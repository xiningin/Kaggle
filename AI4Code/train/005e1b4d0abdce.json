{"cell_type":{"31919201":"code","f442047f":"code","a9d1d0d3":"code","bd421a3b":"code","b941c8f5":"code","ff0b20ba":"code","3bb6c517":"code","66486b2a":"code","72def0cf":"code","0a9b83e3":"code","7e72b88e":"code","178bb5d0":"code","641117ce":"code","bdde2a09":"code","24c20def":"code","613b59af":"code","11007e20":"code","212e9810":"code","4c90e47a":"code","61af0717":"code","a4756299":"code","10f2c51a":"code","c2a43858":"markdown","8b01f7e2":"markdown","f02e23a5":"markdown","69f35513":"markdown","dbf67136":"markdown","e85db82c":"markdown","75fca2a6":"markdown","3b18590e":"markdown","019f7ed0":"markdown","65252c4d":"markdown","c275e944":"markdown","72082da7":"markdown","a1da1d7d":"markdown","24f6b891":"markdown","f3ca482f":"markdown"},"source":{"31919201":"import pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom sklearn.utils import resample\nimport numpy as np\nfrom sklearn.impute import SimpleImputer\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.ensemble import RandomForestClassifier\n","f442047f":"bank_data=pd.read_csv('..\/input\/credit-card-customers\/BankChurners.csv')\nbank_data.head()\n","a9d1d0d3":"bank_data.drop(columns='CLIENTNUM',inplace=True)\nbank_data.drop(columns=['Naive_Bayes_Classifier_Attrition_Flag_Card_Category_Contacts_Count_12_mon_Dependent_count_Education_Level_Months_Inactive_12_mon_1','Naive_Bayes_Classifier_Attrition_Flag_Card_Category_Contacts_Count_12_mon_Dependent_count_Education_Level_Months_Inactive_12_mon_2'],inplace=True)\nbank_data['Attrition_Flag'].replace({'Existing Customer':0,'Attrited Customer':1},inplace=True)\n","bd421a3b":"corr=bank_data.corr()\ncmap = \"tab20\"\nplt.figure(figsize=(20, 20))\nax = sns.heatmap(\n    corr, \n    vmin=-1, vmax=1, center=0,\n    cmap=cmap,\n    square=True,linewidths=.5\n)\nax.set_xticklabels(\n    ax.get_xticklabels(),\n    rotation=45,\n    horizontalalignment='right'\n);\n\n","b941c8f5":"bank_data=pd.read_csv('..\/input\/credit-card-customers\/BankChurners.csv')\nbank_data.drop(columns='CLIENTNUM',inplace=True)\nbank_data.drop(columns=['Naive_Bayes_Classifier_Attrition_Flag_Card_Category_Contacts_Count_12_mon_Dependent_count_Education_Level_Months_Inactive_12_mon_1','Naive_Bayes_Classifier_Attrition_Flag_Card_Category_Contacts_Count_12_mon_Dependent_count_Education_Level_Months_Inactive_12_mon_2'],inplace=True)\n","ff0b20ba":"income_per_edu=bank_data.groupby(by='Education_Level')['Income_Category'].value_counts()\nincome_per_college=(income_per_edu['College']\/income_per_edu['College'].sum())*100\nincome_per_doctorate=(income_per_edu['Doctorate']\/income_per_edu['Doctorate'].sum())*100\nincome_per_graduate=(income_per_edu['Graduate']\/income_per_edu['Graduate'].sum())*100\nhighest_income_per_doctorate=income_per_doctorate[-1]\nhighest_income_per_college=income_per_college[-1]\nhighest_income_per_graduate=income_per_graduate[-1]\nplt.figure(figsize=(8, 8))\nincome_per_female=plt.pie(x=[highest_income_per_graduate,highest_income_per_college,highest_income_per_doctorate],labels=['Graduate','College','Doctorate'],autopct='%1.2f%%',\n        shadow=True, startangle=90,colors=['yellow','green','purple'])\nplt.title('$120K+');","3bb6c517":"customer_age_distribution=sns.distplot(a=bank_data['Customer_Age'],color='orange')","66486b2a":"income_per_gender=bank_data.groupby(by='Gender')['Income_Category'].value_counts()","72def0cf":"female_less_than_40K=((income_per_gender['F']['Less than $40K'])\/income_per_gender['F'].sum())*100\nfemale_between_40k_to_60k=((income_per_gender['F']['$40K - $60K'])\/income_per_gender['F'].sum())*100\nfemale_unknown=100-(female_less_than_40K+female_between_40k_to_60k)\nmale_less_than_40K=((income_per_gender['M']['Less than $40K'])\/income_per_gender['M'].sum())*100\nmale_between_40k_to_60k=((income_per_gender['M']['$40K - $60K'])\/income_per_gender['M'].sum())*100\nmale_60k_to_80k= ((income_per_gender['M']['$60K - $80K'])\/income_per_gender['M'].sum())*100\nmale_80k_to_120k= ((income_per_gender['M']['$80K - $120K'])\/income_per_gender['M'].sum())*100\nmale_above_120k= ((income_per_gender['M']['$120K +'])\/income_per_gender['M'].sum())*100\nmale_unknown=100-(male_less_than_40K+male_between_40k_to_60k+male_60k_to_80k+male_80k_to_120k+male_above_120k)","0a9b83e3":"explode = (0.1, 0.1, 0.2)\nplt.figure(figsize=(10, 10))\nincome_per_female=plt.pie(x=[female_less_than_40K,female_between_40k_to_60k,female_unknown],labels=['less than 40K','40k-60K','Unknown'],explode=explode,autopct='%1.2f%%',\n        shadow=True, startangle=90,colors=['red','pink','purple'])\nplt.title('Female income');","7e72b88e":"explode = (0.2, 0.1, 0.2, 0.1,0.3,0.2)\nplt.figure(figsize=(10, 10))\nincome_per_male=plt.pie(x=[male_less_than_40K,male_between_40k_to_60k,male_60k_to_80k,male_80k_to_120k,male_above_120k,male_unknown],labels=['less than 40K','40k-60k','60k-80k','80k-120k','120k+','unknown'],explode=explode,autopct='%1.2f%%',\n        shadow=True, startangle=45,colors=['red','green','purple','blue','gray','yellow'])\nplt.title('Male income');\n","178bb5d0":"education_per_gender=bank_data.groupby(by='Gender')['Education_Level'].value_counts()\nfemale_education=(education_per_gender['F']\/education_per_gender['F'].sum())*100\nmale_education=(education_per_gender['M']\/education_per_gender['M'].sum())*100   ","641117ce":"explode = (0.2, 0.1, 0.2, 0.1,0.3,0.2,0.1)\nplt.figure(figsize=(10,10))\neducation_per_female=plt.pie(x=[female_education['Graduate'],female_education['High School'],female_education['Unknown'],female_education['Uneducated'],female_education['College'],female_education['Post-Graduate'],female_education['Doctorate']],labels=['Graduate','High School','Unknown','Uneducated','College','Post-Graduate','Doctorate'],explode=explode,autopct='%1.2f%%',\n        shadow=True, startangle=90)\nplt.title('Female Education');","bdde2a09":"explode = (0, 0.1, 0.1, 0.1,0.1,0.1,0.1)\nplt.figure(figsize=(10,10))\neducation_per_male=plt.pie(x=[male_education['Graduate'],male_education['High School'],male_education['Unknown'],male_education['Uneducated'],male_education['College'],male_education['Post-Graduate'],male_education['Doctorate']],labels=['Graduate','High School','Unknown','Uneducated','College','Post-Graduate','Doctorate'],explode=explode,autopct='%1.2f%%',\n        shadow=True, startangle=90)\nplt.title('Male Education');","24c20def":"\nincome_by_edu=bank_data.groupby(by='Education_Level')['Income_Category'].value_counts()\ncollege_income=(income_by_edu['College']\/income_by_edu['College'].sum())*100\nDoctorate_income=(income_by_edu['Doctorate']\/income_by_edu['Doctorate'].sum())*100\nGraduate_income=(income_by_edu['Graduate']\/income_by_edu['Graduate'].sum())*100        \nHigh_School_income=(income_by_edu['High School']\/income_by_edu['High School'].sum())*100    \nPost_Graduate_income =(income_by_edu['Post-Graduate']\/income_by_edu['Post-Graduate'].sum())*100   \nUneducated_income=(income_by_edu['Uneducated']\/income_by_edu['Uneducated'].sum())*100      \n \nplt.figure(figsize=(10,10))\nincome_of_doctorate=plt.pie(x=[Doctorate_income['Less than $40K'],Doctorate_income['$40K - $60K'],Doctorate_income['$60K - $80K'],Doctorate_income['$80K - $120K'],Doctorate_income['$120K +'],Doctorate_income['Unknown']],labels=['less than 40K','40k-60k','60k-80k','80k-120k','120k+','unknown'],autopct='%1.2f%%',\n        shadow=True, startangle=50)\ncentre_circle = plt.Circle((0,0),0.70,fc='white')\nfig = plt.gcf()\nfig.gca().add_artist(centre_circle)\nplt.title('Doctorate Income');","613b59af":"bank_data['Attrition_Flag'].value_counts()\nbank_data['Attrition_Flag'].replace({'Existing Customer':0,'Attrited Customer':1},inplace=True)\nbank_data.head()","11007e20":"existing_customer=bank_data['Attrition_Flag']\nexisting_customer=bank_data[existing_customer==0]\n\nattrited_customer=bank_data['Attrition_Flag']\nattrited_customer=bank_data[attrited_customer==1]\n\nnum_of_existing=existing_customer['Attrition_Flag'].count()\nnum_of_attrited=attrited_customer['Attrition_Flag'].count()\n\nprint(f' The number of attrited customers is:{num_of_attrited}, while the number of existing customers is:{num_of_existing} ')","212e9810":"df_minority_upsampled = resample(attrited_customer, \n                                 replace=True,    \n                                 n_samples=existing_customer['Attrition_Flag'].count()) \ndf_upsampled = pd.concat([existing_customer, df_minority_upsampled])\ndf_upsampled.info()","4c90e47a":"df_upsampled['Gender'].replace({'M':0,'F':1},inplace=True)\ndf_upsampled.replace(to_replace='Unknown',value=np.nan,inplace=True)\ndf_upsampled=pd.get_dummies(df_upsampled,columns=['Education_Level','Marital_Status','Income_Category','Card_Category'])\n","61af0717":"df_upsampled=df_upsampled[['Customer_Age', 'Gender', 'Dependent_count',\n       'Months_on_book', 'Total_Relationship_Count', 'Months_Inactive_12_mon',\n       'Contacts_Count_12_mon', 'Credit_Limit', 'Total_Revolving_Bal',\n       'Avg_Open_To_Buy', 'Total_Amt_Chng_Q4_Q1', 'Total_Trans_Amt',\n       'Total_Trans_Ct', 'Total_Ct_Chng_Q4_Q1', 'Avg_Utilization_Ratio',\n       'Education_Level_College', 'Education_Level_Doctorate',\n       'Education_Level_Graduate', 'Education_Level_High School',\n       'Education_Level_Post-Graduate', 'Education_Level_Uneducated',\n       'Marital_Status_Divorced', 'Marital_Status_Married',\n       'Marital_Status_Single', 'Income_Category_$120K +',\n       'Income_Category_$40K - $60K', 'Income_Category_$60K - $80K',\n       'Income_Category_$80K - $120K', 'Income_Category_Less than $40K',\n       'Card_Category_Blue', 'Card_Category_Gold', 'Card_Category_Platinum',\n       'Card_Category_Silver','Attrition_Flag']]\ndf_upsampled.head()","a4756299":"X=df_upsampled.iloc[:,:-1].values\nY=df_upsampled.iloc[:,-1].values\nimputer = SimpleImputer(missing_values=np.nan, strategy='median')\nX= imputer.fit_transform(X)\nx_train,x_test,y_train,y_test=train_test_split(X,Y,test_size=0.25)\nx_train,x_valid,y_train,y_valid=train_test_split(x_train,y_train,test_size=0.1)\n\nforest=RandomForestClassifier()\ntrain=forest.fit(x_train,y_train)\nacc=train.score(x_valid,y_valid)\nprint(f' The model accuracy on the validation data is :{acc:.2%}')","10f2c51a":"pred=train.predict(x_test)\npred=pred.reshape(-1,1)\ny_test=y_test.reshape(-1,1)\ntotal_predications=pred-y_test\nval,freq=np.unique(total_predications,return_counts=True)\naccuracy=freq[1]\/np.sum(freq)\nprint(f' The model accuracy on the validation data is :{accuracy:.2%}')","c2a43858":" <div style=\"color:black;\n           display:fill;\n           border-radius:5px;\n           font-size:300%;\n           font-family: Times New Roman, Times, serif;\n    letter-spacing:0.5px\"><b> Introduction<\/b><\/div>\n\n<p style=\"padding: 10px;color:black;font-size:130%;font-family: Times New Roman, Times, serif;\"> \nRetaining existing bank customers together with acquiring new customers for bank's credit card services is at the heart of every bank customer service. Having the knowledge in advance, which factor causes customers to leave their credit card services, and the ability to predict which customer going to get churned gives the bank the ability for offering better conditions for the customer and keep him as a satisfied customer. This dataset involves different features about each customer including salary, marital status, credit card limit, credit card category, etc. Initially, data exploration was shown to study the customers and then a model was train to predict churning customers. Here I used <b>Random Forest<\/b> as the classifier and got nearly 98% of accuracy. I'll be happy for any feedback or comment and feel free to send me any questions about the model! thanks in advance\n&#128512;<\/p>","8b01f7e2":"That's surprising, the highest percentage is less than 40K, raising the question, does it worth getting a doctorate?","f02e23a5":" <div style=\"color:black;\n           display:fill;\n           border-radius:5px;\n           font-size:300%;\n           font-family: Times New Roman, Times, serif;\n    letter-spacing:0.5px\"><b>Conclusion<\/b>\n\n<p style=\"padding: 10px;color:black;font-size:40%;font-family: Times New Roman, Times, serif;\">\nMany features can make someone leave his bank, not all of them were taken into account here, such as relocation, death, having a bigger family, etc. Additionally, there is a lot of unknown data and although the median can solve it, it may mislead us, but in general, the model predicted very well the test data with an accuracy of 98%.\n<\/p>","69f35513":"Now let's check the income distribution among doctorates.","dbf67136":" <div style=\"color:black;\n           display:fill;\n           border-radius:5px;\n           font-size:300%;\n           font-family: Times New Roman, Times, serif;\n    letter-spacing:0.5px\">\n\n<p style=\"padding: 10px;color:black;font-size:40%;font-family: Times New Roman, Times, serif;\">\nAs expected doctorate is earning more than the others with the same wage ceiling.\n<\/p>","e85db82c":"<span style=\"font-family: Times New Roman, Times, serif;;\"> <span style=\"color:black;\"><span style=\"font-size:42px;\">  **Import Libraries**","75fca2a6":" <div style=\"color:black;\n           display:fill;\n           border-radius:5px;\n           font-size:300%;\n           font-family: Times New Roman, Times, serif;\n    letter-spacing:0.5px\"><b>Data Insights from the Correlation Map<\/b>\n\n<p style=\"padding: 10px;color:black;font-size:40%;font-family: Times New Roman, Times, serif;\">\nIt can be shown that there is an inverse relationship between the attrition flag to the total relationship count which makes sense. A higher total relationship means that the customer has more assets maintained with the bank. Hence the bank is offering these customers highly attractive and relevant rewards. Therefore, the customer should be more satisfied, less pronounced to leave the bank. On the other end, there is a direct relationship between the monthly activity of the account to the attrition flag. If the account is less active for a longer time, it should raise a red flag for the bank. The same relation between the contacts count, if the bank is calling a lot to the customer, there may be a reason for that. Maybe the customer has debt or maybe the customer calls a lot to complain, or maybe the bank knows that this customer needs a loan which means the customer has a debt makes, him a less satisfied customer. Next, there is an inverse relationship between the attrition flag to the total revolving balance, also reasonable, since this feature means that the certain spending limit is higher so that the customer can spend. An inverse relationship between the attrition flag to total amount change and total transitions amt is also presented. This is more reasonable. If the customer increased their expenditure and their transitions, most of the time it means they are satisfied customers. There is a strong direct relationship between the average utilization ratio since lowering the credit utilization ratio can help a borrower to improve their credit score. Higher scores make the bank more confident that the customer will repay his debts as agreed. Therefore, this customer has a higher score, and he is less pronounced to leave the bank.\n<\/p>","3b18590e":"It can be shown that there are much more data about existing customers than attrited customers. Preventing misclassifications of the model requires us to do upsampling.","019f7ed0":" <div style=\"color:black;\n           display:fill;\n           border-radius:5px;\n           font-size:300%;\n           font-family: Times New Roman, Times, serif;\n    letter-spacing:0.5px\"><b>More Data Exploration<\/b>\n\n<p style=\"padding: 10px;color:black;font-size:40%;font-family: Times New Roman, Times, serif;\">\n\n<\/p>","65252c4d":"Sad but not surprising that women earn less than men dramatically. Although most men earn above 60K(75%) with 15% earn more than 120K , not a single woman earns above 60K. In addition, it can be seen that a lot of women did not report their salary compared to men, perhaps because it is low.","c275e944":" <div style=\"color:black;\n           display:fill;\n           border-radius:5px;\n           font-size:300%;\n           font-family: Times New Roman, Times, serif;\n    letter-spacing:0.5px\">\n\n<p style=\"padding: 10px;color:black;font-size:40%;font-family: Times New Roman, Times, serif;\">\nThe customer age distribution is normal, not surprising that the mean is between 25 to 65. Younger people and older people depend on others, therefore someone else manages their money in his account.\n<\/p>","72082da7":" <div style=\"color:black;\n           display:fill;\n           border-radius:5px;\n           font-size:300%;\n           font-family: Times New Roman, Times, serif;\n    letter-spacing:0.5px\"><b>Training the model<\/b>\n\n<p style=\"padding: 10px;color:black;font-size:40%;font-family: Times New Roman, Times, serif;\">\nIn this section I will replace the unknown data with the median of each column, to avoid outliers, then I'll split the data to train, test and validation. Next, training will be taken using the Random Forest model.\n<\/p>","a1da1d7d":"In the field of education the numbers between men and women are quite similar which makes sense given their distribution in the population.","24f6b891":" <div style=\"color:black;\n           display:fill;\n           border-radius:5px;\n           font-size:300%;\n           font-family: Times New Roman, Times, serif;\n    letter-spacing:0.5px\"><b>Data Exploration<\/b>\n\n<p style=\"padding: 10px;color:black;font-size:40%;font-family: Times New Roman, Times, serif;\">\nHere I'm going to display the data table and try to get some insights out of it. For example, the first column (i.e., Client number can be dropped as well as the two last columns of the naive Bayes). Next, I will show a correlation map and a few pie charts of different features to study the customers. Apart from using one-hot encoding on some of the features, upsampling needs to be taken into account, since this dataset includes more existing customers than attrited customers.\n<\/p>","f3ca482f":" <div style=\"color:black;\n           display:fill;\n           border-radius:5px;\n           font-size:300%;\n           font-family: Times New Roman, Times, serif;\n    letter-spacing:0.5px\"><b>Predications<\/b>\n\n<p style=\"padding: 10px;color:black;font-size:40%;font-family: Times New Roman, Times, serif;\">\nHere the model will try to predict the results of the test data(i.e., the data it didn't see) and measure its accuracy.\n<\/p>"}}