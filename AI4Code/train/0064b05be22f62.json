{"cell_type":{"3c22b0cd":"code","b3233ef8":"code","d518db69":"code","4cca2a79":"code","c5aaec9f":"code","b07165e4":"code","c5ea8e7c":"code","a17aa653":"code","b7467ab5":"code","dc21df3a":"code","eb86cd74":"code","32b69b30":"code","7d125fb2":"code","c26b3a73":"code","48d691bf":"code","f8ebfcca":"code","b0c826c6":"code","d9b451dd":"code","7580b855":"code","c1685f44":"code","c41bce50":"code","1cd7458b":"code","0d4a06db":"code","03c195a1":"markdown","7170edbf":"markdown"},"source":{"3c22b0cd":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport math\nimport cv2\nimport matplotlib.pyplot as plt\nimport os\nimport seaborn as sns\nimport umap\nfrom PIL import Image\nfrom scipy import misc\nfrom os import listdir\nfrom os.path import isfile, join\nimport numpy as np\nfrom scipy import misc\nfrom random import shuffle\nfrom collections import Counter\nimport matplotlib.pyplot as plt\nfrom sklearn.decomposition import PCA\nfrom sklearn.manifold import TSNE\nimport tensorflow as tf\nfrom keras.models import Sequential\nfrom keras.layers import Conv2D, MaxPooling2D\nfrom keras.layers import Activation, Dropout, Flatten, Dense\nfrom keras.utils.np_utils import to_categorical\n","b3233ef8":"os.chdir('..\/input\/utkface_aligned_cropped')","d518db69":"os.chdir('UTKFace')","4cca2a79":"im =Image.open('1_0_0_20161219140623097.jpg.chip.jpg').resize((128,128))\nim","c5aaec9f":"onlyfiles = os.listdir()","b07165e4":"len(onlyfiles)","c5ea8e7c":"shuffle(onlyfiles)\nage = [i.split('_')[0] for i in onlyfiles]","a17aa653":"classes = []\nfor i in age:\n    i = int(i)\n    if i <= 14:\n        classes.append(0)\n    if (i>14) and (i<=25):\n        classes.append(1)\n    if (i>25) and (i<40):\n        classes.append(2)\n    if (i>=40) and (i<60):\n        classes.append(3)\n    if i>=60:\n        classes.append(4)\n","b7467ab5":"X_data =[]\nfor file in onlyfiles:\n    face = misc.imread(file)\n    face =cv2.resize(face, (32, 32) )\n    X_data.append(face)\n","dc21df3a":"X = np.squeeze(X_data)","eb86cd74":"X.shape","32b69b30":"# normalize data\nX = X.astype('float32')\nX \/= 255\n","7d125fb2":"classes[:10]\n","c26b3a73":"categorical_labels = to_categorical(classes, num_classes=5)\n","48d691bf":"categorical_labels[:10]\n","f8ebfcca":"(x_train, y_train), (x_test, y_test) = (X[:15008],categorical_labels[:15008]) , (X[15008:] , categorical_labels[15008:])\n(x_valid , y_valid) = (x_test[:7000], y_test[:7000])\n(x_test, y_test) = (x_test[7000:], y_test[7000:])\n","b0c826c6":"len(x_train)+len(x_test) + len(x_valid) == len(X)\n","d9b451dd":"model = tf.keras.Sequential()\n\n# Must define the input shape in the first layer of the neural network\nmodel.add(tf.keras.layers.Conv2D(filters=64, kernel_size=2, padding='same', activation='relu', input_shape=(32,32,3))) \nmodel.add(tf.keras.layers.MaxPooling2D(pool_size=2))\nmodel.add(tf.keras.layers.Dropout(0.3))\n\nmodel.add(tf.keras.layers.Conv2D(filters=32, kernel_size=2, padding='same', activation='relu'))\nmodel.add(tf.keras.layers.MaxPooling2D(pool_size=2))\nmodel.add(tf.keras.layers.Dropout(0.3))\n\nmodel.add(tf.keras.layers.Flatten())\nmodel.add(tf.keras.layers.Dense(256, activation='relu'))\nmodel.add(tf.keras.layers.Dropout(0.5))\nmodel.add(tf.keras.layers.Dense(5, activation='softmax'))\n\n# Take a look at the model summary\nmodel.summary()\n","7580b855":"model.compile(loss='categorical_crossentropy',\n             optimizer='adam',\n             metrics=['accuracy'])\n","c1685f44":"model.fit(x_train,\n         y_train,\n         batch_size=64,\n         epochs=25,\n         validation_data=(x_valid, y_valid),)","c41bce50":"# Evaluate the model on test set\nscore = model.evaluate(x_test, y_test, verbose=0)\n\n# Print test accuracy\nprint('\\n', 'Test accuracy:', score[1])","1cd7458b":"labels =[\"CHILD\",  # index 0\n        \"YOUTH\",      # index 1\n        \"ADULT\",     # index 2 \n        \"MIDDLEAGE\",        # index 3 \n        \"OLD\",         # index 4\n        ]","0d4a06db":"y_hat = model.predict(x_test)\n\n# Plot a random sample of 10 test images, their predicted labels and ground truth\nfigure = plt.figure(figsize=(20, 8))\nfor i, index in enumerate(np.random.choice(x_test.shape[0], size=15, replace=False)):\n    ax = figure.add_subplot(3, 5, i + 1, xticks=[], yticks=[])\n    # Display each image\n    ax.imshow(np.squeeze(x_test[index]))\n    predict_index = np.argmax(y_hat[index])\n    true_index = np.argmax(y_test[index])\n    # Set the title for each image\n    ax.set_title(\"{} ({})\".format(labels[predict_index], \n                                  labels[true_index]),\n                                  color=(\"green\" if predict_index == true_index else \"red\"))\nplt.show()\n","03c195a1":"**CONVERT IMAGES TO VECTORS**","7170edbf":"We can split the data into Classes\n* Children (1-14) CLASS 0\n* Youth (14-25) CLASS 1\n*  ADULTS (25-40) CLASS 2\n*  Middle age (40-60) CLASS 3\n*  Very Old (>60) CLASS 4"}}