{"cell_type":{"a5bb6c8f":"code","6a721a16":"code","3c128e7b":"code","352ccec5":"code","24580333":"code","11b52ca9":"code","27aba429":"code","f73b4751":"code","c2cc7e58":"code","7aa7020e":"code","639a1e32":"code","e0075c6a":"code","59f0cfd8":"code","62f5275c":"code","3bfc6700":"code","9bc1c488":"code","15979742":"code","82b69792":"code","64d2c184":"code","ea701e17":"code","dca75250":"code","9642e874":"code","ab5cea44":"code","56378afb":"code","d4f32577":"code","bd4da4fd":"code","8698b6f1":"code","c0f508b3":"code","91206f32":"code","36e4a933":"code","7fa3249c":"code","209d689a":"code","dff4a3a0":"code","80067d87":"code","c2aee1fd":"code","867172c1":"code","9f36b103":"code","73010342":"code","a5d17cad":"code","4fbf3bfb":"code","6ab8c22c":"code","6fa253c4":"code","b804d478":"code","00db5d33":"code","f9230cf8":"code","b820835b":"code","0962f4e9":"code","5e8667e1":"code","d52caa34":"code","cf0e14dc":"code","6a7176c8":"code","f60bc5a7":"code","aa47caa3":"code","bf11bc93":"code","39bc9844":"code","77fe3af5":"code","4f2a1b30":"code","0de58436":"code","619bf0a9":"code","95ad27e6":"code","734d85e6":"code","c39634bd":"code","b874fa01":"code","0aceeefe":"code","5e5bbb65":"code","b7e713d0":"code","1ecc1569":"code","fdbf4d21":"code","983c7846":"code","e384f0c1":"code","8e8ed135":"code","7d7cd06f":"code","cb803e9a":"code","bfbceee2":"code","bf30760e":"code","d7e0a71d":"code","fb181284":"code","9ae7a03e":"code","3c84f859":"code","b03e1412":"code","16275250":"code","2667eeda":"code","5c455712":"code","3fc9f73b":"code","ca86508c":"code","81f37482":"code","36f04a4b":"code","7979f2b7":"code","6f968113":"markdown","066429b1":"markdown","47f951a4":"markdown","027a2cb0":"markdown","a6734995":"markdown","22a690a1":"markdown","62dcad5c":"markdown","96b6f744":"markdown","3ea864f2":"markdown","e0a83801":"markdown","afd0eca8":"markdown","ab5c3ccb":"markdown","16deaaae":"markdown","40ff9e28":"markdown","3611c357":"markdown","9a574f84":"markdown","9a69ad0b":"markdown","dee24e95":"markdown","e5522366":"markdown","7163ad55":"markdown","5779451a":"markdown","4465c014":"markdown","946dfdcb":"markdown","b0bffbba":"markdown","776670f0":"markdown","4f426e77":"markdown","b5c141f5":"markdown","c8cb8a9c":"markdown","f6d2051b":"markdown","59443eba":"markdown","3d81831c":"markdown","32f5cb5f":"markdown","6c48538c":"markdown","1171dd74":"markdown","08e7d61b":"markdown","2dc06c3f":"markdown","f87c58e8":"markdown","6fb7e768":"markdown","4818fd40":"markdown"},"source":{"a5bb6c8f":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\n\nimport os","6a721a16":"#First, taking a look at the list files that is available available\nprint(os.listdir(\"..\/input\/\"))","3c128e7b":"application_train_df = pd.read_csv('..\/input\/application_train.csv')","352ccec5":"application_test_df = pd.read_csv('..\/input\/application_test.csv')","24580333":"application_train_df.head()","11b52ca9":"application_test_df.head()","27aba429":"application_train_df.shape","f73b4751":"application_test_df.shape","c2cc7e58":"#A look at their descriptive statistics\napplication_train_df.describe()","7aa7020e":"application_test_df.describe()","639a1e32":"application_train_df.info()","e0075c6a":"#Showing null details (missing values) of the application_train_df\napplication_train_df.isnull().sum()","59f0cfd8":"plt.figure(figsize = (10,5))\nsns.countplot(x='TARGET', data = application_train_df)","62f5275c":"plt.figure(figsize = (10,5))\nsns.countplot(x='NAME_CONTRACT_TYPE', data = application_train_df, hue='TARGET')","3bfc6700":"plt.figure(figsize = (10,5))\nsns.countplot(x='CODE_GENDER', data = application_train_df, hue='TARGET')","9bc1c488":"plt.figure(figsize=(10,5))\nplt.subplot(1,2,1)\nsns.countplot(x='FLAG_OWN_CAR', data = application_train_df, order=('Y','N'),hue='TARGET')\nplt.subplot(1,2,2)\nsns.countplot(x='FLAG_OWN_REALTY', data = application_train_df, hue='TARGET')\nplt.subplots_adjust(wspace = 0.8)","15979742":"ax = sns.factorplot(x=\"NAME_INCOME_TYPE\", hue=\"NAME_CONTRACT_TYPE\", col=\"TARGET\", data=application_train_df, kind=\"count\",size=4, aspect=1.2)\nax.set_xticklabels(rotation=90)","82b69792":"ax = sns.factorplot(hue=\"NAME_INCOME_TYPE\", x=\"CODE_GENDER\", \n                    col=\"TARGET\",data=application_train_df, \n                    kind=\"count\",size=4, aspect=1.2)","64d2c184":"ax = sns.factorplot(x='OCCUPATION_TYPE', data = application_train_df,\n                    hue = 'TARGET', kind = 'count', size=4, aspect=1.8)\nax.set_xticklabels(rotation=90)","ea701e17":"plt.figure(figsize = (10,5))\nsns.countplot(x='NAME_TYPE_SUITE', data = application_train_df)","dca75250":"sns.factorplot(x=\"AMT_INCOME_TOTAL\", y=\"NAME_INCOME_TYPE\", \n               hue=\"CODE_GENDER\", data=application_train_df, size=4, \n                aspect=2.5, kind=\"bar\", ci=False)","9642e874":"sns.factorplot(x=\"AMT_INCOME_TOTAL\", y=\"OCCUPATION_TYPE\", \n               data=application_train_df[application_train_df.OCCUPATION_TYPE.notnull()],\n               size=4, aspect=2.5, kind=\"bar\", ci=False)","ab5cea44":"plt.figure(figsize = (12,5))\nsns.countplot(x='NAME_EDUCATION_TYPE', data = application_train_df)","56378afb":"plt.figure(figsize = (12,5))\nsns.countplot(x='NAME_HOUSING_TYPE', data = application_train_df)","d4f32577":"ax = sns.factorplot(x='ORGANIZATION_TYPE', data = application_train_df, kind = 'count', size=8, aspect=1.8)\nax.set_xticklabels(rotation=90)","bd4da4fd":"plt.figure(figsize=(10,5))\nsns.distplot(application_train_df['DAYS_BIRTH'], bins = 50, color = 'red')\nplt.title('Showing the Age Distribution')","8698b6f1":"sns.set_style('whitegrid')\nplt.figure(figsize=(10,5))\nsns.distplot(application_train_df['AMT_CREDIT'], bins = 30, kde = False, color = 'red')\nplt.title('Showing the Credit Amount Distribution')","c0f508b3":"sns.set_style('whitegrid')\nplt.figure(figsize=(10,5))\nsns.distplot(application_train_df['AMT_ANNUITY'].dropna(), bins = 30, color = 'red')\nplt.title('Showing the Annuity Amount Distribution')","91206f32":"sns.set_style('whitegrid')\nplt.figure(figsize=(10,5))\nsns.distplot(application_train_df['AMT_GOODS_PRICE'].dropna(), bins = 30, color = 'red')\nplt.title('Showing the Goods Price Amount Distribution')","36e4a933":"sns.set_style('whitegrid')\nsns.jointplot('AMT_CREDIT','AMT_GOODS_PRICE', data=application_train_df, size=8)","7fa3249c":"sns.lmplot(x='AMT_CREDIT', y='AMT_GOODS_PRICE', data=application_train_df, \n           hue='TARGET', size =7 , col='NAME_CONTRACT_TYPE')","209d689a":"sns.lmplot(x='AMT_CREDIT', y='AMT_GOODS_PRICE', data=application_train_df,\n           hue='NAME_CONTRACT_TYPE', size = 7, col='TARGET')","dff4a3a0":"#A quick visual of the entire dataframe showing missing values. It can be seen that much of the apartment and \n# own car age data are missing.\nplt.figure(figsize = (10,5))\nsns.heatmap(application_train_df.isnull(), yticklabels=False, cbar = False, cmap = 'viridis')","80067d87":"application_train_df['DAYS_EMPLOYED'].plot.hist()\nplt.xlabel('DAYS_EMPLOYED')","c2aee1fd":"anomalous_days_employed_train = application_train_df[application_train_df['DAYS_EMPLOYED'] == 365243]\nprint(len(anomalous_days_employed_train))","867172c1":"#Replacing the outliers with NaNs\napplication_train_df['DAYS_EMPLOYED'].replace({365243: np.nan}, inplace = True)","9f36b103":"application_train_df['DAYS_EMPLOYED'].plot.hist()\nplt.xlabel('DAYS_EMPLOYED')","73010342":"def impute_suite(NAME_TYPE_SUITE):\n    if pd.isnull(NAME_TYPE_SUITE):\n        return 'Unaccompanied'\n    else:\n        return NAME_TYPE_SUITE","a5d17cad":"application_train_df['NAME_TYPE_SUITE'] = application_train_df['NAME_TYPE_SUITE'].apply(impute_suite)","4fbf3bfb":"def impute_occupation(cols):\n    OCCUPATION_TYPE=cols[0]\n    AMT_INCOME_TOTAL=cols[1]\n    if pd.isnull(OCCUPATION_TYPE):\n        if AMT_INCOME_TOTAL > 150000.000:\n            return 'Laborers'\n        elif AMT_INCOME_TOTAL < 150000.000:\n            return 'Sales staff'\n    else:\n        return OCCUPATION_TYPE","6ab8c22c":"application_train_df['OCCUPATION_TYPE'] = application_train_df[['OCCUPATION_TYPE', 'AMT_INCOME_TOTAL']].apply(impute_occupation, axis=1)","6fa253c4":"def impute_fond(FONDKAPREMONT_MODE):\n    if pd.isnull(FONDKAPREMONT_MODE):\n        return 'reg oper account'\n    else:\n        return FONDKAPREMONT_MODE","b804d478":"application_train_df['FONDKAPREMONT_MODE'] = application_train_df['FONDKAPREMONT_MODE'].apply(impute_fond)","00db5d33":"def impute_housetype(HOUSETYPE_MODE):\n    if pd.isnull(HOUSETYPE_MODE):\n        return 'block of flats'\n    else:\n        return HOUSETYPE_MODE","f9230cf8":"application_train_df['HOUSETYPE_MODE'] = application_train_df['HOUSETYPE_MODE'].apply(impute_housetype)","b820835b":"application_train_df['WALLSMATERIAL_MODE'] = application_train_df['WALLSMATERIAL_MODE'].fillna(application_train_df['WALLSMATERIAL_MODE'].value_counts().index[0])","0962f4e9":"application_train_df['EMERGENCYSTATE_MODE'] = application_train_df['EMERGENCYSTATE_MODE'].fillna(application_train_df['EMERGENCYSTATE_MODE'].value_counts().index[0])","5e8667e1":"#Imputing NaN values in numeric columns with column median. This action completes the clean up.\napplication_train_df = application_train_df.fillna(application_train_df.median())","d52caa34":"#Cleaned dataframe.\nplt.figure(figsize = (10,5))\nsns.heatmap(application_train_df.isnull(), yticklabels=False, cbar = False, cmap = 'viridis')","cf0e14dc":"corr = application_train_df.corr\n\nplt.figure(figsize = (12,10))\nsns.heatmap(corr(), annot = True)","6a7176c8":"application_train_df = pd.get_dummies(application_train_df, prefix_sep='_', drop_first=True)","f60bc5a7":"print('Below is our newly transformed application_train_df now ready to be trained')\nprint('Application_train_df shape: ', application_train_df.shape)\napplication_train_df.head()","aa47caa3":"#Showing null details (missing values) of the application_test_df\napplication_test_df.isnull().sum()","bf11bc93":"application_test_df['DAYS_EMPLOYED'].plot.hist()\nplt.xlabel('DAYS_EMPLOYED')","39bc9844":"anomalous_days_employed_test = application_test_df[application_test_df['DAYS_EMPLOYED'] == 365243]\nprint(len(anomalous_days_employed_test))","77fe3af5":"#Replacing the outliers with NaNs\napplication_test_df['DAYS_EMPLOYED'].replace({365243: np.nan}, inplace = True)","4f2a1b30":"application_test_df['DAYS_EMPLOYED'].plot.hist()\nplt.xlabel('DAYS_EMPLOYED')","0de58436":"def impute_suite(NAME_TYPE_SUITE):\n    if pd.isnull(NAME_TYPE_SUITE):\n        return 'Unaccompanied'\n    else:\n        return NAME_TYPE_SUITE","619bf0a9":"application_test_df['NAME_TYPE_SUITE'] = application_test_df['NAME_TYPE_SUITE'].apply(impute_suite)","95ad27e6":"def impute_occupation(cols):\n    OCCUPATION_TYPE=cols[0]\n    AMT_INCOME_TOTAL=cols[1]\n    if pd.isnull(OCCUPATION_TYPE):\n        if AMT_INCOME_TOTAL > 150000.000:\n            return 'Laborers'\n        elif AMT_INCOME_TOTAL < 150000.000:\n            return 'Sales staff'\n    else:\n        return OCCUPATION_TYPE","734d85e6":"application_test_df['OCCUPATION_TYPE'] = application_test_df[['OCCUPATION_TYPE', 'AMT_INCOME_TOTAL']].apply(impute_occupation, axis=1)","c39634bd":"def impute_fond(FONDKAPREMONT_MODE):\n    if pd.isnull(FONDKAPREMONT_MODE):\n        return 'reg oper account'\n    else:\n        return FONDKAPREMONT_MODE","b874fa01":"application_test_df['FONDKAPREMONT_MODE'] = application_test_df['FONDKAPREMONT_MODE'].apply(impute_fond)","0aceeefe":"def impute_housetype(HOUSETYPE_MODE):\n    if pd.isnull(HOUSETYPE_MODE):\n        return 'block of flats'\n    else:\n        return HOUSETYPE_MODE","5e5bbb65":"application_test_df['HOUSETYPE_MODE'] = application_test_df['HOUSETYPE_MODE'].apply(impute_housetype)","b7e713d0":"application_test_df['WALLSMATERIAL_MODE'] = application_test_df['WALLSMATERIAL_MODE'].fillna(application_test_df['WALLSMATERIAL_MODE'].value_counts().index[0])","1ecc1569":"application_test_df['EMERGENCYSTATE_MODE'] = application_test_df['EMERGENCYSTATE_MODE'].fillna(application_test_df['EMERGENCYSTATE_MODE'].value_counts().index[0])","fdbf4d21":"application_test_df = application_test_df.fillna(application_test_df.median())","983c7846":"plt.figure(figsize = (10,5))\nsns.heatmap(application_test_df.isnull(), yticklabels=False, cbar = False, cmap = 'viridis')","e384f0c1":"application_test_df = pd.get_dummies(application_test_df, prefix_sep='_', drop_first=True)","8e8ed135":"print('Below is our newly transformed application_test_df')\nprint('Application_test_df shape: ', application_test_df.shape)\napplication_test_df.head()","7d7cd06f":"print('Training Features shape: ', application_train_df.shape)\nprint('Testing Features shape: ', application_test_df.shape)","cb803e9a":"#Saving the Target column to re-add it again later\napplication_train_df_TARGET = application_train_df['TARGET']","bfbceee2":"application_train_df.drop('TARGET', axis=1, inplace = True)","bf30760e":"application_train_df, application_test_df = application_train_df.align(application_test_df, join = 'inner', axis = 1)","d7e0a71d":"#ALigned dataframes\nprint('Training Features shape: ', application_train_df.shape)\nprint('Testing Features shape: ', application_test_df.shape)","fb181284":"application_train_df = pd.concat([application_train_df, application_train_df_TARGET], axis=1)","9ae7a03e":"application_train_df.head()","3c84f859":"print('Training Features shape: ', application_train_df.shape)\nprint('Testing Features shape: ', application_test_df.shape)","b03e1412":"X = application_train_df.drop('TARGET', axis = 1)\ny = application_train_df['TARGET']\n\nX_test = application_test_df #This will be called to test our trained and validated model.","16275250":"from sklearn.model_selection import train_test_split ","2667eeda":"x_train, x_valid, y_train, y_valid = train_test_split(X, y, test_size=0.3, random_state=1001)","5c455712":"import lightgbm as lgbm","3fc9f73b":"#Creating our Training and Validation Sets respectively\nlgbm_train = lgbm.Dataset(data=x_train, label=y_train)\nlgbm_valid = lgbm.Dataset(data=x_valid, label=y_valid)","ca86508c":"#We now define our parameters\nparams = {}\nparams['task'] = 'train'\nparams['objective'] = 'binary'\nparams['boosting_type'] = 'gbdt'\nparams['num_iteration'] = 10000\nparams['learning_rate'] = 0.003\nparams['metric'] = 'auc'\nparams['num_leaves'] = 80\nparams['min_data_in_leaf'] = 100\nparams['max_depth'] = 8\nparams['min_child_weight'] = 80\nparams['reg_alpha'] = 0.05\nparams['reg_lambda'] = 0.08\nparams['min_split_gain'] = 0.03\nparams['sub_sample'] = 0.9\nparams['colsample_bytree'] = 0.95","81f37482":"lgbm_model = lgbm.train(params, lgbm_train, valid_sets=lgbm_valid, early_stopping_rounds=200, verbose_eval=200)","36f04a4b":"#Limiting the number of features to displayed to 120\nlgbm.plot_importance(lgbm_model, figsize=(12, 25), max_num_features=120)","7979f2b7":"proba_predictions = lgbm_model.predict(X_test)\nsubmit_lgbm = pd.DataFrame()\nsubmit_lgbm['SK_ID_CURR'] = application_test_df['SK_ID_CURR']\nsubmit_lgbm['TARGET'] = proba_predictions\nsubmit_lgbm.to_csv(\"lgbm_baseline_model.csv\", index=False)\nsubmit_lgbm.head(20)","6f968113":"Imports of libraries we'll be using for a start","066429b1":"External sources 3 and 2 as well as customer's age are the top three most important features in predicting whether a customer would default or not. While we do not know the exact sources of the External sources data, it maybe inferred that it could probably be related to customer's credit scores which are provided by external agencies and are vital determinant of credit worthiness.","47f951a4":"Much of the loans are of the Cash category.","027a2cb0":"**Predictions**","a6734995":"Well, not very important to us as it is right now. Too many features to be decipherable. ","22a690a1":"**The Cleaned Application_Train DataFrame**","62dcad5c":"**Model Training**","96b6f744":"The application_train dataframe has 122 columns (121 features plus the target) and 307511 rows or observations.","3ea864f2":"**The Cleaned Application_Test DataFrame**","e0a83801":"**Read The Data**\n\nReading the CSV files into Pandas DataFrame","afd0eca8":"Time to carry out some basic cleansing operation with the perculiarities of the columns in mind starting with the categorical columns and then the numeric ones.","ab5c3ccb":"Taking a look at what our application and test dataframes look like, including a quick glance at their descriptive statistics.","16deaaae":"There are 9274 outliers in the \"DAYS_EMPLOYED\" column of the application_test_df out of 48744 which represents roughly 19% of the observations. This is comparable to that of the application_train_df which is roughly 18%.","40ff9e28":"The clients own more realty than they do own cars. ","3611c357":"**Baseline Model**\n\nTraining our model with the cleaned application_test and application_train dataframes. We now load the outputted dataframes respectively.","9a574f84":"**Application_Test DataFrame Cleanup**","9a69ad0b":"There seems to be a decent amount of business-minded individuals among the customer base of HomeCredit. ","dee24e95":"Showing a countplot of the target column","e5522366":"There are 55374 outliers in the DAYS_EMPLOYED column in the application train dataset which is pretty significant. The concluded strategy to handle this is to temporarily replace these outliers with NaN values and subsequently treating them as such when dealing with the other NaN (missing) values in the DataFrame. Also, this will be carried out while cleaning the application_test dataframe as well.","7163ad55":"Train and Test aligned. Now add back the 'Target'.","5779451a":"**Aligning The Two DataFrames**\n\nWhile the application test dataframe does not contain the \"TARGET\" column, it is however 3 columns less that the application train dataframe. So we have to align the two dataframes to be able to use them in our model. To accomplish that, we first drop the \"TARGET\" column in the application_train_df , align and then add it back.","4465c014":"While the application_test dataframe has 121 columns (features only) and 48744 rows or observations.","946dfdcb":"**Features Importance**\n\nLet's see a chart of the ranking of the features according to their importance to predicting the target.","b0bffbba":"The visual above shows that there are way more customers that are not having challenges meeting up with their loan obligations. However, it is still an issue to have that much clients struggling with their loans.","776670f0":"And finally, a glimpse of how the various occupation types compare regarding income total amount. Not a lot of variation, however, Managers earns the most.","4f426e77":"The concludes the categorical columns. Now to fill the numerical ones with column medians.","b5c141f5":"**Data Cleansing**\n\nNow lets do a bit of cleaning the data having done some visuals to understand the dataset much better.\n\nThe heatmap below, shows the profile of the dataframe with missing values highlighted in yellow.","c8cb8a9c":"How the total income earned varies by the income type categories. As perhaps would be expected, the \"Businessman\" category has the highest income. Interestingly, the \"Maternity leave\" category appears to provide a decent payday as well.","f6d2051b":"Next is to separate our features (X) from the label\/Target(y) into two separate dataframes","59443eba":"**Categorical Features Dummification**\n\nHaving cleaned up our dataframe, we now move on to create dummy variables for our categorical columns.  In doing so, we drop the first columns of each of the transformed dummy variable columns to avoid collinearity problems in our model.","3d81831c":"We can quickly see the columns with Null values in the dataframe and this will be helpful when we get to the cleansing aspect of the project in preparing the data for the Machine Model.","32f5cb5f":"Another chart of the **Distribution of DAYS_EMPLOYED** now looks like this. Which makes more sense than previously.","6c48538c":"**LightGBM Framework**\n\nWe will be using the LightGBM framework for our classification. This was chosen for it's high performance in terms speed, memory usage as our data size is pretty large, as well as its focus on accuracy.","1171dd74":"**Features Correlation**\n\nLet's take a look to see if there is any meaningful correlation between the features. ","08e7d61b":"From the descriptive statisitics shown earlier, we saw that the maximum value for \"DAYS_EMPLOYED\", is not only positive which is an anomally of its own given that the column is supposed to be negative all through, but it is also too large to represent a reasonable figure. As a result, it is an anomally and would be treated as such. \nFirst, let's take a look at the distribution of this column.\n\n**Distribution of DAYS_EMPLOYED**","2dc06c3f":"Applying the same treatment to the \"DAYS_EMPLOYED\" column of the Application_test_df as that earlier applied to the Application_train_df. But first of, let's look at the distribution. ","f87c58e8":"We now split our X and y variables into training and validation sets.","6fb7e768":"**Exploratory Data Analysis(EDA)**\n\nHaving taking a glimpse at what our application dataframe looks like, now lets dive a little bit into exploring the data to uncover as many insights and trends that we can gained through visualization.","4818fd40":"There are much more females than males based on the above. "}}