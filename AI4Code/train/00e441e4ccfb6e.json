{"cell_type":{"813e5af6":"code","bfb04c00":"code","7f878feb":"code","8bf29312":"code","39395705":"code","6579c96a":"code","5584dc16":"code","5d427a47":"code","e2df96a1":"code","b9cb7d82":"code","f520d66b":"code","63107eed":"code","c6440141":"code","157b7393":"code","15a8610c":"code","c14d5093":"code","73ee0ebf":"code","7f5ba05a":"code","9d02a9a5":"code","0d8b7cf4":"code","249942ae":"code","2e8d5726":"code","b3265bba":"code","5a000841":"code","e6a98940":"code","b230403e":"markdown","6520a99a":"markdown","14473200":"markdown","05ef92fc":"markdown","16b1f648":"markdown","60bd0eb1":"markdown","afa71306":"markdown","db671d93":"markdown","c12c9c7f":"markdown","9d694d27":"markdown"},"source":{"813e5af6":"import pandas as pd \nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom imblearn.over_sampling import RandomOverSampler,SMOTE\nfrom imblearn.under_sampling  import RandomUnderSampler","bfb04c00":"data = pd.read_csv('\/kaggle\/input\/health-insurance-cross-sell-prediction\/train.csv')\ntest = pd.read_csv('\/kaggle\/input\/health-insurance-cross-sell-prediction\/test.csv')\ndata","7f878feb":"data.info()","8bf29312":"data.Response.value_counts()\n\nprint(data.Response.value_counts()\/data.shape[0] *100)","39395705":"data.drop('id',axis=1,inplace=True)\nID = test['id']\ntest.drop('id',axis=1,inplace=True)","6579c96a":"print(data['Vehicle_Age'].value_counts(),test['Vehicle_Age'].value_counts())\nprint(data['Region_Code'].value_counts(),test['Region_Code'].value_counts())","5584dc16":"region_code = data.groupby(['Region_Code'])['Response'].sum().sort_values().to_dict()\npolicy_channel = data.groupby(['Policy_Sales_Channel'])['Response'].sum().sort_values().to_dict()","5d427a47":"from sklearn.preprocessing import LabelEncoder \nl = LabelEncoder()\ndata['Gender'] = l.fit_transform(data['Gender'])\ndata['Vehicle_Age'] = l.fit_transform(data['Vehicle_Age'])\ndata['Vehicle_Damage'] = l.fit_transform(data['Vehicle_Damage'])\n#data['Policy_Sales_Channel'] = l.fit_transform(data['Policy_Sales_Channel'])\n\ntest['Gender'] = l.fit_transform(test['Gender'])\ntest['Vehicle_Age'] = l.fit_transform(test['Vehicle_Age'])\ntest['Vehicle_Damage'] = l.fit_transform(test['Vehicle_Damage'])\ntest['Vehicle_Age'] = l.fit_transform(test['Vehicle_Age'])","e2df96a1":"data","b9cb7d82":"sns.pairplot(data)","f520d66b":"data.corr()","63107eed":"data['Region_Code'].replace(region_code,inplace=True)\ndata['Policy_Sales_Channel'].replace(policy_channel,inplace=True)\n\ntest['Region_Code'].replace(region_code,inplace=True)\ntest['Policy_Sales_Channel'].replace(policy_channel,inplace=True)\ndata","c6440141":"# as you can see the correlation of region code with response has increased\ndata.corr()","157b7393":"plt.figure(figsize=(15, 15))\n\nfor i, col in enumerate(data.columns,1):\n    plt.subplot(5,4, i)\n    sns.boxplot(y=col,data=data)\n    plt.xlabel(col)\nplt.tight_layout()","15a8610c":"data['Annual_Premium'].hist(bins=50)","c14d5093":"## Annual Premium has many ouliers so applying log transformation\ndata['Annual_Premium'] = np.log(data['Annual_Premium'])\ntest['Annual_Premium'] = np.log(test['Annual_Premium'])\ndata[['Annual_Premium']].boxplot()","73ee0ebf":"data['Annual_Premium'].hist(bins=50)","7f5ba05a":"from sklearn.ensemble import RandomForestClassifier,VotingClassifier\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.model_selection import StratifiedKFold,cross_val_score,GridSearchCV,RandomizedSearchCV,train_test_split\nfrom sklearn import svm\nfrom sklearn.metrics import classification_report,confusion_matrix\nimport xgboost","9d02a9a5":"X = data.iloc[:,:-1]\ny = data.iloc[:,-1]\n\noversample = RandomOverSampler(sampling_strategy=0.5)\nX, y = oversample.fit_resample(X, y)\n\nprint(X.shape)\nscale = StandardScaler()\nX = scale.fit_transform(X)\ntest = scale.transform(test)","0d8b7cf4":"from catboost import CatBoostClassifier, Pool","249942ae":"model = CatBoostClassifier(learning_rate=0.03,iterations=800,depth=6,\n                           eval_metric='AUC',task_type=\"GPU\",devices='0:1')","2e8d5726":"model.fit(X,\n          y,\n          eval_set=None,\n          verbose=True)","b3265bba":"model.get_feature_importance()","5a000841":"y_probs = model.predict_proba(test)\ny_probs","e6a98940":"y_probs = y_probs[:,1]\nsub_cat = pd.DataFrame({'id':ID,'Response':y_probs})\nsub_cat.set_index('id',inplace=True)\nsub_cat","b230403e":"## Checking Outliers","6520a99a":"Dropping ID column as it has too many discrete values","14473200":"Checking the percentages of 1's and 0's in target variable","05ef92fc":"Applying logarithmic transformation on Annual Premium to reduce the skewness of the data and also to scale down the values.","16b1f648":"Below are the parameter weights.\n\nYou can see that Previously Insured feature as played a crucial role of all in predicting the output.","60bd0eb1":"# Importing necessary libraries\n\nRandomOverSampler and SMOTE(Synthetic Minority Oversampling Technique) are used to treat imbalanced datasets. \n\nRandomOverSampler duplicates the minority class data until minority class data reaches specified proportion of majority class data.\n\nSMOTE generates synthetic data of minority classes and ensures that the data doesn't overfit.","afa71306":"## Feature Scaling","db671d93":"Label encoding all categorical features.\n\nGender is a nominal variable but since it has only two genders, Male and Female, doing one-hot encoding with drop first as True and label encoding will fetch same results. \n","c12c9c7f":"# Concepts included in this notebook:\n    \n 1)  Data Analysis\n \n 2)  Encoding \n \n 3)  Handling imbalenced classes \n \n 4)  Training a catboost classifier","9d694d27":"To replace region code, summing the number of positive responses for each region code and transforming it into dictionary."}}