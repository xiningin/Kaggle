{"cell_type":{"db53b507":"code","9f2ab95c":"code","b75bf19b":"code","1a4afd97":"code","184a21ce":"code","a8568a34":"code","62e4710d":"code","69e47f90":"code","02077f9d":"code","7dace473":"code","3fa4c4c6":"code","8b95c985":"code","88065de4":"code","4ceb9156":"code","ff4db464":"code","0c255701":"code","9b10c5c0":"code","a16e062a":"code","d9b3c64d":"code","c73bf8e3":"code","521afdef":"code","ba596a33":"code","3bd0532b":"code","d0cf50d7":"code","b2a39863":"code","537aa01a":"code","ca657e62":"markdown","74b4f37b":"markdown","947fc3aa":"markdown","ae4fe750":"markdown","f635a016":"markdown","3195a2d8":"markdown","7c6f6691":"markdown","d0dafad8":"markdown","25215546":"markdown","fad75f27":"markdown","4e0d7670":"markdown","aa990e4a":"markdown","1df75640":"markdown","908beb25":"markdown","9ec2cd8c":"markdown"},"source":{"db53b507":"import numpy as np \nimport pandas as pd \nimport os\nimport re\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\nsns.set_style(\"white\")","9f2ab95c":"## got parts of this from NMenezes Kernel couldnt figure importing all csv at once out!\n\n#Dataset: \ncsv_array =[] # Saving a list of all possible csv names\n\ndict_df = dict()\nfor file in os.listdir(\"..\/input\/dutch-energy\/dutch-energy\/Electricity\/\"):\n    \n    company = file.split('_')[0]\n    year = re.findall('2+[0-9]+',file.split('_')[2])[0]\n    dict_df[company+year] = pd.read_csv(\"..\/input\/dutch-energy\/dutch-energy\/Electricity\/\"+file)\n    csv_array.append(company+year)\n\n#Long \/ Lat data:    \ndf_cities = pd.read_csv(\"..\/input\/long-and-latitude-of-most-nl-towns\/nl_towns.csv\",delimiter=\";\", encoding = \"ISO-8859-1\")  \n\n# convert city names to lowercase\ndf_cities[\"city\"] = df_cities[\"city\"].str.lower()\nfor file_name in csv_array:\n    dict_df[file_name][\"city\"]= dict_df[file_name][\"city\"].str.lower()\n","b75bf19b":"dict_df[\"enexis2018\"].head()","1a4afd97":"df_cities.drop(df_cities[df_cities[\"long\"]<30].index,inplace=True) #Drop Long\/lat data from nl colonies\nsns.scatterplot(y=\"long\",x=\"lat\",data=df_cities)\n","184a21ce":"for file_name in csv_array:\n    dict_df[file_name] = pd.merge(dict_df[file_name],df_cities,how='left', on='city')\n    dict_df[file_name][['long', 'lat']] = dict_df[file_name][['long', 'lat']].fillna(0)\n    dict_df[file_name][\"produced_energy\"] =  dict_df[file_name][\"delivery_perc\"]*dict_df[file_name][\"annual_consume\"] #Self produces energy\n\n\n","a8568a34":"#data cleanup: \ndict_df[\"enexis2018\"][\"pop\"][dict_df[\"enexis2018\"][\"city\"]==\"zwolle\"] = 111805.0\ndict_df[\"enexis2018\"][\"pop\"][dict_df[\"enexis2018\"][\"city\"]==\"boekel\"] = 5480.0\ndict_df[\"enexis2018\"][\"pop\"][dict_df[\"enexis2018\"][\"city\"]==\"gennep\"] = 16642.0\ndict_df[\"stedin2018\"][\"pop\"][dict_df[\"stedin2018\"][\"city\"]==\"weert\"] = 48662.0","62e4710d":"missing_gis = 0 \nfor file_name in csv_array:\n    df_in_question = dict_df[file_name].groupby(\"city\").mean()\n    missing_gis += len(df_in_question[df_in_question[\"long\"]==0])\nprint(\"Currently we have: \"+str(missing_gis)+\" missing values for Longitude and Latitude\") ","69e47f90":"#code for creating the gif is based of Bojk's kernel: https:\/\/www.kaggle.com\/bberghuis\/dutch-electricity-a-first-look\n#kind = \"_smartmeter_perc\"\n#for i in range(2010,2019):\n#    f = plt.figure(figsize=(15,15))\n#    y=str(i)\n#\n#    sns.scatterplot(y=\"long\",x=\"lat\",data=dict_df['enexis'+y].groupby(\"city\").mean(),label=\"Enexis\",s=dict_df['enexis'+y].groupby(\"city\").mean()[\"smartmeter_perc\"])\n#    sns.scatterplot(y=\"long\",x=\"lat\",data=dict_df['liander'+y].groupby(\"city\").mean(),label=\"Liander\",s=dict_df['liander'+y].groupby(\"city\").mean()[\"smartmeter_perc\"])\n#    sns.scatterplot(y=\"long\",x=\"lat\",data=dict_df['stedin'+y].groupby(\"city\").mean(),label=\"Stedin\",s=dict_df['stedin'+y].groupby(\"city\").mean()[\"smartmeter_perc\"])\n#    \n#\n#    plt.title(y,fontsize=18)\n#    plt.ylabel('Longitude')\n#    plt.ylim(50.5,54)\n#    plt.xlabel('Latitude')\n#    plt.xlim(3.9,7.5)\n#    lgnd = plt.legend(['Enexis','Liander','Stedin'],loc='lower right')\n#    lgnd.legendHandles[0]._sizes = [50]\n#    lgnd.legendHandles[1]._sizes = [50]\n#    lgnd.legendHandles[2]._sizes = [50]\n#    f.savefig(y+kind+'.png')\n#    plt.close(f)\n\n\n#import imageio\n#import glob\n#files = glob.glob(\"*\"+kind+'.png')\n#files = np.sort(files)\n#from shutil import copyfile\n#for file in files:\n#    copyfile(file, file.split('.')[0]+'_1.png')\n#files = glob.glob(\"*\"+kind+\"_1\"+'.png')\n#filey = glob.glob(\"*\"+kind+'.png')\n#files = filey+files\n#files = np.sort(files)\n#images = []\n#for file in files:\n#    images.append(imageio.imread(file))\n#imageio.mimsave('smartmeter-spread.gif', images)\n#\n# step 3: prep the gif for display in notebook \n#from IPython.display import Image\n#Image(\"smartmeter-spread.gif\")\n","02077f9d":"# Calculate the rate of smart meter roll out:\n# smart_meter%[year+1]-smart_meter%[year]:\nenergy_supplier = [\"enexis\",\"liander\",\"stedin\"]\nfor supplier in energy_supplier:\n    for year in range(2010,2019):\n        y = str(supplier+str(year))\n        if y == supplier+\"2010\":\n          dict_df[y][\"smartmeter_rate\"] = 0\n        else:\n          dict_df[y][\"smartmeter_rate\"] = dict_df[y][\"smartmeter_perc\"]-dict_df[str(supplier+str(year-1))][\"smartmeter_rate\"]\n    ","7dace473":"#code for creating the gif is based of Bojk's kernel: https:\/\/www.kaggle.com\/bberghuis\/dutch-electricity-a-first-look\n\n#kind = \"_smartmeter_rate\"\n#for i in range(2010,2019):\n#    f = plt.figure(figsize=(15,15))\n#    y=str(i)\n\n#    sns.scatterplot(y=\"long\",x=\"lat\",data=dict_df['enexis'+y].groupby(\"city\").mean(),label=\"Enexis\",s=dict_df['enexis'+y].groupby(\"city\").mean()[\"smartmeter_rate\"])\n#    sns.scatterplot(y=\"long\",x=\"lat\",data=dict_df['liander'+y].groupby(\"city\").mean(),label=\"Liander\",s=dict_df['liander'+y].groupby(\"city\").mean()[\"smartmeter_rate\"])\n#    sns.scatterplot(y=\"long\",x=\"lat\",data=dict_df['stedin'+y].groupby(\"city\").mean(),label=\"Stedin\",s=dict_df['stedin'+y].groupby(\"city\").mean()[\"smartmeter_rate\"])\n    \n\n#    plt.title(y,fontsize=18)\n#    plt.ylabel('Longitude')\n#    plt.ylim(50.5,54)\n#    plt.xlabel('Latitude')\n#    plt.xlim(3.9,7.5)\n#    lgnd = plt.legend(['Enexis','Liander','Stedin'],loc='lower right')\n#    lgnd.legendHandles[0]._sizes = [50]\n#    lgnd.legendHandles[1]._sizes = [50]\n#    lgnd.legendHandles[2]._sizes = [50]\n#    f.savefig(y+kind+'.png')\n#    plt.close(f)\n\n\n\n#import imageio\n#import glob\n#files = glob.glob(\"*\"+kind+'.png')\n#files = np.sort(files)\n#from shutil import copyfile\n#for file in files:\n#    copyfile(file, file.split('.')[0]+'_1.png')\n#    copyfile(file, file.split('.')[0]+'_1_1.png')\n#files = glob.glob(\"*\"+kind+\"_1\"+'.png')\n#filey = glob.glob(\"*\"+kind+'.png')\n#fileyy = glob.glob(\"*\"+kind+\"_1\"+\"_1\"+'.png')\n#files = filey+files+fileyy\n#files = np.sort(files)\n#images = []\n#for file in files:\n#    images.append(imageio.imread(file))\n#imageio.mimsave('smartmeter-rate.gif', images)\n\n#from IPython.display import Image\n#Image(\"smartmeter-rate.gif\")\n","3fa4c4c6":"import json\nimport requests","8b95c985":"response = requests.get(\"https:\/\/api.openchargemap.io\/v2\/poi\/?output=json&countrycode=NL&maxresults=1000000&compact=true&verbose=false&opendata=true\")\ndata_chargers = json.loads(response.text)","88065de4":"#save all town and lat long from smart charger stations:\nn_results = len(data_chargers)\n\ndf_chargers = pd.DataFrame(columns=[\"city\",\"long\",\"lat\"])\ndict_chargers=[]\nfor i in range(n_results):\n    if \"Town\" in data_chargers[i][\"AddressInfo\"] and data_chargers[i][\"AddressInfo\"][\"CountryID\"]==159:\n        dict_chargers.append(dict(zip([\"city\",\"long\",\"lat\"],[data_chargers[i][\"AddressInfo\"][\"Town\"].lower(),data_chargers[i][\"AddressInfo\"][\"Longitude\"],data_chargers[i][\"AddressInfo\"][\"Latitude\"]])))\ndf_chargers = pd.DataFrame(data=dict_chargers)\n\n","4ceb9156":"plt.figure(figsize=(5,5))\nsns.scatterplot(y=\"lat\",x=\"long\",data=df_chargers[(df_chargers[\"lat\"]>50)&(df_chargers[\"lat\"]<55)])","ff4db464":"plt.figure(figsize=(5,5))\ndf_chargers = df_chargers[(df_chargers[\"lat\"]>50)&(df_chargers[\"lat\"]<55)&(df_chargers[\"long\"]<7.3)]\nsns.scatterplot(y=\"lat\",x=\"long\",data=df_chargers)","0c255701":"import mplleaflet\nfrom random import randint\n\nfig, ax = plt.subplots()\nx = [df_chargers[\"long\"][3000:4000]]\ny = [df_chargers[\"lat\"][3000:4000]]\nax.plot(x, y, 'bo')\nmplleaflet.display(fig=fig)","9b10c5c0":"print(\"Start: Number of remaining Data points: \"+ str(len(df_chargers)))\ns1 = pd.Series(df_chargers[\"city\"].value_counts().index)\ns2 = pd.Series(df_chargers[\"city\"].value_counts().values)\ndf = pd.concat([s1, s2], axis=1)\ndf.columns = [\"city\",\"count\"]\ndf_chargers = pd.merge(df_chargers,df,how=\"left\",on=\"city\")\ndf_chargers.drop_duplicates(inplace=True,subset=[\"city\"])\n\nprint(\"End: Number of remaining Data points: \"+ str(len(df_chargers)))","a16e062a":"plt.figure(figsize=(10,10))\ndf_chargers = df_chargers[(df_chargers[\"lat\"]>50)&(df_chargers[\"lat\"]<55)&(df_chargers[\"long\"]<7.3)]\nsns.scatterplot(y=\"lat\",x=\"long\",data=df_chargers,s =df_chargers[\"count\"]*1 )\nplt.text(y=52.070499,x=4.420700,s= \"Den Haag\",horizontalalignment='left', size='medium', color='black')\nplt.text(y=52.370216,x=4.895168,s= \"Amsterdam\",horizontalalignment='left', size='medium', color='black')\nplt.text(y=51.924419,x=4.527733,s= \"Rotterdam\",horizontalalignment='left', size='medium', color='black')","d9b3c64d":"top10_cities = df_chargers[[\"city\",\"count\"]].sort_values(by =[\"count\"],axis=0,ascending=False).head(10)\n\nfor city in top10_cities[\"city\"]:\n    sns.scatterplot(y=\"lat\",x=\"long\",data=df_chargers[df_chargers[\"city\"]==city],s =df_chargers[\"count\"][df_chargers[\"city\"]==city],label=city )\nplt.legend(loc='center right', bbox_to_anchor=(1.5, 0.5), ncol=1)\nplt.text(y=52.070499,x=4.420700,s= \"Den Haag\",horizontalalignment='left', size='medium', color='red')\nplt.text(y=52.370216,x=4.895168,s= \"Amsterdam\",horizontalalignment='right', size='medium', color='red')\nplt.text(y=51.924419,x=4.527733,s= \"Rotterdam\",horizontalalignment='left', size='medium', color='red')","c73bf8e3":"#Add chargers to data frames:\nfor file_name in csv_array:\n    dict_df[file_name] = pd.merge(dict_df[file_name],df_chargers.drop([\"lat\",\"long\"],axis=1),how='left', on='city')\n    dict_df[file_name].fillna(0).replace(np.inf, 0)\n\n","521afdef":"# calculate chargers \/ citizens\n\nfor file_name in csv_array:\n    dict_df[file_name][\"chargers_pop\"] =  dict_df[file_name][\"count\"]\/ dict_df[file_name][\"pop\"]\n    dict_df[file_name][\"chargers_pop\"].replace(np.inf, 0,inplace=True)\n","ba596a33":"dict_df[\"enexis2018\"].head()","3bd0532b":"y=str(2018)\nsns.scatterplot(y=\"long\",x=\"lat\",data=dict_df['enexis'+y].groupby(\"city\").mean(),label=\"Enexis\",s=dict_df['enexis'+y].groupby(\"city\").mean()[\"chargers_pop\"]*1000)\nsns.scatterplot(y=\"long\",x=\"lat\",data=dict_df['liander'+y].groupby(\"city\").mean(),label=\"Liander\",s=dict_df['liander'+y].groupby(\"city\").mean()[\"chargers_pop\"]*1000)\nsns.scatterplot(y=\"long\",x=\"lat\",data=dict_df['stedin'+y].groupby(\"city\").mean(),label=\"Stedin\",s=dict_df['stedin'+y].groupby(\"city\").mean()[\"chargers_pop\"]*1000)\nplt.title(\"Chargers per Citizens in the Netherlands\")","d0cf50d7":"print(\"Cities with the highest share of chargers in their population:\")\nprint(dict_df[\"enexis2018\"][[\"city\",\"chargers_pop\"]].drop_duplicates().sort_values(by=[\"chargers_pop\"],axis =0,ascending=False).head(3))\nprint(dict_df[\"liander2018\"][[\"city\",\"chargers_pop\"]].drop_duplicates().sort_values(by=[\"chargers_pop\"],axis =0,ascending=False).head(3))\nprint(dict_df[\"stedin2018\"][[\"city\",\"chargers_pop\"]].drop_duplicates().sort_values(by=[\"chargers_pop\"],axis =0,ascending=False).head(3))\n","b2a39863":"dict_df[\"enexis2018\"][[\"city\",\"pop\"]][dict_df[\"enexis2018\"][\"city\"]==\"zwolle\"].head()","537aa01a":"dict_df[\"enexis2018\"].corr()","ca657e62":"Future work includes:\n\n-  Data clean up\n\n- Connecting lat long data for smart meter spread and charger stations\n  \n- Additional feature calculations\n  \n- Code cleanup & Improvements","74b4f37b":"**Roll out of smart meters and cities with highest amount of electric chargers:**\n![](https:\/\/i.imgur.com\/TaeVTXo.gif)","947fc3aa":"Zwolle almost has one charger for each of their citizens!! Since their citizen count is above 100k it seems rather unrealistic to believe that they have 100k electric chargers!\n\n\nZwolle has the population wrongfully allocated every second line. \nSince we are using the mean() function to group by city for further calculations the wrongful allocation of population to zwolle results in an error for the share of chargers per citizen:","ae4fe750":"Merge Dataframe with Energy consumption and Long Lat data + additional features:","f635a016":"**I decided to add the location of charger stations in the netherlands: **","3195a2d8":"**Quite a lot long and lat data from the query are out of bounds for the netherlands:**","7c6f6691":"**Load all Data from the Dataset aswell as Longitude and Latitude data: **","d0dafad8":"As in case of the wrong lat long data we'll keep them for now since I am not sure how to effectivly remove them from the dataset.\n\nSome are classified with the wrong country code, see: \n","25215546":"**Top 10 cites by number of charger stations:**","fad75f27":"One stepping stone to the future energy grid is the roll out of smart meters. Smart meter's record conumption while communicating the measured data to the electricity supplier for monitoring and billing. Communication in both ways from electricity supplier to consumer and vice versa are both possible enabling the intelligent control of the energy grid. In addition, the consumer can call up his or her energy consumption at any time with time resolution (f.e. via an mobile-app). With direct feedback of energy consumption, consumers tend to archive higher energy savings for electricity and gas consumption. \n\nIn 2014 the dutch goverment decided to roll out smart meters to every home and aim at 3 million households with smart meters by 2016. By 2020 the goverment aims to reach at least 80%, but preferably 100% installed. \n\n![Smart meter example](https:\/\/asset.re-in.de\/isa\/160267\/c1\/-\/de\/1404245_BB_00_FB\/GEO-PCK-MP-003-Energiekosten-Messgeraet-beleuchtete-Anzeige-Kostenprognose-LCD-Farbdisplay-Stromtarif-einstellbar-inkl.jpg?x=225&y=225&ex=225&ey=225&align=center)\n\nThis kernel aims to investigate the roll-out of smart meters by use of Longitude and Latitude data for cities and other additional data sets.\n\nI hope you enjoy my first kernel and some of the ideas I put to the \"Energy consumption of the Netherlands\"-Dataset.\n\n**Work in Progress**","4e0d7670":"Just looking at the gif it seems like there isn't a correlation between charger station distribution and the number of charger stations. Possibly a nominalisation with population (chargers\/pop) is better here! ","aa990e4a":"Distribution of charger stations, size represents the number of charger stations in given city:","1df75640":"In the next gif you can see the roll out rate for each town. The rate increases with the years!\n\n![Smart meter spread](https:\/\/i.imgur.com\/CF8VSbO.gif )\n","908beb25":"Making a visualisation of the smart_meter spreading:\n![Smart meter spread](https:\/\/i.imgur.com\/ANBpQYd.gif )","9ec2cd8c":"Constraining the data set by filtering with maximum lat and long values: "}}