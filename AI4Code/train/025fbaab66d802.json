{"cell_type":{"1fd1550d":"code","60321f1c":"code","2351d663":"code","11ef4738":"code","a177ef84":"code","b333cc47":"code","c2d32e2e":"code","9b60f242":"code","94a38870":"code","9e884bee":"code","1ccdf1a1":"code","19c08c83":"code","d7648192":"code","82ba59e8":"code","6e7c3d6a":"code","493bc70f":"code","01de17a0":"code","d499d0a4":"code","f495c997":"markdown","718c0dd0":"markdown","1f7c5388":"markdown","d8d9ae46":"markdown","87409441":"markdown","e8597923":"markdown","806f901f":"markdown","acde28d8":"markdown","4510bc89":"markdown","53b67074":"markdown","e76372c8":"markdown","03b59963":"markdown","893c59ea":"markdown","d36741ca":"markdown","bff75dbd":"markdown","bdfb722b":"markdown","ad8f9e09":"markdown","bb05715b":"markdown","c9527498":"markdown","6bb2be8b":"markdown","51e93e7a":"markdown","35b06622":"markdown","dab9710e":"markdown"},"source":{"1fd1550d":"\nimport numpy as np \nimport pandas as pd \nimport plotly.express as px\nimport geopandas as gpd\nimport plotly.graph_objects as go\nfrom plotly.offline import init_notebook_mode\nimport json\nimport plotly.graph_objects as go # or plotly.express as px\ninit_notebook_mode()\n\n\n","60321f1c":"df = pd.read_csv('\/kaggle\/input\/global-power-plant-database\/global_power_plant_database.csv')\n\ndf.head()","2351d663":"world = gpd.read_file(gpd.datasets.get_path('naturalearth_lowres'))\nworld.head()","11ef4738":"world = world[['iso_a3','continent']]\ndf = df.merge(world,how = 'left',left_on = 'country',right_on = 'iso_a3')\ndf.info()","a177ef84":"df.loc[pd.isna(df.continent),:].country_long.unique()","b333cc47":"continent_map = {'Bahrain':'Asia','Cape Verde':'Africa','France':'Europe','French Guiana':'South America','Kosovo':'Europe','Mauritius':'Africa','Norway':'Europe','Singapore':'Asia'}\nfor key,val in continent_map.items():\n    df.loc[df.country_long==key,'continent'] = val\ndf['year_of_generation_data'] = ''*len(df)\nyear = np.arange(2017,2012,-1)\nfor y in year:\n    col = 'generation_gwh_'+str(y)\n    before =  df['estimated_generation_gwh'].isna()\n    df['estimated_generation_gwh'].fillna(df[col],inplace = True)\n    after = df['estimated_generation_gwh'].notna()\n    mask = [b and a for b, a in zip(before, after)]\n    df.loc[mask,['year_of_generation_data']] = str(y)\ndf.dropna(subset = ['estimated_generation_gwh'],inplace = True)\ndf.loc[df.year_of_generation_data == '',['year_of_generation_data']] = 'Estimated Data'\ndf = df[['country','country_long','continent','name','commissioning_year','capacity_mw','latitude','longitude','primary_fuel','estimated_generation_gwh','year_of_generation_data']]\ndf.rename(columns = {'country':'country_code','country_long':'country','estimated_generation_gwh':'annual_generation_gwh'},inplace = True)\ndf.drop(df[df.annual_generation_gwh<=0].index,inplace = True)\ndf.sort_values(by = 'annual_generation_gwh',ascending=False,ignore_index = True, inplace = True)\ndf.describe()\n","c2d32e2e":"df.head()","9b60f242":"df.drop(index = [0],inplace = True)\nfuel_map = {'Coal':'Fossil','Gas':'Fossil','Gas':'Fossil','Oil':'Fossil','Petcoke':'Fossil','Geothermal':'Other_renewable','Biomass':'Other_renewable','Storage':'Other',\n            'Cogeneration':'Other','Waste':'Other','Hydro':'Hydro','Nuclear':'Nuclear','Wind':'Wind','Solar':'Solar','Other':'Other'}\ndf['fuel_type'] = df.primary_fuel.map(fuel_map)\nrenewable = ['Hydro','Other_renewable','Wind','Solar']\ndf['renewable'] = ['renewable' if i in renewable else 'non-renewable' for i in df['fuel_type'] ]\ndf.head()","94a38870":"colordict ={'Hydro':'#6495ED','Fossil':'#DEB887','Nuclear':'#CD5C5C','Other_renewable':'#90EE90','Wind':'#20B2AA','Other':'#BDB76B','Solar':'#FFD700'}\nhoverD = {'primary_fuel':True,'capacity_mw':True,'annual_generation_gwh':True,'year_of_generation_data':True,\n          'country':True,'longitude':False,'latitude':False}\nfig = px.scatter_mapbox(df, lat=\"latitude\", lon=\"longitude\",  color=\"fuel_type\", size=\"annual_generation_gwh\",hover_name=\"name\"\n                        ,hover_data =hoverD ,color_discrete_map =colordict, size_max=15, zoom=2,title ='Power Generation around the Globe')\nfig.update_layout(mapbox_style=\"carto-positron\")\nfig.update_layout({'showlegend':True,'legend':{'title': 'Fuel Type'}})\nfig.show()","9e884bee":"df['rank'] = df.index\nfig = px.scatter(df, x=\"rank\", y=\"annual_generation_gwh\",color = 'fuel_type',color_discrete_map =colordict)\nfig.show()","1ccdf1a1":"df['log_gen'] = df.annual_generation_gwh.apply(np.log1p)\nfig = px.scatter(df, x=\"rank\", y=\"log_gen\",color = 'fuel_type',color_discrete_map =colordict)\nfig.show()","19c08c83":"hoverD = {'primary_fuel':True,'capacity_mw':True,'annual_generation_gwh':True,'year_of_generation_data':True,'country':True,'longitude':False,'latitude':False,'log_gen':False}\nfig = px.scatter_mapbox(df, lat=\"latitude\", lon=\"longitude\",  color=\"fuel_type\", size=\"log_gen\",hover_name=\"name\",\n                        hover_data =hoverD ,color_discrete_map =colordict, size_max=12, zoom=2,title ='Power Generation around the Globe (log-scale marker size)')\nfig.update_layout(mapbox_style=\"carto-positron\")\nfig.update_layout({'showlegend':True,'legend':{'title': 'Fuel Type'}})\nfig.show()\n","d7648192":"continents = df.continent.unique()\nfig = go.Figure()\nalllabels = px.sunburst(df, path=['renewable', 'fuel_type','primary_fuel'], values='annual_generation_gwh',color = 'renewable'\n                  ,color_discrete_map={'non-renewable':'#BDB76B','renewable':'#20B2AA'},title = 'Fuel Type Distribution of Power Generation')\nfig.add_trace(alllabels['data'][0])\nfor c in continents:\n    chart = px.sunburst(df.loc[df.continent==c,:], path=['renewable', 'fuel_type','primary_fuel'], values='annual_generation_gwh',color = 'renewable'\n                  ,color_discrete_map={'non-renewable':'#BDB76B','renewable':'#20B2AA'})\n    fig.add_trace(chart['data'][0])\nupdatemenus=[dict(type = \"buttons\", direction = \"down\",active=0,\n             buttons=list([\n                 dict(args=[{'visible': [True  , False  , False , False,False ,False,False]} ,],\n                  label = \"World\"   , method=\"update\"),\n                dict(args=[{'visible': [False  , True  , False , False,False ,False,False]} ,],\n                  label = continents[0]   , method=\"update\"),\n                 dict(args=[{'visible': [False  , False  , True , False,False ,False,False]} ,],\n                  label = continents[1]   , method=\"update\"),\n                 dict(args=[{'visible': [False  , False  , False , True,False ,False,False]} ,],\n                  label = continents[2]  , method=\"update\"),\n                 dict(args=[{'visible': [False  , False  , False , False,True ,False,False]} ,],\n                  label = continents[3]  , method=\"update\"),\n                 dict(args=[{'visible': [False  , False  , False , False,False ,True,False]} ,],\n                  label = continents[4]  , method=\"update\"),\n                 dict(args=[{'visible': [False  , False  , False , False,False ,False,True]} ,],\n                  label = continents[5]   , method=\"update\"),\n            \n             ])),]\nfig.update_layout(updatemenus = updatemenus)\nfig.show()","82ba59e8":"colordict2 ={'(?)':'#708090','Hydro':'#6495ED','Fossil':'#DEB887','Nuclear':'#CD5C5C','Other_renewable':'#90EE90','Wind':'#20B2AA','Other':'#BDB76B','Solar':'#FFD700'}\n\nfig = px.treemap(df, path=[px.Constant('world'),'continent','country', 'fuel_type'], values='annual_generation_gwh',\n                  color='fuel_type',color_discrete_map =colordict2)\nfig.show()","6e7c3d6a":"df2 = df.dropna(subset=['commissioning_year']).sort_values('commissioning_year')\ndf2.head()\npv_time = pd.pivot_table(df2,values = 'capacity_mw',index = ['commissioning_year'],columns = 'fuel_type', aggfunc=np.sum).fillna(0)\npv_time.reset_index(level=['commissioning_year'],inplace=True)\npv_time['commissioning_year'] = pd.to_datetime(pv_time['commissioning_year'],format = '%Y')\npv_time = pv_time.groupby('commissioning_year').sum()\nfor f in pv_time.columns:\n    pv_time[f+'_MA10'] = pv_time[f].rolling(10).mean()\npv_time.reset_index(level=['commissioning_year'],inplace=True)\n","493bc70f":"fig = px.line(pv_time,x = 'commissioning_year',y =['Fossil_MA10','Hydro_MA10','Nuclear_MA10','Other_MA10','Other_renewable_MA10','Solar_MA10','Wind_MA10'],\n             labels=dict(commissioning_year=\"Commissioning Year\", value=\"10 MA of Capacity (mw)\" ))\nfig.show()","01de17a0":"pv_tbl = pd.pivot_table(df,values = 'annual_generation_gwh',index = ['country','country_code'],columns = 'renewable', aggfunc=np.sum)\npv_tbl.fillna(0,inplace = True)\npv_tbl['total'] = pv_tbl['non-renewable']+ pv_tbl['renewable']\npv_tbl['renewable_pct'] = pv_tbl['renewable']\/pv_tbl['total']*100\npv_tbl.reset_index(level=['country', 'country_code'],inplace=True)\n","d499d0a4":"with open('..\/input\/country-outlines\/countries.geo.json') as f:\n    countries = json.load(f)\nfig = px.choropleth_mapbox(pv_tbl, locations=\"country_code\",\n                           geojson=countries,\n                          featureidkey = 'properties.adm0_a3',\n                    color=\"renewable_pct\", \n                    hover_name=\"country\", \n                    color_continuous_scale=px.colors.sequential.YlGn,\n                   title = 'Percentage of Renewable Energy in Power Generation',\n                   zoom = 2)\nfig.update_layout(mapbox_style=\"carto-positron\")\n\nfig.show()","f495c997":"**The sunburst chart below shows what fuels we use to generate electricity in each continent.**","718c0dd0":"Print out the top 5 power plants with the highest annual generation.","1f7c5388":"* Around 25% of power comes from renewable fuels worldwide.\n* South America is blessed with abundant hydro resources.\n* Nuclear power has a considerable share in Europe.","d8d9ae46":"**<br \/>We have walked through various ways to explore global power generation today, and I hope you find this kernel interesting.\n<br \/>If you like this kernel, please give it an upvote or leave a comment below, thank you!**","87409441":"# Where is Our Electricity Coming from?","e8597923":"First thing first, let's import the data. Global_power_plant_database is the primary dataset we will use today.","806f901f":"# Data Cleaning","acde28d8":"* China is the largest power producer in the world.\n* Most of the countries still rely heavily on fossil fuels.\n* France is the only country that uses nuclear as a primary power resource. ","4510bc89":"If we apply logarithm on power generation, the distribution becomes linear, hence the smaller power plants can be seen more clearly on the map.","53b67074":"There are barely any wind farms or solar farms on this map. If we take a look at the distribution of power generation in the chart below, we will find out it is exponential. Since most of the wind farms and solar farms are small-scale with way lower annual generation than that of traditional power plants, the sizes of the markers are squeezed to a tiny point.","e76372c8":"**The map below shows (almost) every power plant in the world, with fuel types and annual generation data. Find out the ones near you!**","03b59963":"There are still some rows without continent, let's find out what these countries are and fill in the corresponding values. <br \/>\nAs for null values in the estimated_generation_gwh attribute, we will fill in the most recent annual generation data available. ","893c59ea":"* Fossil fuel has stopped growing in the early 2010s, after 2 decades of explosive growth.\n* Nuclear experienced a sharp fall in the 1990s, which could be a result of the Chernobyl incident.\n* Wind and solar took off respectively in the 2000s and 2010s.","d36741ca":"The future of humankind looks way more promising on this map! <br \/>\nBut I am wondering whether the solar farms in England have ever worked ;)","bff75dbd":"# Where are the Power Plants Located?","bdfb722b":"**Let's make a treemap to figure out what's the situation in each country.**","ad8f9e09":"# How green is your country?","bb05715b":"**Now that we have explored the power generation in each region and country. Let's find out what's the trend of fuels over time.**","c9527498":"A.E.S. Corp. power plant has extremely high annual generation that is almost 4 times higher than the second one, and generation doesn't match its capacity. So we will drop the first row.","6bb2be8b":"Here is the plot of 10 years moving average of new power plants in terms of annual generation. We can see what are the fuels of the power plants constructed in different eras.","51e93e7a":"And we will add the continent attribute of each country to the power plant database from geopandas world dataset.","35b06622":"![](https:\/\/media2.giphy.com\/media\/xT77XHIPBBGZL9m62I\/giphy.gif?cid=790b7611f3f63a0f153fb2f9f874bfc9aaf67ed70583d060&rid=giphy.gif&ct=g)","dab9710e":"Finally, let's have a glimpse of how every country is doing at sustainable power generation.<br \/>\nPlease note that the data is not up to date, but still, we can have a big picture from the map."}}