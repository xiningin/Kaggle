{"cell_type":{"8d461c47":"code","48a19780":"code","f6cfc1b0":"code","c3f17c6e":"code","f36a17da":"code","6d9e9abb":"code","bd74914f":"code","74e2d5a2":"code","fd208558":"code","1c229cc3":"code","33b8e4b7":"code","0d06aef0":"code","fc94a295":"code","f22d8b24":"markdown","8e4df395":"markdown","d77a6033":"markdown","1a26208e":"markdown","3b45dd3d":"markdown","cc5b66cc":"markdown","b6817be9":"markdown","2768e2fe":"markdown","15d23b9c":"markdown","22097fce":"markdown"},"source":{"8d461c47":"# Import the required libraries \n\nfrom bq_helper import BigQueryHelper\nimport bq_helper\n\nfrom plotly.offline import init_notebook_mode, iplot\nfrom wordcloud import WordCloud\nimport plotly.graph_objs as go\nimport matplotlib.pyplot as plt\nimport plotly.plotly as py\nfrom plotly import tools\n\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n\nimport pandas as pd\ninit_notebook_mode(connected=True)\n\nmedicare = bq_helper.BigQueryHelper(active_project=\"bigquery-public-data\", dataset_name=\"cms_medicare\")\nbq_assistant = BigQueryHelper(\"bigquery-public-data\", \"cms_medicare\")","48a19780":"# How many nurrsing facilitins in different States \nquery1 = \"\"\"SELECT\nstate, COUNT(state) as total_facilities\nFROM\n  `bigquery-public-data.cms_medicare.nursing_facilities_2014`\n  GROUP BY \n  state\nORDER BY\n  total_facilities DESC;\"\"\"\nresponse1 = medicare.query_to_pandas_safe(query1)\nresponse1.head(55)","f6cfc1b0":"scl = [[0.0, 'rgb(248,255,206)'],[0.2, 'rgb(203,255,205)'],[0.4, 'rgb(155,255,164)'], [0.6, 'rgb(79,255,178)'],[0.8, 'rgb(15,183,132)'], [1, '#008059']]\nquery1 = \"\"\"SELECT\nstate, COUNT(state) as total_facilities\nFROM\n  `bigquery-public-data.cms_medicare.nursing_facilities_2014`\n  GROUP BY \n  state\nORDER BY\n  total_facilities DESC;\"\"\"\nresponse1 = medicare.query_to_pandas_safe(query1)\nresponse1.head(10)\ndata = [ dict(\n        type='choropleth',\n        colorscale = scl,\n        autocolorscale = False,\n        locations = response1.state,\n        z = response1.total_facilities,\n        locationmode = 'USA-states',\n        text = response1.state,\n        marker = dict(\n            line = dict (\n                color = 'rgb(255,255,255)',\n                width = 2\n            ) ),\n        colorbar = dict(\n            title = \"Facilities in Different States\")\n        )\n       ]\n\nlayout = dict(\n        title = 'Nursing Facilities in Different States',\n        geo = dict(\n            scope='usa',\n            projection=dict( type='albers usa' ),\n            showlakes = True,\n            lakecolor = 'rgb(255, 255, 255)'),\n             )\n    \nfig = dict( data=data, layout=layout )\niplot( fig, filename='d3-cloropleth-map' )","c3f17c6e":"query2 = \"\"\"SELECT\n  state, AVG(average_hcc_score) as avg_hcc_score, Max(average_hcc_score) as max_hcc_score, Min(average_hcc_score) as min_hcc_score, COUNT(average_hcc_score) as total_facilities\nFROM\n  `bigquery-public-data.cms_medicare.nursing_facilities_2014`\n  GROUP BY \n  state\nORDER BY\n  avg_hcc_score;\n        \"\"\"\nresponse2 = medicare.query_to_pandas_safe(query2)\nresponse2.head(100)","f36a17da":"trace1 = go.Bar(\n    x=response2.state,\n    y=response2.max_hcc_score,\n    name='Max HCC Score',\n    marker=dict(color='rgb(158,202,225)'),\n)\ntrace2 = go.Bar(\n    x=response2.state,\n    y=response2.min_hcc_score,\n    name='Min HCC Score',\n    marker=dict(color='rgb(58,22,25)'),\n)\n\ndata = [trace1, trace2]\nlayout = go.Layout(\n    barmode='group',\n    title='Minimum and Maximum HCC scores for different States',\n    legend=dict(orientation=\"h\")\n)\n\nfig = go.Figure(data=data, layout=layout)\niplot(fig, filename='grouped-bar')","6d9e9abb":"query1 = \"\"\"SELECT\n  state, Sum(male_beneficiaries) as male_ben, Sum(female_beneficiaries) as female_ben\nFROM\n  `bigquery-public-data.cms_medicare.nursing_facilities_2014`\n  GROUP BY \n      state\n  ORDER BY\n      male_ben DESC;\n        \"\"\"\nresponse1 = medicare.query_to_pandas_safe(query1)\n\n\ntrace1 = go.Bar(\n    x=response1.state,\n    y=response1.male_ben,\n    marker=dict(color='#e584f7'),\n    name='Total Male beneficiaries'\n)\ntrace2 = go.Bar(\n    x=response1.state,\n    y=response1.female_ben,\n    marker=dict(color='#a0f784'),\n    name='Total Female beneficiaries'\n)\n\ndata = [trace1, trace2]\nlayout = go.Layout(barmode='group', legend=dict(orientation='h'), title='Male and Female Beneficiaries in 2014 in different states')\nfig = go.Figure(data=data, layout=layout)\niplot(fig, filename='grouped-bar')","bd74914f":"response1['difference'] = response1['female_ben'] - response1['male_ben']\n\ntrace1 = go.Bar(\n    x=response1.state,\n    y=response1.difference,\n    marker=dict(color='#aabfe0'),\n    name='Total Male beneficiaries'\n)\ndata = [trace1]\nlayout = go.Layout(barmode='group', legend=dict(orientation='h'), title='Difference in Male and Female Beneficiaries in Different State')\nfig = go.Figure(data=data, layout=layout)\niplot(fig, filename='grouped-bar')","74e2d5a2":"query3_a = \"\"\"SELECT provider_id, avg(average_total_payments) as average_outpatient_payments\nFROM `bigquery-public-data.cms_medicare.outpatient_charges_2014` group by provider_id;\"\"\"\noutp = medicare.query_to_pandas_safe(query3_a)\n\nquery3_b = \"\"\"SELECT provider_id, avg(average_total_payments) as average_inpatient_payments\nFROM `bigquery-public-data.cms_medicare.inpatient_charges_2014` group by provider_id;\"\"\"\ninp = medicare.query_to_pandas_safe(query3_b)\n\nmerged = outp.merge(inp, on=\"provider_id\", how = 'inner')\nmerged[\"difference\"] = merged[\"average_inpatient_payments\"] - merged['average_outpatient_payments']\n\ntracex = go.Histogram(x = merged[\"difference\"]) \nfig = go.Figure(data = [tracex])\nfig['layout'].update(height=400, showlegend=False, title=\"Difference in average inpatient and outpatient payments\");\niplot(fig, filename='simple-subplot');","fd208558":"query2 = \"\"\"SELECT\n  state, AVG(average_length_of_stays_days) as average_length_of_stays_days, AVG(total_stays) as total_stays\nFROM\n  `bigquery-public-data.cms_medicare.nursing_facilities_2014`\n  GROUP BY \n  state\nORDER BY\n  average_length_of_stays_days DESC;\n        \"\"\"\nresponse2 = medicare.query_to_pandas_safe(query2)\nresponse2.head(10)\n\n\ntrace0 = go.Scatter(\n    x=response2.average_length_of_stays_days,\n    y=response2.state,\n    mode='markers',\n    name='Average Length of Stay in a State',\n    marker=dict(\n        color='rgba(156, 165, 196, 0.95)',\n        line=dict(\n            color='rgba(156, 165, 196, 1.0)',\n            width=1,\n        ),\n        symbol='circle',\n        size=16,\n    )\n)\ntrace1 = go.Scatter(\n    x=response2.total_stays,\n    y=response2.state,\n    mode='markers',\n    name='Average of Total Stays in a State ',\n    marker=dict(\n        color='#00d8d8',\n        line=dict(\n            color='rgba(217, 217, 217, 1.0)',\n            width=1,\n        ),\n        symbol='circle',\n        size=16,\n    )\n)\n\ndata = [trace0,trace1]\nlayout = go.Layout(\n    title=\"Average Total Stays of each State and Average Length of Stays for each state \",\n    xaxis=dict(\n        showgrid=False,\n        showline=True,\n        linecolor='rgb(102, 102, 102)',\n        titlefont=dict(\n            color='rgb(204, 204, 204)'\n        ),\n        tickfont=dict(\n            color='rgb(102, 102, 102)',\n        ),\n#         autotick=False,\n        dtick=10,\n        ticks='outside',\n        tickcolor='rgb(102, 102, 102)',\n    ),\n    margin=dict(\n        l=140,\n        r=40,\n        b=50,\n        t=80\n    ),\n    legend=dict(\n        font=dict(\n            size=10,\n        ),\n        yanchor='middle',\n        xanchor='right',\n    ),\n#     width=800,\n    height=600,\n    paper_bgcolor='rgb(254, 247, 234)',\n    plot_bgcolor='rgb(254, 247, 234)',\n    hovermode='closest',\n)\nfig = go.Figure(data=data, layout=layout)\niplot(fig, filename='lowest-oecd-votes-cast')","1c229cc3":"# which facilities have highest stays count \n\nquery1 = \"\"\"SELECT\n  facility_name, city, state, average_length_of_stays_days\nFROM\n  `bigquery-public-data.cms_medicare.nursing_facilities_2014`\nORDER BY\n  average_length_of_stays_days DESC;\n        \"\"\"\nresponse1 = medicare.query_to_pandas_safe(query1)\n\ntempdf = response1.head(10)\ny = list(reversed(list(tempdf.facility_name)))\nx = list(reversed(list(tempdf.average_length_of_stays_days)))\ntrace1 = go.Bar(x=x, y=y, orientation=\"h\", marker=dict(color='#f7e484'))\nlayout = dict(height=400, width=700, title='Nursing Facilities having Maximum Average Length of Stay Days', margin=dict(l=400))\ndata = [trace1]\n\nfig = go.Figure(data=data, layout=layout)\niplot(fig, filename='stacked-bar')","33b8e4b7":"query1 = \"\"\"SELECT\n  nppes_provider_state AS state,\n  ROUND(SUM(total_claim_count) \/ 1e6) AS total_claim_count_millions,\n  ROUND(SUM(total_day_supply) \/ 1e6) AS total_day_supply_millions,\n  ROUND(SUM(total_drug_cost) \/ 1e6) AS total_drug_cost_millions\nFROM\n  `bigquery-public-data.cms_medicare.part_d_prescriber_2014`\nGROUP BY\n  state\nORDER BY\n  total_claim_count_millions DESC;\n        \"\"\"\nresponse1 = medicare.query_to_pandas_safe(query1)\nresponse1.head(100)","0d06aef0":"trace1 = go.Scatter(\n    x=response1.total_day_supply_millions,\n    y=response1.total_drug_cost_millions,\n    mode='markers',\n    text=response1.state,\n    marker=dict(\n        color=list(reversed([i*11 for i in range(200,251)])),\n        size=response1.total_claim_count_millions,\n        line=dict(\n            width=2\n        ),\n    )\n)\ndata = [trace1]\n\nlayout = go.Layout(\n    title='Total claim count VS Total Drug Cost VS Total Day Supply for every state',\n    xaxis=dict(\n        title='Total Day Supply',\n        gridcolor='rgb(255, 255, 255)',\n        zerolinewidth=1,\n        ticklen=5,\n        gridwidth=2,\n    ),\n    yaxis=dict(\n        title='Total Drug Cost',\n        gridcolor='rgb(255, 255, 255)',\n        zerolinewidth=1,\n        ticklen=5,\n        gridwidth=2,\n    ),\n    paper_bgcolor='rgb(243, 243, 243)',\n    plot_bgcolor='rgb(243, 243, 243)',\n)\n\nfig = go.Figure(data=data, layout=layout)\niplot(fig, filename='scatter-colorscale')","fc94a295":"# state wise count of claims \n\n## Which providers have highest claims \n\nquery1 = \"\"\"SELECT\n  generic_name AS drug_name,\n  ROUND(SUM(total_claim_count) \/ 1e6) AS total_claim_count_millions,\n  ROUND(SUM(total_day_supply) \/ 1e6) AS total_day_supply_millions,\n  ROUND(SUM(total_drug_cost) \/ 1e6) AS total_drug_cost_millions\nFROM\n  `bigquery-public-data.cms_medicare.part_d_prescriber_2014`\n GROUP BY\n  drug_name\nORDER BY\n  total_claim_count_millions DESC;\n        \"\"\"\nresponse1 = medicare.query_to_pandas_safe(query1)\ntempdf = response1.head(50)\n\ntrace1 = go.Bar(\n    x=tempdf.drug_name,\n    y=tempdf.total_claim_count_millions,\n    name='Total Claims'\n)\ntrace2 = go.Bar(\n    x=tempdf.drug_name,\n    y=tempdf.total_day_supply_millions,\n    name='Total Day Supply'\n)\ntrace3 = go.Bar(\n    x=tempdf.drug_name,\n    y=tempdf.total_drug_cost_millions,\n    name='Total Drug Cost'\n)\n\ndata = [trace1, trace2, trace3]\nlayout = go.Layout(\n    barmode='group'\n    , margin=dict(b=200)\n)\n\nfig = go.Figure(data=data, layout=layout)\niplot(fig, filename='grouped-bar')","f22d8b24":"## 1. Which State has the highest (and lowest) number of Nursing Facilities\n\nSkilled nursing facilities (SNFs) and nursing facilities (NFs) are provided by CMS under medicare. Different States of US have differnt number of nursing facilities.  Number of nursing facilities in a state might be an indicator of how good is the quality of care in different states. Lets obtain the number if of nursing facilities using 2014 dataset\n\n![](http:\/\/www.arh.org\/Uploads\/Images\/Page\/services-skillednursing%5B1%5D.jpg)\n","8e4df395":"## 3. Is there any state where the number of Male Beneficiaries is greater than Female Beneficiaries ?","d77a6033":"## 4. Finding States \/ Facilities with poor average length of stay days \n\n### 4.1 States and their average total number stays (of different facilities) and average length of stays (in different facilities)","1a26208e":"### 3.2 Difference in Male and Female Beneficiaries","3b45dd3d":"\n### 5.2 Which Drugs have been most prescribed in US","cc5b66cc":"## 5. Lets Explore the Total Claims, Day Supply and Drug Costs \n\n### 5.1 Which State has highest claims, Day Supply, and Drug Costs","b6817be9":"### 4.2 Facilities having highest average length of stay days","2768e2fe":"![](http:\/\/www.kiplinger.com\/kipimages\/pages\/14024.jpg)\n\n# An Extensive Medicare Data Exploration - Healthcare Analysis\n\n## About Medicare \n\nIn the United States, Medicare is a single-payer, national social insurance program administered by the U.S. federal government since 1966. United States Medicare is funded by a payroll tax, premiums and surtaxes from beneficiaries, and general revenue. It provides health insurance for Americans aged 65 and older who have worked and paid into the system through the payroll tax. It also provides health insurance to younger people with some disability status as determined by the Social Security Administration, as well as people with end stage renal disease and amyotrophic lateral sclerosis.\n\nIn 2015, Medicare provided health insurance for over **55 million** (46 million people age 65 and older and 9 million younger people). On average, Medicare covers about half of the health care charges for those enrolled. The enrollees must then cover their remaining costs either with supplemental insurance, separate insurance, or out-of-pocket. Out-of-pocket costs can vary depending on the amount of health care a Medicare enrollee needs. \n\n## About CMS\n\nThe Centers for Medicare & Medicaid Services (CMS), previously known as the Health Care Financing Administration (HCFA), is a federal agency within the United States Department of Health and Human Services (HHS) that administers the Medicare program and works in partnership with state governments to administer Medicaid, the Children's Health Insurance Program (CHIP), and health insurance portability standards. In addition to these programs, CMS has other responsibilities, including the administrative simplification standards from the Health Insurance Portability and Accountability Act of 1996 (HIPAA), quality standards in long-term care facilities (more commonly referred to as nursing homes) through its survey and certification process, clinical laboratory quality standards under the Clinical Laboratory Improvement Amendments, and oversight of HealthCare.gov.\n\n## About the Data-Set\n\nThis [public dataset](https:\/\/www.kaggle.com\/cms\/cms-medicare) was created by the Centers for Medicare & Medicaid Services. The data summarizes the utilization and payments for procedures, services, and prescription drugs provided to Medicare beneficiaries by specific inpatient and outpatient hospitals, physicians, and other suppliers. The dataset includes the following data: Common inpatient and outpatient services, All physician and other supplier procedures and services, All Part D prescriptions. Providers determine what they will charge for items, services, and procedures provided to patients and these charges are the amount that providers bill for an item, service, or procedure.\n\nIn this notebook, I have explored the complete dataset using BigQuery, performed clustering on nursing facilities data to identify groups of nursing facilities having similar characteristics\n\n## Contents\n\n1. States having more nursing facilities  \n2. HCC Scores - Which State and Which facilities have poor HCC scores  \n&nbsp;&nbsp;&nbsp;&nbsp;  2.1 Max and Min HCC Scores for different States   \n&nbsp;&nbsp;&nbsp;&nbsp;  2.2 Average HCC scores for different States  \n&nbsp;&nbsp;&nbsp;&nbsp;  2.3 Facilities with High HCC scores  \n&nbsp;&nbsp;&nbsp;&nbsp;  2.4 Facilities with Low HCC Scores\n   \n3. Beneficiary Gender    \n&nbsp;&nbsp;&nbsp;&nbsp;  3.1 States having more male beneficiaries than female beneficiaries      \n&nbsp;&nbsp;&nbsp;&nbsp;  3.2 States and the difference in male and femal beneficiaries    \n&nbsp;&nbsp;&nbsp;&nbsp;  3.3 Difference in Average Inpatient and Outpatient payments   \n\n4. Which state has the largest number of stay days  \n&nbsp;&nbsp;&nbsp;&nbsp;  4.1 States and their Average Total Stays (of different facilities) and Average length of stays    \n&nbsp;&nbsp;&nbsp;&nbsp;  4.2  Facilities having highest average length of stay days  \n\n5. Total Claims, Day Supply and Drug Costs  \n&nbsp;&nbsp;&nbsp;&nbsp;  5.1 States having highest claims, supply, and cost      \n&nbsp;&nbsp;&nbsp;&nbsp;  5.2 Drugs having highest claims, supply and cost      ","15d23b9c":"\n## 2. Which State (and Nursing Facilities) have poor HCC risk adjustment scores \n\nThe Center for Medicare & Medicaid Services (CMS) uses a Hierarchical Condition Category (HCC) risk adjustment model to calculate risk scores. The HCC model ranks diagnoses into categories that represent conditions with similar cost patterns. Higher categories represent higher predicted healthcare costs, resulting in higher risk scores. CMS uses HCCs to reimburse Medicare Advantage plans based on the health of their members. It pays accurately for the predicted cost expenditures of patients by adjusting those payments based on demographic information and patient health status. The risk assessment data used is based on the diagnosis information pulled from claims and medical records which are collected by physician offices, hospital inpatient visits and in outpatient settings.\n\nCMS states that higher HCC scores means there is higher risk of chronic diseases while lower hcc indicates healthy population. It will be interesting to see what is the average hcc score for different states and facilities. \n\n\n### 2.1 Max and Min HCCs for different states\n","22097fce":"### 3.3 Difference in Average Inpatient payment and Average Outpatient payments"}}