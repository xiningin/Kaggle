{"cell_type":{"28d3e6e5":"code","e01fab10":"code","91c16a63":"code","5d8bc64a":"code","f6eef794":"code","e14a2a2b":"code","86e0da0b":"code","e02ea8f8":"code","c663786c":"code","1b6e0a75":"code","275489da":"code","940c8e2e":"code","b803cfd9":"code","bad65ed6":"code","fde02d84":"code","b7fb47b5":"code","b4fea810":"code","f83327cd":"code","ff8c2d70":"code","4bc4d7f8":"code","64c7a3d7":"code","4780e66b":"code","c678c3eb":"code","c18e985d":"code","902f3910":"code","aaa2d6c7":"code","23fc2a22":"markdown","560bb483":"markdown","75858e45":"markdown","0e98385a":"markdown","06a9037c":"markdown","f939f43e":"markdown","79f1521c":"markdown","846eb1dd":"markdown","6e042e67":"markdown","99058522":"markdown","b0e93a23":"markdown","01d6a0cb":"markdown","53a31940":"markdown","0c97924f":"markdown","ff27e4c3":"markdown","b21f4468":"markdown","07179159":"markdown","4bc0e6fd":"markdown","40d0d6f2":"markdown","479f093b":"markdown","061c3bbf":"markdown","048d0b95":"markdown","1d24805a":"markdown","5757e9f6":"markdown","1ff98242":"markdown","81430d5d":"markdown","648cbd60":"markdown","73529510":"markdown","24cabdc8":"markdown","993eb6e3":"markdown","bb2e75e6":"markdown","82938354":"markdown","9f6e796a":"markdown","73d6a295":"markdown","79023d88":"markdown","2c065aca":"markdown","d385c5d7":"markdown","dcda2fe3":"markdown","35106b8c":"markdown","dff4d688":"markdown","3598aa36":"markdown","51b5b5cf":"markdown","f6f5ad1a":"markdown"},"source":{"28d3e6e5":"import numpy as np\nimport pandas as pd\nimport os\n\nimport matplotlib.pyplot as plt\nimport datashader as ds\nimport colorcet as cc\nimport folium\n\nfrom collections import defaultdict, OrderedDict\nfrom folium.plugins import HeatMapWithTime\nfrom datetime import datetime","e01fab10":"%matplotlib inline\nplt.style.use('ggplot')\nplt.rcParams['figure.figsize'] = (15,10)","91c16a63":"# Available months\nmonths = ['apr','may', 'jun', 'jul', 'aug', 'sep']\n\n# Shared file path\nraw_fp = '..\/input\/uber-pickups-in-new-york-city\/uber-raw-data-{}14.csv'\n\n# Read and concatenate pickup data\npickups = pd.DataFrame()\nfor month in months:\n    month_df = pd.read_csv(raw_fp.format(month))\n    pickups = pd.concat([pickups, month_df])\n    \npickups.head()","5d8bc64a":"# Disaggregate 'Date\/Time' column\npickups['Date\/Time'] = pd.to_datetime(pickups['Date\/Time'])\n\npickups['Month'] = pickups['Date\/Time'].dt.month\npickups['Day'] = pickups['Date\/Time'].dt.day\npickups['Time'] = pickups['Date\/Time'].dt.time\n\npickups.head()","f6eef794":"# Day of the week\npickups['Weekday'] = pickups['Date\/Time'].dt.dayofweek\n\n# Hour\npickups['Hour'] = pickups['Date\/Time'].dt.hour\n\npickups.head()","e14a2a2b":"# Map month\nmonth_map = {\n    4: 'April',\n    5: 'May',\n    6: 'June', \n    7: 'July',\n    8: 'August',\n    9: 'September'\n}\npickups['Month'] = pickups['Month'].replace(month_map)\n\n# Map weekday\nweekday_map = {\n    0: 'Monday',\n    1: 'Tuesday',\n    2: 'Wednesday',\n    3: 'Thursday', \n    4: 'Friday', \n    5: 'Saturday',\n    6: 'Sunday'\n}\npickups['Weekday'] = pickups['Weekday'].replace(weekday_map)\n\nfinal_columns = [\n    'Base', 'Lat', 'Lon', 'Month', \n    'Day', 'Weekday', 'Hour']\npickups = pickups[final_columns]\npickups.head()","86e0da0b":"num_missing = pickups.isnull().sum().sum()\nprint('Number of missing values: {}'.format(num_missing))","e02ea8f8":"# Latitude must be between -90 and 90\nlat_check = pickups['Lat'].between(-90, 90, inclusive=True).all()\nassert lat_check, 'Invalid latitude values exist'\n\n# Longitude must be between -180 and 180\nlon_check = pickups['Lon'].between(-180, 180, inclusive=True).all()\nassert lon_check, 'Invalid longitude values exist'\n\n# Hour must be between 0 and 23\nhour_check = pickups['Hour'].between(0, 23, inclusive=True).all()\nassert hour_check, 'Invalid hour values exist'\n\n# Day must be between 1 and 31\nday_check = pickups['Day'].between(1, 31, inclusive=True).all()\nassert day_check, 'Invalid day values exist'\n\nprint('All value ranges valid.')","c663786c":"# Months must be between 4 and 9\nmonth_check = not set(pickups['Month']).difference(month_map.values())\nassert month_check, 'Invalid Month values'\n\nweekday_check = not set(pickups['Weekday']).difference(weekday_map.values())\nassert weekday_check, 'Invalid Weekday values'\n\nprint('Value categories valid.')","1b6e0a75":"duplicate_pickups = pickups[pickups.duplicated(keep=False)]\nduplicate_pickups","275489da":"num_pickups = pickups.shape[0]\nnum_days = len(pickups[['Month', 'Day']].drop_duplicates())\ndaily_avg = np.round(num_pickups\/num_days, 0)\n\nstats_raw = 'Number of Pickups: {}\\nNumber of Days: {}\\nAvg Daily Pickups: {}'\nprint(stats_raw.format(num_pickups, num_days, daily_avg))","940c8e2e":"monthly_pickups = pickups['Month'].value_counts(ascending=True)[month_map.values()]\n\nmonthly_pickups.plot(kind='bar', rot=0)\nplt.title('Uber Pickups Per Month')\nplt.xlabel('Month')\nplt.ylabel('# Pickups (Millions)');","b803cfd9":"weekday_pickups = pickups['Weekday'].value_counts()[weekday_map.values()]\n\nweekday_pickups.plot(kind='bar', rot=0)\nplt.title('Uber Pickups Per Weekday')\nplt.xlabel('Weekday')\nplt.ylabel('# Pickups');","bad65ed6":"monthly_weekdays = pickups.groupby('Month')['Weekday'].value_counts().unstack()\nmonthly_weekdays_norm = monthly_weekdays.apply(lambda x: x\/x.sum(), axis=1)\n\nmonthly_weekdays_norm.loc[month_map.values(),weekday_map.values()].plot(kind='bar', rot=0)\nplt.ylabel('Proportion of Pickups')\nplt.title('Uber Pickups by Month and Weekday');","fde02d84":"daily_pickups = pickups.groupby(['Month', 'Day'])['Hour'].count()[month_map.values()]\ndaily_pickups.plot(kind='line', rot=0)\nmonth_starts = np.where(daily_pickups.reset_index(level=0, drop=True).index.get_loc(1))[0]\nplt.xticks(ticks=month_starts, labels=month_map.values())\nplt.ylabel('# Pickups')\nplt.title('Daily Pickups');","b7fb47b5":"holidays = {\n    \"Easter\": ('April', 20), # Sunday\n    \"Mother's Day\": ('May', 11), # Sunday\n    \"Memorial Day\": ('May', 26), # Monday\n    \"Father's Day\": ('June', 15), # Sunday\n    \"Independence Day\": ('July', 4), # Friday\n    \"Labor Day\": ('September', 1) # Monday\n}\n\nholiday_starts = [daily_pickups.index.get_loc(hol) for hol in holidays.values()]\ncolors = ['grey' if x not in holiday_starts else 'red' for x in range(len(daily_pickups))]\n\ndaily_pickups.plot(kind='bar', color=colors, rot=0)\nplt.xticks(ticks=holiday_starts, labels=holidays.keys())\nplt.xlabel('Holiday')\nplt.ylabel('# Pickups')\nplt.title('Holiday Daily Pickups');","b4fea810":"hourly_pickups = pickups['Hour'].value_counts().sort_index()\n\nhourly_pickups.plot(kind='bar', rot=0)\nplt.xlabel('Hour')\nplt.ylabel('# Pickups')\nplt.title('Pickups by Hour of Day');","f83327cd":"def plot_subplots(pickups, var_name, var_values, figsize, dim):\n    \"\"\"\n    Helper function\n    \n    Plots subplots for a given variable (Month, Weekday) by Hour\n    \n    :param pickups: DataFrame containing Uber pickups\n    :param var_name: Name of the variable in 'pickups'\n    :param var_values: List of variable values\n    :param figsize: Tuple contianing figure size\n    :param dim: List containing the dimension of subplots\n    \"\"\"\n    \n    # Figure layout\n    fig = plt.figure(figsize=figsize)\n    fig.subplots_adjust(hspace=0.4, wspace=0.2)\n    \n    # Generate plot\n    plot_num = 1\n    for value in var_values:\n        ax = fig.add_subplot(dim[0], dim[1], plot_num)\n        value_df = pickups[pickups[var_name] == value]\n        plot = (\n            value_df['Hour']\n            .value_counts(normalize=True)\n            .sort_index()\n            .plot(kind='bar', ax=ax, rot=0)\n        )\n        plt.title(value)\n        plt.xlabel('Hour')\n        plt.ylabel('Proportion of pickups')\n        plot_num +=1","ff8c2d70":"plot_subplots(pickups, 'Month', month_map.values(), (16, 7), [2, 3])","4bc4d7f8":"plot_subplots(pickups, 'Weekday', weekday_map.values(), (16, 10), [3, 3])","64c7a3d7":"base_props = pickups['Base'].value_counts(normalize=True)\ndisplay(base_props)\n\nbase_props.plot(kind='bar', rot=0)\nplt.xlabel('Base')\nplt.ylabel('Proportion of Pickups')\nplt.title('Pickups by Base');","4780e66b":"monthly_bases = pickups.groupby('Month')['Base'].value_counts().unstack()\n\nmonthly_bases.loc[month_map.values()].plot(kind='line', marker='o', rot=0)\nplt.ylabel('# Pickups')\nplt.title('Uber Pickups by Month and Base');","c678c3eb":"pickups_focused = pickups[\n    pickups['Lon'].between(-74.25, -73.75) & \n    pickups['Lat'].between(40.5, 41)\n]\nprint('Number of Pickups: {}'.format(len(pickups_focused)))\n\npickup_points = ds.Canvas().points(pickups_focused, 'Lon', 'Lat', )\nds.tf.set_background(ds.tf.shade(pickup_points, cmap=cc.fire), \"black\")","c18e985d":"daily_pickup = pickups.groupby(['Month', 'Day'])['Hour'].count()\nprint('Busiest Day: {}'.format(daily_pickups.idxmax()))\nprint('Number of pickups: {}'.format(daily_pickups.max()))","902f3910":"# Filtering to pickups on September 13\nbusiest_day = pickups[\n    (pickups['Month'] == 'September') & (pickups['Day'] == 13)]\n\n# Extracting all pickups for a given hour\nhourly = defaultdict(list)\nfor pickup in busiest_day.itertuples():\n    pickup_time = datetime.strptime(\n        '2014-9-13  {}'.format(pickup.Hour), '%Y-%m-%d %H')\n    hourly[str(pickup_time)].append([pickup.Lat, pickup.Lon])   \nhourly = OrderedDict(sorted(hourly.items(), key=lambda t: t[0]))","aaa2d6c7":"mean_location = [pickups['Lat'].mean(),pickups['Lon'].mean()]\npickup_map = folium.Map(mean_location, zoom_start=12, tiles=\"Stamen Terrain\")\n\nhourly_pickups = HeatMapWithTime(\n    data=list(hourly.values()),\n    index=list(hourly.keys()), \n    radius=10,\n    auto_play=True,\n    max_opacity=0.4\n)\nhourly_pickups.add_to(pickup_map)\npickup_map","23fc2a22":"**Note**: To restart the animation, drag the slider to the left and resume.\n\nThe concentration of Uber pickups is consistent with the previous plot. Additionally, the visualization is consistent with our previous findings; very early Saturdays see high levels of pickups (possibly due to Friday night), pickups then die down and pick up steadily into Saturday night.","560bb483":"## Data Quality Check\n\nBefore we jump into analyzing Uber pickups, let's determine whether there are any issues with the data set.","75858e45":"When broken down by month, the pickups generated by each base tells a different story. For example, based on the previous plot, Base B02764  makes up a small proportion of pickups (~6%) which may lead one to believe that this base is not very active. However, we can clearly see that its pickup trend over the 6 months is exponential-like (in yellow). If this trend continued, we would expect this base to surpass the others, as was seen with Base B02617 (in purple) in June. It would be interesting to see how these bases compared over the following 6 months.","0e98385a":"We do see a decline in the number of Uber pickups during holidays. Both of the \"valleys\" identified in the previous plot actually occurred during Memorial Day and Independence Day. \n\nNow, a simple conclusion from this would be that individuals don't use Uber as frequently during holidays. However, something else to consider is the availability of Uber drivers during holidays. Given that Uber drivers set their own work schedules, some may choose to not work during holidays. For such a case, a decline in Uber pickups during holidays may not be due to lack of demand but instead due to a lack of available Uber drivers. Additionally, many businesses are closed during holidays so individuals may just have no place to go!\n\nLet's now move on to analyzing Uber pickups by different hours of the day.","06a9037c":"It would also be useful to know the day of the week in which each pickup occurred. Additionally, the `Time` column is quite granular, let's also create an `Hour` column.","f939f43e":"As can be expected, there are about 4 peaks per month which correspond to the roughly 4-week cycles that happen every month. Some unexpected spikes do occur, most notably April 30th, and there is a big increase in daily pickups throughout September. We also see some \"valleys\" (a decline in pickups) May 24-26 and July 4-6. The second decline, July 4-6 is quite interesting as this corresponds to Independence Day weekend. One may expect elevated levels of Uber pickups to happened during such holidays, but this was not the case.\n\nThis Independence Day weekend observation may lead one to wonder how holidays affect Uber pickups. Therefore, let's focus on the following holidays:\n- `Easter` (April 20, 2014)\n- `Mother's Day` (May 11, 2014)\n- `Memorial Day` (May 26, 2014)\n- `Father's Day` (June 15, 2014)\n- `Independence Day` (July 4, 2014)\n- `Labor Day` (September 1, 2014)","79f1521c":"We have now explored and interpreted various aspects of the pickup data. However, we are yet to explore the actual locations of these pickups. Given that we have the latitude and longitude of each pickup, we can do a spatial analysis of the Uber pickups.\n\nLet's take a quick look at where all 4.5 million pickups occurred throughout New York City.\n\n**Note**: In order to determine the locations where pickups were concentrated, pickups that happened in sparse areas were removed (33,455 pickup locations removed).","846eb1dd":"**Monthly Uber Pickups**","6e042e67":"**Value Ranges & Categories**","99058522":"The busiest day occured on Saturday Septermber 13 with 43,205 pickups -- let's visualize this day.","b0e93a23":"## The Data\n\nFor this analysis, we will be focusing on Uber pickups throughout New York City for the months of April through September 2014. The data is available across 6 CSV files, each file containing data for 1 month. The following variables are available for each pickup:\n\n- `Date\/Time`: The Date and Time of the Uber pickup\n- `Lat`: The latitude of the pickup location\n- `Lon`: The longitude of the pickup location\n- `Base`: The TLC base company code affiliated with the Uber pickup","01d6a0cb":"**Uber Pickup Bases**","53a31940":"Notice that a lot of information can be extracted from the `Date\/Time` column -- we can produce separate `Month`, `Day`, and `Time` variables. \n\n**Note**: Although we can also produce a `Year` column, it does not provide us with any additional information as all pickups occurred in 2014.","0c97924f":"According to the data, there were over **4.5 million** Uber pickups in New York City over the course of April through September 2014. This corresponds to **24,778** pickups every single day on average.","ff27e4c3":"## Data Wrangling","b21f4468":"It would also be neat to produce a time lapse of Uber pickups in New York City over the 6 month period. However, for the sake of time, let's take a look at where pickups occurred for every hour of the day for the busiest day in the data set.","07179159":"Duplicate pickups do exist in the data set. Additional checks were made to check if duplicates occurred only for certain bases, dates, times, or locations but there does not seem to be any consistent trend. \n\nGiven that we do not know the accuracy of a pickup's Latitude\/Longitude or Time, these pickups may just have happened around the same time and around the same location. Therefore, for the sake of this analysis, we will assume that duplicate pickups are valid. ","4bc0e6fd":"## Exploratory Data Analysis","40d0d6f2":"Pickups happened most during... Thursdays? Interesting... After Thursdays, Fridays closely follow. Even more interesting is the fact that more pickups occurred during Tuesdays and Wednesdays than on Saturdays or Sundays. Uber being used as a means to get to work during the week could be a possible explanation but, unfortunately, the purpose of these pickups is not available in the data.\n\nHowever, this weekday trend may be different within months.","479f093b":"Let's also set some global plot settings.","061c3bbf":"We can clearly see an imbalance in pickups between the different bases as nearly 90% of all pickups come from 3 of the 5 bases. Let's determine whether this imbalance holds for different months.","048d0b95":"Plotting the pickup locations produces a beautiful outline of different areas in New York City. Right in the center of the plot, we see Manhattan Island where many popular sites reside like Times Square, Broadway, Central Park, etc. Over on the lower right side of the plot, we see a bright spot where JFK airport is located. The fact that pickups are concentrated in these areas is not surprising but is nonetheless very interesting to see.","1d24805a":"**Duplicate Pickups**","5757e9f6":"Overall, the data looks to be in good shape -- let's proceed with the analysis.","1ff98242":"There does appear to be some variability for the hours following 5-6 p.m., as can be seen between the months of June and September. But, overall, it appears that the hourly distributions are relatively consistent across the 6 months. ","81430d5d":"**Hourly Uber Pickups**","648cbd60":"**Missing Values**","73529510":"Exploring hourly distributions by weekday reveals some interesting insight. The Monday-Thursday distributions are very identical but there is a change for the weekdays that follow. Although Friday has an identical distribution earlier in the day, it sees a greater proportion of pickups occurring during later hours (10-11 p.m.). This makes sense, it is Friday night -- many people do not need to make mandatory trips (may not be limited to just work) the next day. \n\nNow, hourly distributions look very different for Saturday and Sunday. If we look at Saturday, we notice a greater proportion of pickups happening at very early hours of the day (12-2 a.m.), which is surely a result of those late pickups Friday night. Also, Saturday (and Sunday) no longer shows that 7-8 a.m. peak which is expected as people are less likely to get up early in the morning for mandatory purposes. Later that Saturday night, the greatest proportions of late-night Uber pickups occurs and subsequently Sunday sees the greatest proportions of early morning pickups. Sunday then follows a normal-like distribution and those late-night pickups drop significantly as individuals prepare for the new week.","24cabdc8":"**Daily Uber Pickups**","993eb6e3":"## Takeaways","bb2e75e6":"Now that we have all the needed variables, let's map some of these variable's values to make the data more understandable.","82938354":"Let's now read in each file and join them into a single data frame `pickups`.","9f6e796a":"The hourly distribution of pickups during the 6-month period reveals a multimodal distribution. We see two peaks, one during the morning (7-8 a.m.) and another later in the day (4-6 p.m.). A small peak occurs for very early hours, but this appears to be a downtrend from the previous day as hours are cyclical. Intuitively, these two peaks make sense as they correspond to the times in which individuals go to and return from mandatory destinations such as work.\n\nThis may lead one to wonder if the hourly distribution of pickups varies across the 6 months or during different weekdays -- let's explore this.","73d6a295":"This analysis has provided much insight into the New York City Uber pickups in 2014. Some of the key findings include:\n\n- **Heavy increase in pickups during the month of September**\n- **Reductions in pickups during holidays**\n- **Clear difference in the distribution of hourly pickups between workdays and weekends**\n- **Misbalance in pickups between TLC bases**\n- **Concentration of pickups in Manhattan Island and surrounding areas**","79023d88":"**Visualizing September 13, 2014**","2c065aca":"Let's now pay attention to the Bases affiliated with the pickups.","d385c5d7":"**Imports**\n\nBefore we get started, let's import all the required packages\/libraries that we will need for this analysis.","dcda2fe3":"## An Analysis of Uber Pickups in New York City\n**By Enrique Sanchez**","35106b8c":"**Uber Pickups by Month and Weekday**","dff4d688":"**Weekday Uber Pickups**","3598aa36":"Based on the plot above, some months (May, July, and August) see pickups consecutively increase Monday-Thursday\/Friday and drop for later days of the week -- this is consistent with the overall trend we saw in the previous plot. Other months, like June and September, see much more variability across weekdays. Overall, weekday distributions do vary across months.\n\nWe have now analyzed the pickups by month and weekday. Let's take a look at the daily pickups.","51b5b5cf":"**Pickup Locations Visualization**","f6f5ad1a":"According to the plot above, there was an increase in the number of Uber pickups from April to September 2014. Intuition may lead one to believe that Uber pickups would be greatest during Summer months, but this appears to not necessarily be the case.\n\nLet's now break it down by weekday."}}