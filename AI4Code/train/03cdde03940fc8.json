{"cell_type":{"6a0f5c5e":"code","5fc5b095":"code","62a9c888":"code","ca551740":"code","64fb9a6b":"code","a887150f":"code","3850e751":"code","6ee789b5":"code","dfef6e7d":"code","c281144e":"code","6c8e521b":"code","a0dfdb4a":"code","9293860c":"code","df41b4a2":"code","7b789f6c":"code","88e7cdb6":"code","47aa7122":"code","e95ec422":"code","c7fb4453":"code","003f7b2f":"markdown","33e46d8a":"markdown","83689556":"markdown","feee6937":"markdown","4f25677d":"markdown","ce67faea":"markdown"},"source":{"6a0f5c5e":"#import libraries\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n%matplotlib inline","5fc5b095":"#read file\nheart_fail = pd.read_csv(\"..\/input\/heart-failure-clinical-data\/heart_failure_clinical_records_dataset.csv\")\nheart_fail.head()","62a9c888":"#check out the data set\nheart_fail.info()","ca551740":"heart_fail.columns","64fb9a6b":"print(\"Proportion of death occurence: \",np.round(heart_fail[heart_fail[\"DEATH_EVENT\"]==1].shape[0]\/heart_fail.shape[0],decimals=2)*100,\"%\")","a887150f":"X = heart_fail[['age', 'anaemia', 'creatinine_phosphokinase', 'diabetes',\n       'ejection_fraction', 'high_blood_pressure', 'platelets',\n       'serum_creatinine', 'serum_sodium', 'sex',\"time\", 'smoking']]\n\ny = heart_fail[[\"DEATH_EVENT\"]]","3850e751":"from sklearn import preprocessing\n\nX = preprocessing.StandardScaler().fit(X).transform(X)\nX[:3]","6ee789b5":"from sklearn.model_selection import train_test_split\n\nX_train,X_test,y_train,y_test = train_test_split(X,y,test_size=0.2,random_state=4)","dfef6e7d":"from sklearn.neighbors import KNeighborsClassifier\n\nk = 4\nneigh = KNeighborsClassifier(n_neighbors=k).fit(X_train,np.ravel(y_train))\nyhat = neigh.predict(X_test)","c281144e":"from sklearn import metrics\nprint(\"Train set's accuracy: \", metrics.accuracy_score(y_train,neigh.predict(X_train)))\nprint(\"Test set's accuracy: \", metrics.accuracy_score(y_test,yhat))","6c8e521b":"# What about K=6?\n\nk6 = 6\nneigh6 = KNeighborsClassifier(n_neighbors=k6).fit(X_train,np.ravel(y_train))\ny_hat6 = neigh6.predict(X_test)\n\nprint(\"Train set's accuracy: \", metrics.accuracy_score(y_train,neigh.predict(X_train)))\nprint(\"Test set's accuracy: \", metrics.accuracy_score(y_test,y_hat6))","a0dfdb4a":"test_scores = []\ntrain_scores = []\n\nfor i in range(1,15):\n\n    knn = KNeighborsClassifier(i)\n    knn.fit(X_train,np.ravel(y_train))\n    \n    train_scores.append(knn.score(X_train,np.ravel(y_train)))\n    test_scores.append(knn.score(X_test,y_test))\n    \nmax_train_score = max(train_scores)\ntrain_scores_ind = [i for i, v in enumerate(train_scores) if v == max_train_score]\nprint('Max train score {} % and k = {}'.format(max_train_score*100,list(map(lambda x: x+1, train_scores_ind))))","9293860c":"max_test_score = max(test_scores)\ntest_scores_ind = [i for i, v in enumerate(test_scores) if v == max_test_score]\nprint('Max test score {} % and k = {}'.format(max_test_score*100,list(map(lambda x: x+1, test_scores_ind))))","df41b4a2":"k2 = 2\nneigh2 = KNeighborsClassifier(n_neighbors=k2).fit(X_train,np.ravel(y_train))\ny_hat2 = neigh2.predict(X_test)\n\nprint(\"Train set's accuracy: \", metrics.accuracy_score(y_train,neigh.predict(X_train)))\nprint(\"Test set's accuracy: \", metrics.accuracy_score(y_test,y_hat2))","7b789f6c":"import seaborn as sns\nplt.figure(figsize=(12,8))\np = sns.lineplot(range(1,15),train_scores,marker='*',label='Train Score')\np = sns.lineplot(range(1,15),test_scores,marker='o',label='Test Score')","88e7cdb6":"from sklearn.metrics import confusion_matrix\ncon_mat = confusion_matrix(y_test, y_hat2)\ncon_mat","47aa7122":"import math\ntotal_accuracy = (con_mat[0, 0] + con_mat[1, 1]) \/ float(np.sum(con_mat))\nclass1_accuracy = (con_mat[0, 0] \/ float(np.sum(con_mat[0, :])))\nclass2_accuracy = (con_mat[1, 1] \/ float(np.sum(con_mat[1, :])))\nprint(con_mat)\nprint('Total accuracy: %.5f' % total_accuracy)\nprint('Class1 accuracy: %.5f' % class1_accuracy)\nprint('Class2 accuracy: %.5f' % class2_accuracy)\nprint('Geometric mean accuracy: %.5f' % math.sqrt((class1_accuracy * class2_accuracy)))","e95ec422":"from sklearn.metrics import classification_report\nprint(classification_report(y_test, y_hat2))","c7fb4453":"import seaborn as sns \n\nfig = plt.figure(figsize=(10,8))\nax= plt.subplot()\nsns.heatmap(con_mat, annot=True, ax = ax)\n\n# labels, title and ticks\nax.set_xlabel('Predicted labels');ax.set_ylabel('True labels')\nax.set_title('Confusion Matrix')\nax.xaxis.set_ticklabels(['not-dead', 'dead']); ax.yaxis.set_ticklabels(['not-dead', 'dead'])\nplt.show()","003f7b2f":"### K-Nearest Neighbors","33e46d8a":"So in our data set, **there are not balanced entries regarding to death occurrences under DEATH_EVENT column******, which is our target variable. This may prevent us from reaching a robust model predicting death rates.","83689556":"### Normalization","feee6937":"### Finding the Right K","4f25677d":"### Feature Set","ce67faea":"### Accuracy"}}