{"cell_type":{"7ef00650":"code","50a97823":"code","11d70e46":"code","da10756b":"code","677cdedc":"code","e8d415a8":"code","44d59c94":"code","be43258a":"code","936ddec7":"code","d877fbe2":"code","ba2d3a3f":"code","24e226e2":"code","34fa8547":"code","7ce42779":"code","998baa55":"code","d2b8a399":"code","3349e5fe":"code","676b44e7":"code","2c6e0bba":"code","847b6b3e":"code","acc43714":"code","9a81e0df":"code","8b03caaf":"code","bbfcf17c":"code","13d87271":"code","99dad522":"code","1f3eff66":"code","e2369ed8":"markdown","281c4925":"markdown","ef3a0ec7":"markdown","c09ac57e":"markdown","473ac9e9":"markdown","fb05e14c":"markdown","832564eb":"markdown","92d7880f":"markdown","02a76bde":"markdown","cc68357d":"markdown","f9d9fde9":"markdown","9073fe0c":"markdown","25e355b5":"markdown","4acf7f7a":"markdown","bddf43fa":"markdown","a5028691":"markdown","dc49ed31":"markdown","24dba326":"markdown","f3d1ea12":"markdown","799e30f2":"markdown","7ec0459c":"markdown","864e0334":"markdown","a395077e":"markdown","b9a0bad2":"markdown","6f03387a":"markdown","c2d02397":"markdown","10e73e97":"markdown","68b4b4ee":"markdown","4a66e12e":"markdown","c0017bb3":"markdown"},"source":{"7ef00650":"import warnings\nimport numpy as np\nimport pandas as pd\nimport lightgbm\nimport datetime\nfrom sklearn import datasets\nfrom sklearn import model_selection\nfrom sklearn.metrics import mean_squared_error, roc_auc_score\nfrom sklearn.preprocessing import LabelEncoder\nfrom scipy.stats import boxcox\nfrom tqdm.notebook import tqdm\n\nwarnings.filterwarnings('ignore')\npd.set_option('display.max_colwidth', 0)\nn_fold = 5\nresult = pd.DataFrame(columns=['Model', 'RMSE'])\n\ndef create_stratified_folds_for_regression(data_df, n_splits=5):\n    \"\"\"\n    @param data_df: training data to split in Stratified K Folds for a continous target value\n    @param n_splits: number of splits\n    @return: the training data with a column with kfold id\n    \"\"\"\n    data_df['kfold'] = -1\n    # randomize the data\n    data_df = data_df.sample(frac=1, random_state=42).reset_index(drop=True)\n    # calculate the optimal number of bins based on log2(data_df.shape[0])\n    num_bins = np.int(np.floor(1 + np.log2(len(data_df))))\n    # bins value will be the equivalent of class value of target feature used by StratifiedKFold to \n    # distribute evenly the classed over each fold\n    data_df.loc[:, \"bins\"] = pd.cut(pd.to_numeric(data_df['target'], downcast=\"signed\"), bins=num_bins, labels=False)\n    kf = model_selection.StratifiedKFold(n_splits=n_splits, random_state=42)\n    \n    # set the fold id as a new column in the train data\n    for f, (t_, v_) in enumerate(kf.split(X=data_df, y=data_df.bins.values)):\n        data_df.loc[v_, 'kfold'] = f\n    \n    # drop the bins column (no longer needed)\n    data_df = data_df.drop(\"bins\", axis=1)\n    \n    return data_df\n\ndef cv_evaluation_regression(df, n_fold):\n    oof = np.zeros((300000,))\n    for fold in tqdm(range(n_fold)):\n        val_ind = df[df.kfold == fold].index\n        train = df[df.kfold != fold].reset_index(drop=True)\n        valid = df[df.kfold == fold].reset_index(drop=True)\n\n        features = [feature for feature in df.columns if feature not in ['id', 'target', 'kfold']]\n\n        X_train = train[features]\n        y_train = train['target']\n        X_valid = valid[features]\n        y_valid = valid['target']\n\n        model = lightgbm.LGBMRegressor(random_state=42, objective='regression', metric='rmse')\n        model.fit(X_train, y_train, eval_set=[(X_valid, y_valid)], verbose=False)\n        preds = model.predict(valid[features])\n        mse = mean_squared_error(y_valid, preds)\n        \n        oof[val_ind] = preds\n\n        print(f'LGBM fold: {fold}: RMSE:{np.sqrt(mse)}')\n    \n    mse_oof = mean_squared_error(oof, train_df['target'])\n    \n    print(f'LGBM Overall RMSE:{np.sqrt(mse_oof)}')\n    return np.sqrt(mse_oof)","50a97823":"train_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \nnew_row = {'Model':'4. Base Regression Model', 'RMSE': cv_evaluation_regression(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","11d70e46":"train_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \ntrain_df[cont_features] = np.log(train_df[cont_features])\n\nnew_row = {'Model':'5.1. Log Continuous Features and Label Encoding', 'RMSE': cv_evaluation_regression(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","da10756b":"train_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \ntrain_df[cont_features] = np.log(train_df[cont_features])\ntrain_df[cat_features] = np.log(train_df[cat_features])\n\nnew_row = {'Model':'5.2. Log Continuous Features and Log Label Encoding', 'RMSE': cv_evaluation_regression(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","677cdedc":"train_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \ntrain_df['cont_min'] = train_df[cont_features].min(axis=1)\n\nnew_row = {'Model':'5.3. Continuous Features, Label Encoding and Min on Continuous Features', 'RMSE': cv_evaluation_regression(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","e8d415a8":"train_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \ntrain_df['cont_min'] = train_df[cont_features].min(axis=1)\ntrain_df['cont_min'] = np.log(train_df['cont_min'])\n\nnew_row = {'Model':'5.4. Continuous Features, Label Encoding and Log Min on Continuous Features', 'RMSE': cv_evaluation_regression(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","44d59c94":"train_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \ntrain_df['cont_max'] = train_df[cont_features].max(axis=1)\n\nnew_row = {'Model':'5.5. Continuous Features, Label Encoding and Max on Continuous Features', 'RMSE': cv_evaluation_regression(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","be43258a":"train_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \ntrain_df['cont_max'] = train_df[cont_features].max(axis=1)\ntrain_df['cont_max'] = np.log(train_df['cont_max'])\n\nnew_row = {'Model':'5.6. Continuous Features, Label Encoding and Log Max on Continuous Features', 'RMSE': cv_evaluation_regression(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","936ddec7":"train_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \ntrain_df['cont_sum'] = train_df[cont_features].sum(axis=1)\n\nnew_row = {'Model':'5.7. Continuous Features, Label Encoding and Sum on Continuous Features', 'RMSE': cv_evaluation_regression(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","d877fbe2":"train_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \ntrain_df['cont_sum'] = train_df[cont_features].sum(axis=1)\ntrain_df['cont_sum'] = np.log(train_df['cont_sum'])\n\nnew_row = {'Model':'5.8. Continuous Features, Label Encoding and Log Sum on Continuous Features', 'RMSE': cv_evaluation_regression(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","ba2d3a3f":"train_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \ntrain_df['cont_multiply'] = 1\nfor col in cont_features:\n    train_df['cont_multiply'] = train_df[col] * train_df['cont_multiply']\n    \nnew_row = {'Model':'5.9. Continuous Features, Label Encoding and Multiplication on Continuous Features', 'RMSE': cv_evaluation_regression(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","24e226e2":"train_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \ntrain_df['cont_multiply'] = 1\nfor col in cont_features:\n    train_df['cont_multiply'] = train_df[col] * train_df['cont_multiply']\ntrain_df['cont_multiply'] = np.log(train_df['cont_multiply'])\n\nnew_row = {'Model':'5.10. Continuous Features, Label Encoding and Log Multiplication on Continuous Features', 'RMSE': cv_evaluation_regression(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","34fa8547":"train_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \ntrain_df['cont_sum'] = train_df[cont_features].sum(axis=1)\nfor col in cont_features:\n    train_df[col+'new'] = train_df[col] \/ train_df['cont_sum']\ntrain_df = train_df.drop('cont_sum', axis=1)\n\nnew_row = {'Model':'5.11. Continuous Features, Label Encoding and Prorate on Continuous Features', 'RMSE': cv_evaluation_regression(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","7ce42779":"train_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \ntrain_df['cont_sum'] = train_df[cont_features].sum(axis=1)\nfor col in cont_features:\n    train_df[col+'new'] = np.log(train_df[col] \/ train_df['cont_sum'])\ntrain_df = train_df.drop('cont_sum', axis=1)\n\nnew_row = {'Model':'5.12. Continuous Features, Label Encoding and Log Prorate on Continuous Features', 'RMSE': cv_evaluation_regression(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","998baa55":"train_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \ntrain_df[cont_features] = np.exp(train_df[cont_features])\n\nnew_row = {'Model':'5.13. Exponential Continuous and Label Encoding', 'RMSE': cv_evaluation_regression(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","d2b8a399":"train_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \nfor col in cont_features:\n    train_df[col] = boxcox(train_df[col]+1, 0)\n    \nnew_row = {'Model':'5.14. Boxcox Continuous and Label Encoding', 'RMSE': cv_evaluation_regression(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","3349e5fe":"def cv_evaluation_regression_mod(df, n_fold):\n    oof = np.zeros((300000,))\n    for fold in tqdm(range(n_fold)):\n        val_ind = df[df.kfold == fold].index\n        train = df[df.kfold != fold].reset_index(drop=True)\n        valid = df[df.kfold == fold].reset_index(drop=True)\n\n        features = [feature for feature in df.columns if feature not in ['id', 'target', 'kfold']]\n        \n        for col in cat_features:\n            encode = train.groupby(col)['target'].mean()\n            train[col] = train[col].map(encode)\n            valid[col] = valid[col].map(encode)\n\n        X_train = train[features]\n        y_train = train['target']\n        X_valid = valid[features]\n        y_valid = valid['target']\n\n        model = lightgbm.LGBMRegressor(random_state=42, objective='regression', metric='rmse')\n        model.fit(X_train, y_train, eval_set=[(X_valid, y_valid)], verbose=False)\n        preds = model.predict(valid[features])\n        mse = mean_squared_error(y_valid, preds)\n        \n        oof[val_ind] = preds\n\n        print(f'LGBM fold: {fold}: RMSE:{np.sqrt(mse)}')\n    \n    mse_oof = mean_squared_error(oof, train_df['target'])\n    \n    print(f'LGBM Overall RMSE:{np.sqrt(mse_oof)}')\n    return np.sqrt(mse_oof)\n\ntrain_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \nnew_row = {'Model':'6.1. Continuous Features and Mean Encoding', 'RMSE': cv_evaluation_regression_mod(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","676b44e7":"def cv_evaluation_regression_mod(df, n_fold):\n    oof = np.zeros((300000,))\n    for fold in tqdm(range(n_fold)):\n        val_ind = df[df.kfold == fold].index\n        train = df[df.kfold != fold].reset_index(drop=True)\n        valid = df[df.kfold == fold].reset_index(drop=True)\n\n        features = [feature for feature in df.columns if feature not in ['id', 'target', 'kfold']]\n        \n        for col in cat_features:\n            encode = train.groupby(col)['target'].min()\n            train[col] = train[col].map(encode)\n            valid[col] = valid[col].map(encode)\n\n        X_train = train[features]\n        y_train = train['target']\n        X_valid = valid[features]\n        y_valid = valid['target']\n\n        model = lightgbm.LGBMRegressor(random_state=42, objective='regression', metric='rmse')\n        model.fit(X_train, y_train, eval_set=[(X_valid, y_valid)], verbose=False)\n        preds = model.predict(valid[features])\n        mse = mean_squared_error(y_valid, preds)\n        \n        oof[val_ind] = preds\n\n        print(f'LGBM fold: {fold}: RMSE:{np.sqrt(mse)}')\n    \n    mse_oof = mean_squared_error(oof, train_df['target'])\n    \n    print(f'LGBM Overall RMSE:{np.sqrt(mse_oof)}')\n    return np.sqrt(mse_oof)\n\ntrain_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \nnew_row = {'Model':'6.2. Continuous Features and Min Encoding', 'RMSE': cv_evaluation_regression_mod(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","2c6e0bba":"def cv_evaluation_regression_mod(df, n_fold):\n    oof = np.zeros((300000,))\n    for fold in tqdm(range(n_fold)):\n        val_ind = df[df.kfold == fold].index\n        train = df[df.kfold != fold].reset_index(drop=True)\n        valid = df[df.kfold == fold].reset_index(drop=True)\n\n        features = [feature for feature in df.columns if feature not in ['id', 'target', 'kfold']]\n        \n        for col in cat_features:\n            encode = train.groupby(col)['target'].max()\n            train[col] = train[col].map(encode)\n            valid[col] = valid[col].map(encode)\n\n        X_train = train[features]\n        y_train = train['target']\n        X_valid = valid[features]\n        y_valid = valid['target']\n\n        model = lightgbm.LGBMRegressor(random_state=42, objective='regression', metric='rmse')\n        model.fit(X_train, y_train, eval_set=[(X_valid, y_valid)], verbose=False)\n        preds = model.predict(valid[features])\n        mse = mean_squared_error(y_valid, preds)\n        \n        oof[val_ind] = preds\n\n        print(f'LGBM fold: {fold}: RMSE:{np.sqrt(mse)}')\n    \n    mse_oof = mean_squared_error(oof, train_df['target'])\n    \n    print(f'LGBM Overall RMSE:{np.sqrt(mse_oof)}')\n    return np.sqrt(mse_oof)\n\ntrain_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \nnew_row = {'Model':'6.3. Continuous Features and Max Encoding', 'RMSE': cv_evaluation_regression_mod(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","847b6b3e":"def cv_evaluation_regression_mod(df, n_fold):\n    oof = np.zeros((300000,))\n    for fold in tqdm(range(n_fold)):\n        val_ind = df[df.kfold == fold].index\n        train = df[df.kfold != fold].reset_index(drop=True)\n        valid = df[df.kfold == fold].reset_index(drop=True)\n\n        features = [feature for feature in df.columns if feature not in ['id', 'target', 'kfold']]\n        \n        for col in cat_features:\n            encode = train.groupby(col)['target'].median()\n            train[col] = train[col].map(encode)\n            valid[col] = valid[col].map(encode)\n\n        X_train = train[features]\n        y_train = train['target']\n        X_valid = valid[features]\n        y_valid = valid['target']\n\n        model = lightgbm.LGBMRegressor(random_state=42, objective='regression', metric='rmse')\n        model.fit(X_train, y_train, eval_set=[(X_valid, y_valid)], verbose=False)\n        preds = model.predict(valid[features])\n        mse = mean_squared_error(y_valid, preds)\n        \n        oof[val_ind] = preds\n\n        print(f'LGBM fold: {fold}: RMSE:{np.sqrt(mse)}')\n    \n    mse_oof = mean_squared_error(oof, train_df['target'])\n    \n    print(f'LGBM Overall RMSE:{np.sqrt(mse_oof)}')\n    return np.sqrt(mse_oof)\n\ntrain_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \nnew_row = {'Model':'6.4. Continuous Features and Median Encoding', 'RMSE': cv_evaluation_regression_mod(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","acc43714":"def cv_evaluation_regression_mod(df, n_fold):\n    oof = np.zeros((300000,))\n    for fold in tqdm(range(n_fold)):\n        val_ind = df[df.kfold == fold].index\n        train = df[df.kfold != fold].reset_index(drop=True)\n        valid = df[df.kfold == fold].reset_index(drop=True)\n\n        features = [feature for feature in df.columns if feature not in ['id', 'target', 'kfold']]\n        \n        for col in cat_features:\n            encode = train.groupby(col)['target'].std()\n            train[col] = train[col].map(encode)\n            valid[col] = valid[col].map(encode)\n\n        X_train = train[features]\n        y_train = train['target']\n        X_valid = valid[features]\n        y_valid = valid['target']\n\n        model = lightgbm.LGBMRegressor(random_state=42, objective='regression', metric='rmse')\n        model.fit(X_train, y_train, eval_set=[(X_valid, y_valid)], verbose=False)\n        preds = model.predict(valid[features])\n        mse = mean_squared_error(y_valid, preds)\n        \n        oof[val_ind] = preds\n\n        print(f'LGBM fold: {fold}: RMSE:{np.sqrt(mse)}')\n    \n    mse_oof = mean_squared_error(oof, train_df['target'])\n    \n    print(f'LGBM Overall RMSE:{np.sqrt(mse_oof)}')\n    return np.sqrt(mse_oof)\n\ntrain_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \nnew_row = {'Model':'6.5. Continuous Features and Standard Deviation Encoding', 'RMSE': cv_evaluation_regression_mod(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","9a81e0df":"def cv_evaluation_regression_mod(df, n_fold):\n    oof = np.zeros((300000,))\n    for fold in tqdm(range(n_fold)):\n        val_ind = df[df.kfold == fold].index\n        train = df[df.kfold != fold].reset_index(drop=True)\n        valid = df[df.kfold == fold].reset_index(drop=True)\n\n        features = [feature for feature in df.columns if feature not in ['id', 'target', 'kfold']]\n        \n        for col in cat_features:\n            encode = train.groupby(col)['target'].skew()\n            train[col] = train[col].map(encode)\n            valid[col] = valid[col].map(encode)\n\n        X_train = train[features]\n        y_train = train['target']\n        X_valid = valid[features]\n        y_valid = valid['target']\n\n        model = lightgbm.LGBMRegressor(random_state=42, objective='regression', metric='rmse')\n        model.fit(X_train, y_train, eval_set=[(X_valid, y_valid)], verbose=False)\n        preds = model.predict(valid[features])\n        mse = mean_squared_error(y_valid, preds)\n        \n        oof[val_ind] = preds\n\n        print(f'LGBM fold: {fold}: RMSE:{np.sqrt(mse)}')\n    \n    mse_oof = mean_squared_error(oof, train_df['target'])\n    \n    print(f'LGBM Overall RMSE:{np.sqrt(mse_oof)}')\n    return np.sqrt(mse_oof)\n\ntrain_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \nnew_row = {'Model':'6.6. Continuous Features and Skewness Encoding', 'RMSE': cv_evaluation_regression_mod(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","8b03caaf":"def cv_evaluation_regression_mod(df, n_fold):\n    oof = np.zeros((300000,))\n    for fold in tqdm(range(n_fold)):\n        val_ind = df[df.kfold == fold].index\n        train = df[df.kfold != fold].reset_index(drop=True)\n        valid = df[df.kfold == fold].reset_index(drop=True)\n\n        features = [feature for feature in df.columns if feature not in ['id', 'target', 'kfold']]\n\n        for col in cat_features:\n            encode = train.groupby(col)['target'].min()\n            train[col+'min'] = train[col].map(encode)\n            valid[col+'min'] = valid[col].map(encode)\n            \n        for col in cat_features:\n            encode = train.groupby(col)['target'].max()\n            train[col+'max'] = train[col].map(encode)\n            valid[col+'max'] = valid[col].map(encode)\n            \n        for col in cat_features:\n            encode = train.groupby(col)['target'].std()\n            train[col+'med'] = train[col].map(encode)\n            valid[col+'med'] = valid[col].map(encode)\n            \n        for col in cat_features:\n            encode = train.groupby(col)['target'].median()\n            train[col+'std_dev'] = train[col].map(encode)\n            valid[col+'std_dev'] = valid[col].map(encode)\n\n        for col in cat_features:\n            encode = train.groupby(col)['target'].mean()\n            train[col] = train[col].map(encode)\n            valid[col] = valid[col].map(encode)\n\n        X_train = train[features]\n        y_train = train['target']\n        X_valid = valid[features]\n        y_valid = valid['target']\n\n        model = lightgbm.LGBMRegressor(random_state=42, objective='regression', metric='rmse')\n        model.fit(X_train, y_train, eval_set=[(X_valid, y_valid)], verbose=False)\n        preds = model.predict(valid[features])\n        mse = mean_squared_error(y_valid, preds)\n        \n        oof[val_ind] = preds\n\n        print(f'LGBM fold: {fold}: RMSE:{np.sqrt(mse)}')\n    \n    mse_oof = mean_squared_error(oof, train_df['target'])\n    \n    print(f'LGBM Overall RMSE:{np.sqrt(mse_oof)}')\n    return np.sqrt(mse_oof)\n\ntrain_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \nnew_row = {'Model':'6.7. Continuous Features, Mean, Median, Min, Max and Std Dev Encoding', 'RMSE': cv_evaluation_regression_mod(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","bbfcf17c":"train_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \nfor col in cat_features:\n    rate_df = train_df[col].value_counts() \/ len(train_df)\n    train_df[col] = train_df[col].map(rate_df)\n    \nnew_row = {'Model':'7.1. Continuous Features and Percentage Categorical Encoding', 'RMSE': cv_evaluation_regression(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","13d87271":"train_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \nfor col in cat_features:\n    rate_df = train_df[col].value_counts() \/ len(train_df)\n    train_df[col] = train_df[col].map(rate_df)\ntrain_df['sum_cat'] = train_df[cat_features].sum(axis=1)\n\nnew_row = {'Model':'7.2. Continuous Features and Sum Categorical Encoding', 'RMSE': cv_evaluation_regression(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","99dad522":"train_df = pd.read_csv('\/kaggle\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_df = create_stratified_folds_for_regression(train_df)\ncat_features = [feature for feature in train_df.columns if 'cat' in feature]\ncont_features = [feature for feature in train_df.columns if 'cont' in feature]\nfor feature in cat_features:\n    le = LabelEncoder()\n    le.fit(train_df[feature])\n    train_df[feature] = le.transform(train_df[feature])\n    \nfor col in cat_features:\n    rate_df = train_df[col].value_counts() \/ len(train_df)\n    train_df[col] = train_df[col].map(rate_df)\ntrain_df['cont_multiply'] = 1\nfor col in cat_features:\n    train_df['cont_multiply'] = train_df[col] * train_df['cont_multiply']\n    \nnew_row = {'Model':'7.3. Continuous Features and Multiplication Categorical Encoding', 'RMSE': cv_evaluation_regression(train_df, 5)}\nresult = result.append(new_row, ignore_index=True)","1f3eff66":"result.sort_values('RMSE')","e2369ed8":"[back to top](#table-of-contents)\n<a id=\"modified_model_20\"><\/a>\n## 6.5. Continuous Features and Standard Deviation Encoding\nFeatures that are used:\n* Continuous features\n* Standard Deviation encoding on categorical features","281c4925":"[back to top](#table-of-contents)\n<a id=\"modified_model_10\"><\/a>\n## 5.10. Continuous Features, Label Encoding and Log Multiplication on Continuous Features\nFeatures that are used:\n* Continuous features\n* Label encoding on categorical features\n* New Features:\n    * Log multiplication on all continuous features","ef3a0ec7":"[back to top](#table-of-contents)\n<a id=\"modified_model_15\"><\/a>\n## 6.3. Continuous Features and Max Encoding\nFeatures that are used:\n* Continuous features\n* Maximum encoding on categorical features","c09ac57e":"[back to top](#table-of-contents)\n<a id=\"modified_model_8\"><\/a>\n## 5.8. Continuous Features, Label Encoding and Log Sum on Continuous Features\nFeatures that are used:\n* Continuous features \n* Label encoding on categorical features\n* New Features:\n    * Log sum of all continuous features","473ac9e9":"[back to top](#table-of-contents)\n<a id=\"modified_model_5\"><\/a>\n## 5.5. Continuous Features, Label Encoding and Max on Continuous Features\nFeatures that are used:\n* Continuous features \n* Label encoding on categorical features\n* New Features:\n    * Max of all continuous features","fb05e14c":"[back to top](#table-of-contents)\n<a id=\"modified_model_19\"><\/a>\n## 6.4. Continuous Features and Median Encoding\nFeatures that are used:\n* Continuous features\n* Median encoding on categorical features","832564eb":"[back to top](#table-of-contents)\n<a id=\"modified_model_16\"><\/a>\n## 6.7. Continuous Features, Mean, Median, Min, Max and Std Dev Encoding\nFeatures that are used:\n* Continuous features\n* Mean encoding on categorical features\n* New Features:\n    * Minimum encoding on categorical features\n    * Maximum encoding on categorical features","92d7880f":"[back to top](#table-of-contents)\n<a id=\"modified_model_6\"><\/a>\n## 5.6. Continuous Features, Label Encoding and Log Max on Continuous Features\nFeatures that are used:\n* Continuous features \n* Label encoding on categorical features\n* New Features:\n    * Log max of all continuous features","02a76bde":"# Table of Contents\n\n<a id=\"table-of-contents\"><\/a>\n1. [Introduction](#introduction)\n2. [Reference](#reference)\n3. [Preparation](#preparation)\n4. [Base Regression Model](#base_model)\n5. [Base Regression Model and Label Encoding](#base_label_encode)\n    * 5.1. [Log Continuous Features and Label Encoding](#modified_model_1)\n    * 5.2. [Log Continuous Features and Log Label Encoding](#modified_model_2)\n    * 5.3. [Continuous Features, Label Encoding and Min on Continuous Features](#modified_model_3)\n    * 5.4. [Continuous Features, Label Encoding and Log Min on Continuous Features](#modified_model_4)\n    * 5.5. [Continuous Features, Label Encoding and Max on Continuous Features](#modified_model_5)\n    * 5.6. [Continuous Features, Label Encoding and Log Max on Continuous Features](#modified_model_6)\n    * 5.7. [Continuous Features, Label Encoding and Sum on Continuous Features](#modified_model_7)\n    * 5.8. [Continuous Features, Label Encoding and Log Sum on Continuous Features](#modified_model_8)\n    * 5.9. [Continuous Features, Label Encoding and Multiplication on Continuous Features](#modified_model_9)\n    * 5.10. [Continuous Features, Label Encoding and Log Multiplication on Continuous Features](#modified_model_10)\n    * 5.11. [Continuous Features, Label Encoding and Prorate on Continuous Features](#modified_model_11)\n    * 5.12. [Continuous Features, Label Encoding and Log Prorate on Continuous Features](#modified_model_12)\n    * 5.13. [Exponential Continuous Features and Label Encoding](#modified_model_23)\n    * 5.14. [Boxcox Continuous Features and Label Encoding](#modified_model_23)\n6. [Base Regression Model and Target Encoding](#base_target_encode)\n    * 6.1. [Continuous Features and Mean Encoding](#modified_model_13)\n    * 6.2. [Continuous Features and Min Encoding](#modified_model_14)\n    * 6.3. [Continuous Features and Max Encoding](#modified_model_15)\n    * 6.4. [Continuous Features and Median Encoding](#modified_model_19)\n    * 6.5. [Continuous Features and Standar Deviation Encoding](#modified_model_20)\n    * 6.6. [Continuous Features and Skewness Encoding](#modified_model_21)\n    * 6.7. [Continuous Features, Mean, Median, Min, Max and Std Dev Encoding](#modified_model_16)\n7. [Base Regression Model and Categorical Encoding](#base_cat_encode)\n    * 7.1. [Continuous Features and Percentage Encoding](#modified_model_17)\n    * 7.2. [Continuous Features and Sum Categorical Encoding](#modified_model_18)\n    * 7.3. [Continuous Features and Multiplication Categorical Encoding](#modiefied_model_22)\n8. [Summary](#summary)","cc68357d":"[back to top](#table-of-contents)\n<a id=\"base_label_encode\"><\/a>\n# 5. Base Regression Model and Label Encoding\n<a id=\"modified_model_1\"><\/a>\n## 5.1. Log Continuous Features and Label Encoding\nFeatures that are used:\n* Log on all continuous features\n* Label encoding on all categorical features","f9d9fde9":"[back to top](#table-of-contents)\n<a id=\"modified_model_22\"><\/a>\n## 7.3. Continuous Features and Multiplication Categorical Encoding\nFeatures that are used:\n* Continuous features\n* Categorical encoding base on the percentage of categorical items\n* New Features:\n    * Multiplication of encoded categorical features","9073fe0c":"[back to top](#table-of-contents)\n<a id=\"reference\"><\/a>\n# 2. Reference\nPlease find great notebooks that are used in this notebook:\n* [February Solution - Stratified KFolds](https:\/\/www.kaggle.com\/gpreda\/february-solution-stratified-kfolds) by [Gabriel Preda](https:\/\/www.kaggle.com\/gpreda)\n* [TPS Feb 2021 with LGBMRegressor](https:\/\/www.kaggle.com\/tunguz\/tps-feb-2021-with-lgbmregressor) by [Bojan Tunguz](https:\/\/www.kaggle.com\/tunguz)","25e355b5":"[back to top](#table-of-contents)\n<a id=\"modified_model_14\"><\/a>\n## 6.2. Continuous Features and Min Encoding\nFeatures that are used:\n* Continuous features\n* Minimum encoding on categorical features","4acf7f7a":"[back to top](#table-of-contents)\n<a id=\"base_cat_encode\"><\/a>\n# 7. Base Regression Model and Categorical Encoding\n<a id=\"modified_model_17\"><\/a>\n## 7.1. Continuous Features and Percentage Categorical Encoding\nFeatures that are used:\n* Continuous features\n* Categorical encoding base on the percentage of categorical items","bddf43fa":"[back to top](#table-of-contents)\n<a id=\"base_target_encode\"><\/a>\n# 6. Base Regression Model and Target Encoding\n<a id=\"modified_model_13\"><\/a>\n## 6.1. Continuous Features and Mean Encoding\nFeatures that are used:\n* Continuous features\n* Mean encoding on categorical features","a5028691":"[back to top](#table-of-contents)\n<a id=\"modified_model_21\"><\/a>\n## 6.6. Continuous Features and Skewness Encoding\nFeatures that are used:\n* Continuous features\n* Skewness encoding on categorical features","dc49ed31":"[back to top](#table-of-contents)\n<a id=\"modified_model_23\"><\/a>\n## 5.13. Exponential Continuous Features and Label Encoding\nFeatures that are used:\n* Exponential on all continuous features\n* Label encoding on all categorical features","24dba326":"[back to top](#table-of-contents)\n<a id=\"preparation\"><\/a>\n# 3. Preparation\nLoading packages, setup some function to cross validate the training dataset and set cross validation to 5.","f3d1ea12":"[back to top](#table-of-contents)\n<a id=\"modified_model_2\"><\/a>\n## 5.2. Log Continuous Features and Log Label Encoding\nFeatures that are used:\n* Log on all continuous features\n* Log label encoding on all categorical features","799e30f2":"[back to top](#table-of-contents)\n<a id=\"modified_model_18\"><\/a>\n## 7.2. Continuous Features and Sum Categorical Encoding\nFeatures that are used:\n* Continuous features\n* Categorical encoding base on the percentage of categorical items\n* New Features:\n    * Sum of encoded categorical features","7ec0459c":"[back to top](#table-of-contents)\n<a id=\"modified_model_9\"><\/a>\n## 5.9. Continuous Features, Label Encoding and Multiplication on Continuous Features\nFeatures that are used:\n* Continuous features\n* Label encoding on categorical features\n* New Features:\n    * Multiplication on all continuous features","864e0334":"[back to top](#table-of-contents)\n<a id=\"modified_model_12\"><\/a>\n## 5.12. Continuous Features, Label Encoding and Log Prorate on Continuous Features\nFeatures that are used:\n* Continuous features\n* Label encoding on categorical features\n* New Features:\n    * Log prorate on all continuous features","a395077e":"[back to top](#table-of-contents)\n<a id=\"base_model\"><\/a>\n# 4. Base Regression Model\nFeatures that are used:\n* Continuous features\n* Label encoding on categorical features","b9a0bad2":"[back to top](#table-of-contents)\n<a id=\"modified_model_11\"><\/a>\n## 5.11. Continuous Features, Label Encoding and Prorate on Continuous Features\nFeatures that are used:\n* Continuous features\n* Label encoding on categorical features\n* New Features:\n    * Prorate on all continuous features","6f03387a":"[back to top](#table-of-contents)\n<a id=\"modified_model_4\"><\/a>\n## 5.4. Continuous Features, Label Encoding and Log Min on Continuous Features\nFeatures that are used:\n* Continuous features \n* Label encoding on categorical features\n* New Features:\n    * Log min of all continuous features","c2d02397":"[back to top](#table-of-contents)\n<a id=\"summary\"><\/a>\n## 8. Summary\n\n**Observations:**\n- `6.4. Continuous Features and Median Encoding` has the highest score compared to others feature engineering.\n- Many feature engineering can't pass baseline model with RMSE of `0.846526`.\n- There are only `6 models` that can pass the baseline model with a small improvement.\n- These features engineering may not help the models to improve the RMSE, it seems that it create a new noise for the model to predict.\n\nBelow are the temporary result for the models:","10e73e97":"[back to top](#table-of-contents)\n<a id=\"modified_model_3\"><\/a>\n## 5.3. Continuous Features, Label Encoding and Min on Continuous Features\nFeatures that are used:\n* Continuous features \n* Label encoding on categorical features\n* New Features:\n    * Min of all continuous features","68b4b4ee":"[back to top](#table-of-contents)\n<a id=\"modified_model_24\"><\/a>\n## 5.14. Boxcox Continuous Features and Label Encoding\nFeatures that are used:\n* Boxcox 0 on all continuous features\n* Label encoding on all categorical features","4a66e12e":"[back to top](#table-of-contents)\n<a id=\"modified_model_7\"><\/a>\n## 5.7. Continuous Features, Label Encoding and Sum on Continuous Features\nFeatures that are used:\n* Continuous features \n* Label encoding on categorical features\n* New Features:\n    * Sum of all continuous features","c0017bb3":"[back to top](#table-of-contents)\n<a id=\"introduction\"><\/a>\n# 1. Introduction\n\nThe purpose of the notebook is to try as many feature engineering without any parameters tuning to see the impact of the new features. The base model is Lightgbm. There is a little summary on each section on features that are used on the model."}}