{"cell_type":{"82b2aaae":"code","f46644f1":"code","496d5693":"code","1297f66a":"code","5c69ae01":"code","d52ebf4c":"code","cc7aa256":"code","c594c206":"code","26eb0b86":"code","fe050338":"code","715e977b":"code","fca72cb1":"code","5c08ad3d":"code","49bebaf7":"code","fd507f5c":"code","3001293c":"code","ac8c0229":"code","edf0df8b":"code","919c1f6b":"code","e58e97cf":"code","5f95937f":"code","f0da403b":"code","d7bb42d8":"code","06daaf4c":"code","ff32b0b6":"code","f457256e":"code","2bd5eeea":"code","9e1dacfd":"code","f68f41f1":"code","8abab4fd":"code","7407909c":"code","b594ea0e":"code","c7350a50":"code","d30f014f":"code","f84ed8ab":"code","929d4d9b":"code","3e7ece5a":"code","2e2484a0":"code","4374a3c8":"code","d00f9159":"code","0486bcb5":"code","7d7b06fc":"code","df8f930f":"code","d8f1802f":"code","81361f11":"code","d56e17f9":"code","235583f8":"code","67c6e066":"code","592c65f3":"code","63a0f5b3":"code","b1df451b":"code","43f37712":"code","0a907913":"markdown","de20660b":"markdown","1facd590":"markdown","7ae7e7a2":"markdown","75b1f8e7":"markdown","84f36a06":"markdown","2b0c13d0":"markdown","0662f6ad":"markdown","131a72d3":"markdown","4d310742":"markdown","0ed4de36":"markdown","7409e093":"markdown","063487de":"markdown","09e17936":"markdown","222085b5":"markdown","d6726a60":"markdown","2bd21499":"markdown","2c6848a8":"markdown","7b884f99":"markdown","3ff4ed3c":"markdown","5de144fa":"markdown","545e13f4":"markdown","684ce351":"markdown","04028b14":"markdown","5845b378":"markdown","a070d8b0":"markdown","8d6747eb":"markdown","24276351":"markdown","4afffe0b":"markdown","f3c45dd3":"markdown","6ade5f8a":"markdown"},"source":{"82b2aaae":"#Import libraries\nimport numpy as np\nimport pandas as pd\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","f46644f1":"data= pd.read_csv(\"\/kaggle\/input\/telco-customer-churn\/WA_Fn-UseC_-Telco-Customer-Churn.csv\")\ndf= data.copy()\ndf.head()","496d5693":"df.shape","1297f66a":"df.info()","5c69ae01":"df.isnull().sum()","d52ebf4c":"df= df.drop([\"customerID\"],axis=1)","cc7aa256":"df['TotalCharges'] = pd.to_numeric(df.TotalCharges, errors='coerce')","c594c206":"df.isnull().sum()","26eb0b86":"df[df.TotalCharges.isnull()==True].head(5)","fe050338":"data.iloc[[488]]","715e977b":"df.dropna(axis=0,how=\"any\",inplace=True)\ndf.isnull().sum()","fca72cb1":"df.describe().T","5c08ad3d":"#Churn and tenure(Number of months the customer has stayed with the company)\nfig, (ax1,ax2) = plt.subplots(1,2,figsize=(12,5)) \nax1.pie(df.Churn.value_counts(),autopct = '%1.1f%%',labels=[\"No\",\"Yes\"])\nax1.set_title('Churn')\nax2.hist(x=\"tenure\",data=df)\nax2.set_title('Tenure (months)')","49bebaf7":"#Charges\nfig, axes = plt.subplots(1,2,figsize=(14,5)) \naxes[1].set_xlabel(\"$\")\nsns.histplot(x=\"MonthlyCharges\", data=df , ax=axes[1],color=\"pink\").set(title=\"MonthlyCharges\")\naxes[0].set_xlabel(\"$\")\nsns.histplot(x=\"TotalCharges\", data=df , ax=axes[0],color=\"r\").set(title=\"TotalCharges\")","fd507f5c":"#Customers\nfig, (ax1,ax2,ax3,ax4) = plt.subplots(1,4,figsize=(20,20)) \nax1.pie(df.gender.value_counts(),autopct = '%1.1f%%',labels=[\"Male\",\"Female\"],colors=[\"lightblue\",\"pink\"])\nax1.set_title('Gender')\n\nax2.pie(df.SeniorCitizen.value_counts(),autopct = '%1.1f%%',labels=[\"No\",\"Yes\"],colors=[\"brown\",\"grey\"])\nax2.set_title('SeniorCitizen')\n\nax3.pie(df.Partner.value_counts(),autopct = '%1.1f%%',labels=[\"No\",\"Yes\"],colors=[\"#415A77\",\"#778DA9\"])\nax3.set_title('Partner')\n\nax4.pie(df.Dependents.value_counts(),autopct = '%1.1f%%',labels=[\"No\",\"Yes\"],colors=[\"#04888B\",\"#B0FBFD\"])\nax4.set_title('Dependents')\n","3001293c":"#Services per customer\nfig, (ax1,ax2) = plt.subplots(1,2,figsize=(10,10)) \nax1.pie(df.PhoneService.value_counts(),autopct = '%1.1f%%',labels=[\"Yes\",\"No\"],colors=[\"#85E2FF\",\"#005E7A\"])\nax1.set_title('PhoneService')\n\nax2.pie(df.MultipleLines.value_counts(),autopct = '%1.1f%%',labels=[\"No\",\"Yes\",\"No phone service\"],colors=[\"#FECE85\",\"#F29202\",\"grey\"])\nax2.set_title('MultipleLines')\n\n","ac8c0229":"sns.catplot(x=\"InternetService\",kind=\"count\",data=df,palette=\"inferno\").set(title=\"Internet Sevices\")","edf0df8b":"#Services per customer (cont.)\nfig, (ax1,ax2,ax3,ax4) = plt.subplots(1,4,figsize=(20,20)) \nax1.pie(df.OnlineSecurity.value_counts(),autopct = '%1.1f%%',labels=[\"No\",\"Yes\",\"No Internet service\"],colors=[\"#70CFFF\",\"#0092E0\",\"grey\"])\nax1.set_title('OnlineSecurity')\n\nax2.pie(df.OnlineBackup.value_counts(),autopct = '%1.1f%%',labels=[\"No\",\"Yes\",\"No Internet service\"],colors=[\"#EA1744\",\"#EC325A\",\"grey\"])\nax2.set_title('OnlineBackup')\n\nax3.pie(df.DeviceProtection.value_counts(),autopct = '%1.1f%%',labels=[\"No\",\"Yes\",\"No Internet service\"],colors=[\"#84EB8E\",\"#1DAF2B\",\"grey\"])\nax3.set_title('DeviceProtection')\n\nax4.pie(df.TechSupport.value_counts(),autopct = '%1.1f%%',labels=[\"No\",\"Yes\",\"No Internet service\"],colors=[\"#FFC999\",\"#FF7C0A\",\"grey\"])\nax4.set_title('TechSupport')\n\n","919c1f6b":"#Services per customer (cont.)\nfig, (ax1,ax2) = plt.subplots(1,2,figsize=(10,10)) \nax1.pie(df.StreamingMovies.value_counts(),autopct = '%1.1f%%',labels=[\"No\",\"Yes\",\"No Internet service\"],colors=[\"#F4A4A6\",\"#A31419\",\"grey\"])\nax1.set_title('StreamingMovies')\n\nax2.pie(df.StreamingTV.value_counts(),autopct = '%1.1f%%',labels=[\"No\",\"Yes\",\"No Internet service\"],colors=[\"#D3F490\",\"#5B820D\",\"grey\"])\nax2.set_title('StreamingTV')\n","e58e97cf":"#Customer account information \nsns.catplot(x=\"Contract\",kind=\"count\",data=df,ax=ax1,palette=\"Reds\")\nsns.catplot(x=\"PaperlessBilling\",kind=\"count\",data=df,palette=\"Reds\")\nsns.catplot(x=\"PaymentMethod\",kind=\"count\",data=df,palette=\"Reds\",aspect=2)\n","5f95937f":"sns.pairplot(df)","f0da403b":"sns.scatterplot(x=\"MonthlyCharges\",y=\"TotalCharges\",hue=\"Churn\",data=df)","d7bb42d8":"sns.scatterplot(x=\"tenure\",y=\"TotalCharges\",hue=\"Churn\",data=df)","06daaf4c":"#gender\nsns.catplot(x=\"Churn\",kind=\"count\",hue=\"gender\",data=df)","ff32b0b6":"#Seniorcitizen\nsns.catplot(x=\"Churn\",kind=\"count\",hue=\"SeniorCitizen\",data=df)","f457256e":"sns.catplot(x=\"Churn\",kind=\"count\",hue=\"Partner\",data=df)\nsns.catplot(x=\"Churn\",kind=\"count\",hue=\"Dependents\",data=df)","2bd5eeea":"sns.catplot(x=\"Churn\",kind=\"count\",hue=\"PhoneService\",data=df,palette=\"magma\")\nsns.catplot(x=\"Churn\",kind=\"count\",hue=\"MultipleLines\",data=df,palette=\"magma\")","9e1dacfd":"sns.catplot(x=\"Churn\",kind=\"count\",hue=\"InternetService\",data=df,palette=\"rainbow\")","f68f41f1":"sns.catplot(x=\"Churn\",kind=\"count\",hue=\"OnlineSecurity\",data=df,palette=\"rainbow\")","8abab4fd":"sns.catplot(x=\"Churn\",kind=\"count\",hue=\"OnlineBackup\",data=df,palette=\"rainbow\")","7407909c":"sns.catplot(x=\"Churn\",kind=\"count\",hue=\"DeviceProtection\",data=df,palette=\"rainbow\")","b594ea0e":"sns.catplot(x=\"Churn\",kind=\"count\",hue=\"TechSupport\",data=df,palette=\"rainbow\")","c7350a50":"sns.catplot(x=\"Churn\",kind=\"count\",hue=\"StreamingTV\",data=df,palette=\"rainbow\")\nsns.catplot(x=\"Churn\",kind=\"count\",hue=\"StreamingMovies\",data=df,palette=\"rainbow\")","d30f014f":"sns.catplot(x=\"Churn\",kind=\"count\",hue=\"Contract\",data=df,palette=\"Wistia\")\nsns.catplot(x=\"Churn\",kind=\"count\",hue=\"PaymentMethod\",data=df,palette=\"magma\")\nsns.catplot(x=\"Churn\",kind=\"count\",hue=\"PaperlessBilling\",data=df,palette=\"cividis\")","f84ed8ab":"dft=pd.get_dummies(df)\n","929d4d9b":"dft","3e7ece5a":"dft.drop([\"gender_Male\",\"Partner_No\",\"Dependents_No\",\"PhoneService_No\",\"MultipleLines_No\",\"InternetService_No\",\"OnlineSecurity_Yes\",\"OnlineBackup_Yes\",\"DeviceProtection_Yes\",\"TechSupport_Yes\",\"StreamingTV_Yes\",\"StreamingMovies_Yes\",\"Contract_One year\",\"PaperlessBilling_Yes\",\"PaymentMethod_Credit card (automatic)\",\"Churn_No\"],axis=1,inplace=True)","2e2484a0":"dft","4374a3c8":"sns.set(rc={'figure.figsize':(30,20)})\nsns.heatmap(df.corr(),annot=True,cmap=\"YlGnBu\")","d00f9159":"dft.corr()[\"Churn_Yes\"]","0486bcb5":"sns.set(rc={'figure.figsize':(30,20)})\nsns.heatmap(dft.corr(),annot=True,cmap=\"inferno\")","7d7b06fc":"from sklearn.ensemble import RandomForestClassifier\nparams = {'random_state': 0, 'n_jobs': 4, 'n_estimators': 5000, 'max_depth': 8}\nx, y = dft.drop([\"Churn_Yes\"],axis=1), dft['Churn_Yes']\n\n# Fit RandomForest Classifier\nclf = RandomForestClassifier(**params)\nclf = clf.fit(x, y)\n\n# Plot features importances\nimp = pd.Series(data=clf.feature_importances_, index=x.columns).sort_values(ascending=False)\nplt.figure(figsize=(10,12))\nplt.title(\"Feature importance\")\nax = sns.barplot(y=imp.index, x=imp.values, palette=\"inferno\", orient='h')\n\n#.feature_importances_","df8f930f":"dft.drop([\"MultipleLines_No phone service\",\"OnlineSecurity_No internet service\",\"OnlineBackup_No internet service\",\"DeviceProtection_No internet service\",\"TechSupport_No internet service\",\"StreamingMovies_No internet service\",\"StreamingTV_No internet service\"],axis=1, inplace=True)","d8f1802f":"dft.head()","81361f11":"sns.set(rc={'figure.figsize':(30,20)})\nsns.heatmap(dft.corr(),annot=True)","d56e17f9":"from sklearn.model_selection import train_test_split\n\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.svm import SVC\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.ensemble import RandomForestClassifier,GradientBoostingClassifier,AdaBoostClassifier\nfrom xgboost import XGBClassifier\n\nseed=333\nlr = LogisticRegression(solver='liblinear')\nsvc = SVC() \nknn = KNeighborsClassifier()\nrf = RandomForestClassifier()\nxgb = XGBClassifier()\ngb=GradientBoostingClassifier()\nabc=AdaBoostClassifier()","235583f8":"X= dft[[\"tenure\",\"Contract_Month-to-month\",\"TotalCharges\",\"MonthlyCharges\",\"OnlineSecurity_No\",\"TechSupport_No\",\"InternetService_Fiber optic\",\"PaymentMethod_Electronic check\"]]\nY= dft.Churn_Yes\n\nX.head()","67c6e066":"X_train,X_test,y_train,y_test=train_test_split(X,Y,test_size=0.2)","592c65f3":"#Por defecto el metodo score retorna el coeficiente de determinacion R^2\ndef entrenar(model):\n    model.fit(X_train, y_train)\n    return (model.score(X_train, y_train),model.score(X_test, y_test))\n    #return model.score(X_test, y_test)\n\n#Entrenamos\nmodelos = {'LogisticRegression': lr,\n          'KNeighborsClassifier': knn,\n          'SVC': svc,\n          'RandomForestClassifier': rf,\n          'XGBClassifier': xgb,\n          'GradientBoostingClassifier': gb,\n          'AdaBoostClassifier': abc}\nscores={}\ntrain_scores={}\nfor nombre, modelo in modelos.items():\n    scores[nombre]=entrenar(modelo)[1]\n    train_scores[nombre]=entrenar(modelo)[0]\n\nscores.items()","63a0f5b3":"scores = pd.DataFrame(scores,index=['Score']).transpose()\nscores = scores.sort_values('Score')\n\ntrain_scores = pd.DataFrame(train_scores,index=['Train Score']).transpose()\ntrain_scores = train_scores.sort_values('Train Score')\n","b1df451b":"cm = sns.color_palette('flare',as_cmap=True)\nscores = scores.style.background_gradient(cmap=cm)\nscores","43f37712":"train_scores.style.background_gradient(cmap=cm)","0a907913":"Non-senior citizen clients have a greater chance of quitting, but we also know that the majority of clients are non-senior citizens.\nOn the other hand, more than half of senior citizens drop out.","de20660b":"## EDA Churn","1facd590":"\n---\n\n\n\n**Customer account information:**","7ae7e7a2":"**Dont seems to be a relationship between the client's sex and Churn**\n","75b1f8e7":"\n\n---\n\n\n\n**Demographic info about customers:**","84f36a06":"There seem to be no relationships. Those who do not have telephone service almost never leave ","2b0c13d0":"Let's check numeric","0662f6ad":"\n---\n\n\n\n**Internet Services that each customer has signed up for:**","131a72d3":"Oh, customers who have fiber optic tend to quit frequently\n","4d310742":"\n\n---\n11 indirect missing values appear. Why?\n","0ed4de36":"everything seems to be fine for now.\n","7409e093":"\n\n---\n\n**there were blanks as values!**.\nWe will eliminate those records to clean it\n\n","063487de":"# **Model**","09e17936":"# **Data Visualization**","222085b5":"# Missing values","d6726a60":"## Univariate EDA","2bd21499":"**We have 7043 total rows and 21 columns.**\n","2c6848a8":"\n---\n\n\n\n**Phone Services that each customer has signed up for:**","7b884f99":"# Context\n\"Predict behavior to retain customers. You can analyze all relevant customer data and develop focused customer retention programs.\" [IBM Sample Data Sets]","3ff4ed3c":"## Pairlplot","5de144fa":"\n\n---\n\n\n**Done.**\n\n\n","545e13f4":"**The importances validate the previous analysis. All three numerical characteristics are good predictors of churn, especially tern. As we have seen, fiber optic customers are very likely to drop out, while those with long-term contracts do not. On the other hand, gender and streaming are not important characteristics and it might be interesting to remove additional services labeled 'No internet service', as they are highly correlated.**","684ce351":"\n\n---\n\n\n\n\n\n","04028b14":"# **Data Cleaning**","5845b378":"\n\n---\nNo missing values\n","a070d8b0":"# **Correlation**","8d6747eb":"Clients who do not have a partner are more likely to abandon, and there is also a tendency to abandon those who do not have dependents\n","24276351":"The data set includes information about:\n\n* Customers who left within the last month \u2013 the column is called Churn\n* Services that each customer has signed up for \u2013 phone, multiple lines, internet, online security, online backup, device protection, tech support, and streaming TV and movies\n* Customer account information \u2013 how long they\u2019ve been a customer, contract, payment method, paperless billing, monthly charges, and total charges\n* Demographic info about customers \u2013 gender, age range, and if they have partners and dependents","4afffe0b":"# **Data manipulation & encoding**","f3c45dd3":"Now, we transform TotalCharges column to numeric as it should be","6ade5f8a":"Observation: if you dont have any service like TechSupport or Online Security, you are more likely to abandon\n"}}