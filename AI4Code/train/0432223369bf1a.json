{"cell_type":{"574e3578":"code","cf41d5f4":"code","4306b372":"code","876396a4":"code","8943d8d3":"code","d08c9eca":"code","5bf1fba8":"code","1064268f":"code","42c05c3b":"code","ed17489e":"code","5a826abd":"code","cdb8cff3":"code","20812855":"code","98b77f13":"code","a0ac5ddf":"code","eaeabd31":"code","68b20a79":"code","2ae8dd60":"code","4722a2d1":"code","298031ef":"code","a348c343":"code","fa3d3850":"code","4ce1b1d7":"code","ef1eef43":"code","32cccb6e":"code","a5149886":"code","91c6aa89":"code","2fadeafa":"code","f57a84eb":"code","9d3c2d46":"code","0460bae3":"code","7b8df7ef":"code","e1215514":"code","571d07fa":"code","920630ce":"code","22a1429c":"code","da9bdfe5":"code","03d10f7e":"code","a94b2d7c":"code","f2343dd6":"code","db26a729":"code","8e1ade4b":"code","0c772d5d":"code","0efbdfe4":"code","5e05427a":"code","530d3f25":"code","4b59b8bc":"code","7eadb3ad":"markdown","b0030817":"markdown","afe96c13":"markdown","3b65b597":"markdown","631b46ff":"markdown","16b57003":"markdown","eddd3462":"markdown","84ba0417":"markdown","d60b0503":"markdown","2c5d0222":"markdown","a0095e3b":"markdown","a6496bc8":"markdown","aa2bff23":"markdown","aaa448dd":"markdown"},"source":{"574e3578":"import numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\naviation_incidents = '..\/input\/aviation-accident-database-synopses\/AviationData.csv'\n\ndf = pd.read_csv(aviation_incidents, engine ='python')","cf41d5f4":"df.info()","4306b372":"df['Investigation.Type'].value_counts()","876396a4":"df = df[df['Investigation.Type']=='Accident']","8943d8d3":"import missingno as msno","d08c9eca":"msno.matrix(df)","5bf1fba8":"df = df.drop(['Airport.Code', 'Airport.Name', 'Aircraft.Category', 'Registration.Number', \n              'Number.of.Engines', 'Engine.Type', 'FAR.Description', 'Schedule', \n              'Air.Carrier', 'Report.Status', 'Publication.Date'], axis=1)","1064268f":"df.shape","42c05c3b":"# replacing null values with 0 for numerical columns\n\ndf['Total.Fatal.Injuries'].replace({np.nan: 0}, inplace=True)\ndf['Total.Serious.Injuries'].replace({np.nan: 0}, inplace=True)\ndf['Total.Minor.Injuries'].replace({np.nan: 0}, inplace=True)\ndf['Total.Uninjured'].replace({np.nan: 0}, inplace=True)","ed17489e":"# replacing null values with 'Unknown' or 'UNK' for categorical columns\n\ndf['Investigation.Type'].replace({np.nan: 'Unknown'}, inplace=True)\ndf['Location'].replace({np.nan: 'Unknown'}, inplace=True)\ndf['Country'].replace({np.nan: 'Unknown'}, inplace=True)\ndf['Latitude'].replace({np.nan: 'Unknown'}, inplace=True)\ndf['Longitude'].replace({np.nan: 'Unknown'}, inplace=True)\ndf['Aircraft.Damage'].replace({np.nan: 'Unknown'}, inplace=True)\ndf['Make'].replace({np.nan: 'Unknown'}, inplace=True)\ndf['Model'].replace({np.nan: 'Unknown'}, inplace=True)\ndf['Amateur.Built'].replace({np.nan: 'Unknown'}, inplace=True)\ndf['Purpose.of.Flight'].replace({np.nan: 'Unknown'}, inplace=True)\ndf['Weather.Condition'].replace({np.nan: 'UNK'}, inplace=True)\ndf['Broad.Phase.of.Flight'].replace({np.nan: 'UNKNOWN'}, inplace=True)","5a826abd":"msno.matrix(df)","cdb8cff3":"total_purpose = df['Purpose.of.Flight'].value_counts()\nprint(total_purpose)","20812855":"def personal(purpose):\n    if purpose == 'Personal':\n        return 'Personal'\n    \n    else:\n        return 'Non-personal'","98b77f13":"df['Purpose.of.Flight_simplified'] = df['Purpose.of.Flight'].apply(personal)","a0ac5ddf":"plt.figure(figsize=(14, 6))\nsns.countplot(df['Purpose.of.Flight_simplified'])","eaeabd31":"flight_purpose_damage = df.groupby(['Aircraft.Damage', \n                                    'Purpose.of.Flight_simplified']).size().reset_index().pivot(columns='Aircraft.Damage', \n                                                                                  index='Purpose.of.Flight_simplified', \n                                                                                  values=0)\nflight_purpose_damage.plot(kind='bar', stacked=True)","68b20a79":"df['Event.Date'] = pd.to_datetime(df['Event.Date'])\ndf['Month'] = df['Event.Date'].dt.month\ndf['Year'] = df['Event.Date'].dt.year\ndf = df[df['Year']>=1982]","2ae8dd60":"plt.figure(figsize=(20,8))\nsns.countplot(df['Year'],palette = 'coolwarm')","4722a2d1":"plt.figure(figsize=(20,8))\nsns.countplot(df['Month'],palette='coolwarm')","298031ef":"df.head()","a348c343":"injury_count = pd.pivot_table(df, index=['Year'],values=['Total.Fatal.Injuries',\n                                                         'Total.Serious.Injuries',\n                                                         'Total.Minor.Injuries',\n                                                         'Total.Uninjured'],aggfunc=np.sum)\ninjury_count.head()","fa3d3850":"fig, axes = plt.subplots(nrows=2, ncols=2,figsize=(24, 14))\nfig.subplots_adjust(hspace=.3)\n\nfatal_plot = injury_count['Total.Fatal.Injuries'].plot(ax=axes[0,0], \n                                                       kind='bar', \n                                                       title = 'Total fatal injuries per year', \n                                                       color='r')\n\nserious_plot = injury_count['Total.Serious.Injuries'].plot(ax=axes[0,1], \n                                                           kind='bar', \n                                                           title = 'Total serious injuries per year', \n                                                           color='y')\n\nminor_plot = injury_count['Total.Minor.Injuries'].plot(ax=axes[1,0], \n                                                       kind='bar', \n                                                       title = 'Total minor injuries per year', \n                                                       color='g')\n\nuninjured_plot = injury_count['Total.Uninjured'].plot(ax=axes[1,1], \n                                                      kind='bar', \n                                                      title = 'Total uninjured per year', \n                                                      color='b')","4ce1b1d7":"percent_phase = df['Broad.Phase.of.Flight'].value_counts(normalize=True).mul(100).round(1).astype(str) + '%'\npercent_phase","ef1eef43":"def phase_of_flight(phase):\n    if phase in (['UNKNOWN','TAXI','DESCENT','CLIMB','GO-AROUND','STANDING', 'OTHER']):\n        return 'OTHERS'\n    \n    else:\n        return phase","32cccb6e":"df['Phase.of.Flight_simplified'] = df['Broad.Phase.of.Flight'].apply(phase_of_flight)\n\ndf['Phase.of.Flight_simplified'].value_counts()","a5149886":"df['Total.Injuries'] = df['Total.Fatal.Injuries'] + df['Total.Serious.Injuries'] + df['Total.Minor.Injuries']\n\nflight_phase_injury = df.groupby(['Phase.of.Flight_simplified'])['Total.Injuries'].agg('sum').reset_index()\nprint(flight_phase_injury)","91c6aa89":"fig, axes = plt.subplots(nrows=1, ncols=2,figsize=(20, 12))\nfig.subplots_adjust(hspace=.3)\n\n\naccident_plot = sns.countplot(df['Phase.of.Flight_simplified'], \n              ax=axes[0], \n              palette='coolwarm',\n              order=['LANDING', 'TAKEOFF', 'CRUISE', 'MANEUVERING', 'APPROACH', 'OTHERS'])\n\naccident_plot.set(xlabel='', ylabel = 'Number of Accidents')\n\ninjury_plot = sns.barplot(x = 'Phase.of.Flight_simplified', \n            y = 'Total.Injuries', \n            data = flight_phase_injury, \n            ax=axes[1], \n            palette='coolwarm',\n            order=['LANDING', 'TAKEOFF', 'CRUISE', 'MANEUVERING', 'APPROACH', 'OTHERS'])\n\ninjury_plot.set(xlabel = '', ylabel = 'Total Injuries Caused')","2fadeafa":"flight_phase_damage = df.groupby(['Aircraft.Damage', \n                      'Phase.of.Flight_simplified']).size().reset_index().pivot(columns='Aircraft.Damage', \n                                                                                    index='Phase.of.Flight_simplified', \n                                                                                    values=0)\n\nprint(flight_phase_damage)\n\nflight_phase_damage.plot(kind='bar', stacked=True)","f57a84eb":"accident_count = df.groupby(['Year', \n                             'Phase.of.Flight_simplified']).size().reset_index().pivot(columns='Phase.of.Flight_simplified', \n                                                                                       index='Year', \n                                                                                       values=0)\naccident_count.head()","9d3c2d46":"plt.figure(figsize = (20,10))\nsns.heatmap(accident_count, cmap = 'Blues')\nplt.xlabel('')\nplt.title('Breakdown of accidents per category')","0460bae3":"percent_weather = df['Weather.Condition'].value_counts(normalize=True).mul(100).round(1).astype(str) + '%'\npercent_weather","7b8df7ef":"weather_explode = (0.2, 0, 0)\n\nweather_chart = df['Weather.Condition'].value_counts().plot(kind = 'pie',\n                                            explode = weather_explode,\n                                            autopct = '%.1f', \n                                            title = 'Weather Conditon',\n                                            textprops = {'fontsize': 12}\n                                            )\n\nplt.ylabel('')","e1215514":"df['Make'].value_counts().head(10)","571d07fa":"def get_make(make):\n    \n    if make in ['Cessna','Piper','Beech', 'Bell']:\n        return make.upper()\n        \n    elif make in ['CESSNA','PIPER','BEECH', 'BELL']:\n        return make\n        \n    else:\n        return 'OTHER'","920630ce":"df['Make.simplified'] = df['Make'].apply(get_make)","22a1429c":"plt.figure(figsize=(14, 6))\nsns.countplot(df['Make.simplified'])","da9bdfe5":"df_make = df[df['Make.simplified'] != 'OTHER']","03d10f7e":"df_make.shape","a94b2d7c":"make_damage = df_make.groupby(['Aircraft.Damage', \n                      'Make.simplified']).size().reset_index().pivot(columns='Aircraft.Damage', \n                                                                                    index='Make.simplified', \n                                                                                    values=0)\nmake_damage.plot(kind='bar', stacked=True)","f2343dd6":"accidents_year = df.groupby(['Year'])[\"Event.Id\"].count().reset_index(name=\"Number of Accidents\")\naccidents_year.head()","db26a729":"x = accidents_year['Year'].to_numpy()\ny = accidents_year['Number of Accidents'].to_numpy()\n\nprint(x.shape)\nprint(y.shape)","8e1ade4b":"x = x.reshape((-1, 1))\n\nprint(x.shape)","0c772d5d":"from sklearn.linear_model import LinearRegression\nregr = LinearRegression()\n\nregr.fit(x,y)","0efbdfe4":"extended_x = np.arange(1982, 2025, 1).reshape(-1, 1)\ny_pred = regr.predict(extended_x)\n\nf, axes = plt.subplots(1, 1, figsize=(20, 8))\nplt.plot(x,y, 'o')\nplt.plot(extended_x, y_pred)\nplt.plot(extended_x, y_pred, 's')\naxes.set_ylim(ymin=0)\naxes.set_xlabel('Year')\nplt.xticks(np.arange(1982, 2025, 2))\n\nprint(\"Predicting number of accidents for the next 5 years:\\n\" )\nfor i in range (0,5):\n    year = 2020+i\n    n = -5+i\n    print('Year %d: %d' % (year, y_pred[n]))\nprint('')    \nprint('Slope:', regr.coef_)","5e05427a":"from sklearn.preprocessing import PolynomialFeatures\nfrom sklearn.metrics import mean_squared_error, r2_score","530d3f25":"def create_polynomial_regression_model():\n    \n    for degree in [2,3]:\n        poly_features = PolynomialFeatures(degree=degree)\n\n        x_poly = poly_features.fit_transform(x)\n\n        regr_poly = LinearRegression()\n        regr_poly.fit(x_poly, y)\n\n\n        y_poly_pred = regr_poly.predict(x_poly)\n\n        rmse = np.sqrt(mean_squared_error(y,y_poly_pred))\n        r2 = r2_score(y,y_poly_pred)\n        \n        print('Degree: ', degree)\n        print('RMSE: ', rmse)\n        print('R_squared: ', r2)\n        print('')\n\n        poly_2020 = regr_poly.predict(poly_features.fit_transform(np.array(2020).reshape(1,-1)))\n        poly_2021 = regr_poly.predict(poly_features.fit_transform(np.array(2021).reshape(1,-1)))\n        poly_2022 = regr_poly.predict(poly_features.fit_transform(np.array(2022).reshape(1,-1)))\n        poly_2023 = regr_poly.predict(poly_features.fit_transform(np.array(2023).reshape(1,-1)))\n        poly_2024 = regr_poly.predict(poly_features.fit_transform(np.array(2024).reshape(1,-1)))\n\n        y_poly_pred_x = np.arange(1982, 2025, 1)\n\n        poly_pred = np.concatenate((poly_2020, poly_2021, poly_2022, poly_2023, poly_2024))\n\n        poly_pred_full = np.concatenate((y_poly_pred, poly_pred))\n\n        data = np.array([[y_poly_pred_x], [poly_pred_full]])\n\n        print(\"Predicting number of accidents for the next 5 years:\\n\" )\n        for i in range (0,5):\n            year = 2020+i\n            n = -5+i\n            print('Year %d: %d' % (year, poly_pred_full[n]))\n        print('')\n        \n        plt.rcParams[\"figure.figsize\"] = [20,8]\n        plt.plot(x, y, 'o')\n        \n        plt.plot(y_poly_pred_x, poly_pred_full, label=\"degree %d\" % degree +'; $R^2$: %.2f' % r2)\n        plt.legend(loc=\"upper right\")\n        \n        axes.set_ylim(ymin=0)\n        axes.set_xlabel('Year')\n        plt.xticks(np.arange(1982, 2025, 2))","4b59b8bc":"create_polynomial_regression_model()","7eadb3ad":"Linear Regression to view trend of number of accidents over the years.","b0030817":"Focusing only on 'Accidents', we will drop the rows with 'Incidents'.\nWe will also drop columns which are not really relevant to our analysis.","afe96c13":"Since the major contributors are 'LANDING', 'TAKEOFF', 'CRUISE', 'MANEUVERING' and 'APPROACH', we will classify the rest as 'OTHERS'.","3b65b597":"It is interesting to see that most of the accidents occur during VMC as the weather conditions is said to be better as compared to IMC.\n\nExplanation of the terms VMC and IMC can be found [here.](https:\/\/www.thebalancecareers.com\/definition-vmc-and-imc-282942)","631b46ff":"As we only considered 'Accidents', it is expected to have more 'Substantial' and 'Destroyed' damages as compared to minor ones.","16b57003":"Accidents caused by different weather conditions.","eddd3462":"From the result we can see that there are 13 columns with significant amount of null values.\n\nFor the columns with numerical values (Total.Fatal.Injuries, Total.Serious.Injuries, Total.Minor.Injuries and Total.Uninjured), we will replace the null values with 0.\n\nWe will drop the following columns as we would not be using them in our analysis:\n\nAirport.Code, Airport.Name, Aircraft.Category, Registration.Number, Number.of.Engines, Engine.Type, FAR.Description, Schedule, Air.Carrier, Report.Status and Publication.Date.\n\nWe will keep Latitude and Longitude for our analysis.\n\nFor the remaining categorical columns with null values, we will replace them with 'Unknown' or 'UNK'.","84ba0417":"It is interesting to see that accidents occured during LANDING accounted for the least number of injuries despite being the highest accident contributor.","d60b0503":"As 'Personal' flight accounts for more than 50% of the total accidents, we will classify them to 'Personal' and 'Non-personal' and make a comparison.\n\n**Note - 'Unknown' will be regarded as 'Non-personal'**","2c5d0222":"We will take the top 4 variables for our analysis ('CESSNA', 'PIPER', 'BEECH', 'BELL'). ","a0095e3b":"We can see a downward trend for minor and serious injuries.\n\nFor fatal injuries, the numbers increased in 2018 and 2019 and this can be due to the Boeing 737 MAX crash (Ethiopian Airlines Flight 302 and Lion Air Flight 610).\n\nMore details [here.](https:\/\/en.wikipedia.org\/wiki\/Boeing_737_MAX_groundings)","a6496bc8":"The linear model is predicting that the number of accidents will go down by about 46 per year.\n\nWe will now try with polynomial regression to view the trend.","aa2bff23":"We will now use the Missingno library to visualise the distribution of null values.","aaa448dd":"The highest points are in June, July and August. This is in correlation to the summer season when there are more flights during this period."}}