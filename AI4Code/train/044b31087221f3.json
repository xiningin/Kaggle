{"cell_type":{"a9aa58a3":"code","94359a3d":"code","15092a7e":"code","ba144546":"code","5b3826a7":"code","0af69074":"code","34bb2f45":"code","8e61dc2b":"code","cc9ee6db":"code","31fa83bb":"code","79dac130":"code","243b2aa1":"code","69d8061f":"code","0f67835f":"code","1ee422ad":"code","a7b61531":"code","dda8087f":"code","a1be7e53":"code","6639e164":"code","a43479e7":"markdown","c3f14fc9":"markdown","f4c0aee2":"markdown","6665a8d8":"markdown","ae7a4f15":"markdown","fe0b9649":"markdown","a775b919":"markdown","25aa9506":"markdown","8198f733":"markdown","34ff582d":"markdown","e3863363":"markdown","ef35e6dc":"markdown","b4295d0d":"markdown","1eede35b":"markdown","82eea0f3":"markdown","757bb694":"markdown","63df9008":"markdown","813c7772":"markdown","091e0222":"markdown","745c7469":"markdown","1451d867":"markdown","c97be6a9":"markdown"},"source":{"a9aa58a3":"!pip install pycountry_convert\n!pip install pyvis","94359a3d":"from pycountry_convert import country_alpha2_to_continent_code, country_name_to_country_alpha2\n\nimport pandas as pd\nimport numpy as np\n\nimport plotly.express as px\nimport plotly.graph_objects as go\nimport plotly.figure_factory as ff\n\nfrom sklearn.cluster import AgglomerativeClustering\nfrom sklearn.manifold import TSNE\n\nfrom pyvis.network import Network\nimport networkx as nx","15092a7e":"df = pd.read_csv(\"\/kaggle\/input\/world-vaccine-progress\/World_Vaccination_Progress.csv\")\ndf.head(5)","ba144546":"unique_vac = {}\ntemp_encode_len = 30\nencodes = []\ncontinents = []\n\nfor i in range(df.shape[0]):\n    if i == 0:\n        encodes.append([1] * temp_encode_len)\n        continents.append(\"Null\")\n    else:\n        vaccines = df['Vaccine being used in a country'][i]\n        encode = [0] * temp_encode_len\n        for vaccine in [x.strip() for x in vaccines.split(\",\")]: \n            if vaccine not in unique_vac.keys():\n                unique_vac[vaccine] = len(unique_vac.keys())\n                \n            vac_index = unique_vac[vaccine]\n            encode[vac_index] = 1\n        encodes.append(encode)\n        \n        # Retrieving continent\n        try:\n            continents.append(country_alpha2_to_continent_code(country_name_to_country_alpha2(df['Country'][i])))\n        except:\n            continents.append(\"Null\")\n\nfor vaccine in unique_vac.keys():\n    vac_index = unique_vac[vaccine]\n    df[vaccine] = [x[vac_index] for x in encodes]\n    \ndf.head(5)","5b3826a7":"try:\n    df['Oxford\/AstraZeneca'] = df[['Oxford\/AstraZeneca', 'Oxford \/ AstraZeneca']].max(axis=1)\n    df.drop(columns = ['Oxford \/ AstraZeneca'], axis=1, inplace=True)\nexcept:\n    \"not found\"\n\ntry:\n    df['Sinopharm'] = df[['Sinopharm', 'Sinopharm\/Beijing', 'Sinopharm\/HayatVax', 'Sinopharm\/Wuhan']].max(axis=1)\n    df.drop(columns = ['Sinopharm\/Beijing', 'Sinopharm\/HayatVax', 'Sinopharm\/Wuhan'], axis=1, inplace=True)\nexcept:\n    \"not found\"\n    \ntry:\n    df['RBD-Dimer'] = df[['Dimer', 'RBD']].max(axis=1)\n    df.drop(columns = ['Dimer', 'RBD'], axis=1, inplace=True)\nexcept:\n    \"not found\"\n    \ndf.head(5)","0af69074":"df['Size'] = (df['Doses Administered'] \/ df['Doses per 1000'] * 1000).apply(np.floor)\ndf['Continent'] = continents\ndf['Cluster'] = [0] * len(df['Country'])\ndf.head(5)","34bb2f45":"x = df['Doses per 1000'].to_numpy()\ny = df['Fully Vaccinated Population (%)'].to_numpy()\nfig = px.scatter(df[1:], x=\"Doses per 1000\", \n                 y=\"Fully Vaccinated Population (%)\", \n                 hover_name=\"Country\",\n                 size= df[1:][\"Size\"].apply(lambda x: x ** 0.3), # Population size is set to the power of 0.3 for visualization purposes,\n                 color=\"Continent\")\n\nm, c = np.polyfit(x, y, 1)\nx1 = np.linspace(0,2400,2400)\ny1 = m*x1 + c\nfig.add_traces(go.Scatter(x=x1, y=y1,\n                          mode = 'lines',\n                          marker_color='grey',\n                          name='Trendline')\n                          )\nfig.show()","8e61dc2b":"fig = px.box(df, x=\"Continent\", \n             y=\"Doses per 1000\", \n             color=\"Continent\", \n             hover_name=\"Country\", \n             points=\"all\")\nfig.update_xaxes(\n        tickangle = 90,\n        title_text = \"Continent\",\n        title_standoff = 25,\n        categoryorder =\"median descending\")\nfig.show()","cc9ee6db":"fig = px.scatter_geo(df, locations=\"Country\", locationmode=\"country names\",\n                     color=\"Doses per 1000\",\n                     size=\"Size\",\n                     size_max=100\n                     )\nfig.show()","31fa83bb":"fig = px.scatter(df[1:], x=\"Size\", \n                 y=\"Doses per 1000\", \n                 hover_name=\"Country\",\n                 color=\"Continent\")\nfig.show()","79dac130":"\"\"\"\nJoining GDP data with dataframe\n\nhttps:\/\/drive.google.com\/file\/d\/16Im_qB1EhYZVyWZhhMOTFBAkuCWh6EhW\/view?usp=sharing\nref: https:\/\/www.worldometers.info\/gdp\/gdp-per-capita\/\n\"\"\"\n\ndf2 = pd.read_csv(\"\/kaggle\/input\/gdp-per-capita\/GDP_country.csv\", encoding= \"unicode_escape\")\ndf = pd.merge(df, df2, on=\"Country\", how=\"left\")\n\n\ndf.head(5)","243b2aa1":"x = df[\"GDP\"]\ny = df[\"Doses per 1000\"]\nidx = np.isfinite(x) & np.isfinite(y)\nfig = px.scatter(df, x=x, y=y, hover_name=\"Country\", color=\"Continent\")\nm, c = np.polyfit(x[idx], y[idx], 1)\nx1 = np.linspace(0,120000,1000)\ny1 = m*x1 + c\nfig.add_traces(go.Scatter(x=x1, y=y1,\n                          mode = 'lines',\n                          marker_color='grey',\n                          name='Trendline')\n                          )\nfig.show()","69d8061f":"new_df_country = []\nnew_df_vaccine = []\nnew_df_gdp = []\nnew_df_doses = []\nnew_df_continent = []\nfor i in range(len(df['Country'])):\n    if i == 0:\n        pass\n    else:\n        for vaccine in list(df.columns[5:-4]):\n            if df[vaccine][i] == 1:\n                new_df_country.append(df[\"Country\"][i])\n                new_df_vaccine.append(vaccine)\n                new_df_gdp.append(df[\"GDP\"][i])\n                new_df_doses.append(df[\"Doses per 1000\"][i])\n                new_df_continent.append(df[\"Continent\"][i])\n\ndf_split = pd.DataFrame()\ndf_split[\"Country\"] = new_df_country\ndf_split[\"Vaccine\"] = new_df_vaccine\ndf_split[\"GDP\"] = new_df_gdp\ndf_split[\"Doses per 1000\"] = new_df_doses \ndf_split[\"Continent\"] = new_df_continent\n\nfig = px.box(df_split, x=\"Vaccine\", y=\"GDP\", hover_name=\"Country\", points=\"all\")\nfig.update_xaxes(\n        tickangle = 90,\n        title_text = \"Vaccine\",\n        title_standoff = 25,\n        categoryorder =\"mean descending\")\n\nfig.show()\n","0f67835f":"hot_encode = df[df.columns[5:-4]][1:]\ntsne = TSNE(random_state=69)\nX_embedded = tsne.fit_transform(hot_encode)\nfig = px.scatter(df[1:], x=X_embedded[:,0], y=X_embedded[:,1], hover_name=\"Country\", color=\"Continent\", opacity=0.7)\nfig.show()","1ee422ad":"hot_encode = df[1:][df.columns[5:-4]].to_numpy()\n# cols = len(df.columns[5:-3])\ncountries = list(df['Country'])[1:]\n\nencode_dic = {}\nfor i in range(len(countries)):\n    to_encode = [x\/np.sum(hot_encode[i]) for x in hot_encode[i]]\n    encode_dic[countries[i]] = to_encode\n\ncorr_plot = []\nfor i in encode_dic.keys():\n    corr_row = []\n    for j in encode_dic.keys():\n        corr_row.append(np.corrcoef(encode_dic[i], encode_dic[j])[0][1])\n    corr_plot.append(corr_row)\n    \nfig = ff.create_dendrogram(np.array(corr_plot), orientation='bottom', labels=countries)\nfig.update_layout({'width':1800, 'height':600,\n                         'showlegend':False, 'hovermode': 'closest',\n                         })\nfig.show()","a7b61531":"from IPython.display import display\ncluster = AgglomerativeClustering(n_clusters=4, affinity='euclidean', linkage='ward')  \nclusters = cluster.fit_predict(np.array(corr_plot))\n\ndf['Cluster'] = np.concatenate((np.array([100]), clusters), axis=0)\nfor c in range(4):\n    print(\"Cluster\", c)\n    display(df[df['Cluster'] == c].head(5))\n    ","dda8087f":"fig = px.scatter_geo(df[1:], locations=\"Country\", locationmode=\"country names\",\n                     color=\"Cluster\",\n                     size=\"Size\",\n                     size_max=50\n                     )\nfig.show()","a1be7e53":"fig = px.box(df[1:], x=\"Cluster\", y=\"GDP\", hover_name=\"Country\", color=\"Cluster\", points=\"all\")\nfig.update_xaxes(\n        tickangle = 90,\n        title_text = \"Cluster\",\n        title_standoff = 25,\n        categoryorder =\"median descending\")\n\nfig.show()","6639e164":"fig = px.box(df[1:], x=\"Cluster\", y=\"Doses per 1000\", hover_name=\"Country\", color=\"Cluster\", points=\"all\")\nfig.update_xaxes(\n        tickangle = 90,\n        title_text = \"Cluster\",\n        title_standoff = 25,\n        categoryorder =\"median descending\")\n\nfig.show()","a43479e7":"# Fully vaccinated % vs  Doses per 1000\nNow that data cleaning is complete, let's do some basic analysis to gain some insights into the dataset.\n\nFirst, I'll go through a scatter plot of doses against fully vaccination rate for a quick overview,a sanity check and to verify if there are any peculiarities.","c3f14fc9":"# Geography\n- A boxplot and geoplot will be generated to visualise how geography (continent\/region) could influence vaccination progress.","f4c0aee2":"The GDP per capita of Cluster 0 and 3 are much higher than those of the 'budget' clusters 1 and 2. \n\nLet's see how vaccination progress is reflected by vaccination progress.","6665a8d8":"# Cleaning Vaccine columns\nSeems like the vaccine names would have to be cleaned. \n\nLet's combine these sets together:\n\n**Oxford\/AstraZeneca**\n- Oxford\/AstraZeneca\n- Oxford \/ AstraZeneca\n\n**Sinopharm**\n- Sinopharm\n- Sinopharm\/Beijing\n- Sinopharm\/Wuhan\n- Sinopharm\/HayatVax\n\n**RBD-Dimer** \n- Dimer\n- RBD\n","ae7a4f15":"# Further Plots of Clusters","fe0b9649":"# Economics\n- This is pretty logical since more money = more choice and ability to reserve\/invest in vaccines early.\n- A GDP column will be joined to the dataframe using the country column,\n- A scatter plot will be generated to determine if there is indeed a trend between GDP and vaccination progress.\n- We will also look at how the wealth of a country may influence its vaccine choices with a box plot.","a775b919":"Vaccination progress for each cluster seems to follow a similar trend as GDP.\n\nHowever, interestingly, although the median GDP per capita of cluster 0 is lower than that of cluster 3, cluster 0 has a similar median vaccination progress.\n","25aa9506":"There is a clear positive correlation between GDP and Vaccination doses.\n- This makes sense as richer nations would generally be able to place orders and invest in vaccines while they are still in development, reserving stockpiles.\n- Poorer nations may also be unable to afford certain vaccines and would thus have fewer options to choose from. In some cases, nations may even be reliant on donations.\n\nAlthough a correlation seems to exist, a linear fit is not adequate is explaining the data spread and it is likely that other factors also influence vaccination progress.\n- Notably, there are some exceptions where poorer countries have a lot more doses (could be due to political alliances and aid or choosing cheaper alternatives).\n- Individual fluctuations are also likely to be due to countries balancing between 'cost', 'efficacy' and 'safety'.\n\nIt could be interesting to explore how GDP influences a country's vaccine choice.","8198f733":"# Creating\/Initialising a few more columns for analysis","34ff582d":"# Population Size\n- Population size could potentially influence vaccination progress by complicating logistics. However, a large population size could also provide a country with a larger talent pool to research its own vaccine. \n- A simple scatter plot of doses per 1000 against size will be generated to evaluate whether size plays a role in vaccination progress.","e3863363":"# Thank you!","ef35e6dc":"# COVID19 Vaccination Progress Exploratory Data Analysis\n- Some preliminary EDA on the vaccination progress in the world.\n- Factors such as geography (continent), economics (gdp), population size and politics are explored briefly. \n- A variety of plots are used for visualisation and unsupervised learning is used to glean additional insights into how vaccines may be selected by countries. ","b4295d0d":"Examining the t-SNE visualisation plot, it seems plausible that politics has an influence on vaccine choice. \n- We see that many West European countries, South Korea and the United States appear relatively close to one another.\n- Countries that aren't closely associated with NATO generally appear on the other side of the t-SNE plot.\n\nTo gain a better understanding of the association between countries and vaccine choice, we can do some unsupervised learning on a one-hot encoded vector of the vaccines with hierachial agglomerative clustering.\n- This will be achieved by calculating the correlation matrix between countries based on their one-hot encoded vectors of vaccines used. \n- The correlation matrix will then be used for hierachial clustering. \n- We can visualise the clusterings with a dendrogram.\n\nNote: Other forms of clustering such as DBSCAN\/K-means were sampled and did not perform well on the one-hot encoded vector, but may perform better on the t-SNE dimensions.  ","1eede35b":"- The box plot and geoplot reaffirm that Africa seems to be far behind other continents in terms of vaccinations, while Europe seems to be in the lead.\n- However, there are clear outliers to this theory as some African nations such as Seychilles and Morocco have decent progress. Some European countries also seem to be performing poorly. \n- Perhaps factors such as politics and economics, which are closely linked to continent geography could better explain the progress of vaccination. Size could also perhaps explain some of the outliers. \n\n","82eea0f3":"# Conclusion\nOverall it seems that the following factors could influence vaccination progress:\n- Economics (GDP) is a strong predictor of vaccination progress.\n- Vaccine choice (some colinearity with GDP)\n- Potentially politics (potentially influences vaccine choice: can consider both citizen trust and diplomatic relationships). Not enough analysis or data to conclude on the degree of impact. Would be good if an external dataset of political closeness between countries could be used to validate this. \n\nFactors that do not contribute meaningfully to vaccine progress:\n- Size (on it's own)\n- Geography (Although it is a good indicator on its own, it has a colinear impact alongside Economics and Politics, which seem to be more logical proxies) \n\nOther factors to consider:\n- Logistics (Country Land Size, Land-locked)\n- Health policies\n- Covid cases (if a country has several covid cases and\/or deaths, perhaps they would be more inclined to vaccinate quickly)\n- Economics (Industry). Countries and territories that are dependent on tourism may be more inclined to vaccinate quickly.\n\n# Limitations with data and analysis\n- No breakdown of number of vaccine doses for each specific vaccine brand\n- Limited usage on statistics of each individual vaccine (e.g. cost, country of origin, trust)\n- Time series data for vaccination progress is too limited for meaningful insight\n- Would be meaningful to have vaccination and death time series data to develop better insight on how vaccination rates are helping against covid\n\n# Future works\n- Feature engineering using economical and political features. \n- The clustering from the vaccine types could be used as a basic proxy feature for political alignment but there are likely to be more robust datasets that can be used for feature engineering this attribute.\n- Time series to track deaths and vaccination progress. \n- Could use more traits related to countries such as proxies of their healthcare\/political policies. \n- Could represent each vaccine as a vector of traits. e.g. trust (academic trust and political trust), safety (associated with acadamic trust), cost, availability\n\nThis is just a preliminary exploratory data analysis and there is a lot more to explore. \n\nHopefully this kernel has been of help to you.","757bb694":"These results are certainly interesting and it seems like economics definitely play a role in determining which vaccines a country chooses.\n\n- Moderna is a particularly expensive vaccine, costing 32 to 37 dollars a dose and the high median GDP of countries that use it reflects this cost.\n- Countries with a GDP > 50000 almost exclusively use *Pfizer*, *Oxford\/AstraZeneca*, *Moderna* and *Johnson and Johnson*, which are widely regarded as the 'safest'\/most well-documented vaccines.\n- We see that lesser-known vaccines are used by many countries with a GDP <20000. We also see that some of these countries such as Cuba also opt to use locally produced vaccines. \n\n\n- Only one country with a GDP > 50000, Macao, uses Sinopharm, which makes sense due to its close relationship (autonomous territory) with China (the producer). \n- This could point to politics also having a major influence on vaccination choice","63df9008":"As expected, there is a clear linear trend between fully vaccinated rates and the total doses administered per capita.\n- This is inspite of certain vaccinations such as Johnson-Johnson only requiring a single dose compared to the two required of other vaccines. \n\nAlthough most countries follow the trend, there are a few outliers:\n- First, we see some countries (UAE, Kuwait, Guernsay, Ireland...) have particularly low fully vaccinated rates relative to their doses per capita. This could be due to these countries postponing second doses in order to ensure a larger portion of their populations receive a single dose. \n- We also notice that there is one major outlier (Gibraltar) with >100% vaccination rate. Gibraltar is a small, but wealthy British island territory and it's possible that they provide vaccinations to visitors and include such numbers in their tally. Although this possibility would explain the outlier result, it points at another potential limitation that countries may tabulate vaccination records differently (e.g. Some countries may include vaccinations of foreigners, while others may not). This would lead to some inevitable noisiness in data.\n\nOverall, although both metrics are reasonable proxies for one another, it seems that doses per 1000 would be a more meaningful reference for analysing vaccination progress due to potential differences in national vaccination strategies.\n\n\nOther clear insights we can draw from this plot are:\n- It is apparent that several African countries have low vaccination rates. \n- Meanwhile European countries seem to be performing the best with most having 20-40% fully vaccination rates. \n","813c7772":"# Data Initialisation","091e0222":"# Politics(?)\n- Evaluating the impact of politics on vaccination progress is tricky without any proper measurement of political closeness. \n- However, we can try grouping countries by the vaccines they use using dimension reduction visualisation and unsupervised learning methods.\n- Examining the members of the resulting clusters, we can then glean some insight into whether politics could influence which vaccines a country chooses and vaccination progress. \n- However, especially since there isn't an objective way to evaluate our inferences, caution must be exercised to avoid confirmational bias. ","745c7469":"From the dendrogram and sample tables of the clusters, it seems that political affiliation has some influence on the 'vaccine selection' cluster a country belongs to.\n- Cluster 0 seems to be countries that use a mix of Oxford\/AstraZeneca (one of the cheapest vaccines that is highly regarded owever, it has a slightly lower efficacy rate than Pfizer and Moderna) and other high efficacy, but expensive vaccines such as Moderna. We'll call this the 'balanced' group.\n- Cluster 1 consists of countries that use a mix of Oxford\/AstraZeneca (associated with the western Europe) and vaccines produced by the 'East' (China or Russia) such as Sinopharm, Sinovac and Sputnik or India's case, its own vaccine, Covaxin. Using cheaper vaccines produced from both political sides, these countries can be generally seen as 'budget, politically unbiased'.\n- Cluster 2 consists of several countries that are traditionally viewed as being part of the 'communist' block during the cold war era. These countries do not use the vaccines produced by the 'West' and rely on a mix of vaccines from the East or domestically produced vaccines in the case of Cuba. For the purposes of this notebook, I'll label them as 'budget, politically biased'.\n- At first glance, Cluster 3 seems to consist of countries that predominantly use American vaccines such as Pfizer\/BioNTech. However, some countries that also use Sinovac\/Sinopharm such as Turkey and Hong Kong and Macao appear in this cluster. It is interesting that Hong Kong and Macao use Pfizer even though they are autonomous territories of China, which is not on the best diplomatic ties with the United States. These territories may use Pfizer because the citizens in these territories likely trust the US vaccines even though their governments aren't diplomatic terms. This reveals that perhaps citizen trust is just as important as diplomatic ties, when it comes to vaccine selection. Overall this is quite a hodgepodge group and splitting it up could lead to more meaningful clusters. However, based on the current cluster split, the common trait amongst members is that these they use Pfizer, but not Oxford\/AstraZeneca.\n\n\nOverall, it seems that politics could have some influence on how vaccines decide which vaccines to use.\n\nNote: These generalisations may not apply to all countries within the group perfectly. Clusterings are almost never perfect and it would be virutally impossible to describe the countries within each group with a short label. \n","1451d867":"# Creating one-hot encode columns for all the vaccines.\n- Split the vaccine column into individual vaccines.\n- Keep track of each unique vaccine (for indexing) in unique_vac dictionary\n- Generate one-hot encode for each row i. \n- First row (world) defaults to all vaccines. \n\n* As the number of vaccines would not be known at the start, we initialise each encoding with \n[0] * temp_encode_len. Alternatively you can loop through the entire column once to find out how many \nvaccines there are since the dataset is small, but I prefer to skip the extra loop. ","c97be6a9":"- Although it looks like there is a decrease in vaccination progress with size from first glance, it is unlikely that size has a massive impact on vaccination progress.\n- While some very large countries like India are lagging behind in progress (skewing the results), several small countries also have low vaccination progress. \n- It is also noticable that there are large countries like the United States that still have decent vaccination progress per capita. \n- Overall, it seems like there isn't much meaningful relationship between size (at least on its own) and vaccination progress. "}}