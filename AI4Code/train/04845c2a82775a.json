{"cell_type":{"5a882ab9":"code","a02a6c72":"code","f0f1d9bc":"code","1db6a867":"code","49dbca04":"code","ccd93835":"code","bd2feca3":"code","2fd08cc5":"code","1ea6897b":"code","0e2bf665":"code","fd3a81b5":"code","8198b27a":"code","f0966092":"markdown","3f5c16bd":"markdown","072bed0d":"markdown","8cf521d1":"markdown","39fd956f":"markdown","11a5bb4f":"markdown","adb71e78":"markdown","5266b495":"markdown","767e5ae8":"markdown","20fed5dd":"markdown","35f9760c":"markdown","b17715db":"markdown","dd9fe201":"markdown","4340736c":"markdown","62d9622a":"markdown","a0b540e4":"markdown","47832422":"markdown"},"source":{"5a882ab9":"# importing required modules\n\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport pandas as pd\nfrom sklearn import model_selection\nimport statsmodels.formula.api as sm\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.linear_model import LinearRegression\nfrom IPython.core.display import display, HTML\nfrom pdpbox import pdp, get_dataset, info_plots\nimport shap\n\nimport eli5\nfrom eli5.sklearn import PermutationImportance\n","a02a6c72":"dataset = pd.read_csv(\"..\/input\/dataset.csv\")\n# happiness scores\ny = dataset.iloc[:, 5].values\n\n# independent variables\nX = dataset.iloc[:, :-1].values\n\n# feature names\nfeature_names = ['Economy (GDP per Capita)', 'Trust (Government Corruption)', 'HDI', 'Inflation', 'Employment Ratio']\n\nX_train, X_test, y_train, y_test = model_selection.train_test_split(X, y, random_state = 1)","f0f1d9bc":"# Using Permutation importance to find the most important variables\n# Using a random forest regression for this\nfrom sklearn.ensemble import RandomForestRegressor\nrandomForestRegressor = RandomForestRegressor(n_estimators = 300, random_state = 0)\ny = y.ravel()\nrandomForestModel = randomForestRegressor.fit(X_train, y_train)\n\nperm = PermutationImportance(randomForestModel, random_state = 1).fit(X_test, y_test)\ndisplay(HTML(eli5.show_weights(perm, feature_names = feature_names).data))","1db6a867":"# plotting partial dependency plot for HDI\npdp_goals = pdp.pdp_isolate(model=randomForestModel, dataset=dataset, model_features=feature_names, feature='HDI')\npdp.pdp_plot(pdp_goals, 'HDI')\nplt.show()","49dbca04":"# plotting partial dependency plot for Employment Ratio\npdp_goals = pdp.pdp_isolate(model=randomForestModel, dataset=dataset, model_features=feature_names, feature='Employment Ratio')\npdp.pdp_plot(pdp_goals, 'Employment Ratio')\nplt.show()","ccd93835":"# plotting partial dependency plot for Inflation\npdp_goals = pdp.pdp_isolate(model=randomForestModel, dataset=dataset, model_features=feature_names, feature='Inflation')\npdp.pdp_plot(pdp_goals, 'Inflation')\nplt.show()","bd2feca3":"\nprediction_data = X[38]  # Using 1 row here, having high value of happiness score\nexplainer = shap.TreeExplainer(randomForestModel)\nshap_values = explainer.shap_values(prediction_data)\nshap.initjs()\nshap.force_plot(explainer.expected_value, shap_values[0:], prediction_data, feature_names = feature_names)","2fd08cc5":"\nprediction_data = X[75]  # Using 1 row here, having moderate value of happiness score\nexplainer = shap.TreeExplainer(randomForestModel)\nshap_values = explainer.shap_values(prediction_data)\nshap.initjs()\nshap.force_plot(explainer.expected_value, shap_values[0:], prediction_data, feature_names = feature_names)","1ea6897b":"prediction_data = X[90]  # Using 1 row here, having low value of happiness score\nexplainer = shap.TreeExplainer(randomForestModel)\nshap_values = explainer.shap_values(prediction_data)\nshap.initjs()\nshap.force_plot(explainer.expected_value, shap_values[0:], prediction_data, feature_names = feature_names)","0e2bf665":"prediction_data = X[1:100]  # Using 100 rows here\nexplainer = shap.TreeExplainer(randomForestModel)\nshap_values = explainer.shap_values(prediction_data)\nshap.initjs()\nshap.force_plot(explainer.expected_value, shap_values[0:], prediction_data, feature_names = feature_names)","fd3a81b5":"shap_values = explainer.shap_values(X_test)\nshap.summary_plot(shap_values, X_test, feature_names = feature_names)","8198b27a":"# make a dependence plot of Employment Ratio\nshap_values = explainer.shap_values(X)\nshap.dependence_plot('Employment Ratio', shap_values, X, feature_names = feature_names)","f0966092":"As expected, inflation has the least influence on happiness. The graph clearly shows that changes in inflation have a small effect on happiness","3f5c16bd":"Then we are going to read the data, and create variables to hold dependent and independent variables::\n","072bed0d":"We will continue analyzing this result using partial dependency plots:","8cf521d1":"The summary plot shows the impact of all features on the happiness scores. This has already been evaluated with permutation importance, here we are verifying that we are getting the same results. Again we can see that HDI has the highest impact on happiness score and inflation has the lowest impact. It is shown that the HDI values are more spread out and values to the right indicate high HDI values. This means that high HDI values cause the highest increase in happiness score, and low HDI values have a relatively higher negative impact on happiness. Comparing HDI to GDP per capita, it can be concluded that though GDP per capita affects happiness, it does not affect happiness as HDI does. The highest GDP per capita value produces an increase of around 0.6, whereas the highest HDI value produces an increase of around 1.5 in happiness scores.","39fd956f":"This figure shows the output for a moderate value of 5.48, which is close to the base value of 5.467.\n\nAnd this is the figure for a low value:","11a5bb4f":"This graph shows which features are increasing or decreasing the happiness scores. We can browse this graph and get explanations for each prediction. Overall, the expected results are seen here again: high HDI values produce high happines scores,","adb71e78":"This clearly shows that increasing HDI causes an increase in happiness scores.\nNow we will check the partial dependency plot for employment ratio:","5266b495":"This kernel tries to answer the age old question: What is it that makes us happy?\n\nHappiness is the ultimate ambition of our lives. We spend our entire lives striving for happiness. From a nation's point of view, the mood of its population can be estimated by the economic conditions of the country. It is obvious that a nation which is well developed will have a happy population, as compared to a poor nation. But on a deeper thought, we need to find out to what extent the economic conditions affect  the people's sense of happiness and well being. For instance, the country with the highest GDP per capita was Luxembourg (2018) but the happiest country in 2018 is Finland. And Luxembourg is actually on the 17th place on the happiness index. So we can say that money may influence happiness, but only to a limited extent. HDI is a composite index which includes life expectancy, GDP per capita and education. It  represents how developed people are. I will include them both in my calculations.\n\nTo be fair, we should also investigate factors which have a negative impact on people's mood. We often find people complaining about poor leadership and inflation, so I will include parameters for trust on government and inflation in our analysis.\n\nI have taken data from worldbank.org for all countries. This data includes happiness scores, GDP per capita, human development index, government trust factor, employment rate and inflation. The data is from the years 2015, 2016 and 2017.\nNow I am going to determine how different economic indicators influence how happy people are.\n\nImporting the required modules:","767e5ae8":"We can infer that employment ratio influences happiness only upto a certain extent. Beyond a ratio of 60%, it has less influence on happiness score.\nSince inflation has the least impact on happiness score, we will check for inflation too:","20fed5dd":"Permutation importance method is used to find which feature has the highest influence on happiness, and which one has the lowest. First a model should be created from Random forest regression, then that model will be used in permutation importance.","35f9760c":"This is a summary plot of features:","b17715db":"The above graph is a dependence graph of employment ratio. The graph shows the relationship between employment ratio and its SHAP value. The graph tries to highlight a relationship between HDI and employment ratio. HDI is color coded, the blue points indicate rows with low HDI values. The blue points are all near the zero point on the vertical axis. We can conclude that lower HDI values produces lower SHAP values for employment ratio, which means that employment ratio has less effect on happiness for countries with low HDI.","dd9fe201":"This is all for happiness analysis.We have analysed the model with many methods and concluded that in a country, HDI has the maximum influence on happiness.","4340736c":"The figure above shows that the base value is 5.467, which is the average output of the happiness score from the model. From the base value, the value is increased to 6.07, and the feature which is increasing the prediction value is GDP per capita. \nIn the above scenario, I have selected one record which has a high happiness score. Now we will do the same for a record with a moderate happniess score.","62d9622a":"This figure shows the output for a low happiness score of 5.11. In this case, it is the GDP per capita and employment ratio that is reducing the happiness score. Do keep in mind that these results are from analyzing only one row of data at a time, so it shouldn't be considered that GDP per capita is bringing the happiness score down everywhere. Now a force plot will be generated over 100 rows in the dataset.","a0b540e4":"The predictions will now be analyzed with SHAP analysis. For SHAP analysis, we will select three rows from the dataset, one each for a high value, moderate value and low value of happiness score.","47832422":"The result shows that HDI has the highest influence on happiness scores. And the result also shows that inflation is the least importance variable.\nSo this is the order of importance of the features, from highest to lowest:\n1. HDI\n2. GDP per capita\n3. Employment Ratio\n4. Trust on government\n5. Inflation\n\nNow let's analyze this result.\n\nHDI is a composite index representing education, life expectancy and GDP per capita. And employment ratio represents the rate of employment. Since HDI is the most important factor, we can say that our personal development is the most important factor influencing our happiness. And it seems the saying 'Money can't buy happiness' is true. Happiness rather depends on how much people develop themselves (HDI) and their contribution to society (employment).\u00a0So to sum up, happiness really depends on fostering our skills and talents and our ability to harness them to\u00a0contribute\u00a0to society.\n\nNow that is some food for thought."}}