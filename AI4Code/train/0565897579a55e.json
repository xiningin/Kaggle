{"cell_type":{"71fa1d3d":"code","d11b90aa":"code","94e38779":"code","116dc0d0":"code","6e8aa3d2":"code","69e51dae":"code","09ac68e1":"code","933b9551":"code","5291f9bf":"code","9c4fe8f7":"code","9702d6d6":"code","448ef43e":"code","e28347cf":"code","188c7413":"code","cf9ea29c":"code","397044f5":"code","5a82fd58":"code","df7cf6a0":"code","2c3a10e8":"code","57037424":"code","2d79b84c":"code","2a7e9433":"code","88b06f8a":"code","61779cb6":"code","9b1a16a1":"code","722eaeae":"code","767b65df":"code","7dc8ca7e":"code","94acfb8e":"code","d2113b57":"code","efd04e59":"code","735af95f":"code","4f1f908c":"code","dc011cea":"code","8f2da080":"code","0559e8e3":"code","6428727d":"code","522e737d":"code","19b61f40":"code","ff129122":"code","54294012":"code","1698dffa":"code","168ab02d":"code","3a6768b3":"code","69b4973a":"code","df040bec":"code","995abeda":"code","d910a2f1":"code","16369d4b":"code","c80b3f2b":"code","2d023e78":"code","457fa367":"code","a81e1644":"code","87f3d147":"code","efb909da":"code","1be513f8":"code","136ba6a1":"code","ea6de770":"code","edea39af":"code","20643a25":"code","2fddb9ca":"code","a8378d31":"code","bc295af5":"code","771d17f7":"code","f60cb426":"code","6b4a6eb3":"markdown","f87715fa":"markdown","faa36bee":"markdown","b255f38b":"markdown","9e1baaed":"markdown","624ed299":"markdown","55084dce":"markdown","b2fdb7e7":"markdown","f7e3341b":"markdown","707ddeb5":"markdown","9cb3c7a4":"markdown","21be6d13":"markdown","0ef06f76":"markdown","2984b438":"markdown"},"source":{"71fa1d3d":"import math\nimport numpy as np\nimport pandas as pd\nfrom datetime import datetime\nfrom scipy import stats\n\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n%matplotlib inline \nplt.style.use('seaborn-whitegrid')\n\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn import metrics\nfrom sklearn.ensemble import RandomForestRegressor,  GradientBoostingRegressor\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn.model_selection import KFold, cross_val_score\nfrom sklearn.metrics import mean_squared_error\n#import statsmodels.api as sm","d11b90aa":"\ndf_receivable = pd.read_csv('..\/input\/finance-factoring-ibm-late-payment-histories\/WA_Fn-UseC_-Accounts-Receivable.csv')\n#df.dropna(inplace=True)\ndf_receivable.info()","94e38779":"df_receivable.head(5)","116dc0d0":"df_receivable['InvoiceDate']= pd.to_datetime(df_receivable.InvoiceDate)\n","6e8aa3d2":"df_receivable['Late'] = df_receivable['DaysLate'].apply(lambda x: 1 if x >0 else 0)","69e51dae":"df_receivable.head(3)","09ac68e1":"df_receivable['countlate']=df_receivable.Late.eq(1).groupby(df_receivable.customerID).apply(\n    lambda x : x.cumsum().shift().fillna(0)).astype(int)","933b9551":"df_receivable.head(3)","5291f9bf":"df_receivable.info()","9c4fe8f7":"df_receivable.describe()","9702d6d6":"temp = pd.DataFrame(df_receivable.groupby(['countryCode'], axis=0, as_index=False)['DaysLate'].mean())\nplt.figure(figsize=(10,6))\nsns.barplot(x=\"countryCode\", y=\"DaysLate\",data=temp,linewidth=2.5, facecolor=(1, 1, 1, 0),\n                 errcolor=\".4\", edgecolor=\"red\")","448ef43e":"df_receivable.describe(include=np.object)","e28347cf":"print(pd.crosstab(index=df_receivable[\"PaperlessBill\"], columns=\"count\"))\nprint(pd.crosstab(index=df_receivable[\"countryCode\"], columns=\"count\"))\nprint(pd.crosstab(index=df_receivable[\"Late\"], columns=\"count\"))","188c7413":"df_receivable.head(3)","cf9ea29c":"customer_late =pd.crosstab(index=df_receivable[\"customerID\"], columns=df_receivable['Late'])\ncustomer_late.sort_values(by=[1], ascending = False)","397044f5":"df1 = df_receivable[df_receivable['DaysLate']>0].copy()","5a82fd58":"df2 = pd.DataFrame(df1.groupby(['customerID'], axis=0, as_index=False)['DaysLate'].count())","df7cf6a0":"df2.columns = (['customerID','repeatCust'])","2c3a10e8":"df3 = pd.merge(df_receivable, df2, how='left', on='customerID')","57037424":"df3['repeatCust'].fillna(0, inplace=True)","2d79b84c":"df_receivable = df3","2a7e9433":"\ntemp = pd.DataFrame(df_receivable.groupby(['repeatCust'], axis=0, as_index=False)['DaysLate'].mean())\nplt.figure(figsize=(14,7))\nsns.barplot(x=\"repeatCust\", y=\"DaysLate\",data=temp,color='olive')","88b06f8a":"def func_IA (x):\n    if x>60: return \"b. more than 60\"\n    else: return \"a. less than 60\"\ndf_receivable['InvoiceAmount_bin'] = df_receivable['InvoiceAmount'].apply(func_IA)","61779cb6":"df_receivable.head(3)","9b1a16a1":"temp = pd.DataFrame(df_receivable.groupby(['InvoiceAmount_bin'], axis=0, as_index=False)['DaysLate'].mean())","722eaeae":"plt.figure(figsize=(10,6))\nsns.barplot(x=\"InvoiceAmount_bin\", y=\"DaysLate\",data=temp,color='purple')","767b65df":"df_receivable['Disputed'] = df_receivable['Disputed'].map({'No':0,'Yes':1})\ndf_receivable['PaperlessBill'] = df_receivable['PaperlessBill'].map({'Paper': 0,'Electronic': 1})","7dc8ca7e":"df_receivable['InvoiceQuarter']= pd.to_datetime(df_receivable['InvoiceDate']).dt.quarter","94acfb8e":"df_receivable.head(3)","d2113b57":"plt.figure(figsize=(10,8))\n\nax = sns.countplot(df_receivable['countryCode'],hue=df_receivable['Late'],palette=\"YlGn\")\n","efd04e59":"plt.figure(figsize=(10,8))\nsns.countplot(df_receivable['InvoiceQuarter'],hue=df_receivable['Late'],palette='bright')\n","735af95f":"plt.figure(figsize=(10,8))\nsns.countplot(df_receivable['PaperlessBill'],hue=df_receivable['Late'],palette='YlOrRd')\n","4f1f908c":"plt.figure(figsize=(10,8))\nsns.countplot(df_receivable['Disputed'],hue=df_receivable['Late'],palette='BuGn')","dc011cea":"plt.figure(figsize=(8,8))\nplt.figure(1)\nsns.distplot(df_receivable['InvoiceAmount'],color='green')\nplt.figure(figsize=(8,8))\nplt.figure(2)\nsns.distplot(df_receivable['DaysToSettle'],color='blue')","8f2da080":"labels = df_receivable['customerID'].astype('category').cat.categories.tolist()","0559e8e3":"replace_map_comp = {'customerID' : {k: v for k,v in zip(labels,list(range(1,len(labels)+1)))}}","6428727d":"#replace the customerID with Integers\ndf_receivable.replace(replace_map_comp, inplace=True)","522e737d":"df_receivable.head(3)","19b61f40":"df_receivable.head(3)","ff129122":"corremat = df_receivable.corr()\nplt.figure(figsize=(10,10))\ng= sns.heatmap(df_receivable.corr(),annot=True,cmap='viridis',linewidths=.5)","54294012":"corremat","1698dffa":"corremat.columns\n","168ab02d":"cat_feats = ['InvoiceAmount_bin']\nfinal_data = pd.get_dummies(df_receivable,columns=cat_feats,drop_first=True)","3a6768b3":"final_data.head(3)","69b4973a":"features=['countryCode', 'customerID', 'InvoiceAmount',\n       'Disputed', 'PaperlessBill','repeatCust','Late', 'DaysToSettle',\n       'countlate']","df040bec":"features","995abeda":"X = final_data[features]\ny = final_data['DaysLate']","d910a2f1":"y.head(5)","16369d4b":"X_train,X_test,y_train,y_test = train_test_split(X,y,random_state=0)","c80b3f2b":"linear=LinearRegression()","2d023e78":"linear.fit(X_train,y_train)","457fa367":"# linear Regression\n\ny_pred1 = linear.predict(X_test)","a81e1644":"#Checking the accuracy\nlinear_accuracy = round(linear.score(X_train,y_train)*100,2)\nprint(round(linear_accuracy,2),'%')","87f3d147":"from sklearn.metrics import mean_squared_error\n\nmean_squared_error(y_test,y_pred)","efb909da":"GBR_model = GradientBoostingRegressor(n_estimators=100, max_depth=4)","1be513f8":"#Fit\nGBR_model.fit(X_train, y_train)","136ba6a1":"y_pred2 = GBR_model.predict(X_test)","ea6de770":"#Checking the accuracy\nGBR_model_accuracy = round(GBR_model.score(X_train,y_train)*100,2)\nprint(round(GBR_model_accuracy,2),'%')","edea39af":"mean_squared_error(y_test,y_pred2)","20643a25":"random_model = RandomForestRegressor(n_estimators=1000)","2fddb9ca":"#Fit\nrandom_model.fit(X_train, y_train)","a8378d31":"y_pred3 = random_model.predict(X_test)","bc295af5":"#Checking the accuracy\nrandom_model_accuracy = round(random_model.score(X_train,y_train)*100,2)\nprint(round(random_model_accuracy,2),'%')","771d17f7":"from sklearn.metrics import mean_squared_error\n\nmean_squared_error(y_test,y_pred3)","f60cb426":"y = pd.concat([y_test,pd.DataFrame(y_pred2)],axis=1)\ny.columns = ('act','pred')\n\ndef act_decile (x):\n    if x == 0: return \"a. 0\"\n    elif x <= 2: return \"b. (0-2] days\"\n    elif x <= 4: return \"b. (2-4] days\"\n    elif x <= 6: return \"c. (4-6] days\"\n    elif x <= 8: return \"c. (6-8] days\"\n    elif x <= 10: return \"c. (8-10] days\"\n    else: return \"d. more (10-) days\"\ny['act_bin'] = y['act'].apply(act_decile)\n\ntemp = pd.DataFrame(y.groupby(['act_bin'], axis=0, as_index=False)['act','pred'].mean())\ntemp.index = temp['act_bin']\ntemp.plot(marker='o',figsize=(12,6))","6b4a6eb3":"#### Get the Data","f87715fa":"Count of categorical features","faa36bee":"Check for relation to late with  other variable to","b255f38b":"\nFinally, label customers with integers for processing in models","9e1baaed":"\n## Train a Model to Predict if a Payment will be late","624ed299":"generate one more variable 'Late' using another varable called 'DaysLate'","55084dce":"Checking for the customer who is late to pay","b2fdb7e7":"The ideal value for Mean squared error is zero.GBR model is giving high accuracy.","f7e3341b":"**Context**:\n\nThe biggest challenge of Factoring is to predict if and when invoices will be paid. The factor provides funds against this future payment to the business by buying their invoice. The factor then collects the payment and charges their interest rate. If the invoice isn't paid, the factor loses their advanced funds. Try using this data set for predicting when payments will be made.**","707ddeb5":"Generate a rolling count of the amount of late payments for each customer","9cb3c7a4":"**\nGenerate more features and map the some of the categorical variables to integers**<br>\nMap some of the categorical variables to integers. It is also helpful to generate some more insights about a customer given the data. For example if the order occurs at the end of the year is a company more likely to pay on time?","21be6d13":"Identified that country code 818 has maxiimum lateday and minimum late days for 391.<br>\nCheck the details of categorical features","0ef06f76":"Accounts Receivable\nUnderstand the factors of successful collection efforts. You can Predict which customers will pay fastest and recover more money and improve collections efficiency.","2984b438":"\n### Distributions of Invoice Amounts and Days to settle\nIt may be useful to understand the distribution of some variables. This can be helpful if we wish to know within reasonable assumptions what our confidence intervals are for payments or how long it takes for a customer to settle."}}