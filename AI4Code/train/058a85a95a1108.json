{"cell_type":{"2d3f4199":"code","5a4c96ad":"code","04639da9":"code","80421a50":"code","da312d37":"code","a4b4cc28":"code","53ca8887":"code","4c3408d7":"code","ef05a274":"code","696430ce":"code","a8501f23":"code","fe4c5e05":"code","237d8b31":"code","a8c6d074":"code","bda586bb":"code","485ce1e0":"code","d566452a":"code","5cb5bcb6":"code","2271aa83":"code","ab8bd0a4":"code","cd44fd82":"code","dba43eeb":"code","a0295ae2":"code","d28e3fbc":"code","f65e7adf":"code","c3850d3b":"code","41ccd0a2":"code","b7923687":"code","8dc8aa9f":"code","5ba07f83":"markdown","b49ab95a":"markdown","7306d257":"markdown","ded16590":"markdown","e219188c":"markdown","a2773fe8":"markdown","02be095c":"markdown","95d5454a":"markdown","6bf408f6":"markdown","9356d843":"markdown","9289bd42":"markdown","3744015c":"markdown","f18ad5e9":"markdown","1c90f2c5":"markdown"},"source":{"2d3f4199":"%%time\nimport pandas as pd\n","5a4c96ad":"import  lightgbm as lgb","04639da9":"%%time\nimport os\nprint(os.listdir(\"..\/input\"))\ndf_train = pd.read_csv('..\/input\/train.csv')\ndf_test = pd.read_csv('..\/input\/test.csv')\ncombine = [df_train, df_test]","80421a50":"print(df_train.head(3))\nprint(df_test.head(3))","da312d37":"# Define column date as datatype date and define new date features\nfor dataset in combine:\n    dataset['date'] = pd.to_datetime(dataset['date'])\n    dataset['year'] = dataset.date.dt.year\n    dataset['month'] = dataset.date.dt.month\n    dataset['day'] = dataset.date.dt.day\n    dataset['dayofyear'] = dataset.date.dt.dayofyear\n    dataset['dayofweek'] = dataset.date.dt.dayofweek\n    dataset['weekofyear'] = dataset.date.dt.weekofyear","a4b4cc28":"dataset.drop('date', axis=1, inplace=True)","53ca8887":"df_train.head()","4c3408d7":"df_train['daily_avg']=df_train.groupby(['item','store','dayofweek'])['sales'].transform('mean')\ndf_train['monthly_avg']=df_train.groupby(['item','store','month'])['sales'].transform('mean')","ef05a274":"daily_avg=df_train.groupby(['item','store','dayofweek'])['sales'].mean().reset_index()\nmonthly_avg=df_train.groupby(['item','store','month'])['sales'].mean().reset_index()\n","696430ce":"monthly_avg","a8501f23":"def merge(x,y,col,col_name):\n    x =pd.merge(x, y, how='left', on=None, left_on=col, right_on=col,\n            left_index=False, right_index=False, sort=True,\n             copy=True, indicator=False,validate=None)\n    \n    x=x.rename(columns={'sales':col_name})\n    return x\n\ndf_test=merge(df_test, daily_avg,['item','store','dayofweek'],'daily_avg')\ndf_test=merge(df_test, monthly_avg,['item','store','month'],'monthly_avg')\n","fe4c5e05":"print(df_test.columns)\nprint(df_train.columns)","237d8b31":"\ndf_test=df_test.drop(['id'],axis=1)\ndf_train=df_train.drop(['date'],axis=1)","a8c6d074":"df_test.columns","bda586bb":"df_train.shape","485ce1e0":"df_test.shape","d566452a":"df_train.head(2)","5cb5bcb6":"df_test.head(2)","2271aa83":"df_train.isnull().sum()","ab8bd0a4":"df_test.isnull().sum()","cd44fd82":"df_train.dtypes","dba43eeb":"df_test.dtypes","a0295ae2":"#setting parameters for lightgbm\nparam = {'num_leaves':150, 'max_depth':7,'learning_rate':.05,'max_bin':200}\nparam['metric'] = ['auc', 'binary_logloss']","d28e3fbc":"y=pd.DataFrame()\ny=df_train['sales']\n","f65e7adf":"df_train=df_train.drop(['sales'],axis=1)","c3850d3b":"x=df_train\n","41ccd0a2":"%%time\ntrain_data = lgb.Dataset(x,y)\nmodel =lgb.train(param,train_data,)","b7923687":"%%time\noutput=model.predict(df_test)\nresult=pd.DataFrame(output)\nresult","8dc8aa9f":"%%time\ntest=pd.read_csv('..\/input\/test.csv',usecols=['id'])\nfin=pd.DataFrame(test)\nfin['sales']=result\nfin.to_csv('Sales_Lgm.csv',index=False)\n ","5ba07f83":"### Modelling  ","b49ab95a":"#### Dropping columns","7306d257":"#### INPUT size","ded16590":"### Checking datatypes","e219188c":"#### Define column date as datatype date and define new date features","a2773fe8":"### Merging new features","02be095c":"### Add new features daily aveage sales and monthly average sales","95d5454a":"### Loading libraries","6bf408f6":"### Submission","9356d843":"#### Displaying head of training and testing","9289bd42":"### Checking for missing  values","3744015c":"#### Reading test and train data","f18ad5e9":"#### Dropping date column","1c90f2c5":"#### Displaying columns in train and testing "}}