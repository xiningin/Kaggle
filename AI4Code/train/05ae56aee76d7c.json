{"cell_type":{"24f2a989":"code","f80e8fdf":"code","ea039f58":"code","20164b9b":"code","b44131ca":"code","6f859ae8":"code","bd9cc6ca":"code","f644ec2b":"code","5fb5e168":"code","23a33540":"code","ffcc2662":"code","6b0bd8fc":"code","09c50316":"code","03973047":"code","6b75c97b":"code","f0ca692e":"code","12525935":"code","a784e732":"code","dfc0ab90":"code","7a053525":"code","8db55f9a":"code","742db920":"code","fc43a110":"code","dcd576a4":"code","d83cd8f3":"code","8406097d":"code","f473d18d":"code","b0b4cae7":"markdown","b70cc509":"markdown","bb7d9b70":"markdown","a0188823":"markdown","2b1997c7":"markdown","8c4e11af":"markdown","9bf7e872":"markdown","1932b31b":"markdown","1538f442":"markdown"},"source":{"24f2a989":"%reload_ext autoreload\n%autoreload 2\n%matplotlib inline","f80e8fdf":"!pip install spacy==3.1.1","ea039f58":"#!yes Y|conda install -c fastai fastai=2.4.1\n!pip install fastai==2.4.1","20164b9b":"from pandas.core.frame import DataFrame\nfrom fastai.vision.all import *","b44131ca":"path = Path(\"..\/input\")","6f859ae8":"def getfiles(path: Path, ext):\n    \"Get numpy files in `path` recursively, only in `folders`, if specified.\"\n    return L(path.glob(f'**\/*.{ext}'))","bd9cc6ca":"%%time\nfiles = getfiles(path\/'g2net-train-images-with-gpwy-sample', 'png')","f644ec2b":"len(files)","5fb5e168":"files[-1]","23a33540":"files[-1].name.replace(\".png\", \"\")","ffcc2662":"df = pd.read_csv(path\/'g2net-gravitational-wave-detection\/training_labels.csv')","6b0bd8fc":"df.head(1)","09c50316":"filtered_df = df.loc[df.id. isin([f.name.replace(\".png\", \"\") for f in files])]","03973047":"filtered_df.head(1)","6b75c97b":"filtered_df.shape","f0ca692e":"sample = filtered_df[:20000]","12525935":"train_path = path\/'g2net-train-images-with-gpwy-sample\/kaggle\/tmp\/train'\n\nds = DataBlock(blocks=(ImageBlock, CategoryBlock),\n                get_x=ColReader('id', pref=train_path, suff='.png'),\n                splitter=TrainTestSplitter(),\n                get_y=ColReader('target'),\n                item_tfms=Resize(460),\n                batch_tfms=aug_transforms(size=224, flip_vert=True,\n                                          max_lighting=0.1, max_zoom=1.05, \n                                          max_warp=0.))","a784e732":"ds.summary(filtered_df)","dfc0ab90":"dls = ds.dataloaders(filtered_df, bs=256)","7a053525":"dls.show_batch()","8db55f9a":"learn = cnn_learner(dls, resnet34,\n                    loss_func=CrossEntropyLossFlat(), metrics=[RocAucBinary(axis=0)]).to_fp16()","742db920":"def show_me_lrs(learn):\n    suggestions = namedtuple('Suggestions', [\"min\", \"steep\",\n                                            \"valley\", \"slide\"])\n    lr_min, lr_steep,lr_valley, lr_slide = learn.lr_find(suggest_funcs=(minimum, steep,valley, slide))\n    suggested_lrs = suggestions(lr_min, lr_steep, lr_valley, lr_slide)\n    \n    print(f\"Minimum\/10:\\t{lr_min:.2e}\\\n          \\nSteepest point:\\t{lr_steep:.2e}\\\n          \\nLongest valley:\\t{lr_valley:.2e}\\\n          \\nSlide interval:\\t{lr_slide:.2e}\")\n    \n    return suggested_lrs","fc43a110":"learn.fit_one_cycle(2, 3e-3)","dcd576a4":"suggested_lrs = show_me_lrs(learn)","d83cd8f3":"learn.unfreeze()\nlearn.fit_one_cycle(5, lr_max=slice(suggested_lrs.slide\/10, suggested_lrs.slide))","8406097d":"learn.recorder.plot_loss()","f473d18d":"learn.export(\".\/final\")","b0b4cae7":"## Save trained model","b70cc509":"## How does a simple model like resnet would perform?","bb7d9b70":"## getfiles(path: Path, ext)","a0188823":"## The Learner","2b1997c7":"## Get labels","8c4e11af":"## Get the files","9bf7e872":"## Creating the dataloader","1932b31b":"## What is this?\nAttempt ot create a baseline model with data from [here](https:\/\/www.kaggle.com\/thedrcat\/g2net-train-images-with-gpwy-sample\/)\nand [here](https:\/\/www.kaggle.com\/thedrcat\/g2net-test-imgs-with-gwpy\/) ","1538f442":"## Train"}}