{"cell_type":{"71579a8c":"code","c93b82df":"code","ec22afbf":"code","a720c0c5":"code","90fb3e7a":"code","6fdc8fd5":"code","dfbb58c3":"code","f43377fa":"code","a85f5c59":"code","31d2d182":"code","c795b112":"code","f5794d75":"code","cab3c93c":"code","bb8394e7":"code","e98ddc72":"code","e1495c91":"code","6c8e4da5":"code","7129e581":"code","dd602415":"code","65d515b1":"code","9ab219dd":"code","7bc50417":"code","28bc85e2":"code","e9c9c70e":"code","f849945b":"markdown","0b02e214":"markdown","54dbce04":"markdown","6f947563":"markdown","60320b17":"markdown"},"source":{"71579a8c":"# Import all libraries\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt # ploting the data\nimport seaborn as sns # ploting the data\nimport math # calculation","c93b82df":"file = '\/kaggle\/input\/epa-air-quality\/air_status.csv'\ndf = pd.read_csv(file)\n\n# Visualize data info\ndf.info()","ec22afbf":"# Determine the number of missing values for every column\ndf.isnull().sum()","a720c0c5":"#examine the dataset\ndf.describe()","90fb3e7a":"df","6fdc8fd5":"# Target variable distribution\n# sns.distplot(df['NHNO3'])\nsns.distplot(df['TOTAL_NO3'])","dfbb58c3":"# Target according to sites\n# see https:\/\/stackoverflow.com\/questions\/54132989\/is-there-a-way-to-change-the-color-and-shape-indicating-the-mean-in-a-seaborn-bo\n\nx='SITE_ID'\n#y='NHNO3'\ny='TOTAL_NO3'\n\nsns.boxplot(x=x, y=y, data=df, notch=True, showmeans=True,\n           meanprops={\"marker\":\"s\",\"markerfacecolor\":\"white\", \"markeredgecolor\":\"black\"});","f43377fa":"# See https:\/\/stackoverflow.com\/questions\/36018681\/stop-seaborn-plotting-multiple-figures-on-top-of-one-another\nfor x in ['TSO4', 'TNO3', 'TNH4', 'Ca', 'Mg', 'Na', 'K', 'Cl', 'NSO4', 'WSO2', 'TOTAL_SO2', 'TOTAL_NO3', 'FLOW_VOLUME', 'VALID_HOURS']:\n  plt.figure()\n  sns.distplot(df[x]);","a85f5c59":"# Correlation\nplt.figure(figsize=(20,10))\ntitle = 'Correlation matrix of numerical variables'\nsns.heatmap(df.corr(), square=True, cmap='RdYlGn')\nplt.title(title)\nplt.ioff()","31d2d182":"df['Date'] =  pd.to_datetime(df['DATEON'])\ndf.dtypes","c795b112":"# Time Serie analysis of NO3\n# See https:\/\/stackoverflow.com\/questions\/56150437\/how-to-plot-a-time-series-graph-using-seaborn-or-plotly\n\nx='Date'\ny='TOTAL_NO3'\n\nplt.figure(figsize=(40,20))\nsns.lineplot(x=x, y=y, hue='SITE_ID' ,data=df);\nplt.xticks(rotation=30);\nplt.show()","f5794d75":"df_codes = df['COMMENT_CODES']\ndf_codes.dropna()","cab3c93c":"# See https:\/\/www.kaggle.com\/dfitzgerald3\/randomforestregressor\n\n# Select features\n# From our EDA the following features seems the most useful to predict the toal NO3 for each site\nselected_features = ['TOTAL_NO3', 'SITE_ID', 'DATEON', 'TSO4', 'TNH4', \n                     'Ca', 'Mg', 'Na', 'K', 'Cl', 'NSO4', 'WSO2', 'TOTAL_SO2', \n                     'FLOW_VOLUME', 'TEMP_SOURCE']\n\ndf_selected = df[selected_features]","bb8394e7":"# Recode data as categorical\n# https:\/\/pbpython.com\/categorical-encoding.html\n# https:\/\/towardsdatascience.com\/categorical-encoding-techniques-93ebd18e1f24\n\ndf_selected = pd.get_dummies(df_selected, drop_first=True)","e98ddc72":"# Replace missing values\n# Ca, Mg, Na, K, Cl missing values\n# Assumption here is that this correspond to measure faillure as fore NO3\n# So I will use the average values when values are missing\n# See https:\/\/stackoverflow.com\/questions\/18689823\/pandas-dataframe-replace-nan-values-with-average-of-columns\n# Is is important to avaoid leaking information from train to test dataset. \n\nfrom sklearn.model_selection import train_test_split\ntrain, test = train_test_split(df_selected, test_size = 0.25, random_state = 0)","e1495c91":"# See https:\/\/stackoverflow.com\/questions\/45090639\/pandas-shows-settingwithcopywarning-after-train-test-split\n\npd.options.mode.chained_assignment = None\nfor feature in ['Ca', 'Mg', 'Na', 'K', 'Cl']:\n  train[feature].fillna((train[feature].mean()), inplace=True)\n  test[feature].fillna((test[feature].mean()), inplace=True)","6c8e4da5":"train.isnull().sum()","7129e581":"test.isnull().sum()","dd602415":"# Split the dataset features and target\nX_train = train.drop('TOTAL_NO3', axis=1).values\nX_test = test.drop('TOTAL_NO3', axis=1).values\ny_train = train['TOTAL_NO3'].values\ny_test = test['TOTAL_NO3'].values","65d515b1":"# See https:\/\/www.kaggle.com\/dfitzgerald3\/randomforestregressor\n\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.preprocessing import Normalizer","9ab219dd":"# See https:\/\/www.kaggle.com\/dfitzgerald3\/randomforestregressor\nclf = RandomForestRegressor(n_estimators=500, n_jobs=-1)\n\nclf.fit(X_train, y_train)\ny_pred = clf.predict(X_test)","7bc50417":"# Model evaluation R^2 score\n# See https:\/\/scikit-learn.org\/stable\/modules\/generated\/sklearn.ensemble.RandomForestRegressor.html\n# see https:\/\/www.kaggle.com\/nsrose7224\/random-forest-regressor-accuracy-0-91\n# See https:\/\/scikit-learn.org\/stable\/modules\/generated\/sklearn.ensemble.RandomForestRegressor.html\n\nclf.score(X_train, y_train)","28bc85e2":"clf.score(X_test, y_test)","e9c9c70e":"# Compute MSE score\nfrom sklearn.metrics import mean_squared_error\nmean_squared_error(y_test, y_pred)","f849945b":"# Introduction\n\nDataScienceGO Virtual 2020 challenge:\n\nLink to the dataset: [DSGO-Virtual-Oracle-Hackathon](https:\/\/github.com\/dsgovirtual\/DSGO-Virtual-Oracle-Hackathon\/tree\/main\/Data)\n\n3 Different Paths\n\n* Exploratory Analysis: Understand the data, gather insights and focus on an in-depth analysis of the relationships between the measures, the effects over time or between sites.\n\n* Visualization: Create a visualization that communicates a message about what is happening with the air quality. The visualization can be a figure, set of figures, animation or interactive graphic.\n\n* Model: EPA has identified that the total nitrate (NO3) is a metric that they are interested in studying and predictive model that will allow them to estimate the nitrate values when they are missing","0b02e214":"# Model\n\nRandom forest regressor is a simple model that can easily accommodate data, categorical and numerical variables. It should be a reasonable baseline model. \n","54dbce04":"# EDA and Data Wrangling","6f947563":"# Initialization","60320b17":"# Data Visualization"}}