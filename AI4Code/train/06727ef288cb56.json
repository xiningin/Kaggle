{"cell_type":{"94a450fd":"code","2508c93a":"code","eaf412a9":"code","3a06d27b":"code","caf36530":"code","790320a0":"code","912be004":"code","b0b8a312":"code","9c2ec571":"code","33e6eb79":"code","8dabeade":"code","7b71631d":"code","4fe2883c":"code","67694fbd":"code","b6d1baa5":"code","8bb01290":"code","ca1c12dc":"code","31e58ce3":"code","89f41b67":"code","b1a5715e":"code","bddade3f":"code","dbb84dcb":"code","7026a112":"code","ec253191":"code","fe637bcd":"markdown","20dd1027":"markdown","37696f47":"markdown","764fa0c1":"markdown","f0646499":"markdown","8214e6d0":"markdown","74ba8c4e":"markdown","9be75802":"markdown","d59017a7":"markdown","28875ca8":"markdown","97f8b6cd":"markdown","02c95f5d":"markdown","560e0150":"markdown","5507f525":"markdown","b533a298":"markdown"},"source":{"94a450fd":"import os\nimport cv2\nimport numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\nfrom tensorflow.keras.models import Model\nfrom tensorflow.keras.optimizers import Adam\nfrom tensorflow.keras.layers import Dropout, Dense\nfrom tensorflow.keras.applications import MobileNetV2","2508c93a":"#Displaying directory files\nos.listdir('\/kaggle\/input\/lego-minifigures-classification\/')","eaf412a9":"#Initializing variable with path to dataset\ndataPath = '..\/input\/lego-minifigures-classification\/'","3a06d27b":"#Reading image -> Resizing to (512x512) -> Converting to RGB -> Normalizing pixel values\n\nimage = cv2.imread('..\/input\/lego-minifigures-classification\/harry-potter\/0002\/009.jpg')\nimage = cv2.resize(image, (512,512))\nimage = cv2.cvtColor(image, cv2.COLOR_BGR2RGB) \/ 255.0\n\nplt.imshow(image)","caf36530":"#Reading index.csv dataframe\nindex_df = pd.read_csv(dataPath + 'index.csv')\nindex_df","790320a0":"#Reading metadata.csv dataframe\nmeta_df = pd.read_csv(dataPath + 'metadata.csv')\nmeta_df","912be004":"#Merging index and metadata on class_id feature\ndata_df = pd.merge(index_df, meta_df[['class_id', 'minifigure_name']], on='class_id')\ndata_df","b0b8a312":"#Displaying overall information\ndata_df.info()","9c2ec571":"#Looking for missing data in dataframe\nprint(\"Missing Data:\",data_df.isnull().any().any())\ndata_df.isnull().sum()","33e6eb79":"#Keeping count of number of each minifigure\nlabels = data_df['minifigure_name'].unique()\ncount = data_df['minifigure_name'].value_counts()\n\ncount","8dabeade":"#Visualizing quantity of each minifugure in dataset\nimport seaborn as sns\n\nplt.figure(figsize=(12,10))\nsns.barplot(x=labels, y=count,palette=\"rocket\")\n\nplt.xticks(rotation= 90)\nplt.xlabel('Labels')\nplt.ylabel('Count')\nplt.title('Dataset Analysis')\nplt.show()","7b71631d":"#Splitting and creating a training and validation dataframe \ntraining = data_df[data_df[\"train-valid\"] == 'train']\nvalidation = data_df[data_df[\"train-valid\"] == 'valid']","4fe2883c":"#Viewing our prepared dataframes for training and validation\ntraining, validation","67694fbd":"#Evaluating total number of classes\nCLASSES = len(data_df['class_id'].unique())\nCLASSES","b6d1baa5":"#Training Data Preprocessing\n\ntrainData = np.zeros((training.shape[0], 512, 512, 3))\n\nfor i in range(training.shape[0]):\n    \n    image = cv2.imread('..\/input\/lego-minifigures-classification\/' + training[\"path\"].values[i])\n    \n    #Converting BGR to RGB \n    image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n    \n    #Resizing image to (512 x 512)\n    image = cv2.resize(image, (512,512))\n    \n    #Normalizing pixel values to [0,1]\n    trainData[i] = image \/ 255.0\n\ntrainLabel = np.array(training[\"class_id\"])-1","8bb01290":"#Validation Data Preprocessing\n\nvalidData = np.zeros((validation.shape[0], 512, 512, 3))\n\nfor i in range(validation.shape[0]):\n    \n    image = cv2.imread('..\/input\/lego-minifigures-classification\/' + validation[\"path\"].values[i])\n    \n    #Converting BGR to RGB \n    image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n    \n    #Resizing image to (512 x 512)\n    image = cv2.resize(image, (512,512))\n    \n    #Normalizing pixel values to [0,1]\n    validData[i] = image \/ 255.0\n\nvalidLabel = np.array(validation[\"class_id\"])-1","ca1c12dc":"#Viewing our prepared numpy arrays of data and labels\ntrainData, trainLabel","31e58ce3":"#Loading Base Model\nbase_model = MobileNetV2()\n\n#Adding Dropout layer\nx = Dropout(0.5)(base_model.layers[-2].output)\n\n#Adding Dense layer\noutputs = Dense(CLASSES, activation='softmax')(x)\n\n#Creating model\nmodel = Model(base_model.inputs, outputs)","89f41b67":"#Displaying model summary\nmodel.summary()","b1a5715e":"model.compile(\n    optimizer=Adam(lr=0.0001),\n    loss='sparse_categorical_crossentropy',\n    metrics=['accuracy']\n)","bddade3f":"#Training model - 30 epochs\nhist = model.fit(\n    trainData, trainLabel,\n    epochs=40,\n    validation_data=(validData, validLabel),\n    shuffle=True,\n    batch_size=4\n)","dbb84dcb":"plt.figure(figsize=(16, 6))\nplt.subplot(1, 2, 1)\nplt.plot(hist.history['loss'], label='train loss')\nplt.plot(hist.history['val_loss'], label='valid loss')\nplt.grid()\nplt.legend()\n\nplt.subplot(1, 2, 2)\nplt.plot(hist.history['accuracy'], label='train acc')\nplt.plot(hist.history['val_accuracy'], label='valid acc')\nplt.grid()\nplt.legend()","7026a112":"testImage = cv2.imread('..\/input\/lego-minifigures-classification\/marvel\/0001\/001.jpg')\ntestImage = cv2.resize(testImage, (512,512))\ntestImage = cv2.cvtColor(testImage, cv2.COLOR_BGR2RGB) \/ 255.0\n\nplt.imshow(testImage)","ec253191":"testImage = np.reshape(testImage, (1, 512, 512, 3))\n\npredictedClass = model.predict(testImage).argmax()\npredictedClass = predictedClass + 1\n\nfigureName = meta_df['minifigure_name'][meta_df['class_id'] == predictedClass].iloc[0]\n\nprint(figureName)","fe637bcd":"## 2. Loading Dataset","20dd1027":"### Visualizing images using OpenCV and Matplotlib","37696f47":"## 5. Compiling Model using Adam Optimizer\n\n* Learning Rate - 0.0001\n* Loss Function - Sparse Categorical Crossentropy\n****","764fa0c1":"## 6. Training Model - 30 Epochs","f0646499":"* Reshaping and converting image data to numpy array\n* Prediciting on data \n* Displaying class name and minifigure name based on prediciton","8214e6d0":"## 8. Validation\n\n* Loading test image from dataset\n* Preprocessing data - Resizing, Converting Format and Normalizing for input to trained model\n* Displaying test image ","74ba8c4e":"**We'll be preparing our image data for input to the Neural Network model.**\n\n* Creating numpy arrays for Train and Valid Data - Labels\n* Reading each image from training and validation dataframes using the 'path' feature\n* Converting image format to RGB from BGR\n* Resizing image to (512 x 512) \n* Normalizing pixel values between [0, 1] for each image\n* Appending data and labels to train and valid numpy arrays","9be75802":"# Lego Minifigure Classification - Transfer Learning using MobileNetV2\n\n![Lego](https:\/\/i.pinimg.com\/originals\/35\/b7\/0e\/35b70e342fc3ad6e4d78f46febc05ebb.jpg)\n\n","d59017a7":"## We'll be going through the following steps from loading and preparing our data to training our model and finally validating our results.\n\n1. Importing Libraries\n\n2. Loading Dataset - Exploratory Data Analysis\n\n3. Data Preprocessing\n\n4. Loading Base Model for Transfer Learning \n\n5. Compiling Model\n\n6. Training Model\n\n7. Visualizing Model Accuracy and Loss\n\n8. Validation","28875ca8":"## 4. Loading Base Model for Transfer Learning","97f8b6cd":"## 1. Importing Libraries ","02c95f5d":"* We will be taking advantage of Transfer Learning provided under the [tensorflow.keras.applications library](https:\/\/keras.io\/guides\/transfer_learning)\n* Using pretrained model weights of [MobileNetV2](https:\/\/keras.io\/api\/applications\/mobilenet)\n* Loading MobileNetV2 as 'base_model'\n* Defining last two layers of MobileNetV2 as our trainable layers\n* Adding Droupout Layer of (0.5) - 50% neurons are dropped to prevent overfitting on data\n* Adding Dense Layer with number of CLASSES with a 'softmax' function\n* Creating Model with base model as inputs","560e0150":"## 7. Visualizing Model Performance\n\n* Plot 1 - Visualizing based on Model Loss \n* Plot 2 - Visualizing based on Model Accuracy","5507f525":"### Exploratory Data Analysis","b533a298":"## 3. Data Preprocessing"}}