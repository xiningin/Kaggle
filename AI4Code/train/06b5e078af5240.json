{"cell_type":{"3e412d50":"code","f4724a6a":"code","bf36bab1":"code","f7b0562c":"code","1abde108":"code","48d8b5c0":"code","0a9c669f":"code","8c4529bd":"code","0a4739fa":"code","12ffb3d9":"code","166ce1c2":"code","df43307d":"code","2fd81b68":"code","4a5b90e7":"code","8b04eb55":"code","fac9245b":"code","d8ebfbfb":"markdown","c87b52ce":"markdown","cfd4a198":"markdown","f1ad1cde":"markdown","d15ff404":"markdown","8d72a29e":"markdown","84f7ce03":"markdown","1ae90b1e":"markdown","dfa65d41":"markdown","99eb953d":"markdown","082f6f16":"markdown","f62f0428":"markdown","3516ad3f":"markdown","301df610":"markdown","d87d69e9":"markdown","e1669dfb":"markdown","0c7912f3":"markdown","e926c74c":"markdown","5dfcd296":"markdown","570bd458":"markdown","f7a61532":"markdown"},"source":{"3e412d50":"# data analysis, wrangling and preprocessing\nimport numpy as np \nimport pandas as pd\nimport datetime\n\n# data visualization\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nplt.style.use('fivethirtyeight') # change the style of the plot\n\n# missing data interpolation\nfrom scipy.interpolate import CubicSpline","f4724a6a":"energy = pd.read_csv('..\/input\/energy-consumption-generation-prices-and-weather\/energy_dataset.csv')\nenergy.head()","bf36bab1":"energy.info()","f7b0562c":"dropList = ['generation hydro pumped storage aggregated', 'forecast wind offshore eday ahead',\n'total load forecast','forecast solar day ahead','forecast wind onshore day ahead',\n'price day ahead']\nenergy.drop(dropList, axis=1, inplace=True)","1abde108":"energy.isnull().mean()","48d8b5c0":"energy.rename(columns=lambda x: x[11:] if 'generation' in x else x, inplace=True)\nenergy.rename(columns={'total load actual':'energy demand'}, inplace=True)","0a9c669f":"energy['time'] = pd.to_datetime(energy['time'], utc=True)\nenergy['Year-Month'] = pd.to_datetime(energy['time'].dt.strftime('%Y-%m-01')).dt.date","8c4529bd":"energy[energy.isna().any(axis=1)]","0a4739fa":"sns.swarmplot(x='time', data=energy[energy.isna().any(axis=1)])\nplt.xticks(rotation=45)\nplt.title('NaN values across time')","12ffb3d9":"energy[energy.isna().any(axis=1)].groupby('Year-Month')['time'].count()","166ce1c2":"fossil_fuel = ['fossil brown coal\/lignite', 'fossil gas',\n       'fossil hard coal', 'fossil oil']\nhydro = ['hydro pumped storage consumption',\n       'hydro run-of-river and poundage',\n       'hydro water reservoir']\nwind = ['wind onshore']\nothers = ['other', 'other renewable'] \nenergy['fossil_fuel'] = energy.loc[:, fossil_fuel].sum(axis=1)\nenergy['hydro'] = energy.loc[:, hydro].sum(axis=1)\nenergy['wind'] = energy.loc[:, wind].sum(axis=1)\nenergy['others'] = energy.loc[:, others].sum(axis=1)","df43307d":"energy_list = ['biomass','fossil_fuel','hydro','wind','solar','nuclear','waste','others']\nenergy_flat = pd.melt(energy, id_vars='Year-Month', value_vars=energy_list)\ntmp = energy_flat.loc[energy_flat.value == 0]\ntmp.sort_values(by='Year-Month', inplace=True)\nsns.swarmplot(x='Year-Month', y='variable', data=tmp)\nplt.title('NaN Across Time Group By Energy Source')\nplt.ylabel('Energy Sources')\nplt.xlabel('Time (Year-Month)')\nplt.xticks(rotation=45)","2fd81b68":"energy[energy_list] = energy[energy_list].replace(['0', 0], np.nan)","4a5b90e7":"def interpolation(column_list, energy):\n    for column in column_list:\n        index_list = energy[energy[column].isna()].index\n        for index in index_list:\n            lb = index - 10\n            up = index + 10\n            if ((energy.iloc[lb:up][column].isna()).sum() > 1):\n                temp = energy.iloc[lb:up][column]\n                indices = temp[temp.isna()].index\n                temp = temp.interpolate(method='quadratic', order=4)\n                for index in indices:\n                    energy.loc[index, column] = temp.loc[index]\n            else:\n                lb = index - 2\n                up = index + 2\n                temp = energy.iloc[lb: up][column]\n                temp = temp[~temp.isna()]\n                X = temp.index.values\n                y = temp.values\n                cs = CubicSpline(X , y)\n                energy.loc[index, column] = cs(index).item(0)","8b04eb55":"interpolation(energy_list, energy)","fac9245b":"energy.loc[:,energy_list].isna().sum() + energy.loc[:,energy_list][energy.loc[:,energy_list] == 0].sum()","d8ebfbfb":"#### Find pattern for zero value entry  \nWe want to see if any zero values in this dataset are meaningful. If not, they can be treated as missing values (NaN) and interpolate together with other NaN values. ","c87b52ce":"#### Rename columns\nWe drop the unnecessary text in the column names and rename `total load actual` to `energy demand`.","cfd4a198":"### Loading data \nWe start by loading the dataset into Pandas DataFrames.","f1ad1cde":"As we can see in the timeline of the events and frenquency of NaN values by month table above, they scattered around since the data are being recorded. There are several clusters early on, such as the one around January 2015 and May 2015. There are fewer and fewer records recently. It is possible that the instruments were being set up to measure those energy generation data early on, They have a more healthy infrastructure in place to collect necessary data.","d15ff404":"## Spain Energy Analysis \nTo make the successful transition to renewable energy, forecasting is commonly used in the energy markets to understand energy demand as well as energy generation under certain weather or seasonal trend. The use of machine learning on time series datasets is highly leveraged to understand these dynamics. \n\nThis analysis aims to practice data preprocessing, implement algorithms on time-series datasets, and evaluate models using different metrics. This notebook prepares the dataset for further analysis. It presents the process of exploring the energy dataset and interpolates possible missing values. ","8d72a29e":"<a style='text-decoration:none;line-height:16px;display:flex;color:#5B5B62;padding:10px;justify-content:end;' href='https:\/\/deepnote.com?utm_source=created-in-deepnote-cell&projectId=0623ba08-1bf2-4899-8295-01976760b872' target=\"_blank\">\n<img alt='Created in deepnote.com' style='display:inline;max-height:16px;margin:0px;margin-right:7.5px;' src='data:image\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iODBweCIgaGVpZ2h0PSI4MHB4IiB2aWV3Qm94PSIwIDAgODAgODAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDU0LjEgKDc2NDkwKSAtIGh0dHBzOi8vc2tldGNoYXBwLmNvbSAtLT4KICAgIDx0aXRsZT5Hcm91cCAzPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9IkxhbmRpbmciIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSJBcnRib2FyZCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEyMzUuMDAwMDAwLCAtNzkuMDAwMDAwKSI+CiAgICAgICAgICAgIDxnIGlkPSJHcm91cC0zIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjM1LjAwMDAwMCwgNzkuMDAwMDAwKSI+CiAgICAgICAgICAgICAgICA8cG9seWdvbiBpZD0iUGF0aC0yMCIgZmlsbD0iIzAyNjVCNCIgcG9pbnRzPSIyLjM3NjIzNzYyIDgwIDM4LjA0NzY2NjcgODAgNTcuODIxNzgyMiA3My44MDU3NTkyIDU3LjgyMTc4MjIgMzIuNzU5MjczOSAzOS4xNDAyMjc4IDMxLjY4MzE2ODMiPjwvcG9seWdvbj4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0zNS4wMDc3MTgsODAgQzQyLjkwNjIwMDcsNzYuNDU0OTM1OCA0Ny41NjQ5MTY3LDcxLjU0MjI2NzEgNDguOTgzODY2LDY1LjI2MTk5MzkgQzUxLjExMjI4OTksNTUuODQxNTg0MiA0MS42NzcxNzk1LDQ5LjIxMjIyODQgMjUuNjIzOTg0Niw0OS4yMTIyMjg0IEMyNS40ODQ5Mjg5LDQ5LjEyNjg0NDggMjkuODI2MTI5Niw0My4yODM4MjQ4IDM4LjY0NzU4NjksMzEuNjgzMTY4MyBMNzIuODcxMjg3MSwzMi41NTQ0MjUgTDY1LjI4MDk3Myw2Ny42NzYzNDIxIEw1MS4xMTIyODk5LDc3LjM3NjE0NCBMMzUuMDA3NzE4LDgwIFoiIGlkPSJQYXRoLTIyIiBmaWxsPSIjMDAyODY4Ij48L3BhdGg+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMCwzNy43MzA0NDA1IEwyNy4xMTQ1MzcsMC4yNTcxMTE0MzYgQzYyLjM3MTUxMjMsLTEuOTkwNzE3MDEgODAsMTAuNTAwMzkyNyA4MCwzNy43MzA0NDA1IEM4MCw2NC45NjA0ODgyIDY0Ljc3NjUwMzgsNzkuMDUwMzQxNCAzNC4zMjk1MTEzLDgwIEM0Ny4wNTUzNDg5LDc3LjU2NzA4MDggNTMuNDE4MjY3Nyw3MC4zMTM2MTAzIDUzLjQxODI2NzcsNTguMjM5NTg4NSBDNTMuNDE4MjY3Nyw0MC4xMjg1NTU3IDM2LjMwMzk1NDQsMzcuNzMwNDQwNSAyNS4yMjc0MTcsMzcuNzMwNDQwNSBDMTcuODQzMDU4NiwzNy43MzA0NDA1IDkuNDMzOTE5NjYsMzcuNzMwNDQwNSAwLDM3LjczMDQ0MDUgWiIgaWQ9IlBhdGgtMTkiIGZpbGw9IiMzNzkzRUYiPjwvcGF0aD4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+' > <\/img>\nCreated in <span style='font-weight:600;margin-left:4px;'>Deepnote<\/span><\/a>","84f7ce03":"Some takeaways from the output above:\n* There are two columns (`generation hydro pumped storage aggregated', 'forecast wind offshore day ahead'`) that don't have any values in them. We will drop these two columns. We will also drop the columns that are not useful to our analysis (`total load forecast`, `forecast solar day ahead`, `forecast wind onshore day ahead`, `price day ahead`).\n* There might be some missing values for some of the columns. We will try to check the missing rate and decide how to deal with them.\n* We will rename the column names because the names of the columns are long and not necessary.","1ae90b1e":"We want to make sure there are no NaN or zero values in the `energy` dataframe before going into further analysis.","dfa65d41":"Using the `info` function to check if there are any missing values in this dataset and the data type for each column.","99eb953d":"We have aggregated there columns:\n* `biomass`\n* `fossil_fuel`\n* `hydro`\n* `wind`\n* `solar`\n* `nuclear`\n* `waste`\n* `others`\n\nAll of them are in Megawatts(MW).","082f6f16":"### Interpolation\nWe use two different methods to interpolate all the NaN values that we in the `energy` dataset. \n* If there are multiple NaN values in the close span, we use quadratic interpolation with the order of four to account for the movement of the curve. \n* If there is only one NaN value in the close span, we use the CubicSpline method to interpolate that specific NaN value.\n\nWe wrote a function below to automate this process.","f62f0428":"### Missingness analysis\nEven though the missing rate is less than 1% of the time, we still want to see if they all come from a specific period.","3516ad3f":"There is no row with either zero values or NA values after interpolation.\n\nIn the next notebook, we will explore the time series of the major sources of energy generation and the relationships between some of the time series.","301df610":"Call the function `interpolation` and pass in a list of columns that we want to interpolate and the `energy` dataframe.","d87d69e9":"All of the columns that have missing data have a missing rate of less than 1%. We will conduct a missingness analysis to see if those missing values are coming from a specific period of time. ","e1669dfb":"### Consolidate different energy sources\nWe want to consolidate the existing columns into the following columns by summing up the related subcolumns for further analysis. Here is a brief description of each columns:\n* Fossil fuel as `fossil_fuel` (nonrenewable energy formed in the geological past from the remains of living organisms)\n* Energy generated from biomass as `biomass` (renewable energy produced by living or once-living organisms)\n* Energy generated from hydropower as `hydro` (renewable energy generated by fast-running water)\n* Energy generated from nuclear energy as `nuclear` (nonrenewable energy that use a nuclear reaction to produce electricity)\n* Energy generated from wind energy as `wind` (renewable energy that converts kinetic energy in the wind into mechanical power)\n* Energy generated from waste as `waste` (Waste-to-energy plants make steam and electricity)\n* Energy generated from other sources as `others`","0c7912f3":"Find the missing rate for each column","e926c74c":"#### Create different time granularity\nTo explore the dataset further, we create a `Year-Month` column for later aggregation purposes.","5dfcd296":"Drop columns that are uninformative for the analysis","570bd458":"According to the plot above, we can see that zero values coincide between different energy sources. Since they are sparse earlier in time, we can view them as missing values. As a result, we can replace all the zero values with NaN and interpolate them with all the other NaN values. ","f7a61532":"There are only 47 records that contain NaN in the row. We want to plot these 47 records on a timeline and see if there are any clusters."}}