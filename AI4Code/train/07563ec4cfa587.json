{"cell_type":{"9fc26a49":"code","cbbea8ee":"code","13bab8a6":"code","76032753":"code","537bd33b":"code","9f7e389c":"markdown","4733c542":"markdown","fab02b8b":"markdown","28a678ed":"markdown","9bc43b45":"markdown","c5ee47f2":"markdown","e4acdadb":"markdown"},"source":{"9fc26a49":"import torch\nfrom PIL import Image\nimport cv2\nfrom torchvision import transforms\nimport matplotlib.pyplot as plt\nimport time ","cbbea8ee":"if torch.cuda.is_available():\n    input_batch = input_batch.to('cuda')\n    model.to('cuda')","13bab8a6":"model = torch.hub.load('pytorch\/vision:v0.6.0', 'deeplabv3_resnet101', pretrained=True)\nmodel.eval()","76032753":"preprocess = transforms.Compose([\n    transforms.ToTensor(),\n    transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225]),\n])","537bd33b":"video = cv2.VideoCapture(input(\"video file\"))\nwhile(True):    \n    ret, frame = vid.read() \n    input_image = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)\n    input_image = Image.fromarray(input_image)\n    input_tensor = preprocess(input_image)\n    input_batch = input_tensor.unsqueeze(0) \n    \n    with torch.no_grad():\n        output = model(input_batch)['out'][0]\n        \n    output_predictions = output.argmax(0)\n    palette = torch.tensor([2 ** 25 - 1, 2 ** 15 - 1, 2 ** 21 - 1])\n    colors = torch.as_tensor([i for i in range(21)])[:, None] * palette\n    colors = (colors % 255).numpy().astype(\"uint8\")\n    r = Image.fromarray(output_predictions.byte().cpu().numpy()).resize(input_image.size)\n    r.putpalette(colors)\n    \n    r.show()\n    r.close()\n    time.sleep(5)    ","9f7e389c":"<a id = \"2\"><\/a><br>\n\n# Selecting Device","4733c542":"<a id = \"1\"><\/a><br>\n\n# Importing Libraries","fab02b8b":"<font color = 'red'>\nContent: \n\n1. [Importing Libraries](#1)\n1. [Selecting Device](#2)\n1. [Importing Model and Evaluation](#3)\n1. [Transform](#4)\n1. [Video Testing](#5)\n","28a678ed":"<a id = \"5\"><\/a><br>\n\n# Video Testing","9bc43b45":"<a id = \"3\"><\/a><br>\n\n# Importing Model and Evaluation","c5ee47f2":"In this section, we read video with openCV. After that  OpenCV format is transformed to PIL image format. Finally, predict and show images.","e4acdadb":"<a id = \"4\"><\/a><br>\n\n# Transform"}}