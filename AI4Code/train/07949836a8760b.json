{"cell_type":{"bb3b48bb":"code","4a865622":"code","f14f0e96":"code","7914bace":"code","b8351d28":"code","333aad5f":"code","09799746":"code","e6215918":"code","0c4fba03":"code","39614c3e":"markdown"},"source":{"bb3b48bb":"import pandas as pd\nimport glob\n\nimport spacy\nfrom tqdm import tqdm\nfrom collections import Counter\nimport seaborn as sns\nfrom matplotlib import pyplot as plt ","4a865622":"\n\npath = '..\/input\/game-of-thrones-book-files\/'\nall_files = glob.glob(path + \"*.txt\")\n\nli = []\n\nfor filename in all_files:\n    df = pd.read_table(filename, index_col=None, header=None)\n    df['Book'] = filename[-5:-4] \n    li.append(df)\n\ntext = pd.concat(li, axis=0, ignore_index=True)\n\ntext.head()","f14f0e96":"nlp = spacy.load(\"en_core_web_sm\")\n","7914bace":"def entity_counter(entity,df):\n    words_name = []\n\n    for line in tqdm(df[0]):\n        doc = nlp(line)\n        names = [ent.text for ent in doc.ents if ent.label_ == entity]\n\n        words_name.append(names)\n\n\n    entities = [line for line in words_name for line in set(line)]\n    entities_count = Counter(entities)\n    return entities_count\n","b8351d28":"names = entity_counter('PERSON',text)\nplaces = entity_counter('FAC',text)\nevents = entity_counter('EVENT',text)\n","333aad5f":"name_df = pd.DataFrame.from_dict(names, orient='index').reset_index().rename(columns = {'index': 'Name', 0: 'Count'})\nplaces_df = pd.DataFrame.from_dict(places, orient='index').reset_index().rename(columns = {'index': 'Place', 0: 'Count'})\nevents_df = pd.DataFrame.from_dict(events, orient='index').reset_index().rename(columns = {'index': 'Name', 0: 'Count'})\n\nname_df = name_df.set_index('Name')\nplaces_df = places_df.set_index('Place')\nevents_df = events_df.set_index('Name')\n\nplaces_df.loc['The Wall'] = name_df.loc['Wall']\nplaces_df.loc['Riverrun'] = name_df.loc['Riverrun']\nplaces_df.loc['Highgarden'] = name_df.loc['Highgarden']\nplaces_df.loc['Winterfell'] = name_df.loc['Winterfell']\nplaces_df.loc['the Seven Kingdoms'] += events_df.loc['the Seven Kingdoms']\n\n\nevents_df.loc['the Red Wedding'] = places_df.loc['the Red Wedding']\n\n\nname_df.loc['Jon Snow'] = name_df.loc['Jon'] +  name_df.loc['Jon Snow']\nname_df.loc['Jaime'] = name_df.loc['Jaime'] + name_df.loc['Kingslayer']\nname_df.loc['Ned Stark'] = name_df.loc['Ned Stark'] + name_df.loc['Ned'] + name_df.loc['Eddard'] \nname_df.loc['The Hound'] = name_df.loc['Hound']\n\ndrop_names = ['Wall','Kingslayer','Twins','Frey','Riverrun','Bolton','Lannister','Aye','Grace','Highgarden','Winterfell','Kingsguard','Jon','Snow','Robb','Ned','Eddard','Hound']\ndrop_places = ['the Red Wedding','Stranger','Prince Rhaegar']\ndrop_events = ['Tommen','cup','Rhoynar','New Ghis','Ser Marq Piper','the Seven Kingdoms','Black Wind','the Black Dread','the Great Shepherd']\nname_df.drop(drop_names,inplace = True)\nplaces_df.drop(drop_places,inplace = True)\nevents_df.drop(drop_events,inplace = True)","09799746":"\nfigure_name = name_df[(name_df.Count > 700)].sort_values('Count',ascending = False)\n\nplt.figure(figsize = (20,9))\nsns.barplot(x = figure_name.index , y = 'Count', data = figure_name)","e6215918":"figure_places = places_df[(places_df.Count > 50)].sort_values('Count',ascending = False)\n\nplt.figure(figsize = (25,9))\nsns.barplot(x = figure_places.index , y = 'Count', data = figure_places)\n","0c4fba03":"figure_events = events_df[(events_df.Count > 2)].sort_values('Count',ascending = False)\nplt.figure(figsize = (25,9))\nsns.barplot(x = figure_events.index , y = 'Count', data = figure_events)","39614c3e":"# The goal of the notebook\n# \nThe purpose of this notebook is to answer 3 simple questions, who is the most mentioned character in the books? Which event is most mentioned? And which place is most mentioned? For this purpose we will use NER to identify Entities from the text. "}}