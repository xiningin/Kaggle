{"cell_type":{"69651746":"code","22d9fa54":"code","a6374cd0":"code","2da74aba":"code","791de0bc":"code","80522756":"code","012c2fd4":"code","9eec828a":"code","ed7eb949":"markdown","1d79a97e":"markdown","9c8885ff":"markdown","20e84971":"markdown","2c748313":"markdown","5809418b":"markdown","83a0180a":"markdown"},"source":{"69651746":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport sqlite3\nimport pandas.io.sql as psql\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport matplotlib as mpl\nimport networkx as nx\nimport os\n\n%matplotlib inline\n\nprint(os.listdir(\"..\/input\"))","22d9fa54":"dt_eurovision=pd.read_excel('..\/input\/eurovision_song_contest_1975_2017v4.xlsx')\ndt_eurovision.head()","a6374cd0":"# Upload the data in a SQLite database to facilitate queries\nconn = sqlite3.connect(\"eurovision_1975_2017.sl3\")\ncurs = conn.cursor()\ncreate_table_sql =\"CREATE TABLE eurovision(YEAR character varying(50),FINAL_SEMI character varying(50), EDITION character varying(50),JURY_OR_TELEVOTING character varying(50), FROM_COUNTRY character varying(255), TO_COUNTRY character varying(255), POINTS integer, DUPLICATE character varying(50));\"\ncurs.execute(create_table_sql)\n\nfor index, row in dt_eurovision.iterrows():\n    curs.execute(\"INSERT INTO eurovision (YEAR, FINAL_SEMI, EDITION, JURY_OR_TELEVOTING, FROM_COUNTRY, TO_COUNTRY, POINTS, DUPLICATE) VALUES (:YEAR, :FINAL_SEMI, :EDITION, :JURY_OR_TELEVOTING, :FROM_COUNTRY, :TO_COUNTRY, :POINTS, :DUPLICATE)\", \n                         {\"YEAR\": row[0], \"FINAL_SEMI\": row[1], \"EDITION\":row[2], \"JURY_OR_TELEVOTING\":row[3], \"FROM_COUNTRY\": row[4], \"TO_COUNTRY\": row[5], \"POINTS\": row[6], \"DUPLICATE\": row[7]})\nconn.commit()","2da74aba":"# Calculate the average of the points that each country gives to another\ndf_average = pd.read_sql(\"SELECT FROM_COUNTRY, TO_COUNTRY, SUM(POINTS) SUM_POINTS, count(POINTS) as N_PARTICIPATIONS, \"\n                         \"SUM(POINTS)\/count(POINTS) AS AVERAGE_POINTS \" \n                         \"FROM eurovision \" \n                         \"GROUP BY FROM_COUNTRY, TO_COUNTRY;\", conn)\ndf_average.sort_values(by=['AVERAGE_POINTS', 'N_PARTICIPATIONS'], ascending=False).head(20)","791de0bc":"mpl.rcParams['figure.figsize'] = (12.0, 9.0)\nplt.hist(df_average.AVERAGE_POINTS.astype(int))\nplt.show()","80522756":"country_dict = {'Andorra': '0', 'Cyprus': '1', 'Turkey': '2', 'The Netherlands': '3', 'Switzerland': '4', \n                'Italy': '5', 'Hungary': '6', 'Russia': '7', 'Luxembourg': '8', 'Czech Republic': '9', 'Sweden': '10', \n                'Norway': '11', 'Armenia': '12', 'Belarus': '13', 'United Kingdom': '14', 'Netherlands': '15', \n                'Romania': '16', 'Montenegro': '17', 'Austria': '18', 'Australia': '19', 'Ireland': '20', \n                'Germany': '21', 'Macedonia': '22', 'Serbia': '23', 'San Marino': '24', 'Bosnia & Herzegovina': '25', \n                'Portugal': '26', 'Finland': '27', 'Malta': '28', 'Albania': '29', 'Ukraine': '30', 'Lithuania':'31', \n                'Bulgaria': '32', 'Spain': '33', 'Croatia': '34', 'Latvia': '35', 'Serbia & Montenegro': '36', \n                'Azerbaijan': '37', 'Slovenia': '38', 'Greece': '39', 'Georgia': '40', 'Morocco': '41', \n                'Belgium': '42', 'Moldova': '43', 'France': '44', 'Estonia': '45', 'Slovakia': '46', 'Monaco': '47', \n                'Israel': '48', 'Poland': '49', 'Iceland': '50', 'Yugoslavia': '51', 'Denmark': '52', 'F.Y.R. Macedonia': '53'} \nnames, symbols = np.array(sorted(country_dict.items())).T","012c2fd4":"mpl.rcParams['figure.figsize'] = (12.0, 9.0)\ncountry_average = np.zeros((names.size, names.size))\n\nfor index, row in df_average.iterrows():\n    x = int(country_dict[row['FROM_COUNTRY']])\n    y = int(country_dict[row['TO_COUNTRY']])\n    country_average[x, y] = float(row['AVERAGE_POINTS'])\ndf_matrix_average = pd.DataFrame(country_average,index=country_dict.keys(),columns=country_dict.keys())\nsns.heatmap(df_matrix_average, annot=True)","9eec828a":"mpl.rcParams['figure.figsize'] = (12.0, 9.0)\n\nsql=\"SELECT FROM_COUNTRY, TO_COUNTRY, SUM(POINTS), count(POINTS), SUM(POINTS)\/count(POINTS) AS average \" \\\n    \"FROM eurovision \" \\\n    \"WHERE FINAL_SEMI = 'f' \" \\\n    \"GROUP BY FROM_COUNTRY, TO_COUNTRY HAVING SUM(POINTS)\/count(POINTS) >= 9 \" \\\n    \"AND count(POINTS) > 4 \" \\\n    \"ORDER BY SUM(POINTS) desc;\"\n\ncursor = conn.cursor()\ncursor.execute(sql)\nrows = cursor.fetchall()\nlist = []\nfor row in rows:\n    list.append((row[0],row[1]))\ncursor.close()\n\n# Create a networkx graph object\nmy_graph = nx.Graph() \nmy_graph.add_edges_from(list)\n \n# Draw the resulting graph\nnx.draw(my_graph, with_labels=True, font_weight='bold')","ed7eb949":"**Matrix with the averages of votes between countries**","1d79a97e":"We must bear in mind that voting on songs from other countries does not have to be random because there are countries with a greater musical trajectory, others with a greater or lesser number of inhabitants, others with more commercial music, others with more similar musical tastes but even taking these points into account it is not normal to have values greater than 5.","9c8885ff":"**Graph with the countries groups according to the vote**\n\nHere we show the groups of countries that have a clear tendency to vote among themselves and have an average of more than 9 points, have participated at least 5 times and we only have the scores of the finals.","20e84971":"For the neophytes in the Eurovision song festival, which will be few, comment that it is a television contest that is held every year and that involved the different televisions of mainly European countries. Win the country that gets the most votes and each country gives 12 points to the song they like the most, 10 to the second and then descending the points from 8 to 1.\n\nEvery year during and after the voting, there is a debate about the lack of impartiality of some countries in the allocation of the points since it seems that some participants have a tendency to vote among themselves.\n\nI'm going to take a look at the voting data in Eurovision between 1975 and 2017.","2c748313":"**Histogram of average values**\n\nDistribution of the values of the averages (AVERAGE). For a system 100% random should be between 0 and 2.","5809418b":"List of countries that always or almost always give the highest score (12) to the same countries.","83a0180a":"Show \"curious\" cases like Turkey that has always been able to give 12 points to Azerbaijan and vice versa. Although they are not the only ones with a clear bias in the votes, the list is extensive and an average above 5 is suspect."}}