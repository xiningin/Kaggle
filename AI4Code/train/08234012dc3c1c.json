{"cell_type":{"857ba6ea":"code","263fdcac":"code","80716a9b":"code","04671eb7":"code","b4302376":"code","d06c2527":"code","eb02b2b2":"code","47fb77da":"code","cdd76fb1":"code","e2e8817c":"code","6083a34a":"code","28d571ce":"code","0ffd3235":"code","45e2eac7":"code","4818c63b":"code","1da76e96":"code","affb9cf9":"code","82ee92b9":"code","4bace0e4":"code","fbaa14b5":"code","7b539dc6":"code","58fc3b33":"code","ea6ceb0d":"code","8ff41d5d":"code","892ebd9f":"code","e9d8cf03":"code","7e2ce78b":"code","87ce7faa":"code","252bb71b":"code","04c1804d":"code","339d5d0c":"code","1c930805":"code","ae9a3a4e":"code","5007479b":"code","c8cd872d":"code","dc7b6bb3":"code","bfe47a77":"code","2f6868e6":"code","44400bf8":"code","ad1c5f08":"code","90f7d447":"code","aca9c639":"code","4c098f95":"code","2141c706":"code","fffa7db7":"code","4fa32487":"code","a1980af4":"code","e698b251":"markdown","f8f34b4e":"markdown","fd690d9b":"markdown","1eb5ba4a":"markdown","36237371":"markdown","7d440c51":"markdown","9588af75":"markdown","88677771":"markdown","4b388845":"markdown","b7f1bff3":"markdown","fc716058":"markdown","de9a9be8":"markdown","6b331df5":"markdown","86069781":"markdown","035453ec":"markdown","5264da4a":"markdown","5ab56ebe":"markdown","99e22df6":"markdown","f996597d":"markdown","b1396c99":"markdown","e16db208":"markdown","517b0107":"markdown","484dea37":"markdown","30661ffd":"markdown","aa883384":"markdown","749d50e5":"markdown","0a80ee7c":"markdown","1fcf423e":"markdown","75e38363":"markdown","35f590d2":"markdown","7d1c92ea":"markdown"},"source":{"857ba6ea":"# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","263fdcac":"PATH_WEEK1='\/kaggle\/input\/covid19-global-forecasting-week-1'","80716a9b":"df_train = pd.read_csv(f'{PATH_WEEK1}\/train.csv')","04671eb7":"df_test = pd.read_csv(f'{PATH_WEEK1}\/test.csv')","b4302376":"df_train.head()","d06c2527":"df_train.tail()","eb02b2b2":"df_train.rename(columns={'Country\/Region':'Country'}, inplace=True)\ndf_test.rename(columns={'Country\/Region':'Country'}, inplace=True)\n\ndf_train.rename(columns={'Province\/State':'State'}, inplace=True)\ndf_test.rename(columns={'Province\/State':'State'}, inplace=True)","47fb77da":"df_test.head()","cdd76fb1":"df_train.info()","e2e8817c":"df_test.info()","6083a34a":"df_train['Date'] = pd.to_datetime(df_train['Date'], infer_datetime_format=True)\ndf_test['Date'] = pd.to_datetime(df_test['Date'], infer_datetime_format=True)","28d571ce":"df_train.info()","0ffd3235":"df_train.describe()","45e2eac7":"df_test.describe()","4818c63b":"import plotly.express as px\npxdf = px.data.gapminder()\n\ncountry_isoAlpha = pxdf[['country', 'iso_alpha']].drop_duplicates()\ncountry_isoAlpha.rename(columns = {'country':'Country'}, inplace=True)\ncountry_isoAlpha.set_index('Country', inplace=True)\ncountry_map = country_isoAlpha.to_dict('index')","1da76e96":"def getCountryIsoAlpha(country):\n    try:\n        return country_map[country]['iso_alpha']\n    except:\n        return country","affb9cf9":"df_train['iso_alpha'] = df_train['Country'].apply(getCountryIsoAlpha)\ndf_train.info()","82ee92b9":"df_train.isna().sum()","4bace0e4":"df_train.Country.unique()","fbaa14b5":"df_plot = df_train.loc[:,['Date', 'Country', 'ConfirmedCases']]\ndf_plot.loc[:, 'Date'] = df_plot.Date.dt.strftime(\"%Y-%m-%d\")\ndf_plot.loc[:, 'Size'] = np.where(df_plot['Country'].isin(['China', 'Italy']), df_plot['ConfirmedCases'], df_plot['ConfirmedCases']*100)\nfig = px.scatter_geo(df_plot.groupby(['Date', 'Country']).max().reset_index(),\n                     locations=\"Country\",\n                     locationmode = \"country names\",\n                     hover_name=\"Country\",\n                     color=\"ConfirmedCases\",\n                     animation_frame=\"Date\", \n                     size='Size',\n                     #projection=\"natural earth\",\n                     title=\"Rise of Coronavirus Confirmed Cases\")\nfig.show()","7b539dc6":"df_train.drop(columns='iso_alpha', inplace=True)\ndf_train","58fc3b33":"X_Train = df_train.copy()\n\nX_Train.loc[:, 'Date'] = X_Train.Date.dt.strftime(\"%Y%m%d\")\nX_Train[\"Date\"]  = X_Train[\"Date\"].astype(int)\n\nX_Train.drop(columns=['ConfirmedCases', 'Fatalities'], inplace=True)\nX_Train.drop(columns=['Id', 'State', 'Country', 'Lat'], inplace=True)\nX_Train.head()","ea6ceb0d":"X_Train.head()","8ff41d5d":"X_Train.head()","892ebd9f":"y1_Train = df_train.ConfirmedCases","e9d8cf03":"from warnings import filterwarnings\nfilterwarnings('ignore')","7e2ce78b":"from sklearn.linear_model import LinearRegression, SGDRegressor\nfrom sklearn.neighbors import KNeighborsRegressor, RadiusNeighborsRegressor\nfrom sklearn.neural_network import MLPRegressor\nfrom sklearn.svm import LinearSVR, NuSVR, SVR\nfrom sklearn.tree import DecisionTreeRegressor, ExtraTreeRegressor, DecisionTreeClassifier\nfrom sklearn.ensemble import RandomForestRegressor, GradientBoostingRegressor\nfrom xgboost import XGBRegressor \n\nMODELS = {\"Linear_Reg\": LinearRegression(), \"KNN_Reg\": KNeighborsRegressor(), \"LinearSVR_Reg\": LinearSVR(), \"DecisionTree_Reg\": DecisionTreeRegressor(), \"DecisionTree_Class\": DecisionTreeClassifier(), \"ExtraTree_Reg\": ExtraTreeRegressor(), \"RandomForest_Reg\": RandomForestRegressor(), \"GB_Reg\": GradientBoostingRegressor(), \"XGB_Reg\": XGBRegressor() }\n# \"SDG_Reg\": SGDRegressor(), \"RN_Reg\": RadiusNeighborsRegressor(), \"NuSVR_Reg\": NuSVR(), \"SVR_Reg\": SVR(),","87ce7faa":"from sklearn.model_selection import GridSearchCV\nimport time\n\nmodel = XGBRegressor()","252bb71b":"#param_grid = {\"criterion\": [\"mse\", \"mae\"], \"min_samples_split\": [10, 20], \"max_depth\": [2, 6], \"min_samples_leaf\": [20, 40], \"max_leaf_nodes\": [5, 20]} #DTR\n#param_grid = {\"criterion\": [\"mae\"], 'max_depth': [2], 'max_leaf_nodes': [5], 'min_samples_leaf': [20], 'min_samples_split': [10]} #DTR best\n#param_grid = {'criterion':['gini'], 'max_depth': np.arange(2,5), 'min_samples_leaf': range(1,5)} #DTC\n#param_grid = {'criterion': 'gini', 'max_depth': 2, 'min_samples_leaf': 1} #DTC best\n#param_grid = {'n_neighbors':range(1,2,4), 'leaf_size':[4,5,6], 'weights':['uniform', 'distance'], 'algorithm':['auto', 'ball_tree','kd_tree','brute']} #KNR\n#param_grid = {'algorithm': ['auto'], 'leaf_size': [4], 'n_neighbors': [1], 'weights': ['distance']} #KNR best\n#param_grid = {'nthread':[4], 'objective':['reg:linear'], 'learning_rate': [.03, 0.05], 'max_depth': [5, 6], 'min_child_weight': [4], 'silent': [1], 'subsample': [0.7], 'colsample_bytree': [0.7], 'n_estimators': [500, 1000]} #XGBR\nparam_grid = {'n_estimators': [1250]}","04c1804d":"start = time.time()\ngrid_cv = GridSearchCV(model, param_grid, cv=10, scoring='neg_mean_squared_error')\ngrid_cv.fit(X_Train, y1_Train)\nprint (f'{type(model).__name__} Hyper Paramter Tuning took a Time: {time.time() - start}')","339d5d0c":"print(\"Mean Squared Error: {}\".format(grid_cv.best_score_))\nprint(\"Best Hyperparameters:\\n{}\".format(grid_cv.best_params_))\n\n#df_dtr = pd.DataFrame(data=grid_cv.cv_results_)\n#print(df_dtr.head())","1c930805":"X_Test = df_test.copy()\n\nX_Test.loc[:, 'Date'] = X_Test.Date.dt.strftime(\"%Y%m%d\")\nX_Test[\"Date\"]  = X_Test[\"Date\"].astype(int)\n\n#X_Test.drop(columns=['ConfirmedCases', 'Fatalities'], inplace=True)\nX_Test.drop(columns=['ForecastId', 'State', 'Country', 'Lat'], inplace=True)\nX_Test.head()\n","ae9a3a4e":"y1_best_dtr_model = grid_cv.best_estimator_\ny1_pred = y1_best_dtr_model.predict(X_Test)","5007479b":"y1_pred = y1_pred.round(0)","c8cd872d":"y1_pred","dc7b6bb3":"from sklearn.metrics import r2_score\nprint(r2_score(y1_Train, y1_best_dtr_model.predict(X_Train))) ","bfe47a77":"y2_Train = df_train.Fatalities","2f6868e6":"start = time.time()\ngrid_cv = GridSearchCV(model, param_grid, cv=10)\ngrid_cv.fit(X_Train, y2_Train)\nprint (f'Decision Tree Regressor Hyper Paramter Tuning took a Time: {time.time() - start}')","44400bf8":"print(\"R-Squared::{}\".format(grid_cv.best_score_))\nprint(\"Best Hyperparameters::\\n{}\".format(grid_cv.best_params_))\n\n#df_dtr = pd.DataFrame(data=grid_cv.cv_results_)\n#print(df_dtr.head())","ad1c5f08":"y2_best_dtr_model = grid_cv.best_estimator_\ny2_pred = y2_best_dtr_model.predict(X_Test)","90f7d447":"y2_pred = y2_pred.round(0)","aca9c639":"y2_pred","4c098f95":"df_sub = pd.read_csv(f'{PATH_WEEK1}\/submission.csv')","2141c706":"df_sub.head()","fffa7db7":"df_sub.info()","4fa32487":"df = pd.DataFrame({\"ForecastId\": df_test.ForecastId, \"ConfirmedCases\": y1_pred, \"Fatalities\": y2_pred})\ndf.head()","a1980af4":"df.to_csv('submission.csv', index=False)","e698b251":"from sklearn.model_selection import cross_val_score\n# Checking the training model scores\nr2_scores = cross_val_score(grid_cv.best_estimator_, X_Train, y1_Train, cv=10)\nmse_scores = cross_val_score(grid_cv.best_estimator_, X_Train, y1_Train, cv=10, scoring='neg_mean_squared_error')\nrmse_scores = cross_val_score(grid_cv.best_estimator_, X_Train, y1_Train, cv=10, scoring='neg_root_mean_squared_error')\n\nprint(\"avg R-squared::{:.3f}\".format(np.mean(r2_scores)))\nprint(\"MSE::{:.3f}\".format(np.mean(mse_scores)))\nprint(\"RMSE::{:.3f}\".format(np.mean(rmse_scores)))","f8f34b4e":"EMPTY_VAL = \"EMPTY_VAL\"\nX_Train['State'].fillna(EMPTY_VAL, inplace=True)","fd690d9b":"from sklearn.model_selection import cross_val_score\n# Checking the training model scores\n#r2_scores = cross_val_score(grid_cv.best_estimator_, X_Train, y2_Train, cv=10)\n#mse_scores = cross_val_score(grid_cv.best_estimator_, X_Train, y2_Train, cv=10, scoring='neg_mean_squared_error')\n#rmse_scores = cross_val_score(grid_cv.best_estimator_, X_Train, y2_Train, cv=10, scoring='neg_root_mean_squared_error')\n\n#print(\"avg R-squared::{:.3f}\".format(np.mean(r2_scores)))\n#print(\"MSE::{:.3f}\".format(np.mean(mse_scores)))\n#print(\"RMSE::{:.3f}\".format(np.mean(rmse_scores)))","1eb5ba4a":"parameters = {'fit_intercept':[True,False], 'normalize':[True,False], 'copy_X':[True, False]}","36237371":"X_Train['Year'] = X_Train.Date.dt.year\nX_Train['Month'] = X_Train.Date.dt.month\nX_Train['Day'] = X_Train.Date.dt.day\nX_Train.drop(columns = 'Date', inplace=True)","7d440c51":"X_Train = df_train[['Long','Date']]\nX_Train.loc[:, 'Date'] = X_Train.Date.dt.strftime(\"%Y%m%d\")\nX_Train[\"Date\"]  = X_Train[\"Date\"].astype(int)\ny1 = df_train[['ConfirmedCases']]\ny2 = df_train[['Fatalities']]\nX_Test = df_test[['Long','Date']]\nX_Test.loc[:, 'Date'] = X_Test.Date.dt.strftime(\"%Y%m%d\")\nX_Test[\"Date\"]  = X_Test[\"Date\"].astype(int)\n\ntree_reg = XGBRegressor(n_estimators=1000)\ntree_reg.fit(X_Train, y1)\ny1_pred = tree_reg.predict(X_Test)\n\ny1_pred.round(2)\n\ntree_reg.fit(X_Train, y2)\ny2_pred = tree_reg.predict(X_Test)\n\ny2_pred.round(2)","9588af75":"X_scaled = scaler.fit_transform(X_Train)\ny1_scaled = scaler.transform(y1_Train)\ny2_scaled = scaler.transform(y2_Train)","88677771":"from sklearn.ensemble import RandomForestRegressor\n\ndec_tree_reg = RandomForestRegressor()\n#scores1 = cross_val_score(dec_tree_reg, X_Train, y1_Train, cv=10, scoring='neg_mean_absolute_error')\n#scores2 = cross_val_score(dec_tree_reg, X_Train, y1_Train, cv=10, scoring='neg_mean_squared_error')\nscores3 = cross_val_score(dec_tree_reg, X_Train, y1_Train, cv=10, scoring='neg_root_mean_squared_error')\n\n#print(scores1)\n#print(scores2)\nprint(scores3)","4b388845":"def fillState(state, country):\n    if state == EMPTY_VAL: return country\n    return state","b7f1bff3":"model = XGBRegressor()\nparam_search = {'max_depth' : [3, 5]}\n\ntscv = TimeSeriesSplit(n_splits=2)\ngsearch = GridSearchCV(estimator=model, cv=tscv,\n                        param_grid=param_search)\ngsearch.fit(X_Train, y1_Train)\ny_pred = gsearch.predict(X_Test)\ny_pred","fc716058":"DecisionTreeClassifier\n{'criterion': 'gini', 'max_depth': 2, 'min_samples_leaf': 1}","de9a9be8":"From the above *RMSE*, looks like **Decision Tree Regressor** predicts better","6b331df5":"from sklearn import preprocessing\nle = preprocessing.LabelEncoder()\nX_Train.Country = le.fit_transform(X_Train.Country)\nX_Train['State'] = le.fit_transform(X_Train['State'])\nX_Train.tail()","86069781":"from sklearn.linear_model import LinearRegression\nlin_reg = LinearRegression()\n\nlin_reg.fit(X_train, y_train)\ny_pred = lin_reg.predict(X_test)\n\nfrom sklearn.metrics import mean_absolute_error, mean_squared_error\nprint(mean_absolute_error(y_test, y_pred))\nprint(mean_squared_error(y_test, y_pred))\nprint(np.sqrt(mean_squared_error(y_test, y_pred)))","035453ec":"from sklearn.preprocessing import StandardScaler\nscaler = StandardScaler()","5264da4a":"columns = ['Lat', 'Long', 'Date']\nX_Test = df_test[columns]\nX_Test['Date'] = X_Test.Date.dt.strftime('%m%d')\nX_Test.Date.astype('int')\nX_Test.head()","5ab56ebe":"import numpy as np\nimport pandas as pd\nfrom sklearn.model_selection import KFold\n\ndf = pd.DataFrame({'num_legs': [2, 4, 8, 0], 'num_wings': [2, 0, 0, 0], 'num_specimen_seen': [10, 2, 1, 8]}, index=[0,1,2,3])\n\nkf = KFold(n_splits=2, shuffle=True)\nfor train_index, val_index in kf.split(df):\n    df_train, df_val = df[train_index], df[val_index]","99e22df6":"# Checking the training model scores\nr2_scores = cross_val_score(grid_cv.best_estimator_, X_Train, y1_Train, cv=10)\nmse_scores = cross_val_score(grid_cv.best_estimator_, X_Train, y1_Train, cv=10, scoring='neg_mean_squared_error')\nrmse_scores = cross_val_score(grid_cv.best_estimator_, X_Train, y1_Train, cv=10, scoring='neg_root_mean_squared_error')\n\nprint(\"avg R-squared::{:.3f}\".format(np.mean(r2_scores)))\nprint(\"MSE::{:.3f}\".format(np.mean(mse_scores)))\nprint(\"RMSE::{:.3f}\".format(np.mean(rmse_scores)))","f996597d":"import time\nfrom sklearn.model_selection import cross_val_score\n\nfor MODEL_NAME, MODEL in MODELS.items():\n    start = time.time()\n    scores = cross_val_score(MODEL, X_Train, y1_Train, cv=10, scoring='neg_root_mean_squared_error')\n    print (f'{MODEL_NAME} took a Time: {time.time() - start}')\n    print (\"R2 SCore\\n\", scores)\n    print (f'(Min, Max, Mean) Values are : ({scores.min(), scores.max(), scores.mean()})')\n    print ()","b1396c99":"from sklearn.model_selection import train_test_spdlit\nX_train, X_test, y_train, y_test = train_test_split(X_Train, y1_Train, test_size=0.25,random_state=1)","e16db208":"from sklearn.model_selection import GridSearchCV\nfrom sklearn.linear_model import LinearRegression\n\nlin_reg = LinearRegression()\ngrid = GridSearchCV(lin_reg, parameters, cv=10)\ngrid.fit(X_train, y_train)\ny_pred = grid.predict(X_test)\n\nfrom sklearn.metrics import mean_absolute_error\nprint(mean_absolute_error(y_test, y_pred))\n\nfrom sklearn.metrics import mean_squared_error\nprint(mean_squared_error(y_test, y_pred))\nprint(np.sqrt(mean_squared_error(y_test, y_pred)))","517b0107":"X_Train['State'] = X_Train.loc[:, ['State', 'Country']].apply(lambda x : fillState(x['State'], x['Country']), axis=1)","484dea37":"Decision Tree Regressor Hyper Paramter Tuning took a Time: 609.3986613750458\nR-Squared::-0.03599184944916962\nBest Hyperparameters::\n{'criterion': 'mae', 'max_depth': 2, 'max_leaf_nodes': 5, 'min_samples_leaf': 20, 'min_samples_split': 10}","30661ffd":"from sklearn.tree import DecisionTreeClassifier\nTree_model = DecisionTreeClassifier(criterion='entropy')\n\nTree_model.fit(X_Train,y1_Train)\npred1 = Tree_model.predict(X_test)\npred1 = pd.DataFrame(pred1)\n\nTree_model.fit(X_Train,y2_Train)\npred2 = Tree_model.predict(X_test)\npred2 = pd.DataFrame(pred2)","aa883384":"columns = ['Lat', 'Long', 'Date']\nX_Train = df_train[columns]\nX_Train['Date'] = X_Train.Date.dt.strftime('%m%d')\nX_Train.Date.astype('int')\nX_Train.head()","749d50e5":"Decision Tree Regressor Hyper Paramter Tuning took a Time: 823.2946598529816\nR-Squared::-0.040891715137972316\nBest Hyperparameters::\n{'criterion': 'mae', 'max_depth': 2, 'max_leaf_nodes': 5, 'min_samples_leaf': 20, 'min_samples_split': 10}","0a80ee7c":"from sklearn.model_selection import TimeSeriesSplit\ntscv = TimeSeriesSplit(n_splits=5)\ni = 1\nscores = []\nfor tr_index, val_index in tscv.split(X_Train):\n    print(X[tr_index])","1fcf423e":"from sklearn.model_selection import GridSearchCV\nrand_for_reg = RandomForestRegressor()\n\nparam_grid = {\"criterion\": [\"mse\", \"mae\"],\n              \"min_samples_split\": [10, 20],\n              \"max_depth\": [2, 6],\n              \"min_samples_leaf\": [20, 40],\n              \"max_leaf_nodes\": [5, 20],\n              }\n\ngrid_cv = GridSearchCV(rand_for_reg, param_grid, cv=5)\ngrid_cv.fit(X_Train, y1_Train)\n\nprint(\"R-Squared::{}\".format(grid_cv.best_score_))\nprint(\"Best Hyperparameters::\\n{}\".format(grid_cv.best_params_))\n\ndf_rfr = pd.DataFrame(data=grid_cv.cv_results_)\nprint(df_rfr.head())","75e38363":"X_Test = df_test.copy()\nX_Test['Year'] = X_Test.Date.dt.year\nX_Test['Month'] = X_Test.Date.dt.month\nX_Test['Day'] = X_Test.Date.dt.day\nX_Test.drop(columns = 'Date', inplace=True)\nX_Test['State'].fillna(EMPTY_VAL, inplace=True)\n#X_Test['State'] = X_Test.loc[:, ['State', 'Country']].apply(lambda x : fillState(x['State'], x['Country']), axis=1)\nX_Test['State'] = X_Test.loc[:, ['State', 'Country']].apply(lambda x : x['Country'] if x['State'] == EMPTY_VAL else x['State'], axis=1)\n\nX_Test.Country = le.fit_transform(X_Test.Country)\nX_Test['State'] = le.fit_transform(X_Test['State'])\nX_Test.head()","35f590d2":"from sklearn.model_selection import cross_val_score\nfrom sklearn.linear_model import LinearRegression\nlin_reg = LinearRegression()\n\nscores1 = cross_val_score(lin_reg, X_train, y_train, cv=10, scoring='neg_mean_absolute_error')\nscores2 = cross_val_score(lin_reg, X_train, y_train, cv=10, scoring='neg_mean_squared_error')\nscores3 = cross_val_score(lin_reg, X_train, y_train, cv=10, scoring='neg_root_mean_squared_error')\n\nprint(scores1)\nprint(scores2)\nprint(scores3)","7d1c92ea":"from sklearn.model_selection import TimeSeriesSplit\ntscv = TimeSeriesSplit(n_splits=5)\ni = 1\nscores = []\nfor tr_index, val_index in tscv.split(X_Train):\n    X_tr, X_val = X[tr_index], X[val_index]\n    y_tr, y_val = y1[tr_index], y1[val_index]\n    for mf in np.linspace(100, 150, 6):\n        for ne in np.linspace(50, 100, 6):\n            for md in np.linspace(20, 40, 5):\n                for msl in np.linspace(30, 100, 8):\n                    rfr = RandomForestRegressor(\n                        max_features=int(mf),\n                        n_estimators=int(ne),\n                        max_depth=int(md),\n                        min_samples_leaf=int(msl))\n                    rfr.fit(X_tr, y_tr)\n                    scores.append([i,\n                                  mf, \n                                  ne,\n                                  md, \n                                  msl, \n                                  rfr.score(X_val, y_val)])\n    i += 1\nprint(scores)"}}