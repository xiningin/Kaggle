{"cell_type":{"d31be1f5":"code","7070f03f":"code","9f5de531":"code","f94bd8b2":"code","9d43f29a":"code","91324101":"code","1ff02fc4":"code","b3d0acfe":"code","ed6ab176":"code","3f58aba2":"code","df1a243f":"code","dd87405a":"code","42b2e30d":"code","3250eabb":"code","7b695c5a":"code","b042a41b":"code","13ab6305":"code","5e96cb8a":"code","cfa305c6":"code","fda6ee59":"code","e858740f":"code","8db8b5dc":"code","a3283b47":"code","7b74ccd8":"code","887d135f":"code","404fccdd":"code","de2efcb0":"code","5272fc18":"code","d964c12e":"code","d412595c":"code","822ccd99":"markdown","801396e2":"markdown","e4ddeb6f":"markdown","a8428972":"markdown","62995adb":"markdown"},"source":{"d31be1f5":"import torch\nfrom torch import nn\nfrom torch.nn import functional as F\n\nimport pandas as pd\n\nfrom sklearn_pandas import DataFrameMapper\nfrom sklearn.preprocessing import LabelBinarizer, OneHotEncoder\n\nfrom pytorch_utils import train_loop, test_loop","7070f03f":"torch.manual_seed(42)\n\nimport random\nrandom.seed(42)\n\nimport numpy as np\nnp.random.seed(0)","9f5de531":"df_train = pd.read_csv(\"..\/input\/tabular-playground-series-jan-2022\/train.csv\", index_col=\"row_id\")\ndf_test = pd.read_csv(\"..\/input\/tabular-playground-series-jan-2022\/test.csv\", index_col=\"row_id\")","f94bd8b2":"def add_time_cols(df):\n    df.date = pd.to_datetime(df.date)\n    df[\"weekday\"] = df.date.dt.weekday\n    df[\"month\"] = df.date.dt.month\n\n    return df","9d43f29a":"df_train = add_time_cols(df_train)\ndf_test = add_time_cols(df_test)","91324101":"df_train.head()","1ff02fc4":"mapper = DataFrameMapper([\n     (['weekday'], OneHotEncoder()),\n     (['month'], OneHotEncoder()),\n     (['country'], OneHotEncoder()),\n     ('store', LabelBinarizer()),\n     (['product'], OneHotEncoder())\n])","b3d0acfe":"train_data = mapper.fit_transform(df_train)\ntest_data = mapper.fit_transform(df_test)","ed6ab176":"train_data[0]","3f58aba2":"train_data.shape","df1a243f":"test_data.shape","dd87405a":"train_ds = torch.utils.data.TensorDataset(torch.from_numpy(train_data).float(), torch.from_numpy(df_train[\"num_sold\"].values).unsqueeze(1).float())\nnum_train = int(.8 * len(train_ds))\nnum_val = len(train_ds) - num_train\ntrain_ds, val_ds = torch.utils.data.random_split(train_ds, [num_train, num_val])","42b2e30d":"len(train_ds), len(val_ds)","3250eabb":"class SalesRegressor(nn.Module):\n    def __init__(self):\n        super(SalesRegressor, self).__init__()\n        self.linear1 = nn.Linear(26, 512)\n        self.out = nn.Linear(512, 1)\n  \n    def forward(self, inputs):\n        x = F.relu(self.linear1(inputs))\n        num_sold = self.out(x)\n\n        return num_sold","7b695c5a":"model = SalesRegressor()","b042a41b":"pred = model(torch.from_numpy(train_data).float()[0])\npred","13ab6305":"learning_rate = 1e-3\nbatch_size = 64\nepochs = 50","5e96cb8a":"train_dataloader = torch.utils.data.DataLoader(train_ds, batch_size)\nval_dataloader = torch.utils.data.DataLoader(val_ds, batch_size)","cfa305c6":"X, y = next(iter(train_dataloader))","fda6ee59":"preds = model(X)","e858740f":"loss = nn.MSELoss()","8db8b5dc":"loss(preds, y)","a3283b47":"if torch.cuda.is_available():\n    device = 'cuda'\nelse:\n    device = 'cpu'","7b74ccd8":"model = model.to(device)","887d135f":"optimizer = torch.optim.RMSprop(model.parameters(), lr=learning_rate)","404fccdd":"for t in range(epochs):\n    print(f\"Epoch {t+1}\\n-------------------------------\")\n    train_loop(train_dataloader, model, loss, optimizer, device)\n    test_loop(val_dataloader, model, loss, device)\nprint(\"Done!\")","de2efcb0":"preds = model(torch.from_numpy(test_data).float())","5272fc18":"df_pred = pd.Series(preds.squeeze().detach().numpy(), name=\"num_sold\", index=df_test.index).to_frame()","d964c12e":"df_pred.head()","d412595c":"df_pred.to_csv(\"\/kaggle\/working\/submission.csv\")","822ccd99":"## Model","801396e2":"### Vectorize","e4ddeb6f":"## Optimization","a8428972":"## Inference","62995adb":"\n## Data"}}