{"cell_type":{"118631c8":"code","5009dcbe":"code","3967287d":"code","1c5dc19e":"code","c672e5af":"code","bdc5f58e":"code","a2b15664":"code","a23e6f9b":"code","acba8379":"code","76a8239a":"code","fcf0aad8":"code","81f691f7":"code","a3bdb2d4":"code","79d72bab":"code","9c41cfb4":"code","04282aa6":"code","f97b4061":"markdown","b145eb39":"markdown","fefa174b":"markdown","1b070c61":"markdown","b612dd9d":"markdown","35d8eb90":"markdown","9ff147b4":"markdown"},"source":{"118631c8":"!pip install fastai -q --upgrade","5009dcbe":"# import os\n# import cv2\n# bad_list=[]\n# sdir=r'..\/input\/cheese-pics'\n# classes=os.listdir(sdir) # create a list of the sub directories (classes) \n# for klass in classes:  # iterate through the sub directories train and test\n#         classpath=os.path.join (sdir, klass) # create path to class sub directory\n#         flist=os.listdir(classpath) # create list of files in class directory\n#         for f in flist: # iterate through the files\n#             fpath=os.path.join (classpath,f)\n#             index=f.rfind('.') # find index of period infilename\n#             ext=f[index+1:] # get the files extension\n#             if ext  not in ['jpg', 'png', 'bmp']: # mark all gif files as bad\n#                 print(f'file {fpath}  has an invalid extension {ext}')\n#                 bad_list.append(fpath)  \n#                 !rm -rf fpath                   \n#             else:\n#                 try:\n#                     img=cv2.imread(fpath)\n#                     size=img.shape\n#                 except:\n#                     print(f'file {fpath} is not a valid image file ')\n#                     !rm -rf fpath \n#                     bad_list.append(fpath)\n                       \n","3967287d":"import fastai\nprint(fastai.__version__)","1c5dc19e":"!rm -rf '..\/input\/fromages-images\/Pic du Vieux Chaillol fromage\/image_20210806_110205_6694.jpg'","c672e5af":"from fastai.vision.all import *\npath = Path('..\/input\/cheese-pics')\npath.ls()","bdc5f58e":"def get_dls(bs, size):\n    dblock = DataBlock(blocks = (ImageBlock, CategoryBlock),\n                       get_items = get_image_files,\n                       get_y = parent_label,\n                       splitter = RandomSplitter(),\n                       item_tfms = Resize(size)\n                      )\n    return dblock.dataloaders(path, bs = bs)\n\n","a2b15664":"dls = get_dls(16, 128)","a23e6f9b":"learn = cnn_learner(dls, resnet34, metrics=accuracy)","acba8379":"learn.lr_find()","76a8239a":"learn = cnn_learner(dls, resnet34, metrics=accuracy)\nlearn.fit_one_cycle(10, 1e-3)","fcf0aad8":"learn.dls = get_dls(16, 224)\nlearn.fine_tune(5, 1e-3)","81f691f7":"learn.show_results()","a3bdb2d4":"interp = Interpretation.from_learner(learn)\ninterp.plot_top_losses(k=3)","79d72bab":"learn.predict('..\/input\/cheese-pics\/abbots gold cheese\/image_20210806_112545_466.jpg')","9c41cfb4":"learn.export(fname='model.pkl', pickle_module=pickle, pickle_protocol=2)","04282aa6":"reload_model=load_learner('model.pkl', cpu=True, pickle_module=pickle)\nreload_model","f97b4061":"### remove bad images\n!rm -rf '..\/input\/fromages-images\/Pic du Vieux Chaillol fromage\/image_20210806_110205_6694.jpg'","b145eb39":"## Show results","fefa174b":"## Save model","1b070c61":"## Predict","b612dd9d":"## Reload model","35d8eb90":"## Enjoy.","9ff147b4":"## Interpretation"}}