{"cell_type":{"0fa1235f":"code","387f6600":"code","c985d1cf":"code","6b7da10f":"code","8748c201":"code","67460ec6":"code","73b1dd8c":"code","087e53ed":"code","a394a8fd":"code","42434cb4":"code","9c5ea34e":"code","acd26fd0":"code","f5b9c22e":"code","523b04af":"code","1c6b6de1":"markdown","2f84627f":"markdown","72727151":"markdown","7be54e92":"markdown","a1939e98":"markdown","245f3152":"markdown","3532647e":"markdown","843d3fdb":"markdown","79b88aeb":"markdown","59cfb0f6":"markdown","e0517607":"markdown","78990806":"markdown","553b3afd":"markdown","4143f9f2":"markdown","3601378e":"markdown","4a868e91":"markdown","a38e1da0":"markdown","8c49daa2":"markdown","7b025134":"markdown","bf9a5c7f":"markdown","53094a37":"markdown","6cfd37c3":"markdown","7e87df2f":"markdown","4d6234f8":"markdown","3aaae90e":"markdown","5df63aab":"markdown","919b25f2":"markdown","b99cad50":"markdown"},"source":{"0fa1235f":"from IPython.display import Image\nImage(\"..\/input\/machine-learning-system\/machine_learning.png\")","387f6600":"Image(\"..\/input\/frauddetection\/blocked_transactions.jpg\")","c985d1cf":"import numpy as np\nimport pandas as pd\nimport matplotlib.pylab as plt\nfrom IPython.core.interactiveshell import InteractiveShell\n\nInteractiveShell.ast_node_interactivity = \"all\"\n\npd.set_option('display.max_columns', None)","6b7da10f":"transaction = pd.read_csv('..\/input\/ieee-fraud-detection\/train_transaction.csv', usecols  = [0,1,2,4,5,6,7,8,9,10,11,12,15,16,46,47,48,49,50,51,52,53,54])\nidentity = pd.read_csv('..\/input\/ieee-fraud-detection\/train_identity.csv', usecols=[0,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40])","8748c201":"transaction.info()\ntransaction.head()","67460ec6":"identity.info()\nidentity.head()","73b1dd8c":"transaction_joined = transaction.merge(identity, how = \"left\", on = \"TransactionID\", indicator = \"merge\")\ntransaction_joined.head()","087e53ed":"# Transactions with corresponding identity information\ntransaction_with_identity = transaction_joined[transaction_joined[\"merge\"]==\"both\"].shape[0]\n\n\n#  Transactions without corresponding identity information\ntransaction_without_identity = transaction_joined[transaction_joined[\"merge\"]==\"left_only\"].shape[0]\n\nvalues = [transaction_with_identity, transaction_without_identity]\nlabels = [\"Transactions WITH identity information: \" + str(transaction_with_identity), \"Transactions WITHOUT identity information: \" + str(transaction_without_identity)]\nexplode = (0, 0.1)\ncolors = ['#006699','#83B8AE']\n           \nfig, ax = plt.subplots()\nax.set_title(\"Total Transactions: \" + str(transaction_joined.shape[0]))\nax.pie(values, explode=explode, labels = labels, colors = colors, autopct = \"%1.0f%%\", shadow=False, startangle=-90);","a394a8fd":"transaction_joined_null_bool = transaction_joined.isnull()\ntransaction_joined_labels = []\ntransaction_joined_null_freq = []\ntransaction_joined_non_null_freq = []\n    \nfor column in transaction_joined_null_bool:\n    \n    transaction_joined_labels.append(column)\n    \n    try:\n        transaction_joined_null_freq.append(transaction_joined_null_bool[column].value_counts().loc[True])\n    except KeyError:\n            transaction_joined_null_freq.append(0.0)\n    try:   \n        transaction_joined_non_null_freq.append(transaction_joined_null_bool[column].value_counts().loc[False])\n    except KeyError:\n        transaction_joined_non_null_freq(0.0) \n\n# Stacked bar chart\nfig, ax = plt.subplots()\nwidth = 0.35\n\nax.bar(transaction_joined_labels, transaction_joined_null_freq, width*2, label='Null', color='#F46460')\nax.bar(transaction_joined_labels, transaction_joined_non_null_freq, width*2, bottom=transaction_joined_null_freq, label='Non-Null', color='#83B8AE')\n\nax.set_ylabel('Amount Values')\nax.set_title('Missing Values')\nax.legend(frameon=True)\nax.set_frame_on(False)\n\n# Show plot\nfig.tight_layout(rect=(0, 0, 2, 1))\nplt.xticks(rotation=90)\nplt.show();","42434cb4":"transaction_joined[\"card4\"].value_counts(1)\ntransaction_joined[\"card6\"].value_counts(1)","9c5ea34e":"# Card Labels\ncardlabel = transaction_joined[\"card4\"].value_counts().nlargest(2) \ncardlabel[\"others\"] = transaction_joined[\"card4\"].value_counts().nsmallest(2).sum() # Adding the Others item\ncardlabel\nvalues_cardlabel = cardlabel.values\nlabels_cardlabel = cardlabel.index\nexplode_cardlabel = (0.1, 0.1, 0.5)\ncolors_cardlabel = ('#4F80BF','#FCCF61','#EBEBEB')\n\n# Payment Methods (showing just the 2 largest because the others together account for less than 0.01% of the total, see Out[12])\npaymentmethods = transaction_joined[\"card6\"].value_counts().nlargest(2) \npaymentmethods[\"others\"] = transaction_joined[\"card6\"].value_counts().nsmallest(2).sum() # Adding the Others item\nvalues_paymentmethods = paymentmethods.values\nlabels_paymentmethods = paymentmethods.index\nexplode_paymentmethods = (0.1, 0.2, 0.5)\ncolors_paymentmethods = ('#63A599','#A4D4D2')\n\n\n\n# Pie charts\nfig, ax = plt.subplots(1,2)\nfig.tight_layout(rect=(0, 0, 2, 1))\nax[0].set_title(\"Top 2 Card Labels (Mastercard x Visa)\")\nax[0].pie(values_cardlabel, explode=explode_cardlabel, labels = labels_cardlabel, colors = colors_cardlabel, autopct = \"%1.2f%%\", startangle=210)\n\nax[1].set_title(\"Top 2 Payment Methods (Credit x Debit)\")\nax[1].pie(values_paymentmethods, explode=explode_paymentmethods, labels = labels_paymentmethods, colors = colors_paymentmethods, autopct = \"%1.2f%%\", startangle=210);","acd26fd0":"cardlabels_grouped = transaction_joined.groupby(['card4','card6', 'isFraud']).size()\ncardlabels_grouped","f5b9c22e":"# Bar chart\nlabels_bar = ['Mastercard', 'Visa']\ncredit_sum = [cardlabels_grouped[\"mastercard\"][\"credit\"].sum(), cardlabels_grouped[\"visa\"][\"credit\"].sum()]\ndebit_sum = [cardlabels_grouped[\"mastercard\"][\"debit\"].sum(), cardlabels_grouped[\"visa\"][\"debit\"].sum()]\n\nx = np.arange(len(labels))  # the label locations\nwidth = 0.35  # the width of the bars\n\nfig, ax = plt.subplots(1,2)\n\nrects1 = ax[0].bar(x - width\/2, credit_sum, width, label='Credit', color='#A4D4D2')\nrects2 = ax[0].bar(x + width\/2, debit_sum, width, label='Debit', color='#63A599')\n\n# Add some text for labels, title and custom x-axis tick labels, etc.\nax[0].set_ylabel('Transactions')\nax[0].set_title('Total Credit and Debit transactions')\nax[0].set_xticks(x)\nax[0].set_xticklabels(labels_bar)\nax[0].legend(frameon=False)\nax[0].set_frame_on(False)\n\ndef autolabel(rects):\n    \"\"\"Attach a text label above each bar in *rects*, displaying its height.\"\"\"\n    for rect in rects:\n        height = rect.get_height()\n        ax[0].annotate('{}'.format(height),\n                    xy=(rect.get_x() + rect.get_width() \/ 2, height),\n                    xytext=(0, 3),  # 3 points vertical offset\n                    textcoords=\"offset points\",\n                    ha='center', va='bottom')\n        \nautolabel(rects1)\nautolabel(rects2)\n\n# Stacked bar chart\nlabels_stacked = ['Martercard\\nCredit', 'Mastercard\\nDebit', 'Visa\\nCredit', 'Visa\\nDebit']\nfraudulent = [cardlabels_grouped[\"mastercard\"][\"credit\"][1].sum(), cardlabels_grouped[\"mastercard\"][\"debit\"][1].sum(), cardlabels_grouped[\"visa\"][\"credit\"][1].sum(), cardlabels_grouped[\"visa\"][\"debit\"][1].sum()]\nlegitimate = [cardlabels_grouped[\"mastercard\"][\"credit\"][0].sum(), cardlabels_grouped[\"mastercard\"][\"debit\"][0].sum(), cardlabels_grouped[\"visa\"][\"credit\"][0].sum(), cardlabels_grouped[\"visa\"][\"debit\"][0].sum()]\n\nax[1].bar(labels_stacked, fraudulent, width*2, label='Fraudulent', color='#F46460')\nax[1].bar(labels_stacked, legitimate, width*2, bottom=fraudulent, label='Legitimate', color='#83B8AE')\n\nax[1].set_ylabel('Transactions')\nax[1].set_title('Proportion of Legitimate and Fraudulent transactions')\nax[1].legend(frameon=False)\nax[1].set_frame_on(False)\n\n# Show plot\nfig.tight_layout(rect=(0, 0, 1.8, 1))\nplt.show();","523b04af":"# Mastercard Credit\nvalues_mastercard_credit = (cardlabels_grouped[\"mastercard\"][\"credit\"][0], cardlabels_grouped[\"mastercard\"][\"credit\"][1])\nlabels_mastercard_credit = ('Legitimate', 'Fraudulent')\ncolors_mastercard_credit = ('#83B8AE','#F46460')\n\n# Mastercard Debit\nvalues_mastercard_debit = (cardlabels_grouped[\"mastercard\"][\"debit\"][0], cardlabels_grouped[\"mastercard\"][\"debit\"][1])\nlabels_mastercard_debit = ('Legitimate', 'Fraudulent')\ncolors_mastercard_debit = ('#83B8AE','#F46460')\n\n# Visa Credit\nvalues_visa_credit = (cardlabels_grouped[\"visa\"][\"credit\"][0], cardlabels_grouped[\"visa\"][\"credit\"][1])\nlabels_visa_credit = ('Legitimate', 'Fraudulent')\ncolors_visa_credit = ('#83B8AE','#F46460')\n\n# Visa Debit\nvalues_visa_debit = (cardlabels_grouped[\"visa\"][\"debit\"][0], cardlabels_grouped[\"visa\"][\"debit\"][1])\nlabels_visa_debit = ('Legitimate', 'Fraudulent')\ncolors_visa_debit = ('#83B8AE','#F46460')\n\n# Pie charts\nfig, ax = plt.subplots(1,4)\nfig.tight_layout(rect=(0, 0, 2, 1))\nax[0].set_title(\"Mastercard Credit\")\nax[0].pie(values_mastercard_credit, labels = labels_mastercard_credit, colors = colors_mastercard_credit, autopct = \"%1.0f%%\", startangle=70)\nax[1].set_title(\"Mastercard Debit\")\nax[1].pie(values_mastercard_debit, labels = labels_mastercard_debit, colors = colors_mastercard_debit, autopct = \"%1.0f%%\", startangle=70)\n\nax[2].set_title(\"Visa Credit\")\nax[2].pie(values_visa_credit, labels = labels_visa_credit, colors = colors_visa_credit, autopct = \"%1.0f%%\", startangle=70)\nax[3].set_title(\"Visa Debit\")\nax[3].pie(values_visa_debit, labels = labels_visa_debit, colors = colors_visa_debit, autopct = \"%1.0f%%\", startangle=70);","1c6b6de1":"## 2.2 Transaction dataset","2f84627f":"## 2.3 Identity dataset","72727151":"### 2.9.1 Absolute frequencies of Fraudulent and Legitimate transactions","7be54e92":"## 1.3 Supervised Machine Learning applied to Fraud Detection","a1939e98":"- **Input data:** We are going to explore the provided datasets - Transaction and Identity.\n- **ML generates features:** We are going to generates and analyse our final features by joining Transaction and Identity.\n\n- **Train algorithm:** After previous stages the machine learning algorithm uses data described by our final features to learn how to make predictions about the probability that an online transaction is fraudulent.\n- **Create model:** When training is complete we have a specific model for our fraud prevention system, which can detect the probability of fraud in a few seconds.<br><br>\n\nIn our **Exploratory Data Analysis (EDA)**, we may say that we will only act on the first two stages: **Input data** and **ML generates features**.\n\nAfter \"Train algorithm\" and \"Create model\"  stages the model would have a specific accuracy. The **model accuracy** is the measurement used to determine which model is best at identifying relationships and patterns between variables of the features we generated joining the Input data (Transaction and Identity).\n\nThats why the EDA is so important. The accuracy is related in  mostly because to the understanding, selecting and preparation of data.\n\nHere\u2019s a simple explanation of why accuracy is so important in a fraud detection. In a fraud detection system we will have three options about fraudulent charges:\n\n- **True positives** (how many fraudsters we block)\n\n- **False positives** (how many good people we block)\n\n- **False negatives** (how many fraudsters we allow)","245f3152":"## 2.8 Card Labels and Payment Methods Plots","3532647e":"# 1. Introduction ","843d3fdb":"\ud83d\udcccNote:<br> \n>As a result of not have all corresponding Identity information, we have a huge amount of missing values from **\"id_12\"** to **\"DeviceInfo\"** columns.","79b88aeb":"# 3. Conclusion\n\nAlthough we only did an initial **Exploratory Data Analysis**, we can list some of the many benefits of having EDA always in focus:\n\n- Intuitive data visualization through plots.\n- Find missing values.\n- Look for correlations between datasets.\n- Better understanding of how business process  is performed currently.\n- Better insight into the business issues we intend to solve.","59cfb0f6":"## 2.9 Comparing Fraudulent and Legitimate transactions","e0517607":"**Not all Transactions have corresponding Identity information.**<br>\nWe have a total of 590540 transactions, among then 76% have no Identity information.\n<br><br>\nThis way, important informations from fraudulant or legitimate charges are not available, including:\n* **Operating System (OS)** used in the transaction like *'Windows'* or *'MacOS'*\n\n* **Device Type** used in the transaction like *'Mobile'* or *'Desktop'*\n\n* **Browser** used in the transaction like *'Safari'* or *'Chrome'*","78990806":"## 1.4 Adicional necessary libraries and settings","553b3afd":"## 2.6 Missing Values","4143f9f2":"* Together, the **Visa** and **Mastercard** card labels represent the vast majority of **97.46%** of transactions.\n\n* The **Visa** card label represents almost **2\/3** of transactions.\n\n* Together, the **Credit** and **Debit** payment methods represent almost  **100%** of transactions.\n\n* The **Debit** payment method represent almost **3\/4** of transactions.","3601378e":"## 1.1 About EDA\nThe **Exploratory Data Analysis (EDA)** consists of analyzing data and extracting useful information from them through visualization techniques. In this way, we can understand the nature of the data and formulate some hypotheses about the information that is available.\n\nIn this tutorial, we will learn about how to extract useful informations from datasets. We also will see some basic plots used in the EDA in order to improve our ability to interpret data. We will focus on the analysis of **categorical variables**.","4a868e91":"# 4. References\n[https:\/\/www.kaggle.com\/c\/ieee-fraud-detection](http:\/\/)\n\n[https:\/\/www.ravelin.com\/insights\/machine-learning-for-fraud-detection](http:\/\/)\n\nhttps:\/\/www.analyticsvidhya.com\/blog\/2021\/04\/rapid-fire-eda-process-using-python-for-ml-implementation\/","a38e1da0":"### 2.9.3 A better way to visualize the Proportion of Legitimate and Fraudulent transactions","8c49daa2":"## 2.4 Joining Transaction and Identity datasets\n\nThe Exploratory Data Analysis is unavoidable and one of the major step to fine-tune the given datasets in a different way of analysis. Thus we can understand the insights of the key characteristics of various entities of the dataset like columns and rows. In our aproach we are going to join the two provided datasets in order to understand the informations as a whole.","7b025134":"### 2.9.2 Fraudulent and Legitimate transactions Plots\n\n>As we saw in the previous pie plots, **Visa** and **Mastercard** card labels represent the vast majority of **97.46%** of transactions. So let's take a closer look at them.","bf9a5c7f":"## 2.1 Reading Categorical Variables from provided data\n\n> Transaction ID, Fraud Flag and Timedelta are needed for categorical variables analysis and were also readed.","53094a37":"## 2.5 Joining Conclusion","6cfd37c3":"There are several ways of represent a machine learning. Each of them has a number of different stages. Here\u2019s a simple explanation of how a Supervised Machine Learning System would works.","7e87df2f":"## 1.2 Provided Data used in our EDA\n\nThe data is provided by IEEE-CIS for a competition where data scientists are in charge of predicting the probability that an online transaction is fraudulent, as denoted by the binary target \"isFraud\".  The approach used to make such predictions is called **Supervised Machine Learning**.\n\nAs mentioned, our focus here is not to make these predictions  but to act on the phase that precedes it, called  Exploratory Data Analysis. However, in the next topic we will see in a simplified way how a Supervised Machine Learning works and how it could be applied in identifying fraudulent transactions.\n\nThe data is broken into two files **Identity** and **Transaction**, which are joined by TransactionID. Below, the categorical variables we will use in our Exploratory Data Analysis.\n\n**Categorical Features - Transaction** \n- ProductCD\n- card1 - card6\n- addr1, addr2\n- P_emaildomain\n- R_emaildomain\n- M1 - M9\n\n**Categorical Features - Identity**\n- DeviceType\n- DeviceInfo\n- id_12 - id_38","4d6234f8":">As we have noted, there is a higher proportion of fraudulent transactions in **Credit** charges.","3aaae90e":"# 2. Exploratory Data Analysis","5df63aab":"As will be seen further in our EDA that the vast majority of Transactions are legitimate and we will have few \"True positives\". So we will need an accurary high enough to ensure we are blocking the least possible amount of genuine charges. ","919b25f2":"* At both **Mastercard** and **Visa** we see a predominance of **Debit** transactions.\n\n* The vast majority of transactions are **legitimate**.\n<br><br>\n\n**\ud83d\udcccHowever, we noticed an interesting point:**<br>\n\n> The number of **Credit** transactions is lower but it appears that there is a higher proportion of fraud in this type of transaction. Let's get a better look through the pie plot below.\n","b99cad50":"## 2.7 Card Labels relative frequencies"}}