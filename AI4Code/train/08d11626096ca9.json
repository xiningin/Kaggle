{"cell_type":{"5d81892f":"code","ca097541":"code","c2ac2a81":"code","0d7953d7":"code","6c55c5b1":"code","3b42bcf1":"code","5ac4fdbe":"code","420f0019":"code","790490e0":"code","3dd40e6a":"code","82c78be6":"code","c8e2d94f":"code","6fc686c6":"code","de9a1634":"code","42300297":"code","87b51fe5":"code","c814bcf8":"code","c50f7d7d":"code","d8e8f82c":"code","19fe348f":"code","eada4148":"code","adbec245":"code","9d2a107f":"code","cadeeea7":"markdown","cc4bc9a1":"markdown","8a175dae":"markdown","0ffa7bde":"markdown","6c4c8ffe":"markdown","589f5a35":"markdown","223d55c5":"markdown","b0c6100e":"markdown","24f0dd5d":"markdown","d27735d4":"markdown","1c7b8644":"markdown","8247f0f1":"markdown","ac744d7e":"markdown","fc15fafc":"markdown","9a036a9f":"markdown","f0cd9440":"markdown","528c5efb":"markdown","7de72a25":"markdown","d0bd45cc":"markdown","8a51b5fe":"markdown","5f5685ad":"markdown","7a40d34a":"markdown","9358e24e":"markdown","77cd88b9":"markdown"},"source":{"5d81892f":"import numpy as np # linear algebra\nimport pandas as pd\npd.set_option(\"display.max_rows\", 100)\nimport os\nprint(os.listdir(\"..\/input\"))\nimport cv2\nimport json\nimport matplotlib.pyplot as plt\n%matplotlib inline\nplt.rcParams[\"font.size\"] = 14\nimport seaborn as sns\nfrom collections import Counter\nfrom PIL import Image\nimport math\nimport seaborn as sns\nfrom collections import defaultdict\nfrom pathlib import Path\nimport cv2\nfrom tqdm import tqdm","ca097541":"train_df = pd.read_csv(\"..\/input\/understanding_cloud_organization\/train.csv\")\nsample_df = pd.read_csv(\"..\/input\/understanding_cloud_organization\/sample_submission.csv\")","c2ac2a81":"train_df.head()","0d7953d7":"print(f'There are {train_df.shape[0]} records in train.csv')","6c55c5b1":"train_df['Image_Label'].apply(lambda x : x.split('_')[1]).value_counts().plot(kind='bar')","3b42bcf1":"len_train = len(os.listdir(\"..\/input\/understanding_cloud_organization\/train_images\"))\nlen_test = len(os.listdir(\"..\/input\/understanding_cloud_organization\/test_images\"))\nprint(f'There are {len_train} images in train dataset')\nprint(f'There are {len_test} images in test dataset')","5ac4fdbe":"len(train_df[train_df['EncodedPixels'].isnull()])","420f0019":"train_df.loc[train_df['EncodedPixels'].isnull(), 'Image_Label'].apply(lambda x: x.split('_')[1]).value_counts().plot(kind=\"bar\")","790490e0":"train_df.loc[train_df['EncodedPixels'].isnull() == False, 'Image_Label'].apply(lambda x: x.split('_')[1]).value_counts()","3dd40e6a":"train_df.loc[train_df['EncodedPixels'].isnull() == False, 'Image_Label'].apply(lambda x: x.split('_')[0]).value_counts().value_counts().plot(kind=\"bar\")","82c78be6":"from collections import defaultdict\ntrain_size_dict = defaultdict(int)\ntrain_path = Path(\"..\/input\/understanding_cloud_organization\/train_images\/\")\n\nfor img_name in train_path.iterdir():\n    img = Image.open(img_name)\n    train_size_dict[img.size] += 1","c8e2d94f":"train_size_dict","6fc686c6":"test_size_dict = defaultdict(int)\ntest_path = Path(\"..\/input\/understanding_cloud_organization\/test_images\/\")\n\nfor img_name in test_path.iterdir():\n    img = Image.open(img_name)\n    test_size_dict[img.size] += 1","de9a1634":"test_size_dict","42300297":"palet = [(249, 192, 12), (0, 185, 241), (114, 0, 218), (249,50,12)]","87b51fe5":"def name_and_mask(start_idx):\n    col = start_idx\n    img_names = [str(i).split(\"_\")[0] for i in train_df.iloc[col:col+4, 0].values]\n    if not (img_names[0] == img_names[1] == img_names[2] == img_names[3]):\n        raise ValueError\n\n    labels = train_df.iloc[col:col+4, 1]\n    mask = np.zeros((1400, 2100, 4), dtype=np.uint8)\n\n    for idx, label in enumerate(labels.values):\n        if label is not np.nan:\n            mask_label = np.zeros(2100*1400, dtype=np.uint8)\n            label = label.split(\" \")\n            positions = map(int, label[0::2])\n            length = map(int, label[1::2])\n            for pos, le in zip(positions, length):\n                mask_label[pos:(pos+le)] = 1\n            mask[:, :, idx] = mask_label.reshape(1400, 2100, order='F')\n    return img_names[0], mask","c814bcf8":"def show_mask_image(col):\n    name, mask = name_and_mask(col)\n    img = cv2.imread(str(train_path \/ name))\n    fig, ax = plt.subplots(figsize=(15, 15))\n\n    for ch in range(4):\n        contours, _ = cv2.findContours(mask[:, :, ch], cv2.RETR_LIST, cv2.CHAIN_APPROX_NONE)\n        for i in range(0, len(contours)):\n            cv2.polylines(img, contours[i], True, palet[ch], 2)\n    ax.set_title(name)\n    ax.imshow(img)\n    plt.show()","c50f7d7d":"idx_no_class = []\nidx_class_1 = []\nidx_class_2 = []\nidx_class_3 = []\nidx_class_4 = []\nidx_class_multi = []\nidx_class_triple = []\n\nfor col in range(0, len(train_df), 4):\n    img_names = [str(i).split(\"_\")[0] for i in train_df.iloc[col:col+4, 0].values]\n    if not (img_names[0] == img_names[1] == img_names[2] == img_names[3]):\n        raise ValueError\n        \n    labels = train_df.iloc[col:col+4, 1]\n    if labels.isna().all():\n        idx_no_defect.append(col)\n    elif (labels.isna() == [False, True, True, True]).all():\n        idx_class_1.append(col)\n    elif (labels.isna() == [True, False, True, True]).all():\n        idx_class_2.append(col)\n    elif (labels.isna() == [True, True, False, True]).all():\n        idx_class_3.append(col)\n    elif (labels.isna() == [True, True, True, False]).all():\n        idx_class_4.append(col)\n    elif labels.isna().sum() == 1:\n        idx_class_triple.append(col)\n    else:\n        idx_class_multi.append(col)","d8e8f82c":"for idx in idx_class_1[:5]:\n    show_mask_image(idx)","19fe348f":"for idx in idx_class_2[:5]:\n    show_mask_image(idx)","eada4148":"for idx in idx_class_3[:5]:\n    show_mask_image(idx)","adbec245":"for idx in idx_class_4[:5]:\n    show_mask_image(idx)","9d2a107f":"for idx in idx_class_multi[:5]:\n    show_mask_image(idx)","cadeeea7":"## A brief history about the purpose of this competition\n\nIt all started around two years ago at a workshop where 12 cloud experts came together to discuss shallow clouds over the ocean. These clouds look benign compared to big thunderstorms but, in fact, for the Earth\u2019s climate they play a huge role. The reason is that they reflect a lot of sunlight back into space, thereby cooling our planet, while only contributing marginally to the greenhouse effect. This means that it\u2019s really important to figure out how these clouds will change as our planet warms. Current climate models, however, struggle with that. They do not even agree whether there will be more or less of these shallow clouds.\n\n\nPart of the reason is that shallow clouds aren\u2019t just the result of the global circulation of the atmosphere. Rather, they have a life of their own and arrange themselves in a variety of patterns. For many of these patterns, the basic mechanisms behind them are poorly understood. This brings us back to our group of scientists. As they were looking through hundreds of satellite images like the ones shown on this page, they noticed that some structures occur more often than others. After some discussion, they agreed on four common patterns and called them Sugar, Flower, Fish and Gravel.\n\n![](https:\/\/miro.medium.com\/max\/1050\/1*Wz8Rosw9W0VDorCwcLIxkg.png)\n\nSource: Awesome article by Stephan Rasp https:\/\/medium.com\/@raspstephan","cc4bc9a1":"# Images with class 1","8a175dae":"## Images having multiple masks","0ffa7bde":"We have approx 5.5k images in train dataset and they can have up to 4 masks: Fish, Flower, Gravel and Sugar.","6c4c8ffe":"**Dice Coefficient (F1 Score)**\n\nDice coefficient is a statistic used to gauge the similarity of two samples.\n\nSimply put, the Dice Coefficient is 2 * the Area of Overlap divided by the total number of pixels in both images. (See explanation of area of union in section 2).\n\n![](https:\/\/miro.medium.com\/max\/644\/1*yUd5ckecHjWZf6hGrdlwzA.png)","589f5a35":"We can see that there are significant number of images having 2 masks and also a few of them having 4 masks.","223d55c5":"# Images with class 3","b0c6100e":"# Explanation of the evaluation metric","24f0dd5d":"Iterating through all images in Test","d27735d4":"# Vizualizing the masks","1c7b8644":"## Figuring out the total number of images having empty masks.","8247f0f1":"![](https:\/\/storage.googleapis.com\/kaggle-media\/competitions\/MaxPlanck\/Teaser_AnimationwLabels.gif)","ac744d7e":"**Shallow clouds play a huge role in determining the Earth's climate. They\u2019re also difficult to understand and to represent in climate models. By classifying different types of cloud organization, researchers at Max Planck hope to improve our physical understanding of these clouds, which in turn will help us build better climate models.**","fc15fafc":"# Images with class 2","9a036a9f":"Check the size of each image in the dataset by iterating through all the images (in train and test).","f0cd9440":"# Images with multiple classes","528c5efb":"**Please upvote if this is helpful**","7de72a25":"## Checking image size for train and test","d0bd45cc":"# Let's dive in the clouds and explore the data","8a51b5fe":"## Label wise breakdown of empty masks.","5f5685ad":"I devote the credits for the code of this kernel to @GoldFish kernel at [https:\/\/www.kaggle.com\/go1dfish\/clear-mask-visualization-and-simple-eda](https:\/\/www.kaggle.com\/go1dfish\/clear-mask-visualization-and-simple-eda)","7a40d34a":"## Count of labels having mask data","9358e24e":"# Images with class 4","77cd88b9":"## All the images in train and test set have a size 2100*1400"}}