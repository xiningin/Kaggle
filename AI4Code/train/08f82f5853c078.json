{"cell_type":{"5d0a3c06":"code","999293a0":"code","1e6f03a7":"code","38bed3f4":"code","efe1c762":"code","f4fce457":"code","58ed4fdb":"code","32399cbf":"code","fef9f02d":"code","2e93baab":"code","b66bd7b6":"code","2913fa5e":"code","94e0876c":"code","68653d41":"code","2d8ba699":"code","4036e162":"code","d9267de2":"code","bd9102b7":"code","8e97cd1b":"code","7c3e7b6d":"code","d0004c7d":"code","e42a773f":"code","c3e2a7ab":"code","9b328a46":"code","4cd68d37":"code","a28bfdff":"code","25c9a137":"code","3d672052":"code","64ee8f12":"code","7bf2ee71":"code","acf0c9e3":"code","a551c173":"code","3dedf8db":"code","41b0e405":"code","a90fd1bd":"code","c71968e1":"code","a0775ed9":"code","271e3e16":"code","dbdabfc4":"code","1df9cea1":"code","452a743a":"code","517cc3f1":"code","2c199151":"code","56911d8c":"code","b686d31f":"code","7dc375ab":"code","e38ed5ac":"code","74ed09fa":"code","71e0d8da":"code","bb049c78":"code","4fc9eb91":"code","a594ef9d":"code","33e27116":"code","8c81064d":"code","81bba9a8":"code","5894230a":"code","c8e5ef6d":"code","3e27d816":"code","31e27dd2":"code","fb23c566":"code","0c6d5e92":"code","83952831":"code","fa40a7a4":"code","e689ebb9":"code","1bbd8c55":"code","b625d54a":"code","43cc989a":"code","bb1c6247":"code","e840e42e":"code","c40a5e7a":"code","cd4b2b8e":"code","55d4ff80":"code","de2aa6e8":"code","2746fafe":"code","de7ea585":"code","65aded0d":"code","b8cec1ac":"code","089541ac":"code","e77c71cc":"code","50b54b11":"code","f39b5bb9":"code","add8c267":"code","bf6f8e84":"code","26528f9a":"code","0dcd7a25":"code","b840c822":"code","d294dd8d":"code","73ba07d5":"code","84171045":"code","8894a0d4":"code","c3c2799a":"code","fa5666fd":"code","dc07027a":"code","c8f31d58":"code","15f6accb":"code","ca27fb6f":"code","c7293d08":"code","36a9c6b8":"code","37625983":"code","773ea340":"code","4e4a6257":"code","c77401e5":"markdown"},"source":{"5d0a3c06":"import pandas as pd\npd.set_option('display.max_columns', None)\npromo=pd.read_csv('..\/input\/promo-abuse-detection-for-payment-apps\/Promo_Abuse_Detection_Dataset.csv')\npromo.head()","999293a0":"promo.nunique().sort_values(ascending=False)","1e6f03a7":"promo['UserId'].value_counts().sort_values(ascending=False)[:1] #abuse detected","38bed3f4":"promo[promo['UserId']==13341428].head()","efe1c762":"promo.loc[promo['Unnamed: 0'] == 16, \"Target\"] = 0\npromo.loc[promo['Unnamed: 0'] == 17, \"Target\"] = 1\npromo[promo['UserId']==13341428].head()","f4fce457":"promo['Device Id'].value_counts().sort_values(ascending=False)[:1]#abuse detected","58ed4fdb":"fix=promo[promo['Device Id']=='iosvd:++djsadjscior34728128MSASCDMVERww38rmbe8=:2537']\nfix.head()","32399cbf":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","fef9f02d":"promo.loc[promo['Unnamed: 0'] == 950, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Device Id']=='iosvd:++djsadjscior34728128MSASCDMVERww38rmbe8=:2537']","2e93baab":"promo['Ref PC AC Number'].value_counts().sort_values(ascending=False)[:6]#abuse detected","b66bd7b6":"fix=promo[promo['Ref PC AC Number']=='IN312XXXXX1298']\nfix.head()","2913fa5e":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","94e0876c":"promo.loc[promo['Unnamed: 0'] == 656, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN312XXXXX1298']","68653d41":"fix=promo[promo['Ref PC AC Number']=='IN312XXXXX1299']\nfix.head()","2d8ba699":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","4036e162":"promo.loc[promo['Unnamed: 0'] == 666, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN312XXXXX1299']","d9267de2":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1188']\nfix.head()","bd9102b7":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","8e97cd1b":"promo.loc[promo['Unnamed: 0'] == 19, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1188']","7c3e7b6d":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1190']\nfix.head()","d0004c7d":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","e42a773f":"promo.loc[promo['Unnamed: 0'] == 678, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1190']","c3e2a7ab":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1186']\nfix.head()","9b328a46":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","4cd68d37":"promo.loc[promo['Unnamed: 0'] == 18, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1186']","a28bfdff":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1185']\nfix.head()","25c9a137":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","3d672052":"promo.loc[promo['Unnamed: 0'] == 658, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1185']","64ee8f12":"promo['Name']=promo['FirstName']+' '+promo['LastName']\npromo.nunique().sort_values(ascending=False)","7bf2ee71":"promo=promo.drop(['FirstName','LastName'],axis=1)\npromo.head()","acf0c9e3":"promo['Name'].value_counts().sort_values(ascending=False)[:6]#abuse detected","a551c173":"fix=promo[promo['Name']=='amit kumar']\nfix.head()","3dedf8db":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","41b0e405":"promo.loc[promo['Unnamed: 0'] == 595, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='amit kumar']","a90fd1bd":"fix=promo[promo['Name']=='akash gupta']\nfix.head()","c71968e1":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","a0775ed9":"promo.loc[promo['Unnamed: 0'] == 822, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='akash gupta']","271e3e16":"fix=promo[promo['Name']=='rohit kumar']\nfix.head()","dbdabfc4":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","1df9cea1":"promo.loc[promo['Unnamed: 0'] == 886, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='rohit kumar']","452a743a":"fix=promo[promo['Name']=='raman ralhan']\nfix.head()","517cc3f1":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","2c199151":"promo.loc[promo['Unnamed: 0'] == 456, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='raman ralhan']","56911d8c":"fix=promo[promo['Name']=='sunil kumar']\nfix.head()","b686d31f":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","7dc375ab":"promo.loc[promo['Unnamed: 0'] == 490, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='sunil kumar']","e38ed5ac":"round(promo.Name.isnull().sum()*100\/len(promo),2)","74ed09fa":"promo[['Name']]=promo[['Name']].fillna('Unknown')\nfix=promo[promo['Name']=='Unknown']#abuse detected as posssibility of hacker expected.\nfix.head()","71e0d8da":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)\nlen(i)","bb049c78":"for j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo.head()","4fc9eb91":"round(promo.Target.isnull().sum()*100\/len(promo),2)","a594ef9d":"promo.Target=promo.Target.fillna(0)\nround(promo.Target.value_counts()*100\/len(promo),2)","33e27116":"promo[['Sim_OS','Sim_Info','Sim_User']] = promo['Sim Id'].str.split(':',expand=True)\npromo.head()","8c81064d":"promo[['Device_OS','Device_Info','Device_User']] = promo['Device Id'].str.split(':',expand=True)\npromo.head()","81bba9a8":"promo=promo.drop(['Device Id','Sim Id'],axis=1)\npromo.head()","5894230a":"promo[['LastLoginTime','PresentLoginTime']].info()","c8e5ef6d":"promo['LastLoginTime']=promo['LastLoginTime'].replace('01-01-1900 00:00','00:00:00')\npromo['LastLoginTime'].unique()","3e27d816":"promo[['LastLoginTime_HH','LastLoginTime_MM','LastLoginTime_SS']] = promo['LastLoginTime'].str.split(':',expand=True)\npromo.head()","31e27dd2":"promo[['PresentLoginTime_HH','PresentLoginTime_MM','PresentLoginTime_SS']] = promo['PresentLoginTime'].str.split(':',expand=True)\npromo.head()","fb23c566":"promo=promo.drop(['LastLoginTime','PresentLoginTime'],axis=1)\npromo.head()","0c6d5e92":"promo[['Meta Data_1','Meta Data_2','Meta Data_3','Meta Data_4']] =promo['Meta Data'].str.split('-',expand=True)\npromo.head()","83952831":"promo[['Email_user','Email_Domain']] =promo['Email'].str.split('@',expand=True)\npromo.head()","fa40a7a4":"promo=promo.drop(['Email','Meta Data'],axis=1)\npromo.head()","e689ebb9":"promo[['Reg Client IP_1','Reg Client IP_2','Reg Client IP_3','Reg Client IP_4']] =promo['Reg Client IP'].str.split('.',expand=True)\npromo.head()","1bbd8c55":"promo=promo.drop(['Unnamed: 0','Reg Client IP'],axis=1)\npromo.head()","b625d54a":"promo.nunique().sort_values(ascending=False)","43cc989a":"promo=promo.drop(['ProgramId','ProgramName','Meta Data_1','Meta Data_3','Status','Email_Domain','BadTryCount'],axis=1)\npromo.head()","bb1c6247":"promo['Reg Referral Code']=promo['Reg Referral Code'].str.strip().str[-3:]\npromo['Reg Referral Code'].head()","e840e42e":"promo['RegisteredOn']=pd.to_datetime(promo['RegisteredOn'])\npromo['Dob']=pd.to_datetime(promo['Dob'])\npromo.head()","c40a5e7a":"promo.info()","cd4b2b8e":"promo[['UserId','Mobile','PostalCode']]=promo[['UserId','Mobile','PostalCode']].astype(object)\npromo.info()","55d4ff80":"promo.nunique().sort_values(ascending=False)","de2aa6e8":"promo.columns","2746fafe":"promo.info()","de7ea585":"(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","65aded0d":"promo[['Reg Referral Code','Reg Referral Prefix']]=promo[['Reg Referral Code',\n                                                                 'Reg Referral Prefix']].fillna('Unknown')\n(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","b8cec1ac":"promo.Gender.value_counts()","089541ac":"promo['Gender']=promo['Gender'].fillna('U')\n(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","e77c71cc":"promo.nunique().sort_values(ascending=False)","50b54b11":"promo.Name.value_counts()[:5]","f39b5bb9":"!pip install pycaret","add8c267":"promo.nunique().sort_values(ascending=False)*100\/len(promo)","bf6f8e84":"promo.columns\n","26528f9a":"promo.info()","0dcd7a25":"promo.nunique().sort_values(ascending=False)","b840c822":"!pip install pandas-profiling","d294dd8d":"from pandas_profiling import ProfileReport\nProfileReport(promo, title=\"EDA Report\")","73ba07d5":"data = promo.sample(frac=0.8, random_state=42)\ndata_unseen = promo.drop(data.index)\ndata.reset_index(inplace=True, drop=True)\ndata_unseen.reset_index(inplace=True, drop=True)\nprint('Data for Modeling: ' + str(data.shape))","84171045":"print('Unseen Data For Predictions: ' + str(data_unseen.shape))","8894a0d4":"from pycaret.classification import *\npromo= setup(data =data, session_id=42,\n             target = 'Target',\n                  normalize = True, \n                  transformation = True, \n                  log_experiment = True,\n                  remove_multicollinearity = True, #rop one of the two features that are highly correlated with each other\n                  date_features=['RegisteredOn','Dob'],\n            categorical_features=[ 'Gender', 'UserId', 'Mobile', 'PostalCode',\n       'OS Type', 'Reg Referral Code', 'Reg Referral Prefix',\n       'Ref PC AC Number', 'Name', 'Sim_OS', 'Sim_Info', 'Sim_User',\n       'Device_OS', 'Device_Info', 'Device_User', 'LastLoginTime_HH',\n       'LastLoginTime_MM', 'LastLoginTime_SS', 'PresentLoginTime_HH',\n       'PresentLoginTime_MM', 'PresentLoginTime_SS', 'Meta Data_2',\n       'Meta Data_4', 'Email_user', 'Reg Client IP_1', 'Reg Client IP_2',\n       'Reg Client IP_3', 'Reg Client IP_4'],\n            high_cardinality_features =[ 'UserId', 'Mobile', 'PostalCode',\n       'OS Type', 'Reg Referral Code',\n       'Ref PC AC Number', 'Name', 'Sim_User',\n        'Device_User', 'LastLoginTime_HH',\n       'LastLoginTime_MM', 'LastLoginTime_SS', 'PresentLoginTime_HH',\n       'PresentLoginTime_MM', 'PresentLoginTime_SS',\n       'Meta Data_4', 'Email_user', 'Reg Client IP_1', 'Reg Client IP_2',\n       'Reg Client IP_3', 'Reg Client IP_4']  ,         \n            train_size = 0.8)","c3c2799a":"catboost = create_model('catboost')","fa5666fd":"print(catboost)","dc07027a":"tuned_catboost = tune_model(catboost,optimize = 'AUC')","c8f31d58":"plot_model(tuned_catboost, plot = 'auc')","15f6accb":"plot_model(tuned_catboost, plot = 'pr')","ca27fb6f":"plot_model(tuned_catboost, plot='feature')","c7293d08":"plot_model(tuned_catboost, plot = 'confusion_matrix')","36a9c6b8":"evaluate_model(tuned_catboost)","37625983":"predict_model(tuned_catboost)","773ea340":"unseen_predictions = predict_model(tuned_catboost, data=data_unseen)\nunseen_predictions.head()","4e4a6257":"print(\"Confidence Score :   {}\".format(round(unseen_predictions.Score.mean(),2)))#Confidence Score","c77401e5":"There are few considerations , we are working with.\n- A device can be use once\n- Cashback to same account more than once is an abuse\n- Name with same email ID is an abuse"}}