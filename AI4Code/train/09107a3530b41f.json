{"cell_type":{"17c49bad":"code","63dd5247":"code","1bab4b02":"code","d6f452c3":"code","b8171d83":"code","f27080aa":"code","70f52e94":"code","b95dad65":"code","e300dabb":"code","cac55d66":"code","6093a6ec":"code","0d537211":"code","81a96c47":"code","c6d69932":"code","d10aee38":"code","274d4104":"code","22375860":"code","1955f350":"code","8dddbb40":"code","ea6f54ae":"code","1dd17b1d":"code","b0369385":"code","0f3405d1":"code","e695853c":"code","2efb20c1":"code","85f2224c":"code","e1370295":"code","eea9f2d3":"code","49b96006":"code","3d3118bb":"code","38d4ca9e":"code","ecb3b075":"markdown","e8dd3586":"markdown","58b4b026":"markdown","d87b8205":"markdown","4d18f4df":"markdown","a6307421":"markdown","5f17e5b5":"markdown","6ccfd0cc":"markdown","61126896":"markdown","4437dbda":"markdown","e23eb3d5":"markdown","971bdb34":"markdown","5bf33c94":"markdown","4bf7b34e":"markdown","730ce83a":"markdown","6db16fd1":"markdown","79088040":"markdown"},"source":{"17c49bad":"!pip3 uninstall --yes fbprophet\n!pip3 install fbprophet --no-cache-dir --no-binary :all:","63dd5247":"import os\nimport warnings\nwarnings.filterwarnings('ignore')\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nplt.style.use('fivethirtyeight')\n\n%matplotlib inline\nfrom plotly import tools\nimport plotly.plotly as py\nfrom plotly.offline import init_notebook_mode, iplot\ninit_notebook_mode(connected=True)\nimport plotly.graph_objs as go\nfrom scipy.stats import norm\nimport datetime as dt\nfrom fbprophet import Prophet","1bab4b02":"all_stocks = pd.read_csv('..\/input\/all_stocks_5yr.csv', index_col = 'date', parse_dates=['date'])\nall_stocks.head()","d6f452c3":"apple = all_stocks[all_stocks['Name'] == 'AAPL']\napple.head()","b8171d83":"apple.info()","f27080aa":"apple.describe()","70f52e94":"apple['2014':'2017'].plot(subplots=True, figsize=(10, 12))\nplt.title('Apple stock attributes from 2014 to 2017')","b95dad65":"amazon = all_stocks[all_stocks['Name'] == 'AMZN']\namazon.head()","e300dabb":"apple.high.plot()\namazon.high.plot()\nplt.legend(['Apple', 'Amazon'])","cac55d66":"norm_apple = apple.high.div(apple.high.iloc[0]).mul(100)\nnorm_amazon = amazon.high.div(amazon.high.iloc[0]).mul(100)\nnorm_apple.plot()\nnorm_amazon.plot()\nplt.legend(['Apple', 'Amazon'])","6093a6ec":"trace = go.Ohlc(x = apple.index,\n               open = apple['open'],\n               high = apple['high'],\n               low = apple['low'],\n               close = apple['close'])\n\nlayout = {\n    'xaxis': {\n        'title':'Date',\n        'rangeslider':{'visible':False}\n    },\n    'yaxis': {\n        'title':'Price in US Dollars'\n    },\n    'shapes': [{\n        'x0': '2016-11-08', 'x1': '2016-11-08',\n        'y0': 0, 'y1': 1, 'xref': 'x', 'yref': 'paper',\n        'line': {'color': 'rgb(30,30,30)', 'width': 1}\n    }],\n    'annotations': [{\n        'x':'2016-11-08', 'y':0.05, 'xref':'x', 'yref':'paper', 'showarrow':False, 'text': 'US Presidential Election'\n    }]\n}\n\ndata = [trace]\nfig = go.Figure(data = data, layout = layout)\niplot(fig)","0d537211":"apple['close_std'] = apple['close'].rolling(5).std()\napple['close_mean'] = apple['close'].rolling(5).mean()\n\nfig, (std, avg) = plt.subplots(1, 2, figsize=(16, 8))\nstd.plot(apple.index, apple['close_std'], label='5 day Standard Deviation')\nstd.legend()\n\navg.plot(apple.index, apple['close_mean'], label='5 Day Moving Average', color='green')\navg.plot(apple.index, apple['close'].rolling(20).mean(), label='20 Day Moving Average', color='red')\navg.legend()","81a96c47":"apple_two = apple['2016':'2018']\napple_two = apple_two.reset_index()\napple_two.head()","c6d69932":"apple_monthly = apple_two.groupby(['date'])","d10aee38":"agg = apple_monthly.aggregate({'open':np.mean, 'high':np.mean, 'low':np.mean, 'close':np.mean})\nagg = agg.reset_index()\nagg.head()","274d4104":"trace = go.Candlestick(x = agg['date'],\n                      open = agg['open'].values.tolist(),\n                      high = agg['high'].values.tolist(),\n                      low = agg['low'].values.tolist(),\n                      close = agg['close'].values.tolist()\n                      )\nlayout = {\n    'title':'Apple Stock from 2016 to 2018',\n    'xaxis': {'title':'Date',\n             'rangeslider':{'visible':False}},\n    'yaxis':{'title':'Price in US Dollars'}\n}\n\n\ndata = [trace]\n\n\nfig_candle = go.Figure(data, layout)\niplot(fig_candle)","22375860":"apple_2018 = apple['2018']\napple_2018 = apple_2018.reset_index()\napple_2018.head()","1955f350":"apple_m = apple_2018.groupby(['date'])\nagg_m = apple_m.aggregate({'open':np.mean, 'close':np.mean, 'high':np.mean, 'low':np.mean})\nagg_m = agg_m.reset_index()\n\ntrace = go.Candlestick(x = agg_m['date'],\n                       open = agg_m['open'],\n                       high = agg_m['high'],\n                       low = agg_m['low'],\n                       close = agg_m['close']\n                      )\n\ndata = [trace]\n\nlayout = {\n    'title':'Closer look at Apple Stock for downward trend',\n    'xaxis': {'title':'Date',\n             'rangeslider':{'visible':False}},\n    'yaxis':{'title':'Price in US Dollars'}\n}\n\nfig_candle1 = go.Figure(data=data, layout=layout)\niplot(fig_candle1)","8dddbb40":"apple.head()","ea6f54ae":"model = Prophet()\nph_apple = apple.drop(['open', 'high', 'low', 'volume', 'Name', 'close_std', 'close_mean'], axis=1)\n\nph_apple = ph_apple.reset_index()","1dd17b1d":"ph_apple.head()","b0369385":"ph_apple = ph_apple.rename(columns = {'close':'y', 'date':'ds'})","0f3405d1":"model.fit(ph_apple)","e695853c":"future = model.make_future_dataframe(periods=365)\nfuture.tail()","2efb20c1":"forecast = model.predict(future)","85f2224c":"forecast[['ds', 'yhat', 'yhat_upper', 'yhat_lower']].tail()","e1370295":"fig1 = model.plot(forecast)","eea9f2d3":"from fbprophet.plot import add_changepoints_to_plot\nfig1 = model.plot(forecast)\na = add_changepoints_to_plot(fig1.gca(), model, forecast)","49b96006":"fig2 = model.plot_components(forecast)","3d3118bb":"model = Prophet(changepoint_prior_scale=0.05).fit(ph_apple)\nfuture_m = model.make_future_dataframe(periods=12, freq='M')\nm_forecast = model.predict(future_m)\nfig1 = model.plot(m_forecast)\nplt.title('Monthly Predictions (1 year timeframe)')","38d4ca9e":"fig2 = model.plot_components(m_forecast)","ecb3b075":"We can also analyze the points where the trend changes by calling the add_changepoints_to_plot method.\n\nBy default changepoints are only inferred for the first 80% of the time series in order to have plenty of runway for projecting the trend forward and to avoid overfitting fluctuations at the end of the time series. ","e8dd3586":"## Using Prophet for Time-Series Data\n\n### Introduction:\nIn this kernel we will predict stock prices using Prophet, Facebook's library for time series prediction. \n\n### About Prophet:\nProphet is Facebook's way to make time-series prediction simpler. \n\nProphet is used across Facebook for goal setting and planning.\n\nIt can be used effectively in the following situations:\n\n1. Non-linear trends with yearly, weekly and daily seasonality\n2. Time series with strong seasonal effect\n3. Datasets with several seasons of historical data\n\nIt is a useful tool since the syntax is very similar to scikit-learn methods and can handle misssing data and outliers well.\n\nMore about Prophet: https:\/\/facebook.github.io\/prophet\/","58b4b026":"<a id='references'><\/a>","d87b8205":"#### Normalizing the stock prices ","4d18f4df":"<a id='stock-charts'><\/a>","a6307421":"#### Comparing stock prices of Apple and Amazon (not normalized prices)","5f17e5b5":"### Contents:\n\n### <a href='#stock-charts'>1. Stock Charts <\/a>\n    \n### <a href='#prophet'>2. Time Series Analysis with Prophet<\/a>\n\n### <a href='#references'>3. References <\/a>","6ccfd0cc":"The Apple stock price goes down in January. Let us look at that closely.","61126896":"### Monthly Prediction","4437dbda":"Prophet works best with datasets with high degree of seasonality, however, my aim with this is kernel is to use it for simple forecasting and show how simple it is to use Prophet.\n\n#### Data manipulation for Prophet:\n\n1. input is always a dataframe with two columns 'y' and 'ds'.\n2. y is the numeric quantity you want to forecast\n3. ds is the datestamp column and accepted dateformat is YYYY-MM-DD\n","e23eb3d5":"#### OHLC Chart for Apple","971bdb34":"### OHLC and Candlestick Chart:\nOHLC, or open-high-low-close, charts are a type of bar chart that shows open, high, low, and closing prices. Unlike line charts, OHLC charts enable technical analysts to evaluate intraday volatility and see where prices opened and closed. \n(https:\/\/www.investopedia.com\/terms\/o\/ohlcchart.asp)\n\nTraders use the candlesticks to make trading decisions based on regularly occurring patterns that help forecast the short-term direction of the price.\n(https:\/\/www.investopedia.com\/trading\/candlestick-charting-what-is-it\/)\n\n\n<img src=\"https:\/\/mr-uploads.s3.amazonaws.com\/uploads\/2014\/11\/bar-and-candle-1.png\">","5bf33c94":"### 1. Stock Charts","4bf7b34e":"### References\n\n1. https:\/\/www.kaggle.com\/thebrownviking20\/everything-you-can-do-with-a-time-series\n2. https:\/\/www.kaggle.com\/janiobachmann\/s-p-500-time-series-forecasting-with-prophet\/data","730ce83a":"### Time Series with Prophet ","6db16fd1":"<a id=\"prophet\"><\/a>","79088040":"### Insights:\n   - There is an upward trend for the stock price since a dip in mid-2016. \n   - There is no weekly trend \n   - During June, Apple stock increases since June is the time for the Apple WWDC. There is a minor increase in August-September also, probably due to anticipation of the new iPhones. There is a spike again in October-November, since Apple launches its new iPhones in that timeframe. Also, Black Friday is in November and that gives a boost to Apple product sales.\n   - Stock price goes down in January-February. "}}