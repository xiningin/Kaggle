{"cell_type":{"65771c00":"code","8a790ff2":"code","5b218eb0":"code","a35758f6":"code","4c7cb3a7":"code","81765ec2":"code","ba77b37b":"code","f1bceaf1":"code","4d0bf4a3":"code","eff85081":"code","eadf5045":"code","ef6a57dc":"code","d6de7a6e":"markdown","17f64e6d":"markdown","f3f0d0f4":"markdown","243ea265":"markdown","05d13773":"markdown","d3c4b0b4":"markdown","fa88d996":"markdown","0b55a1bf":"markdown","65221bc7":"markdown","0de6379f":"markdown","e8af110b":"markdown","7e0edfcc":"markdown","903ff762":"markdown","dee5cfd4":"markdown","91ae3f03":"markdown","f5230a1b":"markdown","eecc03cf":"markdown","95f0e844":"markdown","ab89a2d9":"markdown","c7afe0df":"markdown","f16471ad":"markdown","08d8594a":"markdown"},"source":{"65771c00":"import os\nimport math\nimport time\nimport numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.style as style\nimport matplotlib.pyplot as plt\n\nPATH_root = '\/kaggle\/input\/' # --> '\/world-data-by-country-2020'\n# os.chdir(PATH_root) # os.listdir()\n\ndf = pd.read_csv( PATH_root+'\/competitions-shakeup\/df_Elo.csv')","8a790ff2":"df_dn = df[df['Shake'] <0]['Shake']\ndf_up = df[df['Shake']>=0]['Shake']\ndf_stats = df['Shake'].describe()\ndf_len, df_mean, df_median, df_std, df_min, df_max = df_stats[0], df_stats[1], df_stats[5], df_stats[2], df_stats[3], df_stats[-1]\nlabels = ['Shake-up', 'No-Shake', 'Shake-down']\n\n# --------- Mean and median extraction -------- #\ndf_up_g = df[df['Shake']>0]['Shake']\ndf_eq = df[df['Shake']==0]['Shake']\ndf_up_mean, df_up_median = np.mean( df_up ), np.median( df_up )\ndf_dn_mean, df_dn_median = np.mean( df_dn ), np.median( df_dn )\n\ndf_dn_len, df_eq_len, df_up_g_len = len(df_dn), len(df_eq), len(df_up_g)\nsizes = pd.Series([df_up_g_len, df_eq_len, df_dn_len])*100\/df_len\n\nexplode = (0.02, 0.2, 0.02)\ncolors = ['#66b3ff','#99ff99', '#ff9999']\n\nfig, ax = plt.subplots( figsize=(8, 8) )\nax.pie(sizes, explode=explode, labels=labels, colors=colors, autopct='%1.2f%%', shadow=True, startangle=-110, \n        labeldistance=1.1, pctdistance=0.6, radius=1, textprops={'fontsize': 20})\n\n# Equal aspect ratio ensures that pie is drawn as a circle\nax.axis('equal')\nplt.tight_layout()\nplt.show()","5b218eb0":"print('Total participants : ', int(df_len))\nprint('Range : [', int(df_min),',', int(df_max),']')\nprint(f'Mean : {df_mean:.2f}')\nprint('Median : ', int(df_median))\nprint(f'STD : {df_std:.2f}')","a35758f6":"rug_kws={\"color\": \"g\"}\nkde_kws={\"color\": \"k\", \"lw\": 3, \"label\": \"KDE\"}\nhist_kws={\"linewidth\": 4, \"alpha\": 0.75, \"color\": \"g\"}\nsns.set(style=\"white\", palette=\"muted\", color_codes=True)\n\nbins_num, df_len = 50, len(df)\nplt.figure(figsize=(15, 6))\n\nax = plt.gca()\nax.set_facecolor('#fffccc')\nsns.set(font_scale = 1.5)\nsns.set_style('whitegrid')\nsns.distplot(df['Shake'], color=\"blue\", kde=False, hist=True, bins=bins_num, label='Shake', kde_kws=kde_kws, rug_kws=rug_kws, hist_kws=hist_kws)\n\nplt.title('Shake Histogram ( bin-width = '+str(int(df_len\/bins_num))+' places )', fontsize = 20) \nplt.grid(linestyle='-', linewidth=1.25)\nplt.xlabel('$\\Delta LB$', fontsize = 20)\nplt.ylabel('Frequency', fontsize = 20)\nplt.xlim([-500, 500])\nplt.xticks(fontsize=18)\nplt.yticks(fontsize=18)\nplt.axvline(x=df_mean, label='Mean', c='k', linestyle='dashed', linewidth=3.5)\nplt.axvline(x=df_median, label='Median', c='k', linestyle='-', linewidth=2.5)\nplt.legend(fontsize = 18)\nplt.show()","4c7cb3a7":"rug_kws={\"color\": \"g\"}\nkde_kws={\"color\": \"k\", 'linestyle':'--', \"lw\": 4, \"label\": \"KDE\"}\nhist_kws={\"linewidth\": 3.5, \"alpha\": 0.75, \"color\": \"g\"}\nsns.set(style=\"white\", palette=\"muted\", color_codes=True)\n\nbins_num = 100\nplt.figure(figsize=(15, 7))\n\nax = plt.gca()\nax.set_facecolor('#fffccc')\nsns.set(font_scale = 1.5)\nsns.set_style('whitegrid')\nsns.distplot(df['Shake'], color=\"blue\", kde=True, hist=True, bins=bins_num, label='Shake', kde_kws=kde_kws, rug_kws=rug_kws, hist_kws=hist_kws)\n\n\nplt.title('Shake PDF ( bin-ratio = '+str( np.round( 100\/bins_num, 3 ))+' [%] )', fontsize = 20) \nplt.grid(linestyle='-', linewidth=1.0)\nplt.xlabel('$\\Delta LB$', fontsize = 20)\nplt.ylabel('Density (KDE)', fontsize = 20)\nplt.xlim([-1000, 1100])\n# plt.xlim([df_min*0.6, df_max*0.7])\nplt.xticks(fontsize=18)\nplt.yticks(fontsize=18)\nplt.legend(fontsize = 18)\nplt.show()","81765ec2":"df_hist = np.histogram( df['Shake'], bins=1000 )\n\nRange = [[-29, 29], [-143, 143], [-369, 369]]\n\nfor i,t in enumerate( Range ):\n    x_min, x_max = Range[i][0], Range[i][1]\n    a = df_hist[1] > x_min\n    b = df_hist[1] < x_max\n    prob_tot = df_hist[1][ a & b ]\n    prob_min, prob_max = np.min(prob_tot), np.max(prob_tot)\n    prob_min_s, prob_max_s = str(int(prob_min)), str(int(prob_max))\n    prob_CDF = str( np.round( 100*( df_hist[0][ (a & b)[:-1]] \/ df_len ).sum() , 3) )\n    print('P('+ prob_min_s+ ' <= X <= '+ prob_max_s+ ') = '+ prob_CDF+ ' [%]')","ba77b37b":"plt.figure(figsize=(15, 7))\nax = plt.gca()\nax.set_facecolor('#fffef0')\nsns.set(font_scale = 1.5)\nsns.set_style('whitegrid')\nhist_b={\"linewidth\": 2, \"alpha\": 0.75, \"color\": \"b\"}\nhist_r={\"linewidth\": 2, \"alpha\": 0.75, \"color\": \"r\"}\n\n# ----------- Mean and median lines ----------- #\nplt.axvline(x=df_up_median, label='SU-Median', c='b', linestyle='dashed', linewidth=3.5, alpha=0.8)\nplt.axvline(x=df_dn_median, label='SD-Median', c='r', linestyle='dashed', linewidth=3.5, alpha=0.8)\nplt.axvline(x=df_up_mean, label='SU-Mean', c='b', linestyle='-', linewidth=3, alpha=0.6)\nplt.axvline(x=df_dn_mean, label='SD-Mean', c='r', linestyle='-', linewidth=3, alpha=0.6)\nplt.legend(fontsize = 18)\nsns.distplot(df_up, color=\"blue\", kde=True, bins=90, label='Shake-up', kde_kws=dict(linewidth=0), hist_kws=hist_b)\nsns.distplot(df_dn, color=\"red\", kde=True, bins=150, label='Shake-down', kde_kws=dict(linewidth=0), hist_kws=hist_r)\n\n# --------------------------------------------- #\nplt.title(\"Shake Histogram\", fontsize = 25)\nplt.ylabel('Frequency', fontsize = 20)  #  Density (KDE)\nplt.xlabel('$\\Delta LB$', fontsize = 20)\nplt.grid(linestyle='-', linewidth=1.0)\nplt.xlabel('$\\Delta LB$', fontsize = 20)\nplt.ylabel('Density (KDE)', fontsize = 20)\nplt.xlim([-600, 600])\n# plt.xlim([df_min*0.3, df_max*0.35])\nplt.xticks(fontsize=18)\nplt.yticks(fontsize=18)\nplt.show()","f1bceaf1":"print( '# -------- Shake-up ------- #')\nprint( 'Median =  %d     Mean =  %.2f' %(int(df_up_median), df_up_mean))\nprint( '\\n# -------- Shake-down ----- #')\nprint( 'Median = %d     Mean = %.2f' %(int(df_dn_median), df_dn_mean))","4d0bf4a3":"plt.figure(figsize=(16, 8))\nax = plt.gca()\nax.set_facecolor('#fffef0')\n\nDf_up = df[df['Shake']>=0]\nDf_dn = df[df['Shake']<0]\n\nplt.scatter( Df_up['Rank_public'], Df_up['Rank_private'], label='Shake-up', s=65, c='b', alpha=1, linewidths=1, edgecolors='w')\nplt.scatter( Df_dn['Rank_public'], Df_dn['Rank_private'], label='Shake-down', s=65, c='r', alpha=0.8, linewidths=1, edgecolors='w')\nplt.legend(fontsize = 22, loc='lower right')\n\nh_medal = np.round( 0.1*df_len )\nplt.hlines(y=h_medal, xmin=0, xmax=0.8*df_len, color='k', linestyle='dashed', linewidth=2.5, alpha=0.6)\nplt.axvline(x=h_medal, label='Medals', c='k', alpha=0.5, linestyle='dashed', linewidth=2.5)\n\n# --------------------------------------------- #\nplt.title('Private rank vs. Public rank', fontsize = 25)\nplt.ylabel('Private LB', fontsize = 20)\nplt.xlabel('Public LB', fontsize = 20)\nplt.grid(linestyle='-', linewidth=1.0)\nplt.xticks(fontsize=20)\nplt.yticks(fontsize=20)\nplt.show()","eff85081":"plt.figure(figsize=(16, 8))\nax = plt.gca()\nax.set_facecolor('#fffef0')\n\nDf_up = df[df['Shake']>=0]\nDf_dn = df[df['Shake']<0]\n\nplt.scatter( Df_up['Rank_public'], Df_up['Shake'], label='Shake-up', s=65, c='b', alpha=1, linewidths=1, edgecolors='w')\nplt.scatter( Df_dn['Rank_public'], Df_dn['Shake'], label='Shake-down', s=65, c='r', alpha=0.8, linewidths=1, edgecolors='w')\nplt.legend(fontsize = 18, loc='lower right')\n\nh_medal = np.round( 0.1*df_len )\nplt.axvline(x=h_medal, label='Medals', c='k', alpha=0.5, linestyle='dashed', linewidth=2.5)\n\n# --------------------------------------------- #\nplt.title('$\\Delta LB$ vs. Public rank', fontsize = 25)\nplt.xlabel('Public LB', fontsize = 20)\nplt.ylabel('$\\Delta LB$', fontsize = 20)\nplt.grid(linestyle='-', linewidth=1.0)\nplt.xticks(fontsize=20)\nplt.yticks(fontsize=20)\nplt.ylim([np.min(Df_dn['Shake'])*0.9, np.max(Df_up['Shake'])*1.25])\nplt.show()","eadf5045":"h_bronze = h_medal\nh_silver = np.round( 0.05*df_len )\nh_gold   = np.round( 10 + 0.002*df_len )\n\n# shortcut for np.array casting\ndef logical_list( l1, l2 ):\n    L1, L2 = np.array( l1 ), np.array( l2 )\n    return pd.Series( np.logical_and( L1, L2) )\n     \ndf_bronze = df[ logical_list( (df['Rank_public'] > h_silver), (df['Rank_public'] <= h_bronze) ) ]\ndf_silver = df[ logical_list( (df['Rank_public'] > h_gold), (df['Rank_public'] <= h_silver) ) ]\ndf_gold   = df[ logical_list( (df['Rank_public'] >= 0), (df['Rank_public'] <= h_gold) ) ]\n\n# ----------------- Visualization ----------------- #\nplt.figure(figsize=(15, 7))\nax = plt.gca()\nax.set_facecolor('#f2f9fa')\n\nplt.scatter( df_bronze['Rank_public'], df_bronze['Rank_private'], label='Bronze Medal', s=90, c='brown', alpha=1, linewidths=0.8, edgecolors='k')\nplt.scatter( df_silver['Rank_public'], df_silver['Rank_private'], label='Silver Medal', s=90, c='silver', alpha=1, linewidths=1, edgecolors='k')\nplt.scatter( df_gold['Rank_public'],   df_gold['Rank_private'],   label='Gold Medal', s=90, c='gold', alpha=1, linewidths=1, edgecolors='k')\n\n# --------------------------------------------- #\nplt.legend(fontsize = 20, loc='upper right')\nplt.hlines(y=h_medal, xmin=0, xmax=np.max(df_bronze['Rank_public']), color='k', linestyle='dashed', linewidth=2.5, alpha=0.7)\nplt.title('Re-ranking of Public LB medalists ', fontsize = 23)\nplt.xlabel('Public LB', fontsize = 21)\nplt.ylabel('Private LB', fontsize = 21)\nplt.grid(linestyle='-', linewidth=1.0)\nplt.xticks(fontsize=20)\nplt.yticks(fontsize=20)\n# plt.ylim([-50, 600])\n# plt.ylim([np.min(Df_dn['Shake'])*0.7, np.max(Df_up['Shake'])*1.25])\nplt.show()","ef6a57dc":"h_bronze = h_medal\nh_silver = np.round( 0.05*df_len )\nh_gold   = np.round( 10 + 0.002*df_len )\n\n# shortcut for np.array casting\ndef logical_list( l1, l2 ):\n    L1, L2 = np.array( l1 ), np.array( l2 )\n    return pd.Series( np.logical_and( L1, L2) )\n     \ndf_bronze = df[ logical_list( (df['Rank_private'] > h_silver), (df['Rank_private'] <= h_bronze) ) ]\ndf_silver = df[ logical_list( (df['Rank_private'] > h_gold), (df['Rank_private'] <= h_silver) ) ]\ndf_gold   = df[ logical_list( (df['Rank_private'] >= 0), (df['Rank_private'] <= h_gold) ) ]\n\n# ----------------- Visualization ----------------- #\nplt.figure(figsize=(15, 7))\nax = plt.gca()\nax.set_facecolor('#f2f9fa')\n\nplt.scatter( df_bronze['Rank_public'], df_bronze['Rank_private'], label='Bronze Medal', s=90, c='brown', alpha=1, linewidths=0.8, edgecolors='k')\nplt.scatter( df_silver['Rank_public'], df_silver['Rank_private'], label='Silver Medal', s=90, c='silver', alpha=1, linewidths=1, edgecolors='k')\nplt.scatter( df_gold['Rank_public'],   df_gold['Rank_private'],   label='Gold Medal', s=90, c='gold', alpha=1, linewidths=1, edgecolors='k')\n\n# --------------------------------------------- #\nplt.legend(fontsize = 20, loc='lower right')\nplt.axvline(x=h_medal, label='Medals', c='k', alpha=0.7, linestyle='dashed', linewidth=2.5)\nplt.title('Re-ranking of Private LB medalists', fontsize = 23)\nplt.xlabel('Public LB', fontsize = 21)\nplt.ylabel('Private LB', fontsize = 21)\nplt.grid(linestyle='-', linewidth=1.0)\nplt.xticks(fontsize=20)\nplt.yticks(fontsize=20)\n# plt.ylim([np.min(Df_dn['Shake'])*0.7, np.max(Df_up['Shake'])*1.25])\nplt.show()","d6de7a6e":"#### $\\text{Shake-what ?!}$\n\n\n**Shake** ( $\\Delta LB$ ) occurs when the competition is shifting between two different datasetes :\n\n$$\n\\text{Public test set} \\ \\Rightarrow \\ \\text{Private test set} \\quad \\Leftrightarrow \\quad LB_{public} \\ \\Rightarrow \\ LB_{private}\n$$\n\nThe private test set that so far was unavailable becomes available, and thus the models scores are re-calculated. This re-evaluation elicits a respective **re-ranking** of the contestants in the competition. The shake allows participants to assess the severity of their overfitting to the public dataset, and act to improve their model until the deadline.\n\nUnable to find a uniform conventional term for this mechanism, I will use my common sense to define the following intuition :\n\n$$\n\\Delta LB := -( LB_{(private)} - LB_{(public)} ) = \\begin{cases}\n\\Delta LB < 0 \\quad : \\quad \\text{Shake-down} \\\\\n\\Delta LB = 0 \\quad : \\quad \\text{No shake} \\\\\n\\Delta LB > 0 \\quad : \\quad \\text{Shake-up}\n\\end{cases}\n$$","17f64e6d":"#### $\\text{Discussion}$\n\nThese scatter plots shouts at me one thing - **Never take the public leaderboard too seriously !**\n\nThe red points **density** in the medal zone imply on the earthquake that is about to come. So many high-ranked contestants will be subjeceted to a dramatic **shake-down** ( $ \\, > 1000 \\ [ \\Delta LB ]$ ) once shifting to the private dataset. \n\nAnd like always, who is the usual suspect ??? None other than the **model OVERFITTING** to the **public datatest**. ","f3f0d0f4":"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <img src='https:\/\/github.com\/Daniboy370\/Uploads\/blob\/master\/meme_0.png?raw=true' width=400 \/>","243ea265":"### $\\Delta LB \\, \\text{ Prevalence}$\n\n\nStarting with a basic histogram over the distribution range :","05d13773":"Amazingly, third of the Private LB medalists were ranked away from the medal zone during the **public** phase. However, they were strong enough to believe in their model, and in the moment of truth they caught the Tsunami successfully.\n\nFurthermore, both scatter plots show an interesting trend which in some engineering fields is known as convergence-divergence :\n\n* The **higher** the PUBLIC rank $\\rightarrow$ the **higher** the PRIVATE rank. \n\n* The **lower** the PUBLIC rank $\\rightarrow$ the **lower** the PRIVATE rank.","d3c4b0b4":"After having seen the $\\, \\Delta LB \\,$ frequency, we shall examine the correlation between **Pubilc** rank to **Private** rank. ","fa88d996":"In this specific competition, the majority of the shakings turned to be positive. A very small portion however, managed to keep their ranking untouched.","0b55a1bf":"Using this definition let's examine the likelihood of certain arbitrary ranges :","65221bc7":"The question is : ***What is the re-ranking of Public LB medalists after shifting to the private phase ?***","0de6379f":"Before discussion, consider another view that demonstrates the **model fitting** concept :\n","e8af110b":"Despite the **HUGE** range that composes the **re-rankings**, both mean and median seem to be rather close to the \"0\" center.","7e0edfcc":"### $\\text{Analysis of medal zone}$\n\nThe medal zone as defined by the Kaggle Progression System [[**link**](https:\/\/www.kaggle.com\/progression)] :\n\n<img src='https:\/\/github.com\/Daniboy370\/Uploads\/blob\/master\/Kaggle-medals.png?raw=true' width=800 \/>","903ff762":"#### $\\text{Probability Density Function ( in percentiles )}$\n\nBy normalizing the above histogram we get its probability density function (**PDF**), which presents the relative likelihood of a random variable :","dee5cfd4":"### $\\text{Overfitting vs. Underfitting}$\n\n\nLet us scatter the samples on a performance plane where $\\, \\Delta LB_i \\,$ is denoted by the vertical distance of point $\\, x_i \\,$ from the diagonal. The dashed line [ **--** ] delineates the medal zone ( $LB \\, \\leq \\text{ Top-}10 \\%$ ) . ","91ae3f03":"#### $\\text{Summary}$\n\nShake-ups and shake-downs occur quite often, however they vary between competitions due to many reasons (organizers, data, contestants, models etc.). Usually, surprises occur often to less than  10 [%] of the population ! It is true to Kaggle competitions as much as it is true to life. My advice : more competitions, more mistakes, more questions, more work. And medals will follow !\n\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <img src='https:\/\/github.com\/Daniboy370\/Uploads\/blob\/master\/meme_1.jpg?raw=true' width=500 \/>","f5230a1b":"$$\n\\text{Thank you !}\n$$","eecc03cf":"### $\\text{ Shake-up vs. Shake-down }$\n\nLet us first examine the ratio between three possible categories :","95f0e844":"$$\n\\text{let :} \\quad F(x) = \\sum_{x_j \\leq x} f(x_j) \\quad \\text{where} \\quad f(x_j)  \\equiv P(X=x_j)  \\\\\n\\text{s.t. :} \\quad \n\\Pr \\, (a \\le X \\le b ) = F(b) - F(a) = \\int_a^b f_X(x) \\, dx  \n$$","ab89a2d9":"At a glance, it is already clear that the majority of the **shakes** occurs in the range of : $ \\, | \\Delta LB | \\leq 50 \\, $ .","c7afe0df":"Almost half the Public LB medalists experienced an enormous **shaking** that washed them away from the medal zone ( the cost of **overfitting** ). The other half was lucky ( and smart ) enough to guarantee their medal awards.\n\nAnd my last question for today : ***What WAS the finalists' ranking PRIOR to the shifting ?***","f16471ad":"### $\\text{Objective}$\nThis kernel delivers a simple and intuitive analysis of participants re-ranking in the ***Quora Insincere Questions Classification*** [[**link**](https:\/\/www.kaggle.com\/c\/quora-insincere-questions-classification)] competition. The kernel attempts to better explain the underlying trends of the **shaking** phenomenon we all are subjected to during any DS competition.","08d8594a":"* $\\, \\sim 25 [\\%] \\,$ of the population $\\ \\Rightarrow \\ \\pm 24 \\ [\\, \\Delta LB \\, ]$\n* $\\, \\sim 50 [\\%] \\,$ of the population $\\ \\Rightarrow \\ \\pm 142 \\ [\\, \\Delta LB \\, ]$\n* $\\, \\sim 75 [\\%] \\,$ of the population $\\ \\Rightarrow \\ \\pm 368 \\ [\\, \\Delta LB \\, ]$\n\nGenerally speaking, these big numbers are not representing a regular competition. In my **dataset** : [**Competitions Shake-up**](https:\/\/www.kaggle.com\/daniboy370\/competitions-shakeup), most of the competitions exhibited lower numbers by far.\n\nLet us compare between both trends :"}}