{"cell_type":{"cfa3968f":"code","c75cee38":"code","5ff61e5d":"code","a2833a55":"code","5938fc49":"code","7118f90d":"code","85b56ffb":"code","2eaca65d":"code","05f248c3":"code","faa0c64c":"code","2d8cdae8":"code","4f9be0cd":"code","5a5fabeb":"code","e46a68fb":"code","1a13c389":"code","002ad8f0":"code","489209e1":"code","fbc8f6d3":"code","d606c148":"code","7fbe31c3":"code","e3b9f644":"code","534c4804":"code","98064215":"code","51e67ce3":"code","ce8ee89b":"code","188e888a":"code","7fc11638":"code","dd5432d3":"code","c6d99a6d":"code","9a423a05":"code","60a9ece6":"code","7f655f8d":"code","98619615":"code","a3547d80":"code","b4a1e770":"code","227acc52":"code","8c48e904":"code","4943924f":"code","81622288":"markdown","1d69096e":"markdown","d1eb1d2d":"markdown","389aa2ec":"markdown","4a3ca610":"markdown","d28fee7d":"markdown","fbe6ebe8":"markdown","240686a6":"markdown","c0c056ed":"markdown","f60d6484":"markdown","45e2e95c":"markdown","fcab0823":"markdown","c1adbd25":"markdown","f720c27e":"markdown","a5e7fd63":"markdown","27aaa3df":"markdown","fd3abbbe":"markdown","ba61c098":"markdown","34902ca5":"markdown","b827a2e3":"markdown","876c601f":"markdown","ff60a6cc":"markdown","607a8f79":"markdown","5f647443":"markdown","d6bc698f":"markdown","a7b53c03":"markdown","8857fbfa":"markdown","72ce91e5":"markdown","5145ab26":"markdown"},"source":{"cfa3968f":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport glob\n\nimport plotly.graph_objects as go\nfrom datetime import datetime, timedelta\nimport json\nimport datetime\nimport time\nfrom plotly.subplots import make_subplots\n\nvideo = False","c75cee38":"df2 = pd.read_csv(\"\/kaggle\/input\/uncover\/UNCOVER\/our_world_in_data\/coronavirus-disease-covid-19-statistics-and-research.csv\")\ndf2.keys()","5ff61e5d":"df2[df2['location']==\"Colombia\"].head()","a2833a55":"df = pd.read_csv('\/kaggle\/input\/uncover\/UNCOVER\/google_mobility\/regional-mobility.csv')\ndf.keys()","5938fc49":"countries = np.unique(df['country'])\ndates = df[ (df['country']==\"Colombia\") & (df['region']==\"Total\")]['date']","7118f90d":"data = []\nfor j in dates:    \n    C = []\n    for i in countries:\n        cases = np.array(df2['total_cases'][(df2['location']==i)&(df2['date']==j)]).astype(int)\n        if cases.size == 0:\n            cases = 0\n        else:\n            cases = cases[0]\n        C.append(cases)\n    data.append([j,np.array(C).flatten()])","85b56ffb":"with open('\/kaggle\/input\/world-json\/countries.geo.json') as response:\n    world = json.load(response)\n\nif video == False:\n    N = 1\nelse:\n    N = len(dates)\n\nfor i in range(N):\n    cases = data[i][1]\n    fig = make_subplots(rows=1, cols=2, specs=[[{\"type\": \"table\"},{\"type\": \"mapbox\" }]],column_widths=[0.2, 1], horizontal_spacing=0.01)\n\n    for loc in world['features']:\n        loc['id'] = loc['properties']['name']\n    fig.add_trace(go.Choroplethmapbox(\n                        geojson=world,\n                        locations=countries,\n                        z=cases,\n                        colorscale='thermal',\n                        colorbar_title=\"Cases\"), row=1, col=2)\n\n    ii = np.argsort(cases)[::-1]\n    fig.add_trace(go.Table(header=dict(values=['Country', 'Cases'],height=20, font=dict(size=14)),\n                           cells=dict(values=[countries[ii],cases[ii]],height=20,font=dict(size=12)),columnwidth = [40,40]),row=1,col=1)\n\n    fig.update_layout(mapbox_style=\"open-street-map\",\n                      mapbox_zoom=1,\n                      mapbox_center = {\"lat\": 0, \"lon\": 0},\n                      width=1500,\n                      height=800,\n                      margin=dict(l=0,r=0,b=0,t=50,pad=4),\n                      title=\"Covid-19 World \/ \"+str(np.array(dates)[i]),\n                      font=dict(family=\"Courier New, monospace\",size=18,color=\"#7f7f7f\"))\n\n\n    fig.show()\n#     fig.write_image(\"Figures\/World_\"+str(round(i,2))+\".png\")","2eaca65d":"df = pd.read_csv('\/kaggle\/input\/uncover\/UNCOVER\/google_mobility\/regional-mobility.csv')\ndf.keys()","05f248c3":"fig = plt.figure(figsize=(20,10))\nscountries = ['Colombia','Germany','Spain','Brazil','France','Italy','China','Ecuador']\n\nfor sc in scountries:\n    dates = df[ (df['country']==sc) & (df['region']==\"Total\")]['date']\n    plt.plot(dates,df[ (df['country']==sc) & (df['region']==\"Total\")]['residential'], label=sc)\n    plt.xticks(rotation=90,size=15)\n    plt.yticks(size=15)\n    plt.title(\"Residential\",size=20)\nplt.legend(fontsize=15)\nplt.show()","faa0c64c":"fig = plt.figure(figsize=(20,10))\nscountries = ['Colombia','Germany','Spain','Brazil','France','Italy','China','Ecuador']\n\nfor sc in scountries:\n    dates = df[ (df['country']==sc) & (df['region']==\"Total\")]['date']\n    plt.plot(dates,df[ (df['country']==sc) & (df['region']==\"Total\")]['workplaces'], label=sc)\n    plt.xticks(rotation=90,size=15)\n    plt.yticks(size=15)\n    plt.title(\"Workplaces\",size=20)\nplt.legend(fontsize=15)\nplt.show()","2d8cdae8":"gro_phar = np.zeros(len(countries))\ntra_stat = np.zeros(len(countries))\nworkpla = np.zeros(len(countries))\nresid = np.zeros(len(countries))\nparks = np.zeros(len(countries))\n\nfor i, c in enumerate(countries):\n    gro_phar[i] = np.average(df['grocery_and_pharmacy'][(df['country']==c) & (df['region']==\"Total\")])\n    tra_stat[i] = np.average(df['transit_stations'][(df['country']==c) & (df['region']==\"Total\")])\n    workpla[i] = np.average(df['workplaces'][(df['country']==c) & (df['region']==\"Total\")])\n    resid[i] = np.nan_to_num(np.average(df['residential'][(df['country']==c) & (df['region']==\"Total\")]))\n    parks[i] = np.average(df['parks'][(df['country']==c) & (df['region']==\"Total\")])","4f9be0cd":"columns=['country','grocery_pharmacy','transit_station','workplaces','residential','parks']\nMEANS = pd.DataFrame(np.array([countries,gro_phar,tra_stat,workpla,resid,parks]).T,columns=columns)","5a5fabeb":"print(MEANS[MEANS['country']==\"Colombia\"]) #show some examples\nprint(MEANS[MEANS['country']==\"Germany\"])\nprint(MEANS[MEANS['country']==\"Japan\"])\nprint(MEANS[MEANS['country']==\"Italy\"])","e46a68fb":"df2 = pd.read_csv(\"\/kaggle\/input\/uncover\/UNCOVER\/our_world_in_data\/coronavirus-disease-covid-19-statistics-and-research.csv\")\ndf2.keys()","1a13c389":"new_cases = np.zeros(len(countries))\nnew_test = np.zeros(len(countries))\n\nfor i,c in enumerate(countries):\n    new_cases[i] = np.nan_to_num(np.mean(df2['new_cases'][(df2['location']==c)]))\n    new_test[i] = np.nan_to_num( np.mean(df2['new_tests'][(df2['location']==c)]))","002ad8f0":"df4 = pd.read_csv(\"\/kaggle\/input\/uncover\/UNCOVER\/HDE\/global-school-closures-covid-19.csv\")\nprint(\"\/kaggle\/input\/uncover\/UNCOVER\/HDE\/global-school-closures-covid-19.csv\")\nprint(df4.keys())","489209e1":"df4[df4['country']==\"Germany\"].head()","fbc8f6d3":"school = np.zeros(len(countries))\nfor i, c in enumerate(countries):\n    ds = np.array(df4['scale'][(df4['country']==c)])\n    ds[ds==\"Localized\"]=0\n    ds[ds==\"National\"]=1\n    if np.shape(ds)[0] != 0:\n        school[i] = np.mean(ds)\n    else:\n        school[i] = 0\nschool = np.array(school)","d606c148":"df4 = pd.read_csv(\"\/kaggle\/input\/uncover\/UNCOVER\/worldometer\/worldometer-confirmed-cases-and-deaths-by-country-territory-or-conveyance.csv\")\nprint(\"\/kaggle\/input\/uncover\/UNCOVER\/worldometer\/worldometer-confirmed-cases-and-deaths-by-country-territory-or-conveyance.csv\")\nprint(df4.keys())","7fbe31c3":"df4[df4['country']==\"Colombia\"].head()","e3b9f644":"total_cases_pm = np.zeros(len(countries))\nserious_cases = np.zeros(len(countries))\nactive_cases = np.zeros(len(countries))\ntotal_recovered = np.zeros(len(countries))\n\ntotal_deaths = np.zeros(len(countries))\nfor i,c in enumerate(countries):\n    total_cases_pm[i] = np.mean(df4['total_cases_per_1m_pop'][(df4['country']==c)])\n    serious_cases[i] = np.nan_to_num(np.mean(df4['serious_critical_cases'][(df4['country']==c)]))\n    active_cases[i] = np.nan_to_num(np.mean(df4['active_cases'][(df4['country']==c)]))\n    total_recovered[i] = np.nan_to_num(np.mean(df4['total_recovered'][(df4['country']==c)]))\n    total_deaths[i] = np.nan_to_num(np.mean(df4['total_deaths_per_1m_pop'][(df4['country']==c)]))","534c4804":"MEANS['new_cases'] = new_cases\nMEANS['new_test'] = new_test\nMEANS['total_cases_pm'] = total_cases_pm\nMEANS['school'] = school\nMEANS['serious_cases'] = serious_cases\nMEANS['active_cases'] = active_cases\nMEANS['total_recovered'] = total_recovered\n\nMEANS['total_deaths'] = total_deaths\nMEANS","98064215":"x_col = ['country','grocery_pharmacy','transit_station','workplaces',\n         'residential','parks','new_cases','new_test','total_cases_pm',\n         'school','serious_cases','active_cases','total_recovered']\nfor i in x_col:\n    MEANS = MEANS[MEANS[i].notnull()]","51e67ce3":"MEANS","ce8ee89b":"MEANS[MEANS['country'] == \"Colombia\"]","188e888a":"Xc = MEANS[MEANS['country'] ==\"Colombia\"][x_col]\nYc = MEANS[MEANS['country'] ==\"Colombia\"]['total_deaths']\n\nX = MEANS[MEANS['country'] !=\"Colombia\"][x_col]\nY = MEANS[MEANS['country'] !=\"Colombia\"]['total_deaths']","7fc11638":"Xc","dd5432d3":"X","c6d99a6d":"from sklearn.model_selection import train_test_split","9a423a05":"x_train, x_test, y_train, y_test = train_test_split(X,Y, train_size=0.6)\n\n# x_train = X[X['country'] !=\"Colombia\"][x_col]\n# y_train = Y[X['country'] !=\"Colombia\"]\n\n# x_test = X[X['country'] ==\"Colombia\"][x_col]\n# y_test = Y[X['country'] ==\"Colombia\"]\n\n\nx_test = x_test.append(Xc)\ny_test = y_test.append(Yc)\n\ncountry_train = x_train['country']\ncountry_test = x_test['country']\nx_train = x_train.drop(['country'],axis=1)\nx_test = x_test.drop(['country'],axis=1)\n\nprint(x_train.shape)\nprint(x_test.shape)\nprint(y_train.shape)\nprint(y_test.shape)","60a9ece6":"import umap\nfig = plt.figure(figsize=(5,5))\n\nXUMAP = MEANS[x_col].drop(['country'],axis=1)\n\nreducer = umap.UMAP(n_neighbors=15,min_dist=0.5,metric='cosine')\nreducer.fit(XUMAP)\nembedding = reducer.transform(XUMAP)\nxmin = min(embedding[:,0])-1\nxmax = max(embedding[:,0])+1\nymin = min(embedding[:,1])-1\nymax = max(embedding[:,1])+1            \n\nplt.title(\"Umap\",size=15)\nplt.scatter(embedding[:,0], embedding[:,1], cmap='Paired', s=4.0)\nplt.grid(alpha=0.3)\nplt.xlim(xmin,xmax)\nplt.ylim(ymin,ymax)\nplt.show()","7f655f8d":"from sklearn.tree import DecisionTreeRegressor\nfrom sklearn.metrics import r2_score","98619615":"md = np.arange(2,200,5)\nR2 = np.zeros(len(md))\nbest = 0\nr2 = 0\n\nfor i, m in enumerate(md):\n    model = DecisionTreeRegressor(max_depth=m,criterion=\"mae\",splitter=\"random\",min_samples_split=3)\n    model.fit(x_train,y_train)\n    y_pred = model.predict(x_test)\n    R2[i] = r2_score(y_test,y_pred)\n\n    if R2[i] > r2:\n        best = m\n        r2 = R2[i]\n            \nfig = plt.figure(figsize=(5,5))\nplt.subplot(1,1,1)\nplt.plot(md,R2)\nplt.xlabel(\"Max Depth\")\nplt.ylabel(r'$r^2$')\nplt.show()\n\nmodel = DecisionTreeRegressor(max_depth=best,criterion=\"mae\",splitter=\"random\",min_samples_split=3)\nmodel.fit(x_train,y_train)\ny_pred = model.predict(x_test)\n\nfig = plt.figure(figsize=(20,6))\nplt.plot(country_test,y_pred,\"*\",label=\"Predicted\")\nplt.plot(country_test,y_test,\"*\",label=\"Truth\")\nplt.xticks(rotation=90,size=15)\nplt.title(r'Desicion Tree Regression  - $r^2$ {}'.format(round(r2,2)),size=30)\nplt.ylabel(\"Total Deaths\")\nplt.yticks(rotation=0,size=15)\nplt.legend(fontsize=15)\nplt.show()","a3547d80":"print(\"Colombia will have a number of deaths per million of \"+str(y_pred[-1]))","b4a1e770":"from sklearn.linear_model import LinearRegression\n\nmodel = LinearRegression()\nmodel.fit(x_train,y_train)\ny_pred = model.predict(x_test)\n\nfig = plt.figure(figsize=(20,6))\nplt.plot(country_test,y_pred,\"*\",label=\"Predicted\")\nplt.plot(country_test,y_test,\"*\",label=\"Truth\")\nplt.xticks(rotation=90,size=15)\nplt.yticks(rotation=0,size=15)\nplt.title(r'Linear Regression -  $r^2$={}'.format(round(r2_score(y_test,y_pred),2)), size=30)\nplt.legend(fontsize=15)\nplt.show()","227acc52":"print(\"Colombia will have a number of deaths per million of population of \"+str(y_pred[-1]))","8c48e904":"country_test = np.array(country_test)","4943924f":"for i in x_test.keys():\n    fig = plt.figure(figsize=(10,10))\n\n    plt.scatter(x_test[i][:-1], y_pred[:-1], cmap='Paired', s=10.0)\n    plt.scatter(x_test[i][-1:], y_pred[-1:], cmap='Paired', s=15.0, c=\"red\", )\n    for j in range(len(x_test)):\n        if country_test[j] == \"Colombia\":\n            plt.text(np.array(x_test[i])[j], y_pred[j], country_test[j] , fontsize=15,color=\"red\")\n        else:\n            plt.text(np.array(x_test[i])[j], y_pred[j], country_test[j] , fontsize=11,color=\"blue\")\n    plt.title(\"Variable: \"+str(i),size=15)\n    plt.xlabel(str(i),size=15)\n    plt.ylabel(\"total deaths per million\",size=15)\n    plt.grid(alpha=0.3)\n    plt.show()","81622288":"for i in datasets_country:\n    df3 = pd.read_csv(i)\n    print(i,df3.keys(),end=\"\\n ---------------------- \\n\\n\")","1d69096e":"###  our_world_in_data\nSource description: Our World In Data aims to aggregate existing research, bring together the relevant data and allow their readers to make sense of the published data and early research on the coronavirus outbreak. They have provided data on coronavirus cases and testing.","d1eb1d2d":"### Adding information with the school mobility\nLocal closueres =0 National Closures = 1 -> then computed the mean value","389aa2ec":"### Using information of the covid evolution ","4a3ca610":"### Decision Tree Regression","d28fee7d":"### Exploration in the mobility for some countries","fbe6ebe8":"### Residential mobility","240686a6":"datasets_country = []\nfor i in datasets:\n    df3 = pd.read_csv(datasets[6])\n    keys = np.array(df3.keys())\n    if  sum( keys == \"country\") !=0:\n        if len(df3[df3['country']==\"Colombia\"]) != 0:\n            datasets_country.append(i)\n            \n    if sum(keys == \"location\") !=0:\n        if len(df3[df3['location']==\"Colombia\"]) != 0:\n            datasets_country.append(i)","c0c056ed":"### Select datasets that contain information related to Colombia","f60d6484":"### Compute parameters of mobility","45e2e95c":"datasets_country","fcab0823":"### Evolution of Covid in the World","c1adbd25":"### Show a snapshot of the covid evolution","f720c27e":"### Linear Regression","a5e7fd63":"###  Final Dataset","27aaa3df":"### worldometer\nSource description: Worldometer is tracking confirmed coronavirus cases and deaths by country, territory, or conveyance.","fd3abbbe":"datasets = []\nfor f in folders:\n    datasets.append(glob.glob(str(f)+\"\/*\"))","ba61c098":"### Problem\nPredict the number of deaths per million of population using information related with the mobility, the number of cases, the number of diseases and the number of critical cases.","34902ca5":"### Exploration with UMAP","b827a2e3":"folders = glob.glob(\"\/kaggle\/input\/uncover\/UNCOVER\/*\")\nfolders","876c601f":"datasets = np.concatenate(datasets).flatten()\ndatasets","ff60a6cc":"if video == True: #To create a video evolution of the covid\n    !ffmpeg -r 2 -i Figures\/World_%01d.png -c:v libx264 -vf fps=25 -pix_fmt yuv420p out.mp4","607a8f79":"###  global school closures\nSource description: The Humanitarian Data Exchange (HDX) is an open platform for sharing data across crises and organisations. Provided are data sets with global information on testing, government responses, and school closures.\n","5f647443":"### Explore the datasets","d6bc698f":"###  Create a list of countrys to study the deaths by covid using as train a interval of dates","a7b53c03":"### Covid evolution information","8857fbfa":"### Explore the variables contained in these datasets","72ce91e5":"##### google_mobility dataset\nAs global communities respond to COVID-19, we've heard from public health officials that the same type of aggregated, anonymized insights we use in products such as Google Maps could be helpful as they make critical decisions to combat COVID-19. These Community Mobility Reports aim to provide insights into what has changed in response to policies aimed at combating COVID-19. The reports chart movement trends over time by geography, across different categories of places such as retail and recreation, groceries and pharmacies, parks, transit stations, workplaces, and residential.","5145ab26":"### Workplaces mobility"}}