{"cell_type":{"b2f13171":"code","5d2ef5f1":"code","b0e05b2e":"code","769144dd":"code","83cf2ca8":"code","d57072ad":"code","d4f6661a":"code","9b4cf285":"code","71361cbb":"code","e1bce461":"code","18128633":"code","9f13c41c":"code","58f394a1":"code","f29ada0f":"code","45ff9c51":"code","9ea2c96a":"code","cc8a4420":"code","237d954f":"markdown","a2c13330":"markdown","ede02a43":"markdown","65ffdaac":"markdown","c7c809a9":"markdown","46dffcab":"markdown","3f79f21b":"markdown","4d80efe5":"markdown","bd412b9f":"markdown","b50df106":"markdown","2d4e2558":"markdown","1d52e9e1":"markdown","9f779736":"markdown","10bb09c2":"markdown","592bc8fd":"markdown","e9c46405":"markdown","64185d64":"markdown","769ac40e":"markdown"},"source":{"b2f13171":"# Importing data\nimport numpy as np\nimport pandas as pd\nfrom sklearn.model_selection import train_test_split\n\n# Read the data\nX = pd.read_csv('..\/input\/train.csv', index_col='Id')\nX_test = pd.read_csv('..\/input\/test.csv', index_col='Id')","5d2ef5f1":"# Shape train dataset:\nprint(\"Shape train dataset (com coluna target ):\", X.shape)\n\n\n# Shape test dataset:\nprint(\"Shape test dataset:\", X_test.shape)\n\n\n# Missing rows in target column train:\nprint(\"Missing rows in target column train:\", (X.SalePrice.isnull().sum()))\n\n\n# Numeric columns:\nprint(\"Numerical columns:\", X.select_dtypes(include=np.number).shape[1])\n\n\n# Missing rows in numeric columns:\n#print(\"Numerical columns:\", X[X.select_dtypes(include=np.number).isnull().sum()>0]\n\n# Categorical columns:\n\n\n\n# Missing rows in numeric columns:","b0e05b2e":"# separate target from predictors\n#X.dropna(axis=0, subset=['SalePrice'], inplace=True)\ny = X.SalePrice\nX.drop(['SalePrice'], axis=1, inplace=True)\nprint(X.shape)\n\n\n# Break off validation set from training data\nX_train, X_valid, y_train, y_valid = train_test_split(X, y, train_size=0.8, test_size=0.2,random_state=1)\nprint(X_train.shape)","769144dd":"# Selecionando numericos\nX_numerical_train = X_train.select_dtypes(exclude=['object'])\nX_numerical_valid = X_valid.select_dtypes(exclude=['object'])\nX_numerical_test = X_test.select_dtypes(exclude=['object'])\n\n# Selecionando categoricos\nX_categorical_train = X_train.select_dtypes(exclude=['int64', 'float64'])\nX_categorical_valid = X_valid.select_dtypes(exclude=['int64', 'float64'])\nX_categorical_test = X_test.select_dtypes(exclude=['int64', 'float64'])\n\nprint(X_numerical_train.shape)\nprint(X_numerical_valid.shape)\nprint(X_numerical_test.shape)\nprint(X_categorical_train.shape)\nprint(X_categorical_valid.shape)\nprint(X_categorical_test.shape) #Tudo certo, nenhum dado sumido.","83cf2ca8":"# Quais colunas possuem NAs?\nmissing_val_count_by_column = (X_numerical_train.isnull().sum())\nprint(\"Colunas com NA tabela treino: \\n\", missing_val_count_by_column[missing_val_count_by_column > 0])\n\nmissing_val_count_by_column2 = (X_numerical_valid.isnull().sum())\nprint(\"Colunas com NA tabela validation: \\n\",missing_val_count_by_column2[missing_val_count_by_column2 > 0])\n\n\nmissing_val_count_by_column3 = (X_numerical_test.isnull().sum())\nprint(\"Colunas com NA tabela teste: \\n\",missing_val_count_by_column3[missing_val_count_by_column3 > 0])","d57072ad":"# Approach ser\u00e1 dividido em 2: \n    #Os Nas na coluna GarageYrBlt ser\u00e1 preenchidos com os respectivos valores da coluna YearBuilt\n    #Demais valores ser\u00e3o subsituidos pela m\u00e9dia\n    \nX_numerical_train.GarageYrBlt = X_numerical_train.GarageYrBlt.fillna(X_numerical_train.YearBuilt)\nX_numerical_valid.GarageYrBlt = X_numerical_valid.GarageYrBlt.fillna(X_numerical_valid.YearBuilt)\nX_numerical_test.GarageYrBlt = X_numerical_test.GarageYrBlt.fillna(X_numerical_test.YearBuilt)\n\n#Testando: \n    #Funciona - para retestar so colocar o codechunk acima aqui embaixo\n\n# Inputando nas outras colunas:\nfrom sklearn.impute import SimpleImputer\n\nmy_imputer = SimpleImputer()\nX_numerical_train_inp = pd.DataFrame(my_imputer.fit_transform(X_numerical_train))\nX_numerical_valid_inp = pd.DataFrame(my_imputer.fit_transform(X_numerical_valid))\nX_numerical_test_inp = pd.DataFrame(my_imputer.fit_transform(X_numerical_test))\n\n    #recolocando nome colunas\nX_numerical_train_inp.columns = X_numerical_train.columns\nX_numerical_valid_inp.columns = X_numerical_valid.columns\nX_numerical_test_inp.columns = X_numerical_test.columns","d4f6661a":"# TESTE PRA VER SE AINDA H\u00c1\nmissing_val_count_by_column = (X_numerical_train_inp.isnull().sum())\nprint(\"Colunas com NA tabela treino: \\n\", missing_val_count_by_column[missing_val_count_by_column > 0])\n\nmissing_val_count_by_column2 = (X_numerical_valid_inp.isnull().sum())\nprint(\"Colunas com NA tabela validation: \\n\",missing_val_count_by_column2[missing_val_count_by_column2 > 0])\n\n\nmissing_val_count_by_column3 = (X_numerical_test_inp.isnull().sum())\nprint(\"Colunas com NA tabela teste: \\n\",missing_val_count_by_column3[missing_val_count_by_column3 > 0])\n\nprint(X_numerical_train_inp.isnull().sum())\n\n#Teste passado!!!","9b4cf285":"missing_val_count_by_column_cat1 = (X_categorical_train.isnull().sum())\nprint(\"Colunas com NA tabela treino: \\n\", missing_val_count_by_column_cat1[missing_val_count_by_column_cat1 > 0]) # 15 colunas\n\nmissing_val_count_by_column_cat2 = (X_categorical_valid.isnull().sum())\nprint(\"Colunas com NA tabela valid: \\n\", missing_val_count_by_column_cat2[missing_val_count_by_column_cat2 > 0]) # 13 colunas\n\nmissing_val_count_by_column_cat3 = (X_categorical_test.isnull().sum())\nprint(\"Colunas com NA tabela test: \\n\", missing_val_count_by_column_cat3[missing_val_count_by_column_cat3 > 0]) # 22 colunas","71361cbb":"# Teste para entender possiveis valores de cada uma das colunas\n\n# Categorical columns in the training data\nobject_cols = [col for col in X_train.columns if X_train[col].dtype == \"object\"]\n\n\n# Get number of unique entries in each column with categorical data\nobject_nunique = list(map(lambda col: X_categorical_train[col].nunique(), object_cols))\nd = dict(zip(object_cols, object_nunique))\n\n# Print number of unique entries by column, in ascending order\nsorted(d.items(), key=lambda x: x[1])","e1bce461":"# columns where NaN values have meaning e.g. no pool etc.\ncols_fillna = ['PoolQC','MiscFeature','Alley','Fence','FireplaceQu',\n               'GarageQual','GarageCond','GarageFinish','MasVnrType','GarageType',\n               'BsmtExposure','BsmtCond','BsmtQual','BsmtFinType1','BsmtFinType2']\n\n# replace 'NaN' with 'None' in these columns\n\n#Train\nfor col in cols_fillna:\n    X_categorical_train[col].fillna('None',inplace=True)\n    \n#Valid\nfor col in cols_fillna:\n    X_categorical_valid[col].fillna('None',inplace=True)\n\n#Test\nfor col in cols_fillna:\n    X_categorical_test[col].fillna('None',inplace=True)\n    \n    \n    \n\n# Checando\nmissing_val_count_by_column_cat1 = (X_categorical_train.isnull().sum())\nprint(\"Colunas com NA tabela treino: \\n\", missing_val_count_by_column_cat1[missing_val_count_by_column_cat1 > 0]) \n\nmissing_val_count_by_column_cat2 = (X_categorical_valid.isnull().sum())\nprint(\"Colunas com NA tabela valid: \\n\", missing_val_count_by_column_cat2[missing_val_count_by_column_cat2 > 0])\n\nmissing_val_count_by_column_cat3 = (X_categorical_test.isnull().sum())\nprint(\"Colunas com NA tabela test: \\n\", missing_val_count_by_column_cat3[missing_val_count_by_column_cat3 > 0])","18128633":"# Inputando nas outras colunas:\n\nmy_imputer = SimpleImputer(strategy='most_frequent')\nX_categorical_train_inp = pd.DataFrame(my_imputer.fit_transform(X_categorical_train))\nX_categorical_valid_inp = pd.DataFrame(my_imputer.fit_transform(X_categorical_valid))\nX_categorical_test_inp = pd.DataFrame(my_imputer.fit_transform(X_categorical_test))\n\n    #recolocando nome colunas\nX_categorical_train_inp.columns = X_categorical_train.columns\nX_categorical_valid_inp.columns = X_categorical_valid.columns\nX_categorical_test_inp.columns = X_categorical_test.columns","9f13c41c":"# Checando\nmissing_val_count_by_column_cat1 = (X_categorical_train_inp.isnull().sum())\nprint(\"Colunas com NA tabela treino: \\n\", missing_val_count_by_column_cat1[missing_val_count_by_column_cat1 > 0]) \n\nmissing_val_count_by_column_cat2 = (X_categorical_valid_inp.isnull().sum())\nprint(\"Colunas com NA tabela valid: \\n\", missing_val_count_by_column_cat2[missing_val_count_by_column_cat2 > 0])\n\nmissing_val_count_by_column_cat3 = (X_categorical_test_inp.isnull().sum())\nprint(\"Colunas com NA tabela test: \\n\", missing_val_count_by_column_cat3[missing_val_count_by_column_cat3 > 0])","58f394a1":"from sklearn.preprocessing import OneHotEncoder\n\n# Use as many lines of code as you need!\n\nOH_encoder = OneHotEncoder(handle_unknown='ignore', sparse=False)\nOH_cols_train = pd.DataFrame(OH_encoder.fit_transform(X_categorical_train_inp))\nOH_cols_valid = pd.DataFrame(OH_encoder.transform(X_categorical_valid_inp))\nOH_cols_test = pd.DataFrame(OH_encoder.transform(X_categorical_test_inp))\n\n# One-hot encoding removed index; put it back\nOH_cols_train.index = X_categorical_train_inp.index\nOH_cols_valid.index = X_categorical_valid_inp.index\nOH_cols_test.index = X_categorical_test_inp.index\n\nprint(OH_cols_train.shape)\nprint(OH_cols_valid.shape)\nprint(OH_cols_test.shape) # todos tem mesma quantidade de linhas que a parte numerica\n\nprint(X_numerical_train_inp.shape)","f29ada0f":"# Add one-hot encoded columns to numerical features\nOH_X_train = pd.concat([X_numerical_train_inp, OH_cols_train], axis=1)\nOH_X_valid = pd.concat([X_numerical_valid_inp, OH_cols_valid], axis=1)\nOH_X_test = pd.concat([X_numerical_test_inp, OH_cols_test], axis=1)\n\nOH_X_trainvalid = pd.concat([OH_X_train, OH_X_valid], axis=0)\n\n#print(OH_X_train.shape)\n#print(OH_X_valid.shape)\nprint(OH_X_test.shape)\nprint(OH_X_trainvalid.shape)\nprint(X_test.shape)\n\nprint(OH_X_train.head())\nprint(OH_X_valid.head())\nprint(OH_X_trainvalid.head())\n","45ff9c51":"from sklearn.ensemble import RandomForestRegressor, GradientBoostingRegressor\nfrom sklearn.metrics import mean_absolute_error\nfrom xgboost import XGBRegressor\n\n#Definindo modelos:\nmodel_1 = RandomForestRegressor(random_state=1)\nmodel_2 = RandomForestRegressor(n_estimators=100, random_state=420)\nmodel_3 = RandomForestRegressor(n_estimators=100, criterion='mae', random_state=420)\nmodel_4 = GradientBoostingRegressor(random_state=420, n_estimators=300)\nmodel_5 = GradientBoostingRegressor(random_state=420, n_estimators=700)\nmodel_6 = XGBRegressor(random_state = 420)\nmodel_7 = XGBRegressor(random_state = 420,n_jobs=2)\nmodel_8 = GradientBoostingRegressor(random_state=420)\n\nmodels = [model_1, model_2, model_3, model_4, model_5, model_6, model_7, model_8]\n\n# Fun\u00e7\u00e3o que ir\u00e1 fazer fit, prever e retornar MAE\ndef score_model(model, X_t=OH_X_train, X_v=OH_X_valid, y_t=y_train, y_v=y_valid):\n    model.fit(X_t, y_t)\n    preds = model.predict(X_v)\n    return mean_absolute_error(y_v, preds)\n\nfor i in range(0, len(models)):\n    mae = score_model(models[i])\n    print(\"Model %d MAE: %d\" % (i+1, mae))","9ea2c96a":"# Fill in the line below: get test predictions\n        # using best model founded and parameters, fitting using all data to predict on X_test\n\npreds_test = model_5.predict(OH_X_test)\n#final_model = XGBRegressor(random_state = 420)\n#final_model.fit(OH_X_trainvalid, y)\n#preds_test = final_model.predict(OH_X_test)","cc8a4420":"\n# Save test predictions to file\noutput = pd.DataFrame({'Id': X_test.index,\n                       'SalePrice': preds_test})\noutput.to_csv('submission.csv', index=False)","237d954f":"**3.3 - Processamento One Hot Encoding:**","a2c13330":"**4 - Juntar tabela categoricos com numericos:**","ede02a43":"**3.1 - Categ\u00f3ricos: checar Nas:**","65ffdaac":"**6 - Submiss\u00e3o resultados:**","c7c809a9":"**2.1 - Numericos: checar NAs**","46dffcab":"**5 - Modegalem:**","3f79f21b":"Fazendo assim, sobram apenas:\n*  1 coluna (Eletrical) para estimar imputa\u00e7\u00e3o em treino (1 valor)\n*  0 coluna para estimar imputa\u00e7\u00e3o em treino\n*  7 colunas (MSZoning, Utilities, Exterior1st, Exterior2nd, KitchenQual, Functional, SaleType) para estimar imputa\u00e7\u00e3o em treino (4,2,1,1,1,2,1 valores respectivamente)","4d80efe5":"5.2 - Defini\u00e7\u00e3o modelos:","bd412b9f":"**This notebook is an exercise in the [Intermediate Machine Learning](https:\/\/www.kaggle.com\/learn\/intermediate-machine-learning) course.  You can reference the tutorial at [this link](https:\/\/www.kaggle.com\/alexisbcook\/missing-values).**\n\n---","b50df106":"In this exercise, you will work with data from the [Housing Prices Competition for Kaggle Learn Users](https:\/\/www.kaggle.com\/c\/home-data-for-ml-course). \n\n![Ames Housing dataset image](https:\/\/i.imgur.com\/lTJVG4e.png)\n\nRun the next code cell without changes to load the training and validation sets in `X_train`, `X_valid`, `y_train`, and `y_valid`.  The test set is loaded in `X_test`.","2d4e2558":"**1.1 - Checking Data:**","1d52e9e1":"**1.2 - Data split train\/valid:**","9f779736":"**1.3 - Separa\u00e7\u00e3o numerico e categorico:**","10bb09c2":"**2.2.1 - Checar:**","592bc8fd":"Now it's your turn to test your new knowledge of **missing values** handling. You'll probably find it makes a big difference.\n\n# Setup\n\nThe questions will give you feedback on your work. Run the following cell to set up the feedback system.","e9c46405":"**2.2 - Inputation em colunas com NAs:**","64185d64":"**3.2 - Inputation em colunas com NAs:**\n\n Para inputar as variaveis, vamos dividir em 2 approachs diferentes. \n*     Approach 1 - H\u00e1 colunas que colocam NA quando a observa\u00e7\u00e3o especifica tem valor 0 (EX: NA em alley \u00e9 quando nao h\u00e1 alley naquela casa)\n*     Approach 2 - Apos fazer isso, inputar lidando com dados nao disponiveis (bfill, ou most commom )","769ac40e":"  Colunas categoricas que tem NA mas que nao \u00e9 missing value:\n*     1 -Alley - NA \u00e9 No alley access\n*     2 - BsmtQual - NA \u00e9 no basement\n*     3 - BsmtExposure - NA \u00e9 No basement\n*     4 - BsmtFinType1 - NA \u00e9 No basement\n*     5 - BsmtFinType2 - NA \u00e9 No basement\n*     6 - FireplaceQu - NA \u00e9 No fireplace\n*     7 - GarageType - NA \u00e9 No Garage\n*     8 - GarageFinish - NA \u00e9 No Garage\n*     9 - GarageQual - NA \u00e9 No Garage\n*     10 - GarageCond - NA \u00e9 No Garage\n*     11 - PoolQC - NA \u00e9 No Pool\n*     12 - Fence - NA \u00e9 No Fence\n*     13 - MiscFeature - NA \u00e9 none\n*     14 - BsmtCond - NA \u00e9 No Basement"}}