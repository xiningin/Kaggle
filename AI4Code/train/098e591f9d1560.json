{"cell_type":{"a527c9ef":"code","f3495217":"code","ed175400":"code","54d6d231":"code","2520dbd9":"code","fa9b1690":"code","8505c7ce":"code","9976d944":"code","a5792c6c":"code","f9b034d6":"code","ff6544dd":"code","5984f35f":"code","94008701":"markdown"},"source":{"a527c9ef":"! pip install fastai2 \n!pip install bayesian-optimization -q","f3495217":"from fastai2.tabular.all import *\nfrom bayes_opt import BayesianOptimization\n","ed175400":"path = untar_data(URLs.ADULT_SAMPLE)\ndf = pd.read_csv(path\/'adult.csv')","54d6d231":"def fit_with(lr:float, wd:float, dp:float):\n    learn = tabular_learner","2520dbd9":"def fit_with(lr:float, wd:float, dp:float, n_layers:float, layer_1:float, layer_2:float, layer_3:float):\n\n  print(lr, wd, dp)\n  if int(n_layers) == 2:\n    layers = [int(layer_1), int(layer_2)]\n  elif int(n_layers) == 3:\n    layers = [int(layer_1), int(layer_2), int(layer_3)]\n  else:\n    layers = [int(layer_1)]\n\n  learn = tabular_learner(dls, layers=layers, metrics=accuracy, embed_p=float(dp), wd=float(wd))\n\n  with learn.no_bar() and learn.no_logging():\n    learn.fit(5, lr=float(lr))\n\n  acc = float(learn.validate()[1])\n\n  return acc","fa9b1690":"cat_names = ['workclass', 'education', 'marital-status', 'occupation', 'relationship', 'race']\ncont_names = ['age', 'fnlwgt', 'education-num']\nprocs = [Categorify, FillMissing, Normalize]\ny_names = 'salary'\nblock_y = CategoryBlock()\nsplits = RandomSplitter()(range_of(df))","8505c7ce":"\n\nto = TabularPandas(df, procs=procs, cat_names=cat_names, cont_names=cont_names,\n                   y_names=y_names, block_y=block_y, splits=splits)\n\n","9976d944":"dls = to.dataloaders(bs=512)\n","a5792c6c":"hps = {'lr': (1e-05, 1e-01),\n      'wd': (4e-4, 0.4),\n      'dp': (0.01, 0.5),\n       'n_layers': (1,3),\n       'layer_1': (50, 200),\n       'layer_2': (100, 1000),\n       'layer_3': (200, 2000)}\n\n","f9b034d6":"optim = BayesianOptimization(\n    f = fit_with, # our fit function\n    pbounds = hps, # our hyper parameters to tune\n    verbose = 2, # 1 prints out when a maximum is observed, 0 for silent\n    random_state=1\n)","ff6544dd":"%time optim.maximize(n_iter=10)","5984f35f":"print(optim.max)","94008701":"\nBayesian Optimization\n\nWhen working with BayesianOpimization, everything needs to be in a fit_with function that accepts our tuned parameters, and does whatever we require of it:\n"}}