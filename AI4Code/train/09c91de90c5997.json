{"cell_type":{"5804c75c":"code","0d30ea73":"code","85b24b99":"code","46467b6c":"code","9c4580d1":"code","d557d984":"code","c2e26bd2":"code","efec3b33":"code","19d2a3a3":"code","888edbde":"code","8d061918":"code","4ee0dce1":"code","2beb7493":"code","8e504749":"code","71fc568b":"code","a74f8c4e":"code","6620de3a":"code","9786a61c":"code","7c7127e3":"code","71cd207b":"code","4deb91b2":"code","61b66c60":"code","1ebabd2d":"code","1812bde5":"code","8bc2c4ae":"code","d4c7a555":"code","054e7dcc":"code","a25a38b8":"code","30ac78c8":"code","8c7865cc":"code","3b55df16":"code","c8bb2da6":"code","7a6f5c03":"markdown","e19a4125":"markdown","fa4454c1":"markdown","b9caf933":"markdown","077692c8":"markdown","7f54b4cf":"markdown","69dc8c72":"markdown","7d22b176":"markdown","4e360b19":"markdown","4ed632b7":"markdown","fc9c804f":"markdown","37795f70":"markdown","fdfb6f5e":"markdown","7df873d8":"markdown","68ce0861":"markdown","18b89bef":"markdown","11f4bf5e":"markdown","1c855396":"markdown","59877bcc":"markdown","b2126fe5":"markdown","702ea8ce":"markdown","3f40843c":"markdown","e3318e87":"markdown","baca2975":"markdown","3b82afc1":"markdown","56d2fd66":"markdown","61b475d8":"markdown","bde3a0c8":"markdown","dfb5dac5":"markdown","c4e77416":"markdown","45e815f8":"markdown","80f0661e":"markdown","44771553":"markdown","8ae66f00":"markdown","9771a04b":"markdown","4ff0698e":"markdown","a8710d2f":"markdown","773beece":"markdown","e8756e2b":"markdown","91ce2194":"markdown","05cebc5d":"markdown","49e379eb":"markdown","3ecd7015":"markdown","4841b105":"markdown"},"source":{"5804c75c":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt","0d30ea73":"sample = pd.read_csv(\"..\/input\/optiver-realized-volatility-prediction\/sample_submission.csv\")\nsample","85b24b99":"test = pd.read_csv(\"..\/input\/optiver-realized-volatility-prediction\/test.csv\")\ntest","46467b6c":"book_testparquet = pd.read_parquet(\"..\/input\/optiver-realized-volatility-prediction\/book_test.parquet\/stock_id=0\")\nbook_testparquet","9c4580d1":"trade_testparquet = pd.read_parquet(\"..\/input\/optiver-realized-volatility-prediction\/trade_test.parquet\/stock_id=0\")\ntrade_testparquet","d557d984":"train = pd.read_csv(\"..\/input\/optiver-realized-volatility-prediction\/train.csv\")\ntrain","c2e26bd2":"book_example = pd.read_parquet('..\/input\/optiver-realized-volatility-prediction\/book_train.parquet\/stock_id=0')\nbook_example","efec3b33":"trade_example = pd.read_parquet(\"..\/input\/optiver-realized-volatility-prediction\/trade_train.parquet\/stock_id=0\")\ntrade_example","19d2a3a3":"train","888edbde":"for col in train.columns:\n    print(col,\":\",len(train[col].unique()))","8d061918":"stock = train.groupby(\"stock_id\")[\"target\"].agg([\"mean\",\"median\",\"std\",\"count\",\"sum\"]).reset_index()\nstock","4ee0dce1":"print(\"mean value=\" ,stock[\"mean\"].mean())\nplt.hist(stock[\"mean\"])","2beb7493":"print(\"sum value=\" ,stock[\"sum\"].mean())\nplt.hist(stock[\"sum\"])","8e504749":"book_example","71fc568b":"book_test = book_example[book_example[\"time_id\"]==5]\nbook_test","a74f8c4e":"samples = [\"bid_price1\",\"bid_price2\",\"ask_price1\",\"ask_price2\"]\nsizes = [\"bid_size1\",\"ask_size1\",\"bid_size2\",\"ask_size2\"]\n\nfor num,a in enumerate(samples):\n    plt.figure(figsize = (20,5))\n    \n    plt.subplot(8,1,2*num+1)\n    \n    plt.plot(book_test[\"seconds_in_bucket\"],book_test[a],label=a)\n    #plt.title(a)\n    plt.legend(bbox_to_anchor=(1.05, 1), loc='upper left', borderaxespad=0, fontsize=18)\n    \n    plt.subplot(8,1,2*(num)+2)\n    \n    plt.bar(book_test[\"seconds_in_bucket\"],book_test[sizes[num]],color=\"green\",label=sizes[num])\n    #plt.title(label=sizes[num])\n    plt.legend(bbox_to_anchor=(1.05, 1), loc='upper left', borderaxespad=0, fontsize=18)\n\n    \n    \n    \nplt.show()\nplt.figure(figsize=(20,5))\n\nfor num,a in enumerate(samples):\n    \n   \n    plt.plot(book_test[\"seconds_in_bucket\"],book_test[a],label=a)\n    \nplt.title(\"all bid\/ask price\")\nplt.legend(bbox_to_anchor=(1.05, 1), loc='upper left', borderaxespad=0, fontsize=18)","6620de3a":"trade_example","9786a61c":"trade_test = trade_example[trade_example[\"time_id\"]==5]\ntrade_test.head(5)","7c7127e3":"plt.figure(figsize=(20,10))\nplt.subplot(2,1,1)\n\nfor num,a in enumerate(samples):\n    \n   \n    plt.plot(book_test[\"seconds_in_bucket\"],book_test[a],label=a)\n    \nplt.plot(trade_test[\"seconds_in_bucket\"],trade_test[\"price\"],label=\"trade_parquet\",lw=10)\nplt.legend(bbox_to_anchor=(1.05, 1), loc='upper left', borderaxespad=0, fontsize=18)\nplt.xlim(0,600)\n\nplt.subplot(2,1,2)\nplt.bar(trade_test[\"seconds_in_bucket\"],trade_test[\"size\"],label=\"trade_parquet_size\",color =\"green\")\nplt.legend(bbox_to_anchor=(1.05, 1), loc='upper left', borderaxespad=0, fontsize=18)\nplt.xlim(0,600)","71cd207b":"stock0 = train[train[\"stock_id\"]==0]\nmin_index = stock0[\"target\"].idxmin()\nmin_time_id = stock0.iloc[min_index][\"time_id\"]\nprint(\"min index is\",min_time_id,\"min target is\",stock0.iloc[min_index][\"target\"])","4deb91b2":"book_test_min = book_example[book_example[\"time_id\"]==min_time_id]\ntrade_test_min = trade_example[trade_example[\"time_id\"]==min_time_id]\n\n\nplt.figure(figsize=(20,5))\n\nfor num,a in enumerate(samples):\n    \n   \n    plt.plot(book_test_min[\"seconds_in_bucket\"],book_test_min[a],label=a)\n    \nplt.plot(trade_test_min[\"seconds_in_bucket\"],trade_test_min[\"price\"],label=\"trade_parquet\",lw=10)\nplt.legend(fontsize=12)","61b66c60":"stock0 = train[train[\"stock_id\"]==0]\nmax_index = stock0[\"target\"].idxmax()\nmax_time_id = stock0.iloc[max_index][\"time_id\"]\nprint(\"max index is\",max_time_id,\"max target is\",stock0.iloc[max_index][\"target\"])","1ebabd2d":"book_test_max = book_example[book_example[\"time_id\"]==max_time_id]\ntrade_test_max = trade_example[trade_example[\"time_id\"]==max_time_id]\n\n\nplt.figure(figsize=(20,5))\n\nfor num,a in enumerate(samples):\n    \n   \n    plt.plot(book_test_max[\"seconds_in_bucket\"],book_test_max[a],label=a)\n    \nplt.plot(trade_test_max[\"seconds_in_bucket\"],trade_test_max[\"price\"],label=\"trade_parquet\",lw=10)\nplt.legend(fontsize=12)","1812bde5":"plt.figure(figsize=(20,5))\nplt.plot(trade_test_min[\"seconds_in_bucket\"],trade_test_min[\"price\"],lw=10,label=\"min_vol_time\")\nplt.plot(trade_test_max[\"seconds_in_bucket\"],trade_test_max[\"price\"],lw=10,label = \"max_vol_time\")\nplt.legend(fontsize=15)","8bc2c4ae":"stock","d4c7a555":"stock2 = stock[[\"stock_id\",\"median\"]]\nstock2 = stock2.set_index(\"stock_id\")\nstock2\n","054e7dcc":"stock_dict = stock2.to_dict()\n\n# example : stock id = 0 median median value\nstock_dict[\"median\"][0]","a25a38b8":"sample # sample_submission.csv","30ac78c8":"sample[\"stock_id\"] = [s.split(\"-\")[0] for s in sample[\"row_id\"]]\nsample","8c7865cc":"sample[\"target\"] = [stock_dict[\"median\"][int(s)] for s in sample[\"stock_id\"]]\nsample","3b55df16":"sample = sample.drop(\"stock_id\",axis=1)\nsample","c8bb2da6":"sample.to_csv(\"submission.csv\",index=False)","7a6f5c03":"## 5.1.2 Statistic by stock","e19a4125":"Since the scale of the vertical axis is completely different, I compared the actual trade transactions (purple lines).","fa4454c1":"# 1. What to predict ??  (Let's look from sample_submission.csv)","b9caf933":"### There are only row_id and target.\n### I think target is a volatility(degree of price fluctuation) that we must predict.\n### See below for what row_id is.","077692c8":"#### Let's look at the histogram only for the mean value and sum.","7f54b4cf":"# Thank you for watching until the end. \n  \u203b Thank you to those who have uploaded to my notebook before.\n# If you find it useful, I would be grateful if you could **upvote**!","69dc8c72":"# 3. train.csv","7d22b176":"## There are 112 types of stock_id, 3830 types of time_id, and 414287 types of target.","4e360b19":"## 6.2 Replace submit file and generate submission file","4ed632b7":"#### From these information, I think it is a competition that we will pred the volatility (degree of price fluctuation) of each stocks by time.\n#### Based on the above, we will look at train data including the explanation of each column item, EDA and, finally submit it as a trial.","fc9c804f":"******Supplementary explanation (Personal Interpretation)******\n\nThe amount actually traded in real time. It is estimated that the buyer bought this quantity at this price and the seller sold at this price.","37795f70":"## 6.1 Creating a dictionary of median values for each stock","fdfb6f5e":"## 5.2 Relationship between Bid, Ask on the order book, and actual transaction behavior price within time_id","7df873d8":"#### Add the actual transaction to the whole graph","68ce0861":"# **Optiver Realized Volatility Prediction**&#x1f600;\nApply your data science skills to make financial markets better\n \n ## \u203b\u3000Japanese version is here.\n \n https:\/\/www.kaggle.com\/chumajin\/optiver-realized-eda-for-starter-version\n\n\n## I think this competition is a competition that predicts the volatility (degree of price fluctuation) of stocks by time (time id).\n\n\n## If you find it useful, I would be grateful if you could **upvote**.\n\u3000\u203b Thank you to those who have uploaded to my notebook before !\n \n \n","18b89bef":"#### Add the actual transaction information to this.","11f4bf5e":"## 4.2 **trade_train.parquet**\n\n#### Contains data on trades that actually executed. Usually, in the market, \n\n#### there are more passive buy\/sell intention updates (book updates) than actual trades, \n\n#### therefore one may expect this file to be more sparse than the order book.\n","1c855396":"## **4.1 book_train.parquet**\n\n\n#### Provides order book data on the most competitive buy and sell orders entered into the market. The top two levels of the book are shared. \n#### The first level of the book will be more competitive in price terms, it will then receive execution priority over the second level.\n","59877bcc":"Extract stock_id from row_id","b2126fe5":"On the other hand, let's visualize when the volatility is the highest of stock_id=0.","702ea8ce":"Let's visualize when the volatility is the lowest of stock_id=0.","3f40843c":"# 6.submit","e3318e87":"******Supplementary explanation (Personal Interpretation)******\n\nI think the order book data is like the reservation status. \n\n\nWhen the price drops to this price, the person who made the reservation will buy it. \n\n\nOn the other hand, the person who made the reservation can sell when it comes up.","baca2975":"Substitute the contents of the dictionary type","3b82afc1":"* stock_id - Same as above.\n* time_id - Same as above.\n* seconds_in_bucket - Same as above. Note that since trade and book data are taken from the same time window and trade data is more sparse in general, this field is not necessarily starting from 0.\n* price - The average price of executed transactions happening in one second. Prices have been normalized and the average has been weighted by the number of shares traded in each transaction.\n* size - The sum number of shares traded.\n* order_count - The number of unique trade orders taking place.","56d2fd66":"# 2. What to predict from?? (Let's see from test.csv)","61b475d8":"## Purple is the actual deal. It's wandering between bid and ask on the order book.\n\n#### \u203b Maybe, it is estimated that if it gets close to the bit or ask, there is an offense and defense,\n\n#### and if it exceeds it, break it, and so on.\n\n#### I am not major of this part, so I will leave it to the experts.","bde3a0c8":"## In the trial, enter all the median values \u200b\u200bfor each stock and submit","dfb5dac5":"stock_id deleted","c4e77416":"--------------Below, let's look at the 10-minute behavior of time_id = 5 with stock id = 0. -------------","45e815f8":"Bid is the price the buyer wants to buy the stock, and Ask is the price the seller wants to sell the stock.\n\n* stock_id: Stock (which stock) Parquet coerces this column to the categorical data type when loaded; you may wish to convert it to int8.\n* time_id: id of which time information (linked to time_id in submission file)\n* seconds_in_bucket: How many seconds after starting from 0 in time_id? Maybe you're predicting a total volatility of 10 minutes, so seconds_in_bucket should be up to 600 sec\n* bid_price1,2: 1st and 2nd desired bid price of the stock (Normalized prices of the most \/ second most competitive buy level. )\n\n* ask_price1,2: Desired selling price of the stock(Normalized prices of the most\/second most competitive sell level.)\n\n* bid_size1,2: The number of shares on the most\/second most competitive buy level.\n* ask_size1,2: The number of shares on the most\/second most competitive sell level.\n\n","80f0661e":"## 5.2.2 One of the image for understanding the volatility","44771553":"#### Very simple configuration. The stock_id, time_id, and target values of the stock are shown.\n#### I think target is the total volatility for 10 minutes that is explained in Data explanation on this competition (this is the target for learning).","8ae66f00":"## The total volatility during this period is 14.8, max, and there are more than 30.","9771a04b":"## 5.1 Analysis by stock\n### 5.1.1 Number of shares","4ff0698e":"## 5.2.1 Price fluctuation (individual + whole)\n\n#### First, order book information","a8710d2f":"#### You can see that the row_id of the submission file is the stock_id (stock id) and time_id (time id) connected by string \"-\".","773beece":"# 5. EDA","e8756e2b":"When the volatility is high, in this case, it can be seen that the price fluctuates considerably in 10 minutes.\n\n\n(Variation and Max-Min seem to be important)\n\n\nThis is one of the examples for the image of the volatility.","91ce2194":"#### In addition, test.csv comes with **book_test.parquet** and **trade_test.parquet**. \n#### Let's see in the case of stock_id = 0. \n\u203b\u3000It opens with the file path, but it seems to open with the path to the folder above it.","05cebc5d":"# 4. train.parquet","49e379eb":"#### Similar to the explanation in the test data, the files book_train.parquet and trade_train.parquet are attached to train.csv.\n#### For example, take a look at each parquet file of the stock_id = 0 in the train.csv.","3ecd7015":"#### It can be seen that the values of bid and ask fluctuate even within 10 minutes of time id = 5. \n#### The variability in this may be related to volatility.\n#### For example, when news comes in that the stock price fluctuates suddenly, the volatility rises.\n#### Therefore, there is possiblity that the variation will be large.\n#### Additionally, Max-Min may be important. (It's the opposite idea because we predict the volatility)","4841b105":"## The average value is 0.003, which is close to 0."}}