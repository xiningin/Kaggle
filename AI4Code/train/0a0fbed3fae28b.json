{"cell_type":{"0c6f70f5":"code","01701fe5":"code","271d28ac":"code","e7167cd0":"markdown","5d412402":"markdown"},"source":{"0c6f70f5":"import pandas as pd\nimport covid19_tools as cv19\nimport os\nimport re\nfrom IPython.core.display import display, HTML\nimport html\n\npd.set_option('display.max_columns', 500)","01701fe5":"# Load the metadata\nMETADATA_FILE = '..\/input\/CORD-19-research-challenge\/metadata.csv'\nmeta = cv19.load_metadata(METADATA_FILE)\nmeta, covid19_counts = cv19.add_tag_covid19(meta)\nmeta, riskfac_counts = cv19.add_tag_risk(meta)\nn = sum(meta.tag_disease_covid19 & meta.tag_risk_factors)\nprint(f'{n} papers on tag_disease_covid19 x tag_risk_factors')\n\n# Load research design\nmeta2 = pd.read_csv('..\/input\/cord-19-study-metadata-export\/metadata_study.csv')\nmeta2['design'] = meta2.Design.apply(lambda x: cv19.DESIGNS[x])\nmeta = meta.merge(meta2[['Id', 'design']], left_on='sha', right_on='Id', how='left')\nmeta['design'] = meta.design.fillna('Other')\nmeta.drop('Id', axis=1, inplace=True)\n\nprint('Loading full text for tag_disease_covid19 x tag_risk_factors')\nfull_text = cv19.load_full_text(meta[meta.tag_disease_covid19 & meta.tag_risk_factors],\n                                '..\/input\/CORD-19-research-challenge\/')\n\nfull_text_df = pd.DataFrame(full_text)\n\ncase_sensitive_keywords = [\n    r'^\\b$' # regex for match nothing\n]\ncase_insensitive_keywords = [\n    'smoker',\n    'smoking',\n    'smoked',\n    'smokes',\n    'nicotine',\n    'tobacco',\n    'cigar'\n]\n\nsmoking_df = full_text_df[full_text_df.body_text.astype(str)\n                          .str.lower()\n                          .str.contains('|'.join(case_insensitive_keywords)) |\n                          full_text_df.body_text.astype(str)\n                          .str.contains('|'.join(case_sensitive_keywords))]\n\nanalysis_df = cv19.term_matcher(smoking_df, meta,\n                                case_sensitive_keywords,\n                                case_insensitive_keywords)\n\ntemp_id = []\nhtml_string = f'<h1>Relevant papers<\/h1><p><b>{len(smoking_df)} papers found<\/b><br><br>'\nfor i, row in enumerate(analysis_df.itertuples()):\n    current_id = [row.doi, row.authors, row.title]\n    if current_id != temp_id:\n        temp_id = current_id\n        if i > 0:\n            html_string += '<\/ul><br><br>'\n        html_string += f'<b><a href=\"{row.doi}\">{html.escape(row.title)}<\/a><\/b><br>'\n        html_string += f'{row.authors} ({row.publish_time})<br>'\n        html_string += f'<i>Research design: {row.design}<\/i>'\n        html_string += '<ul>'\n    html_string += f'<li>{html.escape(row.extracted_string)}<\/li>'\nhtml_string += '<\/ul'\ndisplay(HTML(html_string))","271d28ac":"analysis_df.to_csv('risk_factors_smoking.csv', index=False)","e7167cd0":"# Covid-19 Risk factors: Drinking","5d412402":"This Notebook includes the output data from [@davidmezzetti](https:\/\/www.kaggle.com\/davidmezzetti)'s Notebook [CORD-19 Study Metadata Export](https:\/\/www.kaggle.com\/davidmezzetti\/cord-19-study-metadata-export)."}}