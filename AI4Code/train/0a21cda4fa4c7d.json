{"cell_type":{"a0838a58":"code","fa8e017a":"code","7db1771f":"code","2de77830":"code","25123b5b":"code","39135736":"code","df95f49c":"markdown"},"source":{"a0838a58":"import pandas as pd\nimport numpy as np\nimport fastai\nfrom fastai.vision.all import *\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","fa8e017a":"submission = pd.read_csv('..\/input\/petfinder-pawpularity-score\/sample_submission.csv')\n\ntest = submission.copy()\n\ntest['Id'] = 'test\/' + test['Id'] + '.jpg'\ntest.head()","7db1771f":"def inf_run(fold):\n    learn = load_learner(fname = Path(f'..\/input\/petfinder2021-fastai-train\/export_fold_{fold}.pkl'), cpu=False)\n    test_dl = learn.dls.test_dl(test)\n    preds, _ = learn.get_preds(dl=test_dl) # tta\n    \n    return preds","2de77830":"submission['Pawpularity'] = 0\n\nfor fold in range(7):\n    preds = inf_run(fold)\n    test[f'preds_{fold}'] = preds.numpy()[:,0]\n","25123b5b":"test.head()","39135736":"submission.Pawpularity = test[['preds_'+str(i) for i in range(7)]].mean(axis=1)\nsubmission.to_csv('submission.csv', index = False)\n\nsubmission.head()","df95f49c":"# PetFinder2021 simple Fastai Inference\n\nThis is a simple Fastai Inference Notebook. The models are trained on images only.\n\nThe Train notebook can be found [here](https:\/\/www.kaggle.com\/joatom\/petfinder2021-fastai-train).\n\nRelated Discussion [here](https:\/\/www.kaggle.com\/c\/petfinder-pawpularity-score\/discussion\/294822#1617055).\n"}}