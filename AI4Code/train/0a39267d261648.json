{"cell_type":{"e932a9ef":"code","9e2f817d":"code","8437760a":"code","0d5b9766":"code","34c20e2e":"code","f658cf13":"code","6939c2d2":"code","d04a997f":"code","deeb055e":"code","be36ef39":"code","64846413":"code","84642f96":"code","c677a27d":"code","4e37cf8a":"code","d429f403":"code","d2812ecc":"markdown","f7c302b6":"markdown","f13dc120":"markdown","3fe69aa1":"markdown","8e1ff6b4":"markdown","91b9e6b3":"markdown","ade492c9":"markdown","5c5ae9e0":"markdown","343459e2":"markdown","6bdaafd9":"markdown","b6c6698f":"markdown","25228a5b":"markdown","5c42b3d8":"markdown","c9a77c77":"markdown","1d00958d":"markdown","ec6731a7":"markdown","2124114a":"markdown","dfe2e81e":"markdown","9ea24eee":"markdown","2e4ccb44":"markdown"},"source":{"e932a9ef":"import pandas as pd\nfrom sklearn.model_selection import train_test_split\nfrom catboost import CatBoostClassifier, cv, Pool\nimport seaborn as sns\nimport matplotlib.pyplot as plt","9e2f817d":"SEED = 42","8437760a":"df = pd.read_csv('..\/input\/water-potability\/water_potability.csv')\ndf.head()","0d5b9766":"sns.heatmap(df.corr())","34c20e2e":"df.corr()['Potability']","f658cf13":"df['Potability'].hist(bins=2)","6939c2d2":"pots = df['Potability']\nw0 = 1\nw1 = pots[pots == 0].count() \/ pots[pots == 1].count()\nclass_weights = [w0, w1]\nclass_weights","d04a997f":"cv_pool = Pool(df.drop('Potability', axis=1), df['Potability'])\n\nparams = {'iterations': 500,\n          'loss_function': 'Logloss',\n          'eval_metric': 'F1',\n          'class_weights': class_weights,\n          'roc_file': 'roc_file',\n          'verbose': False}","deeb055e":"model = CatBoostClassifier()\nmodel.set_params(**params)\n\ngrid = {'learning_rate': [0.03, 0.1],\n        'depth': [4, 6, 10],\n        'l2_leaf_reg': [1, 3, 5, 7, 9]}\n\ngrid_search_result = model.grid_search(grid, \n                                       cv_pool,\n                                       verbose=False,\n                                       plot=False)","be36ef39":"params.update(grid_search_result['params'])","64846413":"scores = cv(cv_pool,\n            params,\n            fold_count=5, \n            verbose=False)","84642f96":"roc_curve = pd.read_csv('catboost_info\/roc_file', sep='\\t')\n\nplt.plot(roc_curve['FPR'], roc_curve['TPR'])\n\nplt.title('ROC-curve')\nplt.xlabel('FPR')\nplt.ylabel('TPR')\n\nplt.show()","c677a27d":"print('AUC:', roc_curve['TPR'].sum() \/ roc_curve['TPR'].count())","4e37cf8a":"model = CatBoostClassifier()\nmodel.set_params(**params)\nmodel.fit(cv_pool, silent=True)","d429f403":"print('Logloss:', scores['test-Logloss-mean'].iloc[-1])\nprint('F1-score:', scores['test-F1-mean'].iloc[-1])","d2812ecc":"**Roc-curve**","f7c302b6":"And call cross-validation.","f13dc120":"**Reading dataset**","3fe69aa1":"**Conclusions**  \nFeatures are uncorrelated with target therefore there was created a low quality classificator. I think it is necessary to collect more data for using machine learning algorithms.","8e1ff6b4":"As we can see, there are low coefficients of correlation therefore we can make a conclusion that we should collect more data.","91b9e6b3":"**Histogram of potability**","ade492c9":"<h1><center>Water quality<\/h1><\/center>","5c5ae9e0":"We have imbalanced dataset therefore we should use _cross-validation_ for training model.","343459e2":"Roc-curve shows us that we have low quality classificator. Let's calculate _AUC_ (Area Under Curve) to prove it.","6bdaafd9":"**Correlation matrix**","b6c6698f":"**Cross-validation**","25228a5b":"## Catboost. Cross-validation","5c42b3d8":"Let's search the best params for training.","c9a77c77":"Add the best values of parameters to `params`.","1d00958d":"In the histogram we can see that we work with imbalanced dataset. Therefore we should calculate `class_weights`. I follow the tip in the [catboost_docs](https:\/\/catboost.ai\/docs\/concepts\/python-reference_parameters-list.html) and calculate the value by this formula:  \n<center>$\\large\\begin{array}{l}\n{w_0} = 1;\\\\\n{w_1} = \\frac{{sum\\_negative}}{{sum\\_positive}}.\n\\end{array}$","ec6731a7":"**Training**","2124114a":"**Importing libraries**","dfe2e81e":"**Correlation of potability versus other features**","9ea24eee":"**Grid search**","2e4ccb44":"AUC is above 0.5 but not so much for telling that it is a good classificator."}}