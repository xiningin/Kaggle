{"cell_type":{"01ce215d":"code","88f61dfa":"code","0b6a9c4c":"code","66956cca":"code","4be8f527":"code","8ed67c4f":"code","6d743937":"code","87917402":"code","3c9d820a":"code","1b094290":"code","c38342e0":"code","6d8d74a9":"code","34ae8b25":"code","1884e286":"code","c2717cdf":"code","078eabfe":"code","76a09ace":"code","61f70849":"code","a77ae5f3":"code","7a173721":"code","e3f8f1af":"code","3cbc2dbf":"code","6aaa4452":"markdown","0c7547a1":"markdown","7124ddaf":"markdown","673dd233":"markdown","2544149b":"markdown","7357ef31":"markdown","a7c3f355":"markdown","3345f357":"markdown","f04d95dc":"markdown","10bee007":"markdown","8e4f0e31":"markdown","95282c38":"markdown","1ebb7a72":"markdown"},"source":{"01ce215d":"import pandas as pd \nimport os ","88f61dfa":"column_dictionary={'Country or region':'Country','Country':'Country',\n'Happiness.Rank':'Rank','Overall rank':'Rank','Happiness Rank':'Rank',\n'Region':'Region', 'Family':'Family',\n'Happiness.Score':'Score', 'Happiness Score': 'Score', 'Score':'Score', 'Generosity':'Generosity','Standard Error':'Standard_Error',\n'Economy..GDP.per.Capita.':'GDP', 'Economy (GDP per Capita)':'GDP', 'GDP per capita':'GDP', \n'Health (Life Expectancy)':'Healthy_life_expectancy', 'Health..Life.Expectancy.':'Healthy_life_expectancy','Healthy life expectancy':'Healthy_life_expectancy',\n'Dystopia.Residual':'Dystopia_Residual', 'Dystopia Residual':'Dystopia_Residual','Whisker.high':'Whisker.high', 'Whisker.low':'Whisker.low', 'Social support':'Social_Support',\n'Freedom to make life choices':'Freedom', 'Freedom':'Freedom', 'Lower Confidence Interval':'LCI', 'Upper Confidence Interval':'UCI',\n'Perceptions of corruption':'TGC','Trust (Government Corruption)':'TGC', 'Trust..Government.Corruption.':'TGC'\n}","0b6a9c4c":"      \nfrom pathlib import Path\ndatas=[]\nyears=[]\ncsv_files = [csvfile for csvfile in Path(\"\/kaggle\/input\/world-happiness\/\").iterdir() if csvfile.is_file() and csvfile.suffix == '.csv']\nfor file in csv_files:\n    directory, filename = os.path.split(file)\n    data = pd.read_csv(file)\n    data.columns = [column_dictionary[x] for x in data.columns]\n    year=int( filename.split('.')[0])\n    data['Year']=year  \n    years.append(year)\n    datas.append(data)\nyears.sort()\ndf=pd.concat(datas).sort_values(by=['Year','Rank'])\ndf.set_index(['Country','Year'])\n","66956cca":"df_turkey=df[df.Country=='Turkey']\n","4be8f527":"features=['Freedom','GDP', 'Generosity','Healthy_life_expectancy','TGC']\npredicted_feature=['Score']","8ed67c4f":"import seaborn as sns\nimport numpy as np\nimport matplotlib.pyplot as plt\nsns.set_palette(\"RdBu\")\n\ncorrelation=df_turkey[features+predicted_feature].corr()\nsns.heatmap(correlation, annot=True)\nplt.show()","6d743937":"sns.pairplot(df_turkey[features+predicted_feature], kind='reg')","87917402":"import statistics\nfig, ax = plt.subplots(1,2, figsize=(20, 6))\nmedian_year=statistics.median(years)\n\ncorrelation_first_half=df_turkey[df_turkey.Year<=median_year][features+predicted_feature].corr()\nax[0].set_title(f'[{years[0]}-{median_year}] years')\nsns.heatmap(correlation_first_half, annot=True, ax=ax[0])\n\ncorrelation_second_half=df_turkey[df_turkey.Year>=median_year][features+predicted_feature].corr()\nax[1].set_title(f'[{median_year}-{years[-1]}] years')\nsns.heatmap(correlation_second_half, annot=True, ax=ax[1])\nplt.show()","3c9d820a":"from sklearn import linear_model\n\nX = df_turkey[features] \ny = df_turkey[predicted_feature]\n\nregr = linear_model.LinearRegression()\nregr.fit(X, y)\n\nprint('Intercept: \\n', regr.intercept_)\nprint('Coefficients: \\n', regr.coef_)\n\nfig=sns.barplot(y=features, x=regr.coef_[0])\nplt.show()","1b094290":"import matplotlib.pyplot as plt\ncolors=[\"#648FFF\",\"#DC267F\",\"#FFB000\",\"#BBFF00\",\"#00B0FF\",\"#00B000\"]\nprint(features)\nprint(years)","c38342e0":"def plot_features(df_, features_, regr_, x_):\n    fig, axs = plt.subplots(1,len(features_), figsize=(25, 6))\n    for i in range(len(features_)):\n        axs[i].plot( df_[x_],df_[features_[i]], colors[i])\n        axs[i].set_title(features_[i]+\"\\nCoefficient : \"+ \"%.6f\"% regr_.coef_[0][i])\n        if x_!= 'Year':\n            axs[i].set_xticklabels(df_[x_], rotation=60)","6d8d74a9":"plot_features(df_turkey, features, regr,'Year')","34ae8b25":"year=years[-1]\ndf_year=df[df.Year==year]\n","1884e286":"happies_country=df_year[df_year.Rank==1][['Country','Score','Rank']]\nprint(f'The happiest Country in {year} is: {happies_country.Country.values} with {happies_country.Score.values} score.')","c2717cdf":"#Add Social_Support to the before features\nfeatures_year=features+['Social_Support']","078eabfe":"sns.set_palette(\"RdBu\")\n\ncorrelation=df_year[features_year+predicted_feature].corr()\nsns.heatmap(correlation, annot=True)\nplt.show()","76a09ace":"sns.pairplot(df_year[features_year+predicted_feature], kind='reg')","61f70849":"from sklearn import linear_model\n\nX = df_year[features_year]\ny = df_year[predicted_feature]\n\nregr = linear_model.LinearRegression()\nregr.fit(X, y)\n\nprint('Intercept: \\n', regr.intercept_)\nprint('Coefficients: \\n', regr.coef_)\nprint('Score: \\n', regr.score(X,y))\nfig=sns.barplot(y=features_year, x=regr.coef_[0])\n\nplt.show()","a77ae5f3":"plot_features(df_year[df_year.Rank<=5], features_year, regr,'Country')","7a173721":"import statsmodels.api as sm","e3f8f1af":"fig, ax = plt.subplots(ncols=6, sharey=True, figsize=(25,6))\ni=0\nfor feature in features_year:\n    X_f=sm.add_constant(df_year[feature])\n    lm=sm.OLS(y, X_f)\n    model=lm.fit()\n    print(f'{feature.ljust(25)}: MSE: {model.mse_model}\\t R_Squared: {model.rsquared}\\t R_Squared_Adj: {model.rsquared_adj}')\n    sub_function= format(\"%.4f\" % model.params[0]) + ' + ' + feature+ \"*\"+format(\"%.4f\" % model.params[1])\n    #print('Lineer Function of the Score='+sub_function+'\\n')\n    #print(y.merge(pd.DataFrame(pd.DataFrame(model.fittedvalues)), left_index=True, right_index=True))\n    g=sns.regplot(df_year[feature], y, ci=None,  ax=ax[i])\n    g.set_title(sub_function)\n    g.set_ylabel('Score')\n    g.set_xlabel(feature)\n    plt.ylim(bottom=0)\n    i=i+1\n \n\n    ","3cbc2dbf":"import functools, operator\nlm=sm.OLS(y, X)\nmodel=lm.fit()\n\nstr_function= 'Function of the Score='+format(\"%.4f\" % model.params[0])+' + '+' + '.join([ format( x)+\"*\"+ format(\"%.4f\" % model.params[x])+' '  for x in features_year])\nprint('With single model Lineer '+str_function)\nmodel.summary()","6aaa4452":"The result of correlation table:\nIn the whole World in 2019 the order of strong correlation and explanation of features are:\n1. GDP means; **Gross domestic product** 0.79 - pozitive correlation\n1. **Health (Life Expectancy)** 0.78 - pozitive correlation\n1. **Social Support** 0.78 - pozitive correlation -\n1. **Freedom** 0.57 - pozitive correlation\n1. TGC means; **Trust Government Corruption** 0.39 - pozitive correlation\n1. **Generostiy** 0.076 - pozitive correlation","0c7547a1":"The result of correlation table:\nIn Turkey during all years the order of strong correlation and explanation of features are:\n1. **Freedom** with value 0.88 - pozitive correlation -\n1. TGC means; **Trust Government Corruption** -0.76 - negative correlation\n1. GDP means; **Gross domestic product** 0.61 - pozitive correlation\n1. **Health (Life Expectancy)** -0.59 - negative correlation\n1. **Generostiy** -0.39 - negative correlation","7124ddaf":"Let's write a common function to show features as subplot in loops","673dd233":"* # Q1: Find out factors affecting the happiness of people in Turkey during all years","2544149b":"Although there is 5 csv, my goal is to collect all csvs in a single dataframe.","7357ef31":"Let's split all years by 2 and look at the first half and second half changes.","a7c3f355":"**Linear Regression** is a technique used for the modeling and analysis of *numerical data* and exploits the *relationship* between two or more variables so that we can gain information about one of them through knowing values of the other\nSo it is so suitable for our problem.","3345f357":"**Heatmap** is the best visualization plot type for showing the correlation.","f04d95dc":"There is one csv file for **each** year in our data set. Some columns are discrete and some are common. Also for common columns, there are different headers. So, we create a common dictionary for all csvs","10bee007":"* # Q2: Find out factors affecting the happiness of people in all countries in last year *2019*\n* find last year","8e4f0e31":"## Introduction\nIn this notebook, we are going to study with the dataset www.kaggle.com\/unsdsn\/world-happiness and find out factors affecting the happiness of people. \nFirst, we find the factors affecting happiness in Turkey for all years only then will compare all the countries in the world in last year *2019*. In doing so, we will use various visualization tools to make it easier to understand.","95282c38":"## OLS Regression Model\nOrdinary least squares (OLS) is a type of linear least squares method for estimating the unknown parameters in a linear regression model.(https:\/\/en.wikipedia.org\/wiki\/Ordinary_least_squares)","1ebb7a72":"Lets look at the model function with single mode, it means all features_year are involved in the lineer function and independent variable"}}