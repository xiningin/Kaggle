{"cell_type":{"c400f173":"code","1c2d02ee":"code","355fdee9":"code","d466bd70":"code","8efee03f":"code","3a0fe7bc":"code","3850f2fa":"code","b8eefd0e":"code","c882863f":"code","1f8dbe84":"code","410159a6":"code","524576a9":"code","57a8f676":"code","087d7e12":"code","a40867df":"code","5c4b7964":"code","52c1242d":"code","3d102e35":"code","d412190c":"code","8557e201":"code","8ba5bfa7":"code","d2ea1610":"code","81035ec5":"code","7d0d485c":"code","0576f574":"code","5cb06df5":"code","740caa35":"code","893b6431":"code","e3b64c34":"code","f0350a4f":"code","60ce5e8a":"code","c7d2c323":"code","9852d54d":"code","ba0e44ea":"code","158bc9fa":"code","14089e30":"code","7b36c395":"code","2e2b868f":"code","5cc776ea":"markdown","8b3c9eb4":"markdown","ba40ff26":"markdown","c9bce3e2":"markdown","85b7f214":"markdown","e8e95e33":"markdown","89f8652d":"markdown"},"source":{"c400f173":"import sys\nsys.executable","1c2d02ee":"# 2.1 Display multiple outputs from a jupyter cell\nfrom IPython.core.interactiveshell import InteractiveShell\nInteractiveShell.ast_node_interactivity = \"all\"","355fdee9":"#2.2 Import various packages required\nimport pandas as pd\nimport numpy as np\nimport plotly.express as px\nfrom plotly.subplots import make_subplots\nfrom sklearn.model_selection import train_test_split\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.cluster import KMeans\nfrom sklearn.metrics import silhouette_score\nfrom sklearn.preprocessing import StandardScaler\nfrom yellowbrick.cluster import SilhouetteVisualizer\nimport os","d466bd70":"#2.3 Load Compan'y fundamental financial data\nfundamentals = pd.read_csv(\"..\/input\/nyse\/fundamentals.csv\",parse_dates = ['Period Ending'],index_col='Unnamed: 0')\nsecurities =   pd.read_csv(\"..\/input\/nyse\/securities.csv\",parse_dates = ['Date first added'])","8efee03f":"#2.4 Rename columns, removing spaces and other symbols\nrenamed_columns = {'Ticker Symbol':'TickerSymbol',\n'Period Ending':'PeriodEnding',\n'Accounts Payable':'AccountsPayable',\n'Accounts Receivable':'AccountsReceivable',\n'Add\\'l income\/expense items':'Addlincome_expenseitems',\n'After Tax ROE':'AfterTaxROE',\n'Capital Expenditures':'CapitalExpenditures',\n'Capital Surplus':'CapitalSurplus',\n'Cash Ratio':'CashRatio',\n'Cash and Cash Equivalents':'CashandCashEquivalents',\n'Changes in Inventories':'ChangesinInventories',\n'Common Stocks':'CommonStocks',\n'Cost of Revenue':'CostofRevenue',\n'Current Ratio':'CurrentRatio',\n'Deferred Asset Charges':'DeferredAssetCharges',\n'Deferred Liability Charges':'DeferredLiabilityCharges',\n'Depreciation':'Depreciation',\n'Earnings Before Interest and Tax':'EarningsBeforeInterestandTax',\n'Earnings Before Tax':'EarningsBeforeTax',\n'Effect of Exchange Rate':'EffectofExchangeRate',\n'Equity Earnings\/Loss Unconsolidated Subsidiary':'EquityEarnings_LossUnconsolidatedSubsidiary',\n'Fixed Assets':'FixedAssets',\n'Goodwill':'Goodwill',\n'Gross Margin':'GrossMargin',\n'Gross Profit':'GrossProfit',\n'Income Tax':'IncomeTax',\n'Intangible Assets':'IntangibleAssets',\n'Interest Expense':'InterestExpense',\n'Inventory':'Inventory',\n'Investments':'Investments',\n'Liabilities':'Liabilities',\n'Long-Term Debt':'Long-TermDebt',\n'Long-Term Investments':'Long-TermInvestments',\n'Minority Interest':'MinorityInterest',\n'Misc. Stocks':'MiscStocks',\n'Net Borrowings':'NetBorrowings',\n'Net Cash Flow':'NetCashFlow',\n'Net Cash Flow-Operating':'NetCashFlow-Operating',\n'Net Cash Flows-Financing':'NetCashFlows-Financing',\n'Net Cash Flows-Investing':'NetCashFlows-Investing',\n'Net Income':'NetIncome',\n'Net Income Adjustments':'NetIncomeAdjustments',\n'Net Income Applicable to Common Shareholders':'NetIncomeApplicabletoCommonShareholders',\n'Net Income-Cont. Operations':'NetIncome-ContOperations',\n'Net Receivables':'NetReceivables',\n'Non-Recurring Items':'Non-RecurringItems',\n'Operating Income':'OperatingIncome',\n'Operating Margin':'OperatingMargin',\n'Other Assets':'OtherAssets',\n'Other Current Assets':'OtherCurrentAssets',\n'Other Current Liabilities':'OtherCurrentLiabilities',\n'Other Equity':'OtherEquity',\n'Other Financing Activities':'OtherFinancingActivities',\n'Other Investing Activities':'OtherInvestingActivities',\n'Other Liabilities':'OtherLiabilities',\n'Other Operating Activities':'OtherOperatingActivities',\n'Other Operating Items':'OtherOperatingItems',\n'Pre-Tax Margin':'Pre-TaxMargin',\n'Pre-Tax ROE':'Pre-TaxROE',\n'Profit Margin':'ProfitMargin',\n'Quick Ratio':'QuickRatio',\n'Research and Development':'ResearchandDevelopment',\n'Retained Earnings':'RetainedEarnings',\n'Sale and Purchase of Stock':'SaleandPurchaseofStock',\n'Sales, General and Admin.':'SalesGeneralandAdmin.',\n'Short-Term Debt \/ Current Portion of Long-Term Debt':'Short-TermDebt_CurrentPortionofLong-TermDebt',\n'Short-Term Investments':'Short-TermInvestments',\n'Total Assets':'TotalAssets',\n'Total Current Assets':'TotalCurrentAssets',\n'Total Current Liabilities':'TotalCurrentLiabilities',\n'Total Equity':'TotalEquity',\n'Total Liabilities':'TotalLiabilities',\n'Total Liabilities & Equity':'TotalLiabilities&Equity',\n'Total Revenue':'TotalRevenue',\n'Treasury Stock':'TreasuryStock',\n'For Year':'ForYear',\n'Earnings Per Share':'EarningsPerShare',\n'Estimated Shares Outstanding':'EstimatedSharesOutstanding'\n }\nfundamentals.rename(renamed_columns,inplace = True , axis = 1)","3a0fe7bc":"#2.5 Check NA in columns\nfundamentals.isna().any()","3850f2fa":"#2.5 Update columns containing NA\nfundamentals.loc[fundamentals['ForYear'].isnull() == True ,'ForYear'] = fundamentals['PeriodEnding'].dt.year\nfundamentals.loc[fundamentals['CurrentRatio'].isnull() == True,'CurrentRatio'] = 0\nfundamentals.loc[fundamentals['CashRatio'].isnull() == True,'CashRatio'] = 0\nfundamentals.loc[fundamentals['QuickRatio'].isnull() == True,'QuickRatio'] = 0\nfundamentals.loc[fundamentals['EarningsPerShare'].isnull() == True,'EarningsPerShare'] = 0\nfundamentals.loc[fundamentals['EstimatedSharesOutstanding'].isnull() == True,'EstimatedSharesOutstanding'] = 0\nfundamentals.loc[fundamentals['ForYear'] == 1215,'ForYear'] = 2015","b8eefd0e":"# 2.6 Removing outliners\nfundamentals['ForYear'].value_counts()\nfundamentals.drop(fundamentals[(fundamentals['ForYear'] == 2003.0) | (fundamentals['ForYear'] == 2004.0) | (fundamentals['ForYear'] == 2007.0) | (fundamentals['ForYear'] == 2006.0) | (fundamentals['ForYear'] == 2017.0)].index,inplace=True)\nfundamentals['ForYear'] = fundamentals['ForYear'].astype('int')","c882863f":"fundamentals.columns\nsecurities.columns","1f8dbe84":"# 4.1.1 Calculating Mean Companywise for all the years considered\ncompanywise_mean=fundamentals.groupby('TickerSymbol').mean().reset_index()","410159a6":"# 4.1.2 Considering Cash Ratio\npx.histogram(data_frame = companywise_mean.sort_values('CashRatio',ascending = False).head(10),\n             x = 'TickerSymbol',\n             y= 'CashRatio',\n             histfunc='avg',\n             width = 800,\n             height = 500\n             )\n#fig.update_xaxes(tickangle=90, tickfont=dict(family='Rockwell', color='crimson', size=14))","524576a9":"# 4.1.3 Considering Quick Ratio\npx.histogram(data_frame = companywise_mean.sort_values('QuickRatio',ascending = False).head(10),\n             x = 'TickerSymbol',\n             y= 'QuickRatio',\n             histfunc='avg',\n             width = 800,\n             height = 500\n             )","57a8f676":"# 4.1.4 Considering Current Ratio\npx.histogram(data_frame = companywise_mean.sort_values('CurrentRatio',ascending = False).head(10),\n             x = 'TickerSymbol',\n             y= 'CurrentRatio',\n             histfunc='avg',\n             width = 800,\n             height = 500\n             )","087d7e12":"# 4.1.5 Considering Profit Margin\npx.histogram(data_frame = companywise_mean.sort_values('ProfitMargin',ascending = False).head(10),\n             x = 'TickerSymbol',\n             y= 'ProfitMargin',\n             histfunc='avg',\n             width = 800,\n             height = 500\n             )","a40867df":"# 4.1.6 Considering Research and Development\npx.histogram(data_frame = companywise_mean.sort_values('ResearchandDevelopment',ascending = False).head(10),\n             x = 'TickerSymbol',\n             y= 'ResearchandDevelopment',\n             histfunc='avg',\n             width = 800,\n             height = 500\n             )","5c4b7964":"# 4.1.7 Considering Goodwill\npx.histogram(data_frame = companywise_mean.sort_values('Goodwill',ascending = False).head(10),\n             x = 'TickerSymbol',\n             y= 'Goodwill',\n             histfunc='avg',\n             width = 800,\n             height = 500\n             )","52c1242d":"# 4.1.8 Considering NetIncome\npx.histogram(data_frame = companywise_mean.sort_values('NetIncome',ascending = False).head(10),\n             x = 'TickerSymbol',\n             y= 'NetIncome',\n             histfunc='avg',\n             width = 800,\n             height = 500\n             )","3d102e35":"# 4.1.9 Distribution of Earning per share and Profit margin\nfig = px.density_contour(\n                         data_frame =companywise_mean,\n                         x = 'EarningsPerShare',\n                         y = 'ProfitMargin',\n                         range_x=[0,10]\n                        )\nfig.update_traces(\n                  contours_coloring=\"fill\",\n                  contours_showlabels = True\n                 )","d412190c":"#4.2.1 Join fundamental dataset with securities \nfundamentals_security = pd.merge(fundamentals,securities, left_on = \"TickerSymbol\", right_on=\"Ticker symbol\",how=\"left\")","8557e201":"# 4.2.2 Histogram to show profit margin of various sectors across the years\npx.histogram(data_frame =fundamentals_security,\n                      x = 'GICS Sector',\n                      y = 'ProfitMargin',\n                      marginal = 'violin',\n                      color = 'ForYear',\n                      histfunc = 'avg'\n                #opacity = 0.2\n             )","8ba5bfa7":"# 4.2.3 Histogram to show profit margin of various sectors across the years\npx.histogram(data_frame =fundamentals_security,\n                      x = 'GICS Sector',\n                      y = 'AfterTaxROE',\n                      marginal = 'box',\n                      color = 'ForYear', \n                      histfunc = 'avg'\n                #opacity = 0.2\n             )","d2ea1610":"# 4.2.4 Histogram to show Earning Per Share of various sectors across the years\npx.histogram(data_frame =fundamentals_security,\n                      x = 'GICS Sector',\n                      y = 'EarningsPerShare',\n                      marginal = 'box',\n                      color = 'ForYear', \n                      histfunc = 'avg'\n                #opacity = 0.2\n             )","81035ec5":"# 4.2.5 Histogram to show Earning Per Share of various sectors across the years\npx.histogram(data_frame =fundamentals_security,\n                      x = 'GICS Sector',\n                      y = 'NetIncome',\n                      marginal = 'box',\n                      color = 'ForYear', \n                      histfunc = 'avg'\n                #opacity = 0.2\n             )","7d0d485c":"# 4.2.6 Histogram to show average Net Income of various sectors over the years\nfig = px.histogram(data_frame = fundamentals_security,\n             x = 'GICS Sector',\n             y= 'NetIncome',\n             histfunc='avg',\n             width = 800,\n             height = 1000\n             )\nfig.update_xaxes(tickangle=90, tickfont=dict(family='Rockwell', color='crimson', size=14))","0576f574":"# 5.1 Dataset containing mean of all parameters \ncompanywise_mean=fundamentals.groupby('TickerSymbol').mean().reset_index()","5cb06df5":"# 5.2 A seperate column Net Income category has been added. \ncompanywise_mean['NetIncome_Category'] = companywise_mean['NetIncome'].map(lambda x : 0 if x<=0  else 1 if x\/10000000<500 else 2)","740caa35":"# 5.3 create a copy of original dataset df which contains only float and int columns to draw Andrew Curve \ndf = companywise_mean.select_dtypes(include = ['float64','int64']).copy()\ndf.drop(columns = ['ForYear'], inplace = True)","893b6431":"# 5.4 Draw Andrew Curve to find if there is any pattern\npd.plotting.andrews_curves(df,'NetIncome_Category')","e3b64c34":"# 6.1 creating a seperate array to store values of NetIncome Category and droping from  dataframe df\ny = df['NetIncome_Category'].values\ndf.drop(columns = ['NetIncome_Category'], inplace = True)","f0350a4f":"# 6.2 Use StandardScaler class for scaling of dataframe df\nss = StandardScaler()\nss.fit(df)\nXX = ss.transform(df)","60ce5e8a":"# 6.3 Split dataset into training and test,use train for clustering and test to check test to cluster based on parameter Net Income category\nXX_train,XX_test,_,y_test = train_test_split(XX,y,test_size=0.25)","c7d2c323":"# 6.4 Draw Elbow curve to show relation between no. of clusters and SSE(Sum of squared Error)\nsse =[]\nfor i in list(range(10)):\n    n_cluster = i+1\n    clf = KMeans(n_clusters = n_cluster)\n    clf.fit(XX_train)\n    sse.append(clf.inertia_ )  #append SSE value for this no. of clusters\n    \n    \nsns.lineplot(range(1, 11), sse)    ","9852d54d":"# 6.5 create clusters and find cluster informations\ncls = KMeans(n_clusters = 3)      # instantiate KMean object\ncls.fit(XX_train)                  # Get info about X_train\ncls.cluster_centers_.shape        # shape of cluster centres\ncls.labels_                       # Cluster labels for every observation\ncls.labels_.size                \ncls.inertia_                      # display value of SSE","ba0e44ea":"# 6.6 Predict clustering for test data\ny_pred = cls.predict(XX_test)\ny_pred","158bc9fa":"#6.7 check accuracy of prediction \nnp.sum(y_pred==y_test)\/y_test.size","14089e30":"#6.8 Calculate Silhouette score for the clusters\nsilhouette_score(XX_train, cls.labels_)","7b36c395":"#6.8 Use Yellow brick for plotting Silhouette score for each  cluster\nvisualizer = SilhouetteVisualizer(cls, colors='yellowbrick')\nvisualizer.fit(XX_train)\nvisualizer.show()","2e2b868f":"#6.9 using scatter plot to check cluster differentiality\ndx = pd.Series(XX_test[:, 1])\ndy = pd.Series(XX_test[:,2])\nsns.scatterplot(dx,dy, hue = y_pred)","5cc776ea":"## Sector Wise\n\n\nIT,Real State and Energy have good Profit Margin over the years while in terms of ROE for 2012 and 2013 IT and Consumer staple give generate higher Income for shareholders while for 2016 Financials generates maximum ROE. \n\nSimilarly Earning Per Share and Net Income has been shown.","8b3c9eb4":"# 1. About #\n\n The S&P 500 is a stock market index that tracks the stocks of 500 large-cap U.S. companies. It represents the stock market's     performance by reporting the risks and returns of the biggest companies. Investors use it as the benchmark of the overall       market, to which all other investments are compared.\n  S&P stands for Standard and Poor, the names of the two founding financial companies.\n  The S&P 500 was officially introduced on March 4, 1957, by Standard & Poor. McGraw-Hill acquired it in 1966. The S&P Dow       Jones Indices owns it now and that's a joint venture between S&P Global (formerly) McGraw Hill Financial, CME Group, and News   Corp, the owner of Dow Jones.\n\n  Here, we have performance indicators of S&P companies for the Year 2014 to 2018.","ba40ff26":"# 4. Performance Analysis #\n\n[Company Wise](#Company-Wise)<br>\n[Sector Wise](#Sector-Wise)<br>\n\n\n     Let's first take average of all the parameters for the companies over the years given.\n \n  ## Company Wise\n  \n    Bar Graph has been ploted for Top - 10 companies for various parameters like Cash Ratio,Quick Ratio, Current Ratio,  Profit margin,Research and development, Goodwill and Net income.\n    \n    It is observed that companies like FB,LLTC,MHCP,WAT,NVDA appear in all three graphs of Cash Ratio,Quick Ratio, Current Ratio.It suggests that these companies are having good resources to accomodate any short term or current  liabilities.\n    \n    Companies Like IBM,PFE who spend good amount on Research and Development and having Goodwill of investors generate higher income. \n    \n    The density counter graph shows distribution of companies between Profit Margin and Earning per Share.","c9bce3e2":"# 5.  Data Pattern\n\nTo Check if Company data contains any pattern andrew curve is drawn on Net Income. The Net Income has been divided in 3 various categories ,0 for companies having negative average income, 1 for companies having income upto 500 crores and 2 for companies having income above 500 crores.\n\nThe Andrew curve shows there is distinction between category 1 and 2 while for category as no. of companies re low it can't be distinguished clearly.","85b7f214":"# 3. Some definitions related to DataSet #\n\n  1. **Cash Ratio** - The metric calculates a company's ability to repay its short-term debt with cash or near-cash resources, such as easily marketable securities. This information is useful to creditors when they decide how much money, if any, they would be willing to loan a company.\n  \n  \n  2. **Current Ration** - The current ratio is a liquidity ratio that measures a company's ability to pay short-term obligations or those due within one year. It tells investors and analysts how a company can maximize the current assets on its balance sheet to satisfy its current debt and other payables.The current ratio compares all of a company\u2019s current assets to its current liabilities.\n  \n  \n  3. **Quick Ratio** - The quick ratio is an indicator of a company\u2019s short-term liquidity position and measures a company\u2019s ability to meet its short-term obligations with its most liquid assets. Since it indicates the company\u2019s ability to instantly use its near-cash assets (assets that can be converted quickly to cash) to pay down its current liabilities.\n  \n  The quick ratio indicates a company's capacity to pay its current liabilities without needing to sell its inventory or get additional financing.The higher the ratio result, the better a company's liquidity and financial health; the lower the ratio, the more likely the company will struggle with paying debts.\n\n4. **Profit Margin** - Profit margin is one of the commonly used profitability ratios to gauge the degree to which a company or a business activity makes money. It represents what percentage of sales has turned into profits. For instance, if a business reports that it achieved a 35% profit margin during the last quarter, it means that it had a net income of $0.35 for each dollar of sales generated.\n\n\n\n5. **Return on equity** - Return on equity (ROE) is a ratio that provides investors with insight into how efficiently a company (or more specifically, its management team) is handling the money that shareholders have contributed to it. In other words, it measures the profitability of a corporation in relation to stockholders\u2019 equity.So if ROE is 0.35 i.e for 1 dollar of        shareholders equity the company management is generating income of 0.35 dollar.\n","e8e95e33":"### 6.  Clustering of Dataset\n\nTo Check whether data can be clustered Standard Scalar class from sklearn library has been used for scaling and the calculating Silhouette score for each cluster.\n","89f8652d":"# 2. Loading Of DataSet \n\nHere following datasets has been used.\n\n1. fundamentals.csv - The file contains data for financial parameters of 500 large-cap U.S. companies like Account Payable,Cash Ratio, Profit margin,Net Income, Earning per share etc.\n\n\n2. Securities.csv - This csv contains data for sector,subsector,address etc. for the companies.500 large-cap U.S. "}}