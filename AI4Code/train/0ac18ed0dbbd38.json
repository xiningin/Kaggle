{"cell_type":{"400f750f":"code","15bcbcbf":"code","91714fdf":"code","1e8813d1":"code","ad72cb94":"code","557ba97b":"code","9c6b9743":"code","7960cd45":"code","9b37c307":"code","b4c0c0e7":"code","d666f101":"code","66ef5786":"code","a6032414":"code","04f128f4":"code","f75b65cb":"code","b047ba20":"code","a235e6e4":"code","e3255d93":"code","00a47b6a":"code","5998e39f":"code","3b38dd09":"code","9f87f01d":"code","8ae3654c":"code","6a495cc6":"code","6390639e":"code","0b3442e2":"code","76260bb4":"code","84728f4f":"code","fd41497b":"code","d1bea90e":"markdown","eab170a7":"markdown","f30147c4":"markdown","dbb4a396":"markdown","6880f1dd":"markdown","de1d7181":"markdown","666909a4":"markdown","358c29b6":"markdown","5ccd6a21":"markdown","68f3f939":"markdown","1a0ea321":"markdown","d7f89f39":"markdown","f49fe2dd":"markdown","66ba05f6":"markdown","d44cf850":"markdown","69b750ca":"markdown","99ea8644":"markdown","bb2cd5dc":"markdown","f8d9f48b":"markdown","b4db327f":"markdown","97c2a757":"markdown","87c06672":"markdown","d38ce46e":"markdown","e60fb18d":"markdown","552fd9e6":"markdown"},"source":{"400f750f":"#!pip install plotly -U ","15bcbcbf":"#EDA section\nimport pandas as pd\nimport numpy as np\nimport urllib\nimport zipfile\nimport os \nimport shutil\nfrom datetime import datetime, timedelta\npd.set_option('display.max_columns', None)\nfrom sklearn.cluster import KMeans\nfrom sklearn import preprocessing\nfrom datetime import timedelta\nimport datetime as dt\nimport itertools\n\n#Graphic libraries\nimport plotly.graph_objects as go\nimport plotly.express as px\nfrom plotly.subplots import make_subplots\n\n#ML libraries\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.preprocessing import PolynomialFeatures\nfrom sklearn.metrics import mean_squared_error,r2_score\n\nimport warnings\nwarnings.filterwarnings('ignore')","91714fdf":"#Download the actual version of data\nurl = 'http:\/\/datosabiertos.salud.gob.mx\/gobmx\/salud\/datos_abiertos\/datos_abiertos_covid19.zip'\n#Create a new folder to download the data\nfolder_path = 'DataCovidMx'\n#to avoid duplicates when updating, it is necessary to remove the csv\nif os.path.exists(folder_path):\n    shutil.rmtree(folder_path)\n    os.makedirs(folder_path)   \nelse:\n    os.makedirs(folder_path)\n#Download the file from URL\nurllib.request.urlretrieve(url,\"DataCovidMx\/DataCovidCSV.zip\")\n#getting the file name\nfile_name = zipfile.ZipFile(\"DataCovidMx\/DataCovidCSV.zip\").namelist()\n#extracting file\nwith zipfile.ZipFile(\"DataCovidMx\/DataCovidCSV.zip\", 'r') as zip_ref:\n    zip_ref.extractall(\"DataCovidMx\/\")\n","1e8813d1":"#Load Datasets\ndf = pd.read_csv('DataCovidMx\/'+ file_name[0], encoding= 'unicode_escape',low_memory=False)\nclean_mx = pd.read_csv('..\/input\/covid19-mexico-clean-order-by-states\/Covid_19_Mexico_Clean_Complete.csv')\ndf.head()","ad72cb94":"state_table = pd.read_excel('..\/input\/dictionary\/Catalogo.xlsx', sheet_name='Cat\u00e1logo de ENTIDADES')\nstate_table.drop(labels= 'ABREVIATURA', axis = 1, inplace = True)\nstate_table.rename(columns= {'CLAVE_ENTIDAD':'ID', 'ENTIDAD_FEDERATIVA':'State'},inplace= True)\nstate_table.head()","557ba97b":"#Import Data Dictionary - Municipality ID by State ID\nId_state = pd.read_excel(\"..\/input\/dictionary\/Catalogo.xlsx\", sheet_name='Cat\u00e1logo MUNICIPIOS')\n\n#Creating a new column that contains the Municipality ID by state ID\nId_state['Full_ID']= Id_state['CLAVE_ENTIDAD'].astype(str) + '-' + Id_state['CLAVE_MUNICIPIO'].astype(str)\n\n#Dictionary creation to replace the ID of the \"ENTIDAD_RES\" and \"MUNICIPIO_RES\" by name\ndict_municipality = pd.Series(Id_state.MUNICIPIO.values, index = Id_state.Full_ID).to_dict()\ndict_state = pd.Series(state_table.State.values, index= state_table.ID).to_dict()\n\n#For replace the ID by name it's neccesary create a new column in the original DataSet that contain the State ID and Municipality ID. \n#Defie the new column\ndf['MUNICIPIO_RES'] = df['ENTIDAD_RES'].astype(str) + '-' + df['MUNICIPIO_RES'].astype(str)\n\n#replace the code with the name\ndf['ENTIDAD_RES'].replace(dict_state,inplace = True)\ndf['MUNICIPIO_RES'].replace(dict_municipality,inplace = True)\n\n#replace 1 & 2 as female & male\ndf['SEXO'].replace(1,'Female',inplace = True)\ndf['SEXO'].replace(2,'Male',inplace = True)\n\n#Replace column names\nactualNames = df.columns.to_list()\nnewNames = ['Update Date', 'ID', 'USMER','Health_institute', 'Location_institute','Sex','Birth_location','Residence_Entity', 'Residence_Municipality','Patien_type', 'Diagnosis_Date','Symptoms_Date','Death_Date','Tracheal_intubation','Pneumonia','Age','Nationality','Pregnancy','Indigenous_language','Diabetes','EPOC','Asthma','Immunosuppression','Hypertension','Other_comorbidity','Cardiovascular_disease','Obesity', 'Chronic_kidney_disease','smoking','Another_case','Result','Migrant','Nationality Country','Home_country','UCI']\nreplace_dict = dict(zip(actualNames,newNames))\ndf.rename(columns=replace_dict,inplace=True)\n\n# Created a new column \"Days until decease\"\nDays_decease = []\ndf['Symptoms_Date'] = pd.to_datetime(df['Symptoms_Date'])\n\nfor income, death in zip(df['Symptoms_Date'], df['Death_Date']):\n  if death != '9999-99-99':\n    deceaseDay = pd.to_datetime(death)\n    days_until_decease = (deceaseDay-income).days\n  else:\n    days_until_decease = 0\n  \n  Days_decease.append(days_until_decease)\n\ndf['Days_decease'] = Days_decease\n\n#clasify the death cases and non-death caes\ndf.loc[df.Death_Date != '9999-99-99', 'Death_Date'] = 1  #Pople death\ndf.loc[df.Death_Date == '9999-99-99', 'Death_Date'] = 0  #People alive\ndf['Death_Date'] = df['Death_Date'].astype(int)\ndf.rename(columns = {'Death_Date':'Dead'}, inplace = True)\n\n\ndf.head()","9c6b9743":"#order data by date\nmexico = clean_mx.groupby('Date', as_index=False).sum()\nmexico['Date'] = pd.to_datetime(mexico['Date'])\n\n#plot data by confirmed and deaths\nfig = px.bar(mexico, x='Date', y='Confirmed',\n             hover_data=['Deaths'], color='Deaths',\n             labels={}, height=400)\nfig.show()\n\nprint('\\n')\nprint(\"Recovered Cases: \" ,clean_mx['Recovered'].sum())\nprint(\"Death Cases: \",clean_mx['Deaths'].sum())\nprint(\"Confirmed Cases: \",clean_mx['Confirmed'].sum())\nprint(\"Active Cases: \",clean_mx['Active'].sum())","7960cd45":"#plot data\nfig = px.histogram(df, x = 'Result', color='Sex')\nfig.show()\n\n#Print results\nprint(\"\\n\")\nprint(\"Total of infected people(1):\", df.loc[df.Result == 1, 'Result'].count())\nprint(\"Total of negative people(2):\", df.loc[df.Result == 2, 'Result'].count())\nprint(\"Total of pending result(3):\", df.loc[df.Result == 3, 'Result'].count())","9b37c307":"#Positive cases\npc = df.loc[(df['Result'] == 1)]\n#Percentage\nfem_per = (pc.loc[(pc['Sex'] == 'Female','Sex')].count()  \/ pc['Sex'].count())*100\nmale_per = (pc.loc[(pc['Sex'] == 'Male','Sex')].count()  \/ pc['Sex'].count())*100\n#print results\nprint(\"Percentage Female cases:\", fem_per)\nprint(\"Percentage Male cases\", male_per)","b4c0c0e7":"label=['Death Cases','Surviving Cases']\nvalues = [pc.loc[pc.Dead == 1 , 'Dead'].count(), pc.loc[pc.Dead == 0, 'Dead'].count()]\n\nfig = go.Figure(data=[go.Pie(labels=label, values=values)])\nfig.show()","d666f101":"fig = px.histogram(pc, x = 'Patien_type', color = 'Patien_type',title='Patient type')\nfig.show()\n\nprint('\\n')\nprint('Total outpatient:',pc.loc[pc.Patien_type == 1, 'Patien_type'].count())\nprint('Total inpatient',pc.loc[pc.Patien_type == 2, 'Patien_type'].count())","66ef5786":"fig = px.box(pc, y= 'Age', color= 'Dead')\nfig.show()","a6032414":"#Creating a new dataset with only death cases by COVID\ndeath = df.loc[(df['Dead'] == 1) & (df['Result'] == 1)]\ndeath.reset_index(inplace=True)\ndeath = death.iloc[:,[15,16,20,21,22,23,24,26,27,28,29,36]]\nprint(death.shape)","04f128f4":"#replace values 2, 97, 98 and 99 by 0\ncol = death.columns.to_list()\ncol.remove('Age')\n\nfor col in col: #Replace all columns different from 'EDAD' (Age)\n  death[col].replace([2,97,98,99], 0, inplace = True)","f75b65cb":"X = death\nX = preprocessing.StandardScaler().fit(X).transform(X)\nX.shape","b047ba20":"kclusters = 7\nkmeans = KMeans(n_clusters = kclusters, init = 'k-means++', max_iter = 300, n_init = 10, random_state = 0)\nkmeans.fit(X)","a235e6e4":"death.insert(0, 'Cluster', kmeans.labels_)","e3255d93":"Clusters = pd.DataFrame(columns=[], index=[])\nClusters['Group 1'] = death.loc[death['Cluster'] == 0].describe().iloc[1]\n\nClusters['Group 2'] = death.loc[death['Cluster'] == 1].describe().iloc[1]\n\nClusters['Group 3'] = death.loc[death['Cluster'] == 2].describe().iloc[1]\n\nClusters['Group 4'] = death.loc[death['Cluster'] == 3].describe().iloc[1]\n\nClusters['Group 5'] = death.loc[death['Cluster'] == 4].describe().iloc[1]\n\nClusters['Group 6'] = death.loc[death['Cluster'] == 5].describe().iloc[1]\n\nClusters['Group 7'] = death.loc[death['Cluster'] == 6].describe().iloc[1]\n\nClusters.drop(index='Cluster',inplace=True)\n#Clusters.loc[['Age','Days_decease','Days_decease STD']] = Clusters.loc[['Age','Days_decease','Days_decease STD']].apply(round)\nClusters.loc[['Pneumonia','Diabetes','EPOC','Asthma','Immunosuppression','Hypertension','Cardiovascular_disease', 'Obesity','Chronic_kidney_disease','smoking']] = Clusters.loc[['Pneumonia','Diabetes','EPOC','Asthma','Immunosuppression','Hypertension','Cardiovascular_disease', 'Obesity','Chronic_kidney_disease','smoking']] * 100\nClusters","00a47b6a":"fig = make_subplots(\n    rows=3, cols=3,\n    subplot_titles=(\"Group 1\", \"Group 2\", \"Group 3\", \"Group 4\", \"Group 5\", \"Group 6\", \"Group 7\"))\n\nfig.add_trace(go.Bar(y=Clusters['Group 1']),1,1)\nfig.add_trace(go.Bar(y=Clusters['Group 2']),1,2)\nfig.add_trace(go.Bar(y=Clusters['Group 3']),1,3)\nfig.add_trace(go.Bar(y=Clusters['Group 4']),2,1)\nfig.add_trace(go.Bar(y=Clusters['Group 5']),2,2)\nfig.add_trace(go.Bar(y=Clusters['Group 6']),2,3)\nfig.add_trace(go.Bar(y=Clusters['Group 7']),3,1)\n\nfig.show()","5998e39f":"state = clean_mx.groupby('State', as_index = False).sum()\n\nfig = px.bar(state, y='Confirmed', x='State', text='Confirmed')\nfig.update_traces(texttemplate='%{text:.2s}', textposition='outside')\nfig.show()\n\nprint(state.sort_values(by='Confirmed', ascending=False, ignore_index=True).head())","3b38dd09":"#Transforming the data into a cumulative data to forecasting \nmexico['Deaths'] = mexico['Deaths'].cumsum()\nmexico['Confirmed'] = mexico['Confirmed'].cumsum()\nmexico['Recovered'] = mexico['Recovered'].cumsum()\n\n#Generate a \"day\" column since the first case\nmexico['Day'] = mexico['Date'].dt.dayofyear\n\n#Plot cumulative data\nfig = go.Figure()\n\nfig.add_trace(go.Scatter(x=mexico['Date'], y=mexico['Deaths'],\n                    mode='lines+markers',\n                    name='Deaths'))\n\nfig.add_trace(go.Scatter(x=mexico['Date'], y=mexico['Confirmed'],\n                    mode='lines+markers',\n                    name='Confirmed'))\n\nfig.add_trace(go.Scatter(x=mexico['Date'], y=mexico['Recovered'],\n                    mode='lines+markers',\n                    name='Recovered'))\n\nfig.show()","9f87f01d":"#defining dependent and independent variables\nX = mexico[['Day']]\ny = mexico[['Confirmed']]\n\n#split data into test and train\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.20, random_state = 1)\n\n#training linear model\nlm = LinearRegression()\nlm.fit(X_train,y_train)\n\n#evaluating the model\ny_pred = lm.predict(X)\n\n#r2 score\nprint(lm.score(X_test,y_test))","8ae3654c":"#predicted data\nMexico_lm = mexico.iloc[:,[0,2]]\nMexico_lm['lm_pred'] = y_pred\n\n#plot data comparison\nfig = go.Figure()\n\nfig.add_trace(go.Scatter(x=Mexico_lm['Date'], y=Mexico_lm['Confirmed'],\n                    mode='lines+markers',\n                    name='Confirmed'))\n\nfig.add_trace(go.Scatter(x=Mexico_lm['Date'], y=Mexico_lm['lm_pred'],\n                    mode='lines',\n                    name='predicted'))\n\nfig.show()","6a495cc6":"#defining dependent and independent variables\nX = mexico[['Day']]\ny = mexico[['Confirmed']]\n\n#Transforming data\ndegree = 8\nPoly_reg = PolynomialFeatures(degree)\nXpoly = Poly_reg.fit_transform(X)\n\n#split data into test and train\nX_train, X_test, y_train, y_test = train_test_split(Xpoly, y, test_size=0.20, random_state = 2)\n\n#Training model\npm=LinearRegression()\npm.fit(X_train,y_train)\n\n#evaluating the model\ny_pred_poly = pm.predict(Xpoly)\n\n#r2 score\nprint(r2_score(y,y_pred_poly))\n\n#MSE\nprint(mean_squared_error(y,y_pred_poly,squared=False))","6390639e":"Mexico_pm = mexico.iloc[:,[0,2]]\nMexico_pm['pm_pred'] = y_pred_poly\n\n#plot data comparison\nfig = go.Figure()\n\nfig.add_trace(go.Scatter(x=Mexico_pm['Date'], y=Mexico_pm['Confirmed'],\n                    mode='lines+markers',\n                    name='Confirmed'))\n\nfig.add_trace(go.Scatter(x=Mexico_pm['Date'], y=Mexico_pm['pm_pred'],\n                    mode='lines',\n                    name='predicted'))\n\nfig.show()","0b3442e2":"#creating the next 15 days df\npred = pd.DataFrame(columns=[], index=[])\npred[\"Dates\"] = pd.date_range(start=\"09-10-2020\", end=\"9-30-2020\")","76260bb4":"#Prediction for Linear model\nX = pred[\"Dates\"].dt.dayofyear\nX = X.values.reshape(-1,1)\nprediction_linear = lm.predict(X)\npred['Prediction_linear'] = prediction_linear.round()","84728f4f":"#Prediction for polynomial model\nX = pred[\"Dates\"].dt.dayofyear\nX = X.values.reshape(-1,1)\nX = Poly_reg.fit_transform(X)\nprediction_poly = pm.predict(X)\npred['Prediction_poly'] = prediction_poly.round()","fd41497b":"#Plot model comparison\n\nfig = go.Figure()\n\nfig.add_trace(go.Scatter(x=pred['Dates'], y=pred['Prediction_linear'],\n                    mode='lines+markers',\n                    name='Linear model prediction'))\n\nfig.add_trace(go.Scatter(x=pred['Dates'], y=pred['Prediction_poly'],\n                    mode='lines+markers',\n                    name='Polynomial model prediction'))\n\nfig.add_trace(go.Scatter(x=Mexico_pm['Date'], y=Mexico_pm['Confirmed'],\n                    mode='lines+markers',\n                    name='Confirmed'))\n\n\nfig.show()\n\nprint(pred)","d1bea90e":"In Mexico SARSCov-2 has a mortality rate of 11%, this means 62,594 death cases.","eab170a7":"### How many inpatient and outpatient cases there are?\n\nIn Mexico like a hospital control measure the health systems decided to classify the positive cases as follow:\n\n+ inpatient cases: Severe cases requiring special medical treatment.\n\n+ Outpatient: Cases whose symptoms are not serious and can be quarantined at home.\n\n","f30147c4":"## EDA (Exploratory Data Analysis)","dbb4a396":"### Replace the place ID by Place Name\n\nThe columns \"ENTIDAD_RES\" and \"MUNICIPIO_RES\" refer to the state and municipality of residence respectively. These are coded by numbers so that they can be replaced by their respective names. \n\nFor make this I will use mexican states by ID table and the Data Dictionary.xlsx","6880f1dd":"### How many people have died?","de1d7181":"## Forecasting ML\n","666909a4":"There is not much difference in infection between men and women.\n\nThis is important because we now know that sex does not influence the probability of infection.","358c29b6":"## What is the scenario for the next 20 days?","5ccd6a21":"## Download Dataset","68f3f939":"People who were infected and didn't die have an average age of 42. While people who died from SARS-CoV-2 have an average age of 63.\n","1a0ea321":"Answering the question in this section:\n\n**\"What do the people who died from SARS-Cov-2 have in common?\"**\n\n**Primarily**, pneumonia stands out. Recent studies have indicated that SARS-CoV-2 infection may be a trigger for severe pneumonia.\n\nIn **second** place stands out diabetes and hypertension, it is known that these two diseases can produce chronic renal failure, which leads us to the **third** point. Only one group had chronic renal insufficiency, this group stands out for having the lowest average life span between date of symptoms and date of death (10 days, with an STD of 8 days).\n\nThe **fourth** relational characteristic is obesity which is present in at least 20% of all groups.\n\n**Finally**, age is an important factor since patients who perished range from 59 to 63 years with a 14 year old STD.\n\n**At least in Mexico**, the patients most likely to die have the following characteristics:\n\n- Age between 50 and 70 years old.\n- Diabetes\n- Hypertension \n- Obesity \n- Chronic kidney problem.\n","d7f89f39":"There are several cases with the labels 97, 98 and 99. \n\n|Label |Meaning|\n|------|-------|\n|1     | Yes   |\n|0     | No    |\n|97    |Don\u00b4t apply|\n|98    |Not known|\n|99    |unspecified|\n\n\nBasically these three labels have the same meaning, so we can choose between two options:\n\n1. Drop all the data that cotanin these labels\n\n2. Replace the data that contain these labels by only 0\n\nI choose the second option because it is very sensitive data and I want to avoid losing as much data as possible.\n","f49fe2dd":"## Import libraries","66ba05f6":"### Geographical analysis","d44cf850":"**Data dictionary for better understanding:**\n\n----\n\n| N\u00ba | Column Name  | Column descriptor|\n|----|---------------------|------------------------|\n| 1  | FECHA_ACTUALIZACION | Update date.|\n| 2  | ID_REGISTRO         | Case Number ID.|\n| 3  | ORIGEN              | It specifies if patient is being monitored by USMER (Healthcare Monitoring Unit for Respiratory Diseases) or not. |\n| 4  | SECTOR              | It identifies the type of National Health System institution that provided the care.|\n| 5  | ENTIDAD_UM          | Identifies the entity where the medical unit that provided the care is located.|\n| 6  | SEXO                | Sex.|\n| 7  | ENTIDAD_NAC         | Patient's birth place.|\n| 8  | ENTIDAD_RES         | Entity of residence of the patient.|\n| 9  | MUNICIPIO_RES       | Patient's neighborhood of residence.|\n| 10 | TIPO_PACIENTE       | It identifies the type of care the patient received in the unit. It is called outpatient if returned home or inpatient if admitted to hospital.|\n| 11 | FECHA_INGRESO       | Patient's date of admission to the care unit.|\n| 12 | FECHA_SINTOMAS      | Symptom date.|\n| 13 | FECHA_DEF           | Date of death.|\n| 14 | INTUBADO            | Tracheal intubation.|\n| 15 | NEUMONIA            | Pneumonia.|\n| 16 | EDAD                | Age.|\n| 17 | NACIONALIDAD        | Mexican or foreign.|\n| 18 | EMBARAZO            | Pregnancy.|\n| 19 | HABLA_LENGUA_INDIG  | Indigenous Langauge.|\n| 20 | DIABETES            | Diabetes.|\n| 21 | EPOC                | EPOC.|\n| 22 | ASMA                | Asthma.|\n| 23 | INMUSUPR            | Immunosuppression.|\n| 24 | HIPERTENSION        | Hypertension.|\n| 25 | OTRAS_COM           | Other diseases.|\n| 26 | CARDIOVASCULAR      | Cardiovascular disease.|\n| 27 | OBESIDAD            | Obesity.|\n| 28 | RENAL_CRONICA       | Chronic kidney disease.|\n| 29 | TABAQUISMO          | Smoking.|\n| 30 | OTRO_CASO           | Identifies if the patient had contact with any other cases diagnosed with SARS CoV-2|\n| 31 | RESULTADO           | COVID test result|\n| 32 | MIGRANTE            | Migrant.|\n| 33 | PAIS_NACIONALIDAD   | Nationality.|\n| 34 | PAIS_ORIGEN         | Home state.|\n| 35 | UCI                 | Identifies if the patient required admission to an Intensive Care Unit.|","69b750ca":"### Polynomial model","99ea8644":"### Overall analysis","bb2cd5dc":"### How many cases there are?\n","f8d9f48b":"# Covid-19 Mexico: Analysis & Forecasting \n\n#### Disclaimer\n\nI used two datasets from complete this work. \n\nFisrt dataset is cleaning and formating by me: \n[covid19-mexico-clean-order-by-states](https:\/\/www.kaggle.com\/andresjramos\/covid19-mexico-clean-order-by-states)\n\nSecond is from \u201cDirecci\u00f3n General de Epidemiolog\u00eda\": [Covid Mexico Raw Data](https:\/\/www.gob.mx\/salud\/documentos\/datos-abiertos-152127)\n\nI'm not the author of the second one. My principal objective is apply my knowledge like Data Scientist on these data to generate useful results.\n\n#### My first notebook\n\nThis is the first notebook that I make like a Data Scientist and I would appreciate it very much if you could give me a little feedback.\n\n\n","b4db327f":"To answer this question, I will take advantage of K-Means segmentation","97c2a757":"### Who is most affected by the virus (female or male)?","87c06672":"### Is age related to death?\n\n\n","d38ce46e":"## Data Cleaning and Formating","e60fb18d":"### Linear Model","552fd9e6":"Even though age seems to be an important factor, it is not a determining factor in whether a person will die or not. \n\nThen, there is a new question to be solved: \n\n### What do the people who died from SARS-Cov-2 have in common?"}}