{"cell_type":{"f7685118":"code","187d2dde":"code","04e1af83":"code","47e46c2e":"code","64485591":"code","fb2ba5e3":"code","6c496aa0":"code","f959628d":"code","15a1f6ca":"code","58bd8252":"code","a1a3614c":"code","c330c82b":"code","fb5c5c51":"markdown","e2b58065":"markdown","2001cbf6":"markdown","accbee30":"markdown"},"source":{"f7685118":"import pandas as pd\nimport numpy as np\n\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.model_selection import StratifiedKFold\nfrom sklearn.metrics import log_loss\nfrom sklearn.model_selection import cross_val_score\n\nimport optuna.integration.lightgbm as lgb\nfrom lightgbm import LGBMClassifier\n\nimport optuna\nfrom optuna.visualization import plot_optimization_history, plot_param_importances\nfrom optuna.integration import LightGBMPruningCallback\n\nfrom tqdm import tqdm","187d2dde":"train=pd.read_csv('..\/input\/tabular-playground-series-jun-2021\/train.csv')\ntest=pd.read_csv('..\/input\/tabular-playground-series-jun-2021\/test.csv')\nsub=pd.read_csv('..\/input\/tabular-playground-series-jun-2021\/sample_submission.csv')","04e1af83":"conditions = [\n    (train.target == \"Class_1\"), (train.target == \"Class_2\"), (train.target == \"Class_3\"),\n    (train.target == \"Class_4\"), (train.target == \"Class_5\"), (train.target == \"Class_6\"),\n    (train.target == \"Class_7\"), (train.target == \"Class_8\"), (train.target == \"Class_9\")\n]\nchoices = [0, 1, 2, 3, 4, 5, 6, 7, 8]\ntrain[\"target\"] = np.select(conditions, choices)","47e46c2e":"X_test = test.drop(['id'], axis=1)\nX = train.drop(['id', 'target'], axis=1)\ny = train.target","64485591":"dtrain = lgb.Dataset(X, label=y)","fb2ba5e3":"params = {\n    \"objective\": \"multiclass\",\n    \"num_class\": 9,\n    \"metric\": \"multi_logloss\",\n    \"verbosity\": -1,\n    \"boosting_type\": \"gbdt\",\n    'learning_rate': 0.03,\n    'random_state': 314\n    }","6c496aa0":"tuner = lgb.LightGBMTunerCV(\n    params, dtrain, verbose_eval=100, early_stopping_rounds=100, \n    folds=StratifiedKFold(n_splits=4, shuffle=True)\n)\n\ntuner.run()","f959628d":"tuner.best_score","15a1f6ca":"tuner.best_params","58bd8252":"final_lgb = LGBMClassifier(**dict({'n_estimators': 500}, **tuner.best_params))","a1a3614c":"final_lgb.fit(X, y)\ny_pred = final_lgb.predict_proba(test.drop('id', axis=1))","c330c82b":"sub.iloc[:, 1:] = y_pred\n\nsub.to_csv('lgbm_tuner.csv', index=False)","fb5c5c51":"# Sub","e2b58065":"# Final model","2001cbf6":"# LightGBMTunerCV","accbee30":"# Load dependencies"}}