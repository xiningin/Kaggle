{"cell_type":{"1da776f7":"code","be5249fd":"code","9993166f":"markdown","0eeeb3aa":"markdown"},"source":{"1da776f7":"import json\nfrom kaggle_environments.utils import structify\n\ndef win_loss_draw(score):\n    if score>0: \n        return 'win'\n    if score<0: \n        return 'loss'\n    return 'draw'\n\ndef score(agent, max_lines = 1000):\n    #Scores a connect-x agent with the dataset\n    print(\"scoring \",agent)\n    count = 0\n    good_move_count = 0\n    perfect_move_count = 0\n    observation = structify({'mark': None, 'board': None})\n    with open(\"\/kaggle\/input\/1k-connect4-validation-set\/refmoves1k_kaggle\") as f:\n        for line in f:\n            count += 1\n            data = json.loads(line)\n            observation.board = data[\"board\"]\n            # find out how many moves are played to set the correct mark.\n            ply = len([x for x in data[\"board\"] if x>0])\n            if ply&1:\n                observation.mark = 2\n            else:\n                observation.mark = 1\n            \n            #call the agent\n            agent_move = agent(observation,env.configuration)\n            \n            moves = data[\"move score\"]\n            perfect_score = max(moves)\n            perfect_moves = [ i for i in range(7) if moves[i]==perfect_score]\n\n            if(agent_move in perfect_moves):\n                perfect_move_count += 1\n\n            if win_loss_draw(moves[agent_move]) == win_loss_draw(perfect_score):\n                good_move_count += 1\n\n            if count == max_lines:\n                break\n\n        print(\"perfect move percentage: \",perfect_move_count\/count)\n        print(\"good moves percentage: \",good_move_count\/count)\n","be5249fd":"# Score the 2 built in agents\nfrom kaggle_environments import make\nenv = make(\"connectx\")\n# the built in agents are remarkably slow so only evaluating on 100 moves here\nscore(env.agents[\"random\"],100)  \nscore(env.agents[\"negamax\"],100)","9993166f":"## Intro\n\nThere were a bunch of questions on how to validate an agent or a neural net for connect 4. So I decided to release a dataset that I use to validate the nets that I use. The dataset was generated with a modified version of the C++ connect4 solver provided by http:\/\/connect4.gamesolver.org It contains 1000 samples of board positions from ply 8 to 20. \n\nWith each of the positions it has the perfect score for the position as well as the scores of all positions after the next move. This allows to estimate how good an agent or a net is by comparing its move with a perfect solution. \n\nFormat of the dataset: \n> {\"board\": [0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 2, 0, 0, 2, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 2, 1, 0, 2, 0, 0, 0, 1, 1, 1, 2, 1, 0, 1, 2], \"score\": -2, \"move score\": [-3, -4, -4, -2, -6, -5, -4]}\n\nEach row is a json dictionary with the following fields:\n* \"board\": kaggle format of a connect4 baord, \n* \"score\": Score for the position, \n* \"move score\": Array of 7 scores corresponding to a play in each of the 7 columns\n\nA note on the scores in the dataset:\n* Score = 0: Game will be a draw\n* Score > 0: Current player will win (the bigger the number the sooner the player will win). The score is the half the ammount of plies from the end the game will be won. So +5 is means the win will be in ply 42 - 2*5 = 32. \n* Score < 0: Current player will lose (the bigger the number the sooner the player will lose)\n* Score = -99: simply indicates that that was not a legal move.\n\nThere are 2 metrics that I use are:\n* Perfect Move: Here the agent picks a move with the same score as the perfect player.\n* Good Move: The agent picks a move in the same categoty (win, loss or draw) as the perfect player. If an agent play 100% good moves it will play as well as a perfect player, but the win might be later in the game.\n\n## Let's analyze the built in agents","0eeeb3aa":"Output should be:\n> scoring function random_agent at 0x7f72e753e378  \n> perfect move percentage:  0.22  \n> good moves percentage:  0.67  \n> scoring function negamax_agent at 0x7f72e753e400  \n> perfect move percentage:  0.4  \n> good moves percentage:  0.71  \n\n\nSome more references:  \nA neural net that I use in my best agent (1267 score on 2\/24\/20) score as follows:\n> perfect move percentage:  0.737  \n> good moves percentage:  0.939\n"}}