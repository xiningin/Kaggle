{"cell_type":{"373e22be":"code","b72844c5":"code","8f38a642":"code","91ccb320":"code","08cea4e7":"code","7802a08e":"markdown","5cb5e8a5":"markdown","cee4820f":"markdown","08d43674":"markdown","a938edae":"markdown"},"source":{"373e22be":"import pandas as pd \nimport dask.dataframe as dd\nimport os\nfrom IPython.core import display as ICD\nimport plotly.graph_objs as go\nfrom plotly.offline import init_notebook_mode, iplot\ninit_notebook_mode(connected=True)\nimport warnings\nwarnings.filterwarnings('ignore')\n\ndef valueCounter(dataframe,columnToCount):\n    valueCounts = dataframe[columnToCount].value_counts().compute()\n    df = pd.DataFrame(data=valueCounts)\n    return df\n\ndef quantityCounter(dataframe,columnToCount):\n    quantityCount = dataframe.groupby(columnToCount)['QUANTITY'].sum()\n    quantityCount = quantityCount.compute().sort_values(ascending=False)\n    df = pd.DataFrame(data=quantityCount)\n    return df\n\ndef calculateQuantityPerPerson(dataframe,columnToCount,indexValue,populationValue):\n    cityQuantity = dataframe.groupby(columnToCount)['QUANTITY'].sum()\n    cityQuantity = cityQuantity.compute().sort_values(ascending=False)[indexValue]\n    quantityPerPerson = cityQuantity\/populationValue\n    return quantityPerPerson\n\ndef plotHorizontalBarGraph(dataframe,column,title,yAxisTitle,width,height,begin,end):\n    trace1 = go.Bar(\n                    x = dataframe[column][begin:end],\n                    y = dataframe.index,\n                    orientation='h',\n                    name = \"Kaggle\",\n                    marker = dict(color = 'rgba(0, 0, 255, 0.8)',\n                                 line=dict(color='rgb(0,0,0)',width=1.5)),\n                    text = dataframe.index)\n    data = [trace1]\n    layout = go.Layout(barmode = \"group\",title=title, \n                       xaxis=dict(title=yAxisTitle),\n                       yaxis=dict(autorange=\"reversed\"),\n                       width = width,\n                       height = height,\n                       showlegend=False)\n    fig = go.Figure(data = data, layout = layout)\n    fig.update_yaxes(automargin=True)\n    iplot(fig)\n\nTRAIN_PATH = '..\/input\/arcos-co-statewide-itemized.tsv'\ninterestingColumns = ['BUYER_NAME','BUYER_ADDRESS1', 'BUYER_ADDRESS2', 'BUYER_CITY', 'BUYER_STATE',\n       'BUYER_ZIP', 'BUYER_COUNTY','DRUG_NAME', 'QUANTITY', 'UNIT', 'TRANSACTION_DATE', 'CALC_BASE_WT_IN_GM',\n       'DOSAGE_UNIT', 'Product_Name', 'Ingredient_Name','Revised_Company_Name', 'Reporter_family']\ndf_tmp = pd.read_csv(TRAIN_PATH,sep='\\t',usecols=interestingColumns,nrows=5)\ndf_tmp.head()","b72844c5":"traintypes = {'BUYER_NAME': 'str',\n              'BUYER_ADDRESS1': 'str', \n              'BUYER_ADDRESS2': 'str',\n              'BUYER_CITY': 'str',\n              'BUYER_STATE': 'str',\n              'BUYER_ZIP': 'int64',\n              'BUYER_COUNTY': 'str',\n              'DRUG_NAME': 'str',\n              'QUANTITY': 'int64',\n              'UNIT': 'str',\n              'TRANSACTION_DATE': 'int64',\n              'CALC_BASE_WT_IN_GM': 'float64',\n              'DOSAGE_UNIT': 'float64',\n              'Product_Name': 'str',\n              'Ingredient_Name': 'str',\n              'Revised_Company_Name': 'str',\n              'Reporter_family': 'str'}\ncols = list(traintypes.keys())\ndf = dd.read_csv(TRAIN_PATH,sep='\\t', usecols=interestingColumns,dtype=traintypes)\ndf.head(5)","8f38a642":"drugCounts = quantityCounter(df,'DRUG_NAME')\nplotHorizontalBarGraph(drugCounts,'QUANTITY','Most Popular Pain Pills','Quantity of Pain Pills',500,500,0,2)","91ccb320":"cityCounts = quantityCounter(df,'BUYER_CITY')\nplotHorizontalBarGraph(cityCounts,'QUANTITY','Pain Pills per City','Pain Pills per City',750,1500,0,50)","08cea4e7":"# Note population numbers are estimates from Wikipedia for the year 2018\nvalue_list = ['CO']\ndf = df[df.BUYER_STATE.isin(value_list)]\nprint('Quantity of Pain Pills per Person: ','\\n')\nprint('Denver: ',calculateQuantityPerPerson(df,'BUYER_CITY',1,716492))\nprint('Colorado Springs: ',calculateQuantityPerPerson(df,'BUYER_CITY',0,472688))\nprint('Pueblo: ',calculateQuantityPerPerson(df,'BUYER_CITY',2,111750))","7802a08e":"Step 4: Make conclusions \n* Oxycodone is more popular than hydrocodone in Colorado.\n* Colorado Springs, Denver, and Pueblo consume the most pain pills in Colorado.\n* Pueblo consumes more than 5x as many pain pills per capita as compared to Denver. ","5cb5e8a5":"Step 1: Import Python modules and define helper functions\n* [Dask](https:\/\/dask.org\/)\n* [Plotly](https:\/\/plot.ly\/python\/)","cee4820f":"Step 2: Load the data using Dask \n* 1 x 1.3GB TSV file\n* adapted from [jpmiller\/szelee's method](https:\/\/www.kaggle.com\/szelee\/how-to-import-a-csv-file-of-55-million-rows)","08d43674":"Step 3: Visualize the data","a938edae":"**Pain Pills in the USA**\n* Data from [The Washington Post](https:\/\/www.washingtonpost.com\/graphics\/2019\/investigations\/dea-pain-pill-database)\n"}}