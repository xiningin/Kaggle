{"cell_type":{"d21eead1":"code","0b3c2b63":"code","cdf89adf":"code","37ffe757":"code","2b983b4b":"code","dd3e4724":"code","1db62d40":"code","5e12eb24":"code","cb9d9d30":"code","ba8c99ac":"code","103e3886":"code","19fe0508":"code","3dd9e947":"code","c68c0a90":"code","def25dae":"code","bb4dd77c":"code","f2545e29":"code","a2aef5a9":"code","ac543f14":"code","6c6f0ae0":"code","27fa9dc4":"markdown","cb0af758":"markdown","4e7c2ca3":"markdown","80ae68b4":"markdown","1d9e0982":"markdown","8c8fda8e":"markdown","3feb5f7a":"markdown","1a1cbc6e":"markdown","6e73004f":"markdown","62e8e0a2":"markdown","3684a066":"markdown","fec2e66b":"markdown","bbb916fe":"markdown"},"source":{"d21eead1":"%%capture\n!pip install -Uqq fastcore --upgrade\n!pip install -Uqq fastai --upgrade","0b3c2b63":"!pip install -Uqq cloud-tpu-client==0.10 https:\/\/storage.googleapis.com\/tpu-pytorch\/wheels\/torch_xla-1.7-cp37-cp37m-linux_x86_64.whl","cdf89adf":"!pip install -Uqq git+https:\/\/github.com\/butchland\/fastai_xla_extensions.git","37ffe757":"%%capture\nimport fastai_xla_extensions.core","2b983b4b":"from fastai.vision.all import *\n","dd3e4724":"dataset_path = Path('..\/input\/cassava-leaf-disease-classification')\nos.listdir(dataset_path)","1db62d40":"train_df = pd.read_csv(dataset_path\/'train.csv')","5e12eb24":"train_df['path'] = train_df['image_id'].map(lambda x:dataset_path\/'train_images'\/x)\ntrain_df = train_df.drop(columns=['image_id'])\ntrain_df = train_df.sample(frac=1).reset_index(drop=True) #shuffle dataframe\ntrain_df.head(10)","cb9d9d30":"item_tfms = RandomResizedCrop(448, min_scale=0.75, ratio=(1.,1.))\nbatch_tfms = [*aug_transforms(size=224, max_warp=0), Normalize.from_stats(*imagenet_stats)]\nbs=32","ba8c99ac":"dls = ImageDataLoaders.from_df(train_df, #pass in train DataFrame\n                               valid_pct=0.2, #80-20 train-validation random split\n                               seed=999, #seed\n                               label_col=0, #label is in the first column of the DataFrame\n                               fn_col=1, #filename\/path is in the second column of the DataFrame\n                               bs=bs, #pass in batch size\n                               item_tfms=item_tfms, #pass in item_tfms\n                               batch_tfms=batch_tfms) #pass in batch_tfms","103e3886":"dls.show_batch()","19fe0508":"learn = cnn_learner(dls, resnet18, metrics=[error_rate, accuracy])","3dd9e947":"learn.to_xla()","c68c0a90":"learn.fine_tune(4)","def25dae":"one_param(learn.model).device","bb4dd77c":"learn.recorder.plot_loss()","f2545e29":"interp = ClassificationInterpretation.from_learner(learn)","a2aef5a9":"\ninterp.plot_confusion_matrix()","ac543f14":"interp.most_confused(4)","6c6f0ae0":"\ninterp.plot_top_losses(9)","27fa9dc4":"Install the TPU client ","cb0af758":"Resize each image to 224 * 224 and normalize using imagenet stats","4e7c2ca3":"Read the CSV file containing file names and labels","80ae68b4":"Now let us look at our loaded data.","1d9e0982":"I would like to thank Butch Landingin & andreaslillebo for helping me troubeshoot the instalation process.","8c8fda8e":"We are going to use a very simple model ResNet18 for this demo.","3feb5f7a":"Transfer the model to TPU.","1a1cbc6e":"![image.png](attachment:image.png)\nImage credit: https:\/\/en.wikipedia.org\/wiki\/Cassava_mosaic_virus#\/media\/File:Forestryimages_cassava.jpg","6e73004f":"Let's first install the required libraries ","62e8e0a2":"          0:\"Cassava Bacterial Blight (CBB)\",\n          1:\"Cassava Brown Streak Disease (CBSD)\",\n          2:\"Cassava Green Mottle (CGM)\",\n          3:\"Cassava Mosaic Disease (CMD)\",\n          4:\"Healthy\"","3684a066":"This notebook uses FastAI XLA Extensions Library to use TPU. \nYou can learn more about FastAI XLA Extensions Library at https:\/\/github.com\/butchland\/fastai_xla_extensions","fec2e66b":"# Cassava Leaf Disease classification with FastAI on TPU","bbb916fe":"Install fastai_xla_extensions"}}