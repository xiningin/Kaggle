{"cell_type":{"44294f42":"code","30e61fc1":"code","99580dea":"code","58798afb":"code","e2551b24":"code","8a45a2c5":"code","5e5bbab9":"code","6a9a04c7":"code","ded46060":"code","81a84022":"code","2913bacc":"code","5220580e":"code","59a1524f":"code","681b2aa1":"code","743634da":"code","ec71b78a":"code","8504eb04":"code","0499fe7c":"code","bcf7d541":"code","2f3d117f":"code","41c35b99":"code","4b0ffdab":"code","0b18d53f":"code","998cd0ab":"code","6acefe5e":"code","6b4eb462":"code","76a0fd75":"code","feeb89b0":"code","b7c70373":"code","8e5731e8":"code","31631d6d":"code","4f7dac71":"code","72ad2818":"code","f90f107e":"code","89bb91e7":"code","db05a88d":"code","b7e776ea":"code","a2c638f9":"code","c18d8a04":"code","538314c4":"code","40667463":"code","9fc99fd8":"code","c3068943":"markdown","aaff6976":"markdown","0d9ffcd4":"markdown"},"source":{"44294f42":"import warnings\nwarnings.filterwarnings('ignore')","30e61fc1":"!pip install feature-engine","99580dea":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns","58798afb":"from sklearn.model_selection import train_test_split\nfrom sklearn.ensemble import RandomForestClassifier,ExtraTreesClassifier,GradientBoostingClassifier\nfrom feature_engine.discretisers import EqualWidthDiscretiser\nfrom feature_engine.categorical_encoders import RareLabelCategoricalEncoder\nfrom feature_engine.categorical_encoders import OneHotCategoricalEncoder\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.metrics import confusion_matrix,classification_report,accuracy_score\nfrom sklearn.model_selection import GridSearchCV","e2551b24":"train=pd.read_csv('\/kaggle\/input\/adult-census-income\/adult.csv')","8a45a2c5":"train.head()","5e5bbab9":"train.info()","6a9a04c7":"train.describe()","ded46060":"# We plot to see the capital gains of people with income greater 50k and also less than 50k\n\nplt.figure(figsize=(12,4))\nsns.barplot(x='education',hue='income',y='capital.gain',data=train)\nplt.xticks(rotation=45)","81a84022":"# We similarly plot to see the capital losses of people with income greater than 50k and also less than 50k\n\nplt.figure(figsize=(12,4))\nsns.barplot(x='education',hue='income',y='capital.loss',data=train)\nplt.xticks(rotation=45)","2913bacc":"train.head()","5220580e":"# We plot to see if race has effect on the income of the person.\nplt.figure(figsize=(12,4))\nsns.countplot(x='race',hue='income',data=train)","59a1524f":"# We plot to check if the sex has an effect on the income of a person\nplt.figure(figsize=(12,4))\nsns.countplot(x='sex',hue='income',data=train)","681b2aa1":"# We plot to find if education has an effect on the income of a person\n\nplt.figure(figsize=(12,4))\nsns.countplot(x='education',hue='income',data=train)\nplt.xticks(rotation=45)","743634da":"# We plot to see if being in a relationship has an effect on income\nplt.figure(figsize=(12,4))\nsns.countplot(x='relationship',hue='income',data=train)\nplt.xticks(rotation=45)","ec71b78a":"# We plot to the workclass to see if it has any effect on income\nplt.figure(figsize=(12,4))\nsns.countplot(x='workclass',hue='income',data=train)\nplt.xticks(rotation=45)","8504eb04":"plt.figure(figsize=(12,4))\nsns.countplot(x='occupation',hue='income',data=train)\nplt.xticks(rotation=45)","0499fe7c":"X=train.drop(columns='income')\n\ny=train['income']","bcf7d541":"# We change the <=50K to 1 and >50K to 0 for ease of classification\ny=y.map({'<=50K':0,'>50K':1})","2f3d117f":"# We split the dataset into train and test dataset\n\nX_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=0)","41c35b99":"X_train['workclass'].value_counts()","4b0ffdab":"# We also the ? with the type as missing\nX_train['workclass']=X_train['workclass'].replace({'Without-pay':'Never-worked','?':'Missing'}) # We replace the without pay and to never worked as they both imply the same thing.\n\nX_test['workclass']=X_test['workclass'].replace({'Without-pay':'Never-worked','?':'Missing'}) ","0b18d53f":"# We change the ? to indicate it as missing\nX_train['occupation']=X_train['occupation'].replace({'?':'Missing'})\n\nX_test['occupation']=X_test['occupation'].replace({'?':'Missing'})","998cd0ab":"# We bin the age and hours per week columns\n\newd=EqualWidthDiscretiser(bins=10,variables=['age','hours.per.week'])\n\newd.fit(X_train)\n\nX_train=ewd.transform(X_train)\n\nX_test=ewd.transform(X_test)","6acefe5e":"X_train=X_train.drop(columns=['fnlwgt','education'])\n\nX_test=X_test.drop(columns=['fnlwgt','education'])","6b4eb462":"# We create a list of categorical variables\nqualitative=list(X_train.select_dtypes(include='object'))\n\nqualitative","76a0fd75":"# Inorder to check the sparsity of the categorical variables we plot them on a graph.\ncount=1\nplt.figure(figsize=(20,10))\nfor col in qualitative:\n    temp_df = pd.Series(X_train[col].value_counts() \/ len(X_train) )\n\n    # make plot with the above percentages\n    plt.subplot(3,3, count)\n    fig = temp_df.sort_values(ascending=False).plot.bar()\n    fig.set_xlabel(col)\n    \n    # add a line at 4 % to flag the threshold for rare categories\n    fig.axhline(y=0.04, color='red')\n    fig.set_ylabel('Percentage Count')\n    count +=1","feeb89b0":"# We impute rare labels to the native country column\nrce=RareLabelCategoricalEncoder(tol=0.04,n_categories=2,variables='native.country')\n\nrce.fit(X_train)\n\nX_train=rce.transform(X_train)\n\nX_test=rce.transform(X_test)","b7c70373":"# We use the heatmap to find the most important features\n\ndata_com=pd.concat([X_train,y_train],axis=1)\n\ndata_com=data_com.corr()\n\nplt.figure(figsize=(8,8))\n\nsns.heatmap(data_com,annot=True)","8e5731e8":"# We use one hot categorical encoder on the dataset\n\noce=OneHotCategoricalEncoder(drop_last=True)\n\noce.fit(X_train)\n\nX_train=oce.transform(X_train)\n\nX_test=oce.transform(X_test)","31631d6d":"# We standard scale on the dataset\n\ntrain_cols=X_train.columns\n\nsc=StandardScaler()\n\nsc.fit(X_train)\n\nX_train=pd.DataFrame(sc.transform(X_train),columns=train_cols)\n\nX_test=pd.DataFrame(sc.transform(X_test),columns=train_cols)","4f7dac71":"# We perform the random forest classifier on the dataset\n\nclassifier_rf=RandomForestClassifier(random_state=0)\n\nclassifier_rf.fit(X_train,y_train)\n\ny_pred_rf=classifier_rf.predict(X_test)","72ad2818":"# We find the classification report for the model\n\nclass_report=classification_report(y_pred_rf,y_test)\n\nprint('The classification report is \\n{}'.format(class_report))","f90f107e":"# We perform the gradient boost classifier on the dataset\n\nclassifier_gb=GradientBoostingClassifier(random_state=0)\n\nclassifier_gb.fit(X_train,y_train)\n\ny_pred_gb=classifier_gb.predict(X_test)","89bb91e7":"# We find the classification report for the model\n\nclass_report=classification_report(y_pred_gb,y_test)\n\nprint('The classification report is \\n{}'.format(class_report))","db05a88d":"# We perform the Extra Tree classifier on the dataset\n\nclassifier_ec=ExtraTreesClassifier(random_state=0)\n\nclassifier_ec.fit(X_train,y_train)\n\ny_pred_ec=classifier_ec.predict(X_test)","b7e776ea":"# We find the classification report for the model\n\nclass_report=classification_report(y_pred_ec,y_test)\n\nprint('The classification report is \\n{}'.format(class_report))","a2c638f9":"# We use grid search to find the best parameters for the gradient boosting model\n\nparams=[{'learning_rate':[0.1,0.001,0.001],'n_estimators':[100,300,500,700,1000]}]\n\ngsc=GridSearchCV(estimator=classifier_gb,param_grid=params,scoring='accuracy',n_jobs=-1,cv=5)","c18d8a04":"gsc.fit(X_train,y_train)","538314c4":"gsc.best_params_","40667463":"# We perform the gradient boost classifier on the dataset after finding the best parameters\n\nclassifier_gb1=GradientBoostingClassifier(n_estimators=500,random_state=0)\n\nclassifier_gb1.fit(X_train,y_train)\n\ny_pred_gb1=classifier_gb1.predict(X_test)","9fc99fd8":"# We find the classification report for the model\n\nclass_report=classification_report(y_pred_gb1,y_test)\n\nprint('The classification report is \\n{}'.format(class_report))","c3068943":"all the features look have similar values we cant distinguish a least important feature","aaff6976":"From the above two plots we are able to understand that people with a income greater than 50k tend to make more capital gains while at the same time incur more capital lose","0d9ffcd4":"From the above report there is not much improvment in the accuracy"}}