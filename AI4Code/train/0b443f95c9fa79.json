{"cell_type":{"368f3dd4":"code","4944cfb8":"code","ea9ccabe":"code","8734a798":"code","a0047f63":"code","a3648b19":"code","d07b9b64":"code","bdb4cd69":"code","6de07b46":"code","54189d6c":"code","1d512ebc":"code","9a8d8876":"code","12022323":"code","b3d1bc49":"code","253e0791":"code","63fad986":"code","0dcb9045":"code","9fc6b4a7":"code","a526f2fe":"code","b791eeb0":"code","fba68808":"code","caeb484a":"code","717e899a":"code","6142ef7f":"code","2b4ab4c4":"code","98202af8":"code","a877d52b":"code","9f42c9e9":"code","f224ef55":"code","9f6620e8":"code","cb0961cc":"code","e38169de":"code","8118d089":"code","7eeb525d":"markdown"},"source":{"368f3dd4":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\n#import numpy as np # linear algebra\n#import pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","4944cfb8":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport glob\nimport plotly.graph_objs as go\nimport plotly.express as px\nimport warnings\nwarnings.filterwarnings('once')","ea9ccabe":"districts_info = pd.read_csv('..\/input\/learnplatform-covid19-impact-on-digital-learning\/districts_info.csv')\nproducts_info = pd.read_csv('..\/input\/learnplatform-covid19-impact-on-digital-learning\/products_info.csv')\n\nengagement_path = (\"..\/input\/learnplatform-covid19-impact-on-digital-learning\/engagement_data\")\nengagement_merged = glob.glob(engagement_path + \"\/*.csv\")\nfiles = []\n\nfor file in engagement_merged:\n    df = pd.read_csv(file, index_col = None, header = 0)\n    district_id = file.split('\/')[4].split('.')[0]\n    df['district_id'] = district_id\n    files.append(df)\n    \nengagement = pd.concat(files)\nengagement = engagement.reset_index(drop = True)\nengagement['time'] = pd.to_datetime(engagement['time'])    ","8734a798":"round(len(districts_info.query('state != state'))\/len(districts_info)*100, 1)\ntotal = districts_info.isnull().sum().sort_values(ascending = False)\npercent_1 = districts_info.isnull().sum()\/ districts_info.isnull().count()*100\npercent_2 = round(percent_1, 1).sort_values(ascending = False)\nmissing_data = pd.concat([total, percent_2], axis = 1, keys = ['Total', '%'])","a0047f63":"missing_data","a3648b19":"districts_info.dropna(inplace = True)","d07b9b64":"districts_info.head(30)","bdb4cd69":"for i in ['pct_black\/hispanic', 'pct_free\/reduced']:\n    districts_info[i] = districts_info[i].apply(lambda x: float(x.split(',')[0][1:]) + 0.1)\n    \ndistricts_info['pp_total_raw'] = districts_info['pp_total_raw'].apply(lambda x: int(x.split(',')[0][1:])+1000)   \n\ndistricts_info.drop('county_connections_ratio', axis = 1, inplace = True)\ndistricts_info.head(3)","6de07b46":"#https:\/\/www.kaggle.com\/dmitryuarov\/eda-covid-19-impact-on-digital-learning\n    \n#https:\/\/www.kaggle.com\/sudj10\/learnplatform-covid-19-impact-on-digital-learning\n    \n#https:\/\/www.kaggle.com\/yosefemiru\/learnplatform-covid-19-impact-on-digital-learning    ","54189d6c":"products_info.head()","1d512ebc":"products_info.info()","9a8d8876":"products_info['Basic_Category'] = 'x'\nfor i in range (len(products_info)):\n    if pd.isna(products_info['Primary Essential Function'][i]) == False:\n        products_info['Basic_Category'][i] = products_info['Primary Essential Function'][i].split('-')[0][:-1]\n\nproducts_info.head(5)\n\n# products['Basic_category'] = 'x'\n# for i in range(len(products)):\n#     if pd.isna(products['Primary Essential Function'][i]) == False:\n#         products['Basic_category'][i] = products['Primary Essential Function'][i].split('-')[0][:-1]\n        \n# products.head(3)","12022323":"products_info['Basic_Category'].unique()","b3d1bc49":"engagement.info()","253e0791":"state_abb = {\n    'Alabama': 'AL',\n    'Alaska': 'AK',\n    'American Samoa': 'AS',\n    'Arizona': 'AZ',\n    'Arkansas': 'AR',\n    'California': 'CA',\n    'Colorado': 'CO',\n    'Connecticut': 'CT',\n    'Delaware': 'DE',\n    'District Of Columbia': 'DC',\n    'Florida': 'FL',\n    'Georgia': 'GA',\n    'Guam': 'GU',\n    'Hawaii': 'HI',\n    'Idaho': 'ID',\n    'Illinois': 'IL',\n    'Indiana': 'IN',\n    'Iowa': 'IA',\n    'Kansas': 'KS',\n    'Kentucky': 'KY',\n    'Louisiana': 'LA',\n    'Maine': 'ME',\n    'Maryland': 'MD',\n    'Massachusetts': 'MA',\n    'Michigan': 'MI',\n    'Minnesota': 'MN',\n    'Mississippi': 'MS',\n    'Missouri': 'MO',\n    'Montana': 'MT',\n    'Nebraska': 'NE',\n    'Nevada': 'NV',\n    'New Hampshire': 'NH',\n    'New Jersey': 'NJ',\n    'New Mexico': 'NM',\n    'New York': 'NY',\n    'North Carolina': 'NC',\n    'North Dakota': 'ND',\n    'Northern Mariana Islands':'MP',\n    'Ohio': 'OH',\n    'Oklahoma': 'OK',\n    'Oregon': 'OR',\n    'Pennsylvania': 'PA',\n    'Puerto Rico': 'PR',\n    'Rhode Island': 'RI',\n    'South Carolina': 'SC',\n    'South Dakota': 'SD',\n    'Tennessee': 'TN',\n    'Texas': 'TX',\n    'Utah': 'UT',\n    'Vermont': 'VT',\n    'Virgin Islands': 'VI',\n    'Virginia': 'VA',\n    'Washington': 'WA',\n    'West Virginia': 'WV',\n    'Wisconsin': 'WI',\n    'Wyoming': 'WY'\n}\n\ndistricts_info['state_abb'] = districts_info['state'].map(state_abb)\n\nfig = go.Figure()\nlayout = dict(\n    title_text = \"Count of districts in the available States\",\n    title_font = dict(\n            family = \"monospace\",\n            size = 25,\n            color = \"black\"\n            ),\n    geo_scope = 'usa'\n)\n\nfig.add_trace(\n    go.Choropleth(\n        locations = districts_info['state_abb'].value_counts().to_frame().reset_index()['index'],\n        zmax = 1,\n        z = districts_info['state_abb'].value_counts().to_frame().reset_index()['state_abb'],\n        locationmode = 'USA-states',\n        marker_line_color = 'white',\n        geo = 'geo',\n        colorscale = \"cividis\", \n    )\n)\n            \nfig.update_layout(layout)   \nfig.show()\n\n\nplt.figure(figsize = (15, 8))\nsns.set_style(\"white\")\na = sns.barplot(data = districts_info['state'].value_counts().reset_index(), x = 'state', y = 'index', color = '#90afc5')\nplt.xticks([])\nplt.yticks(fontname = 'monospace', fontsize = 14, color = '#283655')\nplt.ylabel('')\nplt.xlabel('')\n\na.spines['left'].set_linewidth(1.5)\nfor w in ['right', 'top', 'bottom']:\n    a.spines[w].set_visible(False)\n    \nfor p in a.patches:\n    width = p.get_width()\n    plt.text(0.5 + width, p.get_y() + 0.55 * p.get_height(), f'{int(width)}',\n             ha = 'center', va = 'center', fontname = 'monospace', fontsize = 15, color = '#283655')\n\nplt.show()","63fad986":"fig = px.pie(districts_info['locale'].value_counts().reset_index().rename(columns = {'locale': 'count'}), values = 'count', names = 'index', width = 700, height = 700)\n\nfig.update_traces(textposition = 'inside', \n  textinfo = 'percent + label', \n  hole = 0.7, \n  marker = dict(colors = ['#90afc5','#336b87','#2a3132','#763626'], line = dict(color = 'white', width = 2)))\n\nfig.update_layout(annotations = [dict(text = ' The count of districts <br>in each type <br>of areas', \n                      x = 0.5, y = 0.5, font_size = 26, showarrow = False, \n                      font_family = 'monospace',\n                      font_color = '#283655')],\n  showlegend = False)\n\nfig.show()","0dcb9045":"\ncolors = ['#90afc5', '#336b87', '#763626']\n\nfig = plt.figure(figsize = (15, 11))\nfor i in range(len(districts_info.columns.tolist()[3:6])):\n    plt.subplot(2, 2, i+1)\n    sns.set_style(\"white\")\n    plt.title(districts_info.columns.tolist()[3:6][i], size = 20, fontname = 'monospace', color = colors[i])\n    a = sns.kdeplot(districts_info[districts_info.columns.tolist()[3:6][i]], color = colors[i], shade = True, alpha = 0.9, linewidth = 1.5, edgecolor = 'black')\n    plt.ylabel('')\n    plt.xlabel('')\n    plt.xticks(fontname = 'monospace')\n    plt.yticks([])\n    for j in ['right', 'left', 'top']:\n        a.spines[j].set_visible(False)\n        a.spines['bottom'].set_linewidth(1.2)\n        \nfig.tight_layout(h_pad = 3)\n\nplt.figtext(0.07, 1.05, 'Distribution of characteristics of school districts', fontsize = 30, fontname = 'monospace', color = '#283655')\n\nplt.figtext(0.84, 0.37, 'Conclusion', fontsize = 25, fontname = 'monospace', color = '#283655')\n\nplt.figtext(0.98, 0.15, '''The average number of students who identified themselves\nas Black or Hispanic is 23.2%. The most common value is 10%.\n\nThe average number of students eligible for free orreduced-price\nlunch is 38%. The most common values are ~30% and ~50%.\n\nPer-pupil total expenditure (sum of local and federal \nexpenditure) is 11 205 $. The most common value is 9 000 \\$.''', fontsize = 13, fontname = 'monospace', color = '#283655', ha = 'right')\n\nplt.show()","9fc6b4a7":"#round((districts_info['pct_black\/hispanic'].sum()\/len(districts_info))*100,2)\n#(districts_info['pct_black\/hispanic'].mode())*100\n#Free or Reduced Price Lunch\n#round((districts_info['pct_free\/reduced'].sum()\/len(districts_info))*100,2)\n#(districts_info['pct_free\/reduced'].mode())*100\n#Per-Pupil Total Expenditure\n#round((districts_info['pp_total_raw'].sum()\/len(districts_info)),0)\n#(districts_info['pp_total_raw'].mode())","a526f2fe":"dist_area_group = districts_info.groupby('locale').agg({'pct_black\/hispanic': 'mean', 'pct_free\/reduced': 'mean', 'pp_total_raw': 'mean'}).reset_index()\n\ncolors = ['#90afc5', '#336b87', '#763626']\n\nfig = plt.figure(figsize = (13, 12))\nfor i in range(len(dist_area_group.columns.tolist()[1:])):\n    plt.subplot(2, 2, i+1)\n    sns.set_style(\"white\")\n    plt.title(dist_area_group.columns.tolist()[1:][i], size = 20, fontname = 'monospace', y = 1.09, color = colors[i])\n    plt.grid(color = 'gray', linestyle = ':', axis = 'y', zorder = 0,  dashes = (1,7))\n    a = sns.barplot(data = dist_area_group, x = 'locale', y = dist_area_group.columns.tolist()[1:][i], color = colors[i])\n    plt.ylabel('')\n    plt.xlabel('')\n    plt.xticks(fontname = 'monospace', size = 14)\n    plt.yticks([])\n    \n    for j in ['right', 'top', 'left']:\n        a.spines[j].set_visible(False)\n    for j in ['bottom']:\n        a.spines[j].set_linewidth(1.4)\n      \n    if i < 2:\n        for p in a.patches:\n            height = p.get_height()\n            a.annotate(f'{int(height*100)} %', (p.get_x() + p.get_width() \/ 2, p.get_height()-0.03), \n                   ha = 'center', va = 'center', \n                   size = 18,\n                   xytext = (0, 5), \n                   textcoords = 'offset points',\n                   color = 'white',\n                   fontname = 'monospace')\n    else:\n        for p in a.patches:\n            height = p.get_height()\n            a.annotate(f'{int(height)} $', (p.get_x() + p.get_width() \/ 2, p.get_height()-1000), \n                   ha = 'center', va = 'center', \n                   size = 18,\n                   xytext = (0, 5), \n                   textcoords = 'offset points',\n                   color = 'white',\n                   fontname = 'monospace')\n            \nplt.figtext(0.07, 1.05, 'Characteristics of school districts by locale', fontsize = 30, fontname = 'monospace', color = '#283655')\n\nplt.figtext(0.83, 0.34, 'Conclusion', fontsize = 25, fontname = 'monospace', color = '#283655')\n\nplt.figtext(0.99, 0.15, '''The largest count of students who identified themselves\nas Black or Hispanic are in large cities.\nThe smallest count is in the suburbs and rural areas.\n\nIn cities and towns half of the students are eligible\nfor free or reduced-price lunch.\n\nThe highest total expenses per student is in rural area.''', fontsize = 13, fontname = 'monospace', color = '#283655', ha = 'right')\n        \nfig.tight_layout(pad = 3)\n\nplt.show()","b791eeb0":"# Very important! The data is filled incorrectly, which is why many people have an error, because of which, for example, Adobe Inc company has 3, not 4 products.\nfor i in [' ', '.']:\n    for k in range(len(products_info)):\n        if pd.isna(products_info['Provider\/Company Name'][k]) == False:\n            products_info['Provider\/Company Name'][k] = products_info['Provider\/Company Name'][k].strip(i)\n\n# Let's fix the long name\nproducts_info['Provider\/Company Name'] = np.where(products_info['Provider\/Company Name'] == 'Savvas Learning Company | Formerly Pearson K12 Learning',\n                                                  'Savvas Learning Company', products_info['Provider\/Company Name'])\n\nplt.figure(figsize = (15, 8))\nsns.set_style(\"white\")\nplt.title('TOP-15 of learning providers\/companies', size = 35, x = 0.48, y = 1.06, fontname = 'monospace', color = '#283655')\na = sns.barplot(data = products_info['Provider\/Company Name'].value_counts().reset_index().head(15), x = 'Provider\/Company Name', y = 'index', color = '#90afc5')\nplt.xticks([])\nplt.yticks(fontname = 'monospace', fontsize = 14, color = '#283655')\nplt.ylabel('')\nplt.xlabel('')\n\na.spines['left'].set_linewidth(1.5)\nfor w in ['right', 'top', 'bottom']:\n    a.spines[w].set_visible(False)\n    \nfor p in a.patches:\n    width = p.get_width()\n    plt.text(0.5 + width, p.get_y() + 0.55 * p.get_height(), f'{int(width)}',\n             ha = 'center', va = 'center', fontname = 'monospace', fontsize = 15, color = '#283655')\n\nplt.show()","fba68808":"fig = px.pie(products_info['Sector(s)'].value_counts().reset_index().rename(columns = {'Sector(s)': 'count'}).head(15), values = 'count', names = 'index', width = 700, height = 700)\n\nfig.update_traces(textposition = 'inside', \n                  textinfo = 'percent + label', \n                  hole = 0.7, \n                  marker = dict(colors = ['#90afc5','#336b87','#2a3132','#763626', 'a43820'], line = dict(color = 'white', width = 2)))\n\nfig.update_layout(annotations = [dict(text = 'Sector of education <br>where the product is used', \n                                      x = 0.5, y = 0.5, font_size = 26, showarrow = False, \n                                      font_family = 'monospace',\n                                      font_color = '#283655')],\n                  showlegend = False)\n                  \nfig.show()","caeb484a":"plt.figure(figsize = (12, 12))\nsns.set_style(\"white\")\nplt.title('Count of products by subcategory', size = 35, x = 0.2, y = 1.06, fontname = 'monospace', color = '#283655')\na = sns.barplot(data = products_info['Primary Essential Function'].value_counts().reset_index(), x = 'Primary Essential Function', y = 'index', color = '#90afc5')\nplt.xticks([])\nplt.yticks(fontname = 'monospace', fontsize = 10, color = '#283655')\nplt.ylabel('')\nplt.xlabel('')\n\na.spines['left'].set_linewidth(1.5)\nfor w in ['right', 'top', 'bottom']:\n    a.spines[w].set_visible(False)\n    \nfor p in a.patches:\n    width = p.get_width()\n    plt.text(1 + width, p.get_y() + 0.55 * p.get_height(), f'{int(width)}',\n             ha = 'center', va = 'center', fontname = 'monospace', fontsize = 11, color = '#283655')\n\nplt.show()\n##########\nfig = px.pie(products_info.query(\"Basic_Category != 'x'\")['Basic_Category'].value_counts().reset_index().rename(columns = {'Basic_Category': 'count'}),\n             values = 'count', names = 'index', width = 700, height = 700)\n\nfig.update_traces(textposition = 'inside', \n                  textinfo = 'percent + label', \n                  hole = 0.7, \n                  marker = dict(colors = ['#90afc5','#336b87','#2a3132','#763626'], line = dict(color = 'white', width = 2)))\n\nfig.update_layout(annotations = [dict(text = 'Count of products <br>by category', \n                                      x = 0.5, y = 0.5, font_size = 26, showarrow = False, \n                                      font_family = 'monospace',\n                                      font_color = '#283655')],\n                  showlegend = False)\n                  \nfig.show()","717e899a":"merged_data = pd.merge(products_info, engagement, left_on = 'LP ID', right_on = 'lp_id')\nmerged_data['district_id'] = merged_data['district_id'].astype('int64')\nmerged_data = pd.merge(merged_data, districts_info, on = 'district_id')\nmerged_data.drop(['URL', 'lp_id', 'state_abb'], axis = 1, inplace = True)\nmerged_data.head(3)","6142ef7f":"st_ac\u0441ess = merged_data.groupby(['state', 'time']).agg({'pct_access': 'mean'}).reset_index()\nst_eng = merged_data.groupby(['state', 'time']).agg({'engagement_index': 'mean'}).reset_index()\nloc_ac\u0441ess = merged_data.groupby(['locale', 'time']).agg({'pct_access': 'mean'}).reset_index()\nloc_eng = merged_data.groupby(['locale', 'time']).agg({'engagement_index': 'mean'}).reset_index()\ncat_ac\u0441ess = merged_data.groupby(['Basic_Category', 'time']).agg({'pct_access': 'mean'}).reset_index()\ncat_eng = merged_data.groupby(['Basic_Category', 'time']).agg({'engagement_index': 'mean'}).reset_index()\n\nfor i in [st_ac\u0441ess, st_eng, loc_ac\u0441ess, loc_eng, cat_ac\u0441ess, cat_eng]:\n    i['day_of_week'] = i['time'].dt.dayofweek\n    \nst_ac\u0441ess.head(3)","2b4ab4c4":"fig = px.line(st_ac\u0441ess, x=\"time\", y=\"pct_access\", color=\"state\", line_group=\"state\")\n\nfig.update_layout(plot_bgcolor = 'white', title = 'Dynamics of pct_access of all products by states', \n                  title_font_family = 'monospace', title_font_color = '#221f1f', title_font_size = 20, title_x = 0.5)\nfig.update_xaxes(showline = True, linecolor = '#f5f2f2', linewidth = 2, tickfont_family = 'monospace', tickfont_color = '#221f1f', tickfont_size = 12)\nfig.update_yaxes(showline = True, linecolor = '#f5f2f2', \n                 showgrid = True, gridwidth = 1, gridcolor = '#f5f2f2',\n                 linewidth = 2, tickfont_family = 'monospace', tickfont_color = '#221f1f', tickfont_size = 12)\n\nfig.add_vline(x = '2020-03-11', line_width = 3, line_color=\"red\")\n\nfig.add_annotation(\n        x='2020-03-11',\n        y=2.7,\n        text=\"WHO has declared Covid-19 a pandemic\",\n        showarrow=True,\n        font=dict(\n            family=\"monospace\",\n            size=11,\n            color=\"black\"\n            ),\n        arrowhead=2,\n        arrowsize=1,\n        arrowwidth=2,\n        arrowcolor=\"#636363\",\n        ax= 130,\n        ay=1\n        )\n\nfig.add_vrect(x0=\"2020-06-01\", x1=\"2020-08-31\", fillcolor=\"yellow\", opacity=0.25, line_width=0)\n\nfig.add_annotation(\n        x='2020-07-15',\n        y=2.25,\n        text=\"Summer holidays\",\n        showarrow=False,\n        font=dict(\n            family=\"monospace\",\n            size=11,\n            color=\"black\"\n            )\n        )\n\nfig.update_traces(line_width=1)\n\nfig.show()\n","98202af8":"fig = px.line(st_eng, x=\"time\", y=\"engagement_index\", color=\"state\", line_group=\"state\")\n\nfig.update_layout(plot_bgcolor = 'white', title = 'Dynamics of engagement index of all products by states', \n                  title_font_family = 'monospace', title_font_color = '#221f1f', title_font_size = 20, title_x = 0.5)\nfig.update_xaxes(showline = True, linecolor = '#f5f2f2', linewidth = 2, tickfont_family = 'monospace', tickfont_color = '#221f1f', tickfont_size = 12)\nfig.update_yaxes(showline = True, linecolor = '#f5f2f2', \n                 showgrid = True, gridwidth = 1, gridcolor = '#f5f2f2',\n                 linewidth = 2, tickfont_family = 'monospace', tickfont_color = '#221f1f', tickfont_size = 12)\n\nfig.add_vline(x = '2020-03-11', line_width = 3, line_color=\"red\")\n\nfig.add_annotation(\n        x='2020-03-11',\n        y=1150,\n        text=\"WHO has declared Covid-19 a pandemic\",\n        showarrow=True,\n        font=dict(\n            family=\"monospace\",\n            size=11,\n            color=\"black\"\n            ),\n        arrowhead=2,\n        arrowsize=1,\n        arrowwidth=2,\n        arrowcolor=\"#636363\",\n        ax= 130,\n        ay=1\n        )\n\nfig.add_vrect(x0=\"2020-06-01\", x1=\"2020-08-31\", fillcolor=\"yellow\", opacity=0.25, line_width=0)\n\nfig.add_annotation(\n        x='2020-07-15',\n        y=900,\n        text=\"Summer holidays\",\n        showarrow=False,\n        font=dict(\n            family=\"monospace\",\n            size=11,\n            color=\"black\"\n            )\n        )\n\nfig.update_traces(line_width=1)\n\nfig.show()","a877d52b":"months_map = {1:\"January\",2:\"February\",3:\"March\",4:\"April\",\n              5:\"May\",6:\"June\",7:\"July\",8:\"August\",9:\"September\",\n              10:\"October\",11:\"November\",12:\"December\"}\n\nfor i in [st_ac\u0441ess, st_eng]:\n    i['state_abb'] = i['state'].map(state_abb)\n    i['month'] = i.time.dt.month.map(months_map)\n\n    fig = px.choropleth(data_frame = i.groupby(['state', 'state_abb', 'month']).agg({i.columns[2]: 'mean'}).reset_index(), locations = \"state_abb\", locationmode = \"USA-states\",\n                    color = i.groupby(['state', 'state_abb', 'month']).agg({i.columns[2]: 'mean'}).reset_index()[i.groupby(['state', 'state_abb', 'month']).agg({i.columns[2]: 'mean'}).reset_index().columns[3]], scope = \"usa\",\n                    color_continuous_scale = \"cividis\", animation_frame = \"month\", hover_name = \"state\")\n    \n    fig.update_layout(title_text = f'Monthly dynamics of {i.columns[2]}', title_font = dict(family = \"monospace\",size = 25,color = \"black\")) \n    \n    fig.show()","9f42c9e9":"cov_imp = pd.DataFrame(st_ac\u0441ess['state'].unique().tolist()).rename(columns = {0: 'state'})\n\n# We have no information about Texas during the start of pandemic\ncov_imp = cov_imp.query(\"state != 'Texas'\").reset_index()\ncov_imp.drop('index', axis = 1, inplace = True)\n\nfor i in ['mean_access', '1w_acess_change%', '2w_acess_change%', 'mean_eng', '1w_eng_change%', '2w_eng_change%']:\n    cov_imp[i] = 0.0\n\nstates = cov_imp['state'].unique().tolist()\n\nfor i in states:\n    cov_imp['mean_access'][states.index(i)] = round(st_ac\u0441ess.query(\"time >= '2020-03-09' & time <= '2020-03-13' & state == @i\")['pct_access'].mean(), 2)\n    cov_imp['1w_acess_change%'][states.index(i)] = round((st_ac\u0441ess.query(\"time >= '2020-03-16' & time <= '2020-03-20' & state == @i\")['pct_access'].mean() \/ cov_imp['mean_access'][states.index(i)] - 1) * 100, 1)\n    cov_imp['2w_acess_change%'][states.index(i)] = round((st_ac\u0441ess.query(\"time >= '2020-03-23' & time <= '2020-03-27' & state == @i\")['pct_access'].mean() \/ st_ac\u0441ess.query(\"time >= '2020-03-16' & time <= '2020-03-20' & state == @i\")['pct_access'].mean() - 1) * 100, 1)\n    cov_imp['mean_eng'][states.index(i)] = round(st_eng.query(\"time >= '2020-03-09' & time <= '2020-03-13' & state == @i\")['engagement_index'].mean(), 1)\n    cov_imp['1w_eng_change%'][states.index(i)] = round((st_eng.query(\"time >= '2020-03-16' & time <= '2020-03-20' & state == @i\")['engagement_index'].mean() \/ cov_imp['mean_eng'][states.index(i)] - 1) * 100, 1)\n    cov_imp['2w_eng_change%'][states.index(i)] = round((st_eng.query(\"time >= '2020-03-23' & time <= '2020-03-27' & state == @i\")['engagement_index'].mean() \/ st_eng.query(\"time >= '2020-03-16' & time <= '2020-03-20' & state == @i\")['engagement_index'].mean() - 1) * 100, 1)\n\ndef color_values(val):\n    color = 'red' if val < 0 else 'green'\n    return 'color: %s' % color\n\nslice_ = ['1w_acess_change%', '2w_acess_change%', '1w_eng_change%', '2w_eng_change%']\nslice_2 = ['mean_access', '1w_acess_change%', '2w_acess_change%']\nslice_3 = ['mean_eng', '1w_eng_change%', '2w_eng_change%']\ncov_imp.style.applymap(color_values, subset = slice_).set_precision(1).set_properties(**{'background-color': '#fafafa'}, subset=slice_2).set_properties(**{'background-color': '#f7f7f7'}, subset=slice_3)","f224ef55":"fig = px.line(loc_ac\u0441ess, x=\"time\", y=\"pct_access\", color=\"locale\", line_group=\"locale\")\n\nfig.update_layout(plot_bgcolor = 'white', title = 'Dynamics of pct_access of all products by locale', \n                  title_font_family = 'monospace', title_font_color = '#221f1f', title_font_size = 20, title_x = 0.5)\nfig.update_xaxes(showline = True, linecolor = '#f5f2f2', linewidth = 2, tickfont_family = 'monospace', tickfont_color = '#221f1f', tickfont_size = 12)\nfig.update_yaxes(showline = True, linecolor = '#f5f2f2', \n                 showgrid = True, gridwidth = 1, gridcolor = '#f5f2f2',\n                 linewidth = 2, tickfont_family = 'monospace', tickfont_color = '#221f1f', tickfont_size = 12)\n\nfig.add_vline(x = '2020-03-11', line_width = 3, line_color=\"red\")\n\nfig.add_annotation(\n        x='2020-03-11',\n        y=2,\n        text=\"WHO has declared Covid-19 a pandemic\",\n        showarrow=True,\n        font=dict(\n            family=\"monospace\",\n            size=11,\n            color=\"black\"\n            ),\n        arrowhead=2,\n        arrowsize=1,\n        arrowwidth=2,\n        arrowcolor=\"#636363\",\n        ax= 130,\n        ay=1\n        )\n\nfig.add_vrect(x0=\"2020-06-01\", x1=\"2020-08-31\", fillcolor=\"yellow\", opacity=0.25, line_width=0)\n\nfig.add_annotation(\n        x='2020-07-15',\n        y=1.75,\n        text=\"Summer holidays\",\n        showarrow=False,\n        font=dict(\n            family=\"monospace\",\n            size=11,\n            color=\"black\"\n            )\n        )\n\nfig.update_traces(line_width=1)\n\nfig.show()","9f6620e8":"cov_imp2 = pd.DataFrame(loc_ac\u0441ess['locale'].unique().tolist()).rename(columns = {0: 'locale'})\n\nfor i in ['mean_access', '1w_acess_change%', '2w_acess_change%', 'mean_eng', '1w_eng_change%', '2w_eng_change%']:\n    cov_imp2[i] = 0.0\n\nlocales = cov_imp2['locale'].unique().tolist()\n\nfor i in locales:\n    cov_imp2['mean_access'][locales.index(i)] = round(loc_ac\u0441ess.query(\"time >= '2020-03-09' & time <= '2020-03-13' & locale == @i\")['pct_access'].mean(), 2)\n    cov_imp2['1w_acess_change%'][locales.index(i)] = round((loc_ac\u0441ess.query(\"time >= '2020-03-16' & time <= '2020-03-20' & locale == @i\")['pct_access'].mean() \/ cov_imp2['mean_access'][locales.index(i)] - 1) * 100, 1)\n    cov_imp2['2w_acess_change%'][locales.index(i)] = round((loc_ac\u0441ess.query(\"time >= '2020-03-23' & time <= '2020-03-27' & locale == @i\")['pct_access'].mean() \/ loc_ac\u0441ess.query(\"time >= '2020-03-16' & time <= '2020-03-20' & locale == @i\")['pct_access'].mean() - 1) * 100, 1)\n    cov_imp2['mean_eng'][locales.index(i)] = round(loc_eng.query(\"time >= '2020-03-09' & time <= '2020-03-13' & locale == @i\")['engagement_index'].mean(), 1)\n    cov_imp2['1w_eng_change%'][locales.index(i)] = round((loc_eng.query(\"time >= '2020-03-16' & time <= '2020-03-20' & locale == @i\")['engagement_index'].mean() \/ cov_imp2['mean_eng'][locales.index(i)] - 1) * 100, 1)\n    cov_imp2['2w_eng_change%'][locales.index(i)] = round((loc_eng.query(\"time >= '2020-03-23' & time <= '2020-03-27' & locale == @i\")['engagement_index'].mean() \/ loc_eng.query(\"time >= '2020-03-16' & time <= '2020-03-20' & locale == @i\")['engagement_index'].mean() - 1) * 100, 1)\n\ncov_imp2.style.applymap(color_values, subset = slice_).set_precision(1).set_properties(**{'background-color': '#fafafa'}, subset=slice_2).set_properties(**{'background-color': '#f7f7f7'}, subset=slice_3)","cb0961cc":"fig = px.line(cat_ac\u0441ess.query(\"Basic_Category != 'x'\"), x=\"time\", y=\"pct_access\", color=\"Basic_Category\", line_group=\"Basic_Category\")\n\nfig.update_layout(plot_bgcolor = 'white', title = 'Dynamics of pct_access of all products by product category', \n                  title_font_family = 'monospace', title_font_color = '#221f1f', title_font_size = 20, title_x = 0.5)\nfig.update_xaxes(showline = True, linecolor = '#f5f2f2', linewidth = 2, tickfont_family = 'monospace', tickfont_color = '#221f1f', tickfont_size = 12)\nfig.update_yaxes(showline = True, linecolor = '#f5f2f2', \n                 showgrid = True, gridwidth = 1, gridcolor = '#f5f2f2',\n                 linewidth = 2, tickfont_family = 'monospace', tickfont_color = '#221f1f', tickfont_size = 12)\n\nfig.add_vline(x = '2020-03-11', line_width = 3, line_color=\"red\")\n\nfig.add_annotation(\n        x='2020-03-11',\n        y=4.5,\n        text=\"WHO has declared Covid-19 a pandemic\",\n        showarrow=True,\n        font=dict(\n            family=\"monospace\",\n            size=11,\n            color=\"black\"\n            ),\n        arrowhead=2,\n        arrowsize=1,\n        arrowwidth=2,\n        arrowcolor=\"#636363\",\n        ax= 130,\n        ay=1\n        )\n\nfig.add_vrect(x0=\"2020-06-01\", x1=\"2020-08-31\", fillcolor=\"yellow\", opacity=0.25, line_width=0)\n\nfig.add_annotation(\n        x='2020-07-15',\n        y=3.8,\n        text=\"Summer holidays\",\n        showarrow=False,\n        font=dict(\n            family=\"monospace\",\n            size=11,\n            color=\"black\"\n            )\n        )\n\nfig.update_traces(line_width=1)\n\nfig.show()","e38169de":"fig = px.line(cat_eng.query(\"Basic_Category != 'x'\"), x=\"time\", y=\"engagement_index\", color=\"Basic_Category\", line_group=\"Basic_Category\")\n\nfig.update_layout(plot_bgcolor = 'white', title = 'Dynamics of engagement index of all products by product category', \n                  title_font_family = 'monospace', title_font_color = '#221f1f', title_font_size = 20, title_x = 0.5)\nfig.update_xaxes(showline = True, linecolor = '#f5f2f2', linewidth = 2, tickfont_family = 'monospace', tickfont_color = '#221f1f', tickfont_size = 12)\nfig.update_yaxes(showline = True, linecolor = '#f5f2f2', \n                 showgrid = True, gridwidth = 1, gridcolor = '#f5f2f2',\n                 linewidth = 2, tickfont_family = 'monospace', tickfont_color = '#221f1f', tickfont_size = 12)\n\nfig.add_vline(x = '2020-03-11', line_width = 3, line_color=\"red\")\n\nfig.add_annotation(\n        x='2020-03-11',\n        y=1900,\n        text=\"WHO has declared Covid-19 a pandemic\",\n        showarrow=True,\n        font=dict(\n            family=\"monospace\",\n            size=11,\n            color=\"black\"\n            ),\n        arrowhead=2,\n        arrowsize=1,\n        arrowwidth=2,\n        arrowcolor=\"#636363\",\n        ax= 130,\n        ay=1\n        )\n\nfig.add_vrect(x0=\"2020-06-01\", x1=\"2020-08-31\", fillcolor=\"yellow\", opacity=0.25, line_width=0)\n\nfig.add_annotation(\n        x='2020-07-15',\n        y=1600,\n        text=\"Summer holidays\",\n        showarrow=False,\n        font=dict(\n            family=\"monospace\",\n            size=11,\n            color=\"black\"\n            )\n        )\n\nfig.update_traces(line_width=1)\n\nfig.show()","8118d089":"cov_imp3 = pd.DataFrame(cat_eng.query(\"Basic_Category != 'x'\")['Basic_Category'].unique().tolist()).rename(columns = {0: 'Basic_Category'})\n\nfor i in ['mean_access', '1w_acess_change%', '2w_acess_change%', 'mean_eng', '1w_eng_change%', '2w_eng_change%']:\n    cov_imp3[i] = 0.0\n\ncategories = cov_imp3['Basic_Category'].unique().tolist()\n\nfor i in categories:\n    cov_imp3['mean_access'][categories.index(i)] = round(cat_ac\u0441ess.query(\"time >= '2020-03-09' & time <= '2020-03-13' & Basic_Category == @i\")['pct_access'].mean(), 2)\n    cov_imp3['1w_acess_change%'][categories.index(i)] = round((cat_ac\u0441ess.query(\"time >= '2020-03-16' & time <= '2020-03-20' & Basic_Category == @i\")['pct_access'].mean() \/ cov_imp3['mean_access'][categories.index(i)] - 1) * 100, 1)\n    cov_imp3['2w_acess_change%'][categories.index(i)] = round((cat_ac\u0441ess.query(\"time >= '2020-03-23' & time <= '2020-03-27' & Basic_Category == @i\")['pct_access'].mean() \/ cat_ac\u0441ess.query(\"time >= '2020-03-16' & time <= '2020-03-20' & Basic_Category == @i\")['pct_access'].mean() - 1) * 100, 1)\n    cov_imp3['mean_eng'][categories.index(i)] = round(cat_eng.query(\"time >= '2020-03-09' & time <= '2020-03-13' & Basic_Category == @i\")['engagement_index'].mean(), 1)\n    cov_imp3['1w_eng_change%'][categories.index(i)] = round((cat_eng.query(\"time >= '2020-03-16' & time <= '2020-03-20' & Basic_Category == @i\")['engagement_index'].mean() \/ cov_imp3['mean_eng'][categories.index(i)] - 1) * 100, 1)\n    cov_imp3['2w_eng_change%'][categories.index(i)] = round((cat_eng.query(\"time >= '2020-03-23' & time <= '2020-03-27' & Basic_Category == @i\")['engagement_index'].mean() \/ cat_eng.query(\"time >= '2020-03-16' & time <= '2020-03-20' & Basic_Category == @i\")['engagement_index'].mean() - 1) * 100, 1)\n\ncov_imp3.style.applymap(color_values, subset = slice_).set_precision(1).set_properties(**{'background-color': '#fafafa'}, subset=slice_2).set_properties(**{'background-color': '#f7f7f7'}, subset=slice_3)","7eeb525d":"**Students Activity**"}}