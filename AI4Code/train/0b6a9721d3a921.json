{"cell_type":{"e7fd7e91":"code","c6525ed8":"code","ed7a8e1e":"code","391e3c91":"code","03a20377":"code","a2654dd8":"code","f894bccb":"code","3fdbf1aa":"code","2aae3e49":"code","e3bbe70b":"code","f6ea2551":"code","2b2204e6":"code","ace812df":"code","bfd3af75":"code","35059535":"code","a2001c7d":"code","e38e5722":"code","8c4f7770":"code","d9d55fad":"code","82362ea6":"code","735afadb":"code","e2e10713":"code","94631081":"markdown","46211f36":"markdown","bc9247c4":"markdown","5cf7a9b6":"markdown","d214009a":"markdown","b10974b9":"markdown","aaf05f71":"markdown","2a6a556a":"markdown","f84fe7ec":"markdown"},"source":{"e7fd7e91":"import os\nimport json\nimport pandas as pd\n\n%matplotlib inline\n%config InlineBackend.figure_format = 'retina'\nimport matplotlib.pyplot as plt\nimport matplotlib.image as mpimg\nimport seaborn as sns\nimport cv2\n\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import accuracy_score\nimport tensorflow as tf\nfrom tensorflow.keras import models, layers\nfrom tensorflow.keras.preprocessing.image import ImageDataGenerator\nfrom tensorflow.keras.callbacks import ReduceLROnPlateau\nfrom keras.optimizers import RMSprop\nfrom keras.layers.normalization import BatchNormalization\n\nimport warnings\nwarnings.filterwarnings(\"ignore\")","c6525ed8":"path = '..\/input\/cassava-leaf-disease-classification\/'","ed7a8e1e":"os.listdir(path)","391e3c91":"print('No of Train images: ' + str(len(os.listdir(path + 'train_images'))))\nprint('No of Test images: ' + str(len(os.listdir(path + 'test_images'))))","03a20377":"train = pd.read_csv(path + 'train.csv')\ntrain.head()","a2654dd8":"with open(os.path.join(path + 'label_num_to_disease_map.json')) as f:\n    label_name = json.loads(f.read())\n    \nprint(json.dumps(label_name, indent = 1))","f894bccb":"train['label'] = train['label'].astype(str)\ntrain['label_name'] = train['label'].map(label_name)\ntrain.head()","3fdbf1aa":"plt.figure(figsize = (12,6))\nsns.countplot(y = 'label_name', data = train, order = pd.value_counts(train['label_name']).index, palette = 'muted', edgecolor = 'black')\n\nplt.xlabel(\"\")\nplt.ylabel(\"\")\nplt.yticks(fontsize = 12)\nplt.show()","2aae3e49":"train['label_name'].value_counts()","e3bbe70b":"##Credits to https:\/\/www.kaggle.com\/ihelon\/cassava-leaf-disease-exploratory-data-analysis for this function\n\ndef get_image(image_id, labels):\n    \n    plt.figure(figsize=(20, 18))\n    \n    for i, (image_id, label_name) in enumerate(zip(image_id, labels)):\n        plt.subplot(4, 3, i + 1)\n        image = cv2.imread(os.path.join(path, 'train_images', image_id))\n        image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n        \n        plt.imshow(image)\n        plt.title(f\"{label_name}\", fontweight='bold', fontsize=12)\n        plt.axis(\"off\")\n    \n    plt.show()","f6ea2551":"sample = train.sample(12)\nimage_ids = sample['image_id'].values\nlabels = sample['label_name'].values\n\nget_image(image_ids, labels)","2b2204e6":"##Cassava Mosaic Disease (CMD)\ncmd_sample = train[train['label'] == '3'].sample(12)\nimage_ids = cmd_sample['image_id'].values\nlabels = cmd_sample['label_name'].values\n\nget_image(image_ids, labels)","ace812df":"##healthy\nhealthy_sample = train[train['label'] == '4'].sample(12)\nimage_ids = healthy_sample['image_id'].values\nlabels = healthy_sample['label_name'].values\n\nget_image(image_ids, labels)","bfd3af75":"##Cassava Green Mottle (CGM)\ncgm_sample = train[train['label'] == '2'].sample(12)\nimage_ids = cgm_sample['image_id'].values\nlabels = cgm_sample['label_name'].values\n\nget_image(image_ids, labels)","35059535":"##Cassava Brown Streak Disease (CBSD)\ncbsd_sample = train[train['label'] == '1'].sample(12)\nimage_ids = cbsd_sample['image_id'].values\nlabels = cbsd_sample['label_name'].values\n\nget_image(image_ids, labels)","a2001c7d":"##Cassava Bacterial Blight (CBB)\ncbb_sample = train[train['label'] == '0'].sample(12)\nimage_ids = cbb_sample['image_id'].values\nlabels = cbb_sample['label_name'].values\n\nget_image(image_ids, labels)","e38e5722":"train, validation = train_test_split(train, train_size = 0.8, shuffle = True, random_state = 8)","8c4f7770":"model = tf.keras.Sequential([\n    tf.keras.layers.Conv2D(32, (5, 5), activation='relu', input_shape=(150, 150, 3)),\n    tf.keras.layers.MaxPooling2D(2, 2),\n    tf.keras.layers.Conv2D(64, (5, 5), activation='relu'),\n    tf.keras.layers.MaxPooling2D(2, 2),\n    tf.keras.layers.Conv2D(128, (5, 5), activation='relu'),\n    tf.keras.layers.MaxPooling2D(2, 2),\n    tf.keras.layers.Conv2D(128, (5, 5), activation='relu'),\n    tf.keras.layers.MaxPooling2D(2, 2),\n    tf.keras.layers.Flatten(),\n    tf.keras.layers.Dense(512, activation='relu'),\n    tf.keras.layers.Dense(5, activation='softmax')\n])\n\nmodel.compile(optimizer = RMSprop(), loss='categorical_crossentropy', metrics=['acc'])\n\ncallbacks = ReduceLROnPlateau(monitor='val_acc', \n                              factor=0.5, \n                              patience=5, \n                              verbose=1, \n                              min_lr=0.0001)","d9d55fad":"train_datagen = ImageDataGenerator(rescale=1\/255,\n                                   rotation_range=40,\n                                   width_shift_range=0.2,\n                                   height_shift_range=0.2,\n                                   shear_range=0.2,\n                                   zoom_range=0.2,\n                                   horizontal_flip=True,\n                                   vertical_flip=True)\n\nvalidation_datagen = ImageDataGenerator(rescale=1\/255)","82362ea6":"BATCH_SIZE = 256\nSTEPS_PER_EPOCH = train.shape[0]\/BATCH_SIZE\nVALIDATION_STEPS = validation.shape[0]\/BATCH_SIZE\nEPOCHS = 20\n\ntrain_generator = train_datagen.flow_from_dataframe(train, \n                                                    directory = os.path.join(path, 'train_images'),\n                                                    x_col = 'image_id',\n                                                    y_col = 'label',\n                                                    target_size = (150, 150),\n                                                    batch_size = BATCH_SIZE,\n                                                    class_mode = 'categorical')\n\nvalidation_generator = validation_datagen.flow_from_dataframe(validation, \n                                                    directory = os.path.join(path, 'train_images'),\n                                                    x_col = 'image_id',\n                                                    y_col = 'label',\n                                                    target_size = (150,150),\n                                                    batch_size = BATCH_SIZE,\n                                                    class_mode = 'categorical')","735afadb":"history = model.fit_generator(\n            train_generator,\n            steps_per_epoch = STEPS_PER_EPOCH,\n            epochs = EPOCHS,\n            validation_data = validation_generator,\n            validation_steps = VALIDATION_STEPS,\n            verbose = 1,\n            callbacks = [callbacks])","e2e10713":"epochs = range(1, EPOCHS + 1)\n\nacc = history.history['acc']\nval_acc = history.history['val_acc']\nloss = history.history['loss']\nval_loss = history.history['val_loss']\n\nfig, (ax1, ax2) = plt.subplots(1, 2, figsize=(20, 6))\nax1.plot(epochs, acc, label = 'Training Accuracy')\nax1.plot(epochs, val_acc, label = 'Validation Accuracy')\nax1.set_title('Training & Validation Accuracy', fontweight='bold', fontsize=16)\nax1.legend()\n\nax2.plot(epochs, loss, label = 'Training loss')\nax2.plot(epochs, val_loss, label = 'Validation loss')\nax2.set_title('Training & Validation Loss', fontweight='bold', fontsize=16)\nax2.legend()\n\nplt.show()","94631081":"**Healthy**","46211f36":"**Cassava Mosaic Disease (CMD)**","bc9247c4":"**Cassava Green Mottle (CGM)**","5cf7a9b6":"## Exploratory Data Analysis","d214009a":"**Cassava Bacterial Blight (CBB)**","b10974b9":"**Cassava Brown Streak Disease (CBSD)**","aaf05f71":"## Modelling","2a6a556a":"There are:\n\n- <b>13158<\/b> leaf images having Cassava Mosaic Disease (CMD)\n- <b>2577<\/b> healthy leaf images \n- <b>2386<\/b> leaf images having Cassava Green Mottle (CGM)\n- <b>2189<\/b> leaf images having Cassava Brown Streak Disease (CBSD)\n- <b>1087<\/b> leaf images having Cassava Bacterial Blight (CBB)","f84fe7ec":"# Cassava Leaf Disease Classification"}}