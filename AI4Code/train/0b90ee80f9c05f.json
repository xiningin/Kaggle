{"cell_type":{"1151f42c":"code","453d11c8":"code","df821a59":"code","90c9db4d":"code","d4757e97":"code","bbea7e7d":"code","e64b050e":"code","78729830":"code","dbac789f":"code","8df0b8c0":"code","29c73c06":"code","b1fb1b60":"code","69156c62":"code","7bfe94d6":"code","e3fca86e":"code","4149c191":"code","996d808d":"code","f29bf3af":"code","a01d068f":"code","53a65a67":"code","bf5f1321":"code","c94f8009":"code","960afb91":"code","cd5b3011":"code","e6d351d1":"code","6873ed38":"code","56fa44d7":"code","f3af89cd":"code","6908341d":"code","8945e6e1":"code","9aadaf28":"code","ab685b47":"code","fcd62421":"code","91248434":"code","0f987917":"code","bec4cec8":"code","6d27938f":"code","0a4678d0":"code","24d1a4f3":"code","a6a92443":"code","0e228a08":"code","d9537707":"code","1428f864":"code","89c5e6a8":"code","299d021d":"code","cd29c55a":"code","17d2ef53":"code","e6e1a94b":"code","5e0db579":"code","1bc9ca0a":"code","27759f17":"code","caa3bf5c":"code","b273f397":"code","2197e80d":"code","53a7a51b":"code","b8410756":"code","5ffc339f":"code","db66adea":"code","55544b59":"code","f4c5a2a5":"code","a585a166":"code","5cd063b1":"code","0c11c981":"code","e139241e":"code","6fd4bd49":"code","1b0d8bc3":"code","afae4bcf":"code","a28c9007":"code","de79568b":"code","0e723962":"code","b52a9ff2":"code","ee8a52ce":"code","3b866234":"code","b55b027b":"code","77dd15dd":"code","8bfe3a95":"code","7eec64a2":"code","13b58132":"code","9523d671":"code","726670ae":"code","aa9f4488":"code","74bb1839":"code","cf0347df":"code","7c2f7387":"code","9268dcd4":"code","cb743109":"code","466fcff4":"code","e106e24d":"code","bb15c7e3":"code","c61c5edd":"code","89d3f1ef":"code","40c570d6":"code","cbfbc805":"code","b973ba17":"code","9ee819fa":"code","a2a80c97":"code","e2efbe58":"code","29f36762":"code","9eedf4a9":"code","13c99f9f":"code","64a82355":"code","144249e3":"markdown"},"source":{"1151f42c":"import pandas as pd\npd.set_option('display.max_columns', None)\npromo=pd.read_csv('..\/input\/promo-abuse-detection-for-payment-apps\/Promo_Abuse_Detection_Dataset.csv')\npromo.head()","453d11c8":"promo.nunique().sort_values(ascending=False)","df821a59":"promo['UserId'].value_counts().sort_values(ascending=False)[:1] #abuse detected","90c9db4d":"promo[promo['UserId']==13341428].head()","d4757e97":"promo.loc[promo['Unnamed: 0'] == 16, \"Target\"] = 0\npromo.loc[promo['Unnamed: 0'] == 17, \"Target\"] = 1\npromo[promo['UserId']==13341428].head()","bbea7e7d":"promo['Device Id'].value_counts().sort_values(ascending=False)[:1]#abuse detected","e64b050e":"fix=promo[promo['Device Id']=='iosvd:++djsadjscior34728128MSASCDMVERww38rmbe8=:2537']\nfix.head()","78729830":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","dbac789f":"promo.loc[promo['Unnamed: 0'] == 950, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Device Id']=='iosvd:++djsadjscior34728128MSASCDMVERww38rmbe8=:2537']","8df0b8c0":"promo['Ref PC AC Number'].value_counts().sort_values(ascending=False)[:6]#abuse detected","29c73c06":"fix=promo[promo['Ref PC AC Number']=='IN312XXXXX1298']\nfix.head()","b1fb1b60":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","69156c62":"promo.loc[promo['Unnamed: 0'] == 656, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN312XXXXX1298']","7bfe94d6":"fix=promo[promo['Ref PC AC Number']=='IN312XXXXX1299']\nfix.head()","e3fca86e":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","4149c191":"promo.loc[promo['Unnamed: 0'] == 666, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN312XXXXX1299']","996d808d":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1188']\nfix.head()","f29bf3af":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","a01d068f":"promo.loc[promo['Unnamed: 0'] == 19, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1188']","53a65a67":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1190']\nfix.head()","bf5f1321":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","c94f8009":"promo.loc[promo['Unnamed: 0'] == 678, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1190']","960afb91":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1186']\nfix.head()","cd5b3011":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","e6d351d1":"promo.loc[promo['Unnamed: 0'] == 18, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1186']","6873ed38":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1185']\nfix.head()","56fa44d7":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","f3af89cd":"promo.loc[promo['Unnamed: 0'] == 658, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1185']","6908341d":"promo['Name']=promo['FirstName']+' '+promo['LastName']\npromo.nunique().sort_values(ascending=False)","8945e6e1":"promo=promo.drop(['FirstName','LastName'],axis=1)\npromo.head()","9aadaf28":"promo['Name'].value_counts().sort_values(ascending=False)[:6]#abuse detected","ab685b47":"fix=promo[promo['Name']=='amit kumar']\nfix.head()","fcd62421":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","91248434":"promo.loc[promo['Unnamed: 0'] == 595, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='amit kumar']","0f987917":"fix=promo[promo['Name']=='akash gupta']\nfix.head()","bec4cec8":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","6d27938f":"promo.loc[promo['Unnamed: 0'] == 822, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='akash gupta']","0a4678d0":"fix=promo[promo['Name']=='rohit kumar']\nfix.head()","24d1a4f3":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","a6a92443":"promo.loc[promo['Unnamed: 0'] == 886, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='rohit kumar']","0e228a08":"fix=promo[promo['Name']=='raman ralhan']\nfix.head()","d9537707":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","1428f864":"promo.loc[promo['Unnamed: 0'] == 456, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='raman ralhan']","89c5e6a8":"fix=promo[promo['Name']=='sunil kumar']\nfix.head()","299d021d":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","cd29c55a":"promo.loc[promo['Unnamed: 0'] == 490, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='sunil kumar']","17d2ef53":"round(promo.Name.isnull().sum()*100\/len(promo),2)","e6e1a94b":"promo[['Name']]=promo[['Name']].fillna('Unknown')\nfix=promo[promo['Name']=='Unknown']#abuse detected as posssibility of hacker expected.\nfix.head()","5e0db579":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)\nlen(i)","1bc9ca0a":"for j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo.head()","27759f17":"round(promo.Target.isnull().sum()*100\/len(promo),2)","caa3bf5c":"promo.Target=promo.Target.fillna(0)\nround(promo.Target.value_counts()*100\/len(promo),2)","b273f397":"promo[['Sim_OS','Sim_Info','Sim_User']] = promo['Sim Id'].str.split(':',expand=True)\npromo.head()","2197e80d":"promo[['Device_OS','Device_Info','Device_User']] = promo['Device Id'].str.split(':',expand=True)\npromo.head()","53a7a51b":"promo=promo.drop(['Device Id','Sim Id'],axis=1)\npromo.head()","b8410756":"promo[['LastLoginTime','PresentLoginTime']].info()","5ffc339f":"promo['LastLoginTime']=promo['LastLoginTime'].replace('01-01-1900 00:00','00:00:00')\npromo['LastLoginTime'].unique()","db66adea":"promo[['LastLoginTime_HH','LastLoginTime_MM','LastLoginTime_SS']] = promo['LastLoginTime'].str.split(':',expand=True)\npromo.head()","55544b59":"promo[['PresentLoginTime_HH','PresentLoginTime_MM','PresentLoginTime_SS']] = promo['PresentLoginTime'].str.split(':',expand=True)\npromo.head()","f4c5a2a5":"promo=promo.drop(['LastLoginTime','PresentLoginTime'],axis=1)\npromo.head()","a585a166":"promo[['Meta Data_1','Meta Data_2','Meta Data_3','Meta Data_4']] =promo['Meta Data'].str.split('-',expand=True)\npromo.head()","5cd063b1":"promo[['Email_user','Email_Domain']] =promo['Email'].str.split('@',expand=True)\npromo.head()","0c11c981":"promo=promo.drop(['Email','Meta Data'],axis=1)\npromo.head()","e139241e":"promo[['Reg Client IP_1','Reg Client IP_2','Reg Client IP_3','Reg Client IP_4']] =promo['Reg Client IP'].str.split('.',expand=True)\npromo.head()","6fd4bd49":"promo=promo.drop(['Unnamed: 0','Reg Client IP'],axis=1)\npromo.head()","1b0d8bc3":"promo.nunique().sort_values(ascending=False)","afae4bcf":"promo=promo.drop(['ProgramId','ProgramName','Meta Data_1','Meta Data_3','Status','Email_Domain','BadTryCount'],axis=1)\npromo.head()","a28c9007":"promo['Reg Referral Code']=promo['Reg Referral Code'].str.strip().str[-3:]\npromo['Reg Referral Code'].head()","de79568b":"promo['RegisteredOn']=pd.to_datetime(promo['RegisteredOn'])\npromo['Dob']=pd.to_datetime(promo['Dob'])\npromo.head()","0e723962":"promo.info()","b52a9ff2":"promo[['UserId','Mobile','PostalCode']]=promo[['UserId','Mobile','PostalCode']].astype(object)\npromo.info()","ee8a52ce":"promo.nunique().sort_values(ascending=False)","3b866234":"promo.columns","b55b027b":"promo.info()","77dd15dd":"(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","8bfe3a95":"promo[['Reg Referral Code','Reg Referral Prefix']]=promo[['Reg Referral Code',\n                                                                 'Reg Referral Prefix']].fillna('Unknown')\n(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","7eec64a2":"promo.Gender.value_counts()","13b58132":"promo['Gender']=promo['Gender'].fillna('U')\n(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","9523d671":"promo.nunique().sort_values(ascending=False)","726670ae":"promo.Name.value_counts()[:5]","aa9f4488":"!pip install pycaret","74bb1839":"promo.nunique().sort_values(ascending=False)*100\/len(promo)","cf0347df":"promo.columns\n","7c2f7387":"promo.info()","9268dcd4":"promo.nunique().sort_values(ascending=False)","cb743109":"!pip install pandas-profiling","466fcff4":"from pandas_profiling import ProfileReport\nProfileReport(promo, title=\"EDA Report\")","e106e24d":"data = promo.sample(frac=0.8, random_state=42)\ndata_unseen = promo.drop(data.index)\ndata.reset_index(inplace=True, drop=True)\ndata_unseen.reset_index(inplace=True, drop=True)\nprint('Data for Modeling: ' + str(data.shape))","bb15c7e3":"print('Unseen Data For Predictions: ' + str(data_unseen.shape))","c61c5edd":"from pycaret.classification import *\npromo= setup(data =data, session_id=42,\n             target = 'Target',\n                  normalize = True, \n                  transformation = True, \n                  log_experiment = True,\n                  remove_multicollinearity = True, #rop one of the two features that are highly correlated with each other\n                  date_features=['RegisteredOn','Dob'],\n            categorical_features=[ 'Gender', 'UserId', 'Mobile', 'PostalCode',\n       'OS Type', 'Reg Referral Code', 'Reg Referral Prefix',\n       'Ref PC AC Number', 'Name', 'Sim_OS', 'Sim_Info', 'Sim_User',\n       'Device_OS', 'Device_Info', 'Device_User', 'LastLoginTime_HH',\n       'LastLoginTime_MM', 'LastLoginTime_SS', 'PresentLoginTime_HH',\n       'PresentLoginTime_MM', 'PresentLoginTime_SS', 'Meta Data_2',\n       'Meta Data_4', 'Email_user', 'Reg Client IP_1', 'Reg Client IP_2',\n       'Reg Client IP_3', 'Reg Client IP_4'],\n            high_cardinality_features =[ 'UserId', 'Mobile', 'PostalCode',\n       'OS Type', 'Reg Referral Code',\n       'Ref PC AC Number', 'Name', 'Sim_User',\n        'Device_User', 'LastLoginTime_HH',\n       'LastLoginTime_MM', 'LastLoginTime_SS', 'PresentLoginTime_HH',\n       'PresentLoginTime_MM', 'PresentLoginTime_SS',\n       'Meta Data_4', 'Email_user', 'Reg Client IP_1', 'Reg Client IP_2',\n       'Reg Client IP_3', 'Reg Client IP_4']  ,         \n            train_size = 0.8)","89d3f1ef":"lr = create_model('lr')","40c570d6":"print(lr)","cbfbc805":"tuned_lr = tune_model(lr,optimize = 'Kappa')","b973ba17":"plot_model(tuned_lr, plot = 'auc')","9ee819fa":"plot_model(tuned_lr, plot = 'pr')","a2a80c97":"plot_model(tuned_lr, plot='feature')","e2efbe58":"plot_model(tuned_lr, plot = 'confusion_matrix')","29f36762":"evaluate_model(tuned_lr)","9eedf4a9":"predict_model(tuned_lr)","13c99f9f":"unseen_predictions = predict_model(tuned_lr, data=data_unseen)\nunseen_predictions.head()","64a82355":"print(\"Confidence Score :   {}\".format(round(unseen_predictions.Score.mean(),2)))#Confidence Score","144249e3":"There are few considerations , we are working with.\n- A device can be use once\n- Cashback to same account more than once is an abuse\n- Name with same email ID is an abuse"}}