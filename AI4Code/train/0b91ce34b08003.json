{"cell_type":{"99710ffc":"code","4402253f":"code","e55a8cde":"code","d5438b73":"code","d2af1b3b":"code","edebea21":"code","dda85ee2":"code","7c433352":"code","d66cc05e":"code","94460cc7":"code","41efd2c2":"code","c9980446":"code","6d8e607a":"markdown","26aa42ba":"markdown","6a73cc78":"markdown","95849f09":"markdown","e291c3cf":"markdown","8d0ce570":"markdown"},"source":{"99710ffc":"from geopy.geocoders import Nominatim\ngeolocator = Nominatim(user_agent=\"Finn Teste\")","4402253f":"pip install geopandas","e55a8cde":"import pandas as pd\nfrom google.colab import drive\nimport warnings\nwarnings.filterwarnings(\"ignore\")\nimport geopandas\n","d5438b73":"drive.mount('\/content\/drive')","d2af1b3b":"df = geopandas.read_file('\/content\/drive\/My Drive\/Favelas Layers\/Coordenadas das favelas.geojson')","edebea21":"print(df)\ndf=pd.DataFrame(df)","dda85ee2":"l=len(df)\nc=0\nFaveladataset=pd.DataFrame()\nfor x in range(l):\n    linha=df.loc[x:x]\n    favelasname=linha[\"NOMESEC\"].values[0]\n    favelasname2=linha[\"NOME\"].values[0]\n    Reponsabilidade=linha[\"PROPRTR\"].values[0]\n    tamanho=linha[\"AREA_m\u00b2\"].values[0]\n    dataatual=linha[\"DATULTATZ\"].values[0]\n    if favelasname is None:\n        c=c+1\n        favelasname=f'Favela sem nome na secrataria de habitacao, Comunidade N\u00ba {c}'\n    if Reponsabilidade is None:\n           Reponsabilidade=\"Sem Informa\u00e7\u00e3o\"\n    if tamanho is None:\n           tamanho=\"Sem Informa\u00e7\u00e3o\"\n    if dataatual is None:\n           dataatual=\"Sem Informa\u00e7\u00e3o\"\n\n    geometry=linha[\"geometry\"].values[0]\n    for ea in geometry:\n        Y= list(ea.exterior.coords.xy[0])\n        X=list(ea.exterior.coords.xy[1])\n        DFFF=pd.DataFrame({\"Nome Popular da Favela\":favelasname2,\"Nome da Favela na Secretaria de Habitacao\":favelasname,\"Orgao responsavel\":Reponsabilidade,\"Data da ultima atualizacao da Secretaria da habitacao\":dataatual,\"Area da Favela (M\u00b2)\":tamanho,\"X\":Y,\"Y\":X})\n        DFFF[\"ID\"] = DFFF[[\"Nome Popular da Favela\", \"X\",\"Y\"]].sum(axis=1).map(hash).abs()\n        cols = DFFF.columns.tolist()\n        cols = cols[-1:] + cols[:-1]\n        DFFF=DFFF[cols]\n        Faveladataset=pd.concat([DFFF,Faveladataset])\n        Faveladataset=Faveladataset.reset_index(drop=True)\n        \n\n    print(Faveladataset)\n","7c433352":"df22= geopandas.read_file('\/content\/drive\/My Drive\/Favelas Layers\/bairros.geojson')\nprint(df22)\ndf22=pd.DataFrame(df22)","d66cc05e":"l=len(df22)\nc=0\nbairros=pd.DataFrame()\nfor x in range(l):\n    linha=df22.loc[x:x]\n    bairrosname=linha[\"NOME_DIST\"].values[0]\n    Sigla=linha[\"SIGLA_DIST\"].values[0]\n    codigodistrito=linha[\"COD_DIST\"].values[0]\n    codigosubdistrito=linha[\"COD_SUB\"].values[0]\n\n    geometry=linha[\"geometry\"].values[0]\n    for ea in geometry:\n        Y= list(ea.exterior.coords.xy[0])\n        X=list(ea.exterior.coords.xy[1])\n        DFFF2=pd.DataFrame({\"Bairros\":bairrosname,\"Sigla do bairro\":Sigla,\"Codigo do Distrito\":codigodistrito,\"Codigo do Subdistrito\":codigosubdistrito,\"X\":Y,\"Y\":X})\n        DFFF2[\"ID\"] = DFFF2[[\"Bairros\", \"X\",\"Y\"]].sum(axis=1).map(hash).abs()\n        cols = DFFF2.columns.tolist()\n        cols = cols[-1:] + cols[:-1]\n        DFFF2=DFFF2[cols]\n        bairros=pd.concat([DFFF2,bairros])\n        bairros=bairros.reset_index(drop=True)\n        \n    print(bairros)","94460cc7":"bairros[\"X Max\"]=bairros[\"X\"]\nbairros[\"X Min\"]=bairros[\"X\"]\nbairros[\"Y Max\"]=bairros[\"Y\"]\nbairros[\"Y Min\"]=bairros[\"Y\"]\nXXX=bairros.groupby(by=[\"Bairros\",\"Sigla do bairro\"], as_index=False).agg({\"X Max\":\"max\",\"X Min\":\"min\",\"Y Max\":\"max\",\"Y Min\":\"min\"})\n\nprint(XXX)","41efd2c2":"Faveladataset[\"Bairro\"]=\"\"\nFaveladataset[\"Sigla do Distrito\"]=\"\"\nFaveladataset[\"Distrito\"]=\"\"\nFaveladataset[\"Endere\u00e7o\"]=\"\"\nFaveladataset[\"Regi\u00e3o\"]=\"\"\nFaveladataset[\"Cidade\"]=\"\"\nFaveladataset[\"CEP\"]=\"\"\n\n\nFaveladatasetFinal=pd.DataFrame()\nfor x in range(len(Faveladataset)):\n    try:\n        linha=Faveladataset.loc[x:x]\n        #print(linha)\n        X=linha[\"X\"].values[0]\n        Y=linha[\"Y\"].values[0]\n        location = geolocator.reverse(f\"{Y},{X}\",addressdetails=True)\n        ADD=location.raw\n        #ADD=ADD.split(\",\")\n        \n        \"Pesquisar o bairro\"\n        Distrito=XXX[(XXX[\"X Min\"]<=X) & (XXX[\"X Max\"]>=X) & (XXX[\"Y Min\"]<=Y) & (XXX[\"Y Max\"]>=Y)]\n        Sigla=Distrito[\"Sigla do bairro\"].values[0]\n        Distrito=Distrito[\"Bairros\"].values[0]\n        endere\u00e7o=ADD.get(\"address\")\n        bairro=endere\u00e7o.get(\"suburb\")\n        city=endere\u00e7o.get(\"city\")\n        municipio=endere\u00e7o.get('county')\n        state=endere\u00e7o.get(\"state\")\n        CEP=endere\u00e7o.get(\"postcode\")\n        endere\u00e7o=endere\u00e7o.get(\"highway\")\n\n        if endere\u00e7o is None:\n            endere\u00e7o=ADD.get(\"address\")\n            endere\u00e7o=endere\u00e7o.get(\"road\")\n\n        \n        #print(state)\n        #print(CEP)\n\n        linha[\"Bairro\"]=bairro\n        linha[\"Sigla do Distrito\"]=Sigla\n        linha[\"Endere\u00e7o\"]=endere\u00e7o\n        linha[\"Distrito\"]=Distrito\n        linha[\"Regi\u00e3o\"]=municipio\n        linha[\"Cidade\"]=city\n        linha[\"CEP\"]=CEP\n        FaveladatasetFinal=pd.concat([FaveladatasetFinal,linha])\n        FaveladatasetFinal=FaveladatasetFinal.reset_index(drop=True)\n    except:\n        print(\"Deu erro\")","c9980446":"FaveladatasetFinal.to_csv(\"\/content\/drive\/My Drive\/Favelas Layers\/Favelas de Sao Paulo.csv\",sep=\";\",index=False, encoding='utf-8', mode=\"w\", decimal=',')\nbairros.to_csv(\"\/content\/drive\/My Drive\/Favelas Layers\/Bairros de Sao Paulo.csv\",sep=\";\",index=False, encoding='utf-8', mode=\"w\", decimal=',')\n\n\n","6d8e607a":"## Dataset final\n\nBem ap\u00f3s ter tratado os arquivos GEOJSON, eu verifiquei coordenada por coordenada para saber o distrito, e fiz a pesquisa de das coordenadas com a biblioteca geopy para saber o endere\u00e7o, cidade e CEP.\n\nEssa foi a parte mais demorada....","26aa42ba":"### Importa\u00e7\u00f5es\n\n-Importar as bibliotecas de geoprocessamento;\n-Importar as bibliotecas de analise de dados.","6a73cc78":"## Importa\u00e7\u00e3o do arquivo GEOJSON dos bairros.","95849f09":"## Importar o arquivo de GEOJSON convertido no QGIS com a biblioteca geopandas.","e291c3cf":"## Login com o google drive\n\n Esse notebook estava rodando no google colab, e a minha pasta de arquivos estava no google drive.","8d0ce570":"E ap\u00f3s isso eu salvei os datasets..."}}