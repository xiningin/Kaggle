{"cell_type":{"2ad3edca":"code","48bc7846":"code","36530ca1":"code","c53a3d44":"code","cecde180":"code","9e5e6ab9":"code","7c88d25c":"code","e1b7a956":"code","20dd320b":"code","a8f8fca8":"code","c94b86d3":"code","1d3f0b03":"code","4a15b3f3":"code","a8fefffc":"code","3553af41":"code","5f9a4418":"code","1188d471":"markdown","fa98d846":"markdown","2e5c087d":"markdown"},"source":{"2ad3edca":"import os\nimport gc\nimport cv2\nimport json\nimport wandb\nimport numpy as np\nimport pandas as pd\nfrom tqdm import tqdm\nimport matplotlib.pyplot as plt","48bc7846":"root_path = '..\/input\/imgur5k\/IMGUR5K-Handwriting-Dataset\/'\nannotation_path = f'{root_path}\/dataset_info'\nimgs_path = f'{root_path}\/images'\n\nfiles = os.listdir(imgs_path)\nlen(files)","36530ca1":"with open(f'{annotation_path}\/imgur5k_annotations.json') as f:\n    data = json.load(f)\ndata.keys()","c53a3d44":"im_w, im_h = 256, 256","cecde180":"file = np.random.choice(files)\nim = cv2.imread(f'{imgs_path}\/{file}')\nori_w, ori_h = im.shape[:-1]\nprint(ori_w, ori_h)\n\nim = cv2.resize(im, (im_w, im_h))\nplt.imshow(im);","9e5e6ab9":"def draw_bboxes(file, img, ori_dims):\n    # get annotation ids\n    ann_ids = data['index_to_ann_map'][file[:-4]]\n\n    # get annotations using annotation ids\n    annotations = []\n    for ann_id in ann_ids:\n        annotations.append(data['ann_id'][ann_id])\n\n    # get bounding boxes\n    scale_x = im_w\/ori_dims[1]\n    scale_y = im_h\/ori_dims[0]\n    bboxes = []\n    words = []\n    for annotation in annotations:\n        # Get words\n        word = annotation['word']\n        if word != '.':\n            words.append(word)\n        \n        # Get bbox\n        bbox = [float(val) for val in annotation['bounding_box'].strip('[ ]').split(', ')]\n\n        # bounding_box in xywha format, change format\n        x, y = bbox[0], bbox[1]\n        w, h = bbox[2], bbox[3]\n        x1, y1 = int(round(x-(w\/2))), int(round(y-(h\/2)))\n        x2, y2 = int(round(x+(w\/2))), int(round(y+(h\/2)))\n\n        x1, y1 = int(round(x1*scale_x)), int(round(y1*scale_y))\n        x2, y2 = int(round(x2*scale_x)), int(round(y2*scale_y))\n        \n        bboxes.append([x1, y1, x2, y2])\n\n    # create bounding boxes\n    for bbox in bboxes:\n        img = cv2.rectangle(img, (bbox[0], bbox[1]), (bbox[2], bbox[3]), (255,0,0), 2)\n    \n    return img, words","7c88d25c":"im, words = draw_bboxes(file, im, (ori_w, ori_h))\nprint(words)\nplt.imshow(im);","e1b7a956":"file = np.random.choice(files)\nim = cv2.imread(f'{imgs_path}\/{file}')\nori_w, ori_h = im.shape[:-1]\nim = cv2.resize(im, (im_w, im_h))\nim, words = draw_bboxes(file, im, (ori_w, ori_h))\nplt.imshow(im);","20dd320b":"file = np.random.choice(files)\nim = cv2.imread(f'{imgs_path}\/{file}')\nori_w, ori_h = im.shape[:-1]\nim = cv2.resize(im, (im_w, im_h))\nim, words = draw_bboxes(file, im, (ori_w, ori_h))\nplt.imshow(im);","a8f8fca8":"file = np.random.choice(files)\nim = cv2.imread(f'{imgs_path}\/{file}')\nori_w, ori_h = im.shape[:-1]\nim = cv2.resize(im, (im_w, im_h))\nim, words = draw_bboxes(file, im, (ori_w, ori_h))\nplt.imshow(im);","c94b86d3":"file = np.random.choice(files)\nim = cv2.imread(f'{imgs_path}\/{file}')\nori_w, ori_h = im.shape[:-1]\nim = cv2.resize(im, (im_w, im_h))\nim, words = draw_bboxes(file, im, (ori_w, ori_h))\nplt.imshow(im);","1d3f0b03":"file = np.random.choice(files)\nim = cv2.imread(f'{imgs_path}\/{file}')\nori_w, ori_h = im.shape[:-1]\nim = cv2.resize(im, (im_w, im_h))\nim, words = draw_bboxes(file, im, (ori_w, ori_h))\nplt.imshow(im);","4a15b3f3":"file = np.random.choice(files)\nim = cv2.imread(f'{imgs_path}\/{file}')\nori_w, ori_h = im.shape[:-1]\nim = cv2.resize(im, (im_w, im_h))\nim, words = draw_bboxes(file, im, (ori_w, ori_h))\nplt.imshow(im);","a8fefffc":"file = np.random.choice(files)\nim = cv2.imread(f'{imgs_path}\/{file}')\nori_w, ori_h = im.shape[:-1]\nim = cv2.resize(im, (im_w, im_h))\nim, words = draw_bboxes(file, im, (ori_w, ori_h))\nplt.imshow(im);","3553af41":"file = np.random.choice(files)\nim = cv2.imread(f'{imgs_path}\/{file}')\nori_w, ori_h = im.shape[:-1]\nim = cv2.resize(im, (im_w, im_h))\nim, words = draw_bboxes(file, im, (ori_w, ori_h))\nplt.imshow(im);","5f9a4418":"file = np.random.choice(files)\nim = cv2.imread(f'{imgs_path}\/{file}')\nori_w, ori_h = im.shape[:-1]\nim = cv2.resize(im, (im_w, im_h))\nim, words = draw_bboxes(file, im, (ori_w, ori_h))\nplt.imshow(im);","1188d471":"# Draw","fa98d846":"# Draw More","2e5c087d":"# Imports and Setups"}}