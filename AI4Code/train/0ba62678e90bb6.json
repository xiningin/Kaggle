{"cell_type":{"832b4dcf":"code","1ef99133":"code","b01de1f7":"code","848a8412":"code","47f2a05d":"code","f6a827d7":"code","4720bf6d":"code","b25b0f12":"code","dac80555":"code","73137bac":"code","ce318b05":"code","444554e2":"code","5b0b5c99":"markdown","4a543692":"markdown","912c3758":"markdown","2c2e4af2":"markdown"},"source":{"832b4dcf":"# Start by importing the bq_helper module and calling on the specific active_project and dataset_name for the BigQuery dataset.\nimport bq_helper\nfrom bq_helper import BigQueryHelper\n# https:\/\/www.kaggle.com\/sohier\/introduction-to-the-bq-helper-package\n\npatents = bq_helper.BigQueryHelper(active_project=\"patents-public-data\",\n                                   dataset_name=\"patents\")","1ef99133":"# View table names under the patents data table\nbq_assistant = BigQueryHelper(\"patents-public-data\", \"patents\")\nbq_assistant.list_tables()","b01de1f7":"bq_assistant.table_schema(\"publications\")","848a8412":"# View the first three rows of the publications data table\ndata_head = bq_assistant.head(\"publications_201912\", num_rows=5)","47f2a05d":"data_head[[ 'publication_number','family_id']]","f6a827d7":"# View the first three rows of the publications data table\nbq_assistant.head(\"publications_201710\", num_rows=5)","4720bf6d":"query1 = \"\"\"\nSELECT\n  country_code \n  abstract_localized\nFROM\n  `patents-public-data.patents.publications`\nLIMIT\n  20;\n        \"\"\"\n#response1 = patents.query_to_pandas_safe(query1)\n#response1.head(20)","b25b0f12":"query2 = \"\"\"\nSELECT \n  publication_number,\n  family_id,\n  title_localized,\n  abstract_localized\nFROM\n  `patents-public-data.patents.publications`\nWHERE\n  country_code = 'WO'\nLIMIT\n  20;\n        \"\"\"","dac80555":"query21 =  \"\"\"\nSELECT\n  publication_number,\n  family_id,\n  title_localized,\n  abstract_localized,\n  claims_localized,\n  citation\nFROM\n  `patents-public-data.patents.publications_201912`\nWHERE\n  country_code = 'US' AND\n  grant_date > 0;\n        \"\"\"","73137bac":"query3 = \"\"\"\nSELECT FIRST(publication_number)\nFROM\n  `patents-public-data.patents.publications_201912`;\n        \"\"\"\n#response1 = patents.query_to_pandas_safe(query3)\n#response1","ce318b05":"query4 = \"\"\"\nSELECT * FROM (\n  SELECT\n    ROW_NUMBER() OVER (ORDER BY publication_number ASC) AS rownumber\n    FROM `patents-public-data.patents.publications_201912`\n)\nWHERE rownumber IN (2,5);\n\"\"\"\nresponse4 = patents.query_to_pandas_safe(query4)\nresponse4","444554e2":"bq_assistant.estimate_query_size(query4)","5b0b5c99":"## Importance of Knowing Your Query Sizes\n\nIt is important to understand how much data is being scanned in each query due to the free 5TB per month quota. For example, if a query is formed that scans all of the data in a particular column, given how large BigQuery datasets are it wouldn't be too surprising if it burns through a large chunk of that monthly quota!\n\nFortunately, the bq_helper module gives us tools to very easily estimate the size of our queries before running a query. Start by drafting up a query using BigQuery's Standard SQL syntax. Next, call the estimate_query_size function which will return the size of the query in GB. That way you can get a sense of how much data is being scanned before actually running your query.","4a543692":"Interpretting this number, this means my query scanned about ~0.35 GB (or 350 MB) of data in order to return a table of 20 unique country codes in the dataset.","912c3758":"## Example SQL Query\nWhich countries have created patents?","2c2e4af2":"# How to Query Google Patents Public Data (BigQuery)\n[Click here](https:\/\/www.kaggle.com\/mrisdal\/safely-analyzing-github-projects-popular-licenses) for a detailed notebook demonstrating how to use the bq_helper module and best practises for interacting with BigQuery datasets."}}