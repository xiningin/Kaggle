{"cell_type":{"3fe4b19f":"code","4c471808":"code","09c484fd":"code","3bf4dbe4":"code","22349fa4":"code","0a144ec2":"code","708a84d7":"code","080ece5d":"code","29d0512b":"code","95c718d1":"code","c4d22d75":"code","0dbd0b8a":"markdown","e82533a8":"markdown","174e013e":"markdown"},"source":{"3fe4b19f":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt","4c471808":"# Use parquet format for faster loading\ntrain = pd.read_parquet('..\/input\/ubiquant-parquet\/train_low_mem.parquet')","09c484fd":"# row_id: a unique identifier for the row\n# time_id: the ID of time the data was gathered (:= the time index) - time between IDs not constant\n# investment_id: ID of investment\n# target: target\n# [f_0:f_299]: anonymised features generated from market data\n\ntrain.head()","3bf4dbe4":"# Data set info\nprint(f'Total number of observations: {train.shape[0]}')\nprint(f'Total number of investments: {train[\"investment_id\"].nunique()}')\nprint(f'Total number of timestamps: {train[\"time_id\"].nunique()}')\nprint(f'Total number of NaN values in the data set: {len(train.isna().sum()[train.isna().sum()>0])}')","22349fa4":"# Target data counts by asset\nplt.figure(figsize=(10, 6))\ntrain.groupby('investment_id')['time_id'].count().plot.hist(bins=100);\nplt.title('Distribution of number of timestamps by investment');\nplt.xlabel('Number of timestamps');","0a144ec2":"# Are there any time discontinuities within investments data?\ngrouped_timestats = train.groupby('investment_id')['time_id'].agg([('time_id', lambda x: np.min(x)), ('time_id', lambda x: np.max(x)),\n                                                                   ('time_id', lambda x: np.max(x) - np.min(x)),\n                                                                   ('time_id', lambda x: x.count()),\n                                                                   ('time_id', lambda x: (np.max(x)-np.min(x))-x.count())])\ngrouped_timestats.columns = ['start_time_id', 'end_time_id', 'nb_steps', 'nb_datapoints', 'missing_datapoints']\ngrouped_timestats.reset_index(inplace=True)\nprint(grouped_timestats.head())\nprint(f'\\n {grouped_timestats[grouped_timestats[\"missing_datapoints\"]==0].shape[0]} series have no missing data')","708a84d7":"# Amount of data by investment\nprint(train.groupby('investment_id').agg({'target': ['count', 'min', 'max', 'mean', 'std']}))","080ece5d":"# Distribution of target 1st and 2nd order moments by investment ID\nplt.figure(figsize=(10, 6))\ntar_avg = train.groupby('investment_id')['target'].mean()\ntar_avg.plot.hist(bins=100);\nplt.title('Target mean value distribution by investment');\nplt.xlabel('Target mean');\nplt.ylabel('Mean value count')\n\nprint(f'Average target mean value across investments: {np.mean(tar_avg):.4f} \\n')","29d0512b":"# Distribution of target 1st and 2nd order moments by investment ID\nplt.figure(figsize=(10, 6))\ntar_std = train.groupby('investment_id')['target'].std()\ntar_std.plot.hist(bins=100);\nplt.title('Target standard deviation distribution by investment');\nplt.xlabel('Target standard deviation');\nplt.ylabel('Standard deviation count');\n\nprint(f'Average target value standard deviation across investments: {np.mean(tar_std):.4f} \\n')","95c718d1":"# Plot target time series 1st and 2nd order moments\ntrain.groupby('time_id').agg({'target': ['mean', 'std']}).plot(figsize=(8, 3), linestyle='--');\nplt.legend(['target mean', 'target std'], loc='lower right');\nplt.xlabel('Time');\nplt.ylabel('target value');\nplt.title('Target moments (mean and standard deviation) time series');","c4d22d75":"# Select a random investment and look at its target time series\ninvestment = np.random.choice(train['investment_id'].tolist())\ninvestment_df = train[train['investment_id']==investment]\ninvestment_df.set_index('time_id',inplace=True)\n\nplt.figure(figsize=(8, 3))\ninvestment_df['target'].plot(color='r', linestyle='--');\nplt.xlabel('Time');\nplt.ylabel('target');\nplt.title(f'Target value time series for investment {investment}');","0dbd0b8a":"## Time series analysis","e82533a8":"## Target Statistical Analysis","174e013e":"## A First Look at The Data"}}