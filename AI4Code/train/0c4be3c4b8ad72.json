{"cell_type":{"189eaf0c":"code","b0ff7453":"code","05b5e522":"code","466846ff":"code","b4c3cfe3":"code","89b46651":"code","a172064b":"code","89f4471e":"code","eb1e4de7":"code","2d721256":"code","8a2c92cf":"code","bb3cc584":"code","dc63e747":"code","bfe6c022":"code","9623a552":"code","5a9282e7":"code","fe12bb11":"code","70252d84":"code","6e368647":"code","9bc9485f":"code","b8014d3d":"markdown","553b62f1":"markdown","28f2f1a2":"markdown","0436590e":"markdown","8d313e1d":"markdown","1bfe0eb8":"markdown","45cd52e6":"markdown","6a1c3c80":"markdown","a9bb92eb":"markdown","ca32bb41":"markdown","ff2b92fb":"markdown"},"source":{"189eaf0c":"\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom sklearn import linear_model ,neighbors,preprocessing,svm,tree\nfrom sklearn.neighbors import NearestNeighbors\nfrom sklearn.preprocessing import StandardScaler,LabelEncoder\nimport pandas as pd\nfrom IPython.display import display\nfrom sklearn.utils import shuffle\nfrom sklearn.model_selection import train_test_split\nimport warnings\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.neighbors import NearestNeighbors,KNeighborsClassifier\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.metrics import r2_score,accuracy_score,make_scorer\nimport seaborn as sns\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.ensemble import RandomForestClassifier,VotingClassifier,ExtraTreesClassifier,BaggingClassifier\nimport sys\nfrom xgboost import XGBRegressor\n\n\nimport vecstack\nfrom vecstack import stacking\nfrom xgboost import XGBClassifier\nfrom scipy.stats import probplot\nfrom sklearn.neighbors import NearestNeighbors\nfrom sklearn.metrics import r2_score,accuracy_score,make_scorer,log_loss,precision_score\nfrom sklearn.model_selection import GridSearchCV,KFold,cross_val_score\nfrom sklearn.svm import NuSVC,SVC\nfrom scipy import std ,mean\nfrom scipy.stats import norm\nfrom scipy import stats\nwarnings.filterwarnings('ignore')\n\n\n\npd.set_option('display.max_rows', 100)\npd.set_option('display.max_columns', 100)\n\n\n# plt.style.use('dark_background')\n\nsns.set_palette('dark')\n\n\nplt.rcParams['figure.figsize'] = [14, 7]\nsns.set_context(\"paper\", rc={\"font.size\":15,\"axes.titlesize\":22,\"axes.labelsize\":20,\"figure.suptitlesize\":25}) \n\n\ndata=pd.read_csv('..\/input\/heart-disease-uci\/heart.csv')\n\nscale=['age','chol','trestbps','thalach','oldpeak']\nf=data[scale]\nscaler=StandardScaler().fit(f.values)\nf=scaler.transform(f.values)\ndata[scale]=f\n\n\n","b0ff7453":"plt.rcParams['figure.figsize'] = [14, 7]\nsns.countplot(x=\"target\", data=data);","05b5e522":"data.target.value_counts().plot.pie(autopct='%1.1f%%',fontsize=25)","466846ff":"sns.barplot(data.sex,data.target)\nplt.xlabel('Sex:  0:Female, 1:Male');","b4c3cfe3":"sns.heatmap(data.corr())\n","89b46651":"sns.boxplot(data.slope,data.oldpeak)","a172064b":"data.corr().target.sort_values(ascending=False)","89f4471e":"from sklearn.metrics import classification_report,confusion_matrix,accuracy_score,roc_curve,auc\n\ndef model(algorithm,dtrain_x,dtrain_y,dtest_x,dtest_y,of_type):\n    print('*'*120)\n    print (\"MODEL\")\n    algorithm.fit(dtrain_x,dtrain_y)\n    predictions = algorithm.predict(dtest_x)\n    \n    print (algorithm)\n    print (\"\\naccuracy_score :\",accuracy_score(dtest_y,predictions))\n    \n    print (\"\\nclassification report :\\n\",(classification_report(dtest_y,predictions)))\n        \n    plt.figure(figsize=(15,12))\n    plt.subplot(221)\n    sns.heatmap(confusion_matrix(dtest_y,predictions),annot=True, annot_kws={\"size\": 23,'va':'top'})\n    plt.title(\"CONFUSION MATRIX\")\n    \n    predicting_probabilites = algorithm.predict_proba(dtest_x)[:,1]\n    fpr,tpr,thresholds = roc_curve(dtest_y,predicting_probabilites)\n    plt.subplot(222)\n    plt.plot(fpr,tpr,label = (\"Area_under the curve :\",auc(fpr,tpr)),color = \"r\")\n    plt.plot([1,0],[1,0],linestyle = \"dashed\",color =\"k\")\n    plt.legend(loc = \"best\")\n    plt.title(\"ROC - CURVE & AREA UNDER CURVE\")\n    \n    if  of_type == \"feat\":\n        \n        dataframe = pd.DataFrame(algorithm.feature_importances_,dtrain_x.columns).reset_index()\n        dataframe = dataframe.rename(columns={\"index\":\"features\",0:\"coefficients\"})\n        dataframe = dataframe.sort_values(by=\"coefficients\",ascending = False)\n        plt.subplot(223)\n        ax = sns.barplot(x = \"coefficients\" ,y =\"features\",data=dataframe,palette=\"husl\")\n        plt.title(\"FEATURE IMPORTANCES\",fontsize =17)\n        for i,j in enumerate(dataframe[\"coefficients\"]):\n            ax.text(.011,i,j,weight = \"bold\")\n    \n    elif of_type == \"coef\" :\n        \n        dataframe = pd.DataFrame(algorithm.coef_.ravel(),dtrain_x.columns).reset_index()\n        dataframe = dataframe.rename(columns={\"index\":\"features\",0:\"coefficients\"})\n        dataframe = dataframe.sort_values(by=\"coefficients\",ascending = False)\n        plt.subplot(223)\n        ax = sns.barplot(x = \"coefficients\" ,y =\"features\",data=dataframe,palette=\"husl\")\n        plt.title(\"FEATURE IMPORTANCES\",fontsize =20)\n        for i,j in enumerate(dataframe[\"coefficients\"]):\n            ax.text(.011,i,j,weight = \"bold\")\n            \n    elif of_type == \"none\" :\n        return (algorithm)\n","eb1e4de7":"x=data.drop('target',1)\ny=data['target']\nx,y=shuffle(x,y)\nxtr,xtest,ytr,ytest=train_test_split(x,y, test_size=0.2)\n\nmodel(LogisticRegression(),xtr,ytr,xtest,ytest,'coef')\n","2d721256":"\nmodel(XGBClassifier(),xtr,ytr,xtest,ytest,'feat')\n","8a2c92cf":"from sklearn.tree import DecisionTreeClassifier\ndec_tree=DecisionTreeClassifier()\ncross_val_score(dec_tree,x,y, cv=4)","bb3cc584":"fig,axes=plt.subplots(1,3,figsize=(20,11))\n\nsns.barplot(data.slope,data.target,ax=axes[0])\nsns.boxplot(data.target,data.oldpeak,ax=axes[1])\nsns.boxplot(data.target,data.chol,ax=axes[2])","dc63e747":"fig,axes=plt.subplots(1,2,figsize=(15,8))\nsns.boxplot(data.target,data.trestbps,ax=axes[0])\nsns.boxplot(data.target,data.thalach,ax=axes[1])","bfe6c022":"fig,axes=plt.subplots(1,4,figsize=(23,12))\n\nsns.barplot(data.fbs,data.target,ax=axes[0])\nsns.barplot(data.thal,data.target,ax=axes[1])\nsns.barplot(data.cp,data.target,ax=axes[2])\nsns.barplot(data.ca,data.target,ax=axes[3])","9623a552":"data.drop(data[(data.target==1) & (data.oldpeak>1)].index,axis=0,inplace=True)\ndata.drop(data[(data.target==1) & (data.chol>2)].index,axis=0,inplace=True)\ndata.drop(data[(data.target==1) & (data.thalach<-1.5)].index,axis=0,inplace=True)","5a9282e7":"data=pd.get_dummies(data, columns=['cp','restecg','slope','thal'],drop_first=True)","fe12bb11":"x=data.drop('target',1)\ny=data.target\nx,y=shuffle(x,y)\nxtr,xtest,ytr,ytest=train_test_split(x,y, test_size=0.2)\nmodel(LogisticRegression(),xtr,ytr,xtest,ytest,'coef')","70252d84":"\nrf=RandomForestClassifier()\nreg=LogisticRegression()\nk=KNeighborsClassifier()\nxg=XGBClassifier(max_depth=3,learning_rate=0.1)\nsvc=SVC()\nmodel=[rf,reg,k,xg,dec_tree,svc]\nvoting=VotingClassifier([('rf',model[0]),('reg',model[1]),('k',model[2]),('xg',model[3]),('dec_tree',model[4]),('svc',model[5])],weights=[1,2,1,1,1,1])\n\n","6e368647":"\n\nStr,Ste=stacking(model,xtr,ytr,xtest,regression=False,metric=accuracy_score,shuffle=True,verbose=0,stratified=True)\nprint(\n    \n     'LogisticRegression:',cross_val_score(LogisticRegression(),x,y,cv=5).mean(),\n     \n     '\\n DecisionTreeClassifier:' ,cross_val_score(DecisionTreeClassifier(),x,y, cv=5).mean(),\n      \n      \n      '\\n XGB:',cross_val_score(xg,x,y, cv=5).mean(),\n      \n      \n      '\\n KNeighbors:',cross_val_score(KNeighborsClassifier(n_neighbors=6),x,y, cv=5).mean(),\n      \n      \n      \n      '\\n RandomForest:',cross_val_score(RandomForestClassifier(),x,y, cv=5).mean(),\n      \n      \n      \n      '\\n SVC:',cross_val_score(SVC(),x,y, cv=5).mean(),\n      \n      \n      '\\n Voting:',cross_val_score(voting,x,y, cv=5).mean(),\n      \n      \n      \n      '\\n Stacked w SVC ',cross_val_score(SVC(),Str,ytr,cv=4).mean(),\n      \n      \n      \n       '\\n Stacked w Logistic:', cross_val_score(LogisticRegression(),Str,ytr,cv=4).mean(),\n      \n      \n      \n      '\\n Stacked w voting ',cross_val_score(voting,Str,ytr,cv=4).mean()\n      \n    \n    )\n      \n      \n    \n","9bc9485f":"li=[]\nfor i in range(1,25):\n    k = KNeighborsClassifier(n_neighbors = i) \n    li.append(cross_val_score(k,x,y,cv=5).mean())\n    \nplt.plot(range(1,25),li)\n\nplt.xlabel(\"K\")\n\nplt.ylabel(\"acc\")\n\nacc=max(li)*100\nbest_k=li.index(max(li))+1\nprint(f\"Best acc :{acc}\",best_k)","b8014d3d":" # MODELS (before data tranformation)","553b62f1":"# PREPARING DATA","28f2f1a2":"1)some outliers in oldpeak at target 1 , 2)and chol target 1 \n","0436590e":"we see why these features are important!","8d313e1d":"# TESTING AT NEW DATA","1bfe0eb8":"3)outliers at thalach target 1","45cd52e6":"thal,cp are the most important","6a1c3c80":"# FINDING BEST VALUE OF K IN KNN\n","a9bb92eb":"Females have higher ratio,while males have less than 50%\n","ca32bb41":"# DATA DESCRIPTION\n","ff2b92fb":"age: The person's age in years\n\nsex: (1 = male, 0 = female)\n\ncp: The chest pain experienced (Value 1: typical angina, Value 2: atypical angina, Value 3: non-anginal pain, Value 4: asymptomatic)\n\ntrestbps: The person's resting blood pressure (mm Hg on admission to the hospital)\n\nchol: The person's cholesterol measurement in mg\/dl\n\nfbs: The person's fasting blood sugar (> 120 mg\/dl, 1 = true; 0 = false)\n\nrestecg: Resting electrocardiographic measurement (0 = normal, 1 = having ST-T wave abnormality, 2 = showing \n\nprobable or definite left ventricular hypertrophy by Estes' criteria)\n\nthalach: The person's maximum heart rate achieved\n\nexang: Exercise induced angina (1 = yes; 0 = no)\n\noldpeak: ST depression induced by exercise relative to rest ('ST' relates to positions on the ECG plot.)\n\nslope: the slope of the peak exercise ST segment (Value 1: upsloping, Value 2: flat, Value 3: downsloping)\n\nca: The number of major vessels (0-3)\n\nthal: A blood disorder called thalassemia (3 = normal; 6 = fixed defect; 7 = reversable defect)\n\ntarget: Heart disease (0 = no, 1 = yes)"}}