{"cell_type":{"03d3e23e":"code","1a7ece2d":"code","d9f1654e":"code","aa47dfa5":"code","4c9c979a":"code","769211e4":"code","071658de":"code","619ced98":"code","27a5ab25":"code","aeaf48f7":"code","e3ad7509":"code","4a18f66c":"code","aaec139a":"code","0ee781ab":"code","f8b16f7d":"code","4440cabd":"code","eea55aca":"code","87e4b795":"code","a9f254a8":"code","fc86102b":"code","0241cef3":"code","1c0a4b88":"code","faecae74":"code","bad2a863":"code","a4110ca3":"code","59e2d44c":"code","2b308f7f":"code","e61d2a2e":"code","ab2e09d5":"code","ef8e7d3b":"code","703ddd54":"code","4ab4bb6c":"code","3b50f460":"markdown","f4cfb105":"markdown","5ded08a2":"markdown","36ce3593":"markdown","73b59592":"markdown","7873e1a3":"markdown","d12f758f":"markdown","e993e811":"markdown","32a95045":"markdown","603b1900":"markdown"},"source":{"03d3e23e":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","1a7ece2d":"os.chdir(\"\/kaggle\/input\/seattle\/\")\nlisting = pd.read_csv(\"listings.csv\")\ncalendar = pd.read_csv(\"calendar.csv\")","d9f1654e":"listing.head()","aa47dfa5":"calendar.head()","4c9c979a":"listing.info()","769211e4":"listing_col = ['id', 'host_id', 'host_since', 'host_response_time', 'host_response_rate',\n               'host_acceptance_rate', 'host_is_superhost', 'host_neighbourhood', \n               'host_listings_count', 'host_total_listings_count', 'host_has_profile_pic', \n               'host_identity_verified', 'neighbourhood_group_cleansed', 'latitude', \n               'longitude', 'property_type', 'room_type', 'accommodates', 'bathrooms', \n               'beds', 'bed_type', 'amenities', 'square_feet', 'guests_included', \n               'extra_people', 'minimum_nights', 'maximum_nights', 'calendar_updated',\n               'has_availability', 'number_of_reviews', 'first_review', 'last_review', \n               'review_scores_rating', 'review_scores_accuracy', 'review_scores_cleanliness', \n               'review_scores_checkin', 'review_scores_checkin', 'review_scores_communication', \n               'review_scores_location', 'review_scores_value', 'instant_bookable', \n               'cancellation_policy', 'require_guest_profile_picture', \n               'require_guest_phone_verification', 'calculated_host_listings_count', \n               'reviews_per_month',\n               'price']\nlisting = listing[listing_col]","071658de":"datetime_cols = ['host_since', 'first_review', 'last_review']\nnumeric_cols = ['host_response_rate', 'host_acceptance_rate', 'host_listings_count', \n                'host_total_listings_count', 'latitude', 'longitude', \n                'accommodates', 'bathrooms', 'beds', 'square_feet', 'guests_included', \n                'extra_people', 'minimum_nights', 'maximum_nights', 'number_of_reviews', \n                'review_scores_rating', 'review_scores_accuracy', 'review_scores_cleanliness', \n                'review_scores_checkin', 'review_scores_checkin', 'review_scores_communication', \n                'review_scores_location', 'review_scores_value', 'calculated_host_listings_count', \n                'reviews_per_month', 'price']\n\nnominal_cols = ['host_is_superhost', 'host_has_profile_pic', \n                'host_identity_verified', 'neighbourhood_group_cleansed', \n                'has_availability', 'instant_bookable', 'require_guest_profile_picture', \n                'require_guest_phone_verification']\n\nordinal_cols = ['host_response_time', 'property_type', 'room_type', 'bed_type', \n                'calendar_updated', 'cancellation_policy']\n\nother_cols = ['amenities']","619ced98":"listing['host_since'] = pd.to_datetime(listing['host_since'])\nlisting['first_review'] = pd.to_datetime(listing['first_review'])\nlisting['last_review'] = pd.to_datetime(listing['last_review'])\nlisting[datetime_cols].dtypes","27a5ab25":"# extract # of days since being host\/reviewed as possible features\nlisting['num_days_as_host'] = (pd.Timestamp.today() - listing['host_since']).dt.days\nlisting['num_days_first_review'] = (pd.Timestamp.today() - listing['first_review']).dt.days\nlisting['num_days_last_review'] = (pd.Timestamp.today() - listing['last_review']).dt.days","aeaf48f7":"listing[numeric_cols].select_dtypes('object')","e3ad7509":"listing.host_response_rate = listing.host_response_rate.str.strip(\"%\")\nlisting.host_acceptance_rate = listing.host_acceptance_rate.str.strip(\"%\")\nlisting.extra_people = listing.extra_people.str.strip(\"$\").str.replace(\",\", \"\")\nlisting.price = listing.price.str.strip(\"$\").str.replace(\",\", \"\")\nlisting[listing[numeric_cols].select_dtypes('object').columns] = listing[listing[numeric_cols].select_dtypes('object').columns].astype(np.float64)","4a18f66c":"boolean_cols = list(set(nominal_cols).difference(['neighbourhood_group_cleansed']))\nlisting[boolean_cols] = listing[boolean_cols].replace(\"f\", 0).replace(\"t\", 1)","aaec139a":"listing[ordinal_cols]","0ee781ab":"cats = ['within an hour', 'within a few hours', \n        'within a day', 'a few days or more']\nfor i in range(len(cats)):\n    listing['host_response_time'] = listing['host_response_time'].replace(cats[i], i)","f8b16f7d":"print(listing['room_type'].unique())\nprint(listing['bed_type'].unique())\nprint(listing['calendar_updated'].unique())\nprint(listing['cancellation_policy'].unique())","4440cabd":"cats = ['Shared room', 'Private room', 'Entire home\/apt']\nfor i in range(len(cats)):\n    listing['room_type'] = listing['room_type'].replace(cats[i], i)\n\ncats = ['Couch', 'Futon', 'Pull-out Sofa', 'Airbed', 'Real Bed']\nfor i in range(len(cats)):\n    listing['bed_type'] = listing['bed_type'].replace(cats[i], i)\n\ncats = ['strict', 'moderate', 'flexible']\nfor i in range(len(cats)):\n    listing['cancellation_policy'] = listing['cancellation_policy'].replace(cats[i], i)","eea55aca":"listing['calendar_updated'] = listing['calendar_updated'].str.strip(\" ago\")\ncalendar_cats = listing['calendar_updated'].unique()\nfor i in range(len(calendar_cats)):\n    if calendar_cats[i] == 'never':\n        to_replace = 365 * 3\n    elif calendar_cats[i] == 'today':\n        to_replace = 0\n    elif calendar_cats[i] == 'yesterday':\n        to_replace = 1\n    elif calendar_cats[i] == 'week':\n        to_replace = 7\n    else:\n        multiple, period = calendar_cats[i].split(\" \")\n        if period == 'weeks':\n            to_replace = int(multiple) * 7\n        elif period == 'months':\n            to_replace = int(multiple) * 30\n        elif period == 'days':\n            to_replace = int(multiple)\n    listing['calendar_updated'] = \\\n    listing['calendar_updated'].replace(calendar_cats[i], to_replace)","87e4b795":"listing['calendar_updated']","a9f254a8":"listing['amenities']","fc86102b":"listing['amenities'] = listing['amenities'].apply(lambda x: set(x.strip(\"{\").strip(\"}\").replace('\"', '').split(\",\")).difference(['']))","0241cef3":"# from tqdm import tqdm\n# all_amenities = set()\n# for i in tqdm(range(len(listing))):\n#     item = listing.loc[i, 'amenities']\n#     all_amenities = all_amenities.union(set(item))\n\nall_amenities = \\\nset(['24-Hour Check-in',\n 'Air Conditioning',\n 'Breakfast',\n 'Buzzer\/Wireless Intercom',\n 'Cable TV',\n 'Carbon Monoxide Detector',\n 'Cat(s)',\n 'Dog(s)',\n 'Doorman',\n 'Dryer',\n 'Elevator in Building',\n 'Essentials',\n 'Family\/Kid Friendly',\n 'Fire Extinguisher',\n 'First Aid Kit',\n 'Free Parking on Premises',\n 'Gym',\n 'Hair Dryer',\n 'Hangers',\n 'Heating',\n 'Hot Tub',\n 'Indoor Fireplace',\n 'Internet',\n 'Iron',\n 'Kitchen',\n 'Laptop Friendly Workspace',\n 'Lock on Bedroom Door',\n 'Other pet(s)',\n 'Pets Allowed',\n 'Pets live on this property',\n 'Pool',\n 'Safety Card',\n 'Shampoo',\n 'Smoke Detector',\n 'Smoking Allowed',\n 'Suitable for Events',\n 'TV',\n 'Washer',\n 'Washer \/ Dryer',\n 'Wheelchair Accessible',\n 'Wireless Internet'])","1c0a4b88":"for item in all_amenities:\n    colname = \"has_\" + item.replace(\" \", \"_\")\n    listing[colname] = listing['amenities'].apply(lambda x: int(item in x))","faecae74":"del listing['amenities']","bad2a863":"del listing['host_neighbourhood']","a4110ca3":"listing.columns = listing.columns.str.replace(\"(\", \"\").str.replace(\")\", \"\").str.replace(\"\/\", '')","59e2d44c":"del listing['has_Washer__Dryer']\ndel listing['host_total_listings_count']","2b308f7f":"listing.info()","e61d2a2e":"id_col = ['id', 'host_id']\nnumeric_cols = ['host_since', 'num_days_as_host', 'host_response_time', \n                'host_response_rate', 'host_acceptance_rate', \n                'host_listings_count', 'latitude', 'longitude', 'room_type',\n                'accommodates', 'bathrooms', 'beds', 'bed_type', 'square_feet', 'guests_included', \n                'extra_people', 'minimum_nights', 'maximum_nights', 'calendar_updated', \n                'number_of_reviews', 'first_review', 'num_days_first_review', \n                'last_review', 'num_days_last_review',\n                'review_scores_rating', 'review_scores_accuracy', 'review_scores_cleanliness', \n                'review_scores_checkin', 'review_scores_checkin', 'review_scores_communication', \n                'review_scores_location', 'review_scores_value', 'cancellation_policy', \n                'calculated_host_listings_count', 'reviews_per_month']\ncat_cols = ['host_has_profile_pic', 'host_identity_verified',\n            'host_is_superhost', 'instant_bookable',\n            'require_guest_phone_verification', 'require_guest_profile_picture',\n            'has_Wireless_Internet', 'has_Essentials',\n            'has_Wheelchair_Accessible', 'has_Indoor_Fireplace',\n            'has_Carbon_Monoxide_Detector', 'has_Cats', 'has_Safety_Card',\n            'has_Shampoo', 'has_Hot_Tub', 'has_Other_pets', 'has_Pets_Allowed',\n            'has_Gym', 'has_First_Aid_Kit', 'has_BuzzerWireless_Intercom',\n            'has_Doorman', 'has_Suitable_for_Events', 'has_Fire_Extinguisher',\n            'has_Dogs', 'has_Pets_live_on_this_property', 'has_Breakfast',\n            'has_Heating', 'has_Laptop_Friendly_Workspace', 'has_Smoking_Allowed',\n            'has_Internet', 'has_Air_Conditioning', 'has_24-Hour_Check-in',\n            'has_TV', 'has_Elevator_in_Building', 'has_Pool', 'has_Cable_TV',\n            'has_Free_Parking_on_Premises', 'has_Washer', 'has_Iron',\n            'has_FamilyKid_Friendly', 'has_Kitchen', 'has_Dryer',\n            'has_Smoke_Detector', 'has_Hair_Dryer', 'has_Lock_on_Bedroom_Door',\n            'has_Hangers', 'property_type', 'neighbourhood_group_cleansed']\ntarget = ['price']","ab2e09d5":"listing_col = []\nlisting_col.extend(id_col)\nlisting_col.extend(numeric_cols)\nlisting_col.extend(cat_cols)\nlisting_col.extend(target)\nlisting = listing[listing_col]\nlisting.head()","ef8e7d3b":"calendar['date'] = pd.to_datetime(calendar['date'])\ncalendar.loc[:, 'price'] = calendar['price'].str.replace('$', '').str.replace(\",\", \"\").astype(np.float64)\ncalendar.info()","703ddd54":"# save to output\nlisting.to_csv('\/kaggle\/working\/listings.csv', index=False)\ncalendar.to_csv('\/kaggle\/working\/calendar.csv', index=False)","4ab4bb6c":"listing.head()","3b50f460":"### III. Encode Ordered Categorical (Ordinal) Columns into Integers\n\nOrdinal columns are categorical variables that include categories that are ordered in nature. Instead of using ```OneHotEncoding```, it is more appropriate to convert them into integers to reflect the ordered nature of these variables.","f4cfb105":"## 1. Manually examine interesting columns to examine further.\n\nHere I chose columns that are roughly grouped into these categories:\n\n - Information regarding host;\n     - review; performance; experience\n - Information regarding house;\n     - location; amenities; furniture; policy; affordability","5ded08a2":"#### We already have columns ```has_washer``` and ```has_dryer``` so there is no need to also include ```has_Washer_Dryer``` as it is redundant information. Also upon examination ```host_total_listings_count``` is identical to column ```host_listings_count``` so we should consider removing it.","36ce3593":"### I. Datetime Columns\nWe could convert datetime columns that are read in as strings using the ```pd.to_datetime``` function, or we could pass them into ```pd.read_csv``` explicitly using the ```parse_dates=[...]``` argument.","73b59592":"### II. Numeric Columns that are read in as strings\n\nThese are the columns that include strings such as \"%\" or \"$\". While such representation is convenient for viewing, it is not appropriate for quantitative analysis. We should convert them into numerical columns.","7873e1a3":"### IV. Extract Features from Amenities Columns. For each amenity provided, create a new binary variable representing if the amenity is present","d12f758f":"#### Use longitude and latitude as geographical features instead of categorical variables neighborhood (which are of high ordinality).","e993e811":"# Data Cleaning","32a95045":"## Lastly, reorganize the order of columns","603b1900":"## 2. Group columns into types; correct for inconsistent data types"}}