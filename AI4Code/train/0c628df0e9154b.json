{"cell_type":{"d9e61d48":"code","4baf6f43":"code","42897272":"code","1b7bb38a":"code","a5f10b63":"code","71486fe5":"code","4142c5f9":"code","e5d3b0da":"code","be5cb1d7":"code","ab718c41":"code","f78a6ef4":"code","9457e57c":"code","0674ccbb":"markdown","a505b371":"markdown","f09587c6":"markdown","125aec52":"markdown"},"source":{"d9e61d48":"# \u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\nimport sys\nimport os\nimport re\n\n# pandas,sqlite\nimport pandas as pd\nimport numpy as np\nimport pandas.io.sql as psql\nimport sqlite3\n\nfrom datetime import datetime as dt\nimport time\n\n# \u30c7\u30fc\u30bf\u53d6\u5f97\nimport json\nimport inspect\nimport requests\nimport codecs\n# plotly\nimport plotly\nimport plotly.graph_objects as go\n\n# HTML\nfrom IPython.display import display, HTML\n\n\nshow_tables = \"select tbl_name from sqlite_master where type = 'table'\"\ndesc = \"PRAGMA table_info([{table}])\"\nconn = \\\n    sqlite3.connect(':memory:')\ncursor = conn.cursor()\n# os.listdir('..\/input\/japantradestatistics3')\n# kaggle \u3067\u3001plotly \u304c\u8868\u793a\u3055\u308c\u306a\u3044\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u3001\u5bfe\u5fdc\u3059\u308b\u30b3\u30fc\u30c9\uff08\u304a\u307e\u3058\u306a\u3044\u7684\u304b\u3082\uff09\nplotly.offline.init_notebook_mode (connected = True)\n\n# \u30b3\u30fc\u30c9\u95a2\u4fc2\u306e\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u3001pandas \u306b\u3044\u308c\u308b\ntry:\n    attach = 'attach \"..\/input\/japantradestatistics3\/codes4.db\" as code'\n    cursor.execute(attach)\nexcept:\n    pass\n\n# import hs,country code as pandas\ntmpl = \"{hs}_{lang}_df =  pd.read_sql('select * from code.{hs}_{lang}',conn)\"\nfor hs in ['hs2','hs4','hs6','hs6','hs9']:\n    for lang in ['jpn','eng']:\n        exec(tmpl.format(hs=hs,lang=lang))        \n        \n# country table: country_eng,country_jpn\ncountry_eng_df = pd.read_sql('select * from code.country_eng',conn)\ncountry_eng_df['Country']=country_eng_df['Country'].apply(str)\ncountry_jpn_df = pd.read_sql('select * from code.country_jpn',conn)\ncountry_jpn_df['Country']=country_jpn_df['Country'].apply(str)\n\n# \u5e74\u30d9\u30fc\u30b9\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u3064\u304b\u3048\u308b\u3088\u3046\u306b\u3059\u308b(attach)\ntry:\n    attach = 'attach \"..\/input\/japantradestatistics3\/y_from_1988.db\" as y_1988'\n    cursor.execute(attach)\nexcept:\n    pass\n\ny_table = 'y_from_1988'\n","4baf6f43":"# HS \u30b3\u30fc\u30c9\u3092\u8abf\u3079\u308b\u3000\u5143\u30c7\u30fc\u30bf\u306f\u610f\u5473\u4e0d\u660e\u306a\u3053\u3068\u304c\u591a\u3044\u306e\u3067\u9069\u5b9c\u88dc\u3046\nclass util():\n    def __init__(self):\n        print(dt.now())\n        \n    # hs code \u304b\u3089\u3000\u8aac\u660e\u3092\u53d6\u5f97\u3059\u308b\n    def hs_name(self,hs_code):\n        hs = len(hs_code)\n        if hs not in (2,4,6,9):\n            print('HS \u30b3\u30fc\u30c9\u306e\u9577\u3055\u304c\u307e\u3061\u304c\u3063\u3066\u3044\u307e\u3059\u3002 ' + str(hs))\n        hs = str(hs)\n        print(hs_code)\n        text = 'hs' + hs + '_eng_df.query(' +\"'\"+ 'hs' + hs + '==\"' + hs_code + '\"' + \"')\"\n        df = eval(text)\n        print(df['hs' + hs + '_name'].values[0])\n        text = 'hs' + hs + '_jpn_df.query(' +\"'\"+ 'hs' + hs + '==\"' + hs_code + '\"' + \"')\"\n        df = eval(text)\n        print(df['hs' + hs + '_name'].values[0])\n        \n    def hs_url(self,hs_code,exp_imp=2,yyyy_mm='2021_1'):\n        # \u8f38\u51fa https:\/\/www.customs.go.jp\/yusyutu\/index.htm\n        # \u8f38\u5165 https:\/\/www.customs.go.jp\/tariff\/index.htm\n        hs = hs_code[0:2]\n    \n        if exp_imp == 1:\n            ex = 'yusyutu'\n        else:\n            ex = 'tariff'\n        \n        tmpl = 'https:\/\/www.customs.go.jp\/{ex}\/{yyyy_mm}\/data\/print_j_{hs}.htm'\n        print(tmpl.format(ex=ex,yyyy_mm=yyyy_mm,hs=hs))\n        \n    def color_text(self,name):\n         # ex HTML(ut.color_show('red'))\n        return('<h1><font color=\"' + name + '\">\u25a0<\/font><\/h1>') \n        \n        \n\nut = util()","42897272":"# \u6700\u65b0 \u56fd\u5225\u6298\u308c\u7dda\u30b0\u30e9\u30d5\u3067\u4f7f\u3046\u56fd\u306e\u8272\u3001\u66ab\u5b9a\u7684\u306b\u4ed8\u4e0e\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u304b\u3089\u5909\u66f4\u3042\u308a\n# \u914d\u5217\u306e\u914d\u5217\u3092\u57fa\u672c\u3068\u3057\u3066\u3001\u305d\u308c\u304b\u3089\u3001name \u3068 color \u3092\u3064\u304f\u308b\ncountries = [['105', 'China', 'gold'],\n ['304', 'USA', 'red'],\n ['103', 'SouthKorea', 'brown'],\n ['106', 'Taiwan', 'cyan'],\n ['601', 'Australia', 'green'],\n ['111', 'Thai', 'violet'],\n ['213', 'Germany', 'grey'],\n ['110', 'VietNum', 'crimson'],\n ['108', 'HongKong', 'orangered'],\n ['112', 'Singapore', 'lightblue'],\n ['147', 'UAE', 'black'],\n ['137', 'SaudiArabia', 'lightgreen'],\n ['118', 'Indonesia', 'darkorange'],\n ['113', 'Malaysia', 'yellow'],\n ['205', 'UK', 'darkblue'],\n ['224', 'Russia', 'pink'],\n ['117', 'Philipin', 'olive'],\n ['302', 'Canada', 'blue'],\n ['210', 'France', 'indigo'],\n ['305', 'Mexico', 'tan'],\n ['141', 'Oman', 'moccasin'],\n                      \n ['312', 'Panama', 'dimgrey'],\n ['606', 'New_Zealand', 'palevioletred'],\n ['203', 'Sweden', 'slateblue'],\n ['223', 'Poland', 'darkviolet'],\n ['407', 'Peru', 'honeydew'],\n ['220', 'Italy', 'springgreen'],\n ['215', 'Switzerland', 'blue'],\n ['208', 'Belgium', 'darkolivegreen'],\n ['225', 'Austria', 'mediumpurple'],\n ['140', 'Qatar', 'lightgray'],\n ['409', 'Chile', 'maroon'],\n ['234', 'Turkey', 'orchid'],\n ['206', 'Ireland', 'navajowhite'],\n ['207', 'Netherlands', 'darkslateblue'],\n ['138', 'Kuwait', 'wheat'],\n ['123', 'India', 'beige'],\n ['551', 'South_Africa', 'papayawhip'],\n ['218', 'Spain', 'cornsilk'],\n ['410', 'Brazil', 'teal'],\n\n ['116', 'Brunei', 'seashell'],\n ['120', 'Cambodia', 'floralwhite'],\n ['122', 'Myanmar', 'darkmagenta'],\n ['124', 'Pakistan', 'firebrick'],\n ['125', 'Sri_Lanka', 'navy'],\n ['127', 'Bangladesh', 'gainsboro'],\n ['133', 'Iran', 'darkcyan'],\n ['134', 'Iraq', 'cornflowerblue'],\n ['135', 'Bahrain', 'yellowgreen'],\n ['143', 'Israel', 'peru'],\n ['153', 'Kazakhstan', 'darkturquoise'],\n ['202', 'Norway', 'cadetblue'],\n ['204', 'Denmark', 'palegreen'],\n ['222', 'Finland', 'darkseagreen'],\n ['227', 'Hungary', 'paleturquoise'],\n ['230', 'Greece', 'gray'],\n ['231', 'Romania', 'ivory'],\n ['238', 'Ukraine', 'lightpink'],\n ['245', 'Czech_Republic', 'whitesmoke'],\n ['311', 'Cost_rica', 'azure'],                     \n ['315', 'Bahamas', 'lightseagreen'],\n ['324', 'Puerto_Rico_(USA)', 'lightskyblue'],\n ['401', 'Colombia', 'mediumslateblue'],\n ['406', 'Ecuador', 'chartreuse'],\n ['413', 'Argentina', 'lightslategrey'],\n ['506', 'Egypt', 'mediumaquamarine'],\n ['515', 'Liberia', 'slategray'],\n ['541', 'Kenya', 'chocolate'],\n ['602', 'Papua_New_Guinea', 'magenta'],\n\n ['625', 'Marshall', 'darkgray']]\n\n# \u8272\u3068\u540d\u524d\u3092\u3001\u8f9e\u66f8\u578b\u306b\u5c55\u958b\ncountry_colors = {x[0]:x[2] for x in countries}\ncountry_names = {x[0]:x[1] for x in countries}\n\n# HTML('<h1><font color=\"red\">\u25a0<\/font><\/h1>')  # \u8272\u306e\u30c1\u30a7\u30c3\u30af","1b7bb38a":"# hs code \u3068\u305d\u306e\u8aac\u660e \u8907\u6570\u306eHS\u30b3\u30fc\u30c9\u3092\u6271\u3046\u4f8b\nhs_codes = [['870321915', '660cc\u4ee5\u4e0b'],\n ['870321925', '660-1000cc'],\n ['870322910', '1000-1500cc'],\n ['870323915', '1500-2000'],\n ['870323925', '2000-3000'],\n ['870324910', '3000-'],\n ['870331100', '\u30c7\u30a3\u30fc\u30bc\u30eb1500\u4ee5\u4e0b'],\n ['870332915', '\u30c7\u30a3\u30fc\u30bc\u30eb1500-2500'],\n ['870332925', '\u30c7\u30a3\u30fc\u30bc\u30eb2000-2500'],\n ['870333910', '\u30c7\u30a3\u30fc\u30bc\u30eb2500-'],\n ['870340100', '\u30ac\u30bd\u30ea\u30f3HV'],\n ['870350100', '\u30c7\u30a3\u30fc\u30bc\u30ebHV'], \n ['870360100', '\u30ac\u30bd\u30ea\u30f3PHV'],\n ['870370100', '\u30c7\u30a3\u30fc\u30bc\u30ebPHV'],\n ['870380100', 'BEV'],\n ['870390100', '\u305d\u306e\u4ed6\u306e\u3082\u306e']]\n\nhs_text =','.join(['\"' + str(x[0]) + '\"' for x in hs_codes])\nhs_dict = {x[0]:x[1]  for x in hs_codes}\nhs_list = [x[0] for x in hs_codes]\n","a5f10b63":"%%time\n\n# hs code \u3092\u6307\u5b9a\u3057\u3066\u3001\u62bd\u51fa Year \u306e\u30c7\u30fc\u30bf\u306f\u3001hs9 \u306e\u307f\nhs='hs9'\nsql = \"\"\"\nselect Year,exp_imp,Country,hs9,Value,Q1,Q2 from {y_table}\nwhere hs9 in ({hs_text})\n\"\"\"[1:-1]\n\n# \u5e74\u3001\u8f38\u51fa\u5165\u3001\u56fd\u5225\u306e\u60c5\u5831\ny_df = pd.read_sql(sql.format(y_table=y_table,hs_text=hs_text),conn)\n\n# \u30c7\u30fc\u30bf\u30fb\u30bf\u30a4\u30d7\u306e\u554f\u984c\u304c\u751f\u3058\u306a\u3044\u3088\u3046\u306b\u5e74\u306e\u305f\u3081\u306b\u30bf\u30a4\u30d7\u3092\u660e\u78ba\u306b\u5909\u63db\n\n# Year \u306f\u3001\u5e74\u6708\u65e5(\u5e74)\u306b\u5909\u63db\u3059\u308b\n# https:\/\/deepage.net\/features\/pandas-to-datetime.html\ny_df['Year'] = pd.to_datetime(y_df['Year'],format='%Y')\ny_df['exp_imp'] = y_df['exp_imp'].astype(int)\ny_df['Country'] = y_df['Country'].astype(str)\ny_df['hs9'] = y_df['hs9'].astype(str)\ny_df['Value'] = y_df['Value'].astype(float)","71486fe5":"%%time\n# \u4e2d\u53e4\u81ea\u52d5\u8eca\u306e\u8f38\u51fa\u5168\u4f53\u3092\u5e74\u3067\u30b0\u30e9\u30d5\u306b\u3059\u308b\u3002\u8f38\u51fa\u3068\u8f38\u5165\u3067\u306f\u3001\u30b3\u30fc\u30c9\u4f53\u7cfb\u304c\u7570\u306a\u308b\u3000\u8f38\u5165\u306b\u306f\u4e2d\u53e4\u8eca\u3068\u3044\u3046\u533a\u5206\u306f\u306a\u3044\n# xdf \u306f\u4e00\u6642\u7684\u306b\u4f7f\u3046\u30c7\u30fc\u30bf\u540d\nxdf = y_df[['Year','exp_imp','Value']].groupby(['Year','exp_imp'],as_index=False).sum('Value')\n# text \u306f\u3001eval \u306e\u5bfe\u8c61\u3068\u306a\u308b\u4e00\u6642\u7684\u306a\u30c6\u30ad\u30b9\u30c8\u5909\u6570\u540d\u3000\n# \u4e0b\u8a18\u306f\u3001\u30b0\u30e9\u30d5\u306e\u6307\u5b9a Scatter\u6563\u5e03\u56f3\u3068\u3044\u3046\u540d\u79f0\u3060\u304c\u3001\u6298\u308c\u7dda\u30b0\u30e9\u30d5\n# y \u8ef8\u306f\u3001\u308f\u304b\u308a\u3084\u3059\u3044\u3088\u3046\u306b\u3001\u5104\u5186\u63db\u7b97\u3057\u3066\u3044\u308b\u3002Value \u306f\u30011000\u5186\u5358\u4f4d\u3001100000 \u3067\u5272\u308b\u3068\u3000\u5104\u5186\u306b\u306a\u308b\ntext =\"\"\"\ngo.Scatter(x = xdf.query(\"exp_imp=={exp_imp}\")[\"Year\"]\n,y = xdf.query(\"exp_imp=={exp_imp}\")[\"Value\"]\/100000,name=\"{name}\",line=dict(width=5))\n\"\"\"[1:-1]\n\nfig = go.Figure()\nfig.add_trace(eval(text.format(exp_imp=1,name='\u8f38\u51fa')))\nfig.update_layout( yaxis_title = '\u91d1\u984d\u3001\u5104\u5186')\nfig.show()","4142c5f9":"%time \n\n# \u8f38\u51fa\u3057\u304b\u5b58\u5728\u3057\u306a\u3044\u306e\u3067\u3001exp_imp \u306f\u7121\u8996\nxdf = y_df[['Year','hs9','Value']].groupby(['Year','hs9'],as_index=False).sum('Value')\ntext =\"\"\"\ngo.Scatter(x = xdf.query(\"hs9=='{hs9}'\")[\"Year\"]\n,y = xdf.query(\"hs9=='{hs9}'\")[\"Value\"]\/100000,name=\"{name}\",line=dict(width=5))\n\"\"\"[1:-1]\n\nfig = go.Figure()\n\nfor hs9 in hs_list:\n    fig.add_trace(eval(text.format(hs9=hs9,name=hs9 + ' ' + hs_dict[hs9])))\nfig.update_layout( yaxis_title = '\u91d1\u984d\u3001\u5104\u5186')\nfig.show()\n    ","e5d3b0da":"xdf = y_df.query('Year>2015 & exp_imp==1')[['Country','Value']].groupby('Country',as_index=False).sum()\nxdf = pd.merge(xdf,country_eng_df,on='Country').sort_values('Value',ascending=False)\nxdf.head(9)","be5cb1d7":"country_list = ['113', '224', '606', '125', '541', '124', '127', '112', '147']\n\n# \u8f38\u51fa\u3057\u304b\u5b58\u5728\u3057\u306a\u3044\u306e\u3067\u3001exp_imp \u306f\u7121\u8996\nxdf = y_df[['Year','Country','Value']].groupby(['Year','Country'],as_index=False).sum('Value')\ntext =\"\"\"\ngo.Scatter(x = xdf.query(\"Country=='{Country}'\")[\"Year\"]\n,y = xdf.query(\"Country=='{Country}'\")[\"Value\"]\/100000,name=\"{name}\",line=dict(color=\"{color}\",width=5))\n\"\"\"[1:-1]\n\nfig = go.Figure()\n\n#for Country in country_list:\nfor Country in country_list:\n\n        fig.add_trace(eval(text.format(Country=Country,name=country_names[Country],color=country_colors[Country])))\n\n    \nfig.update_layout( yaxis_title = '\u91d1\u984d\u3001\u5104\u5186')\nfig.show()\n    \n","ab718c41":"attach = 'attach \"..\/input\/japantradestatistics3\/ym_2019_2021.db\" as ym_2019_2021'\ncursor.execute(attach)","f78a6ef4":"# \u6708\u5225\u96c6\u8a08\nym_table = 'ym_2019_2021'\nsql = \"\"\"\nselect ym,exp_imp,Country,hs9,Value,Q1,Q2 from {ym_table}\nwhere hs9 in ({hs_text})\n\"\"\"[1:-1]\n# \u5e74\u3001\u8f38\u51fa\u5165\u3001\u56fd\u5225\u306e\u60c5\u5831\nym_df = pd.read_sql(sql.format(ym_table=ym_table,hs_text=hs_text),conn,parse_dates={'ym': '%Y%m'})\nym_df.head()","9457e57c":"country_list = ['113', '224', '606', '125', '541', '124', '127', '112', '147']\n\n# \u8f38\u51fa\u3057\u304b\u5b58\u5728\u3057\u306a\u3044\u306e\u3067\u3001exp_imp \u306f\u7121\u8996\nxdf = ym_df[['ym','Country','Value']].groupby(['ym','Country'],as_index=False).sum('Value')\ntext =\"\"\"\ngo.Scatter(x = xdf.query(\"Country=='{Country}'\")[\"ym\"]\n,y = xdf.query(\"Country=='{Country}'\")[\"Value\"]\/100000,name=\"{name}\",line=dict(color=\"{color}\",width=5))\n\"\"\"[1:-1]\n\nfig = go.Figure()\n\n#for Country in country_list:\nfor Country in country_list:\n\n        fig.add_trace(eval(text.format(Country=Country,name=country_names[Country],color=country_colors[Country])))\n\n    \nfig.update_layout( yaxis_title = '\u91d1\u984d\u3001\u5104\u5186')\nfig.show()\n    \n","0674ccbb":"# \u307e\u305a\u5e74\u30d9\u30fc\u30b9\uff08y_table\uff09\u306e\u96c6\u8a08","a505b371":"# \u54c1\u76ee\u5225\u306e\u57fa\u672c\u7d71\u8a08 (\u4e2d\u53e4\u8eca) \n\n### HS\u30b3\u30fc\u30c9\u3000\u8f38\u51fa\u3067\u3001 \u4e57\u7528\u8eca 8703\u3000\u4e2d\u53e4\u3068\u66f8\u3044\u3066\u3042\u308b\u3082\u306e\u3092\u9078\u3073\u307e\u3059\u3002 \n \n### \u53c2\u8003\n- [\u30b0\u30fc\u30cd\u30c3\u30c8\u4e2d\u53e4\u8eca\u8f38\u51fa\u72b6\u6cc1](https:\/\/www.goonews.jp\/data_bank.php)","f09587c6":"# \u3053\u3053\u304b\u3089\u306f\u3001 \u5bfe\u8c61\u5225\u306e\u30c7\u30fc\u30bf","125aec52":"# \u5171\u901a\u90e8\u5206"}}