{"cell_type":{"7be37240":"code","1ac27b14":"code","b182c536":"code","f52b6d88":"code","62dd7ef9":"code","1cb43f0a":"code","7af184d2":"code","a2225a66":"code","e0bfe6db":"code","f1929ae5":"code","26c30d24":"code","ef9d1ffe":"code","9cf39175":"code","1aa1ddf8":"code","a811b559":"code","ce7bd4e4":"code","a4dff594":"code","e3767d8c":"code","ccf45e83":"code","3d9b1db7":"code","a8063cf2":"code","aeaf44f6":"code","a9225262":"code","b9f214ef":"code","6e573f96":"code","5fe7f176":"code","935320f9":"code","8b901a58":"code","13ad0fee":"code","5bd3e93e":"code","54eb89e1":"code","ed6d4434":"code","1121dae2":"code","24ef8349":"code","4baeed12":"code","3dc35708":"code","1ae6a681":"code","718c7ad5":"code","3495f427":"code","796b97e4":"code","657fee72":"code","ad3c5e88":"code","5d1b91b0":"markdown","b5985241":"markdown","8327fc69":"markdown","4d4f8af9":"markdown","088e4368":"markdown","31655f2d":"markdown","14962d2c":"markdown","f1c62c84":"markdown","86a2dd53":"markdown","e0f08cc1":"markdown","71c5130f":"markdown","06c22b53":"markdown","c3d59bd8":"markdown","fa080efb":"markdown","8cc444f1":"markdown","a7aee418":"markdown","e176dfe1":"markdown","cd71f578":"markdown","bbdca58f":"markdown","8ce056ca":"markdown","2fbf5646":"markdown","d1808412":"markdown","df70a405":"markdown","f8ab3504":"markdown","784074c7":"markdown","942edd8c":"markdown","611c7db8":"markdown","0b040309":"markdown","bc289a7c":"markdown","17078b14":"markdown","eda46c52":"markdown","a78576ab":"markdown","9c5e5ecb":"markdown"},"source":{"7be37240":"\nimport numpy as np \nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom sklearn import preprocessing\n\nimport os\n\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n","1ac27b14":"df=pd.read_csv(\"..\/input\/hr-analytics-job-change-of-data-scientists\/aug_train.csv\")\ndf.head()","b182c536":"df.info()","f52b6d88":"df.set_index('enrollee_id',inplace=True)\ndf.head()","62dd7ef9":"df.describe(include=\"all\")","1cb43f0a":"round(df.isnull().sum()\/df.shape[0]*100,2)","7af184d2":"df2=df.dropna(subset=[\"enrolled_university\",\"education_level\",\"experience\",\"last_new_job\"])\ndf2.head()","a2225a66":"plt.figure(figsize=[8,6])\nax = sns.countplot(x=\"target\", data=df2)","e0bfe6db":"df_city_freq= round(df2[df2[\"target\"]==1][[\"city\",\"target\"]].groupby\n (\"city\").count()\/df2[df2[\"target\"]==1].shape[0]*100,2).rename(columns={\"target\":\"city_freq\"}).reset_index()\n\ndf3=df2.reset_index().merge(df_city_freq, how='left', on='city').set_index('enrollee_id')\ndf3[\"city_freq\"].fillna(0,inplace=True)\n\n\ndf3[\"ordinal_city\"]=pd.qcut(df3[\"city_freq\"],3)\n\nenc=preprocessing.LabelEncoder()\ndf3[\"ordinal_city\"]=enc.fit_transform(df3[\"ordinal_city\"])\n\nplt.figure(figsize=[8,6])\nax=sns.countplot(\"ordinal_city\",data=df3,hue=\"target\")","f1929ae5":"plt.figure(figsize=[8,6])\nax = sns.kdeplot(df3[\"city_development_index\"][(df3[\"target\"] == 1) ],color=\"Red\")\nax = sns.kdeplot(df3[\"city_development_index\"][(df3[\"target\"] == 0) ],color=\"Blue\")\nax.legend([\"Looking for a job change\",\"Not looking for job change\"],loc='upper right')\nax.set_ylabel('Density')\nax.set_xlabel(\"city_development_index\")\nax.set_title(\"Distribution of \"+ \"city_development_index\" +\" by Job change\");","26c30d24":"plt.figure(figsize=[8,6])\nsns.boxplot(x=\"target\",y=\"city_development_index\",data=df3);","ef9d1ffe":"df3[\"ordinal_development_index\"]=pd.qcut(df3[\"city_development_index\"],4)\n\nenc=preprocessing.LabelEncoder()\ndf3[\"ordinal_development_index\"]=enc.fit_transform(df3[\"ordinal_development_index\"])\n\nplt.figure(figsize=[8,6])\nax=sns.countplot(\"ordinal_development_index\",data=df3,hue=\"target\")","9cf39175":"plt.figure(figsize=[8,6])\nax=sns.countplot(\"gender\",data=df3,hue=\"target\")","1aa1ddf8":"df4=df3[df3[\"gender\"]!=\"Other\"]\ndf4.head()","a811b559":"df4.gender.fillna(\"Male\",inplace=True)","ce7bd4e4":"plt.figure(figsize=[8,6])\nax=sns.countplot(\"relevent_experience\",data=df4,hue=\"target\")","a4dff594":"plt.figure(figsize=[8,6])\nax=sns.countplot(\"enrolled_university\",data=df4,hue=\"target\")","e3767d8c":"plt.figure(figsize=[8,6])\nax=sns.countplot(\"education_level\",data=df4,hue=\"target\")","ccf45e83":"df_edu_cat=pd.DataFrame(np.where((df4.loc[:,[\"education_level\"]]==\"Primary School\"),0\n                                 \n                                 ,np.where((df4.loc[:,[\"education_level\"]]==\"High School\"),1\n                                           \n                                           ,np.where((df4.loc[:,[\"education_level\"]]==\"Graduate\"),2\n                                                     \n                                                    ,np.where((df4.loc[:,[\"education_level\"]]==\"Masters\"),3\n                                                              \n                                                              ,4)))),columns=[\"ordinal_education_level\"])\n\n\ndf5=df4.reset_index().merge(df_edu_cat, how='left',left_index=True, right_index=True).set_index('enrollee_id')\n\nplt.figure(figsize=[8,6])\nax=sns.countplot(\"ordinal_education_level\",data=df5,hue=\"target\")","3d9b1db7":"plt.figure(figsize=[8,6])\nax=sns.countplot(\"major_discipline\",data=df5,hue=\"target\")\nax.set_xticklabels(ax.get_xticklabels(),rotation=20);","a8063cf2":"df5.major_discipline.fillna(\"STEM\",inplace=True)","aeaf44f6":"plt.figure(figsize=[8,6])\nax=sns.countplot(\"experience\",data=df5,hue=\"target\")\nax.set_xticklabels(ax.get_xticklabels(),rotation=20);","a9225262":"df_experience_cat=pd.DataFrame(np.where((df5.loc[:,[\"experience\"]].isin([\"<1\",\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\"])),0\n                                        ,np.where((df5.loc[:,[\"experience\"]].isin([\"8\",\"9\",\"10\",\"11\"])),1\n                                                  ,np.where((df5.loc[:,[\"experience\"]].isin([\"12\",\"13\",\"14\",\"15\"])),2\n                                                            ,np.where((df5.loc[:,[\"experience\"]].isin([\"16\",\"17\",\"18\",\"19\",\"20\"])),3\n                                                                      ,4)))),columns=[\"ordinal_experience_cat\"])\n\n\ndf6=df5.reset_index().merge(df_experience_cat, how='left',left_index=True, right_index=True).set_index('enrollee_id')\n\n\nplt.figure(figsize=[8,6])\nax=sns.countplot(\"ordinal_experience_cat\",data=df6,hue=\"target\")","b9f214ef":"plt.figure(figsize=[8,6])\nax=sns.countplot(\"company_size\",data=df6,hue=\"target\")\nax.set_xticklabels(ax.get_xticklabels(),rotation=20);","6e573f96":"df6.company_size.fillna(\"50-99\",inplace=True)","5fe7f176":"df_company_cat=pd.DataFrame(np.where((df6.loc[:,[\"company_size\"]]==\"<10\"),0\n                                     ,np.where((df6.loc[:,[\"company_size\"]]==\"10\/49\"),1\n                                           ,np.where((df6.loc[:,[\"company_size\"]]==\"50-99\"),2\n                                                     ,np.where((df6.loc[:,[\"company_size\"]]==\"100-500\"),3\n                                                              ,np.where((df6.loc[:,[\"company_size\"]]==\"500-999\"),4\n                                                                       ,np.where((df6.loc[:,[\"company_size\"]]==\"1000-4999\"),5\n                                                                                ,np.where((df6.loc[:,[\"company_size\"]]==\"5000-9999\"),6\n                                                                                         ,7))))))),columns=[\"ordinal_company_size\"])\n\n\ndf7=df6.reset_index().merge(df_company_cat, how='left',left_index=True, right_index=True).set_index('enrollee_id')\n\nplt.figure(figsize=[8,6])\nax=sns.countplot(\"ordinal_company_size\",data=df7,hue=\"target\")","935320f9":"plt.figure(figsize=[8,6])\nax=sns.countplot(\"company_type\",data=df7,hue=\"target\")\nax.set_xticklabels(ax.get_xticklabels(),rotation=25);","8b901a58":"df7.company_type.fillna(\"Pvt Ltd\",inplace=True) ","13ad0fee":"plt.figure(figsize=[8,6])\nax = sns.kdeplot(df7[\"training_hours\"][(df7[\"target\"] == 1) ],color=\"Red\")\nax = sns.kdeplot(df7[\"training_hours\"][(df7[\"target\"] == 0) ],color=\"Blue\")\nax.legend([\"Looking for a job change\",\"Not looking for job change\"],loc='upper right')\nax.set_ylabel('Density')\nax.set_xlabel(\"training_hours\")\nax.set_title(\"Distribution of \"+ \"training_hours\" +\" by Job change\");","5bd3e93e":"plt.figure(figsize=[8,6])\nsns.boxplot(x=\"target\",y=\"training_hours\",data=df7);","54eb89e1":"plt.figure(figsize=[8,6])\nax=sns.countplot(\"last_new_job\",data=df7,hue=\"target\")\nax.set_xticklabels(ax.get_xticklabels(),rotation=25);","ed6d4434":"df_lastnew_cat=pd.DataFrame(np.where((df7.loc[:,[\"last_new_job\"]]==\"never\"),0\n                                     \n                                     ,np.where((df7.loc[:,[\"last_new_job\"]]==\"1\"),1\n                                           \n                                           ,np.where((df7.loc[:,[\"last_new_job\"]]==\"2\"),2\n                                                     \n                                                    ,np.where((df7.loc[:,[\"last_new_job\"]]==\"3\"),3\n                                                              \n                                                              ,np.where((df7.loc[:,[\"last_new_job\"]]==\"4\"),4\n                                                                        \n                                                                        ,5))))),columns=[\"ordinal_last_new_job\"])\n\n\ndf8=df7.reset_index().merge(df_lastnew_cat, how='left',left_index=True, right_index=True).set_index('enrollee_id')\n\nplt.figure(figsize=[8,6])\nax=sns.countplot(\"ordinal_last_new_job\",data=df8,hue=\"target\")","1121dae2":"df8.head()","24ef8349":"df8.drop([\"city\",\"city_development_index\",\"education_level\",\"experience\",\"last_new_job\",\"company_size\"\n          ,\"training_hours\",\"city_freq\"],axis=1,inplace=True)","4baeed12":"df8.info()","3dc35708":"df9= pd.get_dummies(df8)\n\nfig, ax = plt.subplots(figsize=(12,12))\nfig.suptitle('Correlation between Target and features',fontsize=20)\nax=sns.heatmap(df9.corr()[[\"target\"]].sort_values(\"target\"),vmax=1, vmin=-1, cmap=\"YlGnBu\", annot=True, ax=ax);\nax.invert_yaxis()","1ae6a681":"from sklearn.model_selection import train_test_split\nfrom sklearn.model_selection import cross_val_score\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.metrics import classification_report\nfrom sklearn.metrics import roc_auc_score,roc_curve\nfrom imblearn.pipeline import Pipeline as imbPipe\nfrom imblearn.over_sampling import SMOTE\nfrom xgboost import  XGBClassifier\n\nimport warnings\nwarnings.filterwarnings(\"ignore\")","718c7ad5":"X=df9.drop(\"target\",axis=1)\ny=df9[\"target\"]","3495f427":"X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42,shuffle=True, stratify = y)","796b97e4":"XGBoost_pipe = imbPipe([\n    (\"smote\", SMOTE(random_state=42,n_jobs=-1)),\n    (\"XGBoost\", XGBClassifier(random_state=42,n_jobs=-1,tree_method=\"hist\"))\n])\n\nparams={\n    \"XGBoost__max_depth\": [20,21],\n    \"XGBoost__min_child_weight\":[22,23],\n    \"XGBoost__n_estimators\":[25,27],\n    \"XGBoost__subsample\":[0.4,0.5,0.6],\n    \"XGBoost__colsample_bytree\":[0.4,0.5,0.6],\n    \"XGBoost__gamma\":[1,2,3],\n    \n}\n\nXGBoost_grid = GridSearchCV(XGBoost_pipe, params, cv=3,n_jobs=-1,scoring=\"roc_auc\")\nXGBoost_grid.fit(X_train, y_train)\nprint(\"Best Parameters for Model:  \",XGBoost_grid.best_params_)\ny_pred=XGBoost_grid.predict(X_train)\nprint(\"\\n\")\nprint(classification_report(y_train, y_pred))","657fee72":"y_pred=XGBoost_grid.predict(X_test)  \nprint(classification_report(y_test, y_pred))","ad3c5e88":"fpr, tpr, thresholds =roc_curve(y_test, XGBoost_grid.predict_proba(X_test)[:,1], pos_label=1)\nroc_auc=roc_auc_score(y_test, XGBoost_grid.predict_proba(X_test)[:,1])\nplt.figure( figsize=(14,6))\nplt.plot(fpr, tpr, color='darkorange', label='ROC curve (AUC = %0.2f)' % roc_auc)\nplt.plot([0, 1], [0, 1], color='navy',linestyle='--')\nplt.xlim([0.0, 1.0])\nplt.ylim([0.0, 1.0])\nplt.xlabel('False Positive Rate')\nplt.ylabel('True Positive Rate')\nplt.title('ROC curve')\nplt.legend(loc=\"lower right\")\nplt.show()","5d1b91b0":"## education_level","b5985241":"Converted to ordinal values.","8327fc69":"## experience","4d4f8af9":"## company_size","088e4368":"Converted to ordinal values.","31655f2d":"Dropped some features that i have already used for feature engineering.","14962d2c":"## gender","f1c62c84":"## training_hours","86a2dd53":"Converted to ordinal values.","e0f08cc1":"Dropped Other gender. Filled missing values with most frequent value.","71c5130f":"city_development_index is divided 4 groups. Data scientists living in low city develoment index tend to change their job more often.","06c22b53":"Filled missing values with most frequent value.","c3d59bd8":"## relevent_experience","fa080efb":"## Correlation Heatmap","8cc444f1":"## First look and Some Data Controls","a7aee418":"## company_size","e176dfe1":"## XGBClassifier with Parameter Tuning","cd71f578":"Target value is imbalance  so i will use oversampling method (SMOTE)","bbdca58f":"it looks like that different training hours have no effect on the target. I'll drop this feature later.","8ce056ca":"## Missing Data Control","2fbf5646":"## major_discipline","d1808412":"Filled missing values with most frequent value.","df70a405":"## city_development_index","f8ab3504":"## City","784074c7":"## Read Data","942edd8c":"Filled missing values with most frequent value.","611c7db8":"## last_new_job","0b040309":"City is divided to 3 groups that depends on the job chaingin ratio.","bc289a7c":"Dropped rows which have lower then % 5 missing ratio.","17078b14":"## company_type","eda46c52":"experience is divided 5 groups. Data scientist with low experience tend to change their job more often.","a78576ab":"## Exploratory Data Analysis","9c5e5ecb":"## enrolled_university"}}