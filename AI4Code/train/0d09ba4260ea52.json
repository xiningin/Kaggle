{"cell_type":{"561f6a24":"code","d5c21e02":"code","f4579a64":"code","6412687a":"code","4efbf090":"code","bbfe9c1c":"code","0e5f4e46":"code","65d1f641":"code","8caa0e9b":"code","dc97c78c":"code","54832a71":"code","42337232":"code","4b3470bc":"code","a0871d91":"code","2e8d526d":"code","f55b0f2a":"code","efcb3518":"code","da0e6d1e":"code","a307230a":"code","1079a75e":"code","8be2a9b5":"code","6c6852f6":"code","b5870273":"code","5865b3a1":"code","2964f7b9":"code","dc449c3e":"code","59315927":"code","4f850a87":"code","f59e3133":"code","07a619f0":"code","62a2ab1e":"code","ac88f06d":"code","1968dd6f":"code","f7d13cbb":"code","7e1801fa":"code","72d922b6":"code","c87f5f7a":"code","cdd26b84":"code","50dd315c":"code","97f1adcb":"code","c9ad03b5":"code","68622eae":"code","f58119bc":"code","e7fabab7":"code","ec2b83ef":"code","11021eac":"code","ccb67254":"code","a9d1a73e":"code","fd6ff79c":"code","e9f59a94":"code","f2e67b72":"code","17c6ac75":"code","ed736293":"code","005d4215":"code","4f2090b5":"code","960017be":"code","1be084b1":"code","97a8bedd":"code","0c8c4d88":"code","d4390b72":"code","c04fa009":"code","65361018":"code","ca917d2b":"code","9bd94686":"code","4c43132a":"code","9942b0d8":"code","9ffaba6b":"code","5c9ee3f1":"code","ec3e68bd":"code","3cef780a":"code","d584bbc7":"code","b0b9884b":"code","2452d182":"code","e1f5e89b":"code","4e738258":"code","5c919166":"code","2649ad44":"code","bb4f0bed":"code","1456b6b9":"code","3ad71d1a":"code","9c1fa574":"code","814e367e":"code","6b590ba8":"code","651f2de2":"code","56a6892c":"code","ab8d56d6":"code","5b786d3d":"code","8537ec6e":"code","9ac74d83":"code","e45fdbb6":"code","5d7e8b0d":"code","e62efb3a":"code","5f66ca49":"code","3ef956fb":"code","b45d5cfc":"code","ee8d8a0c":"code","90beb67d":"code","0ec2d4b6":"code","415e03b9":"code","187ebb0e":"code","cc6ce16c":"code","cc4075b4":"code","e79f7d37":"code","7aa623c8":"code","e1365bb5":"code","2a08adfa":"code","a106fbc3":"code","f2d61f74":"code","86d6eef0":"code","7d2ec67b":"code","6d8deaf6":"code","f6767971":"code","c400f30c":"code","4f6f2de6":"code","68f0f590":"code","95fbdcfc":"code","fb23f813":"code","4a206cf6":"code","4da44f44":"code","7e006f16":"code","58b6b945":"code","26be520f":"code","2ed46cad":"code","b7e292b3":"code","51304947":"code","11521f67":"code","944733e7":"code","27dac163":"code","80480c5a":"code","4dd55986":"code","0f3b289f":"code","be3ab697":"code","47495904":"code","716e7cb6":"code","98906360":"code","6c712bf7":"code","40b9e5d4":"code","ee25f3ef":"code","c999e0b6":"code","190c6c86":"code","b628edd4":"code","7213b6b6":"code","1f21d811":"code","a33629bd":"code","b77b0d5a":"code","3a0ad153":"code","39d24531":"code","45d5dda5":"code","c0620e0b":"code","3c2aabfb":"code","8b66bbea":"code","069bcfa7":"code","33720810":"code","a629247b":"code","4b0cdeef":"markdown","36bb01a7":"markdown","d80559e9":"markdown","0e6bdac1":"markdown","d88556e8":"markdown","895afdb0":"markdown","55f4e395":"markdown","4c56ba3b":"markdown","a0ab0965":"markdown","133d1ee9":"markdown","bb482702":"markdown","94ffef6c":"markdown","9f4767a1":"markdown","c3b2ef38":"markdown","a30c5cc8":"markdown","61af7c72":"markdown","f1b5f72f":"markdown","9439e49a":"markdown","01480e9d":"markdown","6920ff6b":"markdown","5c58d2b3":"markdown","ade0e4f1":"markdown","8a50d8ea":"markdown","bf85b6b2":"markdown","3ba87d83":"markdown","4922a594":"markdown","aec0e527":"markdown","5ff5f291":"markdown","f3f158f6":"markdown","99cf4914":"markdown","884fe0bf":"markdown","c62d7dbc":"markdown","79ce870b":"markdown","a27f8987":"markdown","758c7412":"markdown","31a5fa4d":"markdown","e1f51e53":"markdown","8623df04":"markdown","d0e3cf51":"markdown","3c439871":"markdown","4ed6df3f":"markdown","8d0598b9":"markdown","178837bf":"markdown","05e5ceaa":"markdown"},"source":{"561f6a24":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns","d5c21e02":"import warnings\nwarnings.filterwarnings('ignore')","f4579a64":"# For Kaggle\ntrain_data_raw = pd.read_csv('..\/input\/titanic\/train.csv')\ntest_data_raw = pd.read_csv('..\/input\/titanic\/test.csv')","6412687a":"train_data_raw = pd.read_csv('..\/input\/titanic\/train.csv')\ntest_data_raw = pd.read_csv('..\/input\/titanic\/test.csv')","4efbf090":"train_data_raw.sample(5)","bbfe9c1c":"columns_all = train_data_raw.columns\ncolumns_all","0e5f4e46":"train_data_raw.info()","65d1f641":"train_data_raw.hist(figsize=(9,9))\nplt.tight_layout()","8caa0e9b":"train_data_raw['Survived'].value_counts().apply(lambda x:f'{x} ({x*100\/len(train_data_raw):0.2f}%)')","dc97c78c":"from sklearn.model_selection import train_test_split","54832a71":"train_set,test_set = train_test_split(train_data_raw,test_size=0.2,stratify=train_data_raw['Survived'],random_state=21)","42337232":"train_original = train_set.copy()\ntrain_set.reset_index(drop=True,inplace=True)","4b3470bc":"train_set.sample(5)","a0871d91":"train_set.describe()","2e8d526d":"# No. of unique elements in each column\ntrain_set.apply(lambda x: x.nunique())","f55b0f2a":"num_cols = train_set.select_dtypes('number').columns.drop(['PassengerId','Survived','Pclass']).to_numpy()\ncat_cols = list(train_set.select_dtypes('object').columns.drop(['Name']))\ncat_cols.extend(['Pclass'])\nprint(\"Numerical Columns : \",num_cols)\nprint(\"Categorical Columns : \",cat_cols)","efcb3518":"n_def_num_cols = len(num_cols)\nfig,ax = plt.subplots(round(n_def_num_cols\/2),2,figsize=(10,n_def_num_cols*2))\nfor i,col in enumerate(num_cols):\n  sns.violinplot(x='Survived',y=col,data=train_set,ax=ax.ravel()[i],orient='v',cut=0)\nfig.tight_layout()","da0e6d1e":"fig,ax = plt.subplots(round(n_def_num_cols\/2),2,figsize=(16,n_def_num_cols*2))\nfor i,col in enumerate(num_cols):\n  sns.histplot(x=col,data=train_set,hue='Survived',multiple='dodge',ax=ax.ravel()[i],bins=20,lw=1)\nfig.tight_layout()","a307230a":"sns.pairplot(hue='Survived',data=train_set,corner=True)\nplt.tight_layout()","1079a75e":"train_corr = train_set.corr()","8be2a9b5":"plt.subplots(figsize=(8,7))\nsns.heatmap(train_corr,vmax=1,vmin=-1,annot=True,cmap=sns.color_palette(\"icefire\", as_cmap=True))\nplt.tight_layout()","6c6852f6":"print(\"Correlation of Features with 'Survived' \\n\")\ntrain_corr.loc[:,'Survived'].sort_values(ascending=False).drop('Survived')","b5870273":"print(\"Correlation within Features  \\n\")\nfor i,y in enumerate(train_corr.index):\n    for j,x in enumerate(train_corr.columns.drop('Survived')):\n        if(j<i):\n            continue\n        if ((train_corr.loc[x,y] >0.4) or (train_corr.loc[x,y] <-0.4)) and x!=y:\n            print(f'{x} - {y}  : {train_corr.loc[x,y]}')","5865b3a1":"for i,col in enumerate(['Pclass','Sex','Embarked','Survived']):\n  j=0\n  fig,ax = plt.subplots(1,3,figsize=(16,4),)\n  for col1 in ['Pclass','Sex','Embarked','Survived']:\n    if col1!=col:    \n      sns.countplot(x=col,data=train_set,hue=col1,ax=ax[j])\n      j=j+1\n  \n  fig.suptitle(col,size=16)\n  fig.tight_layout()","2964f7b9":"from scipy.stats import chi2_contingency","dc449c3e":"alpha = 0.05\nfor col in cat_cols:\n  cross_table = pd.crosstab(train_set[col],train_set['Survived'])\n  chi2_stat,p_value, dof, exp = chi2_contingency(cross_table)\n  if p_value <= alpha:\n    print(f\"{col}-Survived \\np-value : \",p_value)\n    print(\"Dependent (reject H0)\",'\\n')\n  else:\n    print(f\"{col}-Survived \\np-value : \",p_value)\n    print(\"Independent (fail to reject H0)\",'\\n')","59315927":"train_set.dtypes","4f850a87":"# Modifying DataType\n#\ntrain_set.loc[:,cat_cols] = train_set[cat_cols].astype('category',errors='ignore')\ntrain_set.loc[:,'PassengerId'] = train_set[['PassengerId']].astype('object',errors='ignore')","f59e3133":"def missing_count(data,cols=None):\n  print(\"Number of Instances : \",len(data))\n  print(\"Number of Missing Values in :\")\n  df = pd.DataFrame(data)\n  if cols==None:\n    cols=df.columns\n  for x in cols:\n    count  = df[x].isna().sum()\n    if count >=1:\n      print(f' - {x} : {count}({count*100\/len(df):0.2f}%)')\n\n","07a619f0":"missing_count(train_set)","62a2ab1e":"train_set.dropna(subset=['Embarked'],inplace=True)\ntrain_set.reset_index(drop=True,inplace=True)","ac88f06d":"pclass_avg_age = train_set.groupby(['Pclass'])['Age'].median()\npclass_avg_age","1968dd6f":"pd.Series(train_set.columns)","f7d13cbb":"train_set.Age = train_set.apply((lambda x: pclass_avg_age[x[8]] if np.isnan(x[0]) else x[0]),axis=1)","7e1801fa":"missing_count(train_set)","72d922b6":"print(\"No. of Entries available : \",train_set.Cabin.notna().sum(),'\\n')\ntrain_set.Cabin.unique()","c87f5f7a":"# Checking if all the values in Cabin starts with an alphabet\npd.Series([str(x)[0].isalpha() if x!=np.nan else False for x in train_set.Cabin.unique()]).sum()","cdd26b84":"# Checking if multiple people have the same cabin\/s\ntrain_set.Cabin.value_counts()","50dd315c":"shared_cabins = train_set.Cabin.value_counts()[train_set.Cabin.value_counts()>1].index\nshared_cabins","97f1adcb":"cabins=[]\nfor x in train_set.Cabin.value_counts().index:\n  if ' ' in x:\n    cabins.extend(x.split(' '))\n  else:\n    cabins.append(x)\nprint(cabins)","c9ad03b5":"cabin_cat = []\ncabin_cat.extend([x[0] for x in cabins])\npd.Series(cabin_cat).value_counts()","68622eae":"for cabin_x in set(cabin_cat):\n  train_set[f'Cabin_{cabin_x}']=[int(cabin_x in str(x)) for x in train_set.Cabin]","f58119bc":"# Categories of Cabins with more than 1 passenger.\n\nfor cabin_ in shared_cabins:\n  train_set[f'Cabin_shared_{cabin_}']=[int(x==cabin_) for x in train_set.Cabin]","e7fabab7":"passengers_in_cabin = train_set.Cabin.value_counts()[train_set.Cabin.value_counts()>1]\npassengers_in_cabin","ec2b83ef":"for n in passengers_in_cabin.unique():\n  train_set[f'{n}_Passenger_Cabin'] =  0\nfor index,x in enumerate(train_set.Cabin):\n  if x in passengers_in_cabin.index:\n    n = passengers_in_cabin[x]\n    train_set.loc[index,f'{n}_Passenger_Cabin'] =  1","11021eac":"train_set.columns","ccb67254":"def clean_data(X):\n\n    # Modifying DataType\n    X.loc[:,cat_cols] = X[cat_cols].astype('category',errors='ignore')\n    X.loc[:,'PassengerId'] = X[['PassengerId']].astype('object',errors='ignore')\n    X.loc[:,num_cols] = X[num_cols].apply(lambda x: pd.to_numeric(x,errors='coerce'),axis=1)\n    \n    #Dropping Missing values in Embarked\n    X.dropna(subset=['Embarked'],inplace=True)\n\n    # Imputing Missing values in Age\n    X.Age = X.apply((lambda x: pclass_avg_age[x[8]] if np.isnan(x[0]) else x[0]),axis=1)\n\n    X = X.reset_index(drop=True)\n\n    if 'Survived' in X:\n      y = X.Survived\n      X = X.drop(['Survived'],axis=1)\n\n      return X,y\n    else:\n      return X\n","a9d1a73e":"train_set.Ticket.nunique()","fd6ff79c":"train_set.Ticket.head(25)","e9f59a94":"# Checking if the initial text in String are random\/unique or if it has any significance\npd.Series([str(x).split(' ')[0] if ' ' in str(x) else x for x in train_set.Ticket]).value_counts()","f2e67b72":"ticket_codes=[]\nfor x in train_set.Ticket.value_counts().index:\n  if ' ' in x:\n    ticket_codes.append(x.split(' ')[0])\nprint(ticket_codes)","17c6ac75":"ticket_codes = [x.replace('.','') for x in ticket_codes]\nticket_pattern_uniq = pd.Series(ticket_codes).unique()\npd.Series(ticket_codes).value_counts()","ed736293":"for x in ticket_pattern_uniq:\n  train_set['Ticket_'+x] = [int(x == str(y).split(' ')[0].replace('.','')) for y in train_set.Ticket]","005d4215":"shared_tickets = train_set.Ticket.value_counts()[train_set.Ticket.value_counts()>1]\nshared_tickets","4f2090b5":"for n in shared_tickets.unique():\n  train_set[f'{n}_Passenger_Ticket'] =  0\nfor index,x in enumerate(train_set.Ticket):\n  if x in shared_tickets.index:\n    n = shared_tickets[x]\n    train_set.loc[index,f'{n}_Passenger_Ticket'] =  1","960017be":"train_set.sample(5)","1be084b1":"train_set['PassengerId']","97a8bedd":"train_set['Name']","0c8c4d88":"train_set['Title'] = train_set['Name'].apply(lambda x: x.split(', ')[1].split('.')[0])\nprint(train_set['Title'].unique())\ntrain_set['Title'].nunique()","d4390b72":"train_set['Title'] = train_set['Title'].replace(['Mlle'],['Ms'])\nprint(train_set['Title'].unique())\ntrain_set['Title'].nunique()","c04fa009":"pd.crosstab(train_set['Survived'],train_set['Title'])","65361018":"fig,ax = plt.subplots(figsize=(12,5))\nsns.countplot(hue='Survived',data=train_set,x='Title',)\nplt.tight_layout()","ca917d2b":"train_set['FamilySize'] = train_set.SibSp +\ttrain_set.Parch\ntrain_set['FamilySize'].unique()","9bd94686":"train_set.drop(['Cabin','Ticket','PassengerId','Name'],axis=1,inplace=True)","4c43132a":"cat_cols_updated = list(cat_cols)\ncat_cols_updated.append('Title')\nnum_cols_updated = list(num_cols)\nnum_cols_updated.append('FamilySize')","9942b0d8":"for i,col in enumerate(['Title','FamilySize']):\n  j=0\n  fig,ax = plt.subplots(1,4,figsize=(24,4),)\n  for col1 in ['Pclass','Sex','Embarked','Survived']:\n      sns.countplot(x=col,data=train_set,hue=col1,ax=ax[j])\n      j=j+1\n  \n  fig.suptitle(col,size=16)\n  fig.tight_layout()","9ffaba6b":"from sklearn.base import TransformerMixin,BaseEstimator","5c9ee3f1":"class FeatureEngineering(TransformerMixin,BaseEstimator):\n\n  def __init__(self):\n    self\n  \n  def fit(self,X,y=None):\n    return self\n\n  def transform(self,X,y=None):\n\n    X = X.reset_index(drop=True)\n\n    # Creating Feature 'Title'\n    X['Title'] = X['Name'].apply(lambda x: x.split(', ')[1].split('.')[0])\n    X['Title'] = X['Title'].replace(['Mlle'],['Ms'])\n\n    # Creating Feature 'FamilySize'\n    X['FamilySize'] = X.SibSp +\tX.Parch\n\n\n    #cabins=[]\n    #cabin_cat = []\n    #for x in X.Cabin.value_counts().index:\n    #  if ' ' in x:\n    #    cabins.extend(x.split(' '))\n    #  else:\n    #    cabins.append(x)\n    #cabin_cat.extend([x[0] for x in cabins])\n    for cabin_x in set(cabin_cat):\n      X[f'Cabin_{cabin_x}']=[int(cabin_x in str(x)) for x in X.Cabin]\n\n    #shared_cabins = X.Cabin.value_counts()[X.Cabin.value_counts()>1].index\n    for cabin_ in shared_cabins:\n      X[f'Cabin_shared_{cabin_}']=[int(x==cabin_) for x in X.Cabin]\n\n    #passengers_in_cabin = X.Cabin.value_counts()[X.Cabin.value_counts()>1]\n    for n in passengers_in_cabin.unique():\n      X[f'{n}_Passenger_Cabin'] =  0\n    for index,x in enumerate(X.Cabin):\n      if x in passengers_in_cabin.index:\n        n = passengers_in_cabin[x]\n        X.loc[index,f'{n}_Passenger_Cabin'] =  1\n\n\n    #ticket_codes=[]\n    #for x in X.Ticket.value_counts().index:\n    #  if ' ' in x:\n    #    ticket_codes.append(x.split(' ')[0])\n    #ticket_codes = [x.replace('.','') for x in ticket_codes]\n    #ticket_pattern_uniq = pd.Series(ticket_codes).unique()\n    for x in ticket_pattern_uniq:\n      X['Ticket_'+x] = [int(x == str(y).split(' ')[0].replace('.','')) for y in X.Ticket]\n\n    for ticket_ in shared_tickets.index:\n      X[f'Ticket_shared_{ticket_}']=[int(x==ticket_) for x in X.Ticket]\n\n    #shared_tickets = X.Ticket.value_counts()[X.Ticket.value_counts()>1]\n    for n in shared_tickets.unique():\n      X[f'{n}_Passenger_Ticket'] =  0\n    for index,x in enumerate(X.Ticket):\n      if x in shared_tickets.index:\n        n = shared_tickets[x]\n        X.loc[index,f'{n}_Passenger_Ticket'] =  1\n\n    X = X.drop(['PassengerId','Name','Ticket', 'Cabin'],axis=1)\n\n    return X\n","ec3e68bd":"# A custom transformer to view the data inbetween the various stages of the pipeline\nclass TransformationSubStage(TransformerMixin,BaseEstimator):\n\n  def __init__(self):\n    self\n    self.transformed_X = None\n    self.transformed_y = None\n  \n  def fit(self,X,y=None):\n    return self\n\n  def transform(self,X,y=None):\n    self.transformed_X = X\n    self.transformed_y = y\n    return X","3cef780a":"from sklearn.pipeline import Pipeline\nfrom sklearn.compose import ColumnTransformer\nfrom sklearn.impute import SimpleImputer\nfrom sklearn.decomposition import PCA","d584bbc7":"from sklearn.preprocessing import StandardScaler,OneHotEncoder","b0b9884b":"sub_pipe1 = Pipeline([\n                      ('imputer',SimpleImputer(strategy='most_frequent')),\n                      (('ohe',OneHotEncoder(handle_unknown='ignore')))\n])","2452d182":"coltransformer = ColumnTransformer([\n                                    ('num_impute',SimpleImputer(strategy='median'),['Age', 'SibSp', 'Parch', 'FamilySize']),\n                                    ('num_impute2',SimpleImputer(strategy='mean'),['Fare']),\n                                    ('cat_impute',sub_pipe1,['Sex', 'Embarked', 'Pclass', 'Title'])\n],remainder='passthrough')","e1f5e89b":"pipe = Pipeline([\n                 ('feat_engg',FeatureEngineering()),\n                 ('substage_feat_engg',TransformationSubStage()),\n                 ('coltransformer',coltransformer),\n                 ('substage_coltransformer',TransformationSubStage()),\n                 ('num',StandardScaler()),\n])","4e738258":"X_train,y_train = clean_data(train_original)\nX_train = pipe.fit_transform(X_train)","5c919166":"X_train.shape","2649ad44":"X_test,y_test = clean_data(test_set)\nX_test = pipe.transform(X_test)","bb4f0bed":"from sklearn.linear_model import LogisticRegression,LogisticRegressionCV\nfrom sklearn.svm import SVC,LinearSVC\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.ensemble import RandomForestClassifier,VotingClassifier,AdaBoostClassifier,GradientBoostingClassifier\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.naive_bayes import GaussianNB","1456b6b9":"from sklearn.metrics import accuracy_score","3ad71d1a":"from sklearn.model_selection import cross_val_score,GridSearchCV,RandomizedSearchCV","9c1fa574":"models = {}","814e367e":"logreg_gridSearch = LogisticRegressionCV(solver='saga',penalty='elasticnet',Cs=[0.1,0.2,0.5,1,10,15,20,25,50,100,100],l1_ratios=[0,0.35,0.5,0.65,1],n_jobs=-1,cv=3,random_state=0)\nlogreg_gridSearch.fit(X_train,y_train)","6b590ba8":"logreg = LogisticRegression(solver='saga',penalty='elasticnet',C=logreg_gridSearch.C_[0],l1_ratio=logreg_gridSearch.l1_ratio_[0],n_jobs=-1,random_state=0)\nlogreg.fit(X_train,y_train)","651f2de2":"accuracy = accuracy_score(y_test,logreg.predict(X_test))\naccuracy","56a6892c":"models['Logistic Regression'] = accuracy","ab8d56d6":"params ={'C':[0.01,0.1,1,2,5,10,20,50,100,1000],\n         'penalty':['l1','l2']}\nlin_svc = GridSearchCV(LinearSVC(random_state=0),params)","5b786d3d":"lin_svc.fit(X_train,y_train)\nlin_svc.best_params_","8537ec6e":"lin_svc = lin_svc.best_estimator_","9ac74d83":"accuracy = accuracy_score(y_test,lin_svc.predict(X_test))\naccuracy","e45fdbb6":"models['Linear SVC'] = accuracy","5d7e8b0d":"params ={'C':[0.01,0.1,1,2,5,10,20,50,100,1000],\n         'kernel':['rbf','sigmoid']}\nsvc = GridSearchCV(SVC(random_state =0,probability=True),params)","e62efb3a":"svc.fit(X_train,y_train)","5f66ca49":"svc.best_params_","3ef956fb":"svc = svc.best_estimator_","b45d5cfc":"accuracy = accuracy_score(y_test,svc.predict(X_test))\naccuracy","ee8d8a0c":"models['SVC'] = accuracy","90beb67d":"dt_clf = DecisionTreeClassifier(random_state =0)\ndt_clf.fit(X_train,y_train)","0ec2d4b6":"accuracy = accuracy_score(y_test,dt_clf.predict(X_test))\naccuracy","415e03b9":"models['Decision Tree'] = accuracy","187ebb0e":"!pip install -q optuna","cc6ce16c":"import optuna","cc4075b4":"def objective(trial):\n\n  max_features=trial.suggest_float('max_features',0.3,1,step=0.05)\n  max_samples=trial.suggest_float('max_samples',0.3,0.95,step=0.05)\n  min_samples_split=trial.suggest_float('min_samples_split',0.01,0.11,step=0.01)\n  class_weight=trial.suggest_categorical('class_weight',['balanced', 'balanced_subsample',None])\n\n  clf = RandomForestClassifier(max_features=max_features, max_samples=max_samples, min_samples_split=min_samples_split,class_weight=class_weight,random_state =0)\n\n  return cross_val_score(clf,X_train,y_train,cv=3,n_jobs=-1,scoring='accuracy').mean()","e79f7d37":"study = optuna.create_study(direction='maximize')\nstudy.optimize(objective,n_trials=50)","7aa623c8":"best_trial = study.best_trial\nprint(\"Accuracy : \",best_trial.value)\nbest_trial.params","e1365bb5":"rf_clf = RandomForestClassifier(**best_trial.params,random_state =0)\nrf_clf.fit(X_train,y_train)","2a08adfa":"accuracy = accuracy_score(y_test,rf_clf.predict(X_test))\naccuracy","a106fbc3":"models['Random Forest'] = accuracy","f2d61f74":"params = {'n_neighbors' : [2,3,4,5,6,7,8,9,10]}\nknn_clf = GridSearchCV(KNeighborsClassifier(), params)","86d6eef0":"knn_clf.fit(X_train,y_train)","7d2ec67b":"knn_clf.best_params_","6d8deaf6":"accuracy = accuracy_score(y_test,knn_clf.predict(X_test))\naccuracy","f6767971":"models['K-Nearest Neighbor'] = accuracy","c400f30c":"params = {'var_smoothing': np.logspace(0,-9, num=100)}\nnb_clf = GridSearchCV(GaussianNB(), params)","4f6f2de6":"nb_clf.fit(X_train,y_train)","68f0f590":"nb_clf.best_params_","95fbdcfc":"accuracy = accuracy_score(y_test,nb_clf.predict(X_test))\naccuracy","fb23f813":"models['Gaussian Naive Bayes'] = accuracy","4a206cf6":"import xgboost as xgb","4da44f44":"cv = cross_val_score(xgb.XGBClassifier(),X_train,y_train,cv=5)\nprint(cv)\nprint(cv.mean())","7e006f16":"tst = xgb.XGBClassifier().fit(X_train,y_train)\naccuracy_score(y_test,tst.predict(X_test))","58b6b945":"n_iter = []\ndef objective_xgb(trial):\n\n  params = {\n      'learning_rate' : trial.suggest_loguniform('learning_rate',1e-8,0.5),\n      'max_depth' : trial.suggest_int('max_depth',8,33),\n      'subsample' : trial.suggest_float('subsample',0.5,1),\n      'colsample_bynode' : trial.suggest_float('colsample_bynode',0.5,1),\n      'lambda' : trial.suggest_loguniform(\"lambda\", 1e-8, 1.0),\n      'alpha': trial.suggest_loguniform(\"alpha\", 1e-8, 1.0),\n      'gamma' : trial.suggest_loguniform(\"gamma\", 1e-8, 1.0),\n                \n      'objective':'binary:logistic','random_state':0\n  }\n  \n  dtrain = xgb.DMatrix(X_train,y_train)\n\n\n  cv = xgb.cv(params, dtrain, num_boost_round=1000, metrics='auc', early_stopping_rounds=50)\n  n_iter.append(len(cv))\n\n  return cv.mean()['test-auc-mean']","26be520f":"study = optuna.create_study(direction='maximize')\nstudy.optimize(objective_xgb,n_trials=750)","2ed46cad":"best_trial = study.best_trial\nprint(\"Accuracy : \",best_trial.value)\nbest_trial.params","b7e292b3":"n_iter[best_trial.number]","51304947":"xgb_clf = xgb.XGBClassifier(**best_trial.params,n_estimators=n_iter[best_trial.number],random_state =0)\nxgb_clf","11521f67":"xgb_clf.fit(X_train,y_train)","944733e7":"accuracy = accuracy_score(y_test,xgb_clf.predict(X_test))\naccuracy","27dac163":"models['XGBoost'] = accuracy","80480c5a":"models","4dd55986":"adaboost_base = AdaBoostClassifier(random_state=0)\nadaboost_base.fit(X_train,y_train)\naccuracy = accuracy_score(y_test,adaboost_base.predict(X_test))\naccuracy","0f3b289f":"def objective_adaboost(trial):\n\n  params = {\n      'n_estimators':trial.suggest_int('n_estimators',2,200),\n      'learning_rate' : trial.suggest_loguniform('learning_rate',1e-6,0.5)\n  }\n\n  clf = AdaBoostClassifier(**params,random_state=0)\n\n  cv_score = cross_val_score(clf,X_train, y_train , scoring='accuracy', cv=3, n_jobs=-1,)\n\n  return cv_score.mean()","be3ab697":"study = optuna.create_study(direction='maximize')\nstudy.optimize(objective_adaboost,100)","47495904":"best_trial = study.best_trial\nbest_trial.params","716e7cb6":"adaboost_clf = AdaBoostClassifier(**best_trial.params,random_state =0).fit(X_train,y_train)\naccuracy = accuracy_score(y_test,adaboost_clf.predict(X_test))\naccuracy\n# 0.8379888268156425","98906360":"models['AdaBoost Classifier'] = accuracy\nmodels","6c712bf7":"votting_clf = VotingClassifier([('Linear SVC',lin_svc),('Logistic Regression',logreg),('SVC',svc),('Random Forest',rf_clf),('K-Nearest Neighbor',knn_clf)],n_jobs=-1)\nvotting_clf.fit(X_train,y_train)","40b9e5d4":"accuracy = accuracy_score(y_test,votting_clf.predict(X_test))\naccuracy","ee25f3ef":"votting_clf2 = VotingClassifier([('Logistic Regression',logreg),('SVC',svc),('Random Forest',rf_clf),('K-Nearest Neighbor',knn_clf)],voting='soft',n_jobs=-1)\nvotting_clf2.fit(X_train,y_train)","c999e0b6":"accuracy = accuracy_score(y_test,votting_clf2.predict(X_test))\naccuracy","190c6c86":"votting_clf3 = VotingClassifier([('SVC',svc),('AdaBoost',adaboost_clf),('XGBoost',xgb_clf),],voting='soft',n_jobs=-1)\nvotting_clf3.fit(X_train,y_train)","b628edd4":"accuracy = accuracy_score(y_test,votting_clf3.predict(X_test))\naccuracy","7213b6b6":"test_data_raw.shape","1f21d811":"test_data_raw.describe()","a33629bd":"X_test_data = clean_data(test_data_raw)\nX_test_data = pipe.transform(X_test_data)","b77b0d5a":"vot_clf1_result = votting_clf.predict(X_test_data).astype(int)\nvot_clf2_result = votting_clf2.predict(X_test_data).astype(int)\nvot_clf3_result = votting_clf3.predict(X_test_data).astype(int)","3a0ad153":"svc_result = svc.predict(X_test_data).astype(int)\nsub_data = {'PassengerId': test_data_raw.PassengerId, 'Survived': svc_result}\nsubmission = pd.DataFrame(data=sub_data)\nsubmission.to_csv('submission_svc.csv', index =False)","39d24531":"sub_data = {'PassengerId': test_data_raw.PassengerId, 'Survived': vot_clf1_result}\nsubmission = pd.DataFrame(data=sub_data)\nsubmission.to_csv('submission_vot_clf1.csv', index =False)","45d5dda5":"sub_data = {'PassengerId': test_data_raw.PassengerId, 'Survived': vot_clf2_result}\nsubmission = pd.DataFrame(data=sub_data)\nsubmission.to_csv('submission_vot_clf2.csv', index =False)","c0620e0b":"sub_data = {'PassengerId': test_data_raw.PassengerId, 'Survived': vot_clf3_result}\nsubmission = pd.DataFrame(data=sub_data)\nsubmission.to_csv('submission_vot_clf3.csv', index =False)","3c2aabfb":"logreg_result = logreg.predict(X_test_data).astype(int)\nsub_data = {'PassengerId': test_data_raw.PassengerId, 'Survived': logreg_result}\nsubmission = pd.DataFrame(data=sub_data)\nsubmission.to_csv('submission_logreg.csv', index =False)","8b66bbea":"lin_SVC_result = lin_svc.predict(X_test_data).astype(int)\nsub_data = {'PassengerId': test_data_raw.PassengerId, 'Survived': lin_SVC_result}\nsubmission = pd.DataFrame(data=sub_data)\nsubmission.to_csv('submission_linSVC.csv', index =False)","069bcfa7":"xgboost_result = xgb_clf.predict(X_test_data).astype(int)\nsub_data = {'PassengerId': test_data_raw.PassengerId, 'Survived': xgboost_result}\nsubmission = pd.DataFrame(data=sub_data)\nsubmission.to_csv('submission_xgboost.csv', index =False)","33720810":"adaboost_result = adaboost_clf.predict(X_test_data).astype(int)\nsub_data = {'PassengerId': test_data_raw.PassengerId, 'Survived': adaboost_result}\nsubmission = pd.DataFrame(data=sub_data)\nsubmission.to_csv('submission_adaboost_result.csv', index =False)","a629247b":"# For Colab\n# Submissuion\n#!kaggle competitions submit -c titanic -f submission_vot_clf2.csv -m \"VotingClassifier2\"","4b0cdeef":"### Random Forest Classifier (Ensemble)","36bb01a7":"We will create a Custom Transformer to extract\/create new features","d80559e9":"We shall impute the missing values in 'Age'. We had noticed that 'Pclass' had the highest correlation with 'Age', so instead of taking the median of the whole training set, we shall impute with class-wise(ticket) median age.","0e6bdac1":"- The Ticket class has the highest correlation with the target column 'Survived'\n- The ticket fare and the ticket class are correlated which makes much sense.\n- Also the number of siblings\/spouses aboard is correlated with the number of parents\/children aboard.","d88556e8":"- PassengerId column contains unique integer values only, no useful information can be extracted from them. Dropping is ideal.","895afdb0":"As we can see, some of the insights that can be drawn are\n- The survival chances for females were much higher than males.\n- The chances of survival  were higher for Individuals with TicketClass('Pclass')-1. Passengers with Class-1 Ticket has survived more than any other class.\n- Passengers who embarked from port Cherbourg has a higher survival ratio.\n- Most passengers with 1st class tickets survived and the survival rate was much higher than any other ticket class. It could also be noted that there were no 1st class passengers from Queenstown.\n- Passengers embarked from Cherbourg has higher survival ratio.\n\n","55f4e395":"Only 'Cabin' had no relation with 'Survived' column. This could also be due to the unavailability of over 75% of the data for 'Cabin'","4c56ba3b":"# Data Preparation","a0ab0965":"# Exploratory Data Analysis","133d1ee9":"### Feature - 'PassengerId'","bb482702":"- Embarked has 2 values missing, we could remove the entry\/instance since its only 2.\n- Age has 140 values missing, which constitutes about 20% of the whole data. We could impute these missing values.\n- Cabin has more than 75% of missing values. Ideally we should drop this feature or find some way to extract any available information if possible.","94ffef6c":"### Linear SVC","9f4767a1":"### Feature - 'Embarked '","c3b2ef38":"- All passengers have a title in their name and to be specific there are 14 titles. \n- Mlle is French for Ms, so we shall replace this.","a30c5cc8":"## Building a Pipeline","61af7c72":"### Decision Tree Classifier","f1b5f72f":"### Feature - 'Ticket'","9439e49a":"Initial Inferences :\n\n- The dataset is mildly imbalanced.\n- The columns 'PassengerId' & 'Name' are unique identifiers.\n- 'Survived' is the target column that we have to predict.\n- The columns 'Pclass', 'Sex' and 'Embarked' are categorical columns and the rest are numerical.\n- The column 'SibSp' should ideally be integer value.\n","01480e9d":"- For passenger 'Name', all seems to have a 'Title'.","6920ff6b":"### Gaussian Naive Bayes Classifier","5c58d2b3":"# ML Modeling","ade0e4f1":"We shall create a method to do the above done cleaning tasks","8a50d8ea":"### Voting Classifier (Ensemble)","bf85b6b2":"We could also try to group Cabins by the number of passengers in it and also by Cabins with more than 1 passenger as passengers in groups may have higher chance of survival.","3ba87d83":"- There are 891 records and there are missing values in some of the columns.","4922a594":"'Cabin' has over 77% of its values missing, dropping the column is the ideal choice. But before droping, we shall try to extract any information if possible.","aec0e527":"### Feature - 'Age'","5ff5f291":"As we can see, all of 119 unique elements starts with an alphabet. We could group the Cabin codes using this initial alphabet character.","f3f158f6":"## Feature Engineering","99cf4914":"- We can see that, the survival rate is higher for the kids and elderly. The survial rate for inividuals between 20-30 is very low.\n- We could also observe that the chances of survival is increasing with the price paid for the ticket.","884fe0bf":"### Feature - 'SibSp' & 'Parch'","c62d7dbc":"### K-Nearest Neighbor Classifier","79ce870b":"### Feature - 'Cabin'","a27f8987":"- The classification of survival isnt linearly seperable with any of the feature.\n- There arent any distinct correlation within various features.","758c7412":"We could also add a feature of Family Size","31a5fa4d":"The tickets seems much more random at first glance apart from the fact that they are mostly numerical or numericals preceeded by some text. Individuals travelling together will have the same ticket code.","e1f51e53":"We have now extracted information from the features 'Cabin','Ticket' and 'Name' and now we shall drop these columns along with 'PassengerId'.\n","8623df04":"# Kaggle Submission","d0e3cf51":"We could follow a similar approach to 'Ticket' as in 'Cabin'. We shall try to extract any useful information possible from Ticket column.","3c439871":"We shall create a copy of train_set so as to not loose the original training set during feature engineering.","4ed6df3f":"We shall split our training data to train-test set before proceeding further to avoid any data leakage into test set.","8d0598b9":"### SVC","178837bf":"### AdaBoost Classifier (Ensemble)","05e5ceaa":"### Logistic Regression"}}