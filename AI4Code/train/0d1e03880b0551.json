{"cell_type":{"680ea194":"code","7a7b9eb8":"code","90f89962":"code","273d83ba":"code","df4c20d9":"code","d8f543a8":"code","5516e084":"code","ef55c4ad":"code","8c0f557e":"code","7ba39b4d":"code","7e49995e":"code","fa5116a9":"code","c8f80788":"code","903dade8":"code","3ae129da":"code","6df5e272":"markdown","238bd118":"markdown","c36d0da9":"markdown","768d5593":"markdown","c909a7c7":"markdown","fe48d0b4":"markdown","90c5047f":"markdown","2987e1fd":"markdown","d708a183":"markdown","45b22d8e":"markdown","5adc97d2":"markdown","ca3efb4b":"markdown","a006a340":"markdown","5deca096":"markdown","fc1bc4d2":"markdown","41137c49":"markdown","67838c0b":"markdown","0a80554e":"markdown"},"source":{"680ea194":"import pandas as pd\ndf_ = pd.read_excel(\"..\/input\/uci-online-retail-ii-data-set\/online_retail_II.xlsx\", sheet_name = \"Year 2010-2011\")\ndf = df_.copy()","7a7b9eb8":"# Invoice code starts with the letter 'C',indicates a cancellation.\n# That's why chose the ones by using ~ which do not contains \"C\"\ndf = df[~df[\"Invoice\"].astype(str).str.contains(\"C\", na=False)]\n\n# Be sure that each quantity value is bigger than 0:\ndf = df[(df['Quantity'] > 0)]\n\n# Drop missing values:\ndf.dropna(inplace=True)","90f89962":"# TotalPrice variable is created by using Quantity and Price values:\ndf[\"TotalPrice\"] = df[\"Quantity\"] * df[\"Price\"]","273d83ba":"# cltv_df dataframe is created in order for ease of calculation and observation\ncltv_df = df.groupby('Customer ID').agg({'Invoice': lambda x: len(x),\n                                         'Quantity': lambda x: x.sum(),\n                                         'TotalPrice': lambda x: x.sum()})","df4c20d9":"# total transaction, total unit, total price\ncltv_df.columns = ['total_transaction', 'total_unit', 'total_price']","d8f543a8":"cltv_df.head()","5516e084":"cltv_df[\"avg_order_value\"] = cltv_df[\"total_price\"]\/ cltv_df[\"total_transaction\"]","ef55c4ad":"#Customer number:\ncltv_df.shape[0]\n\ncltv_df[\"purchase_frequency\"] = cltv_df[\"total_transaction\"]\/cltv_df.shape[0]","8c0f557e":"repeat_rate = cltv_df[cltv_df.total_transaction > 1].shape[0]\/cltv_df.shape[0]\n\nchurn_rate = 1- repeat_rate","7ba39b4d":"# profit margin : 5 %\ncltv_df[\"profit_margin\"] = cltv_df[\"total_price\"]* 0.05\ncltv_df.head()","7e49995e":"# Customer Value(CV):\ncltv_df[\"CV\"] = cltv_df[\"avg_order_value\"] * cltv_df[\"purchase_frequency\"]\ncltv_df.head()\n\n#Customer Lifetime Value(CLTV):\ncltv_df[\"CLTV\"] = (cltv_df[\"CV\"] \/churn_rate)* cltv_df[\"profit_margin\"]\n\ncltv_df.sort_values(\"CLTV\", ascending = False)","fa5116a9":"from sklearn.preprocessing import MinMaxScaler\n\nscaler = MinMaxScaler(feature_range= (1,100))\nscaler.fit(cltv_df[[\"CLTV\"]])\ncltv_df[\"SCALED_CLTV\"] = scaler.transform(cltv_df[[\"CLTV\"]])\ncltv_df.sort_values(\"CLTV\", ascending = False)","c8f80788":"cltv_df[[\"total_transaction\", \"total_unit\",\"total_price\",\"CLTV\", \"SCALED_CLTV\"]].\\\nsort_values(by = \"SCALED_CLTV\",ascending= False).head()","903dade8":"cltv_df[\"Segment\"] = pd.qcut(cltv_df[\"SCALED_CLTV\"], 4, labels = [\"D\", \"C\", \"B\", \"A\"])","3ae129da":"cltv_df.groupby(\"Segment\")[[\"total_transaction\", \"total_unit\", \"total_price\", \"CLTV\", \"SCALED_CLTV\"]].agg(\n    {\"count\", \"mean\", \"sum\"})","6df5e272":" Values are converted between 1-100 with minmaxscaler to better interpret the cltv value","238bd118":"### Profit Margin\n\n\nHere for this problem profit margin is chosen as 5%, actually the calculated value here can be called as Profit\nHowever it can be named as profit margin in order not to confuse the formulas.\n","c36d0da9":"\n## Calculate Customer Lifetime Value\n\nCustomer value (CV) is calculated by using average order value and purchase frequency. Then by using CV, profit margin and churn rate CLTV is calculated.\n","768d5593":"Then, new dataframe is created","c909a7c7":"Total transaction, total unit, total price, CLTV and SCALED CLTV values are interpreted with their count, sum, and mean values.","fe48d0b4":"Firms use many techniques and methods to make these critical decisions. Customer lifetime value (also called CLV or CLTV ) is one of the technique which is rapidly gaining acceptance as a metric to acquire, grow, and retain the \u201cright\u201d customers in customer relationship management (CRM).\n\nCustomer lifetime value for a firm is the net profit or loss to the firm from a customer over the entire life of transactions of that customer with the firm.\n\nThroughout this project, customer lifetime value example for the calculation will be discussed with and customers will be divided into 4 segments according to CLTV value.\n\n#### Data Set Information:\nThis Online Retail II data set contains all the transactions occurring for a UK-based and registered, non-store online retail between 01\/12\/2009 and 09\/12\/2011. The company mainly sells unique all-occasion gift-ware. Many customers of the company are wholesalers.\n\n**Invoice:** Invoice number. Nominal. A 6-digit integral number uniquely assigned to each transaction. If this code starts with the letter \u2018c\u2019, it indicates a cancellation.\n\n**StockCode:** Product (item) code. Nominal. A 5-digit integral number uniquely assigned to each distinct product.\n\n**Description:** Product (item) name.\n\n**Quantity:** The quantities of each product (item) per transaction.\n\n**InvoiceDate:** Invice date and time. Numeric. The day and time when a transaction was generated.\n\n**UnitPrice:** Unit price. Numeric. Product price per unit in sterling.\n\n**CustomerID:** Customer number. Nominal. A 5-digit integral number uniquely assigned to each customer.\n\n**Country:** Country name. Nominal. The name of the country where a customer resides.","90c5047f":"\n### Repeat Rate & Churn Rate\n\n\nIf total transaction is bigger than 1 means that these customers were here more than once\nFor repeat rate, the value where the total transaction is greater than 1 is selected.\n\n\n**Repeat Rate** = Number of customers who have purchased more than once \/ Number of Customers\n\nThe churn rate, also known as the customer churn, is the rate at which customers stop doing business with an instution.\n\nFormula for the calculation of churn rate:\n**churn_rate** = 1- repeat_rate\n","2987e1fd":"Calculation started with data preparation. First of all, since the letter \"C\" indicates the cancelation the values which do not contains \"C\" in the invoice code are selected. Quantity value is greater than zero was confirmed and missing values were dropped.","d708a183":" For comparison of values, variables are chosen from dataframe and values are sorted by \"SCALED_CLTV\"\n","45b22d8e":"Purchase Frequency= Total Number of Orders \/ Total Number of Customers\n\nPurchase Frequency Calculation","5adc97d2":"### DATA PREPARATION","ca3efb4b":"# Customer Lifetime Value Calculation","a006a340":"Total price variable which is required for customer lifetime value calculation is created by using Quantity and Price values. ","5deca096":"For CV calculation AOV and Frequency is required\n\nAverage Order Value = Total Revenue \/ Total Number of Orders\n\nAOV Calculation:","fc1bc4d2":" cltv_df columns are renamed","41137c49":"Required dataset was read and the necessary library was imported. \nNote: Libraries will be imported where they necessary during the calculation.","67838c0b":"Segments are created by using qcut.\n\nSegments are helpful to make the customer experience personalized","0a80554e":"## Let's remember required formulas for Customer Lifetime Value Calculation\n\n### - Average_Order_Value = Total_Revenue \/ Total_Number_of_Orders\n### - Purchase_Frequency =  Total_Number_of_Orders \/ Total_Number_of_Customers\n### - Customer_Value(CV)  = Average_Order_Value * Purchase_Frequency\n\n### - Churn_Rate = 1 - Repeat_Rate\n### - Profit_margin\n### - CLTV = (Customer_Value \/ Churn_Rate) x Profit_margin."}}