{"cell_type":{"243b5204":"code","6b66b667":"code","8eee6b81":"code","e3d74d6b":"code","bfec86d6":"code","e65ccfec":"code","d614517a":"code","de8819c1":"code","c0ead146":"code","9edc9a74":"code","bdf9eeab":"code","744490a0":"code","56504be9":"code","7d404959":"code","69547c94":"markdown","e06a5871":"markdown","6e65fccf":"markdown","f3dc62ba":"markdown","3f8dcbec":"markdown","2859a7d5":"markdown","bb018676":"markdown","24d4a807":"markdown","0c7539da":"markdown","0c935748":"markdown","08c28c55":"markdown","67491738":"markdown"},"source":{"243b5204":"# Check NVIDIA System Management Interface\n!nvidia-smi","6b66b667":"# If you'd like to see your GPU (maybe to see if it's CUDA compatible)\n!lspci | grep -i nvidia","8eee6b81":"# If you's like to see the location of CUDA\n!whereis cuda","e3d74d6b":"# If you'd like to see CUDA version\n!nvcc --version","bfec86d6":"# Check presence of CuDNN \n!whereis cudnn","e65ccfec":"# Check version of cudnn\n!cat \/usr\/include\/cudnn_version.h","d614517a":"# Check is TensorFlow can access GPU\nfrom tensorflow.python.client import device_lib\ndevice_lib.list_local_devices()","de8819c1":"# Alternatively, check device name\nimport tensorflow as tf\ntf.test.gpu_device_name()","c0ead146":"# Check for CUDA\ntf.test.is_built_with_cuda()","9edc9a74":"# Download models\n!git clone --depth 1 https:\/\/github.com\/tensorflow\/models\n\n# Compile proto files \n%cd models\/research\n!pip install protobuf\n!protoc object_detection\/protos\/*.proto --python_out=.\n%cd ..\n%cd ..\n\n# Install cocoapi\n!pip install cython \n!git clone https:\/\/github.com\/cocodataset\/cocoapi.git\n%cd cocoapi\/PythonAPI\n!make\n%cd ..\n%cd ..\n!cp -r cocoapi\/PythonAPI\/pycocotools models\/research\/\n\n# Install object detection api\n%cd models\/research\n!cp object_detection\/packages\/tf2\/setup.py .\n!python -m pip install .\n%cd ..\n%cd ..","bdf9eeab":"# View tensorflow installation\n!pip freeze | grep tensorflow","744490a0":"# Uninstall version 2.5\n!pip uninstall tf-models-official --yes\n# Install version 2.4\n!pip install tensorflow==2.4\n!pip install tf-models-official==2.4","56504be9":"# View tensorflow installation\n!pip freeze | grep tensorflow","7d404959":"# Verify TensorFlow 2 Object Detection API installation (optional)\n%cd models\/research\n!python object_detection\/builders\/model_builder_tf2_test.py\n%cd ..\n%cd ..","69547c94":"## Motivation\nRecently I wanted to train an **object detection** model using **TensorFlow** on a **GPU**. The installation that had worked for me about 5-6 months ago didn't seem to work this time. The TF2 OD API has been updated (to version 2.5) since then and the CUDA (v11.2) doesn't seem to be compatible with that offered by Kaggle (v11.0). After much exploration and deliberation I decided to create <a href=\"https:\/\/www.kaggle.com\/questions-and-answers\/253611\">this topic<\/a>. Eventually I found a rather simple way around it - using an older version of the API. \n\nThis notebook demonstrates installation of (a specific version of) the **TensorFlow 2 Object Detection API**.","e06a5871":"I'm Akshit Bhalla. I work on machine learning technologies as a Software Engineer. I'm passionate about Deep Learning and I'm a TensorFlow fan. Connect with me on <a href=\"https:\/\/www.linkedin.com\/in\/akshit-bhalla\/\">LinkedIn<\/a>. \n\n**If you found this notebook helpful or it taught you something new, please consider upvoting it. Thank you!**","6e65fccf":"For **STEP 3** let's look for an existing installation and then check version","f3dc62ba":"For **STEP 1** and **STEP 2** see NVIDIA System Management Interface. It provides monitoring and management capabilities for NVIDIA's Tesla devices. ","3f8dcbec":"### GPU Support for TensorFlow Object Detection API\n#### At the time of writing (July 2021), the API uses TF 2.5. Currently, for TensorFlow to run on a (CUDA compatible) GPU the following are required to be present:\n#### 1. Nvidia GPU (GTX 650 or newer) \n#### 2. CUDA Toolkit v11.2\n#### 3. CuDNN 8.1.0\n\nSource: <a href=\"https:\/\/tensorflow-object-detection-api-tutorial.readthedocs.io\/en\/latest\/install.html\">TensorFlow 2 Object Detection API<\/a> and <a href=\"https:\/\/www.tensorflow.org\/install\/gpu\">TensorFlow<\/a>","2859a7d5":"Notably, this does not stop us from using GPU with the TensorFlow API itself.","bb018676":"**What options do we have?**\n1. We could upgrade to CUDA v11.2. I found this <a href=\"https:\/\/medium.com\/analytics-vidhya\/installing-any-version-of-cuda-on-ubuntu-and-using-tensorflow-and-torch-on-gpu-b1a954500786\">blog<\/a> useful for doing so. But it involves installing 2-3GB CUDA Toolkit from <a href=\"https:\/\/developer.nvidia.com\/cuda-11.2.0-download-archive?target_os=Linux&target_arch=x86_64&target_distro=Ubuntu&target_version=1804&target_type=runfilelocal\">here<\/a> and other complicated software engineering that's especially difficult on Kaggle.\n2. We can work with an older version of TensorFlow.\n\n**How do we work with an older version?**\n1. Install the latest TF2 OD API (v2.5). You'll also find a directory structure with everything you need.\n2. Uninstall tf-models-official v2.5\n3. Install tensorflow v2.4\n4. Install tf-models-official v2.4 (it is compatible with the hardware\/software configuration)","24d4a807":"1. Let's look <a href=https:\/\/en.wikipedia.org\/wiki\/CUDA> here <\/a> to see if we have the right GPU. Clearly, Tesla P100-PCIE-16GB **>** GTX 650. **STEP 1** \u2714\ufe0f\n\n2. CUDA 11.0 < 11.2. **STEP 2**  \u274c ","0c7539da":"We see *CUDNN_MAJOR 8* and *CUDNN_MINOR 0* which means version 8.0 < 8.1. **STEP 3** \u274c ","0c935748":"All necessary libraries have been installed, as evident from the success messages at the beginning. The API uses GPU for training.","08c28c55":"Clearly, TensorFlow is able access GPU and everything seems normal. What we need to ensure is that the **TensorFlow 2 Object Detection API** is able to access the **GPU**.","67491738":"### TensorFlow Object Detection API Installation\n#### 1. Downloading the TensorFlow Model Garden\n>workspace\/\n\n>\u2514\u2500 models\/\n\n>        \u251c\u2500 community\/\n\n>        \u251c\u2500 official\/\n\n>        \u251c\u2500 orbit\/\n\n>        \u251c\u2500 research\/\n\n>        \u2514\u2500\u2500 ...\n#### 2. Protobuf Installation\/Compilation\n#### 3. COCO API installation\n#### 4. Install the Object Detection API"}}