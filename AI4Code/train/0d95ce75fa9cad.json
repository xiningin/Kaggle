{"cell_type":{"e295ac4e":"code","ee277dc1":"code","c60d8795":"code","073b0ce0":"code","e63f968e":"code","d927c1a3":"code","ad1504f4":"code","7e22257c":"markdown","04107148":"markdown","c4835fd4":"markdown","5656607c":"markdown"},"source":{"e295ac4e":"import numpy as np \nimport pandas as pd \nfrom pathlib import Path\nimport pandas as pd\nimport requests\nfrom requests.exceptions import HTTPError, ConnectionError\nfrom ipywidgets import interact\nimport ipywidgets as widgets\nimport nltk\nfrom nltk.corpus import stopwords\n# nltk.download(\"punkt\")\npd.set_option(\"display.min_rows\", 15)\npd.set_option(\"display.max_rows\", 101)\npd.set_option(\"display.max_columns\", 101)\npd.set_option('max_colwidth', 1000)\n","ee277dc1":"import os\nimport sys\n\n# Where are all the files located\ninput_dir = '..\/input\/CORD-19-research-challenge\/2020-03-13'\n\n# The all sources metadata file\nsrc_metadata_file=os.path.join(input_dir, 'all_sources_metadata_2020-03-13.csv')\nmetadata = pd.read_csv(src_metadata_file, \n                      dtype={'Microsoft Academic Paper ID': str,\n                             'pubmed_id': str})\n\n# Convert the doi to a url\ndef doi_url(d): return f'http:\/\/{d}' if d.startswith('doi.org') else f'http:\/\/doi.org\/{d}'\nmetadata.doi = metadata.doi.fillna('').apply(doi_url)\n","c60d8795":"metadata.dtypes","073b0ce0":"metadata['retracted']=metadata.title.str.contains('retracted', case=False, na=False)\nmetadata[metadata['retracted']]","e63f968e":"# records missing abstracts\n\nmissing_data=metadata[metadata.abstract.isna()] #['doi'].reset_index()\nprint(missing_data)","d927c1a3":"# Fill in missing cells using the doi address \n\nfrom bs4 import BeautifulSoup\n\n\ndef format_author(name):    # `Firstname Lastname` to `Lastname, Firstname;`\n    fname,lname=name.split(' ',1)\n    return '{}, {};'.format(lname,fname)\n\ndef fill_missing_medrxiv(row):\n    url=row.doi\n    print('Getting ' + url)\n    r = requests.get(url,timeout=6)\n    soup=BeautifulSoup(r.content, \"html.parser\")\n\n    row.abstract=soup.find(id=\"p-2\").text if soup.find(id=\"p-2\") else ''\n    authors=set([s.text for s in soup.find_all(class_=\"highwire-citation-author\")])\n    row.authors='\\n'.join(list(map(format_author,authors)))\n    row.title=soup.find(id=\"page-title\").text if soup.find(id=\"page-title\") else ''\n\n    return row \n\nfilled_medrxiv=missing_data[missing_data['source_x'].str.contains('medrxiv')]\n\nfilled_medrxiv=filled_medrxiv.apply(lambda x: fill_missing_medrxiv(x), axis=1)\n\n# save extracted data\nfilled_medrxiv.to_csv('..\/output\/kaggle\/working\/missing-medrxiv-metadata.tsv',sep='\\t')\n# print(filled_medrxiv)","ad1504f4":"tasks = [('What is known about transmission, incubation, and environmental stability?', \n        'transmission incubation environment coronavirus'),\n        ('What do we know about COVID-19 risk factors?', 'risk factors'),\n        ('What do we know about virus genetics, origin, and evolution?', 'genetics origin evolution'),\n        ('What has been published about ethical and social science considerations','ethics ethical social'),\n        ('What do we know about diagnostics and surveillance?','diagnose diagnostic surveillance'),\n        ('What has been published about medical care?', 'medical care'),\n        ('What do we know about vaccines and therapeutics?', 'vaccines vaccine vaccinate therapeutic therapeutics')] \ntasks = pd.DataFrame(tasks, columns=['Task', 'Keywords'])","7e22257c":"# 2. Load the All Sources Metadata file\nHere we load the csv file containing the metadata for the SARS-COV-2 papers.","04107148":"# 1. Technical Setup","c4835fd4":"# Covid Research Tasks\n\n1. **What is known about transmission, incubation, and environmental stability?**\n2. **What do we know about COVID-19 risk factors?**\n3. **What do we know about virus genetics, origin, and evolution?**\n4. **What has been published about ethical and social science considerations?**\n5. **What do we know about diagnostics and surveillance?**\n6. **What has been published about medical care?**\n7. **What do we know about non-pharmaceutical interventions?**\n8. **What has been published about information sharing and inter-sectoral collaboration?**\n9. **What do we know about vaccines and therapeutics?**","5656607c":"# Filling in the missing metadata\n\nI noticed a lot of abstracts and titles were missing from the metadata. Before getting to the analysis, this notebook tries to clean up the data by filling in the missing information. "}}