{"cell_type":{"ac5a9917":"code","1747a5d5":"code","dbea63ae":"code","eea3941b":"code","8bf8ba63":"code","b7c47097":"code","cdee0b6d":"code","57ff2df3":"code","9eef4aa5":"code","df91be48":"code","0314ae9f":"code","093f6b93":"code","02781d51":"code","db8a3a1d":"code","7fc5198e":"code","d5893f23":"code","0f07532f":"code","29f2d31d":"code","befce65d":"markdown","f590efd0":"markdown","1fb18097":"markdown","9616f186":"markdown","3199b693":"markdown","0d2ec9ef":"markdown","42cadc48":"markdown"},"source":{"ac5a9917":"# PACKAGES\n\n# standard\nimport numpy as np\nimport pandas as pd\n\n# plots\nimport matplotlib.pyplot as plt","1747a5d5":"# read file + show overview\ndf = pd.read_csv('..\/input\/excess-mortality-during-the-covid19-pandemic\/excess_mortality.csv')\ndf.info()","dbea63ae":"# convert date + extract features\ndf.date = pd.to_datetime(df.date)\ndf['year'] = df.date.dt.year\ndf['month'] = df.date.dt.month\ndf['day'] = df.date.dt.day","eea3941b":"# location stats\nloc_stats = df.groupby('location', as_index=False).agg(\n    time_unit = pd.NamedAgg(column='time_unit', aggfunc='first'),\n    n_values = pd.NamedAgg(column='time_unit', aggfunc='count'))\n\npd.set_option('display.max_rows', None)\nprint(loc_stats)\npd.set_option('display.max_rows', 10)","8bf8ba63":"# select specific location + year\nmy_loc = 'Germany'\nmy_year = 2020\ndf_select = df[(df.location==my_loc) & (df.year==my_year)].copy()\n# show table\ndf_select","b7c47097":"# plot 2020 deaths vs previous years' average\nmy_title = 'Location ' + my_loc\nplt.figure(figsize=(12,6))\nplt.scatter(df_select.date, df_select.average_deaths_2015_2019_all_ages, label='Avg 2015-2019')\nplt.scatter(df_select.date, df_select.deaths_2020_all_ages, label='2020')\nplt.title(my_title)\nplt.grid()\nplt.legend(loc='upper left')\nplt.show()","cdee0b6d":"# add difference \/ relative deviation\ndf_select['excess_deaths'] = df_select.deaths_2020_all_ages - df_select.average_deaths_2015_2019_all_ages\ndf_select['excess_deaths_rel'] = df_select.excess_deaths \/ df_select.average_deaths_2015_2019_all_ages","57ff2df3":"# plot absolute excess deaths\nmy_title = 'Location ' + my_loc + ' - Nominal Excess Deaths (absolute)'\nplt.figure(figsize=(12,6))\nplt.scatter(df_select.date, df_select.excess_deaths)\nplt.title(my_title)\nplt.grid()\nplt.show()","9eef4aa5":"# plot relative excess deaths\nmy_title = 'Location ' + my_loc + ' - Nominal Excess Deaths (relative)'\nplt.figure(figsize=(12,6))\nplt.scatter(df_select.date, df_select.excess_deaths_rel)\nplt.title(my_title)\nplt.grid()\nplt.show()","df91be48":"# Aggregation over full year\ndeaths_2020 = df_select.deaths_2020_all_ages.sum()\ndeaths_prev = df_select.average_deaths_2015_2019_all_ages.sum()\n\nprint('Annual View:')\nprint('============')\nprint('Deaths 2020          :', int(deaths_2020))\nprint('Avg.Deaths 2015-2019 :', deaths_prev)\nprint('Difference           :', deaths_2020 - deaths_prev)\nprint('Relative Deviation % :', np.round(100*(deaths_2020 - deaths_prev)\/deaths_prev,2))","0314ae9f":"# plot p-scores by age group\nmy_title = 'Location ' + my_loc + ' | p-scores by age group'\nplt.figure(figsize=(12,6))\nplt.scatter(df_select.date, df_select.p_scores_15_64, label='p_scores_15_64')\nplt.scatter(df_select.date, df_select.p_scores_65_74, label='p_scores_65_74')\nplt.scatter(df_select.date, df_select.p_scores_75_84, label='p_scores_75_84')\nplt.scatter(df_select.date, df_select.p_scores_85plus, label='p_scores_85plus')\nplt.title(my_title)\nplt.grid()\nplt.legend(loc='upper left')\nplt.show()","093f6b93":"history = ['deaths_2010_all_ages', 'deaths_2011_all_ages', 'deaths_2012_all_ages',\n           'deaths_2013_all_ages', 'deaths_2014_all_ages', 'deaths_2015_all_ages',\n           'deaths_2016_all_ages', 'deaths_2017_all_ages', 'deaths_2018_all_ages',\n           'deaths_2019_all_ages'] ","02781d51":"deaths_development = df_select[history + ['deaths_2020_all_ages']].sum()\nprint(deaths_development)","db8a3a1d":"# plot development\nplt.scatter(range(2010,2021), deaths_development.values)\nplt.ylim(0,1e6)\nplt.title(my_loc + ' - Deaths per year')\nplt.grid()","7fc5198e":"deaths_development_short_term = deaths_development[5:]\ndeaths_development_short_term","d5893f23":"# check if mean figure for 2015-2019 used above is correct:\ndeaths_development_short_term[0:5].mean()","0f07532f":"# plot development for 2015+ only (used for average figures above)\nplt.scatter(range(2015,2021), deaths_development_short_term.values)\nplt.ylim(0,1e6)\nplt.title(my_loc + ' - Deaths per year')\nplt.grid()","29f2d31d":"# zoom in\nplt.scatter(range(2015,2021), deaths_development_short_term.values)\nplt.title(my_loc + ' - Deaths per year')\nplt.grid()","befce65d":"<a id='1'><\/a>\n# Load \/ Data Preparation","f590efd0":"#### The p-Score is the relative deviation between the number of deaths in 2020\u20132021 (weekly or monthly) and the average number of deaths in the benchmark period 2015\u20132019 (weekly or monthly).","1fb18097":"<a id='4'><\/a>\n# Historical Development (looking for trends)","9616f186":"<a id='2'><\/a>\n# Select and Explore Subset","3199b693":"<a id='3'><\/a>\n# p-Scores by Age Group","0d2ec9ef":"### We see a general upward trend in 2010-2019 (probably driven by aging population) so we have to be somewhat careful in interpreting the nominal excess deaths! However, we are using only years 2015-2019 as benchmark for comparison which reduces the impact of a trend:","42cadc48":"# Table of Contents\n* [Load \/ Data Preparation](#1)\n* [Select and Explore Subset](#2)\n* [p-Scores by Age Group](#3)\n* [Historical Development (looking for trends)](#4)"}}