{"cell_type":{"5619aea9":"code","3b4384d4":"code","307cf22d":"code","8dbdbfe7":"code","f8b7b869":"code","401ce81f":"code","04cb2d88":"code","fe0f999d":"code","abebcd7b":"code","f56c5604":"code","64084782":"code","d87e52e1":"code","98054745":"code","db1ee679":"code","002677aa":"code","620b982d":"code","d6cde55f":"code","0830554c":"code","d10dbbe6":"code","09a9d23d":"code","8281e86b":"code","56baaec7":"code","e9a90c63":"code","14e6f4f0":"code","9230788f":"code","7fa90fa9":"code","19dadc7c":"code","6959a9b0":"code","c8475997":"code","3d84379b":"markdown","0179e974":"markdown","106c0799":"markdown","44c5dd0c":"markdown","815b03e6":"markdown","17114af3":"markdown","a98a2289":"markdown","78594aee":"markdown","f0575ada":"markdown","1a3b3cd9":"markdown","d644c040":"markdown","64931d2b":"markdown","69813c46":"markdown","80cb5544":"markdown","22ff1cf1":"markdown","2bf73402":"markdown","e07e36a9":"markdown","df330e8b":"markdown","77943715":"markdown","3bb7a6c2":"markdown","79559e3b":"markdown","f2dd30a4":"markdown","b68f156a":"markdown","00e73309":"markdown","8e11b60b":"markdown","dbb672b6":"markdown","bb6ad454":"markdown","81b9dd50":"markdown"},"source":{"5619aea9":"from pathlib import Path\n\nimport pandas as pd\nimport plotly_express as px\n\nINPUT_FOLDER = Path(\"..\/input\/\")","3b4384d4":"df = pd.read_csv(INPUT_FOLDER \/ \"news_collection.csv\", parse_dates=[\"date\"])\ndf.sample(5)","307cf22d":"f\"Number of entries: {df.shape[0]:,d}\"","8dbdbfe7":"df[df.duplicated([\"title\", \"desc\", \"image\", \"url\", \"source\"], keep=False)].sort_values([\"url\", \"date\"]).head()","f8b7b869":"df[\n    df.duplicated([\"title\", \"desc\", \"image\", \"url\", \"source\"], keep=False)\n].groupby([\"title\", \"url\", \"source\"]).size().to_frame(\"cnt\").sort_values(\"cnt\", ascending=False).head()","401ce81f":"blacklists = [\n    \"https:\/\/www.sgsme.sg\/\", \"https:\/\/www.voachinese.com\/\", \"https:\/\/www.voachinese.com\/z\/5102\", \n    \"https:\/\/www.instagram.com\/voachinese\/\", \"https:\/\/cn.wsj.com\/\", \"https:\/\/www.wsj.com\/europe\"\n]","04cb2d88":"df = df[~df.duplicated([\"title\", \"desc\", \"image\", \"url\", \"source\"], keep=\"first\")]\ndf.shape[0]","fe0f999d":"df = df[~df.url.isin(blacklists)]\ndf.shape[0]","abebcd7b":"df = df[~df.url.str.startswith(\"https:\/\/www.youtube.com\")]\ndf.shape[0]","f56c5604":"import re\ndef cjk_detect(texts):\n    texts = str(texts)\n    # korean\n    if re.search(\"[\\uac00-\\ud7a3]\", texts):\n        return \"ko\"\n    # japanese\n    if re.search(\"[\\u3040-\\u30ff]\", texts):\n        return \"ja\"\n    # chinese\n    if re.search(\"[\\u4e00-\\u9FFF]\", texts):\n        return \"zh\"\n    return \"others\"","64084782":"%%time\ndf[\"lang\"] = df.apply(cjk_detect, axis=1)","d87e52e1":"df[\"lang\"].value_counts()","98054745":"df[df[\"lang\"]==\"ko\"].head()","db1ee679":"df[df[\"lang\"]==\"others\"].sample(5)","002677aa":"df[df[\"lang\"]==\"ja\"].sample(5)","620b982d":"df[df[\"lang\"]==\"zh\"].sample(5)","d6cde55f":"print(\"Before:\", df.shape[0])\ndf = df[df.lang.isin((\"ja\", \"zh\"))].copy()\nprint(\"After:\", df.shape[0])","0830554c":"source_counts = df.source.value_counts().to_frame(\"Count\").reset_index()\n\npx.bar(\n    source_counts, x=\"index\", y=\"Count\", template=\"plotly_white\",\n    labels=dict(Count=\"Number of Entries\", index=\"Source\"), \n    width=800, height=400, title=\"# of News Entries by Source\"\n)","d10dbbe6":"date_counts = df.date.value_counts().to_frame(\"Count\").reset_index()\ndate_counts[\"index\"] = date_counts[\"index\"].dt.strftime(\"%Y-%m-%d\")\n\npx.bar(\n    date_counts, x=\"index\", y=\"Count\", template=\"plotly_white\",\n    labels=dict(Count=\"Number of Entries\", index=\"Date\"), \n    width=800, height=400, title=\"Article Counts by Date\"\n)","09a9d23d":"date_counts = df[df.source == \"NYTimes\"].date.value_counts().to_frame(\"Count\").reset_index()\ndate_counts[\"index\"] = date_counts[\"index\"].dt.strftime(\"%Y-%m-%d\")\n\npx.bar(\n    date_counts, x=\"index\", y=\"Count\", template=\"plotly_white\",\n    labels=dict(Count=\"Number of Entries\", index=\"Date\"), \n    width=800, height=400, title=\"New York Times (CN) Article Counts by Date\"\n)","8281e86b":"df[\"trump\"] = (\n    df.title.str.contains(\"\u5ddd\u666e\") |\n    df.title.str.contains(\"\u7279\u6717\u666e\")\n)\nf'% of titles mentioning Trump: {df[\"trump\"].sum() \/ df.shape[0] * 100:.2f}%'","56baaec7":"trump_perc_by_source = df.groupby(\"source\")[\"trump\"].mean().sort_values() * 100\ntrump_perc_by_source = trump_perc_by_source.to_frame(\"Perc\").reset_index()\n\npx.bar(\n    trump_perc_by_source, x=\"Perc\", y=\"source\", template=\"plotly_white\",\n    labels=dict(Perc=\"%\", source=\"Source\"), \n    width=800, height=400, title=\"Percentage of Titles mentioning Trump by Sources\",\n    orientation=\"h\"\n)","e9a90c63":"trump_perc_by_date = df.groupby(\"date\")[\"trump\"].mean().sort_values() * 100\ntrump_perc_by_date = trump_perc_by_date.to_frame(\"Perc\").reset_index()\ntrump_perc_by_date[\"date\"] = trump_perc_by_date[\"date\"].dt.strftime(\"%Y-%m-%d\")\n\npx.bar(\n    trump_perc_by_date, x=\"date\", y=\"Perc\", template=\"plotly_white\",\n    labels=dict(Perc=\"%\", date=\"Date\"), \n    width=800, height=400, title=\"Percentage of Titles mentiong Trump by Date\",\n    orientation=\"v\"\n)","14e6f4f0":"df[\"xi\"] = (\n    df.title.str.contains(\"\u7fd2\u8fd1\u5e73\") |\n    df.title.str.contains(\"\u4e60\u8fd1\u5e73\")\n)\nf'% of titles mentioning Xi: {df[\"xi\"].sum() \/ df.shape[0] * 100:.2f}%'","9230788f":"xi_perc_by_source = df.groupby(\"source\")[\"xi\"].mean().sort_values() * 100\nxi_perc_by_source = xi_perc_by_source.to_frame(\"Perc\").reset_index()\n\npx.bar(\n    xi_perc_by_source, x=\"Perc\", y=\"source\", template=\"plotly_white\",\n    labels=dict(Perc=\"%\", source=\"Source\"), \n    width=800, height=400, title=\"Percentage of Titles mentioning Xi by Sources\",\n    orientation=\"h\"\n)","7fa90fa9":"xi_perc_by_date = df.groupby(\"date\")[\"xi\"] .mean().sort_values() * 100\nxi_perc_by_date = xi_perc_by_date.to_frame(\"Perc\").reset_index()\nxi_perc_by_date[\"date\"] = xi_perc_by_date[\"date\"].dt.strftime(\"%Y-%m-%d\")\n\npx.bar(\n    xi_perc_by_date, x=\"date\", y=\"Perc\", template=\"plotly_white\",\n    labels=dict(Perc=\"%\", date=\"Date\"), \n    width=800, height=400, title=\"Percentage of Titles mentiong Xi by Date\",\n    orientation=\"v\"\n)","19dadc7c":"df[(df.date == \"2019-01-03\") & df.xi][[\"title\", \"desc\", \"source\"]].sample(5)","6959a9b0":"xi_perc_by_source[\"poi\"] = \"Xi\"\ntrump_perc_by_source[\"poi\"] = \"Trump\"\ncombined = pd.concat([trump_perc_by_source, xi_perc_by_source], axis=0)\npx.bar(\n    combined, x=\"Perc\", y=\"source\", color=\"poi\", template=\"plotly_white\",\n    labels=dict(Perc=\"%\", source=\"Source\"),\n    width=800, height=400, title=\"Percentage of Title Mentions by Sources\",\n    orientation=\"h\", barmode=\"group\"\n)","c8475997":"xi_perc_by_source[\"poi\"] = \"Xi\"\ntrump_perc_by_source[\"poi\"] = \"Trump\"\ncombined = pd.concat([trump_perc_by_source, xi_perc_by_source], axis=0)\npx.bar(\n    combined, x=\"Perc\", y=\"source\", template=\"plotly_white\",\n    labels=dict(Perc=\"%\", source=\"Source\"), facet_col=\"poi\",\n    width=800, height=600, title=\"Percentage of Title Mentions by Sources\",\n    orientation=\"h\"\n)","3d84379b":"## Imports","0179e974":"Remove those in the blacklist:","106c0799":"### Dedpulicate","44c5dd0c":"### Remove entries that are not written in Chinese","815b03e6":"Now we repeat the same process with Chinese president Xi:","17114af3":"## The End","a98a2289":"## Reading in Data","78594aee":"This is the end of this simple starter notebook. Hopefully you'll find this dataset interesting.\n\nThere are some issues that was not covered here, but might be of interest to you:\n\n1. The conversion of Traditional and Simplified Chinese.\n2. The overabundance of contents from some sources. That could mean a lot of short breaking news pieces, or even just some low-quality contents. Might need some investigation.\n3. The summary field of some sources are just truncated version of the full article. The final sentence are usually not complete. You might want to remove that sentence.","f0575ada":"## Simple Visualizations","1a3b3cd9":"Looks more reasonable, but the spacing between axis and labels still needs some work.","d644c040":"A lot of Xi titles on Jan 3rd. We can take a look at what that's about:","64931d2b":"The news feeds can be quite noisy at times (especially RFI.fr), we need to find non-Chinese entries that are put in to the feed by mistake and remove them.","69813c46":"Remove youtube videos:","80cb5544":"Examine the most frequent entries:","22ff1cf1":"### Xi Jinping","2bf73402":"# Data Cleaning and Basic Exploration v2\n\n20190507 Update: px.bar now supports barmode=\"group\"\n\n20190424 Update: Replace `langua` with a simpler `re` language dector.\n\nUpdates:\n\n1. Use the new Plotly Express API\n2. Use `langua` to detect language to weed out problematic entries","e07e36a9":"Another approach utilizing the facet parameters:","df330e8b":"### Trump","77943715":"There are some duplicates in the dataset:","3bb7a6c2":"We see that some entries are not really news, but links to websites, instagram accounts, youtube, and online surveys.","79559e3b":"## Check the Mentioning of People in the Titles","f2dd30a4":"## Cleaning the Data","b68f156a":"Note: this dataset does not guarantee full coverage. So the following seciont is not necessarily an accurate account of the coverage on Trump and Xi. It just serves as an simpe example.","00e73309":"Looks like we can include Japanese results:","8e11b60b":"Percentage of titles mentioning Trump by Sources:","dbb672b6":"### Combine Two Plots\nOriginally there is a plot combining the number of mentions of Trump and Xi by source together in one plot, but I'm not sure the proper way to do it in Plotly Express. \n\nOne way might be combing the two data frames and use \"color\" parameter to distinguish one from another:","bb6ad454":"## Table of Contents\n\n1. [Imports](#Imports)\n2. [Reading in Data](#Reading-in-data)\n3. [Cleaning the Data](#Cleaining-the-data)\n  - [Dedpulicate](#Dedpulicate)   \n  - [Remove entries that are not written in Chinese](#Remove-entries-that-are-not-written-in-Chinese)    \n4. [Simple Visualizations](#Simple-Visualizations)\n5. [Check the mention of people in the title](#Check-the-Mentioning-of-People-in-the-Titles)\n  - [Trump](#Trump)\n  - [Xi Jinping](#Xi-Jinping)\n6. [The End](#The-End)","81b9dd50":"Deduplicate:"}}