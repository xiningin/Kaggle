{"cell_type":{"209f46d0":"code","330939b4":"code","96151b2a":"code","0a9441ef":"code","e6f44157":"code","1a5a9ede":"code","39136a50":"code","0c8eb3c5":"code","a4de8281":"code","2a684e2a":"code","832d8739":"code","4afe364d":"code","a0509e83":"code","c218fe66":"code","dd16a145":"code","4ad5e487":"code","382a8047":"markdown","1fec53ca":"markdown","dc583109":"markdown","282fa4a7":"markdown","f559b81f":"markdown","693c9173":"markdown","ef89d60d":"markdown","5ece5ba5":"markdown","a3b70c3e":"markdown","18a92317":"markdown","b7b144c6":"markdown","abf95c1c":"markdown","403d7c1b":"markdown","98add657":"markdown","52be5728":"markdown","771b053a":"markdown","837a6704":"markdown","7507a8f0":"markdown","e8ac3b7e":"markdown","973c98b5":"markdown","ee157c4a":"markdown","388eaeed":"markdown","3495101a":"markdown","55ec041f":"markdown","95a4abf0":"markdown"},"source":{"209f46d0":"import pandas as pd\r\nimport matplotlib as plt\r\nimport seaborn as sns\r\nimport numpy as np\r\nimport scipy.stats as st\r\nfrom scipy.stats import shapiro, levene, ttest_ind, mannwhitneyu","330939b4":"df_1 = pd.read_csv(\"..\/input\/survey-data\/monthly_deaths.csv\")\r\ndf_2 = pd.read_csv(\"..\/input\/survey-data\/yearly_deaths_by_clinic.csv\")\r\nprint(\"df_1:\", df_1.shape, \"df_2: \", df_2.shape)","96151b2a":"print(\"df_1 dtypes:\")\r\nprint(df_1.dtypes)\r\nprint()\r\nprint(\"df_2 dtypes:\")\r\nprint(df_2.dtypes)\r\n","0a9441ef":"df_1[\"date\"] = pd.to_datetime(df_1.date)\r\ndf_2[\"year\"] = pd.to_datetime(df_2.year, format=\"%Y\").dt.year","e6f44157":"df_1[\"proportion_deaths\"] = df_1[\"deaths\"]\/df_1[\"births\"]\r\ndf_2[\"proportion_deaths\"] = df_2[\"deaths\"]\/df_2[\"births\"]","1a5a9ede":"handwashing = []\r\nmhw_day = pd.to_datetime(\"1847\/6\/1\")\r\n\r\nfor row in df_1[\"date\"]:\r\n    if row >= mhw_day: handwashing.append(\"mandatory\")\r\n    else: handwashing.append(\"not mandatory\")\r\n\r\ndf_1[\"handwashing\"] = handwashing","39136a50":"sns.set_style(\"white\")\r\nby_clinic = sns.relplot(\r\n    data=df_2,\r\n    kind=\"line\",\r\n    x=\"year\",\r\n    y=\"proportion_deaths\",\r\n    hue=\"clinic\",\r\n    height=8,\r\n    palette=[\"b\", \"r\"]\r\n)\r\n\r\nby_clinic.set_axis_labels(y_var=\"Proportion Deaths\",\r\n                          x_var=\"Year\")\r\nby_clinic.fig.suptitle(\"Proportion Deaths by clinic\")","0c8eb3c5":"sns.set_style(\"white\")\r\nby_hwm = sns.relplot(\r\n    data=df_1,\r\n    kind=\"line\",\r\n    x=\"date\",\r\n    y=\"proportion_deaths\",\r\n    hue=\"handwashing\",\r\n    height=8,\r\n    palette=[\"b\", \"r\"]\r\n)\r\n\r\nby_hwm.set_axis_labels(y_var=\"Proportion Deaths\",\r\n                          x_var=\"Year\")\r\nby_hwm.fig.suptitle(\"Effect of mandatory handwashing on proportion deaths\")","a4de8281":"degreesFreedom_c1 = len(df_2[df_2[\"clinic\"] == \"clinic 1\"])-1\r\ndegreesFreedom_c2 = len(df_2[df_2[\"clinic\"] == \"clinic 2\"])-1\r\nalpha = 0.95\r\n\r\nclinic_1 = df_2.loc[df_2[\"clinic\"] == \"clinic 1\", [\"proportion_deaths\"]]\r\nclinic_2 = df_2.loc[df_2[\"clinic\"] == \"clinic 2\", [\"proportion_deaths\"]]\r\n\r\nci_1 = st.t.interval(alpha=alpha, \r\n                     df=degreesFreedom_c1,\r\n                     loc = np.mean(clinic_1),\r\n                     scale = st.sem(clinic_1))\r\n\r\nci_2 = st.t.interval(alpha=alpha,\r\n                     df=degreesFreedom_c2,\r\n                     loc=np.mean(clinic_2),\r\n                     scale=st.sem(clinic_2))\r\n\r\nprint(\"Confidence intervals for mean of proportion deaths in clinic 1:\")\r\nprint(\"mean: \", np.mean(clinic_1))\r\nprint(\"Interval:\", ci_1[0], \" - \", ci_1[1])\r\nprint()\r\nprint(\"Confidence intervals for mean of proportion deaths in clinic 2:\")\r\nprint(\"mean: \", np.mean(clinic_2))\r\nprint(\"Interval:\", ci_2[0], \" - \", ci_2[1])","2a684e2a":"df_1.handwashing.value_counts()","832d8739":"df_1.groupby(\"handwashing\").proportion_deaths.mean()","4afe364d":"degreesFreedom_mhwN = len(df_1[df_1[\"handwashing\"] == \"not mandatory\"])-1\r\ndegreesFreedom_mhwY = len(df_1[df_1[\"handwashing\"] == \"mandatory\"])-1\r\nalpha = 0.95\r\n\r\nhandwashing_N = df_1.loc[df_1[\"handwashing\"] == \"not mandatory\", [\"proportion_deaths\"]]\r\nhandwashing_Y = df_1.loc[df_1[\"handwashing\"] == \"mandatory\", [\"proportion_deaths\"]]\r\n\r\nci_N = st.t.interval(alpha=alpha,\r\n                     df=degreesFreedom_mhwN,\r\n                     loc=np.mean(handwashing_N),\r\n                     scale=st.sem(handwashing_N))\r\n\r\nci_Y = st.t.interval(alpha=alpha,\r\n                     df=degreesFreedom_mhwY,\r\n                     loc=np.mean(handwashing_Y),\r\n                     scale=st.sem(handwashing_Y))\r\n\r\nprint(\"Confidence intervals for mean of proportion deaths for not mandatory handwashing:\")\r\nprint(\"mean: \", np.mean(handwashing_N))\r\nprint(\"Interval:\", ci_N[0], \" - \", ci_N[1])\r\nprint()\r\nprint(\"Confidence intervals for mean of proportion deaths for mandatory handwashing:\")\r\nprint(\"mean: \", np.mean(handwashing_Y))\r\nprint(\"Interval:\", ci_Y[0], \" - \", ci_Y[1])\r\n","a0509e83":"# H0 = the sample comes from a normal distribution.\r\n# H1 = the sample is not coming from a normal distribution.\r\n# alpha = 0.05\r\n\r\nprint(\"Clinic 1: \", shapiro(clinic_1))\r\nprint(\"Clinic 2: \", shapiro(clinic_2))\r\nprint(\"Not mandatory handwashing: \", shapiro(handwashing_N))\r\nprint(\"Mandatory handwashing: \", shapiro(handwashing_Y))","c218fe66":"# H0: the variances are equal across all samples\/groups.\r\n# H1: the variances are not equal across all samples\/groups.\r\n# alpha = 0.05\r\n\r\nprint(levene(clinic_1[\"proportion_deaths\"], clinic_2[\"proportion_deaths\"]))","dd16a145":"print(ttest_ind(clinic_1, clinic_2, equal_var=True))","4ad5e487":"print(mannwhitneyu(handwashing_N, handwashing_Y))","382a8047":"# Conclusions\r\n\r\nBased on both statistical tests and the estimation of the mean with confidence intervals, it can be concluded with certainty that:\r\n\r\n1. In the clinic where only midwives delivered, the percentage of deaths due to puerperal fever is significantly lower than in the clinic where doctors and students also delivered.\r\n2. The percentage of deaths in Doctor Semmelweis' clinic significantly decreased after the introduction of mandatory hand washing.","1fec53ca":"Then we can make two graphs.","dc583109":"Since the data type of the *date* variable (df_1) and the *year* variable (df_2) are in the wrong format, we will perform a conversion.","282fa4a7":"## According to the clinic","f559b81f":"because p-value < $\\alpha$ we reject the null hypothesis in favor of the alternative hypothesis. This means that the mean proportion of deaths in clinic one and clinic two are significantly different from each other.","693c9173":"As we can see both graphs indicate that there is a difference in the proportion of deaths for: clinics and introduction of handwashing mandatory, respectively.","ef89d60d":"For the data from both clinics, there are no reasons to reject the null hypothesis, so we can move on to testing for equality of variance.\r\n\r\nNot mandatory handwashing has a p-value < $\\alpha$, so to test the significance of the difference between the means we will use a non-parametric test.","5ece5ba5":"## Mann-Whitney U Test\r\n\r\nThe Mann-Whitney U test is a nonparametric statistical significance test for determining whether two independent samples were drawn from a population with the same distribution. The test determines whether it is equally likely that any randomly selected observation from one sample will be greater or less than a sample in the other distribution [(Source)](https:\/\/machinelearningmastery.com\/nonparametric-statistical-significance-tests-in-python\/). \r\n\r\nSince this is a non-parametric test, we do not need to meet any assumptions.\r\n\r\n> H0: the sample distributions are equal. <br \/>\r\n> H1: the sample distributions are not equal. <br \/>\r\n> $\\alpha = 0.05$","a3b70c3e":"# Libraries and data loading","18a92317":"# Confidence Intervals for means\r\n\r\nSince we are interested in the mean of the proportion of deaths, we can calculate confidence intervals for the mean.\r\n\r\n$ \\bar{x} \\pm t\\frac{s}{\\sqrt{n}} $ \r\n\r\nwhere: $\\bar{x}$ - sample mean, $t$ - the value of the chosen distribution with $n-1$ degrees of freedom (for small samples t-distribution, for large samples normal distribution), $s$ - sample standard deviation, $n$ - sample size\r\n\r\nIn Python $\\frac{s}{\\sqrt{n}}$ can be calculated manually as `(np.std(x, ddof=1)\/np.sqrt(np.size(x)))` or usung the function `sem(x)` from *scipy.stats*","b7b144c6":"## Assumption of normality of distribution","abf95c1c":"Based on the Polish textbook \"Przyst\u0119pny kurs statystyki, Tom 1, StatSoft\" (eng. *Accessible Course in Statistics, Volume 1, StatSoft*), the following hypothesis testing graph can be drawn.\r\n\r\n<img src=\"https:\/\/i.imgur.com\/yVVcIXJ.png\">\r\n\r\nSince I could not find the Cochran-Cox test as it is presented in the above mentioned publication, we can use the Welch's test. \r\n\r\n------\r\n\r\nFor those interested in the difference between the two tests, I have included the test statistic formula for the Welch's test and the Cochran-Cox test.\r\n\r\nWelch's test: \r\n\r\n$W = \\frac{m_{1}-m_{2}}{\\sqrt{\\frac{s_{1}^{2}}{n_{1}}+\\frac{s_{2}^{2}}{n_{2}}}}$\r\n\r\nCochran-Cox test: \r\n\r\n$CC =\\frac{m_{1}-m_{2}}{\\sqrt{\\frac{s_{1}^{2}}{n_{1}-1}+\\frac{s_{2}^{2}}{n_{2}-1}}}$\r\n\r\nwhere: $s^2$ - sample variance, $m$ - sample mean, $n$ - sample size.\r\n\r\n*If anyone has found additional information on this then please comment.* ","403d7c1b":"# Hypothesis testing\r\n\r\n...is a procedure that allows you to test your assumptions about the general population without conducting a full population survey.\r\n\r\nIn our case, we want to prove that the average death rate for the two study groups is statistically different. That is:\r\n1. the mean proportion of deaths in clinic 1 and clinic 2 is significantly different,\r\n2. the mean proportion of deaths before the enforcement of mandatory handwashing and after the enforcement of mandatory handwashing is significantly different.","98add657":"## According to the mandatory hand washing","52be5728":"# Doctor Semmelweis discovery\r\n\r\n## Motivation\r\n\r\nThe data that Doctor Semmelweis collected is very well documented, so it is a valuable resource for learning how to perform statistical tests comparing two groups. \r\n\r\nThe knowledge gained in this way can then be used to perform similar tests on other data sets. For example, it can help determine whether the risk of heart attack depends on the degree of obesity or whether smoking cigarettes increases the chance of lung cancer. In technical issues, for example, it can determine whether the same product produced on machine A is different from that produced on machine B.\r\n\r\n### Main goal\r\n\r\nTo determine by statistical methods whether:\r\n\r\n+ there is a difference between the mortality rate in the first clinic, where doctors and students delivered babies, and the second clinic, where only midwives did so,\r\n+ the mortality rate decreased significantly in Doctor Semmelweis' clinic after he recommended that the attendants wash their hands. \r\n  \r\nMandatory handwashing before delivered babies: 1 June 1847. \r\n","771b053a":"> There is a 95% chance that the confidence interval of [0.064, 0.133] contains the true population mean of proportion deaths for clinic 1.\r\n\r\n> There is a 95% chance that the confidence interval of [0.016, 0.064] contains the true population mean of proportion deaths for clinic 2.\r\n\r\nComparing the two sample means, it can be concluded that the proportion of deaths in the clinic where births were delivered by midwives was lower than in the clinic where births were also delivered by doctors and students.\r\n\r\nIn order to formulate a final judgment, an appropriate statistical test (*included in the next section*) must be performed.","837a6704":"## Two Sample t-test\r\n\r\nAssumptions:\r\n+ The observations in one sample should be independent of the observations in the other sample.\r\n+ The data should be approximately normally distributed.\r\n+ The two samples should have approximately the same variance.\r\n\r\nWe met the above assumptions for the data regarding clinics.\r\n\r\n> H0: the two population means are equal. <br \/>\r\n> H1: the two population means are not equal. <br \/>\r\n> $\\alpha = 0.05$","7507a8f0":"Since the number of births in a given period is not constant, we need to create an additional column with the proportion of deaths in order to compare mortality due to puerperal fever.\r\n\r\n$ births \\rightarrow 1 $ <br \/>\r\n$ deaths \\rightarrow x $\r\n\r\nIf we divide deaths by births we get a number between 0 and 1 indicating what proportion of births are those that ended with a death.","e8ac3b7e":"Since we have less than 30 observations for mandatory handwashing we will use the t-distribution further on.","973c98b5":"> There is a 95% chance that the confidence interval of [0.087, 0.122] contains the true population mean of proportion deaths for not mandatory handwashing time period.\r\n\r\n> There is a 95% chance that the confidence interval of [0.014, 0.028] contains the true population mean of proportion deaths for mandatory handwashing time period.\r\n\r\nBy comparing the two sample means, it can be believed that the enforcement of mandatory handwashing significantly reduced the average death proportion.\r\n\r\nIn order to formulate a final judgment, an appropriate statistical test (*included in the next section*) must be performed.","ee157c4a":"Because p-value < alpha we reject the null hypothesis in favor of the alternative hypothesis. This means that the sample distribution for the period when handwashing was mandatory is different from the one when it wasn't.","388eaeed":"# Data preview and manipulations","3495101a":"We will add an additional variable to the database to specify whether handwashing was mandatory on a given date.","55ec041f":"## Assumption of equality of variances","95a4abf0":"p-value > $\\alpha$ therefore there is no reason to reject the null hypothesis. Assume that the variances in both samples are equal."}}