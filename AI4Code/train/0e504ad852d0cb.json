{"cell_type":{"aa14c9ca":"code","46f4bd06":"code","bb655375":"code","d5e3a13d":"code","97690d4f":"code","2c530da5":"code","fff37a40":"code","e7724be5":"code","24f71b08":"code","371beb42":"code","8101a8c6":"code","3634d7d0":"code","e92371fb":"code","08470c6d":"code","07d7874a":"code","4a565870":"code","7ad36d51":"code","0d47439d":"code","e7b23e5b":"code","99f1a8df":"code","99ce987c":"code","a3bbcc64":"markdown","b12b8a1a":"markdown","293b5c0d":"markdown","cbc95925":"markdown"},"source":{"aa14c9ca":"import numpy as np\nimport pandas as pd \nimport os, glob","46f4bd06":"!wget -q -r ftp:\/\/ftp.ibge.gov.br\/Precos_Indices_de_Precos_ao_Consumidor\/IPCA_15\/Resultados_por_Subitem\/2017\/\n!wget -q -r ftp:\/\/ftp.ibge.gov.br\/Precos_Indices_de_Precos_ao_Consumidor\/IPCA_15\/Resultados_por_Subitem\/2018\/\n!mkdir cache\n!for z in ftp.ibge.gov.br\/Precos_Indices_de_Precos_ao_Consumidor\/IPCA_15\/Resultados_por_Subitem\/2017\/*.zip; do unzip -qq \"$z\" -d cache; done\n!for z in ftp.ibge.gov.br\/Precos_Indices_de_Precos_ao_Consumidor\/IPCA_15\/Resultados_por_Subitem\/2018\/*.zip; do unzip -qq \"$z\" -d cache; done\n!rm -r ftp.ibge.gov.br","bb655375":"filenames = glob.glob('.\/cache\/*.xls')","d5e3a13d":"ipca15 = pd.read_excel(filenames[0], index_col=[0], header=[4], skiprows=[5])","97690d4f":"# Select some rows\ncols_cat = [' \u00cdNDICE GERAL',       # 'GENERAL INDEX'\n        ' ALIMENTA\u00c7\u00c3O E BEBIDAS',     # 'FOOD AND BEVERAGES'\n        ' HABITA\u00c7\u00c3O',                 # 'HOUSING',\n        ' IOGURTE E BEBIDAS L\u00c1CTEAS', # 'YOGURT AND DAIRY BEVERAGES',\n        ' ARTIGOS DE RESID\u00caNCIA',     # 'RESIDENCE ARTICLES',\n        ' VESTU\u00c1RIO',                 # 'CLOTHING',\n        ' TRANSPORTES',               # 'TRANSPORTES',\n        ' SA\u00daDE E CUIDADOS PESSOAIS', # 'HEALTH AND PERSONAL CARE',\n        ' DESPESAS PESSOAIS',         # 'PERSONAL EXPENSES',\n        ' EDUCA\u00c7\u00c3O',                  # 'EDUCATION',\n        ' COMUNICA\u00c7\u00c3O',               # 'COMMUNICATION'\n        ]","2c530da5":"mth = filenames[0].split('_')[1][:6]\nprint(f\"Month: {mth[:4]+'-'+mth[-2:]}\")\n# Cols meaning :\n# Monthly variation by groups (%)\n# Rio de Janeiro, Porto Alegre, Belo Horizonte, Recife,\n# S\u00e3o Paulo, Bras\u00edlia, Bel\u00e9m, Fortaleza, Salvador, Curitiba, Goi\u00e2nia\nipca15.drop_duplicates().loc[cols_cat, :]","fff37a40":"# And now collect colomn 'NACIONAL' in DataFrame by month\nIPCA15 = pd.DataFrame(index=pd.DatetimeIndex(freq='M', start='2017-01-01', end='2018-12').to_period('M')\n                          , columns=cols_cat)\n\nfor file in filenames:\n    mth = file.split('_')[1][:6]\n    idx = pd.to_datetime(mth[:4]+'-'+mth[-2:]).to_period('M')\n    tmp = pd.read_excel(file, index_col=[0], header=[4], skiprows=[5])\n    IPCA15.loc[idx,:] = tmp.drop_duplicates().loc[cols_cat, 'NACIONAL'].values\nIPCA15[cols_cat] = IPCA15[cols_cat].astype(np.float32)\nIPCA15.index.name='eval month'","e7724be5":"IPCA15.head()","24f71b08":"# read the data\ndf = pd.read_csv('..\/input\/train.csv', parse_dates=['first_active_month'])\ntrns = pd.read_csv('..\/input\/historical_transactions.csv',\n                   parse_dates=['purchase_date'], infer_datetime_format=True)","371beb42":"cols = ['card_id', 'month_lag', 'purchase_date']\ndf = pd.merge(df, trns[cols].groupby('card_id').first(), on='card_id', left_index=True)","8101a8c6":"df['eval month'] = df.purchase_date - df.month_lag.astype('timedelta64[M]')\ndf['eval month'] = df['eval month'].dt.to_period('M')\ndf.drop(['month_lag', 'purchase_date'], axis=1, inplace=True)","3634d7d0":"df.head()","e92371fb":"df_stats = pd.merge(df, IPCA15.reset_index(), on='eval month', left_index=True)","08470c6d":"# check correlation with target, it's 99% coincidence, but mb usefull\ndf_stats.corr().iloc[4:,3:4]","07d7874a":"IPCA15.to_csv('IPCA15.csv')","4a565870":"!rm -r cache\n!wget -q -r -l 1 ftp:\/\/ftp.ibge.gov.br\/Precos_Indices_de_Precos_ao_Consumidor\/INPC\/Resultados_por_Subitem\/ -A zip\n!wget -q -r ftp:\/\/ftp.ibge.gov.br\/Precos_Indices_de_Precos_ao_Consumidor\/INPC\/Resultados_por_Subitem\/2017    \n!mkdir cache\n!for z in ftp.ibge.gov.br\/Precos_Indices_de_Precos_ao_Consumidor\/INPC\/Resultados_por_Subitem\/2017\/*.zip; do unzip -qq \"$z\" -d cache; done\n!for z in ftp.ibge.gov.br\/Precos_Indices_de_Precos_ao_Consumidor\/INPC\/Resultados_por_Subitem\/*.zip; do unzip -qq \"$z\" -d cache; done\n!rm -r ftp.ibge.gov.br","7ad36d51":"filenames = glob.glob('.\/cache\/*.xls')\n# And now collect colomn 'NACIONAL' in DataFrame by month\nINPC = pd.DataFrame(index=pd.DatetimeIndex(freq='M', start='2017-01-01', end='2018-12').to_period('M')\n                          , columns=cols_cat)\n\nfor file in filenames:\n    mth = file.split('_')[1][:6]\n    idx = pd.to_datetime(mth[:4]+'-'+mth[-2:]).to_period('M')\n    tmp = pd.read_excel(file, index_col=[0], header=[4], skiprows=[5])\n    INPC.loc[idx,:] = tmp.drop_duplicates().loc[cols_cat, 'NACIONAL'].values\nINPC[cols_cat] = INPC[cols_cat].astype(np.float32)\nINPC.index.name='eval month'","0d47439d":"df_stats = pd.merge(df, INPC.reset_index(), on='eval month', left_index=True)","e7b23e5b":"df_stats.corr().iloc[4:,3:4]","99f1a8df":"INPC.to_csv('INPC.csv')","99ce987c":"!rm -r cache","a3bbcc64":"### Extended National Consumer Price Index 15 - IPCA-15\nThe National System of Consumer Price Indexes - SNIPC produces - continuously and systematically - consumer price indexes and, in this production, has, as data collection units, commercial and service-rendering establishments, concessionaires of public Internet services.","b12b8a1a":"![](https:\/\/www.ibge.gov.br\/templates\/novo_portal_internas\/imagens\/logo_mobile.png)\n\n## The Brazilian Institute of Geography and Statistics or IBGE (Portuguese: Instituto Brasileiro de Geografia e Estat\u00edstica) is the agency responsible for official collection of statistical, geographic, cartographic, geodetic and environmental information in Brazil. IBGE performs a decennial national census; questionnaires account for information such as age, household income, literacy, education, occupation and hygiene levels.\n\n### So get some statistic from [IBGE](https:\/\/www.ibge.gov.br\/en\/np-statistics\/full-list-statistics.html)","293b5c0d":"### National Consumer Price Index - INPC\nThe National System of Consumer Price Indexes - SNIPC continuously and systematically produces the National Consumer Price Index - INPC, aimed at the correction of the purchasing power of salaries by means of the measurement of price changes in the basket of the lowest-income salaried population. That income range was created in order to guarantee a 50% coverage of families with a salaried reference person and living in urban areas included in the National System of Consumer Price Indexes - SNIPC . ","cbc95925":"## If you finded some worthwhile method using stats - inform please !"}}