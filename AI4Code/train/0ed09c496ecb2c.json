{"cell_type":{"184872b2":"code","c5bfc62e":"code","5df99f4a":"code","8eba0ae8":"markdown","b5f420c6":"markdown","8f38aa6d":"markdown","bfc8caeb":"markdown"},"source":{"184872b2":"from urllib.request import urlopen as uReq\nfrom bs4 import BeautifulSoup as soup\nimport re\n\nfilename = 'Cities.csv'\nheaders  = 'City,Latitude,Longitude\\n'\nf = open(filename, \"w\")\nf.write(headers)\nfor j in range(1,9):    \n    page_url  = f'https:\/\/www.latlong.net\/category\/cities-102-15-{j}.html'\n    uClient   = uReq(page_url)\n    page_soup = soup(uClient.read(), \"html.parser\")\n    uClient.close()\n    rows = page_soup.findAll('tr')\n    rows = rows[1:]\n    for row in rows:\n        cell      = row.findAll('td')\n        City      = cell[0].text\n        Latitude  = cell[1].text\n        Longitude = cell[2].text\n        f.write(re.sub(r',\\s*', '|',City) + ',' + Latitude + ',' + Longitude + '\\n')\nf.close()","c5bfc62e":"!cat Cities.csv","5df99f4a":"!curl https:\/\/www.latlong.net\/category\/cities-102-15-1.html","8eba0ae8":"We can check that this outputs correctly with a cat","b5f420c6":"# Web scraping with python to .csv file\n\nOriginal Question: https:\/\/www.kaggle.com\/questions-and-answers\/147422\n\n\n> I couldn't run this code, however I could run it in Jupyter Notebook. It gave me an error, and a csv file with only the headers.\n\n```\nfilename = 'Cities.csv'\nheaders = 'City,Latitude,Longitude\\n'\nf = open(filename, \"w\")\nf.write(headers)\nfor j in range(1,9):    \n   page_url = f'https:\/\/www.latlong.net\/category\/cities-102-15-{j}.html'\n   uClient = uReq(page_url)\n   page_soup = soup(uClient.read(), \"html.parser\")\n   uClient.close()\n   rows = page_soup.findAll('tr')\n   rows = rows[1:]\n\n   for row in rows:\n       cell = row.findAll('td')\n       City = cell[0].text\n       Latitude = cell[1].text\n       Longitude = cell[2].text\n       f.write(City.replace(',', '|') + ',' + Latitude + ',' + Longitude + '\\n')\nf.close()\n```\n\n> Thanks for any advice!","8f38aa6d":"Here is the raw text of the data being scraped","bfc8caeb":"Your code works for me. \n- I think you were just missing a couple of import statements. \n- I also tweaked a `City.replace(',', '|')` with `re.sub(r',\\s*', '|',City)` to remove the whitespace between |'s in the output"}}