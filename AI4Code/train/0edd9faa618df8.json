{"cell_type":{"0c632f1a":"code","24847087":"code","85839ec9":"code","241c52ca":"code","94803bc6":"code","2acee091":"code","c961bee0":"code","6fdc6e28":"code","115f4fac":"code","fabbaae0":"code","5b4cb443":"code","a9fed2f5":"code","58edc441":"code","a1e43c1f":"code","28576d42":"code","0bd827f9":"code","b36061d8":"code","30a42ad2":"code","31d7afe2":"code","e08938d2":"code","9309358a":"code","c5d11b66":"code","24afb49c":"code","fecebeac":"code","c99a936c":"code","93246845":"code","08ef7500":"code","386ebac2":"code","d21183e2":"code","3d6eb479":"code","918628b2":"code","aa8e8788":"code","b7c6caea":"code","cee57035":"code","c994a291":"code","ed517e96":"code","77f90285":"code","632b2489":"code","b5717da1":"code","e5948c34":"code","6acd8f6f":"code","269207da":"code","de425a96":"code","d06fd9e0":"code","87ffda4d":"code","0ecc225f":"code","d099862e":"code","61eb861b":"code","f88b4351":"code","083e3b3c":"code","3bfb55c5":"code","532aaebb":"code","fac8381d":"code","c88603c2":"code","22c90072":"code","69a33a82":"code","4b57c678":"code","49c703fa":"code","4b5d9fa5":"code","66724f7f":"code","7f1bab67":"code","20fd74ff":"code","8b0708f9":"code","30ba16cc":"code","b4d6407b":"code","c3cca27a":"code","afd2fd0e":"code","173e9463":"code","f45e260b":"code","22a2a846":"markdown","4f1b5780":"markdown","3e74818c":"markdown","e7ac63b2":"markdown","2cd0ade7":"markdown","7791eb35":"markdown","eecb14c4":"markdown","c41ebdc9":"markdown","da413250":"markdown","60c4dd8c":"markdown","926478b6":"markdown","5c7659e4":"markdown"},"source":{"0c632f1a":"import pandas as pd\nimport numpy as np","24847087":"df=pd.read_csv(\"..\/input\/bengaluru-house-price-data\/Bengaluru_House_Data.csv\")","85839ec9":"df.head()","241c52ca":"df.groupby(\"area_type\")[\"area_type\"].agg(\"count\")","94803bc6":"df.shape","2acee091":"df.drop([\"area_type\",\"availability\",\"society\",\"balcony\"],axis=1,inplace=True)","c961bee0":"df.isnull().sum()","6fdc6e28":"df.dropna(inplace=True)    #drops all the Rows which has NA values","115f4fac":"df.shape    ","fabbaae0":"df[\"size\"].unique()    #BHK and bedroooms are same","5b4cb443":"# Now we will be needing the first numeric value only\n\ndf[\"bhk\"]=df[\"size\"].apply(lambda x: int(x.split(\" \")[0]))  ","a9fed2f5":"df.head()","58edc441":"df[\"bhk\"].unique()","a1e43c1f":"df[df.bhk>20]    # its not possible to have house with 43 bedroooms in just area of 2400 sqft","28576d42":"df.total_sqft.unique()   # here you can see a sqft in range-> so we will take avg of min and max  ","0bd827f9":"#this function will check whether the value is convertable to float or not\n#the values which have range or string in it they cannot be converted float -> so the func returns flase for it\n\ndef is_float(x):\n    try:\n        float(x)\n    except:\n        return False\n    return True","b36061d8":"df.total_sqft.apply(is_float)   #returns Boolean value","30a42ad2":"df[df.total_sqft.apply(is_float)].head() #returns the rows with only True boolean values-> but we need the opposite","31d7afe2":"df[~df.total_sqft.apply(is_float)].tail(10)   #putting the negate symbol-> converts Flase to True and returns them","e08938d2":"def convert_to_sqft(x):\n    tokens =x.split(\"-\")\n    if len(tokens)==2:\n        return (float(tokens[0])+float(tokens[1]))\/2\n    try:\n        return float(x)\n    except: \n        return None","9309358a":"convert_to_sqft(\"4000 - 4450\")","c5d11b66":"convert_to_sqft(\"2000\")","24afb49c":"print(convert_to_sqft(\"200yard\"))  #returns none","fecebeac":"df[\"sqft\"]=df[\"total_sqft\"].apply(convert_to_sqft)","c99a936c":"df.head()","93246845":"df.drop([\"total_sqft\",\"size\"],axis=1,inplace=True)","08ef7500":"df.isnull().sum()","386ebac2":"df.dropna(inplace=True)","d21183e2":"df.isnull().sum()","3d6eb479":"#adding price_per_sqft\n\ndf[\"price_per_sqft\"]= (df[\"price\"]*100000)\/df[\"sqft\"]","918628b2":"df.head(3)","aa8e8788":"# working loaction feature\n\nlen(df.location.unique())   #a lot of location so we will define a Other category","b7c6caea":"df[\"location\"].apply(lambda x: x.strip())","cee57035":"loc_count=df.groupby(\"location\")[\"location\"].agg(\"count\")\nlen(loc_count)","c994a291":"other=loc_count[loc_count<=10]\nlen(other)","ed517e96":"##applying it \n\ndf.location=df.location.apply(lambda x: \"other\" if x in other else x)","77f90285":"len(df.location.unique())","632b2489":"df.tail()    #2nd location is converted now to other","b5717da1":"#on seeing the data you can say that sqft per room must be around 600\n\ndf[df[\"sqft\"]\/df[\"bhk\"]<300].head()  #these are anomalies -> we need to remove them","e5948c34":"df=df[~(df[\"sqft\"]\/df[\"bhk\"]<300)]   # Negate~ will filter out the outliers","6acd8f6f":"df.price_per_sqft.describe()   #min value is very low and unlikely , same case with max","269207da":"a=[]\nfor key ,subdf in df.groupby(\"location\"): \n    a.append(np.mean(subdf.price_per_sqft))\nlen(a)","de425a96":"def remove_outliers(var):\n    df_out=pd.DataFrame()\n    for key, subdf in var.groupby(\"location\"):\n        m=np.mean(subdf.price_per_sqft)\n        st=np.std(subdf.price_per_sqft)\n        reduced_df= subdf[(subdf.price_per_sqft> (m-st)) & (subdf.price_per_sqft< (m+st))]\n        df_out=pd.concat([df_out,reduced_df],ignore_index=True)\n    return df_out","d06fd9e0":"df1=remove_outliers(df)","87ffda4d":"df1.shape   #around 2000 outliers have been removed","0ecc225f":"df.shape","d099862e":"from matplotlib import pyplot as plt\n%matplotlib inline\nimport matplotlib \nmatplotlib.rcParams[\"figure.figsize\"] = (20,10)","61eb861b":"\ndef plot_scatter_chart(df,location):\n    bhk2 = df[(df.location==location) & (df.bhk==2)]\n    bhk3 = df[(df.location==location) & (df.bhk==3)]\n    matplotlib.rcParams['figure.figsize'] = (15,10)\n    plt.scatter(bhk2.sqft,bhk2.price,color='blue',label='2 BHK', s=50)\n    plt.scatter(bhk3.sqft,bhk3.price,marker='+', color='green',label='3 BHK', s=50)\n    plt.xlabel(\"Total Square Feet Area\")\n    plt.ylabel(\"Price (Lakh Indian Rupees)\")\n    plt.title(location)\n    plt.legend()\n    \nplot_scatter_chart(df1,\"Rajaji Nagar\")\n\n#between 1600 and 1800 we can see a vertical line which shows for same area price for 2 bedroom is higher than of 3","f88b4351":"def remove_bhk_outliers(df):\n    exclude_indices = np.array([])\n    for location, location_df in df.groupby('location'):\n        bhk_stats = {}\n        for bhk, bhk_df in location_df.groupby('bhk'):\n            bhk_stats[bhk] = {\n                'mean': np.mean(bhk_df.price_per_sqft),\n                'std': np.std(bhk_df.price_per_sqft),\n                'count': bhk_df.shape[0]\n            }\n        for bhk, bhk_df in location_df.groupby('bhk'):\n            stats = bhk_stats.get(bhk-1)\n            if stats and stats['count']>5:\n                exclude_indices = np.append(exclude_indices, bhk_df[bhk_df.price_per_sqft<(stats['mean'])].index.values)\n    return df.drop(exclude_indices,axis='index')","083e3b3c":"df2 = remove_bhk_outliers(df1)\ndf2.shape","3bfb55c5":"plot_scatter_chart(df2,\"Rajaji Nagar\") #you can notice the diff between this and previous","532aaebb":"matplotlib.rcParams[\"figure.figsize\"] = (20,10)\nplt.hist(df2.price_per_sqft,rwidth=0.8)\nplt.xlabel(\"Price Per Square Feet\")\nplt.ylabel(\"Count\")\n\n#lokks perfect #bell curve","fac8381d":"df2[df2.bath>df2.bhk+2]","c88603c2":"df3=df2[df2.bath<df2.bhk+2]   #removing the outliers","22c90072":"df3.shape","69a33a82":"df3.drop(\"price_per_sqft\",axis=1,inplace=True)","4b57c678":"len(df3)","49c703fa":"#One hot encoding\n\ndummies=pd.get_dummies(df3.location)\ndummies.head()\nlen(dummies)","4b5d9fa5":"df4=pd.concat([df3,dummies.drop(\"other\",axis=1)],axis=1)   #remember to specify the axis\ndf4.head()","66724f7f":"df4.drop(\"location\",axis=1,inplace=True)","7f1bab67":"X=df4.drop(\"price\",axis=1)\ny=df4.price","20fd74ff":"from sklearn.model_selection import train_test_split","8b0708f9":"X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)","30ba16cc":"from sklearn.linear_model import LinearRegression","b4d6407b":"lr=LinearRegression()\nlr.fit(X_train,y_train)\nlr.score(X_test,y_test)","c3cca27a":"from sklearn.model_selection import GridSearchCV,ShuffleSplit\n\nfrom sklearn.linear_model import Lasso\nfrom sklearn.tree import DecisionTreeRegressor\n\ndef find_best_model_using_gridsearchcv(X,y):\n    algos = {\n        'linear_regression' : {\n            'model': LinearRegression(),\n            'params': {\n                'normalize': [True, False]\n            }\n        },\n        'lasso': {\n            'model': Lasso(),\n            'params': {\n                'alpha': [1,2],\n                'selection': ['random', 'cyclic']\n            }\n        },\n        'decision_tree': {\n            'model': DecisionTreeRegressor(),\n            'params': {\n                'criterion' : ['mse','friedman_mse'],\n                'splitter': ['best','random']\n            }\n        }\n    }\n    scores = []\n    cv = ShuffleSplit(n_splits=5, test_size=0.2, random_state=0)\n    for algo_name, config in algos.items():\n        gs =  GridSearchCV(config['model'], config['params'], cv=cv, return_train_score=False)\n        gs.fit(X,y)\n        scores.append({\n            'model': algo_name,\n            'best_score': gs.best_score_,\n            'best_params': gs.best_params_\n        })\n\n    return pd.DataFrame(scores,columns=['model','best_score','best_params'])\n\nfind_best_model_using_gridsearchcv(X,y)","afd2fd0e":"from sklearn.linear_model import LinearRegression\n\nlr=LinearRegression(normalize=True)\nlr.fit(X_train,y_train)\nlr.score(X_test,y_test)","173e9463":"import joblib\n\njoblib.dump(lr,\"Bangalore_House_prices\")","f45e260b":"import json\ncolumns = {\n    'data_columns' : [col.lower() for col in X.columns]\n}\nwith open(\"columns.json\",\"w\") as f:\n    f.write(json.dumps(columns))","22a2a846":"### Outlier removal -> data errors or extreme variation in data","4f1b5780":" **x.split splits string with reference to the space and then using indexing [0] to grab the first value(which is the numeric value , then we use int() to convert the string into int and return it**","3e74818c":"## Model Training","e7ac63b2":"**Let's check if for a given location how does the 2 BHK and 3 BHK property prices look like**\n","2cd0ade7":"**we will drop the unneccesary columns like price_per_sqft as it has no other use than removing the outliers**","7791eb35":"### Export location and column information to a file that will be useful later on in our prediction application\n","eecb14c4":"**It is unusual to have 2 more bathrooms than number of bedrooms in a home**","c41ebdc9":"### Exporting the model","da413250":"{\n    '1' : {\n        'mean': 4000,\n        'std: 2000,\n        'count': 34\n    },\n    '2' : {\n        'mean': 4300,\n        'std: 2300,\n        'count': 22\n    },    \n}\nNow we can remove those 2 BHK apartments whose price_per_sqft is less than mean price_per_sqft of 1 BHK apartment","60c4dd8c":" **while filling na values : (1) use mean() when the values are continuous (float values) and (2) use median() when the values are classified (like number of Balcony which cannot be a float value)**","926478b6":"### Feature engineering -> adding new Feature","5c7659e4":"**We should also remove properties where for same location, the price of (for example) 3 bedroom apartment is less than 2 bedroom apartment (with same square ft area). What we will do is for a given location, we will build a dictionary of stats per bhk, i.e.**"}}