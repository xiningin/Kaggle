{"cell_type":{"f36dacba":"code","634fd6a0":"code","f97cd69d":"code","95c62d3a":"code","5190af9d":"code","2ef359d3":"code","a054f5be":"code","0fcab363":"code","9decc225":"code","36fd7e52":"code","d5ca0c69":"code","81e6861d":"code","86b05749":"code","13deed06":"code","8b6dbdf2":"code","38601fb8":"code","860f9a01":"code","c43b9b4b":"code","b6bc321c":"code","fe1a0340":"code","911420fd":"code","f0d9367e":"code","05929976":"code","0dec86a5":"code","acf2138d":"code","d15fbf5f":"code","23f3cf28":"code","88dd2914":"code","27f27f6e":"code","8cb5b8dc":"code","834e7288":"markdown","9c802326":"markdown","85843e77":"markdown","15e1e002":"markdown","67af594c":"markdown","c604957b":"markdown","b00e011b":"markdown","4c301389":"markdown","ef128275":"markdown","e598d347":"markdown","f48516bd":"markdown","31c1b289":"markdown","b544a849":"markdown","4ff0f06c":"markdown","beb459e8":"markdown","67b84284":"markdown","fba3e373":"markdown"},"source":{"f36dacba":"import pandas as pd\nimport datetime as dt\nimport numpy as np\nimport matplotlib.pyplot as plt","634fd6a0":"# \u8bfb\u53d6\u6570\u636e\n\ndf = pd.read_csv('..\/input\/retailtransactiondata\/Retail_Data_Transactions.csv', parse_dates=['trans_date'])","f97cd69d":"# \u67e5\u770b\u524d\u4e09\u6761\u6570\u636e\ndf.head(3)","95c62d3a":"df.info()","5190af9d":"# \u6700\u65e9\u548c\u6700\u665a\u4ea4\u6613\u8bb0\u5f55\n\nprint(df['trans_date'].min(), df['trans_date'].max())","2ef359d3":"sd = dt.datetime(2015,4,1)\ndf['hist']=sd - df['trans_date']\ndf.head(3)","a054f5be":"# \u63d0\u53d6\u5929\u6570\u7684\u503c\n\ndf['hist'].astype('timedelta64[D]')\ndf['hist']=df['hist'] \/ np.timedelta64(1, 'D')\ndf.head(3)","0fcab363":"df=df[df['hist'] < 730]\ndf.info()","9decc225":"rfmTable = df.groupby('customer_id').agg({'hist': lambda x:x.min(),                 # Recency\n                                        'customer_id': lambda x: len(x),            # Frequency\n                                        'tran_amount': lambda x: x.sum()})          # Monetary Value\n\nrfmTable.rename(columns={'hist': 'recency', \n                         'customer_id': 'frequency', \n                         'tran_amount': 'monetary_value'}, inplace=True)","36fd7e52":"rfmTable.head()","d5ca0c69":"df[df['customer_id']=='CS1112']","81e6861d":"# \u67e5\u770bRFM\u4e09\u4e2a\u7ef4\u5ea6\u7684\u56db\u5206\u7ebf\n\nquartiles = rfmTable.quantile(q=[0.25,0.50,0.75])\nprint(quartiles, type(quartiles))","86b05749":"quartiles=quartiles.to_dict()\nquartiles\n","13deed06":"# \u8ba1\u7b97\u6700\u8fd1\u6d88\u8d39\u65f6\u95f4\uff08R\uff09\u5f97\u5206\n\ndef RClass(x,p,d):\n    if x <= d[p][0.25]:\n        return 1\n    elif x <= d[p][0.50]:\n        return 2\n    elif x <= d[p][0.75]: \n        return 3\n    else:\n        return 4\n    \n# \u6d88\u8d39\u6b21\u6570\uff08F\uff09\u548c\u6d88\u8d39\u603b\u989d\uff08M\uff09\u5f97\u5206\n\ndef FMClass(x,p,d):\n    if x <= d[p][0.25]:\n        return 4\n    elif x <= d[p][0.50]:\n        return 3\n    elif x <= d[p][0.75]: \n        return 2\n    else:\n        return 1    \n    ","8b6dbdf2":"rfmSeg = rfmTable\nrfmSeg['R_Quartile'] = rfmSeg['recency'].apply(RClass, args=('recency',quartiles,))\nrfmSeg['F_Quartile'] = rfmSeg['frequency'].apply(FMClass, args=('frequency',quartiles,))\nrfmSeg['M_Quartile'] = rfmSeg['monetary_value'].apply(FMClass, args=('monetary_value',quartiles,))","38601fb8":"rfmSeg['RFMClass'] = rfmSeg.R_Quartile.map(str) \\\n                            + rfmSeg.F_Quartile.map(str) \\\n                            + rfmSeg.M_Quartile.map(str)","860f9a01":"rfmSeg.head()","c43b9b4b":"rfmSeg.sort_values(by=['RFMClass', 'monetary_value'], ascending=[True, False])","b6bc321c":"rfmSeg.groupby('RFMClass').agg('monetary_value').mean()","fe1a0340":"rfmSeg['Total Score'] = rfmSeg['R_Quartile'] + rfmSeg['F_Quartile'] +rfmSeg['M_Quartile']\nprint(rfmSeg.head(), rfmSeg.info())","911420fd":"# \u6bcf\u4e2a\u5206\u7ec4\u7684\u6d88\u8d39\u5e73\u5747\u503c\n\nrfmSeg.groupby('Total Score').agg('monetary_value').mean()","f0d9367e":"rfmSeg.groupby('Total Score').agg('monetary_value').mean().plot(kind='bar', colormap='Blues_r')","05929976":"rfmSeg.groupby('Total Score').agg('frequency').mean().plot(kind='bar', colormap='Blues_r')","0dec86a5":"rfmSeg.groupby('Total Score').agg('recency').mean().plot(kind='bar', colormap='Blues_r')","acf2138d":"res = pd.read_csv('..\/input\/retailtransactiondata\/Retail_Data_Response.csv')\nres.sort_values('customer_id', inplace=True)\n\nprint(res.head(), res.info())","d15fbf5f":"rfmSeg.reset_index(inplace=True)\nrfmSeg.head()","23f3cf28":"rfmSeg.sort_values('customer_id', inplace=True)\nrfm2=pd.merge(rfmSeg, res, on='customer_id')","88dd2914":"rfm2.head()","27f27f6e":"rfm2.info()","8cb5b8dc":"ax=rfm2.groupby('Total Score').agg('response').mean().plot(kind='bar', colormap='copper_r')\nax.set_xlabel(\"Total Score\")\nax.set_ylabel(\"Proportion of Responders\")","834e7288":"\u53ea\u8003\u8651\u4e24\u5e74\u4e4b\u5185\u7684\u4ea4\u6613\uff0c\u53bb\u6389\u4e24\u5e74\u524d\u7684\u6570\u636e","9c802326":"\u5c06\u56db\u5206\u4f4d\u7ebf\u5b58\u8fdb\u8bcd\u5178","85843e77":"RFM\u5206\u6790\u901a\u5e38\u5728\u6d88\u8d39\u65f6\u95f4\uff08R\uff09\u3001\u6d88\u8d39\u6b21\u6570\uff08F\uff09\u3001\u6d88\u8d39\u603b\u91d1\u989d\uff08M\uff09\u4e09\u4e2a\u7ef4\u5ea6\u4e0a\u5c06\u7528\u6237\u5206\u522b\u8fdb\u884c\u5f52\u7c7b\u3002    \n\u8fd9\u6b21\u5206\u6790\u6309\u7167\u56db\u5206\u4f4d\u7ebf\u5c06\u5ba2\u6237\u5206\u4e3a4\u7c7b\u3002","15e1e002":"\u53e6\u4e00\u4e2a\u7ec4\u5408\u8bc4\u5206\u7684\u65b9\u6cd5\u5c31\u662f\u5bf9\u4e09\u9879\u5206\u6570\u8fdb\u884c\u6c42\u548c\u3002\u8fd9\u4e2a\u65b9\u6cd5\u4ea7\u751f\u7684\u5206\u7ec4\u8f83\u5c11\uff0c\u4f46\u5b83\u7684\u7f3a\u70b9\u662f\uff0c\u8fd9\u6837\u7684\u5206\u7ec4\u4f53\u73b0\u4e0d\u4e86\u67d0\u4e9b\u7ec6\u5206\u5ba2\u6237\u7684\u7279\u70b9\uff0c\u6bd4\u5982421\u548c142\u4f1a\u88ab\u5206\u5728\u540c\u4e00\u7ec4\u3002","67af594c":"\u4ea4\u53c9\u6bd4\u5bf9\u5ba2\u6237'CS1112'\u7684\u4ea4\u6613\u4fe1\u606f\u548crfm\u6570\u636e. ","c604957b":"\u5728RFM\u4e09\u4e2a\u7ef4\u5ea6\u4e2d\uff0c\u6700\u8fd1\u6d88\u8d39\u65f6\u95f4\uff08R\uff09\u8d8a\u5c0f\u8d8a\u597d\uff0c\u6d88\u8d39\u6b21\u6570\uff08F\uff09\u548c\u6d88\u8d39\u603b\u91d1\u989d\uff08M\uff09\u8d8a\u5927\u8d8a\u597d\u3002   \n\u6240\u4ee5\u5728\u5206\u7c7b\u8ba1\u5206\u7684\u65f6\u5019\uff0cR\u8d8a\u4f4e\u5f97\u5206\u8d8a\u9ad8\u3002","b00e011b":"\u4f7f\u7528\u6570\u636e\u7528\u5305\u542b\u5ba2\u6237id\u3001\u4ea4\u6613\u65f6\u95f4\u3001\u6536\u6b3e\u91d1\u989d\u4e09\u4e2a\u7ef4\u5ea6\u3002","4c301389":"\u53ef\u4ee5\u8f83\u660e\u663e\u5730\u770b\u5230\uff0c\u5404\u7ec4\u7684RFM\u5e73\u5747\u503c\u4e0e\u5f97\u5206\u5448\u6b63\u76f8\u5173\u3002","ef128275":"\u7edf\u8ba1\u6bcf\u4e2a\u5ba2\u6237\u7684\u6700\u8fd1\u6d88\u8d39\u65f6\u95f4\uff08Recency\uff09\u3001\u6d88\u8d39\u6b21\u6570\uff08Frequency\uff09\u3001\u6d88\u8d39\u603b\u91d1\u989d\uff08Monetary Value\uff09","e598d347":"\u5047\u8bbe\u5206\u6790\u65f6\u95f4\u4e3a2015\u5e744\u67081\u65e5\uff0c\u5e76\u4ee5\u6b64\u8ba1\u7b97\u6700\u8fd1\u4e00\u6b21\u6d88\u8d39\uff08Recency\uff09","f48516bd":"\u786e\u5b9a\u6700\u65e9\u548c\u6700\u665a\u4ea4\u6613\u8bb0\u5f55","31c1b289":"\u5bf9\u5ba2\u6237\u8fdb\u884c\u5206\u7c7b\u9700\u8981\u5c06\u4e09\u9879\u8bc4\u5206\u7ed3\u5408\u5230\u4e00\u8d77\u6765\u770b\u3002\u6700\u7b80\u5355\u7684\u4e00\u79cd\u529e\u6cd5\u5c31\u662f\u5c06\u8bc4\u5206\u7ec4\u5408\u51fa\u4e00\u4e2a\u4e09\u4f4d\u6570\u5b57\u3002\u4f46\u662f\u8fd9\u6837\u505a\u7684\u7f3a\u70b9\u5c31\u662f\u4ea7\u751f\u51fa\u7684\u5206\u7c7b\u7ec4\u5408\u592a\u591a\u3002","b544a849":"\u7528\u67f1\u72b6\u56fe\u76f4\u89c2\u8868\u793a\u6bcf\u4e2a\u5f97\u5206\u7ec4\u522b\u7684RFM\u5e73\u5747\u503c\u3002","4ff0f06c":"\u6bcf\u6761\u6570\u636e\u7531\u5355\u6b21\u4ea4\u6613\u4ea7\u751f","beb459e8":"# \u5bf9\u96f6\u552e\u4e1a\u7684\u5ba2\u6237\u6570\u636e\u8fdb\u884cRFM\u5206\u6790\u548c\u7528\u6237\u5212\u5206","67b84284":"\u67f1\u72b6\u56fe\u53cd\u6620\u51fa\u5ba2\u6237\u5bf9\u4fc3\u9500\u6d3b\u52a8\u7684\u54cd\u5e94\u7387\u4e0e\u5ba2\u6237\u7684RFM\u5f97\u5206\u6709\u5f88\u5f3a\u7684\u76f8\u5173\u6027\u3002\u5e76\u5728\u5f97\u52066\u548c7\u4e4b\u95f4\u5448\u73b0\u51fa\u4e00\u4e2a\u811a\u5927\u7684\u5dee\u8ddd\u3002","fba3e373":"\u6700\u540e\u68c0\u67e5\u5404\u4e2a\u5206\u7ec4\u5ba2\u6237\u5bf9\u4fc3\u9500\u6d3b\u52a8\u7684\u53cd\u5e94\u3002"}}