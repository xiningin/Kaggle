{"cell_type":{"a21ea09d":"code","107b4537":"code","7affea1c":"code","91ca5136":"code","ff9d090d":"code","3baa5149":"code","447eca46":"code","d97c30b7":"code","67e84cff":"code","ebbdc66b":"code","acee828e":"code","1ff58816":"code","c097f4ba":"code","b2b293da":"code","565dd5e6":"code","7cd878bb":"code","567df55c":"code","4396162c":"code","6b1989b1":"code","047a17e1":"code","a209c9bc":"code","83864e78":"code","7c9b4992":"code","028b56f2":"code","14d5c470":"code","e7929998":"code","f7c962da":"markdown","0d4d173a":"markdown","742a9b60":"markdown"},"source":{"a21ea09d":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport os\nprint(os.listdir(\"..\/input\"))\n","107b4537":"forums = pd.read_csv('..\/input\/Forums.csv').set_index(\"Id\").rename(columns={\"Title\":\"Forum_Title\"})\nforums.head()","7affea1c":"## basic users info (name..). Note that this is leaky(PerformanceTier)! it's not time stamped. It can also be joined with more data, e.g. teams, organization\nusers = pd.read_csv('..\/input\/Users.csv').set_index(\"Id\").drop(\"PerformanceTier\",axis=1).drop_duplicates()\nprint(users.shape)\nusers.head()","91ca5136":"### there are multiple ForumId s . Not unique! \n## Many of these column are effectively leaky variables (not time stamped, and they could indicate a \"topic\" containing a popular post)\n\nforumsTopics = pd.read_csv('..\/input\/ForumTopics.csv').drop(['Score'],axis=1).drop_duplicates().set_index(\"Id\")\nprint(forumsTopics.shape)\nprint(forumsTopics.nunique())\nforumsTopics.head()","ff9d090d":"forumsTopics.columns","3baa5149":"messages = pd.read_csv('..\/input\/ForumMessages.csv').drop(\"MedalAwardDate\",axis=1)\nmessages = messages[messages.Message.notna()].drop_duplicates(subset=\"Message\")\nmessages.Medal.fillna(-1,inplace=True)\nmessages['PostDate'] = pd.to_datetime(messages['PostDate'], infer_datetime_format=True)\n# messages = messages.sort_values('PostDate')\nmessages.tail()","447eca46":"messages[\"Medal\"].hist()","d97c30b7":"print(messages[\"Medal\"].isna().sum())\nmessages[\"Medal\"].describe()","67e84cff":"print(messages.shape)\n# messages= messages.join(forumsTopics,on=\"ForumTopicId\",how=\"left\")\nmessages = messages.join(forumsTopics,on=\"ForumTopicId\",how=\"inner\")\nprint(messages.shape)\n# print(messages.join(forumsTopics,on=\"ForumTopicId\",how=\"inner\").shape)\n# messages.tail()","ebbdc66b":"messages.tail()","acee828e":"forums.head()","1ff58816":"messages = messages.join(forums,on=\"ForumId\")\n","c097f4ba":"## add parent forum title, if any\nmessages = messages.join(forums,on=\"ParentForumId\",rsuffix=\"_parent\")\nprint(messages.shape)","b2b293da":"messages = messages.join(users,on=\"PostUserId\")","565dd5e6":"messages.head()","7cd878bb":"messages[\"message_word_length\"] = messages[\"Message\"].str.split().str.len()\nmessages[\"message_char_length\"] = messages[\"Message\"].str.len()","567df55c":"print(messages.loc[messages.Medal > -1][\"message_word_length\"].quantile(0.995))\nmessages.loc[messages.Medal > -1][\"message_word_length\"].describe()","4396162c":"print(messages[\"message_word_length\"].quantile(0.995))\nmessages[\"message_word_length\"].describe()","6b1989b1":"messages[\"message_char_length\"].describe()","047a17e1":"messages = messages.loc[messages[\"message_word_length\"]<900]\nprint(messages.shape[0])","a209c9bc":"messages[\"message_word_length\"].describe()","83864e78":"messages.columns","7c9b4992":"messages[\"Medal\"] = (messages[\"Medal\"]>-1).astype(int)","028b56f2":"# messages[\"First_or_last_message\"] = ((messages['Id']==messages['LastForumMessageId']) | messages['Id']==messages['FirstForumMessageId'])\n\n# messages[\"First_or_last_message\"].describe()  ### only 20 such cases - maybe wrong key? Ignore for now","14d5c470":"messages.tail()","e7929998":"messages.drop(['Id', 'ForumId','LastForumMessageId',\n       'FirstForumMessageId', 'ForumTopicId','ParentForumId', 'ParentForumId_parent',\n               'TotalReplies'],axis=1).drop_duplicates().to_csv(\"kaggle_medals_train_v1.csv.gz\",index=False,compression=\"gzip\")","f7c962da":"* optional: clean html from messages, +- extract code into seperate col","0d4d173a":"#### text length filter\n* Very long texts are expensive to compute on\n* We see that while post lengths differ between the classes (as expected), the outliers remain the same, so it seems safe to exclude some of the excessively long posts","742a9b60":"* based on: \nhttps:\/\/www.kaggle.com\/pavlofesenko\/strategies-to-earn-discussion-medals"}}