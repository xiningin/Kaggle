{"cell_type":{"c26d65ad":"code","6ec7c3ff":"code","23193154":"code","7d9596aa":"code","ee6e3754":"code","75e0936d":"code","04dd0b2c":"code","d1e1d035":"code","afb313c8":"code","8b2860ff":"code","9759af4b":"code","277ba06b":"code","2021a8f5":"code","f98432f8":"code","50fc0f6e":"code","4ea5cee3":"code","34a4f7c9":"code","7892c08c":"code","f8257670":"code","a21749ca":"code","67820c7b":"code","3b412a02":"code","4ae3c82b":"code","37c948d8":"code","f5ca3228":"code","cf18e598":"code","88c54410":"code","43c811ff":"code","e4ec0450":"code","26dd9e92":"code","3dfa4b77":"code","0a44d435":"code","c2505da2":"code","52b0cd13":"code","f039d2cb":"code","8d829ff2":"code","6502af6b":"code","2fd98724":"code","0ff8080c":"code","a99a304a":"code","2a6e4034":"code","3fb332a6":"code","fb4e00b5":"code","3f3df067":"code","cc86e383":"code","68454765":"code","b30cfac0":"code","331f50de":"code","343612b9":"code","51a05d24":"code","d26a1fdc":"code","6e0aad10":"code","e7bb25e0":"code","89d7c839":"code","9919c6ce":"code","5301d65e":"code","30173dd4":"code","3980effc":"code","bfdf0b8e":"code","3b77bce7":"code","a7a4b90f":"code","df0a44bc":"code","64ccc0aa":"code","aa98d951":"code","59fcfc28":"code","480f3c4e":"code","713c2770":"code","e5f0b280":"code","8a355e28":"code","1eea738a":"code","bb2f4181":"code","b819735c":"code","81af25c8":"code","67b757af":"code","a59f7ea2":"code","6f26ec5f":"code","6440e2f4":"code","05d716c9":"code","aa9f9a52":"code","2905ce87":"code","368868fd":"code","b43a2489":"code","3201c6e4":"code","b816cb49":"code","332adad0":"code","280ced8c":"code","c340ea6d":"code","bc588a3a":"code","1fca5ac3":"code","dcf03ff2":"code","acdef1db":"code","9f251e9f":"code","af396eb4":"code","52e00879":"code","70735386":"code","4ad4f4bf":"code","ef3d6e28":"code","6655005e":"code","925b4a17":"code","104fa0af":"code","39fcc112":"code","31cf148f":"code","d6953648":"code","60c948bf":"code","1e20e92f":"code","f1d18e17":"code","ba6e1a87":"code","b2abb323":"code","0ec2f195":"code","773af1e2":"code","c46b24d1":"code","c42f9dbe":"code","47abbe2f":"code","f2eda6b9":"code","6712a5fe":"code","71bff942":"code","2deb0464":"code","cb9c0eb8":"code","30002ddb":"code","7b999af5":"code","c10f5059":"code","3c94c83a":"code","1e143d50":"code","d772c76e":"code","17d7ac52":"code","c5aac219":"code","eac6af4d":"code","b794dfa5":"code","2ad7f8ff":"code","b3775916":"code","e5d6fffd":"code","59697c9b":"code","0b56bfa0":"code","11c9cb99":"code","efbdbe1a":"code","f5f1b204":"code","bca1ce42":"code","864db76a":"code","e8c45c80":"code","b34df46e":"code","e2e52237":"code","11697567":"code","c626c96c":"code","86b1fe6d":"code","ba8c85e7":"code","b13b6f47":"code","a9a6d3ae":"code","96d1026d":"code","1872067b":"code","3b409f88":"code","82100191":"code","72d88a2b":"code","865d27a9":"code","db02003c":"code","6f390af3":"code","97968677":"code","c98566cb":"code","3190ccb2":"code","db865d8c":"code","0eccfdcc":"code","83a5c119":"code","b4a2e948":"code","db2b28c1":"code","1b125ad5":"code","58ae15e6":"code","667e72ae":"code","cdf33523":"code","d48c5695":"code","d5a7445f":"code","28675cb5":"code","f3601322":"code","ed97059c":"code","3048ee7c":"code","6de3a7dd":"code","2b300a8b":"code","3c3f87bf":"code","bd1c33b4":"code","85c9190e":"code","199c9433":"code","084e40a5":"code","fafb8a7a":"code","09ad9c8a":"code","7a734bcb":"code","5f2b2ae5":"code","cb3ebbde":"code","503ab782":"code","9902c0fa":"code","889734cf":"code","bf9c8f9e":"code","8236d946":"code","ac02835d":"code","70be4289":"code","ec566762":"code","7be8270c":"markdown","90d1e58b":"markdown","83ab318e":"markdown","bd80e0f7":"markdown","e173be00":"markdown","73235c90":"markdown","bf33ab42":"markdown","ee3b6a60":"markdown","444834ed":"markdown","ac3f06db":"markdown","481c97e9":"markdown","09ad03d0":"markdown","0fca93c0":"markdown","1fc096b6":"markdown","32c7d7f6":"markdown","a7b03284":"markdown","38059891":"markdown","38539942":"markdown","a0347821":"markdown","a08eaca7":"markdown","2b7fd87d":"markdown","1a7096ee":"markdown","15c4af2a":"markdown","7c057564":"markdown","c7e71f06":"markdown","cfd3ef4b":"markdown","35b09f0e":"markdown","987fe6af":"markdown","333550fc":"markdown","73270632":"markdown","9b105eb2":"markdown","0b9c839e":"markdown","d967c3db":"markdown","c04ab3ef":"markdown","5ba6983a":"markdown","d2927c4f":"markdown","2ffe38cc":"markdown","98c25aa5":"markdown","6e1dda0d":"markdown","4b4a261f":"markdown","19612e3f":"markdown","95687466":"markdown","9f006f2b":"markdown","eac1b8c3":"markdown","7c640ec5":"markdown","5851de53":"markdown","6322be5e":"markdown","4126249b":"markdown","3f713f20":"markdown","5a4935a6":"markdown","b2165613":"markdown","7879e912":"markdown","72ec61c6":"markdown","2dffe00d":"markdown","750f3c5f":"markdown","267b83c0":"markdown","ea1b5ae5":"markdown","93442310":"markdown","45ebc27b":"markdown","0030d79c":"markdown","e060cb29":"markdown","bf61f0fc":"markdown","6ca3b6b3":"markdown","4a709cf5":"markdown","8d1b5859":"markdown","8f200fbf":"markdown","65cff6fc":"markdown","988b77e7":"markdown","09a7ca77":"markdown","d88b1593":"markdown","d9305c90":"markdown","ae3a09a4":"markdown","4905e863":"markdown","eba8de86":"markdown","c1bd058d":"markdown","1a00992c":"markdown","04878e4f":"markdown","67ae30a1":"markdown","9385140f":"markdown","8b18b19d":"markdown","d1fbfb8e":"markdown","e0e51a31":"markdown","bcd332bf":"markdown","6fa2ba3e":"markdown","fdcc659a":"markdown","c0ab77c9":"markdown","00bd3f5f":"markdown","1a9a7ed1":"markdown","7ec2da7b":"markdown","25452bc4":"markdown","060952e6":"markdown"},"source":{"c26d65ad":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set()","6ec7c3ff":"train_df=pd.read_csv('..\/input\/titanic\/train.csv')","23193154":"train_df['Target']=train_df['Survived'].astype(int)\ntrain_df['Survived']=train_df['Survived'].map({1:'Yes',0:'No'})\ntrain_df.head()","7d9596aa":"train_df.info()","ee6e3754":"train_df['PassengerId'].isnull().any()","75e0936d":"train_df['Pclass'].isnull().any()","04dd0b2c":"train_df['Name'].isnull().any()","d1e1d035":"train_df['Sex'].isnull().any()","afb313c8":"train_df['Age'].isnull().any()","8b2860ff":"train_df['Age'].isnull().value_counts()","9759af4b":"train_df['SibSp'].isnull().any()","277ba06b":"train_df['Parch'].isnull().any()","2021a8f5":"train_df['Cabin'].isnull().value_counts()","f98432f8":"train_df['Embarked'].isnull().value_counts()","50fc0f6e":"sns.kdeplot(train_df['Age'],shade=True)","4ea5cee3":"sns.boxplot('Age',data=train_df)","34a4f7c9":"train_df['Age'].describe()","7892c08c":"train_df['Age'].median()","f8257670":"train_df['Age'].fillna(train_df['Age'].median(),inplace=True)","a21749ca":"train_df['Age'].isna().any()","67820c7b":"bins=np.arange(0,90,10) - 0.5\nplt.figure(figsize=(10,8))\nplt.hist(train_df['Age'],bins=bins)\nplt.xticks(rotation=90)","3b412a02":"def child(passenger):\n    age,sex=passenger\n    if age<16:\n        return 'child'\n    else:\n        return sex","4ae3c82b":"train_df['Person']=train_df[['Age','Sex']].apply(child,axis=1)","37c948d8":"train_df['Person'].value_counts()","f5ca3228":"fig1=sns.FacetGrid(train_df,hue='Sex',aspect=2,height=6)\nfig1.map(sns.kdeplot,'Age',shade=True)\nfig1.add_legend()\n","cf18e598":"fig2=sns.FacetGrid(train_df,hue='Person',aspect=2,height=8)\nfig2.map(sns.kdeplot,'Age',shade=True)\nfig2.add_legend()\n","88c54410":"sns.catplot('Person',data=train_df,kind='count',hue='Survived',aspect=2,height=6)","43c811ff":"sns.lmplot('Age','Target',data=train_df,aspect=2,height=6)","e4ec0450":"train_df['Embarked'].unique()","26dd9e92":"train_df['Embarked'].value_counts()","3dfa4b77":"train_df['Embarked'].isnull().value_counts()","0a44d435":"train_df['Embarked'].replace(np.nan,'S',inplace=True)","c2505da2":"train_df['Embarked'].isnull().any()","52b0cd13":"sns.catplot('Embarked',data=train_df,kind='count',aspect=2,height=6)","f039d2cb":"ax=sns.catplot('Embarked',data=train_df,kind='count',hue='Survived',aspect=2,height=6)\nax.set_xticklabels(['Southampton','Charlton','Queenstown'])","8d829ff2":"deck=train_df['Cabin']","6502af6b":"deck.isna().value_counts()","2fd98724":"deck=deck.dropna()","0ff8080c":"levels=[]\nfor level in deck:\n    levels.append(level[0])\n    ","a99a304a":"cabin_df=pd.DataFrame(levels,columns=['Cabin level'])","2a6e4034":"cabin_df.head()","3fb332a6":"cabin_df['Cabin level'].value_counts().sort_values(ascending=False)","fb4e00b5":"sns.catplot('Cabin level',data=cabin_df,kind='count',aspect=2,height=6,palette='summer_d')","3f3df067":"train_temp=train_df.copy()","cc86e383":"train_temp.isna().any()","68454765":"train_temp=train_temp.dropna(axis=0)","b30cfac0":"train_temp.reset_index(inplace=True,drop=True)","331f50de":"train_temp['Level']=cabin_df['Cabin level']","343612b9":"sns.catplot('Level',kind='count',hue='Person',aspect=2,height=6,data=train_temp)","51a05d24":"sns.catplot('Level',kind='count',hue='Survived',aspect=2,height=6,data=train_temp)","d26a1fdc":"sns.factorplot('Survived',\n               data=train_temp,\n               kind='count',col='Level',\n               col_wrap=4,height=4,aspect=1)","6e0aad10":"train_df['Pclass'].value_counts()","e7bb25e0":"sns.catplot('Pclass',data=train_df, kind='count')","89d7c839":"sns.catplot('Pclass',data=train_df,kind='count',hue='Survived',aspect=2,height=6,palette='winter')","9919c6ce":"sns.lmplot('Age','Target',data=train_df,aspect=2,height=6,hue='Pclass')","5301d65e":"sns.catplot('Pclass','Target',data=train_df,hue='Person',kind='point',aspect=2,height=6)","30173dd4":"train_df['SibSp'].value_counts()","3980effc":"sns.catplot('SibSp',data=train_df,kind='count')","bfdf0b8e":"sns.catplot('SibSp',data=train_df,kind='count',hue='Target',aspect=2,height=6)","3b77bce7":"sns.lmplot('SibSp','Target',data=train_df)","a7a4b90f":"train_df['Sex'].value_counts()","df0a44bc":"sns.catplot('Sex',data=train_df,kind='count',hue='Survived')","64ccc0aa":"sns.lmplot('Age','Target',data=train_df,hue='Sex',aspect=2,height=6)","aa98d951":"train_df['Parch'].unique()","59fcfc28":"train_df['Parch'].value_counts()","480f3c4e":"sns.catplot('Parch',data=train_df,kind='count')","713c2770":"sns.catplot('Parch',data=train_df,kind='count',hue='Survived')","e5f0b280":"train_df['Total relatives']=train_df['Parch']+train_df['SibSp']","8a355e28":"train_df.head()","1eea738a":"ax=sns.catplot('Total relatives','Target',kind='point',data=train_df,aspect=2,height=6)\nax.set_ylabels('Survival probability')","bb2f4181":"correlations=train_df.corr()","b819735c":"plt.figure(figsize=(10,8))\nsns.heatmap(correlations,annot=True,cmap='summer')","81af25c8":"train_mod=train_df.copy()","67b757af":"train_mod.columns.isna()","a59f7ea2":"train_mod.head()","6f26ec5f":"train_mod.drop(['PassengerId','Survived','Sex','Name','Ticket','Cabin','Parch','SibSp'],axis=1,inplace=True)","6440e2f4":"train_mod.head()","05d716c9":"train_mod['Person']=train_mod['Person'].map({'male':1,'female':2,'child':3})\ntrain_mod.head()","aa9f9a52":"temp=pd.get_dummies(train_mod['Embarked'])","2905ce87":"train_mod=train_mod.merge(temp,on=train_mod.index)\ntrain_mod.head()","368868fd":"train_mod.drop(['key_0','Embarked'],axis=1,inplace=True)","b43a2489":"train_mod.head()","3201c6e4":"train_mod.loc[train_mod['Age']<=16,'Age band']=0\ntrain_mod.loc[(train_mod['Age']>16) & (train_mod['Age']<33),'Age band']=1\ntrain_mod.loc[(train_mod['Age']>32) & (train_mod['Age']<49),'Age band']=2\ntrain_mod.loc[(train_mod['Age']>48) & (train_mod['Age']<65),'Age band']=3\ntrain_mod.loc[train_mod['Age']>64,'Age band']=4\ntrain_mod.head()","b816cb49":"train_mod.drop('Age',axis=1,inplace=True)","332adad0":"plt.figure(figsize=(10,8))\nplt.boxplot(train_df['Fare'])\nplt.ylabel('Fare value')\n","280ced8c":"plt.figure(figsize=(10,7))\nsns.kdeplot(train_mod['Fare'],shade=True)","c340ea6d":"train_mod.loc[(train_mod['Fare']<51),'Fare band']=1\ntrain_mod.loc[(train_mod['Fare']>50)&(train_mod['Fare']<101),'Fare band']=2\ntrain_mod.loc[(train_mod['Fare']>100)&(train_mod['Fare']<201),'Fare band']=3\ntrain_mod.loc[(train_mod['Fare']>200),'Fare band']=4\ntrain_mod.head()","bc588a3a":"train_mod.drop('Fare',axis=1,inplace=True)","1fca5ac3":"train_mod.head()","dcf03ff2":"target_df=pd.DataFrame(columns=['Target'])\ntarget_df['Target']=train_mod['Target']\ntarget_df.head()","acdef1db":"target_df['Target'].value_counts()","9f251e9f":"train_mod.drop('Target',axis=1,inplace=True)","af396eb4":"train_mod.head()","52e00879":"from sklearn.model_selection import train_test_split\n\nX_train,X_test,y_train,y_test=train_test_split(train_mod,target_df,test_size=0.2,shuffle=True,random_state=365)\n","70735386":"from sklearn.neighbors import KNeighborsClassifier\n\nknn=KNeighborsClassifier(n_neighbors=6)\nknn.fit(X_train,y_train)","4ad4f4bf":"y_knn_pred=knn.predict(X_test)","ef3d6e28":"print('Score with KNN on test dataset:{}'.format(np.round(knn.score(X_test,y_test) *100,2)))\nprint('Score with KNN on train dataset:{}'.format(np.round(knn.score(X_train,y_train) *100,2)))","6655005e":"from sklearn.metrics import confusion_matrix\ncnf_knn=confusion_matrix(y_knn_pred,y_test)","925b4a17":"sns.heatmap(cnf_knn,annot=True,cmap='winter')","104fa0af":"from sklearn.linear_model import LogisticRegression","39fcc112":"reg_log=LogisticRegression()","31cf148f":"reg_log.fit(X_train,y_train)","d6953648":"y_log_pred=reg_log.predict(X_test)","60c948bf":"print('Score with Logistic regression on test dataset:{}'.format(np.round(reg_log.score(X_test,y_test) *100,2)))\nprint('Score with Logistic regression on train dataset:{}'.format(np.round(reg_log.score(X_train,y_train) *100,2)))","1e20e92f":"cnf_reg=confusion_matrix(y_test,y_log_pred)\nsns.heatmap(cnf_reg,annot=True,cmap='gnuplot')","f1d18e17":"y_lr=reg_log.fit(X_train,y_train).decision_function(X_test)","ba6e1a87":"from sklearn.metrics import roc_curve,auc,precision_recall_curve\n\nfpr,tpr,_=roc_curve(y_test,y_lr)\nplt.plot(fpr,tpr,color='indianred')\nplt.plot([0,1],[0,1],linestyle='--')\nauc_reg=auc(fpr,tpr).round(2)\nplt.title('ROC curve with AUC={}'.format(auc_reg))\nplt.xlabel('False positive rate')\nplt.ylabel('True positive rate')","b2abb323":"precision,recall,threshold=precision_recall_curve(y_test,y_lr)\nclosest_zero=np.argmin(np.abs(threshold))\nclosest_zero_p=precision[closest_zero]\nclosest_zero_r = recall[closest_zero]\nplt.plot(precision,recall)\nplt.plot(closest_zero_p, closest_zero_r, 'o', markersize = 12, fillstyle = 'none', c='r', mew=3)\nplt.title('Precision-Recall curve with Logistic Regression')\nplt.xlabel('Precision')\nplt.ylabel('Recall')","0ec2f195":"from sklearn.svm import SVC","773af1e2":"svc=SVC(gamma=1e-07,C=1e9)\nsvc.fit(X_train,y_train)","c46b24d1":"y_svc_pred=svc.predict(X_test)","c42f9dbe":"print('Score with SVC on test dataset:{}'.format(np.round(svc.score(X_test,y_test) *100,2)))\nprint('Score with SVC on train dataset:{}'.format(np.round(svc.score(X_train,y_train) *100,2)))","47abbe2f":"cnf_reg=confusion_matrix(y_test,y_svc_pred)\nsns.heatmap(cnf_reg,annot=True,cmap='summer',fmt='g')","f2eda6b9":"y_svc=svc.fit(X_train,y_train).decision_function(X_test)\nfpr,tpr,_=roc_curve(y_test,y_svc)\nplt.plot(fpr,tpr,color='indianred')\nplt.plot([0,1],[0,1],linestyle='--')\nauc_reg=auc(fpr,tpr).round(2)\nplt.title('ROC curve with AUC={}'.format(auc_reg))\nplt.xlabel('False positive rate')\nplt.ylabel('True positive rate')\n","6712a5fe":"precision,recall,threshold=precision_recall_curve(y_test,y_svc)\nclosest_zero=np.argmin(np.abs(threshold))\nclosest_zero_p=precision[closest_zero]\nclosest_zero_r = recall[closest_zero]\nplt.plot(precision,recall)\nplt.plot(closest_zero_p, closest_zero_r, 'o', markersize = 12, fillstyle = 'none', c='r', mew=3)\nplt.title('Precision-Recall curve with SVC')\nplt.xlabel('Precision')\nplt.ylabel('Recall')","71bff942":"from sklearn.ensemble import RandomForestClassifier\nfrom sklearn.model_selection import GridSearchCV","2deb0464":"rfc=RandomForestClassifier()\nparam_grid={'n_estimators':[5,7,9,10], 'max_depth':[5,7,9,10]}\ngrid_search=GridSearchCV(rfc,param_grid,scoring='roc_auc')","cb9c0eb8":"grid_result=grid_search.fit(X_train,y_train)","30002ddb":"grid_result.best_params_","7b999af5":"grid_result.best_score_","c10f5059":"y_rfc_pred=grid_result.predict(X_test)","3c94c83a":"print('Score with RFC on test dataset:{}'.format(np.round(grid_result.score(X_test,y_test) *100,2)))\nprint('Score with RFC on train dataset:{}'.format(np.round(grid_result.score(X_train,y_train) *100,2)))","1e143d50":"cnf_rfc=confusion_matrix(y_test,y_rfc_pred)\nsns.heatmap(cnf_rfc,annot=True,fmt='g')","d772c76e":"from sklearn.tree import DecisionTreeClassifier","17d7ac52":"dtc=DecisionTreeClassifier()\ndtc.fit(X_train,y_train)","c5aac219":"y_dtc_pred=dtc.predict(X_test)","eac6af4d":"print('Score with DTC on test dataset:{}'.format(np.round(dtc.score(X_test,y_test) *100,2)))\nprint('Score with DTC on train dataset:{}'.format(np.round(dtc.score(X_train,y_train) *100,2)))","b794dfa5":"cnf_dtc=confusion_matrix(y_dtc_pred,y_test)\nsns.heatmap(cnf_dtc,annot=True,cmap='gist_ncar')","2ad7f8ff":"from sklearn.linear_model import SGDClassifier","b3775916":"sgd=SGDClassifier(max_iter=10)\nsgd.fit(X_train,y_train)","e5d6fffd":"y_sgd_pred=sgd.predict(X_test)","59697c9b":"print('Score with SGD on test dataset:{}'.format(np.round(sgd.score(X_test,y_test) *100,2)))\nprint('Score with SGD on train dataset:{}'.format(np.round(sgd.score(X_train,y_train) *100,2)))","0b56bfa0":"cnf_sgd=confusion_matrix(y_sgd_pred,y_test)\nsns.heatmap(cnf_sgd,annot=True)","11c9cb99":"y_sgd=sgd.fit(X_train,y_train).decision_function(X_test)\nfpr,tpr,_=roc_curve(y_test,y_sgd)\nplt.plot(fpr,tpr,color='indianred')\nplt.plot([0,1],[0,1],linestyle='--')\nauc_reg=auc(fpr,tpr).round(2)\nplt.title('ROC curve with AUC={}'.format(auc_reg))\nplt.xlabel('False positive rate')\nplt.ylabel('True positive rate')\n\n","efbdbe1a":"precision,recall,threshold=precision_recall_curve(y_test,y_sgd)\nclosest_zero=np.argmin(np.abs(threshold))\nclosest_zero_p=precision[closest_zero]\nclosest_zero_r = recall[closest_zero]\nplt.plot(precision,recall)\nplt.plot(closest_zero_p, closest_zero_r, 'o', markersize = 12, fillstyle = 'none', c='r', mew=3)\nplt.title('Precision-Recall curve with SGD')\nplt.xlabel('Precision')\nplt.ylabel('Recall')","f5f1b204":"from sklearn.naive_bayes import GaussianNB","bca1ce42":"nb=GaussianNB()\nnb.fit(X_train,y_train)","864db76a":"y_nb_pred=nb.predict(X_test)","e8c45c80":"print('Score with Naive Bayes on test dataset:{}'.format(np.round(nb.score(X_test,y_test) *100,2)))\nprint('Score with Naive Bayes on train dataset:{}'.format(np.round(nb.score(X_train,y_train) *100,2)))","b34df46e":"cnf_nb=confusion_matrix(y_test,y_nb_pred)\nsns.heatmap(cnf_nb,annot=True,cmap='viridis')","e2e52237":"from xgboost import XGBClassifier","11697567":"xgb=XGBClassifier()\nxgb.fit(X_train,y_train)\nxgb.score(X_train,y_train)","c626c96c":"y_pred_xgb=xgb.predict(X_test)\nxgb.score(X_test,y_test)","86b1fe6d":"conf_mat_xgb=confusion_matrix(y_test,y_pred_xgb)\nsns.heatmap(conf_mat_xgb,annot=True,fmt='g')","ba8c85e7":"from lightgbm import LGBMClassifier","b13b6f47":"lgb=LGBMClassifier(num_leaves=5,\n                              learning_rate=0.05, n_estimators=720,\n                              max_bin = 55, bagging_fraction = 0.8,\n                              bagging_freq = 5, feature_fraction = 0.2319,\n                              feature_fraction_seed=9, bagging_seed=9,\n                              min_data_in_leaf =6, min_sum_hessian_in_leaf = 11)\nlgb.fit(X_train,y_train)\nlgb.score(X_train,y_train)","a9a6d3ae":"y_pred_lgb=lgb.predict(X_test)\nlgb.score(X_test,y_test)","96d1026d":"conf_mat_lgb=confusion_matrix(y_pred_lgb,y_test)\nsns.heatmap(conf_mat_lgb,annot=True,fmt='g',cmap='gnuplot')","1872067b":"score_df=pd.DataFrame(columns=['Model name','Train score'])","3b409f88":"models=['KNN','SVC','Naive Bayes','Decision Tree','Logistic Regression','Random Forest','SGD']\nscore_df['Model name']=models","82100191":"scores=[np.round(knn.score(X_train,y_train) *100,2),\n        np.round(svc.score(X_train,y_train) *100,2),\n        np.round(nb.score(X_train,y_train) *100,2),\n        np.round(dtc.score(X_train,y_train) *100,2),\n        np.round(reg_log.score(X_train,y_train) *100,2),\n        np.round(grid_result.score(X_train,y_train) *100,2),\n        np.round(sgd.score(X_train,y_train) *100,2)]\nscore_df['Train score']=scores","72d88a2b":"score_df","865d27a9":"from sklearn.model_selection import cross_val_score","db02003c":"rfc_opt=RandomForestClassifier(max_depth=5,n_estimators=10)","6f390af3":"score_cv=cross_val_score(rfc_opt,X_train,y_train,cv=5,scoring='accuracy')","97968677":"cv_df=pd.DataFrame(columns=['Cross validated score'])\ncv_scores=np.round(score_cv*100,2)","c98566cb":"cv_df['Cross validated score']=cv_scores\ncv_df.index=cv_df.index + 1","3190ccb2":"cv_df","db865d8c":"print('Cross validated mean score: {}'.format(cv_scores.mean()))\nprint('Cross validated score standard deviation: {}'.format(np.round(cv_scores.std(),2)))","0eccfdcc":"test_df=pd.read_csv('..\/input\/titanic\/test.csv')","83a5c119":"test_df.head()","b4a2e948":"test_df.drop(['Name','Cabin','Ticket'],axis=1,inplace=True)","db2b28c1":"train_df.head()","1b125ad5":"test_df.head()","58ae15e6":"test_df['Total relatives']=test_df['SibSp']+test_df['Parch']\ntest_df.drop(['SibSp','Parch'],axis=1,inplace=True)","667e72ae":"test_df.head()","cdf33523":"embarks=pd.get_dummies(test_df['Embarked'])","d48c5695":"test_df=test_df.merge(embarks,on=test_df.index)","d5a7445f":"test_df.drop(['key_0','Embarked'],axis=1,inplace=True)\ntest_df.head()","28675cb5":"test_df['Person']=test_df[['Age','Sex']].apply(child,axis=1)\ntest_df.head()","f3601322":"test_df['Person']=test_df['Person'].map({'male':1,'female':2,'child':3})\ntest_df.head()","ed97059c":"test_df['Age'].median()","3048ee7c":"test_df['Age']=test_df['Age'].fillna(test_df['Age'].median())","6de3a7dd":"test_df.loc[test_df['Age']<=16,'Age band']=0\ntest_df.loc[(test_df['Age']>16) & (test_df['Age']<33),'Age band']=1\ntest_df.loc[(test_df['Age']>32) & (test_df['Age']<49),'Age band']=2\ntest_df.loc[(test_df['Age']>48) & (test_df['Age']<65),'Age band']=3\ntest_df.loc[test_df['Age']>64,'Age band']=4\ntest_df.head()","2b300a8b":"test_df['Fare']=test_df['Fare'].fillna(test_df['Fare'].median())","3c3f87bf":"test_df.isna().any()","bd1c33b4":"test_df.loc[(test_df['Fare']<51),'Fare band']=1\ntest_df.loc[(test_df['Fare']>50)&(test_df['Fare']<101),'Fare band']=2\ntest_df.loc[(test_df['Fare']>100)&(test_df['Fare']<201),'Fare band']=3\ntest_df.loc[(test_df['Fare']>200),'Fare band']=4\ntest_df.head()","85c9190e":"test_df.drop(['Sex','Age','Fare'],axis=1,inplace=True)\ntest_df.head()","199c9433":"train_mod.head()","084e40a5":"test_df[train_mod.columns].head()","fafb8a7a":"rfc_opt.fit(X_train,y_train)","09ad9c8a":"y_final_predictions=rfc_opt.predict(test_df[train_mod.columns])","7a734bcb":"final_predictions_df=pd.DataFrame(columns=['PassengerId','Survived'])\nfinal_predictions_df['PassengerId']=test_df['PassengerId']","5f2b2ae5":"final_predictions_df['Survived']=y_final_predictions","cb3ebbde":"final_predictions_df.isna().any()","503ab782":"final_predictions_df","9902c0fa":"y_xgb_preds=xgb.predict(test_df[train_mod.columns])","889734cf":"xgb_predictions_df=pd.DataFrame(columns=['PassengerId','Survived'])\nxgb_predictions_df['PassengerId']=test_df['PassengerId']\nxgb_predictions_df['Survived']=y_xgb_preds","bf9c8f9e":"xgb_predictions_df.head()","8236d946":"y_lgb_preds=lgb.predict(test_df[train_mod.columns])","ac02835d":"lgb_predictions_df=pd.DataFrame(columns=['PassengerId','Survived'])\nlgb_predictions_df['PassengerId']=test_df['PassengerId']\nlgb_predictions_df['Survived']=y_lgb_preds","70be4289":"lgb_predictions_df.head()","ec566762":"lgb_predictions_df.to_csv('LGBM_predictions.csv',index=False)","7be8270c":"# Data Visualisation","90d1e58b":"Let us visualise the data of each field so that we can understand how to deal with the NaN values.","83ab318e":"The above scores are far more realistic than the high result of approximately 90% shown.\n\nLet us analyse the mean and standard deviation of all the cross validated scores.","bd80e0f7":"## Decision Tree","e173be00":"# Checking for NaN values in our dataframe","73235c90":"## 6. Sex","bf33ab42":"The above data shows that 3rd class passengers were maximum followed by 1st and 2nd class passengers. Let us check if Pclass has any correlation with survival.","ee3b6a60":"For adult males and females, the age distribution is extremely similar. Let us now compare it with the children.","444834ed":"As we can see from the abpve graph, if there are 0-3 relatives, chances of survival is high. However, anything more than that leads to a drop in survival rate. Hence, we can consider the number of relatives to be an important factor.","ac3f06db":"## XGBoost","481c97e9":"The division of fares maybe done as follows:\n\n* 0-50: 1 (General class)\n* 50-100: 2 (Economy class)\n* 100-200: 3 (Semi-premium)\n* 200+ : 4 (Premium)\n","09ad03d0":"# K-Fold cross validation","0fca93c0":"The above plot proves our hypothesis that survival chances reduce as number of family members increase.","1fc096b6":"## 1. Age","32c7d7f6":"Let us encode the person column as :\n\n1: Male\n\n2: Female\n\n3: Child","a7b03284":"## 9. Data Wrangling","38059891":"### KNN","38539942":"## 5. Siblings and spouses","a0347821":"Let us check if having any siblings and spouses aboard had any relation to survival.","a08eaca7":"As we can see, with increase in age, probability of survival decreases. This could be due to the fact that older people found it more difficult to act quickly during the evacuation time as compared to the young and middle aged passengers.\n","2b7fd87d":"As we can see, Random forest classifier with max_depth=5 and n_estimators=10 gives the best train scores followed by Decision tree. Hence, tree based models have perfored better.","1a7096ee":"The above data is now preprocessed and can be used for Machine Learning.","15c4af2a":"The above distribution looks bimodal in nature containing two peaks. Most passengers were between 20-40","7c057564":"## Stochastic Gradient Descent","c7e71f06":"From the available data, we have maximum passengers from level C followed by B.","cfd3ef4b":"# B) Testing phase","35b09f0e":"To streamline the effect of age, we group the ages as follows:\n* Ages<=16 : 0\n* Ages <=32 & >16 : 1\n* Ages <=48 & >32 : 2\n* Ages <=64 & >48 : 3\n* Ages >64 : 4\n\n\n\n","987fe6af":"The above column shows number of siblings or spouses.","333550fc":"As we can see from the above curve, the optimum precision of this model is quite low (0.45) while it's recall is high. The other models fared better comparatively.","73270632":"## LightGBM","9b105eb2":"From the above boxplot, it is seen that the median fare is around 14 pounds while the high prices could go as high as 500 plus pounds. Hence, we need to divide these fares into fare bands. This will help take care of the non linear distribution of the fare and the presence of so many outliers.","0b9c839e":"The above figure shows there is good amount of area under the curve.","d967c3db":"Hence, the standard deviation is at an appreciated low value. This means our cross validation scores are nearly similar for each fold. ","c04ab3ef":"As we can see, there are two passengers whose embarking station isn't mantioned. As max passengers embarked at Southampton, we can make a brute assumption that these 2 passengers may have embarked at Southhampton. Let us replace NaN with S.","5ba6983a":"###  SVC","d2927c4f":"As it can be seen, maximum number of passengers were actually alone. About 209 passengers had either a spouse or a sibling along with them.\n\nLet us now check if this feature realates to survival.\n","2ffe38cc":"Let us check the age distribution of all adults and children.","98c25aa5":"From the above data, it can be seen that maximum passengers embarked in Southampton followed by Charlton and Queenstown. Let us now check the number of survivors from each of the embarking stations.","6e1dda0d":"Hence, we have 177 entries with NaN values.","4b4a261f":"It could be said that 1st class passengers could have got a preferential treatment during evacuation process as a result of which, more 1st class passengers survived than ones that didn't. In 2nd class passengers, the survivors and deaths were nearly the same. \n\nAs expected, the 3rd class passengers must have been evacuated in the end and hence, couldn't be saved. It could also be due to the fact that the population of 3rd class passengers were highest. Hence, evacuating the passengers couldn't be completed due to the paucity of time.","19612e3f":"Let us check if having any parents or children played any important role in survival of the passengers.","95687466":"Hence, all missing values of Age has been taken care of. Let us now plot a histogram to check which age groups are maximum in the Titanic passengers.","9f006f2b":"## 8. Checking correlation of the various features","eac1b8c3":"As we can see, ages between 20-30 is the highest followed by 30-40.","7c640ec5":"* S stands for Southampton.\n* C stands for Charlton.\n* Q stands for Queenstown.\n","5851de53":"We have 687 cases with no cabin info","6322be5e":"## Naive Bayes ","4126249b":"The above plot clearly indicates that with age, female passengers actually had a higher probability of survival.\n\nThis indicates that aged women were evacuated first and then the middle age and young ones.\n\nFor males, it was the opposite. Younger males had higher chance of survival.","3f713f20":"## Applying machine learning to the test dataframe","5a4935a6":"Let us check if gender has any role to play in survival.","b2165613":"The only categorical data we have in the above data is the Embarked column. Let us one-hot encode the Embarked column.","7879e912":"### Logistic Regression","72ec61c6":"Instead of using a mean age of 29.7 (or 30) , we should select median age to replace the NaN values.","2dffe00d":"Let us check how the survival of children, male and female adults vary.","750f3c5f":"Let us visualise the data for passenger class.","267b83c0":"## 7. Parents\/ Children","ea1b5ae5":"Hence, an optimum precision vs recall will be about 0.83 and 0.65 respectively","93442310":"Let us now perform a K-cross fold validation to prevent any overfitting issues.","45ebc27b":"Let us check the correlation of the various features with each other using a heatmap.","0030d79c":"This particular feature is extremely problematic due to very high number of missing data. It'll be very difficult to fill null values with any cabin data. It is impossible to try to model this particular data. Hence, it will be wise to simply delete this feature. Inputting a feature with high missing values may induce high bias in our model. Never the less, let us check the correlation with surivival for the data we have.","e060cb29":"As is expected, many of the single passengers survived. This could be due to the fact that weren't reqiured to wait for any of the family members to deboard the ship and could be far easily be vacated. Fair number of people with one family member survived since it is realtively easier to find one family member instead of multiple family members.\n\nHence, it can be said that as family members increases, survival reduced.\nLet us check this hypothesis through a lmplot.","bf61f0fc":"Let us perform a 5 fold cross validation.","6ca3b6b3":"Let us check if gender or being a child plays a role in survival from the ship.","4a709cf5":"Let us take a look at the fare paid by the customers.","8d1b5859":"## We shall perform the same data wrangling and preprocessing which we have performed on the training dataset for the model to predict accurately.","8f200fbf":"As it can be observed, the probability of survival from the same age group on class 1 was higher than class 3. Hence, it can be said that Passenger Class definitely has a good correlation to survival and will be an important feature of our dataset.","65cff6fc":"## 4. Passenger class","988b77e7":"## 2. Embarked","09a7ca77":"## We can finalise that we shall be using random forest classifier on our final test dataset.","d88b1593":"Shows number of parents or children aboard","d9305c90":"As we can see, there are ages that are missing. Let us see how many.","ae3a09a4":"Let us visualise the data of the embarking stations.","4905e863":"# Comparison of training scores of the models","eba8de86":"We have visualised all the features in the previous sections. Now, we shall make changes to the dataframe to keep only the relevant features. We may modify or drop features such that it shall give us a good model prediction.","c1bd058d":"## Random Forest","1a00992c":"As we can see, maximum passengers did not have any children aboard. Let us see if this has any relation with survival.","04878e4f":"Both the area under curve score and precision-recall curve are very close to logistic regression curves. Hence, their performances are very identical.","67ae30a1":"# Machine Learning","9385140f":"Let us check how total relative numbers change the probability of survival.","8b18b19d":"Let us make another age group for children. Ages lower than 16 will be considered as a child. This way, we can segregate the children from the list of passengers.","d1fbfb8e":"# A) Data wrangling and training phase\n   # Importing libraries and reading the file","e0e51a31":"## 3. Cabin","bcd332bf":"From above data, we can say that maximum number of female adults survived the accident. Most male passengers died. For children, just above 50 percent survived while the rest could not.\n\nThe reason could be that most female passengers alongiwith their children were evacuated first from the ship. Males were probably evacuated in the end and hence, could not make it.\n\nLet us now see how age played at important role in survival.","6fa2ba3e":"To get a better understanding of the survival trend, let us make a lm plot to see the relation between age and survival with a hue of passenger class.","fdcc659a":"Here, we can see that for children, max survivors were from 2nd class. For males, 3rd class survivors were higher than 2nd class. This is interesting to note as it was unexpected.","c0ab77c9":"As expected, many passengers who did not have to worry about any children survived. There are about 50% survivors amongst parents with 1 and 2 children aboard.","00bd3f5f":"We can drop columns such as *PassengerID,Survived, Name,Sex,SibSp,Parch,Cabin and Ticket*","1a9a7ed1":"Most of the female passengers survived the accident as compared to males. This indicates that female passengers were evacuated first and hence, they survived. Let us check this with another plot.","7ec2da7b":"As we can see, the test data is now preprocessed and can be used for machine learning.","25452bc4":"During the data wrangling process, we can combine the Parch and SibSp columns as with relatives and without relatives to simplify the dataframe and prevent much data leakage. This process is shown below.","060952e6":"Hence, from the above, we can understand that the level location did have a significant impact on whether the person survived. Higher levels such as level A,B, C and D had good number of survivors. The lower decks had much fewer survivors. However, we can't add it to the model since maximum entries have missing entries. "}}