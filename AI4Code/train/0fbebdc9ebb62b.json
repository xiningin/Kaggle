{"cell_type":{"0fcebe06":"code","9d8ba37a":"code","b47bed07":"code","32b4c793":"code","9c14bb50":"code","ccdfbd8b":"code","e709f042":"code","bee2c9c7":"code","152d885a":"code","72aec393":"code","02b7aa4a":"code","2bef0a08":"code","367665db":"code","1eada61d":"code","9211b74a":"code","443751b6":"code","4197efb1":"code","92256f45":"code","de5d5daa":"code","1e7f210c":"code","5bdfeb93":"code","c3f9cd91":"markdown","167a28de":"markdown","77bf9c74":"markdown","97fc266d":"markdown","d5155e28":"markdown","fdaea226":"markdown","c8c92061":"markdown","818f2599":"markdown","0b96b096":"markdown","f450ebb2":"markdown","85809d73":"markdown","7d657eb5":"markdown","ce341362":"markdown","c0683d97":"markdown","563b15e8":"markdown","a511911e":"markdown","ce262932":"markdown","f6b6cea2":"markdown","d342af39":"markdown"},"source":{"0fcebe06":"import numpy as np \nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nsns.set()\n\nfrom sklearn.cluster import KMeans\nfrom sklearn.decomposition import PCA\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))","9d8ba37a":"#loading dataset and print information\ndf = pd.read_csv('..\/input\/Mall_Customers.csv')\ndf.info()\ndf.head()","b47bed07":"df.describe()","32b4c793":"del df['CustomerID']\ndf.columns=['Gender', 'Age', 'AnnualIncome', 'SpendingScore']\ndf.head()","9c14bb50":"df['Gender'] = (df['Gender'] =='Male').astype(int)\ndf.head()","ccdfbd8b":"#map dataset from 4 to 2 dimensions\npca=PCA(n_components=2)\ndata=np.asarray(df)\npca.fit(data)\nX=pca.transform(data)\n\nplt.scatter(X[:,0], X[:,1])","e709f042":"kmeans = KMeans(n_clusters=5, random_state=0).fit(X)\n\nfig, ax = plt.subplots(1, 1)\nscatter=ax.scatter(X[:,0], X[:,1], c=kmeans.labels_, cmap=sns.diverging_palette(220, 10, as_cmap=True, center=\"dark\"))","bee2c9c7":"df['Group']=pd.Series(kmeans.labels_, df.index)\ndf.head()","152d885a":"df.groupby('Group').count().iloc[:,0].plot(kind='bar')","72aec393":"df.groupby('Group').mean()","02b7aa4a":"ageGroup=[]\n\nfor age in df['Age']:\n    if age<=25:\n        index=0\n    elif age<=40:\n        index=1\n    else:\n        index=2\n    ageGroup.append(index)\n\ndf['AgeGroup']=pd.Series(ageGroup, df.index)","2bef0a08":"df.groupby('AgeGroup').mean()","367665db":"data=np.asarray(df[['AnnualIncome', 'SpendingScore']])\ncolors=['red','green', 'blue']\nuniquePoints={}\nfig, ax = plt.subplots(1, 1)\nfor idx, example in enumerate(data):\n    label=ageGroup[idx]\n    point=ax.scatter(example[0], example[1], c=colors[label], label=label)\n    uniquePoints[label]=point\n    \n\nax.legend([uniquePoints[key] for key in uniquePoints],['<26', '26-40', '41>'])\nax.set_ylabel(\"Spending score\")\nax.set_xlabel(\"Annual Income\")","1eada61d":"fig, ax = plt.subplots(1, 2)\nax[0].bar([i for i in range(3)], df.groupby('AgeGroup').mean()['SpendingScore'].tolist(), tick_label=['Students', 'Adults', 'Elders'])\nax[0].set_title('Spending score')\nax[1].bar([i for i in range(3)], df.groupby('AgeGroup').mean()['AnnualIncome'].tolist(), tick_label=['Students', 'Adults', 'Elders'])\nax[1].set_title('Annual income')","9211b74a":"spendingScore=df.groupby('Gender').mean()['SpendingScore'].tolist()\nannualIncome=df.groupby('Gender').mean()['AnnualIncome'].tolist()\n\nfig, ax = plt.subplots(1, 2)\nax[0].bar([i for i in range(2)], spendingScore, tick_label=['Women', 'Men'])\ntot=np.sum(spendingScore)\nfor i in range(2):\n    ax[0].text(i-0.2, spendingScore[i]+1, '{:.2f}'.format(spendingScore[i]\/tot*100))\nax[0].set_title('Spending score')\n\nax[1].bar([i for i in range(2)], annualIncome, tick_label=['Women', 'Men'])\ntot=np.sum(annualIncome)\nfor i in range(2):\n    ax[1].text(i-0.2, annualIncome[i]+1, '{:.2f}'.format(annualIncome[i]\/tot*100))\nax[1].set_title('Annual Income')","443751b6":"sns.pairplot(df[['Gender', 'Age', 'AnnualIncome', 'SpendingScore']])","4197efb1":"#Variance of each feature\nvar = df[['Gender', 'Age', 'AnnualIncome', 'SpendingScore']].var()\nprint(var)","92256f45":"corr = df[['Gender', 'Age', 'AnnualIncome', 'SpendingScore']].corr()\n\nsns.heatmap(corr, xticklabels=corr.columns, yticklabels=corr.columns, annot=True, cmap=sns.diverging_palette(220, 10, as_cmap=True))","de5d5daa":"from sklearn.linear_model import LinearRegression\nfrom sklearn import svm\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.model_selection import cross_val_score\nfrom sklearn.model_selection import validation_curve\nfrom sklearn.dummy import DummyRegressor\n\nX=np.asarray(df[['Gender', 'Age', 'AnnualIncome']])\nY=np.asarray(df['SpendingScore'])\n#x_train, x_test, y_train, y_test = train_test_split(X, Y, test_size=0.33, random_state=0)","1e7f210c":"print('Dummy Regressor:')\ndumModelout=cross_val_score(DummyRegressor(strategy='mean'), X, Y, cv=5)\n#r^2 score\nprint('Dummy model score: {:.2f} (+\/- {:.2f})'.format(dumModelout.mean(), dumModelout.std()**2))\nprint('\\n')\nprint('Linear regression:')\noutLR=cross_val_score(LinearRegression(normalize=True), X, Y, cv=5)\nprint('Linear model score: {:.2f} (+\/- {:.2f})'.format(outLR.mean(), outLR.std()**2))\n","5bdfeb93":"print('Support Vector Regression')\n#Parameters to experiment with\ntuned_parameters = [{'kernel': ['rbf'], 'gamma': [1e-3, 1e-4],'C': [1, 10, 100, 1000]},\n                    {'kernel': ['linear'], 'C': [1, 10, 100, 1000]}]\n\nclf = GridSearchCV(svm.SVR(), tuned_parameters, return_train_score=True, cv=5).fit(X,Y)\nprint('Best model\\'s params:', clf.best_params_)\n#print(clf.cv_results_.keys())\nprint('Train score: {:.2f} (+\/- {:.2f})'.format(clf.cv_results_['mean_train_score'].mean(), clf.cv_results_['std_train_score'].mean()))\nprint('Test score: {:.2f}  (+\/- {:.2f})'.format(clf.cv_results_['mean_test_score'].mean(), clf.cv_results_['std_test_score'].mean()))\n\noptimised_clf= clf.best_estimator_","c3f9cd91":"Let's see how the situation changes when the customers are divided by gender","167a28de":"# Preprocessing","77bf9c74":"From here we can see that the dataset is skewed towards young people with a small percentege of elders. Moreover, the dataset fails to represent rich people's behaviour due to the fact that the distribution of incomes is shifted toward average-low annual incomes.\n\nAnnualIncome-SpendingScore plot resemble the distribution obtained from PCA analysis probably meaning that Annual Income and Spending score provide the higher variance in the dataset.","97fc266d":"Now that the dataset has been preprocessed, let's analyze it by applying PCA in order to see how the customers are distibuted in a lower dimensional space which is possible to visualize.","d5155e28":"# Predicting Spending Score","fdaea226":"The heatmap shows no correlation between gender and spending score which confirms the previous findings.\nThere is another evidence for the fact that the spending score is correlated with age. Although the correlation is too low to have some heavy significance, it is interesting to see that the spending score decreases with age. ","c8c92061":"First, a dummy classifier is used to set a baseline from which we can assess the quality of the predictions. This classifier uses the mean of the target feature as prediction. So, the other models must score higher than this model in order to be usefull to predict the spending score.\n\nUnfortunately, both models (linear regression and support vector regression) performed worse than the baseline. In fact, both models results have a r^2 score below 0 which means that their prediction diverge from the correct answer more than using the average.\n\nSolutions that could be used to improve the predictions could be:\n* Use models ensemble \n* Increasing dataset by collecting more data or noise-generating new datapoints","818f2599":"Women account for the 51% of the total spending score compared to men although their annual income accounts only the 49% of the total. The difference is negligeble and it could be caused by the sample size of the dataset. \n\nLet's move on analyzing the relationship between each feature.","0b96b096":"In this notebook I'm going to analyse the Mall Customer Segmentation dataset. Imagine that you own a mall and you want to discover potential customer groups so that the sense can be given to marketing team and plan the strategy accordingly. \n\nThe dataset consists of some basic data about your customers like: Customer ID, age, gender, annual income and spending score. The spending Score is assigned to the customers based on your defined parameters like customer behavior and purchasing data.\n","f450ebb2":"# Analysis","85809d73":"As already found, elders tend to have a lower spending score compared to younger people. We can see that there is a prevalence of adults (26-40 years old) with a high spending score and a high annual income as well.\n\nLet's plot these three age groups by spending score and annual income. Here students have a spending score close to the adults even if their annual income is the lowest among the age groups.","7d657eb5":"In conclusion, the data provided interesting insights about potential customer groups. From a group-age point of view, elders are the ones that have a lower spending score altough their annual income is on the average. Adults have the higher spending score and as well the higher annual income. Students have a high spending score, close to the Adults although their spending score is lower than the Elders.\n\n> From a gender prospective, women spend more than men although their income is lower although there is not enough data to confirm this.\n\nMoving to customer groups, from the analysis we can extrapolate 5 clusters:\n\nGroup 0: Men adults (40y) with an high income (88k) and a low spending score (20) (unhappy)\n\nGroup 1: Women adults with average income (55k) and average spending score (50) (moderate)\n\nGroup 2: Adults with high income and high spending score (80) (buyers)\n\nGroup 3: Women adults with low income (26k) and low spending score (20) (savers)\n\nGroup 4: Students (mostly women) with low income but high spending score (80)\n\n\nAssuming a strategy that mainly targets customers with high incomes (potential buyers), the mall should focus on group 0 and group 2. While group 0 could represent unhappy clients on which a deeper analysis about the reasons is required, group 2 represents regular customers and the main source of income for the mall. \n\nInterestingly, group 0 may be seen as potential group 2 customers. In fact, with more data and an analysis about the reasons of the low spending score may be possible to develop a targeted market campaign to convert customers from group 0 to group 2.  \n\nPeople in group 1 are not the main source of profit for the mall, but there is potential for profit. With an appropriate data a campaign could be used to increase their spending score. \n\nGroup 3 represents savers. People with a low income that spend their money wise. The mall should not be interested in this category. \n\nGroup 4 describes mainly students which have a low income but high spending score. Due to the low income, a targeted campaign may not have the potential to increase the spending score. However, it is important to keep these customers as satisfied as possible.\n\nIn addition, the mall should provide the products focusing on people ranging 18-40 which have a spending score double then elders in order to increase the revenues.\n","ce341362":"Next, let's encode the Gender column from Male,Female to into integers 1,0 because makes life easier working with numbers","c0683d97":"We can notice that the points are distributed around 5 clusters. Using KMeans, let's assign to each example the cluster to which the customer belongs it. Here the result","563b15e8":"This representation allows to see how the datapoints are clustered but it is missing to explain which features are responsible for these clusters. In other words, what are the features that distinguish these clusters?\n\nFirst, let's assign each datapoint to its cluster which is a number between 0 and 4","a511911e":"# Conclusion","ce262932":"Now, suppose that a new customer has been registered and its spending score is not available yet. Can we predict its spending score?\n\nLet's start by importing the models and preparing the data. Because I have a limited number of examples, I opted for a cross-validation metric instead of just splitting the dataset in train and test.","f6b6cea2":"From the description of the dataset we can see that there are no missing values and that all the columns are in numerical value, except for Gender. \n\nThe dataset provides the spending score of customers between 18-70 years old with incomes ranging from 18.000 to 137.000 dollars\/year.\n\nThe spending score is equally distributed and it ranges between 1 and 99\n\nThe CustomerID column is just another index for the customers, it doesn't provide any value so can be removed.\n\nFinally, let's simplify the name of the columns so that it is easier to retrieve them later on.","d342af39":"We can see that there are groups 4 and 2 which represent customers with a spending score around 80 points. Interestingly, from these two groups we can see that a high spending score is not associated to a high annual income. In addition, these two groups are characterized by young people (25 and 32 years old average) and by a prevalence of female customers. \n\nGenerally, groups with people more than 40 years old tend to have a lower spending score.\nGroup 1 which represents 40 years old people with an average annual income of 55k have a spending score in the middle around 50.\n\nGroup 0 which is the only one with a prevalence of men (56%) represents the lower spending score.  \n\nSo, from this first quick analysis seems that young people have an higher spending score. On the other hand, old people (specially men) tend to have a low spending score. Interestingly, the spending score is affected more by the age of the customer instead of its annual income. \n\nBased on these first insights, let's play around with the customer's age. I decided to divide the customers into 3 categories:\n1. 18-25 students\n2. 25-40 adults\n3. 40-70 elders"}}