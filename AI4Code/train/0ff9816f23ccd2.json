{"cell_type":{"60f59939":"code","eca702a8":"code","bb13e318":"code","2e8574c4":"code","ac89034d":"code","56eaa935":"code","5a23e2c8":"code","cfb5f0ee":"code","528c0188":"code","7f29d030":"code","f8beced4":"code","2cbb29d9":"code","78f8ce84":"code","6bfb9b50":"code","9d5a681f":"code","54baf1ec":"code","c6c07674":"code","949586ca":"code","cb0dedac":"code","d130a52d":"code","a6f50566":"code","920f3bb6":"code","db2125d2":"code","c68b4ebd":"code","313088d3":"code","f7983353":"code","9f7d2799":"code","07d343e8":"code","c9330f30":"markdown","8cf6971d":"markdown","61430d9e":"markdown","eca04bbb":"markdown","c26ad902":"markdown","db2dc307":"markdown","49d4a4e0":"markdown","7284437a":"markdown","5223aa93":"markdown","4c12c8b5":"markdown","157801f0":"markdown","ea606e43":"markdown","0ee5e98e":"markdown"},"source":{"60f59939":"from tensorflow.keras.datasets import reuters\nfrom tensorflow.keras.models import Sequential, load_model, Model\nfrom tensorflow.keras.layers import Dense, Dropout, Embedding, Activation, LSTM, GRU, SpatialDropout1D, Flatten\nfrom tensorflow.keras import utils\nfrom tensorflow.keras.preprocessing import sequence\nfrom tensorflow.keras.preprocessing.text import Tokenizer\nfrom tensorflow.keras.preprocessing.sequence import pad_sequences\nfrom tensorflow.keras.callbacks import EarlyStopping, ModelCheckpoint, ReduceLROnPlateau\nimport numpy as np\nimport matplotlib.pyplot as plt\n%matplotlib inline ","eca702a8":"cb_EarlyStopping = EarlyStopping(monitor='val_acc', mode='max', verbose=1, patience=10)\ncb_ModelCheckpoint = ModelCheckpoint(filepath='model.best.hdf5', monitor='val_acc', mode='max', verbose=1, save_best_only=True)\ncb_ReduceLROnPlateau = ReduceLROnPlateau(monitor='val_acc', factor=0.1, patience=3, verbose=1, mode='max', min_lr=0.00000001)","bb13e318":"num_words=10000","2e8574c4":"data = np.load('..\/input\/train.npz', allow_pickle=True) \nx_train_src = data['x'] \ny_train_src = data['y'] ","ac89034d":"x_test_src = np.load('..\/input\/test.npy', allow_pickle=True)","56eaa935":"index = 0\nprint(x_train_src[index])\nprint(y_train_src[index])","5a23e2c8":"word_index = reuters.get_word_index()","cfb5f0ee":"maxlen = 800\nx_train = pad_sequences(x_train_src, maxlen=maxlen)\nx_test = pad_sequences(x_test_src, maxlen=maxlen)","528c0188":"!wget http:\/\/nlp.stanford.edu\/data\/glove.6B.zip\n!unzip glove.6B.zip","7f29d030":"!ls -la","f8beced4":"embeddings_index = dict()\nwith open('glove.6B.300d.txt', 'r') as f:\n    for line in f:\n        values = line.split()\n        word = values[0]\n        word_vector = np.asarray(values[1:], dtype='float32')\n        embeddings_index[word] = word_vector","2cbb29d9":"embedding_dim = 300\nembedding_matrix = np.zeros((num_words, embedding_dim))\nfor word, i in word_index.items():\n    if i < num_words - 3:\n        embedding_vector = embeddings_index.get(word)\n        if embedding_vector is not None:\n            embedding_matrix[i + 3] = embedding_vector\n            ","78f8ce84":"y_train = utils.to_categorical(y_train_src)","6bfb9b50":"num_classes=len(y_train[0])\nprint(f'\u041a\u043e\u043b\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u043b\u0430\u0441\u0441\u043e\u0432: {num_classes}')","9d5a681f":"model = Sequential()\nmodel.add(Embedding(num_words, embedding_dim, input_length=maxlen))\nmodel.add(LSTM(512))\nmodel.add(Flatten())\nmodel.add(Dense(128, activation='relu'))\nmodel.add(Dropout(0.25))\nmodel.add(Dense(256, activation='relu'))\nmodel.add(Dropout(0.25))\nmodel.add(Dense(num_classes, activation='softmax'))","54baf1ec":"model.layers[0].set_weights([embedding_matrix])\nmodel.layers[0].trainable = False","c6c07674":"model.summary()","949586ca":"model.compile(optimizer='adam', \n              loss='categorical_crossentropy', \n              metrics=['accuracy'])","cb0dedac":"history = model.fit(x_train, \n                    y_train, \n                    epochs=50,\n                    batch_size=128,\n                    callbacks = [cb_EarlyStopping, cb_ModelCheckpoint, cb_ReduceLROnPlateau],\n                    validation_split=0.1,\n                    verbose=1)","d130a52d":"plt.plot(history.history['acc'], \n         label='\u0414\u043e\u043b\u044f \u0432\u0435\u0440\u043d\u044b\u0445 \u043e\u0442\u0432\u0435\u0442\u043e\u0432 \u043d\u0430 \u043e\u0431\u0443\u0447\u0430\u044e\u0449\u0435\u043c \u043d\u0430\u0431\u043e\u0440\u0435')\nplt.plot(history.history['val_acc'], \n         label='\u0414\u043e\u043b\u044f \u0432\u0435\u0440\u043d\u044b\u0445 \u043e\u0442\u0432\u0435\u0442\u043e\u0432 \u043d\u0430 \u043f\u0440\u043e\u0432\u0435\u0440\u043e\u0447\u043d\u043e\u043c \u043d\u0430\u0431\u043e\u0440\u0435')\nplt.xlabel('\u042d\u043f\u043e\u0445\u0430 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f')\nplt.ylabel('\u0414\u043e\u043b\u044f \u0432\u0435\u0440\u043d\u044b\u0445 \u043e\u0442\u0432\u0435\u0442\u043e\u0432')\nplt.legend()\nplt.show()","a6f50566":"predictions = model.predict(x_test)","920f3bb6":"predictions[:2]","db2125d2":"predictions = np.argmax(predictions, axis=1)","c68b4ebd":"predictions[:5]","313088d3":"out = np.column_stack((range(1, predictions.shape[0]+1), predictions))","f7983353":"out[:5]","9f7d2799":"np.savetxt('submission.csv', out, header=\"Id,Category\", \n            comments=\"\", fmt=\"%d,%d\")","07d343e8":"!cat submission.csv","c9330f30":"## \u041e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c \u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u043d\u0430 \u0441\u043e\u0440\u0435\u0432\u043d\u043e\u0432\u0430\u043d\u0438\u0435","8cf6971d":"\u0414\u0430\u043d\u043d\u044b\u0435 \u043f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u043b\u0435\u043d\u044b \u0434\u043b\u044f \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0430 \u0441\u043b\u043e\u0432 10000.","61430d9e":"## \u041a\u043b\u0430\u0441\u0441\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f \u0442\u0435\u043c \u043d\u043e\u0432\u043e\u0441\u0442\u0435\u0439 \u0438\u0437 \u043d\u0430\u0431\u043e\u0440\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 Reuters","eca04bbb":"## \u0413\u043e\u0442\u043e\u0432\u0438\u043c \u0444\u0430\u0439\u043b \u0441 \u0440\u0435\u0448\u0435\u043d\u0438\u0435\u043c \u0434\u043b\u044f Kaggle","c26ad902":"## \u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u043d\u0435\u0439\u0440\u043e\u043d\u043d\u043e\u0439 \u0441\u0435\u0442\u0438","db2dc307":"## \u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0434\u0430\u043d\u043d\u044b\u0445","49d4a4e0":"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u0435 \u0432 Keras \u0441\u0440\u0435\u0434\u0441\u0432\u0430 \u0434\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u0441 \u0442\u0435\u043a\u0441\u0442\u043e\u043c","7284437a":"## \u0420\u0430\u0441\u043f\u043e\u0437\u043d\u0430\u0435\u043c \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 \u0442\u0435\u0441\u0442\u043e\u0432\u043e\u0433\u043e \u043d\u0430\u0431\u043e\u0440\u0430","5223aa93":"1. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0448\u0430\u0431\u043b\u043e\u043d \u043d\u043e\u0443\u0442\u0431\u0443\u043a\u0430, \u0447\u0442\u043e\u0431\u044b \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u043d\u0430 Kaggle.\n2. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0435\u0439\u0440\u043e\u043d\u043d\u0443\u044e \u0441\u0435\u0442\u044c, \u0447\u0442\u043e\u0431\u044b \u0443\u043b\u0443\u0447\u0448\u0438\u0442\u044c \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u0440\u0435\u0448\u0435\u043d\u0438\u044f:\n    * \u0418\u0437\u043c\u0435\u043d\u044f\u0439\u0442\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u043e\u043b\u043d\u043e\u0441\u0432\u044f\u0437\u043d\u044b\u0445 \u0441\u043b\u043e\u0435\u0432 \u0438 \u043d\u0435\u0439\u0440\u043e\u043d\u043e\u0432 \u0432 \u043d\u0438\u0445\n    * \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0441\u043b\u043e\u0439 Embedding\n    * \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c Dropout \u0438\u043b\u0438 \u0434\u0440\u0443\u0433\u0438\u0435 \u043c\u0435\u0442\u043e\u0434\u044b \u0440\u0435\u0433\u0443\u043b\u044f\u0440\u0438\u0437\u0430\u0446\u0438\u0438\n    * \u0418\u0437\u043c\u0435\u043d\u044f\u0439\u0442\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u044d\u043f\u043e\u0445 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f\n    * \u0418\u0437\u043c\u0435\u043d\u044f\u0439\u0442\u0435 \u0440\u0430\u0437\u043c\u0435\u0440 \u043c\u0438\u043d\u0438-\u0432\u044b\u0431\u043e\u0440\u043a\u0438 (batch_size)\n3. \u0412\u043e \u0432\u0440\u0435\u043c\u044f \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u0441\u043b\u0435\u0434\u0438\u0442\u0435, \u0447\u0442\u043e\u0431\u044b \u043d\u0435 \u0432\u043e\u0437\u043d\u0438\u043a\u043b\u043e \u043f\u0435\u0440\u0435\u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f.\n4. \u041f\u043e\u0441\u043b\u0435 \u043f\u043e\u0434\u0431\u043e\u0440\u0430 \u043b\u0443\u0447\u0448\u0438\u0445 \u0433\u0438\u043f\u0435\u0440\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432, \u043e\u0431\u0443\u0447\u0438\u0442\u0435 \u0441\u0435\u0442\u044c \u0435\u0449\u0435 \u0440\u0430\u0437 \u043d\u0430 \u043f\u043e\u043b\u043d\u043e\u043c \u043e\u0431\u044a\u0435\u043c\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u0431\u0435\u0437 \u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u043d\u0430 \u043e\u0431\u0443\u0447\u0430\u044e\u0449\u0438\u0439 \u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043e\u0447\u043d\u044b\u0439 \u043d\u0430\u0431\u043e\u0440\u044b.\n5. \u0421\u043e\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u043e\u0442\u0447\u0435\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u043a\u043b\u044e\u0447\u0430\u0435\u0442:\n     * \u041c\u0435\u0441\u0442\u043e \u0432 \u0441\u043e\u0440\u0435\u0432\u043d\u043e\u0432\u0430\u043d\u0438\u0438, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u0432\u0430\u043c \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0434\u043e\u0441\u0442\u0438\u0447\u044c\n     * \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u044b \u043d\u0435\u0439\u0440\u043e\u043d\u043d\u043e\u0439 \u0441\u0435\u0442\u0438 \u0438 \u0433\u0438\u043f\u0435\u0440\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f\n     * \u0421\u0441\u044b\u043b\u043a\u0443 \u043d\u0430 \u043d\u043e\u0443\u0442\u0431\u0443\u043a \u0441 \u043a\u043e\u0434\u043e\u043c \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f\n     * \u0413\u0440\u0430\u0444\u0438\u043a \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u043d\u0430 \u043e\u0431\u0443\u0447\u0430\u044e\u0449\u0435\u043c \u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043e\u0447\u043d\u043e\u043c \u043d\u0430\u0431\u043e\u0440\u0430\u0445 \u0434\u0430\u043d\u043d\u044b\u0445","4c12c8b5":"\u0417\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u043c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u0432 \u0444\u0430\u0439\u043b ","157801f0":"## \u0414\u043e\u043c\u0430\u0448\u043d\u0435\u0435 \u0437\u0430\u0434\u0430\u043d\u0438\u0435","ea606e43":"## \u041f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0434\u043b\u044f \u043d\u0435\u0439\u0440\u043e\u043d\u043d\u043e\u0439 \u0441\u0435\u0442\u0438","0ee5e98e":"\u041f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u0443\u0435\u043c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u0440\u0430\u0441\u043f\u043e\u0437\u043d\u0430\u0432\u0430\u043d\u0438\u044f \u0438\u0437 \u0444\u043e\u0440\u043c\u0430\u0442\u0430 one hot encoding \u0432 \u0446\u0438\u0444\u0440\u044b"}}