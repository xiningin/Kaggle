{"cell_type":{"154ff973":"code","b97e0955":"code","6c7e4536":"code","0a0f1eb4":"code","d1efc735":"code","8c3d080a":"code","f0ed0c1f":"code","8ab18874":"code","51fba592":"markdown"},"source":{"154ff973":"!pip install lofo-importance","b97e0955":"import numpy as np\nimport pandas as pd\n\nloading_df = pd.read_csv(\"..\/input\/trends-assessment-prediction\/loading.csv\")\nfnc_df = pd.read_csv(\"..\/input\/trends-assessment-prediction\/fnc.csv\")\n\nfnc_features, loading_features = list(fnc_df.columns[1:]), list(loading_df.columns[1:])\ndf = fnc_df.merge(loading_df, on=\"Id\")\n\n\nlabels_df = pd.read_csv(\"..\/input\/trends-assessment-prediction\/train_scores.csv\")\nlabels_df[\"is_train\"] = True\n\ndf = df.merge(labels_df, on=\"Id\", how=\"left\")\n\ntest_df = df[df[\"is_train\"] != True].copy()\ndf = df[df[\"is_train\"] == True].copy()\n\ndf.shape, test_df.shape","6c7e4536":"from sklearn.model_selection import KFold\nfrom sklearn.linear_model import Ridge\nfrom lofo import LOFOImportance, Dataset, plot_importance\n\n\ndef get_lofo_importance(target):\n    cv = KFold(n_splits=5, shuffle=True, random_state=0)\n\n    dataset = Dataset(df=df[df[target].notnull()], target=target, features=loading_features, \n                      feature_groups={\"fnc\": df[df[target].notnull()][fnc_features].values\/500})\n\n    model = Ridge(0.01)\n    lofo_imp = LOFOImportance(dataset, cv=cv, scoring=\"neg_mean_absolute_error\", model=model)\n\n    return lofo_imp.get_importance()","0a0f1eb4":"plot_importance(get_lofo_importance(target=\"age\"), figsize=(16, 8))","d1efc735":"plot_importance(get_lofo_importance(target=\"domain1_var1\"), figsize=(16, 8))","8c3d080a":"plot_importance(get_lofo_importance(target=\"domain1_var2\"), figsize=(16, 8))","f0ed0c1f":"plot_importance(get_lofo_importance(target=\"domain2_var1\"), figsize=(16, 8))","8ab18874":"plot_importance(get_lofo_importance(target=\"domain2_var2\"), figsize=(16, 8))","51fba592":"## [Leave One Feature Out Importance](https:\/\/github.com\/aerdem4\/lofo-importance)\n\nIt is difficult to calculate the feature importances with traditional ways in such high dimensional data. Thanks to LOFO, we can group the features and get one importance value for the whole group. In this notebook, while each loading feature is considered as separate feature, fnc features are considered as one group. Then we calculate the feature importances for each target using a ridge regression model within cross-validation.\n"}}