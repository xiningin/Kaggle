{"cell_type":{"d0b246ff":"code","f17982ca":"code","6aca955b":"code","3b71c6d8":"code","88f54029":"code","8d9f0f91":"code","52b9bccb":"code","0571c523":"code","ba93c264":"code","ee169135":"code","bd354d48":"code","9b6fb180":"code","87c01269":"code","6a239cb5":"code","1d40dfa8":"code","8eb2f8aa":"code","a10fab2a":"code","859c8c09":"code","f2fca033":"code","a29c022c":"code","e8ad5951":"code","0c8c20fb":"code","b6c85eb5":"code","d641880e":"code","b7e7a30e":"code","b70a4575":"markdown","42bac927":"markdown","09f7a496":"markdown","838984d6":"markdown","dcc92231":"markdown","09e8dc11":"markdown","663f686a":"markdown","dc36e6dc":"markdown","a970aede":"markdown"},"source":{"d0b246ff":"import pandas as pd\nfrom sklearn.naive_bayes import MultinomialNB\nfrom sklearn.feature_extraction.text import TfidfVectorizer","f17982ca":"df = pd.read_csv(\"..\/input\/jigsaw-toxic-comment-classification-challenge\/train.csv\")\ndf['y'] = (df[['toxic', 'severe_toxic', 'obscene', 'threat', 'insult', 'identity_hate']].sum(axis=1) > 0 ).astype(int)\ndf = df[['comment_text', 'y']].rename(columns={'comment_text': 'text'})\ndf.sample(5)","6aca955b":"df['y'].value_counts(normalize=True)","3b71c6d8":"min_len = (df['y'] == 1).sum()","88f54029":"df_y0_undersample = df[df['y'] == 0].sample(n=min_len, random_state=201)","8d9f0f91":"df = pd.concat([df[df['y'] == 1], df_y0_undersample])","52b9bccb":"df['y'].value_counts()","0571c523":"from nltk.stem import SnowballStemmer, WordNetLemmatizer\nimport re\nfrom nltk.corpus import stopwords\nstemmer = SnowballStemmer('english')\nlemmatizer = WordNetLemmatizer()\nall_stopwords = stopwords.words('english')","ba93c264":"#https:\/\/www.kaggle.com\/kishalmandal\/multi-label-stratified-k-fold-toxic-comments\ndef clean(comment):\n    comment = re.sub('[^a-zA-Z]', ' ', comment)\n    comment = comment.lower()\n    comment = comment.split()\n    comment = [stemmer.stem(word) for word in comment if not word in set(all_stopwords)]\n    comment = [lemmatizer.lemmatize(word) for word in comment]\n    comment = ' '.join(comment)\n    return comment","ee169135":"df['text'].iloc[0]","bd354d48":"clean(df['text'].iloc[0])","9b6fb180":"df['text'] = df['text'].apply(clean)","87c01269":"vec = TfidfVectorizer()","6a239cb5":"X = vec.fit_transform(df['text'])\nX","1d40dfa8":"model = MultinomialNB()\nmodel.fit(X, df['y'])","8eb2f8aa":"df_val = pd.read_csv(\"..\/input\/jigsaw-toxic-severity-rating\/validation_data.csv\")","a10fab2a":"X_less_toxic = vec.transform(df_val['less_toxic'].apply(clean))\nX_more_toxic = vec.transform(df_val['more_toxic'].apply(clean))","859c8c09":"p1 = model.predict_proba(X_less_toxic)\np2 = model.predict_proba(X_more_toxic)","f2fca033":"# Validation Accuracy\n(p1[:, 1] < p2[:, 1]).mean()","a29c022c":"df_sub = pd.read_csv(\"..\/input\/jigsaw-toxic-severity-rating\/comments_to_score.csv\")\nX_test = vec.transform(df_sub['text'])\np3 = model.predict_proba(X_test)","e8ad5951":"df_sub","0c8c20fb":"df_sub['score'] = p3[:, 1]","b6c85eb5":"df_sub['score'].count()","d641880e":"# 9 comments will fail if compared one with the other\ndf_sub['score'].nunique()","b7e7a30e":"df_sub[['comment_id', 'score']].to_csv(\"submission.csv\", index=False)","b70a4575":"# Submission","42bac927":"# Validate","09f7a496":"# Please, _DO_ upvote!","838984d6":"# \u2623\ufe0f Jigsaw - Super simple Naive Bayes [LB=0.768]\n\n## Very simple naive bayes with `LB=0768`.\n\nUsing data from [Toxic Comment Classification Challenge](https:\/\/www.kaggle.com\/c\/jigsaw-toxic-comment-classification-challenge)\n\nI have created a dataset for this data. It's public here :\n* [jigsaw-toxic-comment-classification-challenge](https:\/\/www.kaggle.com\/julian3833\/jigsaw-toxic-comment-classification-challenge)\n\n\n# Please, _DO_ upvote!","dcc92231":"# Fit Naive Bayes","09e8dc11":"# Imports","663f686a":"# Undersample\n\nThe dataset is very unbalanced. Here we undersample the majority class. Other strategies might work better.","dc36e6dc":"# TF-IDF","a970aede":"# Create train data\n\nThe competition was multioutput\n\nWe turn it into a binary toxic\/ no-toxic classification"}}