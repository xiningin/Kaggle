{"cell_type":{"1a8e7be0":"code","9ebe4d40":"code","0ad1547f":"code","2d2213a4":"code","f1f330be":"code","83bcffd2":"code","ab06bcb1":"code","4258d42f":"code","12289c77":"code","fbf901ce":"code","8d6bdf03":"code","8ee83702":"code","f8dea05a":"code","970b7ca6":"code","482def72":"code","45e93f19":"code","e9b65e93":"code","928fb53f":"code","0c5c5d63":"code","2e6edf6e":"code","05b47401":"code","acc31bab":"code","9b560f63":"code","db69e5aa":"code","bcc5b48e":"code","ca4f2a31":"markdown","703d3702":"markdown","c4c808e8":"markdown","25f96f47":"markdown","d48a4861":"markdown","21ab9b24":"markdown","89651e3b":"markdown","9f2fe53d":"markdown","c5d42f04":"markdown","11ab9e2d":"markdown","a2aba7bb":"markdown","39ba9111":"markdown","8ac6e6ac":"markdown","c10dc3ba":"markdown","30eb47dc":"markdown","8075c176":"markdown","9a19b80e":"markdown","61712c10":"markdown","e28b6f67":"markdown","449f3d88":"markdown","fafb76e5":"markdown","ec3cb999":"markdown","a6122fef":"markdown","6fa6d3c2":"markdown","e5bc756b":"markdown"},"source":{"1a8e7be0":"# import pandas and seaborn\nimport pandas as pd\nimport seaborn as sns","9ebe4d40":"# import linear regression model\nfrom sklearn.linear_model import LinearRegression\n# import linear regression metrics\nfrom sklearn.metrics import r2_score, mean_squared_error\n# import train\/test split function\nfrom sklearn.model_selection import train_test_split","0ad1547f":"#import the data\nwater_data = pd.read_csv('\/kaggle\/input\/water-temperature\/water.csv')\n\n# display the data to check it has imported\nwater_data","2d2213a4":"water_data.info()","f1f330be":"water_data['O2ml_L'].describe()","83bcffd2":"water_data[water_data['O2ml_L'] < 0]","ab06bcb1":"water_data = water_data[water_data['O2ml_L'] >= 0].copy()\nwater_data['O2ml_L'].describe()","4258d42f":"features = ['T_degC', 'PO4uM', 'SiO3uM', 'NO2uM', 'NO3uM', 'Salnty']\ntarget = 'O2ml_L'\n# warning: pairplot can be very slow on a dataset of this size, avoid hue\nsns.pairplot(data=water_data, x_vars=features, y_vars=target);","12289c77":"sns.relplot(data=water_data, x='NO2uM', y='O2ml_L', aspect=2);","fbf901ce":"water_data[water_data['NO2uM'] > 3]","8d6bdf03":"water_data['Sta_X'] = (water_data['Sta_ID'] == '081.8 046.9').replace({True: 'Yes', False: 'No'})\nwater_data","8ee83702":"water_data.groupby('Sta_X')['NO2uM'].describe()","f8dea05a":"# stat='density', common_norm=False gives density relative to the group totals\n# compare to\n# sns.displot(data=water_data, x='O2ml_L', col='Sta_X');\nsns.displot(data=water_data, x='O2ml_L', col='Sta_X', stat='density', common_norm=False);","970b7ca6":"# Take a slice but filtering out Sta_X\nclean_data = water_data[water_data['Sta_ID'] != \"081.8 046.9\"].copy()\nclean_data","482def72":"clean_data['Zone'].value_counts()","45e93f19":"sns.catplot(data=clean_data, kind='box', x='O2ml_L', y='Zone');","e9b65e93":"clean_data.groupby('Zone').agg({'O2ml_L': ['mean', 'median', 'std']})","928fb53f":"sns.relplot(data=clean_data, x='T_degC', y='O2ml_L', hue='Zone', aspect=2);","0c5c5d63":"# displot with two numeric variables shows the density of observations\nsns.displot(data=clean_data, x='T_degC', y='O2ml_L', col='Zone');","2e6edf6e":"photic_data = water_data[water_data['Zone'] == 'Photic'].copy()\nphotic_data","05b47401":"# define target\ny = photic_data['O2ml_L']\n\n# create an array of all the input features and define the X\nall_features = ['T_degC', 'PO4uM', 'SiO3uM', 'NO2uM', 'NO3uM', 'Salnty']\nX_photic=photic_data[all_features]\n\n# perform the training-testing split\nX_photic_train, X_photic_test, y_photic_train, y_photic_test = train_test_split(X_photic, y, train_size=0.8, random_state=1)\n\n# display the length of the lists to check \nprint(\"Size of X_photic_train: \",X_photic_train.shape)\nprint(\"Length of y_photic_train: \",len(y_photic_train))\nprint(\"Size of X_photic_test: \",X_photic_test.shape)\nprint(\"Length of y_photic_test: \",len(y_photic_test))","acc31bab":"# Define the input features\ninput_features = ['T_degC']\n\n# Train the model\nlinear_model_T = LinearRegression().fit(X_photic_train[input_features], y_photic_train)\n\n# display the parameters - output the coefficients and y-intercept\nprint('Coefficients: ', linear_model_T.coef_)\nprint('Intercept: ', linear_model_T.intercept_)","9b560f63":"# create a list of the predictions\ny_pred = linear_model_T.predict(X_photic_test[input_features])\n\n# give the R\u00b2 score and MSE for the predictions\nprint('R\u00b2: ',r2_score(y_photic_test, y_pred))\nprint('RMSE: ',mean_squared_error(y_photic_test, y_pred, squared=False))","db69e5aa":"# Define the input features\n\n\n# create the model\n\n\n# display the parameters - output the coefficients and y-intercept","bcc5b48e":"# create a list of the predictions\n\n\n# give the R\u00b2 score and MSE for the predictions","ca4f2a31":"<a id='model1'><\/a>\n### Building a model with `T_degC`","703d3702":"<a id='Explore2'><\/a>\n## Exploration (2): using multiple input features","c4c808e8":"<a id='modelling'><\/a>\n## Modelling with Data\n\n<a id='split'><\/a>\n### Train\/test split","25f96f47":"These values look anomalous. The code below takes a slice which ignores rows with negative `O2ml_L`.","d48a4861":"<a id='preprocessing1'><\/a>\n## Preprocessing and Preparing (1)","21ab9b24":"What about the distribution of `O2ml_L` values?","89651e3b":"When there is this much data on a scatter plot it can be hard to see how many data points are in each area.","9f2fe53d":"<a id='eda4'><\/a>\n## Exploratory Data Analysis (4)\n\nThe majority of fishes and other aerobic organisms live in the *Photic Zone*: this is region between the surface and 200m below sea level. Exploring the data for these zones separately could be useful.","c5d42f04":"<a id='preprocessing4'><\/a>\n## Preprocessing and preparing (4)\n\nThe data from the photic zone can be extracted to work with separately.","11ab9e2d":"<a id='eda1'><\/a>\n## Exploratory Data Analysis (1)","a2aba7bb":"It doesn't seem possible to have negative values for oxygen saturation. Where are they coming from?","39ba9111":"<a id='preprocessing3'><\/a>\n## Preprocessing and Preparing (3)\nThe values for this station are noticably different from the rest of the data. A new data set can be produced with this station excluded.","8ac6e6ac":"<a id='intro'><\/a>\n## Introduction\n\nOxygen saturation is a measure of the amount of dissolved oxygen in water. It is important for the sustainanility of many aquatic environments to support fish and other aerobic organisms.\n\nThe data in this notebook is taken from CalCOFI (California Cooperative Oceanic Fisheries Investigations). Various features, including oxygen saturation, have been recorded at a number of Pacific ocean sites between 1959 and 2019.\n\n<a id='import'><\/a>\n### Importing libraries and data","c10dc3ba":"**(2) Evaluate the model**","30eb47dc":"**(1) Define the input features and build the model.**","8075c176":"Evaluate the model.","9a19b80e":"<a id='Explore1'><\/a>\n## Exploration (1): using a single input feature\n\nBuild a model using a different input feature.","61712c10":"<a id='eda2'><\/a>\n## Exploratory Data Analysis (2)\n\nThe aim is to build a model for `O2ml_L`. You can explore all the possible numerical input features with a pairplot.","e28b6f67":"<a id='eda3'><\/a>\n## Exploratory Data Analysis (3)\n\nHow does this station's `NO2uM` readings compare to other stations?","449f3d88":"Take a closer look at `NO2uM` versus `O2ml_L`","fafb76e5":"Define the input features and create the model.","ec3cb999":"<a id='feature2'><\/a>\n### Feature engineering","a6122fef":"# MEI Data Science Taught Course - Lesson 9 - Putting it all together\n\n## Table of Contents\n\n* [Introduction](#intro)\n - [Importing libraries and data](#import)\n* [Exploratory Data Analysis (1)](#eda1)\n* [Pre-processing and Preparing (1)](#preprocessing1)\n* [Exploratory Data Analysis (2)](#eda2)\n* [Pre-processing and Preparing (2)](#preprocessing2)\n - [Feature engineering](#feature2)\n* [Exploratory Data Analysis (3)](#eda3)\n* [Pre-processing and Preparing (3)](#preprocessing3)\n - [Feature engineering](#feature3)\n* [Exploratory Data Analysis (4)](#eda4)\n* [Pre-processing and Preparing (4)](#preprocessing4)\n* [Modelling with Data](#modelling)\n - [Train\/test split](#split)\n - [Building a model](#model1)\n* [Exploration](#explore1)","6fa6d3c2":"<a id='preprocessing2'><\/a>\n## Preprocessing and Preparing (2)\n\nStation `081.8 046.9` seems to be responsible for these unusual values. This is the same station that had some negative `O2ml_L` values. Ideally you would want to find out more about this station and whether there is a reason for these extreme values; however, in the absence of this further exploratory data analysis will be helpful.","e5bc756b":"There are a few points with high`NO2uM` and very low `O2ml_L`"}}