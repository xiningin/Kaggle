{"cell_type":{"5e5be4cd":"code","ff59b37a":"code","504ebf0c":"code","0dcced21":"code","72a48366":"code","b71ee398":"code","e70ebb5a":"code","2e163cd5":"code","cfd87058":"code","5ffe18c3":"code","9fe0a95c":"code","7b110673":"code","417871e8":"code","7048024a":"code","3ceda730":"code","99f91ec7":"code","7c57121b":"code","df76aa94":"code","ce8a2cac":"code","371b1737":"code","65494c59":"code","b21df154":"code","d4532cd8":"code","54b4d511":"code","a2b10605":"code","8f0dca14":"code","96841b7e":"code","376da5ee":"code","b44ede82":"code","df297d98":"code","e036b4cb":"code","fcf8406a":"code","8bf42352":"code","35b6e1ca":"code","5cc1b1a6":"code","707f8a4b":"code","8cb76270":"code","385ae591":"code","366d1a01":"code","8a34eb27":"code","016f106b":"code","405bb200":"code","f63d30cd":"code","890fdab7":"code","72cc7ab0":"code","04ae2d2a":"code","fcd0b6e8":"code","3bd36300":"code","36ce44f2":"code","6b976f8c":"code","ab5a6508":"code","fe0c8e44":"code","1f575756":"code","dc092095":"code","bdc0fb4a":"code","81d25b62":"code","ecf328f1":"code","9de33042":"code","6d7988d8":"code","df3df798":"code","9f1c18bf":"code","a037d8a5":"code","b7ee7c7c":"code","4f8df0e4":"code","eb96fbb7":"code","1160579b":"code","b8d24259":"code","f42ccb84":"code","3bc458b7":"markdown","1aeb5cc7":"markdown","65a652af":"markdown","3d383576":"markdown","dcb57383":"markdown","17f89145":"markdown","b536ce8e":"markdown","e0312329":"markdown","a987c7cb":"markdown","49746b35":"markdown","87ceeff0":"markdown","8a5b3bc4":"markdown","c018f722":"markdown","feb1642d":"markdown","a64a6dea":"markdown","195f9344":"markdown","9df83abe":"markdown","a73cbb19":"markdown","e1319294":"markdown","a488ab09":"markdown","ca638fa5":"markdown","99557909":"markdown","8c9114a1":"markdown","7ff732ec":"markdown","20fa09ce":"markdown","de4a0c88":"markdown","33bb4b5d":"markdown","9f10de95":"markdown","a73e59e2":"markdown"},"source":{"5e5be4cd":"!pip install git+https:\/\/github.com\/fastai\/fastai@2e1ccb58121dc648751e2109fc0fbf6925aa8887 2>\/dev\/null 1>\/dev\/null","ff59b37a":"from fastai.imports import *\nfrom fastai.structured import *\nfrom pandas_summary import DataFrameSummary\nfrom sklearn.ensemble import RandomForestClassifier\nfrom IPython.display import display\nfrom sklearn import metrics\nfrom sklearn.model_selection import train_test_split\nimport numpy as np \nimport pandas as pd\n\n%load_ext autoreload\n%autoreload 2\n%matplotlib inline \npd.options.mode.chained_assignment = None","504ebf0c":"df = pd.read_csv(\"..\/input\/heart.csv\")","0dcced21":"df.columns = ['age', 'sex', 'chest_pain_type', 'resting_blood_pressure', 'cholesterol', 'fasting_blood_sugar', 'rest_ecg', 'max_heart_rate_achieved',\n       'exercise_induced_angina', 'st_depression', 'st_slope', 'num_major_vessels', 'thalassemia', 'target']\n\ndf['sex'][df['sex'] == 0] = 'female'\ndf['sex'][df['sex'] == 1] = 'male'\n\ndf['chest_pain_type'][df['chest_pain_type'] == 1] = 'typical angina'\ndf['chest_pain_type'][df['chest_pain_type'] == 2] = 'atypical angina'\ndf['chest_pain_type'][df['chest_pain_type'] == 3] = 'non-anginal pain'\ndf['chest_pain_type'][df['chest_pain_type'] == 4] = 'asymptomatic'\n\ndf['fasting_blood_sugar'][df['fasting_blood_sugar'] == 0] = 'lower than 120mg\/ml'\ndf['fasting_blood_sugar'][df['fasting_blood_sugar'] == 1] = 'greater than 120mg\/ml'\n\ndf['rest_ecg'][df['rest_ecg'] == 0] = 'normal'\ndf['rest_ecg'][df['rest_ecg'] == 1] = 'ST-T wave abnormality'\ndf['rest_ecg'][df['rest_ecg'] == 2] = 'left ventricular hypertrophy'\n\ndf['exercise_induced_angina'][df['exercise_induced_angina'] == 0] = 'no'\ndf['exercise_induced_angina'][df['exercise_induced_angina'] == 1] = 'yes'\n\ndf['st_slope'][df['st_slope'] == 1] = 'upsloping'\ndf['st_slope'][df['st_slope'] == 2] = 'flat'\ndf['st_slope'][df['st_slope'] == 3] = 'downsloping'\n\ndf['thalassemia'][df['thalassemia'] == 1] = 'normal'\ndf['thalassemia'][df['thalassemia'] == 2] = 'fixed defect'\ndf['thalassemia'][df['thalassemia'] == 3] = 'reversable defect'","72a48366":"df.head()","b71ee398":"def missing_data_ratio(df):\n    all_data_na = (df.isnull().sum() \/ len(df)) * 100\n    all_data_na = all_data_na.drop(all_data_na[all_data_na == 0].index).sort_values(ascending=False)[:30]\n    missing_data = pd.DataFrame({'Missing Ratio' :all_data_na})\n    return missing_data","e70ebb5a":"import warnings\n\nwith warnings.catch_warnings():\n    warnings.filterwarnings(\"ignore\", category=DeprecationWarning)\n    import imp","2e163cd5":"import pandas_profiling","cfd87058":"profile = pandas_profiling.ProfileReport(df)","5ffe18c3":"missing_data_ratio(df)","9fe0a95c":"profile","7b110673":"df.columns","417871e8":"df.chest_pain_type = df.chest_pain_type.astype(\"category\")\ndf.exercise_induced_angina = df.exercise_induced_angina.astype(\"category\")\ndf.fasting_blood_sugar = df.fasting_blood_sugar.astype(\"category\")\ndf.rest_ecg = df.rest_ecg.astype(\"category\")\ndf.sex = df.sex.astype(\"category\")\ndf.st_slope = df.st_slope.astype(\"category\")\ndf.thalassemia = df.thalassemia.astype(\"category\")","7048024a":"df = pd.get_dummies(df, drop_first=True)","3ceda730":"df_p,y,_=proc_df(df,\"target\")","99f91ec7":"df_p.head()","7c57121b":"from sklearn.model_selection import RandomizedSearchCV","df76aa94":"rf_param_grid = {\n                 'max_depth' : [4, 6, 8,10],\n                 'n_estimators': range(1,30),\n                 'max_features': ['sqrt', 'auto', 'log2'],\n                 'min_samples_split': [2, 3, 10,20],\n                 'min_samples_leaf': [1, 3, 10,18],\n                 'bootstrap': [True, False],\n                 \n                 }","ce8a2cac":"m = RandomForestClassifier()","371b1737":"m_r = RandomizedSearchCV(param_distributions=rf_param_grid, \n                                    estimator = m, scoring = \"accuracy\", \n                                    verbose = 0, n_iter = 100, cv = 5)","65494c59":"%time m_r.fit(df_p, y)","b21df154":"m_r.best_score_","d4532cd8":"m_r.best_params_","54b4d511":"rf_bp = m_r.best_params_","a2b10605":"rf_classifier=RandomForestClassifier(n_estimators=rf_bp[\"n_estimators\"],\n                                     min_samples_split=rf_bp['min_samples_split'],\n                                     min_samples_leaf=rf_bp['min_samples_leaf'],\n                                     max_features=rf_bp['max_features'],\n                                     max_depth=rf_bp['max_depth'],\n                                     bootstrap=rf_bp['bootstrap'])","8f0dca14":"rf_classifier.fit(df_p,y)","96841b7e":"fi = rf_feat_importance(rf_classifier,df_p)","376da5ee":"def plot_fi(fi):\n    return fi.plot('cols', 'imp', 'barh', figsize=(12,7), legend=False)","b44ede82":"plot_fi(fi)","df297d98":"import lightgbm as lgbm","e036b4cb":"lgbm_model = lgbm.LGBMClassifier()","fcf8406a":"lgbm_params = {\n    \"n_estimators\":[10,100,1000,2000],\n    'boosting_type': ['dart','gbdt'],          \n    'learning_rate': [0.05,0.1,0.2],       \n    'min_split_gain': [0.0,0.1,0.5,0.7],     \n    'min_child_weight': [0.001,0.003,0.01],     \n    'num_leaves': [10,21,41,61],            \n    'min_child_samples': [10,20,30,60,100]\n              }","8bf42352":"lgbm_model = lgbm.LGBMClassifier()","35b6e1ca":"lgbm_c = RandomizedSearchCV(param_distributions=lgbm_params, \n                                    estimator = lgbm_model, scoring = \"accuracy\", \n                                    verbose = 0, n_iter = 100, cv = 4)","5cc1b1a6":"lgbm_c.fit(df_p,y)","707f8a4b":"lgbm_bp =lgbm_c.best_params_","8cb76270":"lgbm_model = lgbm.LGBMClassifier(num_leaves=lgbm_bp[\"num_leaves\"],\n                                 n_estimators=lgbm_bp[\"n_estimators\"],\n                                 min_split_gain=lgbm_bp[\"min_split_gain\"],\n                                 min_child_weight=lgbm_bp[\"min_child_weight\"],\n                                 min_child_samples=lgbm_bp[\"min_child_samples\"],\n                                 learning_rate=lgbm_bp[\"learning_rate\"],\n                                 boosting_type=lgbm_bp[\"boosting_type\"])","385ae591":"lgbm_model.fit(df_p,y)","366d1a01":"def feature_imp(df,model):\n    fi = pd.DataFrame()\n    fi[\"feature\"] = df.columns\n    fi[\"importance\"] = model.feature_importances_\n    return fi.sort_values(by=\"importance\", ascending=False)","8a34eb27":"feature_imp(df_p,lgbm_model).plot('feature', 'importance', 'barh', figsize=(12,7), legend=False)","016f106b":"import xgboost as xgb","405bb200":"xgb_classifier = xgb.XGBClassifier()","f63d30cd":"gbm_param_grid = {\n    'n_estimators': range(1,20),\n    'max_depth': range(1, 10),\n    'learning_rate': [.1,.4, .45, .5, .55, .6],\n    'colsample_bytree': [.6, .7, .8, .9, 1],\n    'booster':[\"gbtree\"],\n     'min_child_weight': [0.001,0.003,0.01],\n}","890fdab7":"xgb_random = RandomizedSearchCV(param_distributions=gbm_param_grid, \n                                    estimator = xgb_classifier, scoring = \"accuracy\", \n                                    verbose = 0, n_iter = 100, cv = 4)","72cc7ab0":"xgb_random.fit(df_p,y)","04ae2d2a":"xgb_bp = xgb_random.best_params_","fcd0b6e8":"xgb_model=xgb.XGBClassifier(n_estimators=xgb_bp[\"n_estimators\"],\n                            min_child_weight=xgb_bp[\"min_child_weight\"],\n                            max_depth=xgb_bp[\"max_depth\"],\n                            learning_rate=xgb_bp[\"learning_rate\"],\n                            colsample_bytree=xgb_bp[\"colsample_bytree\"],\n                            booster=xgb_bp[\"booster\"])","3bd36300":"xgb_model.fit(df_p,y)","36ce44f2":"feature_imp(df_p,xgb_model).plot('feature', 'importance', 'barh', figsize=(12,7), legend=False)","6b976f8c":"from IPython.core.display import HTML\n\ndef multi_table(table_list):\n    ''' Acceps a list of IpyTable objects and returns a table which contains each IpyTable in a cell\n    '''\n    return HTML(\n        '<table><tr style=\"background-color:white;\">' + \n        ''.join(['<td>' + table._repr_html_() + '<\/td>' for table in table_list]) +\n        '<\/tr><\/table>'\n    )","ab5a6508":"rf_fm = rf_feat_importance(rf_classifier,df_p)\nlgbm_fm = feature_imp(df_p,lgbm_model)\nxgb_fm = feature_imp(df_p,xgb_model)","fe0c8e44":"multi_table([rf_fm,lgbm_fm,xgb_fm])","1f575756":"import seaborn as sns\ncorr = df_p.corr()\nmask = np.zeros_like(corr, dtype=np.bool)\nmask[np.triu_indices_from(mask)] = True\nf, ax = plt.subplots(figsize=(11, 9))\n\nsns.heatmap(corr, \n            xticklabels=corr.columns.values,\n            yticklabels=corr.columns.values,mask=mask,cmap='summer_r',vmax=.3, center=0,\n            square=True, linewidths=.5, cbar_kws={\"shrink\": .5})","dc092095":"from scipy.cluster import hierarchy as hc","bdc0fb4a":"def hierarchy_tree(df):\n    corr = np.round(scipy.stats.spearmanr(df).correlation, 4)\n    corr_condensed = hc.distance.squareform(1-df.corr())\n    z = hc.linkage(corr_condensed, method='average')\n    fig = plt.figure(figsize=(16,10))\n    dendrogram = hc.dendrogram(z, labels=df.columns, orientation='left', leaf_font_size=16)\n    plt.show()","81d25b62":"hierarchy_tree(df_p)","ecf328f1":"df_p[\"target\"] = y  ","9de33042":"df_p.columns","6d7988d8":"max_heart_rate_achieved = pd.cut(df_p.max_heart_rate_achieved,4,labels=[\"71-104\",\"105-137\",\"138-170\",\"171-202\"])","df3df798":"df_p.columns","9f1c18bf":"cross1=pd.crosstab([df_p.st_slope_flat[df_p.st_slope_flat==1],df_p.target],max_heart_rate_achieved).style.background_gradient(cmap='summer_r')\ncross1","a037d8a5":"cross1=pd.crosstab([df_p.st_slope_flat[df_p.st_slope_flat==1],df_p[\"thalassemia_fixed defect\"][df_p[\"thalassemia_fixed defect\"]==1],\n                    df_p.target],max_heart_rate_achieved).style.background_gradient(cmap='summer_r')\ncross1","b7ee7c7c":"cross1=pd.crosstab([df_p.st_slope_flat[df_p.st_slope_flat==1],df_p[\"thalassemia_fixed defect\"][df_p[\"thalassemia_fixed defect\"]==1],df_p[\"chest_pain_type_typical angina\"][df_p[\"chest_pain_type_typical angina\"]==1],\n                    df_p.target],max_heart_rate_achieved).style.background_gradient(cmap='summer_r')\ncross1","4f8df0e4":"cross1=pd.crosstab([df_p[\"thalassemia_fixed defect\"]],df_p.sex_male,margins=True).style.background_gradient(cmap='summer_r')\ncross1","eb96fbb7":"cross1=pd.crosstab([df_p[\"thalassemia_fixed defect\"][df_p[\"thalassemia_fixed defect\"]==1],df_p.target],df_p.sex_male).style.background_gradient(cmap='summer_r')\ncross1","1160579b":"cross1=pd.crosstab([df_p.exercise_induced_angina_yes[df_p.exercise_induced_angina_yes==1],df_p.target],[df_p.st_slope_upsloping[df_p.st_slope_upsloping==1],df_p.st_depression]).style.background_gradient(cmap='summer_r')\ncross1","b8d24259":"age = pd.cut(df_p.age,6,labels=[\"(28.952, 37.0)\", \"(37.0, 45.0)\", \"(45.0, 53.0)\",\"(53.0, 61.0)\",\"(61.0, 69.0)\", \"(69.0, 77.0)\"])","f42ccb84":"cross1=pd.crosstab([pd.cut(df_p.resting_blood_pressure,3),df_p.target],[age]).style.background_gradient(cmap='summer_r')\ncross1","3bc458b7":"### <b>Introduction <\/b>","1aeb5cc7":"**Feature correlation**","65a652af":"#### <b>Random Forest<\/b>  <a class=\"anchor\" id=\"rd\"><\/a>","3d383576":"**How does random forest work?**\n\n    To classify a new object with attributes a tree is planted and a tree votes for a specific class and the forest chooses the class with most votes.","dcb57383":"### <b>Kernel Goals <\/b>:\n#### Data exploration and cleaning.\n#### Data modeling(Random Forest + LighGBM + XGBoost ).\n#### Feature importance. \n#### Investigation some correlation.","17f89145":"## Data Cleaning <a class=\"anchor\" id=\"dc\"><\/a>","b536ce8e":"## Models <a class=\"anchor\" id=\"md\"><\/a>","e0312329":"#### <b>Xgboost<\/b>  <a class=\"anchor\" id=\"xgb\"><\/a>","a987c7cb":"#### Dataset information ","49746b35":"We will now process the data to use algorithms on it.","87ceeff0":"#### <b>LightGBM<\/b>  <a class=\"anchor\" id=\"lgm\"><\/a>","8a5b3bc4":"## Heart Disease Diagnosis and Prediction","c018f722":"This database contains 76 attributes, but all published experiments refer to using a subset of 14 of them. In particular, the Cleveland database is the only one that has been used by ML researchers to this date. The \"goal\" field refers to the presence of heart disease in the patient. It is integer valued from 0 (no presence) to 4.\n","feb1642d":"#### <b>Random Forest Feature importance<\/b> ","a64a6dea":"#### <b>XGboost Feature importance <\/b>","195f9344":"### crosstabing correlated features","9df83abe":". It can perform both classification and regression.\n. Handles the missing values and maintains the accuracy for missing data.\n. It dosen't overfit the model.","a73cbb19":"<img src=\"https:\/\/cdn-images-1.medium.com\/max\/1600\/1*CQXQxHDKi0Q2IpdjhufEcw.jpeg\" style=\"height:300px;\" \/>","e1319294":"LightGBM is a gradient boosting framework that uses tree based learning algorithms.","a488ab09":"##  Investigating strongly correlated features <a class=\"anchor\" id=\"ic\"><\/a>","ca638fa5":"Now we will first convert our normal attributes like age,sex etc into numerical form so that we can further analyse it.","99557909":"What is eXtreme Gradient Boosting(Xgboost)?\n\n\nTo understand xgboost we need to first understand Gradient boosting first. Gradient boosting is a machine learning technique for regression and classification problems, which produces a prediction model in the form of an ensemble of weak prediction models, typically decision trees.\n\nThe name xgboost, though, actually refers to the engineering goal to push the limit of computations resources for boosted tree algorithms. Which is the reason why many people use xgboost.","8c9114a1":"### Top feature causing heart disease according to RF,LGBM,XGB <a class=\"anchor\" id=\"tf\"><\/a>","7ff732ec":"#### Attribute Information: \n> 1. Age \n> 2. Sex \n> 3. Chest pain type (4 values) \n> 4. Resting blood pressure \n> 5. Serum cholestoral in mg\/dl \n> 6. Fasting blood sugar > 120 mg\/dl\n> 7. Resting electrocardiographic results (values 0,1,2)\n> 8. Maximum heart rate achieved \n> 9. Exercise induced angina \n> 10. Oldpeak = ST depression induced by exercise relative to rest \n> 11. The slope of the peak exercise ST segment \n> 12. Number of major vessels (0-3) colored by flourosopy \n> 13. Thal: 3 = normal; 6 = fixed defect; 7 = reversable defect","20fa09ce":"#### <b> resting_blood_pressure is strong factory but only in early age <\/b>","de4a0c88":"#### <b>LightGBM Feature importance <\/b>","33bb4b5d":"###### according to this data 93% of poeple that have st_slope_flat + thalassemia_fixed_defect + chest_pain_typical_argina have heart disease ","9f10de95":"#### <b>Quick exploration with pandas profiling. <\/b>","a73e59e2":"### <b>Contents<\/b>\n\n1. [Data Cleaning](#dc)\n2. [Models](#md) <br>\n    2.1 [Random Forest](#md)<br>\n    2.2 [LightGBM](#lgm)<br>\n    2.3 [XGBoost](#xgb)\n3. [Top feature causing heart disease](#tf)\n4. [Feature correlation ](#fc)\n5. [Investigating strongly correlated features](#ic)"}}