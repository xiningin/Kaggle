{"cell_type":{"b3b6f648":"code","4f7bd48f":"code","81b40657":"code","790a06f3":"code","2a1825c8":"code","7ef6e0b0":"code","d6372e65":"markdown","e101bb93":"markdown"},"source":{"b3b6f648":"import pandas as pd\nimport librosa\nimport librosa.display\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport soundfile as sf\nimport IPython\nfrom tqdm.notebook import tqdm\nimport os","4f7bd48f":"# \u30c7\u30fc\u30bf\u8aad\u8fbc\u307f\ndf_train = pd.read_csv('\/kaggle\/input\/hah-data-science-challenge\/train.csv', index_col=False)\ndf_test = pd.read_csv('\/kaggle\/input\/hah-data-science-challenge\/test.csv', index_col=False)\ndf_labeled = df_train[df_train.Target.isnull()==False]","81b40657":"# \u97f3\u306e\u9cf4\u308a\u59cb\u3081\u3092\u691c\u51fa\u3059\u308b\u95a2\u6570\n# \u53c2\u8003: http:\/\/makotomurakami.com\/blog\/2020\/06\/21\/5790\/\n\ndef backtrack(filepath):\n    y, sr = librosa.load(filepath)\n\n    onset_envelope = librosa.onset.onset_strength(y, sr=sr)\n    onset = librosa.onset.onset_detect(onset_envelope=onset_envelope, sr=sr)\n    onset_backtrack = librosa.onset.onset_backtrack(onset, onset_envelope)\n\n    amplitude = np.abs(librosa.stft(y))\n    times = librosa.times_like(onset_envelope, sr=sr)\n\n    fig = plt.figure(figsize=(6.4, 4.8))\n\n    ax1 = fig.add_subplot(2, 1, 1)\n    librosa.display.specshow(librosa.amplitude_to_db(amplitude, ref=np.max), x_axis='time', y_axis='log')\n    ax1.set_title('power spectrogram')\n\n    ax2 = fig.add_subplot(2, 1, 2, sharex=ax1)\n    ax2.plot(times, onset_envelope, label='onset strength')\n    ax2.vlines(times[onset], 0, onset_envelope.max(), color='r', linestyle='--', label='onsets')\n    ax2.vlines(times[onset_backtrack], 0, onset_envelope.max(), color='b', linestyle='--', label='backtracked')\n    ax2.legend(frameon=True, framealpha=0.75)\n    ax2.set_xlabel('Time')\n    ax2.set_title('onset envelope, onsets, and backtracked onsets')\n\n    plt.tight_layout()\n    plt.show()","790a06f3":"# \u307e\u305a\u306f\u30011\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\nfilepath = '\/kaggle\/input\/hah-data-science-challenge\/train\/train\/train1782.wav'\nprint(filepath)\nbacktrack(filepath)\nIPython.display.Audio(filepath)\n\n# \u9752\u8272\u306e\u7dda\u304c\u97f3\u306e\u958b\u59cb\u30bf\u30a4\u30df\u30f3\u30b0","2a1825c8":"# train \u306e wav \u30d5\u30a1\u30a4\u30eb\u306e\u6253\u97f3\u306e\u958b\u59cb\u30dd\u30a4\u30f3\u30c8\u3092\u78ba\u8a8d\nfilelist = filelist = ['\/kaggle\/input\/hah-data-science-challenge\/train\/train\/'+f for f in df_train.\u30d5\u30a1\u30a4\u30eb.values]\n\nfor i, filepath in enumerate(tqdm(filelist)):\n    filename = os.path.basename(filepath)\n    print(filename)\n    backtrack(filepath)\n    \n    if i==5: break   # \u6570\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d","7ef6e0b0":"# test \u306e wav \u30d5\u30a1\u30a4\u30eb\u306e\u6253\u97f3\u306e\u958b\u59cb\u30dd\u30a4\u30f3\u30c8\u3092\u78ba\u8a8d\nfilelist = filelist = ['\/kaggle\/input\/hah-data-science-challenge\/test\/test\/'+f for f in df_test.\u30d5\u30a1\u30a4\u30eb.values]\n\nfor i, filepath in enumerate(tqdm(filelist)):\n    filename = os.path.basename(filepath)\n    print(filename)\n    backtrack(filepath)\n\n    if i==5: break   # \u6570\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d","d6372e65":"### \u307e\u3068\u3081\n\n\uff11\u6253\u97f3\u3092\u5206\u5272\u3059\u308b\u305f\u3081\u306b\u3001\u97f3\u306e\u958b\u59cb\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u304c\u53d6\u308c\u308c\u3070\u5206\u5272\u304c\u3067\u304d\u305d\u3046\u3002<br>\n\u30bb\u30df\u306e\u58f0\u306a\u3069\u74b0\u5883\u97f3\u304c\u5165\u3063\u3066\u3044\u308b\u5834\u5408\u304c\u3042\u308b\u306e\u3067\u3001\u74b0\u5883\u97f3\u3068\u6253\u97f3\u304c\u5206\u96e2\u3067\u304d\u308c\u3070\u3088\u308a\u30cf\u30c3\u30ad\u30ea\u3068\u6253\u97f3\u306e\u958b\u59cb\u30bf\u30a4\u30df\u30f3\u30b0\u304c\u53d6\u308c\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n\uff11\u6253\u97f3\u306e\u958b\u59cb\u30bf\u30a4\u30df\u30f3\u30b0\u306f\u62bd\u51fa\u304c\u3067\u304d\u305d\u3046\u3060\u304c\u3001\u540c\u3058\u3088\u3046\u306b\u97f3\u306e\u7d42\u4e86\u30bf\u30a4\u30df\u30f3\u30b0\u3092\u62bd\u51fa\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u308b\u306e\u3060\u308d\u3046\u304b\u3002","e101bb93":"## \uff11\u6253\u97f3\u3054\u3068\u306b\u5206\u5272\u3059\u308b\u305f\u3081\u306e\u65b9\u6cd5\u3092\u691c\u8a0e\n\n1\u6253\u97f3\u3054\u3068\u306b\u5206\u5272\u3059\u308b\u305f\u3081\u306b\u3001\u6253\u97f3\u306e\u958b\u59cb\u30bf\u30a4\u30df\u30f3\u30b0\u304c\u53d6\u5f97\u3067\u304d\u306a\u3044\u304b\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002"}}