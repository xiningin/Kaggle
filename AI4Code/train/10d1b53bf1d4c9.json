{"cell_type":{"74f9d21b":"code","c6a16e62":"markdown","b66f6c69":"markdown"},"source":{"74f9d21b":"# Import libraries\nimport pandas as pd; import numpy as np \n\n# Download data\ntraindf = pd.read_csv('..\/input\/titanic\/train.csv').set_index('PassengerId')\ntestdf = pd.read_csv('..\/input\/titanic\/test.csv').set_index('PassengerId')\ndf = pd.concat([traindf, testdf], axis=0, sort=False)\n\n# FE\ndf['Title'] = df.Name.str.split(',').str[1].str.split('.').str[0].str.strip()\ndf['IsWomanOrBoy'] = ((df.Title == 'Master') | (df.Sex == 'female'))\ndf['LastName'] = df.Name.str.split(',').str[0]\nfamily = df.groupby(df.LastName).Survived\ndf['WomanOrBoyCount'] = family.transform(lambda s: s[df.IsWomanOrBoy].fillna(0).count())\ndf['WomanOrBoyCount'] = df.mask(df.IsWomanOrBoy, df.WomanOrBoyCount - 1, axis=0)\ndf['FamilySurvivedCount'] = family.transform(lambda s: s[df.IsWomanOrBoy].fillna(0).sum())\ndf['FamilySurvivedCount'] = df.mask(df.IsWomanOrBoy, df.FamilySurvivedCount - df.Survived.fillna(0), axis=0)\ndf['WomanOrBoySurvived'] = df.FamilySurvivedCount \/ df.WomanOrBoyCount.replace(0, np.nan)\ndf['Alone'] = (df.WomanOrBoyCount == 0)\ntest_x = pd.concat([df.WomanOrBoySurvived.fillna(0), df.Alone, df.Sex.replace({'male': 0, 'female': 1})], axis=1).loc[testdf.index]\n\n# Prediction\ntest_x['Survived'] = (((test_x.WomanOrBoySurvived <= 0.238) & (test_x.Sex > 0.5) & (test_x.Alone > 0.5)) | \\\n          ((test_x.WomanOrBoySurvived > 0.238) & \\\n           ~((test_x.WomanOrBoySurvived > 0.55) & (test_x.WomanOrBoySurvived <= 0.633))))\n\n# Submission\npd.DataFrame({'Survived': test_x['Survived'].astype(int)}, \\\n             index=testdf.index).reset_index().to_csv('survived.csv', index=False)","c6a16e62":"This detail about this solution please see in my notebook **[Titanic (0.80382) : one line of the prediction](https:\/\/www.kaggle.com\/vbmokin\/titanic-0-80382-one-line-of-the-prediction)**\n\nThis solution is:\n* the **shortest** - the one line of code for prediction basic on my condition, total 17 rows\n* the **fastest** - model as \"if ...then...\", total work time is less 15 seconds\n\nwith high accuracy Score (public LB) = 0.80382 > 0.803 - Top 6% (earlier it was Top 2%).","b66f6c69":"# [Titanic: Machine Learning from Disaster](https:\/\/www.kaggle.com\/c\/titanic)"}}