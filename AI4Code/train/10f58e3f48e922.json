{"cell_type":{"9817a441":"code","f025c6e6":"code","906a218f":"code","df11f7f6":"code","f7a11d61":"code","1568e68d":"code","ccbc37f2":"code","fa39990b":"code","c3159316":"code","5d86f761":"code","cf6a3ea4":"code","b2f1fecb":"code","7e3e5185":"code","57324855":"code","934a2b7d":"code","b912cd12":"code","cbb5f036":"code","95930d88":"code","d64460fc":"markdown","93fc9003":"markdown","ef538ca7":"markdown","6c6a71e6":"markdown","42ab2f70":"markdown","79921483":"markdown","68a22da1":"markdown","2c0b4849":"markdown","5dffb77f":"markdown","a69fd719":"markdown","40e87037":"markdown","39513d0d":"markdown","408c07b7":"markdown"},"source":{"9817a441":"import os\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline","f025c6e6":"print(os.getcwd())","906a218f":"file1819 = ('..\/input\/season-1819_csv.csv')\nfile1718 = ('..\/input\/season-1718_csv.csv')\nfile1617 = ('..\/input\/season-1617_csv.csv')\nfile1516 = ('..\/input\/season-1516_csv.csv')","df11f7f6":"df_1819 = pd.read_csv(file1819, header=0)\ndf_1718 = pd.read_csv(file1718, header=0)\ndf_1617 = pd.read_csv(file1718, header=0)\ndf_1516 = pd.read_csv(file1516, header=0)","f7a11d61":"df_1819.shape","1568e68d":"df_1718 = df_1718.drop(['LBH', 'LBD', 'LBA'],axis=1)\ndf_1617 = df_1617.drop(['LBH', 'LBD', 'LBA'],axis=1)\ndf_1516 = df_1516.drop(['LBH', 'LBD', 'LBA'],axis=1)","ccbc37f2":"frames = [df_1819, df_1718, df_1617,df_1516]\nepl_df = pd.concat(frames)\nepl_df.shape","fa39990b":"epl_df.head(5)","c3159316":"epl_df.columns","5d86f761":"epl_df = epl_df.assign(HomeWin=lambda epl_df: epl_df.apply(lambda row: 1 if row.FTHG > row.FTAG else 0, axis='columns'),\n              Draw=lambda epl_df: epl_df.apply(lambda row: 1 if row.FTHG == row.FTAG else 0, axis='columns'),\n              AwayWin=lambda epl_df: epl_df.apply(lambda row: 1 if row.FTHG < row.FTAG else 0, axis='columns'))\nepl_df.head(10)","cf6a3ea4":"epl_df['Year'] = pd.DatetimeIndex(epl_df['Date']).year\nepl_df.tail(10)","b2f1fecb":"win_rates = \\\n(epl_df.groupby('Year')\n    .mean()\n    .loc[:,['HomeWin', 'Draw', 'AwayWin']])\n\nwin_rates","7e3e5185":"# Set the style\nplot_cols = ['HomeWin', 'AwayWin', 'Draw']\n\nfig, axes = plt.subplots(3,1, figsize=(20,15))\nwin_rates[plot_cols].plot(subplots=True, ax=axes)\n\nfor ax, col in zip(axes, plot_cols):\n\n    # lets add horizontal zero lines\n    ax.axhline(0.15, color='k', linestyle='-', linewidth=1)\n    \n    # add titles\n    ax.set_title('Win Trend - ' + col)\n    \n    # add axis labels\n    ax.set_ylabel('Win Probability')\n    ax.set_xlabel('Year')","57324855":"home_win_df = \\\n(epl_df.groupby(['HomeTeam'])\n    .HomeWin\n    .mean())\n\naway_win_df = \\\n(epl_df.groupby(['AwayTeam'])\n    .AwayWin\n    .mean())","934a2b7d":"home_grnd_adv = (home_win_df - away_win_df).reset_index().rename(columns={0: 'HomeGrndAdv'}).sort_values(by='HomeGrndAdv', ascending=False)\nhome_grnd_adv.head()","b912cd12":"big_clubs = ['Liverpool', 'Man City', 'Man United', 'Chelsea', 'Arsenal']\nhome_win_rates_5 = epl_df[epl_df.HomeTeam.isin(big_clubs)].groupby(['HomeTeam', 'Year']).HomeWin.mean()\naway_win_rates_5 = epl_df[epl_df.AwayTeam.isin(big_clubs)].groupby(['AwayTeam', 'Year']).AwayWin.mean()\ntop_5 = home_win_rates_5 - away_win_rates_5\n\ntop_5.unstack(level=0)","cbb5f036":"fig, ax = plt.subplots(figsize=(20, 15))\nsns.lineplot(x='Year', y='HomeGrndAdv', hue='Teams', data=top_5.reset_index().rename(columns={0: 'HomeGrndAdv', 'HomeTeam': 'Teams'}), ax=ax)\nplt.legend(loc='lower right', ncol=6, bbox_to_anchor=(0.5, 0., 0.5, 0.5), fontsize='large')\nplt.title(\"Home Ground Advantage for the Top 5 Clubs in the Table\", fontsize=16)\nplt.show()","95930d88":"print('Overall Home Win Rate: {:.4}%'.format(epl_df.HomeWin.mean() * 100))\n\n# Get the top 10 Refs \ntop_10_refs = epl_df.Referee.value_counts().head(10).index\n\nepl_df[epl_df.Referee.isin(top_10_refs)].groupby('Referee').HomeWin.mean().sort_values(ascending=False)","d64460fc":"#### 4) Create HomeWin, AwayWin and Draw Columns using the FTHG, FTAG columns ","93fc9003":"# English Premiere League Dataset Exploration\n\nThe site - https:\/\/datahub.io\/sports-data\/english-premier-league#pandas has EPL data for all years begining from 2009\/2010 season. For this exercise, I will be using data from 2016\/2016 onwards. \nThis kernel will focus on how to integrate data, and looks at whether data speaks for the intuition we know about the game. \n\nBelow are the descriptions of the columns used - \n\n* FTHG = The total number of goals scored by the home team during the match at full time.\n* FTAG = The total number of goals scored by the away team during the match at half time.\n* FTR = The full time result, denoted as 'H' for home team win, 'A' for away team win, or 'D' for draw,\n* HTHG = The total number of goals scored by the home team at half time.\n* HTAG = The total number of goals scored by the away team at half time.\n* HTR = The half time result, denoted 'H' for home team advantage, 'A' for away team advantage, or 'D' for draw.\n* HomeTeam = Home Team \n* AwayTeam = Away Team\n* B365H = Bet365 home win odds\n* B365D = Bet365 draw odds\n* B365A = Bet365 away win odds\n* LBH = Ladbrokes home win odds\n* LBD = Ladbrokes draw odds\n* LBA = Ladbrokes away win odds\n* FTR = Full Time Result (H=Home Win, D=Draw, A=Away Win)","ef538ca7":"This shows that K. Friend is the most influenced by home crowd. With an Overall Win Rate of 45%, the win rate when Friend is refree is 51%.\n\n#### This completes the intial data exploration on this English Premiere League Dataset\n                                                * ------------- * -------------- *\n","6c6a71e6":"#### Home Ground Advantage","42ab2f70":"This shows that Arsenal has had the most advantage in terms of home wins. Lets look at a few top of the table teams and their performance at home vs away ","79921483":"### Importing Relevant Libraries","68a22da1":"#### Refree Home Ground Bias\n\nLet's see if there exists a refree home ground bias. ","2c0b4849":"#### 3) Creating a combined dataframe for all years ","5dffb77f":"### Data Exploration\n\n#### Home Vs Away\n\nWe know by intuition that home games always prove to be winning matches for the home team. Let's take a look if the data speaks for this as well.","a69fd719":"#### 2) Dropping data so columns are consistent throughout the years. The columns dropped are LBH, LBD and LBA which we wont be using in our analysis. ","40e87037":"#### 5) Adding 'Year' column to see past performances","39513d0d":"### Data Collection and Preprocessing\n\n#### 1) Collecting data for 4 years - 2015-2019","408c07b7":"As seen, the Home Win % is fairly high except for 2014\/2015. Let's plot this for better understanding"}}