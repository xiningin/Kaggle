{"cell_type":{"43f6e8ed":"code","8286ad09":"code","a2a89b3f":"code","7f1ef093":"code","a724ddb4":"code","a2726c1b":"code","1ee191d8":"code","9097e220":"code","72719893":"code","bd957fe1":"code","aea39e22":"code","d29c583a":"code","f8554c34":"code","59d2b440":"code","af7c3276":"code","5a874b12":"code","2dffc375":"code","87fd8049":"code","c1a7d1c6":"markdown","ecbee706":"markdown","45d3b9b8":"markdown","c5e41df0":"markdown"},"source":{"43f6e8ed":"import os\nimport time\nimport dask\nimport numpy as np\nimport pandas as pd\nimport seaborn as sns\nfrom pathlib import Path\nfrom functools import partial\nimport matplotlib.pyplot as plt\n\n\nimport librosa\nfrom librosa import display\n\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots\n\nsns.set()\n%config IPCompleter.use_jedi=False","8286ad09":"data_path = Path(\"..\/input\/g2net-gravitational-wave-detection\/\")\ntrain_npy_files_path = data_path \/ \"train\"\ntest_npy_files_path = data_path \/ \"test\"","a2a89b3f":"train_df = pd.read_csv(data_path \/ \"training_labels.csv\")\ntrain_df.head()","7f1ef093":"test_df = pd.read_csv(data_path \/ \"sample_submission.csv\")\ntest_df.head()","a724ddb4":"def get_signal_path(signal_id, split=\"train\"):\n    if split == \"train\":\n        return str(train_npy_files_path \/ signal_id[0] \/ signal_id[1] \/ signal_id[2] \/ f\"{signal_id}.npy\")\n    elif split== \"test\":\n        return str(test_npy_files_path \/ signal_id[0] \/ signal_id[1] \/ signal_id[2] \/ f\"{signal_id}.npy\")","a2726c1b":"start = time.time()\ntrain_df[\"filepath\"] = train_df[\"id\"].apply(partial(get_signal_path, split=\"train\"))\ntest_df[\"filepath\"] = test_df[\"id\"].apply(partial(get_signal_path, split=\"test\"))\nprint(f\"Filepaths stored in dataframes. Time taken: {time.time()-start:.2f} seconds\")","1ee191d8":"train_df.head()","9097e220":"# Any duplicate signal in the data?\ntrain_df[\"id\"].duplicated().sum()","72719893":"#  Distribution of the labels\nplt.figure(figsize=(8, 5))\nsns.countplot(x=train_df[\"target\"], data=train_df)\nplt.show()","bd957fe1":"train_df[\"target\"].value_counts()","aea39e22":"def get_traces(x, y, name, marker=None, color=None):\n    return go.Scatter(x=x,\n                      y=y,\n                      marker=marker,\n                      name=name,\n                     )","d29c583a":"def plot_signals_from_array(signal_array,\n                            target,\n                            names=[\"LIGO Hanford\", \"LIGO Livingston\", \"Virgo\"],\n                            colors=[\"red\", \"green\", \"blue\"],\n                            markers=[None, None, None],\n                            subplots=False,\n                            title=None\n                           ):\n    \n    num_signals = len(signal_array)\n    \n    if num_signals > 1:\n        x = np.arange(len(signal_array[0]))\n        if not isinstance(target, list):\n            target = [target] * num_signals\n    else:\n        x = np.arange(len(signal_array))\n        \n    if num_signals > 1 and subplots:\n        fig = make_subplots(rows=num_signals, cols=1)\n        \n        for i in range(num_signals):\n            fig.add_trace(get_traces(x=x,\n                                     y=signal_array[i],\n                                     name=f\"target_{target[i]}:  {names[i]}\",\n                                     marker=markers[i],\n                                    ),\n                          row=i+1, col=1\n                         )\n    else:\n        fig = go.Figure()\n        \n        if num_signals > 1:\n            for i in range(num_signals):\n                fig.add_trace(get_traces(x=x,\n                                         y=signal_array[i],\n                                         name=f\"target_{target[i]}:  {names[i]}\",\n                                         marker=markers[i],\n                                        )\n                             )\n        else:\n            fig.add_trace(get_traces(x=x,\n                                     y=signal_array,\n                                     name=f\"target_{target}:  {names[0]}\",\n                                     marker=markers[0],\n                                    )\n                             )\n    if title:        \n        fig.layout.update(title_text=title, title_x=0.5)\n    return fig\n","f8554c34":"def extract_values_from_df(df, idx):\n    _id = df[\"id\"][idx]\n    signal = np.load(df[\"filepath\"][idx])\n    target = df[\"target\"][idx]\n    return _id, signal, target","59d2b440":"random_idx = np.random.randint(len(train_df))\nsample_id, sample_signal, sample_target = extract_values_from_df(train_df, random_idx)\n\nprint(\"Randomly chosen ID: \", sample_id)\nprint(\"Shape of the signal: \", sample_signal.shape)\nprint(\"Target for this signal: \", sample_target)","af7c3276":"# Plot individual signals\nfig = plot_signals_from_array(\n    signal_array=sample_signal,\n    target=sample_target,\n    subplots=True,\n    title=f\"ID: {sample_id}  target: {sample_target}\"\n)\nfig.show()\n\n# Plot all signals combined\nfig = plot_signals_from_array(\n    signal_array=sample_signal,\n    target=sample_target,\n    title=f\"ID: {sample_id}  target: {sample_target}\"\n)\nfig.show()","5a874b12":"def random_sample_each_target(df):\n    # Pick a random index from all the indices where target == 0\n    random_idx_0 = np.random.choice(np.where(df[\"target\"]==0)[0])\n\n    # Extract values for this index from the dataframe\n    sample_id_0, sample_signal_0, sample_target_0 = extract_values_from_df(df, random_idx_0)\n\n    # Pick a random index form all the indices where target == 1\n    random_idx_1 = np.random.choice(np.where(df[\"target\"]==1)[0])\n\n    # Extract values for this index from the dataframe\n    sample_id_1, sample_signal_1, sample_target_1 = extract_values_from_df(df, random_idx_1)\n    \n    return (\n        [sample_id_0, sample_signal_0, sample_target_0],\n        [sample_id_1, sample_signal_1, sample_target_1]\n    )","2dffc375":"# Randomly choosing samples for each target value\ntarget_0_sample, target_1_sample = random_sample_each_target(train_df)","87fd8049":"# Compare individual signals for different targets\nsignal_names = [\"LIGO Hanford\", \"LIGO Livingston\", \"Virgo\"]\nmarkers = [\n    [dict(color='rgba(255, 0, 0, 1.0)', size=10), dict(color='rgba(128, 50, 0, 0.8)', size=10)],\n    [dict(color='rgb(60, 179, 113, 1.0)', size=10), dict(color='rgba(25, 229, 206, 0.7)', size=10)],\n    [dict(color='rgba(0, 0, 255, 1.0)', size=10), dict(color='rgba(127, 0, 255, 0.5)', size=10)]\n]\n\nfor i in range(len(signal_names)):\n    fig = plot_signals_from_array(\n        signal_array=[target_0_sample[1][i], target_1_sample[1][i]],\n        target=[target_0_sample[2], target_1_sample[2]],\n        names=[signal_names[i], signal_names[i]],\n        markers=markers[i],\n        title=f\"target_0_ID: {target_0_sample[0]} \" \n              f\"target_1_ID: {target_1_sample[0]}\"\n    )\n    fig.show()\n","c1a7d1c6":"## Get the data","ecbee706":"Now that we can plot individual signals as well as combined. Let's do a comparison of the signal for different labels ","45d3b9b8":"The labels are almost equally distributed in the training set, a good sign. Let's check the actual counts of\nthe target labels to get a much better insight","c5e41df0":"## Data Ananlysis"}}