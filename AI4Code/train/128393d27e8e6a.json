{"cell_type":{"9b2f26f2":"code","ea7a28d5":"code","27387189":"code","a4d798dd":"code","04073c6b":"code","c6ef4061":"code","fd5da9dd":"code","9b02301e":"code","59701771":"code","4ee596a7":"code","d0ccc3bf":"code","d1fccd9f":"code","19596df7":"code","ecc48e70":"code","d40946d9":"code","8d87f455":"code","6397c01b":"code","2dc1fffd":"code","07e2d3d3":"code","22c6461b":"code","310b1b12":"code","9dac5f44":"code","f5b56ac4":"code","559c8236":"code","82513874":"code","5625f4b8":"code","ba6d2112":"code","77a5753f":"code","c5bae749":"code","b3d1dd9e":"code","250cf00a":"code","53ef26ff":"code","da8612f7":"code","dfdd5999":"code","61cfafcd":"code","de113006":"code","a8d32842":"code","541ab41c":"code","6082eabd":"code","73db34d6":"code","becffd87":"code","2a701208":"code","4cf8b99d":"code","681a9fc4":"code","5f136970":"code","ac0c64ad":"code","ad23eab3":"code","f8d24a6b":"code","6e8f4f2c":"markdown","f341fced":"markdown","d86a77f0":"markdown","4589b795":"markdown","6c1f42bf":"markdown","97f4b33a":"markdown","d10f9205":"markdown","767c99cf":"markdown","268fcae5":"markdown"},"source":{"9b2f26f2":"# Data Visualization libraries\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom plotly import tools\nimport plotly.express as px\nimport plotly.graph_objs as go\nimport folium\n\nimport warnings\nwarnings.filterwarnings(\"ignore\")\nimport datetime\n\n# Pipeline Regression\nfrom sklearn import linear_model\nfrom sklearn.preprocessing import PolynomialFeatures\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.linear_model import LinearRegression\n\n#ARIMA libraries\nfrom scipy.optimize import curve_fit\nfrom statsmodels.tsa.statespace.sarimax import SARIMAX\nfrom statsmodels.tsa.arima_model import ARIMA\nfrom random import random\n# for live kernels to be able to run plotly we use these statements.\nfrom plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot\ninit_notebook_mode(connected=True)","ea7a28d5":"data=pd.read_csv('\/kaggle\/input\/covid19\/train(1).csv')\ntrain=pd.read_csv('\/kaggle\/input\/covid19\/train(1).csv')\ntest=pd.read_csv('\/kaggle\/input\/covid19-global-forecasting-week-2\/test.csv')\nd1=pd.read_csv('\/kaggle\/input\/covid19\/countries.csv')\nd2=pd.read_csv('\/kaggle\/input\/covid19\/population.csv')\nd3=pd.read_csv('\/kaggle\/input\/covid19\/training_data_with_weather_info_week_2.csv')","27387189":"data.describe()","a4d798dd":"d3.describe()","04073c6b":"print('Number of Countries  '+str(len(set(data.Country_Region))))\nprint(set(data.Country_Region))","c6ef4061":"data_cases = pd.DataFrame(data.groupby(['Date'])['ConfirmedCases'].sum())\ndata_cases['Deaths'] = pd.DataFrame(data.groupby(['Date'])['Fatalities'].sum())\ndata_cases['Mortality_Rate']=(data_cases['Deaths']\/data_cases['ConfirmedCases'])*100\ndata_cases.head()","fd5da9dd":"datas1=go.Bar(y=data_cases.ConfirmedCases, x=data_cases.index, name= 'Cases',xaxis='x1',yaxis='y1')\ndatas2=go.Bar(y=data_cases.Deaths, x=data_cases.index, name= 'Deaths',xaxis='x2',yaxis='y2')\n\nfig = go.Figure(\n    data=[datas1,datas2],\n    layout=go.Layout(\n        xaxis=dict(showgrid=False,domain=[0,0.45]),\n        yaxis=dict(showgrid=False),\n        xaxis2=dict(showgrid=False,domain=[0.55,1]),\n        yaxis2=dict(showgrid=False,domain=[0, 1],anchor='x2'),\n        title_text=\"Number of Confirmed Cases and Deaths WorldWide.\",\n        \n    )\n)\nfig.show()","9b02301e":"datas1=go.Scatter(y=data_cases.ConfirmedCases, x=data_cases.index, name= 'Cases',xaxis='x1',yaxis='y1')\ndatas2=go.Scatter(y=data_cases.Deaths, x=data_cases.index, name= 'Deaths',xaxis='x2',yaxis='y2')\n\nfig = go.Figure(\n    data=[datas1,datas2],\n    layout=go.Layout(\n        xaxis=dict(showgrid=False,domain=[0,0.45]),\n        yaxis=dict(showgrid=False),\n        xaxis2=dict(showgrid=False,domain=[0.55,1]),\n        yaxis2=dict(showgrid=False,domain=[0, 1],anchor='x2'),\n        title_text=\"Number of Confirmed Cases and Deaths Worldwide.\",\n        \n    )\n)\nfig.show()","59701771":"case_country = data.groupby(['Country_Region'], as_index=False)['ConfirmedCases'].max()\n# Sorting by number of cases\ncase_country.sort_values('ConfirmedCases', ascending=False, inplace = True)\ncase_country","4ee596a7":"death_country = data.groupby(['Country_Region'], as_index=False)['Fatalities'].max()\n# Sorting by number of deaths\ndeath_country.sort_values('Fatalities', ascending=False, inplace = True)\ndeath_country","d0ccc3bf":"first_date = data[data['ConfirmedCases']>0]\nfirst_date = first_date.groupby('Country_Region')['Date'].agg(['min']).reset_index()\nddd = datetime.datetime(2020, 3, 26)\nfirst_date['last_date']=ddd\nfirst_date['min']=pd.to_datetime(first_date['min'])\nfirst_date=first_date.sort_values('min',ascending=True)\nfirst_date['Days']=first_date['last_date']-first_date['min']\nfirst_date.columns=['Task', 'Start', 'Finish', 'Days']\nfirst_date","d1fccd9f":"# plot showing the arrival of the disease\nimport random\nclr = [\"#\"+''.join([random.choice('0123456789ABC') for j in range(6)]) for i in range(len(first_date))]\nimport plotly.figure_factory as ff\nfig = ff.create_gantt(first_date, index_col='Task',colors=clr, show_colorbar=False, \n                      bar_width=0.2, showgrid_x=True, showgrid_y=True, height=2500)\nfig.show()","19596df7":"# Sum countries with states.\ntrain_agg= train[['Country_Region','Date','ConfirmedCases','Fatalities']].groupby(['Country_Region','Date'],as_index=False).agg({'ConfirmedCases': 'sum', 'Fatalities': 'sum'})\n\n# change to datetime format\ntrain_agg['Date'] = pd.to_datetime(train_agg['Date'])","ecc48e70":"fig = px.line(train_agg, x='Date', y='ConfirmedCases', color=\"Country_Region\", hover_name=\"Country_Region\")\nfig.update_layout(autosize=False,width=1000,height=500,title='Confirmed Cases Over Time for Each Country')\nfig.show()","d40946d9":"# Interactive time series plot of fatalities\nfig = px.line(train_agg, x='Date', y='Fatalities', color=\"Country_Region\", hover_name=\"Country_Region\")\nfig.update_layout(autosize=False,width=1000,height=500,title='Fatalities Over Time for Each Country')\nfig.show()","8d87f455":"country=case_country.merge(death_country,how='inner',on='Country_Region')","6397c01b":"d2.rename(columns={'con ':'Country_Region'},inplace=True)\ncountry=country.merge(d2,how='inner',on='Country_Region')\nd1.rename(columns={'name':'Country_Region'},inplace=True)\ncountry=country.merge(d1,how='inner',on='Country_Region')\ncountry=country.drop('S.No.',1)\ncountry=country.drop('Country ',1)\ncountry['mortality_rate']=(country['Fatalities']\/country['ConfirmedCases'])*100\ncountry","2dc1fffd":"w=d3.groupby(['Country_Region'])[['temp','stp','prcp']].mean()","07e2d3d3":"country=country.merge(w,how='inner',on='Country_Region')","22c6461b":"(country['UrbanPop %'])=(country['UrbanPop %']).astype(str).astype(float)\n(country['Med.Age'])=(country['Med.Age']).astype(str).astype(float)\n","310b1b12":"temp_f = country.sort_values(by='ConfirmedCases', ascending=False)\ntemp_f = temp_f[['Country_Region', 'ConfirmedCases', 'Population(2020)', 'Fatalities','temp', 'UrbanPop %','Med.Age','mortality_rate','Density(P\/Km\u00b2)','prcp']]\ntemp_f = temp_f.reset_index(drop=True)\n\ntemp_f.style.background_gradient(cmap=\"Blues\", subset=['ConfirmedCases', 'prcp'])\\\n            .background_gradient(cmap=\"Greens\", subset=['Population(2020)','Med.Age'])\\\n            .background_gradient(cmap=\"Reds\", subset=['Fatalities','mortality_rate'])\\\n            .background_gradient(cmap=\"Purples\", subset=['Density(P\/Km\u00b2)','UrbanPop %'])\\\n            .background_gradient(cmap=\"Oranges\", subset=['temp'])\\","9dac5f44":"\nm = folium.Map(location=[0, 0], tiles='cartodbpositron',\n               min_zoom=1, max_zoom=4, zoom_start=1)\n\nfor i in range(0, len(country)):\n    folium.Circle(\n        location=[country.iloc[i]['latitude'], country.iloc[i]['longitude']],\n        color='crimson', \n        tooltip =   '<li><bold>Country : '+str(country.iloc[i]['Country_Region'])+\n                    '<li><bold>Confirmed : '+str(country.iloc[i]['ConfirmedCases'])+\n                    '<li><bold>Deaths : '+str(country.iloc[i]['Fatalities']),\n        radius=int(country.iloc[i]['ConfirmedCases'])**1.1).add_to(m)\nm","f5b56ac4":"fig = px.choropleth(country, locations=\"Country_Region\", \n                    locationmode='country names', color=np.log(country[\"ConfirmedCases\"]), \n                    hover_name=\"Country_Region\", hover_data=['ConfirmedCases','Fatalities'],\n                    color_continuous_scale=\"Sunsetdark\", \n                    title='Countries with Confirmed Cases')\nfig.update(layout_coloraxis_showscale=False)\nfig.show()","559c8236":"formated_gdf = data.groupby(['Date', 'Country_Region'])['ConfirmedCases', 'Fatalities'].max()\nformated_gdf = formated_gdf.reset_index()\nformated_gdf['Date'] = pd.to_datetime(formated_gdf['Date'])\nformated_gdf['Date'] = formated_gdf['Date'].dt.strftime('%m\/%d\/%Y')\n\nfig = px.choropleth(formated_gdf, locations=\"Country_Region\", \n                    locationmode='country names', color=formated_gdf['ConfirmedCases'], \n                    hover_name=\"Country_Region\", hover_data=['ConfirmedCases','Fatalities'],\n                    color_continuous_scale=\"Sunsetdark\", \n                    animation_frame=\"Date\",  title='Spread over time')\nfig.update(layout_coloraxis_showscale=False)\nfig.show()","82513874":"fig = px.scatter(temp_f.sort_values('Fatalities', ascending=False).iloc[:15, :], \n                 x='Med.Age', y='Fatalities', color='Country_Region', size='ConfirmedCases', height=800,\n                 text='Country_Region', log_x=True, log_y=True, title='Deaths vs Median Age of Country')\nfig.update_traces(textposition='top center')\nfig.update_layout(xaxis_rangeslider_visible=True,xaxis=dict(showgrid=False))\nfig.show()","5625f4b8":"fig = px.scatter(temp_f.sort_values('Fatalities', ascending=False).iloc[:15, :], \n                 x='Density(P\/Km\u00b2)', y='ConfirmedCases', color='Country_Region', size='ConfirmedCases', height=800,\n                 text='Country_Region', log_x=True, log_y=True, title='Confirmed Cases vs Density of Country')\nfig.update_traces(textposition='top center')\nfig.update_layout(xaxis_rangeslider_visible=True,xaxis=dict(showgrid=False))\nfig.show()","ba6d2112":"fig = px.scatter(temp_f.sort_values('Fatalities', ascending=False).iloc[:15, :], \n                 x='UrbanPop %', y='ConfirmedCases', color='Country_Region', size='ConfirmedCases', height=800,\n                 text='Country_Region', log_x=True, log_y=True, title='Confirmed Cases vs UrbanPop % of Country')\nfig.update_traces(textposition='top center')\nfig.update_layout(xaxis_rangeslider_visible=True,xaxis=dict(showgrid=False))\nfig.show()","77a5753f":"country","c5bae749":"top_cases=case_country.iloc[:16,:]","b3d1dd9e":"top_deaths=death_country.iloc[:16,:]","250cf00a":"datas1=go.Bar(y=top_deaths.Fatalities, x=top_deaths.Country_Region, name= 'Deaths',xaxis='x1',yaxis='y1')\ndatas2=go.Bar(y=top_cases.ConfirmedCases, x=top_cases.Country_Region, name= 'Cases',xaxis='x2',yaxis='y2')\n\nfig = go.Figure(\n    data=[datas1,datas2],\n    layout=go.Layout(\n        xaxis=dict(showgrid=False,domain=[0,0.45]),\n        yaxis=dict(showgrid=False),\n        xaxis2=dict(showgrid=False,domain=[0.55,1]),\n        yaxis2=dict(showgrid=False,domain=[0, 1],anchor='x2'),\n        title_text=\"Countrires with maximum number of Confirmed Cases and Deaths.\",\n        \n    )\n)\nfig.show()","53ef26ff":"corr=country.corr(method ='pearson')\ncorr","da8612f7":"sns.heatmap(corr, \n        xticklabels=corr.columns,\n        yticklabels=corr.columns).set_title('Correlation')\n","dfdd5999":"train['Date_datetime'] = train['Date'].apply(lambda x: (datetime.datetime.strptime(x, '%Y-%m-%d')))\ntrain.head()","61cfafcd":"# using pipeline model for prediction of ConfirmedCases\nfor country in train['Country_Region'].unique():\n    print ('training model for country ==>'+str(country))\n    country_pd_train = train[train['Country_Region']==country]\n    country_pd_test = test[test['Country_Region']==country]\n    if country_pd_train['Province_State'].isna().unique().any()==True:\n        x = np.array(range(len(country_pd_train))).reshape((-1,1))\n        y = country_pd_train['ConfirmedCases']\n        model = Pipeline([('poly', PolynomialFeatures(degree=2)),\n                         ('linear', LinearRegression(fit_intercept=False))])\n        model = model.fit(x, y)\n        predict_x = (np.array(range(len(country_pd_test)))+50).reshape((-1,1))\n        test.loc[test['Country_Region']==country,'ConfirmedCases'] = model.predict(predict_x)\n    else:\n        for state in country_pd_train['Province_State'].unique():\n            state_pd = country_pd_train[country_pd_train['Province_State']==state] \n            state_pd_test = country_pd_test[country_pd_test['Province_State']==state] \n            x = np.array(range(len(state_pd))).reshape((-1,1))\n            y = state_pd['ConfirmedCases']\n            model = Pipeline([('poly', PolynomialFeatures(degree=2)),\n                         ('linear', LinearRegression(fit_intercept=False))])\n            model = model.fit(x, y)\n            predict_x = (np.array(range(len(state_pd_test)))+50).reshape((-1,1))\n            test.loc[(test['Country_Region']==country)&(test['Province_State']==state),'ConfirmedCases'] = model.predict(predict_x)","de113006":"# using pipeline model for prediction of Fatalities\nfor country in train['Country_Region'].unique():\n    print ('training model for country ==>'+str(country))\n    country_pd_train = train[train['Country_Region']==country]\n    country_pd_test = test[test['Country_Region']==country]\n    if country_pd_train.loc[:,'Province_State'].isna().unique().any()==True:\n        x = np.array(range(len(country_pd_train))).reshape((-1,1))\n        y = country_pd_train['Fatalities']\n        model = Pipeline([('poly', PolynomialFeatures(degree=2)),\n                         ('linear', LinearRegression(fit_intercept=False))])\n        model = model.fit(x, y)\n        predict_x = (np.array(range(len(country_pd_test)))+50).reshape((-1,1))\n        test.loc[test['Country_Region']==country,'Fatalities'] = model.predict(predict_x)\n    else:\n        for state in country_pd_train['Province_State'].unique():\n            state_pd = country_pd_train[country_pd_train['Province_State']==state] \n            state_pd_test = country_pd_test[country_pd_test['Province_State']==state] \n            x = np.array(range(len(state_pd))).reshape((-1,1))\n            y = state_pd['Fatalities']\n            model = Pipeline([('poly', PolynomialFeatures(degree=2)),\n                         ('linear', LinearRegression(fit_intercept=False))])\n            model = model.fit(x, y)\n            predict_x = (np.array(range(len(state_pd_test)))+50).reshape((-1,1))\n            test.loc[(test['Country_Region']==country)&(test['Province_State']==state),'Fatalities'] = model.predict(predict_x)","a8d32842":"test['Fatalities']=test['Fatalities'].astype('str')\ntest['ConfirmedCases']=test['ConfirmedCases'].astype('str')\ntest['Fatalities']=test['Fatalities'].str.replace('-','')\ntest['ConfirmedCases']=test['ConfirmedCases'].str.replace('-','')\ntest['Fatalities']=test['Fatalities'].astype('float')\ntest['ConfirmedCases']=test['ConfirmedCases'].astype('float')","541ab41c":"# result of Linear regressive pipeline model\ntest.head()","6082eabd":"submits = pd.DataFrame()\nsubmits['ConfirmedCases'] = test['ConfirmedCases'].astype('int')\nsubmits['Fatalities'] = test['Fatalities'].astype('int')","73db34d6":"submits.describe()","becffd87":"# regions=unique(countries+province)\nfor i in range(len(train)):\n    if(pd.isna(train.loc[i,'Province_State'])==True):\n        train.loc[i,'Lat']=train.loc[i,'Country_Region']\n    else:\n        train.loc[i,'Lat']=train.loc[i,'Country_Region']+str(train.loc[i,'Province_State'])\ncountries_list=train.Lat.unique()\ndf1=[]\nfor i in countries_list:\n    df1.append(train[train['Lat']==i])\nprint(\"we have \"+ str(len(df1))+\" regions in our dataset\")","2a701208":"# ARIMA MODEL PREDICTION.\nsubmit_confirmed=[]\nsubmit_fatal=[]\nfor i in df1:\n    # contrived dataset\n    data = i.ConfirmedCases.astype('int32').tolist()\n    # fit model\n    try:\n        model = SARIMAX(data, order=(2,1,0), seasonal_order=(1,1,0,12))#seasonal_order=(1, 1, 1, 1))\n        #model = ARIMA(data, order=(3,1,2))\n        model_fit = model.fit(disp=False)\n        # make prediction\n        predicted = model_fit.predict(len(data), len(data)+34)\n        new=np.concatenate((np.array(data),np.array([int(num) for num in predicted])),axis=0)\n        submit_confirmed.extend(list(new[-43:]))\n    except:\n        submit_confirmed.extend(list(data[-10:-1]))\n        for j in range(34):\n            submit_confirmed.append(data[-1]*2)\n    \n    # contrived dataset\n    data = i.Fatalities.astype('int32').tolist()\n    # fit model\n    try:\n        model = SARIMAX(data, order=(2,1,0), seasonal_order=(1,1,0,12))#seasonal_order=(1, 1, 1, 1))\n        #model = ARIMA(data, order=(3,1,2))\n        model_fit = model.fit(disp=False)\n        # make prediction\n        predicted = model_fit.predict(len(data), len(data)+34)\n        new=np.concatenate((np.array(data),np.array([int(num) for num in predicted])),axis=0)\n        submit_fatal.extend(list(new[-43:]))\n    except:\n        submit_fatal.extend(list(data[-10:-1]))\n        for j in range(34):\n            submit_fatal.append(data[-1]*2)\n\ndf_submit=pd.concat([pd.Series(np.arange(1,1+len(submit_confirmed))),pd.Series(submit_confirmed),pd.Series(submit_fatal)],axis=1)","4cf8b99d":"df_submit=df_submit.fillna(method='pad').astype(int)","681a9fc4":"s=df_submit","5f136970":"df_submit.index=test.Date\ndf_submit.columns=['Id','ConfirmedCases','Fatalities']","ac0c64ad":"data_casess = pd.DataFrame(test.groupby(['Date'])['ConfirmedCases'].sum())\ndata_casess['Deaths'] = pd.DataFrame(test.groupby(['Date'])['Fatalities'].sum())\ndata_casess['Mortality_Rate']=(data_cases['Deaths']\/data_cases['ConfirmedCases'])*100\ndata_casess.head()","ad23eab3":"datas1=go.Bar(y=data_casess.ConfirmedCases, x=data_casess.index, name= 'Cases',xaxis='x1',yaxis='y1')\ndatas2=go.Bar(y=data_casess.Deaths, x=data_casess.index, name= 'Deaths',xaxis='x2',yaxis='y2')\n\nfig = go.Figure(\n    data=[datas1,datas2],\n    layout=go.Layout(\n        xaxis=dict(showgrid=False,domain=[0,0.45]),\n        yaxis=dict(showgrid=False),\n        xaxis2=dict(showgrid=False,domain=[0.55,1]),\n        yaxis2=dict(showgrid=False,domain=[0, 1],anchor='x2'),\n        title_text=\"PIPELINE REGREESION Forecast of Number of Confirmed Cases and Deaths WorldWide.\",\n        \n    )\n)\nfig.show()","f8d24a6b":"datas1=go.Bar(y=df_submit.ConfirmedCases, x=data_casess.index, name= 'Cases',xaxis='x1',yaxis='y1')\ndatas2=go.Bar(y=df_submit.Fatalities, x=data_casess.index, name= 'Deaths',xaxis='x2',yaxis='y2')\n\nfig = go.Figure(\n    data=[datas1,datas2],\n    layout=go.Layout(\n        xaxis=dict(showgrid=False,domain=[0,0.45]),\n        yaxis=dict(showgrid=False),\n        xaxis2=dict(showgrid=False,domain=[0.55,1]),\n        yaxis2=dict(showgrid=False,domain=[0, 1],anchor='x2'),\n        title_text=\"ARIMA Forecast of Number of Confirmed Cases and Deaths WorldWide.\",\n        \n    )\n)\nfig.show()","6e8f4f2c":"The below graphs do show relations between age,urban population and density of population with how hard a country is affected with age being a very important factor.","f341fced":"# COVID 19 EDA,FORECASTING","d86a77f0":"IMPORTING LIBRARIES","4589b795":"from the correlation heatmap it is also observable that low temperature are suitable for the spread of covid-19","6c1f42bf":"# ARIMA MODEL","97f4b33a":"# PIPELINE REGRESSION","d10f9205":"# FUTURE PREDICTIONS","767c99cf":"The datasets are taken from kaggle,worldometre.","268fcae5":"### EDA and Visualisation "}}