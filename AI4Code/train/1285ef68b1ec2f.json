{"cell_type":{"ac0d196f":"code","3bd2ac14":"code","007b6f9e":"code","417da4b7":"code","d4b54b5c":"code","54f81e10":"code","8a12fb3a":"code","1a6bcab7":"code","c94fb153":"code","1fbfad76":"code","d0b89d71":"code","18107c06":"code","467f4d77":"code","2d1d7eff":"markdown","18e97a09":"markdown","c6de2a75":"markdown","52cbd1fe":"markdown"},"source":{"ac0d196f":"import numpy as np\nimport tensorflow as tf\nimport os, random\nimport keras as k\nimport IPython.display as display\nseed = 12","3bd2ac14":"def runSeed():\n    global seed\n    os.environ['PYTHONHASHSEED']=str(seed)\n    tf.random.set_seed(seed)\n    np.random.seed(seed)\n    random.seed(seed)\n\nrunSeed()","007b6f9e":"basePath = '\/kaggle\/input\/animal-breed-cats-and-dogs\/'\ntrainPath = basePath + 'TRAIN\/'\ntestPath = basePath + 'TEST\/'","417da4b7":"labels = []\nimgPath = []\n\nfor x in os.listdir(trainPath):\n    currPath = os.path.join(trainPath,x)\n    for y in os.listdir(currPath):\n        iPath = os.path.join(currPath, y)\n        imgPath.append(iPath)\n        labels.append(x)","d4b54b5c":"train_size = 0.8\nrand = np.random.permutation(len(labels))\ntrain_set_bound = int(len(labels) * train_size)\ntrain_set = rand[:train_set_bound]\nvalid_set = rand[train_set_bound:]","54f81e10":"train_set_data = [imgPath[x] for x in train_set]\ntrain_set_label = [labels[x] for x in train_set]\n\nvalid_set_data = [imgPath[x] for x in valid_set]\nvalid_set_label = [labels[x] for x in valid_set]","8a12fb3a":"test_set_data = []\n\nfor x in os.listdir(testPath):\n    iPath = os.path.join(testPath,x)\n    test_set_data.append(iPath)","1a6bcab7":"def createTFRecord(tfFilePath, filenames, labels=None):\n    tfrecord_writer = tf.io.TFRecordWriter(tfFilePath)\n    print(\"Generating file..\",tfFilePath)\n\n    # create a writer\n    filenames = tf.constant(filenames)\n    if labels:\n        labels = tf.constant(labels)\n        # iterate over image files in directory\n        for img_path, label in zip(filenames, labels):\n            try: # try read image file\n                raw_file = tf.io.read_file(img_path)\n            except FileNotFoundError:\n                print(\"Couldn't read file  {}\".format(img_path))\n                continue\n            # create an example with the image and label\n            example = tf.train.Example(features=tf.train.Features(feature={\n                'image': tf.train.Feature(bytes_list=tf.train.BytesList(value=[raw_file.numpy()])),\n                'label': tf.train.Feature(bytes_list=tf.train.BytesList(value=[label.numpy()]))\n            }))\n            tfrecord_writer.write(example.SerializeToString()) # write example to file\n    else:\n        # iterate over image files in directory\n        for img_path in filenames:\n            try:\n                raw_file = tf.io.read_file(img_path)\n            except FileNotFoundError:\n                print(\"Couldn't read file  {}\".format(img_path))\n                continue\n            # create an example with the image and label\n            example = tf.train.Example(features=tf.train.Features(feature={\n                'image': tf.train.Feature(bytes_list=tf.train.BytesList(value=[raw_file.numpy()]))\n            }))\n            tfrecord_writer.write(example.SerializeToString()) # write example to file\n\n    # close writer\n    tfrecord_writer.close()","c94fb153":"# generate train tfrecords\ncreateTFRecord('train.tfrecords', train_set_data, train_set_label)\n# generate valid tfrecords\ncreateTFRecord('valid.tfrecords', valid_set_data, valid_set_label)\n# generate test tfrecords\ncreateTFRecord('test.tfrecords', test_set_data)","1fbfad76":"# helper function to read tfrecords file\ndef tfrecord_reader_fn(filePath):\n    return tf.data.TFRecordDataset(filePath)","d0b89d71":"def _parse_image_label_function(example_proto):\n    # Create a dictionary describing the features.\n    image_feature_description = {\n        'image': tf.io.FixedLenFeature([], tf.string),\n        'label': tf.io.FixedLenFeature([], tf.string)\n    }\n    # Parse the input tf.train.Example proto using the dictionary above.\n    return tf.io.parse_single_example(example_proto, image_feature_description)\n\ndef _parse_image_function(example_proto):\n    image_feature_description = {\n        'image': tf.io.FixedLenFeature([], tf.string)\n    }\n    # Parse the input tf.train.Example proto using the dictionary above.\n    return tf.io.parse_single_example(example_proto, image_feature_description)","18107c06":"# read and parse tfrecords\ntrain_dataset = tfrecord_reader_fn('train.tfrecords').map(_parse_image_label_function)\nvalid_dataset = tfrecord_reader_fn('valid.tfrecords').map(_parse_image_label_function)\ntest_dataset = tfrecord_reader_fn('test.tfrecords').map(_parse_image_function)","467f4d77":"# display sample image from train dataset\nfor image_features in train_dataset:\n    image_raw = image_features['image'].numpy()\n    image_label = image_features['label'].numpy()\n    print(image_label)\n    display.display(display.Image(data=image_raw))\n    break","2d1d7eff":"# Create TFRecords for TPU from Image Dataset","18e97a09":"## Generating TFRecords","c6de2a75":"## Reading TFRecords","52cbd1fe":"## Reading Image Data"}}