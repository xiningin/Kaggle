{"cell_type":{"479b713c":"code","bac3191f":"code","13a63773":"code","0d873e63":"code","e4c38562":"code","46840915":"code","6f5ae196":"code","0cec9043":"code","78f706f1":"code","a443c56c":"code","dd835aa3":"code","446784af":"code","2c24d8df":"code","9dcd03bd":"code","88df037c":"code","d820cd85":"code","284facbd":"code","44f1c058":"code","18c18315":"code","964caf4a":"code","8b6513b0":"code","466d33a3":"code","d96bf8fd":"code","3abd7f10":"code","e823fcd4":"code","59a2db1f":"code","f0b7b9f9":"code","ee1e21cf":"code","a415528e":"code","2753aacb":"code","c72b6ebc":"code","55d93cb6":"code","df00beb9":"code","db3857b1":"code","b89b88af":"code","5ff04532":"code","6298f7bc":"code","1a72dff3":"code","418fff28":"code","b2b30e00":"code","4ba6b2ad":"code","d10d6f2f":"code","64b36e6e":"code","18805d3a":"code","5af92de0":"code","1a8ff346":"code","5d900993":"code","52cf0dd1":"code","e97a5f1f":"code","ae0adaea":"code","44e60f54":"code","64a3072a":"code","f267a8a5":"code","f0ab0efe":"code","48bfd34d":"code","c65f9697":"code","1a6a5a1b":"markdown","e8f4f1d8":"markdown","791a6a01":"markdown","c0f249be":"markdown","6edbaa91":"markdown","8a8cfb6a":"markdown","55fdb0b6":"markdown","0377a0a2":"markdown","7d912e89":"markdown","936a545b":"markdown","39e490cf":"markdown","aea3ff4a":"markdown","71c817a4":"markdown","5bf58b41":"markdown","05f98ca6":"markdown","c9a83063":"markdown","62c4bb9a":"markdown","8fc5229e":"markdown","d28925ec":"markdown","696611fe":"markdown","b293f124":"markdown","7c80e0d8":"markdown","06c8688b":"markdown","764c829a":"markdown","5f70bc43":"markdown","2906b456":"markdown","b1fb6967":"markdown","0f93e4cd":"markdown","955d7f4a":"markdown","0f324f23":"markdown","3b46b2b3":"markdown","ce862338":"markdown","6c1f2fcf":"markdown","fc6fca57":"markdown","1b34afc0":"markdown","3b44d123":"markdown","3cd7e315":"markdown","5770bd39":"markdown","15af3f85":"markdown","6b7252a8":"markdown","6d36bfa1":"markdown","44a240ae":"markdown","1643a97c":"markdown","7bb739eb":"markdown","8567645e":"markdown","de3dea60":"markdown","6cbc7900":"markdown","1d9d3e26":"markdown","b6f6ffcf":"markdown","35e6460b":"markdown","024aeb8b":"markdown","7c0eea1e":"markdown","0c29f187":"markdown","98ce00ab":"markdown","8e6d84b0":"markdown","bd870e75":"markdown","b7c99706":"markdown","1465066c":"markdown","cae5b31c":"markdown","381b0162":"markdown","2c2835d7":"markdown","98a8268c":"markdown"},"source":{"479b713c":"# Importing and loading data files\nimport pandas as pd\nimport numpy as np\n%matplotlib inline\nimport matplotlib.pyplot as plt","bac3191f":"# Load your data and print out a few lines. Perform operations to inspect data\n#   types and look for instances of missing or possibly errant data.\nguns = pd.read_csv('..\/input\/dataset\/gun_data.csv')\ncensus = pd.read_csv('..\/input\/dataset\/census.csv')","13a63773":"guns.info()","0d873e63":"guns.tail()","e4c38562":"guns.head()","46840915":"census.info()","6f5ae196":"census.head()","0cec9043":"# After discussing the structure of the data and any problems that need to be\n#   cleaned, perform those cleaning steps in the second part of this section.\nguns.month = pd.to_datetime(guns.month) # converting month into datetime type","78f706f1":"(guns.loc[:,'permit':'return_to_seller_other'].sum(axis = 1) - guns['totals']).unique()","a443c56c":"guns.fillna(0, inplace =True) \nguns.tail()","dd835aa3":"guns.info()","446784af":"guns.duplicated().all() #Checking Duplicates","2c24d8df":"guns.isna().all() #checking Nan","9dcd03bd":"census.drop('Fact Note', axis = 1, inplace = True)\ncensus.drop([64], inplace = True)","88df037c":"census.head()","d820cd85":"census.dropna(inplace = True)","284facbd":"census.iloc[:,1:] = census.iloc[:,1:].apply(lambda x: x.str.replace(',','').str.strip(' ').str.strip('$').str.replace('D','0').str.replace('FN','0').str.replace('Z','0').str.strip('-'))","44f1c058":"def per_remove(x): #Percent values in Census is not consistant (some is written in `'%'` and some in decimal) so we need to remove `%` and divide by 100 for those values\n    x[x.str.contains('%')]=x[x.str.contains('%')].str.strip('%').astype('float')\/100\n    return x\ncensus = census.apply(per_remove)","18c18315":"census.info()","964caf4a":"for col in census.iloc[:,1:].columns:\n    census[col] = census[col].astype(float)","8b6513b0":"census.info()","466d33a3":"guns_state = np.array(guns.state.unique())\nlen(guns_state)","d96bf8fd":"census_state = np.array(census.columns[1:])\nlen(census_state)","3abd7f10":"drop_states = np.setdiff1d(guns_state, census_state)\ndrop_states","e823fcd4":"for x in drop_states:\n    guns.drop(guns[guns.state == x].index ,inplace = True)","59a2db1f":"guns.state.nunique()","f0b7b9f9":"# Calculate growth in guns we will calculate percent of increase between the sum (12 months) over the year 1998 and over the year 2020 \n\nstates = guns.state.unique() #getting the states list of names\n\ndef state_growth(state_name): #defining a function to calculate the growth over any state\n    state_start = guns[guns.state == state_name].totals.iloc[12:].sum() # total guns per year (12 months)  2020\n    state_end = guns[guns.state == state_name].totals.iloc[:12].sum() # total guns per year (12 months) 1998\n    return (state_start - state_end)\/ state_end*100\n\niterator =(state_growth(x) for x in states) #using numpy iterator to get list of state growth\ngrowth_list =np.fromiter (iterator, 'int')\nplt.figure(figsize=(12, 15))\nplt.barh(states,growth_list)\nplt.title('Growth Rate% of Guns from the year 1998 to 2020')\nplt.xlabel('Growth Rate %')\nplt.axvline(1300, color=\"gray\")\nplt.xticks(rotation=45);","ee1e21cf":"sorted(zip(growth_list, states))[-3:] #Highest 3 states","a415528e":"# Continue to explore the data to address your additional research\n#   questions. Add more headers as needed if you have more questions to\n#   investigate.\nplt.subplots(figsize=(10,15))\nguns.groupby(guns.state).totals.sum().plot(kind ='barh')\nplt.title('National Gun Registerations from year 1998 to 2020')\nplt.xlabel('10 Millions Guns Registertion')\nplt.axvline(2.4e7, color=\"gray\")\nplt.xticks(rotation=45);","2753aacb":"guns_2020=[]\nfor x in states:\n    guns_2020.append (guns[guns.state == x].totals.iloc[12:].sum()) #sum of recent highest 12 months\nplt.figure(figsize=(12, 15))\nplt.barh(states,guns_2020)\nplt.title('Guns Registeration Year 2020')\nplt.xlabel('Guns Per Year');","c72b6ebc":"plt.subplots(figsize=(15,10))\nguns.groupby(guns.month.dt.year).totals.sum().plot()\nplt.xlabel('Years')\nplt.ylabel('Guns Registered x10^7')\nplt.title('Guns Registration Trend')\nplt.xticks(np.arange(1998,2021));","55d93cb6":"def trend(state):\n    plt.subplots(figsize=(15,10))\n    ((guns[guns.state == state].groupby(guns.month.dt.year).totals.sum())\/guns.groupby(guns.month.dt.year).totals.sum()).plot()\n    plt.xlabel('Years')\n    plt.ylabel('Percent of National Registerations')\n    plt.title(state+' Guns Registration Trend')\n    plt.xticks(np.arange(1998,2021));\n    return()\n","df00beb9":"trend('Louisiana')\nplt.axvspan(2004, 2006, color='y', alpha=0.5);","db3857b1":"trend('Texas')\nplt.axvspan(2004, 2006, color='y', alpha=0.5)\nplt.axvspan(2012, 2014, color='y', alpha=0.5);","b89b88af":"fig, ax =plt.subplots(figsize=(15,10))\nmonths = guns[(guns.month > '2001-06') & (guns.month < '2002-03')] \nplt.plot(months.month.unique(), months.groupby(guns.month).totals.sum())\nplt.xlabel('Months')\nplt.ylabel('Total National Registerations')\nplt.title(' Guns Registration Trend around 9\/11 time period')\nplt.axvspan('2001-09', '2001-11', color='y', alpha=0.5);\n;","5ff04532":"guns_2016 = guns[guns.month == '2016'].groupby(guns.state).sum() #grouping guns for the year 2016 by state","6298f7bc":"guns_2016_totals = guns_2016.drop(guns_2016.columns[0:-1], axis = 1).reset_index()","1a72dff3":"guns_2016_totals","418fff28":"census_2016 = census[census.Fact.str.contains('2016')]","b2b30e00":"census_2016 = census_2016.set_index('Fact').T.reset_index()","4ba6b2ad":"census_2016.head()","d10d6f2f":"guns_2016.head()","64b36e6e":"df_merge = census_2016.merge(guns_2016_totals, left_on = 'index', right_on = 'state')","18805d3a":"df_merge","5af92de0":"df_merge.drop('state', axis = 1, inplace = True)","1a8ff346":"df_merge.drop(df_merge.columns[2:4], axis = 1, inplace = True)","5d900993":"col_names = {'index' : 'state', 'Population estimates, July 1, 2016,  (V2016)': 'population', 'Persons under 5 years, percent, July 1, 2016,  (V2016)':'under_5_years_per',\n         'Persons under 18 years, percent, July 1, 2016,  (V2016)':'under_18_years_per',\n           'Persons 65 years and over, percent,  July 1, 2016,  (V2016)':'over_65_years_per',\n          'Female persons, percent,  July 1, 2016,  (V2016)': 'females_per',  'White alone, percent, July 1, 2016,  (V2016)': 'white_per',\n          'Black or African American alone, percent, July 1, 2016,  (V2016)': 'black_per',\n         'American Indian and Alaska Native alone, percent, July 1, 2016,  (V2016)': 'indians_per',\n         'Asian alone, percent, July 1, 2016,  (V2016)':'asian_per', \n          'Native Hawaiian and Other Pacific Islander alone, percent, July 1, 2016,  (V2016)':'hawaiian_per',\n         'Two or More Races, percent, July 1, 2016,  (V2016)': 'others_per', \n         'Hispanic or Latino, percent, July 1, 2016,  (V2016)' : 'hispanic_latino_per',\n         'White alone, not Hispanic or Latino, percent, July 1, 2016,  (V2016)': 'white_not_others_per',\n         'Housing units,  July 1, 2016,  (V2016)': 'housing_units',\n         'Building permits, 2016':'building_permits','totals': 'guns'}","52cf0dd1":"df_merge.rename(columns=col_names, inplace =True)","e97a5f1f":"df_merge['guns_per_thousand']=df_merge.guns* 1000\/df_merge.population","ae0adaea":"df_merge.head()","44e60f54":"def plot_scatter():\n    for i in df_merge.columns[2:-2]:\n        df_merge.plot(kind= 'scatter', y='guns_per_thousand', x=i);\n    return\nplot_scatter()","64a3072a":"df_merge.drop(df_merge[df_merge.guns_per_thousand>20].index, inplace =True)","f267a8a5":"plot_scatter()","f0ab0efe":"x = np.array(df_merge.white_not_others_per)\ny = np.array(df_merge.guns_per_thousand)\nplt.scatter(x,y)\nm, b = np.polyfit(x, y, 1)\nplt.plot(x, m*x + b);","48bfd34d":"guns.totals.hist();","c65f9697":"labels = 'Guns Registeration less 100,000', 'Guns Registeration more than 100,000'\nhigh = guns.totals >=100000\nlow = guns.totals < 100000\nsizes = [guns[high].totals.sum(), guns[low].totals.sum()]\nexplode = (0.1, 0)  # only \"explode\" the 2nd slice (i.e. 'Hogs')\n\nfig1, ax1 = plt.subplots()\nax1.pie(sizes, explode=explode, labels=labels, autopct='%1.1f%%',\n        shadow=True, startangle=90)\nax1.axis('equal')  # Equal aspect ratio ensures that pie is drawn as a circle.\n\nplt.show()","1a6a5a1b":"#### A. guns.csv","e8f4f1d8":"This can lead us to ask a new question <b> Have the gun registeration went up after 11\/9\/2001 terror attack in the US?<\/b>","791a6a01":"> <b>Seems about right. We can then fill the NaN values with zeros.<\/b>","c0f249be":"#### There is a peak coincides with  `9\/11` terror attack","6edbaa91":"<b> Now we got `census_2016` merged with `totals` of `guns_2016` which is the base of our analysis","8a8cfb6a":"<a id='Q5'><\/a>\n### Research Question 5: What is the trend of guns registeration in the state Louisiana and Texas?","55fdb0b6":"#### Data Wrangling the new dataframe `df_merge`","0377a0a2":"\n\n### Data Cleaning  <img src=\"Images\/clean.png\" align=\"right\" width=\"300\" height=\"300\" \/>","7d912e89":"<b> Percent values in Census is not consistant (some is written in `'%'` and some in decimal) so we need to remove `%` and divide by 100 for those values","936a545b":"Figure above suggests that <b>Connecticut, California and West Virginia<\/b> stand as the hightest 3 states in guns regesteration growth from 1998 to 2020","39e490cf":"### Research Question3: Which states have the hightest gun registeration in 2020?","aea3ff4a":"### Census data base\n> The U.S. census data is found in a .csv file. It contains several variables at the state level. Most variables just have one data point per state (2016), but a few have data for more than one year.\n\n***\n***\n### So, *The plan* here is as follows:\n* Load both guns and census data files.\n* Clean both database.\n* Get insights from `guns.csv`\n* Filter `census.csv` for 2016 data to get insights from it.\n* Merge it with `guns.csv` and get the `guns_per_capita` parameter.\n* Examine which parameter correlates most with the `guns_per_capita`","71c817a4":"### `Census Data`","5bf58b41":"#### To analysis the guns registeration based on the census data we will filter data to 2016 which has the most parameters in census data file","05f98ca6":"<b> Transpose `census_2016` to get the states into rows like guns_2016","c9a83063":"* There are many `NaN` values in the data file. We need to fill them with zeros but first we need to verify that `totals` column really equal the summation of each row.","62c4bb9a":"Renaming the columns for easy access","8fc5229e":"Create a new column indicates total of <b>registered guns per 1000 person of population<\/b> for each state as an indication of guns per capita","d28925ec":"### Research Question 4: What is the trend of total guns registeration over time?","696611fe":"<a id='conclusions'><\/a>\n## Conclusions\n<img src=\"Images\/conclusion.png\" align=\"right\" width=\"500\" height=\"500\" \/><br>\n<b> From the above discussion we can conclude the followings:<\/b>\n* Trend of `gun registration` shows some positive correlation with some `life threatening events` in state Louisiana and Texas (2005-2006 during `hurricane Katrina` and 2012 `The Sandy Hook school shooting`<br> <a href=\"#Q5\">as discussed in Q5<\/a> and also seen in 9\/11 event. \n* There is a positive correlation between the percent of `White population percent` in a state and the `registered guns per capita` in this state based upon statistics 2016 <br> <a href=\"#Q6\">as discussed in Q6<\/a><br>\n* In the majority of months, the registeration did not exceed 100,000. <a href=\"#Q7\">as discussed in Q7<\/a><br>\n\n\n<b> Notes:<\/b><span style=\"color:red\">(Resubmission Note)<\/span><br>\nThe above conclusions were limited by the followings:<br>\n1. Guns registration data file:\n  * We can't be certain that the number of guns registered is the same as the ones sold as per Harvard study ___[here](https:\/\/github.com\/BuzzFeedNews\/nics-firearm-background-checks\/blob\/master\/README.md)__ .\n> A forthcoming study conducted by Harvard researchers found that roughly <b>40 percent<\/b> of respondents had acquired their most recent firearm <b><u>without<\/u><\/b> going through a background check.\n  * The Data file contained information about 55 states(with non-official 5 states) . I omitted those data to match `census` dataframe.\n\n\n\n2. Census Data:\n  * <b><u>Only year 2016<\/u><\/b> was analysed. This is because it was the year that only carried some complete data about the race's percentage. Further investigation of other years and going through some other important factors like non-employment, income per capita, persons per square feet could make the conclusions more precise.\n  * All footnotes were eliminated to get numerical data.\n  * Data file was not consistent about expressing the percentage, sometimes with the symbol `%` and sometimes with decimal point. This was overcomed by data manipulation but it can affect the accuracy of the data.\n \n","b293f124":"We can explore the distribution of total guns registeration for every month.","7c80e0d8":"Finding the best fit line using `numpy polyfit` function","06c8688b":"Dropping irrelevant census columns","764c829a":"####  'White alone, not Hispanic or Latino, percent, July 1, 2016,  (V2016)' column can be considered to be the most positively correlated to guns per capita","5f70bc43":"<a id='Q6'><\/a>\n### Research Question 6: What census data is most associated with high gun per capita?  ","2906b456":"Normalizing the `states` in both Data Files","b1fb6967":"<B>an obvious peak can be seen the year 2005 and can be related to hurrican Katrina as per \n__[New York Magazine](https:\/\/www.nytimes.com\/interactive\/2015\/12\/10\/us\/gun-sales-terrorism-obama-restrictions.html)__ ","0f93e4cd":"<a id='Q7'><\/a>\n### Research Question 7: What is the distribution of the total registerations of guns?\n","955d7f4a":"Dropping NaN","0f324f23":"Figure above suggests that <b>Kentucky<\/b> has the hightest gun registeration in 2020","3b46b2b3":"Dropping the overshooting values of `guns_per_thousand` (over 20) to get a better scatter diagrames ","ce862338":"<b> Converting the numerical columns into float type","6c1f2fcf":"<a id='wrangling'><\/a>\n## Data Wrangling<img src=\"Images\/wrangling.jpg\" align=\"right\" width=\"500\" height=\"500\" \/>\n\n\n\n\n\n","fc6fca57":"### Questions That can be asked from this data file<br>\n<img src=\"Images\/questions.jpg\" alt=\"drawing\" width=\"300\" align=\"right\"\/>\n<b>\nQ1: Which states have had the highest growth in gun registrations?<br>\nQ2: Which states have the hightest regestered guns from 1998 to 2020?<br>  \nQ3: What is the Guns Registeration Year 2020?<br>  \nQ4: What is the trend of total guns registeration over time?<br>  \nQ5: What is the trend of guns registeration in the state Louisiana and Texas?<br>  \nQ6: What census data is most associated with high gun per capita?  <br>\nQ7: What is the distribution of the total registerations of guns? <span style=\"color:red\">(Resubmission Note)<\/span>\n<\/b>","1b34afc0":"Checking if the 'totals' is equal to the summation each row.. ","3b44d123":"### `Gun Data`","3cd7e315":"Dropping irrelevant column and row","5770bd39":"\n# Project: FBI NICS Guns Check\n<img src=\"Images\/guns.jpg\" align=\"right\" width=\"500\" height=\"500\" \/>\n\n\n## Table of Contents\n<ul>\n<li><a href=\"#intro\">Introduction<\/a><\/li>\n<li><a href=\"#wrangling\">Data Wrangling<\/a><\/li>\n<li><a href=\"#eda\">Exploratory Data Analysis<\/a><\/li>\n<li><a href=\"#conclusions\">Conclusions<\/a><\/li>\n<\/ul>","15af3f85":"Similare peak could be found in 2005-2006 during hurrican Katrina. another peak can be found at the year end of 2012 and can be correlated to <b>the Sandy Hook school shooting<\/b> __[see here](https:\/\/www.cbs19.tv\/article\/news\/local\/national-study-shows-gun-sales-on-the-rise-in-the-us-in-texas\/503-0f2b622b-1636-4fc2-83e1-d042c1b459a5)__","6b7252a8":"Renaming `census_2016 columns` to easy access it","6d36bfa1":"Replace commas and replace `Value Flags` with 0","44a240ae":"#### Examining Louisiana","1643a97c":"Defining function to plot state trend over time","7bb739eb":"### It also states limitation for the guns registeration system to be used as an indication of total guns sold:\n>These statistics represent the number of firearm background checks initiated through the NICS They do not represent the number of firearms sold Based on varying state laws and purchase scenarios, a one-to-one correlation cannot be made between a firearm background check and a firearm sale\n\n\n>A forthcoming study conducted by Harvard researchers found that roughly 40 percent of respondents had acquired their most recent firearm without going through a background check\n***","8567645e":"<a id='intro'><\/a>\n## Introduction\n\n<br>","de3dea60":"### Research Question2: Which states have the hightest regestered guns from 1998 to 2020?","6cbc7900":"<b> Now it seems to be okay to merge the two dataframe utilizing `state` as Key","1d9d3e26":"<a id='eda'><\/a>\n## Exploratory Data Analysis\n\n\n<img src=\"Images\/EDA.png\" align=\"right\" width=\"500\" height=\"500\" \/><br>\n### Research Question 1 : Which states have had the highest growth in gun registrations?","b6f6ffcf":"Dropping the repeated key column","35e6460b":"Find the extra 5 states in `guns`","024aeb8b":"Defining a function to plot any census feature against `guns_per_thousand`","7c0eea1e":"Figure above suggests that <b>Kentucky, Illinois and Texas<\/b> stand as the hightest 3 states in guns regesteration totals from 1998 to 2020","0c29f187":"For this data file we would like to do the following:\n1. Removing column Fact Note which seems to irrelevant.\n2. Converting numerical data to `float` type and for that:\n    * replacing commas `,` with decimal points `.`\n    * the data has not been consistent about expressing the percentage values (sometimes it uses `%` and sometimes it uses `.`)\n    * removing `%` and divide those numbers by 100\n    * removing `value flags` as indicated in the file.\n3. Filter data for `2016` only\n4. Transpose the dataframe\n5. Check the `states` is the same in both dataframes.\n5. Merge `totals` column from `guns.csv` with it. ","98ce00ab":"<b> Checking column `states` at both data files to be the same","8e6d84b0":"***\n#### B. Census Data","bd870e75":"It is clear that in the majority of months the registeration did not exceed 100,000.  ","b7c99706":"* We need to convert `month` column into `datetime` format","1465066c":"In the figures above we got overshooting values of `guns_per_thousand`, I would like to eliminate those to get a better look at the correlations.","cae5b31c":"This clearly show that more than 70% of data has guns registeration more than 100,000 guns ","381b0162":"### General Properties","2c2835d7":"#### Examining Texas","98a8268c":"### The project utilizes two database files. One includes data from NICS firearm checks (loaded as `guns.csv`) and the other (`census.csv`) includes population aspects that I will try to link to the former data file.\n***\n### Guns.csv\n### As per Github link to this database __[Github](https:\/\/github.com\/BuzzFeedNews\/nics-firearm-background-checks\/blob\/master\/README.md)__ descriping The NICS system :\n\n>Mandated by the Brady Handgun Violence Prevention Act of 1993 and launched by the FBI on November 30, 1998, NICS is used by Federal Firearms Licensees (FFLs) to instantly determine whether a prospective buyer is eligible to buy firearms or explosives. Before ringing up the sale, cashiers call in a check to the FBI or to other designated agencies to ensure that each customer does not have a criminal record or isn\u2019t otherwise ineligible to make a purchase. More than 100 million such checks have been made in the last decade, leading to more than 700,000 denials."}}