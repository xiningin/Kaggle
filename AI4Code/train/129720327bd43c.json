{"cell_type":{"a53c1e79":"code","d491748d":"code","76414334":"code","e64ef2b9":"code","c2cd81b1":"code","68b559cf":"code","3c9d723c":"code","b3349077":"code","1b8dc39e":"code","041e67c7":"code","451b8685":"code","b7af23f8":"code","43e1c754":"code","da5a825b":"code","26d19cad":"code","4d5debe4":"markdown","5534c05d":"markdown","7f6faf7e":"markdown","18ba7e3a":"markdown","6f4128d8":"markdown"},"source":{"a53c1e79":"!pip install -q yfinance\nimport yfinance as yf\n\n!pip install -q missingno\nimport missingno as msno\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nimport pandas as pd\nimport numpy as np\n\nfrom sklearn import impute\n\nimport warnings\nwarnings.filterwarnings('ignore')","d491748d":"data=pd.read_csv(r'\/kaggle\/input\/stoxx50financialratios\/db.csv')\ndata['Date']=pd.to_datetime(data.Date)\n\ndata=data.dropna(axis=1,how='all')\ntickers=data.Ticker.unique().tolist()","76414334":"data=data.groupby(['Date','Ticker']).apply(lambda x:x.ffill().bfill()).set_index('Date')","e64ef2b9":"display(data)","c2cd81b1":"data.describe()","68b559cf":"msno.matrix(data.iloc[:,1:48],figsize=(30,15))","3c9d723c":"msno.heatmap(data.iloc[:,1:48],figsize=(30,15))","b3349077":"msno.bar(data.iloc[:,1:48],figsize=(30,15),color='brown')","1b8dc39e":"from sklearn.impute import KNNImputer\nfrom sklearn.preprocessing import LabelEncoder\n\ndata_=pd.DataFrame(KNNImputer().fit_transform(pd.get_dummies(data)),index=data.index)\ndata_=data_.iloc[:,:48]\ndata_.columns=data.columns[:-1]\ndata_['Ticker']=data.Ticker","041e67c7":"fig,ax=plt.subplots(2,2,figsize=(30,25))\nfor i,ticker in enumerate(tickers[:4]):#First 4 tickers\n    sns.heatmap(data_[data_.Ticker==ticker].iloc[:,:-1].corr(),ax=ax[int(i\/2)][i%2])\n    ax[int(i\/2)][i%2].set_title(ticker)\n\nfig.tight_layout()\nplt.show()","451b8685":"px=yf.download(tickers=tickers,start='2000-01-01')['Close']\\\n    .asfreq('D')\\\n    .melt(var_name='Ticker',value_name='px',ignore_index=False)","b7af23f8":"px=px.reset_index().merge(data_.reset_index(),on=['Date','Ticker'],how='left').ffill().bfill().set_index('Date')","43e1c754":"fs1={}\nfs2={}\n\nfor ticker in tickers:\n    fs1[ticker]=px[px.Ticker==ticker].corr().px.sort_values().dropna().iloc[:-1].index[-1]\n    fs2[ticker]=px[px.Ticker==ticker].corr().px.sort_values(ascending=False).dropna().index[-1]","da5a825b":"#Positive correlations\n\nfig,ax=plt.subplots(10,5,figsize=(30,40))\n\nfor i,ticker in enumerate(tickers):\n    ax[int(i\/5)][i%5].plot(px[px.Ticker==ticker].px)\n    ax_=ax[int(i\/5)][i%5].twinx()\n    ax_.plot(px[px.Ticker==ticker][fs1[ticker]],color='green')\n    ax[int(i\/5)][i%5].set_title(ticker+', '+fs1[ticker])\n    \nplt.tight_layout()\nplt.show()","26d19cad":"#Negative correlations\n\nfig,ax=plt.subplots(10,5,figsize=(30,40))\n\nfor i,ticker in enumerate(tickers):\n    ax[int(i\/5)][i%5].plot(px[px.Ticker==ticker].px)\n    ax_=ax[int(i\/5)][i%5].twinx()\n    ax_.plot(px[px.Ticker==ticker][fs2[ticker]],color='brown')\n    ax[int(i\/5)][i%5].set_title(ticker+', '+fs2[ticker])\n    \nplt.tight_layout()\nplt.show()","4d5debe4":"# Imputing with KNN Imputer","5534c05d":"# Features most positively and negatively correlated to Closing prices","7f6faf7e":"# Basic EDA","18ba7e3a":"# Checking missing values","6f4128d8":"# Correlation heatmaps"}}