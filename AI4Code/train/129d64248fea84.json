{"cell_type":{"eb4e0be2":"code","108d3f66":"code","521f40fc":"code","2873936e":"code","4ea6e2ff":"code","0c82c887":"code","ed9c718f":"code","6cf3d2c1":"code","c3a4fdd0":"code","a47daeb3":"code","9ecf73fc":"code","1fb13381":"code","7e8f0b5b":"code","f5472e83":"code","06e0e99e":"code","4308aade":"code","7d76ee6d":"code","8c0845a1":"code","094d8278":"code","ad6c93c6":"code","bb8d1144":"code","f77b01ed":"code","3e7455ae":"code","d612ea13":"code","6210ceb6":"code","ee504f12":"code","7f0e0bf2":"code","90d2549e":"code","0acc9e06":"code","8c234e83":"code","d0944955":"markdown","6790c16d":"markdown","95aa2e1c":"markdown","482f86ac":"markdown","1a049aae":"markdown","45c7a61b":"markdown","c013eb31":"markdown","fe8b1ace":"markdown","b34959d6":"markdown","dd63c6be":"markdown","b770efae":"markdown","69f40b90":"markdown","d02ace90":"markdown","c604795c":"markdown","99eb0380":"markdown","8386ac6f":"markdown","afec9b9b":"markdown","8b8af678":"markdown","a25fe73b":"markdown","9d612f6d":"markdown","efe6f9e2":"markdown","839506ad":"markdown","4e3042f1":"markdown"},"source":{"eb4e0be2":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport seaborn as sns\nfrom matplotlib import pyplot as plt\nimport plotly.offline as py\nimport plotly.graph_objs as go\nimport plotly.express as px\nimport plotly.io as pio\npy.offline.init_notebook_mode(connected=True)\n\nimport geopandas","108d3f66":"infected = pd.read_csv('\/kaggle\/input\/covid19-in-spain\/ccaa_covid19_casos_long.csv')\nuci_beds = pd.read_csv('\/kaggle\/input\/covid19-in-spain\/ccaa_camas_uci_2017.csv')\nrecovered = pd.read_csv('\/kaggle\/input\/covid19-in-spain\/ccaa_covid19_altas_long.csv')\ndeath = pd.read_csv('\/kaggle\/input\/covid19-in-spain\/ccaa_covid19_fallecidos_long.csv')\nhospitalized = pd.read_csv('\/kaggle\/input\/covid19-in-spain\/ccaa_covid19_hospitalizados_long.csv')\nmasks = pd.read_csv('\/kaggle\/input\/covid19-in-spain\/ccaa_covid19_mascarillas.csv')\nuci = pd.read_csv('\/kaggle\/input\/covid19-in-spain\/ccaa_covid19_uci_long.csv')\nnational = pd.read_csv('\/kaggle\/input\/covid19-in-spain\/nacional_covid19.csv')\nage_range = pd.read_csv('\/kaggle\/input\/covid19-in-spain\/nacional_covid19_rango_edad.csv')\ngdf = geopandas.read_file('\/kaggle\/input\/spain-geojson\/shapefiles_ccaa_espana.geojson')","521f40fc":"locations = {'Andaluc\u00eda':[37.38,-5.97],\n            'Arag\u00f3n':[41.64,-0.88],\n            'Asturias':[43.36,-5.85],\n            'Baleares':[39.57,2.65],\n            'Canarias':[28.09,-15.41],\n            'Cantabria':[43.46,-3.8],\n            'Castilla-La Mancha':[38.98,-3.92],\n            'Castilla y Le\u00f3n':[41.65,-4.77],\n            'Catalu\u00f1a':[41.39,2.17],\n            'Ceuta':[35.89,-5.34],\n            'C. Valenciana':[39.37,-0.8],\n            'Extremadura':[39.71,-6.16],\n            'Galicia':[43.12,-8.46],\n            'Madrid':[40.49,-3.71],\n            'Melilla':[35.29,-2.95],\n            'Murcia':[38.00,-1.48],\n            'Navarra':[42.66,-1.64],\n            'Pa\u00eds Vasco':[43.23,-2.85],\n            'La Rioja':[42.27,-2.51]}","2873936e":"max_date = infected['fecha'].max()","4ea6e2ff":"map_df = infected[['fecha','CCAA','total']]\nmap_df = map_df[map_df['CCAA']!= 'Total']","0c82c887":"lat = []\nlong = []\nfor ca in map_df['CCAA']:\n    lat=lat+ [locations[ca][0]]\n    long =long +[locations [ca][1]]","ed9c718f":"map_df['lat']= lat\nmap_df['long'] = long","6cf3d2c1":"map_df['size'] = map_df['total'].pow(0.3)\nfig = px.scatter_geo(\n    map_df, lat = 'lat', lon = 'long', color='total', color_continuous_scale=\"portland\",size='size',\n    animation_frame='fecha', range_color=[0, map_df['total'].max()],projection=\"mercator\",\n    center={'lat': 40, 'lon': -3})\nfig.update_layout(title = 'COVID-19 Total infected people over time')\nfig.update_layout(height=600, margin={\"r\":0,\"t\":0,\"l\":0,\"b\":0})\nfig.layout.geo.projection = go.layout.geo.Projection(scale=7.)\nfig.show()","c3a4fdd0":"def dateplot(x, y, **kwargs):\n    ax = plt.gca()\n    data = kwargs.pop(\"data\")\n    data.plot(x=x, y=y, ax=ax, grid=False, **kwargs)","a47daeb3":"infected['fecha'] = pd.to_datetime(infected['fecha'])\nhospitalized['fecha'] = pd.to_datetime(hospitalized['fecha'])\nuci['fecha'] = pd.to_datetime(uci['fecha'])\nrecovered['fecha'] = pd.to_datetime(recovered['fecha'])\ndeath['fecha'] = pd.to_datetime(death['fecha'])","9ecf73fc":"infected = infected[infected['CCAA']!= 'Total']\ng = sns.FacetGrid(infected, col=\"CCAA\", col_wrap=5, height=3.5)\ng = g.map_dataframe(dateplot, \"fecha\", \"total\").set(yscale='log')\ng = g.map(plt.fill_between, 'fecha', 'total', alpha=0.2).set_titles(\"{col_name} CCAA\")\ng = g.set_titles(\"{col_name}\")\nplt.subplots_adjust(top=0.92)\ng = g.fig.suptitle('Evolution of total infected in CCAA (log scale)')","1fb13381":"uci = uci[uci['CCAA']!= 'Total']\ng = sns.FacetGrid(uci, col=\"CCAA\", col_wrap=5, height=3.5)\ng = g.map_dataframe(dateplot, \"fecha\", \"total\").set(yscale='log')\ng = g.map(plt.fill_between, 'fecha', 'total', alpha=0.2).set_titles(\"{col_name} CCAA\")\ng = g.set_titles(\"{col_name}\")\nplt.subplots_adjust(top=0.92)\ng = g.fig.suptitle('Evolution of total UCI patients in CCAA (log scale)')","7e8f0b5b":"hospitalized = hospitalized[hospitalized['CCAA']!= 'Total']\ng = sns.FacetGrid(hospitalized, col=\"CCAA\", col_wrap=5, height=3.5)\ng = g.map_dataframe(dateplot, \"fecha\", \"total\").set(yscale='log')\ng = g.map(plt.fill_between, 'fecha', 'total', alpha=0.2).set_titles(\"{col_name} CCAA\")\ng = g.set_titles(\"{col_name}\")\nplt.subplots_adjust(top=0.92)\ng = g.fig.suptitle('Evolution of total hospitalized in CCAA (Log Scale) ')","f5472e83":"recovered = recovered[recovered['CCAA']!= 'Total']\ng = sns.FacetGrid(recovered, col=\"CCAA\", col_wrap=5, height=3.5)\ng = g.map_dataframe(dateplot, \"fecha\", \"total\").set(yscale='log')\ng = g.map(plt.fill_between, 'fecha', 'total', alpha=0.2).set_titles(\"{col_name} CCAA\")\ng = g.set_titles(\"{col_name}\")\nplt.subplots_adjust(top=0.92)\ng = g.fig.suptitle('Evolution of total recovered in CCAA (Log Scale)')","06e0e99e":"death = death[death['CCAA']!= 'Total']\ng = sns.FacetGrid(death, col=\"CCAA\", col_wrap=5, height=3.5)\ng = g.map_dataframe(dateplot, \"fecha\", \"total\").set(yscale='log')\ng = g.map(plt.fill_between, 'fecha', 'total', alpha=0.2).set_titles(\"{col_name} CCAA\")\ng = g.set_titles(\"{col_name}\")\nplt.subplots_adjust(top=0.92)\ng = g.fig.suptitle('Evolution of total deaths in CCAA (log scale)')","4308aade":"infected_last = infected[infected['fecha']== max_date]\nrecovered_last = recovered[recovered['fecha']== max_date]\nhospitalized_last = hospitalized[hospitalized['fecha']== max_date]\ndeath_last = death[death['fecha']== max_date]\nuci_last = uci[uci['fecha']== max_date]","7d76ee6d":"df_an = pd.DataFrame(data ={'Infected': infected_last['total'].values,\n                            'Hospitalized':hospitalized_last['total'].values,\n                            'UCI':uci_last['total'].values,\n                            'Recovered': recovered_last['total'].values,\n                            'Death':death_last['total'].values},\n                             index = infected_last['CCAA'])","8c0845a1":"df_total = df_an[df_an.index=='Total'] \ndf_an= df_an[df_an.index!='Total']","094d8278":"d = pd.to_datetime(str(max_date)).strftime('%Y-%m-%d')\ntitle = 'COVID-2019'\nchart_title = title + ' as of ' + d\nccaa = df_an.index.to_list()\nprint('Number of CCAA with confirmed cases = ',len(ccaa))\n\n# Looks lot have hit a limit of Sunburst chart\nmax_ccaa = df_an.index.unique()\nids = ccaa\nlabels = ccaa\nparents = [title] * len(ccaa)\nvalues = df_an['Infected'].to_list()\n\nclassifications = df_an.columns.drop('Infected').values\n\nfor cty in ccaa: \n    for c in classifications:\n        ids = ids + [cty + '-' + c]\n        parents = parents + [cty]\n        labels = labels + [c]\n        values = values + [df_an.loc[cty][c]]\n\ntrace = go.Sunburst(\n    ids=ids,\n    labels=labels,\n    parents=parents,\n    values=values,\n    outsidetextfont={\"size\": 20, \"color\": \"#377eb8\"},\n#     leaf={\"opacity\": 0.4},\n    marker={\"line\": {\"width\": 2}}\n)\n\nlayout = go.Layout(\n    title = chart_title + \"<br>(click on CCAA)\",\n    margin = go.layout.Margin(t=100, l=0, r=0, b=0),\n    sunburstcolorway=[\"#636efa\",\"#ef553b\",\"#00cc96\"]\n)\n\nfig = go.Figure([trace], layout)\n\npy.iplot(fig)","ad6c93c6":"age_range= age_range[age_range['rango_edad']!='Total']\nage_range= age_range[age_range['rango_edad']!='80 y +']\nno_gender = age_range[age_range['sexo']=='ambos']","bb8d1144":"g = sns.catplot(x=\"rango_edad\", y=\"casos_confirmados\", hue=\"sexo\", data=no_gender, kind=\"bar\", height=5,aspect=3,palette=\"muted\")\ng.despine(left=True)\ng.set_ylabels(\"Total infected\")","f77b01ed":"last = age_range[age_range.iloc[:,0]== age_range.iloc[:,0].max()]","3e7455ae":"for i in range(last['ingresos_uci'].shape[0]):\n    if last.iloc[i,5] == 'i':\n        last.iloc[i,5] = 0\n        \nlast['ingresos_uci']= last['ingresos_uci'].astype(int)","d612ea13":"last['casos_confirmados'] = last['casos_confirmados'] \/ np.linalg.norm(last['casos_confirmados'])\nlast['hospitalizados'] = last['hospitalizados'] \/ np.linalg.norm(last['hospitalizados'])\nlast['ingresos_uci'] = last['ingresos_uci'] \/ np.linalg.norm(last['ingresos_uci'])\nlast['fallecidos'] = last['fallecidos'] \/ np.linalg.norm(last['fallecidos'])","6210ceb6":"last_ambos = last[last['sexo']=='ambos']\nlast_gender = last[last['sexo']!='ambos']","ee504f12":"plt.figure(figsize=(15,5))\nplt.plot(last_ambos['rango_edad'], last_ambos['casos_confirmados'],color = 'green',label='Total infected')\nplt.plot(last_ambos['rango_edad'], last_ambos['hospitalizados'],color = 'red',label='Hospitalized')\nplt.plot( last_ambos['rango_edad'], last_ambos['ingresos_uci'],color = 'yellow',label='UCI')\nplt.plot( last_ambos['rango_edad'], last_ambos['fallecidos'],color = 'black',label='Death')\nplt.title('COVID-19 vs age groups')\nplt.legend()","7f0e0bf2":"plt.figure(figsize= (10,5))\nsns.relplot(x='rango_edad',y ='casos_confirmados', hue = 'sexo',kind='line',data = last_gender,height=5,aspect=4)\nplt.title('Comparison between men and women: Total infections')","90d2549e":"plt.figure(figsize= (10,5))\nsns.relplot(x='rango_edad',y ='hospitalizados', hue = 'sexo',kind='line',data = last_gender,height=5,aspect=4)\nplt.title('Comparison between men and women: Hospitalized')","0acc9e06":"plt.figure(figsize= (10,5))\nsns.relplot(x='rango_edad',y ='ingresos_uci', hue = 'sexo',kind='line',data = last_gender,height=5,aspect=4)\nplt.title('Comparison between men and women: UCI')","8c234e83":"plt.figure(figsize= (10,5))\nsns.relplot(x='rango_edad',y ='fallecidos', hue = 'sexo',kind='line',data = last_gender,height=5,aspect=4)\nplt.title('Comparison between men and women: Death')","d0944955":"The results are as expected. virus affects mostly older people. We can see that the death\u00b4s curve peak is around 80-89yo.\nThe most surprising result is the \"Total infected\" line as the 'peak' goes from 40 to 80 years whick means the disease is present in most of the population.\n","6790c16d":"# COVID-19 Situation in Spain\nI will zoom into Spain in this kernel to visualize how COVID-19 spread in each CCAA.\n\n**Please upvote both kernel and dataset** if you find it useful!\n","95aa2e1c":"As we can see, in general the virus is more dangerous in men than woman altough the total infected people is higher in woman util 60yo.\nThis can be easily explained with the previous chart as the age ranges in which women are more infected than men are the less dangerous ages.\nOne the other hand, the are more men than woman infected in the dangerous ages (+60yo) ","482f86ac":"### Hospitalized over time","1a049aae":"# Last Report Situation","45c7a61b":"In order to compare between different categories, we should normalize the data:","c013eb31":"Coordinates for mapping each CCAA","fe8b1ace":"### Infected over time","b34959d6":"# General analysis over time","dd63c6be":"## Libraries","b770efae":"In case dataframe format is wrong:","69f40b90":"### UCI over time","d02ace90":"---\nTo be continued...","c604795c":"### Preparing the DataFrame","99eb0380":"### COVID-19 vs Gender","8386ac6f":"## Recovered over time","afec9b9b":"We will see how the virus evolved over time in each CCAA:","8b8af678":"As the following variables follow an exponential line,the following plots will be displayed using logarithmic scale in order to analyze the lineal trend.","a25fe73b":"### COVID-19 vs age groups","9d612f6d":"## Data Load","efe6f9e2":"As a first aproach, I will compare the effects of COVID-19 in each age group without taking into account gender.","839506ad":"# Patients analysis","4e3042f1":"## Deaths over time"}}