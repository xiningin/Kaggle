{"cell_type":{"7a5a45d7":"code","99443f65":"code","0b458ff8":"code","9783c5e3":"code","36f9162b":"code","25b51166":"code","e7de3cf0":"code","a404712b":"code","ef824946":"code","9b8e609e":"code","af1171c4":"code","15687f26":"code","9f8b568a":"code","2649673a":"code","c77b3c3c":"code","3e516bdc":"code","8817f07b":"code","05e974eb":"code","8c417563":"code","8b9968aa":"code","cf0146d3":"code","f6a8ddb2":"code","36ce7a60":"code","d4164219":"code","77da1d36":"code","0f28f781":"code","dfe32765":"markdown","4514f23a":"markdown","e5d3af56":"markdown","4a65fa58":"markdown","8e4e0fe2":"markdown","72390d91":"markdown"},"source":{"7a5a45d7":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n%matplotlib inline\nimport matplotlib.pyplot as plt\nimport seaborn as sns\ncolor = sns.color_palette()\nimport os\nfrom skimage import exposure\nimport pydicom\nimport glob\nfrom pydicom.data import get_testdata_files","99443f65":"train = pd.read_csv(\"..\/input\/rsna-intracranial-hemorrhage-detection\/stage_1_train.csv\")\nsample_sub = pd.read_csv(\"..\/input\/rsna-intracranial-hemorrhage-detection\/stage_1_sample_submission.csv\")","0b458ff8":"train_path = (\"\/kaggle\/input\/rsna-intracranial-hemorrhage-detection\/stage_1_train_images\")\ntest_path = (\"\/kaggle\/input\/rsna-intracranial-hemorrhage-detection\/stage_1_test_images\")","9783c5e3":"print(\"Train shape : {}\".format(train.shape))\nprint(\"Test shape : {}\".format(sample_sub.shape))","36f9162b":"train['ImageID'] = train['ID'].apply(lambda x: 'ID_' + x.split('_')[1] + '.dcm')\ntrain['type'] = train['ID'].apply(lambda x: x.split('_')[2])\nsample_sub ['ImageID'] =sample_sub['ID'].apply(lambda x: 'ID_' + x.split('_')[1] + '.dcm')\nsample_sub['type'] = sample_sub['ID'].apply(lambda x: x.split('_')[2])","25b51166":"print('There are {} images in the train data set'.format(len(train.ImageID.unique())))\nprint('There are {} images in the test data set'.format(len(sample_sub.ImageID.unique())))","e7de3cf0":"train.type.unique().tolist()","a404712b":"value_dict = train.Label.value_counts().to_dict()\nprint(train.Label.value_counts())","ef824946":"fig, ax = plt.subplots()\nsns.barplot(x=list(value_dict.keys()), y=list(value_dict.values()), ax=ax)\nax.set_title(\"the number of labels\")\nax.set_xlabel(\"class\")\nprint('{:.1f} % of images have at least one type of Hemorrhage.'.format((value_dict[1]\/value_dict[0])*100))","9b8e609e":"type_dict = train[train['Label'] == 1].type.value_counts().to_dict()\nprint(train[train['Label'] == 1].type.value_counts())","af1171c4":"fig, ax = plt.subplots(figsize = (10, 6))\nsns.barplot(x=list(type_dict.keys()), y=list(type_dict.values()), ax=ax)\nax.set_title(\"the number of different type of Hemorrhage\")\nax.set_xlabel(\"type\")\ntype_dict","15687f26":"images1_count = train[(train['Label'] == 1) & (train['type'] != 'any')].pivot_table(values = 'Label', index = ['ImageID'], aggfunc = 'sum').Label.value_counts().to_dict()\n# exclude the type \"any\"\nfig, ax = plt.subplots(figsize = (10, 6))\nsns.barplot(x=list(images1_count.keys()), y=list(images1_count.values()), ax=ax)\nax.set_title(\"the number of images with different different class of Hemorrhage\")\nax.set_xlabel(\"number of Hemorrhage\")\nfor index,count in images1_count.items():\n    print('There are {} images have {} Hemorrhage'.format(count, index))","9f8b568a":"filename = pydicom.read_file(os.path.join(train_path, \"ID_000039fa0.dcm\"))","2649673a":"filename","c77b3c3c":"info_dict = {'SOP Instance UID': (0x08, 0x18), \n             'Modality' : (0x08, 0x60),\n             'Patient ID' : (0x10, 0x20),\n             'Study Instance UID' : (0x20, 0x0d),\n             'Series Instance UID' : (0x20, 0x0e),\n             'Study ID' : (0x20, 0x10),\n             'Image Position (Patient)' : (0x20, 0x32),\n             'Image Orientation (Patient)' : (0x20, 0x37),\n             'Samples per Pixel' : (0x28, 0x02),\n             'Photometric Interpretation': (0x28, 0x04),\n             'Rows': (0x28, 0x10),\n             'Columns': (0x28, 0x11),\n             'Pixel Spacing': (0x28, 0x30),\n             'Bits Allocated' : (0x28, 0x100),\n             'Bits Stored' : (0x28, 0x101),\n             'High Bit' : (0x28, 0x102),\n             'Pixel Representation' : (0x28, 0x103),\n             'Window Center' : (0x28, 0x1050),\n             'Window Width' : (0x28, 0x1051),\n             'Rescale Intercept' : (0x28, 0x1052),\n             'Rescale Slope' : (0x28, 0x1053)}","3e516bdc":"pivot = train[train['type'] != 'any'].pivot_table(values = 'Label', index = ['ImageID'], aggfunc = 'sum').reset_index()","8817f07b":"fig = plt.figure(figsize=(24, 16))\nfor j in range(4):\n    for i, image in enumerate(pivot[pivot.Label == 1].iloc[j*4:(j+1)*4,].ImageID.tolist()):\n        ax = fig.add_subplot(4, 4, j * 4 + i + 1, xticks=[], yticks=[])\n        img = np.array(pydicom.read_file(os.path.join(train_path, image)).pixel_array)\n        img = exposure.equalize_hist(img)\n        plt.imshow(img, cmap = plt.cm.bone)\n        ax.set_title('One Hemorrhage ' + image)","05e974eb":"fig = plt.figure(figsize=(24, 16))\nfor j in range(4):\n    for i, image in enumerate(pivot[pivot.Label == 2].iloc[j*4:(j+1)*4,].ImageID.tolist()):\n        ax = fig.add_subplot(4, 4, j * 4 + i + 1, xticks=[], yticks=[])\n        img = np.array(pydicom.read_file(os.path.join(train_path, image)).pixel_array)\n        img = exposure.equalize_hist(img)\n        plt.imshow(img, cmap = plt.cm.bone)\n        ax.set_title('Two Hemorrhage ' + image)","8c417563":"fig = plt.figure(figsize=(24, 16))\nfor j in range(4):\n    for i, image in enumerate(pivot[pivot.Label == 3].iloc[j*4:(j+1)*4,].ImageID.tolist()):\n        ax = fig.add_subplot(4, 4, j * 4 + i + 1, xticks=[], yticks=[])\n        img = np.array(pydicom.read_file(os.path.join(train_path, image)).pixel_array)\n        img = exposure.equalize_hist(img)\n        plt.imshow(img, cmap = plt.cm.bone)\n        ax.set_title('Three Hemorrhage ' + image)","8b9968aa":"fig = plt.figure(figsize=(24, 16))\nfor j in range(4):\n    for i, image in enumerate(pivot[pivot.Label == 4].iloc[j*4:(j+1)*4,].ImageID.tolist()):\n        ax = fig.add_subplot(4, 4, j * 4 + i + 1, xticks=[], yticks=[])\n        img = np.array(pydicom.read_file(os.path.join(train_path, image)).pixel_array)\n        img = exposure.equalize_hist(img)\n        plt.imshow(img, cmap = plt.cm.bone)\n        ax.set_title('Four Hemorrhage ' + image)","cf0146d3":"fig = plt.figure(figsize=(24, 16))\nfor j in range(4):\n    for i, image in enumerate(pivot[pivot.Label == 5].iloc[j*4:(j+1)*4,].ImageID.tolist()):\n        ax = fig.add_subplot(4, 4, j * 4 + i + 1, xticks=[], yticks=[])\n        img = np.array(pydicom.read_file(os.path.join(train_path, image)).pixel_array)\n        img = exposure.equalize_hist(img)\n        plt.imshow(img, cmap = plt.cm.bone)\n        ax.set_title('Five Hemorrhage ' + image)","f6a8ddb2":"def get_info(data, prefix) : \n    for keys, values in info_dict.items():\n        data[keys] = data['ImageID'].apply(lambda x: (pydicom.read_file(os.path.join(prefix, x))[values].value))\n    return data","36ce7a60":"train = get_info(train, train_path)\nsample_sub = get_info(sample_sub, test_path)","d4164219":"train.head()","77da1d36":"train.to_pickle('train_info.pkl')\nsample_sub.to_pickle('test_info.pkl')","0f28f781":"# means = train.groupby('type').mean()\n# sample_sub.loc[sample_sub['type'] == 'epidural', 'Label'] = means.Label[1]\n# sample_sub.loc[sample_sub['type'] == 'intraparenchymal', 'Label'] = means.Label[2]\n# sample_sub.loc[sample_sub['type'] == 'intraventricular', 'Label'] = means.Label[3]\n# sample_sub.loc[sample_sub['type'] == 'subarachnoid', 'Label'] = means.Label[4]\n# sample_sub.loc[sample_sub['type'] == 'subdural', 'Label'] = means.Label[5]\n# sample_sub.loc[sample_sub['type'] == 'any', 'Label'] = means.Label[0]\n# sample_sub[['ID', 'Label']].to_csv('submission.csv', index=False)","dfe32765":"### DICOM Images\nAll provided images are in DICOM format. DICOM images contain associated metadata. This will include PatientID, StudyInstanceUID, SeriesInstanceUID, and other features. You will notice some PatientIDs represented in both the stage 1 train and test sets. This is known and intentional. However, there will be no crossover of PatientIDs into stage 2 test. Additionally, per the rules, \"Submission predictions must be based entirely on the pixel data in the provided datasets.\" Therefore, you should not expect to use or gain advantage by use of this crossover in stage 1.","4514f23a":"# Detect Hemorrhage Visualization","e5d3af56":"# Extract the information in DICOM image","4a65fa58":"So we need to predict the probabilty of each type of Hemorrhage is present in every picture.\n\nLet's see the distribution of label first","8e4e0fe2":"Let's visualize pictures with different numbers of Hemorrhage","72390d91":"# Now Let's look at the pictures"}}