{"cell_type":{"72fde611":"code","c0e7cfb4":"code","70604275":"code","fb8620f0":"code","657e0f82":"code","67127f2c":"code","58647b22":"code","f6732081":"code","aedbe4f2":"code","42269a30":"code","9806b528":"code","b04eb930":"code","af9d3ef8":"markdown","e3f913a4":"markdown","4230949a":"markdown","8d0d211d":"markdown","ea471b75":"markdown","403af33e":"markdown"},"source":{"72fde611":"\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport glob\nimport json\nimport re\nimport scipy as sc\nimport warnings\n\nimport matplotlib.pyplot as plt\nimport os\n\n","c0e7cfb4":"root_path = '\/kaggle\/input\/CORD-19-research-challenge\/'\nmetadata_path = f'{root_path}\/metadata.csv'\nmeta_df = pd.read_csv(metadata_path, dtype={\n    'pubmed_id': str,\n    'Microsoft Academic Paper ID': str, \n    'doi': str\n})\nmeta_df.head()\nmeta_df.info()","70604275":"meta_df.head()\n","fb8620f0":"df=pd.read_csv('..\/input\/covid19prepareddata\/Prepared_data.csv')\ndf.head()\ndf.info()","657e0f82":"task1=\"\"\"Specifically, we want to know what the literature reports about:\n\nHypertension\nDiabetes\nMale gender\nHeart Disease\nCOPD\nSmoking Status\nAge\nAsthma\nAutoimmune disorders\nCerebrovascular disease\nCardio- and cerebrovascular disease\nCancer\nRespiratory system diseases\nChronic kidney disease\nChronic respiratory diseases\nChronic digestive disorders\nDrinking\nDementia\nEndocrine diseases\nEthnicity_ Hispanic vs. non-Hispanic\nHeart Failure\nImmune system disorders\nNeurological disorders\nOverweight or obese\nRace_ Asian vs. White\nRace_ Black vs. White\nRace_ Other vs. White\nChronic liver disease\"\"\"","67127f2c":"task=[task1]\nquery=[]\nfor i in range(len(task)):\n    task[i]=task[i].split(\"\\n\")\n    query.append(task[i][2:])\nprint(query)","58647b22":"!pip install -U sentence-transformers","f6732081":"from sklearn.metrics.pairwise import cosine_similarity\nfrom sentence_transformers import SentenceTransformer\n\nwarnings.filterwarnings(\"ignore\")\nmodel = SentenceTransformer('bert-base-nli-mean-tokens')\n    ","aedbe4f2":"query_embeddings=[]\nfor i in range(len(query)):\n    query_embeddings.append(model.encode(query[i]))","42269a30":"df.reset_index(drop = True, inplace = True)\ndf['abstract_summary']\nabstract_summary_embeddings = model.encode(df['abstract_summary'])\n","9806b528":"def getfile_insensitive(path):\n    directory, filename = os.path.split(path)\n    directory, filename = (directory or '.'), filename.lower()\n    for f in os.listdir(directory):\n        newpath = os.path.join(directory, f)\n        if os.path.isfile(newpath) and f.lower() == filename:\n            return newpath\n\ndef isfile_insensitive(path):\n    return getfile_insensitive(path) is not None\n\nsample_document='8_risk_factors'\n","b04eb930":"scores=[]\ndef formatting(_topdf):\n    _topdf.rename(columns={'journal':'Journal'},inplace=True)\n    _topdf.rename(columns={'url':'Study Link'},inplace=True)\n    _topdf.rename(columns={'publish_time':'Date'},inplace=True)\n    _topdf.rename(columns={'title':'Study'},inplace=True)\n    \n    return _topdf\nfor tsk in range(len(task)):\n    \n    for prob, query_embedding in zip(query[tsk], query_embeddings[tsk]):\n        dis = sc.spatial.distance.cdist([query_embedding], abstract_summary_embeddings, \"cosine\")[0]\n        #print(dis)\n        results = zip(range(len(dis)), dis)\n        results = sorted(results, key=lambda x: x[1])\n        #print(\"Query:\", prob)\n        #print(\"Answer:\" )\n        scores.append(1-results[0][1])\n        #print(df['abstract'][results[0][0]].strip(), \"\\n(Score: %.4f)\" % (1-results[0][1]),\"\\n\")\n        k=50\n        #print(results[:k])\n        topk=results[:k]\n        id,id_v=zip(*topk)\n        topData=df.iloc[1]\n        _topdf = df.iloc[list(id), :]\n        _topdf = formatting(_topdf)\n        csv_str=prob.replace('?','_')+'.csv'\n        #print(csv_str)\n        path1 = f'{root_path}Kaggle\/target_tables\/{sample_document}\/'+csv_str\n        path1 = f'{path1}'\n        print(path1)\n        if (isfile_insensitive(path1)):\n            path1=getfile_insensitive(path1)\n            q_df = pd.read_csv(path1)\n            print(\"exist!\")\n        else:      \n            path1 = f'{root_path}Kaggle\/target_tables\/{sample_document}\/'\n            path1 = os.path.join(path1,os.listdir(path1)[-1])\n            q_df = pd.read_csv(path1)\n            q_df.drop(q_df.index,inplace=True)\n        #print(path1)\n        q_df.head()\n        q_df\n        #print(len(q_df))\n        #print(len(_topdf))\n        #print(q_df.columns)\n        res_df = pd.merge(q_df, _topdf, how='outer', on=['Study','Study Link','Date','Journal'])[q_df.columns[1:]]\n        #print(len(res_df))\n        res_df.info()\n        res_csv=r'\/kaggle\/output\/'+ csv_str\n        print(res_csv)\n        res_df.to_csv( csv_str, index = True)","af9d3ef8":"Specifically, we want to know what the literature reports about:\n\n- Hypertension\n- Diabetes\n- Male gender\n- Heart Disease\n- COPD\n- Smoking Status\n- Age\n- Asthma\n- Autoimmune disorders\n- Cerebrovascular disease\n- Cardio- and cerebrovascular disease\n- Cancer\n- Respiratory system diseases\n- Chronic kidney disease\n- Chronic respiratory diseases\n- Chronic digestive disorders\n- Drinking\n- Dementia\n- Endocrine diseases\n- Ethnicity_ Hispanic vs. non-Hispanic\n- Heart Failure\n- Immune system disorders\n- Neurological disorders\n- Overweight or obese\n- Race_ Asian vs. White\n- Race_ Black vs. White\n- Race_ Other vs. White\n- Chronic liver disease","e3f913a4":"# Check the keywords of the problems.","4230949a":"# This is a notebook that address risk factors related to COVID-19.","8d0d211d":"# Get data from Prepared data. This data is created in another notebook in kaggle I made.\n\nCite:\nhttps:\/\/www.kaggle.com\/nike0good\/population-studies-that-related-to-covid-19","ea471b75":"@inproceedings{Population studies that related to COVID-19, author = {Hang, Wu}, title = {Population studies that related to COVID-19}, year = {2020}, month = {June}, url = {\\url{https:\/\/www.kaggle.com\/nike0good\/population-studies-that-related-to-covid-19} } }","403af33e":"# Prepare data"}}