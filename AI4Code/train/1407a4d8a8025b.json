{"cell_type":{"89ed92f0":"code","bfb64262":"code","9f4dc885":"code","003b7e33":"code","cd82a48e":"code","5f0b5ccb":"code","21668f90":"code","e8ab9b8b":"code","28f2204d":"code","4c97e4f3":"code","14449204":"code","797f42de":"code","dd95e070":"code","e9a9f73a":"code","0b936f55":"code","bda1fe36":"code","18ccdcac":"code","a0189232":"code","2c38c8b4":"code","00c3619a":"code","af42dc1e":"code","8219f53a":"code","56c06927":"code","00bb1e67":"code","d871b4cc":"markdown","1e587790":"markdown","95c1b44f":"markdown","c92c13b4":"markdown","0e7e693d":"markdown","840592e4":"markdown","564914c8":"markdown","95994b5f":"markdown","c1f9abe2":"markdown","b33c71f3":"markdown","577d4d3a":"markdown","b3f43596":"markdown","cdbf703c":"markdown","0f78a9db":"markdown"},"source":{"89ed92f0":"%reload_ext autoreload\n%autoreload 2\n%matplotlib inline","bfb64262":"from fastai.vision import *","9f4dc885":"URLs.BIWI_SAMPLE # \u8fd9\u4e2a\u8bad\u7ec3\u901f\u5ea6\u4f1a\u66f4\u5feb\uff0c\u56e0\u4e3a\u6570\u636e\u96c6\u66f4\u5c0f\npath = untar_data(URLs.BIWI_SAMPLE); path","003b7e33":"URLs.BIWI_HEAD_POSE","cd82a48e":"path = untar_data(URLs.BIWI_HEAD_POSE); path","5f0b5ccb":"cal = np.genfromtxt(path\/'01'\/'rgb.cal', skip_footer=6); cal","21668f90":"fname = '09\/frame_00667_rgb.jpg'","e8ab9b8b":"def img2txt_name(f): return path\/f'{str(f)[:-7]}pose.txt'","28f2204d":"img = open_image(path\/fname)\nimg.show()","4c97e4f3":"ctr = np.genfromtxt(img2txt_name(fname), skip_header=3); ctr","14449204":"def convert_biwi(coords):\n    c1 = coords[0] * cal[0][0]\/coords[2] + cal[0][2]\n    c2 = coords[1] * cal[1][1]\/coords[2] + cal[1][2]\n    return tensor([c2,c1])\n\ndef get_ctr(f):\n    ctr = np.genfromtxt(img2txt_name(f), skip_header=3)\n    return convert_biwi(ctr)\n\ndef get_ip(img,pts): return ImagePoints(FlowField(img.size, pts), scale=True)","797f42de":"get_ctr(fname)","dd95e070":"ctr = get_ctr(fname)\nimg.show(y=get_ip(img, ctr), figsize=(6, 6))","e9a9f73a":"data = (PointsItemList.from_folder(path)\n        .split_by_valid_func(lambda o: o.parent.name=='13')\n        .label_from_func(get_ctr)\n        .transform(get_transforms(), tfm_y=True, size=(120,160))\n        .databunch(num_workers=0).normalize(imagenet_stats)\n       )","0b936f55":"data.show_batch(3, figsize=(9,6))","bda1fe36":"learn = create_cnn(data, models.resnet34, model_dir='\/kaggle\/working')","18ccdcac":"learn.lr_find()\nlearn.recorder.plot()","a0189232":"lr = 2e-2","2c38c8b4":"learn.fit_one_cycle(1, slice(lr)) # \u5b9e\u9a8c\u65f6\uff0c\u53ef\u5c1d\u8bd5\u5176\u4ed6\u6570\u503c \u5982 epochs = 5","00c3619a":"learn.save('stage-1')","af42dc1e":"learn.load('stage-1');","8219f53a":"learn.show_results()","56c06927":"tfms = get_transforms(max_rotate=20, max_zoom=1.5, max_lighting=0.5, max_warp=0.4, p_affine=1., p_lighting=1.)\n\ndata = (PointsItemList.from_folder(path)\n        .split_by_valid_func(lambda o: o.parent.name=='13')\n        .label_from_func(get_ctr)\n        .transform(get_transforms(), tfm_y=True, size=(120,160))\n        .databunch(num_workers=0).normalize(imagenet_stats)\n       )","00bb1e67":"def _plot(i,j,ax):\n    x,y = data.train_ds[0]\n    x.show(ax, y=y)\n\nplot_multi(_plot, 3, 3, figsize=(8,6))","d871b4cc":"## <span id=\"3\"><\/span> \u4e0b\u8f7d\u548c\u8f6c\u5316\u6570\u636e","1e587790":"## <span id=\"5\"><\/span> \u8bad\u7ec3\u6a21\u578b","95c1b44f":"[\u8fd4\u56de](#0)","c92c13b4":"## <span id=\"2\"><\/span> \u5c1d\u8bd5\u5c0f\u6570\u636e","0e7e693d":"[\u8fd4\u56de](#0)","840592e4":"<hr\/>\n# <span id=\"0\"><\/span> **\u56fe\u7247\u56de\u5f52\u95ee\u9898\u4e0eBIWI\u5934\u90e8\u4f4d\u7f6e\u6570\u636e\u96c6**\n\n\u672ckernel\u662f[**fastai 2019 \u82f1\u6587EN\u7248**](https:\/\/forums.fast.ai\/t\/platform-kaggle-kernels\/32569)\u955c\u50cf\u7ffb\u8bd1     \n[**\u672ckernel\u670d\u52a1\u4e8e fast.ai v3 2019\u8bfe\u7a0b\u4e2d\u6587\u7b14\u8bb0**](https:\/\/forums.fast.ai\/t\/fast-ai-v3-2019\/39325)      \n[**\u83b7\u53d6\u66f4\u591a\u8bfe\u7a0bNotebooks\u7684\u4e2d\u6587\u7248**](https:\/\/forums.fast.ai\/t\/fast-ai-v3-2019-notebook-kaggle-kernel\/39722)      \n<hr\/>\n\n1. [\u6570\u636e\u4ecb\u7ecd](#1)\n1. [\u5c1d\u8bd5\u5c0f\u6570\u636e](#2)\n1. [\u4e0b\u8f7d\u548c\u8f6c\u5316\u6570\u636e](#3)\n1. [\u5206\u6b65\u521b\u5efa`DataBunch`](#4)\n1. [\u8bad\u7ec3\u6a21\u578b](#5)\n1. [\u6570\u636e\uff08\u56fe\u7247\uff09\u589e\u5f3a](#6)\n","564914c8":"[\u8fd4\u56de](#0)","95994b5f":"[\u8fd4\u56de](#0)","c1f9abe2":"## <span id=\"4\"><\/span> \u5206\u6b65\u521b\u5efa`DataBunch`","b33c71f3":"\u8fd9\u4e2a\u66f4\u9ad8\u9636\u7684\u4f8b\u5b50\u5c06\u5c55\u793a\u5982\u4f55\u5b9a\u5236\u6570\u636e\u96c6\u4ee5\u53ca\u89e3\u51b3\u56fe\u7247\u56de\u5f52\u95ee\u9898\u3002\u6211\u4eec\u7684\u4efb\u52a1\u662f\u5b9a\u4f4d\u56fe\u7247\u4e2d\u4eba\u4f53\u5934\u90e8\u4e2d\u5fc3\u3002\u6570\u636e\u96c6\u8be6\u60c5\u89c1 [BIWI head pose dataset](https:\/\/data.vision.ee.ethz.ch\/cvl\/gfanelli\/head_pose\/head_forest.html#db), \u611f\u8c22 Gabriele Fanelli et al\u7684\u8d21\u732e\u5206\u4eab\u3002\u6211\u4eec\u5c06\u56fe\u7247\u8f6c\u5316\u6210jpeg\u683c\u5f0f\uff0c\u65b9\u4fbf\u6211\u4eec\u7528`untar_data`[\u4e0b\u8f7d](https:\/\/s3.amazonaws.com\/fast-ai-imagelocal\/biwi_head_pose.tgz).","577d4d3a":"## <span id=\"1\"><\/span> \u6570\u636e\u4ecb\u7ecd","b3f43596":"[\u8fd4\u56de](#0)","cdbf703c":"## <span id=\"6\"><\/span> \u6570\u636e\uff08\u56fe\u7247\uff09\u589e\u5f3a\n\u5c1d\u8bd5\u5404\u79cd\u9488\u5bf9\u56fe\u7247\u7684\u53d8\u5f62(transformation)","0f78a9db":"\u5982\u4f55\u4f7f\u7528\u5c0f\u6570\u636e\u96c6\uff0c\u89c1[tutorial regression](https:\/\/www.kaggle.com\/danielliao\/fastai-tutorial-3-a-regression-problem)"}}