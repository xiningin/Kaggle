{"cell_type":{"1763ece4":"code","8673a26e":"code","ed3db867":"code","5f802273":"code","2d8397ae":"code","152e227b":"code","8a8ce7b1":"code","5f9c51dc":"code","bf5f3bfa":"code","5bdb0ac3":"code","f0cd915c":"markdown","7e6b4d6f":"markdown","42cbcc93":"markdown","140a7979":"markdown","460e2f41":"markdown","c595e31b":"markdown","dff844d6":"markdown","f1f7ff4e":"markdown","49f2f978":"markdown","39e77b1e":"markdown","cf62ebe3":"markdown"},"source":{"1763ece4":"import pandas as pd\nimport numpy as np\nfrom sklearn.metrics import mean_squared_error","8673a26e":"train_data = pd.read_csv('..\/input\/tmdb-box-office-prediction\/train.csv')\nrevenue_data = pd.read_csv('..\/input\/imdb-revenue-dataset\/train_revenue.csv')\ntrain_data = pd.merge(train_data, revenue_data, how='left', on=['imdb_id'])","ed3db867":"zero_usa_revenue_percent = len(train_data[train_data.usa_revenue==0])\/len(train_data)*100\nzero_world_revenue_percent = len(train_data[train_data.world_revenue==0])\/len(train_data)*100\nprint(\"{0:.2f} percent films hasn't USA revenue information\".format(zero_usa_revenue_percent))\nprint(\"{0:.2f} percent films hasn't World revenue information\".format(zero_world_revenue_percent))\n","5f802273":"train_data = train_data[(train_data.usa_revenue > 0) & (train_data.world_revenue > 0)]\nprint(\"full revenue information films count: {}\".format(len(train_data)))","2d8397ae":"train_data['is_usa_revenue'] = abs(train_data.revenue - train_data.usa_revenue) < train_data[['revenue', 'usa_revenue']].max(axis=1)*0.05\ntrain_data['is_ww_revenue'] = abs(train_data.revenue - train_data.world_revenue) < train_data[['revenue', 'world_revenue']].max(axis=1)*0.05","152e227b":"usa_vc = train_data['is_usa_revenue'].value_counts()\nww_vc = train_data['is_ww_revenue'].value_counts()\npd.DataFrame({'true':[usa_vc.get(True), ww_vc.get(True)],\n             'false':[ww_vc.get(False), ww_vc.get(False)]},\n             index = ['USA revenue','World Revenue']).plot.bar()\n","8a8ce7b1":"train_data['is_only_usa_revenue'] = train_data.is_usa_revenue & ~train_data.is_ww_revenue\ntrain_data['is_only_ww_revenue'] = train_data.is_ww_revenue & ~train_data.is_usa_revenue\ntrain_data['both_revenues'] = train_data.is_usa_revenue & train_data.is_ww_revenue\ntrain_data['strange_revenue'] = ~train_data.is_usa_revenue & ~train_data.is_ww_revenue","5f9c51dc":"train_data[['is_only_usa_revenue','is_only_ww_revenue','both_revenues','strange_revenue']].sum().plot.bar()","bf5f3bfa":"train_data['usa_revenue_diff'] = abs(train_data.revenue - train_data.world_revenue)\/train_data.revenue\ntop_error_movies = train_data[train_data.is_only_usa_revenue & (train_data.usa_revenue_diff>0.1)].sort_values(by='usa_revenue_diff',ascending=False)\nprint(top_error_movies.usa_revenue_diff.describe())","5bdb0ac3":"top_error_movies.to_csv('top_error_films.csv',index=False)\ntop_error_movies[['original_title','imdb_id','revenue','usa_revenue','world_revenue','usa_revenue_diff']].head(20)","f0cd915c":"Looks like World revenue is more common, but actually this plot is not fully fair. Some films has equals USA and World revenue values and such films don't bring us serious problems.\nLet's figure out what exactly films can bring us problems","7e6b4d6f":"As we can see some differences are shocking. \nThe main problem is that the same data is using for prediction result validation.\nI've collected data for validation data from test.csv and get next results:\n![image.png](attachment:image.png)\n\nLooks like test data also contains same problem with revenue type(but can not be shured on 100%). Such problem can easily solve in train data, but it's doesn't help if validation is incorrect.\n\nOfcourse there are some data diffrence on IMDB and TMDB sites, but problem with revenue type is apparent.","42cbcc93":"Some of the films doesn't has information about revenue","140a7979":"So we have 289 movies with more than 10% error. Look at the top error movies:","460e2f41":"Start with limport necessary libs","c595e31b":"Read train and dataset for revenue value check. This dataset was collected from official IMDB website","dff844d6":"313 films with USA revenue and 387 films with strange revenue(not USA and not a World). Don't forget that we filter all films with zero values.\n![](https:\/\/www.meme-arsenal.com\/memes\/629fba7185b55e953449bd41cc83c46f.jpg)\n\n","f1f7ff4e":"Let's check what type of revenue is using in train data. Train data can be outdated, therefore tolerance = 5% ","49f2f978":"let's operate with non zero data","39e77b1e":"Maybe it's not so critical for us. Let's check it","cf62ebe3":"## Goal explanation\nIn this kernel I want to take a look at predicted value. According [competition data description](https:\/\/www.kaggle.com\/c\/tmdb-box-office-prediction\/data)\n> You are predicting the worldwide revenue for 4398 movies in the test file.\n\nI've found some [examples](https:\/\/www.kaggle.com\/c\/tmdb-box-office-prediction\/discussion\/81826#477851) in train data when revenue was equals to US revenue and some examples equals Worldwide revenue.\nSo I decide to check what we really have in train data."}}