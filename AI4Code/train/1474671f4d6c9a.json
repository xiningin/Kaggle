{"cell_type":{"f8a4faab":"code","e93477e0":"code","ab90d91e":"code","f9fc734c":"code","824d8d3e":"code","bea9a8d2":"code","e81f61e5":"code","860a5f3c":"markdown","807d1525":"markdown"},"source":{"f8a4faab":"! pip install -U spacy","e93477e0":"import spacy\nimport pandas as pd\nfrom spacy.tokens import DocBin\nfrom tqdm import tqdm\nimport random\nimport re","ab90d91e":"! python -m spacy train ..\/input\/models\/config.cfg --output .\/output_model --gpu-id 0","f9fc734c":"def load_results_manual(X_text, visualize = True):\n    \"\"\"This function ouputs different labels, so the output os a dictionary\"\"\"\n    nlp = spacy.load(\".\/output_model\/model-best\")\n    doc = nlp(X_text)\n    if visualize == True:\n        spacy.displacy.render(doc, style='ent', jupyter=True)\n    ents = doc.ents\n    output = []\n    for entity in ents:\n        row = {'entity': entity.text,\n                'label': entity.label_,\n                'start': entity.start,\n                'end': entity.end}\n        output.append(row)\n    return output","824d8d3e":"test_ids = ['0FB0700DAF44', '18409261F5C2', 'D46BCB48440A', 'D72CB1C11673', 'DF920E0A7337']\ntxt_files = []\nfor i in test_ids:\n    txt_file = open(f\"..\/input\/feedback-prize-2021\/test\/{i}.txt\", \"r\")\n    txt_file = txt_file.read()\n    txt_files.append(txt_file)","bea9a8d2":"dfs = []\nfor j, item in enumerate(test_ids):\n    entities = load_results_manual(txt_files[j], visualize=False)\n    ids = [item for i in range(len(entities))]\n    labels = [entities[i]['label'] for i in range(len(entities))]\n    pred_string = []\n    for i in range(len(entities)):\n        start = int(entities[i]['start']) \n        end = int(entities[i]['end'] + 1)\n        pred_string.append(list(range(start, end)))\n    test_dict = {'id': ids, 'class': labels, 'predictionstring': pred_string}\n    df_test = pd.DataFrame.from_dict(test_dict)\n    dfs.append(df_test)\n\nsubmission_df = pd.concat(dfs)\nsubmission_df = submission_df.reset_index().drop(['index'], axis = 1)\nsubmission_df.to_csv('.\/submission.csv')","e81f61e5":"submission_df","860a5f3c":"## Apply model","807d1525":"## Submission"}}