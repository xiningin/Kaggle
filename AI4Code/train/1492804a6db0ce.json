{"cell_type":{"71965553":"code","86c32ccd":"code","fa88d144":"code","2a3edd1c":"code","47bb00da":"code","0a9c8f49":"code","045b2b6f":"code","f9a8b72a":"code","7eb18b0a":"code","c5fae650":"code","a5b5ecf9":"code","0398ced2":"code","49264612":"code","c0f85caa":"code","10b01bc2":"code","c497c856":"code","9539faeb":"code","6d7fd298":"code","51c86d49":"code","70b9106e":"code","f7bbcb5b":"code","7728b930":"code","db877a25":"code","95923b21":"code","b60f4274":"code","bb0613a1":"code","e0e58522":"code","59a14c4d":"markdown","441ad00f":"markdown","bc921c74":"markdown","586136d8":"markdown","1ab2129c":"markdown","fffa0f75":"markdown","854528f3":"markdown","3fa659bc":"markdown","1110f6bc":"markdown","b8d3f321":"markdown","1541db33":"markdown","552cba18":"markdown","ca9c9b4f":"markdown","1b909d8f":"markdown","e97a1372":"markdown","38f10d08":"markdown","a42425b9":"markdown","733c6627":"markdown","e58d9e0b":"markdown","449c24af":"markdown","d7f2d33f":"markdown","35f51de0":"markdown","8622337a":"markdown"},"source":{"71965553":"!pip install itk --quiet\n!pip install itkwidgets --quiet","86c32ccd":"import os\nimport numpy as np \nimport pandas as pd \n\nimport openslide\nimport gc\nimport matplotlib.pyplot as plt\nfrom collections import defaultdict\n\nfrom PIL import Image\nfrom tqdm import tqdm\n\nimport plotly\nimport plotly.express as px\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots\n\n\nfrom IPython.display import FileLinks\n\nimport itk\nimport itkwidgets\nfrom ipywidgets import interact , interactive , IntSlider , ToggleButtons\nfrom ipywidgets import interact\nplotly.offline.init_notebook_mode (True)","fa88d144":"train_images_dir = '..\/input\/prostate-cancer-grade-assessment\/train_images\/'\ntrain_images     = os.listdir (train_images_dir)","2a3edd1c":"train_csv = pd.read_csv ('..\/input\/prostate-cancer-grade-assessment\/train.csv')","47bb00da":"train_images  = []\n\nfor i , image in enumerate(tqdm(os.listdir (train_images_dir))):\n    img             =  image \n    img_size_MB     = f\"{os.stat(train_images_dir+image).st_size \/ 1024 **2 : 1.2f} \" \n    wsi             = openslide.OpenSlide (train_images_dir + image)\n    train_images.append((img ,  \n                         img_size_MB ,\n                         wsi.level_dimensions[0] , \n                         wsi.level_dimensions[1] , \n                         wsi.level_dimensions[2] , \n                         np.product(wsi.level_dimensions[0]) * 3, \n                         np.product(wsi.level_dimensions[1]) * 3, \n                         np.product(wsi.level_dimensions[2]) * 3\n                        ))\n    gc.collect()\n    \n","0a9c8f49":"train_images = pd.DataFrame ( train_images , \n                              columns = ['img' , \n                                  'Image Size (MB)' ,\n                                  'Image Shape Level0' ,\n                                  'Image Shape Level1' , \n                                  'Image Shape Level2' , \n                                  'Total Pixels Level0' , \n                                  'Total Pixels Level1' , \n                                  'Total Pixels Level2']\n                            )","045b2b6f":"train_images.head()","f9a8b72a":"train_images['Image Size (MB)'] = train_images['Image Size (MB)'].astype('float32')","7eb18b0a":"def image_name(img) :\n    return img.split('.')[0]\n\ntrain_images['img'] = train_images['img'].map(image_name)","c5fae650":"train_images.shape  , train_csv.shape , train_images['img'].nunique()  , train_csv['image_id'].nunique()","a5b5ecf9":"train_df = train_csv.merge (train_images , \n                            left_on = \"image_id\" , \n                            right_on = \"img\")","0398ced2":"train_df.shape","49264612":"#Drop duplicate column\ntrain_df.drop('img', axis = 1, inplace= True)","c0f85caa":"train_df.head()","10b01bc2":"del train_images , train_csv","c497c856":"def get_width (image) :\n    return image[0]\ndef get_height (image) :\n    return image[1]","9539faeb":"width  = train_df['Image Shape Level0'].map(get_width)\nheight = train_df['Image Shape Level0'].map(get_height) \n\nfig    = px.scatter (train_df , \n            x =  width , \n            y = height , \n            color = width,\n           title = 'Image Size in Pixels - Level 0 (highest) Resolution)')\n\nfig.update_layout ( yaxis=dict(title_text=\"Height\") , \n                    xaxis=dict(title_text=\"Width\") , \n                    title_font_family=\"Open Sans\"\n                  )","6d7fd298":"width  = train_df['Image Shape Level1'].map(get_width)\nheight = train_df['Image Shape Level1'].map(get_height) \nfig    =  px.scatter (train_df , \n            x =  width , \n            y = height , \n            color = width , \n            title = 'Image Size in Pixels - Level 1 Resolution)')\n\nfig.update_layout (yaxis=dict(title_text=\"Height\") , \n                    xaxis=dict(title_text=\"Width\") , \n                    title_font_family=\"Open Sans\")\n","51c86d49":"width  = train_df['Image Shape Level2'].map(get_width)\nheight = train_df['Image Shape Level2'].map(get_height) \nfig    = px.scatter (train_df , \n            x =  width , \n            y = height , \n            color = width , \n            title = 'Image Size in Pixels - Level 2 (lowest) Resolution)')\nfig.update_layout (yaxis=dict(title_text=\"Height\") , \n                    xaxis=dict(title_text=\"Width\") , \n                    title_font_family=\"Open Sans\")\n","70b9106e":"def change_level (level):\n    width  = train_df[f'Image Shape Level{level}'].map(get_width)\n    height = train_df[f'Image Shape Level{level}'].map(get_height) \n    fig = px.scatter (train_df , \n            x =  width , \n            y = height , \n            color = width , \n            title = f'Image Size in Pixels - Level {level} (Lowest Resolution)')\n    \n    fig.update_layout ( yaxis=dict(title_text=\"Height\") , \n                    xaxis=dict(title_text=\"Width\") , \n                    title_font_family=\"Open Sans\")\n    fig.show()\n    return level","f7bbcb5b":"interact (change_level , level = (0 , 2))","7728b930":"fig = px.histogram (train_df ,\n              x = ['Total Pixels Level0'] ,\n              hover_data = ['gleason_score' , 'isup_grade'],\n              color = 'data_provider' ,\n              marginal = 'rug',\n              title = 'Pixel Distribution at Level 0')\n\nfig.update_layout ( yaxis=dict(title_text=\"Images Count\") , \n                    xaxis=dict(title_text=\"Total Number of Pixels\") , \n                    title_font_family=\"Open Sans\")\nfig.show()","db877a25":"fig = px.histogram (train_df ,\n              x = ['Total Pixels Level1'] ,\n              hover_data = ['gleason_score' , 'isup_grade'],\n              color = 'data_provider' ,\n              marginal = 'rug',\n              title = 'Pixel Distribution at Level 1')\nfig.update_layout ( yaxis=dict(title_text=\"Images Count\") , \n                    xaxis=dict(title_text=\"Pixel Size\") , \n                    title_font_family=\"Open Sans\")\nfig.show()","95923b21":"fig = px.histogram (train_df ,\n              x = ['Total Pixels Level2'] ,\n              hover_data = ['gleason_score' , 'isup_grade'],\n              color = 'data_provider' ,\n              marginal = 'rug',\n              title = 'Pixel Distribution at Level 2'\n                   )\n\nfig.update_layout ( yaxis=dict(title_text=\"Images Count\") , \n                    xaxis=dict(title_text=\"Pixel Size\") , \n                    title_font_family=\"Open Sans\")\nfig.show()","b60f4274":"def change_level (level):\n    width  = train_df[f'Image Shape Level{level}'].map(get_width)\n    height = train_df[f'Image Shape Level{level}'].map(get_height) \n    fig = px.scatter (train_df , \n            x =  width , \n            y = height , \n            color = train_df['data_provider'] , \n            title = f'Image Size Distribution across Data providers')\n    fig.update_traces(marker=dict(size=12,\n                      line=dict(width=2,color='DarkSlateGrey')),\n                      selector=dict(mode='markers')\n                  )\n\n    fig.show()\n    return level","bb0613a1":"interact (change_level , level = (0 , 2))","e0e58522":"fig = make_subplots(rows=1, \n                    cols=3 , \n                    subplot_titles=(\"Level 0\", \n                                    \"Level 1\" , \n                                    \"Level 2\")\n                   )\nfig.add_trace(go.Violin(\n                        x = train_df['isup_grade'] ,\n                        y = train_df['Total Pixels Level0'], \n                        points = 'all', name = \"Level 0\"\n                ), row = 1, col = 1 )\n\nfig.add_trace(go.Violin(\n                        x = train_df['isup_grade'] ,\n                        y = train_df['Total Pixels Level1'], \n                        points = 'all' , name = \"Level 1\"\n                ) , row = 1, col = 2 )\n\n\nfig.add_trace(go.Violin(\n                        x = train_df['isup_grade'] ,\n                        y = train_df['Total Pixels Level2'], \n                        points = 'all', name = \"Level 2\" \n                ), row =1  , col = 3 )\n\nfig.update_layout(\n    autosize=True , \n    width=2000,\n    height=500 , \n    title = 'Total Pixels distribution by Grading '\n)\n","59a14c4d":"**Below plots visualise the pixel**","441ad00f":"**Dataframe construction with Image Dimensions**","bc921c74":"**Remove .tiff from the 'img' column in Dataframe**","586136d8":"Here, we note that distribution is similar across the image sizes.","1ab2129c":"# **Pixel Distribution**\n","fffa0f75":"**Dropping the intermediate created datasets**","854528f3":"**Above distinction among data providers can be more clearly seen in the below scatter plot**","3fa659bc":"**What do the Image Size plots tell ?**\n1. Image width & height for level 0 lies in range of tens of thousands , level1 until tens of 1000's and the last one i.e. level2 is concentrated in range of a few thousands majorily.\n2. There are a few outliers in terms of sizes among above 3 levels.","1110f6bc":"# **Toggle Level**","b8d3f321":"**Fetching the image width and height for plots**","1541db33":"**Below one is an interactive plot to switch among 3 levels quickly and get an overview of the distribution**","552cba18":"**Below plot analyses if the Gradings vary with image size (i.e. Total number of Pixels) at a given resolution level ?**","ca9c9b4f":"**Converting the above results to a DataFrame**","1b909d8f":"**What do the Total Pixel's plots tell us ?**\n1. Image data size do vary as provided by the 2 data providers.\n2. In all the 3 levels , Karolinska provided datasets are comparatively larger than in size.","e97a1372":"# Image Size Distribution","38f10d08":"# **About Notebook**\n\nThis notebook explores the data through the lens of Whole Slide Images - i.e. across sizes, total pixels and a couple of other provided data columns in the train csv file using plotly.\n\nLet me know if you found these valuable.\n","a42425b9":"Above dataframe will be used futher for data insights through visualization","733c6627":"**Below are the scatter plots of Image pixels across height and width for all 3 levels**","e58d9e0b":"**The below dataframe details the information across WSI's in the training dataset.**","449c24af":"# **Toggle Level**","d7f2d33f":"**Merging the Whole slide images information with the Train DataFrame.**","35f51de0":"**Note : Above interactive plot might not be visible in comit notebook.**","8622337a":"**Path to the Directory**"}}