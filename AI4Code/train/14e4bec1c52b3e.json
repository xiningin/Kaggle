{"cell_type":{"f1b56fad":"code","54a35322":"code","7515df42":"code","4ced5ce3":"code","c56121ae":"code","b01a9c44":"code","e3e7638f":"code","961ea2aa":"code","1d8fefb2":"code","da1b0b81":"code","f8c00daa":"code","939be9e4":"code","6ccd1749":"code","1fde8074":"code","edbfcb97":"code","c3729dab":"code","aa4ec076":"code","18909bcd":"code","fd7d47dc":"code","412dae81":"code","b4261929":"code","08dacc3a":"code","3545d287":"code","72940192":"code","c0faf2dc":"code","a02ad74d":"code","52f1c538":"code","303f12ba":"code","0844818b":"code","7b451a9f":"code","37a379dd":"code","b2b536ec":"code","7ab1f8a1":"code","76c56c7e":"code","8a0980fb":"code","4473bf26":"code","5ab4eb72":"code","f80b68e4":"code","1ed969de":"code","4b83f5c6":"code","5135fc0c":"code","c55247bf":"markdown","504087b1":"markdown","f41224ba":"markdown","52c5b297":"markdown","acac688c":"markdown","810a4849":"markdown","624fbf2b":"markdown","eb9379e6":"markdown","762ddd65":"markdown","ee0b31bd":"markdown","c6ca25c4":"markdown","a2a29d31":"markdown","33dfab33":"markdown","ba2ffa2f":"markdown","79d8e927":"markdown","a49a0ca9":"markdown","77c4f0fa":"markdown","6205bbed":"markdown","70c81b61":"markdown","9a82ba5d":"markdown","1887f2f1":"markdown","ab627eb1":"markdown","6689babf":"markdown","b9fe3e01":"markdown","56af95f4":"markdown","b5a18455":"markdown","ce0c97ef":"markdown","37ef3436":"markdown","52b22fc2":"markdown","773745ed":"markdown","e3179f07":"markdown","a2d652b3":"markdown","945e2027":"markdown","af060e54":"markdown","165582e5":"markdown","a27eb863":"markdown","b43d3ef4":"markdown","21be2468":"markdown"},"source":{"f1b56fad":"import numpy as np \nimport pandas as pd \nimport matplotlib.pyplot as plt\nimport collections\nimport seaborn as sns\n\nfrom matplotlib.gridspec import GridSpec\nfrom matplotlib.pyplot import figure\n\nfrom plotly.offline import init_notebook_mode, iplot\nimport plotly.graph_objs as go\ninit_notebook_mode(connected=True)\n\nimport os\nprint(os.listdir(\"..\/input\"))","54a35322":"df_loans = pd.read_csv('..\/input\/data-science-for-good-kiva-crowdfunding\/kiva_loans.csv')\ndf_mpi = pd.read_csv('..\/input\/data-science-for-good-kiva-crowdfunding\/kiva_mpi_region_locations.csv')\nmpi_national = pd.read_csv(\"..\/input\/mpi\/MPI_national.csv\")\nworld_countries = pd.read_csv(\"..\/input\/countries-of-the-world\/countries of the world.csv\")\ncountry_stats = pd.read_csv(\"..\/input\/additional-kiva-snapshot\/country_stats.csv\")","7515df42":"df_loans.head()","4ced5ce3":"df_loans.shape","c56121ae":"df_loans.describe()","b01a9c44":"df_loans.isna().sum().sort_values(ascending=False)","e3e7638f":"df_mpi.head()","961ea2aa":"genders = np.array(df_loans['borrower_genders'])\n\ngenders_updated = []\n\nfor gender in genders:\n    if(type(gender)==str):\n        gender = gender.replace(',', '').replace(\"'\", '').replace(\"[\", '').replace(\"]\", '').split(' ')\n        for x in gender:\n            genders_updated.append(x)\n\nborrower_genders = collections.Counter(genders_updated)\n\nfigure(num=None, figsize=(8, 8), dpi=80, facecolor='w', edgecolor='k')\nthe_grid = GridSpec(3, 1)\n\nplt.figure(figsize=(7,7))\nplt.pie(borrower_genders.values(), labels=borrower_genders.keys(), autopct='%1.1f%%',)\nplt.title('Borrower genders', fontsize=16)\n\n\nplt.show()","1d8fefb2":"fig = plt.figure(figsize=(14,8))\nplt.xticks(np.arange(0, max(df_loans['loan_amount'])+1, 5000), rotation = 45)\ng = sns.distplot(df_loans['loan_amount'], norm_hist=False)\ng.plot()","da1b0b81":"df_loans[df_loans['loan_amount'] > 50000]","f8c00daa":"df_loans['loan_amount'].sum()","939be9e4":"sectors = df_loans['sector'].value_counts().reset_index()\nsectors = sectors.rename(columns={'index': 'sector', 'sector': 'Loan Count'})\n\nsectors_funded = df_loans.groupby('sector').sum()['loan_amount'].reset_index().sort_values('loan_amount', ascending=False)","6ccd1749":"sns.set()\nfig = plt.figure(figsize=(15,8)) # Create matplotlib figure\n\nax = fig.add_subplot(111) # Create matplotlib axes\nax2 = ax.twinx() # Create another axes that shares the same x-axis as a\nwidth = .4\n\nsectors_funded.plot.bar(x='sector', y='loan_amount',color='plum',ax=ax,width=width, position=0)\nsectors.plot.bar(x='sector', y='Loan Count', color='mediumaquamarine', ax=ax2,width = width,position=1)\n\nax.grid(None, axis=1)\nax2.grid(None)\n\nax.set_ylabel('Total Loan Amount')\nax2.set_ylabel('Number of Loans')\n\nax.set_title('Loan Amount and Loan Count by Sector',fontsize=16)","1fde8074":"plt.figure(figsize=(10,6))\nax = sns.boxplot(x='loan_amount',y='sector', data=df_loans, showfliers=False)\nplt.title('Loan amount by sector', fontsize=16)","edbfcb97":"df = df_loans[df_loans['country'].isin(['Philippines', 'Kenya', 'El Salvador', 'Cambodia', 'Pakistan', 'Peru'])]\ng = sns.FacetGrid(df, col=\"country\", col_wrap=2)\ng.set_xticklabels(rotation=90)\ng.map(sns.countplot, 'sector')","c3729dab":"plt.figure(figsize=(12,8))\nactivities = df_loans['activity'].value_counts().head(40)\nsns.barplot(y=activities.index, x=activities.values, alpha=0.6)\nplt.title(\"Loan Count by Activity (top 40)\", fontsize=16)\nplt.xlabel(\"Loan Count\", fontsize=15)\nplt.ylabel(\"Activity\", fontsize=15)","aa4ec076":"countries = df_loans['country'].value_counts().reset_index()\ncountries = countries.rename(columns={'index': 'country', 'country': 'Loan Count'})\n\ncountries_total_funded = df_loans.groupby('country').sum()['loan_amount'].reset_index().sort_values('loan_amount', ascending=False)\ncountries_total_funded = countries_total_funded.rename(columns={'loan_amount':'Total Amount Loaned'})","18909bcd":"countries_merged = countries.merge(countries_total_funded, on='country')","fd7d47dc":"sns.set()\nfig = plt.figure(figsize=(15,8)) # Create matplotlib figure\n\nax = fig.add_subplot(111) # Create matplotlib axes\nax2 = ax.twinx() # Create another axes that shares the same x-axis as a\nwidth = .4\n\ncountries_merged.head(30).plot.bar(x='country', y='Total Amount Loaned',color='plum',ax=ax,width=width, position=0)\ncountries_merged.head(30).plot.bar(x='country', y='Loan Count', color='mediumaquamarine', ax=ax2,width = width,position=1)\n\nax.grid(None, axis=1)\nax2.grid(None)\n\nax.set_ylabel('Total Loan Amount')\nax2.set_ylabel('Number of Loans')\n\nax.set_title('Loan Amount and Loan Count by Country (top 30)',fontsize=16)","412dae81":"top_countries = countries_total_funded.head(20)['country']\n\nloan_range=df_loans[(df_loans['country'].isin(top_countries))]\nplt.figure(figsize=(12,8))\nax = sns.boxplot(x='loan_amount',y='country', data=loan_range, showfliers=False)\nplt.title('Loan amount by country', fontsize=16)","b4261929":"df_loans['region_country'] = df_loans['region'] + ', ' + df_loans['country']\n\nplt.figure(figsize=(12,8))\nregions = df_loans['region_country'].value_counts().head(30)\nsns.barplot(y=regions.index, x=regions.values, alpha=0.6)\nplt.title(\"Loan Count by Region (top 30)\", fontsize=16)\nplt.xlabel(\"Loan Count\", fontsize=15)\nplt.ylabel(\"Region\", fontsize=15)","08dacc3a":"country_avg_loan = df_loans.groupby('country')['loan_amount'].mean().reset_index()\ncountry_avg_loan = country_avg_loan.rename(columns={'loan_amount': 'avg_loan_amount'}).sort_values('avg_loan_amount', ascending=False)\ncountry_avg_loan.head()","3545d287":"df_loans.groupby('country').agg({'loan_amount': 'mean'}).sort_values('loan_amount', ascending=False).tail(10)","72940192":"top_countries_df = df_loans[df_loans['country'].isin(top_countries)]\ntop_countries_df.groupby('country').agg({'loan_amount': 'mean'}).sort_values('loan_amount', ascending=False)","c0faf2dc":"plt.figure(figsize=(12,8))\nplt.title('Term in Months vs. Loan Amount', fontsize=16)\nsns.scatterplot(x=df_loans['loan_amount'], y=df_loans['term_in_months'])\n\n# df_loans[df_loans['loan_amount'] < 4000].sample(100).plot.scatter(x='loan_amount', y='term_in_months', title='Term in Months vs Loan Amount')","a02ad74d":"region_themes = pd.read_csv(\"..\/input\/data-science-for-good-kiva-crowdfunding\/loan_themes_by_region.csv\")\nregion_themes[region_themes['region'] == 'Kaduna']\n","52f1c538":"region_themes['number'].sum()","303f12ba":"countries_mpi = countries_total_funded.merge(mpi_national, left_on='country', right_on='Country')\ncountries_mpi = countries_mpi.sort_values('MPI Urban', ascending=False)\ncountries_mpi = countries_mpi.drop(['Country'], axis=1)","0844818b":"data = [ dict(\n        type = 'choropleth',\n        locationmode='country names',\n        locations=countries_mpi['country'],\n        z=countries_mpi['MPI Rural']\n      ) ]\n\nlayout = dict(\n    title = 'Rural MPI'\n)\n\nfig = dict( data=data, layout=layout )\niplot( fig )","7b451a9f":"data = [ dict(\n        type = 'choropleth',\n        locationmode='country names',\n        locations=countries_mpi['country'],\n        z=countries_mpi['MPI Urban']\n      ) ]\n\nlayout = dict(\n    title = 'Urban MPI'\n)\n\nfig = dict( data=data, layout=layout )\niplot( fig )","37a379dd":"data = [ dict(\n        type = 'scattergeo',\n        locationmode = 'ISO-3',\n        lon = df_mpi['lon'],\n        lat = df_mpi['lat'],\n        text = df_mpi['region'] + ', ' + df_mpi['country'] + ': ' + df_mpi['MPI'].astype(str),\n        mode = 'markers',\n        marker = dict(\n            size = 7,\n            opacity = 0.8,\n            color = df_mpi['MPI'],\n            symbol = 'square',\n            cmin = 0,\n            colorbar=dict(\n                title=\"MPI\"\n            )\n        ))]\n\nlayout = dict(\n        title = 'MPI by Region',\n        colorbar = True,\n        geo = dict(\n            scope='world',\n            #projection=dict( type='albers usa' ),\n            showland = True,\n            landcolor = \"rgb(250, 250, 250)\",\n            subunitcolor = \"rgb(217, 217, 217)\",\n            countrycolor = \"rgb(217, 217, 217)\",\n            countrywidth = 0.5,\n            subunitwidth = 0.5\n        ),\n    )\nfig = dict( data=data, layout=layout )\n\n\niplot( fig, validate=False, filename='d3-loan-map' )","b2b536ec":"sns.scatterplot(x=countries_mpi['MPI Rural'], y=countries_mpi['Total Amount Loaned'])","7ab1f8a1":"# country_stats.head()\ncountry_stats = country_stats.rename(columns={'country_name': 'country'})\ncountry_stats = country_stats.merge(countries_total_funded, on = 'country')","76c56c7e":"country_stats[country_stats['country'] == 'Afghanistan']","8a0980fb":"x = country_stats[country_stats['population'] < 1000000000]\nsns.scatterplot(x=x['population'], y=x['Total Amount Loaned'])","4473bf26":"country_stats['Loan Amount per Capita'] = country_stats['Total Amount Loaned'] \/ country_stats['population']\ncountry_stats = country_stats.sort_values('Loan Amount per Capita', ascending = False)","5ab4eb72":"plt.figure(figsize=(12,8))\nsns.barplot(y=country_stats.head(20)['Loan Amount per Capita'], x=country_stats.head(20)['country'], alpha=0.6)\nplt.title(\"Loan amount per Capita\", fontsize=16)\nplt.xlabel(\"Amount per Capita\", fontsize=15)\nplt.ylabel(\"Country\", fontsize=15)\nplt.xticks(rotation = 45)","f80b68e4":"country_stats['number_below_poverty_line'] = country_stats['population_below_poverty_line'] * 0.01 * country_stats['population']\ncountry_stats","1ed969de":"plt.figure(figsize=(12,8))\ncountry_stats = country_stats.sort_values('number_below_poverty_line', ascending=False)\nsns.barplot(y=country_stats.head(20)['number_below_poverty_line'], x=country_stats.head(20)['country'], alpha=0.6)\nplt.title(\"Citizens Below Poverty Line\", fontsize=16)\nplt.xlabel(\"Country\", fontsize=15)\nplt.ylabel(\"Citizens Below Poverty Line\", fontsize=15)\nplt.xticks(rotation = 45)","4b83f5c6":"sns.set()\nfig = plt.figure(figsize=(15,8)) # Create matplotlib figure\n\nax = fig.add_subplot(111) # Create matplotlib axes\nax2 = ax.twinx() # Create another axes that shares the same x-axis as a\nwidth = .4\n\ncountry_stats.head(30).plot.bar(x='country', y='number_below_poverty_line',color='plum',ax=ax,width=width, position=0,alpha=0.7)\ncountry_stats.head(30).plot.bar(x='country', y='Total Amount Loaned', color='mediumaquamarine', ax=ax2,width = width,position=1,alpha=0.7)\n\nax.grid(None, axis=1)\nax2.grid(None)\n\nax.set_ylabel('Total Loan Amount')\nax2.set_ylabel('Number of Loans')\n\nax.set_title('Loans per capita and people under poverty line',fontsize=16)","5135fc0c":"fig = plt.figure(figsize=(10,8))\n\nsns.heatmap(df_loans.corr(), annot=True)","c55247bf":"### Amount Loaned vs Population","504087b1":"<a id=\"3\"><\/a> <br>\n## Borrower Demographics","f41224ba":"<a id=\"2\"><\/a> <br>\n## Data Overview","52c5b297":"After parsing the data in the \"borrower_genders\" column, we can see that the **majority of borrowers are female**. Unfortunately, this is the only information we receive about the borrower (apart from their location). It would be useful to have more information such as income, health, family size etc., for measuring poverty level. ","acac688c":"It seems like there isn't a high correlation between MPI Rural and Total Amount Loaned. This seems strange - shouldn't countries with lower MPI receive more money if the goal is to lift people out of poverty? Well, here are a few reasons this might be occuring.\n* Countries in with extremely high MPIs might be conflict zones, preventing Kiva or Kiva partners from working with borrowers in that country\n* Somebody living in extreme poverty might not be in the position to request a loan. Without access to basic necessities such as food and water, it could be difficult to come up with a process for repaying a loan\n* It's possible that some of these countries have a very low population. Maybe it's better to lend to countries with more people living under the poverty line - \"Liftin One, Lifting Many\". So let's take a look at population. ","810a4849":"* Loan amount and lender count are highly correlated. This makes sense - a larger loan takes more lenders to fulfill. \n* Term in months and loam amount are slightly correlated. A larger loan amount likely takes longer to repay.\n* Loan amount and funded amount are highly correlated, but not equal. This implies that some loan requests are not completely funded. ","624fbf2b":"Can see that usually the Urban MPI is higher than the Rural MPI - expected - in more densely populated areas there might be better access to necessary resources such as water and shelter. ","eb9379e6":"<a id=\"6\"><\/a> <br>\n## Feature Correlation","762ddd65":"Top countries for average loan amount are **Cote D'Ivoire and Mauritania**. Note that these countries have only received one loan each. ","ee0b31bd":"### Loan Distribution by Sector","c6ca25c4":"<a id=\"4\"><\/a> <br>\n## Loan Distribution","a2a29d31":"### Loan amount distribution ","33dfab33":"1. [Introduction](#1)\n2. [Data Overview](#2)\n3. [Borrower Demographics](#3)\n4. [Loan Distribution](#4)\n5. [Feature Correlation](#5)\n6. [Conclusion](#6)","ba2ffa2f":"Doesn't seem like there's a correlation - not sure what term in months means. ","79d8e927":"### Loan term length and loan amount","a49a0ca9":"Kiva is a non-profit that lets people lend money to low-income students and entrepreneurs around the world. Lenders can help to fund a requested loan for projects such as buying supplies for a store, starting a farm, or installing solar panels. The borrowers can request as much as they want, and lenders can contribute as much as they would like to this loan. \n\nThis notebook tackles [Kiva's Data Science for Good Kaggle Challenge](https:\/\/www.kaggle.com\/kiva\/data-science-for-good-kiva-crowdfunding\/home) (which is already closed). They provide a dataset with information from over 600,000 loans from the past two years, including the loan amount, data, location, etc. The goal is to \"help them build more localized models to estimate the poverty levels of residents in the regions where Kiva has active loan\". ","77c4f0fa":"After doing an analysis of the data, a suggestion for a better model would be adding information about a borrower's financial situation to the welfare estimation, rather than just using MPI. Although MPI is a good indicator, income is also important in estimating welfare. ","6205bbed":"## Better Welfare Model ","70c81b61":"<a id=\"1\"><\/a> <br>\n## Introduction","9a82ba5d":"It looks like there is only one loan greater than $50,000 - $100,000 for an Agriculture-related project in Haiti. A little research showed that this loan was for a Haitian becuty company called [Kreyol Essence](https:\/\/kreyolessence.com\/). The [loan](https:\/\/www.kiva.org\/lend\/722883) was used to help create 300 new jobs in rural Haiti for their new castor oil brand. This involved hiring farmers to grow the castor plants, and hiring women to extract the castor oil.","1887f2f1":"Here, we see the loan count by Activity. The top activity is Farming, which aligns with the top sector (Agriculture). Next we see General Store, again likely explaining the next highest sector (Food), or the third (Retail). ","ab627eb1":"### Loan Distribution by Country","6689babf":"**Phillippines, Kenya and El Salvador** are the top three countries for number of loans. The top three for amount funded are **Philippenes, Kenya, and the United States**. This is interesting because the USA only ranks 26th in terms of number of loans. They must be getting loans of higher value. ","b9fe3e01":"Note that there are some mistakes in the lat\/lon data. Apparently East China is actually an Iowan town called Waterloo. As expected, many of the regions with the lowest MPI are in Sub-Saharan Africa. ","56af95f4":"First, let's import the necessary libraries and datasets. We are using the provided Kiva data along with additional external datasets for more insight. ","b5a18455":"Most loans are under \\$5,000, but the range of this plot shows that there are some outliers. What \/ where are these loans for?","ce0c97ef":"The United States has the highest average loan amount among the top loan countries. Phillipenes has the lowest, but are still the highest receivers due to loan frequency","37ef3436":"This plot shows the total amount lent for individual sectors along with the number of loans for each sector. **Agriculture, Food, and Retail** are the top 3 sectors for both loan amount and number of loans.  ","52b22fc2":"Boxplot of loan amount distribution with outliers removed. It seems like the US has the highest range of loan amounts by far. Maybe it's because wealthy donors from the USA are more likely to give money to a project they are familiar with from their own lives. ","773745ed":"### Loans vs MPI","e3179f07":"Interestingly, total amount loaned doesn't seem to relate to the number of people living under the poverty line. India has the most under the poverty line by a wide margin, but does not have the highest amount loaned. Depends on severity of poverty. People choose where to lend their money.. ","a2d652b3":"Number of recorded loans is **671,205**. ","945e2027":"The total loan amount requested in this dataset is **\\$565,421,150!** However in total Kiva has given over \\$1,000,000,000 in loans! ","af060e54":"# Kiva Data Exploration","165582e5":"Population below poverty line vs. amount per capita","a27eb863":"### Average Loan Amount by Country","b43d3ef4":"Let's take a look at the loan data!","21be2468":"MPI stands for **Multidimensional Poverty Index**. MPI is a poverty indicator calculated across 10 indicators within 3 dimensions of poverty - Health (nutrition and child mortality), Education (years of schooling and school attendance), and Living Standards (cooking fuel, sanitation, drinking water, electricity, housing, and assets). If someone is experiencing at least three of the indicators, they are classified as MPI poor, and their poverty depends on the number of deprivations. Calculating poverty across a variety of dimensions gives us a more comprehensive picture than just using one indicator such as income. "}}