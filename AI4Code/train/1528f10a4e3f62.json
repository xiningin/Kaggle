{"cell_type":{"1c5ec807":"code","fdd46eff":"code","754c3416":"code","ba74d636":"code","a6ce41cc":"code","3e35d583":"code","a91804ea":"code","476b7553":"code","7b46e7b1":"code","ba36bc93":"code","f54f215f":"code","afa0ddcf":"code","43197801":"code","e496a2b8":"code","f61aa083":"code","9211de1a":"code","d6f7e42b":"code","fce9c61d":"code","1b8e745e":"code","f52262c2":"markdown","f1aa8577":"markdown","5d3705c8":"markdown","c7f71bea":"markdown"},"source":{"1c5ec807":"!pip install -U lightautoml","fdd46eff":"import pandas as pd\nimport numpy as np\n\nfrom lightautoml.automl.presets.tabular_presets import TabularAutoML\nfrom lightautoml.tasks import Task","754c3416":"df_train = pd.read_csv('..\/input\/tabular-playground-series-jan-2022\/train.csv')\ndf_train.head()","ba74d636":"import datetime","a6ce41cc":"def get_weekday(date):\n    year, month, day = date.split('-')\n    return datetime.date(int(year), int(month), int(day)).weekday()","3e35d583":"df_train['weekday'] = df_train['date'].apply(get_weekday)\ndf_train.head()","a91804ea":"list_date = np.array(df_train.date.str.split('-').to_list()).astype(int)\ndf_train['year'] = list_date[:,0]\ndf_train['month'] = list_date[:,1]\ndf_train['day'] = list_date[:,2]\ndf_train.head()","476b7553":"TARGET = 'num_sold'\nDROP = 'row_id'\nN_FOLDS = 7\nN_THREADS = 4\nRANDOM_STATE = 47\nTEST_SIZE = 0.2\nTIMEOUT = 1 * 3600","7b46e7b1":"def smape(y_true, y_pred):\n    return 1\/len(y_true) * np.sum(2 * np.abs(y_pred-y_true) \/ (np.abs(y_true) + np.abs(y_pred))*100)","ba36bc93":"task = Task('reg',\n           metric = smape)","f54f215f":"roles = {\n    'target': TARGET,\n    'drop': DROP,  \n    \n}","afa0ddcf":"%%time \n\nautoml = TabularAutoML(task = task, \n                               timeout = TIMEOUT,\n                               cpu_limit = N_THREADS,\n                               reader_params = {\n                                                'n_jobs': N_THREADS,\n                                                'cv': N_FOLDS\n                                               },\n                               general_params = {\n                               'use_algos': [['lgb_tuned', 'lgb','cb_tuned', 'cb'],['lgb_tuned', 'lgb','cb_tuned', 'cb']],\n                               }\n                             )","43197801":"%%time\n\noof_pred = automl.fit_predict(df_train, roles = roles, verbose=1)\nprint('oof_pred:\\n{}\\nShape = {}'.format(oof_pred, oof_pred.shape))","e496a2b8":"df_test = pd.read_csv('..\/input\/tabular-playground-series-jan-2022\/test.csv')\nsubmission = pd.read_csv('..\/input\/tabular-playground-series-jan-2022\/sample_submission.csv')","f61aa083":"df_test['weekday'] = df_test['date'].apply(get_weekday)","9211de1a":"list_test_date = np.array(df_test.date.str.split('-').to_list()).astype(int)\ndf_test['year'] = list_test_date[:,0]\ndf_test['month'] = list_test_date[:,1]\ndf_test['day'] = list_test_date[:,2]","d6f7e42b":"test_pred = automl.predict(df_test)\ntest_pred.data.astype(int)","fce9c61d":"submission['num_sold'] = np.round(test_pred.data, 0).astype(int)\nsubmission.head()","1b8e745e":"submission.to_csv('submission.csv', index=False)","f52262c2":"# Import library","f1aa8577":"### Predict","5d3705c8":"### Train ","c7f71bea":"### Feature generation"}}