{"cell_type":{"7f936c23":"code","d7bd8046":"code","1ef36257":"code","bfd78daa":"code","98b9ca7d":"code","a2f1574a":"code","779e39f0":"code","9efc53a1":"code","0e4cc149":"code","8e33fb13":"code","d98129cd":"code","a6a59cc0":"code","7ee2d6c0":"code","c0d758e5":"code","3e572d33":"code","abedd334":"code","529c74f4":"markdown","62684bbc":"markdown","ca41009a":"markdown","3e41896f":"markdown","acff3ae8":"markdown","c0537dc5":"markdown","f489d449":"markdown","7e0941e8":"markdown","4471912b":"markdown","d93c076e":"markdown","6b24258f":"markdown","5d411062":"markdown","77161da9":"markdown","0a159c27":"markdown","7d3ea8d0":"markdown","c9230052":"markdown","ce5a9f78":"markdown","33588358":"markdown","cc46003e":"markdown"},"source":{"7f936c23":"%matplotlib inline\n\nimport numpy as np # linear algebra\nimport pandas as pd # I\/O of data\nimport matplotlib.pyplot as plt # making plots\n\nimport os, random, shutil, zlib # directory operations","d7bd8046":" # print the path of the current directory\nprint('Current directory is {}'.format(os.getcwd()))\n\n# print the contents of the current directory\nprint('Current directory contains the follwoing sub-directories:\\n {}'.format(os.listdir())) ","1ef36257":"# print the current directory\nprint('Kaggle directory contains the following sub-directories:\\n {}'.format(os.listdir('..\/'))) ","bfd78daa":"print('Input directory contains the following sub-directories:\\n {}'.format(os.listdir('..\/input\/fruits-360_dataset\/fruits-360')))","98b9ca7d":"print('Validation directory contains the following sub-directories:\\n {}'. \\\n      format(os.listdir('..\/input\/fruits-360_dataset\/fruits-360\/Test')))","a2f1574a":"print('Training directory contains the following sub-directories:\\n {}'. \\\n      format(os.listdir('..\/input\/fruits-360_dataset\/fruits-360\/Training')))","779e39f0":"assert os.listdir('..\/input\/fruits-360_dataset\/fruits-360\/Test') == os.listdir('..\/input\/fruits-360_dataset\/fruits-360\/Training')","9efc53a1":" # path to validation input directory\nvalidationPathSource = '..\/input\/fruits-360_dataset\/fruits-360\/Test'\n# path to training input directory\ntrainPathSource = '..\/input\/fruits-360_dataset\/fruits-360\/Training'\n\n# path to the validation directory to which we will move validation images\nvalidationPathDest = '..\/working\/Validation' \n# path to the test directory to which we will move test images\ntestPathDest = '..\/working\/Test' \n# path to the test directory to which we will move training images\ntrainPathDest = '..\/working\/Training'","0e4cc149":"def get2working():\n    \n    \"\"\"\"\" This function changes the current directory to the working directory\n    regardless of the fact if the current directory is upstream or downstream the\n    working directory \"\"\"\"\"\n    \n    while True:\n        if os.getcwd() == '\/kaggle\/working': # if we are in the working directory then break\n            break\n        elif os.getcwd() == '\/': # else if we are upstream change it to the working directory\n            os.chdir('kaggle\/working')\n        else:\n            os.chdir('..') # else if we are downstream move back a directory untill we are in the working directory","8e33fb13":"def createfolder(pathandname):\n    \n    \"\"\"\"\" Given a path ending with the directory's name to be created as the input to \n    this function, a folder with that name is created \"\"\"\"\"\n    \n    get2working() # ensure that the current directory is the working directory\n    \n    try:\n        os.mkdir(pathandname) # make the desired directory\n        print('Folder created')\n    except FileExistsError:\n        print('Folder already exists so command ignored') # ignore if the directory already exits","d98129cd":"createfolder(validationPathDest)\ncreatefolder(testPathDest)\ncreatefolder(trainPathDest)","a6a59cc0":"test_dict = {} # empty dictionary to store validation data\ntrain_dict = {} # empty dictionary to store training data\nfruit_numbers = {} # empty dictionary to store the above defined 2 dictionaries\nget2working() # ensure that the current directory is the working directory\n\nfor classes in os.listdir(validationPathSource): # looping over the subdirectories in the validationPath (this can be changed to trainPathSource too as it will make no difference to the result)\n    # calculating number of fruits\n    test_dict[classes] = len(os.listdir(os.path.join(validationPathSource,classes))) \n    train_dict[classes] = len(os.listdir(os.path.join(trainPathSource,classes)))\n\nfruit_numbers['Test'] = test_dict # assigning val_dict to 'Validation' key\nfruit_numbers['Training'] = train_dict # assigning test_dict to 'Training' key\n\ndf_fruit_numbers = pd.DataFrame.from_dict(fruit_numbers) # creating a dataframe from fruit_numbers\nprint(df_fruit_numbers) # visualizing the dataframe\n\n# making sure that no values are null or zero. The following code should not print empty dataframes\nprint(df_fruit_numbers[(df_fruit_numbers.Training == 0)])\nprint(df_fruit_numbers[(df_fruit_numbers.Training == np.nan)])\nprint(df_fruit_numbers[(df_fruit_numbers.Test == 0)])\nprint(df_fruit_numbers[(df_fruit_numbers.Test == np.nan)])                  ","7ee2d6c0":"df_fruit_numbers.to_csv('FruitNumbers.csv') ","c0d758e5":"get2working() # Changing path to working directory\nos.chdir(validationPathSource) # Changing path to input training folder\nfruitnames = [file for file in os.listdir()]; # Storing names of fruits (sub folders within the training folder) in a list\n\n# Looping over the list of fruit names\nfor fruit in fruitnames:\n    get2working() # Changing path to working directory\n    validationpath = os.path.join(validationPathDest,fruit) # Creating path for a specifc fruit for the output validation folder\n    testpath = os.path.join(testPathDest,fruit) # Creating path for a specifc fruit for the output test folder\n    trainpath = os.path.join(trainPathDest,fruit) # Creating path for a specifc fruit for the output training folder\n    \n    sourcepath = os.path.join(validationPathSource,fruit) # Creating path for a specifc fruit for the source validation folder\n    sourcepathtrain = os.path.join(trainPathSource,fruit) # Creating path for a specifc fruit for the source training folder\n    \n    os.mkdir(testpath) # Creating a folder for a specific fruit in the test directory\n    os.mkdir(validationpath) # Creating a folder for a specific fruit in the validation directory\n    os.mkdir(trainpath) # Creating a folder for a specific fruit in the training directory\n    \n    os.chdir(sourcepath) # Changing path to the source directory\n    randomsample = random.sample(os.listdir(),len(os.listdir())) # Sampling random fruit images for a certain fruit\n    \n    get2working() # Changing path to the working directory\n    # Copying the first 25% fruit images from the source folder (randomaly sampled already) and copying them to the test folder \n    for k in range(0,len(randomsample)\/\/4):\n        shutil.copy(os.path.join(sourcepath,randomsample[k]),testpath)\n    \n    # Copying the rest of fruit images from the source folder (randomaly sampled already) and copying them to the validation folder\n    for k in range(len(randomsample)\/\/4,len(randomsample)):\n        shutil.copy(os.path.join(sourcepath,randomsample[k]),validationpath)\n    \n    # Copying all images from source training folder to the training folder in the working directory\n    os.chdir(sourcepathtrain) # Changing path to the source training directory\n    name_images = os.listdir()\n    \n    get2working() # Changing path to the working directory\n    for k in range(0,len(name_images)):\n        shutil.copy(os.path.join(sourcepathtrain,name_images[k]),trainpath)","3e572d33":"# Compressing output folders to zip files\nshutil.make_archive('Validation', 'zip',os.getcwd(), validationPathDest)\nshutil.make_archive('Testing', 'zip',os.getcwd(), testPathDest)\nshutil.make_archive('Training', 'zip',os.getcwd(), trainPathDest)\n\n# Removing uncompressed output folders\nshutil.rmtree(validationPathDest)\nshutil.rmtree(testPathDest)\nshutil.rmtree(trainPathDest);","abedd334":"# making sure that the data has been written\nos.listdir()","529c74f4":"Let's save the data frame to a csv file","62684bbc":"The fruits-360 dataset, which we are using for this analysis, contains 'Test' and 'Training' directories. ","ca41009a":"This will be the last step of this part of the project. At the end we will have a .csv file containg the number of fruits in the data set and three folder containing training, testing and validation dataset. We have also made sure that no data is missing and gone over the basics of navigating directories when working in a kaggle kernel. In the next part of the project we will explore the data further. We will visualize the number of fruits in different classes in different sets. We will also visualize different fruits to see how the data looks. Lastly, we will also calculate some parameters that will be used when we build the convolution neural network.","3e41896f":"We need to specify the location where the data exists. In kaggle the default directory (location where the kernel starts in) is the 'working' directory. We can print this directory's path and it's contents as shown below.","acff3ae8":"Now we can split the validation data by copying 25% of the data to the created test folder and the remaining data to the created validation folder.","c0537dc5":"Now that we have split the data set, we can compress and write it. We can also remove the uncompressed folders.","f489d449":"## Importing required packages\nFirstly, lets import the packages that we will be using. The particular use of every package is shown in the comments.","7e0941e8":"Within each of these are sub-directories containing fruits images. These sub-directories are named after the fruits that they contain so we can use the directory names as the target variables (fruit classes).","4471912b":"# Splitting the test data into validation and test set.\nNow we are ready to access the input test data and copy some data from it to the created test folder in our working directory. The contents of this directory will serve as the test data for our model. We will copy the remaining data in the input validation directory to the created validation folder in our working directory. This will serve as the validation data on which we will validate our models","d93c076e":"As we do not see any error the input data has passed the first check. Now that we know where our data is we can create variables for the paths to these directories.\nBut as we can see that we do not have any validation dataset, therefore, we will need to move some images from the 'Test' directory to a new directory. As we only have write access to the 'working' directory, that is where we will create three new directories: 1- for test images, another for training images and the last one for validation images. The 'Training' directory does not need to be created if the kernel is run on an updated datset. The only reason we are creating this directory is because we will save the created directories at the end of the kernel. The reason for saving is that we won't have to run this kernel again when we start building our convolution network. *** Note that the training folder will be copied as is to the working directory***.    \nThe following code sets the paths for different directories.","6b24258f":" If we navigate upstream (to the directory 'kaggle' and print it's contents , we will find a directory named 'input'. This is where the input data exists. The benefit of using kaggle kernel for analyzing kaggle datasets is that we do not need to download this data as it can be accessed directly from the kernel.","5d411062":"Another function that will help us for directory navigation is for the creation of folders.  Given a path ending with the directory's name to be created as the input to this function, a folder with that name is created. ","77161da9":"But, before splitting the data in this way we need to know that no class of fruits (sub-directories in the 'Training' and 'Testing') has zero images. This will also inform us about the number of training and validation images.\nTo do this we will create two dictionaries with keys =  class of a fruit and values = the number of fruits in that class. We will then convert these dictionaries to a pandas dataframe and inspect the dataframe. The purpose of creatiing the dataframe is to make the output easily readable. Also we can check for zero or null values in a dataframe easily.\nThe following code is used for the achievement of the above described goals.","0a159c27":"## Navigating different directories: the directory where we will work, the directory where the input data is stored and any directory that we need to create in the directory where we will work.","7d3ea8d0":"### Important insights from the dataframe:    \nNo folder is empty. If we had an empty folder we would have made a note of it BUT **wouldn't have deleted it. We would have deleted it after we had split our data. The reason being, the source data can be updated any time. An empty folder today can contain images tomorrow.** So if we delete a folder at this step the same folder can contain images when the data set is updated.        ","c9230052":"# Using convolution neural network to classify fruits\nWe will use keras library to build a convolution neural network to classify fruits into different classes. We wil be using kaggle kernel for this analysis. We will also use kaggle's gpu.  In order to do this we go to the settings tab and mark the check box named 'Enable GPU'.  \nAs we will be using kaggle kernel for this analysis, the first step would be doing some exploratory data analysis (EDA) and getting data ready for analysis.\nThis notebook is intended for performing the EDA and data wrangling and is ***Part 1*** of fruit classification project. This notebook takes users in a step wise manner to getting their data ready for model building.\nWe will be working with version 2018.07.01.0 of the 'fruits-360' dataset.","ce5a9f78":"Now using the above functions and the paths and directory names already defined, we create the required directories.","33588358":"Copying images from one directory to another will require alot of directory navigation. To make the workflow easier, it will be helpfull for us if we choose one directory as our reference point. As the paths that we have defined above are relative to the 'working' directory, the 'working' directory is a reasonable choice for a reference point. To make directory navigation simpler, let's first define a function which changes the current directory to the 'working' directory. ","cc46003e":"The first check we need to make is that the directories in the the Validation directory and Training directory are equal in number and have the same names, as we will be using these names as the names of our classes. To do that we will use the assert function as shown below:"}}