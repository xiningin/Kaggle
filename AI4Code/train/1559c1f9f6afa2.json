{"cell_type":{"e5b5fde9":"code","31909049":"code","7bdb549c":"code","c8d92bbe":"code","56e3e497":"code","e533ae11":"code","39836440":"code","0558581a":"code","2dbb1e28":"code","ece253db":"code","ffa4d127":"code","8aa2151e":"code","5a80ff3a":"code","282d7026":"code","f4afd0f3":"code","67fbc638":"code","e7b734d6":"code","6c489746":"code","61796956":"code","2226bd6b":"code","92a75dad":"code","6d52f5cb":"code","4824ded0":"code","613001b2":"code","fcff5120":"markdown","902b38cc":"markdown","76c3b885":"markdown","19601d13":"markdown","943a8464":"markdown","01acabeb":"markdown","a520373e":"markdown","b40b3893":"markdown","f3be5fdb":"markdown","c8394ff9":"markdown","9df2d3d5":"markdown","9c713a25":"markdown","e4ebaac2":"markdown","ce77c9e0":"markdown","5974d5d7":"markdown","d8f1c78a":"markdown","f6c5b0ce":"markdown","202c0bff":"markdown","6c47c4e6":"markdown","fa21f010":"markdown","cdf36593":"markdown","c716c2f5":"markdown","edbbd3ca":"markdown"},"source":{"e5b5fde9":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport folium\nimport squarify\nimport matplotlib as mpl\nmpl.rcParams.update(mpl.rcParamsDefault)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n### Variable Descrpition\npd.options.mode.chained_assignment = None\n\n# Any results you write to the current directory are saved as output","31909049":"df_train = pd.read_csv('..\/input\/zomato.csv', encoding='latin-1')\ncountry = pd.read_excel('..\/input\/Country-Code.xlsx', encoding='latin-1')\ndf_train = pd.merge(df_train,country,on='Country Code')\ndf_train['rating_cat'] = df_train['Rating text'].map({'Not rated': -1, 'Poor':0, 'Average':2, 'Good':3, 'Very Good':4, 'Excellent':5})\ndf_train.rename(columns = {'Aggregate rating':'rating_num', 'Has Table booking': 'Book', 'Has Online delivery': 'On_deliver', 'Is delivering now':'Cur_deliver', \n                          'Switch to order menu' : 'Switch_menu', 'Average Cost for two' : 'Avg_cost_two', 'Price range' : 'Pr_range'}, inplace = True)\n#df_train.drop(['Rating color', 'Rating text'], axis = 1 ,inplace= True)\n\nprint('Original Train Row: ', df_train.shape[0])\n#df_test = df_train.loc[df_train.rating_cat == -1, :].copy()\ndf_train = df_train.loc[df_train.rating_cat != -1, :].copy()\nprint('Train Row : ', df_train.shape[0])\n#print('Test Row : ', df_test.shape[0])","7bdb549c":"India_data =df_train[df_train.Country == 'India']\nresult = df_train['Country'].value_counts().reset_index()\nIndia_data.head()","c8d92bbe":"Cities = India_data['City'].value_counts().reset_index()\nTop_City = Cities.head(10)\nplt.pie(Cities['City'],labels=Cities['index'],autopct='%1.1f%%', shadow=True, startangle=140)\nplt.axis('equal')\nplt.show()","56e3e497":"NCR = India_data[(India_data['City']=='New Delhi') | (India_data['City']=='Gurgaon') | (India_data['City']=='Noida')]\nNCR = NCR.drop(['Address','Locality','Locality Verbose','Country Code','Country'],axis=1)\nNCR.head(5)","e533ae11":"NCR.describe()","39836440":"rating = ['rating_num', 'rating_cat']\n\nf, ax = plt.subplots(1,1, figsize = (12, 4))\nsns.countplot(NCR['rating_num'], ax = ax, color = 'k')\nax.tick_params('x', rotation = 70)\nax.set_title('Rating Distribtion')\nplt.show()","0558581a":"f, ax = plt.subplots(1,1, figsize = (12, 4))\nsns.barplot(NCR['rating_num'],NCR['Votes'], ax=ax)\nax.set_title('Number of vote Distribution over ratings')\nplt.show()","2dbb1e28":"print('ID # \/ Name #')\nNCR[['Restaurant ID','Restaurant Name']].apply(pd.Series.nunique, axis = 0)","ece253db":"NCR_loc = India_data.loc[India_data['City']=='Gurgaon',['Latitude', 'Longitude']]\n#NCR_loc = NCR[['Latitude', 'Longitude']]\nNCR_loc = NCR_loc.loc[India_data['Latitude']!=0,['Latitude', 'Longitude']]\n#Not counting for Restaurants without proper Geo Data\nmap_F = folium.Map( location=[28.201513, 76.989084],zoom_start = 10)\nfor i, (lat, lon) in enumerate(NCR_loc.values): folium.Marker([lat, lon]).add_to(map_F)\nmap_F\n\n","ffa4d127":"\nNCR['rating_cat'] = NCR['Rating text'].map({'Not rated': -1, 'Poor':0, 'Average':2, 'Good':3, 'Very Good':4, 'Excellent':5})\nNCR.rename(columns = {'Aggregate rating':'rating_num', 'Has Table booking': 'Book', 'Has Online delivery': 'On_deliver', 'Is delivering now':'Cur_deliver', \n                          'Switch to order menu' : 'Switch_menu', 'Average Cost for two' : 'Avg_cost_two', 'Price range' : 'Pr_range'}, inplace = True)\n#NCR.drop(['Rating color', 'Rating text'], axis = 1 ,inplace= True)\n\nNCR_test = NCR.loc[NCR.rating_cat == -1, :].copy()\nNCR = NCR.loc[NCR.rating_cat != -1, :].copy()\n\nNCR = NCR.loc[NCR['Longitude'] != 0, :]\n\n","8aa2151e":"tmp = NCR['rating_num'].map(np.round)\na = np.full(tmp.shape[0], False, dtype = bool)\nprint('Round')\n((tmp - NCR['rating_cat']).map(np.round)).value_counts()\n","5a80ff3a":"sys_check = NCR[['rating_num', 'rating_cat', 'Votes']].copy()\nsys_check['distorted'] = (NCR['rating_num'] - NCR['rating_cat']).map(np.round)\nsys_check['diff'] = sys_check['rating_num'] - sys_check['rating_cat']\ng = sns.FacetGrid(data =sys_check, col = 'distorted')\ng = g.map(plt.scatter, 'diff', 'Votes', alpha = 0.5)\nplt.show()","282d7026":"NCR = NCR.loc[sys_check['distorted'] != 2, :]\nNCR['rating_cat'] = NCR['rating_num'].round(0).astype(int)","f4afd0f3":"from sklearn.cluster import KMeans\nkmeans = KMeans(n_clusters=7, random_state=0).fit(NCR[['Longitude', 'Latitude']])\nNCR['pos'] = kmeans.labels_\npop_local = NCR.groupby('pos')['Longitude', 'Latitude', 'rating_num'].agg({'Longitude':np.mean, 'Latitude':np.mean, 'rating_num':np.median}).reset_index()\n\nwith plt.style.context('bmh', after_reset=True):\n    pal = sns.color_palette('rainbow', 7)\n    plt.figure(figsize = (8,6))\n    for i in range(7):\n        ix = NCR.pos == i\n        plt.scatter(NCR.loc[ix, 'Latitude'], NCR.loc[ix, 'Longitude'], color = pal[i], label = str(i))\n        plt.text(pop_local.loc[i, 'Latitude'], pop_local.loc[i, 'Longitude'], str(i) + ': '+str(pop_local.loc[i, 'rating_num'].round(2)), fontsize = 14, color = 'black')\n    plt.title('KMeans New Delhi Median Rating')\n    plt.legend()\n    plt.show()\n    \nvotes_area = NCR.groupby('pos').agg({'Votes': [np.sum, np.mean]})\nvotes_area.columns = votes_area.columns.droplevel(0)\nvotes_area.reset_index(inplace = True)\nplt.figure(figsize = (8,4))\nax = plt.subplot(1,2,1)\nsns.barplot(x = 'pos', y = 'sum', data =votes_area, palette = sns.cubehelix_palette(n_colors = 7, start = 2.4, rot = .1), ax = ax)\nax.set_title('Summation Votes')\n\nax = plt.subplot(1,2,2)\nsns.barplot(x = 'pos', y = 'mean', data =votes_area, palette = sns.cubehelix_palette(n_colors = 7, start = 3, rot = .1), ax = ax)\nax.set_title('Mean Votes')\nplt.show()","67fbc638":"with plt.style.context('bmh', after_reset=True):\n    plt.figure(figsize = (12,9))\n\n    cat = sorted(NCR['rating_cat'].unique())\n    ax = plt.subplot2grid((4,5), (0,0), colspan = 3, rowspan = 3)\n    pal = sns.color_palette('Set1', len(cat))\n    ix0 = NCR.rating_cat.isin((0,2))\n    ix2 = NCR.rating_cat.isin((2,3))\n    ix4 = NCR.rating_cat.isin((4,5))\n      \n\n    ax.scatter(NCR.loc[ix2, 'Latitude'], NCR.loc[ix2, 'Longitude'], color = 'gray', label = '2-3', alpha = 0.8)\n    ax.scatter(NCR.loc[ix4, 'Latitude'], NCR.loc[ix4, 'Longitude'], color = 'red', label = '4-5', alpha = 0.8)\n    ax.scatter(NCR.loc[ix0, 'Latitude'], NCR.loc[ix0, 'Longitude'], color = 'cyan', label = '0-2', alpha = 0.8,s=10)\n    ax.legend()\n    ax.set_title('Rating Dot')\n\n    ax = plt.subplot2grid((4,5), (0,3), colspan = 2, rowspan = 3)\n    tmp = NCR['rating_cat'].value_counts().sort_index()\n    sns.barplot(tmp.index, tmp.values, palette= pal)\n    ax.set_title('Rating Count')\n\n\n    cat = sorted(NCR['rating_cat'].unique().tolist())\n    x_lm = [NCR['Latitude'].min(), NCR['Latitude'].max()]\n    y_lm = [NCR['Longitude'].min(), NCR['Longitude'].max()]\n    for i, c in enumerate(reversed(cat)):\n        ax = plt.subplot2grid((4,5), (3,i))\n        ix = NCR.rating_cat == c\n        ax.scatter(NCR.loc[ix, 'Latitude'], NCR.loc[ix, 'Longitude'], color = pal[len(cat)-1-i], alpha = 0.8)\n        ax.set_xlim(x_lm)\n        ax.set_ylim(y_lm)\n        ax.set_title(str(c) + '_area')\n    plt.subplots_adjust(hspace=0.5, wspace = 0.5)\n    plt.show()","e7b734d6":"\nNCR['Cuisines'] = NCR['Cuisines'].astype(str)\nNCR['Cuisines_num'] = NCR['Cuisines'].apply(lambda x: len(x.split(',')))\n\nfrom collections import Counter\nlst_cuisine = set()\nCnt_cuisine = Counter()\nfor cu_lst in NCR['Cuisines']:\n    cu_lst = cu_lst.split(',')\n    lst_cuisine.update([cu.strip() for cu in cu_lst])\n    for cu in cu_lst:\n        Cnt_cuisine[cu.strip()] += 1\n\ncnt = pd.DataFrame.from_dict(Cnt_cuisine, orient = 'index')\ncnt.sort_values(0, ascending = False, inplace = True)\n\n\ntmp_cnt = cnt.head(10)\ntmp_cnt.rename(columns = {0:'cnt'}, inplace = True)\nwith plt.style.context('bmh'):\n    f = plt.figure(figsize = (12,8))\n    ax = plt.subplot2grid((2,2), (0,0))\n    sns.barplot(x = tmp_cnt.index, y = 'cnt', data = tmp_cnt, ax = ax, palette = sns.color_palette('Blues_d', 10))\n    ax.set_title('# Cuisine')\n    ax.tick_params(axis='x', rotation=70)\n    ax = plt.subplot2grid((2,2), (0,1))\n    sns.countplot(NCR['Cuisines_num'], ax=ax, palette = sns.color_palette('Blues_d', NCR.Cuisines_num.nunique()))\n    ax.set_title('# Cuisine Provided')\n    ax.set_ylabel('')\n\n    ax = plt.subplot2grid((2,2), (1,0), colspan = 2)\n    fusion_rate = NCR[['Cuisines_num', 'rating_cat', 'rating_num']].copy()\n    fusion_rate.loc[fusion_rate['Cuisines_num'] > 5,'Cuisines_num'] = 5\n    fusion_rate = fusion_rate.loc[fusion_rate.rating_cat != -1, :]\n    pal = sns.color_palette('Oranges', 11)\n    for i in range(1,6):\n        num_ix = fusion_rate['Cuisines_num'] == i\n        sns.distplot(fusion_rate.loc[num_ix, 'rating_num'], color = pal[i*2], label = str(i), ax = ax)\n        ax.legend()\n        ax.set_title('Rating Distribution for Cuisines_number')\n        \n\n    plt.subplots_adjust(wspace = 0.5, hspace = 0.8, top = 0.85)\n    plt.suptitle('Cuisine _ Rating')\n    plt.show()        \nprint('# Unique Cuisine: ', len(lst_cuisine))","6c489746":"plt.pie(tmp_cnt.cnt,labels=tmp_cnt.index,autopct='%.2f', shadow=True, startangle=140)\nplt.axis('equal')\nplt.show()","61796956":"south_asia = ['Afghani','Andhra','Awadhi', 'Bengali','Biryani',  'Burmese', 'Chettinad', 'Deli','Goan', 'Gujarati', 'Hyderabadi', 'Kashmiri','Kerala', 'Lebanese','Lucknowi', 'Maharashtrian','Mangalorean',\n 'Mithai', 'Modern Indian', 'Moroccan', 'Mughlai','Naga', 'Nepalese', 'North Eastern', 'North Indian','Oriya', 'Parsi', 'Rajasthani','South Indian', 'Tex-Mex','Sri Lankan',\n'Indian','Indonesian', 'Tibetan']\nafrica = ['African']\namerica = ['American','Mexican', 'South American']\neurope = ['British', 'European', 'French','Italian', 'Mediterranean','Middle Eastern', 'Portuguese','Spanish', 'Continental']\nwest_asia = ['Arabian','Turkish','Iranian']\neast_asia = ['Asian', 'Chinese','Japanese', 'Korean', 'Malaysian', 'Thai','Vietnamese',  'Sushi']\nkind_food = set(['Bakery', 'Beverages','Burger','Cafe', 'Desserts','Drinks Only', 'Fast Food', 'Finger Food','Healthy Food', 'Ice Cream', 'Juices','Pizza','Raw Meats','Salad','Sandwich','Seafood','Street Food',\n 'Tea'])\ncountry = lst_cuisine - set(kind_food)\n\ndef kind_country_cu(lst, kind_food = kind_food, country = country):\n    lst = lst.split(',')\n    tmp1 = [var for var in lst if var in kind_food]\n    tmp2 = [var for var in lst if var in country]\n    if not tmp1: tmp1 = ['None']\n    if not tmp2: tmp2 = ['None']\n    return tmp1, tmp2\nNCR['food_cu'], NCR['count_cu'] = zip(*NCR['Cuisines'].apply(kind_country_cu))\n\ndef get_popular(data):\n    Cnt_cuisine = Counter()\n    for cu_lst in data:\n        for cu in cu_lst:\n            if cu != 'None':\n                Cnt_cuisine[cu.strip()] += 1\n    cnt = pd.DataFrame.from_dict(Cnt_cuisine, orient = 'index')\n    cnt.sort_values(0, ascending = False, inplace = True)\n    return cnt","2226bd6b":"print(NCR['count_cu'].head(),NCR['food_cu'].head())","92a75dad":"rat_cu = NCR['food_cu'].groupby(NCR['rating_cat'])\ntmp_cnt = {}\nfor i in [2,3,4,5]:\n    data = rat_cu.get_group(i)\n    tmp_cnt[i] = get_popular(data)\n\nf, ax = plt.subplots(1,4, figsize = (20,4))\nfor i in [2,3,4,5]:\n    tmp = tmp_cnt[i].reset_index()\n    tmp.columns = ['cuisine', 'cnt']\n    sns.barplot(y = 'cuisine', x = 'cnt', data = tmp.head(10), ax = ax[i-2], palette = sns.cubehelix_palette(n_colors = tmp.shape[0], start = 1, rot = 0.1))\n    ax[i-2].set_title(str(i))\n    #ax[i-2].tick_params('x', rotation = 90)\nplt.show()","6d52f5cb":"rat_cu = NCR['count_cu'].groupby(NCR['rating_cat'])\ntmp_cnt = {}\nfor i in [2,3,4,5]:\n    data = rat_cu.get_group(i)\n    tmp_cnt[i] = get_popular(data)\n\nf, ax = plt.subplots(1,4, figsize = (12,4))\nfor i in [2,3,4,5]:\n    tmp = tmp_cnt[i].reset_index()\n    tmp.columns = ['cuisine', 'cnt']\n    sns.barplot(y = 'cuisine', x = 'cnt', data = tmp.head(10), ax = ax[i-2], palette = sns.cubehelix_palette(n_colors = tmp.shape[0], start = 1, rot = 0.1))\n    ax[i-2].set_title(str(i))\n    #ax[i-2].tick_params('x', rotation = 90)\nplt.show()","4824ded0":"f = plt.figure(figsize = (12,8))\nNCR['Avg_pr_cut'] = pd.cut(NCR['Avg_cost_two'], bins = [0, 200, 500, 1000, 3000, 5000,10000, 800000000], labels = ['<=200', '<=500', '<=1000', '<=3000', '<=5000', '<=10000', 'no limit'])\nax = plt.subplot2grid((1,2), (0,0))\nsns.countplot(NCR['Avg_pr_cut'], ax = ax, palette = sns.color_palette('magma', 7))\nax.set_title('Avg Price')\nax.set_xlabel('')\nax.tick_params('x', rotation = 70)\nax = plt.subplot2grid((1,2), (0,1), colspan = 2)\nsns.boxplot(x = 'Avg_pr_cut', y = 'rating_num', data = NCR, ax = ax, palette = sns.color_palette('magma', 7))\n\n\nplt.show()","613001b2":"Cities.head()","fcff5120":"* This plot suggests that, Majority of vote share goes to highly ranked restaurents. People tend to rank mostly high or low not much in he middle. Either they will like it or dislike it.\n\n##### Even in that, low rankers are voted less ( Most of people tend to vote only high)","902b38cc":"Showing Restaurents location on map for Gurgaon (Example).","76c3b885":"\n### 5. Price Range ","19601d13":"Humm... I need to see with the number of cuisine.","943a8464":"Modern Indian appeared at first in the 5 score! And continental(European) is majorly distributed in 4,5.","01acabeb":"**\"More Number of Cusine, Higer Rate Restaruant.\"**  \nCuisine is a complex variables. It contains two types, Country and Kind of Food. I maybe have to divide them into two variables, country_cu\/kind_cu. Most of restaraunt provided under 4 cusine, but More Number of Cusine, Higer Rate Restaruant.","a520373e":"- ID is unique, but Restuarant Name is overlapped.","b40b3893":"Following work is done on the top of existing work done by \n[https:\/\/www.kaggle.com\/caicell\/zomato-india-restaurants-eda](http:\/\/)\n\n\n---\n\n90% data  from India and out of which 80% data from New Delhi, Gurgaon and Nouda Combined. \n    1. 20% Data doesn't have rated values   2. Rating score distrubiton looked like Normal  3. 90% comes from India. \n\n\n---","f3be5fdb":"#### 1. Local K- Menas: Where high restaraunts gathered?","c8394ff9":"* Area 2 has been rated high in number of votes while Area 6 has received high average votes per restaurent.","9df2d3d5":"--This shows most of the restaurents belong to India only. So we should shift our focus to India","9c713a25":"90% Data belongs to india, so we will dig into india data only.","e4ebaac2":" **\"Where people pay attention more is more attractive and has higher score.\"  **\nThe Local 2,3 are slightly higher scores than the the suburbs area. And through the count of votes, we can find the center Area  1,2,3,5 are more attractive than the North and South of the city.   ","ce77c9e0":"What is the secret of the restaruant even the Price range and average price cut is small! Would they are hidden delicious restaruant? Such a factor maybe assist to develope model.","5974d5d7":"\n### 1. Train , Test\n\n - There are instances not rated. I will set those as Test Data.\n - Renaming Variables to make intutitive.","d8f1c78a":"[](http:\/\/)\"In general, the rating distribution is normal but in the highest score 4.9 has peak! We have to carefully see the condition of the highest restuarant\"","f6c5b0ce":"In india New Delhi, Gurgaon and Noida consist of majorty of Restaurents.i.e. nearly 85%. We can club these three under NCR (New Delhi Capital Region) as they are in close proximity.","202c0bff":"#### 0. Check Rating System","6c47c4e6":"This data has unstable rating variables. There are two variables, \"rating_cat\", \"rating_num\" for rating but sometimes they didn't indicate identical score. It is going to cause a severe harmful model.  \nThe reason, creating the difference between rating, looked like a small votes. I drop off the categorical varialbes and where the difference is 2. And make new categorical variables by round.","fa21f010":"\n### 4. Cusine Secret","cdf36593":"#### 2. Y_Normal Distribution","c716c2f5":"Distribution of Cuisines in numbers among all NCR restaurents.","edbbd3ca":"**\"A Special Avoid North\" **\nI coudln't say the high rated restuarant avoided in a certain area by one criterion (3.5, which is a round position). But at the bottom left graph 5_area indicates that there are no 5 scores in North Part. And remind the suburbs area North\/South having lower rate. A Total Scatter Graph and Blue scatter 3_area expressed the North\/South Area has lower rated restaraunt."}}