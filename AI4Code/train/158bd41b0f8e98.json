{"cell_type":{"7fd50b37":"code","2ed6c907":"code","12d9b52b":"code","6af96237":"code","79aec862":"code","b7c03bd7":"code","18b555f4":"code","f23ba137":"code","13022db8":"code","f573e6cc":"code","5305c701":"code","710a7e52":"code","a62e59fb":"code","73ec5d57":"code","a3db2ac7":"markdown","d2387598":"markdown","81abc637":"markdown","650f68b2":"markdown","f80f4c4b":"markdown","c069f153":"markdown","d5a3fbe1":"markdown"},"source":{"7fd50b37":"import numpy as np\nimport pandas as pd\n\n\nfrom xgboost import XGBClassifier\nfrom lightgbm import LGBMClassifier\nimport lightgbm as LGBM\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import accuracy_score, f1_score\n\nfrom catboost import CatBoostClassifier\nfrom sklearn.metrics import accuracy_score\nimport optuna\nfrom optuna.samplers import TPESampler\n\nimport matplotlib.pyplot as plt\nimport plotly.express as px\nimport seaborn as sns\nsns.set_theme(style=\"whitegrid\")\nsns.set(rc={'figure.figsize':(10,10)})\n\nimport warnings\nfrom sklearn.exceptions import ConvergenceWarning\n\nwarnings.simplefilter('always')\nwarnings.filterwarnings(\"ignore\")\n","2ed6c907":"df = pd.read_csv('\/kaggle\/input\/classification-of-malwares\/ClaMP_Integrated-5184.csv')\npd.set_option('display.max_columns',None)\npd.set_option('display.max_rows',None)","12d9b52b":"col = [i for i in df.columns if df[i].dtype != 'object' ]\nfile_header = [i for i in df.columns if 'FH_char' in i]\nOH_DLL = [i for i in df.columns if 'OH_DLL' in i]","6af96237":"corr = df.corr().stack().reset_index(name=\"correlation\")\ng = sns.relplot(\n    data=corr,\n    x=\"level_0\", y=\"level_1\", hue=\"correlation\", size=\"correlation\",\n    palette=\"vlag\", hue_norm=(-1, 1), edgecolor=\".7\",\n    height=10, sizes=(50, 250), size_norm=(-.2, .8))\ng.set(xlabel=\"\", ylabel=\"\", aspect=\"equal\")\ng.despine(left=True, bottom=True)\ng.ax.margins(.02)\nfor label in g.ax.get_xticklabels():\n    label.set_rotation(90)\nfor artist in g.legend.legendHandles:\n    artist.set_edgecolor(\".7\")\n\n    ","79aec862":"!pip install dabl\n","b7c03bd7":"import dabl\ndabl.plot(df,'class')","18b555f4":"y = df['class']\nX = df[col].drop(columns=['class'])","f23ba137":"from sklearn.model_selection import train_test_split\nX_train,X_test, y_train,y_test = train_test_split(X,y,test_size = 0.2)","13022db8":"'''import optuna\ndef objective(trial):\n\n    param = {\n        \"objective\": trial.suggest_categorical(\"objective\", [\"Logloss\", \"CrossEntropy\"]),\n        \"colsample_bylevel\": trial.suggest_float(\"colsample_bylevel\", 0.01, 0.1),\n        \"depth\": trial.suggest_int(\"depth\", 1, 12),\n        \"boosting_type\": trial.suggest_categorical(\"boosting_type\", [\"Ordered\", \"Plain\"]),\n        \"bootstrap_type\": trial.suggest_categorical(\n            \"bootstrap_type\", [\"Bayesian\", \"Bernoulli\", \"MVS\"]\n        ),\n        \"used_ram_limit\": \"3gb\",\n    }\n\n    if param[\"bootstrap_type\"] == \"Bayesian\":\n        param[\"bagging_temperature\"] = trial.suggest_float(\"bagging_temperature\", 0, 10)\n    elif param[\"bootstrap_type\"] == \"Bernoulli\":\n        param[\"subsample\"] = trial.suggest_float(\"subsample\", 0.1, 1)\n\n    gbm = CatBoostClassifier(**param)\n\n    gbm.fit(X_train, y_train, verbose=0, early_stopping_rounds=100)\n\n    preds = gbm.predict(X_test)\n    pred_labels = np.rint(preds)\n    accuracy = accuracy_score(y_test, pred_labels)\n    return accuracy\nstudy = optuna.create_study(direction=\"maximize\")\nstudy.optimize(objective, n_trials=15, timeout=600)\ntrial = study.best_trial\ncat_params = trial.params'''\n\ncat_params = {'objective': 'CrossEntropy',\n 'colsample_bylevel': 0.07720247769141655,\n 'depth': 10,\n 'boosting_type': 'Ordered',\n 'bootstrap_type': 'Bayesian',\n 'bagging_temperature': 8.769937329955644}","f573e6cc":"'''import optuna\ndef objective1(trial):\n    X_train,X_test,y_train,y_test = train_test_split(X,y,test_size=0.25)\n    dtrain = lgbm.Dataset(X_train, label=y_train)\n\n    param = {\n        \"objective\": \"binary\",\n        \"metric\": \"binary_logloss\",\n        \"verbosity\": -1,\n        \"boosting_type\": \"gbdt\",\n        \"lambda_l1\": trial.suggest_float(\"lambda_l1\", 1e-8, 10.0, log=True),\n        \"lambda_l2\": trial.suggest_float(\"lambda_l2\", 1e-8, 10.0, log=True),\n        \"num_leaves\": trial.suggest_int(\"num_leaves\", 2, 256),\n        \"feature_fraction\": trial.suggest_float(\"feature_fraction\", 0.4, 1.0),\n        \"bagging_fraction\": trial.suggest_float(\"bagging_fraction\", 0.4, 1.0),\n        \"bagging_freq\": trial.suggest_int(\"bagging_freq\", 1, 7),\n        \"min_child_samples\": trial.suggest_int(\"min_child_samples\", 5, 100),\n    }\n\n    gbm = lgbm.train(param, dtrain)\n    preds = gbm.predict(X_test)\n    pred_labels = np.rint(preds)\n    accuracy = accuracy_score(y_test, pred_labels)\n    return accuracy\nstudy1 = optuna.create_study(direction=\"maximize\")\nstudy1.optimize(objective1, n_trials=100)\ntrial1 = study1.best_trial\nlgbm_params = trial1.params'''\n\n\nlgbm_params = {'lambda_l1': 2.9518538351373698e-08,\n 'lambda_l2': 0.07086960074688683,\n 'num_leaves': 131,\n 'feature_fraction': 0.5523182028151434,\n 'bagging_fraction': 0.6074722133685865,\n 'bagging_freq': 4,\n 'min_child_samples': 26}","5305c701":"cb = CatBoostClassifier(**cat_params)\nlgbm = LGBMClassifier(**lgbm_params)","710a7e52":"LGBM.plot_tree(lgbm.fit(X_train,y_train),figsize=(100,100))","a62e59fb":"from sklearn.ensemble import StackingClassifier\nest = [('catboost', cb),('lgbm', lgbm)]\nsclf = StackingClassifier(estimators=est,final_estimator=cb)\nsclf.fit(X_train,y_train);\nprint('Stacking Completed')\n","73ec5d57":"from sklearn.metrics import classification_report\nprint(classification_report(y_test,sclf.predict(X_test)))","a3db2ac7":"## Dataset Split","d2387598":"# Classification of Malwares by PE Headers\n\n![HP](https:\/\/store.hp.com\/app\/assets\/images\/uploads\/prod\/how-to-remove-malware-on-windows-pc-hero1581530134837100.png)\n\n\n","81abc637":"# Stacking","650f68b2":"# CatBoost Hyperparameter Tuning","f80f4c4b":"# EDA","c069f153":"# LGBM Hyperparameter Tuning","d5a3fbe1":"## LGBM Tree"}}