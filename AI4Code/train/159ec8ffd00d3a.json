{"cell_type":{"ee9cc202":"code","4b6200bb":"code","2b377e49":"code","be566ef8":"code","6de0c73a":"code","553e521f":"code","b0ce6685":"code","f6a0f2a6":"code","7acd6129":"code","7a9454b9":"code","93ec2d2c":"code","36b0ebf1":"code","6adf257d":"code","68ad397c":"code","6cf7892e":"code","1fff12c6":"code","b3a496f6":"code","0eac532b":"code","6ef53121":"code","8e729063":"code","7456db42":"code","61022986":"code","8123d4ac":"code","c43caaef":"code","87c14509":"code","902b3b8a":"code","f4a161d6":"code","93f90a5d":"markdown","10c5a3f9":"markdown","db88a08a":"markdown","3e8b8cb8":"markdown","21a828f2":"markdown","7695fc85":"markdown","8d873426":"markdown","171116da":"markdown","688049b2":"markdown","4ea7fa97":"markdown","fe3309c2":"markdown","6533e892":"markdown","07cf8817":"markdown","d6433198":"markdown","22c9fcc2":"markdown","b82defe3":"markdown","417b0211":"markdown","2bd63abd":"markdown","8f498946":"markdown","cff2b08e":"markdown","3631b31e":"markdown","f22b054b":"markdown","8ab00dc2":"markdown","f95b00e0":"markdown","4cb78d23":"markdown","ae39e391":"markdown","5fc33537":"markdown","d457d3eb":"markdown","9efb472f":"markdown","b9e407f9":"markdown","29c1ca2b":"markdown","eeadfbd7":"markdown","50c9f0ed":"markdown","d0c0d774":"markdown","8a20d719":"markdown","3c504e29":"markdown","ea453a2d":"markdown","9a9e9a89":"markdown","7db7c482":"markdown","1b8e9bd9":"markdown","1c32c42a":"markdown","c689eef2":"markdown","9af7f737":"markdown","6c455c8e":"markdown","027d925e":"markdown","525dfe08":"markdown","ff735f27":"markdown","6e171741":"markdown","c8881aed":"markdown","582bb132":"markdown","dceee81c":"markdown","df5f7455":"markdown","033cb859":"markdown","d503a4e0":"markdown"},"source":{"ee9cc202":"# Import all required modules\nimport pandas as pd\nimport numpy as np\n\n# Disable warnings\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n\n# Import plotting modules\nimport seaborn as sns\nsns.set()\nimport matplotlib\nimport matplotlib.pyplot as plt\nimport matplotlib.ticker","4b6200bb":"# Tune the visual settings for figures in `seaborn`\nsns.set_context(\n    \"notebook\", \n    font_scale=1.5,       \n    rc={ \n        \"figure.figsize\": (11, 8), \n        \"axes.titlesize\": 18 \n    }\n)\n\nfrom matplotlib import rcParams\nrcParams['figure.figsize'] = 11, 8","2b377e49":"df = pd.read_csv('..\/input\/mlbootcamp5_train.csv')\nprint('Dataset size: ', df.shape)\ndf.head()","be566ef8":"df_uniques = pd.melt(frame=df, value_vars=['gender','cholesterol', \n                                           'gluc', 'smoke', 'alco', \n                                           'active', 'cardio'])\ndf_uniques = pd.DataFrame(df_uniques.groupby(['variable', \n                                              'value'])['value'].count()) \\\n    .sort_index(level=[0, 1]) \\\n    .rename(columns={'value': 'count'}) \\\n    .reset_index()\n\nsns.factorplot(x='variable', y='count', hue='value', \n               data=df_uniques, kind='bar', size=12);","6de0c73a":"df_uniques = pd.melt(frame=df, value_vars=['gender','cholesterol', \n                                           'gluc', 'smoke', 'alco', \n                                           'active'], \n                     id_vars=['cardio'])\ndf_uniques = pd.DataFrame(df_uniques.groupby(['variable', 'value', \n                                              'cardio'])['value'].count()) \\\n    .sort_index(level=[0, 1]) \\\n    .rename(columns={'value': 'count'}) \\\n    .reset_index()\n\nsns.factorplot(x='variable', y='count', hue='value', \n               col='cardio', data=df_uniques, kind='bar', size=9);","553e521f":"for c in df.columns:\n    n = df[c].nunique()\n    print(c)\n    if n <= 3:\n        print(n, sorted(df[c].value_counts().to_dict().items()))\n    else:\n        print(n)\n    print(10 * '-')","b0ce6685":"df.groupby('gender')['height'].mean()","f6a0f2a6":"df.groupby('gender')['alco'].mean()","7acd6129":"df.groupby('gender')['smoke'].mean()","7a9454b9":"round(100 * (df.loc[df['gender'] == 2, 'smoke'].mean() - df.loc[df['gender'] == 1, 'smoke'].mean()))","93ec2d2c":"df.groupby('smoke')['age'].median() \/ 365.25","36b0ebf1":"(df[df['smoke'] == 0]['age'].median() - \n df[df['smoke'] == 1]['age'].median()) \/ 365.25 * 12","6adf257d":"df['age_years'] = (df['age'] \/ 365.25).round().astype('int')","68ad397c":"df['age_years'].max()","6cf7892e":"smoking_old_men = df[(df['gender'] == 2) & (df['age_years'] >= 60)\n                    & (df['age_years'] < 65) & (df['smoke'] == 1)]","1fff12c6":"smoking_old_men[(smoking_old_men['cholesterol'] == 1) &\n               (smoking_old_men['ap_hi'] < 120)]['cardio'].mean()","b3a496f6":"smoking_old_men[(smoking_old_men['cholesterol'] == 3) &\n               (smoking_old_men['ap_hi'] >= 160) &\n               (smoking_old_men['ap_hi'] < 180)]['cardio'].mean()","0eac532b":"df['BMI'] = df['weight'] \/ (df['height'] \/ 100) ** 2","6ef53121":"df['BMI'].median()","8e729063":"df.groupby('gender')['BMI'].median()","7456db42":"df.groupby(['gender', 'alco', 'cardio'])['BMI'].median().to_frame()","61022986":"filtered_df = df[(df['ap_lo'] <= df['ap_hi']) & \n                 (df['height'] >= df['height'].quantile(0.025)) &\n                 (df['height'] <= df['height'].quantile(0.975)) &\n                 (df['weight'] >= df['weight'].quantile(0.025)) & \n                 (df['weight'] <= df['weight'].quantile(0.975))]\nprint(filtered_df.shape[0] \/ df.shape[0])","8123d4ac":"# Calculate the correlation matrix\ndf = filtered_df.copy()\n\ncorr = df.corr(method='pearson')\n\n# Create a mask to hide the upper triangle of the correlation matrix (which is symmetric)\nmask = np.zeros_like(corr, dtype=np.bool)\nmask[np.triu_indices_from(mask)] = True\n\nf, ax = plt.subplots(figsize=(12, 9))\n\nsns.heatmap(corr, mask=mask, vmax=1, center=0, annot=True, fmt='.1f',\n            square=True, linewidths=.5, cbar_kws={\"shrink\": .5});","c43caaef":"df_melt = pd.melt(frame=df, value_vars=['height'], id_vars=['gender'])\n\nplt.figure(figsize=(12, 10))\nax = sns.violinplot(\n    x='variable', \n    y='value', \n    hue='gender', \n    palette=\"muted\", \n    split=True, \n    data=df_melt, \n    scale='count',\n    scale_hue=False\n)","87c14509":"sns.FacetGrid(df, hue=\"gender\", size=12) \\\n   .map(sns.kdeplot, \"height\").add_legend();","902b3b8a":"# Calculate the correlation matrix\ncorr = df[['id', 'age', 'height', 'weight', \n           'ap_hi', 'ap_lo', 'cholesterol', \n           'gluc']].corr(method='spearman')\n\n# Create a mask to hide the upper triangle of the correlation matrix (which is symmetric)\nmask = np.zeros_like(corr, dtype=np.bool)\nmask[np.triu_indices_from(mask)] = True\n\nf, ax = plt.subplots(figsize=(12, 10))\n\n# Plot the heatmap using the mask and correct aspect ratio\nsns.heatmap(corr, mask=mask, vmax=1, center=0, annot=True, fmt='.2f',\n            square=True, linewidths=.5, cbar_kws={\"shrink\": .5});","f4a161d6":"sns.countplot(x=\"age_years\", hue='cardio', data=df);","93f90a5d":"### Solution:","10c5a3f9":"It would be instructive to peek into the values of our variables.\n \nLet's convert the data into *long* format and depict the value counts of the categorical features using [`factorplot()`](https:\/\/seaborn.pydata.org\/generated\/seaborn.factorplot.html).","db88a08a":"**Question 2.4. (1 point).** At what age does the number of people with CVD outnumber the number of people without CVD for the first time?\n\n1. 44\n2. 55\n3. 64\n4. 70","3e8b8cb8":"Well... obvious :)","21a828f2":"First statement is incorrect since median BMI exceeds the norm of 25 points.","7695fc85":"## 1.4. Cleaning data","8d873426":"### Task:\n\nCreate two [`kdeplot`](https:\/\/seaborn.pydata.org\/generated\/seaborn.kdeplot.html)s of the *height* feature for each gender on the same chart. You will see the difference between the genders more clearly, but you will be unable to evaluate the number of records in each of them.\n\n### Solution:","171116da":"**Answer:** 2.","688049b2":"# Part 2. Visual data analysis\n\n## 2.1. Correlation matrix visualization\n\nTo understand the features better, you can create a matrix of the correlation coefficients between the features. Use the initial dataset (non-filtered).\n\n### Task:\n\nPlot a correlation matrix using [`heatmap()`](http:\/\/seaborn.pydata.org\/generated\/seaborn.heatmap.html). You can create the matrix using the standard `pandas` tools with the default parameters.\n\n### Solution:","4ea7fa97":"We've thrown out about 10% of the original data.","fe3309c2":"### Task:\nWe can notice, that the data is not perfect. It contains much of \"dirt\" and inaccuracies. We'll see it better when we do data visualization.\n\nFilter out the following patient segments (that we consider to have erroneous data)\n\n- diastilic pressure is higher then systolic. \n- height is strictly less than 2.5%-percentile (use `pd.Series.quantile`. If not familiar with it \u2013 please read the docs)\n- height is strictly more than 97.5%-percentile\n- weight is strictly less then 2.5%-percentile\n- weight is strictly more than 97.5%-percentile\n\nThis is not all we can do to clean the data, but let's stop here by now.\n\n**Question 1.7. (2 points). How many percents of data (rounded) did we throw away?**\n\n1. 8\n2. 9\n3. 10\n4. 11\n\n**Answer:** 3\n\n### Solution:","6533e892":"161 cm and almost 170 cm on average, so we make a conclusion that gender=1 represents females, and gender=2 \u2013 males. So the sample contains 45530 women \u0438 24470 men.","07cf8817":"Third statement is incorrect.","d6433198":"To make it simple, we will work only with the training part of the dataset:","22c9fcc2":"### Solution:","b82defe3":"## 1.2. Risk maps\n### Task:","417b0211":"## 2.3. Rank correlation\n\nIn most cases, *the Pearson coefficient of linear correlation* is more than enough to discover patterns in data. \nBut let's go a little further and calculate a [rank correlation](https:\/\/en.wikipedia.org\/wiki\/Rank_correlation). It will help us to identify such feature pairs in which the lower rank in the variational series of one feature always precedes the higher rank in the another one (and we have the opposite in the case of negative correlation).\n\n### Task:\n\nCalculate and plot a correlation matrix using the [Spearman's rank correlation coefficient](https:\/\/en.wikipedia.org\/wiki\/Spearman%27s_rank_correlation_coefficient).\n\n### Solution:","2bd63abd":"**Question 2.2. (1 point).** Which pair of features has the strongest Spearman correlation?\n\n1. Height, Weight\n2. Age, Weight\n3. Cholesterol, Gluc\n4. Cardio, Cholesterol\n5. Ap_hi, Ap_lo\n6. Smoke, Alco","8f498946":"**Question 2.3. (1 point).** Why does these features have strong rank correlation?\n\n1. Inaccuracies in the data (data acquisition errors).\n2. Relation is wrong, these features should not be related.\n3. Nature of the data.","cff2b08e":"On the web site of European Society of Cardiology, a [SCORE scale](https:\/\/www.escardio.org\/Education\/Practice-Tools\/CVD-prevention-toolbox\/SCORE-Risk-Charts) is given. It is used for calculating the risk of death from a cardiovascular decease in the next 10 years. Here it is:\n\n<img src='..\/..\/img\/SCORE_CVD_eng.png' width=60%>\n\nLet's take a look at the upper-right rectangle showing a subset of smoking men aged from 60 to 65. (It's not obvious, but the values in figure represent the upper boundary).\n\nWe see a value 9 in the lower-left corner of the rectangle and 47 in the upper-right. This means that for people in this gender-age group whose systolic pressure is less than 120 the risk of a CVD is estimated to be 5 times lower than for those with the pressure in the interval [160,180).\n\nLet's calculate the same ratio, but with our data.\n\nClarifications:\n- Calculate ``age_years`` feature \u2013 rounded age in years. For this task, select people aged from 60 to 64 inclusive.\n- Cholesterol level categories in the figure and in our data are different. In the figure, the values of ``cholesterol`` feature are as follows: 4 mmol\/l $\\rightarrow$ 1, 5-7 mmol\/l $\\rightarrow$ 2, 8 mmol\/l $\\rightarrow$ 3.\n\n**Question 1.5. (2 points). Calculate fractions of ill people (with CVD) in two segments described above. What's the quotient of these two fractions?**\n\n1. 1\n2. 2\n3. 3\n4. 4\n\n**Answer:** 3.","3631b31e":"**Question 1.4. (1 point). What's the rounded difference between median values of age (in months) for smokers and non-smokers? You'll need to figure out the units of feature `age` in this dataset.**\n\n1. 5\n2. 10\n3. 15\n4. 20\n\n**Answer:** 4.","f22b054b":"## 1.3. Analyzing BMI\n### Task:","8ab00dc2":"# <center>Assignment #2 (demo). Solution\n## <center>Analyzing cardiovascular disease data","f95b00e0":"**Question 1.3. (1 point). What's the rounded difference between the percentages of smokers among men and women?**\n1. 4\n2. 16\n3. 20\n4. 24\n\n**Answer:** 3.","4cb78d23":"Age is given here in days.","ae39e391":"**Question 2.1. (1 point).** Which pair of features has the strongest Pearson's correlation with the *gender* feature?\n\n1. Cardio, Cholesterol\n2. Height, Smoke\n3. Smoke, Alco\n4. Height, Weight","5fc33537":"### Task:\n\nCreate a *count plot* using [`countplot()`](http:\/\/seaborn.pydata.org\/generated\/seaborn.countplot.html), with the age on the *X* axis and the number of people on the *Y* axis. Each value of the age should have two columns corresponding to the numbers of people of this age for each *cardio* class.\n\n### Solution:","d457d3eb":"**Question 1.2. (1 point). Who more often report consuming alcohol - men or women?**\n1. women\n2. men\n\n**Answer:** 2.","9efb472f":"### Solution:","b9e407f9":"<center>\n<img src=\"https:\/\/habrastorage.org\/files\/fd4\/502\/43d\/fd450243dd604b81b9713213a247aa20.jpg\">\n\n## [mlcourse.ai](https:\/\/mlcourse.ai) - Open Machine Learning Course\n    \nAuthors: [Ilya Baryshnikov](https:\/\/www.linkedin.com\/in\/baryshnikov-ilya\/), [Maxim Uvarov](https:\/\/www.linkedin.com\/in\/maxis42\/), and [Yury Kashnitsky](https:\/\/www.linkedin.com\/in\/festline\/). Translated and edited by [Inga Kaydanova](https:\/\/www.linkedin.com\/in\/inga-kaidanova-a92398b1\/), [Egor Polusmak](https:\/\/www.linkedin.com\/in\/egor-polusmak\/), [Anastasia Manokhina](https:\/\/www.linkedin.com\/in\/anastasiamanokhina\/), and [Yuanyuan Pao](https:\/\/www.linkedin.com\/in\/yuanyuanpao\/). All content is distributed under the [Creative Commons CC BY-NC-SA 4.0](https:\/\/creativecommons.org\/licenses\/by-nc-sa\/4.0\/) license.","29c1ca2b":"### Solution:","eeadfbd7":"## 1.1. Basic observations","50c9f0ed":"Let's calculate average height for both values of `gender`:","d0c0d774":"**Answer:** 3.","8a20d719":"You can see that the target variable greatly affects the distribution of cholesterol and glucose levels. Is this a coincidence?\n\nNow, let's calculate some statistics for the feature unique values:","3c504e29":"**Answer:** 5.","ea453a2d":"In this assignment, you will answer questions about a dataset on cardiovascular disease. You do not need to download the data: it is already in the repository. There are some Tasks that will require you to write code. Complete them and then answer the questions in the [form](https:\/\/docs.google.com\/forms\/d\/13cE_tSIb6hsScQvvWUJeu1MEHE5L6vnxQUbDYpXsf24).\n\n#### Problem\n\nPredict presence or absence of cardiovascular disease (CVD) using the patient examination results.\n\n#### Data description\n\nThere are 3 types of input features:\n\n- *Objective*: factual information;\n- *Examination*: results of medical examination;\n- *Subjective*: information given by the patient.\n\n| Feature | Variable Type | Variable      | Value Type |\n|---------|--------------|---------------|------------|\n| Age | Objective Feature | age | int (days) |\n| Height | Objective Feature | height | int (cm) |\n| Weight | Objective Feature | weight | float (kg) |\n| Gender | Objective Feature | gender | categorical code |\n| Systolic blood pressure | Examination Feature | ap_hi | int |\n| Diastolic blood pressure | Examination Feature | ap_lo | int |\n| Cholesterol | Examination Feature | cholesterol | 1: normal, 2: above normal, 3: well above normal |\n| Glucose | Examination Feature | gluc | 1: normal, 2: above normal, 3: well above normal |\n| Smoking | Subjective Feature | smoke | binary |\n| Alcohol intake | Subjective Feature | alco | binary |\n| Physical activity | Subjective Feature | active | binary |\n| Presence or absence of cardiovascular disease | Target Variable | cardio | binary |\n\nAll of the dataset values were collected at the moment of medical examination.","9a9e9a89":"Comparing BMI values in rows where `alco=0` and `cardio=0`, we see that the last statement is correct.","7db7c482":"**Question 1.1. (1 point). How many men and women are present in this dataset? Values of the `gender` feature were not expailned (whether \"1\" stands for women or men) \u2013 figure this out by looking analyzing height, reasonably assuming that on average men are taller.**\n1. 45530 women \u0438 24470 men\n2. 45530 men \u0438 24470 women\n3. 45470 women \u0438 24530 men\n4. 45470 men \u0438 24530 women\n\n**Answer:** 1.","1b8e9bd9":"## 2.2. Height distribution of men and women\n\nFrom our exploration of the unique values we know that the gender is encoded by the values *1* and *2*. And though you don't have a specification of how these values correspond to men and women, you can figure that out graphically by looking at the mean values of height and weight for each value of the *gender* feature.\n\n### Task:\n\nCreate a violin plot for the height and gender using [`violinplot()`](https:\/\/seaborn.pydata.org\/generated\/seaborn.violinplot.html). Use the parameters:\n- `hue` to split by gender;\n- `scale` to evaluate the number of records for each gender.\n\nIn order for the plot to render correctly, you need to convert your `DataFrame` to *long* format using the `melt()` function from `pandas`. Here is [another example](https:\/\/stackoverflow.com\/a\/41575149\/3338479) of this.\n\n### Solution:","1c32c42a":"Median age of smokers is 52.4 years, for non-smokers it's 54. We see that the correct answer is 20 months. But here is a way to calculate it exactly:","c689eef2":"In the end, we have:\n- 5 numerical features (excluding *id*);\n- 7 categorical features;\n- 70000 records in total.","9af7f737":"**Answer:** 2.","6c455c8e":"## 2.4. Age\n\nPreviously we calculated the age of the respondents in years at the moment of examination.","027d925e":"You should use the `seaborn` library for visual analysis, so let's set it up too:","525dfe08":"If cholesterol level in this age group is 1, and systolic pressure is below 120, then the proportion of people with  CVD is 26%.","ff735f27":"As a result, the difference is approximately 3-fold. Not 5-fold, as the SCORE scale tells us, but it's possible that the SCORE risk of CVD is nonlinearly dependent on the proportion of ill people in the given age group.","6e171741":"We can see that the target classes are balanced. That's great!\n\nLet's split the dataset by target values: sometimes you can immediately spot the most significant feature on the plot.","c8881aed":"If, however, cholesterol level in this age group is 3, and systolic pressure is from 160 to 180, then the proportion of people with a CVD is 86%.","582bb132":"Let's get to know our data by performing a preliminary data analysis.\n\n#  Part 1. Preliminary data analysis\n\nFirst, we will initialize the environment:","dceee81c":"The oldest people in the sample are aged 65. Coincidence? Don't think so! Let's select smoking men of age [60,64].","df5f7455":"Seconds statement is correct \u2013 women's BMI is higher on average.","033cb859":"Create a new feature \u2013 BMI ([Body Mass Index](https:\/\/en.wikipedia.org\/wiki\/Body_mass_index)). To do this, divide weight in kilogramms by the square of height in meters. Normal BMI values are said to be from 18.5 to 25. \n\n**Question 1.6. (2 points). Choose the correct statements:.**\n\n1. Median BMI in the sample is within boundaries of normal values.\n2. Women's BMI is on average higher then men's.\n3. Healthy people have, on average, higher BMI than ill people.\n4. In the segment of healthy and non-drinking men BMI is closer to the norm than in the segment of healthy and non-drinking women\n\n**Answer:** 2 and 4\n\n### Solution:","d503a4e0":"### Solution:"}}