{"cell_type":{"d82f28bd":"code","e1f3d235":"code","6b024b70":"code","0db2f985":"code","02e9c9db":"code","1477f7ed":"code","7eaaf8a6":"code","c733bc81":"code","65d89900":"code","5621deeb":"code","f21c681d":"code","c010305c":"code","392feb4c":"code","f3e0354f":"code","c30b46a2":"code","a92029ab":"code","f8470cc4":"code","cdc72392":"code","31ef4040":"markdown","db64fd2a":"markdown","6f083a23":"markdown","0a2072f1":"markdown","82a70d7b":"markdown","059028bd":"markdown","62d080a9":"markdown","538081de":"markdown","93322f9d":"markdown"},"source":{"d82f28bd":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\nimport warnings\nwarnings.filterwarnings('ignore')\nwarnings.filterwarnings('ignore', category=DeprecationWarning)\nimport datatable as dt\nimport gc\nfrom sklearn.ensemble import RandomForestRegressor\nimport eli5\nfrom eli5.sklearn import PermutationImportance\nimport numpy as np\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","e1f3d235":"%%time\n# read large vol data by datatable\n\ntrain_data_datatable = dt.fread('\/kaggle\/input\/jane-street-market-prediction\/train.csv')\ntrain = train_data_datatable.to_pandas()\ntrain.head()","6b024b70":"features = pd.read_csv('\/kaggle\/input\/jane-street-market-prediction\/features.csv',index_col=0)\nfeatures","0db2f985":"test = pd.read_csv('\/kaggle\/input\/jane-street-market-prediction\/example_test.csv')\ntest.head()","02e9c9db":"# Show Data Types\nprint(\"Train data set dtypes: \\n\")\nprint(f\"Total Cols: {len(train.columns)}\")\nprint(f\"{train.dtypes.value_counts()}\")\nprint('-'*30)\n\nprint(\"Features data set dtypes: \\n\")\nprint(f\"Total Cols: {len(features.columns)}\")\nprint(f\"{features.dtypes.value_counts()}\")\nprint('-'*30)\n\nprint(\"Test data set dtypes: \\n\")\nprint(f\"Total Cols: {len(test.columns)}\")\nprint(f\"{test.dtypes.value_counts()}\")","1477f7ed":"# first look for the cumulative values of resp over time\nfig, ax = plt.subplots(figsize=(15, 5))\nbalance= pd.Series(train['resp']).cumsum()\nax.set_xlabel (\"Trade\", fontsize=18)\nax.set_ylabel (\"Cumulative resp\", fontsize=18);\nbalance.plot(lw=3);\ndel balance\ngc.collect();","7eaaf8a6":"# drop variables that are not applied in the analysis\ntrain.drop(['resp_1','resp_2','resp_3','resp_4'],axis=1, inplace =True)\ntrain.head()","c733bc81":"# set ts_id as index\ntrain.set_index(['ts_id'])","65d89900":"# check dist of target variable\nsns.distplot(train['resp'],axlabel='Histogram of the resp values')","5621deeb":"print(\"Skew of resp is:      %.2f\" %train['resp'].skew() )\nprint(\"Kurtosis of resp is: %.2f\"  %train['resp'].kurtosis() )\n\n# This distribution has very long tails","f21c681d":"# check dist of date\nsns.distplot(train['date'])","c010305c":"%%time\n# find pairs of features with high correlation in day_0 (not whole dataset)\nday_0 = train.loc[train['date'] == 0]\nplt.figure(figsize=(130,130))\nsns.heatmap(day_0.loc[:,'feature_0':'feature_129'].corr(),annot=True,cmap='viridis',linewidths=.5)","392feb4c":"%%time\ndef get_redundant_pairs(df):\n\n    pairs_to_drop = set()\n    cols = df.columns\n    for i in range(0, df.shape[1]):\n        for j in range(0, i+1):\n            pairs_to_drop.add((cols[i], cols[j]))\n    return pairs_to_drop\n\ndef get_top_abs_correlations(df, n):\n    \n    au_corr = df.corr().abs().unstack()\n    labels_to_drop = get_redundant_pairs(df)\n    au_corr = au_corr.drop(labels=labels_to_drop).sort_values(ascending=False)\n    return au_corr[0:n]\n\nprint(\"Top Absolute Correlations\")\nprint(get_top_abs_correlations(day_0, 50))","f3e0354f":"%%time\n# convert features dataframe to binary\nfeatures= features*1\n# plot a transposed dataframe\nfeatures.T.style.background_gradient(cmap='Oranges')","c30b46a2":"tag_sum = pd.DataFrame(features.T.sum(axis=0),columns=['Number of tags'])\ntag_sum.T","a92029ab":"X_train = day_0.loc[:,'feature_0':'feature_129']\nX_train = X_train.fillna(X_train.mean())\ny_train = day_0[\"resp\"]","f8470cc4":"%%time\n# quick Permutation Importance using the Random Forest\nregressor = RandomForestRegressor(max_features='auto')\nregressor.fit(X_train, y_train)\nperm_import = PermutationImportance(regressor, random_state=1).fit(X_train, y_train)\n# visualize the results\neli5.show_weights(perm_import, top=50, feature_names = X_train.columns.tolist())","cdc72392":"%%time\n# missing values\nn_features = 50\nnan_val = train.isna().sum()[train.isna().sum() > 0].sort_values(ascending=False)\nprint(nan_val)\nfig, axs = plt.subplots(figsize=(10, 10))\nsns.barplot(y = nan_val.index[0:n_features], \n            x = nan_val.values[0:n_features], \n            alpha = 0.8\n           )\nplt.title('Missing values of train dataset')\nplt.xlabel('# of Missing values')\nplt.show()","31ef4040":"### <center style=\"background-color:white; width:150px;\">References<\/center>\nJane Street Market EDA: https:\/\/www.kaggle.com\/blurredmachine\/jane-street-market-eda-viz-prediction\n\nJane Street: EDA of day 0 and feature importance: https:\/\/www.kaggle.com\/carlmcbrideellis\/jane-street-eda-of-day-0-and-feature-importance","db64fd2a":"<a id=\"4\"><\/a>\n## <center style=\"background-color:#656d73; color:white;\">Exploratory Data Analysis \ud83d\udcca<\/center>","6f083a23":"<a id=\"1000\"><\/a>\n\n<center><h2>Notebook Under Development<\/h2><\/center>\n<img src=\"https:\/\/cdn1.iconfinder.com\/data\/icons\/construction-220\/64\/43-512.png\" width=100 height=100>\n<center><h4>I hope it was helpful!!<\/h4><\/center>\n","0a2072f1":"<a id=\"2\"><\/a>\n## <center style=\"background-color:#656d73; color:white;\">Importing Data \u270d<\/center>\n\n<center><img src=\"https:\/\/media.licdn.com\/dms\/image\/C4E1BAQHbbXAVafylxA\/company-background_10000\/0?e=2159024400&v=beta&t=k-Znz1NioMxVcmnZULjORawONhIWxh3oj82qEkhTXrw\" width=30%><\/center>","82a70d7b":"### [Back to the Top \ud83d\udc46](#1)","059028bd":"## <center style=\"background-color:#656d73; color:white;\">Contents in the Notebook <\/center>\n1. [Import Libraries \ud83d\udcda](#1)\n2. [Import dataset \u270d](#2)\n3. [Understanding Data Features \ud83d\udcc8](#3)\n4. [Exploratory Data Analysis (EDA) \ud83d\udcca](#4)","62d080a9":"<a id=\"0\"><\/a>\n# <center style=\"background-color:#656d73; color:white;\">Jane Street Market Prediction<\/center>\n\n<center><img src=\"https:\/\/www.janestreet.com\/assets\/logo_horizontal.png\" width=70%><\/center>","538081de":"<a id=\"3\"><\/a>\n## <center style=\"background-color:#656d73; color:white;\">Understanding Data Features \ud83d\udcc8<\/center>","93322f9d":"<a id=\"1\"><\/a>\n## <center style=\"background-color:#656d73; color:white;\">Import Libraries \ud83d\udcda<\/center>"}}