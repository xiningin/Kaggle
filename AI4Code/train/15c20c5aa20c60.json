{"cell_type":{"528bf0bd":"code","0b9ea8cb":"code","3bd92853":"code","a480bd05":"code","7d2d1ffc":"code","21a32f7b":"code","2d2cd98a":"code","2a3f6a08":"code","c091fca5":"code","2a4ccf70":"code","6dba779a":"code","537c9cc4":"code","c143ce14":"code","26257d6b":"code","b763fab9":"code","9a69a384":"code","28a4b3c1":"code","7423fd00":"code","89e4cb6e":"code","727c8bd1":"code","994b15b0":"code","bc8b8134":"code","711a6723":"code","5b0e00c8":"code","1ba1d7ce":"code","03650b05":"code","4cb6b508":"code","2f672d0a":"code","661dbd4d":"code","eab99c40":"code","32f0e2db":"code","317d38ff":"code","f1b95216":"code","fedc8a5f":"code","ce758489":"code","f66cdb14":"code","70a20a22":"markdown","2918f8c9":"markdown","8a240369":"markdown","3aa5510b":"markdown","fe2502dd":"markdown","bd31e75d":"markdown","cb30e225":"markdown","4f3da7aa":"markdown","317b0a03":"markdown","6885ceb4":"markdown","a3540215":"markdown","40aace55":"markdown","0360694c":"markdown","52b753b9":"markdown","9ce318d2":"markdown","1ff3e892":"markdown","6487a4ff":"markdown","6eb948f1":"markdown","b9840b6c":"markdown","e1be39f3":"markdown","89d58356":"markdown","ac339eae":"markdown","17267cc3":"markdown","9ffb5b97":"markdown","fa71f184":"markdown","0ddad32a":"markdown"},"source":{"528bf0bd":"import pandas as pd\nimport numpy as np  \nimport seaborn as sns \npal = sns.color_palette()\nfrom wordcloud import WordCloud\nimport plotly.express as px\nimport matplotlib.pyplot as plt\n%matplotlib inline\nfrom sklearn import preprocessing\nimport glob\nimport plotly.offline as py\nimport plotly.graph_objs as go\nimport plotly.tools as tls\nfrom keras.models import Sequential\nfrom tensorflow.keras.layers import Activation, Dense, Dropout","0b9ea8cb":"districts_data = pd.read_csv(\"..\/input\/learnplatform-covid19-impact-on-digital-learning\/districts_info.csv\")","3bd92853":"districts_data.head()","a480bd05":"districts_data.shape","7d2d1ffc":"districts_data.info()","21a32f7b":"districts_data.dtypes","2d2cd98a":"districts_data = districts_data.drop_duplicates()","2a3f6a08":"len(districts_data)","c091fca5":"plt.figure(figsize=(12,10));\nsns.countplot(x=districts_data.state);\nplt.xticks(rotation=90);","2a4ccf70":"districts_data[\"state\"].value_counts().head(15).plot(kind = 'pie', autopct='%1.1f%%', figsize=(10, 10), startangle=0).legend();","6dba779a":"plt.figure(figsize=(12,10));\nsns.countplot(x=districts_data.locale);\nplt.xticks(rotation=90);","537c9cc4":"districts_data[\"locale\"].value_counts().head(10).plot(kind = 'pie', autopct='%1.1f%%', figsize=(10, 10)).legend();","c143ce14":"sns.countplot(data= districts_data, x = \"pct_black\/hispanic\");\nplt.show();","26257d6b":"sns.countplot(data= districts_data, x = \"pct_free\/reduced\");\nplt.show();","b763fab9":"sns.countplot(data= districts_data, x = \"county_connections_ratio\");\nplt.show();","9a69a384":"plt.figure(figsize=(12,10));\nsns.countplot(x=districts_data.pp_total_raw);\nplt.xticks(rotation=90);","28a4b3c1":"products_data = pd.read_csv(\"..\/input\/learnplatform-covid19-impact-on-digital-learning\/products_info.csv\")\n#products_data","7423fd00":"products_data.head()","89e4cb6e":"plt.tight_layout();\nproducts_data[\"Sector(s)\"].value_counts().head(10).plot(kind = 'pie', autopct='%1.1f%%', \n                                                        figsize=(10, 10), startangle=0,\n                                                        labeldistance=1.1,pctdistance=0.5).legend();","727c8bd1":"plt.figure(figsize=(12,10));\nsns.countplot(x=products_data[\"Primary Essential Function\"]);\nplt.xticks(rotation=90);","994b15b0":"CSV_files=pd.DataFrame()\naddress = glob.glob('..\/input\/learnplatform-covid19-impact-on-digital-learning\/engagement_data\/*.csv')\ncount=0\nfor i in address:\n    with open(i, \"rb\") as data_of_files:\n        data=pd.read_csv(data_of_files)\n        CSV_files=pd.concat([CSV_files,data], axis=0)\n        count=count+1\n        if count==233:\n            break  \nCSV_files","bc8b8134":"CSV_files.hist(figsize=(20,20),bins = 20, color=\"blue\")\nplt.title(\"Numeric Features Distribution\");\nplt.show();","711a6723":"colormap = plt.cm.magma\nplt.figure(figsize=(14,12));\nplt.title('Pearson Correlation of Features', y=1.05, size=15);\nsns.heatmap(CSV_files.corr(),linewidths=0.1,vmax=1.0, \n            square=True, cmap=colormap, linecolor='white', annot=True);","5b0e00c8":"data_total = CSV_files.isnull().sum()\ndata_percent = ((CSV_files.isnull().sum()\/CSV_files.shape[0])*100).round(2)\nmissing_data = pd.concat([data_total, data_percent],\n                                axis=1, \n                                keys=['Data_Total', 'Data_Percent %'],\n                                sort = True)\nmissing_data.style.bar(color = ['red'])","1ba1d7ce":"CSV_files['time'] = pd.to_datetime(CSV_files['time'])","03650b05":"print(products_data[\"LP ID\"].nunique())\nprint(CSV_files[\"lp_id\"].nunique())","4cb6b508":"products_engagement_data = pd.merge(products_data,CSV_files, \n                                    left_on='LP ID', right_on='lp_id')\nproducts_engagement_data.head()","2f672d0a":"del CSV_files","661dbd4d":"path = '..\/input\/learnplatform-covid19-impact-on-digital-learning\/engagement_data' \nall_files = glob.glob(path + \"\/*.csv\")\n\nli = []\n\nfor filename in all_files:\n    df = pd.read_csv(filename, index_col=None, header=0)\n    district_id = filename.split(\"\/\")[4].split(\".\")[0]\n    df[\"district_id\"] = district_id\n    li.append(df)\n    \nengagement_data = pd.concat(li)\nengagement_data = engagement_data.reset_index(drop=True)\nengagement_data.head()","eab99c40":"print(engagement_data[\"district_id\"].nunique())\nprint(districts_data[\"district_id\"].nunique())","32f0e2db":"engagement_data[\"district_id\"] = engagement_data[\"district_id\"].astype(str).astype(int)\ndistricts_engagement_data = pd.merge(districts_data, engagement_data, left_on='district_id', right_on='district_id')\ndistricts_engagement_data.head()","317d38ff":"def plot_time_series(df,col1,col2,col3):\n    max_list = df[[col1,col2]]\\\n        .groupby([col1])[col2].mean()\\\n        .sort_values(ascending=False).index[:5].tolist()\n\n    df = df[df[col1].isin(max_list)]\\\n                    .reset_index(drop=True)[[col3, col1, col2]]\n    df = df.pivot_table(index=col3, columns=col1, values=col2)\n\n    fig = px.line(df, facet_col=col1, facet_col_wrap=1, width=800, height=800)\n    fig.update_layout(\n                      title=(col1 + \" , \" + col2 + \" , \" + col3).title(),\n                      title_x=0.39,\n                      template=\"plotly\",\n                      paper_bgcolor='#f5f7f7',\n                      font = {'family': 'Serif', 'size': 15}\n                     )\n    fig.show()","f1b95216":"plot_time_series(districts_engagement_data,\"state\",\"pct_access\",\"time\")\nplot_time_series(districts_engagement_data,\"state\",\"engagement_index\",\"time\")\nplot_time_series(districts_engagement_data,\"locale\",\"pct_access\",\"time\")\nplot_time_series(districts_engagement_data,\"locale\",\"engagement_index\",\"time\")","fedc8a5f":"from geopy.geocoders import Nominatim\ngeolocator = Nominatim(user_agent=\"Ruch\")\n\ndef feature_generation(df):\n    lat=[]\n    long=[]\n    for i in df['state']: \n        location = geolocator.geocode(i)\n        try:\n            lat.append(location.latitude)\n            long.append(location.longitude)\n        except:\n            lat.append(\"NA\")\n            long.append(\"NA\")\n    df['Latitude'] = lat\n    df['Longitude'] = long\n    \n    return df\n\ndef map_df(df,col1,col2):\n    df = pd.DataFrame(df[[col1,col2]]\\\n            .groupby([col1])[col2].mean()\\\n            .sort_values(ascending=False)[:20]).reset_index()\n    \n    df = feature_generation(df)\n    \n    return df\n\nstate_access = map_df(districts_engagement_data, \"state\", \"pct_access\")\nstate_engagement_index = map_df(districts_engagement_data, \"state\", \"engagement_index\")","ce758489":"import folium\nfrom folium import Choropleth, Circle, Marker\nfrom folium.plugins import HeatMap, MarkerCluster\nnorth_america_map = folium.Map(location=[38.9, -77.05], tiles='Stamen Watercolor', zoom_start=3)\nnorth_america_map","f66cdb14":"import math\nmc = MarkerCluster()\nfor idx, row in state_access.iterrows():\n    if not math.isnan(row['Longitude']) and not math.isnan(row['Latitude']):\n        popup = \"\"\"\n        State : <b>%s<\/b><br>\n        Percentage Access : <b>%s<\/b><br>\n        \"\"\" % (row['state'], row['pct_access'])\n        mc.add_child(Marker([row['Latitude'], row['Longitude']],tooltip=popup))\n    north_america_map.add_child(mc)\nnorth_america_map","70a20a22":"## 2.5 Geospatial Analysis","2918f8c9":"#### Per pupil total expenditure in majority of the districts is in the range of 8K-10K dollars","8a240369":"### 2.1.1 Exploratory Data Analysis","3aa5510b":"#### The products are used maximum in PreK-12 sector","fe2502dd":"#### We can notice that a lot of columns have missing values (almost all the columns except district_id)","bd31e75d":"### 2.2.1 Exploratory Data Analysis","cb30e225":"#### Maximum districts have about 20-40% students eligible for free or reduced price lunch","4f3da7aa":"### 2.5.1 Base Map","317b0a03":"#### Maximum missing value is in engagement index, however since it has very high correlation with pct_access (which has lesser missing values), we can use this relationship as a proxy to impute the missing values","6885ceb4":"## 2.4 Merge the data","a3540215":"#### Maximum districs have high speed connection ratio","40aace55":"## 2.1 Load the data - Districts data","0360694c":"### State wise distribution shows that Illinois, Utah, Connecticut and Massachusetts have the maximum data points","52b753b9":"## 1. Importing Libraries","9ce318d2":"#### Percentage of students in the district have at least one page-load event of a given product (pct_access) and on a given day is one of the main drivers for engagement index","1ff3e892":"#### Further updates coming soon, stay tuned, thanks for your patience so far","6487a4ff":"### All the columns except district_id are object types","6eb948f1":"### 2.1.2 Data Visualization","b9840b6c":"### There are 233 rows or district ids and 7 columns in the dataset","e1be39f3":"#### We checked for duplicates and dropped them, however the number of rows remained constant meaning that there are no duplicates in the original data","89d58356":"### 2.5.2 State and Percentage Access (Top 20)","ac339eae":"#### Primary essential function is the digital learning platform ","17267cc3":"## 2.3 Load the data - Engagement data","9ffb5b97":"#### Maximum districts have black and hispanic population upto maximum of 20%","fa71f184":"#### Distribution of locale shows that maximum data entries belong to Suburb locale","0ddad32a":"## 2.2 Load the data - Products data"}}