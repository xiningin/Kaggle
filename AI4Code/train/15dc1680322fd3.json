{"cell_type":{"58c4ad6e":"code","9c1950cf":"code","23d0a726":"code","af22da80":"code","e552ad89":"code","c2ed3049":"code","c09c0246":"code","300c29fc":"code","3c037f0c":"code","615af6bd":"code","a5164ac7":"code","6ea5b37f":"markdown","eeee710b":"markdown","5a88847e":"markdown","9ff47bcb":"markdown","86c6c0c2":"markdown"},"source":{"58c4ad6e":"import tensorflow as tf\nfrom tqdm import tqdm\nimport numpy as np\nimport os\nimport IPython.display as display\nfrom PIL import Image\nimport pandas as pd\nimport shutil\nimport matplotlib.pyplot as plt","9c1950cf":"TRAIN_TFRECORD_PATH = '\/kaggle\/input\/cassava-leaf-disease-classification\/train_tfrecords\/' # Specify path for tfrecord files\nTRAIN_IMAGES_FROM_TFRECORD_PATH = '\/kaggle\/working\/Train_Images\/'                     # Specify path where you want to extract images from tfrecord","23d0a726":"# Let's create required path for TRAIN images\n\nif os.path.exists(TRAIN_IMAGES_FROM_TFRECORD_PATH):\n    print('Looks like already exists')\nelse:\n    os.makedirs(TRAIN_IMAGES_FROM_TFRECORD_PATH)\n    print(f\"Great , You have created required folder at {TRAIN_IMAGES_FROM_TFRECORD_PATH}\")","af22da80":"# # Create a dictionary describing the features. This \nimage_feature_description = {\n    'image': tf.io.FixedLenFeature([], tf.string),  \n    'image_name': tf.io.FixedLenFeature([], tf.string),\n    'target': tf.io.FixedLenFeature([], tf.int64),\n}\n\ndef _parse_image_function(example_proto):\n  # Parse the input tf.train.Example proto using the dictionary above.\n  return tf.io.parse_single_example(example_proto, image_feature_description)","e552ad89":"# I want to store tfrecord filename in variable, filename\nfilename = [TRAIN_TFRECORD_PATH + i for i in os.listdir(TRAIN_TFRECORD_PATH)]\nfilename[:2]","c2ed3049":"\ndf_to_store_imagename_and_info = pd.DataFrame()\nimage_name_to_df = []\ntarget_name_to_df = []\n\n# Here i am converting only first two tfrecord file, so if you want to convert all tfrecord files, then remove square bracket\n# from parsed parameter to the TFRecordDataset(filename = filename)\n\nraw_image_dataset = tf.data.TFRecordDataset(filenames=filename[:2]) # parsing tfrecords path to the TFrecordDataset function from tensorflow\nparsed_image_dataset = raw_image_dataset.map(_parse_image_function) # Basically our tfrecorf file is in the shape, where it contains\n                                                              # dict with (array of image, image_name, target variable)\n\n\nfor image_features in tqdm(parsed_image_dataset):\n    image_raw = image_features['image'].numpy()        # accessing image array  \n    # display.display(display.Image(data=image_raw))\n    array = tf.io.decode_image(image_raw, dtype=tf.dtypes.uint8, expand_animations=True).numpy() # Decoding image\n    im = Image.fromarray(array)                        # converting as a image\n    image_path = TRAIN_IMAGES_FROM_TFRECORD_PATH +str(image_features['image_name'].numpy(), 'utf8')  # specifying image path with image name\n    im.save(image_path)\n    \n    # we are storing image path and target variable for later use \n    image_name_to_df.append(str(image_features['image_name'].numpy(), 'utf8'))\n    target_name_to_df.append(image_features['target'].numpy())\n\ndf_to_store_imagename_and_info['Image_name'] = image_name_to_df\ndf_to_store_imagename_and_info['Target'] = target_name_to_df\n\nprint('Great you have converted from tfrecord to jpg format :)')","c09c0246":"df_to_store_imagename_and_info.head(3)","300c29fc":"# we have extracted tfrecrd to jpg format, We have extracted 2676 out of 21397 images, Coooool\nlen(os.listdir(TRAIN_IMAGES_FROM_TFRECORD_PATH))","3c037f0c":"img = tf.io.read_file(TRAIN_IMAGES_FROM_TFRECORD_PATH + os.listdir(TRAIN_IMAGES_FROM_TFRECORD_PATH)[0] )\nimg = tf.image.decode_image(img).numpy()\nplt.imshow(img)","615af6bd":"# I am removing the extracted files from output directory , Please comment this line so that you will have images in output directory\nshutil.rmtree(TRAIN_IMAGES_FROM_TFRECORD_PATH)","a5164ac7":"#Congratulations,  Finally you have reached end of this notebook, If you found useful do like and comment, If I can improve this in anyway\n# Please let me know :)\n","6ea5b37f":"## Path Initialization","eeee710b":"## Let's make hand dirty by converting tfrecord to jpg","5a88847e":"- Code without using multiprocessing take appox = 50 iter\/s, We have around 21,397 images which will cost us 21397\/50 = 427 sec =7.13 minutes,","9ff47bcb":"## Visualizing image","86c6c0c2":"\n## Importing libraries"}}