{"cell_type":{"34ea6ab9":"code","151490f0":"code","c5928dca":"code","e693da85":"code","7ed4b2d7":"code","bf47d1c2":"code","8c849ea5":"code","e71151fa":"code","340e8190":"code","579b1964":"code","284ab58d":"code","d95a0c05":"code","50679da2":"markdown","cfa4f4f0":"markdown","5a6af607":"markdown","355e6bdf":"markdown","466c8a06":"markdown","5136f633":"markdown","ffff10e3":"markdown","cf812943":"markdown","4edfc42b":"markdown","f6505fd4":"markdown"},"source":{"34ea6ab9":"import numpy as np\nimport pandas as pd\n\nimport datatable as dt\nimport gc\nimport re\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly.express as px\nfrom plotly.subplots import make_subplots\nimport plotly.graph_objs as go\n\nimport warnings\nwarnings.filterwarnings('ignore')\n\nimport shap\nfrom scipy import stats\nfrom tqdm import tqdm\nimport optuna\nfrom optuna.samplers import TPESampler\nimport lightgbm as lgb\nfrom lightgbm import LGBMClassifier, LGBMModel\n\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.feature_selection import RFE\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import accuracy_score, mean_squared_error, mean_squared_log_error\nfrom sklearn.model_selection import KFold, StratifiedKFold, cross_val_score\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.linear_model import LinearRegression\nfrom xgboost import XGBRegressor\n\nfrom collections import defaultdict\nimport joblib\nimport json\n\n# these imports are used to convert the tree to PNG\n# from cairosvg import svg2png\nfrom PIL import Image\nfrom io import BytesIO\n\nfrom pandas_profiling import ProfileReport\n\nsns.set(style='whitegrid', font_scale=1.5)\n\nINPUT_DIR = '..\/input\/house-prices-advanced-regression-techniques'\n\nTARGET = 'SalePrice'\nRANDOM_STATE = 42\nVERSION = 1","151490f0":"dtypes = {\n    'MSSubClass': str,\n}","c5928dca":"full_train_df = pd.read_csv(f'{INPUT_DIR}\/train.csv')\nfull_test_df = pd.read_csv(f'{INPUT_DIR}\/test.csv')\nfull_comb_df = pd.concat([full_train_df, full_test_df], ignore_index=True)\n\nfor col_, type_ in dtypes.items():\n    full_comb_df[col_] = full_comb_df[col_].astype(type_)","e693da85":"full_train_df.info()\nfull_train_df","7ed4b2d7":"ProfileReport(full_train_df, minimal=True).to_notebook_iframe()","bf47d1c2":"corrmat = full_train_df.corr()\n\nplt.figure(figsize=(10, 17))\nsns.barplot(y=corrmat[TARGET].sort_values().index, x=corrmat[TARGET].sort_values().values)\nplt.xlabel(f'correlation between `{TARGET}`')\nplt.show()","8c849ea5":"def fill_missing_data(df: pd.DataFrame):\n    for col_ in df.columns:\n        if df[col_].dtype == 'object':\n            # fill mode for categorical features\n            df[col_].fillna(df[col_].value_counts().iloc[0], inplace=True)\n        else:\n            # fill median for numerical features\n            df[col_].fillna(df[col_].median(), inplace=True)\n        \nfill_missing_data(full_comb_df)","e71151fa":"CATEGORIAL_FEATURES = list(filter(\n    lambda col_: full_comb_df[col_].dtype == 'object', full_comb_df.columns))\ncomb_df = full_comb_df.join(pd.get_dummies(full_comb_df[CATEGORIAL_FEATURES]))\ncomb_df","340e8190":"train_df = comb_df.copy()\ntrain_df = train_df[train_df.Id.isin(full_train_df.Id)]\n\ntest_df = comb_df.copy()\ntest_df = test_df[test_df.Id.isin(full_test_df.Id)]","579b1964":"FEATURES = train_df.columns.drop(TARGET)\nFEATURES = list(filter(lambda x: train_df[x].dtype != 'object', FEATURES))\nFEATURES","284ab58d":"xgboost = XGBRegressor(random_state=RANDOM_STATE)\n\n# test_size = 0\nxgboost.fit(train_df[FEATURES], train_df[TARGET])\nprint('R^2 =', xgboost.score(train_df[FEATURES], train_df[TARGET]))\n\ny_pred = xgboost.predict(train_df[FEATURES])\nprint('Score =', mean_squared_error(np.log(train_df[TARGET]), np.log(y_pred), squared=False))","d95a0c05":"test_df[TARGET] = xgboost.predict(test_df[FEATURES])\nsubmission_df = test_df[['Id', TARGET]]\nsubmission_df.to_csv(f'output_ver_{VERSION}.csv', index=False)\nsubmission_df","50679da2":"<a id='3-1'><\/a><\/br>\n## Fill missing data","cfa4f4f0":"# <center style=\"background-color:#99bbff; width:60%;\">Content<\/center>\n\n1. [Load](#1)\n2. [EDA](#2)\n3. [Preprocessing](#3)\n    - [3-1 Fill missing data](#3-1)\n    - [3-2 One Hot Encode](#3-2)\n    - [3-3 Prepare training & testing sets](#3-3)\n4. [Train XGB model](#4)\n4. [Submit](#5)","5a6af607":"<a id='5'><\/a><\/br>\n# <center style=\"background-color:#99bbff; width:60%;\">Submit<\/center>","355e6bdf":"<a id='3'><\/a><\/br>\n# <center style=\"background-color:#99bbff; width:60%;\">Preprocessing<\/center>","466c8a06":"<a id='4'><\/a><\/br>\n# <center style=\"background-color:#99bbff; width:60%;\">Train XGB model<\/center>","5136f633":"<a id='2'><\/a><\/br>\n# <center style=\"background-color:#99bbff; width:60%;\">EDA<\/center>","ffff10e3":"<a id='1'><\/a><\/br>\n# <center style=\"background-color:#99bbff; width:60%;\">Load<\/center>","cf812943":"<a id='3-2'><\/a><\/br>\n## One Hot Encode","4edfc42b":"<a id='3-3'><\/a><\/br>\n## Prepare training & testing sets","f6505fd4":"- SalePrice - the property's sale price in dollars. This is the target variable that you're trying to predict.\n- MSSubClass: The building class\n- MSZoning: The general zoning classification\n- LotFrontage: Linear feet of street connected to property\n- LotArea: Lot size in square feet\n- Street: Type of road access\n- Alley: Type of alley access\n- LotShape: General shape of property\n- LandContour: Flatness of the property\n- Utilities: Type of utilities available\n- LotConfig: Lot configuration\n- LandSlope: Slope of property\n- Neighborhood: Physical locations within Ames city limits\n- Condition1: Proximity to main road or railroad\n- Condition2: Proximity to main road or railroad (if a second is present)\n- BldgType: Type of dwelling\n- HouseStyle: Style of dwelling\n- OverallQual: Overall material and finish quality\n- OverallCond: Overall condition rating\n- YearBuilt: Original construction date\n- YearRemodAdd: Remodel date\n- RoofStyle: Type of roof\n- RoofMatl: Roof material\n- Exterior1st: Exterior covering on house\n- Exterior2nd: Exterior covering on house (if more than one material)\n- MasVnrType: Masonry veneer type\n- MasVnrArea: Masonry veneer area in square feet\n- ExterQual: Exterior material quality\n- ExterCond: Present condition of the material on the exterior\n- Foundation: Type of foundation\n- BsmtQual: Height of the basement\n- BsmtCond: General condition of the basement\n- BsmtExposure: Walkout or garden level basement walls\n- BsmtFinType1: Quality of basement finished area\n- BsmtFinSF1: Type 1 finished square feet\n- BsmtFinType2: Quality of second finished area (if present)\n- BsmtFinSF2: Type 2 finished square feet\n- BsmtUnfSF: Unfinished square feet of basement area\n- TotalBsmtSF: Total square feet of basement area\n- Heating: Type of heating\n- HeatingQC: Heating quality and condition\n- CentralAir: Central air conditioning\n- Electrical: Electrical system\n- 1stFlrSF: First Floor square feet\n- 2ndFlrSF: Second floor square feet\n- LowQualFinSF: Low quality finished square feet (all floors)\n- GrLivArea: Above grade (ground) living area square feet\n- BsmtFullBath: Basement full bathrooms\n- BsmtHalfBath: Basement half bathrooms\n- FullBath: Full bathrooms above grade\n- HalfBath: Half baths above grade\n- Bedroom: Number of bedrooms above basement level\n- Kitchen: Number of kitchens\n- KitchenQual: Kitchen quality\n- TotRmsAbvGrd: Total rooms above grade (does not include bathrooms)\n- Functional: Home functionality rating\n- Fireplaces: Number of fireplaces\n- FireplaceQu: Fireplace quality\n- GarageType: Garage location\n- GarageYrBlt: Year garage was built\n- GarageFinish: Interior finish of the garage\n- GarageCars: Size of garage in car capacity\n- GarageArea: Size of garage in square feet\n- GarageQual: Garage quality\n- GarageCond: Garage condition\n- PavedDrive: Paved driveway\n- WoodDeckSF: Wood deck area in square feet\n- OpenPorchSF: Open porch area in square feet\n- EnclosedPorch: Enclosed porch area in square feet\n- 3SsnPorch: Three season porch area in square feet\n- ScreenPorch: Screen porch area in square feet\n- PoolArea: Pool area in square feet\n- PoolQC: Pool quality\n- Fence: Fence quality\n- MiscFeature: Miscellaneous feature not covered in other categories\n- MiscVal: Value of miscellaneous feature\n- MoSold: Month Sold\n- YrSold: Year Sold\n- SaleType: Type of sale\n- SaleCondition: Condition of sale"}}