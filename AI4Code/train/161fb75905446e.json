{"cell_type":{"c6021e9f":"code","fba8ff9d":"code","5c864daa":"code","afee3a73":"code","862d6e0d":"code","38a95e9a":"code","299a2e00":"code","be5bbed2":"code","0e037e98":"code","a5edf211":"code","04023362":"code","0f0c66b4":"code","dab8d4b0":"code","cb88fff2":"code","0d4178d9":"code","8bf93783":"code","7e7040d5":"code","ba941e9e":"code","19feb0f5":"markdown","541c2f32":"markdown","27a085c8":"markdown","01299b08":"markdown","d61e86da":"markdown","ae1d7dfe":"markdown","b0409ac6":"markdown"},"source":{"c6021e9f":"import keras\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport pandas as pd\nimport numpy as np \nimport cv2\nimport os\n%matplotlib inline  ","fba8ff9d":"base_dir='..\/input\/chest-xray-pneumonia\/'\ntrain_pneumonia=os.listdir('..\/input\/chest-xray-pneumonia\/chest_xray\/train\/PNEUMONIA\/')\ntrain_normal=os.listdir('..\/input\/chest-xray-pneumonia\/chest_xray\/train\/NORMAL\/')\nval_dir_normal=os.listdir('..\/input\/chest-xray-pneumonia\/chest_xray\/val\/PNEUMONIA\/')\ntest_dir_normal=os.listdir('..\/input\/chest-xray-pneumonia\/chest_xray\/test\/NORMAL\/')\nval_dir_pneumonia=os.listdir('..\/input\/chest-xray-pneumonia\/chest_xray\/val\/PNEUMONIA\/')\ntest_dir_pneumonia=os.listdir('..\/input\/chest-xray-pneumonia\/chest_xray\/test\/NORMAL\/')","5c864daa":"from keras.preprocessing.image import ImageDataGenerator, load_img\nplt.suptitle('Normal Lungs')\nfor i in range(0,4):\n    img = train_normal[i]\n    img = load_img('..\/input\/chest-xray-pneumonia\/chest_xray\/train\/NORMAL\/' + img)\n    plt.imshow(img)\n    plt.show()\n","afee3a73":"from keras.preprocessing.image import ImageDataGenerator, load_img\nplt.suptitle('Pneumonia')\nfor i in range(0,4):\n    img = train_pneumonia[i]\n    img = load_img('..\/input\/chest-xray-pneumonia\/chest_xray\/train\/PNEUMONIA\/' + img)\n    plt.imshow(img)\n    plt.show()","862d6e0d":"sns.barplot(x=['Normal','Pneumonia'],y=[len(train_normal),len(train_pneumonia)])","38a95e9a":"from keras.models import Sequential\nfrom keras.layers import Conv2D, MaxPooling2D\nfrom keras.layers import Activation, Dropout, Flatten, Dense\nfrom keras import backend as K\nfrom keras import regularizers","299a2e00":"train_datagen = ImageDataGenerator(    rescale=1\/255.,\n                                        horizontal_flip=True,\n                                        vertical_flip=True,\n                                        rotation_range=0.4,\n                                        zoom_range=0.4\n                                                                       )\n\ntest_datagen = ImageDataGenerator(rescale=1.\/255)\n\ntraining_set = train_datagen.flow_from_directory('..\/input\/chest-xray-pneumonia\/chest_xray\/train\/',\n                                                 target_size=(224, 224),\n                                                 batch_size=8,\n                                                 class_mode='binary')\n\nval_set = train_datagen.flow_from_directory('..\/input\/chest-xray-pneumonia\/chest_xray\/val',\n                                            target_size=(224, 224),\n                                            batch_size=8,\n                                            shuffle=True,\n                                            class_mode='binary')\n\ntest_set = test_datagen.flow_from_directory('..\/input\/chest-xray-pneumonia\/chest_xray\/test',\n                                            target_size=(224, 224),\n                                            batch_size=8,\n                                            class_mode='binary')\n","be5bbed2":"# Learning rate optimization using tensorflow callbacks\n# Our Learning rate varies from 0.01 to 1 and we are increasing or decreasing\n# this learning rate with factor of 0.1 to adjust.\n\n# types of callbacks are available in tensorflow framework","0e037e98":"import tensorflow as tf\nfrom keras.callbacks import ReduceLROnPlateau\n\nRLR = ReduceLROnPlateau(monitor='val_loss',\n                                         factor=0.1,\n                                         patience=3,\n                                         cooldown=3,\n                                         min_lr=0.01,\n                                        verbose=1)\n\nclass myCallback(tf.keras.callbacks.Callback):\n    def on_epoch_end(self, epoch, logs={}):\n        if(logs.get('accuracy')>0.98):\n            print(\"\\nReached 98% accuracy so cancelling training!\")\n            self.model.stop_training = True\n\ncallbacks = [RLR,myCallback()]","a5edf211":"# We are taking input shape of tensor as 224*224*3","04023362":"import keras\nfrom keras.models import Sequential\nfrom keras.layers import Dense, Dropout, Flatten\nfrom keras.layers import Conv2D, MaxPooling2D, Conv3D, BatchNormalization\nfrom keras import optimizers\nfrom keras import backend as K\nmodel = Sequential()\nmodel.add(Conv2D(32, kernel_size=(3,3), activation='relu', input_shape=(224, 224, 3)))\nmodel.add(MaxPooling2D(pool_size=(2,2)))\nmodel.add(Conv2D(64, kernel_size=(3,3), activation='relu'))\nmodel.add(MaxPooling2D(pool_size=(2,2)))\nmodel.add(Conv2D(128, kernel_size=(3,3), activation='relu'))\nmodel.add(MaxPooling2D(pool_size=(2,2)))\nmodel.add(Conv2D(256, kernel_size=(3,3), activation='relu'))\nmodel.add(MaxPooling2D(pool_size=(2,2)))\nmodel.add(Conv2D(512, kernel_size=(3,3), activation='relu'))\nmodel.add(MaxPooling2D(pool_size=(2,2)))\nmodel.add(Flatten())\nmodel.add(Dense(256, activation='relu',kernel_regularizer=regularizers.l1_l2(l1=1e-5, l2=1e-4),\n        bias_regularizer=regularizers.l2(1e-4), activity_regularizer=regularizers.l2(1e-5)))\nmodel.add(Dense(128, activation='relu',kernel_regularizer=regularizers.l1_l2(l1=1e-5, l2=1e-4),\n        bias_regularizer=regularizers.l2(1e-4),activity_regularizer=regularizers.l2(1e-5)))\nmodel.add(Dense(64, activation='relu',kernel_regularizer=regularizers.l1_l2(l1=1e-5, l2=1e-4),\n        bias_regularizer=regularizers.l2(1e-4),activity_regularizer=regularizers.l2(1e-5)))\nmodel.add(Dropout(0.5))\nmodel.add(Dense(1, activation='sigmoid',kernel_regularizer=regularizers.l1_l2(l1=1e-5, l2=1e-4),\n    bias_regularizer=regularizers.l2(1e-4),\n    activity_regularizer=regularizers.l2(1e-5)))\nprint(model.summary())\nmodel.compile(optimizer='adam', loss='binary_crossentropy', metrics=['accuracy'])\nhistory = model.fit_generator(training_set,\n                    steps_per_epoch=5216\/\/8,\n                    epochs=30,\n                    validation_data=test_set,\n                    validation_steps=624\/\/8,\n                    callbacks=callbacks)","0f0c66b4":"import matplotlib.pyplot as plt\n\nacc = history.history['accuracy']\nval_acc = history.history['val_accuracy']\nloss = history.history['loss']\nval_loss = history.history['val_loss']\n\nepochs = range(1,len(acc)+1)\n\nplt.plot(epochs, acc, 'bo', label='Training acc')\nplt.plot(epochs, val_acc, 'b', label='Validation acc')\nplt.title('Training and validation accuracy')\nplt.legend()\n\nplt.figure()\n\nplt.plot(epochs, loss, 'bo', label='Training loss'\n        )\nplt.plot(epochs, val_loss, 'b', label='Validation loss')\nplt.title('Training and validation loss')\nplt.legend()\n","dab8d4b0":"ev = model.evaluate_generator(val_set)\nprint(\"\\n%s: %.f%%\" % (model.metrics_names[1], ev[1]*100))","cb88fff2":"# y_pred = model.predict(test_set)\n# ev","0d4178d9":"# from sklearn.metrics import f1_score\n# ac= f1_score(y_test, y_pred.round())\n# print('accuracy of the model: ',ac)","8bf93783":"# y_pred.round()","7e7040d5":"tf.keras.utils.plot_model(model, to_file='model_plot.png', show_shapes=True, show_layer_names=True)","ba941e9e":"model.save('new_model.h5')","19feb0f5":"![%D0%B8%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5.png](attachment:%D0%B8%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5.png)","541c2f32":"Viral pneumonia on the X-ray is characterized by such a pattern as Ground-glass opacity. Bacterial pneumonia has clear areas of opacity. In our dataset, we have a lot of people with pneumonia.","27a085c8":"2. Data vizualization ","01299b08":"This is basically my first CNN model that is dedicated to recognizing pneumonia. Let's start with import main libraries.","d61e86da":"Let's see what the lungs look like without and with pneumonia.","ae1d7dfe":"3. Data preprocessing","b0409ac6":"1. Import libraries "}}