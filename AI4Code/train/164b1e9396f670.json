{"cell_type":{"fb04cfc0":"code","624f21de":"code","f6933468":"code","6818a5ab":"code","80cb1d1b":"code","248d5ad9":"code","478d9e09":"code","78c2fe32":"code","fe15cc1a":"code","b77839c4":"code","a1b4188c":"code","86511abd":"code","5125ec81":"code","15507dee":"markdown","887cbec1":"markdown","2444a40d":"markdown","b94ceaa6":"markdown","f057f67d":"markdown","51d840eb":"markdown"},"source":{"fb04cfc0":"import pandas as pd\nfrom sklearn.model_selection import train_test_split","624f21de":"df = pd.read_csv(\"..\/input\/DBP_wiki_data.csv\",usecols=['text', 'l1', 'l2', 'l3', 'wiki_name']).drop_duplicates(subset=\"text\")\n\nprint(df.shape)\nprint(df.nunique())\ndf.head()","f6933468":"df.columns","6818a5ab":"df[\"word_count\"] = df.text.str.split().str.len()\nprint(df[\"word_count\"].quantile([0.02,0.98]))\ndf[\"word_count\"].describe()","80cb1d1b":"print(df[\"word_count\"].quantile([0.01,0.03,0.98,0.99]))\ndf[\"word_count\"].describe()","248d5ad9":"df.loc[df[\"word_count\"]<5]","478d9e09":"print(\"Old shape\",df.shape[0])\ndf = df.loc[(df[\"word_count\"]>10) & (df[\"word_count\"]<500)]\nprint(\"New shape\",df.shape[0])\n\ndf[\"word_count\"].describe()","78c2fe32":"# no need to export word count col. \n# WE also drop the wiki page name\ndf.drop([\"word_count\",\"wiki_name\"],axis=1,inplace=True)","fe15cc1a":"df.l3.value_counts()","b77839c4":"df.l2.value_counts()","a1b4188c":"print(\"orig\",df.shape)\ndf_train,df_test = train_test_split(df, test_size=0.18, random_state=42,stratify = df[\"l3\"])\n\nprint(\"Train size\",df_train.shape, \"\\n Test size\",df_test.shape)","86511abd":"## validation set split:\n\ndf_train,df_val = train_test_split(df_train, test_size=0.13, random_state=42,stratify = df_train[\"l3\"])\nprint(\"Final Train size\",df_train.shape, \"\\nValidation size\",df_val.shape)","5125ec81":"df_train.to_csv(\"DBPEDIA_train_v1.csv.gz\",index=False,compression=\"gzip\")\ndf_val.to_csv(\"DBPEDIA_val_v1.csv.gz\",index=False,compression=\"gzip\")\ndf_test.to_csv(\"DBPEDIA_test_v1.csv.gz\",index=False,compression=\"gzip\")","15507dee":"### rows with very few words look like data errors.\n* We'll Drop them","887cbec1":"#### Original data cleaning kernel\n","2444a40d":"## Create train\/test\/validation split partition\n* Stratify by classes","b94ceaa6":"## Text length analysis\n* Drop if excessive (super short or long) \n* For SB - will need to truncate or drop manually . For deep learning: padding\/truncating i s part of the data prep regardless. \n* Relevant for computational load, ","f057f67d":"#### drop some cols\n* Note we'll still need to drop class columns (but htese can vary per task)","51d840eb":"## Rare class frequencies:\n* from 2,700 to 180. \n* No need to remove the rarest classes? (180+ is reasonable. Rare but reasonable). \n* Data is clearly very imbalanced"}}