{"cell_type":{"20e6ef04":"code","0b47dc56":"code","fc7ff31c":"code","60f21aba":"code","c8cd9a36":"code","2d2df377":"code","34b456c3":"code","e8d84b99":"code","d67ae179":"code","e5f4db7e":"code","6a837476":"code","cd1e4b3f":"code","afcd66db":"code","9b4810e9":"code","c6d21b59":"code","967d0dcd":"code","f4c6523c":"code","6f105981":"code","bbcfa1ca":"code","2a0c329a":"code","70a68e0d":"code","cdb57313":"code","3b7e1ecf":"code","8a4535cd":"code","b479c199":"code","79b84feb":"code","57302755":"code","3fea9bcb":"code","0880fdc1":"code","1157e8da":"code","8bd2fcee":"code","33d145d7":"markdown"},"source":{"20e6ef04":"import pandas as pd\nimport numpy as np\nfrom pathlib import Path\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport plotly.graph_objs as go\nfrom plotly.offline import iplot, init_notebook_mode\ninit_notebook_mode(connected=True)\n%matplotlib inline\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n","0b47dc56":"#path = '\/kaggle\/input\/tabular-playground-series-jan-2021\/'\npath = Path('\/kaggle\/input\/tabular-playground-series-jan-2021\/')\ntrain = pd.read_csv(path \/ 'train.csv', index_col='id')\ntest = pd.read_csv(path \/ 'test.csv', index_col='id')\nsample = pd.read_csv(path \/ 'sample_submission.csv', index_col='id')","fc7ff31c":"print(\"Train Shape {} \\n Test Shape {}\".format(train.shape,test.shape))","60f21aba":"train.head()","c8cd9a36":"train.info()","2d2df377":"#p = sns.pairplot(train)","34b456c3":"corr_matrix = train.corr()\ncorr_matrix['target']","e8d84b99":"plt.figure(figsize=(7,7))\n#sns.color_palette(\"Blues\", as_cmap=True)\nsns.heatmap(corr_matrix,\n            vmin=-1,\n            cmap='Set2');","d67ae179":"dims = []\n\n#for col in list(train.columns):\n#    d = dict(label = col, values=train[col])\n#    dims.append(d)\n\n#fig = go.Figure(data=go.Splom(dimensions=dims,\n#                             showupperhalf=False,\n#                             diagonal_visible=False))\n\n#fig.update_layout(\n#    title='Pairplot',\n#    xaxis=dict(tickangle = 45),\n#    yaxis=dict(tickangle = 45),    \n#    width=800,\n#    height=600,\n#)\n\n#iplot(fig)","e5f4db7e":"import plotly.express as px\nfig = px.histogram(train, x=\"target\")\niplot(fig)","6a837476":"train['log_target'] = np.log(train['target'])\nfig = px.histogram(train, x=\"log_target\")\niplot(fig)","cd1e4b3f":"fig = px.histogram(train, x=\"cont1\")\niplot(fig)","afcd66db":"train[['target']].max()","9b4810e9":"from sklearn.compose import ColumnTransformer\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.impute import SimpleImputer\nfrom sklearn.preprocessing import StandardScaler, OneHotEncoder\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.model_selection import train_test_split, GridSearchCV\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn import set_config\nimport math\nX = train.drop([\"target\",\"log_target\"], axis = 1) # train_data will feed to the model\ny = train['target'] # label to predict\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)\nnumeric_features = list(X_train.columns)","c6d21b59":"def build_model(model):\n    numerical_pipe = Pipeline([('std_scaler',StandardScaler())])\n    numeric_transformer = Pipeline(steps=[('scaler', StandardScaler())])\n    preprocessor = ColumnTransformer(\n        transformers=[\n            ('num', numeric_transformer, numeric_features)])\n    regr = Pipeline(steps=[('preprocessor', preprocessor),\n                      ('regression_model', model)])   \n    set_config(display='diagram')\n    return regr\n\ndef get_pipeline():\n    numerical_pipe = Pipeline([('std_scaler',StandardScaler())])\n    numeric_transformer = Pipeline(steps=[('scaler', StandardScaler())])\n    preprocessor = ColumnTransformer(\n        transformers=[\n            ('num', numeric_transformer, numeric_features)])\n    return preprocessor\n\ndef calculate_train_rmse(name, model):\n    preds = model.predict(X_train)\n    mse = mean_squared_error(y_train, preds)\n    rmse = np.sqrt(mse)\n    print(\"Training RMSE of {} : {}\".format(name,rmse))\n\ndef sample_prediction(name, model, num_records):\n    some_data = X.iloc[:num_records]\n    some_labels = y.iloc[:num_records]\n    preds = []\n    for label in list(model.predict(some_data)):\n        preds.append(math.floor(label))\n\n    print(\"Predictions on training data using :\", name)    \n    print(\"Predictions    :\", preds)\n    print(\"Actual labels  :\", list(some_labels)) ","967d0dcd":"linear_reg = build_model(LinearRegression())\nlinear_reg.fit(X_train,y_train)","f4c6523c":"calculate_train_rmse(\"LinearRegression\",linear_reg)","6f105981":"sample_prediction(\"LinearRegression\",linear_reg, 10)","bbcfa1ca":"from sklearn.tree import DecisionTreeRegressor\ntree_reg = build_model(DecisionTreeRegressor())\ntree_reg.fit(X_train,y_train)","2a0c329a":"calculate_train_rmse(\"DecisionTreeRegressor\",tree_reg)\nsample_prediction(\"DecisionTreeRegressor\", tree_reg, 10)","70a68e0d":"from sklearn.ensemble import RandomForestRegressor\nforest_reg = build_model(RandomForestRegressor(random_state = 42))\nforest_reg.fit(X_train,y_train)\n","cdb57313":"calculate_train_rmse(\"RandomForestRegressor\",forest_reg)\nsample_prediction(\"RandomForestRegressor\", forest_reg, 10)","3b7e1ecf":"final_predictions = forest_reg.predict(X_test)\nfinal_mse = mean_squared_error(y_test,final_predictions)\nfinal_rmse = np.sqrt(final_mse)\nprint(\"Test RMSE for RandomForestRegressor : \", final_rmse)","8a4535cd":"from sklearn.model_selection import GridSearchCV\n\nparam_grid = [\n    {'regression_model__n_estimators': [3, 10, 30, 50], 'regression_model__max_features' : [2, 4, 6, 8, 10, 12]},\n    {'regression_model__bootstrap': [False], 'regression_model__n_estimators' : [3, 10], 'regression_model__max_features' : [2, 3, 4] }\n]\n\ngrid_search = GridSearchCV(forest_reg, param_grid, cv=5, \n                          scoring = 'neg_mean_squared_error',\n                          return_train_score=True)\ngrid_search.fit(X, y)\n","b479c199":"grid_search.best_params_","79b84feb":"set_config(display='diagram')\ngrid_search.best_estimator_","57302755":"\n\ncvres = grid_search.cv_results_\n\nfor mean_score, params in zip(cvres[\"mean_test_score\"], cvres[\"params\"]):\n    print(np.sqrt(-mean_score),params)\n\n","3fea9bcb":"final_model = grid_search.best_estimator_\npreprocessor = get_pipeline()\n\nfinal_predictions = final_model.predict(X_test)\nfinal_mse = mean_squared_error(y_test,final_predictions)\nfinal_rmse = np.sqrt(final_mse)\nprint(\"Test RMSE for RandomForestRegressor : \", final_rmse)","0880fdc1":"sample['target'] = forest_reg.predict(test)\nsample.to_csv('random_forest.csv')","1157e8da":"#np.isfinite(X).all()","8bd2fcee":"import joblib as jbl\njbl.dump(forest_reg, \"forest_reg.pkl\")","33d145d7":"## Model Pipeline"}}