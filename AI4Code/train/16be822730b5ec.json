{"cell_type":{"e7b9b05b":"code","472dd02e":"code","13628f75":"code","75867a61":"code","ecb39d6a":"code","1cd4d60e":"code","91f86909":"code","59b9da10":"code","2b72dd5d":"code","fe634f02":"code","a7959114":"code","f9ffb5ee":"code","df4a38ca":"code","a063fbd3":"code","107918e2":"code","fef23898":"code","074f6863":"code","a52dcce1":"code","8f880e09":"code","7572f438":"code","b58f7588":"code","5bb9b326":"code","4ea439be":"code","167d8e1c":"code","bd673a18":"code","fdca22b6":"code","505b1ed5":"code","1fd03f0f":"code","479b8fff":"code","e75c958a":"code","2fd88b85":"code","f6525042":"code","06828e5c":"code","a557c4b0":"code","0f97c33f":"markdown","cdc0708a":"markdown","39972a72":"markdown","73c53e2b":"markdown","4aec096c":"markdown","8b908d0d":"markdown","f521fd2a":"markdown","a307fb2f":"markdown","984b5855":"markdown","b6d09fe1":"markdown","49daa66a":"markdown","e3148cd9":"markdown","11edf878":"markdown","4b3bc553":"markdown","c761b857":"markdown","11a4a1f9":"markdown","54020906":"markdown","322af516":"markdown","f63fbb7b":"markdown","5aa0fde4":"markdown","5ad6e381":"markdown"},"source":{"e7b9b05b":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt","472dd02e":"import seaborn as sns","13628f75":"from xgboost import XGBClassifier","75867a61":"df = pd.read_csv(\"..\/input\/iba-ml1-mid-project\/train.csv\")\ndf.head()","ecb39d6a":"test_df = pd.read_csv(\"..\/input\/iba-ml1-mid-project\/test.csv\")\ntest_df.head()","1cd4d60e":"df = df.iloc[:,1:]\ndf.head(10)","91f86909":"df.info()","59b9da10":"df['credit_line_utilization'] = pd.to_numeric(df['credit_line_utilization'], errors='coerce')","2b72dd5d":"df.isnull().sum().sort_values(ascending=False)","fe634f02":"df['defaulted_on_loan'].value_counts()","a7959114":"df.describe()","f9ffb5ee":"fig, ax = plt.subplots(figsize=(15,12))\n\ndf.hist(ax=ax)","df4a38ca":"sns.pairplot(vars = ['age', 'real_estate_loans', 'number_of_credit_lines', 'monthly_income', 'number_dependent_family_members'],\n                data = df, hue='defaulted_on_loan', palette='ch:.25')","a063fbd3":"fig, ax = plt.subplots(figsize=(15, 6))\n\nsns.histplot(x='monthly_income', hue='defaulted_on_loan',\n             data=df, ax=ax)","107918e2":"(df['monthly_income'] == 0).value_counts()","fef23898":"df['log_monthly_income'] = np.log(df['monthly_income'])\ndf.head()","074f6863":"(df['log_monthly_income'] == np.NINF).value_counts()","a52dcce1":"df.loc[:, 'log_monthly_income'].replace(np.NINF, 0,inplace=True)\ndf.head()","8f880e09":"fig, ax = plt.subplots(figsize=(15, 6))\n\nsns.histplot(x='log_monthly_income', hue='defaulted_on_loan',\n             data=df, ax=ax)","7572f438":"def dist_visualizer(data, feature, hue):\n    \n    %matplotlib inline\n    fig, [ax, ax1] = plt.subplots(1, 2, figsize=(15, 6))\n   \n    sns.histplot(x=feature, hue=hue,\n             data=data, ax=ax, palette=\"ch:.25\")\n    \n    sns.boxplot(x=feature, hue=hue,\n                data=df, ax=ax1, palette=\"ch:.25\")\n    plt.tight_layout()\n    plt.plot()","b58f7588":"dist_visualizer(df, 'log_monthly_income', 'defaulted_on_loan')","5bb9b326":"dist_visualizer(df, 'number_dependent_family_members', 'defaulted_on_loan')","4ea439be":"dist_visualizer(df, 'number_of_credit_lines', 'defaulted_on_loan')","167d8e1c":"df['log_number_of_credit_lines'] = np.log(df['number_of_credit_lines'])\ndf.loc[:, 'log_number_of_credit_lines'].replace(np.NINF, 0,inplace=True)","bd673a18":"dist_visualizer(df, 'log_number_of_credit_lines', 'defaulted_on_loan')","fdca22b6":"dist_visualizer(df, 'real_estate_loans', 'defaulted_on_loan')","505b1ed5":"dist_visualizer(df, 'number_of_previous_late_payments_up_to_59_days', 'defaulted_on_loan')","1fd03f0f":"dist_visualizer(df, 'number_of_previous_late_payments_up_to_89_days', 'defaulted_on_loan')","479b8fff":"dist_visualizer(df, 'number_of_previous_late_payments_90_days_or_more', 'defaulted_on_loan')","e75c958a":"# A copy of our data with the necessary features\n\ndf_cpy = df[['age', 'number_dependent_family_members', 'log_monthly_income', 'log_number_of_credit_lines', 'real_estate_loans',\n             'ratio_debt_payment_to_income', 'credit_line_utilization', 'number_of_previous_late_payments_up_to_59_days',\n            'number_of_previous_late_payments_up_to_89_days', 'number_of_previous_late_payments_90_days_or_more', 'defaulted_on_loan']]","2fd88b85":"Let's now see how ","f6525042":"df_cpy.corr()","06828e5c":"fig, ax = plt.subplots(figsize=(12, 10))\n\nsns.heatmap(df_cpy.corr(),\n            annot=True, cmap='mako', ax=ax)","a557c4b0":"fig, ax = plt.subplots(figsize=(10, 6))\n\ntarget_corr = df_cpy.corr().iloc[:-1, -1].sort_values()\n\nsns.barplot(x=target_corr, y=target_corr.index, \n           palette='ch:.25', ax=ax)","0f97c33f":"We can readily see that some features have really low statistical correlation with target variable. This is also more exaggerated by the fact that our target is a label. Because of this reason, I had first decided on using various methods of feature selection (RFE, SelectKBest, Wrapper Methods, Manual Selection from the above graph), however juxtaposition of models with same parametres revealed that eliminating some of the features did not prove to be useful in terms of mode ROC_AUC score, so that part of the original notebook has been excluded  ","cdc0708a":"# Importing the Libraries","39972a72":"We can see that are some values that do not quite fit the distribution. These values may not actually be considered by our models, so we better check for outliers as well. But before this, we need to remember that in the distributions of all the features we saw at the beginning of our EDA, we saw similar patterns emerge in some other features as well. Let's check to make sure, to achieve this we'll use a combination of a histogram and a box plot to help. The simple script below does just that. ","73c53e2b":"From the above distribution plot of the \"monthly income\" feature we can see that our data is right skewed and this is not something that our ML models are fond of. So let's deal with this issue before moving on any further and see what we get. For this we'll engineer a new feature which will be the log of the feature in question. As we are using this approach, let's first see if there are any instances of zero income as this will result in negative inf values if we apply the mentioned method (log(0) = -inf). If there are, we will replace them with 0 instead","4aec096c":"Now this looks like a better feature for our models, but we will still need to deal with the outliers","8b908d0d":"Woah... a largely unbalanced data we've got here. Depending on the algorithms we use we will most likely need to somewhat balance out our data so that our models do not straight out ignore the actually defaulted loans","f521fd2a":"Alright, quite a lot of missing data, but we'll make our model robust enough to deal with them. Now let's have a look at our target values","a307fb2f":"Now this should do it. Above we see variations in the number of non-Null datapoints for each feature. This goes to say that we have some missing data and that we will need to take care of that. Let's see the general situation","984b5855":"It seems like we can deal with the skewness of the 'number_of_credit_lines' feature like we did in the case of 'monthly_income'. Let's see how it goes","b6d09fe1":"# Exploratory Data Analysis and Feature Engineering","49daa66a":"Now let's zoom in on the correlation of our features with the target variable specifically to see what are the potential \"predictors\".","e3148cd9":"Now this is what we need. Let's now look at some simple descriptions of our data","11edf878":"We can easily see the correlation betwen the number of late payments based on different timeframes, but this is somehting we got a hint of earlier and not really something peculiar or interesting. It simple states that if people decide to pay late, the procrastination will most likely last for over 59 days.","4b3bc553":"# Fetching the Data","c761b857":"With the above illustration we will not only get an idea of the distributions of our data but the pairplots will help in a later step when we are entertaining idea of \"relevance\" of the features of our data to each other and the target variable","11a4a1f9":"When it comes to the above 3 features depicting the number of late payments, we can see a similar pattern of seemingly outlier-like data appearing if we look to the far right of the boxplots. This is an indication that those data points may be legitimate data, so we will leave them as they are. ","54020906":"In the data there's the ID feature which is redundant for us so we'll remove that from the dataset","322af516":"We do have 0 monthly_income cases so we will proceed as mentioned","f63fbb7b":"From the above it is lucid that ther are severe outliers in feautres 'ratio_debt_payment_to_income' and 'credit_line_utilization'. We will take care of the later.\nFor now, let's get a general idea about the distributions of the remaining features. We may detect some level of outliers not readily obvious from the description of our features.","5aa0fde4":"This will create a few instances of negative inf values as can be seen below","5ad6e381":"Whoops... we have an object type in our data?! That's undesirable so let's get that out of the way real fast"}}