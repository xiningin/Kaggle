{"cell_type":{"e097965f":"code","41febe27":"code","fe8416e0":"code","d226016d":"code","d01fe419":"code","3065b70a":"code","dfa703f1":"code","f0f04527":"code","7ecd56a9":"code","3c024554":"code","d0c62509":"code","b7a2f4e3":"code","0c7b68e3":"code","e4b99cd4":"code","435b5fbd":"code","21dca007":"code","ec6a7e01":"code","4ff4287a":"code","f40bd5a6":"code","94aa1504":"code","87a6ff5f":"code","84a362f3":"code","21d7e936":"code","b99f67d2":"code","96d6d681":"code","f1066a10":"code","e6b83d25":"code","2c1724f1":"code","79c9e468":"code","3940f7f6":"code","4453a73c":"code","bb254fa6":"code","46001940":"code","dae4a823":"code","121a4c45":"code","7a2c1ba4":"code","4b76b159":"code","6a667f05":"code","4578b78f":"code","157605fa":"code","76627908":"code","ff1d8750":"code","49bccd35":"code","61a86380":"code","d0fa6f44":"code","75e1a973":"code","9fc9ee46":"code","3a5f677c":"code","2fd14658":"code","8a8e2910":"code","52998513":"code","573519e2":"code","0c6d9073":"code","75141486":"code","4cb59a9e":"code","2d9c7caa":"code","aef0aa93":"code","c05a6bcb":"markdown","6aec559c":"markdown","d55a15e7":"markdown","6068097e":"markdown","9e9eaa43":"markdown","bbbddd62":"markdown","c60f1f22":"markdown","65e4ba80":"markdown","98c0045f":"markdown","aa8cb207":"markdown","eee3fc55":"markdown","f43318a4":"markdown","afa41f2f":"markdown","d73ddcf9":"markdown","2aac1ffb":"markdown","45069691":"markdown","d1b95622":"markdown","fbf39609":"markdown","30d3451f":"markdown","2567983d":"markdown","e6fdc63c":"markdown","fc8dccaf":"markdown","564b7337":"markdown","9083116b":"markdown","6d98bb7c":"markdown","5214dfda":"markdown","5b8eb742":"markdown","8fbb71aa":"markdown"},"source":{"e097965f":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt #data visualization\nimport seaborn as sns #data visualization\nfrom scipy import stats #Statistics\nfrom sklearn.cluster import DBSCAN  #outlier detection\nfrom collections import Counter\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\nfrom fancyimpute import KNN #KNN imputation\n\nimport os\n\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","41febe27":"test_df = pd.read_csv(\"..\/input\/test_AV3.csv\")\ntrain_df = pd.read_csv(\"..\/input\/train_AV3.csv\")","fe8416e0":"train_df.head()","d226016d":"test_df.head()","d01fe419":"train_df.shape","3065b70a":"train_df['Property_Area'].hist(color = 'orange')\nplt.xlabel('Property Area')\nplt.ylabel('Frequency')\nplt.show()","dfa703f1":"train_df.info()","f0f04527":"train_df.dtypes","7ecd56a9":"train_df.describe()","3c024554":"train_df.mode().iloc[0][1:]   ","d0c62509":"#Number of null values\ntrain_df.isnull().sum()","b7a2f4e3":"#train_df.LoanAmount.value_counts(dropna=False)\nfig,axes = plt.subplots(nrows=1, ncols=2)\nmode = train_df.LoanAmount.mode().iloc[0]\nfig1 = train_df.LoanAmount.fillna(mode).plot(kind = 'hist', bins = 30, ax = axes[1])\nprint(train_df.LoanAmount.fillna(mode).describe())\nprint(train_df.LoanAmount.describe())\ntrain_df.LoanAmount.plot(kind = 'hist', bins = 30, ax = axes[0])\nplt.show()","0c7b68e3":"#Using mean to fill NAN values\nfig,axes = plt.subplots(nrows=1, ncols=2)\nmean = train_df.LoanAmount.mean()\ntrain_df.LoanAmount.fillna(mean).plot(kind = 'hist', bins = 30, ax = axes[1])\nprint(train_df.LoanAmount.fillna(mean).describe())\nprint(train_df.LoanAmount.describe())\ntrain_df.LoanAmount.plot(kind = 'hist', bins = 30, ax = axes[0])","e4b99cd4":"#Using median to fill out NAN values\n#Using mean to fill NAN values\nfig,axes = plt.subplots(nrows=1, ncols=2)\nmedian = train_df.LoanAmount.median()\ntrain_df.LoanAmount.fillna(median).plot(kind = 'hist', bins = 30, ax = axes[1])\nprint(train_df.LoanAmount.fillna(median).describe())\nprint(train_df.LoanAmount.describe())\ntrain_df.LoanAmount.plot(kind = 'hist', bins = 30, ax = axes[0])","435b5fbd":"#Using KNN to fill the values\ntrain_df.ApplicantIncome = train_df.ApplicantIncome.astype('float')\ntrain_df_numeric = train_df.select_dtypes('float')\ndf_filled = KNN(k=5).complete(train_df_numeric)\ndf_filled = pd.DataFrame(df_filled)\ndf_filled.shape","21dca007":"df_filled.index = train_df_numeric.index\ndf_filled.columns = train_df_numeric.columns","ec6a7e01":"df_filled.info()","4ff4287a":"#Make a copy of train_df to fill up the values from df_filled\ntrain_df_c = train_df.copy()\ntrain_df_c.LoanAmount = df_filled.LoanAmount","f40bd5a6":"fig, axes = plt.subplots(nrows=1,ncols=2)\ntrain_df.LoanAmount.hist(bins = 30, ax = axes[0])\ntrain_df_c.LoanAmount.hist(bins = 30, ax = axes[1])\nprint(train_df.LoanAmount.describe())\nprint(train_df_c.LoanAmount.describe())","94aa1504":"train_df_c.ApplicantIncome = df_filled.ApplicantIncome\ntrain_df_c.CoapplicantIncome = df_filled.CoapplicantIncome\ntrain_df_c.Loan_Amount_Term = df_filled.Loan_Amount_Term","87a6ff5f":"plt.hist(train_df_c.LoanAmount, bins = 30, alpha = 0.5, label = 'Imputed Loan Amount', color = 'orange', stacked = True)\nplt.hist(train_df.LoanAmount.dropna(), bins = 30, alpha = 0.5, label = 'Original Loan Amount', color = 'green')\nplt.legend()\nplt.show()","84a362f3":"plt.hist(train_df_c.Loan_Amount_Term, bins = 10, alpha = 0.5, label = 'Imputed Loan Amount Term', color = 'orange', stacked = True)\nplt.hist(train_df.Loan_Amount_Term.dropna(), bins = 10, alpha = 0.5, label = 'Original Loan Amount Term', color = 'green')\nplt.legend()\nplt.show()","21d7e936":"train_df.describe(include = ['O'])","b99f67d2":"train_df = train_df_c.copy()","96d6d681":"#Transforming Loan_Status, Gender, Married, Education, & Property area from object to proper data type like bool, int, categoryetc.\nd = {'Y':True, 'N':False}\ntrain_df.Loan_Status = train_df.Loan_Status.map(d)\nd = {'Male':False, 'Female':True, 'NaN':np.nan}\ntrain_df.Gender = train_df.Gender.map(d)","f1066a10":"#We want to find if there is relationship between gender & Applicants income so that we can find missing gender more clearly.\ntrain_df_c = train_df[train_df.Gender.notnull()].copy()","e6b83d25":"train_df_c.Gender = train_df_c.Gender.astype('int64')\nfig, ax = plt.subplots(figsize = (18,18))\nsns.heatmap(train_df_c.corr(), ax = ax, annot = True)","2c1724f1":"train_df.Gender = train_df.Gender.fillna(True)","79c9e468":"#Filling Nan using mode\ntrain_df.Credit_History = train_df.Credit_History.fillna(train_df.Credit_History.mode()[0])","3940f7f6":"d = {'No':False, 'Yes':True, 'Nan':np.nan}\ntrain_df.Self_Employed = train_df.Self_Employed.map(d)\ntrain_df_c = train_df[train_df.Self_Employed.notnull()]\ntrain_df_c.Self_Employed = train_df_c.Self_Employed.astype('bool')","4453a73c":"fig, ax = plt.subplots(figsize = (10,10))\nsns.heatmap(train_df_c.corr(), annot = True, ax = ax)","bb254fa6":"train_df.Self_Employed = train_df.Self_Employed.fillna(train_df.Self_Employed.mode()[0])\ntrain_df.Dependents = train_df.Dependents.fillna(train_df.Dependents.mode()[0])\ntrain_df.Married = train_df.Married.fillna(train_df.Married.mode()[0])","46001940":"train_df.isnull().sum()","dae4a823":"#Now we hav no null values in our data, also in this cell we delete our useless data frames.\ndel(train_df_c)\ndel(train_df_numeric)","121a4c45":"train_df.head()","7a2c1ba4":"#Visualizing scatter plot of all continuous numerical data, \n#Selecting all numerical attributes with Loan Status\ntrain_df_c = train_df[['ApplicantIncome', 'CoapplicantIncome', 'LoanAmount', 'Loan_Amount_Term','Loan_Status']]\ncolor = ['orange' if i==True else 'green' for i in train_df_c.loc[:,'Loan_Status']]\npd.plotting.scatter_matrix(train_df_c.loc[:, train_df_c.columns != 'Loan_Status'], c = color, figsize=(15,15), diagonal='hist', alpha = 0.5,\n                          s= 200)\nplt.show()","4b76b159":"fig = sns.FacetGrid(train_df, row = 'Gender', col='Education', size = 4)\nfig = fig.map(plt.hist, 'LoanAmount', color = 'g', bins = 30)","6a667f05":"fig = sns.FacetGrid(train_df, row = 'Gender', col='Education', size = 4)\nfig = fig.map(plt.hist, 'ApplicantIncome', color = 'c', bins = 30)","4578b78f":"fig = sns.FacetGrid(train_df, col='Credit_History', row = 'Loan_Status', size = 4)\nfig = fig.map(plt.hist, 'LoanAmount', color = 'k', bins = 30)","157605fa":"train_df.boxplot(by = 'Loan_Status', column = 'LoanAmount', figsize = (7,5))\nplt.show()","76627908":"train_df.boxplot(by = 'Loan_Status', column = 'ApplicantIncome', figsize = (7,5))\nplt.show()","ff1d8750":"train_df.boxplot(by = 'Loan_Status', column = 'CoapplicantIncome', figsize = (7,5))\nplt.show()","49bccd35":"train_df.boxplot(by = 'Education', column = 'ApplicantIncome', figsize = (7,5))\nplt.show()","61a86380":"# Applicant inclome + Coapplicant income = Family income\ntrain_df['Family_Income'] = train_df.ApplicantIncome + train_df.CoapplicantIncome","d0fa6f44":"train_df.Family_Income.plot(kind = 'hist', bins = 50)\nplt.show()","75e1a973":"#Applicant's class \n# 0 - 1000 Lower class\n# 1001 - 5000 Lower Middle class\n# 5001 - 10000 Upper middle Class\n# 10000+ Upper class\nvalues = []\nfor i in train_df.loc[:,'ApplicantIncome']:\n    if i <= 1000:\n        values.append('Lower Class')\n    elif i > 1000 and i <= 5000:\n        values.append('Lower Middle Class')\n    elif i > 5000 and i <= 10000:\n        values.append('Upper Middle Class')\n    else:\n        values.append('Upper Class')\n","9fc9ee46":"values = np.array(values)\ntrain_df['ApplicantClass'] = values","3a5f677c":"fig, ax = plt.subplots(figsize = (10,10))\nsns.countplot(x = 'ApplicantClass',data =  train_df, ax = ax)","2fd14658":"fig = sns.FacetGrid(train_df, col = 'ApplicantClass')\nfig.map(plt.hist, 'LoanAmount', bins = 50)\nplt.show()","8a8e2910":"train_df.head()","52998513":"train_df[['Family_Income','LoanAmount']].corr()","573519e2":"train_df.boxplot(column='Family_Income', by = 'Loan_Status')","0c6d9073":"train_df.Credit_History = train_df.Credit_History.astype('bool')","75141486":"Cols = [i for i in train_df.columns if train_df[i].dtype == 'float64']\nCols","4cb59a9e":"train_df_c = np.log(train_df[['ApplicantIncome', 'Family_Income','LoanAmount']]).copy()","2d9c7caa":"model = DBSCAN(eps = 0.7, min_samples= 25).fit(train_df_c)","aef0aa93":"print(train_df_c[model.labels_ == -1])\nprint(Counter(model.labels_))","c05a6bcb":"There are a lot of Outliers which will be handled afterwards.","6aec559c":"Looking at basic structure of data frames: ","d55a15e7":"Graduate males are earning more than graduate female. ","6068097e":"**Importing CSV files.**","9e9eaa43":"Observations till now:\n1. There are various NULL objects in many attributes. Surely requires attention.\n2. There are 13 attributes of train_df and 12 of test_df.\n3. Categorical Attributes : Gender, married, Education, self employed, Propert_area, Loan_status.\n3. Numercal Categorical : Dependencies, Credit History.\n4. Continuous Numerical : ApplicantIncome, CoapplicantIncome, LoanAmount, Loan_Amount_Term\n5. Most houses are in suburban area. \n6. Data type of few attributes need to be changed.","bbbddd62":"Mode of all features:","c60f1f22":"* Few applicants have very high income. (Imbalance in society)\n* Graduate have more median income than not graduate.","65e4ba80":"Observations from Categorical Data: (No NAN included) \n* 480 are graduate.\n* Most houses are from semiurban area(233)\n* Most Loans were approved.\n* Most of the aplicants are Married and does not have dependents.\n* There are null values in Credit History, self employed, Dependents and gender and married. Let us try fill these NA values.\n","98c0045f":"We saw in box plots that there were several outliers, in the continuous numerical data. These many outliers can't be simply discarded as they might contribute well in our anyalysis so finding iutliers using IQR method will simply find so many outliers, so we can use DBSCAN to find outliers also, Applicant income and Family Income etc are huge numbers we can simply apply log to normalize them. (So that we can keep significantly low values of eps)","aa8cb207":"Male Candidates are applying more, moreover those who are graduate are applying for higher amount of loan. Female those who are not graduate are applying for very less amount.","eee3fc55":"**Some Observations from above matrix:**\n* Mostly there are just three Loan amount term, in which 360 is given to most applicants.\n* From histograms we can see that other than Loan_Amount_term all other distributions are left skewed.\n* Most applicant's are applying for loan amount of less than 300.","f43318a4":"Since median < mean, we can say that our disribution is skewed, so median can be considered as better way of dealing with center. Skewness is easily seen from the histograms.","afa41f2f":"* Most of the people are taking loan again.\n* Loan approval rate is high for applicants with credit history.","d73ddcf9":"Now Self_Employed has 32 missing values. We'll again impute it, after seeing it's dependencies.","2aac1ffb":"* Most of the people are from Middle Class (Lower + Upper). Lower Class don't apply for loan, Upper don't need it.\n* There is some intuition that classes may have some relation with loan amount. (Let's try to find out)","45069691":"Credit History has around 50 Null values let's try to fill it first.","d1b95622":"* Applicants with higher income have slightly higher chance of getting their loan approved.","fbf39609":"* Upper Class people are asking for more money, Lower Middle class is asking for maximum of approx 300. (There is atleast a lower class applicant who asked for approx 375)","30d3451f":"Observation : Mean and median of almost all the attributes are far apart.\nAround 84% people have credit history.\n","2567983d":"**Observation**: kNN is perfect method as magnitude of difference between std of original and imputed loan amount is approximately 0.4, also in this case mean is almost same.\n**Observation**: Dataset is small and applying KNN is good to impute other values also.\nLet us check for other continuous numerical attributes also: ","e6fdc63c":"Exploratory analysis","fc8dccaf":"** Creeatingg New Variables ** ","564b7337":"As we can see that there is not much difference in those two graphs we can go ahead with KNN imputation for continuous numerical attributes. Now we'll find missing values for categorical data.","9083116b":"There are a lot of outliers which needs to be handled.\n","6d98bb7c":"* So we can see tht there is some corelation between Loan Amount and Family Income","5214dfda":"### Correcting data(Imputation of missing values)","5b8eb742":"Again we can see that Self_employed is not very much correlated to any other attributes. So let us fill nan using mode again, also There are total of 15 Nan in dependants and 3 in marrige in these cases again we'll use mode as missing values are comparitively less.","8fbb71aa":"We can simply see that there is almost no relationship between Gender and any other attributes (Beautiful, isn't it?).So we may go ahead and put all Nan in gender to be Female. Similarly we can fill all other nan values of all variables."}}