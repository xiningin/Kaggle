{"cell_type":{"6ffa0614":"code","fce87b35":"code","c8bbe67f":"code","b61fb12b":"code","2e69a97e":"code","260a9724":"code","1e3e87c6":"code","909af9fa":"code","c1fa289e":"code","d85bb97e":"code","1cbfe629":"code","57d102aa":"code","cdcb7059":"code","bb012aac":"code","91fc2b7f":"code","25682799":"code","51ae19aa":"code","4f04bffa":"code","bd103dd8":"code","9ecd9fcb":"code","47633e23":"code","33dbcd14":"code","c1893f5d":"code","0abc471f":"code","1b55144a":"code","79261ab5":"code","692408e8":"code","adaea821":"code","59e6f94c":"code","8ff5e358":"code","c895393f":"code","cf5dccca":"code","bb53ec73":"code","5217d6e8":"code","5cec1c0e":"code","3794cff3":"code","e8ec6afb":"code","db8f0e5e":"code","08ca51ca":"code","aba75f9b":"code","5249a714":"code","2e5c2318":"code","aacb02b4":"markdown","ffbcbcf0":"markdown","f488fe45":"markdown","ff530522":"markdown","9c9ecdc2":"markdown","393f229d":"markdown","ac980092":"markdown","face9545":"markdown","ca1229e7":"markdown","ef0f65c3":"markdown"},"source":{"6ffa0614":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","fce87b35":"# Bibliotecas gr\u00e1ficas\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline\n\n# Biblioteca para gr\u00e1ficos interativos\nfrom plotly import __version__\nfrom plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot\n\nimport cufflinks as cf\ncf.go_offline()\n# Para Notebooks\ninit_notebook_mode(connected=True)","c8bbe67f":"# Carregando a base\nemprestimo = pd.read_csv('..\/input\/dados_clube_emprestimo.csv')","b61fb12b":"# Verificando a quantidade de colunas por TIPO\nemprestimo.dtypes.value_counts()","2e69a97e":"# As 5 menores taxas de juros\nemprestimo.nsmallest(5,'int.rate')","260a9724":"# As 5 maiores taxas de juros\nemprestimo.nlargest(5,'int.rate')","1e3e87c6":"# Analisando as vari\u00e1veis, quantidade de registros e tipos \nemprestimo.info()","909af9fa":"# Visualiza\u00e7\u00e3o das estatisticas das vari\u00e1veis\nemprestimo.describe()","c1fa289e":"# Analisando os registros pelo cabe\u00e7alho\nemprestimo.head()","d85bb97e":"# Analisando a quantidade da politica de cr\u00e9dito\nemprestimo['credit.policy'].value_counts()","1cbfe629":"# Analisando a quantidade de emprestimo por objetivo\nemprestimo['purpose'].value_counts()","57d102aa":"# Histogram da quantidade de EMPRESTIMO pelo OBJETIVO\nemprestimo['purpose'].iplot(kind='hist')","cdcb7059":"# Visualizando o histograma da distribui\u00e7\u00e3o dos empr\u00e9stimos pela pontua\u00e7\u00e3o\nplt.figure(figsize=(16,6))\nsns.distplot(emprestimo['fico'], kde=True)","bb012aac":"# Apresentando o histograma da distribui\u00e7\u00e3o do n\u00famero de dias que teve linha de cr\u00e9dito\nplt.figure(figsize=(16,6))\nsns.distplot(emprestimo['days.with.cr.line'], kde=True)","91fc2b7f":"# Apresentando a quantidade total de empr\u00e9stimos pelo Objetivo\nplt.figure(figsize=(16,6))\nsns.countplot(x='purpose', data=emprestimo)","25682799":"# Apresentado o n\u00famero de EMPRESTIMOS por OBJETIVO agrupados pela politica\nplt.figure(figsize=(16,6))\nsns.countplot(x='purpose', data=emprestimo, hue='credit.policy')\n","51ae19aa":"# Quantidade pela politica de cr\u00e9dito\nemprestimo['credit.policy'].value_counts()","4f04bffa":"# Histograma de duas distribui\u00e7\u00f5es FICO umas sobre as outras, uma para cada um dos valores poss\u00edveis de credit.policy\nplt.figure(figsize=(16,6))\nemprestimo[emprestimo['credit.policy']==1]['fico'].hist(bins=30, alpha=0.5, color='blue', label='Credit.Police=1')\nemprestimo[emprestimo['credit.policy']==0]['fico'].hist(bins=30, alpha=0.5, color='red', label='Credit.Police=0')\nplt.legend()\nplt.xlabel('FICO')","bd103dd8":"emprestimo['not.fully.paid'].value_counts()","9ecd9fcb":"# Histograma de duas distribui\u00e7\u00f5es FICO umas sobre as outras, uma para cada um dos valores poss\u00edveis de not.fully.paid\nplt.figure(figsize=(14,6))\nemprestimo[emprestimo['not.fully.paid']==1]['fico'].hist(bins=30, alpha=0.5, color='blue', label='not.fully.paid=1')\nemprestimo[emprestimo['not.fully.paid']==0]['fico'].hist(bins=30, alpha=0.5, color='red', label='not.fully.paid=0')\nplt.legend()\nplt.xlabel('FICO')","47633e23":"# Analisando a quantidade por objetivo\nemprestimo['purpose'].value_counts()","33dbcd14":"# Vamos transformar a vari\u00e1vel purpose em vari\u00e1veis dummys.\n# E Vamos acrescentar essas vari\u00e1veis no nosso dataframe.\n\nemprestimo = pd.get_dummies(emprestimo, columns = ['purpose'], drop_first = True)","c1893f5d":"# Verificando as informa\u00e7\u00f5es do dataframe com as novas vari\u00e1veis\nemprestimo.info()","0abc471f":"# Importando as fun\u00e7\u00f5es do sklearn\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.metrics import accuracy_score,classification_report,confusion_matrix, mean_squared_error\nfrom sklearn.tree import DecisionTreeClassifier","1b55144a":"# Vamos criar conjunto de treino e teste\n# Separar os dados: 20% teste - usando semente aleat\u00f3ria para podermos replicar o resultado\ntrain, test = train_test_split(emprestimo, test_size=0.2,random_state=42)","79261ab5":"# Separando o dataframe de treino em treino e valida\u00e7\u00e3o\ntrain, valid = train_test_split(train,test_size=0.2,random_state=42)","692408e8":"# Verificando a quantidade de registros para cada dataframe\ntrain.shape, valid.shape, test.shape","adaea821":"# Selecionar as colunas para treinamento\nfeats = [c for c in emprestimo.columns if c not in['not.fully.paid']]","59e6f94c":"feats","8ff5e358":"# Carregando o modelo\ndtree = DecisionTreeClassifier()\n# Treinamento do modelo\ndtree.fit(train[feats], train['not.fully.paid'])\n","c895393f":"# Fazendo a previs\u00e3o\npreds = dtree.predict(valid[feats])","cf5dccca":"# Relat\u00f3rio de classifica\u00e7\u00e3o  \nprint(classification_report(valid['not.fully.paid'],preds))","bb53ec73":"# Apresentando matriz de confus\u00e3o.\npd.DataFrame(confusion_matrix(valid['not.fully.paid'],preds))","5217d6e8":"accuracy_score(test['not.fully.paid'], dtree.predict(test[feats]))","5cec1c0e":"# Carregando o modelo\nrfc = RandomForestClassifier(n_estimators=400,random_state=42,n_jobs=-1)","3794cff3":"# Treinamento do modelo\nrfc.fit(train[feats],train['not.fully.paid'])","e8ec6afb":"# FAzendo a previs\u00e3o\npreds = rfc.predict(valid[feats])","db8f0e5e":"# Relat\u00f3rio de classifica\u00e7\u00e3o  \nprint(classification_report(valid['not.fully.paid'],preds))","08ca51ca":"# Apresentando matriz de confus\u00e3o.\npd.DataFrame(confusion_matrix(valid['not.fully.paid'],preds)) ","aba75f9b":"accuracy_score(valid['not.fully.paid'], preds)","5249a714":"# Rodar o modelo para prever o 'not.fully.paid' dos dados de teste\naccuracy_score(test['not.fully.paid'], rfc.predict(test[feats]))","2e5c2318":"# Analisando a import\u00e2ncia das caracter\u00edsticas\nplt.figure(figsize=(14,6))\npd.Series(rfc.feature_importances_,index=feats).sort_values().plot.barh()","aacb02b4":"# 6 -  FEATURE IMPORTANCES\n\nProposta de aplica\u00e7\u00e3o do modelo treinado\n\n* Via interpreta\u00e7\u00e3o da FEATURE IMPORTANCE\n* Ou aplica\u00e7\u00e3o direta das previs\u00f5es geradas pelo modelo","ffbcbcf0":"## Treinando o modelo com de florestas aleat\u00f3rias","f488fe45":"* <B>days.with.cr.line:<\/B> O n\u00famero de dias em que o mutu\u00e1rio teve uma linha de cr\u00e9dito.\n* <B>installment:<\/B> as parcelas mensais devidas pelo mutu\u00e1rio se o empr\u00e9stimo for financiado.\n* <B>revol.util:<\/B> taxa de utiliza\u00e7\u00e3o da linha rotativa do mutu\u00e1rio (o valor da linha de cr\u00e9dito usada em rela\u00e7\u00e3o ao cr\u00e9dito total dispon\u00edvel).\n* <B>revol.bal:<\/B> Saldo rotativo do mutu\u00e1rio (montante n\u00e3o pago no final do ciclo de cobran\u00e7a do cart\u00e3o de cr\u00e9dito).\n* <B>log.annual.inc:<\/B> O log natural da renda anual auto-relatada do mutu\u00e1rio.\n","ff530522":"## Treinando o modelo com \u00e1rvore de decis\u00e3o","9c9ecdc2":"# Trabalho MACHINE LEARNING\n\n Estaremos explorando dados dispon\u00edveis publicamente de [LendingClub.com](www.lendingclub.com). Lending Club conecta pessoas que precisam de dinheiro (mutu\u00e1rios) com pessoas que t\u00eam dinheiro (investidores).\n \n Utilizaremos os dados de empr\u00e9stimos de 2007-2010 e tentaremos classificar e prever se o mutu\u00e1rio pagou o empr\u00e9stimo na \u00edntegra.\n \nAqui est\u00e3o o que as colunas representam:\n* <B>credit.policy:<\/B> 1 se o cliente atender aos crit\u00e9rios da politica de cr\u00e9dito da LendingClub.com e 0 caso contr\u00e1rio.\n* <B>purpose:<\/B> O objetivo do empr\u00e9stimo (leva valores \"credit_card\", \"debt_consolidation\", \"educacional\", \"grande compra\", \"small_business\" e \"all_other\").\n* <B>int.rate:<\/B> a taxa de juros do empr\u00e9stimo (uma taxa de 11% seria armazenada como 0,11). Os mutu\u00e1rios julgados por LendingClub.com para serem mais arriscados recebem taxas de juros mais elevadas.\n* <B>installment:<\/B> as parcelas mensais devidas pelo mutu\u00e1rio se o empr\u00e9stimo for financiado.\n* <B>log.annual.inc:<\/B> O log natural da renda anual auto-relatada do mutu\u00e1rio.\n* <B>dti:<\/B> Ratio d\u00edvida \/ rendimento do tomador do empr\u00e9stimo (montante da d\u00edvida dividido pela receita anual).\n* <B>fico:<\/B> a pontua\u00e7\u00e3o de cr\u00e9dito FICO do mutu\u00e1rio.\n* <B>days.with.cr.line:<\/B> O n\u00famero de dias em que o mutu\u00e1rio teve uma linha de cr\u00e9dito.\n* <B>revol.bal:<\/B> Saldo rotativo do mutu\u00e1rio (montante n\u00e3o pago no final do ciclo de cobran\u00e7a do cart\u00e3o de cr\u00e9dito).\n* <B>revol.util:<\/B> taxa de utiliza\u00e7\u00e3o da linha rotativa do mutu\u00e1rio (o valor da linha de cr\u00e9dito usada em rela\u00e7\u00e3o ao cr\u00e9dito total dispon\u00edvel).\n* <B>inq.last.6mths:<\/B> n\u00famero de consultas do mutu\u00e1rio por credores nos \u00faltimos 6 meses.\n* <B>delinq.2yrs:<\/B> o n\u00famero de vezes que o mutu\u00e1rio havia passado mais de 30 dias em um pagamento nos \u00faltimos 2 anos.\n* <B>pub.rec:<\/B> O n\u00famero de registros p\u00fablicos depreciativos do mutu\u00e1rio (arquivamentos de fal\u00eancias, \u00f4nus fiscais ou julgamentos).   \n* <b>not.fully.paid:<\/b> verificar se o mutu\u00e1rio pagou todo o empr\u00e9stimo (0) ou n\u00e3o pagou tudo (1).","393f229d":"# 4 - Tratando a coluna categ\u00f3rica","ac980092":"# 2 - An\u00e1lise explorat\u00f3ria e tratamento dos dados","face9545":"# 5 - Machine Learning\n* Escolher vari\u00e1vel a ser prevista\n* Escolher m\u00e9trica de sucesso\n* Escolher modelo\n* Treinar modelo\n* Avaliar qualidade do modelo treinado","ca1229e7":"\n# 1 - Importando as BIBLIOTECAS e ARQUIVO","ef0f65c3":"# 3 - Visualiza\u00e7\u00e3o gr\u00e1fica"}}