{"cell_type":{"9541119b":"code","29fb9fdf":"code","21515927":"code","c64279db":"code","f3159bed":"code","79aedee6":"code","707802f9":"code","4f545d27":"code","dd4a254b":"code","7ede7231":"code","6fcee4de":"code","3d040458":"code","291a6f6a":"code","c85dc8fc":"code","7a9b5abf":"code","6cb7672f":"code","5b4b2c69":"code","5dc890c0":"code","c5dac8ad":"markdown","a56c4a52":"markdown","beb3b9e9":"markdown","352ed5ed":"markdown","60e4ab7b":"markdown","a44399a4":"markdown","2e9dd2f1":"markdown","403fe17c":"markdown","672a77e6":"markdown","ad54abbe":"markdown","a0e8f5c4":"markdown","27be89cd":"markdown"},"source":{"9541119b":"!pip install shifterator","29fb9fdf":"# Import packages\n\nimport pandas as pd\nimport numpy as np\nimport itertools\nimport collections\nimport nltk\nfrom nltk.corpus import stopwords\nimport re\n\nfrom shifterator import relative_shift as rs\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set(font_scale=1.5)\nsns.set_style(\"whitegrid\")","21515927":"# Load the review CSV\nreviews = pd.read_csv(\"..\/input\/animal-crossing\/user_reviews.csv\", encoding='utf-8')","c64279db":"reviews.head()","f3159bed":"reviews['date'] = pd.to_datetime(reviews['date'])\nreviews.index = reviews['date'] \n\nfig, ax = plt.subplots(figsize=(12, 8))\n\nmean_daily_grades = reviews.resample('D', on='date').mean().reset_index('date')\n\n# Plot horizontal bar graph\nmonthly_plot = sns.lineplot(data = mean_daily_grades,\n                      x = 'date',\n                      y = 'grade',\n                      color=\"purple\"\n                      )\n\nax.set_title(\"Average daily grade\")\nx_dates = mean_daily_grades['date'].dt.strftime('%m-%d').sort_values().unique()\nax.set_xticklabels(labels=x_dates, rotation=45, ha='right')\n\nplt.show()","79aedee6":"# Divide reviews into positive and negative based on the median grade for the dataset\nmedian_grade = reviews.grade.median()\n\nreviews.loc[reviews['grade'] <= median_grade, 'review_category'] = 'Negative' \nreviews.loc[reviews['grade'] > median_grade, 'review_category'] = 'Positive' \n\nreviews_neg = reviews[reviews['review_category'] == 'Negative']\nreviews_pos = reviews[reviews['review_category'] == 'Positive']","707802f9":"texts = reviews['text'].tolist()\ntexts_neg = reviews_neg['text'].tolist()\ntexts_pos = reviews_pos['text'].tolist()","4f545d27":"# We will want to remove stop words\nstop_words = set(stopwords.words('english'))","dd4a254b":"def remove_punctuation(txt):\n    \"\"\"Replace URLs and other punctuation found in a text string with nothing \n    (i.e. it will remove the URL from the string).\n\n    Parameters\n    ----------\n    txt : string\n        A text string that you want to parse and remove urls.\n\n    Returns\n    -------\n    The same txt string with URLs and punctuation removed.\n    \"\"\"\n\n    return \" \".join(re.sub(\"([^0-9A-Za-z \\t])|(\\w+:\\\/\\\/\\S+)\", \"\", txt).split())","7ede7231":"def clean_text(txt):\n    \"\"\"Removes punctuation, changes to lowercase, removes\n        stopwords, removes \"animal\" and \"crossing\", and\n        calculates word frequencies.\n\n    Parameters\n    ----------\n    txt : string\n        A text string that you want to clean.\n\n    Returns\n    -------\n    Words and frequencies\n    \"\"\"\n    \n    tmp = [remove_punctuation(t) for t in txt]\n    tmp = [t.lower().split() for t in tmp]\n    \n    tmp = [[w for w in t if not w in stop_words]\n              for t in tmp]\n    tmp = [[w for w in t if not w in ['animal', 'crossing']]\n                     for t in tmp]\n    \n    tmp = list(itertools.chain(*tmp))\n    tmp = collections.Counter(tmp)\n        \n    return tmp","6fcee4de":"# Clean up the review texts\nclean_texts_neg = clean_text(texts_neg)\nclean_texts_pos = clean_text(texts_pos)","3d040458":"# Dataframes for most frequent common words in positive and negative reviews\ncommon_neg = pd.DataFrame(clean_texts_neg.most_common(15),\n                             columns=['words', 'count'])\ncommon_pos = pd.DataFrame(clean_texts_pos.most_common(15),\n                             columns=['words', 'count'])","291a6f6a":"fig, ax = plt.subplots(figsize=(8, 8))\n\n# Plot horizontal bar graph\ncommon_neg.sort_values(by='count').plot.barh(x='words',\n                      y='count',\n                      ax=ax,\n                      color=\"red\")\n\nax.set_title(\"Common Words Found in Negative Reviews\")\n\nplt.show()","c85dc8fc":"fig, ax = plt.subplots(figsize=(8, 8))\n\n# Plot horizontal bar graph\ncommon_pos.sort_values(by='count').plot.barh(x='words',\n                      y='count',\n                      ax=ax,\n                      color=\"green\")\n\nax.set_title(\"Common Words Found in Positive Reviews\")\n\nplt.show()","7a9b5abf":"# From https:\/\/www.kaggle.com\/prakashsadashivappa\/word-cloud-of-abstracts-cord-19-dataset\nfrom wordcloud import WordCloud, STOPWORDS, ImageColorGenerator\n\nwordcloud = WordCloud(\n    width = 3000,\n    height = 2000,\n    background_color = 'black',\n    ).generate(str(texts_neg))","6cb7672f":"fig = plt.figure(\n    figsize = (10, 8),\n    facecolor = 'k',\n    edgecolor = 'k')\nplt.imshow(wordcloud, interpolation = 'bilinear')\nplt.axis('off')\nplt.tight_layout(pad=0)\nplt.show()","5b4b2c69":"# Get an entropy shift\nentropy_shift = rs.EntropyShift(reference=clean_texts_neg,\n                                comparison=clean_texts_pos,\n                                base=2)\nentropy_shift.get_shift_graph() ","5dc890c0":"# Get a Jensen-Shannon divergence shift\nfrom shifterator import symmetric_shift as ss\njsd_shift = ss.JSDivergenceShift(system_1=clean_texts_neg,\n                                 system_2=clean_texts_pos,\n                                 base=2)\njsd_shift.get_shift_graph()","c5dac8ad":"It looks like reviews started off pretty positively and declined steeply after which the average has been bouncing between 2 and almost 7. I could look at more distributions and things, but I won't for now. Mostly because I'd much prefer to use ggplot2 in R. :)","a56c4a52":"I learned how to clean the review text data and calculate frequencies using [this tutorial](https:\/\/www.earthdatascience.org\/courses\/use-data-open-source-python\/intro-to-apis\/calculate-tweet-word-frequencies-in-python\/). The next few cells will clean and prepare the data by removing punctuation, stop words, change everything to lower case, etc so we can calculate frequencies.","beb3b9e9":"## Inspect and prepare the data\n\nThe first thing I'm going to do is have a look at some of the data to get a bit of a feel for it.\n\nLet's look at average review grades over time.","352ed5ed":"## Conclusion\n\nI hope this wasn't too painful to read for my Pythonista friends. I had fun checking out the new Shifterator package and I'm looking forward to digging into it in greater depth. It definitely seems much more promising than a word cloud, to say the least. If you fork this notebook and do something cool to extend and improve this analysis (especially if you add sentiment scores), let me know in the comments! Thanks again to Ryan Gallagher for [Shifterator](https:\/\/github.com\/ryanjgallagher\/shifterator).","60e4ab7b":"It looks like the negative reviews are in purple and positive ones are in yellow. It looks like feedback about the whole \"one island per Switch\" dominates. Fortunately my husband doesn't play so we don't have to deal with that. I wonder if \"fix\", \"ridiculous\", \"experience\" refers to some of the goofy, clunky UX. At least I think it's pretty goofy and clunky. A lot of the words are nouns and verbs like \"console\", \"family\", \"money\", \"fix\", \"save\".\n\nAmong the positive reviews, there are more adjectives pulled out. For example, \"best\", \"fun\", \"amazing\", \"relaxing, \"perfect\". I wonder what \"bombing\" refers to in the positive reviews?","a44399a4":"# Shifterator text analysis on Animal Crossing reviews\n\nI saw a tweet from [Ryan J. Gallagher](https:\/\/twitter.com\/ryanjgallag) about his new Python package for people who hate wordclouds called \"Shifterator\". From his GitHub repo:\n\n> _The Shifterator package provides functionality for constructing word shift graphs, vertical bart charts that quantify which words contribute to a pairwise difference between two texts and how they contribute. By allowing you to look at changes in how words are used, word shifts help you to conduct analyses of sentiment, entropy, and divergence that are fundamentally more interpretable._\n\nI decided to try out this new package on this week's TidyTuesday dataset on [Animal Crossing](https:\/\/www.kaggle.com\/jessemostipak\/animal-crossing). I'm definitely more of an #rstats person where I'm a huge fan of Dr. Julia Silge and David Robinson's [TidyText package](https:\/\/www.tidytextmining.com\/). But Shifterator looked intriguing enough for me to dust off my rusty Python skills (or lack thereof). Anyway, so apologies if my Python code looks terrible. Let me know in the comments what I should fix.","2e9dd2f1":"Hmm, apart from the negative and positive reviews switching places, I don't have too much more to add to this plot. This analysis pulls out slightly different words and rankings.","403fe17c":"### Jensen-Shannon divergence shifts\n\nThe second graph is an Jensen-Shannon divergence shift graph. [See the GitHub repo for more details](https:\/\/github.com\/ryanjgallagher\/shifterator#jensen-shannon-divergence-shifts).","672a77e6":"## Plot data in a boring way\n\nFirst, I thought it would be interesting to make more boring graphs of the data to compare to the cool ones with Shifterator.","ad54abbe":"Yes, these plots are very boring. Common words between negative and positive reviews are pretty similar. For something a bit more nuanced I'd normally look to calculate something like tf-idf, but again, [I'd be a lot more at home doing that in R with TidyText](https:\/\/www.tidytextmining.com\/tfidf.html). Tf-idf would tell you more about a words' relative importance in a corpus taking frequency into account.\n\nOkay, thought you'd get away without seeing a word cloud? Not so fast. ;) Let's do one for good measure. I'll spare you and just plot one for the negative reviews.","a0e8f5c4":"Each review has the following columns: the date, a review, and the review text.\n\nMy research question will be: How do negative and positive reviews compare in the words they use?","27be89cd":"## Create word shift graphs with Shifterator\n\nTime to finally use the Shifterator package! We could compare negative and positive Animal Crossing reviews based on both frequency and sentiment (or other values) using this package, but I've only calculated frequencies, so we'll just try plotting that.\n\n\n### Entropy shift\n\nThe first graph is an entropy shift graph. [See the GitHub repo for more details](https:\/\/github.com\/ryanjgallagher\/shifterator#entropy-and-kullback-leibler-divergence-shifts)."}}