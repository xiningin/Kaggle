{"cell_type":{"d94faa03":"code","5d1c81af":"code","0b0bb78b":"code","dcc318ed":"code","0f748962":"code","b1ac23f7":"code","9d7c1f26":"code","9f4686cb":"code","901b48d2":"code","3401ff60":"code","379cf53e":"code","30f3afe8":"code","ae9e2692":"code","93a415bd":"code","547e809d":"code","31a8b6f8":"code","b4c9a325":"code","eff2d0a2":"code","abcfa996":"code","5fbfe020":"code","31596329":"code","4f79e812":"code","d2c3b356":"code","5bfd5abe":"code","290e07be":"code","9e87a742":"code","dfb4e66a":"code","1ee0accc":"code","8ef5413b":"code","ffa87eee":"code","aacec7ec":"code","08f3e9ec":"code","313dc858":"code","62409f03":"code","6a62e8c8":"code","e707babc":"code","e6647e53":"code","8b8e7a1e":"code","d06b5cc7":"code","ab042727":"code","95359055":"code","5f3ad3b1":"code","7d36694b":"code","d68c3734":"markdown","d965b6cb":"markdown","7efc8e64":"markdown","9043e70c":"markdown","af823f44":"markdown","21b533b7":"markdown","4b6b5112":"markdown","f00bd2ab":"markdown","ee1ffcdc":"markdown","07a71eb2":"markdown","a3a842e5":"markdown","7560e08f":"markdown","31c50fd7":"markdown","e1f6aea6":"markdown","21eae462":"markdown","b8b96ce6":"markdown","0c4c9f2b":"markdown","dfa13a64":"markdown","989d5d4a":"markdown","2af7b4b5":"markdown","3568227d":"markdown","12f4955b":"markdown","6b9ec6a6":"markdown","e04cb603":"markdown","b6aaf5b8":"markdown","1ee484bd":"markdown","a6ffe381":"markdown","988ee51f":"markdown","a69ac238":"markdown","ad8d8adf":"markdown","f5743f4f":"markdown","5d4096aa":"markdown","6d56476f":"markdown"},"source":{"d94faa03":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport sklearn","5d1c81af":"adult = pd.read_csv(\"..\/input\/adult-pmr3508\/train_data.csv\",\n        names=[\n        \"ID\",\"Age\", \"Workclass\", \"fnlwgt\", \"Education\", \"Education-Num\", \"Martial Status\",\n        \"Occupation\", \"Relationship\", \"Race\", \"Sex\", \"Capital Gain\", \"Capital Loss\",\n        \"Hours per week\", \"Country\", \"Target\"],\n         engine='python',skiprows = 1,na_values=\"?\")","0b0bb78b":"adult = adult.drop([\"ID\"], axis = 1)\nadult ","dcc318ed":"adult.describe()","0f748962":"adult.info()","b1ac23f7":"total = adult.isnull().sum().sort_values(ascending = False)\npercent = ((adult.isnull().sum()\/adult.isnull().count())*100).sort_values(ascending = False)\nmissing_data = pd.concat([total, percent], axis = 1, keys = ['Total', '%'])\nmissing_data.head()","9d7c1f26":"plt.figure(figsize=(12,8))\nadult[\"Country\"].value_counts().plot(kind=\"bar\")","9f4686cb":"adult[\"Workclass\"].value_counts().plot(kind=\"bar\")","901b48d2":"adult[\"Occupation\"].value_counts().plot(kind=\"bar\")","3401ff60":"value = adult['Workclass'].describe().top\nadult['Workclass'] = adult['Workclass'].fillna(value)\n\nvalue = adult['Occupation'].describe().top\nadult['Occupation'] = adult['Occupation'].fillna(value)\n\nvalue = adult['Country'].describe().top\nadult['Country'] = adult['Country'].fillna(value)","379cf53e":"total = adult.isnull().sum().sort_values(ascending = False)\npercent = ((adult.isnull().sum()\/adult.isnull().count())*100).sort_values(ascending = False)\nmissing_data = pd.concat([total, percent], axis = 1, keys = ['Total', '%'])\nmissing_data.head()","30f3afe8":"plt.figure(figsize = (7,7))\nadult[\"Race\"].value_counts().plot(kind=\"pie\")","ae9e2692":"plt.figure(figsize = (7,7))\nadult[\"Sex\"].value_counts().plot(kind=\"pie\")\n","93a415bd":"plt.figure(figsize = (7,7))\nadult[\"Education\"].value_counts().plot(kind=\"pie\")","547e809d":"\nadult[\"Capital Gain\"].value_counts().plot(kind=\"hist\")\n","31a8b6f8":"adult[\"Capital Loss\"].value_counts().plot(kind=\"hist\")","b4c9a325":"sns.catplot(x=\"Target\", y=\"Capital Gain\", kind=\"boxen\", data=adult);","eff2d0a2":"sns.catplot(x=\"Target\", y=\"Capital Loss\", kind=\"boxen\", data=adult);","abcfa996":" gp_limite = adult['Capital Gain'].quantile(0.993)\n adult[adult['Capital Gain']>gp_limite]\n\n ","5fbfe020":" adult[adult['Capital Gain']>gp_limite].describe()","31596329":"df_cg_analise = adult[adult['Capital Gain']>gp_limite]","4f79e812":"sns.catplot(x=\"Target\", y=\"Capital Gain\", kind=\"boxen\", data=df_cg_analise);","d2c3b356":"def encoder(x):\n    if x == '>50K':\n          return 1\n    return 0","5bfd5abe":"rela\u00e7\u00e3o_target = adult.drop(['Target'],axis = 1)","290e07be":"target_bi = adult['Target'].apply(encoder)\ntarget_bi","9e87a742":"rela\u00e7\u00e3o_target = pd.concat([rela\u00e7\u00e3o_target, target_bi], axis = 1)\nrela\u00e7\u00e3o_target","dfb4e66a":"plt.figure(figsize=(10,8))\nsns.heatmap(rela\u00e7\u00e3o_target.corr(),annot=True)","1ee0accc":"qlt = adult[[\"Workclass\",\"Martial Status\",\"Occupation\",\"Relationship\",\"Sex\"]]\nqnt = adult.drop([\"Workclass\",\"Martial Status\",\"Occupation\",\"Relationship\",\"Sex\"], axis = 1)","8ef5413b":"def preptreino (adult):\n    qlt = adult[[\"Workclass\",\"Martial Status\",\"Occupation\",\"Relationship\",\"Sex\"]]\n    qnt = adult.drop([\"Workclass\",\"Martial Status\",\"Occupation\",\"Relationship\",\"Sex\",\"Race\",\"Country\",\"Education\",\"Target\",\"fnlwgt\"], axis = 1)\n    qlt = pd.get_dummies(qlt)\n    new_adult = pd.concat([qlt, qnt], axis = 1)\n    return new_adult","ffa87eee":"def prepteste (adult):\n    qlt = adult[[\"Workclass\",\"Martial Status\",\"Occupation\",\"Relationship\",\"Sex\"]]\n    qnt = adult.drop([\"Workclass\",\"Martial Status\",\"Occupation\",\"Race\",\"Relationship\",\"Sex\",\"Country\",\"Education\",\"fnlwgt\"], axis = 1)\n    qlt = pd.get_dummies(qlt)\n    new_adult = pd.concat([qlt, qnt], axis = 1)\n    return new_adult","aacec7ec":"x_treino = preptreino(adult)\ny_treino = adult[\"Target\"]","08f3e9ec":"from sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.model_selection import cross_val_score","313dc858":"i = 15\nKaux = 15\nscore_aux = 0 \nwhile i < 30:\n  knn = KNeighborsClassifier(n_neighbors= i)\n  score = cross_val_score(knn,x_treino , y_treino, cv = 5,scoring=\"accuracy\")\n  print (\"M\u00e9dia:\", score.mean())\n  if score.mean() > score_aux:\n      score_aux = score.mean()\n      Kaux = i\n  i = i + 1\nprint (\"Melhor k:\", Kaux)\nprint (\"Melhor m\u00e9dia:\", score_aux)","62409f03":"adult_teste =pd.read_csv(\"..\/input\/adult-pmr3508\/test_data.csv\",\n            names=[\n            \"Id\",\"Age\", \"Workclass\", \"fnlwgt\", \"Education\", \"Education-Num\", \"Martial Status\",\n            \"Occupation\", \"Relationship\", \"Race\", \"Sex\", \"Capital Gain\", \"Capital Loss\",\n            \"Hours per week\", \"Country\",], skiprows = 1, sep=r'\\s*,\\s*',\n            engine='python',na_values=\"?\",)\n\nadult_teste\n","6a62e8c8":"adult_teste = adult_teste.drop([\"Id\"],axis = 1)\nadult_teste","e707babc":"missing_data = adult_teste.isnull().sum().sort_values(ascending = False)\nmissing_data\n","e6647e53":"\nvalue = adult_teste[\"Occupation\"].describe().top\nadult_teste[\"Occupation\"] = adult_teste[\"Occupation\"].fillna(value)\n#\nvalue = adult_teste[\"Workclass\"].describe().top\nadult_teste[\"Workclass\"] = adult_teste[\"Workclass\"].fillna(value)\n#\nvalue = adult_teste[\"Country\"].describe().top\nadult_teste[\"Country\"] = adult_teste[\"Country\"].fillna(value)\n","8b8e7a1e":"missing_data = adult_teste.isnull().sum().sort_values(ascending = False)\nmissing_data","d06b5cc7":"x_teste = prepteste(adult_teste)\nx_teste","ab042727":"knn = KNeighborsClassifier(n_neighbors= 20)\nknn.fit(x_treino, y_treino)\n\n","95359055":"predict_adult = knn.predict(x_teste)\npredict_adult","5f3ad3b1":"submission = pd.DataFrame()\nsubmission[\"ID\"] = adult_teste.index\nsubmission[\"Income\"] = predict_adult\nsubmission","7d36694b":"submission.to_csv('submission.csv',index = False)","d68c3734":"Mesmo com uma alta variancia e com alguns possiveis outliers as variaveis talvez sejam relevantes para o classificador, j\u00e1 que esta coerente com o que se espera. Com individuos com um maior fluxo de capital apresentando uma renda maior.\n","d965b6cb":"## 2- APLICA\u00c7\u00c3O KNN E PREDI\u00c7\u00c3O","7efc8e64":"Para come\u00e7ar vamos dividir os dados em dois: dados quantitativos e qualitativos. Depois aplicaremos a fun\u00e7\u00e3o get dummies para discretisar os dados qualitativos permitindo que o KNN qualcule a distancia usando todas as variaveis.\n","9043e70c":"Com a fun\u00e7\u00e3o fillna eu completo os dados faltantes com o valor de um rotulo, o qual foi definido como a moda de cada variavel.\n","af823f44":"### Depois da analise e tratamento dos dados estamos prontos para come\u00e7ar a trabalhar no noso classificador KNN","21b533b7":"Analisando os novos dados vemos que valores elevados de ganho de capital aparecem com relativa frequencia, e coerentemente a maioria dos individuos com grande ganho de capital tem uma receita acima de 50k. Logo n\u00e3o precisamos nos preocupar tanto com outliers e essa variavel pode ser usada normalmente pelo nosso classificador KNN","4b6b5112":"* **Agora para saber se os elevados valores de Capital Gain s\u00e3o outliers ou apenas dados elevados vamos avaliar sua frequencia e o contexto onde eles est\u00e3o.**","f00bd2ab":"* Agora que completamos a tabela, parece justo avaliar a propor\u00e7\u00e3o de outros dados nominais para n\u00e3o correr o risco de enviesar nosso classificador.","ee1ffcdc":"**Adotaremos k = 20 daqui pra frente**\n\n\n","07a71eb2":"Pode-se perceber que existe um numero suficientemente grande de dados faltantes para que valha a pena o trabalho de repor esses dados. Mas antes analisaremos o comportamento das variaveis a cima de maneira separada para esolher a melhor estrategia de imputa\u00e7\u00e3o. \n","a3a842e5":"* **Agora precisamos importar nossos dados de teste e fazer todas as mudan\u00e7as necessarias (as mesmas dos dados de treino).**","7560e08f":"Agora com a tabela em m\u00e3os, podemos usar alguns recursos das bibliotecas Pandas e NumPy para analisar e apresentar melhor os dados.\nCome\u00e7aremos analisando as caracteristicas das variaveis numericas.","31c50fd7":"No grafico fica evidente a disparidades dos dados. Claramente a pesquisa foi realizada nos Estados Unidos.\nPara n\u00e3o enviesar nosso classificador esse dado estara de fora da planilha final de treino.","e1f6aea6":"* **Agora temos que definir o valo K do nosso KNN. Vamos fazer isso inferindo alguns valores arbitrarios e testando sua eficiencia.** ","21eae462":"Com nossos valores de Target discretisados um grafico heatmap nos ajudara a avaliar quains variaveis numericas s\u00e3o mais importantes para o nosso classificador","b8b96ce6":" Podemos ver quer a variavel fnlwgt tem muito pouca influencia sobre a variavel de classe. Por esse motivo n fara muita falta no nosso classificador e pode ser removida\n","0c4c9f2b":"As variaveis workclass, occupation e coutry tem uma quantidade significativa de dados faltantes, mas a fun\u00e7\u00e3o info n\u00e3o nos fornesse numeros precisos. Aplicando fun\u00e7\u00f5es mais completa ","dfa13a64":"Separamos nossa variavel de classe das demais ao mesmo tempo que tiramos variveis pouco relevantes para o classificadore transformamos nossas variaveis qualitativas variaveis binarias numericas.","989d5d4a":"* **E agora usaremos nosso KNN com k = 20 e o alinhamos com os dados de treino**","2af7b4b5":"Em occupation os dados est\u00e3o mais bem distribuidos, mas mesmo assim ainda faz sentido usar a moda para imputar os faltantes.","3568227d":"* **Agora parece justo analisar a correla\u00e7\u00e3o entre os dados, e principalmente a correla\u00e7\u00e3o de cada variavel e a variavel de classe Target. Para isso usaremos um heatmap.**","12f4955b":"# ANALISE E PREDI\u00c7\u00c3O DE DADOS BASE ADULT UCI COM CLASSIFICADOR KNN","6b9ec6a6":"* **E finalmente executamos nossa predi\u00e7\u00e3o**","e04cb603":"O hitograma dos ganhos e perdas de capital s\u00f3 deixam mais evidente a desigualdade dos ganhos e perdas de capital. Mas para saber se essa descrepancia faz sentido teremos que avaliar as frequencias dessas variaveis em cada possibilidade e Target","b6aaf5b8":"Antes de tudo vamos importar o dataset do repositorio do Kaggle e padronizo os nomes das variaveis com o dataset do UCI","1ee484bd":"#### **PMR3508 - Aprendizado de M\u00e1quina e Reconhecimento de Padr\u00f5es***","a6ffe381":"* **Agora vamos dar uma olhada mais de perto nas variaveis Capital Gain e Capital Loss.**","988ee51f":"Nesse dado a moda tambem \u00e9 esmagadora porem faz sentido com a maioria dos cidad\u00e3os trabalhando no setor privado. ","a69ac238":"Usando as ferramentas da biblioteca sklearn testaremos varios valores de K e comparemos sua eficacia numa fun\u00e7\u00e3o de cros validation com cv = 5.","ad8d8adf":"Para usarmos o heatmap de maneira apropriada precisaremos transformar a variavel Target em uma variavel numerica. Para isso discretisaremos seus valores usando uma fun\u00e7\u00e3o encoder.","f5743f4f":"## 1- Analise e pre tratamento de dados ","5d4096aa":"Olhando os dados de m\u00e9dia, desvio padr\u00e3o e os extremos de cada variavel tem-se uma ideia do perfil de cada atributo da tabela. \nAs variaveis Capital Gain e Capital Loss por exemplo apresentam uma alta variancia e possibilidade de outliers (valor maximo de Capital Gain). Mais pra frente daremos uma olhada mais de perto nesse problema mas por hora vamos descobrir se existem dados faltantes.","6d56476f":"Podemos ver que a os graficos apresentam uma propor\u00e7\u00e3o justa, exceto o da variavel Race que n\u00e3o condiz nem um pouco com a realidade, nem dos EUA nem do mundo, e por esse motivo a mesma tambem estara fora da nossa tabela de treino."}}