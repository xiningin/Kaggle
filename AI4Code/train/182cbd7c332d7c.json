{"cell_type":{"7fbd3829":"code","aebd0b1b":"code","8976dfd2":"code","b0a5de74":"code","4c02c109":"code","c8b7cc00":"code","76dbab3f":"code","591fba2f":"code","ad9d4d82":"code","74223e98":"code","c5222687":"code","fdc20747":"code","cc218adb":"code","46dcc936":"code","f4128773":"markdown","43a80b51":"markdown","829d7102":"markdown","16dd6e8d":"markdown","bfb9657c":"markdown","56882458":"markdown","8d5b31c4":"markdown","b29f2fc9":"markdown","f2e81bcb":"markdown","d20a8e69":"markdown","75053561":"markdown","b0f5b5c4":"markdown"},"source":{"7fbd3829":"import bq_helper\nimport matplotlib.pyplot as plt\nimport matplotlib.ticker as ticker\nimport numpy as np\nimport seaborn as sns\nfrom matplotlib.pyplot import figure\nfrom bq_helper import BigQueryHelper\nimport pandas as pd\nimport plotly.express as px\n# Using instructions found on https:\/\/www.kaggle.com\/sohier\/introduction-to-the-bq-helper-package\nchicago_crime = bq_helper.BigQueryHelper(active_project=\"bigquery-public-data\",\n                                   dataset_name=\"chicago_crime\")\n","aebd0b1b":"bq_assistant = BigQueryHelper('bigquery-public-data', 'chicago_crime')\nbq_assistant.list_tables()\n","8976dfd2":"bq_assistant.head('crime')\n","b0a5de74":"query = \"\"\"SELECT date,\nprimary_type,\narrest,\nward,\nyear\nFROM\n  `bigquery-public-data.chicago_crime.crime`\nWHERE\nyear IN (\n2019,\n2020)\n\"\"\"\nresponse1 = chicago_crime.query_to_pandas_safe(query)","4c02c109":"response1 = response1.sort_values(by = 'date')\nresponse1['date_only'] = response1['date'].dt.date","c8b7cc00":"fig, ax = plt.subplots()\nax.plot(response1.groupby('date_only').agg({'date_only':'count'}))","76dbab3f":"from datetime import datetime\nfirst_cutoff = datetime.strptime(\"2019-07-21\", \"%Y-%m-%d\")\nfirst_cutoff = first_cutoff.date()\nshutdown = datetime.strptime('2020-03-18',\"%Y-%m-%d\")\nshutdown = shutdown.date()\nallcrime_july2019_nov2020 = response1[response1['date_only'] >= first_cutoff]\nfig, ax = plt.subplots()\nax.plot(allcrime_july2019_nov2020.groupby('date_only').agg({'date_only':'count'}))\nplt.xticks(rotation = 45)","591fba2f":"allcrime_agg_july2019_nov2020 = pd.DataFrame(allcrime_july2019_nov2020.groupby('date_only').agg({'date_only':'count'}))\nallcrime_agg_july2019_nov2020.columns = ['count']\nfig = px.line(allcrime_agg_july2019_nov2020, x= allcrime_agg_july2019_nov2020.index, y= 'count')\nfig = fig.add_shape(type=\"line\",x0= shutdown, y0=0, x1=shutdown, y1=2000,line=dict(color=\"MediumPurple\",width=3, dash = 'dashdot'))\nfig.show()\n \n","ad9d4d82":"arrests_july2019_nov2020 = allcrime_july2019_nov2020[allcrime_july2019_nov2020['arrest']==True]\narrests_agg_july2019_nov2020 = pd.DataFrame(arrests_july2019_nov2020.groupby('date_only').agg({'date_only':'count'}))\narrests_agg_july2019_nov2020.columns = ['arrests']\nfig = px.line(arrests_agg_july2019_nov2020, x= arrests_agg_july2019_nov2020.index, y= 'arrests')\nfig = fig.add_shape(type=\"line\",x0= shutdown, y0=0, x1=shutdown, y1=200,line=dict(color=\"MediumPurple\",width=3, dash = 'dashdot'))\nfig.show()\n \n","74223e98":"!pip install rdd\nfrom rdd import rdd\n# We cant use the rdd package with a datetime index. To get around that I'll just generate a series\narrests_agg_july2019_nov2020['counter'] = list(range(1,(len(arrests_agg_july2019_nov2020.index)+1)))\n#Shutdown is 242\n\nmodel = rdd.rdd(arrests_agg_july2019_nov2020, 'counter', 'arrests', cut=242)\nprint(model.fit().summary())\n","c5222687":"response1['Pandemic Status'] = np.where(response1['date_only'] < shutdown, 'Pre', 'Post')\ng = sns.catplot(x=\"primary_type\", col=\"Pandemic Status\",\n                data=response1, kind=\"count\",\n                height=6, aspect=.7,\n               order=response1.primary_type.value_counts().iloc[:10].index);\ng.set_xticklabels(rotation = 90)\ng.set_axis_labels(\"Type\", \"Calls to police\")","fdc20747":"arrests_july2019_nov2020['Pandemic Status'] = np.where(arrests_july2019_nov2020['date_only'] < shutdown, 'Pre', 'Post')\nh = sns.catplot(x=\"primary_type\", col=\"Pandemic Status\",\n                data=arrests_july2019_nov2020, kind=\"count\",\n                height=6, aspect=.7,\n               order=arrests_july2019_nov2020.primary_type.value_counts().iloc[:10].index);\nh.set_xticklabels(rotation = 90)\nh.set_axis_labels(\"Type\", \"Arrests\")","cc218adb":"pre_pandemic_arrests = arrests_july2019_nov2020[arrests_july2019_nov2020['Pandemic Status'] == 'Pre'].groupby('primary_type').agg({'primary_type':'count'})\npost_pandemic_arrests = arrests_july2019_nov2020[arrests_july2019_nov2020['Pandemic Status'] == 'Post'].groupby('primary_type').agg({'primary_type':'count'})\nfig1 = px.pie(pre_pandemic_arrests, values = 'primary_type', names = pre_pandemic_arrests.index, \n              title = 'Pre Pandemic Arrests')\nfig1.update_traces(textposition='inside')\nfig1.update_layout(uniformtext_minsize=12, uniformtext_mode='hide')\nfig1.show()","46dcc936":"fig2 = px.pie(post_pandemic_arrests, values = 'primary_type', names = post_pandemic_arrests.index, title = \n            'Post Pandemic Arrests')\nfig2.show()","f4128773":"This makes a huge difference. There's a clear divide between before and after the shutdown order. There is only one significant spike in the post-shutdown data, and it is comparable to ~ the average level pre-COVID. Lets use a regression discontinuity design package to investigate this further.","43a80b51":"For now, we can leave it at that. Through simple data visualization combined with an incredibly basic regression discontinuity design model we have shown that crime has decreased post-pandemic in Chicago. We have also shown that the types of arrests have changed post-pandemic. This could be indicative that non-legal markets are suffering from the lack of social activities, or that the pattern of enforcement has changed post-pandemic.","829d7102":"So, that confirms what we could already see. There is a statistically significant difference between the number of arrests pre and post lockdown. That package is made by Evan Magnusson and you can find it [here](https:\/\/pypi.org\/project\/rdd\/).\n\nLet's examine the types of arrests, and calls to police, pre and post pandemic. We will start with calls to \/ interactions with police.","16dd6e8d":"Now that we have the data from 2019 and 2020 in a dataframe, we can begin to determine if the number of crimes responded to, and arrests made, changed after the onset of the COVID-19 pandemic. We need to do a bit of data cleaning first, as we don't necessarily care about the time a crime was committed, but only the date.","bfb9657c":"That's better. It does look like all crime (or, incidents involving police) decreased around the shelter in place order. However, there's a giant spike near the beginning of June. This is likely due to the protests surrounding the murder of George Floyd. Lets use Plotly to take a closer look.","56882458":"In terms of arrests, it seems like the biggest change is number of narcotics arrests. This might imply that non-legal markets suffered a similar fate to their legal counterparts after the imposition of the lockdown in Chicago. On the other hand, this could also imply that the number of narcotics arrests is a function of policing effort; with the imposition of the lockdown, officers became less likely, or willing, to seek out arrests. For good measure, let's compare two pie charts of arrests pre and post lockdown. ","8d5b31c4":"We can move onto plotting our data by date now. ","b29f2fc9":"Moving on to arrests.","f2e81bcb":"So it does look like there is a significant decline for ~ a 2 month period, however, there are two large jumps in the number of crimes (or incidents involving police) on May 31, 2020 and August 10th, 2020. These correspond to two protests around police brutality. Lets see if there is still the same result when we filter the number of observations to where there was an arrest made.","d20a8e69":"It looks like our window is still too large. I'm writing this on November 14, 2020. Chicago's first shelter in place order was March 18, 2020. That is a difference of 241 days. 241 days before March 18, 2020, was July 21 2019. We will use that as our starting point for our data.","75053561":"We don't need all of these variables. Next we will write a query with online a subset selected.","b0f5b5c4":"Let's see how the Coronavirus lockdown has impacted crime in Chicago. First, let's take a look at the head of the table to see what the variables are."}}