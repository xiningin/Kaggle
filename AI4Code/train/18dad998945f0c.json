{"cell_type":{"fc5dfec8":"code","1a98b845":"code","a4506a4c":"code","e5cc7231":"code","da169400":"code","09c852c5":"code","6a6e11b1":"code","a1137318":"code","3b282ec8":"code","545f833a":"code","8fb34241":"code","e426a896":"code","41924b95":"code","11a8271b":"markdown","7d3a8d19":"markdown","97cec849":"markdown","3763ec32":"markdown","eaa33c32":"markdown","33abe669":"markdown"},"source":{"fc5dfec8":"import pandas as pd\nimport numpy as np\nimport os\n\n#import data visualization libraries\nimport missingno\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport geopandas as gpd\n\n\nPROJECT_ID = 'kaggle-tutorial-249207'\n\nfrom google.cloud import bigquery\nclient = bigquery.Client(project=PROJECT_ID, location=\"US\")\ndataset = client.create_dataset('model_dataset', exists_ok=True)\n\nfrom google.cloud.bigquery import magics\nfrom kaggle.gcp import KaggleKernelCredentials\nmagics.context.credentials = KaggleKernelCredentials()\nmagics.context.project = PROJECT_ID\n\n%load_ext google.cloud.bigquery","1a98b845":"%%bigquery location_rides_2018\nSELECT \n    t.start_station_name as station_name,\n    s.status as station_status,\n    s.latitude as latitude, \n    s.longitude as longitude,\n    COUNT(bikeid) as num_rides\nFROM `bigquery-public-data.austin_bikeshare.bikeshare_trips` as t\nINNER JOIN `bigquery-public-data.austin_bikeshare.bikeshare_stations` as s\n    ON t.start_station_name = s.name\nWHERE DATE(start_time) BETWEEN '2018-01-01' AND '2019-01-01'\nGROUP BY station_name, station_status, latitude, longitude\n","a4506a4c":"location_rides_2018.tail()","e5cc7231":"gdf = gpd.GeoDataFrame(\n    location_rides_2018, geometry=gpd.points_from_xy(location_rides_2018.longitude, location_rides_2018.latitude))","da169400":"gdf.head()","09c852c5":"gdf.max()","6a6e11b1":"%%bigquery location_rides_2017\nSELECT \n    t.start_station_name as station_name,\n    s.status as station_status,\n    s.latitude as latitude, \n    s.longitude as longitude,\n    COUNT(bikeid) as num_rides\nFROM `bigquery-public-data.austin_bikeshare.bikeshare_trips` as t\nINNER JOIN `bigquery-public-data.austin_bikeshare.bikeshare_stations` as s\n    ON t.start_station_name = s.name\nWHERE DATE(start_time) BETWEEN '2017-01-01' AND '2018-01-01'\nGROUP BY station_name, station_status, latitude, longitude","a1137318":"gdf_2017 = gpd.GeoDataFrame(\n    location_rides_2017, geometry=gpd.points_from_xy(location_rides_2017.longitude, location_rides_2017.latitude))","3b282ec8":"gdf_2017.head()","545f833a":"# Use Geopandas to read the Shapefile\naustin_shp_gdf = gpd.read_file('..\/input\/data-science-for-good\/cpe-data\/Dept_37-00027\/37-00027_Shapefiles\/APD_DIST.dbf')\n#austin_shp_gdf = gpd.read_file('..\/input\/data-science-for-good\/cpe-data\/Dept_37-00027\/37-00027_Shapefiles\/APD_DIST.sbn')\n#austin_shp_gdf = gpd.read_file('..\/input\/data-science-for-good\/cpe-data\/Dept_37-00027\/37-00027_Shapefiles\/APD_DIST.sbx')\naustin_shp_gdf = gpd.read_file('..\/input\/data-science-for-good\/cpe-data\/Dept_37-00027\/37-00027_Shapefiles\/APD_DIST.shp')\naustin_shp_gdf = gpd.read_file('..\/input\/data-science-for-good\/cpe-data\/Dept_37-00027\/37-00027_Shapefiles\/APD_DIST.shx')\n\naustin_shp_gdf.crs = {'init' :'esri:102739'}\naustin_shp_gdf = austin_shp_gdf.to_crs(epsg='4326')","8fb34241":"location_rides_2017_grouped = location_rides_2017.groupby(\"station_name\").sum() #station names as index\nstations_2017 = location_rides_2017_grouped.index #get all station names\n\nlocation_rides_2018_grouped = location_rides_2018.groupby(\"station_name\").sum() #station names as index\nstations_2018 = location_rides_2018_grouped.index #get all station names\n\nstations_new_2018 = sorted(list(set(stations_2018) - set(stations_2017)))\n\ngdf_new = (gdf.loc[gdf['station_name'].isin(stations_new_2018)])\n#get new stations list","e426a896":"fig1,ax1 = plt.subplots(nrows=1, ncols=2, figsize=(25, 25))\naustin_shp_gdf.plot(ax=ax1[1],color='#556B2F')\ngdf.plot(ax=ax1[1],marker='.',color='#FFE67C',markersize=(gdf['num_rides'])\/27)\ngdf_new.plot(ax=ax1[1],marker='.',color='#F76D82',markersize=(gdf_new['num_rides'])\/27,label='new stations')\nax1[1].set_xlim([-97.8,-97.7])\nax1[1].set_ylim([30.23,30.31])\nax1[1].title.set_text('Bike Share 2018 in Austin,Tx')\nax1[1].axis(\"off\")\nax1[1].legend(loc='lower center', framealpha=0.1, borderpad = 1)\n\naustin_shp_gdf.plot(ax=ax1[0],color='#556B2F')\ngdf_2017.plot(ax=ax1[0],marker='.',color='#FFE67C',markersize=(gdf_2017['num_rides'])\/27)\nax1[0].set_xlim([-97.8,-97.7])\nax1[0].set_ylim([30.23,30.31])\nax1[0].title.set_text('Bike Share 2017')\nax1[0].axis(\"off\")\n\nl1 = plt.scatter([],[], s=10, c='#FFE67C', edgecolors='none')\nl2 = plt.scatter([],[], s=80, c='#FFE67C',edgecolors='none')\nl3 = plt.scatter([],[], s=250, c='#FFE67C', edgecolors='none')\nl4 = plt.scatter([],[], s=600, c='#FFE67C', edgecolors='none')\n\nlabels = [\"1k\", \"5k\", \"20k\", \"70k\"]\n\nax1[0].legend([l1, l2, l3, l4], labels, ncol=4, frameon=True, fontsize=10,\nhandlelength=2, loc = 8, borderpad = 1, framealpha=0.1,\nhandletextpad=1, title='Total Number of Trips started', scatterpoints = 1)\n#plt.setp(leg.get_texts(), color='w')","41924b95":"\n# %bigquery test\n# SELECT \n#     EXTRACT(MONTH from start_time) as month_2017,\n#     COUNT(*) as monthly_rides_2017\n# FROM `bigquery-public-data.austin_bikeshare.bikeshare_trips`\n# WHERE\n#     DATE(start_time) BETWEEN '2017-01-01' AND '2018-01-01'\n# GROUP BY \n#     monthly_rides_2017, month_2017\n    ","11a8271b":"# 1. Setup Bigquery Environment, Libraries & Loading the Data\n\nLoading up all the Python libraries for data analysis, and loading the data from SQL queries.\nAll this was done previously in the first kernel - so all the code is masked.","7d3a8d19":"# Introduction: Deeper Insights on Austin Bike Share\n\n![bike rentals](https:\/\/upload.wikimedia.org\/wikipedia\/commons\/thumb\/a\/a0\/Bay_Area_Bike_Share_launch_in_San_Jose_CA.jpg\/640px-Bay_Area_Bike_Share_launch_in_San_Jose_CA.jpg)\n\nThis is the 2nd kernel on the Austin bike share dataset.\nhttps:\/\/www.kaggle.com\/dcstang\/bigquery-ml-austin-bike-share-2013-2019\n\nWe will have a deeper look at one aspect of the dataset\n>  Geographical impact on station hire\n","97cec849":"# 3. Plotting Data","3763ec32":"# 5. What's next\n\nI would like to examine the seasonality of the data as well with BigQuery. Will post a link here once it's ready.","eaa33c32":"# 2. Getting 2017 & 2018 Data, and making Geopandas Points","33abe669":"# 4. Insights from geographical data\n\n**Few insights from this new data:**\n- Explosion of new stations on the northern side of the city\n- sprinkling of new stations in between old routes, mainly along large roads\n- slight decrease of number of rides in the southern side (~10-20%)\n- only increase of rides for *old stations* is within the northern part\n\n**Business insights:**\n- addition of new stations on northern site is profitable and increases the number of rides for the older stations in proximity.\n- growth on the southern \/ western side is not as pronounced, customers maybe flocking to northern side"}}