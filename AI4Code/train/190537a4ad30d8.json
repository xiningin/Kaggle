{"cell_type":{"74167bd7":"code","e1d746b3":"code","eca06654":"code","32f8980e":"code","31aa3c31":"code","c3da3e85":"code","35314a62":"code","5918334e":"code","0235735e":"code","8c1cd498":"code","c9bd2f86":"code","38ef9594":"code","c4a308d2":"code","78513cd2":"code","42e97491":"code","16f5f1ff":"code","e77645d5":"code","9a1f1543":"code","09fe32c8":"code","fbfd3511":"code","a04c6d4b":"code","650f44a6":"code","f94d2167":"code","1b757624":"code","8846f72c":"code","5fb062af":"code","e05db12f":"code","257917f5":"code","3384e737":"code","4e0fd48d":"code","b8638387":"code","4df31340":"code","11ab49b6":"code","1e23bace":"code","9527e1c2":"code","21dc3cce":"code","c18c6db9":"code","dd9f4e21":"code","3cabd338":"code","a1017849":"code","f1c6aa6f":"markdown","bbb7c36a":"markdown","6548afc8":"markdown","c5304b77":"markdown","72965b59":"markdown","ff9b738f":"markdown","014e85ea":"markdown","3a1a5c35":"markdown","b6c04442":"markdown","326aafe0":"markdown","e12084fa":"markdown","8e160344":"markdown","4159e475":"markdown","69735146":"markdown","f48650e5":"markdown","1fac2060":"markdown","93c6343f":"markdown","971ffff8":"markdown"},"source":{"74167bd7":"import pandas as pd\nimport datetime as dt\nimport seaborn as sns\nimport numpy as np\nfrom sklearn.cluster import KMeans\nfrom sklearn.metrics import silhouette_score\nimport matplotlib.pyplot as plt\n%matplotlib inline","e1d746b3":"df=pd.read_excel(\"..\/input\/Online Retail.xlsx\")","eca06654":"df.columns","32f8980e":"df.head()","31aa3c31":"df.isna().sum()","c3da3e85":"df.describe()","35314a62":"df=df[ ~df.CustomerID.isna()]","5918334e":"df.isna().sum()","0235735e":"df.describe()","8c1cd498":"df[\"total_price\"]=df.Quantity*df.UnitPrice","c9bd2f86":"df","38ef9594":"df.CustomerID.describe()","c4a308d2":"df.total_price.describe()","78513cd2":"#Top Customers\ndf.groupby('CustomerID').agg({'total_price':lambda x:sum(x)}).sort_values(ascending=False,by='total_price')","42e97491":"df[df.CustomerID==17448.0]","16f5f1ff":"df.columns","e77645d5":"df.Country.unique()","9a1f1543":"df.Description.unique()","09fe32c8":"#Unique Customers\ndf.groupby('CustomerID').agg({'InvoiceNo':lambda x:pd.Series.nunique(x)}).sort_values(ascending=False,by='InvoiceNo')","fbfd3511":"df[df.CustomerID.isin(df[df.Quantity<0].CustomerID)]","a04c6d4b":"df.InvoiceDate.max()","650f44a6":"df.InvoiceDate.min()","f94d2167":"(dt.datetime.now()-df.InvoiceDate.min()).days","1b757624":"df.dtypes","8846f72c":"current_time=df.InvoiceDate.max()","5fb062af":"grp=df.groupby('CustomerID').agg({'InvoiceNo': lambda x:pd.Series.nunique(x),\\\n                                 'total_price':lambda x: sum(x),\n                                 'InvoiceDate':lambda x:(current_time-max(x)).days})","e05db12f":"grp=grp.rename(columns={\"InvoiceNo\":\"Frequency\",\n           \"total_price\":\"Monetry\",\n           \"InvoiceDate\":\"Recency\"})","257917f5":"grp","3384e737":"sns.pairplot(grp)","4e0fd48d":"def score(x,series,recency=False):\n    if recency==False:\n        if x<=series.quantile(0.25):\n            return 1\n        elif x<=series.quantile(0.5):\n            return 2\n        elif x<=series.quantile(0.75):\n            return 3\n        else:\n            return 4\n    else:\n        if x<=series.quantile(0.25):\n            return 4\n        elif x<=series.quantile(0.5):\n            return 3\n        elif x<=series.quantile(0.75):\n            return 2\n        else:\n            return 1\n        \ngrp['R_Score']=grp.Recency.map(lambda x: score(x,grp.Recency,True))\ngrp['F_Score']=grp.Frequency.map(lambda x: score(x,grp.Frequency))\ngrp['M_Score']=grp.Monetry.map(lambda x: score(x,grp.Monetry))        ","b8638387":"grp","4df31340":"cluster=KMeans(n_clusters=7,random_state=25,max_iter=1000)\ncluster.fit(grp[['F_Score',\"M_Score\",\"R_Score\"]])","11ab49b6":"labels=cluster.predict(grp[['F_Score', 'R_Score', 'M_Score']])\ngrp['labels']=labels","1e23bace":"grp","9527e1c2":"score=silhouette_score(grp[['F_Score',\"M_Score\",\"R_Score\"]],labels)\nprint('Silhoutte Score:',score)","21dc3cce":"grp.columns","c18c6db9":"cluster.cluster_centers_","dd9f4e21":"for k in range(2,20):\n    cluster=KMeans(n_clusters=k,random_state=23,max_iter=1000,n_jobs=-1)\n    cluster.fit(grp[['F_Score',\"M_Score\",\"R_Score\"]])\n    labels=cluster.predict(grp[['F_Score', 'R_Score', 'M_Score']])\n    score=silhouette_score(grp[['F_Score',\"M_Score\",\"R_Score\"]],labels)\n    print('No of Clusters-K:',k,'\/','Score:',score)\n    ","3cabd338":"cluster.cluster_centers_","a1017849":"wcss = []\nfor i in range(1,11):\n    kmeans = KMeans(n_clusters=i,init='k-means++',max_iter=300,n_init=10,random_state=0)\n    kmeans.fit(grp[['F_Score',\"M_Score\",\"R_Score\"]])\n    wcss.append(kmeans.inertia_)\nplt.plot(range(1,11),wcss)\nplt.title('The Elbow Method')\nplt.xlabel('Number of clusters')\nplt.ylabel('WCSS')\nplt.show()","f1c6aa6f":"## UnSupervised Learning- CLUSTERING","bbb7c36a":"#### Lets Start Now... \nImport all the libraries required.\n","6548afc8":"#### Calculate the Silhoutte Coefficient","c5304b77":"#Recency - the Recency value for a retailer is the time\ninterval between a global datum and his\/her latest\ntransaction.\n\n#Frequency - the total number of transactions put through\nall of the EFTPOS terminals belonging to a retailer forms\nthe Frequency value of the retailer.\n\n#Monetary value - the total amount of transactions put\nthrough all of the EFTPOS terminals belonging a retailer\nforms the Monetary value of the retailer.","72965b59":"### K Means Clustering:\n\tK Means is a partitioned based clustering. ","ff9b738f":"The Silhouette Coefficient is calculated using the mean intra-cluster\ndistance (``a``) and the mean nearest-cluster distance (``b``) for each\nsample.  The Silhouette Coefficient for a sample is ``(b - a) \/ max(a,b)``.  \nTo clarify, ``b`` is the distance between a sample and the nearest\ncluster that the sample is not a part of.\nNote that Silhouette Coefficient is only defined if number of labels\nis 2 <= n_labels <= n_samples - 1.\n\nThis function returns the mean Silhouette Coefficient over all samples.\n\nThe best value is 1 and the worst value is -1. Values near 0 indicate\noverlapping clusters. Negative values generally indicate that a sample has\nbeen assigned to the wrong cluster, as a different cluster is more similar.","014e85ea":"### Discussion on RFM Scores","3a1a5c35":"Import the Data Set from the datapath","b6c04442":"### Simpler representation of RFM analysis\nwe can plot frequency + monetary score on Y-axis (range of 1 to 4) and recency (range of 1 to 4) on X-axis.\n\nThis reduces possible combinations from 64 to 16. Combining F and M into one makes sense because both are related to how much the customer is buying. R on the other axis gives us quick peek into re-engagement levels with customer.\n\nThe customer is equally important in both cases. And our approach of combining frequency and monetary scores gives them equal importance in our RFM analysis.","326aafe0":"#### RFM Analysis","e12084fa":"Creating a new column called as 'total_price' by multiplying Quantity and UnitPrice","8e160344":"R, F and M have scores from 1-4, there are a total of 4x4x4 = 64 combinations of RFM value. Three dimensions of R, F and M can be best plotted on a 3D chart. \n\nIf we were to look at how many customers do we have for each RFM value, we\u2019d have to look at 64 points of data.\n\nBut working with 3D charts on paper or a computer screen is not going to work. We need something in two dimensions, something easier to depict and understand.","4159e475":"### Making it more effective \u2013 creating segments\n\nSelect groups of customers, based on the RFM segments in which they appear.\n\nIt is helpful to assign names to segments of interest. Here are just a group types to which the customers can be segmented:\n\n#### Best Customers \u2013 This group consists of those customers who are found in R-Tier-4, F-Tier-4 and M-Tier-4, meaning that they transacted recently, do so often and spend more than other customers. A shortened notation for this segment is 4-4-4; we\u2019ll use this notation going forward.\n\n#### High-spending New Customers \u2013 This group consists of those customers in 4-1-4 and 4-1-3. These are customers who transacted only once, but very recently and they spent a lot.\n\n#### Lowest-Spending Active Loyal Customers \u2013 This group consists of those customers in segments 4-4-1 and 4-4-2 (they transacted recently and do so often, but spend the least).\n\n#### Churned Best Customers \u2013 This segment consists of those customers in groups 1-4-4, 1-4-3, 1-3-4 and 1-3-3 (they transacted frequently and spent a lot, but it\u2019s been a long time since they\u2019ve transacted).\nMarketers should assemble groups of customers most relevant for their particular business objectives and retention goals.\n","69735146":"### Clustering\n    Process of dividing datasets into groups, consisting o similar points. \n    A group of objects that are similar to other objects in the cluster, and dissimilar to data points in other cluster.","f48650e5":"Convert the RFM values to scores","1fac2060":"Calculate the Elbow Point","93c6343f":"### Business Overview\n\nBest Customers: Communications with this group should make them feel valued and appreciated. These customers likely generate a disproportionately high percentage of overall revenues and thus focusing on keeping them happy should be a top priority. Further analyzing their individual preferences and affinities will provide additional opportunities for even more personalized messaging.\n\n\nHigh-spending New Customers \u2013 It is always a good idea to carefully \u201cincubate\u201d all new customers, but because these new customers spent a lot on their first purchase, it\u2019s even more important. Like with the Best Customers group, it\u2019s important to make them feel valued and appreciated \u2013 and to give them terrific incentives to continue interacting with the brand.\n\n\nLowest-Spending Active Loyal Customers \u2013 These repeat customers are active and loyal, but they are low spenders. Marketers should create campaigns for this group that make them feel valued, and incentivize them to increase their spend levels. As loyal customers, it often also pays to reward them with special offers if they spread the word about the brand to their friends, e.g., via social networks.\n\n\nChurned Best Customers \u2013 These are valuable customers who stopped transacting a long time ago. While it\u2019s often challenging to re-engage churned customers, the high value of these customers makes it worthwhile trying. Like with the Best Customers group, it\u2019s important to communicate with them on the basis of their specific preferences, as known from earlier transaction data.\nOf course, deciding which groups of customers to target and how to best communicate with them is where the art of marketing comes in!","971ffff8":"Cross verify how many records have Negative price."}}