{"cell_type":{"a86310d0":"code","537fcb77":"code","34a0e9e4":"code","79fcfed3":"code","d1d4453b":"code","fdec76b4":"code","4bf491c4":"code","c7ebba4d":"code","41ee1048":"code","a988351b":"code","010e961d":"code","5e9b10bf":"code","3baa7416":"code","506322a8":"code","6215733f":"code","fefede9e":"code","7dbcf1b5":"code","3c9636c0":"code","6b5340e8":"code","1f8db7fb":"code","67b1664d":"code","93065018":"code","0f5862b0":"code","5aaaf192":"code","3290ef4a":"code","25862cb2":"code","776bf1c8":"code","1a7e4ccd":"code","88331178":"code","25b5651c":"code","c8c61514":"code","df90811f":"code","19d16f4e":"code","1d678b2c":"code","5b7e7ca4":"code","4185977f":"code","1b8ab6ff":"code","71f966c1":"code","d0e64bc5":"code","a79c41c0":"code","76facd09":"code","aa7ff4e4":"code","10b2b05f":"code","ddaf0d6d":"code","b8ed63fb":"code","7af700b2":"code","c5903e7d":"code","00dcb51d":"code","5f39c868":"code","33705b5f":"code","9dc19abe":"code","095fa2ac":"code","04ba45bf":"code","d513d8a7":"code","a9541fa4":"code","21a69f36":"code","64f50b2b":"code","9c97011c":"code","de50bcd9":"code","ff23372d":"code","7a8ee436":"code","52f4ab1d":"markdown","f0e5c84c":"markdown","c0d22617":"markdown","04751aa3":"markdown","e62b01a9":"markdown","df90d483":"markdown","86cecd7a":"markdown","1de2052a":"markdown","0eb9205a":"markdown","b683a0bf":"markdown","e0a21fea":"markdown","018d4e02":"markdown","ea74222c":"markdown","74f8e662":"markdown"},"source":{"a86310d0":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport scipy\nfrom scipy import stats\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))","537fcb77":"#Plotting\nimport plotly\nimport plotly.graph_objs as go\nfrom plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot\nimport plotly.express as px\nimport plotly.figure_factory as ff\nfrom plotly import subplots\n# Display plot in the same cell for plotly\ninit_notebook_mode(connected=True)","34a0e9e4":"import sklearn\nfrom sklearn import linear_model,metrics\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.metrics import r2_score, mean_squared_error, make_scorer","79fcfed3":"print('Numpy : Version ',np.__version__)\nprint('Pandas : Version ',pd.__version__)\nprint('Plotly : Version ',plotly.__version__)\nprint('Plotly Express : Version ',plotly.express.__version__)\nprint('Scikit-Learn : Version ',sklearn.__version__)","d1d4453b":"# Colors from material design to make visualizations look awesome!\nmaterial_blue = '#81d4fa'\ndark_blue = '#1e88e5'\nmaterial_green = '#a5d6a7'\ndark_green = '#43a047'\nmaterial_indigo = '#3f51b5'\nmaterial_red = '#f44336'\nbg_color = '#212121'","fdec76b4":"# Importing the train dataset\ndf_train = pd.read_csv('..\/input\/train.csv')\ndf_train.head()","4bf491c4":"# Importing the test dataset\ndf_test = pd.read_csv('..\/input\/test.csv')\ndf_test.head()","c7ebba4d":"# Column names\ndf_train.columns","41ee1048":"# Shape => Tuple of no. of rows and columns\ndf_train.shape","a988351b":"df_train.describe()","010e961d":"total = df_train.isnull().sum().sort_values(ascending=False)\nmissing_cols = list(total.index)\ntotal_values = list(total[:])\ndf_missing = pd.DataFrame(dict({'columns':missing_cols,'total':total_values}))\ndf_missing = df_missing[df_missing['total']>0]\ndf_missing","5e9b10bf":"fig = px.bar(df_missing, x='columns',y='total')\nfig.update_traces(marker_color=dark_blue)\niplot(fig)","3baa7416":"missing_data_cols = list(df_missing['columns'])\ndf_train[missing_data_cols].head()","506322a8":"df_train[df_train['PoolArea']>0].shape[0]","6215733f":"df_train[df_train['Fireplaces']>0].shape[0]","fefede9e":"cols_to_be_del = ['PoolQC','PoolArea','MiscFeature','Alley','Fence','Fireplaces','FireplaceQu','LotFrontage']\ndf_train.drop(cols_to_be_del, inplace=True, axis=1)\ndf_train.shape","7dbcf1b5":"df_test.head()","3c9636c0":"compare_df = df_train[df_train['GarageCars']>0]['Id'] == df_train[df_train['GarageArea']>0]['Id']\ncompare_df.shape[0]","6b5340e8":"df_missing.tail(13)","1f8db7fb":"cols_to_be_del_2 = ['GarageCond', 'GarageQual', 'GarageYrBlt', 'GarageFinish', 'GarageType','MasVnrType']\ndf_train.drop(cols_to_be_del_2, inplace=True, axis=1)\ndf_train.shape","67b1664d":"cols_to_be_del_3 = ['BsmtQual','BsmtCond','BsmtCond','BsmtExposure','BsmtFinType1','BsmtFinType2','Electrical']\ndf_train.drop(cols_to_be_del_3, axis=1, inplace=True)\ndf_train.shape","93065018":"df_missing.tail(3)","0f5862b0":"df_train['MasVnrArea'].describe()","5aaaf192":"df_train.fillna(df_train.median(), inplace=True)\ndf_train.isnull().values.sum()","3290ef4a":"print(\"Skewness: {}\".format(str(df_train['SalePrice'].skew())))\nprint(\"Kurtosis: {}\".format(str(df_train['SalePrice'].kurt())))","25862cb2":"fig = px.histogram(df_train, x='SalePrice', nbins=100)\niplot(fig)","776bf1c8":"fig = ff.create_distplot([df_train['SalePrice']],['SalePrice'],bin_size=20000, colors=[dark_blue],show_hist=False)\niplot(fig, filename='Basic Distplot')","1a7e4ccd":"def box_plot(dataframe, columns):\n    data = []\n    for column in columns:\n        data.append(go.Box(y=df_train[column], name=column, boxmean='sd',fillcolor=material_blue,marker=dict(color=dark_blue)))\n    return data","88331178":"target_box_data = box_plot(df_train,['SalePrice'])\niplot(target_box_data)","25b5651c":"def violin_plot(dataframe, columns):\n    data = []\n    for column in columns:\n        data.append(go.Violin(y=dataframe[column], box_visible=True, line_color=bg_color,\n                               meanline_visible=True, fillcolor=material_green, opacity=0.8,\n                               x0=column))\n    return data","c8c61514":"violin_fig = violin_plot(df_train, ['SalePrice'])\niplot(violin_fig, filename = 'SalePriceViolin')","df90811f":"def qqplots(df, col_name, distribution):\n    qq = stats.probplot(df, dist=distribution, sparams=(0.5))\n    x = np.array([qq[0][0][0],qq[0][0][-1]])\n    pts = go.Scatter(x=qq[0][0],\n                     y=qq[0][1], \n                     mode = 'markers',\n                     showlegend=False,\n                     name=col_name,\n                     marker = dict(\n                            size = 5,\n                            color = material_indigo,\n                        )\n                    )\n    line = go.Scatter(x=x,\n                      y=qq[1][1] + qq[1][0]*x,\n                      showlegend=False,\n                      mode='lines',\n                      name=distribution,\n                      marker = dict(\n                            size = 5,\n                            color = material_red,\n                        )\n                     )\n    \n    data = [pts, line]\n    return data","19d16f4e":"#Plot data for 4 different distributions\nnorm_data = qqplots(df_train['SalePrice'], 'SalePrice','norm')\npower_law_data = qqplots(df_train['SalePrice'], 'SalePrice','powerlaw')\npoisson_data = qqplots(df_train['SalePrice'], 'SalePrice','poisson')\nlognorm_data = qqplots(df_train['SalePrice'], 'SalePrice','lognorm')","1d678b2c":"fig = subplots.make_subplots(rows=2, cols=2, subplot_titles=('Normal Distribution', 'Power Law Distribution',\n                                                          'Poisson Distribution', 'Log Normal Distribution'))\nfig.append_trace(norm_data[0], 1, 1)\nfig.append_trace(power_law_data[0], 1, 2)\nfig.append_trace(poisson_data[0], 2, 1)\nfig.append_trace(lognorm_data[0], 2, 2)\nfig['layout'].update(height=600, width=900, title='Comparision of QQ-plots')\n\niplot(fig, filename='make-subplots-multiple-with-titles')","5b7e7ca4":"layout = dict(xaxis = dict(zeroline = False,\n                           linewidth = 1,\n                           mirror = True),\n              yaxis = dict(zeroline = False, \n                           linewidth = 1,\n                           mirror = True),\n             )\n\nfig = dict(data=lognorm_data, layout=layout)\niplot(fig, show_link=False)","4185977f":"# Creating a pipeline\ndf_pipe = df_train.copy()","1b8ab6ff":"df_pipe['SalePrice'] = np.log(df_train['SalePrice'])\nprint(\"Skewness: {}\".format(str(df_pipe['SalePrice'].skew())))\nprint(\"Kurtosis: {}\".format(str(df_pipe['SalePrice'].kurt())))","71f966c1":"fig = px.histogram(df_pipe,'SalePrice')\niplot(fig)","d0e64bc5":"fig = ff.create_distplot([df_pipe['SalePrice']],['SalePrice Log Normal'],bin_size=0.08, colors=[dark_blue], show_hist=False)\niplot(fig, filename='Distribution plot for Sale Price (Log transform)')","a79c41c0":"log_transformed_qqplot_data = qqplots(df_pipe['SalePrice'], 'SalePrice Log transform','norm')\nlayout = dict(xaxis = dict(zeroline = False,\n                       linewidth = 1,\n                       mirror = True),\n          yaxis = dict(zeroline = False, \n                       linewidth = 1,\n                       mirror = True),\n         )\nqqplot_fig = dict(data=log_transformed_qqplot_data, layout=layout)\niplot(qqplot_fig, show_link=False)","76facd09":"target_transformed_box_data = [go.Box(y=df_pipe['SalePrice'], name='SalePrice Log transform', boxmean='sd',fillcolor=material_green,marker=dict(color=dark_green))]\niplot(target_transformed_box_data)","aa7ff4e4":"target_transformed_violin_data = violin_plot(df_pipe,['SalePrice'])\niplot(target_transformed_violin_data, filename = 'SalePriceLogViolin', validate = False)","10b2b05f":"fig = subplots.make_subplots(rows=1, cols=2)\nfig.append_trace(target_box_data[0], 1, 1)\nfig.append_trace(target_transformed_box_data[0], 1, 2)\nfig['layout'].update(height=600, width=950, title='SalePrice Unchanged vs Log transformed')\niplot(fig, filename='SalePrice-unch-vs-log-box')","ddaf0d6d":"print(\"Skewness: {}\".format(str(df_pipe['SalePrice'].skew())))\nprint(\"Kurtosis: {}\".format(str(df_pipe['SalePrice'].kurt())))","b8ed63fb":"#Feature Engineering\n\ndf_pipe['TotalSF']=df_pipe['TotalBsmtSF'] + df_pipe['1stFlrSF'] + df_pipe['2ndFlrSF']\ndf_pipe['TotalSQR_Footage'] = (df_pipe['BsmtFinSF1'] + df_pipe['BsmtFinSF2'] +\n                                df_pipe['1stFlrSF'] + df_pipe['2ndFlrSF'])\n\ndf_pipe['Total_Bathrooms'] = (df_pipe['FullBath'] + (0.5 * df_pipe['HalfBath']) +\n                              df_pipe['BsmtFullBath'] + (0.5 * df_pipe['BsmtHalfBath']))\n\ndf_pipe['AgeSinceRemodel'] = 2010 - df_train['YearRemodAdd']\ndf_pipe['AgeSinceBuilt'] = 2010 - df_train['YearBuilt']","7af700b2":"corr_matrix = df_pipe.corr()\ncorr_matrix = corr_matrix.abs()\nfig = go.Figure(data=go.Heatmap(z=corr_matrix))\niplot(fig)","c5903e7d":"k = 15 #number of variables for heatmap\ncols = corr_matrix.nlargest(k, 'SalePrice')['SalePrice'].index\n\ncols_to_be_del_pipe = ['FullBath','1stFlrSF']\ncols = list(cols)\nfor i in cols_to_be_del_pipe:\n    cols.remove(i)\n\ncorrelations = list(df_pipe[cols].corr().round(2).values)\ncorrelation_matrix = [list(correlations[i]) for i in range(len(correlations))]\nfig = ff.create_annotated_heatmap(z=correlation_matrix,x=list(cols),y=list(cols))\niplot(fig, filename='annotated_heatmap')","00dcb51d":"#Categorical variables\nordinal_cols = ['BldgType','HeatingQC','Functional']\nbinary_cols = ['PavedDrive','CentralAir']\ndf_pipe[ordinal_cols] = df_pipe[ordinal_cols].astype('category')\ndf_pipe[ordinal_cols].head()","5f39c868":"def count_plot(df,col_name):\n    value_counts_series = df[col_name].value_counts()\n    categories = list(value_counts_series.index)\n    values = list(value_counts_series)\n    fig = go.Figure(data=[go.Bar(\n            x=categories, \n            y=values,\n            textposition='auto',\n        )])\n    iplot(fig)","33705b5f":"count_plot(df_pipe, 'HeatingQC')","9dc19abe":"fig = px.box(df_train, x='HeatingQC', y='SalePrice')\niplot(fig)","095fa2ac":"# Label Encoding for HeatingQC\ncategories = list(df_pipe['HeatingQC'].unique())\nencoding_dict = {col:x for col,x in zip(categories,range(5,0,-1))}\nreplace_dict_heatingqc = {'HeatingQC':encoding_dict}\ndf_pipe.replace(replace_dict_heatingqc, inplace = True)\ndf_pipe[ordinal_cols].head()","04ba45bf":"skews = []\nkurts = []\nfor col in cols:\n    skews.append(df_pipe[col].skew())\n    kurts.append(df_pipe[col].kurt())\ndict_skew_data = {'Feature':cols, 'Skew':skews, 'Kurt':kurts}\ndf_skews = pd.DataFrame(dict_skew_data, columns=['Feature','Skew','Kurt'])\ndf_skews","d513d8a7":"df_pipe['TotalSF'] = np.log(df_pipe['TotalSF'])","a9541fa4":"iplot(qqplots(df_pipe['TotalSF'],'TotalSF Log transform','norm'))","21a69f36":"fig = px.scatter_matrix(df_pipe, dimensions=['TotalSF','GrLivArea','TotalSQR_Footage','SalePrice'],color='OverallQual')\niplot(fig)","64f50b2b":"fig = px.scatter_matrix(df_pipe, dimensions=['Total_Bathrooms','GarageArea','GarageCars','SalePrice'],color='OverallQual')\niplot(fig)","9c97011c":"fig = px.scatter_matrix(df_pipe, dimensions=['AgeSinceBuilt','AgeSinceRemodel','TotRmsAbvGrd','TotalBsmtSF','SalePrice'],color='OverallQual')\niplot(fig)","de50bcd9":"def draw_scatter_plot(col_name_x, col_name_y):\n    trace = go.Scatter(\n        x = df_pipe[col_name_x],\n        y = df_pipe[col_name_y],\n        mode = 'markers'\n    )\n    data = [trace]\n    iplot(data, filename='basic-scatter')","ff23372d":"y_tr = df_pipe['SalePrice']\nx_tr = df_pipe[cols]\nlasso = linear_model.Lasso()\nparameters = {'alpha': [1]}\nlasso_regressor = GridSearchCV(lasso, parameters, scoring=make_scorer(metrics.mean_squared_error), cv=10)\nlasso_regressor.fit(x_tr, y_tr)\ny_pred_lasso = lasso_regressor.predict(x_tr)","7a8ee436":"mse = metrics.mean_squared_error(y_tr, y_pred_lasso, sample_weight=None)\nrmse = np.sqrt(mse)\nprint(rmse)","52f4ab1d":"### Observations: -\n1) SalePrice is fairly positively skewed, i.e., it is more inclined towards left in the distplot and violin plot.\n\n2) The values above 340k are treated as outliers.\n\n### Inferences: - \n- SalePrice needs to be transformed to a known distribution (preferrably the one which brings the value of skewnwss to zero)","f0e5c84c":"### Inferences\n- MasVnrArea has very less number of missing values. Hence, it can be imputed with mean, median or mode.\n- To keep things even, let's replace with median since 0 is the most repeated value.","c0d22617":"## 1) Data Cleaning\n- Visualizing data using Plotly.\n- Dealing with missing values.","04751aa3":"## 4) LASSO (Linear regression)\n- The model which can deal with collinearity due to L1 regualizer (Since it takes the absolute value, it can penalize unnecessary variables and make them equal to zero).\n- One of the most basic models.","e62b01a9":"### Observations: -\n3) The Straight line is seen in QQ-plot of SalePrice vs Log-Normal i.e., assuming that the points at the end are outliers.\n\nLet's draw a concrete straight line just to be sure.","df90d483":"### References:\n\n**1) Plotly**\n- https:\/\/plot.ly\/python\/\n- https:\/\/www.kaggle.com\/thebrownviking20\/intermediate-visualization-tutorial-using-plotly\n- https:\/\/www.kaggle.com\/artemseleznev\/plotly-tutorial-for-beginners\n- https:\/\/stackoverflow.com\/questions\/51170553\/qq-plot-using-plotly-in-python\n\n**2) Kernels**\n- https:\/\/www.kaggle.com\/pmarcelino\/comprehensive-data-exploration-with-python\n- https:\/\/www.kaggle.com\/hamzaben\/eda-feature-eng-and-model-blending-top-20\n- https:\/\/www.kaggle.com\/erikbruin\/house-prices-lasso-xgboost-and-a-detailed-eda\n- https:\/\/www.kaggle.com\/masumrumi\/a-stats-analysis-and-ml-workflow-of-house-pricing\n- https:\/\/www.kaggle.com\/mjbahmani\/the-data-scientist-s-toolbox-tutorial-1","86cecd7a":"## 3) EDA and Feature Engineering\n- Combination of certain features.\n- Creating age based on year given.\n- Visualization of numerical features.","1de2052a":"### **Observations: -**\n\n1) PoolQC is a variable which represents Pool Quality. There are not many houses with pools. Hence, most of the values in the PoolArea column (Pool area in sq. ft.) are equal to zero.\n\n2) MiscFeature is used to represent Miscellaneous features. There are not many miscellaneous features.\n\n3) Alley is used to represent the type of alley access to the property. There is alley acces to very less number of properties.\n\n4) Fence is used to represent Fence Quality. Most of the houses do not have a fence.\n\n5) FireplaceQu is used to represent the Quality of the fireplace. Nearly half of the houses in the dataset do not have a fireplace. Hence, some values in the Fireplaces column (No. of fireplaces) are equal to zero.\n\n6) LotFrontage is a column used to denote the linear feet of street connected to the property. Since it contains more than 200 missing values, it is better to remove the column than replacing the missing values with the measures of central tendancy.\n\n### Inferences\n- The columns PoolQC, MiscFeature, Alley, Fence and FireplaceQu contain null values not because of errors during data entry, but because of them actually being null.\n\n- The numerical columns PoolArea and Fireplace contain zero values at the null values of PoolQC and FireplaceQu respectively, since it makes sense that the qualitative variables contain null values if the PoolArea is zero\n\n- The same can be said about Fireplaces and FireplaceQu.","0eb9205a":"## 2) Univariate Analysis of SalePrice\n- The ultimtate goal of our analysis is to predict the value of SalePrice with the help of our features.\n- Data transformation for skewed variables needs to be done.\n- Let's explore the target variable first.","b683a0bf":"### Observations:\n**a) Dataset contains null values in some rows.**\n\n**b) The categorical variables are in object type. Hence, they should be transformed to 'category' type in Pandas.**","e0a21fea":"### Inferences:\n- There are no abnormal values for Garage variables, i.e., there aren't cases where GarageCars > 0 and GarageArea = 0\n- The converse holds true as well, i.e., there aren't cases where GarageArea > 0 and GarageCars = 0\n- This means that whoever owns a house with a garage is maintaining atleast one car. Let's keep this in mind.","018d4e02":"## Conclusions:\n1) So far, we have explored the numerical variables to a certain extent. However, most of the categorical variables remain to be explored.\n\n2) The feature selection of the numerical variables was based on correlations and scatterplot matrices. This should suffice for a basic approach.\n\n3) The Kernel will be continued . If you are readng this, thank you for checking out this kernel. It must've been tough, since I've included a lot of visualizations and I could not document some of my decisions.\n\n4) Please leave a message in the discussions if there's more to be included.\n\n### Thank you!","ea74222c":"#### Transformation Success!\n- Skewness is down significantly,\n- SalePrice is now closer to a normal distribution.","74f8e662":"### **Observations:-**\n7) Although GarageCond, GarageQual are numerical in nature, they are actually categorical.\n\n8) GarageYrBlt, GarageFinish, GarageType are categorical variables which contain null values. These null values cannot be imputed since the null in this context means that there is no garage.\n\n9) There is no record where the GarageCars is zero for non null values of GarageType. This means that every house containing a garage also has a car associated with it.\n\n10) The features BsmtQual, BsmtCond, BsmtCond, BsmtExposure, BsmtFinType1, BsmtFinType2 also follow the same trend.\n\n### Inferences\n- The garage variables i.e., the GarageCond, GarageQual, GarageYrBlt, GarageFinish, GarageType can be removed.\n- The variables GarageArea, GarageCars however can be useful, since there are only 81 zero values.\n- In the same way, BsmtArea is useful to represent the missing values from the corresponding Bsmt variables.\n\n**Note : All of these inferences are made keeping simplicity in mind. Instead of just removing them, one could argue that a careful study of the data can be done to fill in the missing values accordingly. The assumption here is that most of the categorical variables do not affect the target variable heavily since they contain a lot of missing values and they are already being represented in this dataset by their respective categorical values.**"}}