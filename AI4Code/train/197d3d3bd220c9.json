{"cell_type":{"0e1b2946":"code","f9857365":"code","d0b24f0b":"code","4c4a32f3":"code","bab96c04":"code","827b8d6d":"code","d7838e5d":"code","ed513298":"code","c95c9af6":"code","71410dcb":"code","65bf8b8b":"code","5d2aa846":"code","1553a673":"code","885864e0":"code","80ca3035":"code","76d658e5":"code","850ab417":"code","0427f02b":"code","c065e3c2":"code","40ff9e6f":"code","3fba0494":"code","e5edbd16":"code","55330fb9":"code","c2296b52":"code","be902824":"code","0f640ee3":"code","d576181b":"code","78cc9793":"code","5d27c225":"code","9d7a28cb":"markdown","ab6ef17b":"markdown","33b43242":"markdown","723963ae":"markdown","f86776a5":"markdown","4ec9d719":"markdown","279128fa":"markdown","c1a4a39f":"markdown","5d4c7634":"markdown","2979ee19":"markdown","e14529f2":"markdown","7b82e7e4":"markdown","f77122be":"markdown","64648c12":"markdown","ddf89aca":"markdown","cce40669":"markdown","fa1bb7a2":"markdown","9de7f66b":"markdown","907a0831":"markdown","35abec7e":"markdown","462bed82":"markdown","22fb708b":"markdown","2196ae62":"markdown","ccca8c79":"markdown"},"source":{"0e1b2946":"import numpy as np\nimport pandas as pd\nimport os\nimport matplotlib.pyplot as plt","f9857365":"from sklearn.impute import KNNImputer\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.preprocessing import MinMaxScaler","d0b24f0b":"path = '\/kaggle\/input\/pima-indians-diabetes-database\/'\nos.listdir(path)","4c4a32f3":"def plot_histograms():\n    \"\"\" Plot histograms of all features\"\"\"\n    \n    fig, axs = plt.subplots(4, 2, figsize=(22, 18))\n    fig.subplots_adjust(hspace = 0.5, wspace=0.2)\n    axs = axs.ravel()\n    for i in range(8):\n        axs[i].hist(data[data['Outcome']==0][data.columns[i]],\n                    10, alpha=0.5, label='non-diabetes')\n        axs[i].hist(data[data['Outcome']==1][data.columns[i]],\n                    10, alpha=0.5, label='diabetes')\n        axs[i].set_title(data.columns[i])\n        axs[i].legend(loc='upper right')\n        axs[i].set_ylabel('Frequency')\n        axs[i].grid()","bab96c04":"def plot_bar(data, feature, text='', rotation=False):\n    \"\"\" Bar plot of a feature \"\"\"\n    \n    fig = plt.figure(figsize=(10, 5))\n    x = data.index\n    y = data[feature]\n    plt.bar(x, y)\n    plt.title(text, loc='left')\n    plt.xlabel('Category')\n    if rotation:\n        plt.xticks(rotation='vertical')\n    plt.grid()\n    plt.show()","827b8d6d":"data = pd.read_csv(path+'diabetes.csv')","d7838e5d":"data.head()","ed513298":"print('number of samples:', len(data.index))\nprint('number of features (target included):', len(data.columns))","c95c9af6":"data['Outcome'].value_counts(normalize=True)","71410dcb":"plot_histograms()","65bf8b8b":"corr = data.corr()\ncorr.style.background_gradient(cmap='coolwarm', axis=None).set_precision(2)","5d2aa846":"data.isnull().sum()","1553a673":"data.describe()","885864e0":"features_with_missing_values = ['Glucose', 'BloodPressure', 'SkinThickness', 'Insulin', 'BMI']","80ca3035":"def label_missing_values(s):\n    \"\"\" Label missing values (=0) with None \"\"\"\n    if s == 0:\n        return None\n    else:\n        return s","76d658e5":"for feature in features_with_missing_values:\n    data[feature] = data[feature].apply(label_missing_values)","850ab417":"data.isnull().sum()","0427f02b":"data_dropped = data.dropna()","c065e3c2":"compare = pd.DataFrame()\ncompare['origin'] = data.mean()\ncompare['dropped'] = data_dropped.mean()\ncompare['delta'] = (compare['dropped']-compare['origin'])\/compare['origin']","40ff9e6f":"compare","3fba0494":"plot_bar(compare, 'delta', 'Relative difference', rotation=True)","e5edbd16":"def calculate(X, y):\n    \"\"\" Calulate the best score of grid search \"\"\"\n    \n    knn = KNeighborsClassifier()\n    knn_params = {'n_neighbors': [1, 2, 3, 4, 5, 6, 7]}\n    grid = GridSearchCV(knn, knn_params)\n    grid.fit(X, y)\n    print(grid.best_score_, grid.best_params_)","55330fb9":"X_origin = data[data.columns[:-1]].fillna(0)\ny_origin = data['Outcome']\ncalculate(X_origin, y_origin)","c2296b52":"X_dropped = data_dropped[data_dropped.columns[:-1]]\ny_dropped = data_dropped['Outcome']\ncalculate(X_dropped, y_dropped)","be902824":"X_mean = data[data.columns[:-1]].fillna(X_dropped.mean(axis=0))\ny_mean = data['Outcome']\ncalculate(X_mean, y_mean)","0f640ee3":"imputer = KNNImputer(n_neighbors=2)\nX_imputed = imputer.fit_transform(data[data.columns[:-1]])\ny_imputed = data['Outcome']\ncalculate(X_imputed, y_imputed)","d576181b":"min_max = MinMaxScaler()\nX_scaled = min_max.fit_transform(X_imputed)\ny_scaled = y_imputed\ncalculate(X_scaled, y_scaled)","78cc9793":"imputer = KNNImputer(n_neighbors=1)\nX_imputed = imputer.fit_transform(data[data.columns[:-1]])\ny_imputed = data['Outcome']\ncalculate(X_imputed, y_imputed)","5d27c225":"min_max = MinMaxScaler()\nX_scaled = min_max.fit_transform(X_imputed)\ny_scaled = y_imputed\ncalculate(X_scaled, y_scaled)","9d7a28cb":"Finally we scale the imputed data and calculate best score of gird search:","ab6ef17b":"# Functions\nWe define some simple helper functions for the analysis and visualisation.","33b43242":"## Missing\/Implausible Values\n### Analysis\nFortunately there are no missing values to handel ...","723963ae":"We fill missing data by the mean of every column and calculate the best score of gird search:","f86776a5":"... but a look on the dataframe describetion shows some implausible values:","4ec9d719":"First of all we want do describe the features of the dataset. There are 8 features and 1 target. The target is the Outcome.\n\n|Feature|Description| Measurement|\n|---|---|---|\n|Pregnancies|Number of times pregnant|Number|\n|Glucose|[Plasma glucose concentration](https:\/\/www.ncbi.nlm.nih.gov\/books\/NBK541081\/#:~:text=Normal%20plasma%20glucose%20levels%20are,individuals%20can%20vary%20with%20age.) a 2 hours in an oral glucose tolerance test|mg\/dL|\n|BloodPressure|Diastolic blood pressure|mm Hg|\n|SkinThickness|Triceps skinfold thickness|mm|\n|Insulin|2-Hour serum insulin|mu U\/ml|\n|BMI|Body mass index|weight in kg\/(height in m)\u00b2|\n|DiabetesPedigreeFunction|Diabetes pedigree function||\n|Age|Age|Number|\n\nThe target is 1 if the patient developed diabets and 0 otherwise.","279128fa":"# Summary\nThere are several way handling missing values. We want to put all results togehter in a table:\n\n|Describtion|Rows|Cross-valiated accuracy|\n|:---|---|---|\n|origin (missing values filled with 0)|768|0.7357|\n|dropped missing values|392|0.7348|\n|Impute values with mean of columns|768|0.7305|\n|Impute with knn (n_neighbors=2)|768|0.7448|\n|Impute with knn (n_neighbors=2) and scaled|768|0.7513|\n|Impute with knn (n_neighbors=1)|768|0.7136|\n|Impute with knn (n_neighbors=1) and scaled|768|0.7617|","c1a4a39f":"# Intro\nWelcome to the popular [Pima Indians Diabetes Database](https:\/\/www.kaggle.com\/uciml\/pima-indians-diabetes-database).\n\n![](https:\/\/storage.googleapis.com\/kaggle-datasets-images\/228\/482\/a520351269b547c89afe790820a1087e\/dataset-cover.jpeg)\n\nThe following EDA based on this [book](https:\/\/www.packtpub.com\/product\/feature-engineering-made-easy\/9781787287600).\n\nWe focus on working with missing values in this dataset.\n\n<span style=\"color: royalblue;\">Please vote the notebook up if it helps you. Thank you. <\/span>","5d4c7634":"Distribution of the target:","2979ee19":"Finally there are some missing values. Of course they have influence of the histograms and the correaltion matrix shown before and the model for prediction we will define later. There are several options to deal with missing values. We could drop all rows with missing data. So there are 374 samples with missing values for the feature insulin. If we drop all of them we will loss about 49% of all samples. ","e14529f2":"We compare the mean values of all features and both dataframes.","7b82e7e4":"# Path","f77122be":"First we calculate the best score of the grid search for the origin data set (the missing data were filled with 0):","64648c12":"# Libraries","ddf89aca":"## Correlation Matrix\nWith the correlation matrix we visualize a linear relationsship between the features. We can see a significant correlation between the target label and the feature glucose. So this feature seems to be important.","cce40669":"### Imputing Missing Values","fa1bb7a2":"### Drop Rows With Missing Values\nWe define a new dataframe by dropping the missing values of the origin dataframe. Then we analyse the impact.","9de7f66b":"# Laod Data","907a0831":"# EDA\n## Histograms\nWe plot the histograms of all features and visualize the difference between diabetes and non-diabetes. As we can see there are some obvious differenc in the values.","35abec7e":"We calculate the best score of grid search for the dropped data:","462bed82":"The body mass index of a person could not be 0. Also the features glucose, blood pressure and insulin could not be equal to zero. So it seems that missing values were filled by 0. This is of course a way to handle missing values. But it is also possible to find a better solution.","22fb708b":"# Overview","2196ae62":"The absolut difference is apparently not significant. But the relative difference is it.","ccca8c79":"We fill missing data by the KNN imputer and calculate the best score of grid search:"}}