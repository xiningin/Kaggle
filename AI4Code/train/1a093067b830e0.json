{"cell_type":{"bb039f6d":"code","dcff86c7":"code","f2cf7d4d":"code","b26a8b3e":"code","39a88f59":"code","aeca4cad":"code","962ebc46":"code","4d37498f":"code","f32c0cdb":"code","0387a958":"code","831ae50f":"code","0672ddad":"code","81ed9fec":"code","69db2945":"code","3825fc7b":"code","5f6bccf3":"code","da61e0b0":"code","b6778184":"code","d43ce1f1":"code","7ca7b07b":"code","9b485108":"code","c441b016":"code","50bc054d":"code","c813909d":"code","6236d748":"code","49b4a6bc":"code","7c219196":"code","b7eea074":"code","13a7e6a1":"code","41ae5aad":"code","d98012b9":"code","bf32b685":"code","ce5f49eb":"code","99b35cab":"code","49106add":"code","994668eb":"markdown","f32c700a":"markdown","5d6a9df5":"markdown","c4ba346c":"markdown","f816428f":"markdown","3f0d2adf":"markdown","a1c3eae0":"markdown","7d4fa73a":"markdown","93d42c2d":"markdown","0bc3db17":"markdown","059479a3":"markdown","058b8aee":"markdown","61cdea83":"markdown","6b4b05c6":"markdown","03305329":"markdown","f0a3edf2":"markdown","637b6fe5":"markdown","15b09436":"markdown","a1d302b5":"markdown","05fe3edb":"markdown","fc246051":"markdown","68a22f04":"markdown","e81c8801":"markdown","2819a7b9":"markdown","27eb7ab2":"markdown","41182d4b":"markdown","f6be098c":"markdown","8228d5c8":"markdown","32fb897e":"markdown","2abdbe84":"markdown","d6d9efee":"markdown"},"source":{"bb039f6d":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport missingno as ms\nfrom sklearn.linear_model import LinearRegression","dcff86c7":"df= pd.read_csv('..\/input\/insurance\/insurance.csv')","f2cf7d4d":"df.head()","b26a8b3e":"df.isnull().sum()","39a88f59":"df['sex'].replace('female',0,inplace = True)\ndf['sex'].replace('male',1,inplace = True)","aeca4cad":"df['smoker'].replace('yes',1,inplace = True)\ndf['smoker'].replace('no',0,inplace = True)","962ebc46":"df.head()","4d37498f":"df.dtypes","f32c0cdb":"df.describe()","0387a958":"df.corr()['charges'].sort_values()","831ae50f":"df.groupby(\"smoker\").mean()","0672ddad":"f= plt.figure(figsize=(12,5))\nax=f.add_subplot(121)\nsns.distplot(df[(df.smoker == 1)]['age'],color='b',ax=ax)","81ed9fec":"sns.catplot(x=\"smoker\", kind=\"count\",hue = 'sex', palette=\"Paired\", data=df)","69db2945":"sns.distplot(df[(df.smoker == 0)][\"charges\"],color='g').set(title = 'Insurance cost comparation between smoking or not')\nsns.distplot(df[(df.smoker == 1)][\"charges\"],color='b').set(title = 'Insurance cost comparation between smoking or not')","3825fc7b":"df_gptest = df[['sex','smoker','charges','age']]\ngrouped_test1 = df_gptest.groupby(['sex','smoker'],as_index=False).mean()\ngrouped_test1","5f6bccf3":"sns.lmplot(x=\"age\", y=\"charges\", hue=\"smoker\", data=df, palette = 'Paired', height = 7)\nax.set_title('Smokers and non-smokers')","da61e0b0":"width = 12\nheight = 10\nplt.figure(figsize=(width, height))\nsns.regplot(x=\"age\", y=\"charges\", data=df)\nplt.ylim(0,)","b6778184":"from sklearn.model_selection import train_test_split\ny_data = df['charges']\nx_data = df.drop('charges',axis=1) #All the data except the one we want to predict it.\n\nx_train, x_test, y_train, y_test = train_test_split(x_data, y_data, test_size=0.10, random_state=1)\n\n\nprint(\"number of test samples :\", x_test.shape[0])\nprint(\"number of training samples:\",x_train.shape[0])\n\n","d43ce1f1":"ln = LinearRegression()","7ca7b07b":"ln.fit(x_train[['age', 'sex', 'bmi','children','smoker']], y_train)","9b485108":"yhat_train = ln.predict(x_train[['age', 'sex', 'bmi','children','smoker']])","c441b016":"yhat_test = ln.predict(x_test[['age', 'sex', 'bmi','children','smoker']])","50bc054d":"def DistributionPlot(RedFunction, BlueFunction, RedName, BlueName, Title):\n    width = 12\n    height = 10\n    plt.figure(figsize=(width, height))\n\n    ax1 = sns.distplot(RedFunction, hist=False, color=\"r\", label=RedName)\n    ax2 = sns.distplot(BlueFunction, hist=False, color=\"b\", label=BlueName, ax=ax1)\n\n    plt.title(Title)\n    plt.xlabel('Charge (in dollars)')\n    plt.ylabel('Provided Features')\n\n    plt.show()\n    plt.close()","c813909d":"Title = 'Distribution  Plot of  Predicted Value Using Training Data vs Training Data Distribution'\nDistributionPlot(y_train, yhat_train, \"Actual Values (Train)\", \"Predicted Values (Train)\", Title)\n","6236d748":"ln.score(x_train[['age', 'sex', 'bmi','children','smoker']], y_train)","49b4a6bc":"Title='Distribution  Plot of  Predicted Value Using Test Data vs Data Distribution of Test Data'\nDistributionPlot(y_test,yhat_test,\"Actual Values (Test)\",\"Predicted Values (Test)\",Title)","7c219196":"ln.score(x_test[['age', 'sex', 'bmi','children','smoker']], y_test) #Not the best score...","b7eea074":"from sklearn.preprocessing import PolynomialFeatures","13a7e6a1":"Rsqu_test = []\n\norder = [1, 2, 3, 4]\nfor n in order:\n    pr = PolynomialFeatures(degree=n)\n    \n    x_train_pr = pr.fit_transform(x_train[['age', 'sex', 'bmi','children','smoker']])\n    \n    x_test_pr = pr.fit_transform(x_test[['age', 'sex', 'bmi','children','smoker']])    \n    \n    ln.fit(x_train_pr, y_train)\n    \n    Rsqu_test.append(ln.score(x_test_pr, y_test))\n\nplt.plot(order, Rsqu_test)\nplt.xlabel('order')\nplt.ylabel('R^2')\nplt.title('R^2 Using Test Data')\nplt.text(3, 0.75, 'Maximum R^2 ')    ","41ae5aad":"pr = PolynomialFeatures(degree=3)\nx_train_pr = pr.fit_transform(x_train[['age', 'sex', 'bmi','children','smoker']])\nx_test_pr = pr.fit_transform(x_test[['age', 'sex', 'bmi','children','smoker']])\n","d98012b9":"poly = LinearRegression()\npoly.fit(x_train_pr, y_train)\nyhat_train = poly.predict(x_train_pr)\nyhat_test = poly.predict(x_test_pr)","bf32b685":"Title = 'Distribution  Plot of  Predicted Value Using Training Data vs Training Data Distribution'\nDistributionPlot(y_train, yhat_train, \"Actual Values (Train)\", \"Predicted Values (Train)\", Title)","ce5f49eb":"poly.score(x_train_pr, y_train)","99b35cab":"Title='Distribution  Plot of  Predicted Value Using Test Data vs Data Distribution of Test Data'\nDistributionPlot(y_test,yhat_test,\"Actual Values (Test)\",\"Predicted Values (Test)\",Title)","49106add":"poly.score(x_test_pr, y_test)","994668eb":"## 1. Imports and datasets","f32c700a":"<p>From the previous section  we know that other good predictors of charges could be:<\/p>\n<ul>\n    <li>Smoker<\/li>\n    <li>Age<\/li>\n    <li>Sex<\/li>\n    <li>BMI<\/li>\n<\/ul>\nLet's develop a model using these variables as the predictor variables.\n\n\n\nFirst, were going to create a Linear Regression object, using SciPy libraries, split the dataset and fit it.","5d6a9df5":"In this particular dataset, we want to predict a continous value, so we're in front of a **Linear Regression** problem.","c4ba346c":"On the test, same problem, little values okay, but does not work with large values.","f816428f":"Now, using the libraries that we import, we will visualize the data and take some information before making the formal prediction model.","3f0d2adf":"Let's perform some model evaluation using our training and testing data separately. First  we import the seaborn and matplotlibb library for plotting. I've take from the internet the distribution plot.","a1c3eae0":"Now we clarely see the importance of the age, hopessly, the older you get, the charge will be bigger.","7d4fa73a":"## 3. Exploratory Data Analysis","93d42c2d":"### 4.1 First try using normal linear regression (No polynomial)","0bc3db17":"The data type makes sense too, so the data wranlging stage is ended.","059479a3":"Let's check the distribution of the age and sex of the people who smokes.","058b8aee":"Hopefully, there are not any NaN values, so we are going to transform some categorical values like sex and smoker to numerical values.\n\n**In the case of sex:**\n\n 0 = Female\n \n 1 = Male\n \n \n**In the case of smoker:**\n\n\n 0 = No smoker\n \n \n 1 = Smoker","61cdea83":"As wee see, there's a positive relationship between the age and charges.","6b4b05c6":"### 4.2 Time to try using polynomial regression","03305329":"## 4. Model Development","f0a3edf2":"<p>When it comes to simple linear regression, an excellent way to visualize the fit of our model is by using <b>regression plots<\/b>.<\/p>\n\n<p>This plot will show a combination of a scattered data points (a <b>scatter plot<\/b>), as well as the fitted <b>linear regression<\/b> line going through the data. This will give us a reasonable estimate of the relationship between the two variables, the strength of the correlation, as well as the direction (positive or negative correlation).<\/p>","637b6fe5":"As we see, the model works great for little charge values, but has some problem when fitting bigger amounts.","15b09436":"Now, the data is in the correct format.","a1d302b5":"### After analyzing the data we have come to some simple conclusions, now it's time to develop a proper prediction algorithm.","05fe3edb":"Describing the dataset we can get some usefull information.\n\n    1. Only the 20.4% of the people smokes\n    2. The number of male\/female is practically the same\nBefore a first look, we're going to see the correlation between the features, and see which are the most relevant.","fc246051":"On the training set, the prediction doest not look good... but on the test set...","68a22f04":"It's a little complicated to explain, but I'll try my best. Depending on the grade of the polynom, we can get higher R-score, which is the model \"accuracy\" score, so on, we try different grades, if we use a too high degree,  we will overfit, so i check the best R^2 score on the test set.","e81c8801":"## 2. Data Wrangling","2819a7b9":"As we see it before, the insurance cost of the smokers is much bigger.\n\nAt the moment we have see the most relevant data, now were going to take all together.","27eb7ab2":"We have improved much our model!!!1","41182d4b":"## So, that's all my friends! Hope you like my FIRST KAGGLE submission, in some time i will add more explanation about the code ","f6be098c":"Well, another prove that it's more common for young people to smoke. ","8228d5c8":"First of all, we will observe the data and see if there are missing values","32fb897e":"Wow, as we see, the most important feature when we talk about the charge is to be smoker or not, followed by (logically) the age. So, there are two more conclusions:\n\n    1. If you smoke, you will have to pay more.\n    2. An older you get, the more you have to pay.","2abdbe84":"As said before, It is more common for women to smoke more than men.","d6d9efee":"WOW, Stuning, the people who smoke on average pay 3.5 TIMES MORE of health insurance. By the other hand, we dont see any relevant differences between the people who smokes and not\n"}}