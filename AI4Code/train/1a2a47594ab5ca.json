{"cell_type":{"4c8f5aa1":"code","e09fc8ef":"code","d23be7f7":"code","5eba99af":"code","dd10b45a":"code","6cecc899":"code","93b832c2":"code","f8944a69":"code","a0fb0dc2":"code","9deb1d71":"code","0d60f9d2":"code","86a2fb8b":"code","2aab81b0":"code","0d280250":"code","817c8287":"code","b77dcaa5":"markdown","2097a595":"markdown"},"source":{"4c8f5aa1":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)","e09fc8ef":"# Installing the fastai v2\n!pip install -Uqq fastbook\nimport fastbook\nfastbook.setup_book()","d23be7f7":"from fastbook import *\nfrom fastai.vision.widgets import *","5eba99af":"flower_types = \"daisy\", \"dendelion\", \"rose\", \"sunflower\", \"tulip\"\npath = Path(\"\/kaggle\/input\/flowers-recognition\/flowers\/\")","dd10b45a":"fns = get_image_files(path)\nfns","6cecc899":"# Creating the DataBlock to quickly build Datasets and DataLoaders\n\nflower = DataBlock(\n        blocks = (ImageBlock, CategoryBlock),      # Specify the dependent and independent variables\n        get_items = get_image_files,             # Takes a path and returns a list of all images\n        splitter = RandomSplitter(valid_pct=0.2, seed = 42),# Random Splitting. If you already have a valid set use GrandParentSplitter\n        get_y = parent_label,      # Function provided by Fastai that gets the name of the folder the file is in\n        item_tfms = Resize(128))   # Resize all the images to 128 by 128","93b832c2":"# Now lets create the DataLoader\n\ndls = flower.dataloaders(path)","f8944a69":"dls.valid.show_batch(max_n = 5, nrows = 1)","a0fb0dc2":"flower = flower.new(\n            item_tfms = RandomResizedCrop(224, min_scale = 0.5),    # Image size = 224, min_scale: how much images to be selected at minimum\n            batch_tfms = aug_transforms())    # Perform image augmentation on the entire batch on GPU\n\n# Create new Dataloaders\ndls = flower.dataloaders(path)","9deb1d71":"# Lets create a Learner and finetune it\n\nlearn = cnn_learner(dls, resnet18, metrics = accuracy)\nlearn.fine_tune(4)","0d60f9d2":"# Plot Confusion Matrix\n\ninterp = ClassificationInterpretation.from_learner(learn)\ninterp.plot_confusion_matrix()","86a2fb8b":"interp.plot_top_losses(5, nrows = 1)","2aab81b0":"# Manually remove any misclassified images from training to avoid model confusion\n'''\ncleaner = ImageClassifierCleaner(learn)\ncleaner\n\n'''\n","0d280250":"# To delete the incorrect images\n\n'''\nfor idx in cleaner.delete():\n    cleaner.fns[idx].unlink()         # unlink works as the same way as delete\n\n'''\n","817c8287":"# It's a good idea to always save the model for future use\n\noutput_path = Path(\"\/kaggle\/working\")\nlearn.export(output_path\/\"model\")\n","b77dcaa5":"The code is based on FastAi v2 which is a part of Jeremy Howard's 2020 FastAi course.\n\nIn this notebook, we are trying to classify different species of flowers into:\n- daisy\n- dandelion\n- rose\n- sunflower\n- tulip","2097a595":"Difference between squish, pad with zero and random crop of the image in Image Transformation.\n- If we squish or stretch, we may end up getting unrealistic shape \n- If we crop, we remove key part of the image which can help in recognition\n- If we pad with zero, we have lot of empty space which is wasted computation.\n\n**FastAI recommendations**\nRandomly select part of an image and crop to that part. On each epoch randomly select part of a different image.<br>\nThis is done by RandomResizedCrop\n"}}