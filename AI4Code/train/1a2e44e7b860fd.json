{"cell_type":{"2ed72c45":"code","4cd949bc":"code","bf83d7e2":"code","ea5b66d4":"code","53fbe9dc":"code","7e89dacc":"code","c02afffa":"code","a21d91cf":"code","1e552b3f":"code","aa46ab35":"code","8870bbe6":"code","b65926c1":"code","3c99b1bf":"code","e932eb99":"code","54f7dd05":"code","2276082e":"markdown","40b4cb31":"markdown","cf3c76bc":"markdown","56d48e7b":"markdown","2f30d6e1":"markdown"},"source":{"2ed72c45":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","4cd949bc":"train_df=pd.read_csv('\/kaggle\/input\/twitter-sentiment-analysis-hatred-speech\/train.csv')\ntest_df=pd.read_csv('\/kaggle\/input\/twitter-sentiment-analysis-hatred-speech\/test.csv')","bf83d7e2":"train_df.describe()","ea5b66d4":"train_df.head(15)","53fbe9dc":"import spacy","7e89dacc":"pd.crosstab(index=train_df['label'],columns='count')","c02afffa":"import seaborn as sns\nsns.countplot(x='label',data=train_df)","a21d91cf":"nlp=spacy.blank('en')\nclassifier = nlp.create_pipe('textcat',config={'exclusive_classes':True,'architecture' : 'bow'})\nnlp.add_pipe(classifier)\nclassifier.add_label('RACIST\/SEXIST')\nclassifier.add_label('NON_RACIST\/SEXIST')","1e552b3f":"train_data=train_df['tweet'].values\ntrain_label=[{'cats':{'RACIST\/SEXIST':label==1,\n                    'NON_RACIST\/SEXIST':label==0}} for label in train_df['label']]\ntrain_list=list(zip(train_data,train_label))","aa46ab35":"from spacy.util import minibatch\nimport random\nrandom.seed(1)\nspacy.util.fix_random_seed(1)\noptimizer=nlp.begin_training()\nlosses={}\n","8870bbe6":"for epoch in range(10):\n    random.shuffle(train_list)\n    batches=minibatch(train_list,size=24)\n    for batch in batches:\n        text,labels=zip(*batch)\n        nlp.update(text,labels,sgd=optimizer,losses=losses)\n        print(losses,batch,epoch)","b65926c1":"test_df.head(10)\ntest_df['tweet']","3c99b1bf":"test=[nlp.tokenizer(text) for text in test_df['tweet']]\n","e932eb99":"classifier=nlp.get_pipe('textcat')\nscores,_=classifier.predict(test)\nprint(scores)","54f7dd05":"predict_label=scores.argmax(axis=1)\ncount=0\nfor pred in predict_label:\n  print(test_df['tweet'][count],'racist\/sexist'if pred==0 else \"non_racist\/sexist\")\n  count+=1","2276082e":"Training the model in small batches for 10 epochs using spacy nlp optimizer","40b4cb31":" Creating an empty model with Spacy and using TextCategorizer within the model","cf3c76bc":"Once the model is trained, it is used to predict resuts on the test dataset","56d48e7b":"Converting tweet text data to the input form for the TextCategorizer and setting seperate labels for the two different classes","2f30d6e1":"The prediction gives result in probability with the class having the higher probability has the predominant sentiment"}}