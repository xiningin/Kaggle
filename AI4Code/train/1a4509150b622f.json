{"cell_type":{"e0a5904a":"code","46c8ed40":"code","ad1a3adb":"code","5ed407e3":"code","f0a8eed2":"code","20ffc6ec":"code","80cf7484":"code","220a71fa":"code","2ec6e3b5":"code","601912a5":"code","0e8a472e":"code","4894b429":"code","a8476764":"code","f2ad28e3":"code","508b48b4":"code","86fee32b":"code","bdc51cc1":"code","c5d40201":"code","48f2bc9c":"code","1662a8ca":"code","15357641":"code","649dde76":"code","355c7722":"code","45f111ca":"code","4fe5c218":"code","7969f51a":"code","3f6b74b2":"code","bef9d015":"code","159b0381":"code","021905da":"code","48b4c4cc":"code","d0447818":"code","0dcb89e6":"code","069707ff":"code","4a39c7a8":"code","afbc5402":"code","c95a2efb":"code","f6e9e2c4":"code","58b429f3":"code","89f7a185":"code","8a14aad2":"code","2ddf835b":"code","62736f0b":"code","86b72ad2":"code","4655feb1":"code","342caa20":"code","baa2b8a4":"code","e842d205":"code","ee9d2b0f":"code","ad01dc19":"code","cb9a2b00":"code","fd0fc526":"code","f0fb6950":"code","5287dc5b":"code","aa30f5ec":"code","f216335f":"code","69d54bb4":"code","61182f0c":"code","86d93ed1":"code","90aed643":"code","5a6f5ada":"code","e8d092e5":"code","3358c9d9":"code","6efaab5a":"code","61ad91b6":"code","a992c965":"code","5830775a":"code","de0d8bd4":"code","677ad6f2":"code","7a1f33fd":"markdown","6b084c0f":"markdown","dac4b847":"markdown","f3ffa911":"markdown","72d94e62":"markdown","f9280d95":"markdown","233403dd":"markdown","85374205":"markdown","8973fdd8":"markdown","ca62a787":"markdown","31138367":"markdown","79d7f6d1":"markdown","337cad53":"markdown","9dfc7d03":"markdown","b36a2d1f":"markdown"},"source":{"e0a5904a":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","46c8ed40":"# Let's import some necessary libraries\n\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.metrics import mean_squared_error,r2_score\nfrom sklearn.impute import SimpleImputer\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.tree import DecisionTreeRegressor         #Decision tree regression model\nfrom sklearn.model_selection import cross_val_score    #import cross validation score package\nfrom sklearn.model_selection import GridSearchCV        #import grid search cv\nfrom sklearn.ensemble import RandomForestRegressor \nfrom sklearn.svm import SVR \nimport xgboost as xgb\nfrom xgboost.sklearn import XGBRegressor\n\npd.set_option('display.max_columns',None)\npd.set_option('display.max_rows',None)\npd.set_option('display.max_colwidth',None)\n\n\nimport os\nprint(os.listdir(\"..\/input\/walmart\/\"))","ad1a3adb":"# Loading dataset\ndf_features = pd.read_csv('..\/input\/walmart\/features.csv')\ndf_train = pd.read_csv('..\/input\/walmart\/train.csv')\ndf_test = pd.read_csv('..\/input\/walmart\/test.csv')\ndf_store = pd.read_csv('..\/input\/walmart\/stores.csv')","5ed407e3":"# Looking for feature dataset\ndf_features.head()","f0a8eed2":"# Looking for store dataset\ndf_store.head()","20ffc6ec":"# Looking for test dataset\ndf_test.head()","80cf7484":"# Looking for train dataset\ndf_train.head()","220a71fa":"# checking for info\ndf_train.info()","2ec6e3b5":"# checking for descriptive statistic\ndf_train.describe()","601912a5":"# Checkin for the info of feature columns\ndf_features.info()","0e8a472e":"# checking for IsHoliday columns value\ndf_features['IsHoliday'].value_counts(dropna=True)","4894b429":"# Label Encoding \n\n# Converting date column to datetime datatype\ndf_features['Date'] = pd.to_datetime(df_features['Date'])\ndf_train['Date'] = pd.to_datetime(df_train['Date'])\ndf_test['Date'] = pd.to_datetime(df_test['Date'])\n\n# Mapping IsHoliday column with 0 and 1 \ndf_features['IsHoliday'] = LabelEncoder().fit_transform(df_features['IsHoliday'])\ndf_train['IsHoliday'] = LabelEncoder().fit_transform(df_train['IsHoliday'])\ndf_test['IsHoliday'] = LabelEncoder().fit_transform(df_test['IsHoliday'])\ndf_store['Size']  = LabelEncoder().fit_transform(df_store['Size'] )\ndf_store['Type'] = LabelEncoder().fit_transform(df_store['Type'])\n","a8476764":"df_test.head()","f2ad28e3":"# Merging df_store_train with feature dataframe\ndf_store_feture = pd.merge(df_train,df_features,how='inner',on=['Store','Date','IsHoliday'])\n\ndf_store_feture_test = pd.merge(df_test,df_features,how='inner',on=['Store','Date','IsHoliday'])\n\nprint(\"Shape of dataframe after merging Train & Feature df : \",df_store_feture.shape[0])","508b48b4":"df_final = pd.merge(df_store_feture,df_train,how='inner')\n\ndf_final_test = pd.merge(df_store_feture_test,df_test,how='inner')\n\nprint(\"Shape of dataframe after merging Store,Train & Feature df : \",df_final.shape[0])","86fee32b":"df_final_test.shape","bdc51cc1":"df_final_test.isnull().sum()","c5d40201":"ts_df = df_final.copy()","48f2bc9c":"df_final.info()","1662a8ca":"df_final.isnull().sum()","15357641":"# Let's replace 'NaN' with '0.0' value\n# df_final.fillna(0.0,inplace= True)\n\nmarkdown = pd.DataFrame(SimpleImputer().fit_transform(df_final[['MarkDown1','MarkDown2','MarkDown3','MarkDown4','MarkDown5']]),columns=['MarkDown1','MarkDown2','MarkDown3','MarkDown4','MarkDown5'])\nmarkdown_test = pd.DataFrame(SimpleImputer().fit_transform(df_final_test[['MarkDown1','MarkDown2','MarkDown3','MarkDown4','MarkDown5']]),columns=['MarkDown1','MarkDown2','MarkDown3','MarkDown4','MarkDown5'])\n\ndf = df_final.drop(['MarkDown1','MarkDown2','MarkDown3','MarkDown4','MarkDown5'],axis=1)\ndf_test_1 = df_final_test.drop(['MarkDown1','MarkDown2','MarkDown3','MarkDown4','MarkDown5'],axis=1)\n\ndf_final = pd.concat([df,markdown],axis=1)\ndf_final_test = pd.concat([df_test_1,markdown_test],axis=1)","649dde76":"df_final.shape","355c7722":"df_final_test.isnull().sum()","45f111ca":"df_final_test.CPI.fillna(df_final_test.CPI.mean(),inplace=True)\ndf_final_test.Unemployment.fillna(df_final_test.Unemployment.mean(),inplace=True)","4fe5c218":"import datetime as dt\ndf_final['Year'] = df_final['Date'].dt.year\ndf_final['Month'] = df_final['Date'].dt.month\ndf_final['Week_of_Year'] = df_final['Date'].dt.weekofyear\ndf_final.columns\n\n# For test\ndf_final_test['Year'] = df_final_test['Date'].dt.year\ndf_final_test['Month'] = df_final_test['Date'].dt.month\ndf_final_test['Week_of_Year'] = df_final_test['Date'].dt.weekofyear\n","7969f51a":"df_final_test.head()","3f6b74b2":"df_grp = df_final[['Year','Dept','Weekly_Sales']].groupby(['Year','Dept']).mean().reset_index()\ndf_grp.head()","bef9d015":"plt.figure(figsize=(18,5))\nsns.barplot(data = df_grp,x= df_grp['Year'],y=df_grp['Weekly_Sales'])\nplt.show()","159b0381":"def scatter(dataset, column):\n    plt.figure()\n    plt.scatter(dataset[column] , dataset['Weekly_Sales'])\n    plt.ylabel('Weekly_Sales')\n    plt.xlabel(column)","021905da":"df_final.columns","48b4c4cc":"scatter(df_final, 'Fuel_Price')\nscatter(df_final, 'CPI')\nscatter(df_final, 'IsHoliday')\nscatter(df_final, 'Unemployment')\nscatter(df_final, 'Temperature')\nscatter(df_final, 'Store')\nscatter(df_final, 'Dept')","d0447818":"weekly_sales = df_final['Weekly_Sales'].groupby(df_final['Dept']).mean()\nplt.figure(figsize=(25,8))\nsns.barplot(weekly_sales.index, weekly_sales.values, palette='dark')\nplt.grid()\nplt.title('Average Sales - per Dept', fontsize=18)\nplt.ylabel('Sales', fontsize=16)\nplt.xlabel('Dept', fontsize=16)\nplt.show()","0dcb89e6":"weekly_sales = df_final['Weekly_Sales'].groupby(df_final['Year']).mean()\nplt.figure(figsize=(25,8))\nsns.barplot(weekly_sales.index, weekly_sales.values, palette='dark')\nplt.grid()\nplt.title('Average Sales - per Dept', fontsize=18)\nplt.ylabel('Sales', fontsize=16)\nplt.xlabel('Year', fontsize=16)\nplt.show()","069707ff":"weekly_sales = df_final['Weekly_Sales'].groupby(df_final['Month']).mean()\nplt.figure(figsize=(25,8))\nsns.barplot(weekly_sales.index, weekly_sales.values, palette='dark')\nplt.grid()\nplt.title('Average Sales - per Dept', fontsize=18)\nplt.ylabel('Sales', fontsize=16)\nplt.xlabel('Month', fontsize=16)\nplt.show()","4a39c7a8":"plt.figure(figsize=(18,7))\nsns.heatmap(df_final.corr(),annot=True)\nplt.show()","afbc5402":"df_final.drop(columns=['Month','Date'],inplace = True)\ncolumn_date = df_final_test['Date']\ndf_final_test.drop(columns=['Month','Date'],inplace = True)","c95a2efb":"df_final_test.columns","f6e9e2c4":"X = df_final.drop('Weekly_Sales',axis=1)\ny = df_final['Weekly_Sales']","58b429f3":"X_train,X_val,y_train,y_val = train_test_split(X,y,test_size=0.3,random_state=34)","89f7a185":"print(\"X Train Shape :\",X_train.shape)\nprint(\"X Val Shape   :\",X_val.shape)\nprint(\"Y Train Shape :\",y_train.shape)\nprint(\"Y Val Shape   :\",y_val.shape)\n","8a14aad2":"X.columns","2ddf835b":"# Building a model using Linear Regression:\n\n\nlr = LinearRegression()\nlr.fit(X_train,y_train)\ny_pred = lr.predict(X_val)\nlr_rmse_score = np.sqrt(mean_squared_error(y_pred,y_val))\nlr_r2_score = r2_score(y_pred,y_val)\nprint(\"Root Mean Squared Error :\",lr_rmse_score)\nprint(\"R2Score                 :\",lr_r2_score)","62736f0b":"dt = DecisionTreeRegressor()\ndt_model=dt.fit(X_train,y_train)         \ny_pred_dtone=dt_model.predict(X_val) ","86b72ad2":"# calculate RMSE\nrms_dt = np.sqrt(mean_squared_error(y_pred_dtone,y_val))\nr2_dt = r2_score(y_val, y_pred_dtone)\nprint('RMSE of Decision Tree Regression:',rms_dt)\nprint('R-Squared value:',r2_dt)\nR2 = r2_score(y_val, y_pred)\nn = X_train.shape[0]\np = len(X_train.columns)\nAdj_r2 = 1-(1-R2)*(n-1)\/(n-p-1)\nprint('Adjusted R-Square is : ',Adj_r2)","4655feb1":"# Importing libraries\nrf_reg = RandomForestRegressor()","342caa20":"rf_model = rf_reg.fit(X_train,y_train)          \ny_pred_rf = rf_model.predict(X_val)\n","baa2b8a4":"rmse_rf = np.sqrt(mean_squared_error(y_pred_rf,y_val))\nr2_rf = r2_score(y_pred_rf,y_val)\n\nprint('RMSE of predicted in RF model:',rmse_rf)\nprint('R Sqaured in RF model        :',r2_rf)","e842d205":"# Applying hyper parameter\nrf_params = {'n_estimators':[10,20],'max_depth':[8,10],'max_leaf_nodes':[70,90]}\n\nrf_grid = GridSearchCV(rf_reg,rf_params,cv=10)\nrf_model_two = rf_grid.fit(X_train,y_train)\ny_pred_rf_two = rf_model_two.predict(X_val)\nrmse_rf_2 = np.sqrt(mean_squared_error(y_val,y_pred_rf_two))\nr2_rf_2 = r2_score(y_pred_rf_two,y_val)\nprint('RMSE using RF grid search method:',rmse_rf_2)\nprint('R Sqaured in RF model           :',r2_rf_2)","ee9d2b0f":"rf_model_two.best_params_","ad01dc19":"# After Applying hyper parameter\nrf_params = {'n_estimators':[10],'max_depth':[10],'max_leaf_nodes':[90]}\n\nrf_grid = GridSearchCV(rf_reg,rf_params,cv=10)\nrf_model_three = rf_grid.fit(X_train,y_train)\ny_pred_rf_three = rf_model_three.predict(X_val)\nrmse_rf = np.sqrt(mean_squared_error(y_val,y_pred_rf_three))\nr2_rf = r2_score(y_pred_rf_three,y_val)\nprint('RMSE using RF grid search method :',rmse_rf)\nprint('R Sqaured in RF model            :',r2_score(y_pred_rf_three,y_val))","cb9a2b00":"# import support vector regressor\n         \nsv_reg=SVR()","fd0fc526":"sv_model=sv_reg.fit(X_train,y_train)","f0fb6950":"# predict\ny_pred_sv=sv_model.predict(X_val)        ","5287dc5b":"# Calculate RMSE of SVR\nrmse_svm = np.sqrt(mean_squared_error(y_val,y_pred_sv))\nr2_svm = (r2_score(y_val,y_pred_sv))\nprint('RMSE of SVR model:',rmse_svm)\nprint(\"R2Score          :\",r2_svm)","aa30f5ec":"# Implementing XG Boost library\n\nregressor = xgb.XGBRegressor( \n                                n_estimators=100,\n                                reg_lambda=1,\n                                gamma=0,\n                                max_depth=3\n                            )\n\nregressor.fit(X_train, y_train)","f216335f":"y_pred_xgb = regressor.predict(X_val)\nrmse_xgb = np.sqrt(mean_squared_error(y_val, y_pred_xgb))\nr2_xgb = r2_score(y_val, y_pred_xgb)\nprint('RMSE value without hyperparameter Tuning:',rmse_xgb)\nprint('R-Squared value:',r2_xgb)\nR2 = r2_score(y_val, y_pred_xgb)\nn = X_train.shape[0]\np = len(X_train.columns)\nAdj_r2 = 1-(1-R2)*(n-1)\/(n-p-1)\nprint('Adjusted R-Square is : ',Adj_r2)","69d54bb4":"\nregressor = xgb.XGBRegressor()\nparameters = {'nthread':[3,4], #when use hyperthread, xgboost may become slower\n              'objective':['reg:squarederror'],\n              'learning_rate': [0.1,0.2,0.05], #so called `eta` value\n              'max_depth': [4,5,6],\n              'min_child_weight': [1,2,3],\n              'subsample': [0.7],\n              'colsample_bytree': [0.7],\n              'n_estimators': [100,150]}\n\nxgb_grid = GridSearchCV(regressor, parameters, cv = 5, n_jobs = -1, verbose=True)\nxgb_grid.fit(X_train, y_train)\nprint(xgb_grid.best_score_)\nprint(xgb_grid.best_params_)","61182f0c":"parameters = {\n              'colsample_bytree': [0.7], \n              'learning_rate': [0.1], \n              'max_depth': [6], \n              'min_child_weight': [2], \n              'n_estimators': [150], \n              'nthread': [3], \n              'objective': ['reg:squarederror'],\n              'subsample': [0.7]\n             }\n\nxgb_grid = GridSearchCV(regressor, parameters, cv = 5, n_jobs = -1, verbose=True)\nxgb_grid.fit(X_train, y_train)\ny_pred_xgb_1 = xgb_grid.predict(X_val)","86d93ed1":"rmse_xgb_gscv = np.sqrt(mean_squared_error(y_val, y_pred_xgb_1))\nr2_xgb_gscv = r2_score(y_val, y_pred_xgb_1)\nprint(\"RMSE using XG Boost after applying hyperparamter tuning:\",round(rmse_xgb_gscv,3))\nprint('R-Squared value:',r2_xgb_gscv)\nR2 = r2_score(y_val, y_pred_xgb_1)\nn = X_train.shape[0]\np = len(X_train.columns)\nAdj_r2 = 1-(1-R2)*(n-1)\/(n-p-1)\nprint('Adjusted R-Square is : ',Adj_r2)","90aed643":"# Comparing all the models :\nn = ['Linear Regression','Decision Tree','Random Forest','XG Boost']\nval = [lr_rmse_score,rms_dt,rmse_rf,rmse_xgb]\nval_1 = [lr_r2_score,r2_dt,r2_rf,r2_xgb]\ncompare_df = pd.DataFrame(data=[n,val,val_1]).T","5a6f5ada":"compare_df.columns = ['Models','RMSE Score','R_Sqaured Value']\ncompare_df.sort_values('R_Sqaured Value',inplace = True,ascending=False)\ncompare_df.reset_index(drop=True)","e8d092e5":"X.columns","3358c9d9":"df_final_test.columns","6efaab5a":"df_final_test.head()","61ad91b6":"df_final_test.isnull().sum()","a992c965":"df_final_test.columns","5830775a":"predicted_test = rf_model.predict(df_final_test)","de0d8bd4":"df_final_test['WeeklySales'] = predicted_test\ndf_final_test['Date'] = column_date\ndf_final_test['id'] = df_final_test['Store'].astype(str) + '_' +  df_final_test['Dept'].astype(str) + '_' +  df_final_test['Date'].astype(str)\ndf_final_test = df_final_test[['id', 'WeeklySales']]\ndf_final_test = df_final_test.rename(columns={'id': 'Id', 'WeeklySales': 'Weekly_Sales'})","677ad6f2":"df_final_test.to_csv('output.csv', index=False)","7a1f33fd":"### Data Understanding & Preparation :","6b084c0f":"# Walmart Recruiting - Store Sales Forecasting","dac4b847":"## Decision Tree Regression","f3ffa911":"# This is all from side :) I will be updating the kernel with \"Time Series\" for forcasting Weekly Sales.\n\n# I hope you guys like it if you like it please upvote so that it can motivate me to create moe such kernels :) \n\n# Thanks ","72d94e62":"# Random Forest Regression","f9280d95":"#### Applying hyperparameter tuning","233403dd":"### Spliting data into X & Y","85374205":"#### Description of csv's:\n\n1. stores.csv\n\n    - This file contains anonymized information about the 45 stores, indicating the type and size of store.\n\n2. train.csv\n\n    - This is the historical training data, which covers to 2010-02-05 to 2012-11-01. Within this file you will find the following fields:\n\n        <b>i.   Store<\/b> - the store number <br>\n        <b>ii.  Dept<\/b> - the department number <br>\n        <b>iii. Date<\/b> - the week <br>\n        <b>iv.  Weekly_Sales<\/b> -  sales for the given department in the given store<br>\n        <b>v.   IsHoliday<\/b> - whether the week is a special holiday week<br>\n\n3. test.csv\n\n    - This file is identical to train.csv, except we have withheld the weekly sales. \n    - You must predict the sales for each triplet of store, department, and date in this file.\n\n4. features.csv\n\n    - This file contains additional data related to the store, department, and regional activity for the given dates. \n    - It contains the following fields:\n\n        <b>i.    Store        <\/b> - the store number<br>\n        <b>ii.   Date         <\/b> - the week<br>\n        <b>iii.  Temperature  <\/b> - average temperature in the region<br>\n        <b>iv.   Fuel_Price   <\/b> - cost of fuel in the region<br>\n        <b>v.    MarkDown1-5  <\/b> - anonymized data related to promotional markdowns that Walmart is running.MarkDown data is only available after Nov 2011, and is not available for all stores all the time. Any missing value is marked with an NA.<br>\n        <b>vi.   CPI          <\/b> - the consumer price index<br>\n        <b>vii.  Unemployment <\/b> - the unemployment rate<br>\n        <b>viii. IsHoliday    <\/b> - whether the week is a special holiday week<br>\n\nFor convenience, the four holidays fall within the following weeks in the dataset (not all holidays are in the data):\n\n- <b> Super Bowl    : <\/b>  12-Feb-10, 11-Feb-11, 10-Feb-12, 8-Feb-13 <br>\n- <b> Labor Day     : <\/b>  10-Sep-10, 9-Sep-11, 7-Sep-12, 6-Sep-13 <br>\n- <b> Thanksgiving  : <\/b>  26-Nov-10, 25-Nov-11, 23-Nov-12, 29-Nov-13 <br>\n- <b> Christmas     : <\/b>  31-Dec-10, 30-Dec-11, 28-Dec-12, 27-Dec-13 <br>","8973fdd8":"#### Merging the Dataset ","ca62a787":"## XG Boost","31138367":"### As we can see it is performing very poorly using linear regression.\n#### Let's check for some other alogrithms ","79d7f6d1":"## Support Vector Machine : ","337cad53":"- Here we are provided with historical sales data for 45 Walmart stores located in different regions. \n- Each store contains many departments, and participants must project the sales for each department in each store. \n- In the dataset selected holiday markdown events are included in the dataset. \n- These markdowns are known to affect sales, but it is challenging to predict which departments are affected and the extent of the impact.","9dfc7d03":"### Spliting dataset into train and validation","b36a2d1f":"#### Visualisaing the Data "}}