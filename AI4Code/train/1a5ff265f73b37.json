{"cell_type":{"0cc2f3fa":"code","152f23ae":"code","52fdbf0c":"code","e3c44a56":"code","9df89b88":"code","32ea9f9f":"code","1614ab22":"code","61bdbfcf":"code","d53a32d8":"code","e2b49515":"code","c3b26db8":"code","49341a46":"code","b581b71b":"code","bc61e5ad":"code","a33432aa":"code","5131e438":"code","25c497d8":"code","fc871e7e":"code","0f3f5481":"code","c2d06464":"code","22c2d7d6":"code","56dec523":"code","a4b9437a":"code","f35b0262":"code","656cd32a":"code","5bf6730d":"code","978a34e1":"code","2019310f":"code","b5d6bb49":"code","fd985830":"code","bc84614a":"code","2ff2970e":"code","513feade":"code","17f1134b":"code","2e830904":"code","7da71374":"code","150e0465":"code","b23ce0b7":"code","4249397c":"code","2b024662":"code","edc608cc":"code","0c50e218":"code","1e2c6d54":"code","2579fb4e":"code","a29d88f2":"code","4e588902":"code","6b5e8616":"code","094cf983":"code","c95cbcd4":"code","69347c8d":"code","fbe90ec1":"code","bf23d255":"code","5ca433a0":"code","afdb264d":"code","9c79b2ba":"code","a0ff7074":"code","10d7acca":"code","079b43be":"code","98acc197":"code","4cc4dd83":"code","c25c5b3b":"code","a4c64cc1":"code","09c20655":"code","bd17deb8":"code","9e57cd1e":"code","11ed0b01":"code","ae5a966f":"code","5b4d3043":"code","ccbab5e7":"code","8da79d15":"code","285eb252":"code","e205602e":"code","6c378958":"code","51ac62d7":"code","0c69c144":"code","e2c7667d":"code","c613b4dd":"code","daa1553e":"code","001ef0d2":"code","17a23301":"markdown","2c2cfa10":"markdown","d7c2c85c":"markdown","4a6e4f5f":"markdown","e9c34a53":"markdown","d72c819f":"markdown","fadc6592":"markdown","58c631ae":"markdown","614c6f40":"markdown","ceda3c44":"markdown","2a4147d7":"markdown","d892897d":"markdown","a36d2cda":"markdown","83baacbe":"markdown","98159378":"markdown","e894c8ec":"markdown","bc9460d6":"markdown","37e8880b":"markdown","49c07c48":"markdown","a0177b4c":"markdown","63cae45f":"markdown","d8427b73":"markdown","ea22cd4d":"markdown","bd7866ea":"markdown","3051b902":"markdown","cbd541ec":"markdown","f8119f03":"markdown","986bb244":"markdown","e135f757":"markdown","b11ca18d":"markdown","12a44a5b":"markdown","840f1cb8":"markdown","3a3cbbe9":"markdown","739928ac":"markdown","032c8ed5":"markdown","8943f2c0":"markdown","24251eba":"markdown","c4a637ed":"markdown","dc00bbda":"markdown","ba564cd2":"markdown","8739432e":"markdown"},"source":{"0cc2f3fa":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly.graph_objs as go \nfrom plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot\nimport cufflinks as cf\nimport plotly.express as px\n%matplotlib inline","152f23ae":"world = pd.read_csv('..\/input\/corona-virus-report\/worldometer_data.csv')","52fdbf0c":"full = pd.read_csv('..\/input\/corona-virus-report\/full_grouped.csv') # used in Prophet model","e3c44a56":"covid = pd.read_csv('..\/input\/corona-virus-report\/country_wise_latest.csv')","9df89b88":"day = pd.read_csv('..\/input\/corona-virus-report\/day_wise.csv')","32ea9f9f":"covid.head()","1614ab22":"day.head()","61bdbfcf":"world.head()","d53a32d8":"full.head()","e2b49515":"covid.info()","c3b26db8":"covid.describe()","49341a46":"day.info()","b581b71b":"day.describe()","bc61e5ad":"world.info()","a33432aa":"world.describe()","5131e438":"full.info()","25c497d8":"full.describe()","fc871e7e":"data = dict(type='choropleth',\n            locations = covid['Country\/Region'],\n            locationmode = 'country names',\n            z = covid['Confirmed'],\n            text = covid['Country\/Region'],\n            colorbar = {'title':'Confirmed Cases'}\n            ) \n\nlayout = dict(title='Covid Cases (CONFIRMED)',\n             geo=dict(showframe=False,\n                     projection={'type':'natural earth'}))\n\nchoromap1=go.Figure(data=[data],layout=layout)\niplot(choromap1)","0f3f5481":"data = dict(type='choropleth',\n            locations = world['Country\/Region'],\n            locationmode = 'country names',\n            z = world['TotalCases'],\n            text = world['Country\/Region'],\n            colorbar = {'title':'# of Total Cases'},\n            colorscale = 'viridis'\n            ) \n\nlayout = dict(title='Covid Cases (TOTAL)',\n             geo=dict(showframe=False,\n                     projection={'type':'natural earth'}))\n\nchoromap2=go.Figure(data=[data],layout=layout)\niplot(choromap2)","c2d06464":"data = dict(type='choropleth',\n            locations = world['Country\/Region'],\n            locationmode = 'country names',\n            z = world['TotalRecovered'],\n            text = world['Country\/Region'],\n            colorbar = {'title':'# of Recovered Cases'},\n            colorscale = 'blues'\n            ) \n\nlayout = dict(title='Recovered',\n             geo=dict(showframe=False,\n                     projection={'type':'natural earth'}))\n\nchoromap3=go.Figure(data=[data],layout=layout)\niplot(choromap3)","22c2d7d6":"data = dict(type='choropleth',\n            locations = world['Country\/Region'],\n            locationmode = 'country names',\n            z = world['TotalDeaths'],\n            text = world['Country\/Region'],\n            colorbar = {'title':'# of Deaths'},\n            colorscale = 'reds'\n            ) \n\nlayout = dict(title='Deaths',\n             geo=dict(showframe=False,\n                     projection={'type':'natural earth'}))\n\nchoromap4=go.Figure(data=[data],layout=layout)\niplot(choromap4)","56dec523":"sns.set_style('darkgrid')","a4b9437a":"plt.figure(figsize=(8,8))\nsns.kdeplot(x = 'Recovered',data=covid, hue=\"WHO Region\")","f35b0262":"# Confirmed\nplt.figure(figsize=(10,4))\nax1 = sns.kdeplot(data=covid, x=\"Confirmed\",color='r')\nplt.show(ax1)\n\n# Deaths\nplt.figure(figsize=(10,4))\nax2 = sns.kdeplot(data=covid, x=\"Deaths\", color='g')\nplt.show(ax2)\n\n# Recovered\nplt.figure(figsize=(10,4))\nax3 = sns.kdeplot(data=covid, x=\"Recovered\", color='b')\nplt.show(ax3)\n\n# Active\nplt.figure(figsize=(10,4))\nax4 = sns.kdeplot(data=covid, x=\"Active\", color='y')\nplt.show(ax4)\n\n# New Cases\nplt.figure(figsize=(10,4))\nax5 = sns.kdeplot(data=covid, x=\"New cases\", color='purple')\nplt.show(ax5)\n\n# New Deaths\nplt.figure(figsize=(10,4))\nax6 = sns.kdeplot(data=covid, x=\"New deaths\", color='gray')\nplt.show(ax6)\n\n# New Recovered\nplt.figure(figsize=(10,4))\nax7 = sns.kdeplot(data=covid, x=\"New recovered\", color='pink')\nplt.show(ax7)","656cd32a":"px.pie(world[:25], values='TotalCases', names='Country\/Region', \n       title='Top 25 Countries')","5bf6730d":"europe = world[world['Continent'] == 'Europe']\nasia = world[world['Continent'] == 'Asia']\nnorth_america = world[world['Continent'] == 'North America']\nsouth_america = world[world['Continent'] == 'South America']\naustralia_oceania = world[world['Continent'] == 'Australia\/Oceania']","978a34e1":"px.pie(europe[:25], values='TotalCases', names='Country\/Region', \n       title='Top 25 Countries\/Regions in Europe')","2019310f":"px.pie(asia[:25], values='TotalCases', names='Country\/Region', \n       title='Top 25 Countries\/Regions in Asia')","b5d6bb49":"px.pie(north_america[:15], values='TotalCases', names='Country\/Region', \n       title='Top 15 Countries\/Regions in North America')","fd985830":"px.pie(south_america, values='TotalCases', names='Country\/Region', \n       title='Countries\/Regions in South America')","bc84614a":"px.pie(australia_oceania, values='TotalCases', names='Country\/Region', \n       title='Countries\/Regions in Australia\/Oceania')","2ff2970e":"fig = px.bar(world[:50], x = 'Country\/Region', y = 'TotalRecovered',color = 'Country\/Region')\nfig","513feade":"fig2 = px.bar(world[:50], x = 'Country\/Region', y = 'TotalDeaths',color = 'Country\/Region')\nfig2","17f1134b":"fig3 = px.bar(covid, x = 'WHO Region', y = 'Confirmed',color = 'WHO Region')\nfig3","2e830904":"fig4 = px.bar(covid, x = 'WHO Region', y = 'Recovered',color = 'WHO Region')\nfig4","7da71374":"fig5 = px.bar(covid, x = 'WHO Region', y = 'Deaths',color = 'WHO Region')\nfig5","150e0465":"plt.figure(figsize=(15,8))\nsns.heatmap(covid.corr(),cmap='viridis',annot=True)","b23ce0b7":"plt.figure(figsize=(15,8))\nsns.heatmap(day.corr(),cmap='coolwarm',annot=True)","4249397c":"plt.figure(figsize=(15,8))\nsns.heatmap(world.corr(),cmap='Pastel2_r',annot=True)","2b024662":"day.head()","edc608cc":"covid.head()","0c50e218":"covid.isnull().sum() # no null values","1e2c6d54":"day.isnull().sum() # no null values","2579fb4e":"day['Date']=pd.to_datetime(day['Date']) # converting Data into datetime","a29d88f2":"day['Day'] = day['Date'].apply(lambda x: x.hour)\nday['Month'] = day['Date'].apply(lambda x: x.month)\nday['Year'] = day['Date'].apply(lambda x: x.dayofweek)","4e588902":"day_temp = day.copy()\nday_temp = day_temp.drop('Date',axis=1)\nday_temp.head()","6b5e8616":"from sklearn.model_selection import train_test_split\n\nX = day_temp.drop('Confirmed',axis=1).values\ny = day_temp['Confirmed'].values\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=101)","094cf983":"from tensorflow.keras.models import Sequential\nfrom tensorflow.keras.layers import Dense,Dropout\nX_train.shape","c95cbcd4":"from sklearn.preprocessing import MinMaxScaler\nscaler = MinMaxScaler()\nX_train = scaler.fit_transform(X_train)\nX_test = scaler.transform(X_test)","69347c8d":"model = Sequential()\n\nmodel.add(Dense(19,activation='relu'))\nmodel.add(Dropout(0.5))\nmodel.add(Dense(19,activation='relu'))\nmodel.add(Dropout(0.5))\nmodel.add(Dense(19,activation='relu'))\nmodel.add(Dropout(0.5))\nmodel.add(Dense(19,activation='relu'))\nmodel.add(Dropout(0.5))\n\nmodel.add(Dense(1))\n\nmodel.compile(optimizer='adam',loss='mse')","fbe90ec1":"from tensorflow.keras.callbacks import EarlyStopping\n#early_stop = EarlyStopping(monitor='val_loss',mode='min',verbose=1,patience=25)\nmodel.fit(x=X_train,y=y_train,epochs=600,validation_data=(X_test,y_test),callbacks=[])","bf23d255":"model_loss = pd.DataFrame(model.history.history)\nmodel_loss.plot()","5ca433a0":"from sklearn.metrics import mean_squared_error, explained_variance_score","afdb264d":"predictions = model.predict(X_test)\nnp.sqrt(mean_squared_error(y_test,predictions))","9c79b2ba":"from sklearn.metrics import mean_absolute_error","a0ff7074":"mean_absolute_error(y_test,predictions)","10d7acca":"explained_variance_score(y_test,predictions)","079b43be":"from fbprophet import Prophet","98acc197":"conf_data = full[['Date', 'Confirmed']].groupby('Date', as_index = False).sum()\nconf_data.columns = ['ds', 'y']\nconf_data.ds = pd.to_datetime(conf_data.ds)","4cc4dd83":"conf_data.head()","c25c5b3b":"proph = Prophet()\nproph.fit(conf_data)","a4c64cc1":"confirmed_pred = proph.make_future_dataframe(periods=60)\nconfirmed_pred.tail()","09c20655":"confirmed_forecast = proph.predict(confirmed_pred)\nconfirmed_forecast[['ds', 'yhat', 'yhat_lower', 'yhat_upper']].tail()","bd17deb8":"fig1 = proph.plot(confirmed_forecast)","9e57cd1e":"fig2 = proph.plot_components(confirmed_forecast)","11ed0b01":"deaths_data = full[['Date', 'Deaths']].groupby('Date', as_index = False).sum()\ndeaths_data.columns = ['ds', 'y']\ndeaths_data.ds = pd.to_datetime(deaths_data.ds)","ae5a966f":"deaths_data.head()","5b4d3043":"proph2 = Prophet()\nproph2.fit(deaths_data)","ccbab5e7":"deaths_pred = proph2.make_future_dataframe(periods=60)\ndeaths_pred.tail()","8da79d15":"deaths_forecast = proph2.predict(deaths_pred)\ndeaths_forecast[['ds', 'yhat', 'yhat_lower', 'yhat_upper']].tail()","285eb252":"fig3 = proph2.plot(deaths_forecast)","e205602e":"fig4 = proph2.plot_components(deaths_forecast)","6c378958":"rec_data = full[['Date', 'Recovered']].groupby('Date', as_index = False).sum()\nrec_data.columns = ['ds', 'y']\nrec_data.ds = pd.to_datetime(rec_data.ds)","51ac62d7":"rec_data.head()","0c69c144":"proph3 = Prophet()\nproph3.fit(rec_data)","e2c7667d":"rec_pred = proph3.make_future_dataframe(periods=60)","c613b4dd":"rec_forecast = proph3.predict(deaths_pred)\nrec_forecast[['ds', 'yhat', 'yhat_lower', 'yhat_upper']].tail()","daa1553e":"fig5 = proph3.plot(rec_forecast)","001ef0d2":"fig6 = proph3.plot_components(rec_forecast)","17a23301":"This is another representation of the total cases through an interactive bar plot.","2c2cfa10":"There is an increase in recovered cases. Saturday tends to have the most recovered cases while Tuesday has the least amount of recovered cases. ","d7c2c85c":"Australia has the most cases. This makes sense as Australia is the largest country\/continent in this area.","4a6e4f5f":"COVID-19's effect on the entire world is apparent as we are struggling to fight this deadly virus. \nThe first COVID-19 case was reported on December 31, 2019 in Wuhan, China. \nOn January 21, 2020, the CDC (Center for Disease Control) confirmed the first COVID-19 case in the U.S. (\"A Timeline of Covid-19 Developments in 2020\"). \n\nSince then, cases have risen exponentially and numerous precautionary measures have been taken to prevent the spread of the virus. By May 26, 2021, there were 168 million cases around the world with 3.49 million deaths. AI, machine learning, and data science allows us to analyze the spread of COVID-19 to better understand the virus. It also allows us to help inform the world of new discoveries around COVID-19. \n\n![download](https:\/\/user-images.githubusercontent.com\/75640165\/119728300-2691f100-be28-11eb-9dcd-3a74360577aa.jpg)","e9c34a53":"Brazil has the majority of the total cases in South America.","d72c819f":"# Model for Confirmed Cases","fadc6592":"U.S. has 85% of the total cases in North America.","58c631ae":"# Model for Recovered","614c6f40":"These kde plots represent the distribution of several of the numerical features (recovered, confirmed, deaths...)","ceda3c44":"[EarlyStopping](https:\/\/en.wikipedia.org\/wiki\/Early_stopping) is another way to prevent overfitting, but I found that this model did better without it. ","2a4147d7":"Since the neural network model did not do a great job at predicting the number of confirmed cases, let's try using Prophet. \n\n[Prophet](https:\/\/research.fb.com\/blog\/2017\/02\/prophet-forecasting-at-scale\/) is a forecasting tool from Facebook that uses the data to predict future behavior. It is an additive regression model, a nonparametric model, ( these are contructed using info from the data rather than taking a predetermined form). One benefit is that additive regression models are more flexible than regular linear regression models. \n\nThrough this model, Prophet has 4 main components:\n- list of holidays (from user)\n- weekly seasonal component with dummy variables\n- yearly seasonal component with Fourier series\n- piecewise linear\/logistic curve trend (selects points in the data to detect changes in trends) \n\nTo learn the basics of Prophet, click [here](https:\/\/facebook.github.io\/prophet\/docs\/quick_start.html#python-api)","d892897d":"This shows the yearly and weekly seasonilty of the cases trend. There is a steady increase in cases from February 2020 to October 2020. The weekly graph shows that Saturday tends to have the most cases with Tuesday having the least amount of cases.","a36d2cda":"## Prophet Model","83baacbe":"Most of the concentration of Covid-19 confirmed cases are in the U.S. and Brazil. These countries have the most confirmed cases. We can visualize this data using a choropleth map created with Plotly libraries.","98159378":"When building the model, it is important to use [dropout layers](https:\/\/keras.io\/api\/layers\/regularization_layers\/dropout\/) to prevent overfitting. The activation function is [relu](https:\/\/machinelearningmastery.com\/rectified-linear-activation-function-for-deep-learning-neural-networks\/#:~:text=The%20rectified%20linear%20activation%20function,otherwise%2C%20it%20will%20output%20zero.&text=The%20rectified%20linear%20activation%20function%20overcomes%20the%20vanishing%20gradient%20problem,learn%20faster%20and%20perform%20better.) (rectified linear unit) with the optimizer being [adam](https:\/\/www.tensorflow.org\/swift\/api_docs\/Classes\/Adam). Relu is a piecewise linear function that is easy to train and is generally the default activation function. The adam optimizer helps update weights more efficiently than stochastic gradient descent (adam is an extension of this).","e894c8ec":"Predictions for confirmed cases, recovered, deaths, and were made based on the dataset. To make these predictions, I used Prophet.\n[Prophet](https:\/\/facebook.github.io\/prophet\/#:~:text=Prophet%20is%20a%20procedure%20for,daily%20seasonality%2C%20plus%20holiday%20effects.&text=Prophet%20is%20open%20source%20software,download%20on%20CRAN%20and%20PyPI.) is a forecasting tool from Facebook that uses data to predict future behavoir. Prophet gives a future trend to the data instead of just predictions.\nIt makes forecasts based on irregular holidays and year, weekly, and daily seasonality.\n\n","bc9460d6":"The deaths were flattening at the beginning of 2020, but as time went on, the death cases began increasing. The most amount of deaths or on Saturday and the least amount of deaths is on Monday.","37e8880b":"With this heatmap, we can see what features are most correlated with the number of confirmed cases. \nMost correlated features:\n- Deaths (93%)\n- Active (93%)\n- Recovered (91%)\n- New cases (91%)\n- New deaths (87%)\n- New recovered (86%)\n- Confirmed last week (100%)\n- 1 week change (95%)","49c07c48":"## Building Neural Network Model","a0177b4c":"## Train Test Split","63cae45f":"Using the info() method, we can the data type, and the amount of non-null items in the data frame.","d8427b73":"India has the most cases in Asia. This is consisent with the previous geographical maps.","ea22cd4d":"Russia has over a quarter of the total cases in Europe. ","bd7866ea":"This graph shows the distribution of recovered cases for each WHO region plotted on top of each other.","3051b902":"The percentage of the top 25 countries with the most cases is represented in this pie chart. U.S. has almost 1\/3 of the total cases among these 25 countries. This pie chart was created using Plotly libraries.","cbd541ec":"This creates seperate numerical columns with the year, month, and day.","f8119f03":"day_temp will be used in model","986bb244":"Though U.S. has the most cases, they also have the most recovered. This may be because they had many cases to start off with. ","e135f757":"yhat is the forecast, and yhat_lower & yhat_upper are the uncertainty interval.","b11ca18d":"# Model for Deaths","12a44a5b":"The following plots show the amount of confirmed, recovered, and death cases in the WHO Region. Each bar is also divided into larger and smaller sections based on which country has the most cases.","840f1cb8":"Most correlated with total cases:\n- NewCases (100%)\n- NewDeaths (100%)\n- NewRecovered (100%)\n- ActiveCases (97%)\n- SeriousCritical (97%)\n- TotalDeaths (94%)\n- TotalTests (89%)\n- Population (55%)","3a3cbbe9":"\n\nJust like the previous map, U.S. and Brazil have the most total cases. India and Russia also have a significant amount of total cases. Information about China is not present in this data set and on the map.","739928ac":"# Data PreProcessing","032c8ed5":"The black dots represent the true y values while the blue line represents the forecast or predicted trend. From this graph, we can see that the Prophet model is doing a good job at predicting the number of confirmed cases as the data matches up with the predictions. ","8943f2c0":"Most correlated with confirmed:\n- Recovered (99%)\n- Active (99%)\n- Deaths (98%)\n- New cases (96%)\n- New recovered (94%)\n- Recoverd\/100 Cases (72%)\n- No. of Countries (60%)\n- New deaths (56%)","24251eba":"# Exploratory Data Analysis","c4a637ed":"Just like the previous geographical maps, U.S. and Brazil also have the most deaths.","dc00bbda":"The describe() method presents some quick statistics to the data. ","ba564cd2":"# Load Data","8739432e":"MinMaxScaler scales each feature to a given range. This is known as feature scaling and normalizes the range of features in the data. This allows the neural network to converge faster to the local minimum. \n\nTo learn more about why feature scaling is important, [read this article](https:\/\/towardsdatascience.com\/all-about-feature-scaling-bcc0ad75cb35)."}}