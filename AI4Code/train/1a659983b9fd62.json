{"cell_type":{"ecfd02e1":"code","67b4fb8b":"code","cd8d460c":"code","417fb7b8":"code","6b045f7d":"code","6438b735":"code","8b514352":"code","22bfb010":"code","3159a972":"code","da36524e":"code","b57966b5":"code","45b5572a":"code","ce9fbbbc":"code","d15dd092":"code","d422106c":"markdown","b793151b":"markdown","1c8c7f16":"markdown","77050a45":"markdown"},"source":{"ecfd02e1":"import pandas as pd\nimport numpy as np\nimport os\nfrom sklearn.feature_extraction.text import TfidfVectorizer\nfrom sklearn.model_selection import KFold\nfrom sklearn.linear_model import Ridge, LinearRegression\nfrom sklearn.metrics import mean_squared_error\nimport spacy\nfrom tqdm import tqdm","67b4fb8b":"ROOT_DIR = \"..\/input\/commonlitreadabilityprize\"","cd8d460c":"tr = pd.read_csv(f\"{ROOT_DIR}\/train.csv\")\nte = pd.read_csv(f\"{ROOT_DIR}\/test.csv\")","417fb7b8":"\"\"\"\n#vec = TfidfVectorizer() #26833\nvec = TfidfVectorizer(max_features=10_000)\nX = vec.fit_transform(tr[\"excerpt\"]).toarray()\nXe = vec.transform(te[\"excerpt\"]).toarray()\n\"\"\"","6b045f7d":"nlp = spacy.load('en_core_web_lg')\nwith nlp.disable_pipes():\n    X = np.array([nlp(text).vector for text in tqdm(tr.excerpt)])\n    #Xe = np.array([nlp(text).vector for text in te.excerpt])","6438b735":"with nlp.disable_pipes():\n    Xe = np.array([nlp(text).vector for text in tqdm(te.excerpt)])","8b514352":"y = tr[\"target\"].values","22bfb010":"X.shape, Xe.shape","3159a972":"NFOLDS = 10\nskf = KFold(n_splits=NFOLDS)\nfolds = list(skf.split(X))","da36524e":"oof = np.zeros(y.shape)\npred = np.zeros((Xe.shape[0],))\nfor idx in range(NFOLDS):\n    print(\"FOLD: \", idx + 1)\n    tr_idx, val_idx = folds[idx]\n    #reg = Ridge()\n    reg = LinearRegression()\n    reg.fit(X[tr_idx], y[tr_idx])\n    oof[val_idx] =reg.predict(X[val_idx])\n    pred += reg.predict(Xe) \/ NFOLDS\n#===============","b57966b5":"mse = mean_squared_error(y, oof, squared=False)\nprint(\"OOF MSE:\",mse)","45b5572a":"sub = te[[\"id\"]].copy()\nsub[\"target\"] = pred","ce9fbbbc":"sub.head()","d15dd092":"sub.to_csv(\"submission.csv\", index=False)","d422106c":"## LOADING","b793151b":"## PROCESSING","1c8c7f16":"## SUBMISSION","77050a45":"## TRAINING AND PREDICTION"}}