{"cell_type":{"34298cd2":"code","73f0b204":"code","7c3be19e":"code","6fb446b6":"code","029b8cb5":"code","f9c211ad":"code","d8593cd1":"code","6627cb51":"code","269e98f4":"code","37f2137a":"code","efec339a":"code","966be7e9":"code","0d052e4c":"code","75c8ec69":"code","d0d3c23b":"code","596069d3":"code","3b9db48c":"code","e09ca1f0":"code","81e4059f":"code","d4a01809":"code","ea426e43":"code","e3001393":"markdown","349451b5":"markdown"},"source":{"34298cd2":"from fastai.text.all import *","73f0b204":"old_jigsaw_path = Path('..\/input\/jigsaw-toxic-comment-classification-challenge')\ninput_path = Path('..\/input\/jigsaw-toxic-severity-rating')","7c3be19e":"!unzip ..\/input\/jigsaw-toxic-comment-classification-challenge\/train.csv.zip","6fb446b6":"df = pd.read_csv('..\/working\/train.csv')\ndf.shape","029b8cb5":"df.tail(3)","f9c211ad":"df[df.toxic==1].head(4)","d8593cd1":"df['total_tox'] = df[df.columns[2:]].sum(axis=1)","6627cb51":"df['total_tox'].value_counts()","269e98f4":"db_lm = DataBlock(\n            blocks = TextBlock.from_df('comment_text', is_lm=True),\n    get_x =ColReader('text'),       \n    splitter=RandomSplitter(0.1),\n    ).dataloaders(df, bs=64, seq_len=80)","37f2137a":"db_lm.show_batch(max_n=1)","efec339a":"vocab = pd.Series(db_lm.vocab)\nvocab.to_csv('lm_vocab.csv')","966be7e9":"learn = language_model_learner(\n            db_lm, AWD_LSTM, drop_mult=0.3,\n            metrics=[accuracy, Perplexity()]).to_fp16()","0d052e4c":"learn.fit_one_cycle(1,2e-2)","75c8ec69":"learn.save_encoder('lm_encoder')","d0d3c23b":"toxic_db = DataBlock(blocks=(TextBlock.from_df('comment_text', vocab=db_lm.vocab), RegressionBlock),\n                     get_x = ColReader('text'),\n                     get_y = ColReader('total_tox'),\n                     splitter = RandomSplitter())","596069d3":"dls = toxic_db.dataloaders(df, bs=64)\ndls.show_batch(max_n=1)","3b9db48c":"learner = text_classifier_learner(dls, AWD_LSTM, drop_mult=0.5, metrics=accuracy)","e09ca1f0":"learner = learner.load_encoder('lm_encoder')","81e4059f":"learner.fine_tune(4, 1e-2)","d4a01809":"learner.show_results()","ea426e43":"learner.save('initial_model')","e3001393":"So most of them don't have any toxicity, which we can score as zero. Only 31 are maximally toxic on our arbitrary scale. Probably need to be more mindful about the data collection and parsing, but we'll use this for now to proceed","349451b5":"This is a simple\/naive pipeline to show how to utilize fastai and ULMFIT in order to tackle this problem: https:\/\/docs.fast.ai\/tutorial.text.html\n\nInference notebook can be found here: https:\/\/www.kaggle.com\/alibaba19\/jigsaw-ulmfit-fastai-inference\/notebook"}}