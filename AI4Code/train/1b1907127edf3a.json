{"cell_type":{"7e732aa3":"code","db37f835":"code","4b9923a4":"code","8ef4e06f":"code","7179d19f":"code","78b69970":"code","f9e76ff3":"code","767b27d7":"code","8ab37e06":"code","bb8de3f8":"code","73a5da6a":"code","f4f03d09":"code","4f99a3b8":"code","c0185fd7":"code","4bd417e8":"code","15d0abd1":"code","06a0e481":"code","6965a99b":"code","4e77600e":"code","29bc7269":"code","9c3d4557":"code","872dea10":"code","c4093953":"code","e5c87c1f":"code","f95eb767":"code","c2f6b32c":"code","538dff3f":"markdown"},"source":{"7e732aa3":"from fastai.vision import *\nimport os","db37f835":"os.makedirs('\/root\/.cache\/torch\/checkpoints')","4b9923a4":"!cp ..\/input\/resnet34fastai\/resnet34.pth \/root\/.cache\/torch\/checkpoints\/resnet34-333f7ec4.pth","8ef4e06f":"model_path = 'models'\nplot_path = 'plots'\n\nif not os.path.exists(model_path):\n    os.makedirs(model_path)\n    os.makedirs(os.path.join(model_path, plot_path))","7179d19f":"'''\nSeverity Levels\n\n0 - 'No_DR',\n1 - 'Mild',\n2 - 'Moderate',\n3 - 'Severe',\n4 - 'Proliferate_DR'\n'''\n\nclasses = ['No_DR', 'Mild', 'Moderate', 'Severe', 'Proliferate_DR']","78b69970":"path = Path('..\/input\/diabetic-retinopathy-224x224-2019-data\/colored_images')\npath.ls()","f9e76ff3":"# remove the images that we cannot open\n# for c in classes:\n#     print(c)\n#     verify_images(path\/c, delete=True, max_size=500)","767b27d7":"np.random.seed(42)\ndata = ImageDataBunch.from_folder(path, train='.', valid_pct=0.2, \n                                  ds_tfms=get_transforms(), size=224, \n                                  num_workers=4, bs=16).normalize(imagenet_stats)","8ab37e06":"data.classes","bb8de3f8":"data.show_batch(rows=3, figsize=(10, 7))","73a5da6a":"data.classes, data.c, len(data.train_ds), len(data.valid_ds)","f4f03d09":"learn = cnn_learner(data, models.resnet34, metrics=error_rate, model_dir='\/kaggle\/working\/models')\n# learner = load('..\/input\/resnet34-fastai\/resnet34.pth')\n# learn = cnn_learner(data, learner, metrics=error_rate)","4f99a3b8":"learn.fit_one_cycle(20)    ","c0185fd7":"learn.recorder.plot_losses()","4bd417e8":"!pwd\nprint(os.listdir('..\/..\/'))","15d0abd1":"learn.save('colored_stage1')","06a0e481":"learn.unfreeze()","6965a99b":"learn.lr_find()","4e77600e":"learn.recorder.plot()","29bc7269":"learn.fit_one_cycle(3, max_lr=slice(1e-6, 1e-5))","9c3d4557":"learn.save('colored_stage2')","872dea10":"learn.load('colored_stage2')","c4093953":"interp = ClassificationInterpretation.from_learner(learn)","e5c87c1f":"interp.plot_confusion_matrix()","f95eb767":"!pwd","c2f6b32c":"learn.export('\/kaggle\/working\/models\/colored_export.pkl')","538dff3f":"## 1) Introduction\n* This kernel trains a ResNet34 model on the colored images of Diabetic Retinopathy dataset. All the intermediate models, and the final model is being exported. \n* You can either download the final model or use it in your own kernels as well."}}