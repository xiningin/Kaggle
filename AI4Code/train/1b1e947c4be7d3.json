{"cell_type":{"04e6d3b2":"code","78417280":"code","b46ddcb5":"code","32daa2de":"code","d5be5c84":"code","b9c56ea0":"code","63f86605":"code","3348f85c":"code","67dac8cf":"code","89f62097":"code","5f8c5d47":"code","ed868416":"code","4b4dd35b":"code","0e70b225":"code","144a0fff":"code","6c8c4580":"code","882bbacf":"markdown","3e0d8894":"markdown","6822c69b":"markdown","21a60a94":"markdown","882d0204":"markdown","521f5714":"markdown","7a640dd9":"markdown","4fef1499":"markdown","a2f64a08":"markdown","fe0dc4fd":"markdown","9629219f":"markdown","da82451f":"markdown","ace80b83":"markdown","2b81fe3b":"markdown","8f4719be":"markdown","179ad042":"markdown","27d0ceed":"markdown","41d817ad":"markdown","389b6853":"markdown","b367e73a":"markdown","f7967d79":"markdown"},"source":{"04e6d3b2":"import pandas as pd\n\npath = \"\/kaggle\/input\/competitive-data-science-predict-future-sales\/\"\n\nurunler = pd.read_csv(path+'\/items.csv')\nkategoriler = pd.read_csv(path+'\/item_categories.csv')\ndukkanlar = pd.read_csv(path+'\/shops.csv')\nsatislar = pd.read_csv(path+'\/sales_train.csv')\ntest = pd.read_csv(path+'\/test.csv')\norneklem = pd.read_csv(path+'\/sample_submission.csv')\n\nprint(\"Veri setleri ba\u015far\u0131yla y\u00fcklendi.\")","78417280":"from datetime import datetime\nsatislar['year'] = pd.to_datetime(satislar['date']).dt.strftime('%Y')\nsatislar['month'] = satislar.date.apply(lambda x: datetime.strptime(x,'%d.%m.%Y').strftime('%m')) \n\nsatislar.head(2)","b46ddcb5":"import numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n%matplotlib inline \n\ngrouped = pd.DataFrame(satislar.groupby(['year','month'])['item_cnt_day'].sum().reset_index())\nsns.pointplot(x='month', y='item_cnt_day', hue='year', data=grouped)","32daa2de":"#Fiyat\ngrouped_price = pd.DataFrame(satislar.groupby(['year','month'])['item_price'].mean().reset_index())\nsns.pointplot(x='month', y='item_price', hue='year', data=grouped_price)","d5be5c84":"ts=satislar.groupby([\"date_block_num\"])[\"item_cnt_day\"].sum()\nts.astype('float')\nplt.figure(figsize=(16,8))\nplt.title('B\u00fct\u00fcn zaman periyodu boyunca olan b\u00fct\u00fcn sat\u0131\u015flar')\nplt.xlabel('Zaman')\nplt.ylabel('Sat\u0131\u015flar')\nplt.plot(ts);","b9c56ea0":"satislar.item_cnt_day.hist(bins=100)\nsatislar.item_cnt_day.describe()","63f86605":"print('Fiyat\u0131 s\u0131f\u0131rdan d\u00fc\u015f\u00fck olan \u00fcr\u00fcnler silinmeden \u00f6nceki veri seti b\u00fcy\u00fckl\u00fc\u011f\u00fc:', satislar.shape)\nsatislar = satislar.query('item_price > 0')\nprint('Fiyat\u0131 s\u0131f\u0131rdan d\u00fc\u015f\u00fck olan \u00fcr\u00fcnler silindikten sonraki veri seti b\u00fcy\u00fckl\u00fc\u011f\u00fc:', satislar.shape)","3348f85c":"print('Filtrelemeden \u00f6nceki veri seti b\u00fcy\u00fckl\u00fc\u011f\u00fc:', satislar.shape)\n# Test setinde sadece d\u00fckkanlar bulunuyor.\nsatislar = satislar[satislar['shop_id'].isin(test['shop_id'].unique())]\n# Test setinde sadece \u00fcr\u00fcnler bulunuyor.\nsatislar = satislar[satislar['item_id'].isin(test['item_id'].unique())]\nprint('Filtrelemeden sonraki veri seti b\u00fcy\u00fckl\u00fc\u011f\u00fc:', satislar.shape)","67dac8cf":"print('Ayk\u0131r\u0131 de\u011ferler silinmeden \u00f6nceki veri seti b\u00fcy\u00fckl\u00fc\u011f\u00fc:', satislar.shape)\nsatislar = satislar.query('item_cnt_day >= 0 and item_cnt_day <= 125 and item_price < 75000')\nprint('Ayk\u0131r\u0131 de\u011ferler silindikten sonraki veri seti b\u00fcy\u00fckl\u00fc\u011f\u00fc:', satislar.shape)","89f62097":"aylik_satislar=satislar.groupby([\"date_block_num\",\"shop_id\",\"item_id\"])[\"date_block_num\",\"date\",\"item_price\",\"item_cnt_day\"].agg({\"date_block_num\":'mean',\"date\":[\"min\",'max'],\"item_price\":\"mean\",\"item_cnt_day\":\"sum\"})\naylik_satislar.head(5)","5f8c5d47":"duzgun_satis_verisi = aylik_satislar.item_cnt_day.apply(list).reset_index()\n#Sadece d\u00fczg\u00fcn veriyle i\u015flem yapaca\u011f\u0131z.\nduzgun_satis_verisi = pd.merge(test,duzgun_satis_verisi,on = ['item_id','shop_id'],how = 'left')\n#NA de\u011ferleri 0 ile dolduruyoruz.\nduzgun_satis_verisi.fillna(0,inplace = True)\nduzgun_satis_verisi.drop(['shop_id','item_id'],inplace = True, axis = 1)\nduzgun_satis_verisi.head(20)","ed868416":"# Sat\u0131rlar = Her d\u00fckkan ve \u00fcr\u00fcn kodunun birle\u015fimi\n# S\u00fctunlar = Zaman sekans\u0131 olarak kullan\u0131lacak.\npivot_tablosu = duzgun_satis_verisi.pivot_table(index='ID', columns='date_block_num',fill_value = 0,aggfunc='sum' )\npivot_tablosu.head(20)","4b4dd35b":"# Son s\u00fctun hari\u00e7 hepsini kullanaca\u011f\u0131z.\nX_train = np.expand_dims(pivot_tablosu.values[:,:-1],axis = 2)\n# \u00c7\u00fcnk\u00fc son s\u00fctun bizim tahminlememiz olacak.\ny_train = pivot_tablosu.values[:,-1:]\n\n# Test i\u00e7inse ilk s\u00fctun hari\u00e7 di\u011fer b\u00fct\u00fcn s\u00fctunlar\u0131 kullanaca\u011f\u0131z.\nX_test = np.expand_dims(pivot_tablosu.values[:,1:],axis = 2)\n\n# \u015eekle bir g\u00f6z atal\u0131m.\nprint(X_train.shape,y_train.shape,X_test.shape)","0e70b225":"from keras.models import Sequential\nfrom keras.layers import LSTM,Dense,Dropout\nfrom keras.models import load_model, Model\n\n# Sat\u0131\u015f modelini tan\u0131ml\u0131yoruz.\nsatis_modeli = Sequential()\nsatis_modeli.add(LSTM(units = 64,input_shape = (33,1)))\nsatis_modeli.add(Dropout(0.5))\nsatis_modeli.add(Dense(1))\n\nsatis_modeli.compile(loss = 'mse',optimizer = 'adam', metrics = ['mean_squared_error'])\nsatis_modeli.summary()","144a0fff":"satis_modeli.fit(X_train,y_train,batch_size = 4096,epochs = 20)","6c8c4580":"orneklem_ciktisi = satis_modeli.predict(X_test)\norneklem = pd.DataFrame({'ID':test['ID'],'tahmini_aylik_satis':orneklem_ciktisi.ravel()})\n\norneklem.to_csv('tahminleme.csv',index = False)\norneklem.head(100)","882bbacf":"Daha sonra batch size belirleyip 20 ad\u0131mda tahminlemeyi ger\u00e7ekle\u015ftiriyoruz.\n\nBatch size = \u00d6rnek verilerin ka\u00e7arl\u0131 gruplar halinde n\u00f6ron i\u00e7ine girdi\u011fi belirlemek i\u00e7in kullan\u0131l\u0131r.\n\nBiz verisetimiz \u00e7ok b\u00fcy\u00fck oldu\u011fu i\u00e7in 4096 olarak ayarlad\u0131k.","3e0d8894":"Daha sonra \u00fcr\u00fcnlerin sat\u0131\u015flar\u0131n\u0131n zaman ve tarih girdilerini ekliyoruz.","6822c69b":"Sat\u0131\u015flar\u0131 ayl\u0131k olarak topluyoruz.","21a60a94":"\u00c7\u0131kt\u0131lar \u00e7ok uzun oldu\u011fu i\u00e7in sadece 5 \u00fcr\u00fcn\u00fc \u00f6rnek olarak listeledik.","882d0204":"Art\u0131k elimizde tam istedi\u011fimiz gibi bir matris tablosu var.","521f5714":"\u00c7\u0131kt\u0131lar bize eksi de\u011ferde sat\u0131\u015flar oldu\u011funu g\u00f6steriyor. Bunlar\u0131 veri setinden \u00e7\u0131karmam\u0131z laz\u0131m.","7a640dd9":"Son olarak i\u015flenen verileri csv dosyas\u0131 \u015feklinde \u00e7\u0131kt\u0131 alarak her \u00fcr\u00fcn\u00fcn adet olarak ayl\u0131k ortalama ka\u00e7 tane sat\u0131laca\u011f\u0131n\u0131 buluyoruz.","4fef1499":"\nBu grafikte \u015funu g\u00f6r\u00fcyoruz.\n*     Y\u0131l\u0131n son iki ay\u0131 genelde daha fazla sat\u0131\u015f oluyor.\n*     2015 y\u0131l\u0131nda da daha fazla sat\u0131\u015f bekliyoruz.\n","a2f64a08":"\u00dcr\u00fcn ba\u015f\u0131na ger\u00e7ekle\u015fen ortalama sat\u0131\u015f\u0131, bunun ortalamas\u0131n\u0131, standart sapma de\u011ferini, minimum ve maksimum de\u011ferlerini buluyoruz.","fe0dc4fd":"Elimizdeki toplam \u00fcr\u00fcn say\u0131s\u0131 1.224.439\nArd\u0131ndan filtremizi biraz daha geli\u015ftirip g\u00fcnl\u00fck \u00fcr\u00fcn sat\u0131\u015f\u0131 0'dan b\u00fcy\u00fck ve 125'ten k\u00fc\u00e7\u00fck olan fiyat\u0131da 75000'i ge\u00e7meyen \u00fcr\u00fcnleri buluyoruz.","9629219f":"Sadece 1 adet negatif de\u011ferli \u00fcr\u00fcn oldu\u011funu g\u00f6r\u00fcyoruz.\nArd\u0131ndan tekrar eden \u00fcr\u00fcn ve d\u00fckkanlar\u0131 kald\u0131rmak i\u00e7in unique(\u00f6zel) fonksiyonunu kullanarak yeni bir filtreleme ger\u00e7ekle\u015ftiriyoruz.","da82451f":"Gereksiz verileri kald\u0131r\u0131p sadece zaman damgas\u0131 ve \u00fcr\u00fcn idlere g\u00f6re sat\u0131\u015f say\u0131lar\u0131n\u0131 b\u0131rak\u0131yoruz.\nArd\u0131ndan kerasta kullanmak i\u00e7in pivot tablosu olu\u015fturuca\u011f\u0131z.","ace80b83":"Verilerle i\u015flem yapmak i\u00e7in numpy ve sonraki ad\u0131mlarda kullanaca\u011f\u0131m\u0131z grafikleri g\u00f6rmek i\u00e7in matplot k\u00fct\u00fcphanesini y\u00fckl\u00fcyoruz.\nArd\u0131ndan son 3 y\u0131ldaki aylara g\u00f6re \u00fcr\u00fcn sat\u0131\u015flar\u0131n\u0131 g\u00f6r\u00fcnt\u00fcl\u00fcyoruz.","2b81fe3b":"\u0130lk 100 \u00fcr\u00fcn\u00fc \u00f6rnek olarak yazd\u0131rd\u0131k ve istersek tahminleme.csv dosyam\u0131zdan b\u00fct\u00fcn \u00fcr\u00fcn sat\u0131\u015f verilerine ula\u015fabiliriz.","8f4719be":"Daha sonra t\u00fcm \u00fcr\u00fcnlerin ortalama(mean fonksiyonu) olarak son 3 y\u0131ldaki fiyat de\u011fi\u015fimlerini g\u00f6r\u00fcnt\u00fcl\u00fcyoruz.","179ad042":"S\u0131rada \u00f6nceki 3 y\u0131l\u0131 birle\u015ftirip zamana g\u00f6re sat\u0131\u015f trendini belirlemek var.","27d0ceed":"Veriyi i\u015flemek i\u00e7in \u00f6nce bir ka\u00e7 farkl\u0131 deneme yapt\u0131k fakat s\u0131ral\u0131 modelde karar k\u0131ld\u0131k.\n\nSequential(s\u0131ral\u0131)model, her katman\u0131n tam olarak bir giri\u015f tens\u00f6r\u00fc ve bir \u00e7\u0131k\u0131\u015f tens\u00f6r\u00fcne sahip oldu\u011fu d\u00fcz bir katman y\u0131\u011f\u0131n\u0131 i\u00e7in uygundur. \nBizimde sadece fiyat ve \u00fcr\u00fcn say\u0131s\u0131 de\u011fi\u015fkenlerimiz oldu\u011fu i\u00e7in bunu se\u00e7tik.\nLSTM, dropout ve dense de\u011ferlerini belirleyip, matrisi \u015fekillendirince elimizde ka\u00e7 farkl\u0131 parametre oldu\u011funu g\u00f6r\u00fcyoruz.\n\nLTSM=K\u0131sa-Uzun s\u00fcreli haf\u0131za     \nDENSE=Katman yo\u011funlu\u011fu\nDROPOUT=Seyreltme katman\u0131","41d817ad":"DROPOUT = A\u015f\u0131r\u0131 \u00f6\u011frenmeyi(overfitting) engellemek i\u00e7in baz\u0131 n\u00f6ronlar\u0131 unutmak kullan\u0131lan\u0131l\u0131r.","389b6853":"LTSM = Yapay sinir a\u011flar\u0131 e\u011fitiminde giri\u015f verileriyle \u00e7\u0131k\u0131\u015f de\u011ferleri hesaplan\u0131r. Hesaplanm\u0131\u015f \u00e7\u0131k\u0131\u015f de\u011ferleri ile ger\u00e7ek de\u011ferler kar\u015f\u0131la\u015ft\u0131r\u0131l\u0131r ve farkl\u0131l\u0131k bize bir  meyil  - gradient - Bu meyile g\u00f6re geriye do\u011fru a\u011f a\u011f\u0131rl\u0131k de\u011ferlerinde g\u00fcncelleme yap\u0131l\u0131r. A\u011f\u0131m\u0131z \u00e7ok karma\u015f\u0131ksa geriye do\u011fru meyil de\u011ferleri s\u0131f\u0131rlan\u0131r. Meyil olmazsada g\u00fcncelleme olmaz ve e\u011fitilmeside durmu\u015f olur. RNN yap\u0131s\u0131nda da zaman i\u00e7inde geriye do\u011fru ba\u011fl\u0131l\u0131k var. A\u011f\u0131m\u0131z\u0131 e\u011fitim a\u00e7\u0131s\u0131nda \u00e7ok karma\u015f\u0131k hale getiriryor.Bu problemin \u00e7\u00f6z\u00fcm\u00fc i\u00e7in LSTM - Long short-term memory - denen bir yap\u0131 kurulmu\u015f.","b367e73a":"\u00d6nce pandas k\u00fct\u00fcphanesi ve veritaban\u0131n\u0131 import ediyoruz.","f7967d79":"DENSE = Ekledi\u011fimiz katman Keras\u2019\u0131n Dense layer tipinde. Bu \u201cfully connected layer\u201d(tamamen ba\u011fl\u0131 katman) olarak da biliniyor.\nYani bu katman\u0131n b\u00fct\u00fcn giri\u015fleri ve b\u00fct\u00fcn \u00e7\u0131k\u0131\u015flar\u0131 birbirine ba\u011fl\u0131 ve her birinin ayr\u0131 bir a\u011f\u0131rl\u0131\u011f\u0131(weight) var."}}