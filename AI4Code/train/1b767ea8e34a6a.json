{"cell_type":{"202bf28c":"code","104ee4a3":"code","888c3dad":"code","a6c2a9a9":"code","237b3674":"code","467fc58e":"code","b6f4cabc":"code","ae9a61d0":"code","ba649806":"code","b546ee97":"code","fac277a0":"code","649de94c":"code","a1f78e74":"code","594ce58a":"code","4c6b1d77":"code","b5bb6f8f":"code","4a44b3aa":"code","1af327e8":"code","d3237bbb":"code","af47237a":"code","832fd3cb":"code","e8e07696":"markdown","3cd4fd70":"markdown","025b16f8":"markdown","2f01f7cc":"markdown","3dc7a265":"markdown","776cc710":"markdown","710df018":"markdown","a69c3513":"markdown","fdc19da0":"markdown","bd3de98b":"markdown","e3d1721f":"markdown","b821306a":"markdown","8a562258":"markdown","4fd01d19":"markdown","4222b2f6":"markdown","65e9d1fa":"markdown","3297d05e":"markdown","382ff8c7":"markdown","f5f06b44":"markdown"},"source":{"202bf28c":"from random import randint\nimport os\nimport numpy as np \nimport pandas as pd\nimport cv2\n\nimport matplotlib.pyplot as plot\nimport matplotlib.gridspec as gridspec\nimport seaborn as sns\n\nfrom IPython.display import SVG\n\nfrom sklearn.utils import shuffle\nfrom sklearn.preprocessing import MaxAbsScaler\n\nimport keras\nimport tensorflow.keras.layers as Layers\nimport tensorflow.keras.activations as Actications\nimport tensorflow.keras.models as Models\nimport tensorflow.keras.optimizers as Optimizer\nimport tensorflow.keras.metrics as Metrics\nimport tensorflow.keras.utils as Utils\nfrom keras.utils.vis_utils import model_to_dot\n\nfrom sklearn.model_selection import train_test_split","104ee4a3":"image_size = (128, 128)","888c3dad":"train_images_labels = []\n\ndef get_images(directory, type_id):\n    Images = []\n    for dirname, _, filenames in os.walk(directory):\n        current, total = 0, len(filenames)\n        print(dirname)\n        for filename in sorted(filenames):\n            image = cv2.imread(os.path.join(dirname, filename))\n            image = cv2.resize(image,image_size)\n            if image.all() == None:\n                continue\n            Images.append(image)\n            train_images_labels.append(type_id)\n            current += 1\n            if current % (int(total \/ 10)) == 0:\n                print(round(current\/total * 100) , \"%\")\n       \n    return Images ","a6c2a9a9":"cervical_train_images = get_images('..\/input\/224-224-cervical-cancer-screening\/kaggle\/train\/train', 1)\ncervical_train_images.extend(get_images('..\/input\/224-224-cervical-cancer-screening\/kaggle\/additional_Type_1_v2', 1))\ncervical_train_images.extend(get_images('..\/input\/224-224-cervical-cancer-screening\/kaggle\/additional_Type_2_v2', 1))\ncervical_train_images.extend(get_images('..\/input\/224-224-cervical-cancer-screening\/kaggle\/additional_Type_3_v2', 1))\n\nprint('Cervical images: ', len(cervical_train_images))","237b3674":"f,ax = plot.subplots(5,5) \nf.subplots_adjust(0,0,3,3)\nfor i in range(0,5,1):\n    for j in range(0,5,1):\n        rnd_number = randint(0,len(cervical_train_images))\n        image = cervical_train_images[rnd_number]\n        ax[i,j].imshow(image)\n        ax[i,j].axis('off')","467fc58e":"other_train_images =  get_images('..\/input\/natural-images', 0)\n\nprint('Not Cervical images: ', len(other_train_images))","b6f4cabc":"f,ax = plot.subplots(5,5) \nf.subplots_adjust(0,0,3,3)\nfor i in range(0,5,1):\n    for j in range(0,5,1):\n        rnd_number = randint(0,len(other_train_images))\n        image = other_train_images[rnd_number]\n        ax[i,j].imshow(image)\n        ax[i,j].axis('off')","ae9a61d0":"train_images = cervical_train_images + other_train_images\n\nprint('Total train images: ', len(train_images))\nprint('Total train ids: ', len(train_images_labels))","ba649806":"def choose_label(id):\n    if id == 1:\n        return \"True\"\n    else: \n        return \"False\"\n\nf,ax = plot.subplots(5,5) \nf.subplots_adjust(0,0,3,3)\nfor i in range(0,5,1):\n    for j in range(0,5,1):\n        rnd_number = randint(0,len(train_images))\n        image = train_images[rnd_number]\n        type_id = train_images_labels[rnd_number]\n        ax[i,j].imshow(image)\n        ax[i,j].set_title(choose_label(type_id))\n        ax[i,j].axis('off')","b546ee97":"x_train, x_test, y_train, y_test = train_test_split(train_images, train_images_labels, test_size=0.25, random_state=17)\n\nx_train = np.array(x_train) \nx_test = np.array(x_test)\n\ny_train = np.array(y_train) \ny_train = keras.utils.to_categorical(y_train)\n\ny_test = np.array(y_test)\ny_test = keras.utils.to_categorical(y_test)\n\nprint(\"Shape of train images:\",x_train.shape)\nprint(\"Shape of train labels:\",y_train.shape)\n\nprint(\"Shape of test images:\",x_test.shape)\nprint(\"Shape of test labels:\",y_test.shape)","fac277a0":"from keras.models import Model\nfrom keras.models import Sequential\nfrom keras.layers import Input, Activation, merge, Dense, Flatten\nfrom keras.layers import Conv2D, MaxPooling2D, AveragePooling2D\n\nfrom keras.layers import Dense, Dropout, Activation, Flatten\nfrom keras.layers.normalization import BatchNormalization\nfrom keras import optimizers","649de94c":"conf = dict()\n\nconf['num_classes'] = 2\nconf['num_channels'] = 3\nconf['num_epochs'] = 2\nconf['batch_size'] = 64\nconf['validation_split'] = 0.35\nconf['num_workers'] = 8\nconf['image_shape'] = (128, 128)\nconf['pooling_strategy'] = MaxPooling2D","a1f78e74":"def create_model(conf):\n    \n    num_channels = conf['num_channels']\n    num_classes = conf['num_classes']\n    img_rows, img_cols = conf['image_shape']\n    PoolingStrategy = conf['pooling_strategy']\n    \n    model = Sequential()\n    model.add(Conv2D(32, (3, 3), padding='valid',input_shape=(img_rows, img_cols, num_channels)))\n    model.add(Activation('relu'))\n    model.add(Conv2D(32, (3, 3))) \n    model.add(Activation('relu'))\n    model.add(PoolingStrategy(pool_size=(2, 2)))\n    model.add(Dropout(0.25))\n    model.add(Activation('relu'))\n    model.add(Flatten())\n    model.add(BatchNormalization())\n    model.add(Dense(512))\n    model.add(Activation('relu'))\n    model.add(Dropout(0.5))\n    model.add(Dense(num_classes))\n    model.add(Activation('softmax'))\n\n    adam = optimizers.Adam(lr=0.0001, decay=1e-6)\n\n    model.compile(loss='categorical_crossentropy',\n                  optimizer=adam,\n                  metrics=['accuracy'])\n\n    return model\n\nmodel = create_model(conf)\nmodel.summary()\nSVG(model_to_dot(model).create(prog='dot', format='svg'))\nUtils.plot_model(model,to_file='model.png',show_shapes=True)","594ce58a":"training_history = model.fit(x = x_train,\n                             y = y_train, \n                             validation_split=conf['validation_split'],  \n                             batch_size=conf['batch_size'], \n                             epochs = conf['num_epochs'], \n                             workers =  conf['num_workers'], use_multiprocessing=True)","4c6b1d77":"training_history.history.keys()","b5bb6f8f":"pd.DataFrame(training_history.history['accuracy']).plot()","4a44b3aa":"pd.DataFrame(training_history.history['val_accuracy']).plot()","1af327e8":"pd.DataFrame(training_history.history['loss']).plot()","d3237bbb":"pd.DataFrame(training_history.history['val_loss']).plot()","af47237a":"loss, accuracy = model.evaluate(x_test, y_test)\n\nprint(f\"Accuracy for test: {accuracy}\")\nprint(f\"Loss for test: {loss}\")","832fd3cb":"model_name = 'model-0.98'\n\nmodel_json = model.to_json()\nwith open(model_name + \"json\", \"w\") as json_file:\n    json_file.write(model_json)\nmodel.save_weights(model_name + \".h5\")","e8e07696":"**Define Model Arhitecture**","3cd4fd70":"# PART 2 - Transform Data For Training\n**Split Data Into Two Separate Parts For Training And Testing**","025b16f8":"**Save The Model**","2f01f7cc":"**Check Accuracy And Loss On Testing Data**","3dc7a265":"**Load The Other Images**","776cc710":"# PART 1 - Data Sets","710df018":"# PART 0 - Preparing\n**Import Libaries**","a69c3513":"**Show NOT Train Cervical Cancer Samples**","fdc19da0":"**Combine Data Sets**","bd3de98b":"**List All Data in History**","e3d1721f":"**Helper Function For Image Extraction**","b821306a":"**Show Train Cervical Cancer Samples**","8a562258":"**Load Cervical Cancer Images**","4fd01d19":"# PART 4 - Model Training And Testing\n**Training The Model**","4222b2f6":"**View History Of Training**","65e9d1fa":"# Intel & MobileODT Cervical Cancer Screening Project\n\n**Which cancer treatment will be most effective?**\n\n**Author: Andrii Kobyliuk**","3297d05e":"**Config declarations**","382ff8c7":"**Import Libaries**","f5f06b44":"# PART 3 - Model Building\n"}}