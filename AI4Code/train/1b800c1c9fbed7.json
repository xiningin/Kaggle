{"cell_type":{"7e4e49d0":"code","126040b0":"code","da840872":"code","4e8398fa":"code","c0a2f027":"code","80495d0d":"code","e7fcdc4c":"code","85449f68":"code","4439660e":"code","97a67bd6":"code","072db31b":"code","921e50c5":"code","1586ea26":"code","bd3f5544":"code","af70d51b":"markdown","37bae22d":"markdown","fa2a6ff9":"markdown","d23e1d40":"markdown"},"source":{"7e4e49d0":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport tensorflow as tf\nfrom tqdm.auto import tqdm\n\nsns.set_style('darkgrid')","126040b0":"train = pd.read_csv('..\/input\/plant-pathology-2021-fgvc8\/train.csv')\nprint(train.shape)\ntrain.head()","da840872":"from sklearn.preprocessing import MultiLabelBinarizer\n\nmlb = MultiLabelBinarizer().fit(train.labels.apply(lambda x: x.split()))\nlabels = pd.DataFrame(mlb.transform(train.labels.apply(lambda x: x.split())), columns=mlb.classes_)\n\nfig, ax = plt.subplots(figsize=(20, 6))\nlabels.sum().plot.bar(title='Target Class Distribution');","4e8398fa":"fig, ax = plt.subplots(figsize=(20, 6))\nlabels.sum(axis=1).value_counts().plot.bar(title='Distribution of Number of Labels per Image');","c0a2f027":"fig, ax = plt.subplots(3, 4, figsize=(20, 10))\nfor i, img in enumerate(train.groupby('labels').first().reset_index().values):\n    ax[i\/\/4][i%4].imshow(plt.imread(f\"..\/input\/plant-pathology-2021-fgvc8\/train_images\/{img[1]}\"))\n    ax[i\/\/4][i%4].set_title(img[0])\n    ax[i\/\/4][i%4].axis('off')\nfig.suptitle('Image Samples', fontsize=18); ","80495d0d":"labels = pd.concat([train['image'], labels], axis=1).drop('healthy', axis=1)\nlabels.head()","e7fcdc4c":"batch_size=128\nimage_data_generator = tf.keras.preprocessing.image.ImageDataGenerator(rescale=1.\/255, validation_split=0.1)\n\ntrain_generator = image_data_generator.flow_from_dataframe(\n    dataframe=labels,\n    directory='..\/input\/plant-pathology-2021-fgvc8\/train_images',\n    x_col='image',\n    y_col=labels.columns.tolist()[1:],\n    class_mode='raw',\n    color_mode=\"rgb\",\n    target_size=(224, 224),\n    batch_size=batch_size,\n    subset='training'\n)\n\nvalid_generator = image_data_generator.flow_from_dataframe(\n    dataframe=labels,\n    directory='..\/input\/plant-pathology-2021-fgvc8\/train_images',\n    x_col='image',\n    y_col=labels.columns.tolist()[1:],\n    class_mode='raw',\n    color_mode=\"rgb\",\n    target_size=(224, 224),\n    batch_size=batch_size,\n    subset='validation'\n)","85449f68":"inputs = tf.keras.Input(shape=(224, 224, 3))\nx = tf.keras.applications.InceptionV3(include_top=False)(inputs)\nx = tf.keras.layers.GlobalAveragePooling2D()(x)\noutputs = tf.keras.layers.Dense(5, activation='sigmoid')(x)\n\nmodel = tf.keras.models.Model(inputs, outputs)\nmodel.compile(loss='binary_crossentropy', optimizer=tf.keras.optimizers.Adam(lr=1e-4))\n\nmodel.summary()\ntf.keras.utils.plot_model(model, show_shapes=True)","4439660e":"rlp = tf.keras.callbacks.ReduceLROnPlateau(monitor='val_loss', patience=1, verbose=1, factor=0.01)\nes = tf.keras.callbacks.EarlyStopping(monitor='val_loss', patience=3, verbose=1, restore_best_weights=True)\n\nhistory = model.fit(train_generator, validation_data=valid_generator, epochs=10, callbacks=[rlp, es])","97a67bd6":"fix, ax = plt.subplots(figsize=(20, 6))\npd.DataFrame(history.history)[['loss', 'val_loss']].plot(ax=ax, title='Model Loss Curve')","072db31b":"model.save('InceptionV3.h5')","921e50c5":"submissions = pd.read_csv('..\/input\/plant-pathology-2021-fgvc8\/sample_submission.csv')\nsubmissions.head()","1586ea26":"test_data_generator = tf.keras.preprocessing.image.ImageDataGenerator(rescale=1.\/255)\n\ntest_generator = test_data_generator.flow_from_dataframe(\n    submissions,\n    directory = '..\/input\/plant-pathology-2021-fgvc8\/test_images',\n    x_col=\"image\",\n    y_col=None,\n    target_size=(224, 224),\n    color_mode=\"rgb\",\n    classes=None,\n    class_mode=None,\n    shuffle=False,\n    batch_size=1\n)\n\npredictions = model.predict(test_generator,steps=len(test_generator.filenames))","bd3f5544":"thresh = 0.5\nfor i in range(3):\n    pred = ' '.join(labels.columns[1:][predictions[i] >= thresh])\n    pred = 'healthy' if pred == '' else pred\n    submissions.iloc[i, 1] = pred\n    \nsubmissions.to_csv('submission.csv', index=False)    ","af70d51b":"# Submission","37bae22d":"# Modelling","fa2a6ff9":"# Dataset Exploration","d23e1d40":"# Preprocessing and Augmentation"}}