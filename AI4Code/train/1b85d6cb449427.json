{"cell_type":{"3cd026ce":"code","35a27937":"code","48e55251":"code","3f9df4bd":"code","95b873e3":"code","a175c331":"code","537651f6":"code","b5b7fd05":"code","4bcfed83":"code","c692b669":"code","1e9cbd99":"code","2de7fd11":"code","ab0aa01a":"code","6ffde36c":"code","4227ac98":"code","3656d7a3":"code","8e21ab5a":"code","d07fcae9":"code","90d4f8ea":"code","49abad42":"code","d3907a5d":"code","4674347f":"code","67d39a98":"code","f0ad9b99":"code","a4b3a5ee":"code","d5dfe93c":"code","bc420b77":"code","e3824129":"code","d8b8818c":"code","38524b1b":"code","996d8d43":"code","8909df9c":"code","073fdd26":"code","375883ea":"code","9282f477":"code","74d5910b":"code","11f1de69":"code","4481c751":"code","fe3f69bc":"code","080436b9":"code","f8e91d9b":"code","8764fa19":"code","6ded39a0":"code","378f6ba5":"code","9b828a0c":"code","0c69d38c":"code","35f25ce6":"code","e3417a6a":"code","659ff542":"code","3f4c0db4":"code","0d01e062":"code","aaabc92b":"code","e228b913":"code","31c8ac07":"code","80a14a91":"code","856f94cb":"code","fcd5626c":"code","d08ff693":"code","555734ee":"code","1b29d869":"code","843b5490":"code","bded2808":"code","f0709607":"code","c839f792":"code","870e2792":"code","0f88b317":"code","96c1aea5":"code","ecd7d5c4":"code","d5cef395":"code","8279e984":"code","636d9376":"code","05809295":"code","a6a16dee":"code","9aad3ae5":"code","754cbe61":"code","a7efa862":"code","0d3fa5ea":"code","70fb0a22":"code","0c03e33e":"code","afbc17f0":"code","d1ed3e0c":"code","14f63ffb":"code","9f81ada4":"code","14ebbc68":"code","863fb2f3":"code","2544787e":"code","c7e778ef":"code","b05721c0":"code","30c8a0ba":"code","2f178935":"code","d87267e5":"code","d26c0ce1":"code","4eb4b3a8":"markdown","560604ce":"markdown","df1aab67":"markdown","8677ccc9":"markdown","ef30a260":"markdown","190be306":"markdown","64ccc9b4":"markdown","2cf690c7":"markdown","191d522e":"markdown","1fba5cee":"markdown","1476659c":"markdown","203e80f9":"markdown","06cc02c7":"markdown","6fd6c01f":"markdown","cd54e29c":"markdown","99d833fe":"markdown","975a19d5":"markdown","28276690":"markdown","b1a989a9":"markdown","a9328786":"markdown","0735a46b":"markdown","863f8cfc":"markdown","b5a2c668":"markdown","b424491d":"markdown","32e0a014":"markdown","af6f1e32":"markdown","ed75d481":"markdown","975ae9fd":"markdown","63813c11":"markdown","1299297a":"markdown","6b692cb1":"markdown","fd360089":"markdown","bdce65d8":"markdown","7eda4ca8":"markdown","f28a84e7":"markdown","76aa3c46":"markdown","ff74eb34":"markdown","e9d2b5e4":"markdown","4cedbec7":"markdown","0ddbed0f":"markdown","6ba3bd80":"markdown","c4b835bf":"markdown","42827e4b":"markdown","822572a9":"markdown","9aded6cd":"markdown","07c45f78":"markdown","78b368ce":"markdown","56e5511a":"markdown","d50005ca":"markdown"},"source":{"3cd026ce":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline","35a27937":"data = pd.read_csv(\"..\/input\/lending-club-loan\/lending_club_loan_two.csv\")","48e55251":"data.head()","3f9df4bd":"data.info()","95b873e3":"plt.figure(figsize=(12,7))\nsns.set_context(\"paper\")\nsns.countplot(x=\"loan_status\", data=data, palette=\"Spectral\")","a175c331":"plt.figure(figsize=(15,7))\nsns.set_context(\"paper\", font_scale=2)\nsns.distplot(data[\"loan_amnt\"], bins=15, kde=False, color=\"seagreen\")","537651f6":"data.corr()","b5b7fd05":"plt.figure(figsize=(15,7))\nsns.set_context(\"poster\", font_scale=0.5)\nsns.heatmap(data.corr(), annot=True, cmap=\"coolwarm\", alpha=0.6)","4bcfed83":"plt.figure(figsize=(15,7))\nsns.scatterplot(x=\"installment\", y=\"loan_amnt\", data=data, alpha=0.8, hue=\"loan_status\", palette=\"RdYlBu\" )","c692b669":"plt.figure(figsize=(15,7))\nsns.boxplot(x=\"loan_status\", y=\"loan_amnt\", data=data, palette=\"plasma\")","1e9cbd99":"data.groupby(\"loan_status\")[\"loan_amnt\"].describe()","2de7fd11":"data[\"grade\"].value_counts()","ab0aa01a":"plt.figure(figsize=(15,7))\nsns.set_context(\"paper\", font_scale=2)\nsns.countplot(x=\"grade\", data=data, hue=\"loan_status\", color=\"seagreen\")","6ffde36c":"plt.figure(figsize=(15,7))\nsns.set_context(\"paper\", font_scale=2)\nsorted_grade = sorted(data[\"grade\"].unique())\nsns.countplot(x=\"grade\", data=data, hue=\"loan_status\", color=\"seagreen\", order=sorted_grade)","4227ac98":"data[\"loan_status\"].value_counts()","3656d7a3":"data[\"loan_repaid\"] = data[\"loan_status\"].map({\"Fully Paid\":1, \"Charged Off\":0})","8e21ab5a":"data[[\"loan_repaid\", \"loan_status\"]]","d07fcae9":"plt.figure(figsize=(15,7))\ndata.corr()[\"loan_repaid\"].sort_values().drop(\"loan_repaid\").plot(kind=\"bar\", color=\"seagreen\", alpha=0.6)","90d4f8ea":"data.isnull().sum()","49abad42":"data.isnull().sum() \/ len(data) * 100","d3907a5d":"data[\"emp_title\"].nunique()","4674347f":"data[\"emp_title\"].value_counts()","67d39a98":"data = data.drop(\"emp_title\", axis=1)","f0ad9b99":"sorted(data[\"emp_length\"].dropna().unique())","a4b3a5ee":"sorted_emp_length = ['< 1 year',\n '1 year',\n '2 years',\n '3 years',\n '4 years',\n '5 years',\n '6 years',\n '7 years',\n '8 years',\n '9 years',\n '10+ years']","d5dfe93c":"plt.figure(figsize=(16,7))\nsns.set_context(\"paper\", font_scale=1.5)\nsns.countplot(x=\"emp_length\", data=data, hue=\"loan_status\", order=sorted_emp_length, palette=\"coolwarm\")","bc420b77":"emp_co = data[data[\"loan_status\"] == \"Charged Off\"].groupby(\"emp_length\").count()[\"loan_status\"]\nemp_fp = data[data[\"loan_status\"] == \"Fully Paid\"].groupby(\"emp_length\").count()[\"loan_status\"]","e3824129":"emp_length_graph = emp_co\/(emp_co+emp_fp)","d8b8818c":"emp_length_graph.plot(kind=\"bar\")","38524b1b":"data = data.drop(\"emp_length\", axis=1)","996d8d43":"data.isnull().sum()","8909df9c":"data[\"purpose\"].value_counts()","073fdd26":"plt.figure(figsize=(18,7))\nsns.set_context(\"paper\", font_scale=1)\nsns.countplot(x=\"purpose\", data=data, hue=\"loan_status\", palette=\"seismic\")","375883ea":"data[\"title\"].value_counts()","9282f477":"data = data.drop(\"title\", axis=1)","74d5910b":"data[\"mort_acc\"].value_counts()","11f1de69":"data.corr()[\"mort_acc\"].sort_values()","4481c751":"total_acc_avg = data.groupby(\"total_acc\").mean()[\"mort_acc\"]","fe3f69bc":"def fill_in_mort_acc(total_acc, mort_acc):\n    \n    if np.isnan(mort_acc):\n        return total_acc_avg[total_acc]\n    else:\n        return(mort_acc)","080436b9":"data[\"mort_acc\"] = data.apply(lambda x: fill_in_mort_acc(x[\"total_acc\"], x[\"mort_acc\"]), axis=1)","f8e91d9b":"data.isnull().sum()","8764fa19":"data = data.dropna()","6ded39a0":"data.isnull().sum()","378f6ba5":"data.dtypes","9b828a0c":"data.select_dtypes([\"object\"]).columns","0c69d38c":"data[\"term\"].value_counts()","35f25ce6":"data[\"term\"] = data[\"term\"].apply(lambda term: int(term[:3]))","e3417a6a":"data[\"term\"].value_counts()","659ff542":"data = data.drop(\"grade\", axis=1)","3f4c0db4":"dummy = pd.get_dummies(data[\"sub_grade\"], drop_first=True)","0d01e062":"data = pd.concat([data.drop(\"sub_grade\", axis=1), dummy], axis=1)","aaabc92b":"data.head()","e228b913":"data[\"verification_status\"].value_counts()","31c8ac07":"data[\"application_type\"].value_counts()","80a14a91":"data[\"initial_list_status\"].value_counts()","856f94cb":"dummy = pd.get_dummies(data[[\"verification_status\", \"application_type\", \"initial_list_status\", \"purpose\"]], drop_first=True)\ndata = pd.concat([data.drop([\"verification_status\", \"application_type\", \"initial_list_status\", \"purpose\"], axis=1), dummy], axis=1)","fcd5626c":"data.head()","d08ff693":"data[\"home_ownership\"].value_counts()","555734ee":"data[\"home_ownership\"] = data[\"home_ownership\"].replace([\"NONE\", \"ANY\"], \"OTHER\")","1b29d869":"data[\"home_ownership\"].value_counts()","843b5490":"dummy = pd.get_dummies(data[\"home_ownership\"], drop_first=True)\ndata = pd.concat([data.drop(\"home_ownership\", axis=1), dummy], axis=1)","bded2808":"data.head()","f0709607":"data.select_dtypes(\"object\").columns","c839f792":"data[\"address\"].value_counts()","870e2792":"data[\"zip_code\"] = data[\"address\"].apply(lambda address: address[-5:])","0f88b317":"data[\"zip_code\"].value_counts()","96c1aea5":"dummy = pd.get_dummies(data[\"zip_code\"], drop_first=True)\ndata = pd.concat([data.drop(\"zip_code\", axis=1), dummy], axis=1)","ecd7d5c4":"data.head()","d5cef395":"data = data.drop(\"address\", axis=1)","8279e984":"data = data.drop(\"issue_d\", axis=1)","636d9376":"data[\"earliest_cr_line\"].value_counts()","05809295":"data[\"earliest_cr_line\"] = data[\"earliest_cr_line\"].apply(lambda year: int(year[-4:]))","a6a16dee":"data[\"earliest_cr_line\"].value_counts()","9aad3ae5":"data.select_dtypes(\"object\").columns","754cbe61":"data = data.drop(\"loan_status\", axis=1)","a7efa862":"data.head(3)","0d3fa5ea":"from sklearn.model_selection import train_test_split","70fb0a22":"X = data.drop(\"loan_repaid\", axis=1).values\ny = data[\"loan_repaid\"].values","0c03e33e":"X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)","afbc17f0":"from sklearn.preprocessing import MinMaxScaler","d1ed3e0c":"scaler = MinMaxScaler()","14f63ffb":"X_train = scaler.fit_transform(X_train)","9f81ada4":"X_test = scaler.transform(X_test)","14ebbc68":"import tensorflow as tf\nfrom tensorflow.keras.layers import Dense, Dropout\nfrom tensorflow.keras.models import Sequential","863fb2f3":"X_train.shape","2544787e":"model = Sequential()\n\nmodel.add(Dense(78, activation=\"relu\"))\nmodel.add(Dropout(0.2))\n\nmodel.add(Dense(39, activation=\"relu\"))\nmodel.add(Dropout(0.2))\n\nmodel.add(Dense(19, activation=\"relu\"))\nmodel.add(Dropout(0.2))\n\nmodel.add(Dense(1, activation=\"sigmoid\"))\n\nmodel.compile(loss=\"binary_crossentropy\", optimizer=\"adam\")","c7e778ef":"model.fit(X_train, y_train, epochs=25, batch_size=256, validation_data=(X_test, y_test))","b05721c0":"losses = pd.DataFrame(model.history.history)","30c8a0ba":"losses.plot()","2f178935":"from sklearn.metrics import classification_report, confusion_matrix","d87267e5":"prediction = model.predict_classes(X_test)","d26c0ce1":"print(classification_report(y_test, prediction))\nprint(confusion_matrix(y_test, prediction))","4eb4b3a8":"### Visualizing the loan purpose feature. It is apparent that top reason to borrow loans from Lending Club is debt consolidation as provided by borrowers. This is matches with common perception that people often attempt to pay off high interest rate credit card accounts with unsecured personal loan.","560604ce":"### Since sub-grade provides more information than grade, this featue will be dropped. ","df1aab67":"### Diving in the feature \"grade\", presumably the level of worthiness of the borrowers. ","8677ccc9":"### Visualizing the number of charged off and total borrowers in percentage in each intervals of employment length. They are relatively the same across the board shown in the graph below.","ef30a260":"#### Recalling the dataset has ~310000 observations and 78 features. ","190be306":"## Supervised machine learning algorithm using Lending Club dataset.","64ccc9b4":"#### Recalling that we have converted \"fully paid\" and \"charged off\" with binary digits, it is safe to just drop the original feature. ","2cf690c7":"### Recalling that mortage account feature has ~38000 missing values. This is pretty significant as dropping this feature will significantly reduce the size of the dataset. It is probably a good idea to replace the missing values with some other values. After checking out the correlation of mortageg with other features, it is noted that total account has the highest correlation with mortgage account. it is not surprising that people have more mortgages when they have more accounts. ","191d522e":"### Noted that there is only a slight difference in full paid and charged off on loan amount. ","1fba5cee":"# Project Objective: \n### To develop a supervised machine learning model to identify which borrowers will payoff their loans. The project implications can be beneficial to the financial institute in risk assessments, whether the prospective borrower would default or payoff the loan. Strategy for loan approval and profitable target market can be identified. Ultimately, this model serves as the blueprint to decrease bussiness risks and increase profitability of the organization.","1476659c":"### Importing libraries","203e80f9":"### Descriptive analysis and correlation of features. ","06cc02c7":"#### Noted that the newly engineered feature of ZIP has only a few unique counts so it is feasible to keep this feature. Getting dummy data on this feature. ","6fd6c01f":"#### Loss function graph to see the performance of the deep neural network model. Noted that the loss funtion decreased sharply at the beginning, which is desirable, then trending down slowly below the validation loss. ","cd54e29c":"### Replacing the missing values with lambda function. ","99d833fe":"### Visualizing the distribution of loan amount borrowed.","975a19d5":"## Noted that the recall value is 100% on 1s and precision at 98% on 0s. This model did not do so well in recall on 0s, only at 44%, which is pretty significant. The f1-score on 1 is 94%, which is pretty good. Overall, the prediction against the true positive is 90%, which is pretty good IMO. The overall accuracy yields 89%, which is much better than a random guess. The deep neural network algorithm can be further optimized using Earlystopping and dropout. ","28276690":"#### The target feature or y-variable is \"loan repaid\" (yes = 1; no = 0). ","b1a989a9":"### Grabbing the numeric values \"36\" and \"60\".","a9328786":"#### Address has no values in our machine learning model but the ZIP code may have some sort of influence in the outcome. Grabbing the ZIP code from the address. ","0735a46b":"### Dealing with non-numeric type of data","863f8cfc":"### The employment length feature does not really help us to distinguish borrowers who payoff or default. Will just drop. ","b5a2c668":"#### The feature \"Earliest credit line\" may be a key factor as it provides some sort of a time series information. Grabbing the year as our tim series feature. ","b424491d":"# Predictive Model: Deep Neural Network\n### Real life dataset by one of the financial powerhouses, Lending Club. Supervised machine learning deep neural network will be used to perform binary classification. In this project, the target feature or y-variable will be \"Loan Status\".  ","32e0a014":"##### Four more features with object as data type to deal with.","af6f1e32":"### Visualizing the relationship between installment and loan amount.","ed75d481":"### Evalution of the supervised machine learning deep neural network performance. ","975ae9fd":"### Decided to replace missing values in mortgage account with the mean value based on the total account. ","63813c11":"#### Setting epochs as 25, which is also an arbitrary number; the batch size is set at 256 (64-bit ~ personal preference).","1299297a":"### Noted that loan amount and interest rate has high correlation,, which is expected. Total account & open account also has high correlation. Lastly, public record and bankcruptcies, which also makes sense. ","6b692cb1":"#### Setting \"rectified linear unit\" as the activation function in neural network as this is a commonly used activation. Dense will be set at 78, which is an arbitrary number, as the first layer, then followed by half of it and so forth. On the final layer of the neural network, the \"sigmoid\" is used as the activation function, which is sorta similar to logistic regression. For loss function, the binary cross entropy will be used since this is a binary classification model. Optimizer is set as Adam is this is the most commonly used. ","fd360089":"### Visualizing the relationship between the grade and loan status. As expected, borrowers tend to have a higher charged off in lower grade categories. This shows that the grade can potentially be a good indicator if the borrower has the ability to payoff or default.  ","bdce65d8":"### Preparation is complete. Importing deep neural network libraries. ","7eda4ca8":"### Visualizing in a sorted order of grade gives a better understanding of the impact of grade in loan status. The lower the grade, the higher the ratio in fully paid to charged off.","f28a84e7":"# Process:\n### This project will start off with exploratory data analysis, data visualization, feature-engineering, and preparing the dataset for machine learning. The end result the accuracy of the model to predict payoff or default loan. ","76aa3c46":"# Description:\n### While staring into the future through a crytal ball is a myth, technology can help investors to seek true sight in their investment prospects. It is the financial institutes' dream to grasp the untapped knowledge what is the return on investment in a given project. This is an interesting project to uncover the risky versus the high-profitable loan borrowers in the ocean of dataset. ","ff74eb34":"### Visualizing the correlation between \"loan repaid\" and other features. Noted that interest rate has relatively high correlation compared to the rest. This is expected as the higher the interest rate, the harder it is to pay off a loan.","e9d2b5e4":"### Visualizing the employment length feature. It appears that most of the borrowers have >10yrs employment length, meaning most of the borrowers are middle-aged adults and\/or matured instead of young adults. ","4cedbec7":"#### Scalar is used when preparing the dataset for deep learning so the data will have a more meaningful relationship among features. This can enable the machine to learn the data better. ","0ddbed0f":"### Preparing the data with binary classification (dummy data).","6ba3bd80":"### Trainning data will be set at 80% of the dataset and test size is 20%. Random state will be set at 42, which is arbitrary - I heard 42 is THE number of universe, life, and everything :)","c4b835bf":"#### Data cleansing process and feature-engineering complete. The dataset now has 79 features. Now preparing for training data and test data. ","42827e4b":"### Finding out the current standing of our missing values. Since the remaining 2 features have very low missing values, decided to just drop those missing values as it is more time-saving. ","822572a9":"### It appears that the feature \"title\" provides the same information as loan purpose. Will drop this feature. ","9aded6cd":"### The employment title feature has >170000 unique values. It is not feasible to keep them as a feature to be used in our machine learning model. Will just drop it. ","07c45f78":"# Finance Project: Deep Neural Network","78b368ce":"### Visualizing loan payoff vs chargeoff. ","56e5511a":"### Dealing with missing values. The number of features that have missing values is shown below. The number of missing values in each feature will determine the treatment of the feature; to drop or replace it with some other values. ","d50005ca":"### This is a large dataset, which has ~396000 observations as shown below.  Noted that they are float and object data type. "}}