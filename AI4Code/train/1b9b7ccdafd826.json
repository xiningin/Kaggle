{"cell_type":{"016f44a9":"code","5352ba79":"code","8cadb63e":"code","4c4025b4":"code","0f83aa22":"code","9f81c440":"code","d06dc53d":"code","b17663c2":"code","d7019476":"code","5196bf73":"code","c4b828ac":"code","82bbd224":"code","56570c7e":"code","273f1b45":"code","157daaff":"code","6fc81943":"markdown","c3b791fb":"markdown","adeef517":"markdown","ad1f2ea2":"markdown","f5fcd079":"markdown","b9185b4a":"markdown","50685d56":"markdown","2f8d1c38":"markdown","7dde7d63":"markdown","8535fcb5":"markdown","85eb9602":"markdown","0d0b23c6":"markdown","3092bb8e":"markdown"},"source":{"016f44a9":"!pip install -U lightautoml","5352ba79":"# Standard python libraries\nimport logging\nimport os\nimport time\nimport requests\nlogging.basicConfig(format='[%(asctime)s] (%(levelname)s): %(message)s', level=logging.INFO)\n\n# Installed libraries\nimport numpy as np\nimport pandas as pd\nfrom sklearn.metrics import mean_absolute_error\nfrom sklearn.model_selection import train_test_split\nimport torch\n\n# Imports from our package\nfrom lightautoml.automl.presets.tabular_presets import TabularAutoML, TabularUtilizedAutoML\nfrom lightautoml.tasks import Task","8cadb63e":"N_THREADS = 4 # threads cnt for lgbm and linear models\nN_FOLDS = 5 # folds cnt for AutoML\nRANDOM_STATE = 42 # fixed random state for various reasons\nTEST_SIZE = 0.2 # Test size for metric check\nTIMEOUT = 600 # Time in seconds for automl run\nTARGET_NAME = 'final_price' # Target column name","4c4025b4":"%%time\n\ntrain_data = pd.read_csv('..\/input\/lightautomlcourse-hw1\/train_data.csv')\ntrain_data.head()","0f83aa22":"test_data = pd.read_csv('..\/input\/lightautomlcourse-hw1\/test_data.csv')\ntest_data.head()","9f81c440":"submission = pd.read_csv('..\/input\/lightautomlcourse-hw1\/sample_submission.csv')\nsubmission.head()","d06dc53d":"%%time\n\ndef create_expert_feats(data):\n    pass\n\ncreate_expert_feats(train_data)\ncreate_expert_feats(test_data)","b17663c2":"train_data.head()","d7019476":"%%time\n\ntask = Task('reg', )","5196bf73":"%%time\n\nroles = {'target': TARGET_NAME,\n         'drop': ['row_ID'] # to drop or not to drop?\n         }","c4b828ac":"%%time \n\nautoml = TabularAutoML(task = task, \n                       timeout = TIMEOUT,\n                       cpu_limit = N_THREADS,\n                       reader_params = {'n_jobs': N_THREADS, 'cv': N_FOLDS, 'random_state': RANDOM_STATE},\n                      )\noof_pred = automl.fit_predict(train_data, roles = roles)\nlogging.info('oof_pred:\\n{}\\nShape = {}'.format(oof_pred, oof_pred.shape))","82bbd224":"%%time\n\n# Fast feature importances calculation\nfast_fi = automl.get_feature_scores('fast')\nfast_fi.set_index('Feature')['Importance'].plot.bar(figsize = (20, 10), grid = True)","56570c7e":"%%time\n\ntest_pred = automl.predict(test_data)\nlogging.info('Prediction for test data:\\n{}\\nShape = {}'\n              .format(test_pred, test_pred.shape))\n\nlogging.info('Check scores...')\nlogging.info('OOF score: {}'.format(mean_absolute_error(train_data[TARGET_NAME].values, oof_pred.data[:, 0])))","273f1b45":"submission[TARGET_NAME] = test_pred.data[:, 0]\nsubmission.head()","157daaff":"submission.to_csv('lightautoml_sample_submission.csv', index = False)","6fc81943":"# Step 0.4. Some user feature preparation ","c3b791fb":"Roles setup here set target column and base date, which is used to calculate date differences:","adeef517":"# ========= AutoML preset usage =========\n\n\n## Step 1. Create Task","ad1f2ea2":"# Step 0.3. Data load ","f5fcd079":"# Step 0.0. Install LightAutoML","b9185b4a":"## Step 2. Setup columns roles","50685d56":"Be creative :)","2f8d1c38":"## Step 3. Create AutoML from preset","7dde7d63":"To create AutoML model here we use `TabularAutoML` preset, which looks like:\n\n![TabularAutoML preset pipeline](https:\/\/github.com\/sberbank-ai-lab\/LightAutoML\/raw\/master\/imgs\/tutorial_2_pipeline.png)\n\nAll params we set above can be send inside preset to change its configuration:","8535fcb5":"# Step 0.1. Import necessary libraries ","85eb9602":"## Step 4. Predict to test data and check scores","0d0b23c6":"# Step 0.2. Parameters ","3092bb8e":"## Step 5. Generate submission"}}