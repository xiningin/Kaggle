{"cell_type":{"07cb25b9":"code","9e160aa0":"code","e82fb30c":"code","ca7a0fc2":"code","12dbdae4":"code","a4707696":"code","686607ac":"code","4f6a540b":"code","8b9c0763":"code","e142e9c3":"code","eb9de18f":"code","ded193b1":"code","c2b2a93f":"code","a1537e6f":"code","acd06df0":"code","b350972f":"code","cf41f607":"code","ae68676c":"code","289e10ce":"code","1bb2553c":"code","46987c2e":"code","ae86c975":"code","3bb2454b":"code","e10de1f0":"code","e10dec3c":"markdown","ba206a65":"markdown","d8256a90":"markdown","dd8392c1":"markdown","c6514d33":"markdown","023b1b8e":"markdown","c278a865":"markdown"},"source":{"07cb25b9":"!rm -rf utils.py\n!wget https:\/\/raw.githubusercontent.com\/sevenfx\/fastai_audio\/master\/notebooks\/utils.py","9e160aa0":"%matplotlib inline\nimport os\nfrom pathlib import Path\nfrom IPython.display import Audio\nimport librosa\nimport librosa.display\nimport matplotlib.pyplot as plt\nimport numpy as np\nfrom utils import read_file, transform_path","e82fb30c":"!rm -rf free-spoken-digit-dataset-master master.zip\n!wget https:\/\/github.com\/Jakobovski\/free-spoken-digit-dataset\/archive\/master.zip\n!unzip -q master.zip\n!rm -rf master.zip\n!ls","ca7a0fc2":"AUDIO_DIR = Path('free-spoken-digit-dataset-master\/recordings')\nIMG_DIR = Path('imgs')\n!mkdir {IMG_DIR} -p","12dbdae4":"fnames = os.listdir(str(AUDIO_DIR))\nlen(fnames), fnames[:5]","a4707696":"fn = fnames[94]\nprint(fn)\nAudio(str(AUDIO_DIR\/fn))","686607ac":"# ??read_file","4f6a540b":"x, sr = read_file(fn, AUDIO_DIR)\nx.shape, sr, x.dtype","8b9c0763":"def log_mel_spec_tfm(fname, src_path, dst_path):\n    x, sample_rate = read_file(fname, src_path)\n    \n    n_fft = 1024\n    hop_length = 256\n    n_mels = 40\n    fmin = 20\n    fmax = sample_rate \/ 2 \n    \n    mel_spec_power = librosa.feature.melspectrogram(x, sr=sample_rate, n_fft=n_fft, \n                                                    hop_length=hop_length, \n                                                    n_mels=n_mels, power=2.0, \n                                                    fmin=fmin, fmax=fmax)\n    mel_spec_db = librosa.power_to_db(mel_spec_power, ref=np.max)\n    dst_fname = dst_path \/ (fname[:-4] + '.png')\n    plt.imsave(dst_fname, mel_spec_db)","e142e9c3":"log_mel_spec_tfm(fn, AUDIO_DIR, IMG_DIR)\nimg = plt.imread(str(IMG_DIR\/(fn[:-4] + '.png')))\nplt.imshow(img, origin='lower');","eb9de18f":"transform_path(AUDIO_DIR, IMG_DIR, log_mel_spec_tfm, fnames=fnames, delete=True)","ded193b1":"os.listdir(str(IMG_DIR))[:10]","c2b2a93f":"import fastai\nfastai.__version__","a1537e6f":"from fastai.vision import *","acd06df0":"digit_pattern = r'(\\d+)_\\w+_\\d+.png$'","b350972f":"data = (ImageList.from_folder(IMG_DIR)\n        .split_by_rand_pct(.2)\n        .label_from_re(digit_pattern)\n        .transform(size=(128,64))\n        .databunch())\ndata.c, data.classes","cf41f607":"xs, ys = data.one_batch()\nxs.shape, ys.shape","ae68676c":"xs.min(), xs.max(), xs.mean(), xs.std()","289e10ce":"data.show_batch(4, figsize=(5,9), hide_axis=False)","1bb2553c":"learn = cnn_learner(data, models.resnet18, metrics=accuracy)\nlearn.fit_one_cycle(4)","46987c2e":"learn.unfreeze()\nlearn.fit_one_cycle(4)","ae86c975":"interp = ClassificationInterpretation.from_learner(learn)","3bb2454b":"interp.plot_confusion_matrix(figsize=(10, 10), dpi=60)","e10de1f0":"# Clean up\n!rm -rf {AUDIO_DIR}\n!rm -rf {IMG_DIR}","e10dec3c":"To begin, we download a bunch of [utility functions](https:\/\/github.com\/sevenfx\/fastai_audio\/blob\/master\/notebooks\/utils.py) for I\/O and conversion of audio files to spectrogram images.","ba206a65":"We can import the necessary modules and functions","d8256a90":"Let's see how many recordings we have, and some sample files.","dd8392c1":"## Image Classifier","c6514d33":"Next, let's download the data. We'll use the free spoken digits database: https:\/\/github.com\/Jakobovski\/free-spoken-digit-dataset","023b1b8e":"As before we can play the recording using the `Audio` widget.","c278a865":"# Audio Classification using FastAI\n\nSource: https:\/\/github.com\/sevenfx\/fastai_audio"}}