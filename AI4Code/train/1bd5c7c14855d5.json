{"cell_type":{"8d277154":"code","ee4531f1":"code","d9e3a16f":"markdown"},"source":{"8d277154":"print(\"Loading NER model ... \")\n!pip install https:\/\/s3-us-west-2.amazonaws.com\/ai2-s2-scispacy\/releases\/v0.2.4\/en_ner_bc5cdr_md-0.2.4.tar.gz -q\nprint(\"loaded.\")","ee4531f1":"\"\"\"\nReturn a list of all chemicals present in the papers abstract of CORD-19\n\"\"\"\n\nimport spacy\nfrom pathlib import Path\nimport pandas as pd\n\n\"\"\"\nLOAD DATA\n\"\"\"\n\nCLEAN_DATA_PATH = Path(\"..\/input\/cord-19-eda-parse-json-and-generate-clean-csv\/\")\n\nbiorxiv = pd.read_csv(CLEAN_DATA_PATH \/ \"biorxiv_clean.csv\")\npmc = pd.read_csv(CLEAN_DATA_PATH \/ \"clean_pmc.csv\")\ncomm_use = pd.read_csv(CLEAN_DATA_PATH \/ \"clean_comm_use.csv\")\nnoncomm_use = pd.read_csv(CLEAN_DATA_PATH \/ \"clean_noncomm_use.csv\")\n\n\n\"\"\"\nHELPERS\n\"\"\"\n\n# https:\/\/stackoverflow.com\/questions\/2130016\/splitting-a-list-into-n-parts-of-approximately-equal-length\ndef chunkIt(seq, num):\n    avg = len(seq) \/ float(num)\n    out = []\n    last = 0.0\n\n    while last < len(seq):\n        out.append(seq[int(last):int(last + avg)])\n        last += avg\n\n    return out\n\n\n\n\"\"\"\nMAIN\n\"\"\"\n\npapers = pd.concat(\n    [biorxiv,pmc, comm_use, noncomm_use], axis=0\n).reset_index(drop=True)\nabstracts = list(papers['abstract'].dropna())\n\n# Split abstracts into chunks since SpaCy has a 1 million characters limit.\nabstracts_chunks = chunkIt(abstracts, 50)\n\nnlp_bc = spacy.load('en_ner_bc5cdr_md', disable=[\"tagger\", \"parser\"]) # leave only ner in the pipeline\nchemical_set= set()\n\nfor chunk in abstracts_chunks:\n    doc_bc = nlp_bc(' '.join(chunk))\n    for ent in doc_bc.ents:\n        if ent.label_ == 'CHEMICAL':\n            chemical_set.add(str(ent))\n\n# Store into pandas Series and save into disk\nchemical_list_df = pd.Series(list(chemical_set), name=\"chemicals\")\n\nchemical_list_df.to_csv(\"abstract_chemical_list.csv\", header=True, index=False)\nchemical_list_df.head(50)","d9e3a16f":"<br>\n<br>\n\n<center><font size=\"6\"> \ud83d\udc8a Generate a list of all chemicals present in the abstracts papers<\/font><\/center>\n\n<br>\n<br>\n\n<center><font size=\"4\">This simple-yet-useful notebook return a list of all chemicals present in the CORD-19 abstract papers.<\/font><\/center>\n\n<br>\n\n\n<center><font size=\"4\">The same list will be used in a future notebook to (hopefully) help the community research finding a threatment against COVID-19.<\/font><\/center>"}}