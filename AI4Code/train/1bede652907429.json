{"cell_type":{"2c75e078":"code","b3462118":"code","1ee14d74":"code","b807f7b3":"code","e854863b":"code","23cf3ef8":"code","c1c02080":"code","8771c922":"code","a2d4fcfc":"code","677c2849":"code","4b00a7d7":"code","09bcdc9c":"code","06386477":"code","ed9b5604":"code","c5afdec2":"code","6a5cffc0":"code","4cc38de5":"code","0f917f3e":"code","3c66281c":"code","ecd6118c":"code","91be5d53":"code","b0ba5382":"code","22bae671":"code","f23f3465":"markdown","eefa98c8":"markdown","483e347a":"markdown","b9b6405e":"markdown","ab54e77a":"markdown","1f882606":"markdown","8ae6e489":"markdown","e72f2b96":"markdown","ff850067":"markdown","c901fd05":"markdown","e413d181":"markdown","d6332ba3":"markdown","d7951109":"markdown","c43ef424":"markdown","ef9271fa":"markdown","80d0094e":"markdown","04f489ac":"markdown","7c373ccf":"markdown","6db1a3b5":"markdown","9032abac":"markdown","5e385f53":"markdown","a9241c53":"markdown","c8255af7":"markdown","b7806aa4":"markdown","bb7de6e4":"markdown","2d51861b":"markdown","704938c2":"markdown","595ee9f4":"markdown"},"source":{"2c75e078":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n\n# PreProcessing\nfrom sklearn.compose import ColumnTransformer\nfrom sklearn.preprocessing import OneHotEncoder, MinMaxScaler\nfrom category_encoders import BinaryEncoder\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.impute import SimpleImputer\n\n# Splitting Data\nfrom sklearn.model_selection import train_test_split, StratifiedKFold, cross_val_score, RandomizedSearchCV\n\n# Modeling\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.metrics import accuracy_score, precision_score","b3462118":"hotel = pd.read_csv('..\/input\/hotel-booking-demand\/hotel_bookings.csv', usecols = ['hotel', 'is_canceled', 'adults', 'children', 'babies', 'meal', 'country', 'market_segment', 'distribution_channel', 'reserved_room_type', 'booking_changes', 'deposit_type', 'days_in_waiting_list', 'customer_type', 'required_car_parking_spaces', 'total_of_special_requests'])\nhotel.head()","1ee14d74":"hotel.info()","b807f7b3":"hotel_eda = hotel.copy()\nhotel_eda['hotel'].value_counts()","e854863b":"plt.figure(figsize=(18,6))\nsns.countplot(x='is_canceled', hue = 'hotel', data= hotel_eda)\nplt.title('Cancellation Situation')\nplt.show()","23cf3ef8":"hotel_eda['is_canceled'].value_counts()\/hotel.shape[0]*100","c1c02080":"hotel_eda['all_child'] = hotel_eda['children'] + hotel_eda['babies']\npd.crosstab(hotel_eda['adults'], hotel_eda['all_child'], margins=True, margins_name = 'Total')","8771c922":"plt.figure(figsize=(18,6))\ncountry_booking = hotel_eda['country'].value_counts(normalize=True).rename_axis('country').reset_index(name='Percentage')\nsns.barplot(x='country', y='Percentage', data=country_booking.head(10))\nplt.title('Country of Customers')\nplt.show()","a2d4fcfc":"plt.figure(figsize=(18,6))\nsns.countplot(x='customer_type', data= hotel_eda)\nplt.title('Customer Type')\nplt.show()","677c2849":"hotel_eda['customer_type'].value_counts()\/len(hotel_eda['customer_type'])*100","4b00a7d7":"plt.figure(figsize=(18,6))\nroom_booking = hotel_eda['reserved_room_type'].value_counts(normalize=True).rename_axis('reserved_room_type').reset_index(name='Percentage')\nsns.barplot(x='reserved_room_type', y='Percentage', data= room_booking)\nplt.title('Customer Reserved Room Type')\nplt.show()","09bcdc9c":"hotel_eda['meal'].value_counts()\/len(hotel_eda['meal'])*100","06386477":"plt.figure(figsize=(18,10))\nplt.subplot(211)\nsns.countplot(data=hotel_eda,x='deposit_type',hue='market_segment')\nplt.title('Deposit Type for Market Segment')\nplt.legend(loc = 1)\nplt.subplot(212)\nsns.countplot(data=hotel_eda,x='is_canceled',hue='market_segment')\nplt.title('Cancellation for Market Segment')\nplt.show()","ed9b5604":"plt.figure(figsize=(18,6))\nsns.countplot(x='total_of_special_requests', data= hotel_eda)\nplt.title('Total of Special Requests from Customers')\nplt.show()","c5afdec2":"hotel.isna().sum()\/len(hotel)*100","6a5cffc0":"mode_binary = Pipeline([\n    ('encoder', SimpleImputer(strategy = 'most_frequent')),\n    ('binary', BinaryEncoder())])\n\ntransformer = ColumnTransformer([\n    ('one hot', OneHotEncoder(handle_unknown = 'ignore'), [ 'hotel', 'meal', 'market_segment', 'distribution_channel', 'reserved_room_type', 'deposit_type', 'customer_type']),\n    ('mode binary', mode_binary, ['country']),\n    ('impute mode', SimpleImputer(strategy = 'most_frequent'), ['children'])], remainder = 'passthrough')","4cc38de5":"hotel['is_canceled'].value_counts()","0f917f3e":"X = hotel.drop('is_canceled', axis = 1)\ny = hotel['is_canceled']","3c66281c":"X.shape","ecd6118c":"X_train, X_test, y_train, y_test = train_test_split(X, y, stratify = y, test_size = 0.2, random_state = 1515)","91be5d53":"logreg = LogisticRegression()\ntree = DecisionTreeClassifier(random_state = 1515)\nknn = KNeighborsClassifier()\n\nlogreg_pipe = Pipeline([('transformer', transformer), ('logreg', logreg)])\ntree_pipe = Pipeline([('transformer', transformer), ('tree', tree)])\nknn_pipe = Pipeline([('transformer', transformer), ('scale', MinMaxScaler()), ('knn', knn)])\n\ndef model_evaluation(model, metric):\n    model_cv = cross_val_score(model, X_train, y_train, cv = StratifiedKFold(n_splits = 5), scoring = metric)\n    return model_cv\n\nlogreg_pipe_cv = model_evaluation(logreg_pipe, 'precision')\ntree_pipe_cv = model_evaluation(tree_pipe, 'precision')\nknn_pipe_cv = model_evaluation(knn_pipe, 'precision')\n\nfor model in [logreg_pipe, tree_pipe, knn_pipe]:\n    model.fit(X_train, y_train)\n    \nscore_mean = [logreg_pipe_cv.mean(), tree_pipe_cv.mean(), knn_pipe_cv.mean()]\nscore_std = [logreg_pipe_cv.std(), tree_pipe_cv.std(), knn_pipe_cv.std()]\nscore_precision_score = [precision_score(y_test, logreg_pipe.predict(X_test)), precision_score(y_test, tree_pipe.predict(X_test)), precision_score(y_test, knn_pipe.predict(X_test))]\nmethod_name = ['Logistic Regression', 'Decision Tree Classifier', 'KNN Classifier']\ncv_summary = pd.DataFrame({\n    'method': method_name,\n    'mean score': score_mean,\n    'std score': score_std,\n    'precision score': score_precision_score})\ncv_summary","b0ba5382":"estimator = Pipeline([\n    ('transformer', transformer),\n    ('model', logreg)])\n\nhyperparam_space = {\n    'model__C': [1, 5, 10, 20, 30, 50],\n    'model__class_weight': ['dict', 'balanced'],\n    'model__solver': ['newton-cg', 'lbfgs', 'sag', 'saga'],\n    'model__max_iter': [50, 100, 150, 200, 300],\n    'model__random_state': [1515],\n    'model__n_jobs': [-1]\n}\n\nrandom = RandomizedSearchCV(\n                estimator,\n                param_distributions = hyperparam_space,\n                cv = StratifiedKFold(n_splits = 5),\n                scoring = 'precision',\n                n_iter = 10,\n                n_jobs = -1)\n\nrandom.fit(X_train, y_train)\n\nprint('best score', random.best_score_)\nprint('best param', random.best_params_)","22bae671":"estimator.fit(X_train, y_train)\ny_pred_estimator = estimator.predict(X_test)\nbefore = precision_score(y_test, y_pred_estimator)\n\nrandom.best_estimator_.fit(X_train, y_train)\ny_predict = random.best_estimator_.predict(X_test)\nafter = precision_score(y_test, y_predict)\n\nscore_list = [before, after]\nmethod_name = ['Logistic Regression Before Tuning', 'Logistic Regression After Tuning']\nbest_summary = pd.DataFrame({\n    'method': method_name,\n    'score': score_list\n})\nbest_summary","f23f3465":"# Data Cleaning","eefa98c8":"- I use 0.2 as default score for test_size and X.shape for random_state so the data will be devided equally.","483e347a":"- The difference ratio between canceled and not canceled indicate imbalanced data:\n    * Not Canceled: 62,96%\n    * Canceled: 37,04%","b9b6405e":"From this method, I will choose Logistic Regression\t because it has the highest precision score and continue to HyperParameter Tuning process.","ab54e77a":"*Splitting Data*","1f882606":"Type of booking, assuming one of four categories:\n- Contract, when the booking has an allotment or other type of contract associated to it\n- Group, when the booking is associated to a group\n- Transient, when the booking is not part of a group or contract, and is not associated to other transient booking\n- Transient-party, when the booking is transient, but is associated to at least other transient booking\n\nFrom the graph:\n- Transient as much as 75.05%\n- Transient-party as much as 21.04%\n- Contract as much as 3.41%\n- Group as much as 0.48%\n\nMost of customers is Transient, means they are walk-in guests, last-minute or bookers, or simply people that require a very short-term stay in your facility. Transient customers are one of the major market segments consist of individuals or groups.","8ae6e489":"*Preprocessing Scheme*\n\n- OneHot: hotel, meal, market_segment, distribution_channel, reserved_room_type, deposit_type, customer_type\n- Binary:\n    * mode: country (country column more than 10 countries, soI decide to use binary)\n- Mode Impute: children\n- PassThrough: adults, babies, booking_changes, days_in_waiting_list, required_car_parking_spaces, total_of_special_requests\n- Target: is_canceled\n- No need to scale the data because there isn't any interval nominal between columns","e72f2b96":"# PreProcessing","ff850067":"*Define Target Data*","c901fd05":"* There are missing values and it will be processed on ColumnTransformer.","e413d181":"- City Hotel has the highest canceled booked and also the highest that not canceled booked.","d6332ba3":"*Define Model*\n- I use 3 basic models to predict:\n    * Logistic Regression\n    * Decision Tree Classifier\n    * K-Nearest Neighbor (I add scaler because usually, the score will be better if using a scaler)","d7951109":"# EDA","c43ef424":"### Cross Validation","ef9271fa":"# Before and After Tuning","80d0094e":"- Number of special requests made by the customer (e.g. twin bed or high floor)\n- Most customers don't make any special requests. It has a correlation with customer type. They don't ask for any additional requests because they only transient customers.","04f489ac":"After tuning process, the precision score increasing. I decide to use Logistic Regression After Tuning to predict hotel cancellation.","7c373ccf":"- So far, the best parameter is:\n    * solver: saga\n    * max_iter: 50\n    * class_weight: dict\n    * C: 20","6db1a3b5":"- Categories are represented in the ISO 3155\u20133:2013 format.\n- PRT or Portugal has the most booking demand based on the data (more than 60%). It is pretty obvious because if we trace to the publication page, the description tells us that the data source locations are from hotels located in Portugal.","9032abac":"#### Deposit Type for Market Segment\n- The highest book is using Online TA, with No Deposit. While Groups and Offline TA\/TO are next with Refundable and Non refund. In this era, it will be easy to book a hotel using Online TA, especially most Online TA offers the customers without deposit facility. Customers can choose any type of room up to any special request by Online TA.\n- Looking at Offline TA\/TO and Groups, the situations where the deposit was received were only in the scenarios where the groups came. It is quite logical to apply a deposit for a large number of customers who will fill important amount of the hotel capacity.\n\n#### Cancellation for Market Segment\n- The highest cancellation book is using Online TA. Most of Online TA give a customers previllege to cancel without any charge apply. Second, Groups segment has cancellation rate around 50%.","5e385f53":"Type of meal booked. Categories are presented in standard hospitality meal packages: \n- BB means Bed & Breakfast as much as 77.31%\n- HB means Half board (breakfast and one other meal \u2013 usually dinner) as much as 12.11%\n- FB means Full board (breakfast, lunch and dinner) as much as 0.66%\n- Undefined\/SC means no meal as much as 9.89%\n\nMost customers prefer to book include Breakfast, which's the usual complimentary if someone wants to book a hotel. In case they don't have time to find breakfast outside the hotel. Some of them around 12.11% book with another meal, usually dinner. Them who came with business interests can get more resting time to not find any dinner outside hotel anymore.","a9241c53":"### Customer Profiling","c8255af7":"# Modeling","b7806aa4":"- Type of Reserved Room is A, D, E, G, C, F, H, L, P. Code is presented instead of designation for anonymity reasons.\n- Most of customers book the type A room more than 70%.","bb7de6e4":"# HyperParam Tuning","2d51861b":"- In this data, I combine children and babies in the all_child column to simplify the calculation.\n\n#### Adults\n- Judging from the data above, as many as 4175 adults came and without bring any children as many as 3777. There is a possibility that they have a business purpose or a couple who are on honeymoon.\n- In second place were adults who came alone as many as 654 people and who did not bring children as many as 642 people. It is possible to have a business purpose.\n- For adults who come more than 4 adults, no one brings a single child. There is the possibility of having a business trip or traveling.\n\n#### All Child\n- In the data above, the majority of adults who came without bringing children were 4560, followed by those who brought 1 child as many as 237 adults and 2 children as many as 201 adults.","704938c2":"### Customer Behavior","595ee9f4":"* *0 = Not Canceled*\n* *1 = Canceled*\n\n        - TN: Guest's predict with Not Canceled and the actual is Not Canceled\n        - TP: Guest's predict with Canceled and the actual is Canceled\n        - FP: Guest's predict with Canceled and the actual is Not Canceled\n        - FN: Guest's predict with Not Canceled and the actual is Canceled\n\nActions:\n* FP: When the customer arrives, the room is not available. Customers won't book at the hotel again because they are considered to provide poor service, the hotel experiences financial losses, and a good name.\n* FN: The hotel has the advantage of empty rooms because it's canceled. Customers have more previlledge to choose facilities if they want.\n\n#### I want to reduce one of the situations and its FP. The score that will be pressed is the precision score."}}