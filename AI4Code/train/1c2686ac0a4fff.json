{"cell_type":{"2ddd6152":"code","62bc89d4":"code","3a40d7ba":"code","289121a4":"code","c31b8a7f":"code","5f25a4ea":"code","3b631718":"code","bbd62bb2":"code","04d67efd":"code","42fc54f7":"code","832e6e92":"code","4a880676":"code","0b8dd97b":"code","932533b6":"code","7ef60eb7":"code","f5c46acc":"code","b8889e29":"code","7d39a40d":"code","a79c93c8":"code","92f45228":"code","74c6debf":"code","dfe4685e":"code","a6f64410":"code","41d33539":"code","3f357723":"code","7e810afa":"code","76d5ec16":"code","7efdb0a4":"markdown","92cee597":"markdown","85606133":"markdown","7b2a1e9c":"markdown","81a2117c":"markdown","36304cba":"markdown","02ba20db":"markdown","f0ec3e92":"markdown","3a72ab3c":"markdown","4d71a090":"markdown","dfdc8fc5":"markdown","c76e6706":"markdown","0549e328":"markdown","90162bd3":"markdown","ec004ae4":"markdown","51855e6f":"markdown"},"source":{"2ddd6152":"import pandas as pd\n\nfname_sales_train = '..\/input\/competitive-data-science-predict-future-sales\/sales_train.csv'\ndf_sales_train = pd.read_csv(fname_sales_train)\ndf_sales_train","62bc89d4":"df_sales_train.isnull().sum()","3a40d7ba":"fname_shops = '..\/input\/competitive-data-science-predict-future-sales\/shops.csv'\ndf_shops = pd.read_csv(fname_shops)\ndf_shops","289121a4":"df_shops.isnull().sum()","c31b8a7f":"fname_items = '..\/input\/competitive-data-science-predict-future-sales\/items.csv'\ndf_items = pd.read_csv(fname_items)\ndf_items","5f25a4ea":"df_items.isnull().sum()","3b631718":"fname_item_categories = '..\/input\/competitive-data-science-predict-future-sales\/item_categories.csv'\ndf_item_categories = pd.read_csv(fname_item_categories)\ndf_item_categories","bbd62bb2":"df_item_categories.isnull().sum()","04d67efd":"fname_test = '..\/input\/competitive-data-science-predict-future-sales\/test.csv'\ndf_test = pd.read_csv(fname_test)\ndf_test","42fc54f7":"import matplotlib.pyplot as plt\nimport seaborn as sns\n\nsns.set_theme(style=\"whitegrid\")\n\nplt.figure(figsize=(12, 3))\nsns.boxplot(data=df_sales_train.item_price, orient='h')","832e6e92":"# Remove large outliers\ndf_sales_train = df_sales_train[df_sales_train.item_price < 100000]","4a880676":"plt.figure(figsize=(12, 3))\nsns.boxplot(data=df_sales_train.item_cnt_day, orient='h')","0b8dd97b":"# Remove large outliers\ndf_sales_train = df_sales_train[df_sales_train.item_cnt_day < 900]","932533b6":"df = df_sales_train.pivot_table(index=['shop_id','item_id'], columns='date_block_num', values='item_cnt_day', fill_value=0, aggfunc='sum')\ndf","7ef60eb7":"df = df.reset_index()\ndf.columns.name = None\ndf","f5c46acc":"df_test_src = pd.merge(df_test, df, how='left', on=['shop_id', 'item_id'])\ndf_test_src = df_test_src.drop(['ID'], axis=1).fillna(0)\ndf_test_src","b8889e29":"X_train = df.iloc[:, 2:-1]\nX_train","7d39a40d":"y_train = df.iloc[:, -1]\ny_train","a79c93c8":"X_test = df_test_src.iloc[:, 3:]\nX_test","92f45228":"from sklearn.preprocessing import MinMaxScaler\n\nX_scaler = MinMaxScaler()\nX_train = X_scaler.fit_transform(X_train)\nX_test  = X_scaler.transform(X_test)","74c6debf":"import tensorflow as tf\n\ninput = tf.keras.layers.Input(shape=(33, 1))\n\nx = input\nx = tf.keras.layers.LSTM(32, return_sequences=True, dropout=0.1)(x)\nx = tf.keras.layers.LSTM(32, return_sequences=True, dropout=0.1)(x)\nx = tf.keras.layers.LSTM(32)(x)\n\noutput = tf.keras.layers.Dense(1)(x)\n\nmodel = tf.keras.models.Model(input, output)\nmodel.summary()","dfe4685e":"model.compile(optimizer='adam', loss='mse')","a6f64410":"import numpy as np\n\nepochs = 100\nbatch_size = 64\n\ncallbacks = [\n    tf.keras.callbacks.EarlyStopping(patience=5, restore_best_weights=True)\n]\n\nhistory = model.fit(np.expand_dims(X_train, axis=-1),\n                    y_train,\n                    validation_split=0.2,\n                    epochs=epochs,\n                    batch_size=batch_size,\n                    callbacks=callbacks)","41d33539":"y_pred = model.predict(np.expand_dims(X_test, -1))\ny_pred","3f357723":"y_pred = y_pred.squeeze().clip(0, 20)\ny_pred","7e810afa":"answer = pd.concat([df_test['ID'], pd.Series(y_pred.squeeze(), name='item_cnt_month')], axis=1)\nanswer","76d5ec16":"fname_output = '.\/submission.csv'\nanswer.to_csv(fname_output, index=False)","7efdb0a4":"## Get explanatory and objective variables","92cee597":"## Count monthly sales","85606133":"## Normalization","7b2a1e9c":"## Neural Network","81a2117c":"## Shop data","36304cba":"## Test data","02ba20db":"# Preprocessing","f0ec3e92":"## Train data","3a72ab3c":"## Merge past data to test one","4d71a090":"# Learning","dfdc8fc5":"## Category data","c76e6706":"# Prediction","0549e328":"# Load files","90162bd3":"## Item data","ec004ae4":"# LSTM Modeling","51855e6f":"## Remove outliers"}}