{"cell_type":{"eb441174":"code","9f967507":"code","8959ae2c":"code","c2e83e7a":"code","cf16f075":"code","db041039":"code","5cb8c7ca":"code","8c67be13":"code","9bd7da03":"code","26c1e267":"code","fca2016f":"code","0ae1e5e3":"code","77d7b326":"code","e22f70dc":"code","ad0023d4":"code","7fe90e07":"code","25da06cc":"code","50f191d0":"code","04d26744":"markdown","5ea05937":"markdown","b750aa10":"markdown","e11b264f":"markdown","923ac226":"markdown","eafafd9f":"markdown","83d88401":"markdown","7839775e":"markdown"},"source":{"eb441174":"import numpy as np\nimport pandas as pd\npd.plotting.register_matplotlib_converters()\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\nprint(\"Setup Complete\")","9f967507":"#Atribuindo a base de dados em um vari\u00e1vel\ndf = pd.read_csv('..\/input\/dados-energia\/power-laws-forecasting-energy-consumption-all-data.csv', sep=';')\ndf","8959ae2c":"#Consolidando os dados, convertendo para datetime\npd.to_datetime(df.Timestamp)\npd.to_datetime(df.Timestamp).dt.year\npd.to_datetime(df.Timestamp).dt.year*10_000 + pd.to_datetime(df.Timestamp).dt.month*100 + pd.to_datetime(df.Timestamp).dt.day","c2e83e7a":"#Atualizando a coluna de timeStamp para anomesdia\ndf.loc[:,'anomesdia'] = pd.to_datetime(pd.to_datetime(df.Timestamp).dt.year*1_00_00 + pd.to_datetime(df.Timestamp).dt.month*1_00 + pd.to_datetime(df.Timestamp).dt.day, format='%Y%m%d')\ndf","cf16f075":"#Contagem de medi\u00e7\u00f5es sobre um pr\u00e9dio espec\u00edfico\ndf.loc[df.SiteId==305].groupby(['SiteId','anomesdia']).Value.count()","db041039":"#Medi\u00e7\u00f5es por dia do pr\u00e9dio\ndf.loc[df.SiteId==305].groupby(['SiteId','anomesdia']).Value.mean()","5cb8c7ca":"d1 = df.groupby(['SiteId','anomesdia']).Value.mean().to_frame()\nd1","8c67be13":"plt.figure(figsize=(15,5))\nd1.reset_index().loc[lambda df: df.SiteId==182].set_index('anomesdia').Value.plot()","9bd7da03":"#Filtragem de dados sobre medi\u00e7\u00f5es do consumo de energia por pr\u00e9dio\ndf.reset_index().groupby('SiteId').anomesdia.nunique()","26c1e267":"#Gr\u00e1fico de medi\u00e7\u00f5es do 3\u00b0 pr\u00e9dio\nplt.figure(figsize=(15,5))\nd1.reset_index().loc[lambda df: df.SiteId==3].set_index('anomesdia').Value.plot(marker='.', linestyle='-')","fca2016f":"#Buscando os pr\u00e9dios que possuem mais de 100 medi\u00e7\u00f5es\naux = df.reset_index().groupby('SiteId').anomesdia.nunique()\naux.loc[ aux > 100 ].index\nlimiar = int( aux.max() * 0.50 )\naux.loc[ aux > limiar ].index","0ae1e5e3":"df = pd.read_csv('..\/input\/dados-energia\/base_tratada.csv')\ndf_dev = df.loc[(df.anomesdia<'2017-01-01')].set_index(['SiteId','anomesdia'])\ndf_val = df.loc[(df.anomesdia>='2017-01-01')].set_index(['SiteId','anomesdia'])\nX_dev = df_dev.drop(['Value','Value_bool'],axis=1)\ny_dev = df_dev.Value_bool.astype(int)\nX_val = df_val.drop(['Value','Value_bool'],axis=1)\ny_val = df_val.Value_bool.astype(int)\nfrom sklearn.model_selection import train_test_split\nX_tr, X_ts, y_tr, y_ts = train_test_split(X_dev, y_dev, test_size=.5, random_state=61658)\nX_tr","77d7b326":"energy_data = pd.read_csv(\"..\/input\/dados-energia\/base_com_scores_201708.csv\", index_col=0)\ned = energy_data.groupby(['SiteId','anomesdia']).Value.mean().to_frame()\n\nplt.figure(figsize=(15,5))\n\nplt.title(\"Consumo m\u00e9dio de energia do m\u00eas de Agosto\/2017\")\n\ned.reset_index().set_index('SiteId').Value.plot()\n\nplt.ylabel(\"Valor\")\n","e22f70dc":"plt.figure(figsize=(15,5))\n\nplt.title(\"Consumo m\u00e9dio de energia do m\u00eas de Agosto\/2017\")\n\ned.reset_index().set_index('anomesdia').Value.plot()\n\nplt.ylabel(\"Valor\")","ad0023d4":"energy_data1 = pd.read_csv(\"..\/input\/dados-energia\/base_com_scores_201709.csv\", index_col=0)\ned1 = energy_data1.groupby(['SiteId','anomesdia']).Value.mean().to_frame()\n\nplt.figure(figsize=(15,5))\n\nplt.title(\"Consumo m\u00e9dio de energia do m\u00eas de Setembro\/2017\")\n\ned1.reset_index().set_index('SiteId').Value.plot()\n\nplt.ylabel(\"Valor\")","7fe90e07":"energy_data1 = pd.read_csv(\"..\/input\/dados-energia\/base_com_scores_201709.csv\", index_col=0)\ned1 = energy_data1.groupby(['SiteId','anomesdia']).Value.mean().to_frame()\n\nplt.figure(figsize=(15,5))\n\nplt.title(\"Consumo m\u00e9dio de energia do m\u00eas de Setembro\/2017\")\n\ned1.reset_index().set_index('anomesdia').Value.plot()\n\nplt.ylabel(\"Valor\")","25da06cc":"plt.figure(figsize=(14,7))\ned = energy_data.groupby(['SiteId']).Value.mean().to_frame()\n\nplt.title(\"Mapa de calor das medi\u00e7\u00f5es de energia Agosto\/2017\")\n\nsns.heatmap(data=ed, annot=True)\n\nplt.ylabel(\"Pr\u00e9dios\")","50f191d0":"plt.figure(figsize=(14,7))\ned1 = energy_data1.groupby(['SiteId']).Value.mean().to_frame()\n\nplt.title(\"Mapa de calor das medi\u00e7\u00f5es de energia Setembro\/2017\")\n\nsns.heatmap(data=ed1, annot=True)\n\nplt.ylabel(\"Pr\u00e9dios\")","04d26744":"**Como ser\u00e1 um consumo m\u00e9dio de um certo pr\u00e9dio**","5ea05937":"**O objetivo**\n\nA primeira base de dados n\u00e3o est\u00e1 organizada. O que tem, pra come\u00e7ar, s\u00e3o uns dados do RH, falando quais foram os feriados em cada pr\u00e9dio, e umas medidas de temperatura pela planta. S\u00f3 com isso n\u00e3o seria poss\u00edvel  fazer um bom modelo, os dados precisam ser consolidados para prever o consumo energ\u00e9tico. De acordo com a \u00e1rea de neg\u00f3cio a meta de energia de contrato \u00e9 realizada HOJE da seguinte forma:\n\n> N\u00f3s possu\u00edmos dados hist\u00f3ricos do consumo energ\u00e9tico. Basicamente olhamos para o\nconsumo daquele m\u00eas, no \u00faltimo ano, e somamos uma gordura de uns 20%. Esse limiar\npode variar se o time que trabalha l\u00e1 avisa que vai consumir mais ou menos, mas o\nsistema de avisos n\u00e3o funciona muito, pois o time tem muitas outras atividades hoje,\neles n\u00e3o t\u00eam como fazer essa checagem no parque todo\u2026\nPara come\u00e7ar, se soubermos, pelo menos, quais pr\u00e9dios ir\u00e3o extrapolar al\u00e9m\nda m\u00e9dia, n\u00f3s podemos acionar esse time que estipula o consumo local pra fazer uma\nan\u00e1lise mais detalhada do consumo, e, ainda por cima, pedir pra eles priorizarem a\nconsolida\u00e7\u00e3o desses dados.\nO que precisamos hoje \u00e9 saber quais pr\u00e9dios devemos priorizar para que o time\nfa\u00e7a essa an\u00e1lise detalhada","b750aa10":"**A quantidade de medidas varia de um dia para o outro**\n\nPara evitar efeito dessas \"tais medidas\" usa-se o consumo m\u00e9dio","e11b264f":"**Os dados**\n\nA base de dados utilizada possui todo o consumo de energia\n- power-laws-forecasting-energy-consumption-all-data.csv\n\nCom essa base de dados, foi analisado primeiro uma consolida\u00e7\u00e3o do consumo di\u00e1rio de energia entre os pr\u00e9dios da empresa.","923ac226":"**Dados defasados**\n\nNa base de dados foi notado uma defasagem na quantidade de medi\u00e7\u00f5es em certos pr\u00e9dios. De acordo com a \u00e1rea de neg\u00f3cio. No inicio, foi priorizdo instalar sensores mais rapidamente nos pr\u00e9dios de maior consumo. Dessa forma os casos com pouco hist\u00f3rico da conta n\u00e3o precism ser considerados. Um exemplo de pr\u00e9dio com defasagem nas m\u00e9di\u00e7\u00f5es est\u00e1 no gr\u00e1fico abaixo:","eafafd9f":"**Problematiza\u00e7\u00e3o**\n\nUma certa empresa, com alto consumo energ\u00e9tico, possui um contrato personalizado com uma\nconcession\u00e1ria de energia:\n* A empresa paga de antem\u00e3o pelo consumo de energia do pr\u00f3ximo m\u00eas\n* Caso o consumo esteja dentro de uma meta estipulada no contrato, a empresa paga uma tarifa reduzida\n* Entretanto, caso a meta seja extrapolada, ent\u00e3o a concession\u00e1ria de energia pode cobrar uma tarifa superior \u00e0 de mercado para prover energia al\u00e9m das expectativas. Claro, quanto maior a meta estipulada, maior o custo.\n\nOs executivos da empresa acreditam que h\u00e1 formas de fazer metas mais audaciosas (i.e. menores),\nsem que a **tarifa emergencial** seja acionada.\nPara verificar a viabilidade dessa proposta, a empresa abriu um projeto com os cientistas de dados.","83d88401":"**Sobre o controle do consumo de energia**\n\nDe acordo com a \u00e1rea de neg\u00f3cio, as duas principais fontes de gastos energ\u00e9ticos s\u00e3o: \n- Manter a temperatura da sala de computadores (datacenter) constante \n- Uso cotidiano dos colaboradores, como luz el\u00e9trica, ar condicionado, elevador, etc\u2026\n\nAl\u00e9m disso, o valor da meta de cada m\u00eas do contrato \u00e9 estipulado anualmente, entretanto h\u00e1 ma certa liberdade para renegociar caso tenham previs\u00f5es de um ver\u00e3o muito quente, por exemplo. O principal problema v\u00eam se um dos pr\u00e9dios gastar muito mais do que o esperado, pois nesse caso \u00e9 acionado a tarifa emergencial.\n\nAs seguintes precau\u00e7\u00f5es devem ser seguidas:\n\n* Pela intui\u00e7\u00e3o de neg\u00f3cio, a temperatura externa deve ser uma das principais vari\u00e1veis\n* Podemos construir um modelo inicial que se baseia em previs\u00f5es m\u00e9dias para o ano, e depois construirmos outro modelo para aprimor\u00e1-lo de forma mais tempestiva, m\u00eas a \u00eas\n* Aparentemente o problema n\u00e3o se trata de prever o gasto energ\u00e9tico com precis\u00e3o, mas sim se o pr\u00e9dio vai gastar muito ou pouco\n","7839775e":"**Sobre o modelo**\n\nO tratamento dessa base de dados \u00e9 muito complexa e exige uma aten\u00e7\u00e3o, pois uma base com muitos dados e com defasagem na veracidade desses dados vai demandar uma an\u00e1lise especializada. Nos datasets utilizados para esse processamento de dados, est\u00e1 presente o SCORE, ou seja, o resultado final de como ficaram os dados e o que se pode aproveitar deles. Para a tomada de decis\u00f5es, foram utilizadas a seguinte estrat\u00e9gia:\n\n* Um gr\u00e1fico sobre os pr\u00e9dio com uso excessivo de energia\/consumo normal"}}