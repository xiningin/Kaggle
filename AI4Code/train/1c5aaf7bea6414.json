{"cell_type":{"920da251":"code","629a6509":"code","c3040b62":"code","8d6323dc":"code","bbaef095":"code","ba206166":"code","dbd2366e":"code","6bc4c03b":"code","ebb0bd31":"code","c58bf439":"code","69ef33ae":"code","e6d6f976":"code","61060587":"code","e71512e6":"code","d2cf4df3":"code","905b2b90":"code","87e09785":"markdown","eca9d908":"markdown","47bff5fa":"markdown","e45e2ce8":"markdown","baf835eb":"markdown","7bf2f461":"markdown","e5cec9f1":"markdown","d29ea20c":"markdown"},"source":{"920da251":"import pandas as pd\nfrom datetime import datetime","629a6509":"!pip install openpyxl","c3040b62":"raw_data = pd.read_excel('..\/input\/uci-online-retail-ii-data-set\/online_retail_II.xlsx',sheet_name='Year 2010-2011')","8d6323dc":"df = raw_data.copy()","bbaef095":"df.columns","ba206166":"df.head()","dbd2366e":"df.dropna(inplace=True)","6bc4c03b":"df = df[~df['Invoice'].str.contains('C', na=False)]","ebb0bd31":"df.loc[:, 'TotalPrice'] = df['Quantity'] * df['Price']","c58bf439":"today_date = datetime(2011, 12, 11)","69ef33ae":"rfm = df.groupby('Customer ID').agg({\n    'InvoiceDate': lambda x: (today_date - x.max()).days,\n    'Invoice': lambda x: x.nunique(),\n    'TotalPrice': lambda x: x.sum()\n})\n\nrfm.columns = ['recency', 'frequency', 'monetary']\n\nrfm = rfm[rfm['monetary'] > 0]","e6d6f976":"rfm.head()","61060587":"rfm.loc[:, 'recency_score'] = pd.qcut(rfm['recency'], 5, [5, 4, 3, 2, 1])\nrfm.loc[:, 'frequency_score'] = pd.qcut(\n    rfm[\"frequency\"].rank(method=\"first\"), 5, labels=[1, 2, 3, 4, 5])\n\nrfm.loc[:, 'RFM_SCORE'] = rfm['recency_score'].astype(\n    str) + rfm['frequency_score'].astype(str)","e71512e6":"rfm.head()","d2cf4df3":"seg_map = {\n    r'[1-2][1-2]': 'hibernating',\n    r'[1-2][3-4]': 'at_Risk',\n    r'[1-2]5': 'cant_loose',\n    r'3[1-2]': 'about_to_sleep',\n    r'33': 'need_attention',\n    r'[3-4][4-5]': 'loyal_customers',\n    r'41': 'promising',\n    r'51': 'new_customers',\n    r'[4-5][2-3]': 'potential_loyalists',\n    r'5[4-5]': 'champions'\n}\n\nrfm['segment'] = rfm['RFM_SCORE'].replace(seg_map, regex=True)","905b2b90":"rfm.head()","87e09785":"# Counting Total Prices","eca9d908":"# Exclude Cancelled Transactions","47bff5fa":"# Drop NA","e45e2ce8":"# Introduction\n\nI prefer medium.com for writing. You can access the medium story that relevant with this notebook from [here](https:\/\/medium.com\/@mebaysan\/what-is-rfm-analysis-an-applied-example-in-python-1979b9853f0b). This notebook will cover just codes.\n\nKind regards.","baf835eb":"# Labelling RFM Scores","7bf2f461":"# Loading Data","e5cec9f1":"# Scoring RFM Metrics","d29ea20c":"# RFM Process"}}