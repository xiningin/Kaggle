{"cell_type":{"a2c08b85":"code","01b2f68b":"code","1f1437c8":"code","c1761770":"code","3a70620e":"code","0d3a56a6":"code","78420edc":"code","a5d75ea2":"code","c27ba039":"code","94fbe6af":"code","34d50be3":"code","6deef2a9":"code","36dc5ebb":"code","893e7781":"markdown","63145353":"markdown","73cc6dc7":"markdown","508af896":"markdown","4d4324d0":"markdown","f70f65b9":"markdown","ab602ffa":"markdown","3c8d49e2":"markdown","71011ab3":"markdown","aa7999cb":"markdown","32ed28cc":"markdown","9573d810":"markdown","bde1d84c":"markdown","0ccc95c4":"markdown","4a176272":"markdown","e27c4820":"markdown"},"source":{"a2c08b85":"import pandas as pd\nimport numpy as np\nfrom kaggle.competitions import twosigmanews\n\nfrom plotly.offline import iplot\nfrom plotly.offline import init_notebook_mode\nimport plotly.graph_objs as go\ninit_notebook_mode(connected=True)","01b2f68b":"# retrieve market and news dataframes\nenv = twosigmanews.make_env()\ndfm, dfn = env.get_training_data()","1f1437c8":"print('market data shape:', dfm.shape)","c1761770":"dfm.head()","3a70620e":"dfm.columns","0d3a56a6":"dfm.isnull().sum()","78420edc":"dfm.assetCode.unique().shape[0]","a5d75ea2":"days = dfm.groupby('assetCode').size()\ndays = pd.DataFrame(days, columns=['days']).reset_index().sort_values('days',ascending=False)\n\n# plot barchart\ndata = [go.Bar(\n            x=days.assetCode,\n            y=days.days,\n            name='No. of Days')]\n\nlayout = go.Layout(\n    title='No. Companies with Days of Stock Data',\n    yaxis=dict(\n        title='No. of Days with Data'\n    ),\n    xaxis=dict(\n        title='Company'\n    )\n)\n\nfig = go.Figure(data=data,layout=layout)\n\niplot(fig)","c27ba039":"day_count = pd.DataFrame(days['days'].value_counts()).reset_index()\nday_count.columns = ['days','count']\nday_count = day_count.sort_values('days',ascending=False)\n\n# plot barchart\ndata = [go.Bar(\n            x=day_count['days'],\n            y=day_count['count'],\n            name='No. of Days')]\n\nlayout = go.Layout(\n    title='No. Companies with Days of Stock Data',\n    yaxis=dict(\n        title='No. of Companies'\n    ),\n    xaxis=dict(\n        title='No. of Days with Stock Data'\n    )\n)\n\nfig = go.Figure(data=data,layout=layout)\n\niplot(fig)","94fbe6af":"apple = dfm[dfm['assetCode']=='AAPL.O']\n\ndata1 = go.Scatter(\n          x=apple.time,\n          y=apple['close'],\n          name='Price')\n\ndata2 = go.Bar(\n            x=apple.time,\n            y=apple.volume,\n            name='Volume',\n            yaxis='y2')\n\ndata = [data1, data2]\n\nlayout = go.Layout(\n    title='Closing Price & Volume for AAPL.O',\n    yaxis=dict(\n        title='Price'\n    ),\n    yaxis2=dict(\n        overlaying='y',\n        side='right',\n        range=[0, 1500000000], #increase upper range so that the volume bars are short\n        showticklabels=False,\n        showgrid=False\n    )\n)\n\nfig = go.Figure(data=data,layout=layout)\n\niplot(fig)","34d50be3":"data = [go.Candlestick(x=apple.time,\n                       open=apple.open,\n                       high=apple.open, #no data so used another column\n                       low=apple.close, #no data so used another column\n                       close=apple.close)]\n\n# remove range slider\nlayout = go.Layout(\n    xaxis = dict(\n        rangeslider = dict(\n            visible = False\n        )\n    )\n)\n\nfig = go.Figure(data=data,layout=layout)\niplot(fig)","6deef2a9":"data = [go.Scatter(\n          x=apple.time,\n          y=apple['returnsOpenNextMktres10'],\n          name='Price')]\n\niplot(data)","36dc5ebb":"# for the target variable, change negative values into positive\ndfm['abs_returnsOpenNextMktres10'] = dfm['returnsOpenNextMktres10'].apply(lambda x: abs(x))\n# calculate the mean of absolute returnsOpenNextMktres10 for each company\n# and treat that as a proxy for volatility\nproxy_beta = dfm.groupby('assetCode', as_index=False)['abs_returnsOpenNextMktres10'].mean()\n\n\n# plot barchart\ndata = [go.Bar(\n            x=proxy_beta.assetCode,\n            y=proxy_beta.abs_returnsOpenNextMktres10)]\n\nlayout = go.Layout(\n    title='Volatile Companies',\n    yaxis=dict(\n        title='Proxy Beta'\n    ),\n    xaxis=dict(\n        title='Company'\n    )\n)\n\nfig = go.Figure(data=data,layout=layout)\niplot(fig)","893e7781":"Please come back again for more updates...","63145353":"### Column names are as follows","73cc6dc7":"The companies have a very varied time range of stock prices, from 6 years to 1 day!","508af896":"### Does companies have an equally wide range (days) of stock prices?","4d4324d0":"### This is the target, ie 10 day forward adjusted opening price returns","f70f65b9":"This is not a true candlestick as we were not given the highest and lowest price for each day. But it is still good to know how to plot it using plotly. *Shrugs*","ab602ffa":"#### and again with a Candlestick chart","3c8d49e2":"There is a huge drop of share price in Jun 2015, but that is because there was a 7:1 stock split. Not sure if this is in the news, if not, stock splits are something that needs to be note as a false positive.\n\nNote that the volume of trade also increase significantly at the same time, very likely of the simple fact that there are more shares in the market for trading.","71011ab3":"### Let's concentrate on the Market Data","aa7999cb":"### How many companies are featured?","32ed28cc":"Just a look at how the target is like...","9573d810":"However, 500+ companies, or 30+% of all companies have at least 6 years worth of data. It is probably necessary to drop those companies with very low range of trading days, but at least there is a decent amount that have sufficient data.","bde1d84c":"The higher the proxy beta, the more volatile the company is. For highly volatile companies, they might be easier to predict as they might respond more drastically to news? Seems like a good hypothesis to test.","0ccc95c4":"### Which are companies that are more volatile than others?","4a176272":"### Let's do some plotting, for the company Apple","e27c4820":"### No. of NAN"}}