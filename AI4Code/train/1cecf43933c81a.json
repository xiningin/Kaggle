{"cell_type":{"eec0c739":"code","e9d052c5":"code","3cdc9ae8":"code","a4812e49":"code","87350ca3":"code","2b7e5c51":"code","d4c34430":"code","4549ed9b":"code","bc99de6e":"code","86df325b":"code","286b25bf":"code","4d721820":"code","bd2a3326":"markdown","9b4407df":"markdown","c188f897":"markdown","0668535b":"markdown","c557c491":"markdown","51a54c27":"markdown","b8e7d76b":"markdown","291bf938":"markdown","656b69b2":"markdown","8e65fde6":"markdown","32992270":"markdown","1b05895f":"markdown","349d8d2a":"markdown"},"source":{"eec0c739":"# Setup plotting\nimport matplotlib.pyplot as plt\nfrom learntools.deep_learning_intro.dltools import animate_sgd\nplt.style.use('seaborn-whitegrid')\n# Set Matplotlib defaults\nplt.rc('figure', autolayout=True)\nplt.rc('axes', labelweight='bold', labelsize='large',\n       titleweight='bold', titlesize=18, titlepad=10)\nplt.rc('animation', html='html5')\n\n# Setup feedback system\nfrom learntools.core import binder\nbinder.bind(globals())\nfrom learntools.deep_learning_intro.ex3 import *","e9d052c5":"import numpy as np\nimport pandas as pd\nfrom sklearn.preprocessing import StandardScaler, OneHotEncoder\nfrom sklearn.compose import make_column_transformer, make_column_selector\nfrom sklearn.model_selection import train_test_split\n\nfuel = pd.read_csv('..\/input\/dl-course-data\/fuel.csv')\n\nX = fuel.copy()\n# Remove target\ny = X.pop('FE')\n\npreprocessor = make_column_transformer(\n    (StandardScaler(),\n     make_column_selector(dtype_include=np.number)),\n    (OneHotEncoder(sparse=False),\n     make_column_selector(dtype_include=object)),\n)\n\nX = preprocessor.fit_transform(X)\ny = np.log(y) # log transform target instead of standardizing\n\ninput_shape = [X.shape[1]]\nprint(\"Input shape: {}\".format(input_shape))","3cdc9ae8":"# Uncomment to see original data\nfuel.head()\n# Uncomment to see processed features\npd.DataFrame(X[:10,:]).head()","a4812e49":"from tensorflow import keras\nfrom tensorflow.keras import layers\n\nmodel = keras.Sequential([\n    layers.Dense(128, activation='relu', input_shape=input_shape),\n    layers.Dense(128, activation='relu'),    \n    layers.Dense(64, activation='relu'),\n    layers.Dense(1),\n])","87350ca3":"# YOUR CODE HERE\nmodel.compile(\n    optimizer='adam',\n    loss='mae',\n)\n# Check your answer\nq_1.check()","2b7e5c51":"# Lines below will give you a hint or solution code\n#q_1.hint()\n#q_1.solution()","d4c34430":"# YOUR CODE HERE\nX_train, X_valid, y_train, y_valid = train_test_split(X, y)\n\nhistory = history = model.fit(\n    X_train, y_train,\n    validation_data=(X_valid, y_valid),\n    batch_size=128,\n    epochs=200,\n)\n\n# Check your answer\nq_2.check()","4549ed9b":"# Lines below will give you a hint or solution code\n#q_2.hint()\n#q_2.solution()","bc99de6e":"import pandas as pd\n\nhistory_df = pd.DataFrame(history.history)\n# Start the plot at epoch 5. You can change this to get a different view.\nhistory_df.loc[5:, ['loss']].plot();","86df325b":"# View the solution (Run this cell to receive credit!)\nq_3.check()","286b25bf":"# YOUR CODE HERE: Experiment with different values for the learning rate, batch size, and number of examples\nlearning_rate = 0.05\nbatch_size = 32\nnum_examples = 256\n\nanimate_sgd(\n    learning_rate=learning_rate,\n    batch_size=batch_size,\n    num_examples=num_examples,\n    # You can also change these, if you like\n    steps=50, # total training steps (batches seen)\n    true_w=3.0, # the slope of the data\n    true_b=2.0, # the bias of the data\n)","4d721820":"# View the solution (Run this cell to receive credit!)\nq_4.check()","bd2a3326":"In the *Fuel Economy* dataset your task is to predict the fuel economy of an automobile given features like its type of engine or the year it was made. \n\nFirst load the dataset by running the cell below.","9b4407df":"# 2) Train Model\n\nOnce you've defined the model and compiled it with a loss and optimizer you're ready for training. Train the network for 200 epochs with a batch size of 128. The input data is `X` with target `y`.","c188f897":"# 1) Add Loss and Optimizer\n\nBefore training the network we need to define the loss and optimizer we'll use. Using the model's `compile` method, add the Adam optimizer and MAE loss.","0668535b":"With the learning rate and the batch size, you have some control over:\n- How long it takes to train a model\n- How noisy the learning curves are\n- How small the loss becomes\n\nTo get a better understanding of these two parameters, we'll look at the linear model, our ppsimplest neural network. Having only a single weight and a bias, it's easier to see what effect a change of parameter has.\n\nThe next cell will generate an animation like the one in the tutorial. Change the values for `learning_rate`, `batch_size`, and `num_examples` (how many data points) and then run the cell. (It may take a moment or two.) Try the following combinations, or try some of your own:\n\n| `learning_rate` | `batch_size` | `num_examples` |\n|-----------------|--------------|----------------|\n| 0.05            | 32           | 256            |\n| 0.05            | 2            | 256            |\n| 0.05            | 128          | 256            |\n| 0.02            | 32           | 256            |\n| 0.2             | 32           | 256            |\n| 1.0             | 32           | 256            |\n| 0.9             | 4096         | 8192           |\n| 0.99            | 4096         | 8192           |","c557c491":"Take a look at the data if you like. Our target in this case is the `'FE'` column and the remaining columns are the features.","51a54c27":"---\n\n\n\n\n*Have questions or comments? Visit the [Learn Discussion forum](https:\/\/www.kaggle.com\/learn-forum\/191966) to chat with other Learners.*","b8e7d76b":"# 4) Learning Rate and Batch Size\n\nWhat effect did changing these parameters have? After you've thought about it, run the cell below for some discussion.","291bf938":"The last step is to look at the loss curves and evaluate the training. Run the cell below to get a plot of the training loss.","656b69b2":"**This notebook is an exercise in the [Intro to Deep Learning](https:\/\/www.kaggle.com\/learn\/intro-to-deep-learning) course.  You can reference the tutorial at [this link](https:\/\/www.kaggle.com\/ryanholbrook\/stochastic-gradient-descent).**\n\n---\n","8e65fde6":"Run the next cell to define the network we'll use for this task.","32992270":"# 3) Evaluate Training\n\nIf you trained the model longer, would you expect the loss to decrease further?","1b05895f":"# Introduction #\n\nIn this exercise you'll train a neural network on the *Fuel Economy* dataset and then explore the effect of the learning rate and batch size on SGD.\n\nWhen you're ready, run this next cell to set everything up!","349d8d2a":"# Keep Going #\n\nLearn how to [**improve your model's performance**](https:\/\/www.kaggle.com\/ryanholbrook\/overfitting-and-underfitting) by tuning capacity or adding an early stopping callback."}}