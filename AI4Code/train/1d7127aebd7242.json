{"cell_type":{"dfcceca1":"code","ff77ced4":"code","33940b7c":"code","84b196e7":"code","2a788de2":"code","85d8e3f8":"code","7c287fcb":"code","e19e6610":"code","bba3df21":"code","8c4966e1":"code","62fb352f":"code","80a5e513":"code","d1344226":"code","443913dc":"code","dedd93d1":"code","2abbed72":"code","f227c72c":"code","967faf6b":"code","3d2c85c7":"code","7a3e4ad6":"code","053ee841":"code","fab5228e":"code","fadc1b25":"markdown","b19e52a3":"markdown","85e66f62":"markdown","6fd8c9b1":"markdown","2554e676":"markdown","ef1a3326":"markdown","3c7ddbee":"markdown","552637c9":"markdown","96e6f073":"markdown","93c0b333":"markdown","641862e3":"markdown","dbae0900":"markdown","46e9f58c":"markdown","b7308ae9":"markdown","4592e2b3":"markdown","c0d2fc35":"markdown","6bf080b2":"markdown","79133237":"markdown","606ec4af":"markdown","5834d090":"markdown","01fb62bd":"markdown","f3a60d31":"markdown","4f955eaf":"markdown","f4990215":"markdown","b751f817":"markdown","1d1a1c52":"markdown","c5f2f7b7":"markdown","dc8ec83c":"markdown","80554520":"markdown","b6b72303":"markdown","7e3a0963":"markdown","e670ac8b":"markdown","f9f52fd8":"markdown"},"source":{"dfcceca1":"import pandas as pd\n\ndata = pd.read_csv('..\/input\/ad.data', index_col=0)\ndisplay(data.head())","ff77ced4":"data.shape","33940b7c":"import seaborn as sns\n%matplotlib inline\n\nsns.pairplot(data, x_vars=['TV','Radio','Newspaper'], y_vars='Sales', size=7, aspect=0.7, kind='reg')","84b196e7":"atributos = ['TV', 'Radio', 'Newspaper']\n\nX = data[atributos]\nX.head()","2a788de2":"y = data['Sales']\ny.head()","85d8e3f8":"from sklearn.model_selection import train_test_split\n\n# omitindo o parametro test_size, considera-se 30%\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.3, random_state=1) \n\nprint(X_train.shape)\nprint(y_train.shape)\nprint(X_test.shape)\nprint(y_test.shape)","7c287fcb":"from sklearn.linear_model import LinearRegression\n\nreglin = LinearRegression()\n\nreglin.fit(X_train, y_train)","e19e6610":"print(reglin.intercept_)\nprint(reglin.coef_)","bba3df21":"list(zip(atributos, reglin.coef_)) # o comando zip junta dois vetores e forma tuplas","8c4966e1":"reglin.predict([[100,20,15]])","62fb352f":"# C\u00d3DIGO DO EXERC\u00cdCIO 3\nreglin.predict([[200,100,80]])","80a5e513":"# C\u00d3DIGO DO EXERC\u00cdCIO 4\nreglin.predict([[200,100,80],[100,20,15]])","d1344226":"# C\u00d3DIGO DO EXERC\u00cdCIO 5\nreglin.predict([[0,0,0]])","443913dc":"true = [100, 50, 30, 20]\npred = [90, 50, 50, 30]","dedd93d1":"# calculando MAE na m\u00e3o\nprint((10 + 0 + 20 + 10)\/4.)\n\n# calculando MAE com scikit\nfrom sklearn import metrics\nprint(metrics.mean_absolute_error(true, pred))","2abbed72":"# calculando MSE na m\u00e3o\nprint((10**2 + 0**2 + 20**2 + 10**2)\/4.)\n\n# calculando MSE com scikit\nprint(metrics.mean_squared_error(true, pred))","f227c72c":"# calculando RMSE na m\u00e3o\nimport numpy as np\nprint(np.sqrt((10**2 + 0**2 + 20**2 + 10**2)\/4.))\n\n# calculando RMSE com scikit\nprint(np.sqrt(metrics.mean_squared_error(true, pred)))","967faf6b":"y_pred = reglin.predict(X_test)\n\nprint(np.sqrt(metrics.mean_squared_error(y_test, y_pred)))","3d2c85c7":"atributos = ['TV', 'Radio']\n\nX = data[atributos]\ny = data.Sales\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, random_state=1)\n\nreglin.fit(X_train, y_train)\n\ny_pred = reglin.predict(X_test)\n\nprint(np.sqrt(metrics.mean_squared_error(y_test, y_pred)))","7a3e4ad6":"# C\u00d3DIGO DO EXERC\u00cdCIO 7\n\n\nimport pandas as pd\n\ndata = pd.read_csv('..\/input\/ad.data', index_col=0)\n\natributos = ['TV', 'Radio', 'Newspaper']\n\nX = data[atributos]\nX.head()\n\ny = data['Sales']\ny.head()\n\n\nfrom sklearn.model_selection import train_test_split\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.1, random_state=1) # test_size = tamanho do teste\n\nfrom sklearn.linear_model import LinearRegression\n\nreglin = LinearRegression()\n\nreglin.fit(X_train, y_train)\n\nlist(zip(atributos, reglin.coef_))\n\ny_pred = reglin.predict(X_test)\n\nprint(np.sqrt(metrics.mean_squared_error(y_test, y_pred)))\n","053ee841":"\n\nfrom sklearn.model_selection import cross_val_score\n\nX = data[atributos]\ny = data.Sales\n\nscores = cross_val_score(LinearRegression(), X, y, cv=10, scoring='neg_mean_squared_error')\nscores = np.sqrt(-scores)\n\nprint(scores)\nprint(\"RMSE: %0.2f (+\/- %0.2f)\" % (scores.mean(), scores.std() * 2))","fab5228e":"# C\u00d3DIGO DO EXERC\u00cdCIO 8\nimport pandas as pd\n\ndata = pd.read_csv('..\/input\/ad.data', index_col=0)\n\natributos = ['TV', 'Radio']\n\nX = data[atributos]\nX.head()\n\ny = data['Sales']\ny.head()\n\nfrom sklearn.model_selection import cross_val_score\n\nX = data[atributos]\ny = data.Sales\n\nscores = cross_val_score(LinearRegression(), X, y, cv=10, scoring='neg_mean_squared_error')\nscores = np.sqrt(-scores)\n\nprint(scores)\nprint(\"RMSE: %0.2f (+\/- %0.2f)\" % (scores.mean(), scores.std() * 2))","fadc1b25":"4 - Simule dois cen\u00e1rios ao mesmo tempo utilizando uma \u00fanica chamada de reglin.predict. Utilize a c\u00e9lula abaixo.","b19e52a3":"** Exerc\u00edcios **\n\n1- O que \u00e9 poss\u00edvel perceber com rela\u00e7\u00e3o \u00e0 linha de tend\u00eancia entre as vari\u00e1veis do eixo X (atributos) e o eixo Y (r\u00f3tulo)?\n\nResposta: Foi poss\u00edvel perceber que as linhas de tendencia demonstram com clareza o qu\u00e3o dispersos est\u00e3o os valores dos respectivos atributos. Por exemplo, com o atributo \"TV\" os pontos se aglomeram entorno da linha de tendencia, produzindo assim uma linha de tendencia mais precisaa e com uma margem de erro menor. Pegando-se como exemplo o atributo \"Newpapers\" com um valor elevador ter\u00e1 algumas poss\u00edveis respostas, onde os resultados s\u00e3o distintos por terem uma maior taxa de erro e uma pior distribui\u00e7\u00e3o.\n\n\n2- Visualmente, qual atributo parece ter uma correla\u00e7\u00e3o maior com a vari\u00e1vel de sa\u00edda \"Sales\"?\n\nResposta: O atributo \"TV\" aparenta ter uma correla\u00e7\u00e3o muito grande com a vari\u00e1vel de sa\u00edda \"Sales\", visto que os pontos est\u00e3o melhores distribuidos, produzindo uma linha de tendencia com uma margem de erro menor do que os demais atributos.\n","85e66f62":"## Regress\u00e3o Linear","6fd8c9b1":"Coment\u00e1rios: O resultado encontrado sofreu uma pequena altera\u00e7\u00e3o diminuindo o erro em +\/- 0,01, e tambem foi reduzido o RMSE em 0,01, podendo assim concluir, que o atributo Newspaper est\u00e1 prejudicando o modelo.","2554e676":"**Mean Squared Error** (MSE) \u00e9 a m\u00e9dia do quadrado dos erros:\n\n$$\\frac 1n\\sum_{i=1}^n(y_i-\\hat{y}_i)^2$$","ef1a3326":"## Regress\u00e3o Linear\n\nUma das formas de resolver um problema desse tipo \u00e9 aplicando a regress\u00e3o linear. Nesse m\u00e9todo, procura-se uma fun\u00e7\u00e3o capaz de tra\u00e7ar uma linha de tend\u00eancia que servir\u00e1 para prever um valor futuro em determinadas condi\u00e7\u00f5es. A vantagem \u00e9 que \u00e9 um modelo matematicamente simples de interpretar. A desvantagem \u00e9 que dificilmente levar\u00e1 a uma acur\u00e1cia satisfat\u00f3ria.","3c7ddbee":"Em seguida, \u00e9 necess\u00e1rio dividir quais dados ser\u00e3o apresentados na etapa de treino e quais dados ser\u00e3o apresentados na etapa de teste:","552637c9":"## Separando os atributos da classe\n\n\u00c9 importante separar, assim como na classifica\u00e7\u00e3o, quais s\u00e3o os atributos e quais s\u00e3o as classes.\nVeja uma forma diferente de fazer isso:","96e6f073":"5 - Qual \u00e9 a sa\u00edda para um cen\u00e1rio que foi gasto 0 d\u00f3lares tanto com TV, como Radio e Newspaper? Qual a explica\u00e7\u00e3o para o valor? Utilize a c\u00e9lula abaixo para simular.","93c0b333":"Um coment\u00e1rio importante \u00e9 que o m\u00e9todo predict espera um vetor 2d, ou seja, mesmo que seja desejado prever o valor de 1 amostra, \u00e9 importante pass\u00e1-la dentro de um vetor externo (por isso dois colchetes no come\u00e7o e no fim).\n\nNo cen\u00e1rio dado, era esperado a venda de **11,1 milh\u00f5es** de itens de produto.","641862e3":"A compara\u00e7\u00e3o entre as diferentes m\u00e9tricas:\n\n- **MAE** \u00e9 a mais f\u00e1cil de entender, porque \u00e9 uma m\u00e9dia.\n- **MSE** \u00e9 mais popular que a MAE porque pune erros maiores.\n- **RMSE** \u00e9 ainda mais popular porque, al\u00e9m das caracter\u00edsticas anteriores, \u00e9 interpret\u00e1vel em termos da vari\u00e1vel de sa\u00edda.","dbae0900":"$$y = 2.93 + 0.0466 \\times TV + 0.179 \\times Radio + 0.00345 \\times Newspaper$$\n\nO valor mostrado \u00e9 representado pelo fato da fun\u00e7\u00e3o possuir um deslocamento na qual a reta se inicia, no caso 2,93.. podendo ser observado na fun\u00e7\u00e3o descrita acima ","46e9f58c":"## Regress\u00e3o linear no scikit-learn\n\nPara aplicar o m\u00e9todo de regress\u00e3o linear (LinearRegression), ser\u00e1 feito algo bem similar ao kNN.","b7308ae9":"## Avalia\u00e7\u00e3o de modelos de regress\u00e3o\n\nM\u00e9tricas como acur\u00e1cia s\u00e3o comuns em problemas de classifica\u00e7\u00e3o, mas n\u00e3o se aplicam em problemas de regress\u00e3o. No lugar desta, s\u00e3o utilizadas m\u00e9tricas espec\u00edficas para valores cont\u00ednuos.\n\nSer\u00e3o utilizados alguns exemplos para observar o comportamento de **tr\u00eas m\u00e9tricas comuns** para problemas de regress\u00e3o:","4592e2b3":"6 - De acordo com os coeficientes aprendidos, ordene do maior para o menor a ordem de impacto deles no n\u00famero de vendas:\n\nResposta: Radio Possu\u00ed um impacto em vendas de 17,9%, TV possu\u00ed um impacto em vendas de 4,66%, Newspaper possu\u00ed um impacto em vendas de 0,345%, segundo a fun\u00e7\u00e3o de regress\u00e3o linear.","c0d2fc35":"**Mean Absolute Error** (MAE) \u00e9 a m\u00e9dia absoluta dos erros:\n\n$$\\frac 1n\\sum_{i=1}^n|y_i-\\hat{y}_i|$$","6bf080b2":"$$y = 2.93 + 0.0466 \\times TV + 0.179 \\times Radio + 0.00345 \\times Newspaper$$\n\nComo interpretar **TV coefficient** (0.0466)?\n\n- Para uma dada quantia gasta com Radio e Newspaper, **uma \"unidade\" a mais em gasto com TV** est\u00e1 associada com **0.0466 \"unidades\" a mais de vendas**.\n- Ou simplificando: Para uma dada quantia gasta com de Radio e Newspaper, **um adicional de $1.000 gastos com TV** reflete diretamente na **venda de 46.6 itens**, segundo esse modelo.","79133237":"** Exerc\u00edcios **\n\n8 - Remova a coluna Newspaper e execute o mesmo experimento de valida\u00e7\u00e3o cruzada. Verifique se h\u00e1 uma melhora geral no desempenho da regress\u00e3o.","606ec4af":"**Exerc\u00edcios**\n\n3 - Qual cen\u00e1rio seria suficiente para que um produto vendesse mais de 30 milh\u00f5es de unidades? Utilize a c\u00e9lula seguinte para mostrar o c\u00f3digo","5834d090":"Quais s\u00e3o os atributos?\n- **TV:** d\u00f3lares gastos em propagandas veiculadas na TV para um produto em determinado mercado (em milh\u00f5es)\n- **Radio:** d\u00f3lares gastos em propagandas veiculadas em r\u00e1dio\n- **Newspaper:** d\u00f3lares gastos com propaganda em jornais\n\nQual o r\u00f3tulo da amostra?\n- **Sales:** vendas (em milhares) de um determinado item em um mercado espec\u00edfico","01fb62bd":"** Exerc\u00edcios **\n\n7 - Para fazer uma an\u00e1lise melhor se o atributo Newspaper realmente \u00e9 descart\u00e1vel, considere treinar tr\u00eas modelos com separa\u00e7\u00e3o de treino e teste diferentes de 25%. Considere dividir em 50% e 90% para treino tamb\u00e9m. Simule os cen\u00e1rios **com** e **sem** o atributo Newspaper. Implemente o c\u00f3digo na c\u00e9lula seguinte, preencha com os dados obtidos na tabela da c\u00e9lula em sequ\u00eancia e fa\u00e7a os devidos coment\u00e1rios das suas conclus\u00f5es e percep\u00e7\u00f5es a respeito do experimento.","f3a60d31":"## Sele\u00e7\u00e3o de atributos\n\nAlguns m\u00e9todos n\u00e3o lidam muito bem com atributos que n\u00e3o contribuem para o modelo. Nesses casos, o modelo acaba se prejudicando com atributos particularmente in\u00fateis. Um atributo s\u00f3 perde completamente o valor na regress\u00e3o linear quando seu coeficiente zera. \n\nO atributo **Newspaper** tem um valor bem pr\u00f3ximo de zero. Vale a pena verificar como o modelo fica sem utilizar esse atributo no treino. Esse tipo de pensamento caracteriza a sele\u00e7\u00e3o de atributos. ","4f955eaf":"O modelo, uma vez treinado, permite que seja acessado os valores do modelo matem\u00e1tico:","f4990215":"Resposta:\n    \n|Cen\u00e1rio              |  RMSE  |\n|---------------------|--------|\n| Com, Treino: 75%    | 1,4046 |\n| Sem, Treino: 75%     | 1,3879 |\n| Com, Treino: 50%    | 1,5248 |\n| Sem, Treino: 50%    | 1,5144 |\n| Com, Treino: 90%    | 1,5821 |\n| Sem, Treino: 90%    | 1,5756 |\n\nComent\u00e1rios: Notou-se que o atributo 'Newspaper' em compara\u00e7\u00e3o com os demais causa um varia\u00e7\u00e3o relativamente pequena n\u00e3o tendo tanta relevancia para o resultado, podendo ser observado na tabela acima, onde mesmo retirando tal atributo o valor do RMSE permanece em uma faixa quase constante, mas \u00e9 importante salientar que um valor s\u00f3 perde o valor da regress\u00e3o linear quando seu coeficiente \u00e9 zero, tendo isso em mente pode-se dizer que o atributo Newspaper acaba prejudicando o modelo.","b751f817":"## Valida\u00e7\u00e3o Cruzada com Scikit\n\nOutra forma de analisar os resultados \u00e9 garantindo que todas as amostras em algum momento fa\u00e7am parte tanto do treino quanto do teste. Para isso, \u00e9 poss\u00edvel empregar a valida\u00e7\u00e3o cruzada dispon\u00edvel no Scikit.","1d1a1c52":"Como o valor de RMSE **caiu**, \u00e9 percept\u00edvel que nesse cen\u00e1rio testado o atributo n\u00e3o tinha grande contribui\u00e7\u00e3o para o modelo. \u00c9 importante notar que diferente da acur\u00e1cia (que quanto mais alta melhor), o erro \u00e9 esperado que seja sempre o menor poss\u00edvel.","c5f2f7b7":"E como o modelo poderia ser utilizado para fazer predi\u00e7\u00f5es?\nSuponha que tenha sido gasto 100 milh\u00f5es com propagandas em TV, 20 milh\u00f5es em r\u00e1dios e 15 milh\u00f5es em jornais.","dc8ec83c":"### Calculando RMSE para as predi\u00e7\u00f5es de Vendas","80554520":"At\u00e9 agora foram vistos alguns conceitos de classifica\u00e7\u00e3o. Outro importante aspecto do aprendizado supervisionado s\u00e3o os modelos de aprendizagem para problemas de regress\u00e3o. Nestes problemas, a sa\u00edda esperada \u00e9 cont\u00ednua, em vez de valores discretos como na classifica\u00e7\u00e3o.\n\nUm conjunto de dados de propaganda \u00e9 disponibilizado junto com esse notebook, onde cada linha indica um tipo de mercado diferente. Importe os dados para visualizar a estrutura deles:","b6b72303":"Para facilitar, os dados tamb\u00e9m poderiam ser visualizados para compreender melhor com a distribui\u00e7\u00e3o, e se h\u00e1 alguma tend\u00eancia.","7e3a0963":"### Forma da regress\u00e3o linear:\n\n$y = \\beta_0 + \\beta_1x_1 + \\beta_2x_2 + ... + \\beta_nx_n$\n\n- $y$ \u00e9 a sa\u00edda\n- $\\beta_0$ \u00e9 um valor de bias (deslocamento)\n- $\\beta_1$ \u00e9 o coeficiente de $x_1$ (do primeiro atributo)\n- $\\beta_n$ \u00e9 o coeficiente de $x_n$ (do n-\u00e9simo atributo)\n\nAssim, para esse problema, tem-se:\n\n$y = \\beta_0 + \\beta_1 \\times TV + \\beta_2 \\times Radio + \\beta_3 \\times Newspaper$\n\nOs valores $\\beta$ s\u00e3o chamados de **coeficientes de modelo**. Esses valores s\u00e3o \"aprendidos\" durante a etapa de aprendizagem, a qual acontece com o ajuste do modelo utilizando o crit\u00e9rio dos \"quadrados m\u00ednimos\". Uma vez aprendidos esses par\u00e2metros, o modelo pode ser usado de forma preditiva!","e670ac8b":"**Root Mean Squared Error** (RMSE) \u00e9 a raiz quadrada da m\u00e9dia do quadrado dos erros:\n\n$$\\sqrt{\\frac 1n\\sum_{i=1}^n(y_i-\\hat{y}_i)^2}$$","f9f52fd8":"A interpreta\u00e7\u00e3o desses resultados \u00e9 a seguinte: na primeira rodada de 10 (cv=10), o RMSE foi de 1.83; na segunda, foi de 1.81, e assim por diante. \u00c9 poss\u00edvel observar que a rodada mais dif\u00edcil para o m\u00e9todo foi a s\u00e9tima, com RMSE de 2.82.\n\nA m\u00e9dia e desvio padr\u00e3o diz bastante tamb\u00e9m sobre a dificuldade de utilizar esse conjunto de dados: o desvio padr\u00e3o \u00e9 quase 50% do valor original da m\u00e9dia.\n"}}