{"cell_type":{"351afe5e":"code","d622904f":"code","cdccee23":"code","3fb60f1d":"code","b7788e60":"code","67a71f1f":"code","e3b3a232":"code","0682cf9b":"code","041bc0fb":"code","74bc166e":"code","b48ef224":"code","05c4814c":"code","79046c6c":"code","bd7f3937":"code","c9917462":"code","603db894":"code","fa70adad":"code","624d1c39":"code","37d95b6c":"code","6c37fc6e":"code","e9891508":"code","c506c752":"code","3cead934":"code","2d6acfe8":"code","c37e7e37":"code","07d4fd6f":"markdown","e5dbc3a9":"markdown"},"source":{"351afe5e":"from fastai.vision.all import *","d622904f":"import os\n\nfrom pathlib import Path\n\nimport pandas as pd","cdccee23":"INPUT = Path(\"..\/input\/digit-recognizer\")\nos.listdir(INPUT)","3fb60f1d":"train_df = pd.read_csv(INPUT\/\"train.csv\")\ntrain_df.head(3)","b7788e60":"test_df = pd.read_csv(INPUT\/\"test.csv\")\ntest_df.head(3)","67a71f1f":"TRAIN = Path(\"..\/train\")\nTEST = Path(\"..\/test\")","e3b3a232":"for index in range(10):\n    try:\n        os.makedirs(TRAIN\/str(index))\n    except:\n        pass","0682cf9b":"try:\n    os.makedirs(TEST)\nexcept:\n    pass","041bc0fb":"import numpy as np\n\nfrom PIL import Image\n\ndef saveDigit(digit, filepath):\n    digit = digit.reshape(28,28)\n    digit = digit.astype(np.uint8)\n    \n    img = Image.fromarray(digit)\n    img.save(filepath)","74bc166e":"for index,row in train_df.iterrows():\n    label, digit = row[0], row[1:]\n    \n    folder = TRAIN\/str(label)\n    filename = f\"{index}.jpg\"\n    filepath = folder\/filename\n    \n    digit = digit.values\n    \n    saveDigit(digit, filepath)\n    ","b48ef224":"for index,digit in test_df.iterrows():\n    \n    folder = TEST\n    filename = f\"{index}.jpg\"\n    filepath = folder\/filename\n    \n    digit = digit.values\n    \n    saveDigit(digit, filepath)\n    ","05c4814c":"!dir {TRAIN}","79046c6c":"# from: https:\/\/www.kaggle.com\/fanbyprinciple\/fruits-with-fastai-v4\/notebook\ndblock = DataBlock(blocks=(ImageBlock, CategoryBlock),\n                   get_items = get_image_files,\n                   splitter=RandomSplitter(valid_pct=0.2,seed=42),\n                   get_y=parent_label,\n                   item_tfms=Resize(128))","bd7f3937":"dls = dblock.dataloaders(TRAIN)","c9917462":"dls.show_batch()","603db894":"loss_func = LabelSmoothingCrossEntropy()\n# cbs = ActivationStats(with_hist=True)\n\nlearn = cnn_learner(dls, resnet18, loss_func=loss_func, metrics=accuracy)","fa70adad":"learn.fine_tune(5, base_lr=1e-2)","624d1c39":"# learn.fine_tune(20, base_lr=1e-2, freeze_epochs=8)","37d95b6c":"# learn = learn.to_native_fp32()","6c37fc6e":"submission_df = pd.read_csv('..\/input\/digit-recognizer\/sample_submission.csv')\nsubmission_df.head()","e9891508":"os.listdir(TEST)","c506c752":"TEST","3cead934":"ImageId = [int(os.path.splitext(path)[0])+1 for path in os.listdir(TEST)]","2d6acfe8":"ImageId","c37e7e37":"try:\n    class_score, y = learn.get_preds(DatasetType.Test)\n    class_score = np.argmax(class_score, axis=1)\n    submission  = pd.DataFrame({\"ImageId\": ImageId,\"Label\": class_score})\n    submission.to_csv(\"submission_learn.csv\", index=False)\nexcept Exception as e:\n    print(e)","07d4fd6f":"thanks for fastaiv1 notebook: https:\/\/www.kaggle.com\/slm37102\/0-9955-using-diff-arch-of-cnn-in-mnist-fastai-v1\n\nfor inducing me to try again","e5dbc3a9":"Submission : needs to be verified."}}