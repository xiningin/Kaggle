{"cell_type":{"9b386820":"code","b17e5e8b":"code","54bfa58e":"code","c664658a":"code","6103c5e5":"code","0cdbea11":"code","116b1e4f":"code","ee588db3":"code","e41c2f98":"code","80256c69":"code","3011b8e7":"code","f8c262c0":"code","9fa2a0a2":"code","829b6a12":"code","f66d7b62":"code","9a75eb6c":"code","29a930a8":"code","2ec33427":"code","017b4aac":"code","a776e7ed":"code","bb41a862":"code","3f23030e":"code","ff17d6aa":"code","75f6e78f":"code","f9417242":"code","ad153128":"code","72f6195e":"code","497aeaee":"code","7d2fd13a":"code","eb68efad":"code","b10ad093":"code","3950dd52":"code","e300d98e":"code","0741e452":"code","45f715be":"code","cdd180a0":"code","8144427e":"code","65a74c87":"code","161fc9a1":"markdown","1b295bdd":"markdown","61c31607":"markdown","f9ca9d85":"markdown","39794253":"markdown","555a1915":"markdown","40f13d7c":"markdown","133736e4":"markdown","ff881eba":"markdown","71e696f2":"markdown","92f8d710":"markdown","dbb29b73":"markdown","7312f51e":"markdown","d3aff948":"markdown","7f8464e6":"markdown","9e752cb9":"markdown","6bd7da0d":"markdown","f7f22f9f":"markdown","772eb889":"markdown","67db1c62":"markdown","ad73d429":"markdown","80f6bc68":"markdown","a122f268":"markdown","6320bf7d":"markdown","0d86b4c9":"markdown","29a985dc":"markdown"},"source":{"9b386820":"# installing external lib opencage\n!pip install opencage","b17e5e8b":"import pandas as pd\nimport numpy as np\nimport datetime\n\nimport folium \nfrom folium import plugins\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nimport plotly.express as px\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots\nfrom plotly.graph_objs import *\n\nfrom opencage.geocoder import OpenCageGeocode\n\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import PolynomialFeatures\nfrom sklearn.metrics import mean_squared_error, mean_absolute_error\nfrom math import sqrt\n\nimport warnings\n\n%config InlineBackend.figure_format = 'retina'\n\nwarnings.filterwarnings('ignore')\n\n%matplotlib inline","54bfa58e":"brazil = pd.read_csv(\"..\/input\/corona-virus-brazil\/brazil_covid19.csv\")\n\nconf = \"https:\/\/raw.githubusercontent.com\/CSSEGISandData\/COVID-19\/master\/csse_covid_19_data\/csse_covid_19_time_series\/time_series_covid19_confirmed_global.csv\"\nrec = \"https:\/\/raw.githubusercontent.com\/CSSEGISandData\/COVID-19\/master\/csse_covid_19_data\/csse_covid_19_time_series\/time_series_covid19_recovered_global.csv\"\ndea = \"https:\/\/raw.githubusercontent.com\/CSSEGISandData\/COVID-19\/master\/csse_covid_19_data\/csse_covid_19_time_series\/time_series_covid19_deaths_global.csv\"\n\nconfirmed = pd.read_csv(conf)\nrecovered = pd.read_csv(rec)\ndeaths = pd.read_csv(dea)\n\nbrazil_date = '2020-06-04'\n\nby_state = brazil[['cases','deaths']][brazil['date']==brazil_date].groupby(brazil['state']).max().sort_values(by = 'cases', ascending=False)\n\nkey = '5bc0901142f2404cbec4048336ecc36f'  # get api key from:  https:\/\/opencagedata.com\ngeocoder = OpenCageGeocode(key)\n\nstates = by_state.index\ncountry =\"Brazil\"\n\nby_state['latitude'] = 0.0000000\nby_state['longitude'] = 0.0000000\nby_state['Country'] = 'Brazil'\n\nj = 0\n\nfor i in states:\n    \n    query = str(i+\",\"+country)\n    results = geocoder.geocode(query)\n\n    by_state['latitude'][j] = results[0]['geometry']['lat']\n    by_state['longitude'][j] = results[0]['geometry']['lng']\n    \n    j = j+1","c664658a":"world_map = folium.Map(location=[-20, -50]\n                       , zoom_start=3.5\n                       , tiles='Stamen Terrain')\n\nfor lat, lon, value, name in zip(by_state['latitude']\n                                 , by_state['longitude']\n                                 , by_state['cases']\n                                 , by_state['Country']):\n    \n    folium.CircleMarker([lat, lon]\n                        , radius=0.00025*value\n                        , popup = ('<strong>Country<\/strong>: ' \n                                   + str(name).capitalize() + '<br>'\n                                '<strong>Confirmed Cases<\/strong>: ' \n                                   + str(value) + '<br>')\n                        , color='red'\n                        , fill_color='red'\n                        , fill_opacity=0.7 ).add_to(world_map)\n    \nworld_map","6103c5e5":"brazil['date'] = pd.to_datetime(brazil['date'])\n\nconfirmed = confirmed.fillna('unknow')\nrecovered = recovered.fillna('unknow')\ndeaths = deaths.fillna('unknow')","0cdbea11":"last_update = '6\/4\/20'\ncurrent_cases = confirmed\ncurrent_cases = current_cases[['Country\/Region',last_update]]\n\ncurrent_cases = current_cases.groupby('Country\/Region').sum().sort_values(by=last_update, ascending=False)\n\ncurrent_cases['recovered'] = recovered[['Country\/Region',last_update]].groupby('Country\/Region').sum().sort_values(by=last_update,ascending=False)\n\ncurrent_cases['deaths'] = deaths[['Country\/Region',last_update]].groupby('Country\/Region').sum().sort_values(by=last_update,ascending=False)\n\ncurrent_cases['active'] = current_cases[last_update]-current_cases['recovered']-current_cases['deaths']\n\ncurrent_cases = current_cases.rename(columns={last_update:'confirmed'\n                                              ,'recovered':'recovered'\n                                              ,'deaths':'deaths'\n                                              ,'active':'active'})\n\ncurrent_cases.head(20).style.background_gradient(cmap='Blues')","116b1e4f":"top_10_confirmed = confirmed[(confirmed['Country\/Region']=='Brazil') |\n                             (confirmed['Country\/Region']=='US') |\n                             (confirmed['Country\/Region']=='China') |\n                             (confirmed['Country\/Region']=='Italy') |\n                             (confirmed['Country\/Region']=='Spain') |\n                             (confirmed['Country\/Region']=='Germany') |\n                             (confirmed['Country\/Region']=='France') |\n                             (confirmed['Country\/Region']=='Iran') |\n                             (confirmed['Country\/Region']=='United Kingdom') |\n                             (confirmed['Country\/Region']=='Russia') |\n                             (confirmed['Country\/Region']=='Turkey')]\n\ntop_10_confirmed = top_10_confirmed.groupby(top_10_confirmed['Country\/Region']).sum()\n\ntop_10_confirmed = top_10_confirmed.drop(['Lat','Long'], axis = 1)\ntop_10_confirmed = top_10_confirmed.transpose()","ee588db3":"top_10_countries = top_10_confirmed.drop('Brazil', axis = 1)\n\nlayout = Layout(\n    paper_bgcolor='rgba(0,0,0,0)'\n    , plot_bgcolor='rgba(0,0,0,0)'\n    , title=\"Cases over time in top 10 countries in confirmed cases numbers\"\n)\n\nindex = top_10_countries.index\ndata = top_10_countries\n\nfig = go.Figure(data=[\n    \n    go.Line(name='US', x = index, y=data['US'])\n    , go.Line(name='China', x = index, y=data['China'])\n    , go.Line(name='Italy', x = index, y=data['Italy'])\n    , go.Line(name='Spain', x = index, y=data['Spain'])\n    , go.Line(name='Germany', x=index, y=data['Germany'])\n    , go.Line(name='France', x=index , y=data['France'])\n    , go.Line(name='Iran', x = index, y=data['Iran'])\n    , go.Line(name='United Kingdom', x = index, y=data['United Kingdom'])\n    , go.Line(name='Russia', x = index, y=data['Russia'])\n    , go.Line(name='Turkey', x = index, y=data['Turkey'])\n    \n])\n\nfig['layout'].update(layout)\n\nfig.show()","e41c2f98":"brazil_over_time = brazil[['cases','deaths']].groupby(brazil['date']).sum().sort_values(by = 'cases', ascending=True)\n\nlayout = Layout(\n    paper_bgcolor='rgba(0,0,0,0)'\n    , plot_bgcolor='rgba(0,0,0,0)'\n)\n\nfig = make_subplots(rows=2, cols=1\n                    , subplot_titles=('Confirmed cases', 'Deaths'))\n\nfig.append_trace(go.Line(name='Confirmed'\n                        , x = brazil_over_time.index\n                        , y = brazil_over_time['cases']\n                        , mode=\"lines+markers\")\n                        , row=1, col=1)\n\nfig.append_trace(go.Line(name='Deaths'\n                        , x = brazil_over_time.index\n                        , y = brazil_over_time['deaths']\n                        , mode=\"lines+markers\")\n                        , row=2, col=1)\n\nfig['layout'].update(layout)\n\nfig.show()","80256c69":"mortality_over_time = round((brazil_over_time['deaths']\/brazil_over_time['cases'])*100,2)\n\nlayout = Layout(\n    paper_bgcolor='rgba(0,0,0,0)'\n    , plot_bgcolor='rgba(0,0,0,0)'\n    , title=\"Mortality rate over the time\"\n)\n\nindex = mortality_over_time.index\ndata = mortality_over_time\n\nfig = go.Figure(data=[\n    \n    go.Line(name='Mortality in %'\n            , x = index\n            , y=data\n            , mode=\"lines+markers\")\n    \n])\n\nfig['layout'].update(layout)\n\nfig.show()","3011b8e7":"cases_today = brazil[['cases']].groupby(brazil['date']).sum().sort_values(by = 'cases', ascending=True).shift(-1)\ncases_yesterday = brazil[['cases']].groupby(brazil['date']).sum().sort_values(by = 'cases', ascending=True)\n\ndeaths_today = brazil[['deaths']].groupby(brazil['date']).sum().sort_values(by = 'deaths', ascending=True).shift(-1)\ndeaths_yesterday = brazil[['deaths']].groupby(brazil['date']).sum().sort_values(by = 'deaths', ascending=True)\n\ncases_growth_rate = cases_today-cases_yesterday\ncases_growth_rate = cases_growth_rate.dropna()\n\ndeaths_growth_rate = deaths_today-deaths_yesterday\ndeaths_growth_rate = deaths_growth_rate.dropna()\n\nlayout = Layout(\n    paper_bgcolor='rgba(0,0,0,0)'\n    , plot_bgcolor='rgba(0,0,0,0)'\n)\n\nfig = make_subplots(rows=2, cols=1\n                    , subplot_titles=('New cases per day over the time'\n                                      , 'New deaths per day over the time'))\n\nfig.append_trace(go.Line(name='New cases per day'\n                        , x = cases_growth_rate.index\n                        , y = cases_growth_rate['cases']\n                        , mode=\"lines+markers\")\n                        , row=1, col=1)\n\nfig.append_trace(go.Line(name='New deaths per day'\n                        , x = deaths_growth_rate.index\n                        , y = deaths_growth_rate['deaths']\n                        , mode=\"lines+markers\")\n                        , row=2, col=1)\n\nfig['layout'].update(layout)\n\nfig.show()","f8c262c0":"top10_since_first_case = top_10_confirmed.reset_index()\ntop10_since_first_case = top10_since_first_case.drop('index',axis=1)\ntop10_since_first_case['Brazil'] = top10_since_first_case['Brazil'].shift(-35)\ntop10_since_first_case['France'] = top10_since_first_case['France'].shift(-2)\ntop10_since_first_case['Germany'] = top10_since_first_case['Germany'].shift(-5)\ntop10_since_first_case['Iran'] = top10_since_first_case['Iran'].shift(-28)\ntop10_since_first_case['Italy'] = top10_since_first_case['Italy'].shift(-9)\ntop10_since_first_case['Spain'] = top10_since_first_case['Spain'].shift(-10)\ntop10_since_first_case['Russia'] = top10_since_first_case['Russia'].shift(-9)\ntop10_since_first_case['Turkey'] = top10_since_first_case['Turkey'].shift(-49)\ntop10_since_first_case['United Kingdom'] = top10_since_first_case['United Kingdom'].shift(-9)","9fa2a0a2":"# creating the plot\ntop10_since_first_case_log = np.log(top10_since_first_case)\n\nlayout = Layout(\n    paper_bgcolor='rgba(0,0,0,0)'\n    , plot_bgcolor='rgba(0,0,0,0)'\n    , title=\"Log Top 10 countries VS Brazil since first case appear\"\n)\n\nindex = top10_since_first_case_log.index\ndata = top10_since_first_case_log\n\nfig = go.Figure(data=[\n    \n    go.Line(name='Brazil', x=index , y=data['Brazil'])\n    , go.Line(name='US', x = index, y=data['US'])\n    , go.Line(name='Italy', x = index, y=data['Italy'])\n    , go.Line(name='China', x = index, y=data['China'])\n    , go.Line(name='Spain', x = index, y=data['Spain'])\n    , go.Line(name='Germany', x=index, y=data['Germany'])\n    , go.Line(name='France', x=index , y=data['France'])\n    , go.Line(name='Iran', x = index, y=data['Iran'])\n    , go.Line(name='United Kingdom', x = index, y=data['United Kingdom'])\n    , go.Line(name='Russia', x = index, y=data['Russia'])\n    , go.Line(name='Turkey', x = index, y=data['Turkey'])\n  \n])\n\nfig['layout'].update(layout)\n\nfig.show()","829b6a12":"by_state = brazil[['cases','deaths']][brazil['date']==brazil_date].groupby(brazil['state']).max().sort_values(by = 'cases', ascending=False)\n\nlayout = Layout(\n    paper_bgcolor='rgba(0,0,0,0)',\n    plot_bgcolor='rgba(0,0,0,0)',\n    title=\"Cases and Deaths by state (deaths highlighted by numbers)\"\n)\n\nfig = go.Figure(data=[\n    \n    go.Bar(name='cases'\n           , x=by_state.index\n           , y=by_state['cases']),\n    \n    go.Bar(name='deaths'\n           , x=by_state.index\n           , y=by_state['deaths']\n           , text=by_state['deaths']\n           , textposition='outside')\n])\n\nfig.update_layout(barmode='stack')\nfig['layout'].update(layout)\n\nfig.show()","f66d7b62":"mortality_by_state = round((by_state['deaths']\/by_state['cases'])*100,2)\nmortality_by_state = mortality_by_state.sort_values(ascending=False)\n\nlayout = Layout(\n    paper_bgcolor='rgba(0,0,0,0)',\n    plot_bgcolor='rgba(0,0,0,0)',\n    title=\"Mortality rate by state\"\n)\n\nfig = go.Figure(data=[\n    \n    go.Bar(x=mortality_by_state.index\n           , y=mortality_by_state)\n])\n\nfig.update_layout(barmode='stack')\nfig['layout'].update(layout)\n\nfig.show()","9a75eb6c":"by_region = brazil[['cases','deaths']][brazil['date']==brazil_date].groupby(brazil['region']).max().sort_values(by = 'cases', ascending=False)\n\nfig = make_subplots(rows=1, cols=2, specs=[[{'type':'domain'}\n                                            , {'type':'domain'}]])\n\nfig.add_trace(go.Pie(labels=by_region.index\n                     , values=by_region[\"cases\"]\n                     , name=\"Cases\"),1, 1)\n\nfig.add_trace(go.Pie(labels=by_region.index\n                     , values=by_region[\"deaths\"]\n                     , name=\"Deaths\"),1, 2)\n\n# Use `hole` to create a donut-like pie chart\nfig.update_traces(hole=.4, hoverinfo=\"label+percent+name\")\n\nfig.update_layout(\n    \n    title_text=\"Brazil cases and deaths situation by region\",\n    annotations=[dict(text='Cases', x=0.18, y=0.5, font_size=20, showarrow=False),\n                 dict(text='Deaths', x=0.82, y=0.5, font_size=20, showarrow=False)])\nfig.show()","29a930a8":"others = by_state[by_state.index!='S\u00e3o Paulo'].sum()\nsp = by_state[by_state.index=='S\u00e3o Paulo'].sum()\ncases = pd.DataFrame([others, sp],columns = ['cases','deaths'], index = ['Other states','S\u00e3o Paulo'])\n\n\nfig = make_subplots(rows=1, cols=2, specs=[[{'type':'domain'}\n                                            , {'type':'domain'}]])\n\nfig.add_trace(go.Pie(labels=cases.index\n                     , values=cases[\"cases\"]\n                     , name=\"Cases\"),1, 1)\n\nfig.add_trace(go.Pie(labels=cases.index\n                     , values=cases[\"deaths\"]\n                     , name=\"Deaths\"),1, 2)\n\n# Use `hole` to create a donut-like pie chart\nfig.update_traces(hole=.4, hoverinfo=\"label+percent+name\")\n\nfig.update_layout(\n    \n    title_text=\"How much of confirmed cases and deaths cases are in S\u00e3o Paulo?\",\n    annotations=[dict(text='Cases', x=0.18, y=0.5, font_size=20, showarrow=False),\n                 dict(text='Deaths', x=0.82, y=0.5, font_size=20, showarrow=False)])\nfig.show()","2ec33427":"other_states_over_time = brazil[['cases','deaths']][brazil['state']!='S\u00e3o Paulo'].groupby(brazil['date']).sum().sort_values(by = 'cases', ascending=True)\n\nsp_over_time = brazil[['cases','deaths']][brazil['state']=='S\u00e3o Paulo'].groupby(brazil['date']).sum().sort_values(by = 'cases', ascending=True)\n\nlayout = Layout(\n    paper_bgcolor='rgba(0,0,0,0)'\n    , plot_bgcolor='rgba(0,0,0,0)'\n    , title=\"Total cases in other states vs S\u00e3o Paulo over the time\"\n)\n\nfig = go.Figure(data=[\n    \n    go.Line(name='Other states'\n            , x=other_states_over_time.index\n            , y=other_states_over_time['cases']\n            , mode=\"lines+markers\")\n    , go.Line(name='S\u00e3o Paulo'\n              , x=sp_over_time.index\n              , y=sp_over_time['cases']\n              , mode=\"lines+markers\")\n    \n])\n\nfig.update_layout(barmode='stack')\nfig['layout'].update(layout)\n\nfig.show()","017b4aac":"layout = Layout(\n    paper_bgcolor='rgba(0,0,0,0)'\n    , plot_bgcolor='rgba(0,0,0,0)'\n    , title=\"Deaths in other states vs S\u00e3o Paulo over the time\"\n)\n\nfig = go.Figure(data=[\n    \n    go.Line(name='Other states'\n            , x=other_states_over_time.index\n            , y=other_states_over_time['deaths']\n            , mode=\"lines+markers\")\n    , go.Line(name='S\u00e3o Paulo'\n              , x=sp_over_time.index\n              , y=sp_over_time['deaths']\n              , mode=\"lines+markers\")\n    \n])\n\nfig.update_layout(barmode='stack')\nfig['layout'].update(layout)\n\nfig.show()","a776e7ed":"# Taking confirmed cases since first case appear in 2\/26\/2020\ncases = brazil['cases'].groupby(brazil['date']).sum().sort_values(ascending=True)\ncases = cases[cases>0].reset_index().drop('date',axis=1)\n\ndeaths = brazil['deaths'].groupby(brazil['date']).sum().sort_values(ascending=True)\ndeaths = deaths[deaths>0].reset_index().drop('date',axis=1)\n\n# add new 3 days here\ncases = cases[0:100]\ndeaths = deaths[0:80]","bb41a862":"# Converting our data into a array\ndays_since_first_case = np.array([i for i in range(len(cases.index))]).reshape(-1, 1)\nbrazil_cases = np.array(cases).reshape(-1, 1)\n\ndays_since_first_death = np.array([i for i in range(len(deaths.index))]).reshape(-1, 1)\nbrazil_deaths = np.array(deaths).reshape(-1, 1)","3f23030e":"#Preparing indexes to predict next 15 days\ndays_in_future = 3\nfuture_forcast = np.array([i for i in range(len(cases.index)+days_in_future)]).reshape(-1, 1)\nadjusted_dates = future_forcast[:-3]\n\nfuture_forcast_deaths = np.array([i for i in range(len(deaths.index)+days_in_future)]).reshape(-1, 1)\nadjusted_dates_deaths = future_forcast_deaths[:-3]","ff17d6aa":"#Splitting data into train and test to evaluate our model\nX_train, X_test, y_train, y_test = train_test_split(days_since_first_case\n                                                    , brazil_cases\n                                                    , test_size= 10\n                                                    , shuffle=False\n                                                    , random_state = 42) \n\nX_train_death, X_test_death, y_train_death, y_test_death = train_test_split(days_since_first_death\n                                                    , brazil_deaths\n                                                    , test_size= 10\n                                                    , shuffle=False\n                                                    , random_state = 42) ","75f6e78f":"# looking for best degree for deaths\nrmse = 10000\ndegree = 0\nfor i in range(101):\n    # Transform our cases data for polynomial regression\n    poly = PolynomialFeatures(degree=i)\n    poly_X_train = poly.fit_transform(X_train)\n    poly_X_test = poly.fit_transform(X_test)\n    poly_future_forcast = poly.fit_transform(future_forcast)\n\n    # polynomial regression cases\n    linear_model = LinearRegression(normalize=True, fit_intercept=False)\n    linear_model.fit(poly_X_train, y_train)\n    test_linear_pred = linear_model.predict(poly_X_test)\n    linear_pred = linear_model.predict(poly_future_forcast)\n\n    # evaluating with RMSE\n    rm = sqrt(mean_squared_error(y_test, test_linear_pred))\n    if(rm<rmse):\n        rmse = rm\n        degree = i\n    if(i==100):\n        print('the best mae is:',round(rmse,2))\n        print('the best degree for cases is:',degree)","f9417242":"# looking for best degree for deaths\nrmse = 10000\ndegree = 0\nfor i in range(101):\n    # Transform our death data for polynomial regression\n    poly_death = PolynomialFeatures(degree=i)\n    poly_X_train_death = poly_death.fit_transform(X_train_death)\n    poly_X_test_death = poly_death.fit_transform(X_test_death)\n    poly_future_forcast_death = poly_death.fit_transform(future_forcast_deaths)\n\n    # polynomial regression deaths\n    linear_model_death = LinearRegression(normalize=True, fit_intercept=False)\n    linear_model_death.fit(poly_X_train_death, y_train_death)\n    test_linear_pred_death = linear_model_death.predict(poly_X_test_death)\n    linear_pred_death = linear_model_death.predict(poly_future_forcast_death)\n\n     # evaluating with RMSE\n    rm = sqrt(mean_squared_error(y_test_death, test_linear_pred_death))\n    if(rm<rmse):\n        rmse = rm\n        degree = i\n    if(i==100):\n        print('the best mae is:',round(rmse,2))\n        print('the best degree for cases is:',degree)","ad153128":"# Transform our cases data for polynomial regression\npoly = PolynomialFeatures(degree=7)\npoly_X_train = poly.fit_transform(X_train)\npoly_X_test = poly.fit_transform(X_test)\npoly_future_forcast = poly.fit_transform(future_forcast)\n\n# Transform our death data for polynomial regression\npoly_death = PolynomialFeatures(degree=6)\npoly_X_train_death = poly_death.fit_transform(X_train_death)\npoly_X_test_death = poly_death.fit_transform(X_test_death)\npoly_future_forcast_death = poly_death.fit_transform(future_forcast_deaths)","72f6195e":"# polynomial regression cases\nlinear_model = LinearRegression(normalize=True, fit_intercept=False)\nlinear_model.fit(poly_X_train, y_train)\ntest_linear_pred = linear_model.predict(poly_X_test)\nlinear_pred = linear_model.predict(poly_future_forcast)\n\n# evaluating with RMSE\nprint('RMSE:', sqrt(mean_squared_error(y_test, test_linear_pred)))","497aeaee":"plt.figure(figsize=(12,7))\n\nplt.plot(y_test, label = \"Real cases\")\nplt.plot(test_linear_pred, label = \"Predicted\")\nplt.title(\"Predicted vs Real cases\", size = 20)\nplt.xlabel('Days', size = 15)\nplt.ylabel('Cases', size = 15)\nplt.xticks(size=12)\nplt.yticks(size=12)\n\n# defyning legend config\nplt.legend(loc = \"upper left\"\n           , frameon = True\n           , ncol = 2 \n           , fancybox = True\n           , framealpha = 0.95\n           , shadow = True\n           , borderpad = 1\n           , prop={'size': 15});","7d2fd13a":"plt.figure(figsize=(16, 9))\n\nplt.plot(adjusted_dates\n         , brazil_cases\n         , label = \"Real cases\")\n\nplt.plot(future_forcast\n         , linear_pred\n         , label = \"Polynomial Regression Predictions\"\n         , linestyle='dashed'\n         , color='orange')\n\nplt.title('Cases in Brazil over the time: Predicting Next 3 days', size=30)\nplt.xlabel('Days Since 2\/26\/20', size=30)\nplt.ylabel('Cases', size=30)\nplt.xticks(size=20)\nplt.yticks(size=20)\n\nplt.axvline(len(X_train), color='black'\n            , linestyle=\"--\"\n            , linewidth=1)\n\nplt.text(18, 5000\n         , \"model training\"\n         , size = 15\n         , color = \"black\")\n\nplt.text((len(X_train)+0.2), 15000\n         , \"prediction\"\n         , size = 15\n         , color = \"black\")\n\n# defyning legend config\nplt.legend(loc = \"upper left\"\n           , frameon = True\n           , ncol = 2 \n           , fancybox = True\n           , framealpha = 0.95\n           , shadow = True\n           , borderpad = 1\n           , prop={'size': 15})\n\nplt.show();","eb68efad":"#brazil['cases'].groupby(brazil['date']).sum().sort_values(ascending=True)[50:]","b10ad093":"last_predictions = pd.DataFrame([11358,12955,14842\n                                 ,17699,19662,21786\n                                 ,22927,25172,27576\n                                ,29127,31544,34091\n                                ,36399,38975,41622\n                                ,43905,43959,50150\n                                ,53847,57243,60754\n                                ,64343,68257,72326\n                                ,80683,87617,95599\n                                ,105137,111865,117749\n                                ,123360,130245,137383\n                                ,155546,166505,178187\n                                ,184195,196411,209366\n                                ,218811,231836,245470\n                                ,254394,268675,283579\n                                ,305524,323032,341383\n                                ,344890,366454,389838\n                                ,416676,437880,459836\n                                ,488148,513437,539800\n                                ,570328,598446,627637]\n                                , columns = ['Predicted']\n                                , index = ['04\/06\/20','04\/07\/20','04\/08\/20'\n                                           ,'04\/09\/20','04\/10\/20','04\/11\/20'\n                                          ,'04\/12\/20','04\/13\/20','04\/14\/20'\n                                          ,'04\/15\/20','04\/16\/20','04\/17\/20'\n                                          ,'04\/18\/20','04\/19\/20','04\/20\/20'\n                                          ,'04\/21\/20','04\/22\/20','04\/23\/20'\n                                          ,'04\/24\/20','04\/25\/20','04\/26\/20'\n                                          ,'04\/27\/20','04\/28\/20','04\/29\/20'\n                                          ,'04\/30\/20','05\/01\/20','05\/02\/20'\n                                          ,'05\/03\/20','05\/04\/20','05\/05\/20'\n                                          ,'05\/06\/20','05\/07\/20','05\/08\/20'\n                                          ,'05\/09\/20','05\/10\/20','05\/11\/20'\n                                          ,'05\/12\/20','05\/13\/20','05\/14\/20'\n                                          ,'05\/15\/20','05\/16\/20','05\/17\/20'\n                                          ,'05\/18\/20','05\/19\/20','05\/20\/20'\n                                          ,'05\/21\/20','05\/22\/20','05\/23\/20'\n                                          ,'05\/24\/20','05\/25\/20','05\/26\/20'\n                                          ,'05\/27\/20','05\/28\/20','05\/29\/20'\n                                          ,'05\/30\/20','05\/31\/20','06\/01\/20'\n                                          ,'06\/02\/20','06\/03\/20','06\/04\/20'])\n\nlast_predictions['Real cases'] = [12056,13717,15927\n                                  ,17857,19638,20727\n                                  ,22169,23430,25262\n                                 ,28320,30425,33682\n                                 ,36599,38654,40581\n                                 ,43079,45757,49492\n                                 ,52995,58509,61888\n                                 ,66501,71886,78162\n                                 ,85380,91589,96559\n                                 ,101147,107780,114715\n                                 ,125128,135106,145328\n                                 ,155939,162699,168331\n                                 ,177589,188974,202918\n                                 ,218223,233142,241080\n                                 ,254220,271628,291579\n                                 ,310087,330890,347398\n                                 ,363211,374898,391222\n                                 ,411821,438238,465166\n                                 ,498440,514200,526447\n                                 ,555383,584016,614941]\n\nlayout = Layout(\n    paper_bgcolor='rgba(0,0,0,0)'\n    , plot_bgcolor='rgba(0,0,0,0)'\n    , title=\"Last predictions vs Real cases\"\n)\n\nfig = go.Figure(data=[\n    \n    go.Line(name='Predicted'\n            , x=last_predictions.index\n            , y=last_predictions['Predicted']\n            , mode=\"lines+markers\")\n    , go.Line(name='Real cases'\n              , x=last_predictions.index\n              , y=last_predictions['Real cases']\n              , mode=\"lines+markers\")\n    \n])\n\nfig.update_layout(barmode='stack')\nfig['layout'].update(layout)\n\nfig.show()","3950dd52":"pd.DataFrame(linear_pred[len(cases):].astype('Int64'), columns = ['Predicted'], index = ['06-05-20','06-06-20','06-07-20']).style.background_gradient(cmap='Blues')","e300d98e":"# polynomial regression deaths\nlinear_model_death = LinearRegression(normalize=True, fit_intercept=False)\nlinear_model_death.fit(poly_X_train_death, y_train_death)\ntest_linear_pred_death = linear_model_death.predict(poly_X_test_death)\nlinear_pred_death = linear_model_death.predict(poly_future_forcast_death)\n\n# evaluating with RMSE\nprint('RMSE:', sqrt(mean_squared_error(y_test_death, test_linear_pred_death)))","0741e452":"plt.figure(figsize=(12,7))\n\nplt.plot(test_linear_pred_death, label = \"Predicted\")\nplt.plot(y_test_death, label = \"Real deaths\")\nplt.title(\"Predicted vs Real deaths\", size = 20)\nplt.xlabel('Days', size = 15)\nplt.ylabel('Deaths', size = 15)\nplt.xticks(size=12)\nplt.yticks(size=12)\n\n# defyning legend config\nplt.legend(loc = \"upper left\"\n           , frameon = True\n           , ncol = 2 \n           , fancybox = True\n           , framealpha = 0.95\n           , shadow = True\n           , borderpad = 1\n           , prop={'size': 15});","45f715be":"plt.figure(figsize=(16, 9))\n\nplt.plot(adjusted_dates_deaths\n         , brazil_deaths\n         , label = \"Real deaths\")\n\nplt.plot(future_forcast_deaths\n         , linear_pred_death\n         , label = \"Polynomial Regression Predictions\"\n         , linestyle='dashed'\n         , color='red')\n\nplt.title('Deaths in Brazil over the time: Predicting Next 3 days', size=30)\nplt.xlabel('Days Since 03\/17\/20', size=30)\nplt.ylabel('Deaths', size=30)\nplt.xticks(size=20)\nplt.yticks(size=20)\n\nplt.axvline(len(X_train_death), color='black'\n            , linestyle=\"--\"\n            , linewidth=1)\n\nplt.text(10, 200\n         , \"model training\"\n         , size = 15\n         , color = \"black\")\n\nplt.text((len(X_train_death)+0.2), 600\n         , \"prediction\"\n         , size = 15\n         , color = \"black\")\n\n# defyning legend config\nplt.legend(loc = \"upper left\"\n           , frameon = True\n           , ncol = 2 \n           , fancybox = True\n           , framealpha = 0.95\n           , shadow = True\n           , borderpad = 1\n           , prop={'size': 15})\n\nplt.show();","cdd180a0":"#brazil['deaths'].groupby(brazil['date']).sum().sort_values(ascending=True)[47:]","8144427e":"last_predictions = pd.DataFrame([574,678,799\n                                 ,876,998,1132\n                                ,1227,1375,1534\n                                ,1507,1633,1765\n                                ,2384,2616,2862\n                                ,2961,3215,3483\n                                ,3385,3603,3827\n                                ,4390,4688,4999\n                                ,5586,6028,6510\n                                ,7482,8083,8706\n                                ,7949,8343,8746\n                                ,10254,10861,11492\n                                ,12173,12879,13614\n                                ,14494,15279,16092\n                                ,17339,18279,19256\n                                ,19953,20946,21972\n                                ,21952,23010,24102\n                                ,26532,27741,28987\n                                ,28446,29469,30495\n                                ,31199,32548,34021]\n                                , columns = ['Predicted']\n                                , index = ['04\/06\/20','04\/07\/20','04\/08\/20'\n                                           ,'04\/09\/20','04\/10\/20','04\/11\/20'\n                                          ,'04\/12\/20','04\/13\/20','04\/14\/20'\n                                          ,'04\/15\/20','04\/16\/20','04\/17\/20'\n                                          ,'04\/18\/20','04\/19\/20','04\/20\/20'\n                                          ,'04\/21\/20','04\/22\/20','04\/23\/20'\n                                          ,'04\/24\/20','04\/25\/20','04\/26\/20'\n                                          ,'04\/27\/20','04\/28\/20','04\/29\/20'\n                                          ,'04\/30\/20','05\/01\/20','05\/02\/20'\n                                          ,'05\/03\/20','05\/04\/20','05\/05\/20'\n                                          ,'05\/06\/20','05\/07\/20','05\/08\/20'\n                                          ,'05\/09\/20','05\/10\/20','05\/11\/20'\n                                          ,'05\/12\/20','05\/13\/20','05\/14\/20'\n                                          ,'05\/15\/20','05\/16\/20','05\/17\/20'\n                                          ,'05\/18\/20','05\/19\/20','05\/20\/20'\n                                          ,'05\/21\/20','05\/22\/20','05\/23\/20'\n                                          ,'05\/24\/20','05\/25\/20','05\/26\/20'\n                                          ,'05\/27\/20','05\/28\/20','05\/29\/20'\n                                          ,'05\/30\/20','05\/31\/20','06\/01\/20'\n                                          ,'06\/02\/20','06\/03\/20','06\/04\/20'])\n\nlast_predictions['Real cases'] = [553,667,800\n                                  ,941,1056,1124\n                                 ,1223,1328,1534\n                                 ,1736,1924,2141\n                                 ,2347,2462,2575\n                                 ,2741,2906,3313\n                                 ,3670,4016,4205\n                                 ,4543,5017,5466\n                                 ,5901,6329,6724\n                                 ,7025,7321,7921\n                                 ,8536,9146,9897\n                                 ,10627,11123,11519\n                                 ,12400,13149,13993\n                                 ,14817,15633,16118\n                                 ,16792,17971,18859\n                                 ,20047,21048,22013\n                                 ,22666,23473,24512\n                                 ,25598,26754,27878\n                                 ,28834,29314,29937\n                                 ,33754,35094,36460]\n\nlayout = Layout(\n    paper_bgcolor='rgba(0,0,0,0)'\n    , plot_bgcolor='rgba(0,0,0,0)'\n    , title=\"Last predictions vs Real deaths\"\n)\n\nfig = go.Figure(data=[\n    \n    go.Line(name='Predicted'\n            , x=last_predictions.index\n            , y=last_predictions['Predicted']\n            , mode=\"lines+markers\")\n    , go.Line(name='Real deaths'\n              , x=last_predictions.index\n              , y=last_predictions['Real cases']\n              , mode=\"lines+markers\")\n    \n])\n\nfig.update_layout(barmode='stack')\nfig['layout'].update(layout)\n\nfig.show()","65a74c87":"pd.DataFrame(linear_pred_death[len(deaths):].astype('Int64'), columns = ['Predicted'], index = ['06-05-20','06-06-20','06-07-20']).style.background_gradient(cmap='Reds')","161fc9a1":"#### Total cases in other states vs S\u00e3o Paulo over the time\n\nThe first case appear in 2\/26\/20 but just start to explode after 3\/1\/20","1b295bdd":"### Modeling\n\nNow let's use our prepared data into poly.fit function and transform our data to be used into a regression latter. To find the best degree for our PolynomialFeatures function, let's use a simple loop that evaluate RMSE in test dataset and selected the best degree for the current prediction.","61c31607":"#### Top 10 countries VS Brazil since first case appear\n\nBrazil still are behind all other countries except for Turkey in number of cases but are growing fast but not so fast as Italy, Spain or US.","f9ca9d85":"#### Cases growth over the time in top 10 countries in confirmed cases numbers\n\nConfirmed cases explode in US and now United States are the first in the world in number of active cases, followed by Spain, Italy and France.","39794253":"#### Cases prediction for next 3 days","555a1915":"\n***NOTE: I will update the kernel every 3 days- Last update 06-04-20***\n\n##### Please let me know what you think about this kernel and if it is useful and you can leave an upvote I would be very grateful! :)","40f13d7c":"### Current situation in Brazil\n\n#### Total cases over the time","133736e4":"### Referencies\n\nhttps:\/\/www.kaggle.com\/elloaguedes\/panorama-do-covid-19-no-brasil\n\nhttps:\/\/www.kaggle.com\/dferhadi\/covid-19-predictions-growth-factor-and-calculus\/comments#783008\n\nhttps:\/\/www.kaggle.com\/therealcyberlord\/coronavirus-covid-19-visualization-prediction\n\nhttps:\/\/www.kaggle.com\/pedrohenriquecardoso\/predicting-covid-cases-with-lowest-rmse-possible","ff881eba":"#### Mortality rate by state","71e696f2":"### Introduction\n\nBrazil is a continental country, with pleasant places to visit, happy people and, now, unfortunately fighting the coronavirus. In this notebook, we will understand the current world situation, looking at the largest countries in confirmed number of cases, understanding how the cases grow after the first case appears, how Brazil is positioned in this whole scenario and  predict the cases and deaths in Brazil for the next 3 days using the Polynomial regression algorithm.","92f8d710":"#### Last predictions\n\nBellow you can see the predictions from last days vs real deaths","dbb29b73":"#### Total deaths in other states vs S\u00e3o Paulo over the time\n\nThe first death appear in 3\/17\/20 and continue to growth fast","7312f51e":"#### How much of confirmed and deaths cases are in S\u00e3o Paulo?\n\nClearly S\u00e3o Paulo are leading confirmed cases and deaths in Brazil, but, How much of all confirmed cases and deaths are in S\u00e3o Paulo?","d3aff948":"#### Training, predicting and evaluating polynomial regression into death cases","7f8464e6":"#### New cases and deaths per day over the time","9e752cb9":"### Current situation around the world in top 20 countries in number of confirmed cases\n\nChina controled the virus with only a fell active cases, US are leading with more than 1.8 million active cases, Brazil is now the second country with more confirmed cases in the world with more than 614000 cases and 34000 registered deaths.","6bd7da0d":"# Brazil infected! Coronavirus (Covid-19) Situation and Prediction\n### Current world situation, current Brazil situation VS top 10 countries and Predicting next 3 days cases and deaths with Polynomial Regression","f7f22f9f":"#### Training, predicting and evaluating polynomial regression into confirmed cases","772eb889":"#### Current situation in Brazil by region","67db1c62":"#### Thank you very much for read this kernel, if you think that this kernel was useful please give a upvote so i can continue to create quality content to all kagglers :)","ad73d429":"#### Current situation in Brazil by state\n\nS\u00e3o Paulo are leading in confirmed cases followed by Rio de Janeiro, S\u00e3o Paulo seems to have a great percentage of total cases in Brazil, let's see this foward.","80f6bc68":"#### Mortality rate over the time","a122f268":"#### Last predictions\n\nBellow you can see the predictions from last days vs real cases","6320bf7d":"### Preparing data for modeling\n\nTo modeling confirmed cases and deaths let's take cases and deaths since first case appear, convert our data into 1D arrays, split into train and test and train_death and test_death, transform our data using polynomial fit. Every 3 days let's add new data to make a new prediction.","0d86b4c9":"#### Deaths prediction for the next 3 days","29a985dc":"***Perfect!*** Now that we already have the bests degree for death and cases prediction, let's put into poly.fit again and transform our data for polynomial regression."}}