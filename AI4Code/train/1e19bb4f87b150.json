{"cell_type":{"604e155a":"code","a3e5c222":"code","6e7e2265":"code","329fd692":"code","0636b4fa":"code","f74b9245":"code","6912dd47":"code","502d0d8f":"code","0b1f245d":"code","05d61131":"code","092f8adf":"code","f4faa479":"code","e7192d83":"code","e91c6174":"code","7cf7f5ef":"code","ff4b5df7":"code","a66f82ef":"code","25263110":"code","a126eadb":"code","cbdc8aa4":"code","b22cd855":"code","dcab4a56":"code","3501cf47":"code","eacac728":"code","1a2f922c":"code","54d67c60":"code","1564e5f6":"code","ba52c369":"code","2e9a8f59":"markdown","e22217ec":"markdown","3784553b":"markdown","fde67139":"markdown","fd6eb008":"markdown","fd8f43dd":"markdown","6d65dc5b":"markdown","9727a6ff":"markdown","54accae0":"markdown","77f160b9":"markdown","6c6c1367":"markdown","9c744517":"markdown","8cf220c1":"markdown","2a086757":"markdown","f60dcbe0":"markdown","e26d8e66":"markdown","a2d67f9f":"markdown","470b5aaf":"markdown"},"source":{"604e155a":"#importing libraries\nimport numpy as np \nimport pandas as pd \nimport os\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport warnings\nwarnings.filterwarnings('ignore')","a3e5c222":"#importing the dataset\ndata=pd.read_csv('..\/input\/insurance\/insurance.csv')\ndata.sample(5)  #getting 5 samples from the dataset","6e7e2265":"data.info()","329fd692":"print(data['sex'].value_counts())\nsns.countplot(x='sex',data=data)","0636b4fa":"print(data['smoker'].value_counts())\nsns.countplot(x='smoker',data=data)","f74b9245":"print(data['region'].value_counts())\nsns.countplot(x='region',data=data)","6912dd47":"#label encoding all the categorical variables\nfrom sklearn.preprocessing import LabelEncoder\n#sex\nle = LabelEncoder()\nle.fit(data.sex.drop_duplicates()) \ndata.sex = le.transform(data.sex)\n# smoker or not\nle.fit(data.smoker.drop_duplicates()) \ndata.smoker = le.transform(data.smoker)\n#region\nle.fit(data.region.drop_duplicates()) \ndata.region = le.transform(data.region)","502d0d8f":"#checking correlation of the features with our target variable\nprint(data.corr()['charges'].sort_values())\nf, ax = plt.subplots(figsize=(10, 8))\ncorr = data.corr()\nsns.heatmap(corr, mask=np.zeros_like(corr, dtype=np.bool), cmap=sns.diverging_palette(240,10,as_cmap=True),\n            square=True,annot=True, ax=ax)","0b1f245d":"plt.figure(figsize=(14,8))\nsns.histplot(data=data,x='charges')","05d61131":"f= plt.figure(figsize=(12,5))\n\nax=f.add_subplot(121)\nsns.distplot(data[(data.smoker == 1)][\"charges\"],color='c',ax=ax)\nax.set_title('Distribution of charges for smokers')\n\nax=f.add_subplot(122)\nsns.distplot(data[(data.smoker == 0)]['charges'],color='b',ax=ax)\nax.set_title('Distribution of charges for non-smokers')","092f8adf":"sns.countplot(x=\"smoker\",hue = 'sex', palette=\"pink\", data=data,)","f4faa479":"plt.figure(figsize=(12,5))\nplt.title(\"Box plot for charges of women\")\nsns.boxplot(y=\"smoker\", x=\"charges\", data =  data[(data.sex == 1)] , orient=\"h\", palette = 'rainbow')","e7192d83":"plt.figure(figsize=(12,5))\nplt.title(\"Box plot for charges of men\")\nsns.boxplot(y=\"smoker\", x=\"charges\", data =  data[(data.sex == 0)] , orient=\"h\", palette = 'icefire')","e91c6174":"# let's see how the age affects the cost of patients\nplt.figure(figsize=(12,6))\nplt.title(\"Distribution of age\")\nax = sns.distplot(data[\"age\"], color = 'g')","7cf7f5ef":"plt.figure(figsize=(10,6))\nsns.countplot(x=\"smoker\",hue='sex', data=data[(data.age == 18)])\nplt.title(\"The number of smokers and non-smokers (18 years old)\")","ff4b5df7":"sns.lmplot(x=\"age\", y=\"charges\", hue=\"smoker\", data=data, palette = 'plasma', size = 7)\nax.set_title('Smokers and non-smokers')","a66f82ef":"plt.figure(figsize=(12,5))\nplt.title(\"Distribution of bmi\")\nax = sns.distplot(data[\"bmi\"], color = 'm')","25263110":"plt.figure(figsize=(12,5))\nplt.title(\"Distribution of charges for patients with BMI greater than 30\")\nax = sns.distplot(data[(data.bmi >= 30)]['charges'], color = 'r')","a126eadb":"plt.figure(figsize=(12,5))\nplt.title(\"Distribution of charges for patients with BMI less than 30\")\nax = sns.distplot(data[(data.bmi < 30)]['charges'], color = 'g')","cbdc8aa4":"# let's see the number of children present in our dataset\nsns.countplot(x=\"children\", palette=\"flare\", data=data,)","b22cd855":"R2_Scores = []\nmodels = ['Linear Regression', 'RandomForest Regression','XGBoost Regressor']","dcab4a56":"from sklearn.linear_model import LinearRegression\nfrom sklearn.tree import DecisionTreeRegressor\nfrom xgboost import XGBRegressor\nfrom sklearn.svm import SVR\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.pipeline import make_pipeline\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.model_selection import GridSearchCV , KFold , cross_val_score\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import r2_score,mean_squared_error\nfrom sklearn.ensemble import RandomForestRegressor\n\n#splitting the data into training and testing\nx = data.drop(['charges'], axis = 1)\ny = data.charges\n\nX_train,X_test,y_train,y_test = train_test_split(x,y, random_state = 42)\n# Linear Regression\nlin_reg =make_pipeline(StandardScaler(),LinearRegression())\nlin_reg.fit(X_train , y_train)\naccuracies = cross_val_score(estimator = lin_reg, X = X_train, y = y_train, cv = 10)\ny_pred = lin_reg.predict(X_test)\nprint('')\nprint('     Linear Regression      ')\nprint('Score : %.4f' % lin_reg.score(X_test, y_test))\nprint( accuracies)\nprint('Mean score: %0.3f'% accuracies.mean())\n\nmse = mean_squared_error(y_test, y_pred)\nrmse = mean_squared_error(y_test, y_pred)**0.5\nr2 = r2_score(y_test, y_pred)\nprint('')\nprint('MSE    : %0.2f ' % mse)\nprint('RMSE   : %0.2f ' % rmse)\nprint('R2     : %0.2f ' % r2)\nR2_Scores.append(r2)","3501cf47":"# Random Forrest\nclf_rf = RandomForestRegressor()\nclf_rf.fit(X_train , y_train)\naccuracies = cross_val_score(estimator = clf_rf, X = X_train, y = y_train, cv = 10)\ny_pred = clf_rf.predict(X_test)\nprint('')\nprint('     Random Forest     ')\nprint('Score : %.4f' % clf_rf.score(X_test, y_test))\nprint(accuracies)\nprint('Mean: %0.3f' % accuracies.mean())\n\nmse = mean_squared_error(y_test, y_pred)\nrmse = mean_squared_error(y_test, y_pred)**0.5\nr2 = r2_score(y_test, y_pred)\nprint('')\nprint('MSE    : %0.2f ' % mse)\nprint('RMSE   : %0.2f ' % rmse)\nprint('R2     : %0.2f ' % r2)\nR2_Scores.append(r2)","eacac728":"# XGBoost\nclf_xgb = XGBRegressor()\nclf_xgb.fit(X_train , y_train)\naccuracies = cross_val_score(estimator = clf_xgb, X = X_train, y = y_train, cv = 10)\ny_pred = clf_xgb.predict(X_test)\nprint('')\nprint('     XGBoost     ')\nprint('Score : %.4f' % clf_xgb.score(X_test, y_test))\nprint(accuracies)\nprint('Mean: %0.3f' % accuracies.mean())\n\nmse = mean_squared_error(y_test, y_pred)\nrmse = mean_squared_error(y_test, y_pred)**0.5\nr2 = r2_score(y_test, y_pred)\nprint('')\nprint('MSE    : %0.2f ' % mse)\nprint('RMSE   : %0.2f ' % rmse)\nprint('R2     : %0.2f ' % r2)\nR2_Scores.append(r2)","1a2f922c":"compare = pd.DataFrame({'Algorithms' : models , 'R2-Scores' : R2_Scores})\ncompare.sort_values(by='R2-Scores' ,ascending=False)","54d67c60":"from sklearn.model_selection import GridSearchCV\n\nparam_grid = {  'bootstrap': [True], 'max_depth': [5, 10, None], 'max_features': ['auto', 'log2','sqrt'],\n               'n_estimators': [10,25,50,100]}\n\ng_search = GridSearchCV(estimator = clf_rf, param_grid = param_grid, \n\n                          cv = 3, n_jobs = 1, verbose = 0, return_train_score=True)","1564e5f6":"#finding the best parameters for our model\ng_search.fit(X_train, y_train)\nprint(g_search.best_params_)","ba52c369":"# Random Forrest\nclf_rf = RandomForestRegressor(bootstrap=True,max_depth=5,max_features=6,n_estimators=100)\nclf_rf.fit(X_train , y_train)\naccuracies = cross_val_score(estimator = clf_rf, X = X_train, y = y_train, cv = 10)\ny_pred = clf_rf.predict(X_test)\nprint('')\nprint('     Random Forest     ')\nprint('Score : %.4f' % clf_rf.score(X_test, y_test))\nprint(accuracies)\nprint('Mean: %0.3f' % accuracies.mean())\n\nmse = mean_squared_error(y_test, y_pred)\nrmse = mean_squared_error(y_test, y_pred)**0.5\nr2 = r2_score(y_test, y_pred)\nprint('')\nprint('MSE    : %0.2f ' % mse)\nprint('RMSE   : %0.2f ' % rmse)\nprint('R2     : %0.2f ' % r2)\nR2_Scores.append(r2)","2e9a8f59":"we can observe from the dataset that for people who don't smoke the cost increases with their age but we don't see such dependencies for smokers.","e22217ec":"we can see that the R2 score increased by 0.1 and the Mean score increased by 0.2 after tuning the hyperparameters.","3784553b":"# Exploratory Data Analysis","fde67139":"we can see that there are a few 18 year olds (both male and female) that are smokers","fd6eb008":"we can see that more men smoke (sex 0 means men) so we can also assume that the charges of treatment for men would be more compared to women","fd8f43dd":"we can observe from the graph that most of the people have charges between 0 to 10000 and the people keep decreasing as the charges increase","6d65dc5b":"we can see that most of our patients (about 600) don't have kids and a few having 4,5 kids","9727a6ff":"we can see that most of the people are non-smokers with about 20% of the people being smokers","54accae0":"we can see that none of the columns have null values so we don't need to perform data cleaning ","77f160b9":"we can observe that people with BMI greater than 30 tend to spend more on treatments","6c6c1367":"we can observe from the above distplot that average BMI of the person present in the dataset is 30. Now let's try to see the affect of BMI on their charges","9c744517":"we can see that the number of male and females present in our dataset is almost same","8cf220c1":"we can see that Random Forest gives us the best R2 scores with 84% accuracy, let's try to implement grid search to tune its hyperparameters to increase the R2 score","2a086757":"value of all the regions are almost the same with southeast having slightly high number of people","f60dcbe0":"we can see that there is a strong correlation between smoker , which makes sense","e26d8e66":"# Applying ML Algorithms","a2d67f9f":"we can observe from the graph that people who smoke tend to spend more on treatments than non smokers . See, that's why you shouldn't smoke :)","470b5aaf":"we can see that most of the people in the dataset are 20-25 years old and minimum age is 18 while 64 being highest . Now let's take a look at how many of 18 years old are smokers"}}