{"cell_type":{"0ac6301e":"code","4771ca31":"code","3065deb3":"code","c1ec89c3":"code","f95f65d2":"code","5d740a0e":"code","a966247b":"code","bbc127b8":"code","29a419b1":"code","2ddc7ca9":"code","1fe584e6":"code","bb9e6f7a":"code","2fb3cf30":"code","aaf09d8a":"code","72503a6c":"code","495d382b":"code","0656074e":"code","dcb08fad":"code","f6f2a5d7":"code","99fd4505":"code","07503102":"code","f8a0bbc1":"code","51403e25":"code","4024b13d":"code","b5c128b3":"code","152b61eb":"code","e4ac9272":"code","17bd4e85":"code","f28ea9c2":"code","b100af67":"code","0ce3968b":"code","9b63988f":"code","2083e106":"code","cbf7191a":"code","40ea102b":"code","ec66f05a":"code","b8e2ee11":"code","ec92e047":"code","75d7e6a3":"code","9cdd820e":"code","b1ab4f42":"code","2a722575":"code","676df278":"code","905439f5":"code","8e3f0210":"code","fef0dc8a":"code","12fbefa2":"code","ca03efdf":"code","8b275419":"code","ccc9a45f":"code","bcfaab3c":"code","3fc389d3":"code","2e3f165e":"code","b5437671":"code","d7085fc6":"code","2c14a53d":"code","a95ae30c":"code","fdaecfa2":"code","050aae87":"code","4674e40f":"code","140f04ba":"code","e1c33c97":"code","be2d329e":"code","4ce65d49":"code","441dc07e":"markdown","7004dc8c":"markdown","e112880d":"markdown","9e7d1a96":"markdown","3a2c5aa9":"markdown","ca0e5841":"markdown","59141791":"markdown","3a15a309":"markdown","29055962":"markdown","1fd69d9c":"markdown","5910aba4":"markdown","801a3e74":"markdown","0e68a6ae":"markdown","e34afc2b":"markdown","699c19cc":"markdown","fa0ecba8":"markdown","a8d97cce":"markdown","634c8bac":"markdown","7a234a1d":"markdown","28941db6":"markdown","a9fe3fd7":"markdown","2a00f37b":"markdown","b5ee26f7":"markdown","426f98e2":"markdown","b02eed35":"markdown","7055c9b5":"markdown","2e22cb39":"markdown","3e32d742":"markdown","8d066fbc":"markdown","4019aec6":"markdown","7a343701":"markdown","708bcf5e":"markdown","0452cf0c":"markdown","8e3fc5d5":"markdown","1b436e09":"markdown","e5210702":"markdown","b3fda261":"markdown","7d809e91":"markdown","379a7641":"markdown","0f41532f":"markdown","4c39854e":"markdown","9eac2195":"markdown","299f6347":"markdown","0b2869ba":"markdown","ca01d724":"markdown","64ae6f31":"markdown","c70c79c6":"markdown","e7e3a610":"markdown","7c94995c":"markdown","d15d1940":"markdown","87489034":"markdown","82e116b3":"markdown","3d5a394b":"markdown","9d1a9d58":"markdown","582cb75e":"markdown"},"source":{"0ac6301e":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns","4771ca31":"sns.set_style('darkgrid')\nsns.set_context('talk')\nplt.rcParams['figure.figsize'] = (20, 10)","3065deb3":"df = pd.read_csv('..\/input\/students-performance-in-exams\/StudentsPerformance.csv')","c1ec89c3":"df.head(10)","f95f65d2":"df.info()","5d740a0e":"score_cols = ['math score', 'reading score', 'writing score']\nfeatures = ['gender', 'lunch', 'parental level of education', 'test preparation course']","a966247b":"score_cols = ['math score', 'reading score', 'writing score']","bbc127b8":"df[score_cols].describe()","29a419b1":"sns.displot(df[score_cols], height=8, aspect=2, kde=True, alpha=0.3);","2ddc7ca9":"sns.heatmap(df[score_cols].corr(), annot=True);","1fe584e6":"def plot_hist(df, x, cat_var, alpha=0.5, kde=True):\n    sns.histplot(data=df, x=x, alpha=alpha, kde=kde, legend=True, hue=cat_var);\n    for value in df[cat_var].unique():\n        plt.axvline(df[df[cat_var] == value][x].mean(), linewidth=2, label=\"mean\", alpha=0.8, color='black')\n        plt.text(df[df[cat_var] == value][x].mean(), 2, value, rotation=90)","bb9e6f7a":"df['gender'].value_counts()","2fb3cf30":"sns.histplot(df['gender']);","aaf09d8a":"plot_hist(df, 'math score', 'gender')","72503a6c":"df[df['gender'] == 'male']['math score'].mean() - df[df['gender'] == 'female']['math score'].mean()","495d382b":"plot_hist(df, 'reading score', 'gender')","0656074e":"df[df['gender'] == 'male']['reading score'].mean() - df[df['gender'] == 'female']['reading score'].mean()","dcb08fad":"plot_hist(df, 'writing score', 'gender')","f6f2a5d7":"df[df['gender'] == 'male']['writing score'].mean() - df[df['gender'] == 'female']['writing score'].mean()","99fd4505":"df['test preparation course'].value_counts()","07503102":"sns.histplot(df['test preparation course']);","f8a0bbc1":"plot_hist(df, 'math score', 'test preparation course')","51403e25":"df[df['test preparation course'] == 'completed']['math score'].mean() - df[df['test preparation course'] == 'none']['math score'].mean()","4024b13d":"plot_hist(df, 'reading score', 'test preparation course')","b5c128b3":"df[df['test preparation course'] == 'completed']['reading score'].mean() - df[df['test preparation course'] == 'none']['reading score'].mean()","152b61eb":"plot_hist(df, 'writing score', 'test preparation course')","e4ac9272":"df[df['test preparation course'] == 'completed']['writing score'].mean() - df[df['test preparation course'] == 'none']['writing score'].mean()","17bd4e85":"df['parental level of education'].value_counts()","f28ea9c2":"sns.histplot(df['parental level of education']);","b100af67":"plt.figure(figsize=(35, 10))\nplot_hist(df, 'math score', 'parental level of education')","0ce3968b":"df.groupby('parental level of education').mean()['math score'].sort_values()","9b63988f":"plt.figure(figsize=(25, 10))\nplot_hist(df, 'reading score', 'parental level of education')","2083e106":"df.groupby('parental level of education').mean()['reading score'].sort_values()","cbf7191a":"plt.figure(figsize=(25, 10))\nplot_hist(df, 'writing score', 'parental level of education')","40ea102b":"df.groupby('parental level of education').mean()['writing score'].sort_values()","ec66f05a":"df['lunch'].value_counts()","b8e2ee11":"sns.histplot(df['lunch']);","ec92e047":"plot_hist(df, 'math score', 'lunch')","75d7e6a3":"df[df['lunch'] == 'standard']['math score'].mean() - df[df['lunch'] == 'free\/reduced']['math score'].mean()","9cdd820e":"plot_hist(df, 'reading score', 'lunch')","b1ab4f42":"df[df['lunch'] == 'standard']['reading score'].mean() - df[df['lunch'] == 'free\/reduced']['reading score'].mean()","2a722575":"plot_hist(df, 'writing score', 'lunch')","676df278":"df[df['lunch'] == 'standard']['writing score'].mean() - df[df['lunch'] == 'free\/reduced']['writing score'].mean()","905439f5":"from sklearn.linear_model import LinearRegression","8e3f0210":"lr = LinearRegression()","fef0dc8a":"from sklearn.multioutput import MultiOutputRegressor","12fbefa2":"multi_lr = MultiOutputRegressor(lr)","ca03efdf":"X = df[features]\ny = df[score_cols]","8b275419":"X","ccc9a45f":"from sklearn.preprocessing import OneHotEncoder","bcfaab3c":"onehot = OneHotEncoder()\nX_enc = onehot.fit_transform(X)","3fc389d3":"multi_lr.fit(X_enc, y)","2e3f165e":"multi_lr.score(X_enc, y)","b5437671":"multi_lr.estimators_[0].coef_","d7085fc6":"onehot.get_feature_names()","2c14a53d":"fi_df = pd.DataFrame()","a95ae30c":"onehot.get_feature_names(features)","fdaecfa2":"fi_df['features'] = onehot.get_feature_names(features)","050aae87":"fi_df['math_importance'] = multi_lr.estimators_[0].coef_\nfi_df['reading_importance'] = multi_lr.estimators_[1].coef_\nfi_df['writing_importance'] = multi_lr.estimators_[2].coef_","4674e40f":"fi_df","140f04ba":"fi_df.plot(x=\"features\", y=['math_importance', 'reading_importance', 'writing_importance'], kind=\"bar\");","e1c33c97":"fi_df_melted = fi_df.melt('features', var_name='subject', value_name='importance')","be2d329e":"fi_df_melted","4ce65d49":"sns.barplot(data=fi_df_melted, x='features', y='importance', hue='subject');\nplt.xticks(rotation=75);","441dc07e":"#### Distribution of gender in the data","7004dc8c":"### Effect of parental level of education on scores","e112880d":"So the test preparation course was most effective for writing, and surprisingly the least effect for math. ","9e7d1a96":"Even with a cursory glance, the reading and writing scores look pretty similar, which I kind of expected. The math scores aren't too far off, but out of all three, they are the lowest with a mean of 66. Reading and writing have a mean of 69 and 68 respectively.","3a2c5aa9":"## The Data","ca0e5841":"To find out what feature these coefficients correspond to, we'll use our one-hot encoder.","59141791":"For math, we see a difference of 5 marks. Not as much as I expected, but still a good amount.","3a15a309":"#### With Seaborn\nLet's see how to create the same plot using seaborn. For that, we'll need to `melt` our dataframe so that all the numeric values are in a single column.","29055962":"## Exploratory Data Analysis\nThis notebook is contains my analysis of the Student Performance in Exams Dataset. The dataset contains students' scores in three subjects along with factors that may have affected those scores, like parental income, parental level of education, gender, etc.\n\nAn EDA along with analyzing feature importance for a linear regression model are demonstrated in this notebook.","1fd69d9c":"Let's see how the first few rows look like.","5910aba4":"#### Seeing how correlated they are\nWe'll use pearson correlation to quantify what we obversed visually.","801a3e74":"Still a significant difference due to income levels. Its probably less than that for math scores since math is more intensive and may require formal practise like tutors which parents may not be able to provide.","0e68a6ae":"Just like we expected, female students handily outperform males when it comes to writing. The gap is over 9 marks.","e34afc2b":"#### Evaluating the Linear Regression model\nWe'll use `sklearn`'s `score` method that computes $R^2$, called the **coefficient of determination**. According to `sklearn`,\n> The coefficient of determination  is defined as\n> $$ R^2 = 1 - \\frac{u}{v}$$\n>  \n> where $u$ is the residual sum of squares ((y_true - y_pred)** 2).sum() and $v$ is the total sum of squares ((y_true - y_true.mean()) ** 2).sum(). The best possible score is 1.0 and it can be negative (because the model can be arbitrarily worse). A constant model that always predicts the expected value of y, disregarding the input features, would get a  score of 0.0.\n\nMore intuitively, $R^2$ tells you how much of the total variance is explained by the model. Though it would seem like its a simple measure of how good a model fits a dataset, there's a lot more to correctly interpreting $R^2$ values, but that's a topic for another time.\n\nSince we're using a multioutput wrapper, the returned $R^2$ value would be the mean of the value for each predictor.","699c19cc":"We'll now analyze the relationship between each feature and these scores.","fa0ecba8":"The difference for math scores is very pronounced, as we expected.","a8d97cce":"#### Checking their distributions\nWe'll make a simple count vs score plot for all three scores simultaneously. We'll look for interesting patterns here.","634c8bac":"## Imports and Configuration\nSome basic processing and plotting libraries are imported.","7a234a1d":"The 0.95 correlation confirms our observations.","28941db6":"The distribution is fairly balanced. Let's see how individual scores are affected by gender using our utility function.","a9fe3fd7":"This result surprised me the most, but since I don't know the age group these students belong to, practising reading may be very effective for them. At least, that's what our analysis showed. As always, we can expect a similar trend for writing due to a high correlation.","2a00f37b":"Just like the reading scores, writing scores show significant impact of parental education levels. In fact, the variation here is 13 marks, the highest of the three scores.","b5ee26f7":"We'll quickly check some basic statistics about these scores.","426f98e2":"The same holds for reading scores, though the variation of scores of students with highly educated parents and those with less educated parents is more pronounced -- its about 11 marks, which is pretty significant considering the fact that the scores are out of 100.","b02eed35":"## Feature Importance\nIf we wanted to find which of these features actually have a significant impact on the subject scores, we can simply use a regression model (since we're regressing on the scores). It may seem odd to predict numbers strictly from categorical values, so something to keep in mind is that this is supervised. We're aren't pulling these predictions out of thin air.\n\nAnother point to keep in mind is that we aren't expecting our model to represent a lot of the variance. That is, we expect a pretty low value for $R^2$. Let's try `sklearn`'s `LinearRegression` model to see how it performs.","7055c9b5":"#### Utility function\nThis function plots a target score's distribution with respect to a single feature. It also marks the mean of each distribution. We'll use it to quickly look at how each feature affects the scores.","2e22cb39":"## Relationship between individual features and targets","3e32d742":"Some imbalance exists.","8d066fbc":"Let's create a dataframe summarizing all this.","4019aec6":"About the same as for reading, just slightly higher.","7a343701":"### Effect of taking the preparation course on scores\nThis seems to be a foregone conclusion. You would have to be very lucky to do better on a test without preparation than you would have if you had prepared well. The question here is just how effective this preparation course is.","708bcf5e":"### Effect of Gender on Scores\nI don't expect one gender to have a higher scores over the other in every case, but this isn't real data, so let's find out.","0452cf0c":"## Analysis\nLooking at the data, the most interesting questions for me are:\n\n* the relationship between the three scores\n* the effect of gender on scores\n* the effect of parental education on scores\n* the effect of family income (lunch subsidies) on scores\n* the effect of test preparedness on scores","8e3fc5d5":"A bit on the lower side, but just because its a low value doesn't mean that the model is completely useless. Regardless, the model is unlikely to give very precise predictions. This is where analyzing a linear model comes in. Other factors must be considered before concluding anything based solely on the $R^2$ value.","1b436e09":"### Effect of family income on scores\nJust like parental education levels, students with family income above a certain threshold have a certain advantage compared to their peers. In a purely academic sense, they can get extra help like hiring tutors or attending enrichment summer schools. They are also less likely to miss school, since their poorer counterparts have to deal with issues like lack of food or proper school supplies. Lets see what our data has to say about this.","e5210702":"### Setting some basic configuration for plotting","b3fda261":"### Saving the dependent and independent variables\nLet's split the columns into two lists for easier filtering later on.","7d809e91":"### Computing coefficients\nSince we fit one linear regression model for each target variable, we can directly access the coefficient of each variable. For example, the coefficients for the math score predictor can be found below.","379a7641":"### Encoding the data","0f41532f":"### The results","4c39854e":"<div style=\"width:100%;text-align: center;\">\n    <img align=\"middle\" src=\"https:\/\/source.unsplash.com\/dGxOgeXAXm8\/700x500\" alt=\"Unsplash computer image with cat\">\n<\/div>","9eac2195":"This plot is consistent with the findings from our EDA. Let's look at each feature and summarize this experiment.\n- **Gender**:\nAs we found in our EDA, and according to this dataset, males are better at Math while females are better at reading and writing. The feature importance plot above shows exactly this.\n- **Lunch - free\/ reduced or standard rate:**\nThis feature represents parental income, since that's the basis of deciding which students get free or reduced rates for lunch. Just like our EDA, its clear that parental income is positively correlated with higher scores in all three subjects.\n- **Level of Parental Education**:\nThis one is also pretty straightforward. Lower levels of education (High School) are negatively correlated with scores while students of parents with masters degrees have the greatest chance of getting the highest scores.\n- **Taking the test preparation course**:\nClearly, taking the preparatory course should have a strong positive impact on scores, and that's exactly what we see here.","299f6347":"For math, male students seem to outperform female students on average by about 5 marks.","0b2869ba":"We see some imbalance here, unlike the nearly perfectly balanced gender distribution. Let's see how test scores are affected by taking the preparation course. Personally, I expect math and writing to have a significant difference between mean scores of prepared and unprepared students, while they may not be as significant for reading.","ca01d724":"Its clear how similar the distributions are, especially the reading and writing scores. You can also see that the means for reading and writing are higher than that for math.","64ae6f31":"### Modelling","c70c79c6":"We'll check the dataframe for counts and to get an idea of dtypes.","e7e3a610":"#### MultiOutputRegressor\nWe have three target variables, so let's wrap our LinearRegression model in sklearn's `MultiOutputRegressor`. Internally, it fits one regressor for each target.","7c94995c":"Coming to the reading scores, females outperform male students by about 7 marks. This is a bigger difference than the math scores. Since writing and reading scores are -- understandably -- highly correlated, we can expect a similar result for writing scores.","d15d1940":"The higher the level of parental education, the more likely they are to be financially stable and be able to help their children, especially academically, like hiring tutors. So I expect student scores to correlate at least to some extent with parental levels of education.","87489034":"## Conclusion\nThe dataset was pretty straightforward to analyze. Factors that we know for a fact have a positive impact on scores, like advanced parental education, high family income and whether a student has taken a preparatory course show up as having a high impact in our analysis and experiments.\n\nSimilarly, negative factors like low income, lower levels of parental education and not taking the preparatory course all have corresponding negative effects on student scores.\n\nGender was the only factor where we couldn't intuitively say which gender would score better, and in which subjects. This data is synthetically generated, and a small one at that, so it doesn't make sense to make generalized conclusions, but according to this dataset, we can conclude that:\n- females do much better at reading and writing\n- males are better at math\n\nHopefully, this notebook gave you an idea of how seaborn can be used to create really nice, and more importantly, really informative visualizations. Do upvote if it helped, and feel free to fork it and play around.","82e116b3":"Looking at the distributions, children of parents with masters and bachelors degrees score on average 7 marks more than those whose parents have students till high school. This is consistent with our expecations.","3d5a394b":"### Scores\nBefore we get into our features, we'll first look at the three kinds of scores themselves. Let's see if there's something interested about these scores.","9d1a9d58":"The distribution here is a little haphazard, with less data for parents with masters while high school and college degrees are in the majority. Let's see how these levels actually affect student scores.","582cb75e":"#### Note\nI'm not including race \/ ethnicity in the EDA since the values are replaced by letters and so I can't validate my expectations with this data."}}