{"cell_type":{"9b101dcd":"code","47592239":"code","d4d2314f":"code","ff199ccd":"code","d2a2abb2":"code","480fdaf4":"code","93df19c2":"code","c62cf24d":"markdown","073c49c0":"markdown","af538463":"markdown","7a70d803":"markdown","08c3c9c4":"markdown","b3ea0bc9":"markdown","3b2c0a6e":"markdown"},"source":{"9b101dcd":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Import data\ndf = pd.read_csv('..\/input\/train.csv')\n\n# Split into numeric and enumerated types\nenumSeries = []\nnumSeries = []\nnonDiscreteSeries = []\nfor colname in df.columns:\n    datatype = str(df[colname].dtype)\n    if colname == 'Id' or colname == 'SalePrice':\n        pass\n    elif datatype == 'int64' or datatype == 'float64':\n        numSeries.append(colname)\n    else:\n        enumSeries.append(colname)\n        \n# Fill in some missing values\ndf.fillna(pd.Series([0,1970,0, 5, 3, 3, 0, 0, 0, 0, 0, 0, 0, 0], index=['LotFrontage', 'GarageYrBlt', 'MasVnrArea', 'OverallQual', 'GrLivArea10', 'GarageCars', '1stFlrSF10', 'TotalBsmtSF', 'GarageArea', 'BsmtFullBath', 'BsmtUnfSF', 'BsmtHalfBath', 'BsmtFinSF2', 'BsmtFinSF1']), inplace=True)\nassert df[pd.isnull(df[numSeries]).any(axis=1)][numSeries].shape[0] == 0\n\n# Take logarithms of some values\ndf['LotAreaLog10'] = np.log10(df['LotArea'].values)\ndf['1stFlrSFLog10'] = np.log10(df['1stFlrSF'].values)\ndf['GrLivAreaLog10'] = np.log10(df['GrLivArea'].values)\ndf['SalePriceLog10'] = np.log10(df['SalePrice'].values)\nif 'LotArea' in numSeries:\n    numSeries.remove('LotArea')\n    numSeries.append('LotAreaLog10')\nif '1stFlrSF' in numSeries:\n    numSeries.remove('1stFlrSF')\n    numSeries.append('1stFlrSFLog10')\nif 'GrLivArea' in numSeries:\n    numSeries.remove('GrLivArea')\n    numSeries.append('GrLivAreaLog10')\n\ndf[numSeries].head()","47592239":"import operator\n\nallEnums = []\nfor seriesName in enumSeries:\n    allEnums.append([])\n    enums = df[seriesName].value_counts()\n    for enum in enums.index.values:\n        allEnums[-1].append({ 'name': enum, 'series': seriesName, 'mean': df.query(seriesName + ' == \"' + enum + '\"')['SalePrice'].mean(), 'count': df.query(seriesName + ' == \"' + enum + '\"')['SalePrice'].count() })\n    if pd.isnull(df[seriesName]).any():\n        val = 0.0\n        allEnums[-1].append({ 'name': None, 'series': seriesName, 'mean': df.query(seriesName + ' != ' + seriesName)['SalePrice'].mean(), 'count': df.query(seriesName + ' == \"' + enum + '\"')['SalePrice'].count() })\n    else:\n        val = 1.0                    \n    allEnums[-1] = sorted(allEnums[-1], key=lambda k: k['mean'])\n    meanSumForNull = 0.0\n    meanCntForNull = 0\n    for enumDict in allEnums[-1]:\n        enumDict['value'] = val\n        meanSumForNull += val * enumDict['count']\n        meanCntForNull += enumDict['count']\n        val += 1.0\n    if not pd.isnull(df[seriesName]).any():\n        allEnums[-1].append({ 'name': None, 'series': seriesName, 'mean': 0, 'value': meanSumForNull \/ float(meanCntForNull), 'count': 0 })    \nfor enumCollection in allEnums:\n    for enumDict in enumCollection:\n        if enumDict['name']:\n            print(enumDict['series'] + '-' + enumDict['name'] + ': ' + str(enumDict['value']) + ' (' + str(enumDict['count']) + ')')\n        else:\n            print(enumDict['series'] + '-NULL: ' + str(enumDict['value']) + ' (' + str(enumDict['count']) + ')')\n                            ","d4d2314f":"for enumCollection in allEnums:\n    srcCol = enumCollection[0]['series']\n    destCol = enumCollection[0]['series'] + 'Numeric'\n    mapping = {}\n    naValue = 0.0\n    for enumDict in enumCollection:\n        if enumDict['name']:\n            mapping[enumDict['name']] = enumDict['value']\n        else:\n            naValue = enumDict['value']\n    df[destCol] = df[srcCol].map(mapping)\n    df[destCol].fillna(naValue, inplace=True)\n    if not destCol in numSeries:\n        numSeries.append(destCol)\ndf[numSeries].head()","ff199ccd":"from sklearn.model_selection import GridSearchCV\nfrom sklearn.linear_model import Ridge\n\nridge = Ridge()\nparameters = { 'alpha': [ 1e-15, 1e-10, 1e-8, 1e-4, 1e-3, 1e-2, 1, 5, 10, 20 ]}\nridge_regressor = GridSearchCV(ridge, parameters, scoring='neg_mean_squared_error', cv=5)\nridge_regressor.fit(df[numSeries].values, df['SalePriceLog10'])\nprint(ridge_regressor.best_params_)","d2a2abb2":"from sklearn.metrics import mean_absolute_error\nridge = Ridge(alpha=1)\nridge.fit(df[numSeries].values, df['SalePriceLog10'])\nridgePredictions = np.power(10, ridge.predict(df[numSeries].values))\ntargets = np.power(10, df['SalePriceLog10'])\nmae = mean_absolute_error(ridgePredictions, targets)\nmae","480fdaf4":"tdf = pd.read_csv('..\/input\/test.csv')\ntdf.fillna(pd.Series([0,1970,0, 5, 3, 3, 0, 0, 0, 0, 0, 0, 0, 0], index=['LotFrontage', 'GarageYrBlt', 'MasVnrArea', 'OverallQual', 'GrLivArea10', 'GarageCars', '1stFlrSF10', 'TotalBsmtSF', 'GarageArea', 'BsmtFullBath', 'BsmtUnfSF', 'BsmtHalfBath', 'BsmtFinSF2', 'BsmtFinSF1']), inplace=True)\ntdf['LotAreaLog10'] = np.log10(tdf['LotArea'].values)\ntdf['1stFlrSFLog10'] = np.log10(tdf['1stFlrSF'].values)\ntdf['GrLivAreaLog10'] = np.log10(tdf['GrLivArea'].values)\nfor enumCollection in allEnums:\n    srcCol = enumCollection[0]['series']\n    destCol = enumCollection[0]['series'] + 'Numeric'\n    mapping = {}\n    naValue = 0.0\n    for enumDict in enumCollection:\n        if enumDict['name']:\n            mapping[enumDict['name']] = enumDict['value']\n        else:\n            naValue = enumDict['value']\n    tdf[destCol] = tdf[srcCol].map(mapping)\n    tdf[destCol].fillna(naValue, inplace=True)\n    if not destCol in numSeries:\n        numSeries.append(destCol)\nassert tdf[pd.isnull(tdf[numSeries]).any(axis=1)][numSeries].shape[0] == 0\ntdf[numSeries].head()","93df19c2":"ridgeFinalPredictions = np.power(10, ridge.predict(tdf[numSeries].values))\nassert ridgeFinalPredictions.shape[0] == tdf['Id'].shape[0]\nres = pd.DataFrame([tdf['Id'], ridgeFinalPredictions]).transpose().rename(columns={'Unnamed 0': 'SalePrice'})\nres.Id = res.Id.astype(int)\nres.to_csv('submission.csv', index=False)\nres","c62cf24d":"This suggests we might have a new winning model. Let's prepare our test data in the same manner...","073c49c0":"Let's find our $\\alpha$ for ridge regression...","af538463":"With $\\alpha = 1$, let's the get he mean absolute erorr:","7a70d803":"And now run our model...","08c3c9c4":"To this point I've simply used the enumerated types to pick one of five different linear models. I want to see what happens when we use the enumerated types as an input to the linear models. I'm going to start what I've done prior but not going to explain it (check my earlier kernels if you're interested)...","b3ea0bc9":"The following code is almost as long as the previous but essentially takes all enumerated values within each series and sorts them by the mean sale price. Importantly null values are treated as just another enumerated type. The sorted enumerated values are then assigned nominal numeric values but so these values ascend with the sorting. With this more thoughtful assignment of numeric values it is hoped the ridge regression will perform better. The output is:\n\n```\nSERIES-ENUM: NUMERIC (COUNT)\n```\n\nwhere `SERIES` is the series name, `ENUM` is the enumerated value, `NUMERIC` the nominal numeric value and `COUNT` the count of that enumerated value in the training set\n\nFor cases where there are no null values, they are assigned the mean numeric value. You can easily spot these because they are unsorted and have a `COUNT` of zero. ","3b2c0a6e":"From here it's a pretty simple to put our numeric values into action..."}}