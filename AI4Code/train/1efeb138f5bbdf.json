{"cell_type":{"8436d72f":"code","4686802a":"code","33426888":"code","c69bade1":"code","e4ae0be2":"code","8dc614f0":"code","ab950ccf":"code","1458e13e":"code","56db796f":"code","66c03e1e":"code","05e86bed":"code","eecc2954":"code","9877f846":"code","8edbc18e":"code","4cef9fb4":"code","2712139f":"code","1e789b47":"code","9a20fbb4":"code","26e762d1":"code","15f40b3a":"code","748f5610":"markdown","b7f71f13":"markdown","2d97e2a5":"markdown","48941c5f":"markdown","859197de":"markdown","bdfc9245":"markdown","8ed389ed":"markdown","4b896299":"markdown"},"source":{"8436d72f":"# Data manipulation\nimport pandas as pd\nimport numpy as np\n\n# Plotting\nimport matplotlib\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n# Finance related operations\nfrom pandas_datareader import data\n\n# Import this to silence a warning when converting data column of a dataframe on the fly\nfrom pandas.plotting import register_matplotlib_converters\nregister_matplotlib_converters()\n\n%matplotlib inline","4686802a":"# Load data\ndf = pd.read_csv('..\/input\/df-out1\/df_out.csv', index_col=0)\n\ndf.head()","33426888":"df_2018 = pd.read_csv('..\/input\/200-financial-indicators-of-us-stocks-20142018\/2018_Financial_Data.csv', index_col=0)\ndf_2018.head()","c69bade1":"df_2018 = df_2018.rename(columns={'Enterprise Value': 'Enterprise Value 2018'})\ndf_2018x = df_2018[df_2018['Enterprise Value 2018'].notna()]\ndf_2018x = df_2018x['Enterprise Value 2018']","e4ae0be2":"df_1418 = pd.merge(df, df_2018x, right_index =True, left_index = True, how='inner')\ndf_1418.head()","8dc614f0":"df_2014 = pd.read_csv('..\/input\/200-financial-indicators-of-us-stocks-20142018\/2014_Financial_Data.csv', index_col=0)\nEV_2014 = df_2014['Enterprise Value']\ndf_1418x = pd.merge(df_1418, EV_2014, right_index =True, left_index = True, how='inner')\ndf_1418x.head()","ab950ccf":"df_1418x['Growth Rate'] = df_1418x['Enterprise Value 2018'] \/ df_1418x['Enterprise Value']\ndf_1418x.head()\ndf_1418x = df_1418x.dropna()","1458e13e":"##category = pd.cut(df_1418x['Growth Rate'],bins=[-np.inf,0,1.461,np.inf],labels=[-1,1,10])\n##category = pd.cut(df_1418x['Growth Rate'],bins=[-np.inf,0,np.inf],labels=[-1,1])\ncategory = pd.cut(df_1418x['Growth Rate'],bins=[-np.inf,2,np.inf],labels=['NG','G'])\ndf_1418x.insert(67,'Stock Performance',category)","56db796f":"df_1418x['Stock Performance'].value_counts(normalize=True)","66c03e1e":"features2 = ['Revenue', 'EPS', 'EBITDA Margin', 'returnOnEquity', 'EBIT Growth', 'Operating Income Growth', 'Sector']\ndf_1418x[(df_1418x['Stock Performance'] == 'G') & (df_1418x['Sector'] == 'Technology')][features2].describe()","05e86bed":"df_1418x[df_1418x['Stock Performance'] == 'G']['Sector'].value_counts(normalize=True)","eecc2954":"df_1418x[(df_1418x['Stock Performance'] == 'NG') & (df_1418x['Sector'] == 'Technology')][features2].describe()","9877f846":"df_1418x[df_1418x['Stock Performance'] == 'NG']['Sector'].value_counts(normalize=True)","8edbc18e":"features = ['Revenue', 'EPS', 'EBITDA Margin', 'returnOnEquity', 'Operating Income Growth', 'Sector']\nX = df_1418x[features]\ny = df_1418x.loc[:, df_1418x.columns.intersection(['Stock Performance'])]","4cef9fb4":"one_hot_X = pd.get_dummies(X)\none_hot_X.replace([np.inf, -np.inf], np.nan)\none_hot_X.fillna(0)\none_hot_X.head()","2712139f":"y = y.values.ravel()\nprint(y)","1e789b47":"from sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(one_hot_X, y, test_size=0.25, random_state=52)","9a20fbb4":"from sklearn.metrics import accuracy_score, log_loss\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.svm import SVC, LinearSVC, NuSVC\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.ensemble import RandomForestClassifier, AdaBoostClassifier, GradientBoostingClassifier\nfrom sklearn.naive_bayes import GaussianNB\nfrom sklearn.discriminant_analysis import LinearDiscriminantAnalysis\nfrom sklearn.discriminant_analysis import QuadraticDiscriminantAnalysis\n\nclassifiers = [\n    KNeighborsClassifier(3),\n    SVC(kernel=\"rbf\", C=0.025, probability=True),\n    DecisionTreeClassifier(),\n    RandomForestClassifier(),\n    AdaBoostClassifier(),\n    GradientBoostingClassifier(),\n    GaussianNB(),\n    LinearDiscriminantAnalysis(),\n    QuadraticDiscriminantAnalysis()]\n\n# Logging for Visual Comparison\nlog_cols=[\"Classifier\", \"Accuracy\", \"Log Loss\"]\nlog = pd.DataFrame(columns=log_cols)\n\nfor clf in classifiers:\n    clf.fit(X_train, y_train)\n    name = clf.__class__.__name__\n    \n    print(\"=\"*30)\n    print(name)\n    \n    print('****Results****')\n    train_predictions = clf.predict(X_test)\n    acc = accuracy_score(y_test, train_predictions)\n    print(\"Accuracy: {:.4%}\".format(acc))\n    \n    train_predictions = clf.predict_proba(X_test)\n    ll = log_loss(y_test, train_predictions)\n    print(\"Log Loss: {}\".format(ll))\n    \n    log_entry = pd.DataFrame([[name, acc*100, ll]], columns=log_cols)\n    log = log.append(log_entry)\n    \nprint(\"=\"*30)","26e762d1":"sns.set_color_codes(\"muted\")\nsns.barplot(x='Accuracy', y='Classifier', data=log, color=\"b\")\n\nplt.xlabel('Accuracy %')\nplt.title('Classifier Accuracy')\nplt.show()\n\nsns.set_color_codes(\"muted\")\nsns.barplot(x='Log Loss', y='Classifier', data=log, color=\"g\")\n\nplt.xlabel('Log Loss')\nplt.title('Classifier Log Loss')\nplt.show()","15f40b3a":"forest = RandomForestClassifier()\nforest.fit(X_train, y_train)\n\nimportances = forest.feature_importances_\nstd = np.std([tree.feature_importances_ for tree in forest.estimators_],\n             axis=0)\nindices = np.argsort(importances)[::-1]\n\n# Print the feature ranking\nprint(\"Feature ranking:\")\n\nfor f in range(X.shape[1]):\n    print(\"%d. feature %d (%f)\" % (f + 1, indices[f], importances[indices[f]]))\n\n# Plot the impurity-based feature importances of the forest\nplt.figure()\nplt.title(\"Feature importances\")\nplt.bar(range(X.shape[1]), importances[indices],\n        color=\"r\", yerr=std[indices], align=\"center\")\nplt.xticks(range(X.shape[1]), indices)\nplt.xlim([-1, X.shape[1]])\nplt.show()","748f5610":"print(X_test)","b7f71f13":"print(rf_model.predict(X_test))","2d97e2a5":"X_test.insert(1,'Actual', y_test)\nprint(X_test)","48941c5f":"from sklearn.ensemble import RandomForestRegressor\nfrom sklearn.metrics import mean_absolute_error\n\n\n# Define the model. Set random_state to 1\nrf_model = forest_model = RandomForestRegressor(random_state=1)\n\n# fit your model\nrf_model.fit(X_train, y_train)\n\n# Calculate the mean absolute error of your Random Forest model on the validation data\nrf_val_mae = mean_absolute_error(y_test, rf_model.predict(X_test))\n\nprint(\"Validation MAE for Random Forest Model: {}\".format(rf_val_mae))\n\n","859197de":"from sklearn.tree import export_graphviz\n\nexport_graphviz(rf_model.estimators_[0], out_file='tree.dot', feature_names=X.columns, filled=True, rounded=True)\n\n!dot -Tpng tree.dot -o tree.png\n\nfrom IPython.display import Image\nImage(filename = 'tree.png')","bdfc9245":"results1 = pd.DataFrame({'Results': results}, index = X_test.index)\nprint(results1)","8ed389ed":"X_test.insert(2, 'Prediction', results1['Results'])\nprint(X_test)","4b896299":"results = rf_model.predict(X_test)"}}