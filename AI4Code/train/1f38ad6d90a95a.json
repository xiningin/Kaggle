{"cell_type":{"8843935d":"code","dea85cd5":"code","f11fed82":"code","e176a0c5":"code","5a4d6dec":"code","f8c6066f":"code","937fb257":"code","350a0c21":"code","760e4344":"code","17d572d7":"code","1335c0d1":"code","38566f5d":"code","082e33e9":"markdown","2375f0f1":"markdown","62231770":"markdown","308154a3":"markdown","a8ac1fe1":"markdown","8073069a":"markdown","f087295d":"markdown","24ef3259":"markdown","7963b6ae":"markdown","1d65e14b":"markdown","80012ae6":"markdown"},"source":{"8843935d":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport warnings\nwarnings.simplefilter(action = \"ignore\", category = FutureWarning)\n\nmatches = pd.read_csv('..\/input\/matches.csv')\nmatches[\"type\"] = \"pre-qualifier\"\nfor year in range(2008, 2017):\n   final_match_index = matches[matches['season']==year][-1:].index.values[0]\n   matches = matches.set_value(final_match_index, \"type\", \"final\")\n   matches = matches.set_value(final_match_index-1, \"type\", \"qualifier-2\")\n   matches = matches.set_value(final_match_index-2, \"type\", \"eliminator\")\n   matches = matches.set_value(final_match_index-3, \"type\", \"qualifier-1\")\n\nmatches.groupby([\"type\"])[\"id\"].count()\nmatches.head()","dea85cd5":"deliveries = pd.read_csv('..\/input\/deliveries.csv')\ndeliveries.head()","f11fed82":"team_score = deliveries.groupby(['match_id', 'inning'])['total_runs'].sum().unstack().reset_index()\nteam_score.columns = ['match_id', 'Team1_score', 'Team2_score', 'Team1_superover_score', 'Team2_superover_score']\nmatches_agg = pd.merge(matches, team_score, left_on = 'id', right_on = 'match_id', how = 'outer')\n\nteam_extras = deliveries.groupby(['match_id', 'inning'])['extra_runs'].sum().unstack().reset_index()\nteam_extras.columns = ['match_id', 'Team1_extras', 'Team2_extras', 'Team1_superover_extras', 'Team2_superover_extras']\nmatches_agg = pd.merge(matches_agg, team_extras, on = 'match_id', how = 'outer')\n\n#Reorder the columns to make the data more readable\ncols = ['match_id', 'season','city','date','team1','team2', 'toss_winner', 'toss_decision', 'result', 'dl_applied', 'winner', 'Team1_score','Team2_score', 'win_by_runs', 'win_by_wickets', 'Team1_extras', 'Team2_extras', 'Team1_superover_score', 'Team2_superover_score', 'Team1_superover_extras', 'Team2_superover_extras', 'player_of_match', 'type', 'venue', 'umpire1', 'umpire2', 'umpire3']\nmatches_agg = matches_agg[cols]\nmatches_agg.head(2)","e176a0c5":"batsman_grp = deliveries.groupby([\"match_id\", \"inning\", \"batting_team\", \"batsman\"])\nbatsmen = batsman_grp[\"batsman_runs\"].sum().reset_index()\n\n# Ignore the wide balls.\nballs_faced = deliveries[deliveries[\"wide_runs\"] == 0]\nballs_faced = balls_faced.groupby([\"match_id\", \"inning\", \"batsman\"])[\"batsman_runs\"].count().reset_index()\nballs_faced.columns = [\"match_id\", \"inning\", \"batsman\", \"balls_faced\"]\nbatsmen = batsmen.merge(balls_faced, left_on=[\"match_id\", \"inning\", \"batsman\"], \n                        right_on=[\"match_id\", \"inning\", \"batsman\"], how=\"left\")\n\nfours = deliveries[ deliveries[\"batsman_runs\"] == 4]\nsixes = deliveries[ deliveries[\"batsman_runs\"] == 6]\n\nfours_per_batsman = fours.groupby([\"match_id\", \"inning\", \"batsman\"])[\"batsman_runs\"].count().reset_index()\nsixes_per_batsman = sixes.groupby([\"match_id\", \"inning\", \"batsman\"])[\"batsman_runs\"].count().reset_index()\n\nfours_per_batsman.columns = [\"match_id\", \"inning\", \"batsman\", \"4s\"]\nsixes_per_batsman.columns = [\"match_id\", \"inning\", \"batsman\", \"6s\"]\n\nbatsmen = batsmen.merge(fours_per_batsman, left_on=[\"match_id\", \"inning\", \"batsman\"], \n                        right_on=[\"match_id\", \"inning\", \"batsman\"], how=\"left\")\nbatsmen = batsmen.merge(sixes_per_batsman, left_on=[\"match_id\", \"inning\", \"batsman\"], \n                        right_on=[\"match_id\", \"inning\", \"batsman\"], how=\"left\")\nbatsmen['SR'] = np.round(batsmen['batsman_runs'] \/ batsmen['balls_faced'] * 100, 2)\n\nfor col in [\"batsman_runs\", \"4s\", \"6s\", \"balls_faced\", \"SR\"]:\n    batsmen[col] = batsmen[col].fillna(0)\n\ndismissals = deliveries[ pd.notnull(deliveries[\"player_dismissed\"])]\ndismissals = dismissals[[\"match_id\", \"inning\", \"player_dismissed\", \"dismissal_kind\", \"fielder\"]]\ndismissals.rename(columns={\"player_dismissed\": \"batsman\"}, inplace=True)\nbatsmen = batsmen.merge(dismissals, left_on=[\"match_id\", \"inning\", \"batsman\"], \n                        right_on=[\"match_id\", \"inning\", \"batsman\"], how=\"left\")\n\nbatsmen = matches[['id','season']].merge(batsmen, left_on = 'id', right_on = 'match_id', how = 'left').drop('id', axis = 1)\nbatsmen.head(2)","5a4d6dec":"bowler_grp = deliveries.groupby([\"match_id\", \"inning\", \"bowling_team\", \"bowler\", \"over\"])\nbowlers = bowler_grp[\"total_runs\", \"wide_runs\", \"bye_runs\", \"legbye_runs\", \"noball_runs\"].sum().reset_index()\n\nbowlers[\"runs\"] = bowlers[\"total_runs\"] - (bowlers[\"bye_runs\"] + bowlers[\"legbye_runs\"])\nbowlers[\"extras\"] = bowlers[\"wide_runs\"] + bowlers[\"noball_runs\"]\n\ndel( bowlers[\"bye_runs\"])\ndel( bowlers[\"legbye_runs\"])\ndel( bowlers[\"total_runs\"])\n\ndismissal_kinds_for_bowler = [\"bowled\", \"caught\", \"lbw\", \"stumped\", \"caught and bowled\", \"hit wicket\"]\ndismissals = deliveries[deliveries[\"dismissal_kind\"].isin(dismissal_kinds_for_bowler)]\ndismissals = dismissals.groupby([\"match_id\", \"inning\", \"bowling_team\", \"bowler\", \"over\"])[\"dismissal_kind\"].count().reset_index()\ndismissals.rename(columns={\"dismissal_kind\": \"wickets\"}, inplace=True)\n\nbowlers = bowlers.merge(dismissals, left_on=[\"match_id\", \"inning\", \"bowling_team\", \"bowler\", \"over\"], \n                        right_on=[\"match_id\", \"inning\", \"bowling_team\", \"bowler\", \"over\"], how=\"left\")\nbowlers[\"wickets\"] = bowlers[\"wickets\"].fillna(0)\n\nbowlers_over = bowlers.groupby(['match_id', 'inning', 'bowling_team', 'bowler'])['over'].count().reset_index()\nbowlers = bowlers.groupby(['match_id', 'inning', 'bowling_team', 'bowler']).sum().reset_index().drop('over', 1)\nbowlers = bowlers_over.merge(bowlers, on=[\"match_id\", \"inning\", \"bowling_team\", \"bowler\"], how = 'left')\nbowlers['Econ'] = np.round(bowlers['runs'] \/ bowlers['over'] , 2)\nbowlers = matches[['id','season']].merge(bowlers, left_on = 'id', right_on = 'match_id', how = 'left').drop('id', axis = 1)\n\nbowlers.head(2)","f8c6066f":"#No of wins by team and season in each city\nx, y = 2008, 2017\nwhile x < y:\n    wins_percity = matches_agg[matches_agg['season'] == x].groupby(['winner', 'city'])['match_id'].count().unstack()\n    plot = wins_percity.plot(kind='bar', stacked=True, title=\"Team wins in different cities\\nSeason \"+str(x), figsize=(7, 5))\n    sns.set_palette(\"Paired\", len(matches_agg['city'].unique()))\n    plot.set_xlabel(\"Teams\")\n    plot.set_ylabel(\"No of wins\")\n    plot.legend(loc='best', prop={'size':8})\n    x+=1","937fb257":"batsman_runsperseason = batsmen.groupby(['season', 'batting_team', 'batsman'])['batsman_runs'].sum().reset_index()\nbatsman_runsperseason = batsman_runsperseason.groupby(['season', 'batsman'])['batsman_runs'].sum().unstack().T\nbatsman_runsperseason['Total'] = batsman_runsperseason.sum(axis=1) #add total column to find batsman with the highest runs\nbatsman_runsperseason = batsman_runsperseason.sort_values(by = 'Total', ascending = False).drop('Total', 1)\nax = batsman_runsperseason[:5].T.plot()","350a0c21":"batsman_runs = batsmen.groupby(['batsman'])['batsman_runs', '4s', '6s'].sum().reset_index()\nbatsman_runs['4s_6s'] = batsman_runs['4s'] * 4 + batsman_runs['6s'] * 6\nbatsman_runs['pct_boundaries'] = np.round(batsman_runs['4s_6s'] \/ batsman_runs['batsman_runs'] * 100, 2)\nbatsman_runs = batsman_runs.sort_values(by = 'batsman_runs', ascending = False)\nbatsman_runs[:10].plot(x= 'batsman', y = 'pct_boundaries', kind = 'bar')","760e4344":"bowlers_wickets = bowlers.groupby(['bowler'])['wickets'].sum()\nbowlers_wickets.sort_values(ascending = False, inplace = True)\nbowlers_wickets[:10].plot(x= 'bowler', y = 'runs', kind = 'barh', colormap = 'Accent')","17d572d7":"bowlers_extras = bowlers.groupby(['season', 'bowler'])['extras'].sum().unstack().T\nbowlers_extras['Total'] = bowlers_extras.sum(axis=1)\nbowlers_extras.sort('Total', ascending = False, inplace = True)\nbowlers_extras.head()","1335c0d1":"matches['player_of_match'].value_counts()[:10].plot(kind = 'bar')","38566f5d":"toss = matches_agg.groupby(['season', 'toss_winner']).winner.value_counts().reset_index(name = 'count')\ntoss['result'] = np.where(toss.toss_winner == toss.winner, 'won', 'lost')\ntoss_result = toss.groupby(['season', 'toss_winner','result'])['count'].sum().reset_index()\n\nfor x in range(2008, 2017, 1):\n    toss_result_x = toss_result[toss_result['season'] == x]\n    plot = sns.barplot(x=\"toss_winner\", y=\"count\", hue=\"result\", data=toss_result_x)\n    plot.set_title('Matches won\/lost by teams winning toss \\nSeason ' +str(x))\n    plot.set_xticklabels(toss_result_x['toss_winner'],rotation=30)\n    plt.show()\n    x+=1","082e33e9":"##Team wins in home city vs other cities\nEach team plays two matches against the other teams, one in its home city and other in the home city of the opposite team. It would be interesting see if playing in home city increases a teams chances of a win.","2375f0f1":"## Impact of toss on the match outcome","62231770":"##Player of the match\nSee who has won the Player of the match award maximum number of times","308154a3":"##Performance of top bowlers over seasons\nMalinga is the highest wicket taken in IPL so far","a8ac1fe1":"##Batsmen aggregates (Runs, Balls, 4s, 6s, SR)","8073069a":"#Introduction\nWe have the Indian Premier League data from 2008 to 2016. We have two files to begin with. \nMatches - giving us details of each match played.\nDeliveries - all the deliveries in all the matches put together. \nWe would work on these two files to extract data on each match, batsmen and bowlers.","f087295d":"##Bowler Aggregates","24ef3259":"##Extra runs conceded by bowlers","7963b6ae":"##Plot the performance of top 5 batsmen over seasons\nV.Kohli show a steady improvement over season and C. Gayle  and SK Raina show a slump ","1d65e14b":"##Percentage of total runs scored through boundaries for each batsman\nThe average for top batsmen is around 58-60% with exception of CH Gayle at 76%. Interestingly, MS Dhoni who is known for helicopter shots(6s) gets close to 45% of his runs through singles","80012ae6":"##Add team score and team extra columns for each match, each inning."}}