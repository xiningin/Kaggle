{"cell_type":{"b6c9fe3a":"code","f2eaa862":"code","380120e9":"code","1c4625ad":"code","65cca5b2":"code","a48539b9":"code","30647d40":"code","7559362e":"code","19a3f936":"code","322c7b1b":"code","195028ee":"code","c024dfbe":"code","95f4fbd2":"markdown"},"source":{"b6c9fe3a":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot","f2eaa862":"import os\nprint(os.listdir(\"..\/input\"))","380120e9":"df = pd.read_csv('..\/input\/all_stocks_5yr.csv',parse_dates = ['date'], index_col=False)\nclose = df.reset_index().pivot(index = 'date',columns = 'Name',values='close')\n#close","1c4625ad":"# resampling data to monthly frequency\nfreq = 'M'\nmonthly_close = close.resample(freq).last()\n#monthly_close","65cca5b2":"#monthly_close.plot(x=index, y='AAL')","a48539b9":"#Getting the returns\nmonthly_log_returns = np.log(monthly_close)-np.log(monthly_close.shift(1))","30647d40":"prev_returns = monthly_log_returns.shift(1)\nlookahead_returns = monthly_log_returns.shift(-1)","7559362e":"# getting long and short portfolios\ndef get_top_n(prev_returns, top_n):\n\n    p_r = prev_returns.copy()\n    for i, row in p_r.iterrows():\n        top = row.nlargest(top_n).index\n        p_r.loc[i] = 0\n        p_r.loc[i,top] = 1\n    print(p_r.astype('int64'))\n    return p_r.astype('int64')","19a3f936":"top_bottom_n = 50\ndf_long = get_top_n(prev_returns, top_bottom_n)\ndf_short = get_top_n(-1*prev_returns, top_bottom_n)","322c7b1b":"# We'll assume every stock gets an equal dollar amount of investment.\nexpected_portfolio_returns = lookahead_returns*(df_long-df_short)\/(2*top_bottom_n)","195028ee":"expected_portfolio_returns_by_date = expected_portfolio_returns.T.sum().dropna()\nportfolio_ret_mean = expected_portfolio_returns_by_date.mean()\nportfolio_ret_ste = expected_portfolio_returns_by_date.sem()\nportfolio_ret_annual_rate = (np.exp(portfolio_ret_mean * 12) - 1) * 100\n\nprint(\"\"\"\nMean:                       {:.6f}\nStandard Error:             {:.6f}\nAnnualized Rate of Return:  {:.2f}%\n\"\"\".format(portfolio_ret_mean, portfolio_ret_ste, portfolio_ret_annual_rate))\n","c024dfbe":"# Statistical Analysis\nfrom scipy import stats\nt, p_two_tail = stats.ttest_1samp(expected_portfolio_returns_by_date,0)\nprint(\"\"\"\nAlpha analysis:\n t-value:        {:.3f}\n p-value:        {:.6f}\n\"\"\".format(t, p_two_tail\/2))","95f4fbd2":" generally $\\alpha = 0.05$ and since p-value < $\\alpha$  which means that we succesfully rejected the null hypothesis and result is significant."}}