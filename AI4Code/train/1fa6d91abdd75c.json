{"cell_type":{"2ac9ad27":"code","02c2a200":"code","826315be":"code","3dc0369a":"code","ae65dea9":"code","5a15fbfb":"code","c8979c48":"code","47e54c15":"code","2075a50a":"code","16b34e5e":"code","bc12f493":"code","982f2e09":"code","10e4ddd7":"code","a8c7ea4a":"code","cbccb903":"code","b7125965":"code","efc6de15":"code","88af77c2":"code","20b90793":"code","e810ed58":"code","32ac7309":"code","5d4ca24a":"code","37907bb2":"code","cd74de5b":"code","ff7c7a02":"code","f0f8aadc":"code","16b4b8cd":"code","4ac87561":"code","f4cf392e":"code","f5da5c7f":"code","8f9e082d":"code","94c52456":"code","1d3c482a":"code","5bdd6c5d":"code","d07d17fd":"code","73d5f959":"code","f262db03":"code","cfdf18c0":"code","6c98539b":"code","8866fd4c":"code","bba77895":"code","d4dfe422":"code","9d906d27":"code","e66d2db6":"code","0573ede4":"code","26eaa42a":"code","876d9ec8":"code","0e303fc1":"code","226fd65c":"code","e5fc15d6":"code","89f58031":"code","aaabc29e":"code","d99b2d85":"code","d366882e":"code","47446817":"code","5b705929":"code","e6e5caaf":"code","8175d8b4":"code","9b15c57c":"code","37d0256c":"code","bb3fa3a6":"code","60c3b625":"code","437ef73d":"code","10360014":"code","1ed41aba":"code","53c53a06":"code","531e9217":"code","bc7c8fc9":"code","d1982dba":"code","52b9bbfd":"code","f5a88293":"code","62691262":"code","6f076ae7":"code","0ffdc794":"code","fdbaca43":"code","4b839d54":"code","b249cd93":"code","1e256d83":"code","09b426df":"code","a88f82e3":"code","724af794":"code","0099ee8f":"code","aa60c992":"markdown","156a6f18":"markdown","5b97b920":"markdown","1bbc138c":"markdown","fe0045fa":"markdown","b3e31e8b":"markdown","c8838a60":"markdown","40a15d11":"markdown","62fe2c3a":"markdown","32488deb":"markdown","2843a176":"markdown","9f2c5d00":"markdown","e23b704d":"markdown","a7f340ed":"markdown","1d5642eb":"markdown","e211ffba":"markdown","1abcb5bc":"markdown","1c40866e":"markdown","e7d02eeb":"markdown","63343ed2":"markdown","d24fb5cf":"markdown","64dd3d19":"markdown","8b6b71a3":"markdown","1294967f":"markdown","224d7e44":"markdown"},"source":{"2ac9ad27":"import IPython.display\nIPython.display.YouTubeVideo('lSKCF3or8HA')","02c2a200":"!pip install git+https:\/\/github.com\/darecophoenixx\/wordroid.sblo.jp","826315be":"%matplotlib inline\nfrom IPython.display import SVG\nfrom keras.utils.vis_utils import model_to_dot\n\nimport os.path\nimport sys\nimport re\nimport itertools\nimport csv\nimport datetime\nimport pickle\nimport random\nfrom collections import defaultdict, Counter\nimport gc\n\nimport matplotlib.pyplot as plt\nfrom matplotlib.ticker import NullFormatter\nimport seaborn as sns\nimport pandas as pd\nimport numpy as np\nimport scipy\nimport gensim\nfrom sklearn.metrics import f1_score, classification_report, confusion_matrix, log_loss\nfrom sklearn.model_selection import train_test_split\nimport gensim\nfrom keras.preprocessing.sequence import skipgrams\nimport tensorflow as tf","3dc0369a":"def hexbin(x, y, color, **kwargs):\n    cmap = sns.light_palette(color, as_cmap=True)\n    plt.hexbin(x, y, cmap=cmap, **kwargs)\ndef scatter(x, y, color, **kwargs):\n    plt.scatter(x, y, marker='.')","ae65dea9":"ls -la ..\/input","5a15fbfb":"dir_data_src = '..\/input\/anime-recommendations-database'\nos.listdir(dir_data_src)","c8979c48":"anime_csv = pd.read_csv(os.path.join(dir_data_src, 'anime.csv'))\nprint(anime_csv.shape)\nanime_csv.index = anime_csv.anime_id.values\nanime_csv.head()","47e54c15":"def Anime_title2id(titlename, csv=anime_csv):\n    try:\n        return csv.query('name==@titlename').anime_id.values[0]\n    except:\n        return 9999999\n\nAnime_title2id('Kimi no Na wa.'), Anime_title2id('Fullmetal Alchemist: Brotherhood'), Anime_title2id('Gintama\u00b0'), Anime_title2id('PL_ANIME')","2075a50a":"def Anime_id2title(anime_id, csv=anime_csv):\n    try:\n        return csv.query('anime_id==@anime_id').name.values[0]\n    except:\n        return '*****'\n\nAnime_id2title(32281), Anime_id2title(5114), Anime_id2title(28977), Anime_id2title(9999999)","16b34e5e":"'''\nload rating.csv\n'''\nrating_csv = pd.read_csv(os.path.join(dir_data_src, 'rating.csv'))\nprint(rating_csv.shape)\nrating_csv.head()","bc12f493":"'''\n`Yuri!!! on Ice` doesn't exist in rating_csv\n'''\nprint(Anime_title2id('Yuri!!! on Ice'))\nrating_csv.query('anime_id==32995')","982f2e09":"rating_csv2 = rating_csv.loc[rating_csv.rating.values != -1]\nrating_csv2.shape\nrating_csv2.head(10)","10e4ddd7":"'''\nshow anime no rated\n'''\nanime_id_norated = anime_csv.anime_id.values[~np.isin(anime_csv.anime_id.values, rating_csv2.groupby('anime_id').size().keys().values)]\nprint(anime_csv.loc[anime_id_norated].shape)","a8c7ea4a":"src_tfidf_anime = '..\/input\/create-tfidf-of-anime-side'\nos.listdir(src_tfidf_anime)","cbccb903":"corpus_csr_anime = scipy.sparse.load_npz(os.path.join(src_tfidf_anime, 'corpus_csr.npz'))\ntfidf_anime = gensim.models.TfidfModel.load(os.path.join(src_tfidf_anime, 'tfidf'))\ndic_user = gensim.corpora.Dictionary.load(os.path.join(src_tfidf_anime, 'dic_user'))\ndic_anime = gensim.corpora.Dictionary.load(os.path.join(src_tfidf_anime, 'dic_anime'))\n\ncorpus_csr_anime, tfidf_anime, dic_user, dic_anime","b7125965":"src_tfidf_user = '..\/input\/create-tfidf-of-user-side-another-way'\nos.listdir(src_tfidf_user)","efc6de15":"corpus_csr_user = scipy.sparse.load_npz(os.path.join(src_tfidf_user, 'corpus_csr.npz'))\ntfidf_user = gensim.models.TfidfModel.load(os.path.join(src_tfidf_user, 'tfidf'))\n#dic_user = gensim.corpora.Dictionary.load(os.path.join(src_tfidf_user, 'dic_user'))\n#dic_anime = gensim.corpora.Dictionary.load(os.path.join(src_tfidf_user, 'dic_anime'))\n\ncorpus_csr_user, tfidf_user","88af77c2":"def Anime2id(title):\n    return dic_anime.token2id['anime_id-'+str(Anime_title2id(title))]\n\nAnime2id('Kimi no Na wa.')","20b90793":"def get_animeid(name):\n    Id = anime_csv.query(\"name==@name\").anime_id.values[0]\n    return 'anime_id-' + str(Id)\n\nget_animeid('Mobile Suit Gundam')","e810ed58":"from feature_eng import neg_smpl","32ac7309":"sim_anime = neg_smpl.MySparseMatrixSimilarity(corpus_csr_anime, num_features=max(dic_user.keys())+1, tfidf=tfidf_anime)\nsim_anime","5d4ca24a":"sim_user = neg_smpl.MySparseMatrixSimilarity(corpus_csr_user, num_features=max(dic_anime.keys())+1, tfidf=tfidf_user)\nsim_user","37907bb2":"anime_csv.query('name.str.contains(\"Saenai\")', engine='python')","cd74de5b":"get_animeid('Saenai Heroine no Sodatekata')","ff7c7a02":"query_anime = dic_anime.doc2bow([get_animeid('Saenai Heroine no Sodatekata')])\nquery_anime","f0f8aadc":"'''\nUser who like 'Saenai Heroine no Sodatekata' the most\n'''\nsim_user.num_best = 1\nuser_rating = sim_user[query_anime]\nuser_rating","16b4b8cd":"for idx, wgt in user_rating:\n    print(dic_user[idx])","4ac87561":"'''\nget anime list\n'''\nsim_anime.num_best = 30\nanime_rating = sim_anime[user_rating]\nanime_rating","f4cf392e":"for idx, rating in anime_rating:\n    #print(dic_anime[idx])\n    print(rating, Anime_id2title(re.sub('anime_id-', '', dic_anime[idx])))","f5da5c7f":"'''\nanime list this user rated\n'''\npd.merge(rating_csv2.query('user_id==71640'), anime_csv, on='anime_id')","8f9e082d":"'''\nanime list this user watched\n'''\npd.merge(rating_csv.query('user_id==71640'), anime_csv, on='anime_id').head()","94c52456":"query_anime = dic_anime.doc2bow([get_animeid('Saenai Heroine no Sodatekata')])\nquery_anime","1d3c482a":"'''\nUsers who like 'Saenai Heroine no Sodatekata'\n'''\nsim_user.num_best = 30\nuser_rating = sim_user[query_anime]\nuser_rating","5bdd6c5d":"for idx, wgt in user_rating:\n    print(dic_user[idx])","d07d17fd":"'''\nget anime list\n'''\nsim_anime.num_best = 30\nanime_rating = sim_anime[user_rating]\nanime_rating","73d5f959":"anime_list = []\nfor idx, rating in anime_rating:\n    #print(dic_anime[idx])\n    print(rating, Anime_id2title(re.sub('anime_id-', '', dic_anime[idx])))\n    anime_list.append(int(re.sub('anime_id-', '', dic_anime[idx])))","f262db03":"anime_list\nanime_csv.loc[anime_list]","cfdf18c0":"anime_csv.query('name.str.contains(\"Evangelion\")', engine='python')","6c98539b":"anime_title = 'Neon Genesis Evangelion'\nget_animeid(anime_title)","8866fd4c":"query_anime = dic_anime.doc2bow([get_animeid(anime_title)])\nquery_anime","bba77895":"'''\nUser who like this anime the most\n'''\nsim_user.num_best = 1\nuser_rating = sim_user[query_anime]\nuser_rating","d4dfe422":"for idx, wgt in user_rating:\n    print(dic_user[idx])\n    user_id = int(re.sub('user_id-', '', dic_user[idx]))","9d906d27":"'''\nget anime list\n'''\nsim_anime.num_best = 30\nanime_rating = sim_anime[user_rating]\nanime_rating","e66d2db6":"for idx, rating in anime_rating:\n    #print(dic_anime[idx])\n    print(rating, Anime_id2title(re.sub('anime_id-', '', dic_anime[idx])))","0573ede4":"'''\nanime list this user rated\n'''\npd.merge(rating_csv2.query('user_id==@user_id'), anime_csv, on='anime_id')","26eaa42a":"'''\nanime list this user watched\n'''\npd.merge(rating_csv.query('user_id==@user_id'), anime_csv, on='anime_id').head()","876d9ec8":"query_anime = dic_anime.doc2bow([get_animeid(anime_title)])\nquery_anime","0e303fc1":"'''\nUsers who like this anime\n'''\nsim_user.num_best = 30\nuser_rating = sim_user[query_anime]\nuser_rating","226fd65c":"for idx, wgt in user_rating:\n    print(dic_user[idx])","e5fc15d6":"'''\nget anime list\n'''\nsim_anime.num_best = 30\nanime_rating = sim_anime[user_rating]\nanime_rating","89f58031":"anime_list = []\nfor idx, rating in anime_rating:\n    #print(dic_anime[idx])\n    print(rating, Anime_id2title(re.sub('anime_id-', '', dic_anime[idx])))\n    anime_list.append(int(re.sub('anime_id-', '', dic_anime[idx])))","aaabc29e":"anime_list\nanime_csv.loc[anime_list]","d99b2d85":"anime_csv.query('name.str.contains(\"Love Live\")', engine='python')","d366882e":"anime_title = 'Love Live! School Idol Project'\nget_animeid(anime_title)","47446817":"query_anime = dic_anime.doc2bow([get_animeid(anime_title)])\nquery_anime","5b705929":"'''\nUser who like this anime the most\n'''\nsim_user.num_best = 1\nuser_rating = sim_user[query_anime]\nuser_rating","e6e5caaf":"for idx, wgt in user_rating:\n    print(dic_user[idx])\n    user_id = int(re.sub('user_id-', '', dic_user[idx]))","8175d8b4":"'''\nget anime list\n'''\nsim_anime.num_best = 30\nanime_rating = sim_anime[user_rating]\nanime_rating","9b15c57c":"for idx, rating in anime_rating:\n    #print(dic_anime[idx])\n    print(rating, Anime_id2title(re.sub('anime_id-', '', dic_anime[idx])))","37d0256c":"'''\nanime list this user rated\n'''\npd.merge(rating_csv2.query('user_id==@user_id'), anime_csv, on='anime_id')","bb3fa3a6":"'''\nanime list this user watched\n'''\npd.merge(rating_csv.query('user_id==@user_id'), anime_csv, on='anime_id').head()","60c3b625":"query_anime = dic_anime.doc2bow([get_animeid(anime_title)])\nquery_anime","437ef73d":"'''\nUsers who like this anime\n'''\nsim_user.num_best = 30\nuser_rating = sim_user[query_anime]\nuser_rating","10360014":"for idx, wgt in user_rating:\n    print(dic_user[idx])","1ed41aba":"'''\nget anime list\n'''\nsim_anime.num_best = 30\nanime_rating = sim_anime[user_rating]\nanime_rating","53c53a06":"anime_list = []\nfor idx, rating in anime_rating:\n    #print(dic_anime[idx])\n    print(rating, Anime_id2title(re.sub('anime_id-', '', dic_anime[idx])))\n    anime_list.append(int(re.sub('anime_id-', '', dic_anime[idx])))","531e9217":"anime_list\nanime_csv.loc[anime_list]","bc7c8fc9":"anime_csv.query('name.str.contains(\"Bungo\")', engine='python')","d1982dba":"anime_title = 'Bungou Stray Dogs'\nget_animeid(anime_title)","52b9bbfd":"query_anime = dic_anime.doc2bow([get_animeid(anime_title)])\nquery_anime","f5a88293":"'''\nUser who like this anime the most\n'''\nsim_user.num_best = 1\nuser_rating = sim_user[query_anime]\nuser_rating","62691262":"for idx, wgt in user_rating:\n    print(dic_user[idx])\n    user_id = int(re.sub('user_id-', '', dic_user[idx]))","6f076ae7":"'''\nget anime list\n'''\nsim_anime.num_best = 30\nanime_rating = sim_anime[user_rating]\nanime_rating","0ffdc794":"for idx, rating in anime_rating:\n    #print(dic_anime[idx])\n    print(rating, Anime_id2title(re.sub('anime_id-', '', dic_anime[idx])))","fdbaca43":"'''\nanime list this user rated\n'''\npd.merge(rating_csv2.query('user_id==@user_id'), anime_csv, on='anime_id')","4b839d54":"'''\nanime list this user watched\n'''\npd.merge(rating_csv.query('user_id==@user_id'), anime_csv, on='anime_id').head()","b249cd93":"query_anime = dic_anime.doc2bow([get_animeid(anime_title)])\nquery_anime","1e256d83":"'''\nUsers who like this anime\n'''\nsim_user.num_best = 30\nuser_rating = sim_user[query_anime]\nuser_rating","09b426df":"for idx, wgt in user_rating:\n    print(dic_user[idx])","a88f82e3":"'''\nget anime list\n'''\nsim_anime.num_best = 30\nanime_rating = sim_anime[user_rating]\nanime_rating","724af794":"anime_list = []\nfor idx, rating in anime_rating:\n    #print(dic_anime[idx])\n    print(rating, Anime_id2title(re.sub('anime_id-', '', dic_anime[idx])))\n    anime_list.append(int(re.sub('anime_id-', '', dic_anime[idx])))","0099ee8f":"anime_list\nanime_csv.loc[anime_list]","aa60c992":"# Saenai Heroine no Sodatekata","156a6f18":"# Load Pre-Processing Data\n---","5b97b920":"## User who like this anime the most","1bbc138c":"# Create MatrixSimilarity\n---","fe0045fa":"# Prepare Data\n---","b3e31e8b":"## User who like this anime the most","c8838a60":"## Favorite anime of this user","40a15d11":"# Pre-Processing Data\n* [create tfidf of anime side](https:\/\/www.kaggle.com\/wordroid\/create-tfidf-of-anime-side)\n* [create tfidf of user side](https:\/\/www.kaggle.com\/wordroid\/create-tfidf-of-user-side-another-way)\n\n# Related Notebooks\n* [Recommendations using topic model](https:\/\/www.kaggle.com\/wordroid\/recommendations-using-topic-model)\n* [Load and Confirm tfidf of anime side](https:\/\/www.kaggle.com\/wordroid\/load-and-confirm-tfidf-of-anime-side)\n  * [similar anime to Mobile Suit Gundam](https:\/\/www.kaggle.com\/wordroid\/load-and-confirm-tfidf-of-anime-side#Mobile-Suit-Gundam)\n  * [similar anime to 'Kimi no Na wa.'](https:\/\/www.kaggle.com\/wordroid\/load-and-confirm-tfidf-of-anime-side#Kimi-no-Na-wa.)\n* [Load and Confirm tfidf of user side](https:\/\/www.kaggle.com\/wordroid\/load-and-confirm-tfidf-of-user-side)","62fe2c3a":"## Similar anime","32488deb":"## Favorite anime of this user","2843a176":"## anime no-rated","9f2c5d00":"## User who like this anime the most","e23b704d":"## Favorite anime of this user","a7f340ed":"## load anime.csv","1d5642eb":"## Similar anime","e211ffba":"## Favorite anime of this user","1abcb5bc":"# Saenai Heroine no Sodatekata\n---","1c40866e":"## Similar anime to 'Saenai Heroine no Sodatekata'","e7d02eeb":"## Similar anime","63343ed2":"## create rating_csv2\ndelete rating == -1","d24fb5cf":"## load rating.csv","64dd3d19":"# Bungou Stray Dogs\n---","8b6b71a3":"# Love Live! School Idol Project\n---","1294967f":"## User who like this anime the most","224d7e44":"# Neon Genesis Evangelion\n---"}}