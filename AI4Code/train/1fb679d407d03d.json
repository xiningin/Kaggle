{"cell_type":{"8ccf0dda":"code","27fd08b5":"code","f9cebb6d":"code","ff87c4e7":"code","bff8093f":"code","441920f6":"code","8512e0df":"code","d7a2a0a5":"code","7a937e0d":"code","1e1c6e15":"code","9a877ec7":"code","1d290cab":"code","14138062":"code","441969da":"code","e1e438e6":"code","7f335269":"code","7b85a11e":"code","4d4c52ef":"code","e55d4573":"code","9e2b5624":"code","66d130e3":"code","ca3427ed":"code","4e42697c":"code","7e29b169":"code","16ac615b":"code","85c950d3":"code","2fbb194d":"code","dfabd3ca":"code","bd3d52a3":"code","a345d5f7":"code","582f443e":"code","4576c2d9":"code","dd216ed6":"code","d54ab4d2":"code","72ca502f":"code","05463b9f":"code","a0c18206":"code","6a9d4579":"code","8b52228f":"code","108d111d":"code","4eec6a4c":"code","b07aa58b":"code","87b6d97c":"code","cf953970":"code","dd609a96":"code","86de6af4":"code","0c2db030":"code","daeee479":"code","2d2dc8bc":"code","027b6114":"code","115f64a7":"code","9ff29fda":"code","3dd97d99":"code","e4a41d66":"code","272f04c8":"code","3c2047df":"code","87ee01ed":"code","521d482c":"code","befb5c34":"code","6ef4f2b2":"code","df8fbd5e":"code","2cfb9d3d":"code","70c32b8e":"code","11bcf26b":"markdown","5ab4adf8":"markdown","4987a6f2":"markdown","ff1a04c4":"markdown","ff92e83f":"markdown","926b1c3d":"markdown","f3f88816":"markdown","f171046d":"markdown","14e370de":"markdown","21f7addc":"markdown","37b60574":"markdown","b899037c":"markdown","5e45c63d":"markdown","38668efe":"markdown","680ae952":"markdown","0bbe7940":"markdown","0d49b775":"markdown","4ec1f65b":"markdown","e115ddb9":"markdown","5dcc5ab7":"markdown","a0040fbe":"markdown","edf5b220":"markdown","1f508ef3":"markdown"},"source":{"8ccf0dda":"import pandas as pd\nimport sklearn \nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport numpy as np\nfrom datetime import datetime\n\nfrom subprocess import check_output","27fd08b5":"train_raw_data = pd.read_csv('..\/input\/sales_train.csv')\ntest_raw_data = pd.read_csv('..\/input\/test.csv')\nitems_data = pd.read_csv('..\/input\/items.csv')\nitem_categories_data = pd.read_csv('..\/input\/item_categories.csv')\nshops_data = pd.read_csv('..\/input\/shops.csv')","f9cebb6d":"train_raw_data.head()","ff87c4e7":"test_raw_data.head()","bff8093f":"items_data.head()","441920f6":"item_categories_data.head()","8512e0df":"shops_data.head()","d7a2a0a5":"print(train_raw_data.shape)\nprint(test_raw_data.shape)","7a937e0d":"n_train = train_raw_data.shape[0]\nn_test = test_raw_data.shape[0]","1e1c6e15":"train_data = train_raw_data.set_index('item_id').join(items_data.set_index('item_id'), how='left').reset_index()","9a877ec7":"train_data = train_data.drop(['item_name'], axis=1)","1d290cab":"train_data.loc[:, 'date'] = train_data['date'].map(lambda d: datetime.strptime(d, '%d.%m.%Y')).values","14138062":"train_data.head(10)","441969da":"n_ids = train_data.groupby('item_id')['shop_id'].count()\nn_ids.plot()","e1e438e6":"n_cats = train_data.groupby('item_category_id')['item_id'].count()\nplt.bar(n_cats.index, n_cats.values)","7f335269":"n_items_month = train_data.groupby(['date_block_num'])['item_id'].count()\nn_items_month.plot(kind='bar')","7b85a11e":"unique_items_shops = train_data.groupby('shop_id')['item_id'].nunique()\nunique_items_shops.plot(kind='bar')","4d4c52ef":"def has_null(data):\n    columns = data.columns\n    nulls = []\n    for column in data.columns:\n        nulls.append(data[column].isnull().sum())\n        \n    null_df = pd.DataFrame({'column': columns, 'total null values': nulls})\n    print(null_df)","e55d4573":"has_null(train_data)","9e2b5624":"print('min item id {}'.format(train_data['item_id'].min()))\nprint('max item id {}'.format(train_data['item_id'].max()))","66d130e3":"item_id_vc = train_data['item_id'].value_counts()\nprint(item_id_vc)\nplt.plot(item_id_vc.index, item_id_vc, 'b.')","ca3427ed":"train_data_20949 = train_data.loc[train_data['item_id'] == 20949]\ntrain_data_20949","4e42697c":"train_data_20949['date_block_num'].value_counts()","7e29b169":"itemid_shopid_month = train_data.groupby(['item_id', 'shop_id', 'date_block_num'])","16ac615b":"train_data['item_cnt_day'].describe()","85c950d3":"train_data.loc[train_data['item_cnt_day'] > 500]","2fbb194d":"train_data.loc[train_data['item_cnt_day'] < -10]","dfabd3ca":"n_itemid_shopid_month = itemid_shopid_month['item_cnt_day'].count()\nn_itemid_shopid_month.describe()","bd3d52a3":"itemid_shopid_month_pos = train_data.loc[train_data['item_cnt_day'] > 0].groupby(['item_id', 'shop_id', 'date_block_num'])","a345d5f7":"train_data.loc[train_data['item_cnt_day'] > 0, ['item_id', 'shop_id', 'date_block_num', 'item_cnt_day']]","582f443e":"n_itemid_shopid_month_pos = itemid_shopid_month_pos['item_cnt_day'].count()\nn_itemid_shopid_month_pos.describe()","4576c2d9":"n_itemid_shopid_month_pos","dd216ed6":"tot_itemid_shopid_month_pos = itemid_shopid_month_pos['item_cnt_day'].sum()\ntot_itemid_shopid_month_pos.describe()","d54ab4d2":"tot_itemid_shopid_month_pos","72ca502f":"print(train_data['item_id'].describe())\nprint(train_data['shop_id'].describe())","05463b9f":"print(test_raw_data['item_id'].describe())\nprint(test_raw_data['shop_id'].describe())","a0c18206":"def find_unique_item_shops(data):\n    item_shop_ids = set()\n    for index, row in data.iterrows():\n        item_shop = (row['item_id'], row['shop_id'], )\n        if item_shop not in item_shop_ids:\n            item_shop_ids.add(item_shop)\n\n    return item_shop_ids","6a9d4579":"train_item_shop_ids = find_unique_item_shops(train_data)","8b52228f":"test_item_shop_ids = find_unique_item_shops(test_raw_data)","108d111d":"len(train_item_shop_ids)","4eec6a4c":"len(test_item_shop_ids)","b07aa58b":"cnt = 0\nfor item_shop_id in test_item_shop_ids:\n    if item_shop_id not in train_item_shop_ids:\n        print(item_shop_id)\n        cnt += 1\n\nprint(cnt)","87b6d97c":"tot_itemid_shopid_month_pos.sort_index(inplace=True)\ntot_itemid_shopid_month_pos_df = tot_itemid_shopid_month_pos.reset_index()","cf953970":"def get_33_sales(r): \n    try:\n        return tot_itemid_shopid_month_pos.loc[(r['item_id'], r['shop_id'], 33)]\n    except pd.core.indexing.IndexingError:\n        return 0\n    except KeyError:\n        return 0\n\npred_prev_value_bench = test_raw_data.apply(get_33_sales, axis=1)","dd609a96":"pred_prev_value_bench.describe()","86de6af4":"pred_prev_value_bench_clipped = pred_prev_value_bench.clip(0, 20)","0c2db030":"prev_value_bench_df = pd.DataFrame()\nprev_value_bench_df['ID'] = test_raw_data['ID']\nprev_value_bench_df['item_cnt_month'] = pred_prev_value_bench_clipped","daeee479":"prev_value_bench_df.to_csv('submission1.csv', header=True, index=False)","2d2dc8bc":"print(check_output([\"ls\", \"..\/working\"]).decode(\"utf8\"))","027b6114":"# train_data['week_day'] = train_data['date'].dt.weekday","115f64a7":"train_data_final = pd.DataFrame(train_data[train_data['item_cnt_day'] > 0].groupby(['date_block_num', 'item_id', 'shop_id'])['item_cnt_day'].sum())\ntrain_data_final.columns = ['item_cnt_month']","9ff29fda":"returned_items_df = pd.DataFrame(train_data[train_data['item_cnt_day'] < 0].groupby(['date_block_num', 'item_id', 'shop_id'])['item_cnt_day'].sum())\nreturned_items_df.columns = ['item_cnt_rtn_last_month']\nreturned_items_df.reset_index(inplace=True)\nreturned_items_df['item_cnt_rtn_last_month'] *= -1\nreturned_items_df['date_block_num'] += 1","3dd97d99":"train_data_final = train_data_final.join(returned_items_df.set_index(['date_block_num', 'item_id', 'shop_id']), how='left')","e4a41d66":"train_data_final.loc[:, 'item_cnt_rtn_last_month'] = train_data_final.loc[:, 'item_cnt_rtn_last_month'].fillna(0)","272f04c8":"train_data_final.sort_index(inplace=True)","3c2047df":"train_data_final.loc[:, 'first_month'] = 0\ntrain_data_final.loc[(0), 'first_month'] = 1","87ee01ed":"total_items_df = pd.DataFrame(train_data[train_data['item_cnt_day'] > 0].groupby(['date_block_num', 'item_id', 'shop_id'])['item_cnt_day'].sum())\ntotal_items_df.columns = ['item_cnt_sold_last_month']\ntotal_items_df.reset_index(inplace=True)\ntotal_items_df['date_block_num'] += 1","521d482c":"train_data_final = train_data_final.join(total_items_df.set_index(['date_block_num', 'item_id', 'shop_id']), how='left')","befb5c34":"train_data_final.loc[:, 'item_cnt_sold_last_month'].fillna(0, inplace=True)","6ef4f2b2":"items_sold_year_ago_df = train_data_final.reset_index()\nitems_sold_year_ago_df['date_block_num'] += 12\nitems_sold_year_ago_df.drop(items_sold_year_ago_df[items_sold_year_ago_df['date_block_num'] > 34].index, axis=0, inplace=True)\nitems_sold_year_ago_df.drop(['item_cnt_rtn_last_month', 'first_month', 'item_cnt_sold_last_month'], axis=1, inplace=True)\nitems_sold_year_ago_df.rename(columns={'item_cnt_month': 'item_cnt_prev_year'}, inplace=True)","df8fbd5e":"train_data_final = train_data_final.join(items_sold_year_ago_df.set_index(['date_block_num', 'item_id', 'shop_id']), how='left')","2cfb9d3d":"train_data_final.fillna(0, inplace=True)","70c32b8e":"train_data_final","11bcf26b":"There can be large values in previous month which can be very harmful, hence I am clipping the large values to 20.","5ab4adf8":"item_id 20949 is present very high number of times","4987a6f2":"## Feature Generation","ff1a04c4":"number of negative + positive values of item cnt day of an item in a shop in a month","ff92e83f":"number of positive values of item cnt day of an item in a shop in a month","926b1c3d":"### Number of items sold in same month last year\nIf there are specific occassions during a month that impacts sales of an item in some region, then that will be captured here","f3f88816":"convert date table into usable format","f171046d":"### Number of week day this item was sold","14e370de":"This notebook is under progress...\nThank you for reading.","21f7addc":"### is there any item_id, shop_id combination in test data not in train data?","37b60574":"items that are returned many times","b899037c":"### This month is first month or not","5e45c63d":"### Number of times this item was sold this month (target)","38668efe":"### Number of times this item was sold in last month","680ae952":"It gives score of 1.16813 on public leaderboard","0bbe7940":"sum is the thing that we want to predict","0d49b775":"## previous value benchmark\nFind out the baseline for prediction to compare models. Here I am using the sales of item in previous month as prediction in the month of the test set. For the item id and shop id combination not there in previous month, I am taking that as 0.","4ec1f65b":"for item_id 11373 shop_id 12, on date 2015-10-28, price is very low (can be reason of high sales)","e115ddb9":"## Check for null values","5dcc5ab7":"### Number of times this item in this shop was returned last month","a0040fbe":"## Some analysis of various columns","edf5b220":"join train data table with item data to get item category id information","1f508ef3":"\nitems that have very large value of item cnt day (may be outlier)"}}