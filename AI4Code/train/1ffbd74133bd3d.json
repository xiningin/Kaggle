{"cell_type":{"1143cad2":"code","b6284ff1":"code","08aecbfd":"code","4ce600c9":"code","8a893bfa":"code","be398b71":"code","3d45ed73":"code","87dbee49":"code","9059ce7e":"code","19337c3e":"code","b5f111da":"code","c0f892f9":"code","832b5815":"code","e18ec269":"code","4a48ca2a":"code","74b10e33":"code","86b96b03":"code","66bde89f":"code","aac7ca79":"code","8c63f39f":"code","e14378da":"code","177176bd":"code","55489a7c":"code","10ae766e":"markdown","e00f0d4d":"markdown","3d33ed1c":"markdown","572ae76e":"markdown","cdf744d8":"markdown","4d20cca0":"markdown","4f378f6f":"markdown","68767b5e":"markdown","c8de15a8":"markdown","ebfe9232":"markdown","1abd7ba9":"markdown","43fdc097":"markdown","c770c081":"markdown"},"source":{"1143cad2":"import pandas as pd\nimport statsmodels.api as sm\nimport statsmodels.formula.api as smf\nimport matplotlib.pyplot as plt\nimport seaborn as sns\ncolor = sns.color_palette()\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n%matplotlib inline","b6284ff1":"df = pd.read_csv(\"https:\/\/raw.githubusercontent.com\/noahgift\/socialpowernba\/master\/data\/nba_2017_players_with_salary_wiki_twitter.csv\");df.head()","08aecbfd":"salary_pie_social_df = df.loc[:,['PLAYER','SALARY_MILLIONS','PIE','PAGEVIEWS','TWITTER_FAVORITE_COUNT','TWITTER_RETWEET_COUNT']];salary_pie_social_df.head()","4ce600c9":"from IPython.core.display import display, HTML\ndisplay(HTML(\"<style>.container { width:100% !important; }<\/style>\"));sns.pairplot(salary_pie_social_df, hue=\"PLAYER\")","8a893bfa":"corr = salary_pie_social_df.corr()\nsns.heatmap(corr, \n            xticklabels=corr.columns.values,\n            yticklabels=corr.columns.values)","be398b71":"corr","3d45ed73":"plt.figure(figsize=[16,12])\n\nY = salary_pie_social_df['SALARY_MILLIONS']\n\nplt.subplot(221)\nplt.scatter(salary_pie_social_df['PIE'], Y, marker=\">\")\nplt.title('PIE vs SALARY')\nplt.xlabel('PIE')\nplt.ylabel('SALARY_MILLIONS')\n\n\nplt.subplot(222)\nplt.scatter(salary_pie_social_df['PAGEVIEWS'], Y, marker=\">\")\nplt.title('WIKI_PAGEVIEWS vs SALARY')\nplt.xlabel('WIKI_PAGEVIEWS')\nplt.ylabel('SALARY_MILLIONS')\n\nplt.subplot(223)\nplt.scatter(salary_pie_social_df['TWITTER_FAVORITE_COUNT'], Y, marker=\">\")\nplt.title('TWITTER_FAVORITE_COUNT vs SALARY')\nplt.xlabel('TWITTER_FAVORITE_COUNT')\nplt.ylabel('SALARY_MILLIONS')\n\nplt.subplot(224)\nplt.scatter(salary_pie_social_df['TWITTER_RETWEET_COUNT'], Y, marker=\">\")\nplt.title('TWITTER_RETWEET_COUNT vs SALARY')\nplt.xlabel('TWITTER_FAVORITE_COUNT')\nplt.ylabel('SALARY_MILLIONS')\n\n","87dbee49":"results = smf.ols('SALARY_MILLIONS ~PIE', data=salary_pie_social_df).fit()","9059ce7e":"print(results.summary())","19337c3e":"salary_pie_social_predictions_df = salary_pie_social_df.copy()","b5f111da":"salary_pie_social_predictions_df[\"predicted\"] = results.predict()\nsalary_pie_social_predictions_df","c0f892f9":"sns.lmplot(x=\"predicted\", y=\"SALARY_MILLIONS\", data=salary_pie_social_predictions_df)","832b5815":"numerical_df = salary_pie_social_df.loc[:,['SALARY_MILLIONS','PIE','PAGEVIEWS','TWITTER_FAVORITE_COUNT','TWITTER_RETWEET_COUNT']]","e18ec269":"numerical_df.info()","4a48ca2a":"numerical_df['TWITTER_FAVORITE_COUNT'].fillna(numerical_df['TWITTER_FAVORITE_COUNT'].median(), inplace = True)\nnumerical_df['TWITTER_RETWEET_COUNT'].fillna(numerical_df['TWITTER_RETWEET_COUNT'].median(), inplace = True)\n","74b10e33":"numerical_df.info()","86b96b03":"from sklearn.preprocessing import MinMaxScaler\nscaler = MinMaxScaler()\nprint(scaler.fit(numerical_df))\nprint(scaler.transform(numerical_df))","66bde89f":"from sklearn.cluster import KMeans\nk_means = KMeans(n_clusters=3)\nkmeans = k_means.fit(scaler.transform(numerical_df))\nsalary_pie_social_df['cluster'] = kmeans.labels_\nsalary_pie_social_df.head()","aac7ca79":"import ggplot\nfrom ggplot import *\nggplot(salary_pie_social_df, aes(x=\"PIE\", y=\"SALARY_MILLIONS\", color=\"cluster\")) +\\\ngeom_point(size=400) + scale_color_gradient(low = 'red', high = 'blue')","8c63f39f":"distortions = []\nfor i in range(1, 11):\n    km = KMeans(n_clusters=i,\n            init='k-means++',\n            n_init=10,\n            max_iter=300,\n            random_state=0)\n    km.fit(scaler.transform(numerical_df))\n    distortions.append(km.inertia_)\n    \nplt.plot(range(1,11), distortions, marker='o')\nplt.xlabel('Number of clusters')\nplt.ylabel('Distortion')\nplt.title(\"Team Valuation Elbow Method Cluster Analysis\")\nplt.show()","e14378da":"km = KMeans(n_clusters=3,\n            init='k-means++',\n            n_init=10,\n            max_iter=300,\n            random_state=0)\ny_km = km.fit_predict(scaler.transform(numerical_df))","177176bd":"import numpy as np\nfrom matplotlib import cm\nfrom sklearn.metrics import silhouette_samples\ncluster_labels = np.unique(y_km)\nn_clusters = cluster_labels.shape[0]\nsilhouette_vals = silhouette_samples(scaler.transform(numerical_df),\n                                     y_km,\n                                     metric='euclidean')\ny_ax_lower, y_ax_upper = 0, 0\nyticks = []\nfor i, c in enumerate(cluster_labels):\n    c_silhouette_vals = silhouette_vals[y_km == c]\n    c_silhouette_vals.sort()\n    y_ax_upper += len(c_silhouette_vals)\n    color = cm.jet(float(i)\/n_clusters)\n    plt.barh(range(y_ax_lower, y_ax_upper), c_silhouette_vals, height=1.0, edgecolor='none',color=color)\n    yticks.append((y_ax_lower + y_ax_upper)\/2)\n    y_ax_lower += len(c_silhouette_vals)\nsilhouette_avg = np.mean(silhouette_vals)\nplt.axvline(silhouette_avg,\n            color=\"red\",\n            linestyle=\"--\")\nplt.yticks(yticks, cluster_labels + 1)\nplt.ylabel('Cluster')\nplt.xlabel('Silhouette coefficient')\nplt.title('Silhouette Plot Team Valuation')\nplt.figure(figsize=(20,10))\nplt.show()","55489a7c":"f, (ax1, ax2) = plt.subplots(1, 2, figsize=(8, 3))\nkm = KMeans(n_clusters=2,\n            random_state=0)\nX = scaler.transform(numerical_df)\ny_km = km.fit_predict(X)\nax1.scatter(X[y_km==0,0],\n            X[y_km==0,1],\n            c='lightblue',\n            edgecolor='black',\n            marker='o',\n            s=40,\n            label='cluster 1')\nax1.scatter(X[y_km==1,0],\n            X[y_km==1,1],\n            c='red',\n            edgecolor='black',\n            marker='s',\n            s=40,\n            label='cluster 2')\nax1.set_title('NBA Team K-means clustering')\n\nfrom sklearn.cluster import AgglomerativeClustering\n\nX = scaler.transform(numerical_df)\nac = AgglomerativeClustering(n_clusters=2,\n                             affinity='euclidean',\n                             linkage='complete')\ny_ac = ac.fit_predict(X)\nax2.scatter(X[y_ac==0,0],\n             X[y_ac==0,1],\n             c='lightblue',\n             edgecolor='black',\n             marker='o',\n            s=40,\n            label='cluster 1')\nax2.scatter(X[y_ac==1,0],\n            X[y_ac==1,1],\n            c='red',\n            edgecolor='black',\n            marker='s',\n            s=40,\n            label='cluster 2')\nax2.set_title('NBA Team Agglomerative clustering')\nplt.legend()\nplt.show()","10ae766e":"#### Using linear regression in Python\n\nThere is a signal here, salary and pie do seem to be related.","e00f0d4d":"### Exploratory Data Analysis (EDA)","3d33ed1c":"**Correlation DataFrame Output**","572ae76e":" Elbow method shows that 3 clusters is decent choice","cdf744d8":"###creating  boxplot to see relationship between salary and pie\/social influence","4d20cca0":"##### Agglomerative clustering (Hierachial) vs KMeans clustering\n","4f378f6f":"#### Data Preparation for Clustering\n\n* Clustering on four columns:  Attendence, ELO, Valuation and Median Home Prices\n* Scaling the data\n","68767b5e":"##### Silhouette Plot\n\n","c8de15a8":"**2D Cluster Plot**","ebfe9232":"**Correlation Heatmap**","1abd7ba9":"#### Understand correlation heatmaps and pairplots\n","43fdc097":"#### Import and merge DataFrames in Pandas\n\n","c770c081":"#### Use seaborn lmplot to plot predicted vs actual values\n\n"}}