{"cell_type":{"5ac10362":"code","600dda2f":"code","81a45af9":"code","9fbd311f":"code","4726185a":"code","a3d43589":"code","76e4d928":"code","c45ac33e":"code","70fb3e2f":"code","f76fb984":"code","b3382ec1":"code","3a388abd":"code","bbb9080d":"code","fa7f4d40":"code","5880f0e7":"code","9b3cd5b9":"code","d123091c":"code","241e5c7e":"code","e145f1b7":"code","326811c4":"code","d5447387":"code","010b6122":"code","aab0fced":"code","4601fa26":"code","72db5bad":"code","326097ee":"code","02174ade":"code","2288f63a":"code","cd7bc8b8":"code","a9954fd6":"code","c0f0e1cd":"code","8833abbc":"code","6bbc2200":"code","45d22c9b":"code","ca0365e1":"code","c622f15f":"code","286da13e":"code","f4622af8":"code","727e17af":"code","493c7249":"code","67dfbfc2":"markdown","c60800b4":"markdown","fef3e975":"markdown","8047ae18":"markdown","444af29b":"markdown","1d636a66":"markdown","ebb5dd4a":"markdown","10b60189":"markdown","fbf7a862":"markdown","d0381d47":"markdown","5b90d47e":"markdown","c3ac2a77":"markdown","4ecf3e2c":"markdown","aa21d194":"markdown","7308c7bd":"markdown","65ba020a":"markdown","6d73286f":"markdown","0761a988":"markdown","c8a711cf":"markdown","f19b0a3e":"markdown","0f5734cb":"markdown","79b55748":"markdown","9e751fa2":"markdown","3060d583":"markdown","4f171ba8":"markdown","81ce657e":"markdown","cfd9c468":"markdown","ac762d5c":"markdown","f827a09d":"markdown","0d5710bc":"markdown","331dada5":"markdown","06de7d8f":"markdown","6233414a":"markdown","71a7d0d4":"markdown","70cf4d6c":"markdown","7a7490dd":"markdown","f93319bc":"markdown","c774a111":"markdown","495a4c93":"markdown","8bd7bb68":"markdown","35808047":"markdown"},"source":{"5ac10362":"import pandas as pd\nimport numpy as np\nimport matplotlib\nimport matplotlib.pyplot as plt \nimport seaborn as sns ","600dda2f":"medical_df = pd.read_csv(\"..\/input\/insurance\/insurance.csv\")\nmedical_df","81a45af9":"medical_df.info()","9fbd311f":"medical_df.describe().T","4726185a":"medical_df.drop(columns = [\"sex\"], inplace = True)","a3d43589":"plt.figure(figsize = (15,10))\nsns.heatmap(medical_df.corr(), annot = True);","76e4d928":"sns.relplot(x = \"age\", y = \"charges\", data = medical_df);\nplt.xlabel(\"Age of a person\")\nplt.ylabel(\"Charges incurred by medical company\")\nplt.title(\"Age vs Charges\")","c45ac33e":"sns.kdeplot(medical_df[\"age\"], shade = True);","70fb3e2f":"sns.kdeplot(medical_df[\"charges\"], shade = True);","f76fb984":"sns.relplot(x = \"bmi\", y = \"charges\", data = medical_df);\nplt.xlabel(\"BMI of a person\")\nplt.ylabel(\"Charges incurred by medical company\")\nplt.title(\"BMI vs Charges\");","b3382ec1":"sns.countplot(x = \"smoker\", data = medical_df);","3a388abd":"sns.relplot(data = medical_df, x = 'charges', y = 'bmi', kind = 'scatter', col = 'smoker');","bbb9080d":"sns.relplot(data = medical_df, x = 'charges', y = 'age', kind = 'scatter', col = 'smoker');","fa7f4d40":"sns.relplot(data = medical_df, x = 'charges', y = 'age', kind = 'scatter', col = 'region');","5880f0e7":"sns.relplot(data = medical_df, x = 'charges', y = 'bmi', kind = 'scatter', col = 'region')","9b3cd5b9":"sns.boxplot(y = \"charges\", x = \"smoker\", data = medical_df);","d123091c":"medical_df.drop(columns = [\"region\"], inplace = True)\nprint(\"Columns after dropping \", list(medical_df.columns))","241e5c7e":"#Columns for input\ntrain_cols = list(medical_df.columns[1:-1])\nprint(train_cols)","e145f1b7":"#Target column \ntarget_col = \"charges\"","326811c4":"train_inputs = medical_df[train_cols]\ntrain_target = medical_df[target_col]\n\nprint(\"Shape of train inputs \", train_inputs.shape)\nprint(\"Shape of train target \", train_target.shape)","d5447387":"from sklearn.preprocessing import OneHotEncoder\nencoder = OneHotEncoder(sparse = False, handle_unknown='ignore').fit(medical_df[[\"smoker\"]])\nencoded_cols = list(encoder.get_feature_names([\"smoker\"]))\n#print(encoded_cols)\n\ntrain_inputs[encoded_cols] = encoder.transform(medical_df[[\"smoker\"]])","010b6122":"print(\"Columns for trainining inputs \", train_inputs.columns)","aab0fced":"#train_inputs.drop(columns = [\"smoker\"], inplace = True)","4601fa26":"from sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(train_inputs, train_target, test_size = 0.2, random_state = 42, stratify = medical_df[\"smoker\"])","72db5bad":"print(\"Shape of training dataset \", X_train.shape)\nprint(\"Shape of test dataset \", X_test.shape)","326097ee":"train_smoker_counts = list(X_train[\"smoker\"].value_counts())\nprint(train_smoker_counts)\nprint(\"Percentage of smoker in train dataset = \", (train_smoker_counts[1] \/ sum(train_smoker_counts))*100, \"%\")\nprint(\"Percentage of non-smoker in train dataset \", (train_smoker_counts[0] \/ sum(train_smoker_counts))*100, \"%\")","02174ade":"test_smoker_counts = list(X_test[\"smoker\"].value_counts())\nprint(test_smoker_counts)\nprint(\"Percentage of smoker in test dataset = \", (test_smoker_counts[1] \/ sum(test_smoker_counts))*100, \"%\")\nprint(\"Percentage of non-smoker in test dataset \", (test_smoker_counts[0] \/ sum(test_smoker_counts))*100, \"%\")","2288f63a":"X_train.drop(columns = [\"smoker\"], inplace = True)\nX_test.drop(columns = [\"smoker\"], inplace = True)","cd7bc8b8":"from sklearn.tree import DecisionTreeRegressor\ntree = DecisionTreeRegressor()","a9954fd6":"tree.fit(X_train, y_train)","c0f0e1cd":"#Predictions on the training data \ntrain_preds = tree.predict(X_train)","8833abbc":"from sklearn.metrics import mean_absolute_error, mean_squared_error\nprint(\"MAE(train) = \", mean_absolute_error(y_train, train_preds))\nprint(\"MSE (train) = \", mean_squared_error(y_train, train_preds))\nprint(\"RMSE(train) = \", np.log(np.sqrt(mean_squared_error(y_train, train_preds))))","6bbc2200":"print(\"Depth of the decision tree\", tree.tree_.max_depth)","45d22c9b":"#prediction of test data\ntest_preds = tree.predict(X_test)","ca0365e1":"print(\"MAE(test) = \", mean_absolute_error(y_test, test_preds))\nprint(\"MSE(test) = \", mean_squared_error(y_test, test_preds))\nprint(\"RMSE(test) = \", np.log(np.sqrt(mean_squared_error(y_test, test_preds))))","c622f15f":"tree = DecisionTreeRegressor(max_depth = 5)\ntree.fit(X_train, y_train)","286da13e":"train_preds = tree.predict(X_train)","f4622af8":"print(\"MSE (train) = \", mean_squared_error(y_train, train_preds))\nprint(\"MAE (train) = \", mean_absolute_error(y_train, train_preds))\nprint(\"RMSE (train) = \", np.log(np.sqrt(mean_squared_error(y_train, train_preds))))","727e17af":"test_preds = tree.predict(X_test)","493c7249":"print(\"MSE (test) = \", mean_squared_error(y_test, test_preds))\nprint(\"MAE (test) = \", mean_absolute_error(y_test, test_preds))\nprint(\"RMSE (test) = \", np.log(np.sqrt(mean_squared_error(y_test, test_preds))))","67dfbfc2":"### Encode smoker column ","c60800b4":"We have 1338 records with 7 columns and 1338 rows in the dataset with charges as our target column","fef3e975":"### Charges for smoker vs non-smoker\nWith smoker more prone to diseases, it is highly likely that a smoker will incurr more cost for an insurance company compared to a non-smoker ","8047ae18":"### Correlation between all the features ","444af29b":"### Impact of region \nRegion should not have much impact on how the premium is assigned as well as expense. Let us confirm the same ","1d636a66":"From above output we can see that we dont have any missing or null values int the dataset. We have integer, float and string datatypes for our available columns.","ebb5dd4a":"### Split train and test dataset","10b60189":"From above graph we can conclude that -\n* **For a smoker, charges increases with increasing BMI**\n* **For a non smoker this pattern is not that true**","fbf7a862":"From the output shown in the graph above, we dont see any significant correlation between the features ","d0381d47":"## Model evaluation on test data","5b90d47e":"### Separate target and feature column","c3ac2a77":"## Model training - DecisionTreeRegressor with hyperparameters","4ecf3e2c":"### Let us drop the smoker column","aa21d194":"The above output shows some more details around the statistics like mean, std, min, max, etc. ","7308c7bd":"**From above graph we can see that the distribution of charges is mostly around 0 to 20,000 and data is skewed**","65ba020a":"### Create train input dataset and target dataset","6d73286f":"## Preparing data for model training\nWe can now jump into preparing data for model training. For that let us do the following - \n- Drop region column as it does not have much impact on the prediction \n- Seperate target and feature columns \n- Label encode smoker column \n- Split data for training and test ","0761a988":"## Who is the winner ?\nMachine learning algorithm training is a hit and trail process where you get the best accuracy for the data. For now DecisionTreeRegressor performed better with lesser values of MAE, MSE and RMSE compared to DecisionTreeRegressor with max_depth of 5","c8a711cf":"We have an uneven distribution of smoker yes and smoker no records in our dataset. That does makes sense in a sample as most of the people generally dont smoke or even dont tend to reveal if they smoke","f19b0a3e":"### Distribution of Charges in our dataset","0f5734cb":"**BMI too has a similiar pattern for all regions**","79b55748":"## Drop sex column \nLet us drop gender\/sex column as we do not want our model to bias decisions based on gender for things like insurance for now.\nWe can try training a model with sex column if directed by insurance company","9e751fa2":"Let us drop the smoker column now ","3060d583":"# Objetive\nTo predict the medical expenditure of a individual \n\n# Business Overivew\nMedical Insurance companies has to pay the medical facilities bills when claimed by their eligible customers. A medical insurance company decides on the medical premium to be paid by customer based on his\/her age, any existing diseaes, income, gender, location, etc. Once a customer gets into an eligible medical treatment, insurance company has to pay the bills under the terms and conditions of insurance. \nMedical insurance company collects premiums from various customers and only a fraction of those end-up claiming the insurance and this medical insurance companies end up making a hefty amount. \nIn this excerice we will predict the amount of medical insurance, company might have to pay for an individual based on the historical data. \n\n# Approach \n- Understanding existing data - Exploratory data analysis to explore patterns in the dataset\n- Preparing data for training \n- Train, test and evaluate model \n- Improve model accuracy ","4f171ba8":"## Model evaluation for test data","81ce657e":"The plot rather looks scattered but is not really showing a significant relationship between the two. O","cfd9c468":"## Import required libraries","ac762d5c":"### Drop region column ","f827a09d":"**From the graph above, we can conlude that almost all regions have same patterns and really does not impact the charges**","0d5710bc":"### Distribution of Age\nLet us see the distribution of age in our dataset","331dada5":"## Model evaluation on training data ","06de7d8f":"## Understanding existing data - Exploratory data analysis","6233414a":"### Impact of smoker\nSmokers are more prone to any critical diseases like that of heart, lungs, mouth, etc. Further when dugged, they are more likely to be a part of accidents. For sure, this habit of a person might impact the premium they pay as well the cost insurance company would occur. Let us see some stats around smokers in our dataset.","71a7d0d4":"### Impact of age on medical charges","70cf4d6c":"**There seems a linear relationship between charges and age based on whether a person is smoking or not**","7a7490dd":"## Model training - DecisionTreeRegressor with default parameters","f93319bc":"### Impact of BMI on medical charges","c774a111":"The box plot shown above, we can clearly see that -\n* charges for a smoker is too high compared to non-smoker \n* for a smoker median charge is around 38 K compared to the median of a non-smoker which is around 10K","495a4c93":"Let us see the number of smoker yes and smoker no records in the dataset","8bd7bb68":"## Model evaluation for training data ","35808047":"Above graph shows some sort of linear relationship between Age and Charges. "}}