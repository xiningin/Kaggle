{"cell_type":{"d420ca0a":"code","4aba365b":"code","15dd9c7d":"code","c0e015c7":"code","2dbb35ea":"code","79b06131":"code","c2f81c29":"code","2f26597b":"code","969027e2":"code","123b3553":"code","11ba4f8e":"code","d230d294":"code","dfdbccf9":"code","8c1e6205":"code","ac7ddef6":"code","7b7909f1":"code","430ae958":"code","425a4f8c":"code","6b97793e":"code","b75ab6a2":"code","7b6be010":"code","27a33f85":"code","53290eea":"code","1c535ea2":"code","34be73dd":"code","7ca7869b":"code","2c96dd8f":"code","7831fcba":"code","1b03cfcf":"code","8400a2fe":"code","ab5efc2d":"code","566b5018":"code","2d9e7927":"markdown"},"source":{"d420ca0a":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","4aba365b":"df = pd.read_csv(\"\/kaggle\/input\/medicaltranscriptions\/mtsamples.csv\")","15dd9c7d":"df.head()","c0e015c7":"df.drop(df.index[2449:2498], inplace = True)","2dbb35ea":"df.drop(df.index[3056:3080], inplace = True)","79b06131":"df.drop(df.index[3080:3108], inplace = True)","c2f81c29":"from fastai.text.all import * ","2f26597b":"db_lm = DataBlock(\n    blocks = TextBlock.from_df('transcription',is_lm = True),\n    get_x = ColReader('text'), \n    splitter = RandomSplitter(0.1)\n).dataloaders(df,bs=64,seq_len=72)","969027e2":"db_lm.show_batch(max_n=2)","123b3553":"vocab = pd.Series(db_lm.vocab)\nvocab.to_csv('lm_vocab.csv')","11ba4f8e":"learn = language_model_learner(\n    db_lm, AWD_LSTM, drop_mult=0.3, \n    metrics=[accuracy, Perplexity()]).to_fp16()","d230d294":"learn.fit_one_cycle(1,2e-2)","dfdbccf9":"learn.save('1epoch')","8c1e6205":"learn = learn.load('1epoch')","ac7ddef6":"learn.unfreeze()\nlearn.fit_one_cycle(14,2e-2)","7b7909f1":"learn.save_encoder('finetuned_encoder')","430ae958":"\ndls = DataBlock(\n    blocks=(TextBlock.from_df('transcription', vocab=db_lm.vocab),CategoryBlock),\n    get_x = ColReader('text'),\n    get_y = ColReader('medical_specialty'),\n    splitter=RandomSplitter()\n).dataloaders(df,bs=64)","425a4f8c":"dls.show_batch(max_n=10)","6b97793e":"learner = text_classifier_learner(dls, AWD_LSTM, drop_mult=0.5)","b75ab6a2":"learner = learner.load_encoder(\"finetuned_encoder\")","7b6be010":"learn.fit_one_cycle(1, 2e-2)","27a33f85":"learn.freeze_to(-2)\nlearn.fit_one_cycle(1, slice(1e-2\/(2.6**4),1e-2))","53290eea":"\nlearner = text_classifier_learner(dls, AWD_LSTM, drop_mult=0.5, metrics = accuracy)","1c535ea2":"learn.fit_one_cycle(1, 2e-2)","34be73dd":"learn.freeze_to(-3)\nlearn.fit_one_cycle(1, slice(5e-3\/(2.6**4),5e-3))","7ca7869b":"learn.unfreeze()\nlearn.fit_one_cycle(2, slice(1e-3\/(2.6**4),1e-3))","2c96dd8f":"learn.fit_one_cycle(4, slice(1e-3\/(2.6**4),1e-3))","7831fcba":"learner.save('initial_model')","1b03cfcf":"learner.export","8400a2fe":"learner.predict(\"IMPRESSION:  ,EEG during wakefulness, drowsiness, and sleep with synchronous video monitoring demonstrated no evidence of focal or epileptogenic activity..\")","ab5efc2d":"prediction, indice, losses = learner.predict(\"brain pain\")","566b5018":"len(prediction)","2d9e7927":"prediction"}}