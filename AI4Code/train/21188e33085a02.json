{"cell_type":{"d0ccc3f8":"code","0d677082":"code","e92d5c4e":"code","2399a3bb":"code","1bc62323":"code","4796804d":"code","25a9a8a3":"code","20c4ccd3":"code","f83f8f02":"code","61119b78":"code","1205f30e":"code","83ecde5a":"code","e04bd385":"code","363d2a65":"code","5e17d002":"code","23eafce0":"markdown","6717f583":"markdown","2bb5081b":"markdown","f5d85744":"markdown","ec5f86e6":"markdown","cee3c032":"markdown","0b95850d":"markdown","2b7d2ebd":"markdown","c29a50a6":"markdown","50f0ad49":"markdown","d2a7c539":"markdown","ec157e6a":"markdown"},"source":{"d0ccc3f8":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport datetime as dt\nfrom matplotlib.ticker import PercentFormatter\n\npd.options.mode.chained_assignment = None\n\nplt.rcParams[\"axes.facecolor\"] = \"#A2A2A2\"\nplt.rcParams[\"axes.grid\"] = 1","0d677082":"df = pd.read_csv(\"..\/input\/online-retail-final\/online_retail_final.csv\")\n\ndf.head()","e92d5c4e":"df['InvoiceDate'] = pd.to_datetime(df['InvoiceDate'])\n\nprint(\"Min date: {} \\nMax date: {}\".format(df.InvoiceDate.min(), df.InvoiceDate.max()))\nprint(\"Time difference is: {}\".format(df.InvoiceDate.max() - df.InvoiceDate.min()))","2399a3bb":"def get_month(x): return dt.datetime(x.year, x.month, 1) \n\ndef get_dates(df, col):\n    \n    year = df[col].dt.year\n    month = df[col].dt.month\n    day = df[col].dt.day\n    \n    return year, month, day","1bc62323":"df[\"InvoiceMonth\"] = df[\"InvoiceDate\"].apply(get_month)\n\ndf[\"CohortMonth\"] = df.groupby(\"CustomerID\")[\"InvoiceMonth\"].transform(\"min\")","4796804d":"df.head()","25a9a8a3":"invoice_year, invoice_month, invoice_day = get_dates(df, \"InvoiceMonth\")\ncohort_year, cohort_month, cohort_day = get_dates(df, \"CohortMonth\")\n\nyear_diff = invoice_year - cohort_year\nmonth_diff = invoice_month - cohort_month\n\ndf[\"CohortIndex\"] = 12 * year_diff + month_diff + 1","20c4ccd3":"cohort_data = df.groupby([\"CohortIndex\", \"CohortMonth\"])[\"CustomerID\"].nunique().reset_index()\ncohort_pivot = cohort_data.pivot(index = \"CohortMonth\", columns = \"CohortIndex\", values = \"CustomerID\")\n\ncohort_pivot","f83f8f02":"cohort_sizes = cohort_pivot.iloc[:, 0]\n\nretention = cohort_pivot.divide(cohort_sizes, axis = 0)\nretention.index = retention.index.strftime(\"%Y-%m\")\n\nretention","61119b78":"plt.rcParams[\"axes.facecolor\"] = \"white\"\nfig, ax = plt.subplots(figsize = (14, 10))\n\nsns.heatmap(retention, cmap = \"Blues\", annot = True, fmt = \".2%\", annot_kws = {\"fontsize\": 12}, cbar = False, ax = ax)\n\nplt.title(\"Retention Rate Percentages - Monthly Cohorts\")\nplt.yticks(rotation = 0)\nplt.show()","1205f30e":"customer_per_month = df.groupby(\"CohortMonth\")[\"CustomerID\"].nunique().values\ncustomers = customer_per_month.cumsum()\ncustomers = customers[::-1]\ncustomers","83ecde5a":"customer_in_month = df.groupby(\"CohortIndex\")[\"CustomerID\"].nunique()\ncustomer_in_month","e04bd385":"plt.rcParams[\"axes.facecolor\"] = \"#A2A2A2\"\nfig, ax = plt.subplots(figsize = (14, 8), facecolor = \"#A2A2A2\")\nax.grid(False)\nx = customer_in_month.index\ny = 100*(customer_in_month \/ customers)\n\nsns.lineplot(x = x, y = y,  color = \"#101820\", marker = \"o\", markerfacecolor = \"#0EB8F1\", markeredgecolor = \"#000000\")\n\nfor x, y in zip(x, y):\n    plt.text(x, y + 2, s = round(y, 2))\n\nplt.xlabel(\"Cohort Index\")\nplt.ylabel(\"Retention Rate %\")\nplt.title(\"Monthly Retention Rates for All Customers\")\nsns.despine()\nplt.show()","363d2a65":"monthly_customer_price_df = df.groupby(\"InvoiceMonth\").agg({\"TotalPrice\": \"sum\",\n                                                            \"CustomerID\": \"nunique\"})\n\nmonthly_customer_price_df","5e17d002":"fig, ax = plt.subplots(figsize = (16, 8), facecolor = \"#A2A2A2\")\nax.set_facecolor(\"#A2A2A2\")\n\nsns.barplot(x = np.arange(len(monthly_customer_price_df.index)), y = monthly_customer_price_df.TotalPrice, ax = ax,\n            color = \"#101820\")\nax2 = ax.twinx()\nsns.lineplot(x = np.arange(len(monthly_customer_price_df.index)), y = monthly_customer_price_df.CustomerID, ax = ax2,\n            color = \"#F1480F\", marker = \"o\", markerfacecolor = \"#0EB8F1\", markeredgecolor = \"#000000\")\n\nax.set_yticks([])\nax2.set_yticks([])\nax2.set_ylabel(\"Total Customer\", fontname = \"Times New Roman\")\nax.set_ylabel(\"Total Price\", fontname = \"Times New Roman\")\nplt.title(\"Revenue & Customer Count per Month\", fontname = \"Times New Roman\")\nax.text(-0.75, 1000000, \"Bars represent revenue \\nLine represents unique customer count\", \n        fontsize = 7, alpha = 0.8, fontname = \"Times New Roman\")\nfor x, y in zip(np.arange(len(monthly_customer_price_df.index)),  monthly_customer_price_df.CustomerID):\n    ax2.text(x -0.1, y + 20 , y, color = \"white\")\n    \nsns.despine(left = True, right = True, bottom = True, top = True)\nplt.show()","23eafce0":"Retention tables show a group of people that visited your site or used your app for the first time during a certain time frame. They also display the progressive \u2018drop-off\u2019 or decline in activity over time for that particular group (a cohort).\n\nMarketers can use Retention tables to analyze the quality of users brought by a marketing campaign and compare it to other sources of traffic.\n\n*https:\/\/www.smartlook.com\/blog\/retention-tables-introduction\/","6717f583":"# Next\n\nNext chapters:\n\nhttps:\/\/www.kaggle.com\/mustafacicek\/marketing-analytics-pareto-principle\n\nhttps:\/\/www.kaggle.com\/mustafacicek\/marketing-analytics-rfm-analysis\n\nhttps:\/\/www.kaggle.com\/mustafacicek\/marketing-analytics-forecasting\n\nFull work: https:\/\/www.kaggle.com\/mustafacicek\/detailed-marketing-cohort-pareto-rfm-forecast","2bb5081b":"Great!\n\n**Retention rate increases significantly for last months of the year.**\n\nProbably, Thanksgiving, Black Friday and Christmas causes it. There are lots of special day at the end of year.","f5d85744":"This is second part of https:\/\/www.kaggle.com\/mustafacicek\/detailed-marketing-cohort-pareto-rfm-forecast\n\nYou can reach this data from here. https:\/\/www.kaggle.com\/mustafacicek\/online-retail-final","ec5f86e6":"Our dataset contains invoice records for more than one year. Let's apply cohort analysis. We can create monthly cohorts.\n\nWe will group customers for first invoice record. Cohort index will be number of months since first transaction.","cee3c032":"# Cohort Analysis","0b95850d":"Cohort analysis is a better way of looking at data. Its application is not limited to a single industry or function. For example, eCommerce companies can use cohort analysis to spot products that have more potential for sales growth. In digital marketing, it can help identify web pages that perform well based on time spent on websites, conversions or sign-ups. In product marketing, this analysis can be used to identify the success of feature adoption rate and also to reduce churn rates.\n\n*https:\/\/www.moengage.com\/blog\/growth-tactic-1-how-to-use-cohort-analysis-to-measure-customer-retention\/","2b7d2ebd":"Let's look at above retention rate chart and interpret it.\n\n40.05% of customers that made their first shopping in January 2011, use this company after five months.","c29a50a6":"A cohort simply means that a group of people they have same characteristics.\n\nGenerally, we have three type of cohort analysis:\n\n   - **Time cohorts** or **Acquisition cohorts**: Groups are divided by first activity.\n   - **Behavior cohorts** or **Segment-Based cohorts**: Groups are divided by their behaivors and actions about your service.\n   - **Size cohorts**: Size-based cohorts refer to the various sizes of customers who purchase a company\u2019s products or services.","50f0ad49":"Cohort analysis is a subset of behavioral analytics that takes the data from a given eCommerce platform, web application, or online game and rather than looking at all users as one unit, it breaks them into related groups for analysis. These related groups, or cohorts, usually share common characteristics or experiences within a defined time-span.\n\nCohort analysis is a tool to measure user engagement over time. It helps to know whether user engagement is actually getting better over time or is only appearing to improve because of growth.\n\nCohort analysis proves to be valuable because it helps to separate growth metrics from engagement metrics as growth can easily mask engagement problems. In reality, the lack of activity of the old users is being hidden by the impressive growth numbers of new users, which results in concealing the lack of engagement from a small number of people.\n\n*https:\/\/clevertap.com\/blog\/cohort-analysis\/","d2a7c539":"# Retention Rate\n\n![](https:\/\/images.ctfassets.net\/vrkkgjbn4fsk\/7KUaWGQ9IJvf85OheLucgk\/e03a27e5c68cc317b38dda354fee504d\/how_to_calculate_user_retention_rate)\n\n*https:\/\/amplitude.com\/blog\/how-to-calculate-retention-rate-b2b-saas","ec157e6a":"Above data is our cohort table. Its interpretation is simple. \n\nFor example, We have 874 unique customer with their first transaction is in 2010-12. Its cohort month is 2010-12 and cohort index is 1. Go on the one right cell, it is 319.\nIts mean, 319 unique customer retain their customership for next month."}}