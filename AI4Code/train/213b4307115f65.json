{"cell_type":{"4887b486":"code","e9868f9b":"code","7a24ff87":"code","08b6b175":"code","df02e6fb":"code","032b076e":"code","e7be5201":"markdown","afe549e4":"markdown","0361e340":"markdown","3a34f39c":"markdown","26e6d651":"markdown","2d592e3a":"markdown","18a6f6cd":"markdown"},"source":{"4887b486":"import numpy as np \nimport pandas as pd \nimport folium\nfrom folium import IFrame\n\ndf = pd.read_csv(\"..\/input\/poole2018.csv\")","e9868f9b":"#colours for each marker\ncolor_key={'5':'darkblue','4':'blue','3':'purple','2':'lightred','1':'darkred','0':'black','AwaitingInspection':'lightgray','Exempt':'lightgray'}\n\n#initialise the map\nmap_hyg = folium.Map(location=[50.7299,-1.9615],zoom_start = 13) \n\n#add a marker to the map for each establishment\nfor index,row in df.iterrows():\n    folium.Marker([row['Lat'], row['Long']],\n                  popup= \"<b>\"+row['Name']+\"<\/b> <br> Type: \"+row['Type']+\"<br> <br> Rating: \"+row['Rating'],\n                  icon=folium.Icon(color=color_key[row['Rating']])\n                 ).add_to(map_hyg)\n#show the map\nmap_hyg","7a24ff87":"from folium import plugins\nfrom folium.plugins import HeatMap\n\n#initialise the heatmap\nheatmap = folium.Map(location=[50.7299,-1.9615],zoom_start = 13) \n\n# make the data for the heatmap by collecting the coordinates in a list\nheat_data = [[row['Lat'],row['Long']] for index, row in df.iterrows()]\n\n# Plot it on the map\nHeatMap(heat_data).add_to(heatmap)\n\n# Display the map\nheatmap","08b6b175":"#get counts for each rating for each est. type\ncounts=[]\nfor est_type in np.unique(df['Type']):\n    est_type_data={}\n    df_type=df[df['Type']==est_type].copy()\n    for rating in np.unique(df_type['Rating']):\n        est_type_data[rating]=(df_type.Rating == rating).sum()\n    counts.append(est_type_data)\n#create and show the resulting dataframe\ndf_counts=pd.DataFrame(counts,index=np.unique(df['Type'])).fillna(0)\ndf_counts","df02e6fb":"#plot a stacked bar chart of the dataframe\nimport seaborn as sns\nfrom matplotlib.colors import ListedColormap\n\nsns.set(rc={'figure.figsize':(30,15)},font_scale=3)\ndf_counts.iloc[:,0:5].plot(kind='bar', stacked=True,colormap=ListedColormap(sns.color_palette(\"GnBu\", 5)),)","032b076e":"from folium import plugins \n\n#initialise the heatmap\nheatmap = folium.Map(location=[50.7299,-1.9615],zoom_start = 13)\n\n#colelct the data for the heatmap in a list of lists (one for each year)\nheat_data=[]\nyears=np.arange(2013,2019)\nfor year in years:\n    file=\"..\/input\/poole\"+str(year)+\".csv\"\n    print(file)\n    df = pd.read_csv(file)\n    heat_data.append([[row['Lat'],row['Long']] for index, row in df.iterrows()])\n\n# Plot it on the map\nhm = plugins.HeatMapWithTime(heat_data,auto_play=True,max_opacity=0.8)\nhm.add_to(heatmap)\n\n# Display the map \nheatmap\n\n#Note the buttons to control the heatmap are on the bottom right. Not sure why they arent visible, but if you hover over them the commands can be seen","e7be5201":"# Exploration of Poole (UK) food hygiene ratings\n\nUnlike Wales, food establishments in England aren't legally required to display their food hygiene rating on their building. The result of this is that only establishments that have a good rating display it. However, the ratings of all establishments are freely available online, so we can map all this data! I haven't seen this done before, and figured it could be useful for people looking for somewhere to eat in a new city.\n\n## What?\n\nThis is a quick visualisation of food hygeine ratings data in Poole, UK. \n\nThe food hygiene ratings are explained here: https:\/\/www.food.gov.uk\/safety-hygiene\/food-hygiene-rating-scheme\n\nThe data can be found here: http:\/\/ratings.food.gov.uk\/open-data\/en-GB","afe549e4":"## Create a heatmap of the establishments","0361e340":"Looks like takeaways\/sandwich shops have a higher proportion of low (<4) hygiene ratings than resteraunts\/cafes\/canteens.\nAlso hospitals\/childcare\/caring premises, retailers and schools\/universities seem to have proportionally very high hygeiene ratings, as you'd hope.\nMost suprising to me is that mobile caterers also have a high proportion of 5 rated establishments, although the sample size may be too small to draw too many conclusions.","3a34f39c":"## Import libraries and read data","26e6d651":"## Create time-series heatmap of establishments between 2013 and 2018","2d592e3a":"## Create a map of the establishment's hygiene ratings\nNote that the coordinates aren't the best - sometimes when establishments are nearby they will be given the same coordinates, and when plotted on this map the markers will simply overlap.\nAlso, I'm aware of many resteraunts that don't appear in the dataset (not sure why the food standards agency haven't included them).","18a6f6cd":"## Visualising food hygiene by establishment type"}}