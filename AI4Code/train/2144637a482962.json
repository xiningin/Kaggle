{"cell_type":{"496530f0":"code","c16253d0":"code","c9fbf0ff":"code","0c6d4002":"code","1347c86b":"code","68097d21":"code","00eb474b":"code","ebf579b7":"code","b7282b08":"code","42adb14d":"code","0fc1dc50":"code","b23f53f4":"code","409928b9":"code","bdf43afd":"code","62719e88":"code","f60945b9":"code","675a3710":"code","30d5b3ec":"code","cdf21968":"code","352cab12":"code","0f0de29f":"code","522e5972":"code","349b4fdf":"code","f41d79b3":"code","d989f495":"code","93cb9018":"code","94599613":"code","17ac7b1b":"code","450cd0d1":"code","6d756c32":"code","9a33d648":"markdown","b9f81588":"markdown","082ad4f0":"markdown","e0a811dc":"markdown","b870767d":"markdown","aa454368":"markdown","b4df0268":"markdown","b1c9c3c6":"markdown","6ddaca71":"markdown","115eaca3":"markdown","b2fc4c40":"markdown","bf1996ee":"markdown","34adcded":"markdown","462683fa":"markdown","c45b57f2":"markdown","bf916d22":"markdown","8613fa06":"markdown","8e419693":"markdown","7c74c13d":"markdown","b169468e":"markdown","65432669":"markdown","c9e9579e":"markdown","0e337498":"markdown","a6837091":"markdown","7e3952dc":"markdown","c2a0c7dc":"markdown","26e74412":"markdown"},"source":{"496530f0":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","c16253d0":"# Seaborn for visualization\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\n## initial viz settings ##\nsns.set(font_scale=1.2)\ncol = '#3B1C8C'\ncm = 'viridis'","c9fbf0ff":"df = pd.read_csv('\/kaggle\/input\/absenteeism-at-work-uci-ml-repositiory\/Absenteeism_at_work.csv', sep=';')\n\nnRow, nCol = df.shape\nprint(f'There are {nRow} rows and {nCol} columns')","0c6d4002":"df.head(10)","1347c86b":"# Rename columns\ndf.rename(columns={'Reason for absence': 'Reason',\n                  'Month of absence': 'Month',\n                  'Day of the week': 'Weekday',\n                   'Seasons': 'Season',\n                   'Disciplinary failure': 'Failure',\n                  'Transportation expense': 'Expense',\n                  'Distance from Residence to Work': 'Distance',\n                  'Service time': 'ServiceTime',\n                  'Work load Average\/day ': 'Workload',\n                   'Hit target': 'HitTarget',\n                   'Son': 'Child',\n                  'Social drinker': 'Drinker',\n                  'Social smoker': 'Smoker',\n                  'Body mass index': 'BMI',\n                  'Absenteeism time in hours': 'AbsH'}, \n          inplace = True)\ndf.head(10)","68097d21":"# add the string values for education\n#high school (1), graduate (2), postgraduate (3), master and doctor (4)\n\ndf.loc[(df['Education'] == 1),'Edu_Text'] = 'High school'\ndf.loc[(df['Education'] == 2),'Edu_Text'] = 'Graduate'\ndf.loc[(df['Education'] == 3),'Edu_Text'] = 'Postgraduate'\ndf.loc[(df['Education'] == 4),'Edu_Text'] = 'Master and doctor'\ndf.head(10)","00eb474b":"# Convert  attributes to categories\n\ndf['Month'] = df['Month'].astype('category')\ndf['Weekday'] = df['Weekday'].astype('category')\ndf['Reason'] = df['Reason'].astype('category')\ndf['Failure'] = df['Failure'].astype('category')\ndf['Season'] = df['Season'].astype('category')\ndf['Education'] = df['Education'].astype('category')\ndf['Edu_Text'] = df['Edu_Text'].astype('category')\ndf['Drinker'] = df['Drinker'].astype('category')\ndf['Smoker'] = df['Smoker'].astype('category')","ebf579b7":"df.describe(include = 'all')","b7282b08":"plt.figure(figsize = (15, 6))\nsns.distplot(df['AbsH'], color = col, kde = False)\nplt.show()","42adb14d":"plt.figure(figsize = (15, 6))\nsns.boxplot(x = df['Reason'], y = df['AbsH'])\nplt.show()","0fc1dc50":"df[['ID','Month', 'Weekday','Reason', 'AbsH']] \\\n.sort_values(['AbsH', 'ID'], ascending = [0, 1])[:5]","b23f53f4":"df[['ID','Month', 'Weekday','Reason', 'AbsH']] \\\n.sort_values(['AbsH', 'ID'], ascending = [1, 1])[:5]","409928b9":"df[df['Month'] == 0][['ID','Month', 'Weekday','Reason', 'AbsH']]","bdf43afd":"plt.figure(figsize = (15,4))\nplt.subplot(1, 2, 1)\nsns.barplot(df.groupby(['Weekday'])['AbsH'].sum().index, \n            df.groupby(['Weekday'])['AbsH'].sum(), \n            color = col)\nplt.subplot(1, 2, 2)\nsns.barplot(df.groupby(['Month'])['AbsH'].sum().index, \n            df.groupby(['Month'])['AbsH'].sum(), \n            color = col)\nplt.show()","62719e88":"plt.figure(figsize = (15, 6))\nsns.heatmap(df.groupby(['Month', 'Weekday'])['AbsH'].sum().unstack()[1:13], \n            annot = True, fmt = 'g', cmap = cm) \nplt.show()","f60945b9":"plt.figure(figsize = (15, 6))\nsns.heatmap(df.groupby(['Month', 'Weekday'])['ID'].nunique().unstack()[1:13], cmap = cm, annot = True, fmt = 'g')\nplt.show()","675a3710":"#hours_per_reason = df.groupby('Reason')['AbsH'].sum()\n#id_per_reason = df.groupby('Reason')['ID'].nunique()\n\nreason_df = pd.concat([df.groupby('Reason')['AbsH'].sum(), df.groupby('Reason')['ID'].nunique()], axis=1, sort=False)\nreason_df.columns = ['AbsH', 'AbsIDs']\n\nreason_df.head(5)","30d5b3ec":"plt.figure(figsize = (12,6))\np1 = sns.scatterplot(x=reason_df.index[1:], y=\"AbsH\", size=\"AbsIDs\", hue =\"AbsIDs\", palette = cm,\n                sizes=(20, 1000),data=reason_df[1:], markers = True)\nplt.legend(loc='upper left')\nplt.show()","cdf21968":"reason_df = reason_df.sort_values('AbsH', ascending = 0)\nreason_df['cum_sum'] = reason_df['AbsH'].cumsum()\nreason_df['cum_perc'] = 100 * reason_df['cum_sum'] \/ reason_df['AbsH'].sum()\n\nround(reason_df[:15],1).T","352cab12":"plt.figure(figsize = (18, 6))\nsns.heatmap(df[df['Reason'] != 0].groupby(['Month', 'Reason'])['AbsH'].sum().unstack(), \n            cmap = cm, annot = True, fmt = 'g')\nplt.show() ","0f0de29f":"plt.figure(figsize = (18, 6))\nax = sns.heatmap(df[df['Reason'] != 0].groupby(['Month', 'Reason'])['ID'].nunique().unstack(), \n                 cmap = cm, annot = True, fmt = 'g')\n\nplt.xlabel('Reason')\nplt.show()","522e5972":"age = df['Age'].groupby(df['ID']).max()\nedu = pd.to_numeric(df['Education']).groupby(df['ID']).max().astype('category')\nson = df['Child'].groupby(df['ID']).max()\ndrink = pd.to_numeric(df['Drinker']).groupby(df['ID']).max().astype('category')\nsmoke = pd.to_numeric(df['Smoker']).groupby(df['ID']).max().astype('category')\nfail = pd.to_numeric(df['Failure']).groupby(df['ID']).max().astype('category')\npet = df['Pet'].groupby(df['ID']).max()\nservice = df['ServiceTime'].groupby(df['ID']).max()\nweight = df['Weight'].groupby(df['ID']).max()\nheight = df['Height'].groupby(df['ID']).max()\nbmi = df['BMI'].groupby(df['ID']).max()\nexp = df['Expense'].groupby(df['ID']).max()\ndist = df['Distance'].groupby(df['ID']).max()\nabsh = df['AbsH'].groupby(df['ID']).sum()\nreason = df[df['Reason'] != 0].groupby('ID')['Reason'].nunique()\n\n#new features \nhitmax = df['HitTarget'].groupby(df['ID']).max()\nhitmin = df['HitTarget'].groupby(df['ID']).min()\nhitmean = round(df['HitTarget'].groupby(df['ID']).mean(),2)\nwlmax = round(df['Workload'].groupby(df['ID']).max(),2)\nwlmin = round(df['Workload'].groupby(df['ID']).min(),2)\nwlmean = round(df['Workload'].groupby(df['ID']).mean(),2)","349b4fdf":"ind_df = pd.concat([age, edu, son, drink, smoke, fail, pet, hitmax, hitmin, hitmean, \n                    wlmax, wlmin, wlmean, service, weight, height, bmi, exp,dist,reason,absh], axis=1, sort=False)\n\nind_df.columns = ['Age', 'Education', 'Child', 'Drinker', 'Smoker', 'Failure', 'Pet',\n       'HT_Max', 'HT_Min', 'HT_Mean', 'WL_Max', 'WL_Min',\n       'WL_Mean', 'ServiceTime', 'Weight', 'Height', 'BMI', 'Expense',\n       'Distance', 'R_Count', 'AH_Sum']","f41d79b3":"ind_df.loc[(ind_df['Education'] == 1),'Edu_Text'] = 'High school'\nind_df.loc[(ind_df['Education'] == 2),'Edu_Text'] = 'Graduate'\nind_df.loc[(ind_df['Education'] == 3),'Edu_Text'] = 'Postgraduate'\nind_df.loc[(ind_df['Education'] == 4),'Edu_Text'] = 'Master and doctor'","d989f495":"# employees without absence has reason_count = 0\nind_df['R_Count'] = ind_df['R_Count'].fillna(0)","93cb9018":"ind_df.head()","94599613":"plt.figure(figsize = (12,6))\nsns.scatterplot(ind_df.index, ind_df['WL_Max'], color = '#450256', s = 80, label = 'Max')\nplt.scatter(ind_df.index, ind_df['WL_Mean'], color = '#5AC865',  s = 80, label = 'Mean')\nplt.scatter(ind_df.index, ind_df['WL_Min'], color = '#21908D',  s = 80, label = 'Min')\nplt.ylabel('Workload')\nplt.xlabel('Employee')\nplt.legend(fontsize  = 'large', bbox_to_anchor=(1, 0.5))\nplt.show()","17ac7b1b":"plt.figure(figsize = (8,6))\n\ncorr = ind_df.drop(['Weight', 'Height'], axis=1).corr()\n\nax = sns.heatmap(\n    corr[((corr <= -0.5) | (corr >= 0.5)) & (corr != 1)], \n    vmin = -1, vmax = 1, center = 0,\n    cmap = cm,\n    square = True,\n    linewidths = .5\n    #annot = True\n)\n\nax.set_xticklabels(\n    ax.get_xticklabels(),\n    rotation = 90,\n    horizontalalignment = 'right'\n)\nplt.show() ","450cd0d1":"plt.figure(figsize = (8,6))\nsns.regplot(ind_df['Age'], ind_df['ServiceTime'], color = col, scatter_kws = {'s':80})\nplt.show()","6d756c32":"plt.figure(figsize = (8,6))\nsns.regplot(ind_df['HT_Min'], ind_df['AH_Sum'], color = col, scatter_kws = {'s':80})\nplt.show()","9a33d648":"# 2.1 Explore Observations","b9f81588":"### Number of employees per month and weekday\n\nWhat one can see: \n\n- Most employees are absent on Wednesdays in May, 2nd are Mondays in July and Tuesdays in September.\n\nThose analyses can help the company in two ways:\n\n- Look for reasons: was there something special in the past?\n- Prepare for future: some more employees \/ helper can support in in case of bottlenecks.\n\n","082ad4f0":"### Create a new df based on data per reason","e0a811dc":"### Absence hours per reason","b870767d":"But \"month\" and \"day\" in combination gives a different result:\n\nThe Tuesdays in July have the highest sum of absence hours, 2nd are the Tuesdays in December.","aa454368":"What one can see: \n\nEmployee 9 has been absent for 120h (=15d) on Tuesdays in July over 3 years for reason 6 (Diseases of the nervous system) and 112h (=14d) on Tuesdays in March for reason 12 (Diseases of the skin and subcutaneous tissue).\n\nWhat is not clear: \n\nHow the absence hours are distributed over the years. In the case of the 120h, the employee must have been absent almost every Tuesday in July over the three years. If there are e.g. 8h, one doesn't know when that happened and how the hours are distributed.\n","b4df0268":"### Workload per employee\n\nThe daily workload differs: for some is the average workload as high as the maximum for others.","b1c9c3c6":"# 2.2 Explore monthly data","6ddaca71":"### Absence hours and number of employees per peason\n\nWhat one can see:\n\n- Reason 13 (musculoskeletal system and connective tissue) causes the most absence hours, and 18 employees are affected.\n- Reason 19 (Injury, poisoning and certain other consequences of external causes) has the 2nd place, 16 employees are affected\n- Reason 23 (medical consultation) causes the 3rd most absence hours and most of the employees (24) are affected.\n- Reason 20 (external causes of morbidity and mortality) includes traffic accident: just an additional ICD-10 code and not included in that dataset\n\n","115eaca3":"### Are some attributes correlated?\n\nPositive correlated are:\n\n- Age & ServiceTime\n- HitTargetMaximum & Number of Reasons\n- HitTargetMaximum & Sum of Absence Hours\n- and also Min\/Max\/Mean of HitTarget, Workload in some cases\n\nNegative correlated are:\n\n- HitTargetMinimum & Sum of Absence Hours\n- WorkloadMinimum & Number of Reasons","b2fc4c40":"### Number of IDs (employees) per month and reason\n\nReasons with the highest number of absent employees:\n\n- 23: medical consultation - less during Brazilian summer\n- 28: dental consultation - more or less evenly distributed\n\n","bf1996ee":"### Cumulated absence hours\n\nWhat one can see: only five reasons cause more than 50% of absence hours\n\n- 13: Diseases of the musculoskeletal system and connective tissue\n- 19: Injury, poisoning and certain other consequences of external causes\n- 23: medical consultation\n- 28: dental consultation\n- 11: Diseases of the digestive system","34adcded":"### Top 5: Least absence hours per observation","462683fa":"# 2.3 Explore the reasons","c45b57f2":"### What one can see per observation (row)\n\n* how many hours an employee was absent\n* for a certain reason\n* in a certain month\n* on a certain weekday\n* over 3 years\n* plus some work-related data like expense for traveling to work, distance, service time\n* plus some personal data for each ID like age, education, childs\n\n","bf916d22":"### Sum of absence hours per month and reason\n\nThe two top categories stick out:\n\n- 13: Diseases of the musculoskeletal system and connective tissue - peak in April\n- 19: Injury, poisoning and certain other consequences of external causes - peak in March\n\n","8613fa06":"# 2. Data Exploration","8e419693":"### Histogram of Absence Hours","7c74c13d":"### Absence hours per month and per weekday\nMondays and March have the highest sum of absence hours.","b169468e":"# 1. Data reading and little bit of wrangling","65432669":"### Employees without any absence","c9e9579e":"# 2.4 Explore individual employee data","0e337498":"What one can see: \n\nThere are some absence hours = 0, reason = 0 and also month = 0.\n\nThat looks like the dataset contains all the employees, and some haven't been absent in certain months or have never absent (month = 0).","a6837091":"### Top 5: Most absence hours per observation","7e3952dc":"What one can see:\n\nThere are 3 employees without any absence hours during the 3 years.\n\nWhat is not clear: \n\nWhen these 3 employees have started to work for the company - maybe that was just a month before the data collection has finished.","c2a0c7dc":"What one can see in the boxplot:\n\nReason 9 (Diseases of the circulatory system) causes longer absences, followed by Reason 12  \t(Diseases of the skin and subcutaneous tissue).","26e74412":"### Create a new df based on individual employee data"}}