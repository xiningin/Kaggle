{"cell_type":{"7d3700e1":"code","fc676315":"code","371a931a":"code","5cb1e27c":"code","ecf273e9":"code","78d2ebdd":"code","6b41d48f":"code","3c79df93":"code","7425952d":"code","2974249c":"code","7b373838":"code","db6cc079":"code","f2cdd268":"code","7e958f63":"markdown","e407a62e":"markdown","b8d60dde":"markdown","52391e40":"markdown","18d1497e":"markdown","f8b390e6":"markdown","a2910289":"markdown","00e86062":"markdown","650aaea2":"markdown","d175f77f":"markdown"},"source":{"7d3700e1":"pip install -U lightautoml","fc676315":"# Standard python libraries\nimport os\nimport time\nimport re\n\n# Installed libraries\nimport numpy as np\nimport pandas as pd\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn.model_selection import train_test_split\nimport torch\n\n# Imports from our package\nfrom lightautoml.automl.presets.tabular_presets import TabularAutoML, TabularUtilizedAutoML\nfrom lightautoml.dataset.roles import DatetimeRole\nfrom lightautoml.tasks import Task\nfrom lightautoml.utils.profiler import Profiler","371a931a":"N_THREADS = 4 # threads cnt for lightautoml\nRANDOM_STATE = 42 # fixed random state for various reasons\nTIMEOUT = 6 * 3600 # Time in seconds for automl run","5cb1e27c":"np.random.seed(RANDOM_STATE)\ntorch.set_num_threads(N_THREADS)","ecf273e9":"%%time\n\ntrain_data = pd.read_csv('..\/input\/tabular-playground-series-feb-2021\/train.csv')\ntrain_data.head()","78d2ebdd":"test_data = pd.read_csv('..\/input\/tabular-playground-series-feb-2021\/test.csv')\ntest_data.head()","6b41d48f":"submission = pd.read_csv('..\/input\/tabular-playground-series-feb-2021\/sample_submission.csv')\nsubmission.head()","3c79df93":"%%time\ndef rmse(y_true, y_pred, **kwargs):\n    return mean_squared_error(y_true, y_pred, squared = False, **kwargs)\n\ntask = Task('reg')","7425952d":"%%time\n\nroles = {\n    'target': 'target',\n    'drop': ['id'],\n}","2974249c":"%%time \n\nautoml = TabularUtilizedAutoML(task = task, \n                               timeout = TIMEOUT,\n                               cpu_limit = N_THREADS,\n                               reader_params = {'n_jobs': N_THREADS},\n                               general_params = {'use_algos': [['linear_l2', 'lgb', 'lgb_tuned']]}, # Use only linear models and LGBM and no CatBoost\n                               tuning_params = {'max_tuning_time': 25 * 60}, # Set 25 minutes for LGBM params tuning\n                               lgb_params = {'default_params': {'num_trees': 100000, 'learning_rate': 0.005, 'early_stopping_rounds': 1000}, # Set smaller LR and more ES rounds\n                                             'freeze_defaults': True},\n                              )\noof_pred = automl.fit_predict(train_data, roles = roles)\nprint('oof_pred:\\n{}\\nShape = {}'.format(oof_pred[:10], oof_pred.shape))","7b373838":"%%time\n\ntest_pred = automl.predict(test_data, n_jobs = N_THREADS)\nprint('Prediction for test data:\\n{}\\nShape = {}'.format(test_pred[:10], test_pred.shape))\n\nprint('Check scores...')\nprint('OOF score: {}'.format(rmse(train_data['target'].values, oof_pred.data[:, 0])))","db6cc079":"submission['target'] = test_pred.data[:, 0]\nsubmission.to_csv('lightautoml_sport_mode_util_modified.csv', index = False)","f2cdd268":"submission","7e958f63":"# Step 0.3. Fix torch number of threads and numpy seed ","e407a62e":"# Step 0.0.0. Introduction\n\nIn previous version of this kernel we used `TabularAutoML` with updated params. In this version we will run `TabularUtilizedAutoML` preset on full data for 6 hours and check the final score :) \n\n\n# Step 0.0. Install LightAutoML","b8d60dde":"\n## Step 3. Train LightAutoML model on full data \n\nBelow we are going to create specific AutoML preset with updated LGBM params to activate Kaggle solver mode:","52391e40":"## Step 4. Predict for test data and check OOF score","18d1497e":"# Step 0.2. Parameters ","f8b390e6":"## Step 2. Setup columns roles","a2910289":"# Step 0.1. Import necessary libraries ","00e86062":"## Step 5. Prepare submission","650aaea2":"# Step 0.4. Data load ","d175f77f":"# ========= AutoML preset usage =========\n\n\n## Step 1. Create Task"}}