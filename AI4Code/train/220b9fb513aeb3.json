{"cell_type":{"c587c887":"code","93a29b05":"code","a507ce59":"code","7770c61d":"code","814f64a9":"code","394848fb":"code","58c68ae9":"code","de572a02":"code","217116ce":"code","f3ca324e":"code","7776cb75":"code","7970cba6":"code","d60a64f5":"code","17dd3277":"code","725a2669":"code","9ddc5e87":"code","558e555e":"code","837b1bca":"code","0dd5e21a":"code","c6abc0e0":"code","e0055893":"code","67ee3723":"code","2c41bf11":"code","563063fc":"code","36e1196e":"code","80bb5731":"code","e79ddab2":"code","e0dfbdc9":"code","d7b141cb":"code","db860704":"code","2830ac45":"code","2492c7ca":"code","fcd94cd3":"code","0834bfa7":"code","65546ba7":"code","06fb925b":"code","906a2766":"code","85154d1e":"code","c8019e6b":"code","45e4cf3c":"code","dd80f505":"code","48731034":"code","3d937926":"code","072db2aa":"code","2926ca20":"code","84977163":"code","245f8b91":"code","a7ec1ec7":"code","d98e2465":"code","54fcb817":"code","e813a918":"code","0696863f":"code","72b6c060":"code","c79c6062":"code","54d70d69":"code","7a39b0c5":"code","6a21a2ad":"code","e91a04b0":"code","c9fcdf9d":"code","176464f4":"code","b224b66f":"code","be47b2c9":"code","cc60fc9f":"code","31668cde":"code","03c1a21c":"code","09e47a36":"code","1e07bd80":"code","75826526":"code","ea2e32b1":"code","c9eb6b5d":"code","c9476a10":"markdown","dd45367a":"markdown","1f048f48":"markdown","643bf3a1":"markdown","ca37be54":"markdown","39531fe7":"markdown","daedb38c":"markdown","d362adbe":"markdown","42dac1ee":"markdown","cc80f51b":"markdown","e9c6a930":"markdown","1cf2a9a9":"markdown","7ea13f33":"markdown","5922a0bd":"markdown","925f9c0a":"markdown","a4ff751b":"markdown","ce713b9d":"markdown","97898e72":"markdown","0229ef6c":"markdown","2fc2a5a1":"markdown","1e84582d":"markdown","c18f6e5b":"markdown","05c96030":"markdown","331f319e":"markdown","633a69d0":"markdown","e3f4bce8":"markdown","15dceeef":"markdown"},"source":{"c587c887":"import torch\nimport torchvision\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport torch.nn as nn\nimport torch.nn.functional as F\nfrom torchvision.transforms import ToTensor\nfrom torchvision.utils import make_grid\nfrom torch.utils.data.dataloader import DataLoader\nfrom torch.utils.data import random_split\nimport pandas as pd\nimport seaborn as sns\nfrom colorama import Fore, Back, Style\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n%matplotlib inline","93a29b05":"train = pd.read_csv(\"..\/input\/titanic\/train.csv\")\ntest = pd.read_csv(\"..\/input\/titanic\/test.csv\")\nsubmission = pd.read_csv(\"..\/input\/titanic\/gender_submission.csv\")","a507ce59":"train.shape","7770c61d":"test.shape","814f64a9":"train.head()","394848fb":"test.head()","58c68ae9":"train.isnull().sum()","de572a02":"red = Fore.RED\ngrn = Fore.GREEN\nblu = Fore.BLUE\nylw = Fore.YELLOW\nwht = Fore.WHITE","217116ce":"def plot_distribution(feature,color):\n    plt.figure(dpi=125)\n    sns.distplot(train[feature],color=color);\n    print(\"{}Max value of {} is {}\\n{}Min value of {} is {}\\n{}Mean value of {} is {}\\n{}Std value of {} is {}\\n{}Median value of {} is {}\".format(red,feature,train[feature].max(),blu,feature,train[feature].min(),grn,feature,train[feature].mean(),ylw,feature,train[feature].std(),wht,feature,train[feature].median()));","f3ca324e":"plot_distribution('Age','green')","7776cb75":"sns.set(style = 'darkgrid')\nplt.figure(dpi=125)\nsns.countplot(x=train.Sex, hue=train.Survived, data=train,edgecolor = sns.color_palette('dark',2));","7970cba6":"plt.figure(dpi=125)\nsns.countplot(x = train.Sex, hue = train.Pclass,data = train,edgecolor = sns.color_palette('dark',3));","d60a64f5":"plt.figure(dpi=125)\nsns.countplot(x = train.Survived, hue = train.Pclass, data = train,edgecolor = sns.color_palette('dark',1));","17dd3277":"plt.figure(dpi=125)\nsns.countplot(x = train.Pclass, hue = train.Survived, data = train,edgecolor = sns.color_palette('dark',5));","725a2669":"train.groupby('Pclass').Survived.value_counts()","9ddc5e87":"plt.figure(dpi=125)\nsns.countplot(x = train.Embarked, hue = train.Sex, data = train,edgecolor = sns.color_palette('dark',6));","558e555e":"plt.figure(dpi=125)\nsns.countplot(x = train.Embarked, hue = train.Survived, data = train);","837b1bca":"train['Name'] = train.Name.str.extract('([A-Za-z]+)\\.',expand = False)","0dd5e21a":"plt.figure(dpi=200)\nplt.xticks(size=5)\nsns.countplot(x = train.Name, hue = train.Survived, data = train);","c6abc0e0":"top6 = train['Name'].value_counts()[:6].index.to_list()\ntop6","e0055893":"train['Name'] = train['Name'].apply(lambda x: x if x in top6 else 'Other')","67ee3723":"train.groupby('Name').Survived.value_counts()","2c41bf11":"train['family'] = train['SibSp'] + train['Parch'] + 1","563063fc":"plt.figure(dpi=125)\nsns.countplot(x = train.family, hue = train.Survived, data = train);","36e1196e":"train.groupby('family').Survived.value_counts()","80bb5731":"for i in range(len(train)):\n    if(train['family'][i] > 1):\n        train['family'][i] = 1\n    else:\n        train['family'][i] = 0","e79ddab2":"plt.figure(dpi=125)\nsns.countplot(x = train.family, hue = train.Survived, data = train);","e0dfbdc9":"train.groupby('Cabin').Survived.value_counts()","d7b141cb":"train['Cabin'].fillna('S',inplace=True)","db860704":"for i in range(len(train)):\n    train['Cabin'][i] = train['Cabin'][i][0]","2830ac45":"train.groupby('Cabin').Survived.value_counts()","2492c7ca":"plt.figure(dpi = 125)\nsns.countplot(x = train.Cabin,hue = train.Survived, data = train);","fcd94cd3":"plt.figure(dpi=125)\nplot_distribution('Fare','orange')","0834bfa7":"train['fare_val'] = 0\nfor i in range(len(train)):\n    if(train['Fare'][i] > 32.0):\n        train['fare_val'][i] = 1","65546ba7":"train.groupby('fare_val').Survived.value_counts()","06fb925b":"plt.figure(dpi=125)\nsns.countplot(x = train.fare_val, hue = train.Survived, data = train);","906a2766":"#family\ntest['family'] = test['SibSp'] + test['Parch'] + 1\nfor i in range(len(test)):\n    if(test['family'][i] > 1):\n        test['family'][i] = 1\n    else:\n        test['family'][i] = 0\n\n#Name\ntest['Name'] = test['Name'].apply(lambda x: x if x in top6 else 'Other')\n\n#Cabin\ntest['Cabin'].fillna('S',inplace=True)\n\nfor i in range(len(test)):\n    test['Cabin'][i] = test['Cabin'][i][0]\n\n\n#Fare\ntest['fare_val'] = 0\nfor i in range(len(test)):\n    if(test['Fare'][i] > 32.0):\n        test['fare_val'][i] = 1","85154d1e":"features = [##'PassengerId',\n            'Pclass',\n            #'Name',\n            'Sex',\n            'Age',\n            ##'SibSp',\n            ##'Parch',\n            'family',#derived from SibSp & Parch\n            #'Ticket',\n            ##'Fare',\n            'fare_val',#derived from Fare\n            #'Cabin',\n            'Embarked'\n           ]\n\ntarget = 'Survived'","c8019e6b":"train[features].isnull().sum()","45e4cf3c":"test[features].isnull().sum()","dd80f505":"'''Age_mean = train['Age'].mean()\ntrain['Age'] = train['Age'].fillna(value = Age_mean)\n\nAge_mean_t = test['Age'].mean()\ntest['Age'] = test['Age'].fillna(value = Age_mean_t)\nf\"'train',{Age_mean}, 'test',{Age_mean_t}\"''';","48731034":"Age_std = train['Age'].std()\ntrain['Age'] = train['Age'].fillna(value = Age_std)\n\nAge_std_t = test['Age'].std()\ntest['Age'] = test['Age'].fillna(value = Age_std_t)\nf\"'train',{Age_std}, 'test',{Age_std_t}\"","3d937926":"from sklearn.preprocessing import LabelEncoder\n\nlbl = LabelEncoder()\n\ntrain['Sex'] = lbl.fit_transform(train[['Sex']].values.ravel())\ntest['Sex'] = lbl.fit_transform(test[['Sex']].values.ravel())","072db2aa":"#lbl2 = LabelEncoder()\n#train['Name'] = lbl2.fit_transform(train[['Name']].values.ravel())\n#test['Name'] = lbl2.fit_transform(test[['Name']].values.ravel())","2926ca20":"train['Embarked'] = train['Embarked'].fillna(value=train['Embarked'].mode()[0])\ntest['Embarked'] = test['Embarked'].fillna(value=test['Embarked'].mode()[0])\n","84977163":"train_ds = train[features]\ntest_ds = test[features]","245f8b91":"train_ds = pd.get_dummies(columns = ['Embarked','Pclass'],data=train_ds,drop_first = True)\ntest_ds = pd.get_dummies(columns = ['Embarked','Pclass'],data=test_ds,drop_first = True)","a7ec1ec7":"print(train_ds.head())\ntrain_ds.shape","d98e2465":"print(test_ds.head())\ntest_ds.shape","54fcb817":"#train_ds.drop(columns = ['Cabin_T'],inplace = True)","e813a918":"y_train = train[target]","0696863f":"from sklearn.model_selection import train_test_split\nX_train, X_valid, y_train, y_valid = train_test_split(train_ds, y_train, test_size=0.30)","72b6c060":"X_train.columns","c79c6062":"from sklearn.model_selection import train_test_split,cross_val_score,RandomizedSearchCV,GridSearchCV\nfrom sklearn.metrics import confusion_matrix, accuracy_score, classification_report\nfrom sklearn.metrics import roc_auc_score, roc_curve\nfrom sklearn.ensemble import RandomForestClassifier\nfrom xgboost import XGBClassifier","54d70d69":"'''rfc = RandomForestClassifier()\n\nparams = {'n_estimators': [200,500,800,1000,1200],\n          'max_depth': [3,5,7],\n          'criterion':['entropy', 'gini'],\n          'min_samples_leaf' : [1, 2, 3, 4, 5],\n          'max_features':['auto'],\n          'min_samples_split': [3, 5, 10],\n          'max_leaf_nodes':[2,3,5,7],\n          }\n\nrfc_cv = RandomizedSearchCV(rfc, params, cv = 250, n_jobs=-1, verbose=2).fit(X_train, y_train)''';","7a39b0c5":"rfc = XGBClassifier()\n\nparams = {'n_estimators': [200,500,800,1000,1200],\n          'max_depth': [3,5,7],\n          'objective' : ['binary:logistic'],\n          'min_samples_leaf' : [1, 2, 3, 4, 5],\n          'max_leaf_nodes':[2,3,5,7],\n          'min_child_weight': [1, 5, 10],\n          'gamma': [0.5, 1, 1.5, 2, 5],\n          }\n\nrfc_cv = RandomizedSearchCV(rfc, params, cv = 10, n_jobs=-1, verbose=2).fit(X_train, y_train)","6a21a2ad":"rfc_cv.best_params_\nbest_model = rfc_cv.best_estimator_\n\nprint(best_model)\nprint(rfc_cv.best_score_)","e91a04b0":"rfc_pred = best_model.predict(X_valid)\n\nprint(\"Accuracy: \", accuracy_score(y_valid, rfc_pred))\n\nprint(\"\\nConfusion Matrix\\n\")\nprint(confusion_matrix(y_valid, rfc_pred))","c9fcdf9d":"import pickle\n\nfilename = 'Titanic_model.sav'\npickle.dump(best_model, open(filename, 'wb'))","176464f4":"loaded_model = pickle.load(open(filename, 'rb'))\nresult = loaded_model.score(X_valid, y_valid)\nprint(result)","b224b66f":"print(rfc_pred)","be47b2c9":"passId = test[['PassengerId']].values","cc60fc9f":"test_ds.head()","31668cde":"final_pred = best_model.predict(test_ds)","03c1a21c":"sub = {'PassengerId':passId.ravel(), 'Survived':final_pred}","09e47a36":"submission_csv = pd.DataFrame(sub)","1e07bd80":"submission_csv.head()","75826526":"submission_csv.to_csv('final_sub_titanic_xgb_cv_10.csv',index = False)","ea2e32b1":"x = pd.read_csv(\".\/final_sub_titanic_xgb_cv_10.csv\")","c9eb6b5d":"x.head()","c9476a10":"#### Making same modifications to test dataset","dd45367a":"The minimum fare is 0.0 which means there was\/were someone\/some people with a free ride in titanic(probably in 1st class) \ud83d\ude05\ud83d\ude05","1f048f48":"As we can confirm females had a greater survival rate compared to males.","643bf3a1":"# Data Preprocessing \ud83d\uddc4\ufe0f","ca37be54":"# To-Do\ud83d\udccb\n## Tuning parameters \ud83e\udd37\u200d\u2642\ufe0f\ud83e\udd37\u200d\u2642\ufe0f\n## Make the PyTorch Model more accurate","39531fe7":"## Saving the Model \ud83d\udcbe","daedb38c":"### Fare","d362adbe":"Most people survived were from 1st class.. so people in 1st class had a greater chance of survival","42dac1ee":"Well there weren't fewer people in 1st class.. so we can conclude that people in first class did indeed had a higher chance and rate of survival","cc80f51b":"### Cabin","e9c6a930":"More people survived from Cherbourg compared to other two","1cf2a9a9":"People with greater fare had a higher rate of survival","7ea13f33":"# EDA \ud83d\udcca","5922a0bd":"This seems kinda random .. only people with family member size of 2,3,4 survived greater than the rest \ud83e\udd14\ud83e\udd14.","925f9c0a":"Only people from 1st class had a greater survival rate compared to classes 2 and 3... maybe there were fewer people in 1st class","a4ff751b":"# Importing libraries\ud83d\udcda","ce713b9d":"people from cabins were more likely to survive","97898e72":"# Creating a XGBoost Model with Randomized Search \u2764\ufe0f\u200d\ud83d\udd25","0229ef6c":"### Family","2fc2a5a1":"people with family had greater rate of survival","1e84582d":"## Checkout my other [**Notebook**](https:\/\/www.kaggle.com\/mdhamani\/titanic-getting-better-eda-pytorch-gpu-top-14) with PyTorch Neural Network Classifier","c18f6e5b":"# Getting data \ud83d\udcbd","05c96030":"There were many people from both genders in 3rd class(as expected)... the second most filled class was 1st class ... this maybe suggests huge price difference between classes.. not sure though \ud83e\udd37\u200d\u2642\ufe0f\ud83e\udd37\u200d\u2642\ufe0f","331f319e":"## Loading the Model \ud83d\udd03","633a69d0":"As we know from the disaster.. women and children were the first to be evacuated.. mean age is 29.6, median age is 28.. both of which are >18 which suggests the people with missing ages are adults ... standard deviation is 14.5 which is <18 which suggests they are chilren..","e3f4bce8":"# My Submission \ud83d\ude4b\u200d\u2642\ufe0f","15dceeef":"### Name"}}