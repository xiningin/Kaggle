{"cell_type":{"5af061ff":"code","604ff993":"code","a903abbf":"code","ff09d8fd":"code","41608977":"code","06a63748":"code","bd3f864a":"code","4fff3e4c":"code","03e71ed1":"code","668ee390":"code","bacf3efb":"code","50946d68":"code","3934e794":"code","4532ee15":"code","8f144a75":"code","e7e9cfdc":"code","b9083a85":"code","84c7425a":"code","68cf2006":"code","7b0e7e57":"code","5263c2b2":"code","f244beb1":"code","f22e7ee0":"code","dc048c8e":"code","57ca33dd":"code","ab88164a":"code","02bd7417":"code","850f84c7":"code","e381a830":"code","2e6ccd11":"markdown","0e58e856":"markdown","426aec99":"markdown","877e9a70":"markdown","52f56b15":"markdown","05d52009":"markdown","346dda26":"markdown","36c22e4f":"markdown","43e9dc4d":"markdown","985437aa":"markdown","46a1eb08":"markdown","cec7e09c":"markdown","706fdc75":"markdown","dcfb794d":"markdown","1f54fe91":"markdown"},"source":{"5af061ff":"# packages\n\nimport numpy as np \nimport pandas as pd \n\n# plot\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly.express as px\n\n# scaling\nfrom sklearn.preprocessing import MinMaxScaler\n# PCA\nfrom sklearn.decomposition import PCA\n# data split\nfrom sklearn.model_selection import train_test_split\n\n\n# Data imputation\n!pip install imbalanced-learn\nfrom imblearn.over_sampling import SMOTE\n\n# ANN\nimport tensorflow as tf\nfrom tensorflow.keras.models import Sequential\nfrom tensorflow.keras.layers import Dense, Activation,Dropout\nfrom tensorflow.keras.callbacks import EarlyStopping\n\n# model evaluation\nfrom sklearn.metrics import confusion_matrix, classification_report, f1_score\nfrom sklearn.metrics import plot_confusion_matrix\n# MISC\nimport warnings\nwarnings.simplefilter(action='ignore', category=FutureWarning)","604ff993":"# to reproduce same results every time we run the code\nimport random as python_random\n\nnp.random.seed(123)\npython_random.seed(123)\ntf.random.set_seed(1234)","a903abbf":"# read df\ndf = pd.read_csv('..\/input\/company-bankruptcy-prediction\/data.csv')\n","ff09d8fd":"df.head()","41608977":"df.describe()","06a63748":"# correlation above 0.50\n\ncorrelation_five = df.corr()\ncorrelation_five = correlation_five[correlation_five >0.50]\n\nplt.figure(figsize=(10,15))\nsns.set_style('white')\nsns.set_context(context='notebook',font_scale=1.2)\nsns.heatmap(correlation_five,cmap=\"Blues\");\nplt.title('correlation');","bd3f864a":"# filter the highly correlated variables\n\ncorr_df = df.corr()\nhigh_corr = ~(corr_df.mask(np.eye(len(corr_df ), dtype=bool)).abs() > 0.5).any()\nhigh_corr\n\ncorr_df = corr_df.loc[high_corr,high_corr]\nprint(corr_df.columns)","4fff3e4c":"# missing values\nmissing_value = 100 * df.isnull().sum()\/len(df)\nmissing_value = missing_value.reset_index()\nmissing_value.columns = ['variables','missing values in percentage']\nmissing_value = missing_value.sort_values('missing values in percentage',ascending=False)\n\n\nprint((missing_value['missing values in percentage'] > 0).sum())\nmissing_value.head(4)","03e71ed1":"# plot data\nplot_target = df['Bankrupt?'].value_counts(1).reset_index()\nplot_target.columns = ['Bankruptcy?','percentage']\n\n# plot\nsns.set_style('white')\nsns.set_context(context='notebook',font_scale=1.2)\nsns.barplot(x='Bankruptcy?',y='percentage',data=plot_target);\nplt.title('Target variable');\nprint(df['Bankrupt?'].value_counts(1)*100)","668ee390":"# checking for duplicates\n\ndup = df.duplicated()\ndup.sum()","bacf3efb":"# drop target variable for training\n\nX = df.drop(['Bankrupt?'],axis = 1)\ny = df.pop('Bankrupt?')","50946d68":"# data split\n\nX_train, X_test,y_train,y_test = train_test_split(X, y,stratify=y)","3934e794":"y_train.value_counts(1)","4532ee15":"# smote oversampling\n\nSMOTE_oversample = SMOTE()\nX_train,y_train = SMOTE_oversample.fit_resample(X_train,y_train)","8f144a75":"# class imbalance is treated\nsns.set_style('white');\nsns.set_context(context='notebook',font_scale=1.2)\nsns.countplot(x=y_train);\nplt.title('Target variable balanced');\n","e7e9cfdc":"# for plot I only selected 10 columns\ndf.iloc[:,10:40].plot(kind='box',figsize=(16,6));\nplt.xticks(rotation=70);","b9083a85":"#\"\"\"outlier\ndef remove_outlier(col):\n    sorted(col)\n    Q1,Q3=np.percentile(col,[25,75])\n    IQR=Q3-Q1\n    lower_range= Q1-(1.5 * IQR)\n    upper_range= Q3+(1.5 * IQR)\n    return lower_range, upper_range\n   \n#\"\"\"","84c7425a":"\nfor column in X_train.columns:\n    lr,ur = remove_outlier(df[column])\n    df[column] = np.where(df[column]>ur, ur,df[column])\n    df[column] = np.where(df[column]<lr,lr,df[column])","68cf2006":"df.iloc[:,10:40].plot(kind='box',figsize=(16,6))\nplt.xticks(rotation=70);","7b0e7e57":"# scaling the data\n\nstd = MinMaxScaler()\n\nX_train = std.fit_transform(X_train)\nX_test = std.transform(X_test)","5263c2b2":"# we have 96 column that too much to learn for a ML or ANN\nX_train.shape,X_test.shape","f244beb1":"# PCA \npca = PCA(n_components=16)\n\nX_train = pca.fit_transform(X_train)\nX_test = pca.transform(X_test)","f22e7ee0":"# reduce dimentionality \nX_train.shape,X_test.shape","dc048c8e":"# early stopping\nearly_stop =  EarlyStopping(monitor='val_auc',mode='max', verbose=1, patience=27,restore_best_weights=True)\n\n# ANN\nmodel =  Sequential()\n\nmodel.add(Dense(units=8,activation='relu'))\nmodel.add(Dropout(0.10))\n\nmodel.add(Dense(units=4,activation='relu'))\n\nmodel.add(Dense(units=1,activation='sigmoid'))\n\n# compile ANN\nmodel.compile(loss='binary_crossentropy', optimizer='adam',metrics = ['accuracy'])","57ca33dd":"# Train ANN\nmodel.fit(x=X_train, \n          y=y_train, \n          epochs=120,\n          validation_data=(X_test, y_test), verbose=1,\n          callbacks=[early_stop]\n          )","ab88164a":"# model history to df\nloss_plot = pd.DataFrame(model.history.history)\naccuracy_plot = pd.DataFrame(model.history.history)\n\n#  accuracy and loss plot\nfig, (ax1, ax2) = plt.subplots(1, 2,figsize=(14,4))\nplt.style.use('seaborn')\nax1.plot(loss_plot.loc[:, ['loss']], label='Training loss');\nax1.plot(loss_plot.loc[:, ['val_loss']],label='Validation loss');\nax1.set_title('Training and Validation loss')\nax1.set_xlabel('epochs')\nax1.set_ylabel('Loss')\nax1.legend(loc=\"best\");\n\nax2.plot(accuracy_plot.loc[:, ['accuracy']],label='Training_accuracy');\nax2.plot(accuracy_plot.loc[:, ['val_accuracy']], label='Validation_accuracy');\nax2.set_title('Training_and_Validation_accuracy');\nax2.set_xlabel('epochs')\nax2.set_ylabel('accuracy')\nax2.legend(loc=\"best\");","02bd7417":"y_pred = model.predict(X_test)\ny_pred = (y_pred > 0.5)","850f84c7":"print(classification_report(y_test, y_pred))","e381a830":"sns.heatmap(confusion_matrix(y_test,y_pred,normalize='true'), annot=True);#","2e6ccd11":"# <span style=\"font-family: Arial;font-size:1.2em;color:#3366ff\">Scaling\n* scaling is important for Neural networks","0e58e856":"# <span style=\"font-family: Arial;font-size:1.2em;color:#3366ff\">ANN","426aec99":"# <span style=\"font-family: Arial;font-size:1.2em;color:#3366ff\">PCA\n\n* PCA, is a dimensionality-reduction method that is often used to reduce the dimensionality","877e9a70":"# <span style=\"font-family: Arial;font-size:1.1em;color:#3366ff\">Class imbalance","52f56b15":"# <span style=\"font-family: Arial;font-size:1.1em;color:#3366ff\">Missing values","05d52009":"# <span style=\"font-family: Arial;font-size:1.2em;color:#3366ff\">Company Bankruptcy\n\nThe data were collected from the Taiwan Economic Journal for the years 1999 to 2009. Company bankruptcy was defined based on the business regulations of the Taiwan Stock Exchange\n","346dda26":"### <span style=\"font-family: Arial;font-size:1.5em;color:#3366ff\">Thanks!","36c22e4f":"# <span style=\"font-family: Arial;font-size:1.2em;color:#3366ff\">Outlier\n\n* In statistics, an outlier is a data point that differs significantly from other observations","43e9dc4d":"# <span style=\"font-family: Arial;font-size:1.1em;color:#3366ff\">EDA","985437aa":"\n# <span style=\"font-family: Arial;font-size:1.2em;color:#3366ff\">Packages","46a1eb08":"## <span style=\"font-family: Arial;font-size:1.2em;color:#3366ff\">Index","cec7e09c":"#### <span style=\"font-family: Arial;font-size:1.5em;color:#3366ff\">Feel free to post any suggestion! ","706fdc75":"# <span style=\"font-family: Arial;font-size:1.2em;color:#3366ff\">Oversampling","dcfb794d":"## <span style=\"font-family: Arial;font-size:1.2em;color:#3366ff\"> challenges in data set\n\n* <span style=\"font-family: Arial;font-size:1.1em;color:#333333\">too many independent variables to learn for ML or ANN\n* <span style=\"font-family: Arial;font-size:1.1em;color:#333333\">Class imbalance -  Bankrupt is only 3.22% and 96.77% normal\n* <span style=\"font-family: Arial;font-size:1.1em;color:#333333\">highly correlated variables\n* <span style=\"font-family: Arial;font-size:1.1em;color:#333333\">Outlier presence","1f54fe91":"* <a href=\"#Packages\">Packages<\/a>\n* <a href=\"#EDA\">EDA<\/a>\n* <a href=\"#Class-imbalance\">Class imbalance<\/a>\n* <a href=\"#Scaling\">Scaling<\/a>\n* <a href=\"#Oversampling\">Oversampling<\/a>\n* <a href=\"#PCA\">PCA<\/a>\n* <a href=\"#Outlier\">Outlier<\/a>\n* <a href=\"#ANN\">ANN<\/a>\n"}}