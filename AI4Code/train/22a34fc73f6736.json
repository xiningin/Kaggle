{"cell_type":{"3741bb70":"code","cc644432":"code","1dd414ef":"code","efd25f6a":"code","c2ffbbfc":"code","5bebf347":"code","ac504952":"code","29952f02":"code","81dc26a3":"code","35ba9f90":"code","35e78541":"code","3df56622":"code","2a8f59ca":"code","37751c42":"code","7dc7e189":"code","fcd6058d":"code","81ce1dab":"code","5dea2670":"code","19fd9f5f":"code","d3e7f9dd":"code","9d288e96":"code","cdcaf0ed":"code","416382d9":"code","68212201":"code","eface269":"code","f609cf78":"code","872aa332":"code","99222075":"code","de4a5131":"code","1a4a86d1":"code","0b9ce31c":"code","db403c95":"code","8f9cb932":"code","fe8f01ca":"code","d3d5feaf":"code","0c18623a":"code","46a4e4fb":"code","39d12deb":"code","c60918fb":"code","87546006":"code","86157c39":"code","12ea5b53":"code","b1d97232":"code","7eb7c26d":"code","902fa9fc":"code","c633d450":"code","37bf0b31":"code","11b41dfe":"code","866cdb8e":"code","d7fa9302":"code","d0a50b5e":"code","f203dd6a":"code","e75fa0ae":"code","dd85e0e7":"code","1ee00361":"code","6a1c0755":"code","8aa848b1":"code","ae5d6672":"code","35b1df13":"code","e70467b9":"code","3fb3ccbf":"code","2fa91876":"code","e55b399e":"code","c207e20b":"code","7bc85aa0":"code","e322ee1b":"code","a1b00314":"code","f9448294":"code","b966eba2":"code","94d15d49":"code","239b75ec":"code","8306c1ec":"markdown","a6aaf91d":"markdown","31e52bf0":"markdown","1234c521":"markdown","0193ebfd":"markdown","b8ef45cb":"markdown","8f8c2e90":"markdown","416e3ffc":"markdown","fa9106ce":"markdown","56032a67":"markdown","f450c7a8":"markdown","d26dda29":"markdown","81a9b223":"markdown","51e68d6b":"markdown","786cfe83":"markdown","9770c55e":"markdown","8f7428ec":"markdown","a7db302b":"markdown","8880d8c0":"markdown","af845f63":"markdown","2c0b20d5":"markdown","1f3da2f5":"markdown","7b22c5e0":"markdown","27de5c56":"markdown","c0265b15":"markdown","951fcdc8":"markdown","8cd2cc21":"markdown","8e72acf9":"markdown","fa766940":"markdown","16829815":"markdown","4cbf8453":"markdown","00310575":"markdown","3b4fdedc":"markdown","a47d72ab":"markdown","c3777678":"markdown","62b6a40b":"markdown","a5de2986":"markdown","4354336e":"markdown","e84a5ca8":"markdown","d9350864":"markdown"},"source":{"3741bb70":"import numpy as np\nimport pandas as pd\nimport seaborn as sb\nimport matplotlib.pyplot as plt\nfrom sklearn.cluster import KMeans\nfrom sklearn import preprocessing\nsb.set()","cc644432":"def unique_columns(raw_data):\n    for i in raw_data.columns: \n        print(i, ':', len(raw_data[i].unique()))","1dd414ef":"raw_data = pd.read_csv('..\/input\/customer-personality-analysis\/marketing_campaign.csv', sep = '\\t')","efd25f6a":"raw_data.head(3)","c2ffbbfc":"raw_data.info()","5bebf347":"raw_data = raw_data.dropna()","ac504952":"raw_data.describe()","29952f02":"unique_columns(raw_data)","81dc26a3":"raw_data = raw_data.drop(['Z_CostContact'], axis = 1)\nraw_data = raw_data.drop(['Z_Revenue'], axis = 1)","35ba9f90":"raw_data.head(11)","35e78541":"raw_data['Marital_Status'].unique()","3df56622":"raw_data['Marital_Status'].value_counts()","2a8f59ca":"data_ms = raw_data.copy()  ","37751c42":"data_ms['Marital_Status'] = data_ms['Marital_Status'].map({'Single':0, 'Together':1, 'Married':1,\n                                                           'Divorced':0, 'Widow':0, 'Alone':0, 'Absurd':0, 'YOLO':0})\ndata_ms['Marital_Status'].unique()","7dc7e189":"data_ms['Marital_Status'].value_counts() #1430: Have-Partner and 786: Single","fcd6058d":"data_ms['Education'].unique()","81ce1dab":"data_ms['Education'].value_counts()","5dea2670":"data_ed = data_ms.copy()","19fd9f5f":"data_ed['Education'] = data_ed['Education'].map({'Graduation':1, 'PhD':2, 'Master':2, 'Basic':0, '2n Cycle':0})\ndata_ed['Education'].value_counts()","d3e7f9dd":"data_ed= data_ed.reset_index(drop=True)","9d288e96":"data_dt = data_ed.copy()","cdcaf0ed":"data_dt['Dt_Customer'] = pd.to_datetime(data_dt['Dt_Customer'], format='%d-%m-%Y')","416382d9":"data_dt.info()","68212201":"data_dt['Dt_Customer'][0].year","eface269":"data_dt['Year_Birth'][0]","f609cf78":"data_dt['Dt_Customer'].max() #Thus, we will assume that data was collected in 2014","872aa332":"int(data_dt['Dt_Customer'][10].year)","99222075":"Age = []","de4a5131":"print('As the Maximum value of customers joined year is 2014, we shall assume that data was collected in 2014')","1a4a86d1":"for i in range(data_dt.shape[0]):\n    a = int(2014) - data_dt['Year_Birth'][i]\n    Age.append(a)","0b9ce31c":"data_dt['Age'] = Age","db403c95":"data_s = data_dt.copy()","8f9cb932":"data_s['Income'].unique().max()","fe8f01ca":"sb.set(style=\"ticks\", color_codes=True)\ng = sb.pairplot(data_s, vars=[\"Income\", \"Recency\", \"Age\", 'MntWines']) #, hue=\"Cluster\")\nplt.show()","d3d5feaf":"sb.set(style=\"ticks\", color_codes=True)\ng = sb.pairplot(data_s, vars=['MntFruits', 'MntMeatProducts', 'MntFishProducts',\n       'MntSweetProducts', 'MntGoldProds'])\nplt.show()","0c18623a":"sb.set(style=\"ticks\", color_codes=True)\ng = sb.pairplot(data_s, vars=['NumDealsPurchases',\n       'NumWebPurchases', 'NumCatalogPurchases', 'NumStorePurchases',\n       'NumWebVisitsMonth'])\nplt.show()\nprint('We will remove certain outliers that are prone to distort our results')","46a4e4fb":"data_s = data_s[data_s['Age'] < 100]\ndata_s = data_s[data_s['Income'] < 60000]\ndata_s = data_s[data_s['MntMeatProducts'] < 1500]\ndata_s = data_s[data_s['MntSweetProducts'] < 250]\ndata_s = data_s[data_s['MntGoldProds'] < 300]\ndata_s = data_s[data_s['NumWebPurchases'] < 20]\ndata_s = data_s[data_s['NumCatalogPurchases'] < 20]","39d12deb":"data_s = data_s.reset_index(drop=True)","c60918fb":"data_ags = data_s.copy()","87546006":"#data_ags.columns.values","86157c39":"column_names_reordered = ['ID', 'Year_Birth','Age', 'Education', 'Marital_Status', 'Income',\n       'Kidhome', 'Teenhome', 'Dt_Customer', 'Recency', 'MntWines',\n       'MntFruits', 'MntMeatProducts', 'MntFishProducts',\n       'MntSweetProducts', 'MntGoldProds', 'NumDealsPurchases',\n       'NumWebPurchases', 'NumCatalogPurchases', 'NumStorePurchases',\n       'NumWebVisitsMonth', 'AcceptedCmp3', 'AcceptedCmp4',\n       'AcceptedCmp5', 'AcceptedCmp1', 'AcceptedCmp2', 'Complain',\n       'Response']","12ea5b53":"data_ag = data_ags[column_names_reordered]","b1d97232":"data_ags.columns.values","7eb7c26d":"data_ag.head(2)","902fa9fc":"data_ag['Kids'] = data_ag['Kidhome'] + data_ag['Teenhome']","c633d450":"data_ag['Total Spending'] = (data_ag['MntWines'] + data_ag['MntFruits'] + \n                             data_ag['MntMeatProducts'] + data_ag['MntFishProducts'] + \n                             data_ag['MntSweetProducts'] + data_ag['MntGoldProds'])","37bf0b31":"data_ag['Total Purchases'] = (data_ag['NumDealsPurchases'] + data_ag['NumWebPurchases'] + \n                             data_ag['NumCatalogPurchases'] + data_ag['NumStorePurchases'] + \n                             data_ag['NumWebVisitsMonth'])","11b41dfe":"data_ag = data_ag.drop(['Kidhome', 'Teenhome', 'ID', 'Year_Birth', 'Dt_Customer'], axis=1)","866cdb8e":"data_tp = data_ag.drop(['MntWines', 'MntFruits', 'MntMeatProducts', 'MntFishProducts',\n       'MntSweetProducts', 'MntGoldProds', 'NumDealsPurchases',\n       'NumWebPurchases', 'NumCatalogPurchases', 'NumStorePurchases',\n       'NumWebVisitsMonth'], axis=1)","d7fa9302":"data_tp.columns.values","d0a50b5e":"columns_tp = ['Income', 'Recency', \n              'Total Spending', 'Total Purchases']","f203dd6a":"columns_tp","e75fa0ae":"data_tbs = data_tp[columns_tp]","dd85e0e7":"# scale the data for better results\nx_scaled_tbs = preprocessing.scale(data_tbs)\nx_scaled_tbs","1ee00361":"# Createa an empty list\nwcss =[]\n\nfor i in range(1,10):\n    # Clsuter solution with i clusters\n    kmeans = KMeans(i)\n    # Fit the STANDARDIZED data\n    kmeans.fit(x_scaled_tbs)\n    # Append the WCSS for the iteration\n    wcss.append(kmeans.inertia_)\n    \n# Check the result\n# Plot the number of clusters vs WCSS\nplt.plot(range(1,10),wcss)\n# Name your axes\nplt.xlabel('Number of clusters')\nplt.ylabel('WCSS')\nprint('From the graph we shall consider 4 clusters optimal number, as we try to minimize the WCSS values without losing interpetation meaning')","6a1c0755":"kmeans_scaled_tbs = KMeans(4)\n# fit the data\nkmeans_scaled_tbs.fit(x_scaled_tbs)","8aa848b1":"# Create a variable which will contain the predicted clusters for each observation\nidentified_clusters_tbss = kmeans_scaled_tbs.fit_predict(x_scaled_tbs)\n# Check the result\nidentified_clusters_tbss","ae5d6672":"data_tbss_clusters = data_tp.copy()\n# Create a new Series, containing the identified cluster for each observation\ndata_tbss_clusters['Cluster'] = identified_clusters_tbss\n# Check the result\ndata_tbss_clusters.head(2)","35b1df13":"plt.figure(figsize=(10,6))\nCl = sb.countplot(x = 'Cluster', data = data_tbss_clusters, palette= ['#F7420D', '#1DFF0E', '#FBFF0E',  '#0EC1FF'])\nCl.set_title(\"Distribution Of The Clusters\", size = 20)\nplt.show()","e70467b9":"Features = ['Income', 'Recency', 'Total Spending', 'Total Purchases', 'Cluster']\nplt.figure()\nsb.pairplot(data_tbss_clusters[Features], hue = \"Cluster\", palette=['#F7420D', '#1DFF0E', '#FBFF0E',  '#0EC1FF'])\nplt.subplots_adjust(top=0.9)\nplt.suptitle('Customers Segmentation', size = 20)\nplt.show()","3fb3ccbf":"data_cs = {'Features': ['Income', 'Spending', 'Purchases', 'Recency', 'Customer Segments'],\n           'Cluster 0': ['High', 'High', 'High', 'High', 'Impulsive'], 'Cluster 1': ['Low', 'Low', 'Low', 'Low', 'Need-Based']\n          , 'Cluster 2': ['Avg', 'Low', 'Low', 'Low', 'Wandering'], 'Cluster 3': ['High', 'Avg', 'Avg', 'Low', 'Loyal']}\ncs = pd.DataFrame(data_cs)\ncs","2fa91876":"data_tbss_clusters.columns.values","e55b399e":"grouped = (data_tbss_clusters.groupby(['Cluster']).agg({'Marital_Status': 'sum', 'Age': 'sum', 'Kids': 'sum',\n                                                        'Education': 'sum', 'Recency': 'sum',\n                                                        'Income': 'sum','Total Spending':'sum', 'Total Purchases':'sum'}))\ngrouped","c207e20b":"percents_df = grouped.apply(lambda x: round((x\/x.sum()*100),2))\npercents_df","7bc85aa0":"plt.figure(figsize=(15,8))\ns = sb.barplot(x = 'Features', y = 'Percentage', hue = 'Cluster',\n            data = percents_df.stack().reset_index().rename(columns = {'level_1':'Features', 0: 'Percentage'}))\ns.set_title(\"Distribution Of Clusters along the Features\", size=20)","e322ee1b":"plt.figure(figsize=(15,8))\n\ngrouped = (data_tbss_clusters.groupby(['Cluster']).agg({'AcceptedCmp1': 'sum','AcceptedCmp2': 'sum', \n                                                        'AcceptedCmp3': 'sum','AcceptedCmp4': 'sum', \n                                                        'AcceptedCmp5': 'sum', 'Response': 'sum', 'Complain': 'sum'})\n           .stack().reset_index().rename(columns = {'level_1':'weights', 0: 'value'}))\n\nh = sb.barplot(x = 'weights', y = 'value', hue = 'Cluster', data = grouped)\nh.set_title(\"Customers' Response Segment\", size=20)","a1b00314":"plt.figure(figsize=(15,8))\npl = sb.countplot(x = 'Age', hue=data_tbss_clusters['Cluster'], data = data_tbss_clusters, palette= ['#F7420D', '#1DFF0E', '#FBFF0E',  '#0EC1FF'])\npl.set_title(\"Age Distribution\", size=20)\nplt.show()","f9448294":"plt.figure(figsize=(15,8))\npl = sb.countplot(x = 'Kids', hue=data_tbss_clusters['Cluster'], data = data_tbss_clusters, palette= ['#F7420D', '#1DFF0E', '#FBFF0E',  '#0EC1FF'])\npl.set_title(\"Distribution Of The Clusters\", size=20)\nplt.show()","b966eba2":"sb.scatterplot(data = data_tbss_clusters, x = 'Age', y = 'Income', hue='Cluster', palette='rainbow') ","94d15d49":"g = sb.FacetGrid(data_tbss_clusters, col=\"Marital_Status\", row=\"Education\", hue=\"Cluster\", height = 3.5, aspect= 1)\ng.map(sb.scatterplot, \"Age\", \"Kids\", alpha=.7)\ng.add_legend()\ng.fig.subplots_adjust(top=0.9) # adjust the Figure in rp\ng.fig.suptitle('Customer Demographics', size=20)","239b75ec":"data_cs = {'Features': ['Income', 'Spending', 'Purchases', 'Recency', 'Customer Segments'],\n           'Cluster 0': ['High', 'High', 'High', 'High', 'Impulsive'], 'Cluster 1': ['Low', 'Low', 'Low', 'Low', 'Need-Based']\n          , 'Cluster 2': ['Avg', 'Low', 'Low', 'Low', 'Wandering'], 'Cluster 3': ['High', 'Avg', 'Avg', 'Low', 'Loyal']}\ncs = pd.DataFrame(data_cs)\ncs","8306c1ec":"### Removing Rows with Null Values","a6aaf91d":"### ------CHECKPOINT","31e52bf0":"># Import Libraries","1234c521":"># Data Preprocessing","0193ebfd":"## ----CHECKPOINT","b8ef45cb":"* These are the customers segments identified from the analysis above.","8f8c2e90":"># Model Evaluation","416e3ffc":"#### For analysing the preprocessed data in Tableau for better understanding and interpetation, the file can be saved as .csv at this point. \ndata_tbss_clusters.to_csv('Tableau_preprocessed.csv', index=False)","fa9106ce":"### Mapping Marital Status into Single and Married \n*  (0: Single, Alone, YOLO, Widow, Divorced, Absurd) & (1: Married, Together)","56032a67":"># Results","f450c7a8":"### ------CHECKPOINT","d26dda29":"#### Unique Columns Identifier","81a9b223":">## What is Customer Segmentation?\n\nCustomer segmentation is the practice of dividing a company's customers into groups that reflect similarity among customers in each group. The goal of segmenting customers is to decide how to relate to customers in each segment in order to maximize the value of each customer to the business. (Source: Optimove)","51e68d6b":"### Identifying Outliers and Data Distribution\n* This can be analysed either visually or numerically. In this analysis, we are considering analysing the outliers through graphs. ","786cfe83":"### Standardising the Features\n* Since standardising categorical values are avoided, will extract other columns and standardise them for KMeans analysis.","9770c55e":"## Grouping Kidhome, Teenhome, Spending and Purchases","8f7428ec":"## Calculating Customers Age","a7db302b":"![4781-min.jpg](attachment:d09436ca-f0e7-4d93-a8ea-7afb4a648051.jpg)","8880d8c0":"### Customers Segmentation","af845f63":"##Mapping Education into groups\n1: Graduate, 2: Post-Graduation(Masters\/Phd) 3: Undergraduate (Basic\/2n-cycle)","2c0b20d5":"### ------CHECKPOINT\n* Make it a habit of creating checkpoints at various stages of your datasets, so incase you want to edit your dataset, you won't have to start from the beginning.","1f3da2f5":"## Types of Customer Segmentation\n\nThere are numerous types but ones that are mainly considered are demographic, psychographic, behavioral and geographic segmentation.\n\nWe shall examine the three segments as we have data related to demographics, behavourial and psychographics. \n\n* Demographics are age, sex, marital status, family size, occupation, education level, income, race, nationality and religion.\n* Behavourial data is how someone interacts with the product or campaign.\n* Psychographic characteristics include personality traits, interests, beliefs, values, attitudes and lifestyles.\n","7b22c5e0":"## Grouping of Marital Status","27de5c56":"## Removing Outliers\nAs indentified from the graphs above, we will adjust the data accordingly. This will remove the outliers.\n\n1. Ages greater than 100\n2. Income greater than 60,000\n3. MntMeatProducts greater than 1500\n4. MntSweetProducts greater than 250\n5. NumWebPurchases greater than 20\n6. NumCatalogPurchases greater than 20","c0265b15":">## Problem Statement\n\nCustomer Personality Analysis is a detailed analysis of a company\u2019s ideal customers. It helps a business to better understand its customers and makes it easier for them to modify products according to the specific needs, behaviors and concerns of different types of customers.\n\nCustomer personality analysis helps a business to modify its product based on its target customers from different types of customer segments. For example, instead of spending money to market a new product to every customer in the company\u2019s database, a company can analyze which customer segment is most likely to buy the product and then market the product only on that particular segment.\n\n>## Content\n\n### Attributes\n\n#### People\n* ID: Customer's unique identifier\n* Year_Birth: Customer's birth year\n* Education: Customer's education level\n* Marital_Status: Customer's marital status\n* Income: Customer's yearly household income\n* Kidhome: Number of children in customer's household\n* Teenhome: Number of teenagers in customer's household\n* Dt_Customer: Date of customer's enrollment with the company\n* Recency: Number of days since customer's last purchase\n* Complain: 1 if customer complained in the last 2 years, 0 otherwise\n\n#### Products\n* MntWines: Amount spent on wine in last 2 years\n* MntFruits: Amount spent on fruits in last 2 years\n* MntMeatProducts: Amount spent on meat in last 2 years\n* MntFishProducts: Amount spent on fish in last 2 years\n* MntSweetProducts: Amount spent on sweets in last 2 years\n* MntGoldProds: Amount spent on gold in last 2 years\n\n#### Promotion\n* NumDealsPurchases: Number of purchases made with a discount\n* AcceptedCmp1: 1 if customer accepted the offer in the 1st campaign, 0 otherwise\n* AcceptedCmp2: 1 if customer accepted the offer in the 2nd campaign, 0 otherwise\n* AcceptedCmp3: 1 if customer accepted the offer in the 3rd campaign, 0 otherwise\n* AcceptedCmp4: 1 if customer accepted the offer in the 4th campaign, 0 otherwise\n* AcceptedCmp5: 1 if customer accepted the offer in the 5th campaign, 0 otherwise\n* Response: 1 if customer accepted the offer in the last campaign, 0 otherwise\n\n#### Place\n* NumWebPurchases: Number of purchases made through the company\u2019s web site\n* NumCatalogPurchases: Number of purchases made using a catalogue\n* NumStorePurchases: Number of purchases made directly in stores\n* NumWebVisitsMonth: Number of visits to company\u2019s web site in the last month\n\n#### Target\n* Need to perform clustering to summarize customer segments.\n\n","951fcdc8":"### Clusters Count\n* This plot shows the sum of each cluster (0 - 3), this gives us a brief idea of how diverse and quantified are the segments.","8cd2cc21":"## Removing Z Columns - because they contain constant variable and won't contribute to the analysis","8e72acf9":"># Modeling - KMeans ","fa766940":"### ------CHECKPOINT","16829815":"## Analysis from a Wider Prespective (Considering Total Spending and Total Purchases)","4cbf8453":"## Grouping of Education","00310575":"## Reordering Columns","3b4fdedc":"### Summed Total Spending and Purchases (for Cumulative Analysis)\n* Initally we will consider reviewing the results from a wider scope: taking cumulative spending and purchase values.\n* To understand the customers behaviour and demographics, we will initially analyse cumulative rates only.\n* Analysis of sale and purchase of each product will be conducted on later stage. ","a47d72ab":"### Clusters Distribution Along the Features\n* The notion behind this plot is that its provides an overview of how diverse is our segmentation based on the features.\n* This barchart shows the percentage of all the clusters in each feature.","c3777678":">### Customer Segments \n\nBased on Income, Spending, Purchases and Recency, the clusters can be categorised as:\n* 0: High Income, High Spending, High Purchases and High Recency \n* 1: Low Income, Low Spending, Low Purchases and Low Recency\n* 2: Average Income, Low Spending, Low Purchases and High Recency\n* 3: High Income, Average Spending, Average Purchases and Low Recency","62b6a40b":"* Following columns will be scaled:","a5de2986":"## Findings ","4354336e":"### Clusters Distribution over Customers Interaction\n* Finally, this pairplot with scattered graphs would enable us to interpret the clusters, and label them accordingly. ","e84a5ca8":"* Initally we will consider reviewing the results from a wider scope: taking cumulative spending and purchase values ","d9350864":"#### Demographics\n* Need-Based customers dominate the age groups between 20 - 45. \n* All the customer segments are dominated by individuals with kids.\n* Loyal customers have atleast a graduate degree and have high income.\n\n#### Campaign Reponse\n* Majority of the customers regardless of segment accepted the offer after 5th Campaign.\n* From the ones who accepted the offer in first campaign, Loyal customers were the highest, while impulsive customers on second. \n* Response to campaign acceptance was signficant 3rd campaign, and 'Need-Based customers' were highest among them. The reason behind this would be because of frequent visits by the Need-Based customers and products offered through the campaign may align with their demands.\n* Complain were highest from Need-Based and Wandering customers, which may correlate with their income status, and in their lack of interest in first two campaigns.\n\nmore interperations coming soon.\n\n#### Recommendations\n* Address the complains of Need-Based and Wandering Customers. \n* Impulsive customer can be converted into Loyal customers, through address their demands. "}}