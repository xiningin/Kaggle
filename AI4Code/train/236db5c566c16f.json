{"cell_type":{"0e565c76":"code","f030962e":"code","5a96828b":"code","94f31282":"code","78591b6c":"code","f253ad3d":"code","bace9098":"code","6f40f8c5":"code","29720cc8":"code","a25100bb":"code","0e89c8ae":"code","e59c6089":"code","f6ea79a7":"code","9733dfd2":"code","41881c42":"code","cd6d8e6b":"code","b8c2b80f":"code","1a33ad7f":"code","f16d3c33":"markdown","02d3dbe9":"markdown","139c16f4":"markdown","0e876818":"markdown","30f363cb":"markdown","a519e4d9":"markdown","b834fd3e":"markdown","60842bb4":"markdown","f9bfb10b":"markdown","ed070eaa":"markdown","b2a5705f":"markdown","122a3c7e":"markdown","6cd190d9":"markdown"},"source":{"0e565c76":"import pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport numpy as np\n%matplotlib inline","f030962e":"hourly_data = pd.read_csv('..\/input\/bike-sharing-dataset\/hour.csv')","5a96828b":"preprocessed_data = hourly_data.copy()\nseasons_mapping = {1: 'winter', 2: 'spring', 3: 'summer', 4: 'fall'}\npreprocessed_data['season'] = preprocessed_data['season'].apply(lambda x: seasons_mapping[x])\nyr_mapping = {0: 2011, 1: 2012}\npreprocessed_data['yr'] = preprocessed_data['yr'].apply(lambda x: yr_mapping[x])\nweekday_mapping = {0: 'Sunday', 1: 'Monday', 2: 'Tuesday', \\\n3: 'Wednesday', 4: 'Thursday', 5: 'Friday', 6: 'Saturday'}\npreprocessed_data['weekday'] = preprocessed_data['weekday'].apply(lambda x: weekday_mapping[x])\nweather_mapping = {1: 'clear', 2: 'cloudy', 3: 'light_rain_snow', 4: 'heavy_rain_snow'}\npreprocessed_data['weathersit'] = preprocessed_data['weathersit'].apply(lambda x: weather_mapping[x])\npreprocessed_data['hum'] = preprocessed_data['hum'] * 100\npreprocessed_data['windspeed'] = preprocessed_data['windspeed'] * 67","94f31282":"from statsmodels.tsa.stattools import adfuller\ndef test_stationarity(ts, window=10, **kwargs):\n    # create dataframe for plotting\n    plot_data = pd.DataFrame(ts)\n    plot_data['rolling_mean'] = ts.rolling(window).mean()\n    plot_data['rolling_std'] = ts.rolling(window).std()\n    \n    # compute p-value of Dickey-Fuller test\n    p_val = adfuller(ts)[1]\n    ax = plot_data.plot(**kwargs)\n    ax.set_title(f\"Dickey-Fuller p-value: {p_val:.3f}\")","78591b6c":"# get daily rides\ndaily_rides = preprocessed_data[[\"dteday\", \"registered\", \"casual\"]]\ndaily_rides = daily_rides.groupby(\"dteday\").sum()\n\n# convert index to DateTime object\ndaily_rides.index = pd.to_datetime(daily_rides.index)","f253ad3d":"#registered\ntest_stationarity(daily_rides.registered, figsize=(10, 8))","bace9098":"#casual\ntest_stationarity(daily_rides.casual, figsize=(10, 8))","6f40f8c5":"registered = daily_rides[\"registered\"]\nregistered_ma = registered.rolling(10).mean()\nregistered_ma_diff = registered - registered_ma\nregistered_ma_diff.dropna(inplace=True)\n\ncasual = daily_rides[\"casual\"]\ncasual_ma = casual.rolling(10).mean()\ncasual_ma_diff = casual - casual_ma\ncasual_ma_diff.dropna(inplace=True)","29720cc8":"#registered\ntest_stationarity(registered_ma_diff, figsize=(10, 8))","a25100bb":"#casual\ntest_stationarity(casual_ma_diff, figsize=(10, 8))","0e89c8ae":"registered = daily_rides[\"registered\"]\nregistered_diff = registered - registered.shift()\nregistered_diff.dropna(inplace=True)\n\ncasual = daily_rides[\"casual\"]\ncasual_diff = casual - casual.shift()\ncasual_diff.dropna(inplace=True)","e59c6089":"#registered\nplt.figure()\ntest_stationarity(registered_diff, figsize=(10, 8))","f6ea79a7":"#casual\nplt.figure()\ntest_stationarity(casual_diff, figsize=(10, 8))","9733dfd2":"from statsmodels.tsa.seasonal import seasonal_decompose\nregistered_decomposition = seasonal_decompose(daily_rides[\"registered\"])\ncasual_decomposition = seasonal_decompose(daily_rides[\"casual\"])","41881c42":"#registered plot\nregistered_plot = registered_decomposition.plot()\nregistered_plot.set_size_inches(10, 8)","cd6d8e6b":"#casual plot\ncasual_plot = casual_decomposition.plot()\ncasual_plot.set_size_inches(10, 8)","b8c2b80f":"#registered\nplt.figure()\ntest_stationarity(registered_decomposition.resid.dropna(), figsize=(10, 8))","1a33ad7f":"#casual\nplt.figure()\ntest_stationarity(casual_decomposition.resid.dropna(), figsize=(10, 8))","f16d3c33":"# Let's first check whether the time series is stationary by *subtracting their rolling means and last values*:","02d3dbe9":"we perform a time series analysis on the rides columns (registered and casual) in the bike sharing dataset.  \na time series is *weakly stationary*, that is, its mean, standard deviation, and covariance are stationary with respect to time.\nthere are two different techniques for identifying time series stationarity: rolling statistics and augmented Dickey-Fuller stationarity test (we consider both of them).","139c16f4":"Let's define function for plotting rolling statistics and ADF test for time series:","0e876818":"we can see that neither the moving average nor standard deviations are stationary.  \nFurthermore, the Dickey-Fuller test returns values of 0.355 and 0.372 for the registered and casual columns, respectively. This is strong evidence that the time series is not stationary.  \n  \nwe need to process them in order to obtain a stationary one.\nA common way to detrend a time series and make it stationary is to *subtract either its rolling mean or its last value*, or to *decompose it into a component that will contain its\ntrend, seasonality, and residual components*. ","30f363cb":"To access each of these three signals, use .trend, .seasonal, and .resid variables.  \nobtain visual results from the generated decompositions by calling the .plot() method:","a519e4d9":"Use the *statsmodel.tsa.seasonal. seasonal_decompose()* method to decompose the registered and casual rides:","b834fd3e":"apply the function to registered and casual data:","60842bb4":"# Mpw let's also check whether the time series is stationary using the previously mentioned technique, that is, *time series decomposition* in Trend, Seasonality, and Residual Components.","f9bfb10b":"[credit: The Data Analysis Workshop](https:\/\/smile.amazon.com\/Data-Analysis-Workshop-state-art\/dp\/1839211385\/ref=sr_1_1?dchild=1&keywords=The+Data+Analysis+Workshop+Solve+business+problems+with+state-of-the-art+data+analysis+models&qid=1612045402&sr=8-1)","ed070eaa":"extract the daily registered and casual rides from our preprocessed data:","b2a5705f":"subtract rolling mean:","122a3c7e":"Test the residuals obtained for stationarity:","6cd190d9":"subtract last value:"}}