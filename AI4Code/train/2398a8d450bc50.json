{"cell_type":{"8181cbca":"code","dc596376":"code","0a6db1f5":"code","1ea29cbb":"code","bd884994":"code","f142e4d6":"code","281f062b":"code","ee2d4165":"code","b7310f79":"code","3138b067":"code","9c1df6a6":"code","79e64a76":"code","c3a4530e":"code","91511c5d":"code","54343bc0":"code","1efb4ecc":"code","5317a9ff":"code","dc5fb00e":"code","49020d82":"code","23d50eb2":"code","0a6e2342":"code","ba8e5d0c":"markdown","34824b20":"markdown","a68db677":"markdown","9d82a4dc":"markdown","9b8a7d68":"markdown","3147e9df":"markdown","01b3a283":"markdown","017b9880":"markdown","26953edf":"markdown","cbbd4dfd":"markdown","a3d4980a":"markdown","f01e62cb":"markdown","a6ac5871":"markdown","09906519":"markdown"},"source":{"8181cbca":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport math\n\nimport geopandas as gpd\nimport geoplot.crs as gcrs\nimport geoplot as gplt\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","dc596376":"# Adjust display settings\npd.set_option('display.max_rows', 500)","0a6db1f5":"df = pd.read_csv('..\/input\/DV_lottery_dataset.csv', sep=';')\ndf.fillna(0, inplace = True)\n#print(df.info())","1ea29cbb":"path = gpd.datasets.get_path('naturalearth_lowres')\ngdf = gpd.read_file(path)\ngdf = gdf[gdf.name!=\"Antarctica\"]\nprint(gdf.info())","bd884994":"# We will merge it on 'name' column\ndf['name'] = df['Foreign State']\n\n# Fixing discrepancy in the country names\ndf.loc[df['Foreign State']== 'French Southern and Antarctic Lands', ['name']] = 'Fr. S. Antarctic Lands'\ndf.loc[df['Foreign State']== 'Bosnia and Herzegovina', ['name']] = 'Bosnia and Herz.'\ndf.loc[df['Foreign State']== 'Cote d\\'Ivoire', ['name']] = 'C\u00f4te d\\'Ivoire'\ndf.loc[df['Foreign State']== 'Congo, Democratic Republic of The', ['name']] = 'Dem. Rep. Congo'\ndf.loc[df['Foreign State']== 'Congo, Republic of The', ['name']] = 'Congo'\ndf.loc[df['Foreign State']== 'Czech Republic', ['name']] = 'Czech Rep.'\ndf.loc[df['Foreign State']== 'Equatorial Guinea', ['name']] = 'Eq. Guinea'\ndf.loc[df['Foreign State']== 'North Korea', ['name']] = 'Dem. Rep. Korea'\ndf.loc[df['Foreign State']== 'Western Sahara', ['name']] = 'W. Sahara'\ndf.loc[df['Foreign State']== 'South Sudan', ['name']] = 'S. Sudan'\ndf.loc[df['Foreign State']== 'Solomon Islands', ['name']] = 'Solomon Is.'\ndf.loc[df['Foreign State']== 'Laos', ['name']] = 'Lao PDR'\ndf.loc[df['Foreign State']== 'Central African Republic', ['name']] = 'Central African Rep.'\ndf.loc[df['Foreign State']== 'Solomon Islands', ['name']] = 'Solomon Is.'\n","f142e4d6":"gdf = gdf.merge(df, on='name', how=\"left\")\n#print(gdf.info())","281f062b":"df[['Foreign State', '2018_Total']].sort_values(by='2018_Total',ascending= False)","ee2d4165":"gplt.choropleth(gdf, hue=gdf['2018_Total'],projection=gcrs.Robinson(),\n                cmap='Purples', linewidth=0.5, edgecolor='gray', \n                k=None, legend=True, figsize=(20, 8))\nplt.title(\"Total number of participants in 2018\")","b7310f79":"gplt.choropleth(gdf, hue=gdf['2007_Total'],projection=gcrs.Robinson(),\n                cmap='Purples', linewidth=0.5, edgecolor='gray', \n                k=None, legend=True, figsize=(20, 8))\nplt.title(\"Total number of participants in 2007\")","3138b067":"df[['Foreign State', '2017_visas']].sort_values(by='2017_visas',ascending= False)","9c1df6a6":"gplt.choropleth(gdf, hue=gdf['2017_visas'],projection=gcrs.Robinson(),\n                cmap='Purples', linewidth=0.5, edgecolor='grey', \n                k=None, legend=True, figsize=(20, 8))\nplt.title(\"Number of winners in 2017\")","79e64a76":"gplt.choropleth(gdf, hue=gdf['2008_visas'],projection=gcrs.Robinson(),\n                cmap='Purples', linewidth=0.5, edgecolor='gray', \n                k=None, legend=True, figsize=(20, 8))\nplt.title(\"Number of winners in 2008\")","c3a4530e":"df['2017_p'] = df['2017_visas']\/df['2017_Total']\ndf['2017_p'].describe()","91511c5d":"df[['Foreign State', '2017_p']].sort_values(by='2017_p',ascending= False)","54343bc0":"gdf['2017_p'] = gdf['2017_visas']\/gdf['2017_Total']\ngplt.choropleth(gdf, hue=gdf['2017_p'],projection=gcrs.Robinson(),\n                cmap='Purples', linewidth=0.5, edgecolor='gray', \n                k=None, legend=True, figsize=(20, 8))\nplt.title(\"Probability of winning in 2017\")","1efb4ecc":"gdf['2010_p'] = gdf['2010_visas']\/gdf['2010_Total']\ngplt.choropleth(gdf, hue=gdf['2010_p'],projection=gcrs.Robinson(),\n                cmap='Purples', linewidth=0.5, edgecolor='gray', \n                k=None, legend=True, figsize=(20, 8))\nplt.title(\"Probability of winning in 2010\")","5317a9ff":"def nestim(x, win_prob):\n    if (x>0) and (x<=1):\n        return math.log(1-win_prob)\/math.log(1-x)\n    else: return np.nan\n\ndf['2017_Nyears'] = df['2017_p'].apply(lambda x: nestim(x, 0.95)) \nprint(df['2017_Nyears'].describe())","dc5fb00e":"df[['Foreign State', '2017_Nyears']].sort_values(by='2017_Nyears',ascending= False)","49020d82":"gdf['2017_Nyears'] = gdf['2017_p'].apply(lambda x: nestim(x, 0.95)) \ngplt.choropleth(gdf, hue=gdf['2017_Nyears'],projection=gcrs.Robinson(),\n                cmap='Purples', linewidth=0.5, edgecolor='gray', \n                k=None, legend=True, figsize=(20, 8))\nplt.title(\"Number of years one needs to play to win with 0.95 probability\")","23d50eb2":"# outcome: 1 - win, 0 -lose\np = 0.005457\nq = 1 - p\noutcome, probability, n = [0,1], [q, p], 548\nresults = []\nfor i in range(100000):\n    outcomes = np.random.choice(outcome, size=n, p=probability) \n    if 1 in outcomes: results.append(1)\n    else: results.append(0)\nprint('Probability of winning in {0} trials is {1}'.format(n, sum(results)\/len(results)))","0a6e2342":"# outcome: 1 - win, 0 -lose\np = 0.014904\nq = 1 - p\noutcome, probability, n = [0,1], [q, p], 200\nresults = []\nfor i in range(100000):\n    outcomes = np.random.choice(outcome, size=n, p=probability) \n    if 1 in outcomes: results.append(1)\n    else: results.append(0)\nprint('Probability of winning in {0} trials is {1}'.format(n, sum(results)\/len(results)))","ba8e5d0c":"### 2008 for comparision:","34824b20":"## Probability of winning in US green card lottery\n### In this kernel, we will estimate the probability of winning in the green card lottery for participants from different countries and visualize results on the map. We will also estimate the number of years one needs to participate in order to win with 0.95 probability.","a68db677":"### Read geospatial data (we will use it later for data visualization)","9d82a4dc":"## Let's calculate the probability of winning in a single year\n### The probability for each country will be the number of winners divided by the number of participants. \n### For 2017:","9b8a7d68":"### The probability of winning in a single year (2017) for participants from all countries (except Tuvalu) is below 2%.\n### 2010 for comparision:","3147e9df":"### 2007 for comparision:","01b3a283":"### Merge the geospatial data and lottery data","017b9880":"## Let's explore the total number of participants\n### 2018 year:","26953edf":"## Calculate number of years\n\n### Perhaps the probability value is too abstract, let's convert probability to a number which is more tangible. \n\n### We will estimate the number of years one needs to participate in the lottery in order to win with high confidence.\nFor calculations we will use Binomial distrubution formula:\n\\\\(P(x) = \\frac{n!}{(n-x)!(x)!}p^xq^{(n-x)}\\\\), \n\nwhere \\\\(n\\\\) is the number of trials\/years, \\\\(x\\\\) - number of wins, \\\\(p\\\\) - probability of winning in one trial\/year, \\\\(q = 1-p\\\\) is probability of not winning in one trial\/year.\n\nIt is easier to calculate \\\\(P(0)\\\\) (probability of not winning) and to find probability of winning as \\\\(1 - P(0)\\\\).\n\n\\\\(P(0) = q^n = (1-p)^n\\\\)\n\nBy taking logarithm of the equation, we can get the formula for number of trials\/years \\\\(n\\\\):\n\n\\\\(n = \\frac{ln(P(0))}{ln(1-p)}\\\\)\n\nWe will use this formula for estimation of the number of years\n\nThe number of years one needs to participate in the lottery in order to win with 0.95 probability:","cbbd4dfd":"## Number of winners\n### 2017:","a3d4980a":"### For Australia:","f01e62cb":"### The result is not very promising.\n### The estimated number of years for all countries (except Tuvalu) is higher than the current life expectancy. Of course, everyone can participate [applies to eligible countries] since it is free, but I would not recommend anyone to seriously bet on winning. ","a6ac5871":"## P.S. We will cross-check our calculation results using statistical simulations\n\n### For selected countries, we'll calculate the probability of winning over \\\\(n\\\\) years period using newly obtained number of years.\n\n### For Russia:","09906519":"## Data preparation\n### Read the lottery data"}}