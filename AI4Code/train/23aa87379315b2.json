{"cell_type":{"06f581d1":"code","61801575":"code","3a0cd48f":"code","96604b72":"code","3162ff2f":"code","4e978b81":"code","fcfa5446":"code","2d0d451c":"code","a19b38ee":"code","f31987f7":"code","201e18cd":"code","8e976ce8":"code","04ce7211":"code","ca2998b4":"code","2daff8e0":"code","7fa49036":"code","9f774830":"code","6258b4ce":"code","b4e6cb96":"code","56da8b63":"code","b0b54360":"code","071710b4":"code","eb248d2b":"code","4ababadf":"code","2c522f84":"code","eb87293d":"code","3ce3cae5":"code","13e7fa29":"code","f85359fa":"markdown","c70fabaa":"markdown","ae374ea7":"markdown","6277993a":"markdown","d21fd23c":"markdown","e534fb5b":"markdown","b4d206dd":"markdown","846fb1a2":"markdown","df1a88ea":"markdown"},"source":{"06f581d1":"import os\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nimport glob\nimport pydicom\n\nfrom tqdm import tqdm_notebook","61801575":"PATH = '..\/input\/siim-acr-pneumothorax-segmentation-data\/pneumothorax\/'\nfield_list = ['PatientAge', 'PatientSex', 'ViewPosition']\nattr_list = []\n\nfor fp in tqdm_notebook(glob.glob(os.path.join(PATH,'dicom-images-train\/*\/*\/*.dcm'))):\n    dataset = pydicom.dcmread(fp)\n    obj = {'fp': fp}\n    for f in field_list:\n        obj[f] = getattr(dataset,f)    \n    attr_list.append(obj)\n    \nframe = pd.DataFrame(attr_list)","3a0cd48f":"frame.nunique()","96604b72":"frame['PatientAge'] = frame['PatientAge'].astype(np.int32)\nframe['PatientAge'].sort_values(ascending=False).head()","3162ff2f":"frame['PatientAge'][frame['PatientAge']>90] = 90","4e978b81":"frame['PatientAge'].hist(bins=90)","fcfa5446":"frame['PatientSex'].value_counts()","2d0d451c":"frame['ViewPosition'].value_counts()","a19b38ee":"pd.DataFrame(frame.groupby(['PatientSex','ViewPosition'])['PatientAge'].count())","f31987f7":"sns.distplot(frame['PatientAge'][frame['PatientSex']=='F'], bins=45)\nsns.distplot(frame['PatientAge'][frame['PatientSex']=='M'], bins=45)","201e18cd":"sns.distplot(frame['PatientAge'][frame['ViewPosition']=='AP'], bins=45)\nsns.distplot(frame['PatientAge'][frame['ViewPosition']=='PA'], bins=45)","8e976ce8":"train_mask = pd.read_csv(os.path.join(PATH,'train-rle.csv'))","04ce7211":"# This fucntion based on the same name function from kernel:\n# https:\/\/www.kaggle.com\/abhishek\/image-mask-augmentations\ndef rle2mask(rle, width=1024, height=1024):\n    mask= np.zeros(width* height)\n    array = np.asarray([int(x) for x in rle.split()])\n    if array.shape == (1,):\n        return mask.reshape(width, height)\n    starts = array[0::2]\n    lengths = array[1::2]\n    current_position = 0\n    for index, start in enumerate(starts):\n        current_position += start\n        mask[current_position:current_position+lengths[index]] = 1\n        current_position += lengths[index]\n    return mask.reshape(width, height)","ca2998b4":"MASKS = train_mask[' EncodedPixels'].apply(rle2mask)\nMASKS = np.array(MASKS)","2daff8e0":"fraction = [i.sum()\/(1024**2) for i in tqdm_notebook(MASKS)]","7fa49036":"train_mask['fraction'] = fraction","9f774830":"mask_stats = train_mask.groupby('ImageId')['fraction'].agg(['sum','count'])","6258b4ce":"frame.shape, mask_stats.shape","b4e6cb96":"frame['ImageId'] = frame['fp'].apply(lambda x :os.path.split(x)[-1][:-4])","56da8b63":"frame = frame.merge(mask_stats.reset_index())","b0b54360":"frame['sum'].hist(bins=100, log=True)","071710b4":"frame['log_sum'] = np.log(frame['sum']+0.01)","eb248d2b":"plt.figure(figsize=(10,10))\nsns.scatterplot(y='log_sum', x='PatientAge', data=frame, hue='PatientSex', alpha=0.5)\nplt.show()","4ababadf":"plt.figure(figsize=(10,10))\nsns.scatterplot(y='log_sum', x='PatientAge', data=frame, hue='ViewPosition', alpha=0.5)\nplt.show()","2c522f84":"frame['count'].value_counts()","eb87293d":"plt.figure(figsize=(10,5))\nsns.distplot(frame['PatientAge'][(frame['count']==1) & (frame['sum']>0)], bins=50)\nsns.distplot(frame['PatientAge'][frame['count']==2], bins=50)\nsns.distplot(frame['PatientAge'][frame['count']==3], bins=50)\nplt.show()","3ce3cae5":"plt.figure(figsize=(10,5))\nsns.distplot(frame['sum'][(frame['count']==1) & (frame['sum']>0)], bins=50, norm_hist=True)\nsns.distplot(frame['sum'][frame['count']==2], bins=50, norm_hist=True)\nsns.distplot(frame['sum'][frame['count']==3], bins=50, norm_hist=True)\nplt.show()","13e7fa29":"plt.figure(figsize=(10,5))\nsns.distplot(frame['sum'][(frame['ViewPosition']=='AP') & (frame['sum']>0)], bins=50, norm_hist=True)\nsns.distplot(frame['sum'][(frame['ViewPosition']=='PA') & (frame['sum']>0)], bins=50, norm_hist=True)\nplt.show()","f85359fa":"I tried to look inside the image metadata.","c70fabaa":"Ok! Can we say that the **youngest** and oldest patients do not have pneumothorax?","ae374ea7":"Attention! Size of this data different from count of image","6277993a":"Wow! I see a 400 year old man, isn't  it?","d21fd23c":"Work in progress...\nLike, Share, Follow me...","e534fb5b":"There are approximately same distiributions","b4d206dd":"Let's look at the age of the patient","846fb1a2":"How many values do these fields take?","df1a88ea":"Time to discover mask image fraction"}}