{"cell_type":{"596883d9":"code","1eb3a081":"code","6e32f420":"code","dae6268e":"markdown"},"source":{"596883d9":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport time\nimport datetime\nfrom sklearn.metrics import accuracy_score\nfrom kaggle.competitions import twosigmanews\nimport gc\nenv = twosigmanews.make_env()\n(market_train, news_train) = env.get_training_data()\ngc.enable()","1eb3a081":"import warnings\nimport datetime\nwarnings.filterwarnings(action ='ignore',category = DeprecationWarning)\n\nnews_train['time'] = news_train['time'].dt.floor('d')\n\ncols = ['sentimentNegative','sentimentNeutral','sentimentPositive','relevance','companyCount','bodySize','sentenceCount','wordCount','firstMentionSentence']\ndef get_news_train(raw_data,days = 2):\n    news_last = pd.DataFrame()\n    for i in range(days):\n        cur_train = raw_data[cols]\n        cur_train['time'] = raw_data['time'] + datetime.timedelta(days = i,hours=22)\n        cur_train['key'] = cur_train['time'].astype(str)+ raw_data['assetName'].astype(str)\n        news_last = pd.concat([news_last, cur_train[['key'] + cols]])\n        print(\"after concat the shape is:\",news_last.shape)\n        news_last = news_last.groupby('key').sum()\n        news_last['key'] = news_last.index.values\n        print(\"the result shape is:\",news_last.shape)\n        del cur_train\n        gc.collect()\n    del news_last['key']\n    return news_last\n\nnews_last = get_news_train(news_train)\nprint(news_last.shape)\nprint(news_last.head())\nprint(news_last.dtypes)\n","6e32f420":"market_train['key'] = market_train['time'].astype(str) + market_train['assetName'].astype(str)\nmarket_train = market_train.join(news_last,on = 'key',how='left')\nprint(market_train['sentimentNeutral'].isnull().value_counts())\nmarket_train.head()","dae6268e":"# The key problem is how to join news data and market data.\n## I just using time + assetName as the key to join, so before join, i just do a floor operation with news_trian, see the code below\n## the news in serveral days before the trading time is important"}}