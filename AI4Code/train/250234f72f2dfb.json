{"cell_type":{"d124fe4b":"code","4a58accc":"code","852c0286":"code","c1289b02":"code","9c2cd538":"code","03a77633":"code","ef5420e4":"code","89b4a6c9":"code","a6c41c15":"code","b236656d":"code","b42e0aee":"code","29eb0904":"code","1c959989":"code","33191a49":"code","8c37bd20":"code","f5d6eb3f":"code","ec48e4c5":"code","773ee370":"code","4d9e2cf1":"code","c19da57e":"code","cca994d5":"code","1ba36c4a":"code","931d918c":"code","3b8b6c12":"code","aec85c8e":"code","036f6dbc":"code","618a7629":"code","b5d34f21":"code","3af3210d":"code","12ac4048":"code","e8b4689a":"code","d310cb81":"code","5765368f":"code","1d98f851":"code","80ecc0e6":"code","01b996b9":"code","b441f80d":"code","1d310279":"code","5444329f":"code","251a35a6":"code","eb531297":"code","a2c06c68":"code","8c052a91":"code","a5ff3c99":"code","62316e5d":"code","8589d101":"code","8c2e13b4":"code","07cb1ba5":"code","928883ef":"markdown","29abd054":"markdown","23e76945":"markdown","8c4d04fe":"markdown","f35d232d":"markdown","119c1d5e":"markdown","7d0ff10a":"markdown","3a53499f":"markdown","5dac5d66":"markdown","fad34a6c":"markdown","57475fa6":"markdown","e871e853":"markdown","1feda837":"markdown","c2846da9":"markdown","20e06378":"markdown","4d80d6fa":"markdown","10ec7624":"markdown","7a7e8bee":"markdown","1a19331a":"markdown","c0ac0834":"markdown","af7942aa":"markdown","90f440bf":"markdown","868f3293":"markdown","92d5ee16":"markdown","5e320f6a":"markdown","ee6d0006":"markdown"},"source":{"d124fe4b":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport warnings\nwarnings.filterwarnings('ignore')","4a58accc":"import os\nprint(os.listdir(\"..\/input\"))\nraw_data = pd.read_csv(\"..\/input\/beer-consumption-sao-paulo\/Consumo_cerveja.csv\")\nraw_data.head()","852c0286":"raw_data.columns = [\"Date\", \"Avg Temp\", \"Min Temp\", \"Max Temp\", \"Rainfall\", \"Weekend\", \"Beer Consumption\"]\nraw_data.head()","c1289b02":"raw_data.shape","9c2cd538":"raw_data.info()","03a77633":"raw_data.isnull().sum()","ef5420e4":"pd.set_option(\"display.max_rows\", 15)","89b4a6c9":"raw_data.iloc[364:]","a6c41c15":"after_drop_data = raw_data.drop(range(365, 941))\nafter_drop_data.shape","b236656d":"after_drop_data.tail()","b42e0aee":"temp_data = after_drop_data[[\"Min Temp\", \"Max Temp\", \"Avg Temp\", \"Rainfall\"]]\ntemp_data.head()","29eb0904":"import re\nfor index, row in temp_data.iterrows():\n    for j in [\"Min Temp\", \"Max Temp\", \"Avg Temp\", \"Rainfall\"]:\n        row[j] = re.sub(r',', '.', row[j])\ntemp_data.head()","1c959989":"temp_data = temp_data.astype(\"float64\")","33191a49":"tidy_data = after_drop_data\nfor j in [\"Min Temp\", \"Max Temp\", \"Avg Temp\", \"Rainfall\"]:\n    tidy_data[j] = temp_data[j]\ntidy_data.head()","8c37bd20":"tidy_data.info()","f5d6eb3f":"date_data = pd.DataFrame(tidy_data[\"Date\"])\ndate_data.head()","ec48e4c5":"months = np.array([])\ndays = np.array([])\nfor index, row in tidy_data.iterrows():\n    months = np.append(months, re.search(r'-(.+?)-', row[\"Date\"]).group(1))\n    days = np.append(days, re.search(r'-..-(.+?)$', row[\"Date\"]).group(1))\ndate_data[\"Month\"] = months\ndate_data[\"Day\"] = days\ndate_data[[\"Month\", \"Day\"]] = date_data[[\"Month\", \"Day\"]].astype(\"float64\")\ndate_data.head()","773ee370":"final_data = pd.merge(tidy_data, date_data, on=\"Date\", how=\"inner\")\nfinal_data = final_data.drop([\"Date\"], axis=1)\n#Re-order to have a y on right side \nfinal_data = final_data[[\"Avg Temp\", \"Min Temp\", \"Max Temp\", \"Rainfall\", \"Weekend\", \"Month\", \"Day\", \"Beer Consumption\"]]\nfinal_data.head()","4d9e2cf1":"from sklearn.model_selection import train_test_split\ntrain, test = train_test_split(final_data, test_size = 0.2, random_state = 25) \nprint(train.shape)\nprint(test.shape)","c19da57e":"df = train\ndf.describe()","cca994d5":"df.hist(figsize = (15, 18))","1ba36c4a":"df.boxplot(figsize=(8, 8), column = [\"Min Temp\", \"Avg Temp\", \"Max Temp\", \"Beer Consumption\"])","931d918c":"corr = df.corr()\nsns.heatmap(corr)","3b8b6c12":"fig, ax = plt.subplots(1, 3, figsize=(14, 4))\nax[0].scatter(df[\"Beer Consumption\"], df[\"Min Temp\"])\nax[1].scatter(df[\"Beer Consumption\"], df[\"Avg Temp\"])\nax[2].scatter(df[\"Beer Consumption\"], df[\"Max Temp\"])","aec85c8e":"by_month = df[[\"Month\", \"Beer Consumption\"]]\nby_month = by_month.groupby(\"Month\").mean().reset_index()\nby_month[\"Name\"] = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"]\nby_month.sort_values(by=[\"Beer Consumption\"], inplace=True, kind=\"heapsort\")\nby_month.reset_index(inplace=True)\nby_month.drop([\"index\"], axis=1, inplace=True)\nplt.figure(figsize=(12, 4))\nplt.bar(by_month[\"Name\"], by_month[\"Beer Consumption\"])","036f6dbc":"order_Month = by_month[\"Month\"].tolist()\norder_Month = {v : k+1 for k, v in enumerate(order_Month)}\norder_Month","618a7629":"def editMonth(df):\n    for index, row in df.iterrows():\n        #print(row[\"Month\"], order_Month[row[\"Month\"]])\n        row[\"Month\"] = order_Month[row[\"Month\"]]\n    return df\ndf = editMonth(df)\ndf.head()","b5d34f21":"plt.scatter(df[\"Month\"], df[\"Beer Consumption\"])","3af3210d":"print(final_data[[\"Month\", \"Beer Consumption\"]].corr())\nprint(df[[\"Month\", \"Beer Consumption\"]].corr())","12ac4048":"by_day = df[[\"Day\", \"Beer Consumption\"]]\nby_day = by_day.groupby(\"Day\").mean().sort_values(by=\"Beer Consumption\").reset_index()\nplt.figure(figsize=(16, 4))\nplt.bar(range(1, 32), by_day[\"Beer Consumption\"], tick_label=by_day[\"Day\"])","e8b4689a":"order_Day = by_day[\"Day\"].tolist()\norder_Day = {v : k+1 for k, v in enumerate(order_Day)}\nprint(order_Day)\ndef editDay(df):\n    for index, row in df.iterrows():\n        #print(row[\"Day\"], order_Day[row[\"Day\"]])\n        row[\"Day\"] = order_Day[row[\"Day\"]]\n    return df\ndf = editDay(df)\ndf.head()","d310cb81":"plt.scatter(df[\"Day\"], df[\"Beer Consumption\"])","5765368f":"print(final_data[[\"Day\", \"Beer Consumption\"]].corr())\nprint(df[[\"Day\", \"Beer Consumption\"]].corr())","1d98f851":"co = df.corr()\nsns.heatmap(co)","80ecc0e6":"rest_data = df[[\"Rainfall\", \"Weekend\", \"Beer Consumption\"]]\nfig, ax = plt.subplots(1, 2)\nax[0].scatter(rest_data[\"Weekend\"], rest_data[\"Beer Consumption\"], c=rest_data[\"Weekend\"])\nax[1].scatter(rest_data[\"Rainfall\"], rest_data[\"Beer Consumption\"])","01b996b9":"rest_data.corr()","b441f80d":"plt.hist(x = [rest_data[\"Beer Consumption\"].where(rest_data[\"Weekend\"]==1).dropna(), rest_data[\"Beer Consumption\"].where(rest_data[\"Weekend\"]==0).dropna()], color=[\"blue\", \"red\"], histtype=\"step\")","1d310279":"plt.hist(rest_data[\"Rainfall\"], log=True)","5444329f":"def logRainfall(df):\n    df[\"Rainfall\"] = df[\"Rainfall\"].apply(np.log)\n    #df[\"Rainfall\"].replace(to_replace = (-np.inf), value=0)\n    df.loc[df[\"Rainfall\"] == -np.inf, \"Rainfall\"] = 0\n    return df\ndf = logRainfall(df)\ndf[\"Rainfall\"]","251a35a6":"sns.heatmap(df.corr())\nprint(df.corr()[\"Beer Consumption\"])","eb531297":"test = editMonth(test)\ntest = editDay(test)\ntest = logRainfall(test)","a2c06c68":"test","8c052a91":"x_train, y_train = df.drop([\"Beer Consumption\"], axis=1), df[\"Beer Consumption\"]\nx_test, y_test = test.drop([\"Beer Consumption\"], axis=1), test[\"Beer Consumption\"]\nprint(x_train.shape, y_train.shape)\nprint(x_test.shape, y_test.shape)","a5ff3c99":"from sklearn.linear_model import LinearRegression\nlr = LinearRegression()\nlr.fit(x_train, y_train)\nlr.coef_","62316e5d":"predict = lr.predict(x_test)\nprint(predict[:5])\nprint(y_test[:5])","8589d101":"lr.score(x_test, y_test)#r2 score","8c2e13b4":"from sklearn.metrics import mean_squared_error\nans = np.sqrt(mean_squared_error(y_test, predict))","07cb1ba5":"ans","928883ef":"##### As data for only the first year is present need to drop rest entries","29abd054":"### PCA for temperature data - (Giving bogus results hence)\n#### This execution is on hold for future versions of this kernel \nfrom sklearn.decomposition import PCA\npca = PCA(n_components = 2)\ndec_temp = pca.fit_transform(df[[\"Avg Temp\", \"Min Temp\", \"Max Temp\"]])\nprint(pca.explained_variance_ratio_)\ndec_temp[:5]\n#### after end of preparation pieline\ndec_temp = pd.DataFrame(dec_temp, columns=[\"PC1\", \"PC2\"])\ndf = df.drop([\"Min Temp\", \"Max Temp\", \"Avg Temp\"], axis=1)\ndf[\"Temp1\"] = dec_temp[\"PC1\"]\ndf[\"Temp2\"] = dec_temp[\"PC2\"]\ndf = df[[\"Temp1\", \"Temp2\", \"Rainfall\", \"Weekend\", \"Month\", \"Day\", \"Beer Consumption\"]]\ndf.head()","23e76945":"Date,\nAverage Temperature (C),\nMinimum Temperature (C),\nMaximum Temperature (C),\nRainfall (mm),\nWeekend,\nBeer Consumption (liters),","8c4d04fe":"#### Heatmap shows good corelation in temperature data and consumption. But rest has to be further investigated. Moreover, Temperature data is inter-corelated. Multicolinearity could hence be a problem here. Adding Pricipal Component Analysis for Dimensionality reduction to my to do list","f35d232d":"#### Let's first translate column names to english","119c1d5e":"#### first take out test set and train set on fixed seed 25","7d0ff10a":"#### Scatterplot reassures positive corelation between beer consumption and temperature data. We can infer that people prefer a beer more on hotter days rather than cold ones","3a53499f":"#### FUTURE VERSIONs will contain-\n1. Dealing with multicolinearity of temperature\n2. pipeling for feature enggineering and model evlauation\n3. Cross validation and model selection using algorithms like SVM and Trees\n4. Different analysis for days and distribuution on week days","5dac5d66":"#### We can infer that people drink more during holiday season that is new year's eve, christmas and i believe october has halloween\n#### So i wll engineer a feature utilising this inference","fad34a6c":"#### Let's try figure out how beer consumtion is spread across different months","57475fa6":"# Exploratory Data Analysis","e871e853":"### DATA TIDYING","1feda837":"#### we were able to get a descent l2score on this.\n# Questions \/ Answers-\n1. Is beer consumption more in begining of month? Ans: No particular inference for this question\n2. how is beer consumption spread throughout the week? Ans: On hold\n3. how is beer consumption spread throughout the months? Ans: corelation can be found in terms of months with holidays & exams\n4. how is consumption related to avg, min and max temperature? Ans: all are corelated to beer consumption\n5. how is consumption related to rainfall? Ans: Highly right skewed due to more days with almost no rainfall\n6. What is the impact of weekend on consumption? Ans: More consumption on weekend but the difference is not steep","c2846da9":"##### So we have 5 object type features. Other than \"Date\" rest features have \", \" instead of \".\" decimal and the difference in shape and infor data entries suggest presence of a lot of NULL data. Let's get into some tidying of our data.","20e06378":"(x_test.isnull()==True).Rainfall.sum()","4d80d6fa":"#### As expected distribution for weekend is quite separated but for significance will do a chi-square test!","10ec7624":"#### As expected from the temperature data has incresing quantile distribution. One outlier can bee seen from the whiskers of Max Temp feature, don't think it is an issue.","7a7e8bee":"##### Now let's find out if there is any information to be extracted from the dates in relation with and beer consumption\n##### To do that first extract day and month from the date feature","1a19331a":"#### Quite interestingly month consumption is more for 31. Could it be because of 31st Dec? As 30 is on  the lowes side. Can't explain highest for 21 though. \n#### I have two options either to go with this or not. For this version i'll choose the prior.","c0ac0834":"#### Well it's better than nothing. that new year's eve could create a bias!","af7942aa":"#### So we were able to catch significant co-relation. We will do same with days","90f440bf":"#### Log transformation on the right skewed rainfall distribution generated lots of \"-inf\" as there are lots of 0s in data","868f3293":"# Questions-\n1. Is beer consumption more in begining of month?\n2. how is beer consumption spread throughout the week?\n3. how is beer consumption spread throughout the months?\n4. how is consumption related to avg, min and max temperature?\n5. how is consumption related to rainfall?\n6. What is the impact of weekend on consumption?","92d5ee16":"#### The temp features are almost normal can conduct a normality test to verify. Will put it on hold for future versions of kernel. Rest don't provide much inference","5e320f6a":"#### Let's fit our linear regression line to it","ee6d0006":"#### Let's do all of the above to test set"}}