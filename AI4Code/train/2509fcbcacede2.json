{"cell_type":{"040b8aab":"code","29472d7f":"code","5f19e829":"code","018aea29":"code","7767c8c3":"code","baa02cdf":"code","e5cd2bf6":"code","bc8e7d0a":"code","49e0cf3a":"code","8a896b17":"code","46cbbb25":"code","18c30c26":"code","c7c3a75d":"code","69afb74b":"code","6d59c0b3":"code","4cbcb583":"code","f47a124c":"code","9cd363b0":"code","85270e35":"code","73e3916e":"code","2a3fabcb":"code","f89794d5":"code","a4af3cfa":"code","5a964721":"code","fe119764":"code","21987845":"code","aa910754":"code","8cf811c5":"code","7c9eea24":"code","8a620cb1":"code","59897efa":"code","daf6cccb":"code","704858d1":"code","b945f9bf":"code","aa870e0d":"code","5c3059fa":"code","ae11f953":"code","15adac1d":"code","f952e870":"code","d866f3b3":"code","161d5183":"markdown","d7e750fb":"markdown","9cda7c58":"markdown","e1f8230b":"markdown","ef29ec93":"markdown","c00b7e9f":"markdown"},"source":{"040b8aab":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt","29472d7f":"data2019 = pd.read_csv(\"\/kaggle\/input\/world-happiness\/2019.csv\")\ndata2019[\"Year\"] = 2019\ndata2018 = pd.read_csv(\"\/kaggle\/input\/world-happiness\/2018.csv\")\ndata2018[\"Year\"] = 2018\ndata = pd.concat((data2019,data2018))\ndata.reset_index(inplace = True,drop=True)\ndata","5f19e829":"data[data.isna().any(axis=1)]","018aea29":"data[data[\"Country or region\"]==\"United Arab Emirates\"]","7767c8c3":"!pip install ycimpute\nfrom ycimpute.imputer import knnimput","baa02cdf":"#we need numerical values for prediction\nnum_data = data.select_dtypes(include=[\"float64\",\"int64\"])\n\n#we kept column names for create new similar dataframe \nvar_names = list(num_data)\nvar_names","e5cd2bf6":"#to take values as np.array\nvar_values = num_data.values\nvar_values","bc8e7d0a":"#after the prediction\ncompleted_values = knnimput.KNN(k=4).complete(var_values)\ncompleted_values","49e0cf3a":"#new not-null dataframe\nnew_num_data = pd.DataFrame(completed_values,columns = var_names)\n# and the value we want to find\nnew_num_data.iloc[175]","8a896b17":"#check value of data (consistency)\ndata.iloc[170:180]","46cbbb25":"#change values\ndata[\"Perceptions of corruption\"] = new_num_data[\"Perceptions of corruption\"]","18c30c26":"#control\ndata.iloc[170:180]","c7c3a75d":"plt.figure(figsize=(15,10))\nplt.subplot(2,3,1)\ndata.boxplot(\"GDP per capita\")\nplt.subplot(2,3,2)\ndata.boxplot(\"Social support\")\nplt.subplot(2,3,3)\ndata.boxplot(\"Healthy life expectancy\")\nplt.subplot(2,3,4)\ndata.boxplot(\"Freedom to make life choices\")\nplt.subplot(2,3,5)\ndata.boxplot(\"Generosity\")\nplt.subplot(2,3,6)\ndata.boxplot(\"Perceptions of corruption\")","69afb74b":"#Rwanda has srange \"Perceptions of corruption\" value!\ndata[data[\"Perceptions of corruption\"]>.35]","6d59c0b3":"#we looked to heatmap and we can see here,too\nsns.jointplot(x=\"Score\",y=\"Generosity\",data=data,kind=\"reg\")","4cbcb583":"### multiple outliers\nfrom sklearn.neighbors import LocalOutlierFactor\nclf = LocalOutlierFactor(n_neighbors = 20, contamination = 0.1)","f47a124c":"clf.fit_predict(new_num_data)","9cd363b0":"n_scores = clf.negative_outlier_factor_","85270e35":"plt.plot(np.sort(n_scores))","73e3916e":"#Outlier values\n#These cities are best and worst cities and they are out of standart.\nnew_num_data[n_scores<-1.01]","2a3fabcb":"diff = data.groupby(\"Country or region\")[\"Overall rank\"].diff()[156:]","f89794d5":"country_diff = pd.DataFrame({\"country\":data[\"Country or region\"][:156].values,\"diff\":diff.values})\ncountry_diff","a4af3cfa":"# Countries which have big score change.\ntreshold = 10\n\ncountry_diff = country_diff[(country_diff[\"diff\"] > treshold) | (country_diff[\"diff\"] < -treshold)]","5a964721":"plt.figure(figsize=(18,10))\nsns.barplot(x=\"diff\",y=\"country\",data=country_diff)","fe119764":"# Lastly Our Overall Rank\ndata[data[\"Country or region\"]==\"Turkey\"]","21987845":"### Prepare train data\n\ndf = data[[\"Score\",\"GDP per capita\",\"Social support\",\"Healthy life expectancy\",\"Freedom to make life choices\",\"Generosity\",\"Perceptions of corruption\"]]","aa910754":"### There are high relation between Score and GDP per capita, Social support, Healthy life expectancy\n\n### There isn't a certain relation between Score and Generosity, we can see this\n\nsns.heatmap(df.corr())","8cf811c5":"X = df.drop([\"Score\"],axis = 1)\ny = df[\"Score\"]","7c9eea24":"from sklearn.model_selection import train_test_split\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2)","8a620cb1":"from lightgbm import LGBMRegressor\n\nlgbm_model = LGBMRegressor()\n\nlgbm_params = {\"learning_rate\":[0.002,0.005,0.01,0.04,0.1],\n            \"max_depth\":[3,5,8,12,15,18],\n            \"n_estimators\":[5,20,50,100,300]}\n\n","59897efa":"from sklearn.model_selection import GridSearchCV\n\nlgbm_cv_model = GridSearchCV(lgbm_model,lgbm_params,cv=5,n_jobs=-1,verbose=2).fit(X_train,y_train)","daf6cccb":"lgbm_cv_model.best_params_","704858d1":"model = LGBMRegressor(learning_rate=0.1,\n                       max_depth=3,\n                       n_estimators=50).fit(X_train,y_train)","b945f9bf":"y_pred = model.predict(X_test)","aa870e0d":"import sklearn.metrics as sm\n\nprint(\"R2 score =\", round(sm.r2_score(y_test, y_pred), 5))","5c3059fa":"feature_imp = pd.Series(model.feature_importances_,\n                index=X_train.columns).sort_values(ascending=False)","ae11f953":"plt.figure(figsize=(20,10))\n\nsns.barplot(feature_imp,feature_imp.index)","15adac1d":"from pdpbox import pdp\n\ndef plot_partial_dep(model,data,feature):\n    pdp_dist = pdp.pdp_isolate(model=model, dataset=data\n                               , model_features=data.columns\n                               , feature=feature)\n    return pdp.pdp_plot(pdp_isolate_out=pdp_dist, feature_name=feature);","f952e870":"fig,ax = plot_partial_dep(model,X_train,\"Freedom to make life choices\")\nax[\"pdp_ax\"].set_ylabel('Happiness Score Effect');","d866f3b3":"fig,ax = plot_partial_dep(model,X_train,\"Social support\")\nax[\"pdp_ax\"].set_ylabel('Happiness Score Effect');","161d5183":"### Feature Importance\n","d7e750fb":"### Factors that affecting happiness score","9cda7c58":"### we need np.array for ycimpute prediction.","e1f8230b":"### Null value control","ef29ec93":"### Outliers","c00b7e9f":"> ### Fill \"Perceptions of corruption\" value with KNN"}}