{"cell_type":{"21c090d3":"code","e5ded20a":"code","d0a952f7":"code","4b9989e4":"code","24f0e065":"code","870839f8":"code","d55e173c":"code","f4e7542a":"code","e32c6577":"code","b41fddd0":"code","d15ff6a9":"code","5e06c62c":"code","fd2bc821":"code","2b729983":"code","7b1320be":"code","c3338523":"code","691eb099":"code","1c54c008":"code","b4182dd7":"code","b874f7f4":"code","3bdd12ce":"code","f670231b":"code","8fab2877":"code","a8a4aa9c":"code","b109e49b":"code","f8f0a09c":"code","6a0c46f8":"code","dc1addfe":"code","b92f2def":"code","ccf59e04":"code","ed302117":"code","7ad7f033":"code","85333ab8":"code","01801d90":"code","d59f79c3":"code","5ff2cbd6":"code","17af6e6f":"code","c4ce99af":"code","ced812e2":"code","c726e18f":"code","ad3e4df1":"code","c81301b7":"code","8e2c3afb":"markdown","ba11e2ca":"markdown","3d19e887":"markdown"},"source":{"21c090d3":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n        \n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","e5ded20a":"dataset = pd.read_csv('\/kaggle\/input\/bengaluru-house-price-data\/Bengaluru_House_Data.csv')\nprint(dataset.head())","d0a952f7":"print(dataset.groupby('area_type')['area_type'].agg('count'))\n\ndataset = dataset.drop(['availability','society','area_type'], axis=1)\nprint(dataset.head())\nprint(dataset.shape)","4b9989e4":"#Data Cleaning\nprint(dataset.isnull().sum())","24f0e065":"#add 0 to all null bathroom and balcony values\ndataset[['bath','balcony']] = dataset[['bath','balcony']].fillna(0)","870839f8":"#drop size and location null values\ndataset = dataset.dropna()\nprint(dataset.isnull().sum())\nprint(dataset.shape)","d55e173c":"\n#Size column has really weird values\nprint(dataset['size'].unique())\ndataset['size_bhk'] = dataset['size'].apply(lambda x: x.split(' ')[0])  #split by space\ndataset = dataset.drop(['size'], axis=1)\nprint(dataset.head())","f4e7542a":"#total_sqft column\nprint(dataset.total_sqft.unique())  #There are some range values and values in diff format like sq meter, Perch etc\n#fetch values which are not integers\nprint(dataset[dataset['total_sqft'].apply(lambda x: True if len(x) > 7 else False)].head(20))","e32c6577":"\n#make functions to convert other types into sqft\ndef convert_dash_value_to_mean(x):\n    temp = x.split(' - ')\n    if len(temp) == 2:\n        return (float(temp[0]) + float(temp[1]))\/\/2\n    else:\n        return float(temp)\n\ndef convert_sq_meter_to_feet(x):\n    # 1 sq meter = 10.7639 sq feet\n    temp = x.split('Sq. Meter')\n    if len(temp) == 2:\n        return float(temp[0]) * 10.7639\n    else:\n        return float(temp[0])\n\ndef convert_sq_yards_to_feet(x):\n    # 1 sq yard = 9 sq feet\n    temp = x.split('Sq. Yards')\n    if len(temp) == 2:\n        return float(temp[0]) * 9\n    else:\n        return float(temp[0])\n\ndef convert_perch_to_feet(x):\n    # 1 perch = 272.25\n    temp = x.split('Perch')\n    if len(temp) == 2:\n        return float(temp[0]) * 272.25\n    else:\n        return float(temp[0])\n\ndef convert_acres_to_feet(x):\n    # 1 acres = 4046.86 sq ft\n    temp = x.split('Acres')\n    if len(temp) == 2:\n        return float(temp[0]) * 4046.86\n    else:\n        return float(temp[0])\n\ndef convert_cents_to_feet(x):\n    # 1 acres = 435.6 sq ft\n    temp = x.split('Cent')\n    if len(temp) == 2:\n        return float(temp[0]) * 435.6\n    else:\n        return float(temp[0])\n\ndef convert_guntha_to_feet(x):\n    # 1 acres = 1089 sq ft\n    temp = x.split('Guntha')\n    if len(temp) == 2:\n        return float(temp[0]) * 1089\n    else:\n        return float(temp[0])\n\ndef convert_ground_to_feet(x):\n    # 1 acres = 2400 sq ft\n    temp = x.split('Ground')\n    if len(temp) == 2:\n        return float(temp[0]) * 2400\n    else:\n        return float(temp[0])\n\ndataset['total_sqft'] = dataset['total_sqft'].apply(lambda x: float(x) if len(x) < 6 else convert_dash_value_to_mean(x) if '-' in x else convert_sq_meter_to_feet(x) if 'Sq. Meter' in x else convert_sq_yards_to_feet(x) if 'Sq. Yards' in x else convert_perch_to_feet(x) if 'Perch' in x else convert_acres_to_feet(x) if 'Acres' in x else convert_cents_to_feet(x) if 'Cent' in x else convert_guntha_to_feet(x) if 'Guntha' in x else convert_ground_to_feet(x) if 'Ground' in x else float(x))\n\nprint(dataset.head())\n","b41fddd0":"#converting size_bhk column to float\ndataset['size_bhk'] = dataset['size_bhk'].apply(lambda x: float(x))","d15ff6a9":"#Adding price per sqft to detect outliers\ndataset['price_per_sqft'] = dataset['price'].apply(lambda x: float(x*100000))\/dataset['total_sqft']    #1 lakh = 100000 INR\nprint(dataset.head())\nprint(dataset.price_per_sqft.describe())","5e06c62c":"#Adding sqft per bhk to detect outliers\n\ndataset['sqft_per_bhk'] = dataset['total_sqft']\/(dataset['size_bhk'] + dataset['bath']+1) \nprint(dataset.head())\nprint(dataset.price_per_sqft.describe())","fd2bc821":"min(dataset['sqft_per_bhk'])   #Regular room size is between 100sqft to 1200sqft","2b729983":"dataset['sqft_per_bhk'] = dataset[~((dataset['sqft_per_bhk']>1200) | (dataset['sqft_per_bhk']<100))]['sqft_per_bhk']\ndataset.dropna(inplace=True)\nprint(dataset.shape)\ndataset.head(15)","7b1320be":"max(dataset['price_per_sqft'])","c3338523":"#Some room sizes based on number of rooms are impossible, so remove them\n#per bed-room size < 200 not possible, assuming\ndataset = dataset[dataset['total_sqft']\/\/dataset['size_bhk'] > 200]","691eb099":"#price per sqft min is 23.569 and max is 12000000, which are impossible for generic model, \nq1 = dataset.price_per_sqft.quantile(0.25)\nq3 = dataset.price_per_sqft.quantile(0.75)\niqr = q3 - q1\ndataset = dataset[(dataset['price_per_sqft']>float(q1-(1.5*iqr))) & (dataset['price_per_sqft']<float(q3+(1.5*iqr)))]\nprint(dataset.shape)\ndataset.head()","1c54c008":"dataset[dataset['size_bhk']==2]['size_bhk'].head()","b4182dd7":"dataset['location'].head()","b874f7f4":"import matplotlib\nmatplotlib.rcParams['figure.figsize'] = (15,10)\nplt.scatter(dataset[(dataset['size_bhk']==2) & (dataset['location']=='Uttarahalli')]['price'], dataset[(dataset['size_bhk']==2) & (dataset['location']=='Uttarahalli')]['total_sqft'], marker='*', label='2 bhk')\nplt.scatter(dataset[(dataset['size_bhk']==3) & (dataset['location']=='Uttarahalli')]['price'], dataset[(dataset['size_bhk']==3) & (dataset['location']=='Uttarahalli')]['total_sqft'], marker='o', label='3 bhk')\nplt.xlabel(\"BHK\")\nplt.ylabel(\"Total Price\")\nplt.legend()\nplt.show()","3bdd12ce":"#Some 2BHK flats have higher price than 3bhk flat, so remove those\ndef remove_bhk_outliers(df):\n    exclude_indices = np.array([])\n    for location, location_df in df.groupby(['location']):\n        bhk_stats = {}\n        for bhk, bhk_df in location_df.groupby('size_bhk'):\n            bhk_stats[bhk] = {\n                'mean' : np.mean(bhk_df.price_per_sqft),\n                'std' : np.std(bhk_df.price_per_sqft),\n                'count' : bhk_df.shape[0]\n            }\n        for bhk, bhk_df in location_df.groupby('size_bhk'):\n            stats = bhk_stats.get(bhk-1)\n            if stats and stats['count']>5:\n                exclude_indices = np.append(exclude_indices, bhk_df[bhk_df.price_per_sqft<(stats['mean'])].index.values)\n\n    return df.drop(exclude_indices, axis='index')\n\ndataset = remove_bhk_outliers(dataset)\n\nprint(dataset.shape)","f670231b":"plt.hist(dataset.price_per_sqft,color='blue',rwidth=0.8)\nplt.xlabel(\"Price Per SqFt\")\nplt.ylabel(\"Count\")\nplt.show()","8fab2877":"#no of bathroom should not be greater than no of bed rooms + 1\n#so remove them\nprint(dataset.groupby('bath')['bath'].agg('count'))\n\ndataset = dataset[(dataset['bath'] <= (dataset['size_bhk'] + 1))]\nprint(dataset.groupby('bath')['bath'].agg('count'))","a8a4aa9c":"dataset = dataset.drop(['price_per_sqft','sqft_per_bhk'],axis=1)\ndataset.head()","b109e49b":"dataset.head()\ndataset['location'][0]","f8f0a09c":"print(dataset.groupby('location')['location'].agg('count'))","6a0c46f8":"dataset.location = dataset.location.apply(lambda x: x.strip())","dc1addfe":"location_stats = dataset.groupby('location')['location'].agg('count').sort_values(ascending=False)\n\n\nlocation_stats_less_then_10 = location_stats[location_stats<=10]\ndataset.location = dataset.location.apply(lambda x: 'other' if x in location_stats_less_then_10 else x)","b92f2def":"len(dataset.location.unique())","ccf59e04":"dummies = pd.get_dummies(dataset.location)\ndummies.head(5)","ed302117":"dummies[dummies['Abbigere']==1]","7ad7f033":"n_df = pd.concat([dataset.drop(['location'],axis='columns'),dummies.drop('other',axis='columns')],axis='columns')","85333ab8":"\nn_df.head()","01801d90":"n_df[n_df.Abbigere == 1]","d59f79c3":"#Model Training\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.svm import SVC\nfrom sklearn.linear_model import LinearRegression, Lasso, Ridge\nfrom sklearn.model_selection import GridSearchCV\n\n","5ff2cbd6":"\nX_train, X_test, Y_train, Y_test = train_test_split(n_df.drop(['price'],axis=1),n_df['price'],test_size=0.2) \n","17af6e6f":"model_params = {\n    'linear_regression' : {\n        'model': LinearRegression(),\n        'params': {\n        }\n    },\n\n    'lasso' : {\n        'model': Lasso(),\n        'params': {\n            'alpha' : [1,10,20,30,50],\n            'max_iter' : [10,15,100],\n            'tol' : [0.1]\n        }\n    },\n    \n    'ridge' : {\n        'model': Ridge(),\n        'params': {\n            'alpha' : [1,10,20,30,50],\n            'max_iter' : [10,15,100]\n        }\n    },\n\n}","c4ce99af":"scores = []\n\nfor model_name, mp in model_params.items():\n    clf =  GridSearchCV(mp['model'], mp['params'], cv=5, return_train_score=False)\n    clf.fit(X_train, Y_train)\n    scores.append({\n        'model': model_name,\n        'best_score': clf.best_score_,\n        'best_params': clf.best_params_,\n    })\n    \nresult_df = pd.DataFrame(scores,columns=['model','best_score','best_params'])\nprint(result_df)\n","ced812e2":"model = Ridge(alpha=1.0, max_iter=10)\nmodel.fit(X_train, Y_train)","c726e18f":"model.score(X_test,Y_test)","ad3e4df1":"import joblib\njoblib.dump(model,'bengaluru_real_estate_model.ml')","c81301b7":"imp_model = joblib.load('bengaluru_real_estate_model.ml')\n\ndef predict_price(location,sqft,bath,bhk):\n    loc_index = np.where(n_df.drop(['price'],axis=1).columns==location)[0][0]\n    \n    x = np.zeros(len(n_df.drop(['price'],axis=1).columns))\n    x[0] = sqft\n    x[1] = bath\n    x[2] = bhk\n    if loc_index >= 0:\n        x[loc_index] = 1\n        \n    return imp_model.predict([x])[0]\n\npredict_price('Vidyaranyapura', 1800, 3, 2)","8e2c3afb":"## Visualization\n","ba11e2ca":"## Importing model and using it","3d19e887":"### Seems like Ridge model is best here"}}