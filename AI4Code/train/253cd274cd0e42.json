{"cell_type":{"16acdd9d":"code","1d9802ef":"code","7466e3a2":"code","89e9d236":"code","3a7afebd":"code","52ef7461":"code","85fa148e":"code","38313008":"code","31e745ea":"code","0c615d0a":"markdown","ef129711":"markdown","cce992d2":"markdown","2c725131":"markdown","1fcdaf1f":"markdown","5a74f249":"markdown","1c56c2a2":"markdown","cd1531f8":"markdown","5d6dd38a":"markdown"},"source":{"16acdd9d":"import pandas as pd\nimport matplotlib.pyplot as plt\n%matplotlib inline","1d9802ef":"import bq_helper\ngithub_repos = bq_helper.BigQueryHelper(active_project= \"bigquery-public-data\", \n                                       dataset_name = \"github_repos\")","7466e3a2":"query = \"\"\"SELECT EXTRACT(YEAR FROM TIMESTAMP_SECONDS(author.time_sec)) AS year,\n                  EXTRACT(MONTH FROM TIMESTAMP_SECONDS(author.time_sec)) AS month,\n                  author.name AS author_name, COUNT(*) AS count\n            FROM `bigquery-public-data.github_repos.commits`\n            GROUP BY year, month, author_name\n        \"\"\"\ngithub_repos.estimate_query_size(query)","89e9d236":"commits = github_repos.query_to_pandas_safe(query, max_gb_scanned=5)\ncommits.head()","3a7afebd":"commits.to_csv('output.csv', index=False)\n#commits = pd.read_csv('output.csv')","52ef7461":"commits['month_nr'] = (commits['year']-1970)*12 + commits['month']\nmonthly_commits = commits[['month_nr', 'count']].groupby(['month_nr']).sum()\nmonthly_commits.head()","85fa148e":"plt.figure(figsize=(12,6))\nplt.plot(monthly_commits)\nplt.title(\"Monthly Commits in Public Github-Repos since 1970\")","38313008":"yearly_commits_per_user = commits[['year', 'author_name', 'count']].groupby(['year', 'author_name']).sum()\nyearly_commits_per_user.head()","31e745ea":"yearly_active_users = yearly_commits_per_user.groupby('year').count()\nyearly_active_users.head()\n\nplt.figure(figsize=(12,6))\nplt.plot(yearly_active_users)\nplt.title(\"Yearly Active Users in Public Github-Repos\")","0c615d0a":"\nLet's first setup our environment to run BigQueries in Kaggle Kernels.\n\n### Importing Kaggle's bq_helper package pointing to the Github Repos public dataset","ef129711":"Obviously, some commits have a surprisingly \"early\" date (while others - and we will show this in just a minute - have dates lying in the future!). Let's visualize our results in a simple plot with matplotlib:","cce992d2":"This is the estimated amount of data in GB to be scanned during execution of this query. By default any query scanning more than 1GB of data will get cancelled by kaggle kernel environment.\n\n### Running a query\n\nThere are 2 ways to do this:\n\n1. BigQueryHelper.query_to_pandas(query): This method takes a query and returns a Pandas dataframe.\n1. BigQueryHelper.query_to_pandas_safe(query, max_gb_scanned=1): This method takes a query and returns a Pandas dataframe only if the size of the query is less than the given upperSizeLimit (1 gigabyte by default).\n\nHere's our example of a query with a specified upper limit.","2c725131":"### Saving the query result as a file (*.csv)\nHere, we simply can use the method to_csv for Pandas dataframes. (Use pd.read_csv('output.csv') to read the dataframe in again!)","1fcdaf1f":"### What are the Numbers of Monthly Commits in Public Github-Repositories\n\nUsing our dataframe we can now compute some further aggregations with Pandas methods. We can e.g. compute the number of commits for all months by using Panda's groupby- and sum-methods. Let's first add a new column for the number of each month (starting with the number 1 for January 1970)!","5a74f249":"### What are the Numbers of Active Github-Users in Public Repositories\n\nWe can use our dataframe and compute the number of commits again within Pandas:","1c56c2a2":"### Checking the size of a query each time before we run it\nOur Dataset is more than 3TBs so we can easily cross the allowed limits by running few queries. We should always estimate how much data we need to scan for executing this query by **BigQueryHelper.estimate_query_size()** method. We start with a simple query that gives us information on all commits and their authors (pre-aggregated on a user and per month basis with BigQuery-SQL).\n","cd1531f8":"Again, we see some strange dates (and also strange author names!). However, we can simply count the active users for each year and plot the result to have a simple visualization:","5d6dd38a":"# PLEASE NOTE\n### This notebook starts as a simple fork of https:\/\/www.kaggle.com\/poonaml\/analyzing-3-million-github-repos-using-bigquery"}}