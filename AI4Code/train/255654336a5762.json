{"cell_type":{"fefa562d":"code","f318beae":"code","bbd2479c":"code","d09652ca":"code","2cbc9992":"code","f391d4ec":"code","32afaa0d":"code","62beac2b":"code","448c17ac":"code","fccd3c26":"code","d82f6c40":"code","fde9ad81":"code","44431c53":"code","0c5ddf44":"code","66da1468":"markdown"},"source":{"fefa562d":"!pip install git+https:\/\/github.com\/deepset-ai\/haystack.git\n!pip install urllib3==1.25.4\n!pip install torch==1.6.0+cu101 torchvision==0.6.1+cu101 -f https:\/\/download.pytorch.org\/whl\/torch_stable.html","f318beae":"!nvidia-smi","bbd2479c":"from haystack import Finder\nfrom haystack.preprocessor.cleaning import clean_wiki_text\nfrom haystack.preprocessor.utils import convert_files_to_dicts, fetch_archive_from_http\nfrom haystack.reader.farm import FARMReader\nfrom haystack.reader.transformers import TransformersReader\nfrom haystack.utils import print_answers","d09652ca":"# In Colab \/ No Docker environments: Start Elasticsearch from source\n! wget https:\/\/artifacts.elastic.co\/downloads\/elasticsearch\/elasticsearch-7.6.2-linux-x86_64.tar.gz -q\n! tar -xzf elasticsearch-7.6.2-linux-x86_64.tar.gz\n! chown -R daemon:daemon elasticsearch-7.6.2\n\nimport os\nfrom subprocess import Popen, PIPE, STDOUT\nes_server = Popen(['elasticsearch-7.6.2\/bin\/elasticsearch'],\n                   stdout=PIPE, stderr=STDOUT,\n                   preexec_fn=lambda: os.setuid(1)  # as daemon\n                  )\n# wait until ES has started\n! sleep 30","2cbc9992":"from haystack.document_store.elasticsearch import ElasticsearchDocumentStore\ndocument_store = ElasticsearchDocumentStore(host=\"localhost\", username=\"\", password=\"\", index=\"document\")","f391d4ec":"import urllib.request  # the lib that handles the url stuff\n\ndata = urllib.request.urlopen('https:\/\/raw.githubusercontent.com\/peace-in-mind\/Quran-Truth-Edition\/master\/English-Quran-plain-text.txt').read().decode('utf-8')\n","32afaa0d":"dicts=[{'text':data, 'meta': {'name': 'quran_english.txt'}}]","62beac2b":"print(dicts[:3])","448c17ac":"document_store.write_documents(dicts)","fccd3c26":"from haystack.retriever.sparse import ElasticsearchRetriever\nretriever = ElasticsearchRetriever(document_store=document_store)","d82f6c40":"# Load a  local model or any of the QA models on\n# Hugging Face's model hub (https:\/\/huggingface.co\/models)\n\nreader = FARMReader(model_name_or_path=\"deepset\/roberta-base-squad2\", use_gpu=True)","fde9ad81":"finder = Finder(reader, retriever)","44431c53":"prediction = finder.get_answers(question=\"Who is Muhammad?\", top_k_retriever=10, top_k_reader=5)","0c5ddf44":"print_answers(prediction, details=\"minimal\")","66da1468":"doc_dir = \"data\/article_txt_got\"\ns3_url = \"https:\/\/s3.eu-central-1.amazonaws.com\/deepset.ai-farm-qa\/datasets\/documents\/wiki_gameofthrones_txt.zip\"\nfetch_archive_from_http(url=s3_url, output_dir=doc_dir)\n\ndicts = convert_files_to_dicts(dir_path=doc_dir, clean_func=clean_wiki_text, split_paragraphs=True)"}}