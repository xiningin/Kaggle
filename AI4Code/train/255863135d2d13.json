{"cell_type":{"b2ac0a31":"code","1e7a4e79":"code","3958c079":"code","3cdbd35b":"code","6d578b66":"code","0ace02b9":"code","5aafc1db":"code","0238b439":"code","47752e3b":"code","7a91f9a1":"code","6d051a48":"code","db59e1c5":"code","1c6611f6":"code","075eb20a":"code","f648d4c7":"code","1b61af4c":"code","69938917":"code","e46c3a37":"code","26eab6c4":"code","ff381ccd":"code","df8f703d":"code","6cc11ba7":"code","588f0947":"code","8b0aebe0":"code","f2fa534f":"code","81f5eba6":"code","d8e01421":"code","380a4e80":"code","3c0997f4":"code","a1b4aa7b":"code","63fc3072":"code","fe09cec4":"code","fdd40f4d":"code","880c1e61":"code","865239d3":"code","6975a7ec":"code","41b37dde":"code","3dc0f268":"code","d91a24b6":"code","4f94d613":"code","54f66724":"code","f07d3fc8":"code","0254d74d":"code","7612cd63":"code","7a2919a2":"code","95067ab6":"code","2429189a":"code","35fc28ac":"code","e79887e0":"code","4313af74":"code","a4b059ec":"code","4fd81cbd":"code","a37f9f95":"code","cbe36ad3":"code","0e74eacb":"markdown","e7565c70":"markdown","d1b35563":"markdown","ab486a47":"markdown","6fb1da73":"markdown","edb26cd9":"markdown","5d97b59d":"markdown","5867512e":"markdown","039d2edd":"markdown","4c843b65":"markdown","d2eb0f75":"markdown","7d038dd5":"markdown","7d38e203":"markdown","3248af8f":"markdown","75603e46":"markdown","1dddf95b":"markdown","0a8926d7":"markdown","7c68fa5f":"markdown","0e2862dd":"markdown","835bbd92":"markdown","5cd41629":"markdown","7b12d29e":"markdown","52e73b2e":"markdown","0e291637":"markdown","ac651cd4":"markdown","373301f8":"markdown","290aa935":"markdown","14f57a8b":"markdown","a4bdf7f7":"markdown","d35c8ab7":"markdown","1d9334d0":"markdown","29b1c437":"markdown","cc70dcb9":"markdown","d8a36130":"markdown","ef25b33c":"markdown","a3fae95a":"markdown","a9c22e15":"markdown","38e6e74a":"markdown","25dc12ce":"markdown","1658cb43":"markdown","d6d30757":"markdown","691c5410":"markdown"},"source":{"b2ac0a31":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport gc # garbage collect to clean memory\nimport seaborn as sns\nimport datetime\n# Any results you write to the current directory are saved as output.","1e7a4e79":"train_set = pd.read_csv('\/kaggle\/input\/data-science-bowl-2019\/train.csv', \n                        usecols=['event_id', 'game_session', 'timestamp', 'installation_id', 'event_count', 'event_code', 'game_time', 'title', 'type', 'world'], \n                        dtype= {'event_id':'category', 'game_session':'category', 'installation_id':'category', 'event_count':'int16', 'event_code':'int16', 'game_time':'int32', 'title':'category', 'type':'category', 'world':'category'},\n                        parse_dates=['timestamp']) \ntrain_labels_set = pd.read_csv('\/kaggle\/input\/data-science-bowl-2019\/train_labels.csv', dtype={'game_session':'category', 'installation_id':'category','title':'category','num_correct':'int8','num_incorrect':'int8','accuracy_group':'int8','accuracy':'float16'})","3958c079":"test_set = pd.read_csv('\/kaggle\/input\/data-science-bowl-2019\/test.csv', \n                        usecols=['event_id', 'game_session', 'timestamp', 'installation_id', 'event_count', 'event_code', 'game_time', 'title', 'type', 'world'], \n                        dtype= {'event_id':'category', 'game_session':'category', 'installation_id':'category', 'event_count':'int16', 'event_code':'int16', 'game_time':'int32', 'title':'category', 'type':'category', 'world':'category'},\n                        parse_dates=['timestamp'])\n","3cdbd35b":"pd.options.display.max_columns = None\npd.options.display.max_rows = 25 ","6d578b66":"plt.pie(train_labels_set['accuracy_group'].value_counts().values, labels=train_labels_set['accuracy_group'].unique(),\n        autopct='%1.1f%%', shadow=True, startangle=90)\nplt.axis('equal')\nplt.show()","0ace02b9":"sns.set_style(\"darkgrid\")\nchart = sns.distplot(train_set['game_time'].apply(np.log1p), color=\"deeppink\", label='train set')\nsns.kdeplot(test_set['game_time'].apply(np.log1p), color=\"teal\", label='test set')\nchart.set_xlabel('Game_time (log(milisecond))')\nchart.set_title(\"Game time distribution\")","5aafc1db":"str(datetime.timedelta(seconds=(np.expm1(11.5)\/1000)))","0238b439":"sns.set_style(\"darkgrid\")\nchart = sns.distplot(train_set.groupby('game_session').game_time.sum().apply(np.log1p), color=\"deeppink\", label='train set')\nsns.kdeplot(test_set.groupby('game_session').game_time.sum().apply(np.log1p), color=\"teal\", label='test set')\nchart.set_xlabel('Game_time (log(milisecond))')\nchart.set_title(\"Distribution of the game time per game session\")","47752e3b":"game_time_set = train_set.loc[(train_set['game_time']>0)].copy()\ngame_time_set['game_session'] = game_time_set.game_session.cat.remove_unused_categories() ","7a91f9a1":"sns.set_style(\"darkgrid\")\nchart = sns.distplot(game_time_set.groupby('game_session').game_time.sum().apply(np.log1p), color=\"deeppink\", label='train set')\n# sns.kdeplot(test_set.groupby('game_session').game_time.sum().apply(np.log1p), color=\"teal\", label='test set')\nchart.set_xlabel('Game_time (log(milisecond))')\nchart.set_title(\"Distribution of the game time per game session\")","6d051a48":"str(datetime.timedelta(seconds=(np.expm1(15)\/1000)))","db59e1c5":"game_time_set = train_set.loc[(train_set['game_time']>0) & (train_set['type']=='Assessment')].copy()\ngame_time_set['game_session'] = game_time_set.game_session.cat.remove_unused_categories() ","1c6611f6":"sns.set_style(\"darkgrid\")\nchart = sns.distplot(game_time_set.groupby('game_session').game_time.sum().apply(np.log1p), color=\"deeppink\", label='train set')\n# sns.kdeplot(test_set.groupby('game_session').game_time.sum().apply(np.log1p), color=\"teal\", label='test set')\nchart.set_xlabel('Game_time (log(milisecond))')\nchart.set_title(\"Distribution of the game time per game session\")","075eb20a":"import datetime\n\nfig, axes = plt.subplots(1, 2, figsize=(10, 5), sharey=False, dpi=100)\nchart = sns.distplot(train_set['timestamp'].dt.dayofweek, color=\"teal\", ax=axes[0])\nchart.set_title(\"Day of the week distribution (train_set)\")\nchart = sns.distplot(test_set['timestamp'].dt.dayofweek, color=\"teal\", ax=axes[1])\nchart.set_title(\"Day of the week distribution (test_set)\")","f648d4c7":"cat_order = ['Watering Hole (Activity)', \n'Fireworks (Activity)',\n'Sandcastle Builder (Activity)', \n'Flower Waterer (Activity)', \n'Bottle Filler (Activity)', \n'Bug Measurer (Activity)',\n'Chicken Balancer (Activity)',\n'Egg Dropper (Activity)',  \n'All Star Sorting', \n'Air Show', \n'Scrub-A-Dub', 'Dino Drink', \n'Bubble Bath', 'Dino Dive', 'Crystals Rule', \n'Chow Time',\n'Pan Balance', 'Happy Camel', \n'Leaf Leader',\n'Mushroom Sorter (Assessment)', \n'Bird Measurer (Assessment)',\n'Cauldron Filler (Assessment)', \n'Cart Balancer (Assessment)', \n'Chest Sorter (Assessment)',\n'Welcome to Lost Lagoon!', \n'Magma Peak - Level 1',\n'Magma Peak - Level 2',\n'Tree Top City - Level 1',\n'Tree Top City - Level 2',\n'Tree Top City - Level 3',\n'Ordering Spheres', 'Slop Problem',\n'Costume Box', \n'12 Monkeys', \"Pirate's Tale\",\n'Treasure Map',\n'Rulers', \n'Crystal Caves - Level 1', 'Crystal Caves - Level 2', 'Crystal Caves - Level 3', \n'Balancing Act', 'Lifting Heavy Things','Honey Cake', 'Heavy, Heavier, Heaviest']","1b61af4c":"plt.figure(figsize=(20,15))\nchart = sns.countplot(x='title',order=cat_order,hue='type',dodge=False,data=train_set)\nchart.set_xticklabels(chart.get_xticklabels(), rotation=45, horizontalalignment='right')\nchart.set_title(\"Activity's title distribution and type of the activities (train_set)\")","69938917":"plt.figure(figsize=(20,15))\nchart = sns.countplot(x='title',order=cat_order,hue='type',dodge=False,data=test_set)\nchart.set_xticklabels(chart.get_xticklabels(), rotation=45, horizontalalignment='right')\nchart.set_title(\"Activity's title distribution and type of the activities (test_set)\")","e46c3a37":"fig, axes = plt.subplots(1, 2, figsize=(10, 5), sharey=False, dpi=100)\nchart = sns.countplot(train_set['type'], ax=axes[0])\nchart.set_xticklabels(chart.get_xticklabels(), rotation=45, horizontalalignment='right')\nchart.set_title(\"Type distribution (train_set)\")\nchart = sns.countplot(test_set['type'], ax=axes[1])\nchart.set_xticklabels(chart.get_xticklabels(), rotation=45, horizontalalignment='right')\nchart.set_title(\"Type distribution (test_set)\")","26eab6c4":"fig, axes = plt.subplots(1, 2, figsize=(10, 5), sharey=False, dpi=100)\nchart = sns.countplot(x='world',hue='type',data=train_set, ax=axes[0])#dodge=False,\nchart.set_xticklabels(chart.get_xticklabels(), rotation=45, horizontalalignment='right')\nchart.set_title(\"Type in world distribution (train_set)\")\nchart = sns.countplot(x='world',hue='type',data=test_set, ax=axes[1])#dodge=False,\nchart.set_xticklabels(chart.get_xticklabels(), rotation=45, horizontalalignment='right')\nchart.set_title(\"Type in world distribution (test_set)\")","ff381ccd":"fig, axes = plt.subplots(1, 2, figsize=(10, 5), sharey=False, dpi=100)\nchart = sns.countplot(x='world',data=train_set.loc[train_set['type']=='Assessment'], ax=axes[0])\nchart.set_xticklabels(chart.get_xticklabels(), rotation=45, horizontalalignment='right')\nchart.set_title(\"Assessment distribution among world (train_set)\")\nchart = sns.countplot(x='world',data=test_set.loc[train_set['type']=='Assessment'], ax=axes[1])\nchart.set_xticklabels(chart.get_xticklabels(), rotation=45, horizontalalignment='right')\nchart.set_title(\"Assessment distribution among world (test_set)\")","df8f703d":"train_xy = train_set.join(train_labels_set.set_index(['game_session','installation_id','title']), on=['game_session','installation_id','title'])","6cc11ba7":"train_xy = train_xy.astype({'title': 'category'}, copy=False)","588f0947":"sns.set(style = \"white\", font_scale=1)\ncorr=train_xy.corr()\n# mask for the upper triangle\nmask = np.zeros_like(corr, dtype=np.bool)\nmask[np.triu_indices_from(mask)]= True\n# set up the matplot figure\nf, ax = plt.subplots(figsize=(15,10))\nf.suptitle(\"Correlation matrix\", fontsize = 16)\n\ncmap = sns.diverging_palette(220,10,as_cmap=True)\n\nsns.heatmap(corr, mask=mask, cmap=cmap, vmax=.3, center=0, square=True, linewidths=.5, cbar_kws={\"shrink\":.5})","8b0aebe0":"var = 'title'\nsns.set_style(\"darkgrid\")\nf, ax = plt.subplots(figsize=(6, 8))\nfig = sns.boxplot(x=var, y=\"accuracy_group\", data=train_labels_set)\nfig.axis(ymin=-0, ymax=3.5)\nfig.set_title('Box plot of accuracy_group according to the assessment title')\nplt.xticks(rotation=90);","f2fa534f":"cross_title_group = pd.crosstab(train_labels_set[\"accuracy_group\"],train_labels_set[\"title\"])","81f5eba6":"x = [[0,1,2,3,4]]*4\ny = [[0]*5,[1]*5,[2]*5,[3]*5]\nplt.scatter(x,y,data=train_labels_set, s=cross_title_group)\nplt.ylabel('accuracy groups')\nplt.xticks([0,1,2,3,4], ['Bird Measurer', 'Cart Balancer', 'Cauldron Filler', 'Chest Sorter', 'Mushroom Sorter'], rotation=45, horizontalalignment='right')\nplt.yticks([0,1,2,3],[0,1,2,3])\nplt.title('Predominance of accuracy group per assessment title')\nplt.show()","d8e01421":"pd.set_option('max_colwidth', 500)\ntrain_set.loc[train_set['type']=='Assessment'].groupby('world').title.unique()","380a4e80":"train_labels_set.groupby([\"installation_id\"])[\"accuracy_group\"].count().nlargest(5)\n","3c0997f4":"train_labels_set.groupby([\"game_session\"])[\"accuracy_group\"].count().nlargest(5)","a1b4aa7b":"train_labelled = train_set.loc[train_set['installation_id'].isin(train_labels_set['installation_id'])]","63fc3072":"train_xy_ass = train_labelled.loc[train_labelled['type']=='Assessment'].iloc[:,[1, 2, 3, 9]].merge(train_labels_set.iloc[:, [0, 6]].set_index('game_session'), on='game_session')\ntrain_xy_ass['installation_id'] = train_xy_ass.installation_id.cat.remove_unused_categories() ","fe09cec4":"cross_world_group = pd.crosstab(train_xy_ass[\"accuracy_group\"],train_xy_ass[\"world\"])","fdd40f4d":"cross_world_group","880c1e61":"x = [[0,1,2]]*4\ny = [[0]*3,[1]*3,[2]*3,[3]*3]\nplt.scatter(x,y,data=train_xy_ass, s=cross_world_group\/100)\nplt.ylabel('accuracy groups')\nplt.xticks([0,1,2], ['Crystal caves', 'Magmapeak', 'Treetopcity'], rotation=45, horizontalalignment='right')\nplt.yticks([0,1,2,3],[0,1,2,3])\nplt.title('Predominance of accuracy group per assessment world')\nplt.show()","865239d3":"train_xy_ass.groupby('installation_id').accuracy_group.nunique().hist()\nplt.xticks([1,2,3,4],[1,2,3,4])\nplt.xlabel('Number of distinct accuracy group')\nplt.ylabel('Number of installation_id')\nplt.title('Histogramme of the number of distinct accuracy group per installation_id')","6975a7ec":"pd.options.display.min_rows = 40\ntrain_xy_ass.groupby(['installation_id', 'accuracy_group']).agg({'game_session':'first', 'timestamp': 'max'})","41b37dde":"nb_assessment = train_set.loc[train_set['type']=='Assessment']['game_session'].nunique()\nnb_label = train_labels_set['game_session'].nunique()\nprint(\"%0.2f pourcent assessment without attempt\"%(100*(nb_assessment - nb_label)\/nb_assessment))","3dc0f268":"print(\"%0.0f game sessions mean per installation id\"%(train_set.groupby(['installation_id']).game_session.nunique().mean()))","d91a24b6":"graph = train_set.groupby(['installation_id']).game_session.nunique().plot()\ngraph.axes.get_xaxis().set_ticks([])\nplt.title('Histogramme of number of distinct game session per installation id')\nplt.ylabel('number of distinct game session')","4f94d613":"fig = sns.violinplot( y=train_set.groupby(['installation_id']).game_session.nunique())\nfig.set_title('Violin plot of number of distinct game session per installation id')","54f66724":"print(\"%0.0f mean assessment per installation id\"%(train_set.loc[train_set['type']=='Assessment'].groupby(['installation_id']).game_session.nunique().mean()))","f07d3fc8":"graph = train_set.loc[train_set['type']=='Assessment'].groupby(['installation_id']).game_session.nunique().plot()\ngraph.axes.get_xaxis().set_ticks([])\nplt.title('Histogramme of number of assessment per installation id')\nplt.ylabel('number of assessment')","0254d74d":"fig = sns.violinplot( y=train_set.loc[train_set['type']=='Assessment'].groupby(['installation_id']).game_session.nunique())\nfig.set_title('Violin plot of number of assessment per installation id')","7612cd63":"train_set.loc[~(train_set['game_session'].isin(train_labels_set['game_session'])) & (train_set['type']=='Assessment')]['installation_id'].nunique()","7a2919a2":"acc_no_attempt = train_labels_set.loc[train_labels_set['installation_id']\n                     .isin(train_set.loc[~(train_set['game_session'].isin(train_labels_set['game_session'])) & \n              (train_set['type']=='Assessment')]['installation_id'])].groupby(['accuracy_group']).installation_id.nunique()","95067ab6":"acc_all_attempt = train_labels_set.loc[~train_labels_set['installation_id']\n                     .isin(train_set.loc[~(train_set['game_session'].isin(train_labels_set['game_session'])) & \n              (train_set['type']=='Assessment')]['installation_id'])].groupby(['accuracy_group']).installation_id.nunique()","2429189a":"df_group_attempt = pd.DataFrame(acc_no_attempt\/acc_no_attempt.sum()*100)\ndf_group_attempt.columns = ['no_attempt']\ncol_all_attempt = acc_all_attempt\/acc_all_attempt.sum()*100","35fc28ac":"df_group_attempt['all_attempt'] = col_all_attempt","e79887e0":"df_group_attempt","4313af74":"x = [[0,1]]*4\ny = [[0]*2,[1]*2,[2]*2,[3]*2]\nplt.scatter(x,y,data=train_labels_set, s=df_group_attempt*100)\nplt.ylabel('accuracy groups')\nplt.xticks([0,1], ['no attempt', 'all attempt'], rotation=45, horizontalalignment='right')\nplt.yticks([0,1,2,3],[0,1,2,3])\nplt.title('Normalized distribution of accuracy group on installation id having assessment with or without attempt')\nplt.show()","a4b059ec":"df_conting = pd.DataFrame(acc_no_attempt)\ndf_conting.columns = ['no_attempt']\ndf_conting['all_attempt'] = acc_all_attempt","4fd81cbd":"df_conting","a37f9f95":"x = [[0,1]]*4\ny = [[0]*2,[1]*2,[2]*2,[3]*2]\nplt.scatter(x,y,data=train_labels_set, s=df_conting)\nplt.ylabel('accuracy groups')\nplt.xticks([0,1], ['no attempt', 'all attempt'], rotation=45, horizontalalignment='right')\nplt.yticks([0,1,2,3],[0,1,2,3])\nplt.title('Distribution of accuracy group on installation id having assessment with or without attempt')\nplt.show()","cbe36ad3":"from scipy import stats\nstat, p, dof, expected = stats.chi2_contingency(df_conting)\nprint('dof=%d' % dof)\nprint(expected)\n# interpret test-statistic\nprob = 0.95\ncritical = stats.chi2.ppf(prob, dof)\nprint('probability=%.3f, critical=%.3f, stat=%.3f' % (prob, critical, stat))\nif abs(stat) >= critical:\n\tprint('Dependent (reject H0)')\nelse:\n\tprint('Independent (fail to reject H0)')\n# interpret p-value\nalpha = 1.0 - prob\nprint('significance=%.3f, p=%.3f' % (alpha, p))\nif p <= alpha:\n\tprint('Dependent (reject H0)')\nelse:\n\tprint('Independent (fail to reject H0)')","0e74eacb":"normalize the two tables:","e7565c70":"### Correlation between one another","d1b35563":"### Distribution of the world","ab486a47":"accuracy_group is inversly related to event_count which is logical.","6fb1da73":"### Correlation between world and Accuracy group","edb26cd9":"some game_session from train_set has no occurence in train_labels_set ! During the assessment phase, no assessment attemp has been recorded for these ones.","5d97b59d":"the world is less correlated to the assessment title but less informative. The assessment title should be conserved.","5867512e":"The distribution of the activities type from test and train set are comparable.","039d2edd":"get the accuracy group of the installation id which has at least one assessment not completed:","4c843b65":"### Correlation","d2eb0f75":"### Relation installation_id\/game_session\/assessment\n\n1. game_session and installation_id\n\nThere is 17000 distinct installation_id","7d038dd5":"does the absence of attempt is correlated to the accuracy group ?","7d38e203":"The accuracy group belongs to game_session and not installation_id.\nOne installation_id can have several accuracy_group:","3248af8f":"the time difference between two assessment could be only minutes: the same children may be trying again.\n\nthe timestamp is increasing with the accuracy group:  the same children may be improving himself with training time.","75603e46":"The distribution of the activities world from test and train set are comparable.\n\nClip occurs in no world (none).\nAssessement are split through the three differents worlds.","1dddf95b":"Game time per game session","0a8926d7":"### Missing values\n\nHow many assessment has no attempt (so no accuracy level) ?","7c68fa5f":"### Distribution of time_stamp","0e2862dd":"Mean game time per event is less than 2 minutes.","835bbd92":"The distribution of the activities from test and train set are comparable.\n\nclip values are scattered and has few occurences. These values can be grouped.\n","5cd41629":"### Distribution of the game time\ngame_time = 0 correspond to the starting event, so it is not meaningfull.\nWe need to zoom into differents intervals to have a better understanding of the distribution.","7b12d29e":"## Visualization\n### Distribution of the accuracy group","52e73b2e":"### Dispersion inside one installation id (presumed to be one user but which is probably not)","0e291637":"Mean game time for assessment activity is little shorter than for the other activities.","ac651cd4":"The distribution of the game time intervals from test and train set are comparable.","373301f8":"The distribution of the assessment activity among the worlds from test and train set are comparable.","290aa935":"get the accuracy group of the installation id which has all assessments completed:","14f57a8b":"when loading the data in the dataframe, specify the data type so the memory is well handled","a4bdf7f7":"**test stat chi-square**\n\nH0: the distribution in the accuracy group for installation id with assessment having no attempt is the same as installation id which complete all their attempt","d35c8ab7":"One assessment belongs to one and only one world. One world have one or two assessment:","1d9334d0":"Mean game time for assessment activity","29b1c437":"### Correlation between Title and Accuracy group","cc70dcb9":"Zoom in","d8a36130":"How many assessment per installation id ?","ef25b33c":"### Distribution of the title (categorical data)","a3fae95a":"get installation_id which has at least one assessment without attempt:","a9c22e15":"H0 is rejected, so the fact that assessment miss or not miss attempt is relevant.\nIt has to be taken into account in the prediction.","38e6e74a":"### Distribution of the type","25dc12ce":"A world propose one or two different assessment. One assessment belong to one and only one world.","1658cb43":"the day of the week shows no significant variation, so it is not informative.\nwe can't use the time since we don't have the time zone.","d6d30757":"Mean time per game_session is less than 1h.","691c5410":"# Data preparation\n## Train data \nAnayse and extract meaningfull informations from train.csv without the JSON column, so the dataframe is lighter. Event_data, the JSON data from train and test, will be analysed separately."}}