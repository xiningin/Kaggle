{"cell_type":{"9df81531":"code","44b5bf10":"code","f18d4d6e":"code","acaf6a7a":"code","11c0ad5f":"code","4430515a":"code","25159aee":"code","833b3886":"code","f7a11d8b":"code","f9635848":"code","c0749ac4":"code","c1e1a768":"code","e21c32b6":"code","276fee23":"code","517f4e58":"code","015932a2":"code","21270003":"code","af5755a8":"code","86a7a9f9":"code","cb12c2bc":"code","b7b31aed":"code","93f3d397":"code","2811c9f8":"code","de8a5dbd":"code","93626662":"code","b750d9f8":"code","dae8518a":"code","788d5344":"code","cdc8f0b0":"code","67bde402":"markdown","009877fc":"markdown","eeab2ee7":"markdown","97d93b24":"markdown","41de7cda":"markdown","9a525e80":"markdown","4952d784":"markdown","33bb807b":"markdown","22c58515":"markdown"},"source":{"9df81531":"import warnings\nwarnings.simplefilter(\"ignore\")\nimport seaborn as sns \nimport matplotlib.pyplot as plt\nimport time\nimport pandas as pd\nimport numpy as np\nimport lightgbm as lgb\nimport tracemalloc\nfrom pandas_summary import DataFrameSummary\nfrom sklearn.metrics import classification_report\n%matplotlib inline\nsns.set_style(\"whitegrid\")\n\npd.set_option('display.max_columns', None)  # or 1000\npd.set_option('display.max_rows', None)  # or 1000\npd.set_option('display.max_colwidth', -1)  # or 199","44b5bf10":"!pip install octopus-ml","f18d4d6e":"#check out https:\/\/github.com\/gershonc\/octopus-ml\nimport octopus_ml as oc","acaf6a7a":"import os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","11c0ad5f":"df= pd.read_csv('\/kaggle\/input\/heart-failure-prediction\/heart.csv')","4430515a":"df.head(2)","25159aee":"# Data shape \nprint (\"Train set: \",df.shape)\nprint (\"Test set: \",df.shape)","833b3886":"# DataFrane Summary by pandas summary package (extension of pandas.describe method) \ndfs = DataFrameSummary(df)\ndfs.summary()","f7a11d8b":"oc.hist_target(df, 'Cholesterol', 'HeartDisease')","f9635848":"oc.hist_target(df, 'ST_Slope', 'HeartDisease')","c0749ac4":"oc.hist_target(df, 'MaxHR', 'HeartDisease')","c1e1a768":"oc.hist_target(df, 'RestingBP', 'HeartDisease')","e21c32b6":"# Categorical features pre-proccesing  \ncat_list ,df=oc.cat_features_proccessing(df)\nprint (cat_list)","276fee23":"features=df.columns.to_list()\nprint ('number of features ', len(features))\n\nfeatures_remove=['HeartDisease']\nfor f in features_remove:\n    features.remove(f)","517f4e58":"X=df[features]\ny=df['HeartDisease']","015932a2":"oc.label_dist(df,'HeartDisease')","21270003":"params = {\n        'boosting_type': 'gbdt',\n        'objective': 'binary',\n        'metric': 'auc',\n        #'learning_rate': 0.1,\n        #'n_estimators': 100,\n        'verbose': -1,\n        #'max_depth': -1,\n        #'seed':100,      \n        #'min_split_gain': 0.01, \n        #'num_leaves': 18, \n        #'reg_alpha': 0.01, \n        #'reg_lambda': 1.50,\n        #'feature_fraction':0.2,\n        #'bagging_fraction':0.84\n}\n    \nmetrics= oc.cv_adv(X,y,0.5,20,shuffle=False,params=params,method='full')\n","af5755a8":"oc.cv_plot(metrics['f1_weighted'],metrics['f1_macro'],metrics['f1_positive'],'Heart disease dataset', mode='full')","86a7a9f9":"print(classification_report(metrics['y'], metrics['predictions_folds']))","cb12c2bc":"oc.roc_curve_plot(metrics['y'], metrics['predictions_proba'])","b7b31aed":"oc.preds_distribution(metrics['y'], metrics['predictions_proba'], bins=40)","93f3d397":"oc.confusion_matrix_plot(metrics['y'], metrics['predictions_folds'])","2811c9f8":"feature_imp_list=oc.plot_imp(metrics['final_clf'],X,'LightGBM Mortality Kaggle',num=16)","de8a5dbd":"top_features=feature_imp_list.sort_values(by='Value', ascending=False).head(20)\ntop_features","93626662":"list_for_correlations=top_features['Feature'].to_list()\nlist_for_correlations.append('HeartDisease')\noc.correlations(df,list_for_correlations)","b750d9f8":"import shap\nshap.initjs()","dae8518a":"explainer = shap.TreeExplainer(metrics['final_clf'])\nshap_values = explainer.shap_values(X)","788d5344":"shap.initjs()\nshap.force_plot(explainer.expected_value[1], shap_values[1][0,:], X.iloc[0,:])","cdc8f0b0":"for name in X.columns:\n    shap.dependence_plot(name, shap_values[1], X, display_features=X)","67bde402":"## ML Explainability ","009877fc":"## ML modeling","eeab2ee7":"# Check if there are any duplicate instances (rows)\noc.data_leakage(df,df.columns.to_list())","97d93b24":"The highest precentage of patients with disease is flat and down ST slope","41de7cda":"## Data pre-processing ","9a525e80":"## EDA","4952d784":"The patients with heart disease are left skewed distribution on the Max HR ","33bb807b":"There is an artifact - Cholesterol level of 0 - the majority of which is patients with heard disease ","22c58515":"## ML evaluation"}}