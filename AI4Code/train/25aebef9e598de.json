{"cell_type":{"61f434af":"code","65c4c69d":"code","ed5fd6f9":"code","cb4855f4":"code","e6473df7":"code","294f613a":"code","5a7a40c9":"code","482e88c4":"code","17129494":"code","10a3bb9b":"code","60defb82":"code","e51499ea":"code","4722e746":"code","4ce8de72":"code","74cba16c":"code","00b60973":"code","27835a26":"code","8309b28c":"code","1cf7b575":"code","1bcd90dc":"code","48d64f10":"code","7e1fcd70":"code","121b5591":"code","794d7003":"code","0ec90fae":"code","7595d334":"code","f957b621":"code","439a2d2a":"code","a06bbe57":"code","851d27dc":"code","d3153b69":"code","09f62d33":"code","7690c0fc":"code","b245cfab":"code","39b40bac":"code","2face3e1":"code","ae1dbd1e":"code","7aafdf1e":"code","74dc4dab":"code","54ec6446":"code","133c25a7":"code","46e35781":"code","c6529d1f":"code","cb5425f1":"code","deac268a":"code","31a8b2ba":"code","2e953a0f":"code","23e4bbde":"code","165ce3dd":"code","7c947126":"code","8d277271":"code","3bd35962":"code","aaa2759d":"code","7820a3bd":"code","44382150":"code","748375a2":"code","f0b1602d":"code","0b4a0057":"code","15ea3ac2":"code","bd5cfe94":"code","9b076c8a":"code","ff923c80":"code","9bd3de0d":"code","be9806fd":"code","fb0fe3d4":"code","8b179ea2":"code","43e015f9":"code","c599cf77":"code","99c17fd2":"code","99cbd01c":"code","9bb956c1":"code","95ff1ebc":"code","e4ac2430":"code","623f5170":"code","027adc2e":"code","d2f937e0":"code","7fe113a4":"code","6d23c563":"code","18be5899":"markdown","2c21f2c2":"markdown","b0594ac6":"markdown","b4fb5a39":"markdown","6f0e5163":"markdown","d93ce9c7":"markdown","3638e123":"markdown","442bec1f":"markdown","f51d11b7":"markdown","da468a3a":"markdown","d0dcb827":"markdown","58b82ed3":"markdown","4042702d":"markdown","3e51b5cc":"markdown","58c502bc":"markdown","2f354c4b":"markdown","a2c911e8":"markdown","ebd51f01":"markdown","8c8dc10f":"markdown","38f8b8b3":"markdown","764b7902":"markdown","769d4ad0":"markdown","f5c03133":"markdown","f9ac96ab":"markdown","630ecaeb":"markdown","f51a95c1":"markdown","641c5f60":"markdown","089d7e65":"markdown","b62553f5":"markdown"},"source":{"61f434af":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom warnings import filterwarnings\nfrom sklearn.metrics import confusion_matrix, accuracy_score, classification_report, roc_auc_score, roc_curve\nfrom tensorflow.keras.models import Sequential\nfrom keras.layers import Dense, Dropout, Flatten, Conv2D, MaxPool2D, BatchNormalization,MaxPooling2D\nfrom keras import models\nfrom keras import layers\nimport tensorflow as tf\nimport os\nimport os.path\nfrom pathlib import Path\nimport cv2\nfrom tensorflow.keras.preprocessing.image import ImageDataGenerator\nfrom keras.utils.np_utils import to_categorical\nfrom sklearn.model_selection import train_test_split\nfrom keras import regularizers\nfrom keras.optimizers import RMSprop,Adam\nimport glob\nfrom PIL import Image\n\n# IGNORING UNNECESSARRY WARNINGS\n\nfilterwarnings(\"ignore\",category=DeprecationWarning)\nfilterwarnings(\"ignore\", category=FutureWarning) \nfilterwarnings(\"ignore\", category=UserWarning)","65c4c69d":"No_Data_Path = Path(\"..\/input\/brain-tumor-detection\/no\")\nYes_Data_Path = Path(\"..\/input\/brain-tumor-detection\/yes\")","ed5fd6f9":"No_JPG_Path = list(No_Data_Path.glob(r\"*.jpg\"))\nYes_JPG_Path = list(Yes_Data_Path.glob(r\"*.jpg\"))","cb4855f4":"print(No_JPG_Path[0:5])\nprint(\"-----\"*20)\nprint(Yes_JPG_Path[0:5])","e6473df7":"Yes_No_List = []\n\nfor No_JPG in No_JPG_Path:\n    Yes_No_List.append(No_JPG)\n    \nfor Yes_JPG in Yes_JPG_Path:\n    Yes_No_List.append(Yes_JPG)","294f613a":"print(Yes_No_List[0:10])","5a7a40c9":"JPG_Labels = list(map(lambda x: os.path.split(os.path.split(x)[0])[1],Yes_No_List))","482e88c4":"print(JPG_Labels[0:10])","17129494":"print(\"NO COUNTING: \", JPG_Labels.count(\"no\"))\nprint(\"YES COUNTING: \", JPG_Labels.count(\"yes\"))","10a3bb9b":"JPG_Path_Series = pd.Series(Yes_No_List,name=\"JPG\").astype(str)\nJPG_Category_Series = pd.Series(JPG_Labels,name=\"TUMOR_CATEGORY\")","60defb82":"Main_Train_Data = pd.concat([JPG_Path_Series,JPG_Category_Series],axis=1)","e51499ea":"print(Main_Train_Data.head(-1))","4722e746":"Prediction_Path = Path(\"..\/input\/brain-tumor-detection\/pred\")","4ce8de72":"Test_JPG_Path = list(Prediction_Path.glob(r\"*.jpg\"))","74cba16c":"print(Test_JPG_Path[0:5])","00b60973":"Test_JPG_Labels = list(map(lambda x: os.path.split(os.path.split(x)[0])[1],Test_JPG_Path))","27835a26":"print(Test_JPG_Labels[0:5])","8309b28c":"Test_JPG_Path_Series = pd.Series(Test_JPG_Path,name=\"JPG\").astype(str)\nTest_JPG_Labels_Series = pd.Series(Test_JPG_Labels,name=\"TUMOR_CATEGORY\")","1cf7b575":"Test_Data = pd.concat([Test_JPG_Path_Series,Test_JPG_Labels_Series],axis=1)","1bcd90dc":"print(Test_Data.head())","48d64f10":"Main_Train_Data = Main_Train_Data.sample(frac=1).reset_index(drop=True)","7e1fcd70":"print(Main_Train_Data.head(-1))","121b5591":"figure = plt.figure(figsize=(10,10))\nplt.imshow(plt.imread(Main_Train_Data[\"JPG\"][10]))\nplt.title(Main_Train_Data[\"TUMOR_CATEGORY\"][10])","794d7003":"figure = plt.figure(figsize=(10,10))\nplt.imshow(plt.imread(Main_Train_Data[\"JPG\"][2997]))\nplt.title(Main_Train_Data[\"TUMOR_CATEGORY\"][2997])","0ec90fae":"fig, axes = plt.subplots(nrows=5, ncols=5, figsize=(10, 10),\n                        subplot_kw={'xticks': [], 'yticks': []})\n\nfor i, ax in enumerate(axes.flat):\n    ax.imshow(plt.imread(Main_Train_Data[\"JPG\"][i]))\n    ax.set_title(Main_Train_Data[\"TUMOR_CATEGORY\"][i])\nplt.tight_layout()\nplt.show()","7595d334":"train_data,test_data = train_test_split(Main_Train_Data,train_size=0.9,random_state=42)","f957b621":"print(train_data.shape)","439a2d2a":"print(train_data.head())","a06bbe57":"print(test_data.shape)","851d27dc":"print(test_data.head())","d3153b69":"Generator_Basic = ImageDataGenerator(rescale=1.\/255,\n                                     validation_split=0.1)","09f62d33":"Train_Set = Generator_Basic.flow_from_dataframe(dataframe=train_data,\n                                               x_col=\"JPG\",\n                                               y_col=\"TUMOR_CATEGORY\",\n                                               color_mode=\"grayscale\",\n                                               class_mode=\"categorical\",\n                                               subset=\"training\",\n                                               batch_size=20,\n                                               target_size=(200,200))","7690c0fc":"Validation_Set = Generator_Basic.flow_from_dataframe(dataframe=train_data,\n                                                     x_col=\"JPG\",\n                                                     y_col=\"TUMOR_CATEGORY\",\n                                                     color_mode=\"grayscale\",\n                                                     class_mode=\"categorical\",\n                                                     subset=\"validation\",\n                                                     batch_size=20,\n                                                     target_size=(200,200))","b245cfab":"Test_Set = Generator_Basic.flow_from_dataframe(dataframe=test_data,\n                                              x_col=\"JPG\",\n                                              y_col=\"TUMOR_CATEGORY\",\n                                              color_mode=\"grayscale\",\n                                              class_mode=\"categorical\",\n                                              batch_size=20,\n                                              target_size=(200,200))","39b40bac":"for data_batch,label_batch in Train_Set:\n    print(\"DATA SHAPE: \",data_batch.shape)\n    print(\"LABEL SHAPE: \",label_batch.shape)\n    break","2face3e1":"for data_batch,label_batch in Validation_Set:\n    print(\"DATA SHAPE: \",data_batch.shape)\n    print(\"LABEL SHAPE: \",label_batch.shape)\n    break","ae1dbd1e":"for data_batch,label_batch in Test_Set:\n    print(\"DATA SHAPE: \",data_batch.shape)\n    print(\"LABEL SHAPE: \",label_batch.shape)\n    break","7aafdf1e":"print(Train_Set.class_indices)\nprint(Train_Set.classes[0:5])\nprint(Train_Set.image_shape)","74dc4dab":"print(Validation_Set.class_indices)\nprint(Validation_Set.classes[0:5])\nprint(Validation_Set.image_shape)","54ec6446":"print(Test_Set.class_indices)\nprint(Test_Set.classes[0:5])\nprint(Test_Set.image_shape)","133c25a7":"Model = Sequential()\n\nModel.add(Conv2D(32,(5,5),activation=\"relu\",input_shape=(200,200,1)))\nModel.add(MaxPool2D((2,2)))\nModel.add(Dropout(0.2))\n#\nModel.add(Conv2D(64,(3,3),activation=\"relu\"))\nModel.add(MaxPool2D((2,2)))\nModel.add(Dropout(0.2))\n#\nModel.add(Conv2D(128,(3,3),activation=\"relu\"))\nModel.add(MaxPool2D((2,2)))\nModel.add(Dropout(0.2))\n#\nModel.add(Conv2D(256,(3,3),activation=\"relu\"))\nModel.add(MaxPool2D((2,2)))\nModel.add(Dropout(0.2))\n#\nModel.add(Flatten())\nModel.add(Dropout(0.5))\nModel.add(Dense(512,activation=\"relu\"))\nModel.add(Dense(2,activation=\"softmax\"))","46e35781":"Model.compile(optimizer=RMSprop(lr=0.001),loss=\"categorical_crossentropy\",metrics=[\"accuracy\"])","c6529d1f":"ANN_Model = Model.fit(Train_Set,validation_data=Validation_Set,\n                      epochs=30,steps_per_epoch=120)","cb5425f1":"print(Model.summary())","deac268a":"HistoryDict = ANN_Model.history\n\nval_losses = HistoryDict[\"val_loss\"]\nval_acc = HistoryDict[\"val_accuracy\"]\nacc = HistoryDict[\"accuracy\"]\nlosses = HistoryDict[\"loss\"]\nepochs = range(1,len(val_losses)+1)","31a8b2ba":"plt.plot(ANN_Model.history[\"accuracy\"])\nplt.plot(ANN_Model.history[\"val_accuracy\"])\nplt.ylabel(\"ACCURACY\")\nplt.legend()\nplt.show()","2e953a0f":"plt.plot(epochs,losses,\"k-\",label=\"LOSS\")\nplt.plot(epochs,val_losses,\"ro\",label=\"LOSS VALIDATION\")\nplt.title(\"LOSS & LOSS VAL\")\nplt.xlabel(\"EPOCH\")\nplt.ylabel(\"LOSS & LOSS VAL\")\nplt.legend()\nplt.show()","23e4bbde":"plt.plot(epochs,acc,\"k-\",label=\"ACCURACY\")\nplt.plot(epochs,val_acc,\"ro\",label=\"ACCURACY VALIDATION\")\nplt.title(\"ACCURACY & ACCURACY VAL\")\nplt.xlabel(\"EPOCH\")\nplt.ylabel(\"ACCURACY & ACCURACY VAL\")\nplt.legend()\nplt.show()","165ce3dd":"Dict_Summary = pd.DataFrame(ANN_Model.history)\nDict_Summary.plot()","7c947126":"Model_Results = Model.evaluate(Test_Set,verbose=False)\nprint(\"LOSS:  \" + \"%.4f\" % Model_Results[0])\nprint(\"ACCURACY:  \" + \"%.2f\" % Model_Results[1])","8d277271":"Main_Data_Prediction = pd.DataFrame({\"JPG\":Test_JPG_Path_Series})","3bd35962":"print(Main_Data_Prediction.head())","aaa2759d":"Main_Test_Generator = ImageDataGenerator(rescale=1.\/255)","7820a3bd":"Main_Test_Set = Main_Test_Generator.flow_from_dataframe(dataframe=Main_Data_Prediction,\n                                                       x_col=\"JPG\",\n                                                       y_col=None,\n                                                       color_mode=\"grayscale\",\n                                                        class_mode=None,\n                                                        batch_size=20,\n                                                        target_size=(200,200))","44382150":"Model_Test_Prediction = Model.predict(Main_Test_Set)","748375a2":"Model_Test_Prediction = Model_Test_Prediction.argmax(axis=-1)","f0b1602d":"print(Model_Test_Prediction)","0b4a0057":"Last_Prediction = []\n[Last_Prediction.append('NO') if i == 1 else Last_Prediction.append('TUMOR') for i in Model_Test_Prediction]\nprint(Last_Prediction)","15ea3ac2":"fig, axes = plt.subplots(nrows=5,\n                         ncols=5,\n                         figsize=(20, 20),\n                        subplot_kw={'xticks': [], 'yticks': []})\n\nfor i, ax in enumerate(axes.flat):\n    ax.imshow(plt.imread(Main_Data_Prediction[\"JPG\"].loc[i]))\n    ax.set_title(f\"PREDICTION:{Last_Prediction[i]}\")\nplt.tight_layout()\nplt.show()","bd5cfe94":"Data_Generator_Div = ImageDataGenerator(rescale=1.\/255,brightness_range=[0.3,0.9],\n                                       rotation_range=30,\n                                       width_shift_range=0.2,\n                                       height_shift_range=0.2,\n                                       shear_range=0.2,\n                                       horizontal_flip=True,\n                                       fill_mode=\"nearest\",\n                                       validation_split=0.1)","9b076c8a":"Train_Set_Div = Data_Generator_Div.flow_from_dataframe(dataframe=train_data,\n                                               x_col=\"JPG\",\n                                               y_col=\"TUMOR_CATEGORY\",\n                                               color_mode=\"grayscale\",\n                                               class_mode=\"categorical\",\n                                               subset=\"training\",\n                                               batch_size=20,\n                                               target_size=(200,200))","ff923c80":"Validation_Set_Div = Data_Generator_Div.flow_from_dataframe(dataframe=train_data,\n                                                     x_col=\"JPG\",\n                                                     y_col=\"TUMOR_CATEGORY\",\n                                                     color_mode=\"grayscale\",\n                                                     class_mode=\"categorical\",\n                                                     subset=\"validation\",\n                                                     batch_size=20,\n                                                     target_size=(200,200))","9bd3de0d":"Test_Set_Div = Data_Generator_Div.flow_from_dataframe(dataframe=Main_Data_Prediction,\n                                                       x_col=\"JPG\",\n                                                       y_col=None,\n                                                       color_mode=\"grayscale\",\n                                                        class_mode=None,\n                                                        batch_size=20,\n                                                        target_size=(200,200))","be9806fd":"Model_Two = Sequential()\n\nModel_Two.add(Conv2D(32,(5,5),activation=\"relu\",input_shape=(200,200,1)))\nModel_Two.add(MaxPool2D((2,2)))\n#\nModel_Two.add(Conv2D(64,(3,3),activation=\"relu\"))\nModel_Two.add(MaxPool2D((2,2)))\n#\nModel_Two.add(Conv2D(128,(3,3),activation=\"relu\"))\nModel_Two.add(MaxPool2D((2,2)))\n#\nModel_Two.add(Conv2D(128,(3,3),activation=\"relu\"))\nModel_Two.add(MaxPool2D((2,2)))\n#\nModel_Two.add(Conv2D(256,(3,3),activation=\"relu\"))\nModel_Two.add(MaxPool2D((2,2)))\n#\nModel_Two.add(Flatten())\nModel_Two.add(Dropout(0.5))\nModel_Two.add(Dense(512,activation=\"relu\"))\nModel_Two.add(Dense(2,activation=\"softmax\"))","fb0fe3d4":"Model_Two.compile(optimizer=RMSprop(lr=0.001),loss=\"categorical_crossentropy\",metrics=[\"accuracy\"])","8b179ea2":"ANN_Model_Two = Model_Two.fit(Train_Set_Div,\n                              validation_data=Validation_Set_Div,\n                              batch_size=20,\n                      epochs=50)","43e015f9":"print(Model_Two.summary())","c599cf77":"HistoryDict_Two = ANN_Model_Two.history\n\nval_losses_Two = HistoryDict_Two[\"val_loss\"]\nval_acc_Two = HistoryDict_Two[\"val_accuracy\"]\nacc_Two = HistoryDict_Two[\"accuracy\"]\nlosses_Two = HistoryDict_Two[\"loss\"]\nepochs_Two = range(1,len(val_losses_Two)+1)","99c17fd2":"plt.plot(ANN_Model_Two.history[\"accuracy\"])\nplt.plot(ANN_Model_Two.history[\"val_accuracy\"])\nplt.ylabel(\"ACCURACY\")\nplt.legend()\nplt.show()","99cbd01c":"plt.plot(epochs_Two,losses_Two,\"k-\",label=\"LOSS\")\nplt.plot(epochs_Two,val_losses_Two,\"r-.\",label=\"LOSS VALIDATION\")\nplt.title(\"LOSS & LOSS VAL\")\nplt.xlabel(\"EPOCH\")\nplt.ylabel(\"LOSS & LOSS VAL\")\nplt.legend()\nplt.show()","9bb956c1":"plt.plot(epochs_Two,acc_Two,\"k-\",label=\"ACCURACY\")\nplt.plot(epochs_Two,val_acc_Two,\"r-.\",label=\"ACCURACY VALIDATION\")\nplt.title(\"ACCURACY & ACCURACY VAL\")\nplt.xlabel(\"EPOCH\")\nplt.ylabel(\"ACCURACY & ACCURACY VAL\")\nplt.legend()\nplt.show()","95ff1ebc":"Dict_Summary_Two = pd.DataFrame(ANN_Model_Two.history)\nDict_Summary_Two.plot()","e4ac2430":"Model_Results_Two = Model_Two.evaluate(Test_Set,verbose=False)\nprint(\"LOSS:  \" + \"%.4f\" % Model_Results_Two[0])\nprint(\"ACCURACY:  \" + \"%.2f\" % Model_Results_Two[1])","623f5170":"Model_Test_Prediction_Two = Model_Two.predict(Test_Set_Div)","027adc2e":"Model_Test_Prediction_Two = Model_Test_Prediction_Two.argmax(axis=-1)","d2f937e0":"print(Model_Test_Prediction_Two)","7fe113a4":"Last_Prediction_Two = []\n[Last_Prediction_Two.append('NO') if i == 1 else Last_Prediction_Two.append('TUMOR') for i in Model_Test_Prediction_Two]\nprint(Last_Prediction_Two)","6d23c563":"fig, axes = plt.subplots(nrows=5,\n                         ncols=5,\n                         figsize=(20, 20),\n                        subplot_kw={'xticks': [], 'yticks': []})\n\nfor i, ax in enumerate(axes.flat):\n    ax.imshow(plt.imread(Main_Data_Prediction[\"JPG\"].loc[i]))\n    ax.set_title(f\"PREDICTION:{Last_Prediction_Two[i]}\")\nplt.tight_layout()\nplt.show()","18be5899":"#### TEST","2c21f2c2":"#### TRAIN","b0594ac6":"#### MODEL SUMMARY","b4fb5a39":"# PATH PROCESS","6f0e5163":"#### Abstract\n* A Brain tumor is considered as one of the aggressive diseases, among children and adults. Brain tumors account for 85 to 90 percent of all primary Central Nervous System(CNS) tumors. Every year, around 11,700 people are diagnosed with a brain tumor. The 5-year survival rate for people with a cancerous brain or CNS tumor is approximately 34 percent for men and36 percent for women. Brain Tumors are classified as: Benign Tumor, Malignant Tumor, Pituitary Tumor, etc. Proper treatment, planning, and accurate diagnostics should be implemented to improve the life expectancy of the patients. The best technique to detect brain tumors is Magnetic Resonance Imaging (MRI). A huge amount of image data is generated through the scans. These images are examined by the radiologist. A manual examination can be error-prone due to the level of complexities involved in brain tumors and their properties.\n* Application of automated classification techniques using Machine Learning(ML) and Artificial Intelligence(AI)has consistently shown higher accuracy than manual classification. Hence, proposing a system performing detection and classification by using Deep Learning Algorithms using Convolution-Neural Network (CNN), Artificial Neural Network (ANN), and Transfer-Learning (TL) would be helpful to doctors all around the world.\n\n#### Context\n* Brain Tumors are complex. There are a lot of abnormalities in the sizes and location of the brain tumor(s). This makes it really difficult for complete understanding of the nature of the tumor. Also, a professional Neurosurgeon is required for MRI analysis. Often times in developing countries the lack of skillful doctors and lack of knowledge about tumors makes it really challenging and time-consuming to generate reports from MRI\u2019. So an automated system on Cloud can solve this problem.\n\n#### Definition\n* To Detect and Classify Brain Tumor using, CNN or ANN; as an asset of Deep Learning and to examine the tumor position(segmentation).\n\n#### About the data:\n* The dataset contains 3 folders: yes, no and pred which contains 3060 Brain MRI Images.","d93ce9c7":"#### PREDICTION SCORE ON DIVIDED DATA","3638e123":"# HISTORY","442bec1f":"# IMAGE DATA GENERATOR WITHOUT DIVERSIFICATION","f51d11b7":"#### MODEL SUMMARY","da468a3a":"# SHUFFLING","d0dcb827":"# CNN MODEL WITH DIVERSIFICATION","58b82ed3":"#### MODEL COMPILE","4042702d":"# VISUALIZATION","3e51b5cc":"#### CHECKING MODEL WITH GRAPHIC","58c502bc":"# PACKAGES AND LIBRARIES","2f354c4b":"#### PREDICTION PROCESS","a2c911e8":"#### PREDICTION SCORE ON DIVIDED DATA","ebd51f01":"#### MODEL FITTING","8c8dc10f":"#### PREDICTION PROCESS","38f8b8b3":"#### MODEL FITTING","764b7902":"# MODEL TRAINING DATA","769d4ad0":"#### CHECKING","f5c03133":"# IMAGE DATA GENERATOR WITH DIVERSIFICATION","f9ac96ab":"#### MODEL STRUCTURE","630ecaeb":"# CNN MODEL FOR NON-DIVERSIFICATION","f51a95c1":"#### MODEL COMPILE","641c5f60":"#### MODEL STRUCTURE","089d7e65":"#### BASED ON TRAIN DATA","b62553f5":"#### CHECKING MODEL WITH GRAPHIC"}}