{"cell_type":{"2ba3d4c2":"code","c8658c45":"code","670df50a":"code","043d51cc":"code","d2251b90":"code","02a186e2":"code","df1b073e":"code","dddbd057":"code","c95eabe4":"code","8d6af35c":"code","9ba5466d":"code","1feb776f":"code","4d6ab16b":"code","3407805e":"code","1961563c":"code","ae55408c":"code","d14a97b8":"code","04c6ab3b":"code","a7d87ba2":"code","4d822ff6":"code","de28d6da":"markdown"},"source":{"2ba3d4c2":"import tensorflow as tf\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport random\n\nimport PIL\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport cv2\nimport os\nimport random\nimport math\nimport numpy as np\nimport h5py\nimport matplotlib.pyplot as plt\nimport tensorflow as tf\n\nfrom numpy import save\nfrom numpy import load\n\nfrom tensorflow.keras import Sequential\nfrom tensorflow.keras.layers import Dense\nfrom tensorflow import keras\nfrom tensorflow.keras import Input, Model\n\nfrom tensorflow.keras.layers import Conv2D\nfrom tensorflow.keras.layers import MaxPool2D\nfrom tensorflow.keras.layers import Flatten\nfrom tensorflow.keras.utils import to_categorical","c8658c45":"training_path = \"..\/input\/10-monkey-species\/training\/training\"\ntesting_path = \"..\/input\/10-monkey-species\/validation\/validation\"","670df50a":"generator = tf.keras.preprocessing.image.ImageDataGenerator(rescale=1\/255,\n                               zoom_range = 0.2,\n                               width_shift_range=0.15,\n                               height_shift_range=0.15,\n                               horizontal_flip=True)\ntraining_instances = generator.flow_from_directory(training_path, \n                                                   target_size=(299, 299),\n                                                   batch_size=256)\n\ngenerator = tf.keras.preprocessing.image.ImageDataGenerator(rescale=1\/255)\ntest_instances = generator.flow_from_directory(testing_path,\n                                               target_size=(299, 299),\n                                               batch_size=32)","043d51cc":"base_model = tf.keras.applications.InceptionResNetV2(weights=\"imagenet\", include_top=False, input_shape=(299,299,3))","d2251b90":"base_model.trainable = False","02a186e2":"x = tf.keras.layers.GlobalAvgPool2D()(base_model.output)\n\nx = tf.keras.layers.Dense(512, activation=\"relu\") (x)\nx = tf.keras.layers.Dense(256, activation=\"relu\") (x)\n\noutput_layer = tf.keras.layers.Dense(10, activation=\"softmax\") (x)","df1b073e":"model = Model(inputs=base_model.input, outputs=output_layer)","dddbd057":"model.compile(loss=\"categorical_crossentropy\", optimizer=tf.keras.optimizers.Adam(learning_rate=0.001), metrics=[\"accuracy\"])","c95eabe4":"model.summary()","8d6af35c":"initial_epochs = 17","9ba5466d":"%%time\nBatch_size=256\nmodel_fit=model.fit(training_instances, \n                    steps_per_epoch=1098\/\/Batch_size,\n                    epochs=initial_epochs,\n                    validation_data=test_instances\n                   )","1feb776f":"model.evaluate(test_instances)","4d6ab16b":"base_model.trainable = True","3407805e":"len(base_model.layers)","1961563c":"# Let's take a look to see how many layers are in the base model\nprint(\"Number of layers in the base model: \", len(base_model.layers))\n\n# Fine-tune from this layer onwards\nfine_tune_at = 600\n\n# Freeze all the layers before the `fine_tune_at` layer\nfor layer in base_model.layers[:fine_tune_at]:\n    layer.trainable =  False","ae55408c":"model.compile(loss=\"categorical_crossentropy\", optimizer=tf.keras.optimizers.Adam(learning_rate=0.0001), metrics=[\"accuracy\"])","d14a97b8":"model.summary()","04c6ab3b":"len(model.trainable_variables)","a7d87ba2":"%%time\nfine_tune_epochs = 20\ntotal_epochs =  initial_epochs + fine_tune_epochs\n\nhistory_fine = model.fit(training_instances,\n                         epochs=total_epochs,\n                         initial_epoch =  model_fit.epoch[-1],\n                         validation_data=test_instances)","4d822ff6":"model.evaluate(test_instances)","de28d6da":"Fine tuning"}}