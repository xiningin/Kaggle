{"cell_type":{"44ca4b8f":"code","305ca6ab":"code","162e0bc8":"code","db1d4360":"code","7abaed91":"code","f894e22b":"code","17a9ab82":"code","066ae1ec":"code","187cd7f1":"code","43fb36b6":"code","beb5bf5b":"code","68302dbf":"code","a676e1ac":"code","5d29e6da":"code","a550f528":"code","6904c6eb":"code","7598a3f4":"code","06e39265":"code","cf5aa751":"code","be0af7b5":"code","928b96cc":"code","c690a064":"code","e74619c2":"code","548d4c72":"code","774c774e":"code","021e7b8d":"code","4ebd9293":"code","74d2985a":"code","4d559978":"code","86e3bd10":"code","87abf571":"code","ec94d552":"code","5cf13195":"code","a8850a7a":"code","d150c038":"code","2d2e67e4":"code","947bf231":"code","0573fd93":"code","4b4592a4":"code","ff49bb87":"code","827412d7":"code","d69c2196":"code","21947426":"code","4f2cac2a":"code","7ea905e5":"code","a1c175fb":"code","73c27a05":"code","6d0c5716":"code","8a7c424a":"code","aa8579dd":"code","13992cc4":"code","b62b914e":"code","10d6b46c":"code","9c1ee241":"code","eca93fac":"code","c181a73d":"code","75fb012c":"code","9a7e1b62":"code","eb529a7b":"code","cb84e0e6":"code","3edeafc1":"code","5b777f1a":"code","3a0196ae":"code","9ef5372c":"code","b400d6fd":"code","ac700073":"code","58bed390":"code","32fc4305":"code","dcac231a":"code","ef789725":"code","2f900a09":"code","52f3e278":"code","ac4060f2":"code","21ecd857":"code","f28d5b25":"code","b2fcb650":"code","6dcf80eb":"code","140903bb":"code","ea3981fc":"code","88cc65eb":"code","4154cfb6":"code","a671dade":"code","0eb315e0":"code","72804bc2":"code","4b563828":"code","63c8082b":"code","bf0dc830":"code","4780d904":"code","aa4c764e":"code","00c8653d":"code","9fb3cf18":"code","28421628":"code","70c434d8":"code","5194b116":"code","f8864591":"code","65bac9b0":"code","0b992499":"code","5f4827c1":"code","d9a74b47":"code","f159a06e":"code","81c769e4":"code","0a89dd1a":"markdown","79111d4e":"markdown","888cca0e":"markdown","2f3b3d61":"markdown","243fa65c":"markdown","2ca2cd79":"markdown","f68bca46":"markdown","3d4bba7c":"markdown","584ee0e4":"markdown","79913465":"markdown","5bc1a48c":"markdown","42e7de5d":"markdown","908a62bc":"markdown","0eef5be7":"markdown","e54d6cbc":"markdown"},"source":{"44ca4b8f":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns","305ca6ab":"aisles = pd.read_csv('..\/input\/aisles.csv')","162e0bc8":"departments = pd.read_csv('..\/input\/departments.csv')","db1d4360":"order_products = pd.read_csv('..\/input\/order_products__prior.csv')","7abaed91":"orders = pd.read_csv('..\/input\/orders.csv')","f894e22b":"products = pd.read_csv('..\/input\/products.csv')","17a9ab82":"aisles.info()","066ae1ec":"aisles.head()","187cd7f1":"departments.info()","43fb36b6":"departments.head()","beb5bf5b":"order_products.info()","68302dbf":"order_products.describe()","a676e1ac":"order_products.head(10)","5d29e6da":"orders.info()","a550f528":"orders.describe()","6904c6eb":"orders.head()","7598a3f4":"products.info()","06e39265":"products.describe()","cf5aa751":"products.head()","be0af7b5":"user_order = orders[['user_id','order_id']]","928b96cc":"user_order.head()","c690a064":"user_order.describe()","e74619c2":"order_products_ex = order_products[['order_id','product_id']]","548d4c72":"order_products_ex.head()","774c774e":"user_products = pd.merge(user_order,order_products_ex,left_on='order_id',right_on='order_id')","021e7b8d":"user_products.tail(10)","4ebd9293":"user_products_pure = user_products[['user_id','product_id']]","74d2985a":"user_products_pure.head(10)","4d559978":"user_products.info()","86e3bd10":"user_products_cross = pd.crosstab(user_products_pure[:1000000]['user_id'],user_products_pure[:1000000]['product_id'])","87abf571":"user_products_cross.tail()","ec94d552":"#sns.clustermap(user_products_cross)","5cf13195":"from scipy.cluster.hierarchy import linkage, dendrogram,fcluster","a8850a7a":"linkage_result = linkage(user_products_cross, method='ward',metric='euclidean')","d150c038":"threshold = 0.5 * np.max(linkage_result[:,2])","2d2e67e4":"#visualise hyerarchical clustering\nplt.figure(num=None, figsize=(16,9),dpi=300, facecolor='w', edgecolor='k')\ndendrogram(linkage_result,color_threshold=threshold)\nplt.show","947bf231":"#get the result of clustering\nuser_clustered_5 = fcluster(linkage_result, threshold, criterion='distance')\nuser_clustered_5","0573fd93":"len(user_clustered_5)","4b4592a4":"user_clustered_5.max()","ff49bb87":"user_tagged_5 = pd.DataFrame(data=user_clustered_5,index=user_products_cross.index)","827412d7":"user_type_5_1=list(user_tagged_5[user_tagged_5[0]==1].index)\nuser_type_5_2=list(user_tagged_5[user_tagged_5[0]==2].index)\nuser_type_5_3=list(user_tagged_5[user_tagged_5[0]==3].index)\nuser_type_5_4=list(user_tagged_5[user_tagged_5[0]==4].index)\nuser_type_5_5=list(user_tagged_5[user_tagged_5[0]==5].index)\nuser_type_5_6=list(user_tagged_5[user_tagged_5[0]==6].index)","d69c2196":"print('Number of Users for each Type')\nprint('type1:{0} '.format(len(user_type_5_1)))\nprint('type2:{0} '.format(len(user_type_5_2)))\nprint('type3:{0} '.format(len(user_type_5_3)))\nprint('type4:{0} '.format(len(user_type_5_4)))\nprint('type5:{0} '.format(len(user_type_5_5)))\nprint('type6:{0} '.format(len(user_type_5_6)))","21947426":"user_pid_pname =pd.merge(user_products_pure,products, left_on='product_id', right_on='product_id').dropna()\nuser_pid_pname =pd.merge(user_pid_pname,aisles, left_on='aisle_id', right_on='aisle_id')\nuser_pid_pname =pd.merge(user_pid_pname,departments, left_on='department_id', right_on='department_id')","4f2cac2a":"user_pid_pname.tail(10)","7ea905e5":"sns.set()\nplt.figure(figsize=(16, 9))\ng = sns.countplot(user_pid_pname['product_name'],order=user_pid_pname['product_name'].value_counts().iloc[:30].index)\nplt.xticks(rotation=90)\ng.set_title('Best 30 products(Total)',fontdict={'fontsize':18})\nplt.show()","a1c175fb":"sns.set()\nplt.figure(figsize=(16, 9))\ng = sns.countplot(user_pid_pname['aisle'],order=user_pid_pname['aisle'].value_counts().iloc[:30].index)\nplt.xticks(rotation=90)\ng.set_title('Best 30 aisles(Total)',fontdict={'fontsize':18})\nplt.show()","73c27a05":"sns.set()\nplt.figure(figsize=(16, 9))\ng = sns.countplot(user_pid_pname['department'],order=user_pid_pname['department'].value_counts().iloc[:30].index)\nplt.xticks(rotation=90)\ng.set_title('Departments Countplot(Total)',fontdict={'fontsize':18})\nplt.show()","6d0c5716":"user_pid_pname_selected =user_pid_pname[user_pid_pname['user_id']<6468]","8a7c424a":"user_pid_pname_type_5_1 = pd.DataFrame(columns=user_pid_pname.columns)\nfor each in user_type_5_1:\n    selected = user_pid_pname_selected[user_pid_pname_selected['user_id']==each]\n    user_pid_pname_type_5_1 = user_pid_pname_type_5_1.append(selected)\nuser_pid_pname_type_5_1.head()","aa8579dd":"sns.set()\nplt.figure(figsize=(16, 9))\ng = sns.countplot(user_pid_pname_type_5_1['product_name'],order=user_pid_pname_type_5_1['product_name'].value_counts().iloc[:30].index)\nplt.xticks(rotation=90)\ng.set_title('Best 30 products(Type1)',fontdict={'fontsize':18})\nplt.show()","13992cc4":"sns.set()\nplt.figure(figsize=(16, 9))\ng = sns.countplot(user_pid_pname_type_5_1['aisle'],order=user_pid_pname_type_5_1['aisle'].value_counts().iloc[:30].index)\nplt.xticks(rotation=90)\ng.set_title('Best 30 aisles(Type1)',fontdict={'fontsize':18})\nplt.show()","b62b914e":"sns.set()\nplt.figure(figsize=(16, 9))\ng = sns.countplot(user_pid_pname_type_5_1['department'],order=user_pid_pname_type_5_1['department'].value_counts().iloc[:30].index)\nplt.xticks(rotation=90)\ng.set_title('Departments Countplot(Type1)',fontdict={'fontsize':18})\nplt.show()","10d6b46c":"user_pid_pname_type_5_2 = pd.DataFrame(columns=user_pid_pname.columns)\nfor each in user_type_5_2:\n    selected = user_pid_pname_selected[user_pid_pname_selected['user_id']==each]\n    user_pid_pname_type_5_2 = user_pid_pname_type_5_2.append(selected)\nuser_pid_pname_type_5_2.head()","9c1ee241":"sns.set()\nplt.figure(figsize=(16, 9))\ng = sns.countplot(user_pid_pname_type_5_2['product_name'],order=user_pid_pname_type_5_2['product_name'].value_counts().iloc[:30].index)\nplt.xticks(rotation=90)\ng.set_title('Best 30 products(Type2)',fontdict={'fontsize':18})\nplt.show()","eca93fac":"sns.set()\nplt.figure(figsize=(16, 9))\ng = sns.countplot(user_pid_pname_type_5_2['aisle'],order=user_pid_pname_type_5_2['aisle'].value_counts().iloc[:30].index)\nplt.xticks(rotation=90)\ng.set_title('Best 30 aisles(Type2)',fontdict={'fontsize':18})\nplt.show()","c181a73d":"sns.set()\nplt.figure(figsize=(16, 9))\ng = sns.countplot(user_pid_pname_type_5_2['department'],order=user_pid_pname_type_5_2['department'].value_counts().iloc[:30].index)\nplt.xticks(rotation=90)\ng.set_title('Departments Countplot(Type2)',fontdict={'fontsize':18})\nplt.show()","75fb012c":"user_pid_pname_type_5_3 = pd.DataFrame(columns=user_pid_pname.columns)\nfor each in user_type_5_3:\n    selected = user_pid_pname_selected[user_pid_pname_selected['user_id']==each]\n    user_pid_pname_type_5_3 = user_pid_pname_type_5_3.append(selected)\nuser_pid_pname_type_5_3.head()","9a7e1b62":"sns.set()\nplt.figure(figsize=(16, 9))\ng = sns.countplot(user_pid_pname_type_5_3['product_name'],order=user_pid_pname_type_5_3['product_name'].value_counts().iloc[:30].index)\nplt.xticks(rotation=90)\ng.set_title('Best 30 products(Type3)',fontdict={'fontsize':18})\nplt.show()","eb529a7b":"sns.set()\nplt.figure(figsize=(16, 9))\ng = sns.countplot(user_pid_pname_type_5_3['aisle'],order=user_pid_pname_type_5_3['aisle'].value_counts().iloc[:30].index)\nplt.xticks(rotation=90)\ng.set_title('Best 30 aisles(Type3)',fontdict={'fontsize':18})\nplt.show()","cb84e0e6":"sns.set()\nplt.figure(figsize=(16, 9))\ng = sns.countplot(user_pid_pname_type_5_3['department'],order=user_pid_pname_type_5_3['department'].value_counts().iloc[:30].index)\nplt.xticks(rotation=90)\ng.set_title('Departments Countplot(Type3)',fontdict={'fontsize':18})\nplt.show()","3edeafc1":"user_pid_pname_type_5_4 = pd.DataFrame(columns=user_pid_pname.columns)\nfor each in user_type_5_4:\n    selected = user_pid_pname_selected[user_pid_pname_selected['user_id']==each]\n    user_pid_pname_type_5_4 = user_pid_pname_type_5_4.append(selected)\nuser_pid_pname_type_5_4.head()","5b777f1a":"sns.set()\nplt.figure(figsize=(16, 9))\ng = sns.countplot(user_pid_pname_type_5_4['product_name'],order=user_pid_pname_type_5_4['product_name'].value_counts().iloc[:30].index)\nplt.xticks(rotation=90)\ng.set_title('Best 30 products(Type4)',fontdict={'fontsize':18})\nplt.show()","3a0196ae":"sns.set()\nplt.figure(figsize=(16, 9))\ng = sns.countplot(user_pid_pname_type_5_4['aisle'],order=user_pid_pname_type_5_4['aisle'].value_counts().iloc[:30].index)\nplt.xticks(rotation=90)\ng.set_title('Best 30 aisles(Type4)',fontdict={'fontsize':18})\nplt.show()","9ef5372c":"sns.set()\nplt.figure(figsize=(16, 9))\ng = sns.countplot(user_pid_pname_type_5_4['department'],order=user_pid_pname_type_5_4['department'].value_counts().iloc[:30].index)\nplt.xticks(rotation=90)\ng.set_title('Departments Countplot(Type4)',fontdict={'fontsize':18})\nplt.show()","b400d6fd":"user_pid_pname_type_5_5 = pd.DataFrame(columns=user_pid_pname.columns)\nfor each in user_type_5_5:\n    selected = user_pid_pname_selected[user_pid_pname_selected['user_id']==each]\n    user_pid_pname_type_5_5 = user_pid_pname_type_5_5.append(selected)\nuser_pid_pname_type_5_5.head()","ac700073":"sns.set()\nplt.figure(figsize=(16, 9))\ng = sns.countplot(user_pid_pname_type_5_5['product_name'],order=user_pid_pname_type_5_5['product_name'].value_counts().iloc[:30].index)\nplt.xticks(rotation=90)\ng.set_title('Best 30 products(Type5)',fontdict={'fontsize':18})\nplt.show()","58bed390":"sns.set()\nplt.figure(figsize=(16, 9))\ng = sns.countplot(user_pid_pname_type_5_5['aisle'],order=user_pid_pname_type_5_5['aisle'].value_counts().iloc[:30].index)\nplt.xticks(rotation=90)\ng.set_title('Best 30 aisles(Type5)',fontdict={'fontsize':18})\nplt.show()","32fc4305":"sns.set()\nplt.figure(figsize=(16, 9))\ng = sns.countplot(user_pid_pname_type_5_5['department'],order=user_pid_pname_type_5_5['department'].value_counts().iloc[:30].index)\nplt.xticks(rotation=90)\ng.set_title('Departments Countplot(Type5)',fontdict={'fontsize':18})\nplt.show()","dcac231a":"user_order_products_pure =pd.merge(user_products,products, left_on='product_id', right_on='product_id').dropna()\nuser_order_products_pure =pd.merge(user_order_products_pure,aisles, left_on='aisle_id', right_on='aisle_id')\nuser_order_products_pure =pd.merge(user_order_products_pure,departments, left_on='department_id', right_on='department_id')","ef789725":"for each in user_type_5_1:\n    user_order_products_pure.loc[user_order_products_pure['user_id']==each,'type']=1\nfor each in user_type_5_2:\n    user_order_products_pure.loc[user_order_products_pure['user_id']==each,'type']=2\nfor each in user_type_5_3:\n    user_order_products_pure.loc[user_order_products_pure['user_id']==each,'type']=3\nfor each in user_type_5_4:\n    user_order_products_pure.loc[user_order_products_pure['user_id']==each,'type']=4\nfor each in user_type_5_5:\n    user_order_products_pure.loc[user_order_products_pure['user_id']==each,'type']=5\nuser_order_products_pure = user_order_products_pure.dropna()\nuser_order_products_pure.head()","2f900a09":"user_order_products_pure =pd.merge(user_order_products_pure,orders,left_on='order_id', right_on='order_id')","52f3e278":"user_order_products_pure.drop('user_id_y',axis=1,inplace=True)","ac4060f2":"order_products[order_products['order_id']==40]","21ecd857":"order_summary = user_order_products_pure.groupby('order_id').mean()","f28d5b25":"day_hour_summary = pd.crosstab(order_summary['order_dow'],order_summary['order_hour_of_day'])\nday_hour_summary","b2fcb650":"day_hour_summary_1 =  order_summary[order_summary['type']==1]\nday_hour_summary_1 =  pd.crosstab(day_hour_summary_1['order_dow'],day_hour_summary_1['order_hour_of_day'])","6dcf80eb":"day_hour_summary_2 =  order_summary[order_summary['type']==2]\nday_hour_summary_2 =  pd.crosstab(day_hour_summary_2['order_dow'],day_hour_summary_2['order_hour_of_day'])","140903bb":"day_hour_summary_3 =  order_summary[order_summary['type']==3]\nday_hour_summary_3 =  pd.crosstab(day_hour_summary_3['order_dow'],day_hour_summary_3['order_hour_of_day'])","ea3981fc":"day_hour_summary_4 =  order_summary[order_summary['type']==4]\nday_hour_summary_4 =  pd.crosstab(day_hour_summary_4['order_dow'],day_hour_summary_4['order_hour_of_day'])","88cc65eb":"day_hour_summary_5 =  order_summary[order_summary['type']==5]\nday_hour_summary_5 =  pd.crosstab(day_hour_summary_5['order_dow'],day_hour_summary_5['order_hour_of_day'])","4154cfb6":"fig, axes = plt.subplots(nrows=2, ncols=3, figsize=(18, 10))\nax1 = sns.heatmap(day_hour_summary,cmap='Oranges',ax=axes[0,0])\nax1.set_title('Heatmap(Total)',fontdict={'fontsize':14})\nax2 = sns.heatmap(day_hour_summary_1,cmap='Blues',ax=axes[0,1])\nax2.set_title('Heatmap(Type1)',fontdict={'fontsize':14})\nax3 = sns.heatmap(day_hour_summary_2,cmap='Blues',ax=axes[0,2])\nax3.set_title('Heatmap(Type2)',fontdict={'fontsize':14})\nax4 = sns.heatmap(day_hour_summary_3,cmap='Blues',ax=axes[1,0])\nax4.set_title('Heatmap(Type3)',fontdict={'fontsize':14})\nax5 = sns.heatmap(day_hour_summary_4,cmap='Blues',ax=axes[1,1])\nax5.set_title('Heatmap(Type4)',fontdict={'fontsize':14})\nax6 = sns.heatmap(day_hour_summary_5,cmap='Blues',ax=axes[1,2])\nax6.set_title('Heatmap(Type5)',fontdict={'fontsize':14})","a671dade":"user_order_products_pure","0eb315e0":"product_type_pivot=pd.crosstab(user_order_products_pure['product_name'],user_order_products_pure['type'],normalize='columns',margins=True)\nproduct_type_pivot=product_type_pivot.sort_values('All',ascending=False)","72804bc2":"product_type_pivot.head()","4b563828":"sns.set()\nplt.figure(figsize=(9,20))\ng = sns.heatmap(product_type_pivot[:50],vmax=0.0075,linewidths=0.1,annot=True)\nplt.xticks(rotation=90)\ng.set_title('Remarkable Product',fontdict={'fontsize':18})\nplt.show()","63c8082b":"type_description = pd.DataFrame(index=['# of user','# of order','# of products','order\/user','product\/user','product\/order'],columns=product_type_pivot.columns)\ntype_description","bf0dc830":"Type=[1,2,3,4,5]\nfor each in Type:\n    type_description.iloc[0][each]=user_order_products_pure[user_order_products_pure['type']==each]['user_id_x'].nunique()\n    type_description.iloc[1][each]=user_order_products_pure[user_order_products_pure['type']==each]['order_id'].nunique()\n    type_description.iloc[2][each]=len(user_order_products_pure[user_order_products_pure['type']==each]['product_id'])\ntype_description.iloc[0]['All']=user_order_products_pure[:]['user_id_x'].nunique()\ntype_description.iloc[1]['All']=user_order_products_pure[:]['order_id'].nunique()\ntype_description.iloc[2]['All']=len(user_order_products_pure[:]['product_id'])\n\ntype_description.iloc[3,:]=type_description.iloc[1,:]\/type_description.iloc[0,:]\ntype_description.iloc[4,:]=type_description.iloc[2,:]\/type_description.iloc[0,:]\ntype_description.iloc[5,:]=type_description.iloc[2,:]\/type_description.iloc[1,:]","4780d904":"user_order_products_pure[user_order_products_pure['type']==1]['user_id_x'].nunique()","aa4c764e":"type_description","00c8653d":"type_description.to_csv('type_description.csv')","9fb3cf18":"aisle_type_pivot=pd.crosstab(user_order_products_pure['aisle'],user_order_products_pure['type'],normalize='columns',margins=True)\naisle_type_pivot=aisle_type_pivot.sort_values('All',ascending=False)","28421628":"sns.set()\nplt.figure(figsize=(9,20))\ng = sns.heatmap(aisle_type_pivot[:50],linewidths=0.1,annot=True,vmax=0.04)\nplt.xticks(rotation=90)\ng.set_title('Remarkable Aisle',fontdict={'fontsize':18})\nplt.show()","70c434d8":"department_type_pivot=pd.crosstab(user_order_products_pure['department'],user_order_products_pure['type'],normalize='columns',margins=True)\ndepartment_type_pivot=department_type_pivot.sort_values('All',ascending=False)","5194b116":"sns.set()\nplt.figure(figsize=(9,20))\ng = sns.heatmap(department_type_pivot[:50],linewidths=0.1,annot=True,vmax=0.06)\nplt.xticks(rotation=90)\ng.set_title('Remarkable Department',fontdict={'fontsize':18})\nplt.show()","f8864591":"threshold_7 = 0.35 * np.max(linkage_result[:,2])\n#visualise hyerarchical clustering\nplt.figure(num=None, figsize=(16,9),dpi=300, facecolor='w', edgecolor='k')\ndendrogram(linkage_result,color_threshold=threshold_7)\nplt.show","65bac9b0":"#get the result of clustering\nuser_clustered_7 = fcluster(linkage_result, threshold_7, criterion='distance')\nuser_clustered_7","0b992499":"len(user_clustered_7)","5f4827c1":"#products_user_pure = user_products_pure.sort_values(by='product_id',ascending=False).dropna()","d9a74b47":"#products_user_pure.head(20)","f159a06e":"#products_user_cross = pd.crosstab(products_user_pure[1000000:1100000]['product_id'],products_user_pure[1000000:1100000]['user_id'])","81c769e4":"#linkage_result_2 = linkage(products_user_cross, method='ward',metric='euclidean')","0a89dd1a":"# 4.Create Order-Product Table","79111d4e":"# 2. Basic Info","888cca0e":"# Product Clustering","2f3b3d61":"2-5.products","243fa65c":"2-1.aisles","2ca2cd79":"# Analyze 5 types(Vol2)","f68bca46":"# Analyze 7 Types","3d4bba7c":"2-4.orders","584ee0e4":"# Clusterring(User(5types))","79913465":"# Analyse 5 Types","5bc1a48c":"# 1.Read the Data","42e7de5d":"2-2.departments","908a62bc":"# 5. Create User-Product Table","0eef5be7":"2-3.order_products","e54d6cbc":"# 3.Create User-Order Table"}}