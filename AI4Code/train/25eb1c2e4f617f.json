{"cell_type":{"743410c6":"code","25d0c113":"code","e52944c7":"code","fa17f90e":"code","f2d988b8":"code","6a6f0edf":"code","9077d689":"code","59ea53df":"code","f4377a17":"code","abb93794":"code","e1579efa":"code","19d63fad":"code","2496f44e":"code","9fb7966e":"code","d325637e":"code","28597ba2":"code","0300b179":"code","6d5f0594":"code","a23c8d58":"code","3ea53fe2":"code","faccb48e":"code","a894c24c":"code","622edbe5":"markdown","28a2623b":"markdown","f91df184":"markdown","cf478a13":"markdown","d13ff916":"markdown","3a43413c":"markdown","8d36eff7":"markdown","a3eac824":"markdown","3f0f08f6":"markdown","15bd38fe":"markdown","994f991f":"markdown","14aab669":"markdown","c250f30f":"markdown","81f8e0ed":"markdown","b5b32140":"markdown","1b811303":"markdown","e97f20f3":"markdown","23756869":"markdown"},"source":{"743410c6":"#Import libraries\nimport numpy as np \nimport pandas as pd \n#pandasql package allows us to write SQL querry on Pandas DataFrame\nimport pandasql as psql\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\npd.set_option('display.max_columns', 100)\npd.set_option('display.width', 1000)\n\n#load data\ntract_2015 = pd.read_csv('\/kaggle\/input\/us-census-demographic-data\/acs2015_census_tract_data.csv', encoding='latin-1') #to deal with various encoding if any\ncounty_2015 = pd.read_csv('\/kaggle\/input\/us-census-demographic-data\/acs2015_county_data.csv', encoding='latin-1') #to deal with various encoding if any\n\ntract_2017 = pd.read_csv('\/kaggle\/input\/us-census-demographic-data\/acs2017_census_tract_data.csv', encoding='latin-1')\ncounty_2017 = pd.read_csv('\/kaggle\/input\/us-census-demographic-data\/acs2017_county_data.csv', encoding='latin-1')\n","25d0c113":"#county_2015.head().transpose()\n#Check the summary\ncounty_2015.describe(include = 'all')","e52944c7":"#Check the rows with missing data\nnull = psql.sqldf(\"SELECT State, County, TotalPop, Income, IncomeErr, IncomePerCap, ChildPoverty\\\n                  FROM county_2015\\\n                  WHERE Income IS NULL OR ChildPoverty IS NULL\")\nnull","fa17f90e":"psql.sqldf(\"SELECT State, County, TotalPop, Income, IncomeErr, IncomePerCap, ChildPoverty FROM tract_2015\\\n            WHERE (State = 'Hawaii' AND County = 'Kalawao') OR (State = 'Texas' AND County = 'Loving')\")","f2d988b8":"#Mean Income and IncomeErr\nMeanIncome = round(county_2015.Income.mean(), 1)\nMeanIncomeErr = round(county_2015.IncomeErr.mean(), 1)\n#Fill Missing Value in Income and IncomeErr with mean\ncounty_2015.Income = county_2015.Income.fillna(MeanIncome)\ncounty_2015.IncomeErr = county_2015.IncomeErr.fillna(MeanIncomeErr)\n\n#Fill missing value in ChildPoverty with zero\ncounty_2015.ChildPoverty = county_2015.ChildPoverty.fillna(0)\n\n#Inspect the filled values\n#psql.sqldf(\"SELECT State, County, TotalPop, Income, IncomeErr, IncomePerCap, ChildPoverty FROM county_2015\\\n#            WHERE (State = 'Hawaii' AND County = 'Kalawao') OR (State = 'Texas' AND County = 'Loving')\")","6a6f0edf":"County2015 = county_2015[['CensusId', 'State', 'County', 'TotalPop', 'Hispanic', 'IncomePerCap', 'Poverty', 'ChildPoverty', 'Employed', 'SelfEmployed', 'Unemployment']]\nCounty2015.head()","9077d689":"fig, axes = plt.subplots(nrows=2, ncols=5)\nfig.set_figheight(5)\nfig.set_figwidth(20)\n\nCounty2015.plot(ax=axes[0,0],x='TotalPop', y='Hispanic', kind = 'scatter', title = 'TotalPop vs. Hispanic Density')\nCounty2015.plot(ax=axes[0,1],x='Employed', y='IncomePerCap', kind = 'scatter', title = 'Employed vs. IncomePerCap')\nCounty2015.plot(ax=axes[0,2],x='Hispanic', y='IncomePerCap', kind = 'scatter', title = 'Hispanic Density vs. IncomePerCap')\nCounty2015.plot(ax=axes[0,3], x='IncomePerCap', y='Poverty', kind = 'scatter', title = 'IncomePerCap vs. Poverty')\nCounty2015.plot(ax=axes[0,4], x='IncomePerCap', y='ChildPoverty', kind = 'scatter', title = 'IncomePerCap vs. ChildPoverty')\nCounty2015.plot(ax=axes[1,0], x='Unemployment', y='IncomePerCap', kind = 'scatter', title = 'Unemployment vs. IncomePerCap')\nCounty2015.plot(ax=axes[1,1], x='Hispanic', y='Poverty', kind = 'scatter', title = 'Hispanic vs. Poverty')\nCounty2015.plot(ax=axes[1,2], x='Hispanic', y='ChildPoverty', kind = 'scatter', title = 'Hispanic vs. ChildPoverty')\nCounty2015.plot(ax=axes[1,3], x='Unemployment', y='Poverty', kind = 'scatter', title = 'Unemployment vs. Poverty')\nCounty2015.plot(ax=axes[1,4], x='Unemployment', y='ChildPoverty', kind = 'scatter', title = 'Unemployment vs. ChildPoverty')\n\nplt.tight_layout()","59ea53df":"#psql.sqldf(\"SELECT * FROM county_2015 WHERE TotalPop < 200000 AND IncomePerCap > 50000\")\n#psql.sqldf(\"SELECT * FROM county_2015 WHERE TotalPop > 10000000 AND IncomePerCap < 30000\")\n#psql.sqldf(\"SELECT * FROM county_2015 WHERE TotalPop < 20000 AND Poverty > 60\")","f4377a17":"#county_2017.head().transpose()\ncounty_2017.describe(include = 'all')","abb93794":"#Checking missing Data\nnull_2017 = psql.sqldf(\"SELECT State, County, TotalPop, Income, IncomeErr, Poverty, ChildPoverty\\\n                        FROM county_2017\\\n                        WHERE ChildPoverty IS NULL\")\nnull_2017","e1579efa":"#Fill missing value in ChildPoverty with zero\ncounty_2017.ChildPoverty = county_2015.ChildPoverty.fillna(0)\n\n#Drop the current County column\ncounty2017 = county_2017.copy().drop('County', axis = 1)\n\n#Join with the County column name from 2015 data\nCounty_2017 = psql.sqldf(\"SELECT * FROM county2017\\\n                        LEFT JOIN (SELECT CensusId, County FROM county_2015) as a\\\n                        ON county2017.CountyId = a.CensusId\")\n#County_2017.head()","19d63fad":"County2017 = County_2017[['CensusId', 'State', 'County', 'Hispanic', 'TotalPop', 'IncomePerCap', 'Poverty', 'ChildPoverty', 'Employed', 'SelfEmployed', 'Unemployment']]\nCounty2017.head()","2496f44e":"fig, axes = plt.subplots(nrows=2, ncols=5)\nfig.set_figheight(5)\nfig.set_figwidth(20)\n\nCounty2017.plot(ax=axes[0,0],x='TotalPop', y='Hispanic', kind = 'scatter', title = 'TotalPop vs. Hispanic Density')\nCounty2017.plot(ax=axes[0,1],x='Employed', y='IncomePerCap', kind = 'scatter', title = 'Employed vs. IncomePerCap')\nCounty2017.plot(ax=axes[0,2],x='Hispanic', y='IncomePerCap', kind = 'scatter', title = 'Hispanic Density vs. IncomePerCap')\nCounty2017.plot(ax=axes[0,3], x='IncomePerCap', y='Poverty', kind = 'scatter', title = 'IncomePerCap vs. Poverty')\nCounty2017.plot(ax=axes[0,4], x='IncomePerCap', y='ChildPoverty', kind = 'scatter', title = 'IncomePerCap vs. ChildPoverty')\nCounty2017.plot(ax=axes[1,0], x='Unemployment', y='IncomePerCap', kind = 'scatter', title = 'Unemployment vs. IncomePerCap')\nCounty2017.plot(ax=axes[1,1], x='Hispanic', y='Poverty', kind = 'scatter', title = 'Hispanic vs. Poverty')\nCounty2017.plot(ax=axes[1,2], x='Hispanic', y='ChildPoverty', kind = 'scatter', title = 'Hispanic vs. ChildPoverty')\nCounty2017.plot(ax=axes[1,3], x='Unemployment', y='Poverty', kind = 'scatter', title = 'Unemployment vs. Poverty')\nCounty2017.plot(ax=axes[1,4], x='Unemployment', y='ChildPoverty', kind = 'scatter', title = 'Unemployment vs. ChildPoverty')\n\nplt.tight_layout()","9fb7966e":"#psql.sqldf(\"SELECT * FROM county_2017 WHERE TotalPop < 200000 AND IncomePerCap > 50000\")\n#psql.sqldf(\"SELECT * FROM county_2015 WHERE TotalPop > 10000000 AND IncomePerCap < 30000\")\n#psql.sqldf(\"SELECT * FROM county_2015 WHERE TotalPop < 20000 AND Poverty > 60\")","d325637e":"County2015_17 = psql.sqldf(\"select\\\n                t1.CensusId,\\\n                t1.State,\\\n                t1.County,\\\n                t1.TotalPop AS TotalPop2015,\\\n                t1.IncomePerCap AS IncomePerCap2015,\\\n                t1.Poverty AS Poverty2015,\\\n                t1.ChildPoverty AS ChildPoverty2015,\\\n                t1.Employed AS Employed2015,\\\n                t1.SelfEmployed AS SelfEmployed,\\\n                t1.Unemployment AS Unemployment2015,\\\n                t2.TotalPop AS TotalPop2017,\\\n                t2.IncomePerCap AS IncomePerCap2017,\\\n                t2.Poverty AS Poverty2017,\\\n                t2.ChildPoverty AS ChildPoverty2017,\\\n                t2.Employed AS Employed2017,\\\n                t2.SelfEmployed AS SelfEmployed2017,\\\n                t2.Unemployment AS Unemployment2017\\\n            from\\\n                county_2015 t1\\\n                left join\\\n                County2017 t2\\\n                on t1.CensusId = t2.CensusId\")\n#County2015_17.head(10)","28597ba2":"poverty2015_17 = psql.sqldf(\"SELECT CensusId, State, County, TotalPop2015, TotalPop2017, IncomePerCap2015,Poverty2015, ChildPoverty2015, IncomePerCap2017, Poverty2017, ChildPoverty2017,\\\n            100.0 * (IncomePerCap2017 - IncomePerCap2015) \/ IncomePerCap2015 AS IncomePerCapDiff,\\\n            100.0 * (Poverty2017 - Poverty2015) \/ Poverty2015 AS PovertyDiff\\\n           FROM  County2015_17 WHERE (IncomePerCap2017 > IncomePerCap2015) AND (Poverty2017 > Poverty2015) AND (IncomePerCapDiff > 10) AND (PovertyDiff > 15) AND (Poverty2015 >= 10)\\\n           ORDER BY PovertyDiff DESC\")\npoverty2015_17['CountyState'] = poverty2015_17['County'] + ', ' + poverty2015_17['State']\npoverty2015_17","0300b179":"x1 = poverty2015_17.Poverty2015\nx2 = poverty2015_17.Poverty2017\ny = poverty2015_17.CountyState\nplt.figure(figsize=(8, 8), dpi=80)\nplt.scatter(x1, y, color='g', alpha = 0.5, label = '2015')\nplt.scatter(x2, y, color='r', alpha = 0.5, label = '2017')\n#plt.grid(color='#d3d3d3', linestyle='-', linewidth=2)\nplt.title(\"Counties with increased poverty alongside economic growth\")\nplt.xlabel('Poverty')\nplt.ylabel('')\nplt.legend(loc='upper left', bbox_to_anchor=(1.0, 0.5), frameon=False, ncol=1)\nplt.show()","6d5f0594":"#display(psql.sqldf(\"SELECT * FROM county_2015 WHERE CensusId = 51149\"))\n#psql.sqldf(\"SELECT * FROM county_2017 WHERE CountyId = 51149\")","a23c8d58":"#2015 ACS Data\n#Couties with population below 5000\nTotalPop_Below5k = psql.sqldf(\"SELECT * FROM county_2015\\\n                                WHERE TotalPop < 5000\")\n#Population between 5000-20000\nTotalPop_Below20k = psql.sqldf(\"SELECT * FROM county_2015\\\n                                WHERE TotalPop >= 5000 AND TotalPop < 20000\")\n#Population between 20,000 - 100,000\nTotalPop_Below100k = psql.sqldf(\"SELECT * FROM county_2015\\\n                                WHERE TotalPop >= 20000 AND TotalPop < 100000\")\n#Population above 100,000\nTotalPop_Above100k = psql.sqldf(\"SELECT * FROM county_2015\\\n                                WHERE TotalPop >= 100000\")\n\n#2017 Acs data\n#Couties with population below 5000\nTotalPop_Below5k_2017 = psql.sqldf(\"SELECT * FROM county_2017\\\n                                WHERE TotalPop < 5000\")\n#Population between 5000-20000\nTotalPop_Below20k_2017 = psql.sqldf(\"SELECT * FROM county_2017\\\n                                WHERE TotalPop >= 5000 AND TotalPop < 20000\")\n#Population between 20,000 - 100,000\nTotalPop_Below100k_2017 = psql.sqldf(\"SELECT * FROM county_2017\\\n                                WHERE TotalPop >= 20000 AND TotalPop < 100000\")\n#Population above 100,000\nTotalPop_Above100k_2017 = psql.sqldf(\"SELECT * FROM county_2017\\\n                                WHERE TotalPop >= 100000\")","3ea53fe2":"#Relation between professional and Percapita income in small and big counties: 2015\nfig, axes = plt.subplots(nrows=1, ncols=4)\nfig.set_figheight(4)\nfig.set_figwidth(20)\n\nTotalPop_Below5k.plot(ax=axes[0], x='Professional', y='IncomePerCap', kind = 'scatter', yticks= np.arange(0, 70000, step=5000), title = 'Counties with Population below 5,000')\nTotalPop_Below20k.plot(ax=axes[1], x='Professional', y='IncomePerCap', kind = 'scatter', yticks= np.arange(0, 70000, step=5000), title = 'Counties with Population between 5,000-20,000')\nTotalPop_Below100k.plot(ax=axes[2], x='Professional', y='IncomePerCap', kind = 'scatter', yticks= np.arange(0, 70000, step=5000), title = 'Counties with Population between 20,000-100,000')\nTotalPop_Above100k.plot(ax=axes[3], x='Professional', y='IncomePerCap', kind = 'scatter', yticks= np.arange(0, 70000, step=5000), title = 'Counties with Population above 100,000')\nplt.suptitle('Professional vs. PerCapita Income in Small and Big Counties in 2015', y= 1.1, fontsize = 15)\nplt.tight_layout()","faccb48e":"#Relation between professional and Percapita income in small and big counties: 2017\nfig, axes = plt.subplots(nrows=1, ncols=4)\nfig.set_figheight(4)\nfig.set_figwidth(20)\n\nTotalPop_Below5k_2017.plot(ax=axes[0], x='Professional', y='IncomePerCap', kind = 'scatter', yticks= np.arange(0, 70000, step=5000), title = 'Counties with Population below 5,000')\nTotalPop_Below20k_2017.plot(ax=axes[1], x='Professional', y='IncomePerCap', kind = 'scatter', yticks= np.arange(0, 70000, step=5000), title = 'Counties with Population between 5,000-20,000')\nTotalPop_Below100k_2017.plot(ax=axes[2], x='Professional', y='IncomePerCap', kind = 'scatter', yticks= np.arange(0, 70000, step=5000), title = 'Counties with Population between 20,000-100,000')\nTotalPop_Above100k_2017.plot(ax=axes[3], x='Professional', y='IncomePerCap', kind = 'scatter', yticks= np.arange(0, 70000, step=5000), title = 'Counties with Population above 100,000')\nplt.suptitle('Professional vs. PerCapita Income in Small and Big Counties in 2017', y= 1.1, fontsize = 15)\n\nplt.tight_layout()","a894c24c":"df2015 = psql.sqldf(\"SELECT State, AVG(Income) As AvgIncome, AVG(IncomePerCap) As AvgIncomePerCap, \\\n        AVG(Poverty) AS AvgPoverty, AVG(ChildPoverty) AS AvgChildPoverty FROM county_2015\\\n        group by state\")\n\npsql.sqldf(\"SELECT * FROM df2015 WHERE AvgIncome > 50000 AND AvgChildPoverty > 20\\\n          INTERSECT\\\n           SELECT * FROM df2015 ORDER BY AvgChildPoverty DESC LIMIT 20\")","622edbe5":"To better understand these two counties let's look at the Census tract data 2015. ","28a2623b":"## 2.3. Relationship between variables","f91df184":"# Small and Big Counties\nWe have small counties like Kalawao (Hawaii) and Loving (Texas) where population is below 150 and large counties like Los Angeles and Cook (Illinois) where population is above 10 million and 5 million respectively. To know whether there is any difference in relationship between variables in small and big counties, categorize the data as given:\n* Counties with population below 5,000\n* Counties with population between 5,000-20,000\n* Counties with population between 20,000-100,000\n* Countis with population above 100,000\n\nWe need to segment 2015 and 2017 datasets like this.","cf478a13":"## 2.2. Subsetting the Data\nSubset the data as we did with the 2015 County data.\n","d13ff916":"## 1.1. Missing Values\nFrom the summary we can understand that **Income**, **IncomeErr** and **ChildProperty** columns have missing values.","3a43413c":"# States with Highest Income and High Poverty Rate\nIncome and IncomePerCap are negaively correlated to poverty and and ChildPoverty. But there is states with high income as well as higher Poverty rate.","8d36eff7":"# Understanding the Data\nWe have data for each county or county equivalent in the US, including DC and Puerto Rico from the American Community Survey, 2015, which include 37 demographic features about 3220 counties in the US. The summary of the entire dataset is given. We can use these statistical details to understand the data quickly. We can use *count* to understand the number of rows with or without values in each column. standard deviation, quartiles and range (min and max) helps us to understand how the data in each column spread out. These measures also used to understand the presence of outliers (extremely low or extremely high numbers). \n","a3eac824":"# 3. Changes From 2015 to 2017\nLet\u2019s see what changes these variables have from 2015 to 2017. \n","3f0f08f6":"# Analysis on Income, Employment Status and Poverty\nWe have data from the American Community Survey (ACS) for the year 2015 and 2017. This is an analysis on the ACS datasets to identify suspicious trends in the data pattern.  \n**Note**: ACS 1-Year estimates have smaller sample size than 5-year estimates. Therefore, the margin of error will be high. \nMargin of Error is a measure of the possible variation of the estimate around the population value. At 90% confidence level, the estimates and the actual population value will differ by no more than the value of the MOE.","15bd38fe":"## 2.1. Handling Missing Values and Formatting\nWe have one missing value in the child poverty column. We fill this with 0. \n","994f991f":"# 1. Census Data For Counties - 2015","14aab669":"# Conclusion\n**Income per capita and Poverty has negative correlation**. Which means, as the Per Capita income increases Poverty and Child poverty decreases. As opposite to the trends, poverty of some counties has increased from 2015 to 2017.  \nWhen we individually inspect the other data points related to these counties we can understand that, some counties has increased employment rate and decreased the number of employed people from 2015 to 2017. This may be a reason for increase in Poverty rate. There are counties like Robertson of Kentucky where employment rate has increased and number of people employed has declined from 2015 to 2017. The individual Observation about top 5 counties has given:\n* Harding, New Mexico: Poverty increased from 10.8% to 19.8%  \nTheir population has declined 3.3%, PerCapita Income increased 34%, Unemployment rate has increased 8%.\n* Robertson, Kentucky: Poverty incresed from 22% to 30.4%  \nPopulation declined 2%, Employed increased 9%,Unemployment declined from 6.7% to 5.9% \n* Chattahoochee, Georgia: Poverty increased from 11.5% to 15%  \nPopulation decline of 6.8%, Unemployment rate decresed from 16.5% to 15.2%\n* Garza, Texas: Poverty increased from 10.4% to 13.5%  \nPopulation increased 5%, Number of people employed increased 21%, Unemployment rate has no change.\n* Prince George, Virginia:  Poverty increased from 10% to 12.3%  \nUnemployment rate declined from 10.6% to 8.5%, Number of employed has an increase of 4%\n\n\n**Professional and PerCapita Income has correlation of 0.66 in 2015 and 2017**. If we check the relation between these variables in small and big counties we can see that, as population increases, the positive correlation between Professional and IncomePercapita become more stronger. \n* **Professional vs. IncomePerCapita : 2015**  \nCounties with Population below 5,000: $R^{2}$ = 0.32  \nCounties with Population between 5,000-20,000: $R^{2}$ = 0.51  \nCounties with Population between 20,000-100,000: $R^{2}$ = 0.56  \nCounties with Population above 100,000: $R^{2}$ = 0.81  \n\n* **Professional vs. IncomePerCapita : 2017**  \nCounties with Population below 5,000: $R^{2}$ = 0.31  \nCounties with Population between 5,000-20,000: $R^{2}$ = 0.51  \nCounties with Population between 20,000-100,000: $R^{2}$ = 0.58  \nCounties with Population above 100,000: $R^{2}$ = 0.81  \n\n* **Even though District of Columbia is among the top 3 in terms of Average income and Average PerCapita Income, the state has high Child poverty rate. **\n","c250f30f":"As the census tract dataset also misses values for these counties, fill the **ChildPoverty** with 0 and **Income** and **IncomeErr** with their Mean values. ","81f8e0ed":"Its clear from the plot that, as the population increases, the positive correlation between Professional and PerCapita Income gets stronger.","b5b32140":"## 1.3. Relationship between variables\nThe plot shows how all these variables related each other\n\nWe can use this plot to understand the relation between demographic variables and find outliers. We can inspect the supected data points individually.","1b811303":"## 1.2. Subsetting the data\n\nSubset the data keeping the columns:\n* CensusId\n* State\n* County\n* TotalPop\n* Hispanic\n* IncomePerCap\n* Poverty\n* ChildPoverty\n* Employed\n* SelfEmployed\n* Unemployment\n","e97f20f3":"### Load Packages and Data\nWe need to import all the necessary python packages to analyse the data. An important component of pandasql, **sqldf** is used to run SQL on pandas dataframe.\n","23756869":"# 2. Census Data For Counties - 2017 \nWe get stats like mean, standard deviation, quartiles, minimum and maximum from the summary of data.\n"}}