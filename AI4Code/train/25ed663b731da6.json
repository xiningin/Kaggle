{"cell_type":{"acba64d3":"code","c1dc4d9a":"code","e74345a4":"code","d8a6d56d":"code","3d4e977e":"code","b1c3b7d2":"code","cb5bfe33":"code","6839c6e0":"code","7fafad6e":"code","f8eb7b1b":"code","d978f181":"code","a330df98":"code","afc23a4b":"code","e293c9cf":"code","943639d2":"code","f65debd7":"code","2b17662f":"code","63d05809":"code","6f061037":"code","260c1747":"code","a43815be":"code","2eda4d0e":"code","aabb08f6":"code","f685de1f":"code","c5954df1":"code","35b6e5c3":"code","fa51667d":"code","a72214ed":"code","90ac907d":"code","a9dc5fd4":"code","dff05ab8":"code","0aa9b549":"code","1dc1397b":"code","a0479393":"code","34d80c83":"code","225f97a7":"code","9d663e86":"code","6ba6bed7":"code","8f8846a6":"code","7a0eb1e0":"code","f3d465ed":"code","0688fed8":"code","179af703":"code","52029fd3":"code","d6e5bf7b":"code","5d72e736":"code","08ede6e7":"code","d1c140ab":"code","7e0666ff":"code","d0ce8a90":"code","3ab5b57b":"code","d802ec67":"code","e05b4774":"code","cbf96844":"code","dc7f0d10":"markdown","618bd93e":"markdown","a0bc21c4":"markdown","d78082d1":"markdown","ee2a6a81":"markdown","20ee7208":"markdown","8ec2b9ba":"markdown","0a3e50b8":"markdown","eeefb8a5":"markdown","9f3fa807":"markdown","b99147ec":"markdown","8b4b927d":"markdown","9a1a4894":"markdown","addbca71":"markdown","610dae61":"markdown","38f53473":"markdown","79f2a7ca":"markdown","07593adf":"markdown","e7eaf256":"markdown","46aacc20":"markdown","4e65cf30":"markdown","25a1157e":"markdown","ef0f3ec9":"markdown","96b0599e":"markdown","31bc1023":"markdown","fe426b9a":"markdown","d20c4809":"markdown","582ed04a":"markdown","d0103dc3":"markdown","df69b54c":"markdown","149f0eac":"markdown","be932d9c":"markdown","bd0435d3":"markdown","cfa24b19":"markdown","f8d4ca29":"markdown","b1c63b13":"markdown","f920d48b":"markdown","2382a6ae":"markdown","720eaa63":"markdown","70337504":"markdown","0d66e0d8":"markdown","cfb9f0aa":"markdown","73ab969b":"markdown","77ddc123":"markdown","20831c04":"markdown"},"source":{"acba64d3":"# Ref: https:\/\/www.kaggle.com\/sakshigoyal7\/credit-card-customers\n#      https:\/\/www.kaggle.com\/pmarcelino\/comprehensive-data-exploration-with-python\n#      https:\/\/www.statsmodels.org\/stable\/contingency_tables.html  \n#   ","c1dc4d9a":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Import graphics libraries\nimport matplotlib.pyplot as plt\nfrom statsmodels.graphics.mosaicplot import mosaic\nimport seaborn as sns\n\n# Plotly libraries\n# https:\/\/plotly.com\/python\/plotly-express\/#distributions\nimport plotly.graph_objs as go\nimport plotly.offline as py\npy.init_notebook_mode(connected=True)\nimport plotly.express as px\n\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","e74345a4":"# Display outputs of multiple commands from a cell\nfrom IPython.core.interactiveshell import InteractiveShell\nInteractiveShell.ast_node_interactivity = \"all\"\n","d8a6d56d":"# Read data\ndf = pd.read_csv(\"\/kaggle\/input\/credit-card-customers\/BankChurners.csv\")\ndf.head(3)","3d4e977e":"# Dropping column with index 0 and the last two columns\ndf = df.iloc[:, 1:-2]\ndf.head(3)","b1c3b7d2":"# For conveience let us convert all column names to smallcase:\ndf.columns = df.columns.str.lower() \ndf.columns\n","cb5bfe33":"# For convenience let us rename some long column names\n#  Copy result of above output here and amend the names\n\ndf.columns = [ 'a_flag', 'age', 'gender',\n       'dep_count', 'education', 'married',\n       'income', 'card_cat', 'months_on_book',\n       'total_relationship_count', 'months_inactive_12_mon',\n       'contacts_count_12_mon', 'credit_limit', 'total_revolving_bal',\n       'avg_open_to_buy', 'total_amt_chng_q4_q1', 'total_trans_amt',\n       'total_trans_ct', 'total_ct_chng_q4_q1', 'avg_utilization_ratio']\ndf.columns","6839c6e0":"# Pandas crosstab function \nct = pd.crosstab(\n                 index = df['gender'],      # Rows\n                 columns = df['a_flag'],    # Columns\n                 normalize = 'index'        # Row wise proportion\n                )\nct","7fafad6e":"# Draw Mosaic plot\n# In the index list, keep 'a_flag' first\n# https:\/\/www.statsmodels.org\/stable\/generated\/statsmodels.graphics.mosaicplot.mosaic.html\n_=mosaic(df, index = ['a_flag', 'gender'])","f8eb7b1b":"sns.heatmap(ct,cmap = plt.cm.coolwarm) ; ","d978f181":"# Heatmap can also be drawn in plotly express\n#  However, it is a heatmap not a mosiac plot with \n#  rectangles of difft sizes:\n\npx.density_heatmap(\n                   data_frame =df,\n                   x = 'gender',\n                   y = 'a_flag'\n                   )","a330df98":"sns.catplot(kind = 'box', x = 'a_flag', y = 'age', data = df);","afc23a4b":"\npd.crosstab(\n            index = df['income'],      # Rows\n            columns = df['a_flag'],    # Columns\n            normalize = 'index'        # Row wise proportion\n           )","e293c9cf":"# And here is a mosaic plot for the same\n\n# Decide the figure size of our plot\nfig = plt.figure(figsize = (10,10))  \nax = fig.add_subplot(111)\n\n_=mosaic(df,\n         index = ['a_flag', 'income'],\n         ax = ax, \n         statistic = True\n        )","943639d2":"pd.crosstab(\n            index = df['card_cat'],    # Rows\n            columns = df['a_flag'],    # Columns\n            normalize = 'index'        # Row wise proportion\n           )","f65debd7":"# sns relation plot\n# https:\/\/seaborn.pydata.org\/generated\/seaborn.relplot.html#seaborn.relplot\nsns.relplot( x = 'credit_limit', y = 'avg_utilization_ratio', data = df) ;","2b17662f":"sns.relplot( x = 'credit_limit', y = 'total_trans_amt', data = df ) ;","63d05809":"sns.relplot( x = 'credit_limit', y = 'total_trans_amt', data = df, hue = 'a_flag' ) ;","6f061037":"# credit limit vs income\nsns.catplot(x = 'credit_limit', y = 'income', kind = 'box', data = df);","260c1747":"# credit limit vs income vs a_flag\nsns.catplot(x = 'credit_limit', y = 'income', kind = 'box', data = df, hue = 'a_flag');","a43815be":"# Does 'age' has a relationship with 'avg_utilization_ratio'\nsns.relplot( x = 'age', y = 'avg_utilization_ratio', data = df) ;","2eda4d0e":"# Boxplot of avg_utilization_ratio conditioned by a_flag\nsns.catplot(kind = 'box', data = df, x = 'a_flag', y = 'avg_utilization_ratio') ;\n","aabb08f6":"# We can also draw a density plot of these two feature\nsns.kdeplot(data=df, x=\"avg_utilization_ratio\", hue=\"a_flag\") ;","f685de1f":"# We will draw pairplots. First of float features\n# then of integer features. This distiction by us between float and int\n# is just for conveience.\ndf_f = df.select_dtypes(include = ['float64'])\n# Add to it attrition flag also\ndf_f['a_flag'] = df['a_flag']","c5954df1":"# Pairplot now conditioned by attrition\nsns.pairplot(df_f, hue = 'a_flag') ;","35b6e5c3":"# Integer features, next\ndf_i = df.select_dtypes(include = ['int64'])\n# Add 'a_flag' also\ndf_i['a_flag'] = df['a_flag']","fa51667d":"sns.pairplot(df_i, hue = 'a_flag') ;","a72214ed":"sns.relplot(data = df,x = \"credit_limit\", y = \"avg_utilization_ratio\", col = \"card_cat\", hue = 'a_flag');","90ac907d":"sns.jointplot(x = 'avg_utilization_ratio', y = 'avg_open_to_buy', data = df, hue ='a_flag') ;","a9dc5fd4":"sns.jointplot(x = 'total_revolving_bal', y = 'total_trans_amt', data = df, hue ='a_flag') ;","dff05ab8":"sns.jointplot('total_amt_chng_q4_q1', 'total_trans_amt' , data =df , hue = 'a_flag', alpha = 0.4)","0aa9b549":"# Call the requisite libraries\nfrom sklearn.ensemble import RandomForestClassifier    # Classifier\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.model_selection import train_test_split   # Data splitter\nfrom sklearn.metrics import f1_score","1dc1397b":"# Extract a data frame with just two features + target\ndx = df[['total_amt_chng_q4_q1', 'total_trans_amt','a_flag']].copy()\ndx.head(3)\n","a0479393":"# Separate target and predictors.\ny = dx.pop('a_flag')\n# Also let us map\ny = y.map({'Existing Customer' : 0, 'Attrited Customer' : 1 })\nX = dx.values","34d80c83":"ss = StandardScaler()\nX_s = ss.fit_transform(X)","225f97a7":"# Split data into train and test\n\nX_train,X_test,y_train,t_test = train_test_split(X_s,y,test_size = 0.3)","9d663e86":"# Instantiate classifier and train it over our two-features data\nrnn = RandomForestClassifier(n_estimators= 200)\nrnn.fit(X_train,y_train)","6ba6bed7":"# Make predictions\ny_pred = rnn.predict(X_test)\n# Accuracy\nnp.sum(t_test == y_pred)\/y_pred.size    # 89%","8f8846a6":"# And f1-score\nf1_score(t_test, y_pred)    # 0.66","7a0eb1e0":"sns.jointplot('total_amt_chng_q4_q1','total_ct_chng_q4_q1', data = df, hue = 'a_flag');","f3d465ed":"# Ref: https:\/\/heartbeat.fritz.ai\/seaborn-heatmaps-13-ways-to-customize-correlation-matrix-visualizations-f1c49c816f07\nfig = plt.figure(figsize = (15,10))  # 15: width, 10: height\nax = fig.add_subplot(111)\nsns.heatmap(df.corr(), annot = True, vmin=-1, vmax=1, center= 0, cmap= 'coolwarm', ax = ax, fmt = '.1g');","0688fed8":"fig = px.box(df, x=\"education\", y=\"credit_limit\", color=\"a_flag\", notched=True) ;\nfig.show()","179af703":"# Let us process data first\n# We select only numeric data \nnum_data = df.select_dtypes(include = ['float64', 'int64']).copy()\nnum_data.head(2)\nnum_data.shape      # (10127, 14)  \nnum_data.columns","52029fd3":"#  Here is a full list of numeric columns\n#  And our dataset\n\ncols=['age', 'dep_count', 'months_on_book', 'total_relationship_count',\n       'months_inactive_12_mon', 'contacts_count_12_mon', 'credit_limit',\n       'total_revolving_bal', 'avg_open_to_buy', 'total_amt_chng_q4_q1',\n       'total_trans_amt', 'total_trans_ct', 'total_ct_chng_q4_q1',\n       'avg_utilization_ratio']\n\nnum_data = df[cols]\n","d6e5bf7b":"# We will scale all numeric data\n# Create an instance of StandardScaler object\nss= StandardScaler()\n\n# Use fit and transform method to transform all numeric data\nnc = ss.fit_transform(num_data.loc[:,cols])\n\nnc.shape     # (10127, 14)\n\n#     Transform numpy array back to pandas dataframe\n#     as we will be using pandas plotting functions\nnc = pd.DataFrame(nc, columns = cols)\nnc.head(2)","5d72e736":"# Add target column\n# And transform it to 1,0\n\nnc['a_flag'] = df['a_flag']\nnc['a_flag'] = nc.a_flag.map({\"Existing Customer\" : 0, \"Attrited Customer\" : 1})\nnc.head(2)","08ede6e7":"# Parallel coordinates with 'nc' data\nfig = plt.figure() ;\nax = pd.plotting.parallel_coordinates(nc,\n                                      'a_flag',\n                                       colormap= plt.cm.winter\n                                       ) ;\n\nplt.xticks(rotation=90) ;\nplt.title(\"Parallel chart with credit-card data\") ;\n","d1c140ab":"# Andrews plots with nc data\nfig = plt.figure();\npd.plotting.andrews_curves(nc,\n                           'a_flag',\n                            colormap = plt.cm.winter\n                           );\nplt.xticks(rotation=90);\nplt.title(\"Andrews curve with credit-card data\");\n\n","7e0666ff":"# Radviz plot\n# https:\/\/pandas.pydata.org\/docs\/reference\/api\/pandas.plotting.radviz.html\n\nfig = plt.figure();\npd.plotting.radviz(nc,\n                   class_column ='a_flag',\n                   colormap= plt.cm.winter,\n                   alpha = 0.4\n                   );","d0ce8a90":"# For the sake of compairsion, we also generate random data\n# Generate random data\nrng = np.random.default_rng()\nnc_rand = pd.DataFrame(rng.normal(size = (10127, 14)),\n                       columns = cols    # Assign column names, just like that\n                       )\n\nnc_rand['a_flag'] = df['a_flag']\nnc_rand['a_flag'] = nc_rand.a_flag.map({\"Existing Customer\" : 0, \"Attrited Customer\" : 1})\nnc_rand.head(2)","3ab5b57b":"# Parallel coordinates with random data\nfig = plt.figure() ;\nax = pd.plotting.parallel_coordinates(nc_rand,\n                                      'a_flag',\n                                      colormap= plt.cm.winter\n                                       ) ;\n\nplt.xticks(rotation=90) ;\nplt.title(\"Parallel chart with random data\") ;\n","d802ec67":"# Andrews plots with random data\nfig = plt.figure();\npd.plotting.andrews_curves(nc_rand,\n                           'a_flag',\n                            colormap = plt.cm.winter\n                           );\nplt.xticks(rotation=90);\nplt.title(\"Andrews curve with random data\");","e05b4774":"# Use t-sne to look at the structure of data\n# (t-distributed Stochastic Neighbor Embedding)\n\nfrom sklearn.manifold import TSNE\n\n# Project all data but 'a_flag' on two axis\n# Also just replace nc with nc_rand and try again\n\nX_embedded = TSNE(n_components=2).fit_transform(nc.iloc[:,:-1])\n#X_embedded.shape    # (10127, 2), numpy array\ndsne = pd.DataFrame(X_embedded, columns=['X','Y'])\n\n# Clear clusters of 1 and 0 can be seen in the plot\nsns.relplot(x = \"X\",\n            y = \"Y\",\n            hue = nc.a_flag,    # Colur each point as per 1 or 0\n            data = dsne\n            ) ;\n","cbf96844":"###### ####### --XXX -- ###### ####### ","dc7f0d10":"# Students Exercises:\nStudents may perform any one of the following four projects:\n\n1. Predicting Churn for [Bank Customers](https:\/\/www.kaggle.com\/adammaus\/predicting-churn-for-bank-customers)\n2. Understand [Housing prices data](https:\/\/www.kaggle.com\/c\/house-prices-advanced-regression-techniques\/data)\n3. Predict [Telecom churn](https:\/\/www.kaggle.com\/blastchar\/telco-customer-churn)\n4. Analyse [Supermarket sales data](https:\/\/www.kaggle.com\/aungpyaeap\/supermarket-sales) \n      \n","618bd93e":"Yes, definitely a relatioship exists between credit limit and income. What if I want to condition by *'a_flag'*?","a0bc21c4":"# Class project\nThis is a class project for students of FORE School of Management. All the students are expected to login on Kaggle during the class, understand data and its features and then ask themselves questions to discover possible relationships among features.  They draw appropriate graphs to bring out such relationships.This is their first Data Visualization project on Kaggle.","d78082d1":"## Income vs Attrition\n","ee2a6a81":"The data reveals:\n* Persons in the income group 60K--80K are most loyal\n* There is high attrition among <40K and 120K+","20ee7208":"## Parallel co-ordinates plots\nSee [here](https:\/\/en.wikipedia.org\/wiki\/Parallel_coordinates) for explanations","8ec2b9ba":"Correlation of numeric features","0a3e50b8":"## Distribution of Avg Utilization Ratio","eeefb8a5":"Obviouly age has no relationship with avg utilization ratio. It appears somewhat unintutive as those Let us now see the relationship of attrition to avg_utilization ratio.","9f3fa807":"## Age vs Avg Utilization Ratio","b99147ec":"# Relationships\n\n## Attrition vs gender\n\nCreate a contingency or crosstab table. Keep 'target' or 'dependent' variable as *columns* and independent variable as *index*","8b4b927d":"The graph displays both -ve and +ve correlations. Clearly you can see that some features are very closely correlated.","9a1a4894":"Another jointplot between 'total_revolving_bal' and 'total_trans_amt',","addbca71":"# Joint distributions\nJoint distributions of two continuous features is a scatter plot of two features with distributions of each of the feature also plotted on the margins. We will  condition such plots by 'a_flag'.","610dae61":"<a id=\"Section1\"><\/a>\n## Explore Data","38f53473":"The trend of pattern remains the same. Those with high income have higher credit limit whether they are in churn class or loyal group. Let us now look at the relationship of age vs avg_utilization_ratio","79f2a7ca":"## Radviz plot\nSee this [link](https:\/\/www.researchgate.net\/figure\/Radviz-plot-with-two-data-examples-from-the-table-Springs-are-drawn-to-illustrate-how_fig1_225719533) for how it works","07593adf":"Before we close, let us draw one last graph using plotly express to display relationship between education and credit_limt, conditioned by 'a_flag',","e7eaf256":"# Discovering structure in data\nDoes our data possess some overall structure? We will use different plots to discover existence or absence of such structures. And also see what kind of plots we get when we use random data, instead. ","46aacc20":"## A quick classification modeling","4e65cf30":"Both seaborn and plotly express can be used to draw heatmaps. Choice of colormap becomes important to make distinctions. You can try, default color map or 'cmap = plt.cm.GnBu'. For a tutorial in colormaps, please see this [link](https:\/\/matplotlib.org\/tutorials\/colors\/colormaps.html) ","25a1157e":"## Joint distribution again","ef0f3ec9":"Yes, there is a pattern. One can confidently say that no one whose *total_trans_amt* is above 12500\/- churns. Besides, there is a pattern of those churning for certain bands of *'total_trans_amt'*.<br>\nLet us now proceed with discovering relationship between *credit_limit* and *income*.","96b0599e":"There dows not appear to be any relationship here between credit limit and total_trans_amt. Does credit limit have to do something with Income? But before that, let us see if there is any relationship between a_flag, credit limit and total_trans_amt. Let us see:\n","31bc1023":"Slightly more attrition on the part of females than males. We can draw a moszic plot to display this.","fe426b9a":"Several conclusiuons can be drawn:\n* i)   *'credit_limit'* and *'avg_open_to_buy'* are strongly related\n* ii)  *'credit_limit'* has relationship with *'avg_utilization_ratio'*. *'avg_utilization_ratio'* is exponentially decresing with *'credit_limit'*\n* iii) Not exactly, but somewhat linear relatioship exists between *'total_ct_chng_q4_q1'* and *'total_amt_chng_q4_q1'*\n* iv)  Both *'total_ct_chng_q4_q1*' and *'total_amt_chng_q4_q1'* show a pattern with respect to *'a_flag'*\n*  v)  *'credit_limit'* does not appear to be related to both *'total_ct_chng_q4_q1*' and *'total_amt_chng_q4_q1'* \n","d20c4809":"## Pairplots of float features","582ed04a":"Let us drop Ist column as we will not need 'CLIENTNUM' and also the last two columns. These are not part of collected data.","d0103dc3":"The graph shows that as credit limit is increasing, avg_utilization is decreasing exponentially. But what about total transaction amount? Let us see:","df69b54c":"The cross-table reveals:\n*    People above 54 years age are not using credit cards\n*    Among those who are churning, relatively younger age people are more than older people\n","149f0eac":"<a id=\"section-two\"><\/a>\n# Questions on Relationships\nLooking at the features, here is a set of sample questions. We answer a few of them.\n\n1. Is there a relationship between age vs attrition. Are older persons more loyal?\n2. Do ladies churn less and men more or vice-versa \n3. Is there a relationship between income_category vs attrition. Maybe well-off persons churn more rapidly.\n4. Do people with higher Eduation level have higher income \n5. Do persons with higher income have higher avg card utilization \n6. What about age wise avg-card-utilization\n7. What is gender distribution in the bank\n8. Which of the features have good reltaionship with Attrition and which features are important?\n9. How is credit_limit related to various features\n10. What about credit-card type? \n","be932d9c":"## Pairplots of integer features","bd0435d3":"## Andrews plots\nSee [here](https:\/\/en.wikipedia.org\/wiki\/Andrews_plot) for how it is derived.","cfa24b19":"## Credit Limit vs Total Trans Amt","f8d4ca29":"## Plots with Random data","b1c63b13":"Surely attrition is affected by avg_utilization_ratio. We can also look at these through density plots.","f920d48b":"# t-sne plot\nFor a very good and simple explanation of how t-sne works, see [this video](https:\/\/www.youtube.com\/watch?v=NEaUSP4YerM)\n","2382a6ae":"## Credit Limit vs avg_utilization_ratio\n","720eaa63":"Most attrition remains at the borders of this plot. So a pattern is evident.","70337504":"Here again one can clearly see bands of attrition along X-axis. Let us see one last jointplot between 'total_amt_chng_q4_q1' and 'total_trans_amt' .","0d66e0d8":"In the case of churning customers, avg_utilization ratio peaks around 0.0 while in the case of loyal customers after a peak, curve is somewhat flat till 0.8 when it touches down.","cfb9f0aa":"## Age vs Attrition\n","73ab969b":"## Credit Limit vs Income","77ddc123":"## Card category vs Attrition","20831c04":"This joint plot shows a clear and very distinguishing pattern of those churning and those not. In fact just these two features should be good enough to make strong prediction of churning customers. Let us see if this is true. We will use a very simple approach of k-nearest neighbour for making prediction."}}