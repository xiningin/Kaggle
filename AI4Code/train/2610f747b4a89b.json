{"cell_type":{"93866d6e":"code","8d0fa243":"code","5a7dfd59":"code","4dca7c1b":"code","7ce2464b":"code","2b0ec323":"code","4cdbca21":"code","2bd894f3":"code","4ee16e43":"code","8188a28d":"code","f4af2496":"code","76f3094d":"code","e259d074":"code","8ba272f1":"code","f2efb051":"code","6f87c7a8":"code","204336e5":"code","40b2ce39":"code","015e9a06":"code","e24b48d6":"code","2a3d61c6":"code","e6df999b":"code","e8debeeb":"code","295c4ca5":"code","0d70775e":"code","24fc31bd":"markdown","a4027af1":"markdown","ece26355":"markdown","15117c42":"markdown","805e815c":"markdown","a45eb55b":"markdown","3a5307dc":"markdown","8ecd49cb":"markdown","eff6e803":"markdown","a3d1d66d":"markdown","9c84c599":"markdown","ac1c37f8":"markdown","2061d2ca":"markdown","acda3399":"markdown"},"source":{"93866d6e":"import pandas as pd\npd.set_option(\"display.max_columns\", None)\npd.set_option(\"display.width\", 500)\npd.set_option(\"display.expand_frame_repr\", False)","8d0fa243":"from mlxtend.frequent_patterns import apriori, association_rules","5a7dfd59":"!pip install xlrd\n!pip install openpyxl","4dca7c1b":"df_ = pd.read_excel(\"..\/input\/uci-online-retail-ii-data-set\/online_retail_II.xlsx\", sheet_name= \"Year 2010-2011\")\ndf = df_.copy()\ndf.head()","7ce2464b":"# To avoid the outliers\ndef outlier_thresholds(dataframe, variable):\n    quartile1 = dataframe[variable].quantile(0.01)\n    quartile3 = dataframe[variable].quantile(0.99)\n    interquantile_range = quartile3 - quartile1\n    up_limit = quartile3 + 1.5 * interquantile_range\n    low_limit = quartile1 - 1.5 * interquantile_range\n    return low_limit, up_limit\ndef replace_with_thresholds(dataframe, variable):\n    low_limit, up_limit = outlier_thresholds(dataframe, variable)\n    dataframe.loc[(dataframe[variable] < low_limit), variable] = low_limit\n    dataframe.loc[(dataframe[variable] > up_limit), variable] = up_limit","2b0ec323":"# Preprocessing\ndef retail_data_prep(dataframe):\n    dataframe.dropna(inplace=True)\n    dataframe = dataframe[~dataframe[\"Invoice\"].str.contains(\"C\", na=False)]\n    dataframe = dataframe[dataframe[\"Quantity\"] > 0]\n    dataframe = dataframe[dataframe[\"Price\"] > 0]\n    replace_with_thresholds(dataframe, \"Quantity\")\n    replace_with_thresholds(dataframe, \"Price\")\n    return dataframe","4cdbca21":"df_germany = df[df[\"Country\"] == \"Germany\"]","2bd894f3":"df_germany.groupby([\"Invoice\",\"Description\"]).agg({\"Quantity\":\"sum\"}).head(20)","4ee16e43":"df_germany.groupby(['Invoice', 'Description']).agg({\"Quantity\": \"sum\"}).unstack().iloc[0:5, 0:5]","8188a28d":"df_germany.groupby(['Invoice', 'Description']).agg({\"Quantity\": \"sum\"}).unstack().fillna(0).iloc[0:5, 0:5]","f4af2496":"df_germany.groupby(['Invoice', 'Description']).agg({\"Quantity\": \"sum\"}).unstack().fillna(0).applymap(lambda x: 1 if x > 0 else 0).iloc[0:5, 0:5]","76f3094d":"def create_invoice_product_df(dataframe, id=False):\n    if id:\n        return dataframe.groupby([\"Invoice\", \"StockCode\"])[\"Quantity\"].sum().unstack().fillna(0). \\\n            applymap(lambda x: 1 if x > 0 else 0)\n    else:\n        return dataframe.groupby([\"Invoice\", \"Description\"])[\"Quantity\"].sum().unstack().fillna(0). \\\n            applymap(lambda x: 1 if x > 0 else 0)","e259d074":"ger_inv_pro_df = create_invoice_product_df(df_germany)\nger_inv_pro_df = create_invoice_product_df(df_germany, id=True)","8ba272f1":"# For the find the names of id\ndef check_id(dataframe, stock_code):\n    product_name = dataframe[dataframe[\"StockCode\"] == stock_code][[\"Description\"]].values[0].tolist()\n    print(product_name)","f2efb051":"check_id(df_germany, 21987) # ['PACK OF 6 SKULL PAPER CUPS']","6f87c7a8":"check_id(df_germany, 23235) # ['STORAGE TIN VINTAGE LEAF']","204336e5":"check_id(df_germany, 22747) # [\"POPPY'S PLAYHOUSE BATHROOM\"]","40b2ce39":"frequent_itemsets = apriori(ger_inv_pro_df, min_support=0.01, use_colnames=True)\nfrequent_itemsets.sort_values(\"support\", ascending=False).head(20)","015e9a06":"rules = association_rules(frequent_itemsets, metric=\"support\", min_threshold=0.01)\nrules.sort_values(\"support\", ascending=False).head(100)","e24b48d6":"rules.sort_values(\"lift\", ascending=False).head(100)","2a3d61c6":"# Product recommendation:\ndef arl_recommender(rules_df, product_id, rec_count=1):\n    sorted_rules = rules_df.sort_values(\"lift\", ascending=False)\n    recommendation_list = []\n    for i, product in enumerate(sorted_rules[\"antecedents\"]):\n        for j in list(product):\n            if j == product_id:\n                recommendation_list.append(list(sorted_rules.iloc[i][\"consequents\"])[0])\n\n    return recommendation_list[0:rec_count]","e6df999b":"arl_recommender(rules, 21987,2) # [21086, 21989]","e8debeeb":"check_id(df_germany, 21086) # ['SET\/6 RED SPOTTY PAPER CUPS']","295c4ca5":"arl_recommender(rules, 22747,1)# [22746]","0d70775e":"check_id(df_germany, 22746) # [\"POPPY'S PLAYHOUSE LIVINGROOM \"]","24fc31bd":"# Association Rules\n\nAssociation rule mining is a methodology that is used to discover unknown relationships hidden in big data. Rules refer to a set of identified frequent itemsets that represent the uncovered relationships in the dataset. The underlying idea is to identify rules that will predict the occurence of one or more items based on the occurrences of other items in the dataset. It is an unsupervised machine learning method. This means that no direct guiding output data is given to find the patterns.\n\nIn many commercial environments large quantities of data is accumulated in databases from day-to-day operations. This lays the foundation for mining association rules. In retail, for example, customer purchase data are collected on a daily basis at the checkout counters of city stores or when shopping at online stores. The accumulated data items are often market basket transactions. Managers of stores are interested in analyzing the collected data in order to learn the purchasing behaviour of customers. This enables a large variety of business-related applications (see below) based on the identified rules in the data.\n\nBelow is one of the famous examples illustrating a rule based on a strong relationship between the sale of Diapers and the sale of Beer. In other words many customers who buy Diapers also buy Beer. Investigating the transactions below in order to find those frequent itemsets seems to be easy. But consider in real datasets millions or billions of transactions are searched across 100000 of different items that may identify 1000 of rules. This motivates the automation of the process using association rule mining algorithms. In retail these rules help to identify new opportunities and ways for cross-selling products to customers.\n\n![image.png](attachment:6ae1bfdc-4419-45d2-a498-b209ec260aef.png)\n\n\nThe example above illustrated the core idea of association rule mining based on frequent itemsets. It is a simple example since it essentially ignores other relevant attributes such as quantity of items sold, the Price, or even a specific brand of items. The mining process to discover unknown patterns in large transaction datasets is computationally expensive. A particular challenge is also the size of the millions or billions of the transaction dataset when performing mining within memory. In other words smart out-of-cpu strategies are needed to work on the big datasets as a whole in order to identify frequent itemsets. This is the case since sub-sampling of dataset items may increase the risk to overlook frequent itemset patterns.\n\nAnother challenge when performing association rule mining is that some uncovered patterns are simply not true since they have happen by chance. The latter therefore needs often manual post-processing or even application domain knowledge in order to find true rules out of the undiscovered patterns. Important is to find actionable insights from rules that can be used to change a product portfolio, store setup, or customer relations. Several configuration options are available for association rules (e.g. support, confidence) in order to provide a more clear set of rules.","a4027af1":"# Variables\n\n* InvoiceNo \u2013 Invoice Number\n\n> If this code starts with C, it means that the operation has been cancelled.\n\n* StockCode \u2013 Product code\n\n> Unique number for each product.\n\n* Description \u2013 Product name\n\n* Quantity \u2013 Number of products\n\n> It expresses how many of the products on the invoices have been sold.\n\n* InvoiceDate \u2013 Invoice date\n\n* UnitPrice \u2013 Invoice price (Sterling)\n\n* CustomerID \u2013 Unique customer number\n\n* Country \u2013 Country name","ece26355":"![image.png](attachment:ee702f43-6a1e-4730-83b6-7240540e9c45.png)","15117c42":"# TASK 4: \n\nMake a product recommendation for the users in the cart.","805e815c":"# <span style=\"font-family:cursive;\"> Thank youu:)))) <\/span>","a45eb55b":"Hellooooo, I \u2764\ufe0f VBO\n- I will explain my Association Rule Learning Recommender project in my weekly assignments in order to turn it into a contribution for you.","3a5307dc":"# TASK 2: \n\nGenerate association rules through Germany customers.","8ecd49cb":"# TASK 3: \n\nWhat are the names of the products whose IDs are given?","eff6e803":"# Project Steps","a3d1d66d":"# Association Rules Applications\n\nUnderstanding the customer purchasing behaviour by using association rule mining enables different applications. As shown above rules help to identify new opportunities and ways for cross-selling products to customers. It is used for personalised marketing promotions, smarter inventory management, product placement strategies in stores, and a better customer relationship management.","9c84c599":"# Business Problem:\n\nSuggesting products to users at the basket stage.","ac1c37f8":"# TASK 1: \n\nPerform Data Preprocessing\n\n**Important note!**\n*Select the 2010-2011 data and preprocess all the data.\nThe choice of Germany will be in the next step.*","2061d2ca":"# **Association Rule Learning Recommender**","acda3399":"# Dataset Story\n\n* The dataset named Online Retail II shows the sales of a UK-based online store between 01\/12\/2009 - 09\/12\/2011.\ncontains.\n\n* The product catalog of this company includes souvenirs. promotion\ncan be considered as products.\n\n* There is also information that most of its customers are wholesalers."}}