{"cell_type":{"5848a90e":"code","ad61219d":"code","57b9695e":"code","688ed92b":"code","c70f9d04":"code","4a95c2f7":"code","5a315df5":"code","bb0ea5d2":"code","6b63bb5c":"code","66f1ced4":"code","b24650a0":"code","9139e29c":"code","d0e1371c":"code","c8a3608b":"code","694481b3":"code","6529a963":"markdown"},"source":{"5848a90e":"# Imports\n%matplotlib inline\n%reload_ext autoreload\n%autoreload 2\nimport lightgbm as lgb\nimport xgboost as xgb\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.svm import SVC\nfrom fastai.structured import *\nfrom fastai.column_data import *\nnp.set_printoptions(threshold=50, edgeitems=20)\nfrom IPython.display import HTML, display\nimport pandas as pd\npd.set_option('display.max_rows', 500)\npd.set_option('display.max_columns', 500)\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.model_selection import KFold, cross_val_score, cross_val_predict\nfrom sklearn.metrics import accuracy_score, f1_score","ad61219d":"# Load the csv\nPATH = '..\/input\/'\ntrain_df = pd.read_csv(PATH+'train.csv')\ntest_df = pd.read_csv(PATH+'test.csv')","57b9695e":"# Classify our labels:\ncat_vars = ['hacdor',\n            'hacapo',\n            'v14a',\n            'refrig',\n            'v18q',\n            'paredblolad',\n            'paredzocalo',\n            'paredpreb',\n            'pareddes',\n            'paredmad',\n            'paredzinc',\n            'paredfibras',\n            'paredother',\n            'pisomoscer',\n            'pisocemento',\n            'pisoother',\n            'pisonatur',\n            'pisonotiene',\n            'pisomadera',\n            'techozinc',\n            'techoentrepiso',\n            'techocane',\n            'techootro',\n            'cielorazo',\n            'abastaguadentro',\n            'abastaguafuera',\n            'abastaguano',\n            'public',\n            'planpri',\n            'noelec',\n            'coopele',\n            'sanitario1',\n            'sanitario2',\n            'sanitario3',\n            'sanitario5',\n            'sanitario6',\n            'energcocinar1',\n            'energcocinar2',\n            'energcocinar3',\n            'energcocinar4',\n            'elimbasu1',\n            'elimbasu2',\n            'elimbasu3',\n            'elimbasu4',\n            'elimbasu5',\n            'elimbasu6',\n            'epared1',\n            'epared2',\n            'epared3',\n            'etecho1',\n            'etecho2',\n            'etecho3',\n            'eviv1',\n            'eviv2',\n            'eviv3',\n            'dis',\n            'male',\n            'female',\n            'estadocivil1',\n            'estadocivil2',\n            'estadocivil3',\n            'estadocivil4',\n            'estadocivil5',\n            'estadocivil6',\n            'estadocivil7',\n            'parentesco1',\n            'parentesco2',\n            'parentesco3',\n            'parentesco4',\n            'parentesco5',\n            'parentesco6',\n            'parentesco7',\n            'parentesco8',\n            'parentesco9',\n            'parentesco10',\n            'parentesco11',\n            'parentesco12',\n            'dependency',\n            'edjefe',\n            'edjefa',\n            'instlevel1',\n            'instlevel2',\n            'instlevel3',\n            'instlevel4',\n            'instlevel5',\n            'instlevel6',\n            'instlevel7',\n            'instlevel8',\n            'instlevel9',\n            'tipovivi1',\n            'tipovivi2',\n            'tipovivi3',\n            'tipovivi4',\n            'tipovivi5',\n            'computer',\n            'television',\n            'mobilephone',\n            'lugar1',\n            'lugar2',\n            'lugar3',\n            'lugar4',\n            'lugar5',\n            'lugar6',\n            'area1',\n            'area2',\n            'idhogar']\n\ncontin_vars = ['v2a1',\n               'rooms',\n               'v18q1',\n               'r4h1',\n               'r4h2',\n               'r4h3',\n               'r4m1',\n               'r4m2',\n               'r4m3',\n               'r4t1',\n               'r4t2',\n               'r4t3',\n               'tamhog',\n               'escolari',\n               'rez_esc',\n               'hhsize',\n               'hogar_nin',\n               'hogar_adul',\n               'hogar_mayor',\n               'hogar_total',\n               'meaneduc',\n               'bedrooms',\n               'overcrowding',\n               'qmobilephone',\n               'age',\n               'SQBescolari',\n               'SQBage',\n               'SQBhogar_total',\n               'SQBedjefe',\n               'SQBhogar_nin',\n               'SQBovercrowding',\n               'SQBdependency',\n               'SQBmeaned',\n               'agesq']\n\nobjective= ['Target']\n\nids = ['Id']","688ed92b":"# Apply categorical type:\nfor v in cat_vars: train_df[v] = train_df[v].astype('category').cat.as_ordered()\n\napply_cats(test_df, train_df)","c70f9d04":"# Contin_vars as floats:\nfor v in contin_vars:\n    train_df[v] = train_df[v].fillna(0).astype('float32')\n    test_df[v] = test_df[v].fillna(0).astype('float32')","4a95c2f7":"# Create new features\n# Credits to this notebook in R for the features:\n# https:\/\/www.kaggle.com\/taindow\/predicting-poverty-levels-with-r\nfor dataframe in (train_df, test_df):\n    dataframe['Rent_per_individual'] = dataframe['v2a1']\/dataframe['r4t3']\n    dataframe['Rent_per_child'] = dataframe['v2a1']\/dataframe['r4t1']\n    dataframe['Rent_per_over_65'] = dataframe['v2a1']\/dataframe['r4t3']\n    dataframe['Rent_per_room'] = dataframe['v2a1']\/dataframe['rooms']\n    dataframe['Rent_per_bedrooms'] = dataframe['v2a1']\/dataframe['bedrooms']\n    dataframe['Proportion_under_12'] = dataframe['r4t1']\/dataframe['r4t3']\n    dataframe['Proportion_under_12_male'] = dataframe['r4h1']\/dataframe['r4t3']\n    dataframe['Proportion_under_12_female'] = dataframe['r4m1']\/dataframe['r4t3']\n    dataframe['Proportion_male'] = dataframe['r4h3']\/dataframe['r4t3']\n    dataframe['Proportion_female'] = dataframe['r4m3']\/dataframe['r4t3']\n    dataframe['Rooms_per_individual'] = dataframe['rooms']\/dataframe['r4t3']\n    dataframe['Rooms_per_child'] = dataframe['rooms']\/dataframe['r4t1']\n    dataframe['Tablets_per_individual'] = dataframe['v18q1']\/dataframe['r4t3']\n    dataframe['Tablets_per_child'] = dataframe['v18q1']\/dataframe['r4t1']\n    dataframe['Years_schooling_per_individual'] = dataframe['escolari']\/dataframe['r4t3']\n    dataframe['Years_schooling_per_adult'] = dataframe['escolari']\/(dataframe['r4t3']-dataframe['r4t1'])\n    dataframe['Years_schooling_per_child'] = dataframe['escolari']\/dataframe['r4t1']\n    dataframe['Proportion_under_19'] = dataframe['hogar_nin']\/dataframe['r4t3']\n    dataframe['Proportion_over_19'] = dataframe['hogar_adul']\/dataframe['r4t3']\n    dataframe['Proportion_under_65'] = (dataframe['hogar_total']-dataframe['hogar_mayor'])\/dataframe['r4t3']\n    dataframe['Proportion_over_65'] = dataframe['hogar_mayor']\/dataframe['r4t3']\n    dataframe['Bedrooms_per_individual'] = dataframe['bedrooms']\/dataframe['r4t3']\n    dataframe['Bedrooms_per_child'] = dataframe['bedrooms']\/dataframe['r4t1']\n    dataframe['Bedrooms_per_over_65'] = dataframe['bedrooms']\/dataframe['r4t3']\n    dataframe['Extreme_conditions_flag'] = (dataframe['abastaguano'] & dataframe['noelec'] & dataframe['sanitario1'] & dataframe['energcocinar1'])\n    dataframe['bedrooms_to_rooms'] = dataframe['bedrooms']\/dataframe['rooms']\n    dataframe['tamhog_to_rooms'] = dataframe['tamhog']\/dataframe['rooms']\n    dataframe['tamhog_to_bedrooms'] = dataframe['tamhog']\/dataframe['bedrooms']\n    dataframe['r4t3_to_tamhog'] = dataframe['r4t3']\/dataframe['tamhog']\n    dataframe['hhsize_to_rooms'] = dataframe['hhsize']\/dataframe['rooms']\n    dataframe['hhsize_to_bedrooms'] = dataframe['hhsize']\/dataframe['bedrooms']\n    dataframe['rent_to_hhsize'] = dataframe['v2a1']\/dataframe['hhsize']\n    dataframe['qmobilephone_to_r4t3'] = dataframe['qmobilephone']\/dataframe['r4t3']\n    dataframe['qmobilephone_to_v18q1'] = dataframe['qmobilephone']\/dataframe['v18q1']","5a315df5":"new_features = ['Rent_per_individual',\n                'Rent_per_child',\n                'Rent_per_over_65',\n                'Rent_per_room',\n                'Rent_per_bedrooms',\n                'Proportion_under_12',\n                'Proportion_under_12_male',\n                'Proportion_under_12_female',\n                'Proportion_male',\n                'Proportion_female',\n                'Rooms_per_individual',\n                'Rooms_per_child',\n                'Tablets_per_individual',\n                'Tablets_per_child',\n                'Years_schooling_per_individual',\n                'Years_schooling_per_adult',\n                'Years_schooling_per_child',\n                'Proportion_under_19',\n                'Proportion_over_19',\n                'Proportion_under_65',\n                'Proportion_over_65',\n                'Bedrooms_per_individual',\n                'Bedrooms_per_child',\n                'Bedrooms_per_over_65',\n                'Extreme_conditions_flag',\n                'bedrooms_to_rooms',\n                'tamhog_to_rooms',\n                'tamhog_to_bedrooms',\n                'r4t3_to_tamhog',\n                'hhsize_to_rooms',\n                'hhsize_to_bedrooms',\n                'rent_to_hhsize',\n                'qmobilephone_to_r4t3',\n                'qmobilephone_to_v18q1']\n# Treat the new features as contin_vars:\nfor v in new_features:\n    train_df[v] = train_df[v].fillna(0).astype('float32')\n    test_df[v] = test_df[v].fillna(0).astype('float32')","bb0ea5d2":"# Process the training data using the awesome fastai function proc_df:\ntrain_df = train_df.set_index('Id')\ntrain_df = train_df[cat_vars+contin_vars+objective]\n\ntrain_X, train_y, nas, mapper = proc_df(train_df, 'Target', do_scale=True)","6b63bb5c":"train_X.shape,train_y.shape","66f1ced4":"# Process the testing data using the awesome fastai function proc_df:\ntest_df = test_df.set_index('Id')\n\n# Just a dummy column so that the column exists.\ntest_df['Target'] = 0\ntest_df = test_df[cat_vars+contin_vars+['Target']]\n\ntest_X, _, nas, mapper = proc_df(test_df, 'Target', do_scale=True,\n                                  mapper=mapper, na_dict=nas)","b24650a0":"train_X.shape,test_X.shape,train_y.shape","9139e29c":"%%time\nfrom catboost import CatBoostClassifier\nfrom sklearn.metrics import f1_score\n\nfrom sklearn.model_selection import train_test_split\nxtrain,xtest,ytrain,ytest = train_test_split(train_X,train_y,train_size=.85,random_state=1234)\n\n\nestimator = CatBoostClassifier(verbose=False, loss_function='MultiClass')\nestimator.fit(train_X,train_y)","d0e1371c":"# %%time\n# y_pred = estimator.predict(xtest)\n# print(f1_score(ytest, y_pred, average='macro'))","c8a3608b":"pred = estimator.predict(test_X)\nsub =  pd.read_csv(\"..\/input\/sample_submission.csv\")\nsub[\"Target\"] = pred.astype(\"int64\")\nsub.to_csv(\"catboost_sub.csv\", index=False)","694481b3":"sub.head()","6529a963":"### 0. Data Cleaning \/ Feature engineering"}}