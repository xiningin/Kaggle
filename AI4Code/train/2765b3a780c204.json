{"cell_type":{"02a144f8":"code","2968fbac":"code","2bf332d6":"code","61f329b1":"code","c85fbf16":"code","c8c0f2c0":"code","de2a646b":"code","77e92009":"code","f9b8128b":"code","c26faa36":"code","de03f577":"code","2ba50a20":"code","a94adf7a":"code","b556c9a3":"code","dfb4a65e":"code","1d29e885":"code","883acc30":"code","8c98f329":"code","f32a2875":"code","009f788b":"code","3a15fd19":"code","638dba0e":"code","78d5fa52":"code","aa820493":"code","3049207b":"code","e7af151f":"code","e216772c":"code","280fe4a9":"markdown","1bfd401a":"markdown","9f087eb4":"markdown","282abdb7":"markdown","fa55eb4c":"markdown","d4af4ea7":"markdown","59b814cd":"markdown","2bab29fb":"markdown","79b5c9a2":"markdown","0d3b6c45":"markdown","04b28b6a":"markdown","56e1d14e":"markdown","74977b1d":"markdown","f35c3f6f":"markdown","ba3e149a":"markdown","b2554203":"markdown","f2b21816":"markdown","4ec314e9":"markdown","f0d5a19b":"markdown","e0ffe74c":"markdown","ba293dbe":"markdown","532687ad":"markdown","2eaa18d2":"markdown","74e28846":"markdown","8b426e74":"markdown","eee7efab":"markdown","caa35a7b":"markdown"},"source":{"02a144f8":"import warnings\nwarnings.filterwarnings('ignore')","2968fbac":"import pandas as pd\nbl_fri = pd.read_csv(\"..\/input\/black-friday\/BlackFriday.csv\", header = 'infer')","2bf332d6":"print(bl_fri.shape)","61f329b1":"print(bl_fri.info())","c85fbf16":"bl_fri.head()","c8c0f2c0":"def missing_values_table(df):\n        # Total missing values\n        mis_val = df.isnull().sum()\n        \n        # Percentage of missing values\n        mis_val_percent = 100 * df.isnull().sum() \/ len(df)\n        \n        # Make a table with the results\n        mis_val_table = pd.concat([mis_val, mis_val_percent], axis=1)\n        \n        # Rename the columns\n        mis_val_table_ren_columns = mis_val_table.rename(\n        columns = {0 : 'Missing Values', 1 : '% of Total Values'})\n        \n        # Sort the table by percentage of missing descending\n        mis_val_table_ren_columns = mis_val_table_ren_columns[\n            mis_val_table_ren_columns.iloc[:,1] != 0].sort_values(\n        '% of Total Values', ascending=False).round(1)\n        \n        # Print some summary information\n        print (\"Your selected dataframe has \" + str(df.shape[1]) + \" columns.\\n\"      \n            \"There are \" + str(mis_val_table_ren_columns.shape[0]) +\n              \" columns that have missing values.\")\n        \n        # Return the dataframe with missing information\n        return mis_val_table_ren_columns","de2a646b":"missing_values_table(bl_fri)","77e92009":"#Replacing the NaN with 0 in columns Product_Category_3 and Product_Category_2\nbl_fri['Product_Category_2'] = bl_fri['Product_Category_2'].fillna(0)\nbl_fri['Product_Category_3'] = bl_fri['Product_Category_3'].fillna(0)","f9b8128b":"from pandasql import sqldf\npysqldf = lambda q: sqldf(q, globals())\n\ngen_q = \"\"\"\nselect Gender, count(distinct User_ID) as cnt\nFrom bl_fri\nGROUP BY Gender;\n\"\"\"\n\ngen_df = pysqldf(gen_q)","c26faa36":"import plotly.plotly as py\nimport plotly.graph_objs as go\nfrom plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot\ninit_notebook_mode(connected=True)\n\nfig = {\n  \"data\": [\n    {\n      \"values\": gen_df.cnt,\n      \"labels\": gen_df.Gender,\n      \"domain\": {\"x\": [0, .5]},\n      \"hoverinfo\":\"label+percent\",\n      \"hole\": .3,\n      \"type\": \"pie\"\n    },],\n \"layout\": {\n        \"title\":\"Gender Proportion on Black Friday\"\n    }\n}\n\niplot(fig)","de03f577":"from pandasql import sqldf\npysqldf = lambda q: sqldf(q, globals())\n\nage_q = \"\"\"\nselect Age, count(distinct User_ID) as cnt\nFrom bl_fri\nGROUP BY Age;\n\"\"\"\n\nage_df = pysqldf(age_q)","2ba50a20":"fig = {\n  \"data\": [\n    {\n      \"values\": age_df.cnt,\n      \"labels\": age_df.Age,\n      \"domain\": {\"x\": [0, .5]},\n      \"hoverinfo\":\"label+percent\",\n      \"hole\": .3,\n      \"type\": \"pie\"\n    },],\n \"layout\": {\n        \"title\":\"Age Group Proportion on Black Friday\"\n    }\n}\n\niplot(fig)","a94adf7a":"am_q = \"\"\"\nselect Age,  Marital_Status, count(distinct User_ID) as cnt\nFrom bl_fri\nGROUP BY Age,  Marital_Status;\n\"\"\"\n\nam_df = pysqldf(am_q)\n\nam_df_m = am_df[am_df.Marital_Status == 1]\nam_df_nm = am_df[am_df.Marital_Status == 0]","b556c9a3":"trace1 = go.Bar(\n                x = am_df_m.Age,\n                y = am_df_m.cnt,\n                name = \"Married\")\n\ntrace2 = go.Bar(\n                x = am_df_nm.Age,\n                y = am_df_nm.cnt,\n                name = \"Single\")\n\ndata = [trace1, trace2]\nlayout = go.Layout(barmode = \"group\", title = \"Buying volume - Marriage Vs Age\")\nfig = go.Figure(data = data, layout = layout)\niplot(fig)","dfb4a65e":"#Product Category 1\ngen_prod_1 = \"\"\"\nselect Gender, Product_Category_1, count(Product_Category_1) as cnt\nFrom bl_fri\nGROUP BY Gender, Product_Category_1;\n\"\"\"\n\ngen_prod_1_df = pysqldf(gen_prod_1)\n\ngen_prod_1_m = gen_prod_1_df[gen_prod_1_df.Gender == 'M']\ngen_prod_1_f = gen_prod_1_df[gen_prod_1_df.Gender == 'F']","1d29e885":"fig = {\n  \"data\": [\n    {\n      \"values\": gen_prod_1_m.cnt,\n      \"labels\": gen_prod_1_m.Product_Category_1,\n      \"domain\": {\"x\": [0, .48]},\n      \"name\": \"Product Category 1\",\n      \"hoverinfo\":\"label+percent+name\",\n      \"hole\": .4,\n      \"type\": \"pie\"\n    },     \n    {\n      \"values\": gen_prod_1_f.cnt,\n      \"labels\": gen_prod_1_f.Product_Category_1,\n      \"domain\": {\"x\": [.52, 1]},\n      \"name\": \"Product Category 1\",\n      \"hoverinfo\":\"label+percent+name\",\n      \"hole\": .4,\n      \"type\": \"pie\"\n    }],\n  \"layout\": {\n        \"title\":\"Product Category 1 Vs Gender\",\n        \"annotations\": [\n            {\n                \"font\": {\n                    \"size\": 20\n                },\n                \"showarrow\": False,\n                \"text\": \"Male\",\n                \"x\": 0.20,\n                \"y\": 0.5\n            },\n            {\n                \"font\": {\n                    \"size\": 20\n                },\n                \"showarrow\": False,\n                \"text\": \"Female\",\n                \"x\": 0.8,\n                \"y\": 0.5\n            }\n        ]\n    }\n}\n\niplot(fig)","883acc30":"#Product Category 2\ngen_prod_2 = \"\"\"\nselect Gender, Product_Category_2, count(Product_Category_2) as cnt\nFrom bl_fri\nwhere Product_Category_2 != 0\nGROUP BY Gender, Product_Category_2;\n\"\"\"\n\ngen_prod_2_df = pysqldf(gen_prod_2)\n\ngen_prod_2_m = gen_prod_2_df[gen_prod_2_df.Gender == 'M']\ngen_prod_2_f = gen_prod_2_df[gen_prod_2_df.Gender == 'F']","8c98f329":"fig = {\n  \"data\": [\n    {\n      \"values\": gen_prod_2_m.cnt,\n      \"labels\": gen_prod_2_m.Product_Category_2,\n      \"domain\": {\"x\": [0, .48]},\n      \"name\": \"Product Category 2\",\n      \"hoverinfo\":\"label+percent+name\",\n      \"hole\": .4,\n      \"type\": \"pie\"\n    },     \n    {\n      \"values\": gen_prod_2_f.cnt,\n      \"labels\": gen_prod_2_f.Product_Category_2,\n      \"domain\": {\"x\": [.52, 1]},\n      \"name\": \"Product Category 2\",\n      \"hoverinfo\":\"label+percent+name\",\n      \"hole\": .4,\n      \"type\": \"pie\"\n    }],\n  \"layout\": {\n        \"title\":\"Product Category 2 Vs Gender\",\n        \"annotations\": [\n            {\n                \"font\": {\n                    \"size\": 20\n                },\n                \"showarrow\": False,\n                \"text\": \"Male\",\n                \"x\": 0.20,\n                \"y\": 0.5\n            },\n            {\n                \"font\": {\n                    \"size\": 20\n                },\n                \"showarrow\": False,\n                \"text\": \"Female\",\n                \"x\": 0.8,\n                \"y\": 0.5\n            }\n        ]\n    }\n}\n\niplot(fig)","f32a2875":"#Product Category 3\ngen_prod_3 = \"\"\"\nselect Gender, Product_Category_3, count(Product_Category_3) as cnt\nFrom bl_fri\nwhere Product_Category_3 != 0\nGROUP BY Gender, Product_Category_3;\n\"\"\"\n\ngen_prod_3_df = pysqldf(gen_prod_3)\n\ngen_prod_3_m = gen_prod_3_df[gen_prod_3_df.Gender == 'M']\ngen_prod_3_f = gen_prod_3_df[gen_prod_3_df.Gender == 'F']","009f788b":"fig = {\n  \"data\": [\n    {\n      \"values\": gen_prod_3_m.cnt,\n      \"labels\": gen_prod_3_m.Product_Category_3,\n      \"domain\": {\"x\": [0, .48]},\n      \"name\": \"Product Category 3\",\n      \"hoverinfo\":\"label+percent+name\",\n      \"hole\": .4,\n      \"type\": \"pie\"\n    },     \n    {\n      \"values\": gen_prod_3_f.cnt,\n      \"labels\": gen_prod_3_f.Product_Category_3,\n      \"domain\": {\"x\": [.52, 1]},\n      \"name\": \"Product Category 3\",\n      \"hoverinfo\":\"label+percent+name\",\n      \"hole\": .4,\n      \"type\": \"pie\"\n    }],\n  \"layout\": {\n        \"title\":\"Product Category 3 Vs Gender\",\n        \"annotations\": [\n            {\n                \"font\": {\n                    \"size\": 20\n                },\n                \"showarrow\": False,\n                \"text\": \"Male\",\n                \"x\": 0.20,\n                \"y\": 0.5\n            },\n            {\n                \"font\": {\n                    \"size\": 20\n                },\n                \"showarrow\": False,\n                \"text\": \"Female\",\n                \"x\": 0.8,\n                \"y\": 0.5\n            }\n        ]\n    }\n}\n\niplot(fig)","3a15fd19":"gen_occ = \"\"\"\nselect Gender, Occupation, count(Occupation) as cnt\nFrom bl_fri\nGROUP BY Gender, Occupation;\n\"\"\"\n\ngen_occ_df = pysqldf(gen_occ)\n\ngen_occ_df_m = gen_occ_df[gen_occ_df.Gender == 'M']\ngen_occ_df_f = gen_occ_df[gen_occ_df.Gender == 'F']","638dba0e":"fig = {\n  \"data\": [\n    {\n      \"values\": gen_occ_df_m.cnt,\n      \"labels\": gen_occ_df_m.Occupation,\n      \"domain\": {\"x\": [0, .48]},\n      \"name\": \"Occupation\",\n      \"hoverinfo\":\"label+percent+name\",\n      \"hole\": .4,\n      \"type\": \"pie\"\n    },     \n    {\n      \"values\": gen_occ_df_f.cnt,\n      \"labels\": gen_occ_df_f.Occupation,\n      \"domain\": {\"x\": [.52, 1]},\n      \"name\": \"Occupation\",\n      \"hoverinfo\":\"label+percent+name\",\n      \"hole\": .4,\n      \"type\": \"pie\"\n    }],\n  \"layout\": {\n        \"title\":\"Occupation Vs Gender\",\n        \"annotations\": [\n            {\n                \"font\": {\n                    \"size\": 20\n                },\n                \"showarrow\": False,\n                \"text\": \"Male\",\n                \"x\": 0.20,\n                \"y\": 0.5\n            },\n            {\n                \"font\": {\n                    \"size\": 20\n                },\n                \"showarrow\": False,\n                \"text\": \"Female\",\n                \"x\": 0.8,\n                \"y\": 0.5\n            }\n        ]\n    }\n}\n\niplot(fig)","78d5fa52":"import numpy as np\ncity = \"\"\"\nselect distinct User_ID, City_Category, Stay_In_Current_City_Years, Age\nFrom bl_fri\nGROUP BY User_ID, City_Category, Stay_In_Current_City_Years, Age;\n\"\"\"\n\ncity_df = pysqldf(city)\n\ncity_df['Years'] = np.where(city_df['Stay_In_Current_City_Years']=='4+', '4', city_df['Stay_In_Current_City_Years'])\n\ncity_df['Years'] = city_df['Years'].astype(str).astype(int)","aa820493":"city_avg = \"\"\"\nselect City_Category, Age, round(avg(Years),2) as Avg_yrs\nFrom city_df\nGROUP BY City_Category, Age;\n\"\"\"\n\ncity_avg_df = pysqldf(city_avg)\n\ncity_avg_A_df = city_avg_df[city_avg_df.City_Category == 'A']\ncity_avg_B_df = city_avg_df[city_avg_df.City_Category == 'B']\ncity_avg_C_df = city_avg_df[city_avg_df.City_Category == 'C']","3049207b":"trace_A = go.Bar(\n                x = city_avg_A_df.Age,\n                y = city_avg_A_df.Avg_yrs,\n                name = \"City - A\")\n\ntrace_B = go.Bar(\n                x = city_avg_B_df.Age,\n                y = city_avg_B_df.Avg_yrs,\n                name = \"City - B\")\n\ntrace_C = go.Bar(\n                x = city_avg_C_df.Age,\n                y = city_avg_C_df.Avg_yrs,\n                name = \"City - C\")\n\ndata = [trace_A, trace_B, trace_C]\nlayout = go.Layout(barmode = \"group\", title = \"Average yrs of stay - City Vs Age\")\nfig = go.Figure(data = data, layout = layout)\niplot(fig)","e7af151f":"ad_dollar = \"\"\"\nselect Age, Gender, sum(Purchase) as Dollars\nFrom bl_fri\nGROUP BY Age, Gender;\n\"\"\"\n\nad_dollar_df = pysqldf(ad_dollar)\n\nad_dollar_m = ad_dollar_df[ad_dollar_df.Gender == 'M']\nad_dollar_f = ad_dollar_df[ad_dollar_df.Gender == 'F']","e216772c":"trace_M = go.Bar(\n                x = ad_dollar_m.Age,\n                y = ad_dollar_m.Dollars,\n                name = \"Male\")\n\ntrace_F = go.Bar(\n                x = ad_dollar_f.Age,\n                y = ad_dollar_f.Dollars,\n                name = \"Female\")\n\ndata = [trace_M, trace_F]\nlayout = go.Layout(barmode = \"group\", title = \"Purchase in Dollar - Age Vs Gender\")\nfig = go.Figure(data = data, layout = layout)\niplot(fig)","280fe4a9":"From the above plot its clearly evident that almost 70% of the black friday sales is between the age group of 18 - 45.","1bfd401a":"**4. Analysis Incoming**  \nWe will start the analysis from each of the columns that are available in the dataset and will point out the inferences.","9f087eb4":"**5.  Gender Proportion**","282abdb7":"**Note:**  \nKindly upvote the kernel if you find it useful. Suggestions are always welome. Let me know your thoughts in the comment if any.","fa55eb4c":"**3. Function to calculate the missing values**","d4af4ea7":"With respect to Occupation, Males top 3 category are 4, 0 and 7 where as Females top 3 category are 0, 1 and 4. The top occupation category of Male is 4 which constitiutes to 13.2% of the overall occupation categories where as the top occupation category of Female is 0 which constitiutes to 13.4% of the overall occupation categories.  \n\nFurther, the top 3 category occupation of Male occupies 37.5% of their over all occupation categories whereas the top 3 category occupation of Female occupies 39.7% of their over all occupation categories.","59b814cd":"**7. Marriage Vs Age**","2bab29fb":"**9. Occupation Vs Gender**","79b5c9a2":"# **The End! Will see you all in next Kernel!..........**","0d3b6c45":"From the above plot we can clearly say that 72% of the population who bought products on Black friday were Men and the rest 28% are female.","04b28b6a":"With respect to Product category 1, Both Male and Female have the same top 3 category [1, 5 and 8] purchases. The top purchase category of Male is Product category 1 which constitiutes to 28.1% of the overall purchase where as the top purchase category of Female is Product category 5 which constitiutes to 31.2% of the overall purchase.  \n\nFurther, the top 3 category purchase of Male occupies 74.1% of their over all purchase whereas the top 3 category purchase of Female occupies 74.6% of their over all purchase.","56e1d14e":"**10. City Vs Average years of stay in the city**","74977b1d":"From the above plot we can clearly see that Males are dominating with respect to dollar values in all the age groups. In the age group of 26-35, the dolllar value is almost 4 times bigger than the purchase of females.","f35c3f6f":"**6.  Age Proportion**","ba3e149a":"With respect to Product category 2, Males top 3 category are 8, 2 and 14 where as Females top 3 category are 14, 8 and 16. The top purchase category of Male is Product category 8 which constitiutes to 16.7% of the overall purchase where as the top purchase category of Female is Product category 14 which constitiutes to 21.5% of the overall purchase.  \n\nFurther, the top 3 category purchase of Male occupies 43.1% of their over all purchase whereas the top 3 category purchase of Female occupies 49.9% of their over all purchase.","b2554203":"**1. Reading the Olympic Dataset**","f2b21816":"**0. Global Options**","4ec314e9":"From the above plot, we can clearly see that the average years of stay for both 26-35 and 36-35 age groupss are almost the same except the little difference in City - B and C. The maximum average years of stay is on 46-50 age group with 2.21 years in City - A.","f0d5a19b":"![](https:\/\/media4.s-nbcnews.com\/i\/newscms\/2015_48\/871586\/black-friday-shoppers-tease-151123_c4900e348d71aae38b400e04421681b2.jpg)","e0ffe74c":"There is an interesting buying pattern in the above chart. From the age 18 to 45 married people tend to buy less compared to single. But, the trend gets reversed after the age to 46 as married people buy more compared to single.","ba293dbe":"# ** Hey!  It's Black Friday!!!**","532687ad":"As the missing values are both in category column, I don't want to replace these NaN with imputation. So, I am replacing all the NaN with 0 as the user didn't buy any product in that category.","2eaa18d2":"# Overview of the Dataset\nThe dataset here is a sample of the transactions made in a retail store. The store wants to know better the customer purchase behaviour against different products. Specifically, here the problem is a regression problem where we are trying to predict the dependent variable (the amount of purchase) with the help of the information contained in the other variables.\n\nClassification problem can also be settled in this dataset since several variables are categorical, and some other approaches could be \"Predicting the age of the consumer\" or even \"Predict the category of goods bought\". This dataset is also particularly convenient for clustering and maybe find different clusters of consumers within it.\n\n# Acknowledgements\nThe dataset comes from a competition hosted by Analytics Vidhya.","74e28846":"**2. Investigating the datasets**","8b426e74":"With respect to Product category 3, Males top 3 category are 16, 15 and 17 where as Females top 3 category are 16, 14 and 15. The top purchase category of Male is Product category 16 which constitiutes to 20% of the overall purchase where as the top purchase category of Female is Product category 16 which constitiutes to 18% of the overall purchase.  \n\nFurther, the top 3 category purchase of Male occupies 48.1% of their over all purchase whereas the top 3 category purchase of Female occupies 45.2% of their over all purchase.","eee7efab":"**11. Which Age group purchase the most in Dollars based on Gender**","caa35a7b":"**8. Product Category Vs Gender**\n\nI have consider each of the different values in the Product category column as categorical number as in the analytics vidhya website where the original dataset was hosted they have the description as category masked which I understand them as categorical variable.\n\nRefrence:\nhttps:\/\/datahack.analyticsvidhya.com\/contest\/black-friday\/"}}