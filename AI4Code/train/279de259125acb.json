{"cell_type":{"1f916840":"code","21bfd1d2":"code","5a4aae06":"code","2d8bbf3f":"code","a1cc012b":"code","cdcf8236":"markdown"},"source":{"1f916840":"import pandas as pd\nimport numpy as np\nimport os\n\nfrom datetime import datetime\nfrom dateutil.relativedelta import relativedelta\n\nimport matplotlib.pyplot as plt\nimport plotly\nimport seaborn as sns\nimport folium\n\nimport json","21bfd1d2":"data_sf_fire = pd.read_csv('..\/input\/sf-fire-data-incidents-violations-and-more\/fire-department-calls-for-service.csv')\ndate_columns = ['Call Date','Watch Date','Received DtTm','Entry DtTm','Dispatch DtTm',\n                'Response DtTm','On Scene DtTm','Transport DtTm','Hospital DtTm',\n                'Available DtTm']\n\nfor c in date_columns:\n    data_sf_fire[c] = pd.to_datetime(data_sf_fire[c])\n\ndata_start_date = np.max(data_sf_fire['Call Date']) - relativedelta(months=1)\ndata_sf_fire_recent = data_sf_fire[data_sf_fire['Call Date']>=data_start_date]","5a4aae06":"average_entry_time = np.mean(data_sf_fire_recent['Entry DtTm'] - data_sf_fire_recent['Received DtTm']).total_seconds()\nprint('Average time taken to enter details of an incident (in minutes):',round(average_entry_time\/60,2))\n\naverage_dispatch_time = np.mean(data_sf_fire_recent['Dispatch DtTm'] - data_sf_fire_recent['Entry DtTm']).total_seconds()\nprint('Average time taken to dispatch to the appropriate team (in minutes):',round(average_dispatch_time\/60,2))\n\naverage_response_time = np.mean(data_sf_fire_recent['Response DtTm'] - data_sf_fire_recent['Dispatch DtTm']).total_seconds()\nprint('Average time taken by the team to respond to the incident (in minutes):',round(average_response_time\/60,2))\n\naverage_on_scene_time = np.mean(data_sf_fire_recent['On Scene DtTm'] - data_sf_fire_recent['Response DtTm']).total_seconds()\nprint('Average time taken by the team to arrive on scene of the incident (in minutes):',round(average_on_scene_time\/60,2))","2d8bbf3f":"number_of_incidents_by_zipcode = data_sf_fire_recent.groupby(['Zipcode of Incident']).size().reset_index()\nnumber_of_incidents_by_zipcode.columns = ['zipcode','count']\nnumber_of_incidents_by_zipcode['zipcode'] = number_of_incidents_by_zipcode['zipcode'].astype(int)\nnumber_of_incidents_by_zipcode['zipcode'] = number_of_incidents_by_zipcode['zipcode'].astype(str)\n\npopup_dict = {'94121':[37.7802,-122.4938],\n              '94122':[37.7623,-122.4897],\n              '94116':[37.7444,-122.4842],\n              '94132':[37.7213,-122.4890],\n              '94118':[37.7810,-122.4615],\n              '94117':[37.7715,-122.4433],\n              '94114':[37.7585,-122.4364],\n              '94131':[37.7447,-122.4437],\n              '94127':[37.7365,-122.4594],\n              '94112':[37.7191,-122.4450],\n              '94123':[37.8003,-122.4368],\n              '94115':[37.7862,-122.4371],\n              '94109':[37.7913,-122.4213],\n              '94102':[37.7794,-122.4220],\n              '94103':[37.7742,-122.4107],\n              '94110':[37.7506,-122.4162],\n              '94134':[37.7186,-122.4134],\n              '94124':[37.7341,-122.3911],\n              '94107':[37.7577,-122.3963],\n              '94105':[37.7897,-122.3939],\n              '94111':[37.7957,-122.4001],\n              '94108':[37.7922,-122.4086],\n              '94133':[37.8025,-122.4107],\n              '94129':[37.7984,-122.4663],\n              '94130':[37.8231,-122.3705],\n              '94104':[37.7914,-122.4015]\n             }\n\npopup_coords = pd.DataFrame(popup_dict).T.reset_index()\npopup_coords.columns = ['zipcode','lat','lon']\n\nmap_data_set = pd.merge(number_of_incidents_by_zipcode,popup_coords,how='left')\nmap_data_set","a1cc012b":"district_geo = r'..\/input\/sf-json\/comprehensive_sf_geojson.json'\ngeo_json_data = json.load(open(district_geo))\nsf_coordinates = (37.76, -122.45)\n\nmap1 = folium.Map(location=sf_coordinates, zoom_start=12)\n\nfor i in map_data_set.index:\n    try:\n        folium.Marker(location=[map_data_set.iloc[i]['lat'],map_data_set.iloc[i]['lon']],\n                      popup='No. of incidents: {}'.format(map_data_set.iloc[i]['count'])).add_to(map1)\n    except ValueError:\n        pass\n\nfolium.Choropleth(geo_data=district_geo,\n                  legend_name = 'Number of incidents by Zipcode',\n                  data = map_data_set,\n                  columns = ['zipcode', 'count'],\n                  key_on = 'feature.properties.ZIP',\n                  fill_color = 'YlOrRd',\n                  fill_opacity = 0.7,\n                  line_opacity = 0.2,\n                  highlight = True\n               ).add_to(map1)\n\ndisplay(map1)","cdcf8236":"# SF Fire Department Incidents - Dashboard\n\nThis dashboard visualizes the number of incidents received by the San Francisco Fire Department and reports information up to one month from the last date in the dataset."}}