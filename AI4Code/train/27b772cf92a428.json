{"cell_type":{"7c32c1bb":"code","814879a0":"code","b9c893d5":"code","9d3bd9dd":"code","6b9d53ad":"code","1ff8c681":"code","407fb587":"code","0ee7c213":"code","12c971c6":"code","3ad57ec1":"code","8fb922d7":"code","9010d692":"code","d8a8b6c3":"code","766a896f":"code","3757eb78":"code","47223ba0":"code","154d6d9e":"code","095275a6":"code","858273b8":"code","b5f703e8":"code","453838f6":"code","b95425b3":"code","82078eb7":"code","f3d4ac90":"code","ae469ea4":"code","51972b76":"code","dfe82e5a":"code","e2341776":"code","c9c26949":"code","50acea85":"code","b628d64d":"code","d758601e":"code","03b3d99c":"code","448c9fe2":"code","ea6490c1":"code","567b5114":"code","4d406aff":"code","d365d3ed":"code","63b9b493":"code","23ce3029":"code","34c8b205":"code","90fd4ec0":"code","68d24067":"code","4d09187a":"code","b58208e7":"code","ea8830a5":"code","b15dadcd":"code","0fc4cd1b":"code","91badd3c":"code","901c1dfd":"code","299bc112":"code","c2479b0d":"code","b87d56d9":"code","76069f2c":"code","3b09ad87":"code","2eaa0c53":"code","1aa6ab0d":"code","774d374e":"code","ef490d58":"code","cb2b0162":"code","2b75d983":"code","e479a9c8":"code","7f797d32":"code","419af2d8":"code","25126a48":"code","9ac45234":"code","c89d0c76":"code","0074dd54":"code","57e3be0b":"code","2906c3aa":"code","2c3d7fa0":"code","6a05cfd1":"code","a5164fdd":"code","0575fc5f":"code","bcc2cdfb":"code","4d8eef2f":"code","37d6fce4":"code","53707c6d":"code","85e39ed4":"code","5d025fcc":"markdown","b70d6d40":"markdown","3ef3a14d":"markdown","94f94a06":"markdown","9961569c":"markdown","4a9f26a3":"markdown","e43981a0":"markdown","dc5bfa65":"markdown","78e8a8e5":"markdown","9734b264":"markdown","08e947bc":"markdown","1fae3c08":"markdown","ef92b161":"markdown","95951d4c":"markdown","08cc0039":"markdown","7868912c":"markdown","e021dfcf":"markdown","c6b1ddc2":"markdown","7161c8bc":"markdown","8d301513":"markdown","0ce22fe0":"markdown","267bf6bf":"markdown","3d8a7ca0":"markdown","cd7bc11b":"markdown","197202fb":"markdown","4f6a90a3":"markdown","b98dd097":"markdown","6887a14d":"markdown","192158d5":"markdown","0bda4c56":"markdown"},"source":{"7c32c1bb":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set()\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.linear_model import LinearRegression\n\nfrom sklearn.model_selection import RandomizedSearchCV\nfrom sklearn.ensemble import RandomForestRegressor","814879a0":"raw_data = pd.read_csv('..\/input\/house-prices-advanced-regression-techniques\/train.csv')\npd.set_option(\"display.max_columns\",0)\nraw_data","b9c893d5":"raw_data.shape","9d3bd9dd":"numeric = raw_data.select_dtypes({'int64','float64'}).columns\nnumeric","6b9d53ad":"categorical = raw_data.select_dtypes({'object'}).columns\ncategorical","1ff8c681":"#Number of numeric columns\nraw_data.select_dtypes({'int64','float64'}).shape[1]","407fb587":"#Number of categorical columns\nraw_data.select_dtypes({'object'}).shape[1]","0ee7c213":"raw_data['SalePrice'].describe()","12c971c6":"sns.distplot(raw_data['SalePrice'])","3ad57ec1":"raw_data['SalePrice'].skew()","8fb922d7":"raw_data['SalePrice'].kurt()","9010d692":"#correlation matrix\ncorrmat = raw_data.corr()\nplt.subplots(figsize=(10, 10))\nsns.heatmap(corrmat, square=True);","d8a8b6c3":"k = 10\nmost_correlated = corrmat.nlargest(k, 'SalePrice')['SalePrice'].index\nprint(most_correlated)","766a896f":"factors = ['SalePrice', 'OverallQual', 'GrLivArea', 'GarageCars', 'GarageArea',\n            'TotalBsmtSF', '1stFlrSF', 'FullBath', 'TotRmsAbvGrd', 'YearBuilt']","3757eb78":"#Checking for duplicate values:\ndup_data = raw_data[raw_data.duplicated()]\ndup_data.shape[0]","47223ba0":"total = pd.isnull(raw_data).sum().sort_values(ascending=False)\npercentage = ((pd.isnull(raw_data).sum() \/ pd.isnull(raw_data).count()).sort_values(ascending=False))*100\nno_values = pd.concat([total,percentage],axis = 1, keys = ['Total', 'Percent'])","154d6d9e":"no_values.head(19)","095275a6":"raw_data_without_null = raw_data.drop((no_values[no_values['Total'] > 1]).index,1)","858273b8":"raw_data_without_null = raw_data_without_null.dropna()","b5f703e8":"pd.isnull(raw_data_without_null).sum().max()","453838f6":"raw_data_without_null.shape","b95425b3":"sns.boxplot(raw_data_without_null['OverallQual'])\nq1 = raw_data_without_null['OverallQual'].quantile(.25)\nq3 = raw_data_without_null['OverallQual'].quantile(.75)\niqr = q3 - q1\nfloor = q1 - 3*iqr\ncap = q3 + 3*iqr\nprint('Floor = {}, Capping = {}'.format(floor,cap))\nraw_data_without_null = raw_data_without_null[(raw_data_without_null['OverallQual'] > floor) & (raw_data_without_null['OverallQual'] < cap)]","82078eb7":"sns.boxplot(raw_data_without_null['GrLivArea'])\nq1 = raw_data_without_null['GrLivArea'].quantile(.25)\nq3 = raw_data_without_null['GrLivArea'].quantile(.75)\niqr = q3 - q1\nfloor = q1 - 3*iqr\ncap = q3 + 3*iqr\nprint('Floor = {}, Capping = {}'.format(floor,cap))\nraw_data_without_null = raw_data_without_null[(raw_data_without_null['GrLivArea'] > floor) & (raw_data_without_null['GrLivArea'] < cap)]","f3d4ac90":"sns.boxplot(raw_data_without_null['GarageCars'])\nq1 = raw_data_without_null['GarageCars'].quantile(.25)\nq3 = raw_data_without_null['GarageCars'].quantile(.75)\niqr = q3 - q1\nfloor = q1 - 3*iqr\ncap = q3 + 3*iqr\nprint('Floor = {}, Capping = {}'.format(floor,cap))\nraw_data_without_null = raw_data_without_null[(raw_data_without_null['GarageCars'] > floor) & (raw_data_without_null['GarageCars'] < cap)]","ae469ea4":"sns.boxplot(raw_data_without_null['GarageArea'])\nq1 = raw_data_without_null['GarageArea'].quantile(.25)\nq3 = raw_data_without_null['GarageArea'].quantile(.75)\niqr = q3 - q1\nfloor = q1 - 3*iqr\ncap = q3 + 3*iqr\nprint('Floor = {}, Capping = {}'.format(floor,cap))\nraw_data_without_null = raw_data_without_null[(raw_data_without_null['GarageArea'] > floor) & (raw_data_without_null['GarageArea'] < cap)]","51972b76":"sns.boxplot(raw_data_without_null['TotalBsmtSF'])\nq1 = raw_data_without_null['TotalBsmtSF'].quantile(.25)\nq3 = raw_data_without_null['TotalBsmtSF'].quantile(.75)\niqr = q3 - q1\nfloor = q1 - 3*iqr\ncap = q3 + 3*iqr\nprint('Floor = {}, Capping = {}'.format(floor,cap))\nraw_data_without_null = raw_data_without_null[(raw_data_without_null['TotalBsmtSF'] > floor) & (raw_data_without_null['TotalBsmtSF'] < cap)]","dfe82e5a":"sns.boxplot(raw_data_without_null['1stFlrSF'])\nq1 = raw_data_without_null['1stFlrSF'].quantile(.25)\nq3 = raw_data_without_null['1stFlrSF'].quantile(.75)\niqr = q3 - q1\nfloor = q1 - 3*iqr\ncap = q3 + 3*iqr\nprint('Floor = {}, Capping = {}'.format(floor,cap))\nraw_data_without_null = raw_data_without_null[(raw_data_without_null['1stFlrSF'] > floor) & (raw_data_without_null['1stFlrSF'] < cap)]","e2341776":"sns.boxplot(raw_data_without_null['FullBath'])\nq1 = raw_data_without_null['FullBath'].quantile(.25)\nq3 = raw_data_without_null['FullBath'].quantile(.75)\niqr = q3 - q1\nfloor = q1 - 3*iqr\ncap = q3 + 3*iqr\nprint('Floor = {}, Capping = {}'.format(floor,cap))\nraw_data_without_null = raw_data_without_null[(raw_data_without_null['FullBath'] > floor) & (raw_data_without_null['FullBath'] < cap)]","c9c26949":"sns.boxplot(raw_data_without_null['TotRmsAbvGrd'])\nq1 = raw_data_without_null['TotRmsAbvGrd'].quantile(.25)\nq3 = raw_data_without_null['TotRmsAbvGrd'].quantile(.75)\niqr = q3 - q1\nfloor = q1 - 3*iqr\ncap = q3 + 3*iqr\nprint('Floor = {}, Capping = {}'.format(floor,cap))\nraw_data_without_null = raw_data_without_null[(raw_data_without_null['TotRmsAbvGrd'] > floor) & (raw_data_without_null['TotRmsAbvGrd'] < cap)]","50acea85":"sns.boxplot(raw_data_without_null['YearBuilt'])\nq1 = raw_data_without_null['YearBuilt'].quantile(.25)\nq3 = raw_data_without_null['YearBuilt'].quantile(.75)\niqr = q3 - q1\nfloor = q1 - 3*iqr\ncap = q3 + 3*iqr\nprint('Floor = {}, Capping = {}'.format(floor,cap))\nraw_data_without_null = raw_data_without_null[(raw_data_without_null['YearBuilt'] > floor) & (raw_data_without_null['YearBuilt'] < cap)]","b628d64d":"raw_data_without_null.shape","d758601e":"data_cleaned = raw_data_without_null.copy()","03b3d99c":"data_use = data_cleaned[factors].copy()","448c9fe2":"f, (ax1,ax2,ax3,ax4,ax5,ax6,ax7,ax8,ax9) = plt.subplots(1,9, sharey = True, figsize = (30,5))\nax1.scatter(data_use['OverallQual'],data_use['SalePrice'])\nax1.set_title('OverallQual and SalePrice')\n\nax2.scatter(data_use['GrLivArea'],data_use['SalePrice'])\nax2.set_title('GrLivArea and SalePrice')\n\nax3.scatter(data_use['GarageCars'],data_use['SalePrice'])\nax3.set_title('GarageCars and SalePrice')\n\nax4.scatter(data_use['GarageArea'],data_use['SalePrice'])\nax4.set_title('GarageArea and SalePrice')\n\nax5.scatter(data_use['TotalBsmtSF'],data_use['SalePrice'])\nax5.set_title('TotalBsmtSF and SalePrice')\n\nax6.scatter(data_use['1stFlrSF'],data_use['SalePrice'])\nax6.set_title('1stFlrSF and SalePrice')\n\nax7.scatter(data_use['FullBath'],data_use['SalePrice'])\nax7.set_title('FullBath and SalePrice')\n\nax8.scatter(data_use['TotRmsAbvGrd'],data_use['SalePrice'])\nax8.set_title('TotRmsAbvGrd and SalePrice')\n\nax9.scatter(data_use['YearBuilt'],data_use['SalePrice'])\nax9.set_title('YearBuilt and SalePrice')","ea6490c1":"data_use['logPrice'] = np.log(data_use['SalePrice'])","567b5114":"before = raw_data['SalePrice'].skew()\nafter = data_use['logPrice'].skew()\nprint('Skewness before : {}, Skewness after : {}'.format(before,after))","4d406aff":"sns.distplot(data_use['logPrice'])","d365d3ed":"f, (ax1,ax2,ax3,ax4,ax5,ax6,ax7,ax8,ax9) = plt.subplots(1,9, sharey = True, figsize = (30,5))\nax1.scatter(data_use['OverallQual'],data_use['logPrice'])\nax1.set_title('OverallQual and logPrice')\n\nax2.scatter(data_use['GrLivArea'],data_use['logPrice'])\nax2.set_title('GrLivArea and logPrice')\n\nax3.scatter(data_use['GarageCars'],data_use['logPrice'])\nax3.set_title('GarageCars and logPrice')\n\nax4.scatter(data_use['GarageArea'],data_use['logPrice'])\nax4.set_title('GarageArea and logPrice')\n\nax5.scatter(data_use['TotalBsmtSF'],data_use['logPrice'])\nax5.set_title('TotalBsmtSF and logPrice')\n\nax6.scatter(data_use['1stFlrSF'],data_use['logPrice'])\nax6.set_title('1stFlrSF and logPrice')\n\nax7.scatter(data_use['FullBath'],data_use['logPrice'])\nax7.set_title('FullBath and logPrice')\n\nax8.scatter(data_use['TotRmsAbvGrd'],data_use['logPrice'])\nax8.set_title('TotRmsAbvGrd and logPrice')\n\nax9.scatter(data_use['YearBuilt'],data_use['logPrice'])\nax9.set_title('YearBuilt and logPrice')","63b9b493":"location = data_cleaned[['Neighborhood','Condition1']].copy()\ndata = data_cleaned[factors]\ndata_with_cat = data.join(location)\ndata_with_cat","23ce3029":"data_with_cat['logPrice'] = np.log(data_with_cat['SalePrice'])\ndata_with_cat = data_with_cat.drop(['SalePrice'],axis=1)","34c8b205":"data_with_dummies = pd.get_dummies(data_with_cat, drop_first = True)","90fd4ec0":"cols = ['logPrice','OverallQual', 'GrLivArea', 'GarageCars', 'GarageArea',\n       'TotalBsmtSF', '1stFlrSF', 'FullBath', 'TotRmsAbvGrd', 'YearBuilt',\n        'Neighborhood_Blueste', 'Neighborhood_BrDale',\n       'Neighborhood_BrkSide', 'Neighborhood_ClearCr',\n       'Neighborhood_CollgCr', 'Neighborhood_Crawfor',\n       'Neighborhood_Edwards', 'Neighborhood_Gilbert',\n       'Neighborhood_IDOTRR', 'Neighborhood_MeadowV',\n       'Neighborhood_Mitchel', 'Neighborhood_NAmes',\n       'Neighborhood_NPkVill', 'Neighborhood_NWAmes',\n       'Neighborhood_NoRidge', 'Neighborhood_NridgHt',\n       'Neighborhood_OldTown', 'Neighborhood_SWISU',\n       'Neighborhood_Sawyer', 'Neighborhood_SawyerW',\n       'Neighborhood_Somerst', 'Neighborhood_StoneBr',\n       'Neighborhood_Timber', 'Neighborhood_Veenker', 'Condition1_Feedr',\n       'Condition1_Norm', 'Condition1_PosA', 'Condition1_PosN',\n       'Condition1_RRAe', 'Condition1_RRAn', 'Condition1_RRNe',\n       'Condition1_RRNn']","68d24067":"data_preprocessed = data_with_dummies[cols]","4d09187a":"data_preprocessed","b58208e7":"train_input = data_preprocessed.drop(['logPrice'],1)\ntrain_target = data_preprocessed['logPrice']","ea8830a5":"scaler = StandardScaler()\nscaler.fit(train_input)","b15dadcd":"train_scaled = scaler.transform(train_input)","0fc4cd1b":"df_test = pd.read_csv('..\/input\/house-prices-advanced-regression-techniques\/test.csv')","91badd3c":"df_test","901c1dfd":"#Checking for duplicate values:\ndup_data1 = df_test[df_test.duplicated()]\ndup_data1.shape[0]","299bc112":"total = pd.isnull(df_test).sum().sort_values(ascending=False)\npercentage = ((pd.isnull(df_test).sum() \/ pd.isnull(df_test).count()).sort_values(ascending=False))*100\nno_values = pd.concat([total,percentage],axis = 1, keys = ['Total', 'Percent'])","c2479b0d":"no_values.head(30)","b87d56d9":"df_test1 = df_test.drop((no_values[no_values['Total'] > 1]).index,1)","76069f2c":"df_test1.shape","3b09ad87":"factors_test = [ 'OverallQual', 'GrLivArea', 'GarageCars', 'GarageArea',\n            'TotalBsmtSF', '1stFlrSF', 'FullBath', 'TotRmsAbvGrd', 'YearBuilt']","2eaa0c53":"test_use = df_test1[factors_test].copy()","1aa6ab0d":"test_use","774d374e":"location1 = df_test1[['Neighborhood','Condition1']].copy()\ndata = df_test1[factors_test]\ndata_with_cat = data.join(location)\ndata_with_cat","ef490d58":"pd.isnull(data_with_cat).sum()","cb2b0162":"data_with_cat[['GarageArea','GarageCars','TotalBsmtSF']].describe()","2b75d983":"data_with_cat['GarageArea'].fillna(data_with_cat['GarageArea'].mean(),inplace=True)\ndata_with_cat['TotalBsmtSF'].fillna(data_with_cat['TotalBsmtSF'].mean(),inplace=True)\ndata_with_cat['GarageCars'].fillna(data_with_cat['GarageCars'].median(),inplace=True)","e479a9c8":"data_with_cat['Condition1'].fillna(data_with_cat['Condition1'].mode().values[0],inplace=True)\ndata_with_cat['Neighborhood'].fillna(data_with_cat['Neighborhood'].mode().values[0],inplace=True)","7f797d32":"pd.isnull(data_with_cat).sum().max()","419af2d8":"data_with_dummies = pd.get_dummies(data_with_cat, drop_first = True)","25126a48":"data_with_dummies","9ac45234":"test_data = data_with_dummies.copy()","c89d0c76":"scaler = StandardScaler()\nscaler.fit(test_data)","0074dd54":"test_scaled = scaler.transform(test_data)","57e3be0b":"rf_reg = RandomForestRegressor()","2906c3aa":"max_features = ['auto','sqrt','log2']\nn_estimators = [ int(x) for x in np.linspace(start=100,stop=1200,num=12)]\noob_score = ['True','False']\nmin_samples_leaf = [int(x) for x in np.linspace(start=1,stop=6,num=6)]\n","2c3d7fa0":"hyper_tune = { 'max_features' : max_features,\n               'n_estimators' : n_estimators,\n               'oob_score' : oob_score,\n               'min_samples_leaf' : min_samples_leaf\n    \n}","6a05cfd1":"rf_search = RandomizedSearchCV(estimator = rf_reg, param_distributions = hyper_tune, n_iter = 10, cv = 5, random_state = 1)","a5164fdd":"rf_search.fit(train_scaled,train_target)","0575fc5f":"rf_search.best_params_","bcc2cdfb":"rf_search.best_score_","4d8eef2f":"rf_search.best_estimator_","37d6fce4":"test_pred = rf_search.predict(test_scaled)","53707c6d":"output = pd.DataFrame({'ID' : df_test.Id, 'SalePrice' : np.exp(test_pred)})","85e39ed4":"output.to_csv('submission.csv',index=False)","5d025fcc":"# Random Forest Regression","b70d6d40":"Now coming to homoscedasticity, we already implemented the log transformation which is the best fix for heteroscedasticity. Thus, we don't need any other fix or tansformation.","3ef3a14d":"Our dataset is almost ready, but before we dive into modelling and predictions let's include the dummy variables for categorical data that we haven't used till now. At the initial stage we included location as a factor determinig the SalePrice of a house.  I'll add the 'Neighborhood' and 'Condition1' columns and create dummy variables.","94f94a06":"Kurtosis : The measure of outliers. Leptokurtic (positive kurtosis) implies that our dataset has heavy outliers","9961569c":"The data consists of 1460 rows and 81 columns","4a9f26a3":"Going by the definition, positve skewness implies that more number of houses are being sold for price less than the average value.","e43981a0":"# Preparing our test data","dc5bfa65":"To my knowledge and the variables present in the dataset. I classify the variables into 4 categories which one looks upon while deciding a house to buy.\n1. SIZE\/AREA - LotArea, TotalBsmntSF, Bedroom, GrLivArea\n2. LOCATION - Neighborhood, Condition1 ( Proximity to main road )\n3. BUILT - YearBuilt\n4. QUALITY - OverallQual","78e8a8e5":"I'll be using the box and whisker plot method to detect the outliers.\n1. I used the flooring and capping techique to mark the boundary.\n2. I used the outer boundary to remove the confirmed outliers and not the suspected outliers. If you wish you can try removing the suspected outliers as well.","9734b264":"Now we could have removed these single missing values but the output submission file requires all the rows. Thus, we will treat these values with appropriate method.","08e947bc":"1. Linearity - Check using scatter plots\n2. No Endogeneity\n3. Homoscedasticity\n4. No autocorrelation","1fae3c08":"Instead of treating all the missing values, we can just treat the values which are required in the test dataset. ","ef92b161":"Let's read our data into raw_data as a dataset and examine the contents and shape ","95951d4c":"As we saw above there was skewness in the SalePrice, which can be treated using the logarithmic transformation. Let's verify the skewness before and after the transformation.","08cc0039":"Autocorrelation needs to checked when the data is a time series. Observations here are not coming from a time series or a panel data. These are just the snapshot of current situation, where it's different for each customer.","7868912c":"The minimum price isn't negative. Thus, one less thing to worry.","e021dfcf":"For other columns, it's upto you how you treat your data. If you have expertise in the concerned field, you could treat the missing values accordingly, else (my case here): None of these columns have a strong correlation with SalePrice. Thus, could remove the entire column.\nAlso, for the 'Electrical' column we can just remove the row containing missing value, as only a single value is missing.","c6b1ddc2":"# Step 3 : Checking conditions for Linear Model","7161c8bc":"# Step 1 : Analysing 'SalePrice'","8d301513":"Before we dive into exploring datasets and deploying ML algorithms, it would be nice to look into the SalePrice variable as it's the reason of our quest.","0ce22fe0":"Looking at the heatmap, the factors having a strong correlation with SalePrice I could see are : OverallQual, GrLivArea, GarageCars, GarageArea. We should also consider mild correlated factors which could be : YearBuilt, 1stFlrSF, TotalBsmntSF.\nAnyways, let's just take the top 10 factors depending upon the correlation with SalePrice.","267bf6bf":"# Step 2 : Data Cleaning","3d8a7ca0":"Best way to check the correlation between parameters is i guess, HeatMap. Let's check whether our intuition about factors affecting SalePrice is correct or does it differs in actual.","cd7bc11b":"If not perfectly linear, we are still able to see some improvement in linearity after applying log transformation.","197202fb":"See, by mere applying the log transformation the skewness got reduced to near 0 i.e. close to Normally Distributed Graph. Also, let's check the density plot for same.","4f6a90a3":"OUTLIER DETECTION","b98dd097":"# Intuitive parameters affecting SalePrice","6887a14d":"Looking from the about scatter plots some factors need to be treated for linearity before applying the regression model.\n1. OverallQual\n2. GarageArea\n3. TotalBsmtSF\n4. 1stFlrSF\n5. YearBuilt","192158d5":"Thus, we dont have any duplicate value in the data set.","0bda4c56":"It seems that the data for columns with more than 15% null values i.e. PoolQC, MiscFeatur, Alley, Fence, FireplaceQu, LotFrontage is missing a lot. Trying to replace these values by mean\/median\/mode would definitely mean changing the distribution of the dataset. For example if we try to replace the missing values by mean value, it would imply that we have deviated the dataset toward mean."}}