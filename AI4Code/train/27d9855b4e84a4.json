{"cell_type":{"0f2d6020":"code","be1ee8d2":"code","fd823d0a":"code","a85e12cd":"code","2207d450":"code","841e5e88":"code","39633204":"code","a4d2e55e":"code","b15f72f1":"code","185d0d20":"code","56383abc":"code","1a8910b7":"code","0af42cec":"code","d52b39b2":"code","18cfd5c8":"code","19440c3b":"code","2931b1b8":"code","a7a31ab5":"code","d5dfa738":"code","9b6b245d":"code","6addd498":"code","be1d50d4":"code","84dd5e9a":"code","79f81b15":"code","ce197dde":"code","076cd774":"code","a05b7596":"code","7c1c96df":"code","223aac81":"code","f1db6862":"code","002c9ce9":"code","7b936d60":"code","2847313e":"code","48467dfe":"code","c0b88658":"code","83fbb3ec":"code","52d11ba1":"code","e0ba49d9":"code","9e4faa04":"code","92171e0f":"code","456ba7fd":"code","a32da01d":"code","8563da77":"code","dca852d9":"code","edf5a67a":"code","323913e5":"code","21c1b54c":"code","209a1b0d":"code","cfe28435":"code","eea1560f":"code","a88fdadd":"code","2932a5d9":"markdown","de0c42ec":"markdown","48f6c207":"markdown","28c52848":"markdown","89f28180":"markdown","539ff29c":"markdown"},"source":{"0f2d6020":"#import the necessary modules\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport scipy.stats as ss\nimport folium as fl\nfrom folium.plugins import HeatMap\nfrom folium.plugins import PolyLineTextPath\n\n%matplotlib inline\nsns.set(rc = {'figure.figsize': (20,8)}, style = 'whitegrid', palette = 'Set2')","be1ee8d2":"# load airbnb dataset\ndf = pd.read_csv('..\/input\/new-york-city-airbnb-open-data\/AB_NYC_2019.csv')\ndf.head()","fd823d0a":"df.shape","a85e12cd":"# explore the 'calculated_host_listings_count' column\ndf.loc[(df['host_name'] == 'John') & (df['host_id'] == 2787)]\n\n## indicates that how many different housings\/options do each host have available","2207d450":"# explore the categories for 'neighbourhood_group'\ndf.neighbourhood_group.value_counts()","841e5e88":"# explore the categories for 'neighbourhood'\ndf.neighbourhood.value_counts()","39633204":"# explore the categories for 'room_type'\ndf.room_type.value_counts()","a4d2e55e":"# remove the first two columns for now as it is not needed\ndf.drop(columns = ['id', 'name'], axis = 1, inplace = True)\ndf.rename(columns = {\n    'calculated_host_listings_count': 'host_listings_count',\n    'number_of_reviews': 'reviews_count'\n}, inplace = True)\ndf.head()","b15f72f1":"# check for duplicate rows\ndf.duplicated().value_counts()\n\n## no duplicate rows","185d0d20":"df.info()","56383abc":"# convert the date field\ndf['last_review'] = pd.to_datetime(df['last_review'], format = '%Y-%m-%d')\ndf.info()","1a8910b7":"#inspect the summary of numerical columns\ndf.describe().round(2)\n\n##need to look further into max of 'minimum_nights' and min of 'availability_365'","0af42cec":"#check for null values\ndf.isna().sum()","d52b39b2":"# check if we can impute the missing host_name values from their other listings\ndf.loc[df['host_id'].isin(df[df['host_name'].isna()].host_id)]\n\n## seems like those who have multiple listings, still have the host_name missing for those too. We assume its for privacy. 'host_id' column can be used instead for identification","18cfd5c8":"# drop 'host_name' column as we can use 'host_id' for identification\/uniqueness\n\ndf.drop(columns = 'host_name', axis = 1, inplace = True)","19440c3b":"# investigate on null values for 'last_review' & 'reviews_per_month'\ndf[(df['last_review'].isna()) | (df['reviews_per_month'].isna())]\n\n## we can see that the rows that have null for 'last_review', also has null for 'reviews_per_month'","2931b1b8":"# check if all these entries have 0 reviews\ndf[(df['last_review'].isna()) | (df['reviews_per_month'].isna())].reviews_count.value_counts()\n\n## reason for having NA, is because these listings never got a single review yet","a7a31ab5":"# for NA 'reviews_per_month', we can impute it with '0' as these listings didnt get any reviews yet\ndf.reviews_per_month.fillna(value = 0, inplace = True)","d5dfa738":"df.last_review.min()","9b6b245d":"df.last_review.max()","6addd498":"# to deal with NA in 'last_review', we change the column to a categorical variable (by year), and those that have NA will be categorised as 'Never', as they did not get any reviews yet\ndf.last_review = df.last_review.dt.year.astype('object')\ndf.last_review.fillna(value = 'Never', inplace = True)","be1d50d4":"# check 'last_review' categories\ndf.last_review.value_counts()","84dd5e9a":"# confirm all null values are dealt with\ndf.isna().sum()","79f81b15":"df.head()","ce197dde":"df.describe()\n## need to look further into max of 'minimum_nights' and min of 'availability_365'","076cd774":"df.availability_365.value_counts()\n## 0 days availability can possibly refer to the listing not being available at the moment, so we can keep this data","a05b7596":"#check values for 'minimum_nights'\ndf.minimum_nights.value_counts()","7c1c96df":"plt.figure(figsize = (25, 8))\nsns.boxplot(df['minimum_nights'])\n\n## can see some extreme outliers","223aac81":"#check how many listings have minimum nights set to more than a year\ndf.loc[df['minimum_nights'] > 365]","f1db6862":"# Given that having minimum nights as more than 365 days is extremely rare and could be invalid at times as well, we can remove them. Furthermore, its only a few entries, so it should not affect our data.\n# Therefore, we will only consider listings that have minimum nights set to a year or less.\ndf = df.loc[df['minimum_nights'] <= 365]\n\n# resetting the count for listings, as a few rows were removed\ndf['host_listings_count'] = df.groupby('host_id')['host_id'].transform('count')\n# rest index as well\ndf.reset_index(inplace = True)","002c9ce9":"# extreme outliers have been removed, while the moderate outliers are kept, as they are valid but uncommon cases\nplt.figure(figsize = (30, 8))\nsns.boxplot(df['minimum_nights'])","7b936d60":"# now things look better\ndf.describe().round(2)","2847313e":"df.minimum_nights.value_counts().sort_values(ascending = False).head(10)","48467dfe":"# create a new column, for categorising the minimum nights\n\nmin_night_type = []\n\nfor row in range(len(df)):\n    if df.minimum_nights[row] <= 5:\n        min_night_type.append('1-5 days')\n    elif df.minimum_nights[row] <= 14:\n        min_night_type.append('1-2 weeks')\n    elif df.minimum_nights[row] <= 90:\n        min_night_type.append('1-3 months')\n    elif df.minimum_nights[row] <= 180:\n        min_night_type.append('4-6 months')\n    else:\n        min_night_type.append('7-12 months')   ","c0b88658":"# add this column to the dataframe\ndf['min_night_type'] = min_night_type\n\ndf.head()","83fbb3ec":"# get correlation matrix for numerical columns\ndf_corr = df[['price', 'minimum_nights', 'reviews_count', 'reviews_per_month', 'host_listings_count', 'availability_365']].corr()\n\n# draw heatmap\nsns.heatmap(df_corr, annot = True, annot_kws = {'size': 15}, square = True, cmap = 'YlGnBu')\n\n## from this observation, we can conclude that most of the numerical features do not really have strong correlations with each other directly, apart from review count & rate.","52d11ba1":"df.head()","e0ba49d9":"# create function so that it can be reused as a base for map\n# visualize the amount of listing clusters in NYC\n\ndef draw_map():\n    nyc = [df.latitude.mean(), df.longitude.mean()]\n    boroughs = df.groupby('neighbourhood_group').mean().reset_index()\n    boroughs_name = boroughs['neighbourhood_group'].values.tolist()\n    boroughs_loc = boroughs[['latitude', 'longitude']].values.tolist()\n\n    base_map = fl.Map(location = nyc, control_scale = True, zoom_start = 11, tiles = 'OpenStreetMap')\n\n    for i in range(len(boroughs_name)):\n        attr = {'fill': 'midnightblue', 'font-weight': 'bold', 'font-size': '20'}\n        pl = fl.PolyLine([[boroughs_loc[i][0], boroughs_loc[i][1]-.1], [boroughs_loc[i][0], boroughs_loc[i][1]+.1]], weight = 15, color = 'rgb(255,255,255, 0)')\n        base_map.add_child(pl)\n        base_map.add_child(PolyLineTextPath(pl, text = boroughs_name[i], attributes = attr, center = True))\n    \n    return base_map\n\nbase_map = draw_map()    \nbase_map.add_child(HeatMap(data = df[['latitude', 'longitude']], min_opacity = 0.2, radius = 15, blur = 40))\nbase_map.add_child(fl.ClickForMarker(popup='High amount of listings'))\n\n## Manhattan and Brooklyn have the most amount of listing options available","9e4faa04":"# view the cluster of room types available\n# folium visual map is not used as the cluster colours blend, preventing from differentiating the room types\n\nplt.figure(figsize = (30, 15))\nsns.scatterplot(x = 'longitude', y = 'latitude', data = df, hue = 'room_type', size = 'price', sizes = (50, 200), style = 'room_type')\n\n## There are very few shared rooms available compared to private rooms & entire homes","92171e0f":"# check if 'review_counts' have many outliers\nsns.boxplot(x = 'neighbourhood_group', y = 'reviews_count', data = df)\n\n## has many outliers","456ba7fd":"# since 'review_counts' have many outliers, we should use median instead of mean as the measure of central tendency.\n\ntop_listings = df.groupby('neighbourhood_group').median().sort_values(by = 'reviews_count', ascending = False).reset_index()\ntop10_listings = df.groupby(['neighbourhood_group', 'neighbourhood']).median().sort_values(by = 'reviews_count', ascending = False).reset_index().head(10)\n\nfig, axis = plt.subplots(1, 2, figsize = (25, 8), squeeze = True)\nfig.tight_layout(pad = 5)\nsns.barplot(x = 'reviews_count', y = 'neighbourhood', data = top10_listings, orient = 'h', ci = False, hue = 'neighbourhood_group', dodge = False, ax = axis[0], estimator = np.median).set(title = 'Top rented listings according to neighbourhood')\nsns.barplot(x = 'neighbourhood_group', y = 'reviews_count', data = top_listings, ci = False, dodge = False, ax = axis[1]).set(title = 'Average number of customers that hosts get in each borough')\nplt.show()\n\n## From the below observations, we can conclude that hosts in Staten Island are the most busy, in terms of getting customers\n## Silver Lake, Eltingville and Richmondtown seems to be the top 3 hotspots for hosts to get many customers","a32da01d":"# Investigate which hosts in Manhattan & Brooklyn have the most customers as they have the highest amount of listing options\n\ntop_listings = df.loc[(df.neighbourhood_group == 'Manhattan') | (df.neighbourhood_group == 'Brooklyn')].groupby('neighbourhood_group').median().sort_values(by = 'reviews_count', ascending = False).reset_index()\ntop10_listings = df.loc[(df.neighbourhood_group == 'Manhattan') | (df.neighbourhood_group == 'Brooklyn')].groupby(['neighbourhood_group', 'neighbourhood']).median().sort_values(by = 'reviews_count', ascending = False).reset_index().head(10)\n\nfig, axis = plt.subplots(1, 2, figsize = (25, 8), squeeze = True)\nfig.tight_layout(pad = 5)\nsns.barplot(x = 'reviews_count', y = 'neighbourhood', data = top10_listings, orient = 'h', ci = False, hue = 'neighbourhood_group', dodge = False, ax = axis[0], estimator = np.median).set(title = 'Top rented listings according to neighbourhood')\nsns.barplot(x = 'neighbourhood_group', y = 'reviews_count', data = top_listings, ci = False, dodge = False, ax = axis[1]).set(title = 'Average number of customers that hosts get in each borough')\nplt.show()\n\n# Brooklyn hosts tops this one, with Manhattan Beach, Dyker Heights & Bergen Beach being the common locations","8563da77":"# inspect the price differences for each borough\navg_roomtype_cost = df.groupby('room_type').price.median()\ntop_price = df.groupby(['neighbourhood_group', 'room_type']).median().sort_values(by = 'price', ascending = False).reset_index()\n\ng = sns.catplot(x = 'neighbourhood_group', y = 'price', data = top_price, ci = False, estimator = np.median, kind = 'point', col = 'room_type')\n\nfor i in range(len(avg_roomtype_cost)):\n    g.axes[0][i].axhline(avg_roomtype_cost[i], color = 'midnightblue')\n\nplt.show()\n\n# as we can see, Manhattan has the most expensive listing offers for all room_types\n# on the other hand, Staten Island has the cheapest listings. This further reinforces the previous observations we made as to why each Staten Island hosts get alot of customers.","dca852d9":"# aggregate to view and compare the listings count with reviews count. View rental rate as well.\nhost_count = df.groupby('neighbourhood_group').count().sort_values('index', ascending = False).reset_index()[['neighbourhood_group', 'index']].rename(columns = {'index': 'listings_count'})\ncustomer_count = df.groupby('neighbourhood_group').sum().sort_values('reviews_count', ascending = False).reset_index()[['neighbourhood_group', 'reviews_count']]\nborough_data = host_count.merge(customer_count, left_on = 'neighbourhood_group', right_on = 'neighbourhood_group', how = 'left')\nborough_data['rental_rate'] = (borough_data.reviews_count \/ borough_data.listings_count).round(2)\nborough_data","edf5a67a":"# visualise the comparison for listings and reviews\nfig, axis = plt.subplots(1, 3, figsize = (25, 8), squeeze = True)\nfig.tight_layout(pad = 10)\n\nsns.barplot(x = 'listings_count', y = 'neighbourhood_group', data = borough_data, orient = 'h', ci = False, estimator = np.median, ax = axis[0]).set(title = 'Amount of listings')\nsns.barplot(x = 'reviews_count', y = 'neighbourhood_group', data = borough_data, orient = 'h', ci = False, estimator = np.median, ax = axis[1]).set(title = 'Amount of rentals')\nsns.barplot(x = 'rental_rate', y = 'neighbourhood_group', data = borough_data, orient = 'h', ci = False, estimator = np.median, ax = axis[2]).set(title = 'Rental Rate')\nplt.show()\n\n## As seen earlier, Manhattan & Brooklyn has more listings, but as we look at the rental rate. In average, Staten Island & Queens hosts are able to secure customers at a better rate compared to the other boroughs.","323913e5":"# inspect the availability of listings according to each borough and room type\n\nsns.catplot(x = 'neighbourhood_group', y = 'availability_365', data = df.loc[df.availability_365 > 0], ci = False, estimator = np.median, kind = 'boxen', col = 'room_type')\n\n## For private rooms, most Staten Island listings have them available throughout the whole year compared to the other boroughs.\n## Entire homes in NYC are generally not available for the whole year, and more towards the 6 months mark.\n## For shared rooms, Brooklyn & Queens have them available through out most of the year, while Staten Island and Bronx have them for only a couple months in a year.","21c1b54c":"# inspect the minimum nights for listings in terms of room type and borough\n# consider those that are 30 days or less, since higher is more uncommon in general\nsns.catplot(x = 'neighbourhood_group', y = 'minimum_nights', data = df.loc[df.minimum_nights <= 30], ci = False, estimator = np.median, kind = 'strip', col = 'room_type')\n\n## Staten Island listings tend to have very low minimum night requirements, which means that many vistors do not have to stay for long.","209a1b0d":"# view the trend for reviews per month against price. Ignore rates above 30 as they could potentially be invalid.\n\nsns.scatterplot(x = 'reviews_per_month', y = 'price', data = df.loc[(df.reviews_count > 0) & (df.reviews_per_month <= 30)].sort_values('reviews_count', ascending = False))\n\n# exponential trend where extreme high prices have a very low review rate while lower prices have a variety of rates.","cfe28435":"# inspect the review rate for each room type in the different boroughs\n\nsns.catplot(x = 'room_type', y = 'reviews_per_month', data = df.loc[(df.reviews_count > 0) & (df.reviews_per_month <= 30)].sort_values('reviews_count', ascending = False), ci = False, estimator = np.median, kind = 'boxen', col = 'neighbourhood_group')\n\n## Althoough Manhattan has alot of private rooms & entire homes available, many people tend to opt for the shared rooms.\n## Entire homes seem to be the go to option for most visitors in Staten Island and Bronx.","eea1560f":"# get the list for each group and using sampling for private rooms, to ensure equal sample size\nshared_rooms = df.loc[df.room_type == 'Shared room']['reviews_per_month'].values.tolist()\nprivate_rooms = df.loc[df.room_type == 'Private room'].sample(len(shared_rooms), replace = False, random_state = 1)['reviews_per_month'].values.tolist()\n\n# view the distribution for each group\nsns.distplot(shared_rooms)\nsns.distplot(private_rooms)\nplt.xlabel('Reviews per Month')\nplt.legend(['Shared Room', 'Private Room'])\n\nplt.show()\n\n## we can see that both groups have a right skewed distribution, so we can proceed with the test","a88fdadd":"# create general function to get the result for Mann Whitney U Test\ndef mann_whitney_u_test(d1, d2):\n    u_stat, p_val = ss.mannwhitneyu(d1, d2)\n    return u_stat, f'{p_val:.20f}'\n\nmann_whitney_u_test(shared_rooms, private_rooms)\n\n## we can see that the p-value is around 0.108, which is higher than our significance level. So we FAIL to reject the null hypothesis","2932a5d9":"### Hypothesis Test for Significance (Mann Whitney U Test)\n\nSince the reviews_per_month does not have a gaussian distribution, we will use the 'Mann Whitney U Test' which is the nonparametric equivalent of the 'Two Sample t-test', and we can therefore focus on the medians of the two groups rather than the mean.\n\n<b>Is there a significant difference between reviews_per_month for hosts of 'shared rooms' and 'private rooms'?<\/b>\n> H<sub>0<\/sub>: There is no significant difference between the medians of the two groups\n\n> H<sub>a<\/sub>: There is a significant difference between the medians of the two groups\n\n> Significance Level, \u03b1 = 0.05","de0c42ec":"### 1. Data Load & Exploration","48f6c207":"# <font color = 'teal'>Airbnb New York Analysis (2011 - 2019)<\/font>\n\nThis dataset contains information about Airbnb host listings, neighbourhoods, price, minimum nights, review counts\/rate and the availability throughout the year.\n\nLimitations: No data on customer stay duration, timeline, review score for each listing and no. of tourist attractions nearby.\n\nAnalysis by: Ahmad Abu Saiid\n\n---\n\n## Acknowledgements\n> Dataset taken from [Kaggle](https:\/\/www.kaggle.com\/dgomonov\/new-york-city-airbnb-open-data).\n> This is a <b>public dataset of Airbnb<\/b>, and the original source can be found in their website.\n\n\n## Main Insights\n<b>1. Which areas have the most listings and customers?<\/b>\n> Manhattan and Brooklyn\n\n<b>2. Which type of room is the most\/least common in NYC?<\/b>\n> Private rooms and Entire homes are the most common listings while Shared rooms are much less.\n\n<b>3. What is the average cost for each room type and which area is the most expensive\/cheap?<\/b>\n> a) Entire homes normally cost around 160 dollars\n\n> b) Private rooms cost around 70 dollars\n\n> c) Shared rooms cost around 45 dollars\n\n> Manhattan has the most expensive listings while Staten Island has the cheapest listings.\n\n<b>4. Which areas have the busiest hosts and why?<\/b>\n> Although Manhattan and Brooklyn have the most listings & customers, Staten Island has the busiest hosts, particularly in Silver Lake, Eltingville and Richmondtown. This is due to less competition, very low costs compared to other boroughs and less minimum night requirements which drives more customers. \n\n<b>5. Which area has the best\/worst rental rate?<\/b>\n> Lowest rental rate is in Manhattan (21), while best rental rate is at Staten Island (31)\n\n<b>6. Between Manhattan and Brooklyn, which area is doing better?<\/b>\n> Brooklyn hosts receive more customers, most notably in Manhattan Beach, Dyker Heights & Bergen Beach.\n\n<b>7. How is the availability of each room type and borough in general?<\/b>\n> a) For private rooms, most Staten Island listings have them available throughout the whole year compared to the other boroughs.\n\n> b) Entire homes in NYC are generally not available for the whole year, and more towards the 6 months mark.\n\n> c) For shared rooms, Brooklyn & Queens have them available through out most of the year, while Staten Island and Bronx have them for only a couple months in a year.\n\n<b>8. Is there any particular difference in minimum nights for each borough?<\/b>\n> Staten Island listings tend to have very low minimum night requirements, which means that many vistors do not have to stay for long.\n\n<b>9. How is the review rate for hosts for each room type and area?<\/b>\n> a) Althoough Manhattan has alot of private rooms & entire homes available, many people tend to opt for the shared rooms, possibly due to lower cost and travelling alone.\n\n> b) Entire homes seem to be the go to option for most visitors in Staten Island and Bronx.\n\n<b>10. Is there a significant difference between reviews_per_month for hosts of 'shared rooms' and 'private rooms'?<\/b>\n> There is no significant difference for reviews_per_month between hosts of 'shared rooms' and 'private rooms' (with a 95% confidence)\n\n\n---","28c52848":"### 2. Data Cleaning & Processing","89f28180":"### End of Analysis","539ff29c":"### 3. Data Engineering & Exploratory Data Analysis (EDA)"}}