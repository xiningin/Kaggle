{"cell_type":{"80158660":"code","26a6fc72":"code","0f2f24f8":"code","6235c4fe":"code","068876f0":"code","e528ad15":"code","6dabe284":"code","62ed2549":"code","60161e62":"code","bccb7525":"code","38ce98b8":"code","d1c64b34":"code","10c1fa72":"code","b815d1a0":"code","77122beb":"code","6f5b8d20":"code","2bf63d96":"code","78a8ad47":"code","2c7f8bfd":"code","39f08705":"code","e3e58c4f":"code","884dea8b":"code","77baf52d":"code","fc571f91":"code","631193d3":"code","badc62be":"code","64d6e491":"code","23b87d33":"code","c346bfb7":"code","e6bb10d5":"code","39932767":"code","543d758f":"code","ba3c034c":"code","e9a7f15e":"code","f4ebc424":"code","567e46d5":"code","6e1a204f":"code","977307de":"code","b9a19518":"code","45188dac":"code","ab7be9dc":"markdown","01ec73dc":"markdown","d3e920b2":"markdown","77183483":"markdown","c3b4d76b":"markdown","a6dc3e81":"markdown","4d1017fe":"markdown","6595b750":"markdown","4152d54b":"markdown","19cc6971":"markdown","c3a446ea":"markdown","7fb63158":"markdown","d58eef17":"markdown","cb394a94":"markdown","e2ffe28a":"markdown","d23812a1":"markdown","f6c8c61f":"markdown","0b54e400":"markdown","da28aef3":"markdown","e22f97b7":"markdown","1dc1ae81":"markdown","de4fe9ea":"markdown","4a8be381":"markdown","a0bf2791":"markdown","9834e4d4":"markdown","47dbf842":"markdown","9d2f51b8":"markdown","b1439e97":"markdown","f9ba46c2":"markdown","e156bedc":"markdown","56caf12b":"markdown","8a5a0f53":"markdown","f7b2bd54":"markdown","98aaf330":"markdown","5f4e65c0":"markdown"},"source":{"80158660":"''' This project is to predict whether a patient has ckd or not.'''","26a6fc72":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport plotly.express as px\nimport warnings\nwarnings.filterwarnings(\"ignore\")\nfrom sklearn.metrics import confusion_matrix,accuracy_score\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","0f2f24f8":"df = pd.read_csv('\/kaggle\/input\/ckdisease\/kidney_disease.csv')","6235c4fe":"### Run this to Profile data\n\nimport pandas_profiling as pp\n\nprofile = pp.ProfileReport(    df, title=\"Chronic Kidney Disease Profile\", html={\"style\": {\"full_width\": True}}, sort=None)\nprofile","068876f0":"columns=pd.read_csv('..\/input\/ckd-input\/data_description.txt',sep='-')\ncolumns=columns.reset_index()\ncolumns.columns=['cols','abb_col_names']\ndf.columns=columns['abb_col_names'].values\n","e528ad15":"df.info()","6dabe284":"features=['red blood cell count','packed cell volume','white blood cell count']\ndef convert_dtype(df,feature):\n    df[feature] = pd.to_numeric(df[feature], errors='coerce')\n    \nfor feature in features:\n    convert_dtype(df,feature)\n    \ndf.dtypes","62ed2549":"df.drop([\"id\"],axis=1,inplace=True) ","60161e62":"cat_col=[col for col in df.columns if df[col].dtype=='object']\nfor col in cat_col:\n    print('{} has {} values '.format(col,df[col].unique()))\n    print('\\n')","bccb7525":"#Replace incorrect values\n\ndf['diabetes mellitus'].replace(to_replace = {'\\tno':'no','\\tyes':'yes',' yes':'yes'},inplace=True)\n\ndf['coronary artery disease'] = df['coronary artery disease'].replace(to_replace = '\\tno', value='no')\n\ndf['class'] = df['class'].replace(to_replace = 'ckd\\t', value = 'ckd')\n\n\n\nfor col in cat_col:\n    print('{} has {} values  '.format(col, df[col].unique()))\n    print('\\n')","38ce98b8":"data=df.copy()","d1c64b34":"data[cat_col].isnull().sum()","10c1fa72":"def Random_value_imputation(feature):\n    random_sample=data[feature].dropna().sample(data[feature].isnull().sum())               \n    random_sample.index=data[data[feature].isnull()].index\n    data.loc[data[feature].isnull(),feature]=random_sample\n\nRandom_value_imputation('pus cell')\nRandom_value_imputation('red blood cells')\ndata[cat_col].isnull().sum()","b815d1a0":"def mode_imputation(feature):\n    mode=data[feature].mode()[0]\n    data[feature]=data[feature].fillna(mode)\n    \nfor col in cat_col:\n    mode_imputation(col)\n    \ndata[cat_col].isnull().sum()","77122beb":"num_col=[col for col in df.columns if df[col].dtype!='object']\ndata[num_col].isnull().sum()","6f5b8d20":"for col in num_col:\n    Random_value_imputation(col)\n    \ndata[num_col].isnull().sum()","2bf63d96":"sns.countplot(x='class',data=data)\nplt.xlabel(\"class\")\nplt.ylabel(\"Count\")\nplt.title(\"target Class\")","78a8ad47":"plt.figure(figsize=(30,20))\nfor i,feature in enumerate(num_col):\n    plt.subplot(5,3,i+1)\n    data[feature].hist()\n    plt.title(feature)","2c7f8bfd":"plt.figure(figsize=(20,20))\nfor i,feature in enumerate(cat_col):\n    plt.subplot(4,3,i+1)\n    sns.countplot(data[feature])\n    ","39f08705":"plt.figure(figsize=(10,8))\ncorr_df = data.corr()\nsns.heatmap(corr_df,annot=True)","e3e58c4f":"data.groupby(['red blood cells','class'])['red blood cell count'].agg(['count','mean','median','min','max'])","884dea8b":"px.violin(data,y='red blood cell count',x=\"class\", color=\"class\")","77baf52d":"px.scatter(df,'haemoglobin','packed cell volume')","fc571f91":"grid=sns.FacetGrid(df, hue=\"class\",aspect=2)\ngrid.map(sns.kdeplot, 'red blood cell count')\ngrid.add_legend()","631193d3":"def violin(col):\n    fig = px.violin(data, y=col, x=\"class\", color=\"class\", box=True)\n    return fig.show()\n\ndef scatters(col1,col2):\n    fig = px.scatter(data, x=col1, y=col2, color=\"class\")\n    return fig.show()\n\ndef kde_plot(feature):\n    grid = sns.FacetGrid(data, hue=\"class\",aspect=2)\n    grid.map(sns.kdeplot, feature)\n    grid.add_legend()","badc62be":"kde_plot('red blood cell count')","64d6e491":"kde_plot('haemoglobin')","23b87d33":"scatters('red blood cell count', 'packed cell volume')","c346bfb7":"scatters('red blood cell count', 'haemoglobin')","e6bb10d5":"scatters('haemoglobin','packed cell volume')","39932767":"violin('red blood cell count')","543d758f":"violin('packed cell volume')","ba3c034c":"scatters('red blood cell count','albumin')","e9a7f15e":"scatters('packed cell volume','blood urea')","f4ebc424":"fig = px.bar(data, x=\"specific gravity\", y=\"packed cell volume\",\n             color='class', barmode='group',\n             height=400)\nfig.show()\n\n   ","567e46d5":"for col in cat_col:\n    print('{} categories in the column- {} '.format(data[col].nunique(), col))\n    ","6e1a204f":"from sklearn.preprocessing import LabelEncoder\nle= LabelEncoder()\nfor col in cat_col:\n    data[col]=le.fit_transform(data[col])\n    \ndata.head()","977307de":"from sklearn.feature_selection import SelectKBest #Also known as Information Gain\nfrom sklearn.feature_selection import chi2\n\nind_col=[col for col in data.columns if col!='class']\ndep_col='class'\n\nx=data[ind_col]\ny=data[dep_col] \n\nordered_rank_features=SelectKBest(score_func=chi2,k=20)\nordered_feature=ordered_rank_features.fit(x,y)\n\ndatascores=pd.DataFrame(ordered_feature.scores_,columns=[\"Score\"])\n\ndfcolumns=pd.DataFrame(x.columns)\n\nfeatures_rank=pd.concat([dfcolumns,datascores],axis=1)\n\nfeatures_rank.columns=['Features','Score']\n\n# features_rank.nlargest(10,'Score')  --->  fetch largest 10 values of Score column   \n\nselected_columns=features_rank.nlargest(10,'Score')['Features'].values\nX_new=data[selected_columns]\nX_new","b9a19518":"from sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(X_new, y, train_size=0.7, random_state=123)\n\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.svm import SVC\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.neural_network import MLPClassifier\nfrom sklearn.ensemble import RandomForestClassifier\nfrom xgboost import XGBClassifier\nfrom catboost import CatBoostClassifier\nimport lightgbm\nimport xgboost\nfrom sklearn.ensemble import GradientBoostingClassifier\nfrom sklearn.naive_bayes import GaussianNB\nfrom sklearn.neighbors import KNeighborsClassifier\n\nnames = [\n    \"CatBoostClassifier\",\n    \"Support Vector Machine\",\n    \"Decision Tree\",\n    \"Neural Network\",\n    \"Random Forest\",\n    \"XGBoost\",\n    \"LGBMClassifier\",\n    \"XGBRFClassifier\",\n    \"GradientBoosting\",\n    \"GaussianNB\",\n    \"KNeighborsClassifier\"\n]\nmodels = [\n    CatBoostClassifier(verbose= False),\n    SVC(),\n    DecisionTreeClassifier(),\n    MLPClassifier(),\n    RandomForestClassifier(),\n    XGBClassifier(),\n    lightgbm.LGBMClassifier(max_depth=2, random_state=4),\n    xgboost.XGBRFClassifier(max_depth=3, random_state=1),\n    GradientBoostingClassifier(max_depth=2, random_state=1),\n    GaussianNB(),\n    KNeighborsClassifier(n_neighbors=5, p=2, metric='minkowski')\n]\n\naccuracy=[]","45188dac":"for model, name in zip(models,names):\n    model.fit(X_train, y_train)\n    \n    y_pred = model.predict(X_test)\n    print('Confusion matrix of ',name)\n    print(confusion_matrix(y_test, y_pred))\n    ac = accuracy_score(y_test, y_pred)\n    print('Accuracy score is ',ac)\n    accuracy.append(ac)\n    print('='*50)\n\nAccuracy_list = pd.DataFrame(list(zip(names, accuracy)),columns =['Model', 'Accuracy'])\nAccuracy_list= Accuracy_list.sort_values('Accuracy', axis=0, ascending=False, inplace=False, kind='quicksort', na_position='last', ignore_index=True, key=None)\n\nplt.rcParams['figure.figsize']=20,6 \nsns.set_style(\"darkgrid\")\nax = sns.barplot(x = 'Model',y = 'Accuracy',data = Accuracy_list , palette = \"rocket\", saturation =1.5)\nplt.xlabel(\"Model\", fontsize = 20 )\nplt.ylabel(\"Accuracy\", fontsize = 20)\nplt.title(\"Sorted Accuracy of different Models\", fontsize = 20)\nplt.xticks(fontsize = 11, horizontalalignment = 'center', rotation = 8)\nplt.yticks(fontsize = 13)\nfor p in ax.patches:\n    width, height = p.get_width(), p.get_height()\n    x, y = p.get_xy() \n    ax.annotate(f'{height:.2%}', (x + width\/2, y + height*1.02), ha='center', fontsize = 'x-large')\nplt.show()","ab7be9dc":"## c. Drop the id column","01ec73dc":" Clearly, specific gravity >=1.02 affects non ckd","d3e920b2":"### Importing the Dataset","77183483":"### Categorical features using Random value Imputation & Mode imputation","c3b4d76b":"    Observations:\n        1.age looks a bit left skewed\n        2.Blood gluscose random is right skewed\n        3.Blood Urea is also a bit right skewed\n        4.Rest of the features are lightly skewed","a6dc3e81":"### analysing distribution of 'red_blood_cell_count' in both Labels ","4d1017fe":"    Clearly, albumin levels of above 0 affect ckd largely","6595b750":"    Packed cell volume >= 40 largely affects to be non ckd","4152d54b":"## b. Correcting datatype of the columns","19cc6971":"### Numerical features using Random value Imputation","c3a446ea":"###  Label distribution for Numerical data","7fb63158":"# About Data\n\nChronic kidney disease is the Longstanding disease of the kidneys leading to renal failure.\n\nThe kidneys filter waste and excess fluid from the blood. As kidneys fail, waste builds up.\nSymptoms develop slowly and aren't specific to the disease. Some people have no symptoms at all and are diagnosed by a lab test.\nMedication helps manage symptoms. In later stages, filtering the blood with a machine (dialysis) or a transplant may be required\n\nSource : https:\/\/www.kaggle.com\/mansoordaku\/ckdisease \n\n### Attribute Information:\n\nWe use 24  medical features + 1 class = 25 ( 11 numeric ,14 nominal)\n\n1.Age(numerical)\nage in years\n\n2.Blood Pressure(numerical)\nbp in mm\/Hg\n\n3.Specific Gravity(nominal)\nsg - (1.005,1.010,1.015,1.020,1.025)\n\n4.Albumin(nominal)\nal - (0,1,2,3,4,5)\n\n5.Sugar(nominal)\nsu - (0,1,2,3,4,5)\n\n6.Red Blood Cells(nominal)\nrbc - (normal,abnormal)\n\n7.Pus Cell (nominal)\npc - (normal,abnormal)\n\n8.Pus Cell clumps(nominal)\npcc - (present,notpresent)\n\n9.Bacteria(nominal)\nba - (present,notpresent)\n\n10.Blood Glucose Random(numerical)\nbgr in mgs\/dl\n\n11.Blood Urea(numerical)\nbu in mgs\/dl\n\n12.Serum Creatinine(numerical)\nsc in mgs\/dl\n\n13.Sodium(numerical)\nsod in mEq\/L\n\n14.Potassium(numerical)\npot in mEq\/L\n\n15.Hemoglobin(numerical)\nhemo in gms\n\n16.Packed Cell Volume(numerical)\n\n17.White Blood Cell Count(numerical)\nwc in cells\/cumm\n\n18.Red Blood Cell Count(numerical)\nrc in millions\/cmm\n\n19.Hypertension(nominal)\nhtn - (yes,no)\n\n20.Diabetes Mellitus(nominal)\ndm - (yes,no)\n\n21.Coronary Artery Disease(nominal)\ncad - (yes,no)\n\n22.Appetite(nominal)\nappet - (good,poor)\n\n23.Pedal Edema(nominal)\npe - (yes,no)\n\n24.Anemia(nominal)\nane - (yes,no)\n\n25.Class (nominal)\nclass - (ckd,notckd)\n\n","d58eef17":"    Both distributions are quite different, distribution CKD is quite normal and evenly distributed but not CKD distribution is a little bit left-skewed but quite close to a normal distribution","cb394a94":"    A few features has imbalanced categories. Stratified folds will be necessary while cross validation.","e2ffe28a":"    Positive Correlation:\n    Specific gravity -> Red blood cell count, Packed cell volume and Hemoglobin\n    Sugar -> Blood glucose random\n    Blood Urea -> Serum creatinine\n    Hemoglobin -> Red Blood cell count <- packed cell volume\n    \n    Negative Correlation:\n    Albumin, Blood urea -> Red blood cell count, packed cell volume, Hemoglobin\n    Serum creatinine -> Sodium","d23812a1":"###  label distribution for Class data","f6c8c61f":"## e. Assigning random values to missing(NaN) Values","0b54e400":"### Let's check for Positive correlation and its impact on classes\u00b6","da28aef3":"# 3. Data Visualization","e22f97b7":" # Please let me know in the comments what improvements can be done ","1dc1ae81":"# 6. Model","de4fe9ea":"## d. Cleaning Categorical Columns\n","4a8be381":"# **Import Libraries**","a0bf2791":"### Correlations","9834e4d4":"#### as we have just 2 categories in each feature then we can consider Label Encoder as it will not cause Curse of Dimensionality","47dbf842":"#### Random_value_imputation for \"red blood cells\" & \"pus cell\"\n","9d2f51b8":"# 4. Feature Encoding \/ Label Encoder","b1439e97":"###  Label distribution for Categorical data","f9ba46c2":"### Defining violin and scatter plot & kde_plot functions","e156bedc":"chi2-Internally this class is going to check that whether p-value is less than 0.05 or not based on that,it will order all the features","56caf12b":"###  Now let's check for negative correlation and its impact on classes\n\n    Albumin, Blood urea -> Red blood cell count, packed cell volume, Haemoglobin","8a5a0f53":"#### mode_imputation for all other categorical features","f7b2bd54":"    1.RBC count range ~2 to <4.5 and Hemoglobin between 3 to <13 are mostly classified as positive for chronic kidney  \n    disease(i.e ckd).\n    2.RBC count range >4.5 to ~6.1 and Hemoglobin between >13 to 17.8 are classified as negative for chronic kidney \n    disease(i.e nockd).","98aaf330":"# 2 Data Cleaning\n\n## a. Renaming the columns in the data to their expanded form","5f4e65c0":"# 5. Feature Selection"}}