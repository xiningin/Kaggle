{"cell_type":{"c3256d5e":"code","4f24b341":"code","67273f5e":"code","7f8b322b":"code","844deaa6":"code","fa551e53":"code","d805b7aa":"code","7b24fb69":"code","509d4fb6":"code","277fc9c6":"code","5e18a253":"code","e2bffd6d":"code","9c594d55":"code","ced7f2b3":"code","9a10a6fb":"code","d88f0c9c":"code","fb3ab583":"code","0fb11b05":"code","be8ed3a8":"markdown","76d1f273":"markdown","cb3dec50":"markdown","bd95e48d":"markdown"},"source":{"c3256d5e":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\nimport plotly.graph_objs as go\nimport plotly.offline as py\n\n#Ignore warnings\nimport warnings\nwarnings.filterwarnings('ignore')\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","4f24b341":"df = pd.read_csv(\"..\/input\/jokes-dataset\/jokes_dataset.csv\")\ndf.head()","67273f5e":"#Fourth row, first column  (text)\n\ndf.iloc[3,0]","7f8b322b":"import nltk\nimport spacy\nimport re\nfrom spacy import displacy\nfrom PIL import Image\nimport matplotlib.pyplot as plt\nimport tensorflow as tf\nimport plotly.express as px\nfrom tensorflow.keras.models import Sequential\nfrom tensorflow.keras.layers import LSTM,Dense,Embedding,Dropout,GRU\nfrom tensorflow.keras.losses import sparse_categorical_crossentropy\nfrom tensorflow.keras.models import load_model\nfrom wordcloud import WordCloud\nwarnings.filterwarnings('ignore')","844deaa6":"#Third row, first column  (text)\n\ndf.iloc[2,0]","fa551e53":"path_of_file = '..\/input\/jokes-dataset\/humor\/upjoke.txt'\ntext = open(path_of_file, 'r').read()","d805b7aa":"text[:2000]","7b24fb69":"#Code by MAMMAD ABBASLI https:\/\/www.kaggle.com\/mammadabbasli\/friends-text-generatornlp = spacy.load('en_core_web_sm')\n\n\nstopword = nltk.corpus.stopwords.words('english')\ndef text_cleaning(text):\n    \n    text = re.sub(r'[^\\w\\s]', '',str(text))             #Punctuations\n    text=re.split(\"\\W+\",text)                           #Tokenizing\n    text=[word for word in text if word not in stopword]#Stop words\n    text = ' '.join(text)                              \n    return text\n\n\ndef frequent_of_words(string):\n    \n    clean_string = text_cleaning(string)\n    split_string = pd.DataFrame(clean_string.split(),columns=['Words'])\n    split_string = split_string.value_counts()[:1000].reset_index(drop=False)[:1000]\n    split_string.columns = ['Words','Count']\n    return split_string","509d4fb6":"frequent_words = frequent_of_words(text)\nfrequent_words[:15].style.background_gradient(cmap='summer')","277fc9c6":"#Code by MAMMAD ABBASLI https:\/\/www.kaggle.com\/mammadabbasli\/friends-text-generatornlp = spacy.load('en_core_web_sm')\n\nfig = px.funnel(frequent_words[:15], x='Count', y='Words')\nfig.show()","5e18a253":"#Code by MAMMAD ABBASLI https:\/\/www.kaggle.com\/mammadabbasli\/friends-text-generatornlp = spacy.load('en_core_web_sm')\n\nlist_for_cloud = []\nfor i in frequent_words.Words:\n    list_for_cloud.append(str(i))","e2bffd6d":"wordcloud = WordCloud(width = 300, height = 300,\n                background_color ='black',\n                colormap='Set3',      \n                stopwords = stopword,\n                min_font_size = 10).generate(' '.join(list_for_cloud))\n  \n# plot the WordCloud image                       \nplt.figure(figsize = (8, 8), facecolor = None)\nplt.imshow(wordcloud)\nplt.axis(\"off\")\nplt.tight_layout(pad = 0)\nplt.show()","9c594d55":"#Code by MAMMAD ABBASLI https:\/\/www.kaggle.com\/mammadabbasli\/friends-text-generatornlp = spacy.load('en_core_web_sm')\n\nname_list = ['wishes','lawyers','genie','lamp','husband','wife']\nscripts = []\nsplit_string = text.split()\nfor name in name_list:\n    scripts.append((name,split_string.count(name)))","ced7f2b3":"#Code by MAMMAD ABBASLI https:\/\/www.kaggle.com\/mammadabbasli\/friends-text-generatornlp = spacy.load('en_core_web_sm')\n\ncolors = ['#2F86A6','#34BE82','#2FDD92','#F2F013','#F9975D','#F4E185']\nsections = [scripts[0][1],\n            scripts[1][1],\n            scripts[2][1],\n            scripts[3][1],\n           scripts[4][1],\n           scripts[5][1]]\nplt.figure(figsize=(14, 8), dpi=75)\nplt.pie(sections, labels=name_list,colors=colors, \n        wedgeprops=dict( alpha=1),\n        startangle=90,\n        #explode = (0,0,0,0),\n        autopct = '%0.1f%%',\n         textprops={\n                'fontsize': 15, \n                'fontweight': 'normal'}\n            )\n\nplt.axis('equal')\nplt.title('Script Count',fontsize=20)\nplt.show()","9a10a6fb":"#Code by MAMMAD ABBASLI https:\/\/www.kaggle.com\/mammadabbasli\/friends-text-generatornlp = spacy.load('en_core_web_sm')\n\ndef target(text):\n    input_txt = text[:-1]\n    target = text[1:]\n    return input_txt, target\n\nvocab = sorted(set(text))\nchar_index = {u:i for i, u in enumerate(vocab)}\nindex_of_charachter = np.array(vocab)\nencoded_text = np.array([char_index[c] for c in text])\nchar_dataset = tf.data.Dataset.from_tensor_slices(encoded_text)\nsequence_lenght = 120\n#+1 because of zero indexing\nsequences = char_dataset.batch(sequence_lenght+1, drop_remainder=True)\ndataset = sequences.map(target)\nbatch_size = 128\nbuffer_size = 10000\ndataset = dataset.shuffle(buffer_size).batch(batch_size, drop_remainder=True)","d88f0c9c":"#Code by MAMMAD ABBASLI https:\/\/www.kaggle.com\/mammadabbasli\/friends-text-generatornlp = spacy.load('en_core_web_sm')\n\nclass JokesTextGenerator:\n    '''\n    TextGeneratorModel writed for generate text for Jokes.\n    Class Bulit with Tensorflow.\n    This class has multifunction. It can train and save alse test ability.\n    '''\n\n    def loss_func(self,true,pred):\n         return sparse_categorical_crossentropy(true, pred, from_logits=True) \n        \n    def base_model(self,size_of_vocab=153,embedding_dim = 64,neurons = 1026,batch_size = 128):\n      \n        model = Sequential()\n        model.add(Embedding(size_of_vocab, embedding_dim,batch_input_shape=[batch_size, None]))\n        model.add(GRU(neurons,return_sequences=True,stateful=True,recurrent_initializer='glorot_uniform'))\n        model.add(Dense(size_of_vocab))\n        model.compile(optimizer='adam', loss=self.loss_func) \n      \n        return model\n    \n    def train_model(self,dataset,epoch=2,train_vb_size=94,em_dim = 64,rnn_nrs = 1026,batchs = 128):\n        '''\n        This funtion used for train model with defined params\n\n        '''\n    \n        model = self.base_model(size_of_vocab = train_vb_size,\n                                embedding_dim = em_dim,\n                                neurons = rnn_nrs,\n                                batch_size = batchs)\n        print('\\n    --Model Creat Succesfully--   ')\n        model.fit(dataset,epochs=epoch)\n        model.save('friends.h5') \n        print('\\n    --Model Saved Succesfully--   ')\n        return model\n    \n    def use_trained_model(self,path):\n        '''\n        Function takes only path of trained model and generated sentence afterwords\n\n        '''\n        saved_model = self.base_model(size_of_vocab=94,embedding_dim = 64,neurons = 1026,batch_size=1)\n        saved_model.load_weights(path)\n        saved_model.build(tf.TensorShape([1, None]))\n        print('\\n    --Model ReCreat Succesfully--   ')\n        return saved_model\n    \n    def generate_dialog(self,model, start_sentence,characters=100):\n        '''\n        Purpose of this function is generate senctence\n        model : trained sequential model\n        start_sentence : according to which word will be generate\n        characters : lenght of generated sentence\n        '''\n    \n        num_generate = characters\n        change_char = {'\\n': 0, ' ': 1, '!': 2, '\"': 3, '#': 4, '$': 5, '%': 6,'&': 7,\"'\": 8,'(': 9,')': 10, '*': 11,'+': 12,',': 13,'-': 14,'.': 15,'\/': 16,'0': 17,'1': 18,'2': 19,'3': 20,'4': 21,'5': 22,'6': 23,'7': 24,\n        '8': 25,'9': 26,':': 27,';': 28,'<': 29,'=': 30,'>': 31,'?': 32,'@': 33,'A': 34,'B': 35,'C': 36,'D': 37,'E': 38,'F': 39,'G': 40,'H': 41,'I': 42,'J': 43,'K': 44,'L': 45,'M': 46,'N': 47,'O': 48,'P': 49,\n        'Q': 50,'R': 51,'S': 52,'T': 53,'U': 54,'V': 55,'W': 56,'X': 57,'Y': 58,'Z': 59,'[': 60,']': 61,'^': 62,'_': 63,'`': 64,'a': 65,'b': 66,'c': 67,'d': 68,'e': 69,'f': 70,'g': 71,'h': 72, 'i': 73,'j': 74,\n        'k': 75,'l': 76,'m': 77,'n': 78,'o': 79,'p': 80,'q': 81,'r': 82,'s': 83,'t': 84,'u': 85,'v': 86,'w': 87,'x': 88,'y': 89,'z': 90,'{': 91,'|': 92, '}': 93}\n        vocab = ['\\n', ' ', '!', '\"', '#', '$', '%', '&', \"'\", '(', ')', '*', '+', ',', '-', '.', '\/', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', ':', ';', '<', '=', '>', '?', '@', 'A', 'B', 'C', 'D', 'E',\n                 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '[', ']', '^', '_', '`', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', \n                 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', '{', '|', '}']\n        \n        index_of_charachter = np.array(vocab)\n        # Vecotrizing sentecnce\n        input_sentence = [change_char[chrr] for chrr in start_sentence]\n        input_sentence = tf.expand_dims(input_sentence, 0)\n        generated_txt = []\n        model.reset_states()\n        print('\\n    --Dialog Creating--   ')\n        for i in range(num_generate):\n            \n            predictions = model(input_sentence)\n            predictions = tf.squeeze(predictions, 0)\n            predictions = predictions \/ 1.0\n            predicted_id = tf.random.categorical(predictions, num_samples=1)[-1,0].numpy()\n            input_sentence = tf.expand_dims([predicted_id], 0)\n            generated_txt.append(index_of_charachter[predicted_id])\n       \n        return (start_sentence + ''.join(generated_txt))","fb3ab583":"generator = JokesTextGenerator()","0fb11b05":"#first_model = generator.train_model(dataset,epoch=35) #InvalidArgumentError:  indices[49,5] = 152 is not in [0, 94)","be8ed3a8":"#I simply don't know how to fix Spacy.","76d1f273":"#I hate dumb Blonds jokes\n\n![](https:\/\/cdn.quotesgram.com\/img\/74\/45\/82552401-f83d73fcb37c0d82a08d6e798651faa2.jpg)quotesgram.com","cb3dec50":"#\"I tensorflow\"  Now TF is a person that speaks in the 1st person?","bd95e48d":"![](https:\/\/encrypted-tbn0.gstatic.com\/images?q=tbn:ANd9GcQoLs5mgp0_G_f45_skNNf6cvkxsRBQRca6j9IB6csdv2KGC4rqFWaGnf7Gy4GrLd0_EQE&usqp=CAU)imgflip.com"}}