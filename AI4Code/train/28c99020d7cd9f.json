{"cell_type":{"dd53afad":"code","5541bf66":"code","032fff61":"code","19762eae":"code","57386b99":"code","81e3aaa0":"code","cd6f2211":"code","990b1584":"code","47aa5080":"code","66701dba":"code","b776d2d5":"code","1e9cf920":"code","7f714d99":"code","b1b97fcf":"code","6e76826a":"code","9801be8f":"code","248381f4":"code","b069a974":"code","40a47f93":"code","1dd753d8":"code","1f6c28b2":"code","5a58b70e":"code","a3b9374a":"code","5ba09e90":"markdown","a1005ad7":"markdown"},"source":{"dd53afad":"!pip install pydot","5541bf66":"import tensorflow as tf\nfrom tensorflow.keras.models import Model\nfrom tensorflow.keras.layers import Dense,Input\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport pandas as pd\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import confusion_matrix","032fff61":"URL = 'http:\/\/archive.ics.uci.edu\/ml\/machine-learning-databases\/wine-quality\/winequality-white.csv'\ndata_w=pd.read_csv(URL, sep=\";\")\ndata_w['is_red']=0\ndata_w.drop_duplicates(keep='first',inplace=True)","19762eae":"URL = 'http:\/\/archive.ics.uci.edu\/ml\/machine-learning-databases\/wine-quality\/winequality-red.csv'\ndata_r=pd.read_csv(URL, sep=\";\")\ndata_r['is_red']=1\ndata_r.drop_duplicates(keep='first',inplace=True)","57386b99":"df=pd.concat([data_r, data_w],axis=0,ignore_index=True)","81e3aaa0":"sns.histplot(df['quality'],bins=20)","cd6f2211":"df=df[(df['quality']>4) &(df['quality']<8)]","990b1584":"df=df.reset_index(drop=True)","47aa5080":"train, test = train_test_split(df, test_size=0.2)\ntrain, val = train_test_split(train, test_size=0.2)","66701dba":"train.describe().T","b776d2d5":"def format_data(data):\n    is_red=np.array(data.pop('is_red'))\n    quality=np.array(data.pop('quality'))\n    return quality,is_red","1e9cf920":"train_y=format_data(train)\nval_y=format_data(val)\ntest_y=format_data(test)","7f714d99":"from sklearn.preprocessing import StandardScaler\nscaler=StandardScaler()\nscaler.fit(train)","b1b97fcf":"train_x=scaler.transform(train)\ntest_x=scaler.transform(test)\nval_x=scaler.transform(val)","6e76826a":"def base_model(inputs):\n    x=Dense(128,activation='relu')(inputs)\n    x=Dense(128,activation='relu')(x)\n    return x","9801be8f":"def final_model(inputs):\n    x=base_model(inputs)\n    wine_quality=Dense(units=1,name='wine_quality')(x)   # no activation used\n    wine_type=Dense(units=1,activation='sigmoid',name='wine_type')(x)\n    model=Model(inputs=inputs,outputs=[wine_quality,wine_type])\n    \n    return model","248381f4":"inputs=Input(shape=(11,))\nmodel=final_model(inputs)","b069a974":"inputs = tf.keras.layers.Input(shape=(11,))\nrms = tf.keras.optimizers.RMSprop(lr=0.0001)\nmodel = final_model(inputs)\n\nmodel.compile(optimizer=rms, \n              loss = {'wine_type' : 'binary_crossentropy',\n                      'wine_quality' : 'mse'\n                     },\n              metrics = {'wine_type' : 'accuracy',\n                         'wine_quality': tf.keras.metrics.RootMeanSquaredError(), \n                       }\n             )","40a47f93":"tf.keras.utils.plot_model(\n    model,\n    to_file=\"model.png\",\n    show_shapes=False,\n    show_dtype=False,\n    show_layer_names=True,\n    rankdir=\"TB\",\n    expand_nested=False,\n    dpi=96,\n)","1dd753d8":"history = model.fit(train_x,(train_y[0],train_y[1]), \n                    epochs = 180, verbose=0,validation_data=(val_x, (val_y[0],val_y[1])))","1f6c28b2":"loss, wine_quality_loss, wine_type_loss, wine_quality_rmse, wine_type_accuracy = model.evaluate(x=test_x, y=(test_y[0],test_y[1]))\n\nprint()\nprint(f'loss: {loss}')\nprint(f'wine_quality_loss: {wine_quality_loss}')\nprint(f'wine_type_loss: {wine_type_loss}')\nprint(f'wine_quality_rmse: {wine_quality_rmse}')\nprint(f'wine_type_accuracy: {wine_type_accuracy}')","5a58b70e":"predictions = model.predict(test_x)\nquality_pred = predictions[0]\ntype_pred = predictions[1]","a3b9374a":"for i in [0,6,9,10,22]:\n    print(quality_pred[i],test_y[0][i])\n    print(type_pred[i],test_y[1][i])","5ba09e90":"**PRE PROCESSING**","a1005ad7":"**MODEL**"}}