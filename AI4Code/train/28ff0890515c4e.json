{"cell_type":{"118153ca":"code","6ebd9b74":"code","61dbdcb0":"code","7b040535":"code","c1748738":"code","5c932ad1":"code","654b9d91":"code","5a78ce05":"code","2c754df7":"code","264166b9":"code","2f3e6e5f":"code","2b763d4d":"code","3052baff":"code","378984ab":"code","ca9749c2":"code","529a1fea":"code","59635d97":"code","60fb3b4f":"code","89fb2c06":"code","45d55753":"code","9ed6aa05":"code","bfb36af0":"code","34c9a5be":"code","b58340f2":"markdown","8c123a8b":"markdown","1798dd9d":"markdown","a2d9c3e1":"markdown","e873d2eb":"markdown","2ba5b134":"markdown","7f239670":"markdown","bc9406d7":"markdown","cd0ab767":"markdown","247afcc0":"markdown","b3c88f34":"markdown","557ea3e0":"markdown","78ab41b1":"markdown","6cd13c6f":"markdown","2660234c":"markdown","87e18f0b":"markdown","ba30add1":"markdown","4ef91b13":"markdown","3d27c986":"markdown","8c5b6013":"markdown","1f35e0fe":"markdown","fab64699":"markdown"},"source":{"118153ca":"import tensorflow as tf\nimport keras\nfrom tensorflow.keras.preprocessing.image import ImageDataGenerator\nimport numpy as np\nimport os\nfrom sklearn.metrics import classification_report\nimport numpy","6ebd9b74":"# rescale (normalize) the images and generate a set of new images with differnet rotations and zoom levels (augmentatoin) to prevent overfitting\n# it can also help to balance the imbalanced data\n# by default keras automatically converts all images to RGB mode, so no need to convert images, if they are differnet.\ntrain_datagen = ImageDataGenerator(rescale = 1.\/255,\n                                   shear_range = 0.2,\n                                   zoom_range = 0.2,\n                                   horizontal_flip = True)\n# apply the data augmentatoin on the dataset and reduce their size for faster (but of course less accurate) learning\nimg_width, img_height = 64, 64\ntraining_set = train_datagen.flow_from_directory('\/kaggle\/input\/chest-xray-pneumonia\/chest_xray\/chest_xray\/train',\n                                                 target_size = (img_width, img_height),\n                                                 batch_size = 32,\n                                                 class_mode = 'binary')","61dbdcb0":"# Get the counts for each class\nfrom collections import Counter\ncases_count = Counter(training_set.classes)\nprint(cases_count.items())","7b040535":"total = cases_count[0] + cases_count[1]\nweight_for_0 = (1 \/ cases_count[0]) * (total \/ 2.0)\nweight_for_1 = (1 \/ cases_count[1]) * (total \/ 2.0)\nclass_weight = {0: weight_for_0, 1: weight_for_1}\nprint(class_weight)","c1748738":"val_datagen = ImageDataGenerator(rescale = 1.\/255)\nval_set = val_datagen.flow_from_directory('\/kaggle\/input\/chest-xray-pneumonia\/chest_xray\/chest_xray\/val',\n                                            target_size = (img_width, img_height),\n                                            batch_size = 32,\n                                            class_mode = 'binary')","5c932ad1":"test_datagen = ImageDataGenerator(rescale = 1.\/255)\ntest_set = test_datagen.flow_from_directory('\/kaggle\/input\/chest-xray-pneumonia\/chest_xray\/chest_xray\/\/test',\n                                            target_size = (img_width, img_height),\n                                            batch_size = 32,\n                                            class_mode = 'binary',\n                                            shuffle=False)","654b9d91":"cnn = tf.keras.Sequential()","5a78ce05":"cnn.add(tf.keras.layers.Conv2D(filters=32, kernel_size=3, activation='relu', input_shape=[img_width, img_height, 3]))","2c754df7":"cnn.add(tf.keras.layers.MaxPool2D(pool_size=2, strides=2))","264166b9":"cnn.add(tf.keras.layers.Conv2D(filters=32, kernel_size=3, activation='relu'))\ncnn.add(tf.keras.layers.MaxPool2D(pool_size=2, strides=2))","2f3e6e5f":"cnn.add(tf.keras.layers.Flatten())","2b763d4d":"cnn.add(tf.keras.layers.Dense(units=128, activation='relu'))","3052baff":"cnn.add(tf.keras.layers.Dense(units=1, activation='sigmoid'))","378984ab":"cnn.compile(optimizer = 'adam', loss = 'binary_crossentropy', metrics = ['accuracy'])","ca9749c2":"#model_fit = cnn.fit(x = training_set, validation_data = val_set, epochs = 25, class_weight=class_weight)","529a1fea":"# save weights\n#cnn.save_weights('kaggle\/alizmn\/pneumoniadetection')","59635d97":"# Load weights\nmodel_fit = cnn.load_weights('kaggle\/alizmn\/pneumoniadetection')","60fb3b4f":"model_evaluation = cnn.evaluate(test_set)","89fb2c06":"print(f\"Model Accuracy: {model_evaluation[1]*100: 0.2f}%\")","45d55753":"# Predict classes\npreds = np.round(cnn.predict(test_set),0)","9ed6aa05":"# Ground truth classes and labels\ngt_class = test_set.classes\ngt_labels = list(test_set.class_indices.keys())","bfb36af0":"from sklearn.metrics import classification_report, confusion_matrix, accuracy_score, recall_score\ncm = confusion_matrix(gt_class, preds)\nprint(cm)\nprint('The cnn model has an accuracy score of {:.2f} and recall score of {:.2f} for {:s}'.format((accuracy_score(gt_class, preds) *100),(recall_score(gt_class, preds) *100),gt_labels[1]))","34c9a5be":"# Detailed report\nreport = classification_report(gt_class, preds, target_names=gt_labels)\nprint(report)","b58340f2":"## Data Preprocessing","8c123a8b":"### Model evaluatoin","1798dd9d":"# Pneumonia Detection with Convolutional Neural Network: A classification Problem","a2d9c3e1":"### Preprocessing the Test set","e873d2eb":"### Compiling the CNN","2ba5b134":"### Generating Classificatoin Report and Confusion Matrix","7f239670":"### Initialising the CNN","bc9406d7":"### Step 5 - Output Layer","cd0ab767":"### Weight classes to balance the data","247afcc0":"### Preprocessing the Training set ","b3c88f34":"### Step 2 - Pooling","557ea3e0":"### Step 4 - Full Connection","78ab41b1":"### Step 3 - Flattening","6cd13c6f":"### Training the CNN on the Training set and evaluating it on the Test set","2660234c":"## Training the CNN","87e18f0b":"### Step 1 - Convolution","ba30add1":"## Building the CNN","4ef91b13":"### Preprocessing the Validation set","3d27c986":"### Importing the libraries","8c5b6013":"### Adding a second convolutional layer","1f35e0fe":"### Examine the class label imbalance","fab64699":"### Save model weights"}}