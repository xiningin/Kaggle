{"cell_type":{"b62e6c9c":"code","a8912cd3":"code","be45be1b":"code","91d22f55":"code","2821334a":"code","0e285f0b":"code","b89574cc":"code","810ed9da":"code","116b95d7":"code","6f7160bd":"code","c5b20872":"code","01cf9b3a":"code","028a8dc8":"code","f97377f9":"code","dc34d731":"code","eff40f68":"code","9556508f":"code","46409e65":"code","94846d43":"code","0dd5030b":"code","38f4933a":"code","0096f1ea":"code","4f2737b9":"code","5e9a57a9":"code","d2fe3591":"code","80bba1cd":"code","1228ff95":"code","7cc2d7cb":"code","cce10ba9":"code","7c7110a1":"code","47cc10ec":"code","c9a0f716":"code","4a9aa32f":"code","50808b40":"code","d546435d":"code","7e3ba4c8":"code","70acc303":"code","33fb5029":"code","20f719d2":"code","cda867a1":"code","0af14192":"markdown"},"source":{"b62e6c9c":"import pandas as pd\nimport numpy as np\nimport tensorflow as tf\nfrom tensorflow.keras.layers import Input,Dense,Dropout,Lambda","a8912cd3":"#lets work with csv files\n\ntrain_df=pd.read_csv(\"..\/input\/osic-pulmonary-fibrosis-progression\/train.csv\")\ntest_df=pd.read_csv(\"..\/input\/osic-pulmonary-fibrosis-progression\/test.csv\")\nsub_df=pd.read_csv(\"..\/input\/osic-pulmonary-fibrosis-progression\/sample_submission.csv\")","be45be1b":"train_df.head()","91d22f55":"len(train_df['Patient'].unique())","2821334a":"train_df.groupby(['SmokingStatus']).count()['Sex']","0e285f0b":"train_df.info()","b89574cc":"train_df.count()","810ed9da":"train_df.columns","116b95d7":"patient_train_df=set(train_df['Patient'].unique())\npatient_test_df= set(test_df['Patient'].unique())","6f7160bd":"patient_train_df.intersection(patient_test_df)","c5b20872":"unique_train_df=train_df[['Patient', 'Age', 'Sex', 'SmokingStatus']].drop_duplicates()\nunique_train_df.head()","01cf9b3a":"train_df['Patient'].value_counts().max()","028a8dc8":"train_df['Patient'].value_counts().min()","f97377f9":"train_df[train_df['Patient']=='ID00422637202311677017371']","dc34d731":"import matplotlib.pyplot as plt\n\n#1 visualization\n\n#smoking status\n\nunique_train_df['SmokingStatus'].value_counts().plot(kind='bar', \n                                              color='blue',\n                                              title='Distribution of the SmokingStatus column')\n\nplt.ylabel('counts')\nplt.xticks(rotation = 0)","eff40f68":"train_df['Weeks'].value_counts().head()","9556508f":"train_df['Weeks'].value_counts().head()","46409e65":"#week distribution\nplt.figure(figsize=(50,40))\ntrain_df['Weeks'][:int(len(train_df['Weeks'].unique())\/2)].value_counts().plot(kind='barh', color='blue',\n                                              title='Distribution of the weeks column')\nplt.tick_params(axis=\"x\", labelsize=20)\nplt.tick_params(axis=\"y\", labelsize=20)\n","94846d43":"train_df.head()","0dd5030b":"train_df['FVC'].max()","38f4933a":"#fvc vs percent \nimport plotly.express as px\nplt.figure(figsize=(30,20))\npx.scatter(train_df,x='Percent',y='FVC',color='Age')","0096f1ea":"#FVC vs age\n\npx.bar(train_df,x='SmokingStatus',y='FVC',color='Age')","4f2737b9":"#percent\n\ntrain_df['Percent'].value_counts()","5e9a57a9":"plt.scatter(train_df['Percent'],train_df['FVC'],color='red')","d2fe3591":"data = train_df.append([test_df, sub_df])","80bba1cd":"len(train_df),len(test_df),len(sub_df)","1228ff95":"data.info()","7cc2d7cb":"data.isnull().sum()","cce10ba9":"train_df = pd.concat( (train_df,test_df) )","7c7110a1":"from sklearn import preprocessing\nlabel_encoder=preprocessing.LabelEncoder()\ntrain_df['SmokingStatus']=label_encoder.fit_transform(train_df['SmokingStatus'])\ntrain_df['Sex']=label_encoder.fit_transform(train_df['Sex'])","47cc10ec":"train_df['Percent']       = (train_df['Percent'] - train_df['Percent'].mean()) \/ train_df['Percent'].std()\ntrain_df['Age']           = (train_df['Age'] - train_df['Age'].mean()) \/ train_df['Age'].std()\ntrain_df['Sex']           = (train_df['Sex'] - train_df['Sex'].mean()) \/ train_df['Sex'].std()\ntrain_df['SmokingStatus'] = (train_df['SmokingStatus'] - train_df['SmokingStatus'].mean()) \/ train_df['SmokingStatus'].std()\ntrain_df.head(10)","c9a0f716":"#keras model\n\n# model architecture https:\/\/www.kaggle.com\/chrisden\/6-82-quantile-reg-lr-schedulers-checkpoints\n\nfrom tensorflow.keras.models import Model\n\ni = Input(shape=(5,))\nx = Dense(100, activation=\"relu\", name=\"d1\")(i)\nx = Dense(100, activation=\"relu\", name=\"d2\")(x)\np1 = Dense(3, activation=\"linear\", name=\"p1\")(x)\np2 = Dense(3, activation=\"relu\", name=\"p2\")(x)\npreds=preds =Lambda(lambda x: x[0] + tf.cumsum(x[1], axis = 1), \n                     name = \"preds\")([p1, p2])\n\n\nmodel=Model(i,[p1,p2])\nmodel.compile(optimizer=tf.keras.optimizers.Adam(lr=0.1, beta_1=0.9, beta_2=0.999, epsilon=None, decay=0.01, amsgrad=False),loss='mse')","4a9aa32f":"model.summary()","50808b40":"r=model.fit(train_df[['Weeks','Percent','Sex','SmokingStatus','Age']],train_df['FVC'],epochs=100,verbose=1)","d546435d":"#quantile regression model\n#linear model\n\nfrom statsmodels.formula.api import quantreg\n\nmodel_1=quantreg('FVC ~ Weeks+Sex+Age+SmokingStatus+Percent', train_df).fit(q=0.15)\nmodel_2=quantreg('FVC ~ Weeks+Sex+Age+SmokingStatus+Percent', train_df).fit(q=0.50)\nmodel_3=quantreg('FVC ~ Weeks+Percent+Age+Sex+SmokingStatus', train_df).fit( q=0.85 )","7e3ba4c8":"train_df['FVC1'],train_df['FVC2'],train_df['FVC3']=model_1.predict(train_df),model_2.predict(train_df),model_3.predict(train_df)","70acc303":"train_df.head()","33fb5029":"len(sub_df),len(train_df)","20f719d2":"df=pd.DataFrame()","cda867a1":"df['Confidence1'] = train_df.iloc[:730,9] - train_df.iloc[:730,8]\ndf['Patient_Week']=train_df['Patient'][:730]+'_'+train_df['Weeks'].astype('str')[:730]\ndf['Confidence']=sub_df['Confidence']\ndf['FVC']=train_df['FVC'][:730]\ndf['FVC1']=train_df['FVC1'][:730]\n# get rid of unused data and show some non-empty data\nsubmission = df[['Patient_Week','FVC','Confidence','FVC1','Confidence1']].copy()\nsubmission.loc[~submission.FVC1.isnull()].head(10)\n","0af14192":"#better option"}}