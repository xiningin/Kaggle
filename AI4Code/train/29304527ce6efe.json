{"cell_type":{"fe0bb4cb":"code","1b6f7317":"code","0f1886f0":"code","9a59ed3e":"code","40fe1510":"code","3fe632a8":"code","b2bf63ae":"code","383b2193":"code","5d58d1a6":"code","3b399922":"code","3d9337d8":"code","86331028":"code","9ca4bee8":"code","097ed87d":"code","c4745bd0":"code","42fde3db":"code","590ef330":"code","96de1961":"code","921a5331":"code","c8cc4799":"code","cb72800e":"code","316758ba":"code","df20df04":"code","f688ac91":"code","b4a65d2c":"code","12855e33":"code","84ea22b0":"code","79efb194":"code","f4e49e31":"code","39af98f9":"code","4690b4c2":"code","2521a4a8":"code","24663ef9":"code","2b995abc":"code","ab42eed4":"code","3245c81e":"code","498c81a8":"code","e79eb912":"code","ae053172":"code","0a004b2b":"code","571ec162":"code","20a0df34":"code","557eb882":"markdown","3eabfc8e":"markdown","5d3eb43e":"markdown","654ffacd":"markdown","ea7a2553":"markdown","fc185ec7":"markdown","55f371fe":"markdown","15aacb42":"markdown","a5a72e9f":"markdown","638bbdef":"markdown","67983cba":"markdown","cdff03b4":"markdown","a771d4aa":"markdown","ec9162f8":"markdown","37a9ca26":"markdown","90333e9f":"markdown","0782731d":"markdown","bf1aeea6":"markdown","f4a66233":"markdown","6ffee496":"markdown","5b48447b":"markdown","80ca7eba":"markdown","7044b56b":"markdown","633fcd13":"markdown","2095da63":"markdown","b16c70b4":"markdown","d5077dda":"markdown","5547e000":"markdown","625f4c82":"markdown","46c9fa29":"markdown","022c345f":"markdown","61fb9b5f":"markdown","29e62ce6":"markdown","899f708c":"markdown","7d240a5a":"markdown","96ba4bbf":"markdown","41f467ca":"markdown","3971615c":"markdown","9d23d82a":"markdown","f24b5eb9":"markdown"},"source":{"fe0bb4cb":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport matplotlib.pyplot as plt\n\nimport seaborn as sns\nfrom sklearn.linear_model import LinearRegression\nfrom IPython.display import display\n#import testmodul\n%pwd\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n\n# Any results you write to the current directory are saved as output.","1b6f7317":"d=pd.read_csv('..\/input\/en.openfoodfacts.org.products.tsv', delimiter='\\t', encoding='utf-8')\nd.info()\n","0f1886f0":"pd.set_option('display.max_columns', 500)\nd.sample(5)","9a59ed3e":"\"\"\"Eliminate duplicates if there are any.\"\"\"\nprint(d.shape)\nd=d.drop_duplicates()\nprint(d.shape)\nd.describe()","40fe1510":"col_vides=[]\nfor col in d.columns:\n    if d[col].isnull().all():\n        col_vides.append(col)\n#print (df.sample(5).to_html())\nprint ('empty columns are :\\n\\n')\ndisplay(col_vides)\nt=pd.DataFrame(index=['number of missing values', 'number of values','fill_rate'], columns=d.columns )\nfor col in d.columns:\n    nb_nan=d[col].isnull().sum()\n    t.loc['number of missing values',col]=nb_nan              \n    t.loc['number of values', col]= d.shape[0]-nb_nan \n    t.loc['fill_rate', col]=(d.shape[0]-nb_nan)\/(d.shape[0]*1.0)\ndisplay(t)#pd.set\n#t.to_pickle('.\/tableuxValeursManquantes.pkl')\nprint(d.shape[0]*0.3\/100)\n#t[t[col]>df.shape[0]*0.2\/100]\n\n\"\"\"Selection criterion\"\"\"\np=0.95 #0.05\nfor col in t.columns:\n    if t.loc['number of missing values',col]>(d.shape[0]*(100-p)\/100):\n    #if f=t[t[col]>d.shape[0]*0.2\/100]\n        #display(t[col])\n        print('{} deleted -------> only {} values.'.format(col, d.shape[0]-t.loc['number of missing values', col]))\n        d=d.drop(col, axis=1)\ndisplay(d.shape) \n\n","3fe632a8":"l=4 #(l*(df.shape[1]\/\/5)+1, l*5)\ni=0\nj=0\nf, ax = plt.subplots((d.shape[1]\/\/5)+1, 5, figsize=(l*5, l*(d.shape[1]\/\/5)))\nf.subplots_adjust(left=0, right=0.9, top= 0.95, bottom= 0., wspace=0.9, hspace=0.9)\nf.tight_layout(rect=(0, 0, 0.95,0.95 ), h_pad=0.5, w_pad=0.5)\nfor col in d.columns:\n    if i < 5:\n        ax[j,i].pie(t.loc[['number of missing values', 'number of values'], col], \n                        autopct='%0.1f')\n        ax[j,i].set_title(col)\n        i+=1\n    else:\n        i=0\n        j+=1\n        ax[j,i].pie(t.loc[['number of missing values', 'number of values'], col], \n                        autopct='%0.1f')\n        ax[j,i].set_title(col)\n        i+=1\nf.legend(loc='best', labels=['missing values', 'reals values'] , fontsize=15) \nf.suptitle('ratio : reals values \/ missing values', fontsize=40, fontweight=30)        \n      \nplt.show()    ","b2bf63ae":"dico = {'columns': d.columns, 'fill_rate': t.loc['fill_rate', d.columns]*100, 'missing_values': 100-t.loc['fill_rate',d.columns]*100}\n\ntr = pd.DataFrame(dico)\n#display(tr)\n\n\n\npreserved = [c for c in d.columns if not((c.endswith('_100g'))|\n                                          (c.endswith('_en'))|\n                                          (c.endswith('_tags'))|\n                                          (c.endswith('_fr'))|\n                                          (c.endswith('_datetime'))|\n                                          (c.endswith('_t')))]\n\npreserved+=['nutrition_grade_fr', 'nutrition-score-uk_100g', 'nutrition-score-fr_100g']\nnutri_info = [c for c in d.columns if c.endswith('_100g') and c!='energy_100g' and c!='energy-from-fat_100g'\n                and c!='nutrition-score-fr_100g' and c!='nutrition-score-uk_100g' and c!='carbon-footprint_100g']\nd_no_nutri =d[d[nutri_info].isnull().all(axis=1)]\nnutri_empty = 100*d_no_nutri.shape[0]\/d.shape[0]\nnutri_info = {'columns' : ['**have_nutri_info**'], 'fill_rate' : [100-nutri_empty], 'missing_values': [nutri_empty] }\ntr_nutri = pd.DataFrame(nutri_info)\ntr = tr.loc[preserved,:]\ntr = pd.concat([tr, tr_nutri])\ntr=tr.sort_values(by='fill_rate', ascending=False)\n#display(tr)\nr = range(tr.shape[0])\n\ntr.drop(index=['image_small_url', 'creator'], inplace=True)#Remove any columns\n\n\nbarWidth=0.85\nplt.figure(figsize=(8,10))\nplt.gca().invert_yaxis()\n#plt\nplt.barh(tr['columns'], tr['fill_rate'], color='#a3acff')\nplt.barh(tr['columns'], tr['missing_values'], left=tr['fill_rate'], color ='#b5ffb9')\nplt.title('fill rate representation', fontsize=30)\nplt.yticks(fontsize=10)\nplt.ylabel('columns', fontdict={'fontsize' : 20})\nplt.xlabel('fill rate(%)', fontdict={'fontsize' : 20})\n\nplt.axvline(x=80, color='b')\nplt.text(82, -1, '>80%', color='b')\nplt.axvline(x=20, color='r')\nplt.text(12, -1, '<20%', color='r')\nplt.grid(True)\n\n","383b2193":"d=d.dropna(axis=0, how='all')\nprint(d.shape)","5d58d1a6":"NUTRI_COL = [c for c in d.columns if c.endswith('_100g')]\ndftemp=d[NUTRI_COL].isnull().all(axis=1)\nprint(\"{} products have no nutritional indications ie {}% of the data\".format(dftemp.sum(), (dftemp.sum()*100\/d.shape[0]))) ","3b399922":"numeric = ['int32', 'int64', 'float32', 'float64']\nnewdf=d.select_dtypes(include=numeric)\ncolnum=newdf.columns\ncolnum[-2:]","3d9337d8":"dftest=pd.DataFrame(d)\n\nfor col in newdf.columns:\n    if col!='nutrition-score-fr_100g' and col!='nutrition-score-uk_100g':\n        for i in dftest[dftest[col].fillna(0)<0].index:\n            dftest.loc[i, col] = np.nan","86331028":"d2=dftest.copy()\n\nquantile=0.001\nqmax=d.quantile(q=1-quantile, axis=0, interpolation='higher')\nqmin=d.fillna(0).quantile(q=quantile, interpolation='lower')\n#display(qmin)\n#print('qmax: \\n {} \\n qmin: \\n {}'.format(qmax[qmax>100], qmin[qmin<0]))\n\n\nfor lab in colnum[:-2]:#here, i cut on every numericals columns except in nutrition_score_** columns wich are already OK\n    valmax=qmax[lab]\n    valmin=qmin[lab]\n    #print(lab, valmax, valmin)\n    d2=d2[d2[lab].fillna(0)<=valmax]\n    d2=d2[d2[lab].fillna(0)>=valmin]\n    \n   \nd2.describe()","9ca4bee8":"\"\"\"Below we are interested in the words present in the database\"\"\"\nfrom collections import Counter\nfrom wordcloud import WordCloud","097ed87d":"def wordclouding(data, label='product_name', sep=' '):\n    \"\"\"To return a wordcloud present in the column 'label', the separation of the word is the argument 'sep' '\"\"\"\n    words = []\n    \n    for string in data[label]:\n        listwords= str(string).split(sep)\n        for w in listwords:\n            if (w!=' ')and (w!='nan'):\n                words.append(w)\n    count=Counter(words)\n        \n\n    wordcloud = WordCloud(width=1080, height=920, colormap='PuBuGn').fit_words(count)\n    plt.figure(figsize=(25,15))\n    plt.imshow(wordcloud, interpolation='bilinear')\n    plt.axis('off')\n    plt.margins(x=0, y=0)\n    plt.show()\n        \n\n","c4745bd0":"wordclouding(d2, label='main_category_en', sep=',')","42fde3db":"def most_common_word(labels, sep=\",\"):\n    words=[]\n    for lab in labels:\n        words+=str(lab).split(sep)\n    count=Counter(words)\n    for word in count.most_common(100):\n        print(word)","590ef330":"most_common_word(d['main_category'], sep=',')\n\n","96de1961":"d[d['main_category']=='en:farming-products']\nd[d['main_category']=='en:sweeteners']\nd[d['main_category']=='en:dried-products']\nd[d['main_category']=='en:dairies']\nd[d['main_category']=='en:labeled-products']\nd[(d['main_category']=='en:plant-based-foods-and-beverages')&(d['nutrition-score-fr_100g'].dropna()!=d['nutrition-score-uk_100g'].dropna())]\nd[d['main_category']=='en:spreads']\nd[d['main_category']=='en:desserts']\nd[d['main_category']=='en:sweeteners']\nd[d['main_category']=='en:pie-dough']\nd[d['main_category']=='en:fats']\nd[d['main_category']=='en:fresh-foods'].head(5)\n","921a5331":"wordclouding(d2, label='pnns_groups_2', sep=',')\nmost_common_word(d['pnns_groups_2'], sep=',')","c8cc4799":"CATEGS ={\n    'cheese' : ['Cheese'],\n    'juice' : ['Fruit juices', 'Fruit nectars'],\n    'plant' : [ 'fruits', 'Fruits', 'Vegetables'],\n    'legume' : ['legumes', 'Legumes'],\n    'cake' : ['Biscuits and cakes', ],\n    'feculent' : ['Cereals', 'Bread', 'pastries', 'Potatoes' ],\n    'beverage' : ['Non-sugared beverages', 'Artificially sweetened beverages', 'Alcoholic beverages'],\n    #'sea_food' : [],\n    'meat_fish' : ['Tripe dishes', 'Meat','Fish and seafood'],\n    'fats' : ['Fats'],\n    'milk' : ['Milk and yogurt', 'Ice cream'],\n}\n#'Soups' has been removed from 'vegetables' as it includes soups of noodles and other","cb72800e":"\n\ndef compare_word(word):\n    \"\"\"Check if 'word' can be referenced to one of our clusters. Each category is a key of our dico 'CATEGS'\"\"\"\n    if word == ' 'or word == 'nan':\n        pass\n    for key, val in CATEGS.items():\n        if word in val:\n            return key \n    pass\n\n\ndef new_categ (data, lab='main_category'):\n    \"\"\"defines a new 'simple_categ' column in 'data'. This allows a cluster according to the catergory of the product.\"\"\"\n    #i=0\n    list_column=[]\n    for lab in data[lab]:\n        list_prov= []\n        for w in str(lab).split(\"en:\"):\n            s=compare_word(w)\n            if s != None:\n                break\n                        \n        list_column.append(s)\n        \n    data['simple_categ'] = list_column\n ","316758ba":"new_categ(d2, lab='pnns_groups_2')","df20df04":"\ndef nutri_bar(data, categ='vegetables', sep=0.2):\n    \"\"\"displays two diagrams representing the average nutrient content in the category 'categ'.\n\u00a0\u00a0\u00a0\u00a0 The first diagram corresponds to the main nutrients and the second one to the secondary nutrients.\n\u00a0\u00a0\u00a0\u00a0 The 'sep' argument separates the main nutrients from the secondary nutrients (secondary nutrients <'sep' grams)\"\"\"\n    data_categ = data[data['simple_categ']==categ]\n    data_mean=data_categ.mean()\n    nutri_col = [c for c in data.columns if c.endswith('_100g') and c!='energy_100g' and c!='energy-from-fat_100g'\n                and c!='nutrition-score-fr_100g' and c!='nutrition-score-uk_100g' and c!='carbon-footprint_100g']\n    data_mean=data_mean.loc[nutri_col]\n    \n    data_mean=data_mean[data_mean>0]\n    data_mean_main=data_mean[data_mean>=sep]\n    data_mean_second=data_mean[data_mean<sep]\n    \n    ind_main = np.arange(len(data_mean_main))\n    ind_second = np.arange(len(data_mean_second))\n    width=0.55\n    \n    \n    \n    plt.title('Average nutrient present in the category {}'.format(categ), fontsize=40)\n    fig, ax = plt.subplots(1, 1, figsize=(8,5),dpi=75, num=1)\n    \n    \n    plt.yticks(ind_main, (data_mean_main.index), fontsize=20)\n    plt.xticks(fontsize=15)\n    ax.invert_yaxis()\n    plt.barh(ind_main, data_mean_main, width, align='center')\n    \n    plt.subplots(1, 1, figsize=(10,15), dpi=50, num=2)\n    plt.title('Secondary Nutriments (<{}g)'.format(sep), fontsize=20)\n    plt.yticks(ind_second, (data_mean_second.index), fontsize=15)\n    plt.xticks(fontsize=15)\n    ax.invert_yaxis()\n    plt.barh(ind_second, data_mean_second, width, align='center')\n    \n    \n    \n    plt.show()\n    ","f688ac91":"\"\"\"Improved products recognition without nutritional information\"\"\"\nnutri_col = [c for c in d.columns if c.endswith('_100g') and c!='energy_100g' and c!='energy-from-fat_100g'\n                and c!='nutrition-score-fr_100g' and c!='nutrition-score-uk_100g' and c!='carbon-footprint_100g']\n\nd_no_nutri =d2[d2[nutri_col].isnull().all(axis=1)]\n\nc_no_nutri = d_no_nutri.loc[:,['code', 'simple_categ']].groupby('simple_categ').count()\nc_no_nutri = c_no_nutri.rename(columns={ 'code' : 'nb_no_nutri'})\nc_categ = d2.loc[:,['code','simple_categ']].groupby('simple_categ').count()#compte le nombre de produit repertorie dans chaques categories\nc_categ = c_categ.rename(columns={ 'code' : 'nb'})\nc_no_nutri['nb'] = c_categ['nb']\n\nc_no_nutri['percent_no_nutri']=pd.DataFrame(c_no_nutri['nb_no_nutri']*100\/c_categ['nb'])\nc_no_nutri","b4a65d2c":"nutri_bar(d2, categ='plant')","12855e33":"nutri_bar(d2, categ='cheese')","84ea22b0":"nutri_bar(d2[d2['simple_categ']=='cheese'].fillna(0), categ='cheese')","79efb194":"#import matplotlib.pyplot as plt\nx=pd.DataFrame(d2['nutrition-score-fr_100g'].fillna(0), columns=['nutrition-score-fr_100g'])\ny=pd.DataFrame(d2['nutrition-score-uk_100g'].fillna(0), columns=['nutrition-score-uk_100g']) \nplt.figure(figsize=(9,9))\nplt.title('relationship between nutrition-score-fr and nutrition-score-uk')\nplt.xlabel('nutrition-score-fr_100g')\nplt.ylabel('nutrition-score-uk_100g')\nplt.plot(x, y, '.')\n\n\n              \n\nreg = LinearRegression()\ndroite = reg.fit(x, y)\n\n\nprint('y=ax with a={}\\n score : {}'.format(droite.coef_[0], droite.score(x,y)))\nplt.plot([-10,40], [droite.coef_[0]*(-10),droite.coef_[0]*40])\nplt.show()\n\n","f4e49e31":"#sns.scatterplot(x, y)#, plot_kws={'s' :80}, palette='husl')\nplt.figure(figsize=(10,10))\nsns.scatterplot(x=d2['nutrition-score-fr_100g'], \n                y=d2['nutrition-score-uk_100g'], \n                hue=d2['simple_categ'],\n                legend='full',\n                s=90) \n             ","39af98f9":"\"\"\"Under these conditions, we find again fats products\"\"\"\nd_fr_indulgent = d2[(d2['main_category']=='en:plant-based-foods-and-beverages')&(d2['nutrition-score-fr_100g'].dropna()!=d2['nutrition-score-uk_100g'].dropna())]\nwordclouding(d_fr_indulgent)","4690b4c2":"d_uk_indulgent = d2[(d2['main_category']=='en:beverages')&(d2['nutrition-score-fr_100g'].dropna()>d2['nutrition-score-uk_100g'].dropna())]\nwordclouding(d_uk_indulgent)","2521a4a8":"\"\"\"Let keep the traditionnal color code for 'nutrition_grade_fr'\"\"\"\npalette = sns.color_palette(\"RdYlGn\", 5)\nlegend = {'e': palette[0], 'd': palette[1], 'c': palette[2], 'b':palette[3], 'a':palette[4]}\n\n\nnutri_grade=d.loc[:,['nutrition_grade_fr', 'energy_100g']].groupby('nutrition_grade_fr').agg(['mean', 'count'])\n#nutri_grade = d.groupby('nutrition_grade_fr').agg(['mean', 'count'])\nplt.title('Average energy according to nutrition_grade_fr')\nplt.bar(nutri_grade.index, nutri_grade['energy_100g']['mean'], color=palette[::-1])","24663ef9":"ds=d2.sample(150000)\nx = pd.DataFrame(ds['energy_100g'], columns=['energy_100g'])\nfig=plt.figure(figsize=(30,15))\nplt.style.use('ggplot')\nplt.title('Energy according to mains nutrients' )\n\nplt.plot(ds['sugars_100g'], x, 'o', label='sugars_100g')\nplt.plot(ds['fat_100g'], x, 'o', label='fat_100g')\nplt.plot(ds['saturated-fat_100g'], x, 'o', label='saturated-fat_100g')\nplt.plot(ds['carbohydrates_100g'], x, 'o', label='carbohydrates_100g')\nplt.plot(ds['proteins_100g'], x, 'o', label='proteins_100g')\nplt.plot(ds['fiber_100g'], x, 'o', label='fiber_100g')\nplt.ylabel('energy_100g')\nplt.plot([0, 100], [0, 3765.6], linewidth=5, linestyle='-', color='pink')# 9 Kcal = 37.656 kJ\nplt.plot([0, 100], [0, 1673.6], linewidth=7, color= 'blue', linestyle='-')# 4 Kcal = 1973.6 kJ\n\nplt.legend(loc='upper left', prop={'size':32})","2b995abc":"nb_sample=10000\n#marker_size=nb_sample*5\/10000\nds=d2.sample(10000)\nsns.set(font_scale=1)\nplt.figure(figsize=(4, 4))\n\nsns.pairplot(ds.loc[:,['fat_100g', 'saturated-fat_100g', 'fiber_100g', 'carbohydrates_100g', 'proteins_100g', 'nutrition_grade_fr' ]], \n             hue='nutrition_grade_fr',\n             hue_order=['e','d','c','b','a'],\n             height=2.5,\n             plot_kws = {'s': 12},\n             palette=legend)\n\nplt.title('Mains nutriments according to nutriment_grade_fr', loc='right')","ab42eed4":"ds=d2.sample(50000)\nplt.figure(figsize=(8,8))\nsns.scatterplot(x=ds['carbohydrates_100g'], \n                y=ds['proteins_100g'], \n                hue=ds['nutrition_grade_fr'],\n                hue_order=['e','d','c','b','a'],\n                legend='full',\n                palette=legend) \nplt.title('Carbohydrate and protein levels according to nutri-grade')","3245c81e":"d_a = d2[(d2['carbohydrates_100g']>56)&(d2['proteins_100g']>20)&(d2['nutrition_grade_fr']=='a')]\nwordclouding(d_a)\nd_a.shape","498c81a8":"#pal_bgrd = sns.color_palette(\"RdYlGn\", 5, desat=0.35)\nda=d2[d2['nutrition_grade_fr']=='a']\nplt.figure(figsize=(8,8))\nplt.style.use('default')\n#plt.set_facecolor(pal_bgrd[0])\n\nsns.scatterplot(x=da['carbohydrates_100g'], \n                y=da['proteins_100g'], #'fiber_100g'\n                hue=da['simple_categ'],\n                hue_order=['plant', 'cake', 'feculent', 'meat_fish', 'beverage', 'milk',\n       'cheese', 'fats', 'juice', 'legume'],\n                legend='full')\n                #palette=legend) \nplt.title(\"the distribution of products 'A' according to the categories\", color=palette[-1])","e79eb912":"l=['b', 'c', 'd', 'e']\npal_bgrd=['#FADBD8', '#FDEBD0', '#FCF3CF', '#D5F5E3', '#A9DFBF']\nfig = plt.figure(figsize=(8,16))\nplt.title('product comparison')  \nplt.style.use('default')\nax = plt.subplot(2,1, 1)\nsns.set(font_scale=0.7)\nax.set_facecolor(pal_bgrd[-1])\nsns.scatterplot(x=da['carbohydrates_100g'], \n                y=da['proteins_100g'], #'fiber_100g'\n                hue=da['simple_categ'],\n                hue_order=['plant', 'cake', 'feculent', 'meat_fish', 'beverage', 'milk',\n       'cheese', 'fats', 'juice', 'legume'],\n                legend='full') \nax.set_title(\"the distribution of products 'A' according to the categories\", fontsize=10)\nfor note in l:\n    sns.set(font_scale=0.5)\n    ds=d2[d2['nutrition_grade_fr']==note]\n    ind=l.index(note)\n    ax = plt.subplot(4, 2, (ind+5))\n    ax.set_facecolor(pal_bgrd[-ind+3])\n    sns.scatterplot(x=ds['carbohydrates_100g'], \n                y=ds['proteins_100g'], #'fiber_100g'\n                hue=ds['simple_categ'],\n                hue_order=['plant', 'cake', 'feculent', 'meat_fish', 'beverage', 'milk',\n       'cheese', 'fats', 'juice', 'legume'],\n                legend='full',)\n                #s=27)\n                \n    ax.set_title(\"the distribution of products '{}'\".format(note.upper()), \n                 fontsize=8)\n                \n      ","ae053172":"wordclouding(d2, label='packaging_tags', sep=',')","0a004b2b":"def organic_class(data, bio=True):\n    \"\"\"organic product clustering attempt'\"\"\"\n    organic_product = []\n    not_organic_product = []\n    i=0\n    for name in data['product_name']:\n        words = str(name).split(\" \")\n        words = [w.lower() for w in words]\n        if ('organic' in words) or ('bio' in words) or ('\u043e\u0440\u0433\u0430\u043d\u0438\u0447\u0435\u0441\u043a\u0438\u0439'in words):\n            \n            organic_product.append(name)\n            i+=1\n        else:\n            words = str(data.iloc[i]['labels_tags']).split('en:')\n            words = [w.lower() for w in words]\n            if ('organic,' in  words) or ('bio' in words):\n                organic_product.append(name)\n                i+=1\n            else:        \n                not_organic_product.append(name)\n                i+=1\n    organic = pd.DataFrame(organic_product, columns=['product_name'])\n    not_organic = pd.DataFrame(not_organic_product, columns=['product_name'])\n    print('We have class {} organic products against {} not organic\\n {}% are organic'.format(organic.shape[0],\n                                                                            not_organic.shape[0],\n                                                                            organic.shape[0]*100\/(organic.shape[0]+not_organic.shape[0]) ))\n    if bio==True:\n        return(pd.merge(data, organic))\n    else:\n        return(pd.merge(data, not_organic))\n\n\n\n","571ec162":"organic = organic_class(d2)\norganic.head(2)","20a0df34":"d2.shape","557eb882":"Given the influence of proteins and carbohydrates on caloric energy, we found a category of products class 'a' rich in energy: the **legumes**.<br>\nThis may explain the difference in caloric averages between products 'a' and 'b'.<br>\n\n**So, as part of healthy food, legumes can help us  to meet our calorie needs**","3eabfc8e":"# 1.4 Search and delete absurd values (Outliers)\nLet's work on the data set that keeps the missing values.<br>\n\u2022 Treatment of negative values <br>\n\u2022 Other outliers (we 'll use the quantiles methode--->d2)<br>\n","5d3eb43e":"# 1.2 Examination of the filling rate of the columns\nDeletion of non-consistent variables<br>\nSome columns do not contain any value.<BR>\nAfter setting a selection criterion (ex: p = 0.02), we removed columns with less than p% non-empty values.\n(For p = 0.02, we go from 162 to 115 columns)","654ffacd":"## Alternative fill rate representation","ea7a2553":"# 2.4 Some tracks to explore","fc185ec7":"Here some nutriment mean can be over-evaluate, let try with a dataframe which nan values are fill by 0.","55f371fe":"Nutrition score fr and uk are equivalent with the exception of some products. The cluster performs previously will help us better understand the graph :","15aacb42":"The nutrition scores Uk and Fr are very close. However, **nutrition-score-uk** is more **forgiving** on **drinks** and **sugar-based products**, while **nutrition-score-fr** is more **indulgent** on **cheeses** and **high-fat products**.<br>\n\n\nFor exemple, let explicit some of these products, in the biggest main categories wich are 'beverages' and 'plant-based-foods-and-beverages' :","a5a72e9f":"# 2 Exploratory Data Analysis\n\n## 2.1 Choice of clustering\n\nWe need to perform cluster because of the diversity of products.\n\n\nLet find a feature which can describe well the type of food. ","638bbdef":"In this EDA, I will focus on **healthy food** in retail. \n# 1 cleaning phase\n## 1.1 First overview of the data set\n## 1.2 Examination of the filling rate of the columns\n        Deletion of non-consistent variables\n        Representation of the filling rate of the columns\n## 1.3 Processing missing numeric values\n        Comparison of different approaches\n        Conclusion\n## 1.4 Search and delete absurd values (Outliers)\n        Case of negative variables\n        Comparison of different methods to remove outliers.\n        Conclusion\n# 2 Exploratory Data Analysis\n## 2.1 Choice of clustering\n##  2.2 Analyze based on our clusters\n        nutriment average per category\n        relation between nutriment_score_fr an nutriment_score_uk\n## 2.3 Nutritional Analysis and Nutriment Grade\n    \u2022 The influence of nutrients on energy\n    \u2022 The Nutrition-Score\n    \u2022 Search specific foods (omega 3, vitamins ...)---to complete\n## 2.4 Some tracks to explore","67983cba":"## 2.2.1 The influence of nutrients on caloric energy\n\n\nThe ACP would tell us that caloric energy is approaching the first factorial.\nLet represent energy according to the main nutrients:","cdff03b4":"# 2.2 Analysis based on our clusters\n## We can see the nutriment average in some categories","a771d4aa":" Let define a fonction which display the averages nutrients by categories.\n","ec9162f8":"We will see that the choice of the completion by 0 of missing values or not will have a major impact in the analysis to come.<br>\n\nSimilarly, the nutrient averages will be different. The average values will be smaller with the completion by 0. Keeping the missing values, we can also over-evaluate some mean.\n\n\n# Conclusion:\n\n-Replacing missing values with 0 decreases sensitivity in multivariate analysis.<BR>\n-If we choose to leave the cells empty, we will have to review the consistency of the variables and increase our selection criterion p.<br>\n-Finally, at this stage, it remains interesting to keep both methods<br>","37a9ca26":"It is found that in a food, the **protein content** rarely exceeds 40%. Similarly, the **fiber content** rarely exceeds 20%. <br>\n**Lipids** provide the most calories (1g = 9 kcal). <br>\n**Carbohydrates** (including sugars) and **proteins** provide an equal calorie count (1g = 4kcal). <br>\nIn addition, the amount of **fiber** is not correlated with the caloric energy.<br>\n**Example** for a product having 40g of carbohydrates one is at least 160 kcal is 670kJ. More if this product also contains lipids or proteins.<br>\n*(The case of carbohydrates inferior to the line y = 16. X corresponds to outliers but also products containing stevia.)*","90333e9f":"### Let's only represent products A by coloring them by category:\n","0782731d":"In plant category (fruits and vegetables) 31% have no  nutritional indication. We should'nt fill 'nan' values by 0 in this category. Maybe we can explain that by the fact fresh product have often no nutrition labels.","bf1aeea6":"Here we see that a high energy caloric penalizes the nutriscore but we note that the lowest energy products on average are not the best ( Class A products are on average more caloric than those class B.). We will understand why...<br>\nFirst, let explicit caloric energy","f4a66233":"Finaly, 'main_category' does not seem very precise, let try on that mysterius feature: 'pnns_groups_2'","6ffee496":"# 1.3 Processing missing numeric values\n\u2022 Should we leave the missing numeric values or complete them with 0?\n\n*My first choice was to complete the missing nutrient values with 0's.\nIt can be assumed that the label of a product only specifies the amount of nutrients present in the product. For example, we do not need to specify that a meat does not contain caffeine.\nHowever, a problem arises ....*\n","5b48447b":"##  We could favour organic products","80ca7eba":"In this part, we 'll essentialy explain the following graph:","7044b56b":"Before using this function, we will create a reference dataframe which indicate the percentage of product with no nutritional value. So we will be able to estimate if it is better to complete the missing nutritional values or not.","633fcd13":"The 'main_category' variable only affects 29% of products, but it has a very generic name that will facilitate classification.","2095da63":"## Fill rate representation","b16c70b4":"### Better ranked in France:","d5077dda":"## Let compare this distribution with the other products","5547e000":"And finally let create our new feature call 'simple_categ' :","625f4c82":"# 2.2 Nutritional Analysis and Nutriment Grade\n\nThe **nutriment score** is calculate with a point system. It is penalized by the sugar content, saturated fat, sodium, caloric energy and favored by the proportion of fruits and vegetables, fiber and protein.<br>\nThe **nutriment grade** is a **simplification** of nutriment score for customers:<br>\n**A**<=-1<br>\n-1<**B**<=3<br>\n3<**C**<=11<br>\n11<**D**<=16<br>\n16<**E**\n","46c9fa29":"\n\u2022 Treatment of negative values <br>","022c345f":"## Let see the difference between nutrition_score_fr and nutrition_score_uk","61fb9b5f":"Now we can define a dictionnary with more general categories for our clustering:","29e62ce6":"## Packaging\nProducts in plastic packaging could be avoided. (In addition to the pollution generated, some plastics are known to be endocrine disruptors)","899f708c":"### Better ranked in United Kingdom :","7d240a5a":"## 2.2.2 Influence of nutriment on 'nutrition_grade_fr'","96ba4bbf":"Let see all the columns for few product:","41f467ca":"*rq: I chose to keep some low values like caffeine, fluoride, These may be exploited with an appropriate cluster ...*","3971615c":"And here are our clustering functions:","9d23d82a":"In this graph, we see how the level of fats and particularly that of saturated fats penalizes the nutriscore.\nThe carbohydrate level does not seem to affect the nutriscore.\n\nSome of the good foods are rich in protein and carbohydrates (so rich in caloric energy):","f24b5eb9":"Let use quantiles methode with d2  wich is more quick for our publication.<br>\nNutrition_score_** columns have no outliers so i'll keep theme intact for our futur analyse."}}