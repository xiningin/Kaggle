{"cell_type":{"c595f175":"code","c4c31e83":"code","f8fb9206":"code","ef01800b":"code","9b730def":"code","c364ec0b":"code","900b4b57":"code","d266c172":"code","f883c1e6":"code","bafa2e69":"code","f42ee286":"code","c6e8d84f":"code","cb93b65c":"markdown","a5df4ac9":"markdown","899d2f73":"markdown","1c3302ed":"markdown","07397d11":"markdown","b4c861cc":"markdown","30c8b52e":"markdown","5ad39c31":"markdown","f9eb7b14":"markdown","eaedede6":"markdown","492fec93":"markdown","40faad9f":"markdown","892c1e6c":"markdown","b8208c53":"markdown","25cef44a":"markdown","2a3cb4cc":"markdown","a6ab39a7":"markdown","b6696125":"markdown"},"source":{"c595f175":"!pip install bottleneck-transformer-pytorch","c4c31e83":"import torch\nfrom torch import nn\nfrom torchvision.models import resnet50\n\nfrom bottleneck_transformer_pytorch import BottleStack\n","f8fb9206":"from fastai.vision.all import *\n\nimport pandas as pd","ef01800b":"data = pd.read_csv(\"..\/input\/ranzcr-clip-catheter-line-classification\/train_annotations.csv\")\ndata.head()","9b730def":"path = \"..\/input\/ranzcr-clip-catheter-line-classification\"\n\ndef get_x(r):\n    return path + \"\/\" + 'train' + \"\/\" + r['StudyInstanceUID'] + \".jpg\"\n\ndef get_y(r):\n    return r['label']","c364ec0b":"def getblock(size=256,batch=3, data_df=data):\n    block = DataBlock(blocks=(ImageBlock, CategoryBlock),\n                      splitter=RandomSplitter(seed=42),\n                      get_x=get_x, # Using the function above.\n                      get_y=get_y, # Using the function above.\n                      item_tfms = RandomResizedCrop(256), # Resizing images to 400 pixels.\n                      \n                      # Data Augmentation time:\n                      batch_tfms = [*aug_transforms(mult=1.0, do_flip=False,\n                                                   flip_vert=False, max_rotate=0,\n                                                   min_zoom=1.0, max_zoom=1.0,\n                                                   pad_mode=\"zeros\",\n                                                   xtra_tfms=None,max_warp=0,\n                                                   p_affine=0, p_lighting=0),\n                                    Normalize.from_stats(*imagenet_stats)])\n    \n    return block.dataloaders(data_df, bs=batch)\n                      \n    ","900b4b57":"dataloader = getblock()","d266c172":"dataloader.show_batch()","f883c1e6":"layer = BottleStack(\n    dim = 256,\n    fmap_size = 64,        # set specifically for imagenet's 224 x 224\n    dim_out = 2048,\n    proj_factor = 4,\n    downsample = True,\n    heads = 4,\n    dim_head = 128,\n    rel_pos_emb = True,\n    activation = nn.ReLU()\n)\n\nresnet = resnet50()\n\n# model surgery\n\nbackbone = list(resnet.children())\n\nmodel = nn.Sequential(\n    *backbone[:5],\n    layer,\n    nn.AdaptiveAvgPool2d((1, 1)),\n    nn.Flatten(1),\n    nn.Linear(2048, 1000)\n)","bafa2e69":"learn = Learner(dataloader, model, metrics = accuracy)","f42ee286":"learn.lr_find()","c6e8d84f":"learn.fine_tune(2, 0.0006918309954926372)\n# The above LR was suggested by the lr_find.","cb93b65c":"### Finally setting up the Dataloader for FastAI.\n### Well below you can see we got a lot of hyperparmeter tuning. Hit me up on [LinkedIn](https:\/\/www.linkedin.com\/in\/vyom-bhatia-40ba79181\/) on [Instagram](https:\/\/instagram.com\/vyombhatia) if you got any questions.","a5df4ac9":"# Learning Rate Finder","899d2f73":"# Building the model","1c3302ed":"### Easy Peasy grab a resnet50 on top of the BotNet and train the model using transfer learning:","07397d11":"# Importing Libraries + Data","b4c861cc":"#### Reading the CSV with annotations.","30c8b52e":"### Yes Karen, I know that the accuracy sucks with BotNet and my current hyperparameters for data augmentation. But this was just a little experimenting with the BotNet.\n\n### A little background about me?\n\n### I am an 18-year-old business major, Fresher at Delhi University. Thank you. Love from India.","5ad39c31":"### Lets see how the data augmentations is doing:","f9eb7b14":"<div style=\"margin-left:50px;margin-right:50px;\">\n<center><div style=\"background:url(https:\/\/www.teahub.io\/photos\/full\/19-197024_backgrounds-medical-hd-best-free-medicine-wallpapers-medicine.jpg); border-radius:8px;padding:20px; color:white;\"><h1 style=\"font-size: 40px;\">REMINDER<\/h1><\/div><br>\n<p style=\"font-size:20px;margin-left:50px;margin-right:50px;\">If you are planning to fork this, upvote and link me! :D<\/p><\/center><\/div>","eaedede6":"<center><p style=\"font-size:20px;margin-left:50px;margin-right:50px;\">\n\u2601\u2601\ud83c\udf30\ud83c\udf30\ud83c\udf30\u2601\u2601<br>\n\u2601\u2601\ud83d\udc42\ud83d\udc40\ud83d\udc42\u2601\u2601<br>\n\u2601\u2601\ud83d\udc4d\ud83d\udc43\ud83d\udc4d\u2601\u2601<br>\n\u2601\u2601\ud83d\udc4d\u3030\ud83d\udc4d\u2601\u2601<br>\n\u2601\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\u2601<br>\n\ud83d\udd35\ud83d\udd35\ud83d\udd34\ud83d\udc9b\ud83d\udd34\ud83d\udd35\ud83d\udd35<br>\n\ud83d\udd35\u2601\ud83d\udd35\u2063\ud83d\udd34\ud83d\udd35\u2601\ud83d\udd35<br>\n\ud83d\udd35\u2601\ud83d\udd35\ud83d\udd35\ud83d\udd35\u2601\ud83d\udd35<br>\n\ud83d\udc47\u2601\ud83d\udd34\ud83d\udd34\ud83d\udd34\u2601\ud83d\udc47<br>\n\u2601\u2601\ud83d\udd35\ud83d\udd34\ud83d\udd35\u2601\u2601<br>\n\u2601\u2601\ud83d\udd35\u2601\ud83d\udd35\u2601\u2601<br>\n\u2601\u2601\ud83d\udd35\u2601\ud83d\udd35\u2601\u2601<br>\n\u2601\u2601\ud83d\udc62\u2601\ud83d\udc62\u2601\u2601<br>\n\n Random Superman Image with Emojis<\/p><\/center>","492fec93":"# Forming the Dataloader","40faad9f":"<div style=\"margin-left:50px;margin-right:50px;\">\n<center><div style=\"background:url(https:\/\/www.teahub.io\/photos\/full\/19-197024_backgrounds-medical-hd-best-free-medicine-wallpapers-medicine.jpg); border-radius:8px;padding:20px; color:white;\"><h1 style=\"font-size: 40px;\">DATA EXPLANATION VIDEO<\/h1><\/div><br>\n    <p style=\"font-size:20px\">Did I actually sit down to discuss this competetion with myself? You bet I did.<br><br><a hreaf=\"https:\/\/www.linkedin.com\/posts\/vyom-bhatia-40ba79181_computervision-activity-6747848578720419840-wMNc\">Check it out here on LinkedIn.<\/a><\/p><\/div>\n   ","892c1e6c":"### Installing the Bottleneck Transformer:","b8208c53":"<div style=\"margin-left:50px;margin-right:50px;\">\n<center><div style=\"background:url(https:\/\/www.teahub.io\/photos\/full\/19-197024_backgrounds-medical-hd-best-free-medicine-wallpapers-medicine.jpg); border-radius:8px;padding:20px; color:white;\"><h1 style=\"font-size: 40px;\">TIME TO CODE<\/h1><\/div><br>\n<p style=\"font-size:20px;margin-left:50px;margin-right:50px;\">The point is simple, we need a model to solve the problem, let's build one. <br>\nWe will be using the latest <a href=\"https:\/\/paperswithcode.com\/paper\/bottleneck-transformers-for-visual\">Bottleneck Transformers<\/a>!<br><br>Also,<br><br>I have my semesters in 15 days and I haven't really studied anything, just busy building models ;) <br>I have no idea what I am going to do :D<\/p><\/center><\/div>","25cef44a":"### Importing Stuff:","2a3cb4cc":"### Defining the functions to grab those files.","a6ab39a7":"# Visualizing","b6696125":"### I absolutely love this function from the FastAI library. \n### Why? It finds you the best Learning Rate."}}