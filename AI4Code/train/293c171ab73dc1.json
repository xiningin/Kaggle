{"cell_type":{"84274a2d":"code","1bf908ac":"code","97dc76b2":"code","0192cd63":"code","d9ef592a":"code","53cd4f70":"code","58b81bd7":"code","7bc30579":"code","7c47dd85":"code","a9b6aa0e":"code","b77f918c":"code","584daffb":"code","8ea232f4":"code","5eb431a9":"code","031ca353":"code","ea5816fc":"code","3da564d6":"code","05cd2ea9":"code","8cd950fa":"code","e8263c4a":"code","ad9ff367":"code","2d374eaa":"code","884d3492":"code","f0421568":"code","67998191":"code","76a73dc8":"code","bc4ed0d0":"code","5e0e7dc0":"code","3dcb6458":"code","9d6aecd6":"code","8b292846":"code","c9ee4fa9":"code","c784e2d4":"code","da884603":"code","884a58bc":"code","df9b2c12":"code","6bb03eec":"code","d2e57ded":"code","58e3da48":"code","c538e5da":"code","f1e99d05":"code","9378bdca":"code","6ef15939":"code","956ef7a1":"code","6375b584":"code","33ca585f":"code","005cde0a":"code","f35c2063":"markdown","d5c345ec":"markdown","715f220c":"markdown","f3a291e4":"markdown","07a642b2":"markdown","0c8412c9":"markdown","de36d24e":"markdown","a97f8bfe":"markdown","048cbd5d":"markdown","5edf6939":"markdown","1c9cc685":"markdown","b0d3d547":"markdown","7fcb8c28":"markdown","3d1210d4":"markdown","03f7d434":"markdown","1b2215f3":"markdown","6bacf708":"markdown","915dad5a":"markdown","6c9eea09":"markdown","8719e891":"markdown","d03a37bf":"markdown","91ec95f5":"markdown","2b075489":"markdown","58cb75e7":"markdown","a21ed30f":"markdown"},"source":{"84274a2d":"import pandas as pd\nimport numpy as py\nfrom matplotlib import pyplot as plt\nimport seaborn as sns\nimport numpy as np","1bf908ac":"#test data\ntest = pd.read_csv(\"..\/input\/GiveMeSomeCredit\/cs-test.csv\")","97dc76b2":"#train data\ntraining = pd.read_csv(\"..\/input\/GiveMeSomeCredit\/cs-training.csv\")","0192cd63":"#data dictionary\ndata_dictionary = pd.read_excel(\"..\/input\/GiveMeSomeCredit\/Data Dictionary.xls\")","d9ef592a":"training.head(10)","53cd4f70":"training.isna().sum()","58b81bd7":"test.isna().sum()","7bc30579":"sns.barplot(x=training['SeriousDlqin2yrs'].value_counts().index,y=training['SeriousDlqin2yrs'].value_counts())\nplt.title(\"Distribution of the Defaulters in the data\")","7c47dd85":"print(\"Minimum Age\",training.age.min())\nprint(\"Maximum Age\",training.age.max())\nprint(\"Median Age\",training.age.median())\nprint(\"Mean Age\",training.age.mean())\nprint(\"Mode Age\",training.age.mode()[0])\n\nsns.distplot(training['age'],bins=10)","a9b6aa0e":"training.loc[training['age'] == 0, 'age']","b77f918c":"training.loc[training['age'] == 0, 'age'] = training.age.mode()[0]","584daffb":"default_0 = training[training['SeriousDlqin2yrs'] == 0]\nsns.distplot(default_0['age'],bins=7)","8ea232f4":"default_1 = training[training['SeriousDlqin2yrs'] == 1]\nsns.distplot(default_1['age'],bins=7)","5eb431a9":"sns.scatterplot(x=training['DebtRatio'],y=training['age'])","031ca353":"sns.scatterplot(x=training['DebtRatio'],y=training['RevolvingUtilizationOfUnsecuredLines'])","ea5816fc":"training['MonthlyIncome'].describe()","3da564d6":"monthly_income_less_10000 = training[training['MonthlyIncome'] < training['MonthlyIncome'].quantile(0.99)]","05cd2ea9":"sns.scatterplot(x=monthly_income_less_10000['MonthlyIncome'],y=monthly_income_less_10000['NumberOfOpenCreditLinesAndLoans'])","8cd950fa":"f, ax = plt.subplots(figsize=(10, 8))\ncorr = training.corr()\nsns.heatmap(corr, mask=np.zeros_like(corr, dtype=np.bool), cmap=sns.diverging_palette(220, 10, as_cmap=True),\n            square=True, ax=ax)","e8263c4a":"print(\"Minimum MonthlyIncome\",training.MonthlyIncome.min())\nprint(\"Maximum MonthlyIncome\",training.MonthlyIncome.max())\nprint(\"Median MonthlyIncome\",training.MonthlyIncome.median())\nprint(\"Mean MonthlyIncome\",training.MonthlyIncome.mean())\nprint(\"Mode MonthlyIncome\",training.MonthlyIncome.mode()[0])\nprint(\"Null Values\",training.MonthlyIncome.isna().sum())\n\nsns.distplot(training['MonthlyIncome'])","ad9ff367":"training.loc[training.MonthlyIncome.isna(),'MonthlyIncome'] = training.MonthlyIncome.median()","2d374eaa":"print(\"Minimum NumberOfDependents\",training.NumberOfDependents.min())\nprint(\"Maximum NumberOfDependents\",training.NumberOfDependents.max())\nprint(\"Median NumberOfDependents\",training.NumberOfDependents.median())\nprint(\"Mean NumberOfDependents\",training.NumberOfDependents.mean())\nprint(\"Mode NumberOfDependents\",training.NumberOfDependents.mode()[0])\nprint(\"Null Values\",training.NumberOfDependents.isna().sum())\n\nsns.distplot(training['NumberOfDependents'])","884d3492":"training.loc[training.NumberOfDependents.isna(),'NumberOfDependents'] = training.NumberOfDependents.median()","f0421568":"sns.barplot(x=training['NumberOfTime30-59DaysPastDueNotWorse'].value_counts().index,y=training['NumberOfTime30-59DaysPastDueNotWorse'].value_counts())","67998191":"training.isna().sum()","76a73dc8":"#Spliting of Data:\nfrom sklearn.model_selection import train_test_split\nimport xgboost as xgb\nfrom sklearn.metrics import auc, accuracy_score, confusion_matrix, mean_squared_error,roc_curve","bc4ed0d0":"y = training.loc[:,training.columns.isin(['SeriousDlqin2yrs'])]\nX_attributes=[\n       'RevolvingUtilizationOfUnsecuredLines', 'age',\n       'NumberOfTime30-59DaysPastDueNotWorse', 'DebtRatio', 'MonthlyIncome',\n       'NumberOfOpenCreditLinesAndLoans', 'NumberOfTimes90DaysLate',\n       'NumberRealEstateLoansOrLines',\n       'NumberOfDependents'] # Excluding NumberOfTime60-89DaysPastDueNotWorse' because of strong collinearity\nX = training.loc[:,training.columns.isin(X_attributes)]","5e0e7dc0":"X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.20, random_state=42)","3dcb6458":"xgb_model = xgb.XGBClassifier(objective=\"binary:logistic\",random_state=42)","9d6aecd6":"xgb_model.fit(X_train,y_train.values.ravel())","8b292846":"y_pred = xgb_model.predict(X_test)\ny_probab = xgb_model.predict_proba(X_test)","c9ee4fa9":"accuracy_score(y_pred,y_test)","c784e2d4":"#Feature Importance Plot\nfeature_important = xgb_model.get_booster().get_score(importance_type='weight')\nkeys = list(feature_important.keys())\nvalues = list(feature_important.values())\ndata = pd.DataFrame(data=values, index=keys, columns=[\"score\"]).sort_values(by = \"score\", ascending=False)\ndata.plot(kind='barh')","da884603":"def plot_roc(y_test,probs):\n    fpr, tpr, thresholds = roc_curve(y_test, probs)\n    plt.plot([0, 1], [0, 1], linestyle='--')\n    plt.plot(fpr, tpr, marker='.')\n    plt.title(\"ROC curve\")\n    plt.xlabel('false positive rate')\n    plt.ylabel('true positive rate')\n    plt.show()","884a58bc":"plot_roc(y_test,y_probab[:,1])","df9b2c12":"test.isna().sum()","6bb03eec":"test.loc[test['MonthlyIncome'].isna(),'MonthlyIncome'] = test['MonthlyIncome'].dropna().median()\ntest.loc[test['NumberOfDependents'].isna(),'NumberOfDependents'] = test['NumberOfDependents'].dropna().mode()","d2e57ded":"test_proba = xgb_model.predict_proba(test.loc[:,test.columns.isin(X_attributes)])","58e3da48":"len(np.arange(1,len(test_proba)+1))","c538e5da":"len(test_proba)","f1e99d05":"df = pd.DataFrame({'Id':np.arange(1,len(test_proba)+1),'Probability':test_proba[:,1]})","9378bdca":"#Test data predicitions\ndf","6ef15939":"!pwd","956ef7a1":"df.to_csv('submission.csv', index = False)","6375b584":"import shap\n\nmybooster=xgb_model.get_booster()\n\nmodel_bytearray = mybooster.save_raw()[4:]\n\ndef myfun(self=None):\n    return model_bytearray\n\nmybooster.save_raw = myfun","33ca585f":"explainerXGB = shap.TreeExplainer(mybooster)","005cde0a":"shap_values = explainerXGB.shap_values(X_train.loc[:,X_train.columns.isin(feature_important)])\nshap.summary_plot(\n    shap_values,\n    X_train.loc[:,X_train.columns.isin(feature_important)],\n    max_display=110,\n    show=True,\n)","f35c2063":"Exploratory Data Analysis","d5c345ec":"**ANALYSIS OF AGE**","715f220c":"Making Predictions on Test Data..!!","f3a291e4":"As we have many outliers in the data for Monthly Income we would be replacing the nulls in the Monthly income with the Median Value of the Monthly Income.","07a642b2":"**MONTHLY INCOME**","0c8412c9":"NumberOfOpenCreditLinesAndLoans vs Monthly Income","de36d24e":"Checking for the age distribution for the defaulters and non-defaulters","a97f8bfe":"DebtRatio vs RevolvingUtilizationOfUnsecuredLines","048cbd5d":"<br>","5edf6939":"Now that there are no null values we would be starting with modeling of data.\n","1c9cc685":"<br>","b0d3d547":"**Number of Dependents**","7fcb8c28":"People with age group between 35 - 55 are the major defaulters in the data","3d1210d4":"**Correlation Plot:**","03f7d434":"Null Values in Monthly Income and Number of Dependents : Need to do cleaning of the data before modeling.","1b2215f3":"Numberoftime90daysLate is highly correlated with NumberofTime60-89DaysPastDueNotWorse as both of the variables are denoting the defaulters days.","6bacf708":"DebtRatio vs Age","915dad5a":"It can be observed that the data includes a record with age = 0 which is not a valid age ,updating the record with mode age of 49.","6c9eea09":"**XGBoost Classifier**","8719e891":"The above SHAP summary plot for the XGBOost Model \n\n- Higher the RevolvingUtilizationofUnsecuredLines higher the defaulter probability\n- Higher the number of times the borrower has past due more is the probability of being a defaulter.\n- Lower the age high are the likelihood of being defaulter\n- With more number of open credit lines and loans high are probability for being a defaulter. \n- Lower the Monthly Income higher the chances of being a defaulter\n- Higher the Number of dependents and realestate loans more the probability of being a defaulter.","d03a37bf":"As there are many outliers in the NumberOfdependents it is better to replace the nulls of the data with the required median value of 0.","91ec95f5":"MODEL INTERPRETATION WITH SHAP","2b075489":"<br>","58cb75e7":"Improve on the state of the art in credit scoring by predicting the probability that somebody will experience financial distress in the next two years.The goal of this analysis is to build a model that borrowers can use to help make the best financial decisions.","a21ed30f":"Import Data"}}