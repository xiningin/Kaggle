{"cell_type":{"749ac99b":"code","8dce747e":"code","4ff28e77":"code","d888f849":"code","6627fb89":"code","08025875":"code","5bff4a66":"code","37257a62":"code","b4206c3b":"code","cf5fcbd2":"code","03de201e":"code","90249add":"code","aabe6662":"code","3ed80b16":"code","12330fbc":"code","d6d5a54c":"code","b14a2c3a":"code","46aea357":"code","7de46095":"code","60f56d3a":"code","bbede4fc":"code","e0036ba0":"code","6d21bedf":"code","3b58170c":"code","328c6086":"code","7dacd783":"code","11186eb4":"code","143055c4":"code","ac49b85e":"code","9befed8e":"code","887f09c6":"code","1a777ca7":"code","bacc7e69":"code","255ad717":"markdown","dac1fbf4":"markdown","38a42475":"markdown","8b06ed67":"markdown","7d5a4f18":"markdown","e5a1a34c":"markdown","b452b082":"markdown","5eb8d0a0":"markdown","67a5e0c1":"markdown","2032d24c":"markdown","d32bc861":"markdown","375e82ff":"markdown","4341a83f":"markdown","68ebdc1f":"markdown","26f8e5ac":"markdown","6b4ee0ac":"markdown","0daec0ac":"markdown","e8b27f22":"markdown","9423713b":"markdown","fc2dfa41":"markdown","99617985":"markdown","148ced9a":"markdown","8f2b4af4":"markdown","2afbedb4":"markdown"},"source":{"749ac99b":"import os\nimport warnings  \nwarnings.filterwarnings('ignore')\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport pandas as pd\nimport seaborn as sns\nfrom scipy import stats\nfrom scipy.stats import norm, skew \nfrom sklearn import metrics\nfrom sklearn.metrics import mean_absolute_error\nfrom sklearn.metrics import mean_squared_error     \nfrom sklearn.metrics import r2_score\n\n\n\ndataset = pd.read_csv(\"..\/input\/diamonds.csv\")\n","8dce747e":"dataset.describe()","4ff28e77":"dataset = dataset.drop('Unnamed: 0', axis=1)","d888f849":"dataset[['x','y','z']] = dataset[['x','y','z']].replace(0,np.NaN)\ndataset.isnull().sum()\ndataset.dropna(inplace=True)\n\n\n\ndataset['volume'] = dataset['x']*dataset['y']*dataset['z']   \ndataset.drop(['x','y','z'], axis=1, inplace= True)\n","6627fb89":"sns.distplot(dataset[\"price\"] , fit = norm)","08025875":"sns.boxplot(x = dataset['price'])","5bff4a66":"sns.distplot(dataset[\"carat\"] , fit = norm)","37257a62":"sns.scatterplot( x = dataset['carat'] , y = dataset['price'])","b4206c3b":"sns.boxplot( x = dataset['carat'])\n","cf5fcbd2":"dataset = dataset.drop(dataset[(dataset['carat']>1.99)].index)\n\nsns.boxplot( x = dataset['carat'])\n","03de201e":"sns.distplot(dataset[\"carat\"] , fit = norm)","90249add":"sns.distplot(dataset[\"volume\"] , fit = norm)","aabe6662":"sns.scatterplot(x = dataset['volume'] , y = dataset['price'])\n","3ed80b16":"sns.boxplot(dataset['volume'])","12330fbc":"dataset = dataset.drop(dataset[(dataset['volume'] > 299)].index)\n\nsns.boxplot(dataset['volume'])\n","d6d5a54c":"sns.countplot( x = dataset['cut'])\n","b14a2c3a":"sns.countplot( x = dataset['color'])","46aea357":"sns.countplot( x = dataset['clarity'])\n","7de46095":"sns.boxplot(x='clarity', y='price', data=dataset ) \n","60f56d3a":"dataset = pd.get_dummies(dataset , drop_first = True)","bbede4fc":"y = dataset['price'].values\n\nX = dataset.drop(['price'], axis=1)     \n\n\n\nfrom sklearn.preprocessing import RobustScaler \nrb = RobustScaler()\nX_scaled = rb.fit_transform(X)\n\nX_scaled = pd.DataFrame(X_scaled, columns = X.columns)  #--> rename columns after scaling\nX = X_scaled\n\n","e0036ba0":"plt.figure(figsize=(15,15))\nplt.title('Correlation Map')\nax=sns.heatmap(dataset.corr(),\n               linewidth=2.1,\n               annot=True,\n               center=1)","6d21bedf":"for v in X.columns:\n    variance = X.var()\nvariance = variance.sort_values(ascending = False)\n   \nplt.figure(figsize=(12,5))\nplt.plot(variance)  \n","3b58170c":"variance","328c6086":"from sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.2, random_state = 42)","7dacd783":"from sklearn.model_selection import train_test_split\nX_train, X_valid, y_train, y_valid = train_test_split(X_train, y_train, test_size = 0.25, random_state = 42)\n","11186eb4":"from sklearn.linear_model import LinearRegression\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.ensemble import RandomForestRegressor\nfrom xgboost import XGBRegressor\nfrom sklearn.ensemble import ExtraTreesRegressor\nfrom sklearn.neighbors import KNeighborsRegressor\nfrom sklearn.svm import SVR\n\n\nregressors = [['Linear Regression :' , LinearRegression()],\n       ['Decision Tree Regression :' , DecisionTreeRegressor()],\n       ['Random Forest Regression :' , RandomForestRegressor()],\n       [' XGB :' , XGBRegressor()] ,\n       ['K-Neighbors Regression :', KNeighborsRegressor()],\n       ['Support Vector Regression :', SVR()]   \n       ]\n\nfor name,model in regressors:\n        \n    model = model      \n    \n    model.fit(X_train,y_train)\n    \n    y_pred_train = model.predict(X_train)  \n    \n    y_pred_valid = model.predict(X_valid)\n        \n\n    print('-----------------------------------')\n    print(name)\n    \n    print(' --TRAINING SET --')\n    print('MAE:', mean_absolute_error(y_train , y_pred_train))\n    print('R2 :', r2_score(y_train , y_pred_train))\n\n    print('-----------------------------------')    \n    print(' --VALIDATION SET --')\n    print('MAE:', mean_absolute_error(y_valid, y_pred_valid))\n    print('R2 :', r2_score(y_valid , y_pred_valid))\n    print('---------------------------------')\n","143055c4":"model = XGBRegressor()\nmodel.fit( X_train , y_train)\n\n\nimportances = model.feature_importances_\nindex = np.argsort(importances)[::-1][0:15]\nfeature_names = X.columns.values\n\nplt.figure(figsize=(10,5))\nsns.barplot(x = feature_names[index], y = importances[index])\nplt.title(\" XGB - Top important features \")\n\n","ac49b85e":"\nmodel = RandomForestRegressor()\nmodel.fit( X_train , y_train)\n\n\nimportances = model.feature_importances_\nindex = np.argsort(importances)[::-1][0:15]\nfeature_names = X.columns.values\n\nplt.figure(figsize=(10,5))\nsns.barplot(x = feature_names[index], y = importances[index])\nplt.title(\" Random Forest - Top important features \")\n\n","9befed8e":"from sklearn.model_selection import RandomizedSearchCV\n\n\ncolsample_bylevel = [1 , 0.5]\ncolsample_bytree = [1 , 0.5]\ngamma = [0 , 1 , 5]\nlearning_rate = [  0.01 , 0.0125 , 0.001] \nmax_depth = [ 1 , 5 , 10 ]\nmin_child_weight = [1]\nn_estimators = [ 250 , 500 , 750 , 1000]   \nrandom_state = [42]     \nreg_alpha = [0, 1]\nreg_lambda = [0 , 1]\nscale_pos_weight = [1]\nsubsample = [0.5, 0.8 ,  1 ]\n\n\nparam_distributions = dict(\n                           colsample_bylevel = colsample_bylevel,\n                           colsample_bytree = colsample_bytree,\n                           gamma = gamma, \n                           learning_rate = learning_rate,\n                           max_depth = max_depth,\n                           min_child_weight = min_child_weight,\n                           n_estimators = n_estimators,\n                           random_state = random_state,\n                           reg_alpha = reg_alpha,\n                           reg_lambda = reg_lambda,\n                           scale_pos_weight = scale_pos_weight,\n                           subsample = subsample , \n                           \n                           ) \n\n\n\nestimator = XGBRegressor()     \n\n\nRandomCV = RandomizedSearchCV(\n                            estimator = estimator,         \n                            param_distributions = param_distributions,\n                            n_iter = 10,\n                            cv = 5,\n                            scoring = \"neg_mean_absolute_error\" ,  #'r2', \n                            random_state = 42, \n                            verbose = 1, \n                            n_jobs = -1,\n                            )\n\n\n\nhyper_model = RandomCV.fit(X_train, y_train)      ","887f09c6":"           \nprint('Best Score: ', hyper_model.best_score_)    \n\nprint('Best Params: ', hyper_model.best_params_)\n\n\nhyper_model.best_estimator_.fit(X_train , y_train)","1a777ca7":"\n\ny_pred_train_hyper = hyper_model.predict(X_train)  \n\ny_pred_valid_hyper = hyper_model.predict(X_valid)  \n\n\n\nprint(' -- HYPER TRAIN --')\nprint('MAE:', mean_absolute_error ( y_train , y_pred_train_hyper))\nprint('R2 :', r2_score ( y_train , y_pred_train_hyper))\n\n\nprint('-----------------------------------')    \nprint(' -- HYPER VALIDATION  --')\nprint('MAE:', mean_absolute_error(y_valid, y_pred_valid_hyper))\nprint('R2 :', r2_score(y_valid , y_pred_valid_hyper))\nprint('---------------------------------')\n","bacc7e69":"y_pred_hyper = hyper_model.predict(X_test)  \n\n\nprint('-----------------------------------')    \nprint(' -- HYPER TEST --')\nprint('MAE:', mean_absolute_error(y_test, y_pred_hyper))\nprint('R2 :', r2_score(y_test , y_pred_hyper))\nprint('---------------------------------')\n","255ad717":"1. Eliminate carat > 1.99 to eliminate outliers.\n\n","dac1fbf4":"# ***Preprocessing***","38a42475":"***COLOR VS PRICE***","8b06ed67":"***CUT VS PRICE***","7d5a4f18":"Eliminate Volume > 299","e5a1a34c":"There's seems to be some min values of x,y,z that are zeros. It can't be possible because x,y,z rapresent volume\naxis. \nIs no possible to have an axis <= 0 , so let's drop 0 values and create a new Volume column : \nVolume column = x * y * z\n\n\n","b452b082":"If you have any advice\/suggestion, let me know in the comments and upvote!\nThank you!","5eb8d0a0":"Train - Validation split","67a5e0c1":"XGB Hyperparameters","2032d24c":"Check Correlation","d32bc861":"# ***RandomizedSearchCV*** ","375e82ff":"# ***EDA***","4341a83f":"***CLARITY VS PRICE***","68ebdc1f":"If you have any advice\/suggestion, let me know in the comments and upvote!\nThank you!","26f8e5ac":"Final pred on Y test","6b4ee0ac":"Train - Test split","0daec0ac":"***Features***\n\nCarat : Carat weight of the Diamond.\n\nCut : Describe cut quality of the diamond.\n\nColor : Color of the Diamond.\n\nClarity : Diamond Clarity refers to the absence of the Inclusions and Blemishes.\n\nDepth : The Height of a Diamond, measured from the Culet to the table, divided by its average Girdle Diameter.\n\nTable : The Width of the Diamond's Table expressed as a Percentage of its Average Diameter.\n\nPrice : the Price of the Diamond.\n\nX : Length of the Diamond in mm.\n\nY : Width of the Diamond in mm.\n\nZ : Height of the Diamond in mm.\n","e8b27f22":"***CARAT VS PRICE***","9423713b":"<img style=\"float: left;\" src=\"https:\/\/upload.wikimedia.org\/wikipedia\/en\/thumb\/6\/6d\/Hirst-Love-Of-God.jpg\/220px-Hirst-Love-Of-God.jpg\" width=\"400px\"\/>","fc2dfa41":"***VOLUME VS PRICE***","99617985":"Check features variance","148ced9a":"Features Importance","8f2b4af4":"***For the Love of God - Damien Hirst***","2afbedb4":"# ***Regression Models***"}}