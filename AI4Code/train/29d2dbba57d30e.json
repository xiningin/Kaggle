{"cell_type":{"5bb55adc":"code","c9464c73":"code","efa11a81":"code","f641c426":"code","e967ceed":"code","a95e1e45":"code","cc6cedbf":"code","925a3e02":"code","05860266":"code","cbd59f7d":"code","08684772":"code","33ab56da":"code","6d547bf9":"code","82f275c4":"code","7722730c":"code","93c20986":"code","76e4da67":"code","e90cb756":"code","b4db0ae4":"code","98c454ca":"code","bb6dc0a5":"code","a6e7c209":"code","91ccc844":"code","4754c579":"code","9f0da915":"code","96be869e":"code","2c0514c1":"code","076ec165":"code","1a683a26":"code","6835d669":"code","95dcc3ed":"code","5e089ec4":"code","7fd5d6f5":"code","ec4a4f0f":"code","b3732ae8":"code","b034eb25":"code","4e3de084":"code","d845eb67":"code","2a2bb7fd":"code","28e81600":"code","111d0f17":"code","5fae5011":"code","e4cbd271":"code","73a6c34f":"code","50fc2a22":"markdown","69ece759":"markdown","8cac427d":"markdown","ec2dc8cf":"markdown","1eef034f":"markdown","9311cbf0":"markdown","0edb00fd":"markdown","2c34f2d2":"markdown","78f453eb":"markdown","9777d05b":"markdown","c2af91a3":"markdown","e5b77bf1":"markdown","1b65405a":"markdown","2120492c":"markdown","e3199b1d":"markdown","9a7a2db2":"markdown","f46a5ac1":"markdown","82bb8bb8":"markdown","0a9ed775":"markdown","9dad8904":"markdown","f425e05a":"markdown","8ebc8965":"markdown","cc5d1e9e":"markdown","5ea93495":"markdown","11706403":"markdown","0f97930c":"markdown","192f3caa":"markdown","06b80453":"markdown","013162e0":"markdown","2f2beb2b":"markdown","a92d4117":"markdown","0afabd6e":"markdown","890e0ea9":"markdown","4ddb60d4":"markdown","9188ae48":"markdown","44740705":"markdown"},"source":{"5bb55adc":"import os\nimport numpy as np\nimport pandas as pd\nfrom matplotlib import pyplot as plt\nfrom matplotlib import style\nimport seaborn as sns\nfrom sklearn.cluster import KMeans\nfrom sklearn.metrics import silhouette_samples, silhouette_score\nfrom sklearn.preprocessing import StandardScaler\nfrom matplotlib.ticker import MaxNLocator\nfrom statsmodels.formula.api import ols","c9464c73":"path=\"\/kaggle\/input\/insurance\/insurance.csv\"","efa11a81":"raw_data=pd.read_csv(path)\nraw_data","f641c426":"raw_data.info()","e967ceed":"raw_data_c=raw_data.drop([\"sex\", \"smoker\", \"region\"], axis=1).copy() #only continuous variable dataset will be used for plots","a95e1e45":"raw_data.describe()","cc6cedbf":"raw_data.isnull().sum()","925a3e02":"plt.figure(figsize=(14,8))\nstyle.use(\"seaborn-dark-palette\")\nplt.subplot(2,2,1)\nplt.hist(raw_data[\"age\"])\nplt.xlabel(\"Ages\", fontsize=12)\nplt.subplot(2,2,2)\nplt.hist(raw_data[\"bmi\"])\nplt.xlabel(\"BMI\", fontsize=12)\nplt.subplot(2,2,3)\nplt.hist(raw_data[\"charges\"])\nplt.xlabel(\"Charges\", fontsize=12)\nplt.subplot(2,2,4)\nplt.hist(raw_data[\"region\"])\nplt.xlabel(\"Region\", fontsize=12)","05860266":"corr_mat=raw_data_c.corr()\ncorr_mat","cbd59f7d":"plt.figure(figsize=(10,8))\ncorar=np.array(corr_mat.values)\nsns.set(font_scale=1.5)\nsns.heatmap(corr_mat, annot=corar,cmap=\"coolwarm_r\")","08684772":"raw_data.age.describe()","33ab56da":"raw_data.loc[(raw_data.age>17) & (raw_data.age<=30), \"age_cat\"]=\"Young Adult\"\nraw_data.loc[(raw_data.age>30) & (raw_data.age<=59), \"age_cat\"]=\"Adult\"\nraw_data.loc[(raw_data.age>59), \"age_cat\"]=\"Old\"\nraw_data","6d547bf9":"labels=raw_data.age_cat.unique().tolist()\ncount=raw_data.age_cat.value_counts()\nprint(count)\ncount=count.values\nstyle.use(\"ggplot\")\nplt.figure(figsize=(8,8))\nexplode=(0.1,0,0)\nplt.pie(count, labels=labels,explode=explode, autopct=\"%1.1f%%\", textprops={'fontsize': 20})","82f275c4":"charge_avg_age=raw_data.groupby(\"age_cat\")[\"charges\"].mean()\nlabels_avg=charge_avg_age.keys()\ncharge_avg_age=charge_avg_age.tolist()\n\ncharge_sum_age=raw_data.groupby([\"age_cat\"])[\"charges\"].sum()\nlabels_sum=charge_sum_age.keys()\ncharge_sum_age=charge_sum_age.tolist()\n\ncharge_std_age=raw_data.groupby([\"age_cat\"])[\"charges\"].std()\nlabels_std=charge_std_age.keys()\ncharge_std_age=charge_std_age.tolist()\n\n\nstyle.use(\"seaborn\")\nplt.figure(figsize=(16,10))\nplt.subplot(2,2,1)\nplt.bar(labels_avg, charge_avg_age, color=\"green\")\nplt.ylabel(\"Mean Charges\", fontsize=16)\nplt.subplot(2,2,2)\nplt.bar(labels_sum, charge_sum_age, color=\"indigo\")\nplt.ylabel(\"Sum  (1e7)\", fontsize=16)\nplt.subplot(2,2,3)\nplt.bar(labels_sum, charge_std_age, color=\"black\")\nplt.ylabel(\"Charges Standard Deviation\", fontsize=16)","7722730c":"raw_data[\"log_charges\"]=np.log(raw_data[\"charges\"])\nraw_data ","93c20986":"plt.figure(figsize=(16,6))\n\nplt.subplot(1,2,1)\nraw_data[\"charges\"].hist()\nplt.xlabel(\"Charges\", fontsize=16)\n\n\nplt.subplot(1,2,2)\nraw_data[\"log_charges\"].hist()\nplt.xlabel(\"Log of Charges\", fontsize=16)","76e4da67":"plt.figure(figsize=(15,10))\nsns.set(font_scale=1.5)\nplt.subplot(1,2,1)\nsns.swarmplot(raw_data[\"sex\"], raw_data[\"charges\"], palette =\"seismic\")\nplt.subplot(1,2,2)\nsns.boxenplot(raw_data[\"sex\"], raw_data[\"log_charges\"], palette =\"seismic\")","e90cb756":"plt.figure(figsize=(14,8))\nsns.set(font_scale=1.5)\nsns.boxenplot(raw_data[\"sex\"], raw_data[\"bmi\"], palette =\"seismic_r\")","b4db0ae4":"raw_data.loc[(raw_data.age<19), \"bmi_cat\"]=\"Underweight\"\nraw_data.loc[(raw_data.age>=19) & (raw_data.age<=25), \"bmi_cat\"]=\"Normal\"\nraw_data.loc[(raw_data.age>25) & (raw_data.age<=30), \"bmi_cat\"]=\"Overweight\"\nraw_data.loc[(raw_data.age>30), \"bmi_cat\"]=\"Obese\"\nraw_data","98c454ca":"bmi_val=raw_data[\"bmi_cat\"].value_counts()\nbmi_val=bmi_val.tolist()\nstyle.use(\"seaborn-dark-palette\")\nlabels=raw_data[\"bmi_cat\"].unique()\nplt.figure(figsize=(12,5))\nplt.bar(labels, bmi_val)\nplt.ylabel(\"Count\", fontsize=16)","bb6dc0a5":"bmi_avg_charge=raw_data.groupby(\"bmi_cat\")[\"charges\"].mean()\nlabels_a=bmi_avg_charge.keys()\nbmi_avg_charge=bmi_avg_charge.tolist()\n\nbmi_count_charge=raw_data.groupby(\"bmi_cat\")[\"charges\"].count()\nlabels_c=bmi_count_charge.keys()\nbmi_count_charge=bmi_count_charge.tolist()\n\n\nstyle.use(\"seaborn-dark-palette\")\nplt.figure(figsize=(16,5))\nplt.subplot(1,2,1)\nplt.bar(labels_a, bmi_avg_charge)\nplt.ylabel(\"Mean Charges\", fontsize=16)\n\nplt.subplot(1,2,2)\nplt.bar(labels_c, bmi_count_charge)\nplt.ylabel(\"Count\", fontsize=16)\n","a6e7c209":"plt.figure(figsize=(14,8))\nsns.set(font_scale=1.5)\nsns.swarmplot(raw_data[\"smoker\"], raw_data[\"charges\"],hue=raw_data[\"sex\"], palette=\"winter\")","91ccc844":"plt.figure(figsize=(15,10))\nstyle.use(\"ggplot\")\nax=plt.subplot(2,1,1)\nsmk_bmi=raw_data.groupby([\"smoker\", \"bmi_cat\"])[\"charges\"].mean().unstack()\nprint(smk_bmi)\nsmk_bmi.plot(ax=ax)\n\nax=plt.subplot(2,1,2)\nsmk_bmi=raw_data.groupby([\"smoker\", \"bmi_cat\"])[\"charges\"].mean().plot(ax=ax)\nax.tick_params('x',labelrotation=45)","4754c579":"raw_data_c","9f0da915":"std_scl=StandardScaler()\nraw_data_std=std_scl.fit_transform(raw_data_c)\nprint(\"columns as age, bmi. children, charges\")\nprint(raw_data_std)","96be869e":"bmi_charg_c=raw_data_std[:,[1,3]]\nprint(bmi_charg_c)\nprint(bmi_charg_c.shape)","2c0514c1":"wss=[]\nsil=[]\nfor k in range(2,16):\n    kmeans=KMeans(n_clusters=k, random_state=1).fit(bmi_charg_c)\n    wss.append(kmeans.inertia_)\n    labels=kmeans.labels_\n    silhoutte=silhouette_score(bmi_charg_c, labels, metric = 'euclidean')\n    sil.append(silhoutte)","076ec165":"k=range(2,16)\nstyle.use(\"bmh\")\nfig,ax=plt.subplots(figsize=(14,6))\nax.set_facecolor(\"white\")\nax.plot(k, wss, color=\"green\")\nax.xaxis.set_major_locator(MaxNLocator(nbins=15, integer=True))\nax.set_xlabel(\"No of clusters\", fontsize=20)\nax.set_ylabel(\"WSS (With in Sum of squares)\", fontsize=20)\nax2=ax.twinx()\nax2.plot(k, sil, color=\"blue\")\nax2.set_ylabel(\"Silhouette scores\", fontsize=20)\nax2.grid(True,color=\"silver\")\nplt.show()","1a683a26":"k=3\nkmeans=KMeans(n_clusters=k, random_state=1).fit(bmi_charg_c)\nclusters=kmeans.labels_\ncentrids=kmeans.cluster_centers_\nraw_data[\"clusters\"]=clusters\nraw_data","6835d669":"raw_data2=raw_data.sort_values([\"clusters\"]).copy()","95dcc3ed":"for i in range(0,k+1):\n    raw_data2[\"clusters\"]=raw_data2[\"clusters\"].replace(i, chr(i+65))\n    \nraw_data2","5e089ec4":"raw_data2[\"clusters\"].unique()","7fd5d6f5":"x=raw_data2.iloc[:,[2,6]].values\nprint(x.shape)\ny=kmeans.fit_predict(x)\nprint(y.shape)","ec4a4f0f":"plt.figure(figsize=(14,8))\nstyle.use(\"Solarize_Light2\")\nplt.scatter(x[y==0,0], x[y==0,1], color=\"red\", label=\"A\")\nplt.scatter(x[y==1,0], x[y==1,1], color=\"blue\", label=\"B\")\nplt.scatter(x[y==2,0], x[y==2,1], color=\"green\", label=\"C\")\n\nplt.xlabel(\"BMI\", fontsize=16)\nplt.ylabel(\"Charges\", fontsize=16)\nplt.title(\"Charges depends on BMI??\", fontsize=18)","b3732ae8":"age_charg_c=raw_data_std[:,[0,3]]\nprint(age_charg_c)\nprint(age_charg_c.shape)","b034eb25":"wss=[]\nsil=[]\nfor k in range(2,16):\n    kmeans=KMeans(n_clusters=k, random_state=1).fit(age_charg_c)\n    wss.append(kmeans.inertia_)\n    labels=kmeans.labels_\n    silhoutte=silhouette_score(age_charg_c, labels, metric = 'euclidean')\n    sil.append(silhoutte)","4e3de084":"k=range(2,16)\nstyle.use(\"bmh\")\nfig,ax=plt.subplots(figsize=(14,6))\nax.set_facecolor(\"white\")\nax.plot(k, wss, color=\"green\")\nax.xaxis.set_major_locator(MaxNLocator(nbins=15, integer=True))\nax.set_xlabel(\"No of clusters\", fontsize=20)\nax.set_ylabel(\"WSS (With in Sum of squares)\", fontsize=20)\nax2=ax.twinx()\nax2.plot(k, sil, color=\"blue\")\nax2.set_ylabel(\"Silhouette scores\", fontsize=20)\nax2.grid(True,color=\"silver\")\nplt.show()","d845eb67":"k=3\nkmeans=KMeans(n_clusters=k, random_state=1).fit(age_charg_c)\nclusters=kmeans.labels_\ncentrids=kmeans.cluster_centers_\nraw_data[\"clusters\"]=clusters\nraw_data","2a2bb7fd":"raw_data2=raw_data.sort_values([\"clusters\"]).copy()","28e81600":"for i in range(0,k+1):\n    raw_data2[\"clusters\"]=raw_data2[\"clusters\"].replace(i, chr(i+65))\n    \nraw_data2","111d0f17":"x=raw_data2.iloc[:,[0,6]].values\nprint(x.shape)\ny=kmeans.fit_predict(x)\nprint(y.shape)","5fae5011":"plt.figure(figsize=(14,8))\nstyle.use(\"Solarize_Light2\")\nplt.scatter(x[y==0,0], x[y==0,1], color=\"red\", label=\"A\")\nplt.scatter(x[y==1,0], x[y==1,1], color=\"blue\", label=\"B\")\nplt.scatter(x[y==2,0], x[y==2,1], color=\"green\", label=\"C\")\n\nplt.xlabel(\"Age\", fontsize=16)\nplt.ylabel(\"Charges\", fontsize=16)\nplt.title(\"Charges depends on Age??\", fontsize=18)","e4cbd271":"raw_data2[\"smoker\"]=raw_data2[\"smoker\"].replace([\"yes\", \"no\"],[1,0])","73a6c34f":"pval=ols(\"charges~bmi+age+children+smoker\", data=raw_data).fit()\nprint(pval.summary())","50fc2a22":"This project is mainly focussed on **Storytelling** from a small dataset. The main aim of the project is to bring out the fun of data exploration in a small dataset. Through multiple graphs and plots I will try to present the whole data and their interaction with other variable in a lucid manner. \n\nThe data set is sourced from Kaggle and it seems like a abridged version of some insurance company's database. The main aim of the project with the data is to find the cost's dependencies of factors like BMI or body mass index, smoking habits, age and no of childrens and also roughly touches on the average spendings of males and females based on the above mentioned factors.","69ece759":"Dependent variable: Charges, Independent variable: BMI, age, children and smoker or non-smoker","8cac427d":"### Standardization of Data\n\nStandard scaling is required to bring all the variables to the same page. *BMI* and *Age* range in tens where as *Children* range in once while *Charges* ranged in 5 digits. Thus to keep all on same page we use the standard scaler.\n\nStandardize features by removing the mean and scaling to unit variance\n\n$$z=(x-u)\/sd$$","ec2dc8cf":"From the desription of data we find except *Charges* other don't have much **outliers**","1eef034f":"From the above three bar plots we note the following:-\n\n1. **Adults** comprises of 33.2% of the whole data set and thus sum total of their medical expenses is the highest but the mean cost per adult patient is **less than \\$15,000** with a standard deviation of **\\$12,000**. Adult age ranges from 30 to 59 with critical age starts post 59 where lots of ailments crop up due to work stress and socio-environmental factors. \n\n2. **Young Adult** is the age ranges from 18 to 30. A age when human body is at its peak. With a 58.3%  of Young adults representation still get lowest total. With a mean of around **less than \\$10,000** and standard deviation of around **\\$10,000**\n\n3. **Old** age is the age where the medical cost becomes the primary expenditure and its evident by the fact that the mean cost is among the highest which shoots **above \\$20,000** with a standard deviation of **\\$13,000**. ","9311cbf0":"### Hypothesis\n\n$$H0 = \"Charges are independent of the variables like age, bmi, no of childrens and smoking habits\"$$\n$$H1 = \"Charges are dependent of the variables like age, bmi, no of childrens and smoking habits\"$$","0edb00fd":"So we have around 3 object variables and 4 continuous variables and all the categories are non-null.","2c34f2d2":"### Clustering \n\nUsing KMeans and Silhoutte scores","78f453eb":"From the above as we have defined we got 3 distinct clusters. With BMI (15 to 35) has a expense of \\$10,000 to \\$30,000 where as higher BMI's have much higher cost.","9777d05b":"### Relationship between BMI and Charges","c2af91a3":"From the above plots we can see obesity has quite a impact on medical cost. Our datset has high number of Obese patients and also the mean cost is above \\$14,000. Thus its better to keep our weights under control.","e5b77bf1":"We also Run the same clustering for **\"Age\"**","1b65405a":"We do check that all the 4 independent variable has a **Pvalue of less than 0.05** thus we **reject the null hypothesis**.\nand conclude that \"Charges\" are dependent on the mentioned variables.","2120492c":"From the plot we see the \"elbow\" at 3 and silhouutee score almost best at that point.","e3199b1d":"The information about charges gathered from the swarm plot and the boxen plot (both are special cases of box plot) shows independency of charges on gender. With the mean lying around \\$10,000.","9a7a2db2":"We plot a scatter box plot or **Swarm** plot of both **Charges** and **log charges** comparing with both the **genders** and observe the following.","f46a5ac1":"The pie chart shows that our datasets has more Children and Young adults by count than adult and old.","82bb8bb8":"The distribution of BMI has a mean of around of 30 with upper quartile ranges from 34 to 35 and lower quartile ranges from 25 for both the gender. Also male genders has outliers suggest by few BMI over 50.","0a9ed775":"### Relationship between BMI and Gender","9dad8904":"### Correlation","f425e05a":"### PValue test \n\nWe convert categorical variable \"Smoker\" as 0 and 1 or a continuous binary variable and run a OLS test","8ebc8965":"So without much ado lets begin the project by importing some of our dependencies. Following a brief description and their need in this project:-\n1. OS: for file navigation from storage devices\n2. Numpy for array and calculations\n3. Pandas for data management including dataframes and series\n4. Matplotlib and its subordinates like Pyplot, Style, MAXNLocator for plotting, style and Ticks\n5. Sklearns StandardScaler for Data scaling\n6. Sklearns KMeans for K-menas clustering\n7. Sklearns Silhouette_Samples and Silhouette_score are for calculating silhouette scores for each individual and whole data set respectively.\n8. Statsmodel ols (lowercase) for R style Oridinary Least sqaures analysis to find the Pvalues for our hypothesis.","cc5d1e9e":"From the hist() plot we have seen that charges have outliers so we do a log transformation of charges to get rid of the impact of outliers.","5ea93495":"From all the 3 graphs we note that Smoking and medical cost as direct relationship. Smoker tend to spend more on medical expenses that non-smoker. Which also indirectly suggests that smoker tend to develop more medical complication than non smokers.","11706403":"### Basic Histogram\n\n**To find the nature of data**\n\nThe basic histogram, called by the **hist()** function gives a visual represention of the distribution of the data based on the *Normal distribution*. From this graph we can understand:-\n1. Data type of each variable: \"Continuous variables\" will have a continuous normal distribution curve. \"Categorical variable\" will have distinct plots.\n2. Skewness of data highlights the presence of **outliers**. Here we note **Charges** and **Age** have outliers where as BMI doesn't.\n3. Region is categorical","0f97930c":"From correlation plot we can see **age** and **charges** have very slight positive correlation with **charges** which we will try to prove in due course.","192f3caa":"### Data Insites","06b80453":"## How life burns your pockets during medical emergency?","013162e0":"### Relationship between Smoking and Charges","2f2beb2b":"#### Plotting of Correlation plot","a92d4117":"We load the data using Pandas read_csv. So one the first glace we see that our data has a shape of 1338,7 and has a mixed data type categorical and continuous. More overview of the data are follows:-","0afabd6e":"### Relationship between Age and Charges.\n\nWe first convert the age into bins\/groups of categorical variables like Child, Young Adult, Adult and Old to analyse its relationship with medical expenses \"charges\".","890e0ea9":"Confirmation that no **NULL values in out dataset**","4ddb60d4":"### Relationship between Sex and Charges","9188ae48":"We dont see much distinction about groups here with quite high overlaps. All the three expenses ranges has all the age groups","44740705":"To find the best number of cluster (n_clusters=k) we run a for-loop and compute the WSS (Within sum of squares) Elbow method and Silhoutte scores for each \"k\".\n\n**BMI**"}}