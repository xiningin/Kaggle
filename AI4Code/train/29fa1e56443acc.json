{"cell_type":{"9a75c370":"code","6251c185":"code","bdb75443":"code","08f9b1dd":"code","1e626029":"code","f937c8e4":"code","6bbc9fff":"code","1dda5614":"code","ccd82617":"code","64e3e711":"code","aaee1dd5":"code","235f76ef":"code","0b998d51":"code","6ee8ee86":"code","949f4341":"code","97f48885":"code","7baeefa7":"code","6b9e57da":"code","b93114f2":"code","5d688a8e":"code","89452b16":"code","349a8ed2":"code","d1573f09":"code","1d032535":"code","4292505e":"code","453b2e67":"code","4087b05c":"code","c073013a":"code","4fe896c8":"code","e825de40":"code","5d4f04aa":"code","20ee6ecb":"code","52ff106c":"code","02b8cfc7":"code","5d77b4fb":"code","93bc2ee1":"code","fd56bedf":"code","53d2aac8":"code","fa5c4a1d":"markdown","f0c499c3":"markdown","d308cd7e":"markdown","22bae364":"markdown","b2cd37f9":"markdown","79ddc514":"markdown","3ce53bd9":"markdown","9c649efe":"markdown","e175f5e4":"markdown","c264e123":"markdown","bd82847a":"markdown","beab13a2":"markdown","798fb8cb":"markdown","05c1b896":"markdown","f52f131d":"markdown","94f075dc":"markdown","8f52f8fb":"markdown","bb856640":"markdown","81e3bc06":"markdown","36537107":"markdown","ebc6a919":"markdown","0d230293":"markdown","d5fa674f":"markdown","caf685b7":"markdown","91fbc01a":"markdown","41309ab3":"markdown","a97369c1":"markdown","de22efd9":"markdown"},"source":{"9a75c370":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport sklearn\nimport math\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","6251c185":"df = pd.read_csv(r'\/kaggle\/input\/insurance\/insurance.csv')","bdb75443":"df.dtypes","08f9b1dd":"df['age'].isna().value_counts()\ndf.columns","1e626029":"def checkNull (data) :\n    columns = data.columns\n    for column in columns :\n        print('****Checking null values for '+ str(column) + ' ****')\n        print(data[column].isna().value_counts())\n        print('****Checking competed*****')\n    ","f937c8e4":"checkNull(df)","6bbc9fff":"corrMatrix = df.corr()","1dda5614":"fig = plt.figure(figsize = (8,6))\nax= fig.add_subplot(111)\nsns.heatmap(corrMatrix,annot=True,ax=ax)","ccd82617":"df[['sex','charges']].plot(kind = 'scatter',x='sex',y='charges')","64e3e711":"df['region'].value_counts()","aaee1dd5":"df[df['region'] == 'southeast'][['region','charges']].plot(kind='hist',title = 'southeast')","235f76ef":"df[df['region'] == 'southwest'][['region','charges']].plot(kind='hist',title = 'southwest')","0b998d51":"df[df['region'] == 'northwest'][['region','charges']].plot(kind='hist',title = 'northwest')","6ee8ee86":"df[df['region'] == 'northeast'][['region','charges']].plot(kind='hist',title = 'northeast')","949f4341":"df_smoking = df[['smoker','charges']]\n#df_smoker = df_smoking[df_smoking['smoker'] == 'yes']\ndf_smoking['smoker'].value_counts()","97f48885":"df_smoking.replace({'yes' : 1,'no': 0},inplace = True)","7baeefa7":"fig1 = plt.figure(figsize = (12,6))\nfig1.subplots_adjust(wspace = 0.5)\nax1 = fig1.add_subplot(121)\nsns.boxplot(x='smoker',y='charges',data=df_smoking,palette='rainbow',ax =ax1,showfliers=False)\nax1.set_xticklabels(['Non-Smoker','Somker'])\nax1.set_xlabel('')\nax1.set_ylabel('Insurance Charges')\n\nax1 = fig1.add_subplot(122) \nsns.violinplot(data =df_smoking, x='smoker', y='charges',ax= ax1)\nax1.set_xticklabels(['Non-Smoker','Somker'])\nax1.set_xlabel('')\nax1.set_ylabel('Insurance Charges')","6b9e57da":"mat = df_smoking.corr()\nsns.heatmap(mat,annot=True)","b93114f2":"df_gen = df[['sex','charges']]\nfig2 = plt.figure(figsize = (15,6))\nfig2.subplots_adjust(wspace = 0.5)\nax2 = fig2.add_subplot(121) \nsns.boxplot(data= df_gen,x = 'sex',y='charges',showfliers=False,ax=ax2)\nax2 = fig2.add_subplot(122)\nsns.violinplot(data =df_gen, x='sex', y='charges',ax=ax2)","5d688a8e":"#df_gen.replace({'male': 1,'female':0},inplace = True)\ndf_gen.corr()","89452b16":"df_model =                  df.replace({\n                                        'southeast':0,\n                                        'northwest':1,\n                                        'southwest':2,\n                                        'northeast':3,\n                                        'male': 1,\n                                        'female':0,\n                                        'yes' : 1,\n                                        'no': 0\n                                         })\ndf_model.head()","349a8ed2":"figg = plt.figure(figsize = (10,8))\nax3 = figg.add_subplot(111) \nsns.heatmap(df_model.corr(),annot=True,ax=ax3)","d1573f09":"total_data_count = df_new_model.shape[0]\ntrain_data_index = round(total_data_count*0.8) -1\ntrain_data = df_new_model.loc[:train_data_index,:]\ntest_data_index = train_data_index +1\ntest_data = df_new_model.loc[test_data_index:,:]","1d032535":"test_data.shape\ntrain_data.shape","4292505e":"from sklearn import linear_model\nfrom sklearn.metrics import r2_score\nfrom sklearn.metrics import mean_squared_error\n#reg = linear_model.LinearRegression() \n#x = df_new_model[['age','sex','bmi','children','smoker','region']]\n#x = df_model[['smoker']]\n#y = df_new_model[['charges']]\n#reg.fit(x,y)\n#print('The coefficients are ',reg.coef_)\n#print('The intercept is ',reg.intercept_)","453b2e67":"y_hat = reg.predict(test_data[['age','sex','bmi','children','smoker','region']])\nprint ('R2 score is ',r2_score(test_data['charges'],y_hat))\nprint('RMSE score is ',math.sqrt(mean_squared_error(test_data['charges'],y_hat)))","4087b05c":"df_new_model = pd.get_dummies(df,columns=['smoker','sex','region'],prefix =['smoker','sex','region'])\ndf_new_model.head()\n#df_new_model.columns","c073013a":"fig_new = plt.figure(figsize = (10,8))\nax_new = fig_new.add_subplot(111) \nsns.heatmap(df_new_model.corr(),annot=True,ax=ax_new)","4fe896c8":"total_data_count = df_new_model.shape[0]\ntrain_data_index = round(total_data_count*0.8) -1\ntrain_data = df_new_model.loc[:train_data_index,:]\ntest_data_index = train_data_index +1\ntest_data = df_new_model.loc[test_data_index:,:]","e825de40":"from sklearn import linear_model\nfrom sklearn.metrics import r2_score\nfrom sklearn.metrics import mean_squared_error\nreg = linear_model.LinearRegression() \nx = df_new_model[['age', 'bmi', 'children','smoker_no', 'smoker_yes',\n       'sex_female', 'sex_male', 'region_northeast', 'region_northwest',\n       'region_southeast', 'region_southwest']]\ny = df_new_model[['charges']]\nreg.fit(x,y)\nprint('The coefficients are ',reg.coef_)\nprint('The intercept is ',reg.intercept_)","5d4f04aa":"y_hat = reg.predict(test_data[['age', 'bmi', 'children','smoker_no', 'smoker_yes',\n       'sex_female', 'sex_male', 'region_northeast', 'region_northwest',\n       'region_southeast', 'region_southwest']])\nprint ('R2 score is ',r2_score(test_data['charges'],y_hat))\nprint('RMSE score is ',math.sqrt(mean_squared_error(test_data['charges'],y_hat)))","20ee6ecb":"total_data_count = df_new_model[['smoker_yes']].shape[0]\ntrain_data_index = round(total_data_count*0.8) -1\ntrain_data = df_new_model.loc[:train_data_index,:]\ntest_data_index = train_data_index +1\ntest_data = df_new_model.loc[test_data_index:,:]","52ff106c":"from sklearn.preprocessing import PolynomialFeatures\nfrom sklearn import linear_model\nfrom sklearn.metrics import r2_score\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn.metrics import mean_absolute_error\n\ndef ployFuntion (degrees,train_data,test_data) :\n    for degree in degrees :\n        poly = PolynomialFeatures(degree)\n        train_x_poly = poly.fit_transform(train_data[['age','bmi','smoker_no', 'smoker_yes']])\n        test_x_poly = poly.fit_transform(test_data[['age','bmi','smoker_no', 'smoker_yes']])\n        reg = linear_model.LinearRegression()\n        reg.fit(train_x_poly,train_data['charges'])\n        y_hat = reg.predict(test_x_poly)\n        print('Degree of polynomial model used :',degree)\n        print ('R2 score is ',r2_score(test_data['charges'],y_hat))\n        print('RMSE score is ',math.sqrt(mean_squared_error(test_data['charges'],y_hat)))\n        print ('MAE score is ',mean_absolute_error(test_data['charges'],y_hat))\n        print ('*****************************')\n","02b8cfc7":"ployFuntion(degrees = list(range(2,12)),train_data = train_data,test_data =test_data)","5d77b4fb":"from sklearn.preprocessing import StandardScaler\nstan = StandardScaler()\nstd_charges = stan.fit_transform(df_new_model[['charges']])","93bc2ee1":"from sklearn.preprocessing import StandardScaler\nstan = StandardScaler()\nstd_bmi = stan.fit_transform(df_new_model[['bmi']])","fd56bedf":"from sklearn.preprocessing import StandardScaler\nstan = StandardScaler()\nstd_age = stan.fit_transform(df_new_model[['age']])","53d2aac8":"df_new_model['age'] = std_age\ndf_new_model['bmi'] = std_bmi\ndf_new_model['charges'] = std_charges","fa5c4a1d":"Previously I chnaged the smoker column data for 'Yes' to 1 and 'No' to 0, similarly also chaanged Gender column data for 'Male' to 1 and 'Female' to 0. This is popularly called as label encoding which has some diadvantages.","f0c499c3":"R2 score is average only but,RMSE is pretty high which is not right.\nI have to find why ?","d308cd7e":"Checking null values in the dataframe","22bae364":"Now that we trained our model.Now lets test it. ","b2cd37f9":"Still no significant improvement huh !","79ddc514":"Correlation is also not that much strong.","3ce53bd9":"Checking the if different regions have any affect on the charges or not","9c649efe":"Lets give a try using ploynomial regression.","e175f5e4":"So using both polynomial and Multilinear regression we can see that \nfor Polynomial regression at dergee of freedom '9'\nR2 score is  0.7185110926492733\nRMSE score is  0.5437599132780697\nfor Multilinear regression is \nR2 score is  0.7603054934267751\nRMSE score is  0.5017710322215123\n\nwhich is pretty good.","c264e123":"Thank you all for giving time to my notebook.You guys can give suggestions in comments on how further I can increase the accuracy of the model.","bd82847a":"Finding out diffrent regions","beab13a2":"I got a suggestion that if I scale the features to smiliar range then it can do some improvement.\nLets scale our variables using StandardScalar. What it does is \nLet is consider feature X  (1,2,3,4,5...)\nAfter applying StandardScalar\nevery element of x will be converted using \nnew_x(i th element) = (x (i th) - mean)\/standard deviation\n","798fb8cb":"Let's get started with the preparing the test and train data. We will be taking 80% of data for tarining and 20% for with testing. ","05c1b896":"As above seen the distribution is similar in all the regions .So it doesnot have a much of affect on charges. ","f52f131d":"lets quickly check for the correlation.","94f075dc":"There are total 274 smokers ","8f52f8fb":"lets just have a quick look into the heatmap.Here SEX,CHILDREN,REGION have very weak correlation. \nWhere values nearer to +1 or -1 have strong correlation.","bb856640":"Now lets check wheather smoking has some affect on charges or not !","81e3bc06":"We can also see that the there is a posotive correlation between smoking and charges.","36537107":"**Checking data types of the columns**","ebc6a919":"We will be using multiple ploynomial regression model to check which degree polynomial gives best result.Here I will be using only few features","0d230293":"Now lets use the One Hot Encoding to the change the catgeorical columns into numerical columns using pandas get_dummies method.","d5fa674f":"Now let prepare the data for our model.By converting the categorical data to numerical.","caf685b7":"Now lets see If Gender as any impact on insurance amount paid","91fbc01a":"Now we splited our training and testing data.Lets prepare the model.","41309ab3":"In above box plot and vilion plot we can see that the Average Insurance Amount paid to a non smoker is around $8000 to $9000, where as for smokers the Average Insurance Amount paid is far greater then the non smoker which is nearly $35000.\nSo the Smoker feature is very useful for predicting the insurance charges.","a97369c1":"Both males and females have same average Insurance charges ,but for the females the threshold for the 3rd quartile nearly 16000 dollars and for males it is nearly 20000 dollars.I think gender will not have that much of a impact on charges as the smoking habit,but we still consider it as a feature for the model","de22efd9":"Now you see that we have converted the categorical columns to numerical columns using one hot encoding.Though our number of columns have increased.Lets build our model again and see if we can better score."}}