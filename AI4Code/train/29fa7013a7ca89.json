{"cell_type":{"c5e3e5b0":"code","f8706da5":"code","3eb73600":"code","9864fb33":"code","448addb0":"code","d9ac0b37":"code","746f3e9d":"code","f8fd23a6":"code","e1932abb":"code","27cd8704":"code","5005b78f":"code","141a1094":"code","8fbf0b2e":"code","089e79ee":"code","1af31e3c":"code","4011cdab":"code","0a5a1819":"code","fc982bd0":"code","ab06464f":"code","5d2f7e55":"code","5c66ef85":"code","cc07c0fb":"code","7a245db0":"code","7715e82e":"code","b2039b76":"code","2104ca25":"code","7866cf11":"code","82975698":"code","3b98fe29":"code","a4c99153":"code","0c5296ed":"code","f2a05ee3":"code","e51839fd":"code","3fd5586c":"code","13969e86":"code","57ec84f3":"code","7a307230":"code","f3180542":"code","1f262ed1":"code","da709806":"code","957d8960":"markdown","59f4cd72":"markdown","f9d59817":"markdown","806314ad":"markdown","2ff62eed":"markdown","7fa84c0e":"markdown","876802fb":"markdown","fc71cfc6":"markdown","1009c8cc":"markdown","495493db":"markdown"},"source":{"c5e3e5b0":"import numpy as np \nimport pandas as pd \nimport matplotlib.pyplot as plt\nimport seaborn as sns \nimport re\nfrom wordcloud import WordCloud\nimport nltk\nfrom nltk.corpus import stopwords\nfrom nltk.tokenize import word_tokenize\nfrom nltk.stem import WordNetLemmatizer\nfrom sklearn.feature_extraction.text import CountVectorizer\nfrom sklearn.feature_extraction.text import TfidfTransformer\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import confusion_matrix\nfrom sklearn.metrics import plot_confusion_matrix\nfrom sklearn.metrics import classification_report\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.model_selection import cross_val_score\nfrom sklearn.model_selection import cross_val_predict\nfrom imblearn.over_sampling import RandomOverSampler","f8706da5":"df = pd.read_csv('..\/input\/brazilian-ecommerce\/olist_order_reviews_dataset.csv')\n","3eb73600":"df.describe()","9864fb33":"df.head()","448addb0":"df.pop('review_comment_title')\ndf.pop('review_id')\ndf.pop('order_id')","d9ac0b37":"df.head()","746f3e9d":"df.describe()","f8fd23a6":"n_of_r = df['review_comment_message'].isnull().sum()\nprint(f'N of rows without comments : {n_of_r}')\nprint(f'N of rows with comments: {len(df)-n_of_r}')","e1932abb":"df =df.dropna() ","27cd8704":"y = df.pop('review_score') ","5005b78f":"df","141a1094":"sns.barplot(x = np.unique(y), y = [list(y).count(i) for i in np.unique(y)])","8fbf0b2e":"for i in np.unique(y):\n    print(f'The percentage of {i} in the data is {list(y).count(i)\/len(df)} %')","089e79ee":"texts = df['review_comment_message']","1af31e3c":"nltk.download('stopwords')\nstop_words = stopwords.words('portuguese')","4011cdab":"wordcloud = WordCloud(stopwords=stop_words,\n                      background_color=\"black\",\n                      width=1600, height=800).generate(' '.join(texts))","0a5a1819":"fig, ax = plt.subplots(figsize=(10,6))\nax.imshow(wordcloud, interpolation='bilinear')\nax.set_axis_off()\n\nplt.imshow(wordcloud)","fc982bd0":"def pre_process_data(text):\n    lemm = WordNetLemmatizer()\n    text  = re.sub(r\"[^0-9a-zA-Z]+\",' ',text)\n    tokenized = word_tokenize(text)\n    text = [lemm.lemmatize(i.lower()) for i in tokenized if not(i.lower() in stop_words) and i.isalpha()]\n    return ' '.join(text)","ab06464f":"texts = [pre_process_data(i) for i in texts]","5d2f7e55":"vectorizer = CountVectorizer(max_features=10000)\nvectorizer2 = TfidfTransformer()\nx = vectorizer.fit_transform(texts)\nx = vectorizer2.fit_transform(x,y)","5c66ef85":"x_train,x_test,y_train,y_test = train_test_split(x,y)\nrf_model = RandomForestClassifier(n_jobs=5,verbose=1)","cc07c0fb":"scores_nos = cross_val_score(rf_model,x,y)","7a245db0":"print(f'The Average score for not oversampled data is {scores_nos.mean()}')","7715e82e":"rf_model.fit(x_train,y_train)","b2039b76":"y_pred = rf_model.predict(x_test)\nprint(classification_report(y_test,y_pred))","2104ca25":"plot_confusion_matrix(rf_model,x_test,y_test)","7866cf11":"ro = RandomOverSampler()\nx_ros, y_ros = ro.fit_resample(x, y)\nx_train,x_test,y_train,y_test = train_test_split(x_ros,y_ros)","82975698":"sns.barplot(x = np.unique(y), y = [list(y_ros).count(i) for i in np.unique(y)])","3b98fe29":"rf_model = RandomForestClassifier(verbose = 1,n_jobs=5)\nscore = cross_val_score(rf_model,x_ros,y_ros,cv=5)","a4c99153":"print(f'The mean score was: {score.mean()}')","0c5296ed":"rf_model.fit(x_train,y_train)\ny_pred = rf_model.predict(x_test)","f2a05ee3":"print(classification_report(y_test,y_pred))","e51839fd":"plot_confusion_matrix(rf_model,x_test,y_test)","3fd5586c":"y[y<4] = 0 #setting to be bad 1,2,3\ny[y>3] = 1 # setting to be good 4 and 5 ","13969e86":"perc = list(y).count(1)\/len(y)\nprint(f'The percentage of good comments is {perc}')\nprint(f'The percentaage of bad comments is {1-perc}')","57ec84f3":"x_train,x_test,y_train,y_test = train_test_split(x,y)","7a307230":"score = cross_val_score(rf_model,x_train,y_train,cv=5)\nprint(f'Average score is {score.mean()}')\nrf_model.fit(x_train,y_train)","f3180542":"y_pred = rf_model.predict(x_test)","1f262ed1":"print(classification_report(y_test,y_pred))","da709806":"plot_confusion_matrix(rf_model,x_test,y_test)","957d8960":"# Conclusion - Final \n* What did we made it ?\n    * First we made an small analysis of the  data to see how the classes are organized \n    * Second we pre-processed the text data and shown the word cloud representation of the data \n    * Later we Oversampled the data so all the classes have the same amount in the training and testing data\n    * We saw the cross validation mean score for the dataset oversampled, not oversampled and showing our suspicious thoughts on the model when its oversampled.\n    * Then we worked on making the result data binary and simpler for a model to understand\n    * We got better results usng the binary classification than the multiple class, i think we need to disconsider the oversampled model mainly because the training data and the test data share data what is problematic.\n    \n**Thank you for reading the notebook if you enjoyed please leave a comment and give it an up on the notebook**","59f4cd72":"# Pre Processing the text data \n* What are we going to do ?\n    * Take the text and remove any kinds of special characters\n    * Remove portuguese stopwords from the text\n    * Lemmatize the words\n    * Show the words inside the dataset with word clouds\n    * Then we are going to use BagOfWords to create the vectors later we aregoing to use TF-IDF.","f9d59817":"is the data balanced or close to it ?","806314ad":"# Oversampling\n\nWe will oversample the data so wich class can have the same amount of vectors as the biggest class this happens mainly because the 5 class. ","2ff62eed":"# Cleaning the dataset\n* What we are going to do :\n    * Remove where there are no comments \n    * Show how much data did we lost ","7fa84c0e":"# Conclusion 1 \n* Is this result what we expected?\n    * Really this result brings suspicious thoughts about the quality of the model oversampled mainly by it's high accuracy with multiple classes \n    * This means that we can be having a data leakage. If you can point out what is happening in the comments or if you think it's a normal result leave the comment below \n    * Actually i personally believe that by oversampling we are actually overfiting our model, making it falsely having greater precision, mainly because the training data and the test data share, by the overfitting, the same data, making the model highly specific from the data that we gave it but should perform worst in new data when showed.","876802fb":"# What if we classified as good or bad ?\n* We are going to put any comment with an 4+ review as a good comment and else a bad comment\n* We can see by the model below that the class that had the biggest mistakes is the 4 to 5 and 5 to 4 predictions what will happen if we join this both classes ?\n* Will we have a better result ?","fc71cfc6":"# Distibution of reviews\n* Does the data is very sparse ? \n* Is the data concentrated ?\n\n* We can see that the data is concentrated around the 5 star review and the 1 star review. \n* We are going to balance this data","1009c8cc":"i believe is balanced the difference is not that huge","495493db":"# Building the model without oversampling "}}