{"cell_type":{"3301fab5":"code","89042fa8":"code","93b55897":"code","34c5c65d":"code","f9c52828":"code","f0297654":"code","0c72fe84":"code","609f922b":"code","bf8e6287":"code","d003d779":"code","107a8cfe":"code","c786a89e":"code","517d4106":"code","6854b4c6":"code","6ff7f418":"code","7488d991":"code","24f1d13c":"code","310a11da":"code","78766b7a":"code","13161a66":"code","9e5ddb6a":"markdown","46a5cfc4":"markdown","6f57bb98":"markdown","c83c6ff2":"markdown","14f7ae13":"markdown","c05675bc":"markdown","9bf10cf1":"markdown"},"source":{"3301fab5":"import os\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as p\nimport PIL as pil\nfrom tensorflow.keras.preprocessing.image import ImageDataGenerator\nfrom tensorflow.keras.utils import to_categorical\nfrom sklearn.model_selection import train_test_split\nimport seaborn as sns","89042fa8":"base='\/kaggle\/input\/skin-cancer-mnist-ham10000'","93b55897":"meta=pd.read_csv(os.path.join(base,'HAM10000_metadata.csv'))\nmeta.info()","34c5c65d":"meta.head()","f9c52828":"g = sns.catplot(x=\"dx\", kind=\"count\", palette='bright', data=meta)\ng.fig.set_size_inches(16, 5)\n\ng.ax.set_title('Skin Cancer by Class', fontsize=20)\ng.set_xlabels('Skin Cancer Class', fontsize=14)\ng.set_ylabels('Number of Data Points', fontsize=14)","f0297654":"g = sns.catplot(x=\"dx\", kind=\"count\", hue=\"sex\", palette='coolwarm', data=meta)\ng.fig.set_size_inches(16, 5)\n\ng.ax.set_title('Skin Cancer by Sex', fontsize=20)\ng.set_xlabels('Skin Cancer Class', fontsize=14)\ng.set_ylabels('Number of Data Points', fontsize=14)\ng._legend.set_title('Sex')","0c72fe84":"g = sns.catplot(x=\"dx\", kind=\"count\", hue=\"age\", palette='bright', data=meta)\ng.fig.set_size_inches(16, 9)\n\ng.ax.set_title('Skin Cancer by Age', fontsize=20)\ng.set_xlabels('Skin Cancer Class', fontsize=14)\ng.set_ylabels('Number of Data Points', fontsize=14)\ng._legend.set_title('Age')","609f922b":"df=pd.read_csv(os.path.join(base,'hmnist_28_28_RGB.csv'))\nx=df.drop('label',axis=1)\ny=df['label']\nx=x.to_numpy()\nx=x\/255\ny=to_categorical(y)","bf8e6287":"df['label'].value_counts()","d003d779":"label={\n    ' Actinic keratoses':0,\n    'Basal cell carcinoma':1,\n    'Benign keratosis-like lesions':2,\n    'Dermatofibroma':3,\n    'Melanocytic nevi':4,\n    'Melanoma':6,\n    'Vascular lesions':5\n}","107a8cfe":"x=x.reshape(-1,28,28,3)","c786a89e":"p.figure(figsize=(20,10))\nfor i in range(25):\n    p.subplot(5,5,i+1)\n    img=x[i]\n    p.imshow(img)","517d4106":"trainx,trainy,testx,testy = train_test_split(x,y,test_size=0.02,random_state=13)","6854b4c6":"datagen=ImageDataGenerator(rotation_range=20, # rotate the image 20 degrees\n                               width_shift_range=0.10, # Shift the pic width by a max of 5%\n                               height_shift_range=0.10, # Shift the pic height by a max of 5%\n                               rescale=1\/255, # Rescale the image by normalzing it.\n                               shear_range=0.1, # Shear means cutting away part of the image (max 10%)\n                               zoom_range=0.1, # Zoom in by 10% max\n                               horizontal_flip=True,\n                               vertical_flip=True,\n                               fill_mode='nearest')\ndatagen1=ImageDataGenerator(rotation_range=20, # rotate the image 20 degrees\n                               width_shift_range=0.10, # Shift the pic width by a max of 5%\n                               height_shift_range=0.10, # Shift the pic height by a max of 5%\n                               rescale=1\/255, # Rescale the image by normalzing it.\n                               shear_range=0.1, # Shear means cutting away part of the image (max 10%)\n                               zoom_range=0.1, # Zoom in by 10% max\n                               horizontal_flip=True,\n                               vertical_flip=True,\n                               fill_mode='nearest')","6ff7f418":"datagen.fit(trainx)\ndatagen1.fit(trainy)","7488d991":"from tensorflow.keras.layers import Flatten,Dense,Dropout,BatchNormalization,Conv2D,MaxPooling2D\nfrom tensorflow.keras.models import Sequential\nfrom tensorflow.keras.metrics import Recall\nfrom tensorflow.keras.optimizers import RMSprop\n\nmodel=Sequential()\n\nmodel.add(Conv2D(64,(2,2),input_shape=(28,28,3),activation='relu'))\nmodel.add(MaxPooling2D(pool_size=(2, 2)))\nmodel.add(BatchNormalization())\n\nmodel.add(Conv2D(512,(2,2),input_shape=(28,28,3),activation='relu'))\nmodel.add(MaxPooling2D(pool_size=(2, 2)))\nmodel.add(BatchNormalization())\n\nmodel.add(Dropout(0.3))\n\nmodel.add(Conv2D(1024,(2,2),input_shape=(28,28,3),activation='relu'))\nmodel.add(MaxPooling2D(pool_size=(2, 2)))\nmodel.add(BatchNormalization())\n\nmodel.add(Dropout(0.4))\n\nmodel.add(Conv2D(1024,(1,1),input_shape=(28,28,3),activation='relu'))\nmodel.add(MaxPooling2D(pool_size=(1, 1)))\nmodel.add(BatchNormalization())\n\nmodel.add(Dropout(0.4))\n\nmodel.add(Flatten())\n\nmodel.add(Dense(256,activation='relu'))\nmodel.add(Dropout(0.5))\n\n\nmodel.add(Dense(7,activation='softmax'))\n\nmodel.compile(optimizer='adam',loss='categorical_crossentropy',metrics=['accuracy',Recall()])\nmodel.summary()","24f1d13c":"from tensorflow.keras.callbacks import EarlyStopping,ReduceLROnPlateau\n\nearly=EarlyStopping(monitor='accuracy',patience=3)\nreduce_lr = ReduceLROnPlateau(monitor='val_loss', factor=0.5, patience=2, verbose=1, mode='min', min_lr=0.0001)","310a11da":"model.fit(trainx,testx,batch_size=90,epochs=25,validation_data=(trainy,testy),callbacks=[reduce_lr,early])","78766b7a":"p.figure(figsize=(15,5))\nloss=pd.DataFrame(model.history.history)\nloss=loss[['accuracy','val_accuracy']]\nloss.plot()","13161a66":"from sklearn.metrics import classification_report,confusion_matrix\n\npredictions=model.predict_classes(trainy)\n\ncheck=[]\nfor i in range(len(testy)):\n  for j in range(7):\n    if(testy[i][j]==1):\n      check.append(j)\ncheck=np.asarray(check)\n\nprint(classification_report(check,predictions))\n","9e5ddb6a":"# **Spliiting into train test**","46a5cfc4":"# **Model**","6f57bb98":"This graph shows the dataset has a major problem of class imbalance.","c83c6ff2":"# **Sample images**","14f7ae13":"# **Visualising Dataset**","c05675bc":"# **Extracting x and y from csv file**","9bf10cf1":"# **Image augmentation**"}}