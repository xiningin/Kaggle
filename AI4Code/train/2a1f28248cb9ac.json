{"cell_type":{"d58e8555":"code","84efbc7f":"code","2a4608ae":"code","8484d370":"code","3ae5cbcf":"code","41b2c208":"code","4d21e15b":"code","7509757c":"code","e2246ba8":"code","b25c7452":"code","122ef232":"code","d44de83d":"code","0f4c0f64":"code","f8c4543b":"code","ec4d307d":"code","6681fe8c":"code","367c4ea6":"code","fd3638b8":"code","0d94cb94":"code","6bbdf89d":"code","478de9b5":"markdown","3c49a15e":"markdown","2926a322":"markdown","a7e5f14f":"markdown","c0f811d0":"markdown","8dd5012f":"markdown","31945fb5":"markdown"},"source":{"d58e8555":"import pandas as pd\nimport numpy as np\nimport os\nimport matplotlib.pyplot as plt\nimport plotly.express as px\nimport plotly.graph_objects as go\nimport datetime as dt\nimport warnings\nwarnings.filterwarnings('ignore')\nimport tensorflow as tf\nfrom sklearn import metrics","84efbc7f":"os.chdir('\/kaggle\/input\/wallmart-sales\/')\ntotal_value = pd.read_csv('total_value.csv')\ntotal_value.head()","2a4608ae":"os.chdir('\/kaggle\/input\/wallmart\/')\ncal = pd.read_csv('calendar.csv')","8484d370":"# One-hot encoding months\nmonth = pd.get_dummies(cal['month'],prefix='month',drop_first=True)\n\n# Dropping unecessary cols\ncal.drop(['wm_yr_wk', 'weekday','d', 'event_type_1', 'event_name_2', 'event_type_2', 'snap_TX', 'snap_WI'],1,inplace=True)\n\n# Handling events\ncal['event_name_1'] = cal['event_name_1'].fillna(0)\ncal['event_name_1'] = np.where(cal['event_name_1'] != 0,1,0)\n\n# One-hot encoding day of months\ncal['date'] = pd.to_datetime(cal['date'])\ncal['dayofmonth'] = cal['date'].dt.day     \ndom = pd.DataFrame(np.where(cal['dayofmonth']>=15,1,0),columns=['day_ge_15'])\n\n# One-hot encoding years\nyear = pd.get_dummies(cal['year'],prefix='year_',drop_first=True)\n\n# One-hot encoding weekdays\nwday = pd.get_dummies(cal['wday'],prefix='wday_',drop_first=True)\n\n# Combing and removing features\ncal.drop(['month','year','dayofmonth','wday'],1,inplace=True)\ncal = pd.concat([cal,month,year,dom,wday],axis=1)","3ae5cbcf":"# Function for filtering california store 3 items\ndef california_store_3(item):\n    state = item.split('_')[3] \n    store_no = int(item.split('_')[4])\n    if (state == 'CA' and store_no == 3): \n        return True\n    else: \n        return False","41b2c208":"item_list = list(total_value.columns[:-1])\ncalifornia_store_3_item = filter(california_store_3, item_list)\ncalifornia_store_3_item_list = [i for i in california_store_3_item]","4d21e15b":"california_store_3_df = total_value.loc[:,california_store_3_item_list]\ncalifornia_store_3_df","7509757c":"# Concatinating categorical variables\ncalifornia_store_3_df = pd.concat([cal,california_store_3_df],1)\ncalifornia_store_3_df.head()","e2246ba8":"california_store_3_df['date'] = pd.to_datetime(california_store_3_df['date'])","b25c7452":"# 3049 items\ncalifornia_store_3_last_1_year_df = california_store_3_df[california_store_3_df['date'] >='2015-02-22']\ncalifornia_store_3_last_1_year_df.head()","122ef232":"# Dropping Nas\ncalifornia_store_3_last_1_year_df_without_Nas_list = list(california_store_3_last_1_year_df.iloc[0,:].dropna().index)\ncalifornia_store_3_last_1_year_df_without_Nas = california_store_3_last_1_year_df.loc[:, california_store_3_last_1_year_df_without_Nas_list]\ncalifornia_store_3_last_1_year_df_without_Nas.head() # 3021 items","d44de83d":"# Fuction for filtering hobbies\ndef california_store_3_hobbies(item):\n    category = item.split('_')[0]\n    if (category == 'HOBBIES'): \n        return True\n    else: \n        return False","0f4c0f64":"categorical_variables = list(california_store_3_last_1_year_df_without_Nas.columns[:26])\ncalifornia_store_3_last_1_year_without_Nas_item_list = list(california_store_3_last_1_year_df_without_Nas.columns[26:])\ncalifornia_store_3_last_1_year_without_Nas_item_hobbies = filter(california_store_3_hobbies, california_store_3_last_1_year_without_Nas_item_list)\ncalifornia_store_3_last_1_year_without_Nas_item_hobbies_list = categorical_variables + [i for i in california_store_3_last_1_year_without_Nas_item_hobbies]","f8c4543b":"california_store_3_last_1_year_without_Nas_item_hobbies_df = california_store_3_last_1_year_df_without_Nas.loc[:,california_store_3_last_1_year_without_Nas_item_hobbies_list]\ncalifornia_store_3_last_1_year_without_Nas_item_hobbies_df","ec4d307d":"master_df = california_store_3_last_1_year_without_Nas_item_hobbies_df.copy()","6681fe8c":"master_df_all_items = master_df.iloc[:,:]","367c4ea6":"# Packages for arima\n!python3.7 -m pip install --upgrade pip\n!pip install pmdarima\nfrom pmdarima.arima import auto_arima","fd3638b8":"# loop for arima\n\ntarget_variables = master_df_all_items.iloc[:,26:].columns\n\npredictions_ar = pd.DataFrame(np.arange(1,29),columns=['index'])\n\nfor target_variable in target_variables:\n     \n    # Making dataset\n    dataset = master_df[target_variable]\n\n    # Splitting train and test data\n    df_arima_train = dataset[:-28]\n    \n    # Defining model\n    stepwise_model = auto_arima(df_arima_train,start_p=1,start_q=1,max_p=3,max_q=3,m=7,start_P=0,seasonal=True,d=1,D=1,trace=True,error_action='ignore',suppress_warnings=True,stepwise=True)\n\n    # Predictions\n    test_predictions = stepwise_model.predict(n_periods=28)\n\n    test_predictions = pd.DataFrame(test_predictions, columns=[target_variable])\n    predictions_ar = pd.concat([predictions_ar, test_predictions], 1)","0d94cb94":"fig = go.Figure()\n\n\nfig.add_trace(go.Scatter(x=predictions_ar.index, y=predictions_ar.sum(axis=1),mode='lines',name='pred_ar'))\n\n    \nfig.update_layout(\n    autosize=False,\n    width=1000,\n    height=700,\n    margin=dict(\n        l=50,\n        r=50,\n        b=100,\n        t=100,\n        pad=4\n    ),\n    paper_bgcolor=\"LightSteelBlue\",\n    title=\"Walmart California store 3 hobbies sales for 15 items\",\n    xaxis_title=\"Date\",\n    yaxis_title=\"Sales\",\n    font=dict(\n        family=\"Courier New, monospace\",\n        size=18,\n        color=\"#042a30\"\n    )\n)\n\n\nfig.update_xaxes(rangeslider_visible=True)\nfig.show()","6bbdf89d":"predictions_ar.to_csv('\/kaggle\/working\/CA_3_hobbies_ar.csv', index=False)","478de9b5":"# Model building and preprocessing","3c49a15e":"### Seperating Hobbies items","2926a322":"## Pre-processing total_value dataset","a7e5f14f":"## Pre-processing cal dataset","c0f811d0":"## Reading data","8dd5012f":"**Arima**","31945fb5":"## Importing libraries"}}