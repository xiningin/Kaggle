{"cell_type":{"1f388100":"code","fab5337c":"code","c75df868":"code","ac3327f4":"code","9ca5906a":"code","0ae5170e":"code","d752c648":"code","653890df":"code","520db77b":"code","504e9ccb":"code","96fb4585":"code","775716f0":"code","f079e9a6":"code","0e4c3c00":"code","ea230c71":"code","89a82c0c":"code","b4c2801b":"code","b048f6fd":"code","b7a9b481":"code","f991a452":"code","aab482d5":"code","7809ca3a":"code","bafc5d15":"code","b9b60ded":"code","18c148ca":"code","c2f55ebb":"code","7ad79803":"code","e0e8d85c":"code","45086455":"code","cca9223a":"markdown","08eb8381":"markdown","4c6ec903":"markdown","f61555d8":"markdown","e4b7343d":"markdown","cce48497":"markdown","35e83db5":"markdown","9b434cf3":"markdown","fd8b6f9d":"markdown","1151f340":"markdown","6b189dd0":"markdown","c803b2d9":"markdown","746f0588":"markdown","6292f76f":"markdown"},"source":{"1f388100":"import numpy as np\nimport pandas as pd\nimport matplotlib.image as mpimg\nimport matplotlib.pyplot as plt\nimport os\nimport zipfile\nimport random\nimport tensorflow as tf\n\nfrom tensorflow.keras.layers import Conv2D, MaxPooling2D, Flatten, Dense, BatchNormalization, Dropout\nfrom tensorflow.keras.models import Sequential\nfrom tensorflow.keras.optimizers import RMSprop\nfrom tensorflow.keras.preprocessing import image\nfrom tensorflow.keras.preprocessing.image import ImageDataGenerator\nfrom tensorflow.keras.callbacks import EarlyStopping\nfrom shutil import copyfile","fab5337c":"local_zip = '..\/input\/dogs-vs-cats\/train.zip'\nzip_ref = zipfile.ZipFile(local_zip, 'r')\nzip_ref.extractall('\/tmp\/source')\nzip_ref.close()\nprint('No. of Training Images: ', len(os.listdir('\/tmp\/source\/train')))","c75df868":"os.listdir('\/tmp\/source\/train')[:10]","ac3327f4":"plt.figure(figsize=(16,16))\n\nimages = os.listdir('\/tmp\/source\/train')\nfor i in range(8):\n    img = random.choice([x for x in images])\n    fig = plt.subplot(4,4,i+1)\n    fig.axis('off')\n    img = mpimg.imread(os.path.join('\/tmp\/source\/train', img)) \n    fig.imshow(img) ","9ca5906a":"local_zip = '..\/input\/dogs-vs-cats\/test1.zip'\nzip_ref = zipfile.ZipFile(local_zip, 'r')\nzip_ref.extractall('\/tmp\/source')\nzip_ref.close()\nprint('No. of Testing Images: ',len(os.listdir('\/tmp\/source\/test1')))","0ae5170e":"os.listdir('\/tmp\/source\/test1')[:10]","d752c648":"try:\n    parent_dir = '\/tmp\/cats-v-dogs'\n    os.mkdir(parent_dir)\n\n    for dir in ['training', 'validation']:\n        path = os.path.join(parent_dir , dir)\n        os.mkdir(path)\n        for dir in ['cats', 'dogs']:\n            n_path = os.path.join(path , dir)\n            os.mkdir(n_path)\nexcept OSError:\n    print('error')","653890df":"src_dir = '\/tmp\/source\/train'\n\ncats_train_dir = '\/tmp\/cats-v-dogs\/training\/cats\/'\ncats_valid_dir = '\/tmp\/cats-v-dogs\/validation\/cats\/'\n\ndogs_train_dir = '\/tmp\/cats-v-dogs\/training\/dogs\/'\ndogs_valid_dir = '\/tmp\/cats-v-dogs\/validation\/dogs\/'\n\n# List of cats names in all training images\ncats =[img for img in os.listdir(src_dir) if img[:3] == 'cat']\n\n# List of dogs names in all training images\ndogs =[img for img in os.listdir(src_dir) if img[:3] == 'dog']\n\n# Take 10% of training images for validation    \ncats_valid_sample = random.sample(cats, int(0.1*len(cats))) \ndogs_valid_sample = random.sample(dogs, int(0.1*len(dogs)))\n\nfor img in os.listdir(src_dir):\n    src_img = os.path.join(src_dir, img)\n    \n    if img[:3] == 'cat':\n        if img in cats_valid_sample:\n            dest_img = os.path.join(cats_valid_dir, img)\n        else:\n            dest_img = os.path.join(cats_train_dir, img)\n        \n    elif img[:3] == 'dog':\n        if img in dogs_valid_sample:\n            dest_img = os.path.join(dogs_valid_dir, img)\n        else:\n            dest_img = os.path.join(dogs_train_dir, img)\n\n    copyfile(src_img, dest_img)  ","520db77b":"print('No. of ALL cats : ', len(cats))\nprint('No. of cats for training: ', len(os.listdir(cats_train_dir)))\nprint('No. of cats for validation: ', len(os.listdir(cats_valid_dir)))\n\nprint('\\nNo. of ALL dogs : ', len(dogs))\nprint('No. of dogs for training: ', len(os.listdir(dogs_train_dir)))\nprint('No. of dogs for validation: ', len(os.listdir(dogs_valid_dir)))","504e9ccb":"plt.figure(figsize=(16,16))\n\nimages = os.listdir(cats_train_dir)\nfor i in range(8):\n    img = random.choice([x for x in images])\n    fig = plt.subplot(4,4,i+1)\n    fig.axis('off')\n    img = mpimg.imread(os.path.join(cats_train_dir, img)) \n    fig.imshow(img) ","96fb4585":"plt.figure(figsize=(16,16))\n\nimages = os.listdir(dogs_valid_dir)\nfor i in range(8):\n    img = random.choice([x for x in images])\n    fig = plt.subplot(4,4,i+1)\n    fig.axis('off')\n    img = mpimg.imread(os.path.join(dogs_valid_dir, img)) \n    fig.imshow(img) ","775716f0":"# All images will be rescaled by 1.\/255\n# All images will be resized to 150x150\n\ntrain_datagen = ImageDataGenerator(rescale=1\/255,rotation_range=40, width_shift_range=0.2, height_shift_range=0.2,\n                                   shear_range=0.2,zoom_range=0.2,horizontal_flip=True, fill_mode='nearest')\nvalid_datagen = ImageDataGenerator(rescale=1\/255)\n\n\ntrain_dir = '\/tmp\/cats-v-dogs\/training\/'\ntrain_generator = train_datagen.flow_from_directory(train_dir, target_size=(150, 150), batch_size=28, class_mode='binary')\n\nvalid_dir = '\/tmp\/cats-v-dogs\/validation\/'\nvalid_generator = valid_datagen.flow_from_directory(valid_dir,target_size=(150, 150), batch_size=28,class_mode='binary')","f079e9a6":"early_stopping = EarlyStopping( min_delta=0.01, # minimium amount of change to count as an improvement\n                                patience=5, # how many epochs to wait before stopping\n                                restore_best_weights=True,\n                              )\n\nstrategy = tf.distribute.MirroredStrategy()\n\nwith strategy.scope():\n    model = Sequential([     Conv2D(32, (3,3), activation='relu', input_shape=(150, 150, 3)),\n                             MaxPooling2D(2, 2),\n\n                             Conv2D(64, (3,3), activation='relu'),\n                             MaxPooling2D(2,2),\n\n                             Conv2D(64, (3,3), activation='relu'),\n                             MaxPooling2D(2,2),\n\n                             Flatten(),\n\n                             Dense(128, activation='relu'),\n                             Dense(1, activation='sigmoid')      \n                        ])\n\n    model.compile(optimizer='adam', loss='binary_crossentropy', metrics=['accuracy'])\n                        \nmodel.summary()","0e4c3c00":"history = model.fit(train_generator, epochs=20, verbose=1,validation_data=valid_generator, callbacks = [early_stopping])","ea230c71":"print(valid_generator.class_indices)","89a82c0c":"history_df = pd.DataFrame(history.history)\nhistory_df.loc[:,['loss','val_loss']].plot()\nhistory_df.loc[:,['accuracy','val_accuracy']].plot()","b4c2801b":"model.evaluate(valid_generator)","b048f6fd":"test_dir = '\/tmp\/source\/test1'\nos.listdir(test_dir)[:10]","b7a9b481":"def convert_one_img(img_folder, img):\n  # dimensions of image\n    img_width, img_height = 150, 150\n    img = os.path.join(img_folder, img)\n    img = image.load_img(img, target_size=(img_width, img_height))\n    img = image.img_to_array(img)\n    img = np.expand_dims(img, axis=0)\n    img \/= 255\n\n    return img","f991a452":"def convert_imgs_to_tensors(img_folder):\n\n  # load all images into a list\n  images = []\n\n  for img in os.listdir(img_folder):\n    img = convert_one_img(img_folder, img)\n    images.append(img)\n\n  # stack up images list to pass for model\n  images = np.vstack(images)\n\n  return images","aab482d5":"img1= convert_one_img(test_dir, os.listdir(test_dir)[0])\nmodel.predict(img1)","7809ca3a":"plt.figure(figsize=(16,16))\n\nimages = os.listdir(cats_train_dir)[:20]\nfor i, img in enumerate(images):\n    fig = plt.subplot(5,5,i+1)\n    fig.axis('off')\n    img = mpimg.imread(os.path.join(cats_train_dir, img)) \n    fig.imshow(img)\n    pic = convert_one_img(cats_train_dir, os.listdir(cats_train_dir)[i])\n    label = 'Cat' if (model.predict(pic) < 0.5).astype('int') else 'Dog'\n    plt.title(label)","bafc5d15":"plt.figure(figsize=(16,16))\n\nimages = os.listdir(dogs_valid_dir)[:18]\nfor i, img in enumerate(images):\n    fig = plt.subplot(5,5,i+1)\n    fig.axis('off')\n    img = mpimg.imread(os.path.join(dogs_valid_dir, img)) \n    fig.imshow(img)\n    pic = convert_one_img(dogs_valid_dir, os.listdir(dogs_valid_dir)[i])\n    label = 'Cat' if (model.predict(pic) < 0.5).astype('int') else 'Dog'\n    plt.title(label)","b9b60ded":"test_dir = '\/tmp\/source\/test1'\ntest_images= convert_imgs_to_tensors(test_dir)","18c148ca":"plt.figure(figsize=(20,20))\n\nimages = os.listdir(test_dir)[:100]\nfor i, img in enumerate(images):\n    fig = plt.subplot(10,10,i+1)\n    fig.axis('off')\n    img = mpimg.imread(os.path.join(test_dir, img)) \n    fig.imshow(img)\n    pic = convert_one_img(test_dir, os.listdir(test_dir)[i])\n    label = 'Cat' if (model.predict(pic) < 0.5).astype('int') else 'Dog'\n    plt.title(label)","c2f55ebb":"pred = (model.predict(test_images) > 0.5).astype('int')","7ad79803":"test_dir = '\/tmp\/source\/test1'\ntest_data = os.listdir(test_dir)\ntest_df = pd.DataFrame({ \"id\" : test_data})\ntest_df","e0e8d85c":"test_df['id'] = test_df['id'].str.split('.').str[0]\ntest_df['label'] = pred\ntest_df.head(20)","45086455":"test_df.to_csv('submission.csv',index=False)","cca9223a":"# Images Augmentation","08eb8381":"> Only 5\/100 are wrong predictions from first 100 images of testing data","4c6ec903":"# Predicting of Testing Images\n","f61555d8":"# Visualizing Random images of cats for training","e4b7343d":"# Visualizing Random images of dogs for validation","cce48497":"# Directories\n\n * cats-v-dogs:\n    * training:\n        * cats\n        * dogs\n    * validation:\n        * cats\n        * dogs","35e83db5":"# Unzipping Testing Images","9b434cf3":"# Unzipping Training Images","fd8b6f9d":"# Check Predictions on First 100 Images of Testing Data","1151f340":"# Visualizing Random Images","6b189dd0":"# Import Libraries","c803b2d9":"# Try Prediction on Validation Data (Dogs)","746f0588":"# Our CNN","6292f76f":"# Try Prediction on Training Data (Cats)"}}