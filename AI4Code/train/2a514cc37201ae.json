{"cell_type":{"518e1836":"code","d3db4318":"code","a067933f":"code","9ad8b0e5":"code","a0673a6e":"code","abd3263f":"code","9e0b1c65":"code","92c055d3":"code","89a00c8f":"code","7b71e262":"code","8b6143f6":"code","b84d6507":"code","ed108a17":"markdown","aa1c634b":"markdown","ae0ef4be":"markdown","776a20f9":"markdown","82bfb63a":"markdown","9f7634c7":"markdown","9e7616b6":"markdown","551f03e4":"markdown","383751f8":"markdown","5afa2ba0":"markdown","e06149bb":"markdown","0227cbd1":"markdown","ae16b608":"markdown"},"source":{"518e1836":"import requests\nimport json\nimport numpy as np\nimport pandas as pd\nimport geopandas as gpd #I'm not sure if any functionality of geopandas is needed for this project, but it's cool, an I wanted to check:)\nimport folium\nimport folium.plugins\n%matplotlib inline","d3db4318":"url_base='https:\/\/terkep.police.hu\/api\/odata\/v1\/'\nurl_crimes='https:\/\/terkep.police.hu\/api\/odata\/v1\/Crimes'\nurl_accidents='https:\/\/terkep.police.hu\/api\/odata\/v1\/Accidents'\nurl_infections='https:\/\/terkep.police.hu\/api\/odata\/v1\/Infections'","a067933f":"resp=requests.get(url_base+\"Crime('CRIME_30_ALL_CRIME')\") #it is sooo simple to get data with requests library, I love it!\nif resp.status_code != 200:\n    # This means something went wrong.\n    raise requests.HTTPError('Error {}'.format(resp.status_code))\n\nprint(resp.headers['content-type'])\nresp.encoding = 'UTF-8'\nwith open('data4.json', 'w') as outfile:\n    #I'm saving the data locally just in case, not used in the rest of the notebook\n    json.dump(resp.json(), outfile)\n","9ad8b0e5":"crime_json=pd.DataFrame(resp.json())\ncrime_json.head()","a0673a6e":"#We actually need data column only\ncrime=pd.DataFrame(dict(crime_json['data'])).transpose()\ncrime.head()","abd3263f":"crime.shape","9e0b1c65":"crime.dtypes","92c055d3":"crime['lat']=crime['lat'].astype(float)\ncrime['lon']=crime['lon'].astype(float)\ncrime.dtypes","89a00c8f":"gdf_crime=gpd.GeoDataFrame(crime, geometry=gpd.points_from_xy(crime['lon'], crime['lat']))\ngdf_crime.head()","7b71e262":"gdf_crime['Description']=gdf_crime['shortInfo']+'<br>'+gdf_crime['longInfo'].apply(lambda str: (str.split('\\\\'))[0])\ngdf_crime.head()","8b6143f6":"map=folium.Map(location=[47.16,19.50],zoom_start=7,min_zoom=7)\ncrime_group=folium.plugins.FastMarkerCluster([]).add_to(map)\n\nfor geo,label in zip(gdf_crime['geometry'],gdf_crime['Description']):\n    folium.Marker(\n        location=[geo.x,geo.y],\n        icon=None,\n        tooltip=label \n    ).add_to(crime_group)\n\nmap.add_child(crime_group)\nmap","b84d6507":"map.save('map.html') #and it can be saved into an html file, keeping all interactivity!","ed108a17":"I'm creating a GeoDataFrame from the coordinates, you will see later though that it is not necessary for the project. But I wanted to experiment.:)","aa1c634b":"# Visualizing Hungarian Crime Data with Folium","ae0ef4be":"Ok, so there were over ten thousand reported crime in the last 30 days in Hungary. We don't get much info, but it's enough for map visualization. There are coordinates (**lat** and **lon**) and the type of the crime in **longInfo**. We'll use these.","776a20f9":"Hungarian Police publishes geospatial data about crimes and accidents around the country. You can find nice maps and charts on the website but you can also download raw data through an API. The API documentation can be chekced here: https:\/\/terkep.police.hu\/portal\/open-data-api (Documentation is Hungarian only, unfortunately.)","82bfb63a":"## First, the usual imports","9f7634c7":"## And the actual magic!","9e7616b6":"**lat** and **lon** are strings!","551f03e4":"## Some data cleaning...","383751f8":"I'm a beginner, and I have just finished a Python data visualization course which included map charts and I wanted to practice what I have just learned. :) My first project is to show committed crimes in Hungary in the last 30 days on a map.","5afa2ba0":"## Getting Crime data from Police API and loading into a DataFrame","e06149bb":"I'm converting **shortInfo** and **longInfo** into a more proper description I can use it as a marker label","0227cbd1":"It is quite amazing how simple it is to create an interactive, and very eye-pleasing map. It's like 6 lines of code!\n\nPlease note that accented letters are show incorrectly in this notebook, but they are correct in html version. (See next step.)","ae16b608":"Thank you for looking at this notebook. I'm thankful for any feedbacks. Especially for suggestions of improvements, simplification, best parctice, etc."}}