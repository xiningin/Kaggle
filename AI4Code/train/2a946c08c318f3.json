{"cell_type":{"32b5cdc1":"code","9160d201":"code","82447a37":"code","84b4bab3":"code","ba08012e":"code","4fb176d5":"code","ed97b4f7":"code","468bd75a":"code","6f1e249d":"code","1e21a773":"code","7328c8a7":"code","85c987b6":"code","f78158f0":"code","e071f9a0":"code","722c98f7":"code","b9c7c63c":"code","7f7f17d5":"code","f8c06b85":"code","095938b1":"code","61c3e090":"code","231baf7e":"code","14578002":"code","3150450a":"code","3ef97917":"code","95b1a79e":"code","a5fee766":"code","e66cb6e6":"code","1b65fde3":"code","5c35f4ff":"code","adce7870":"code","162d4d11":"code","b39c5ed2":"code","8249c7df":"code","047e6ea4":"code","8390f075":"code","ae469751":"code","fe6ae175":"code","85654143":"code","43bdd0d6":"code","a3de39ff":"code","4b2e501b":"code","73709d6e":"code","574207ff":"code","c7177464":"code","7264da9b":"code","e838dea5":"code","84de4ce9":"markdown","db002c39":"markdown","d5e52e51":"markdown","9852a78f":"markdown","d031b31d":"markdown","49e39344":"markdown","5e4b86aa":"markdown","02063d22":"markdown","18fa5e67":"markdown","1b5b7702":"markdown","e5bf0d41":"markdown","d9488181":"markdown","4369f29b":"markdown","6e6b7f0e":"markdown","3acf549a":"markdown","6493032b":"markdown","42502509":"markdown","b7eee9e5":"markdown","b19ea313":"markdown"},"source":{"32b5cdc1":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.decomposition import PCA\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.ensemble import GradientBoostingRegressor\nfrom sklearn.metrics import mean_squared_error,mean_absolute_error,r2_score\nsns.set()","9160d201":"original=pd.read_csv('..\/input\/BlackFriday.csv')","82447a37":"print(original.head())\nprint(original.shape)\nprint(original.isnull().sum())\nprint(original.dtypes)","84b4bab3":"original['User_ID']=original['User_ID'].astype('str')","ba08012e":"original['Product_Category_2']=original['Product_Category_2'].fillna(round(np.mean(original['Product_Category_2']),0))\noriginal['Product_Category_3']=original['Product_Category_3'].fillna(round(np.mean(original['Product_Category_3']),0))","4fb176d5":"original.isnull().sum()","ed97b4f7":"original['Product_Category_2']=original['Product_Category_2'].astype('str')\noriginal['Product_Category_3']=original['Product_Category_3'].astype('str')","468bd75a":"original.head()","6f1e249d":"original.dtypes","1e21a773":"original['Purchase'].describe()","7328c8a7":"def cv(data):\n    x=data.std()\n    y=data.mean()\n    coefficientofvariation=round((x\/y)*100,4)\n    return coefficientofvariation","85c987b6":"print('Purchase skewness:',original['Purchase'].skew())\nprint('Purchase kurtosis:',original['Purchase'].kurt())\nprint('Purchase cv:%1.2f%%'%(cv(original['Purchase'])))\nprint('Purchase mode:',original['Purchase'].mode())\nprint('Purchase range:',original['Purchase'].max()-original['Purchase'].min())","f78158f0":"z1=plt.figure(figsize=(15,14))\noriginal['Purchase'].plot(kind='kde',title='Black Friday Purchase distribution plot')\nplt.text(-10000,0.00014,'std:%1.2f'%(original['Purchase'].std()))\nplt.show()","e071f9a0":"original.columns","722c98f7":"ageGroup=original.groupby(by='Age')\nageam=ageGroup.sum()\nageAmount=pd.DataFrame(ageam.loc[:,'Purchase'])","b9c7c63c":"z2=plt.figure(figsize=(15,14))\ny=np.array(ageAmount['Purchase'])\nlabel=np.array(ageAmount.index)\nexplode=[0.0,0.0,0.05,0.0,0.0,0.0,0.0]\nplt.pie(y,labels=label,explode=explode,autopct='%1.2f%%')\nplt.title('Black Friday purchase amount percentage by age pie chart',fontsize='large')\nplt.show()","7f7f17d5":"z3=ageAmount.plot.bar(figsize=(15,14),title='Black Friday purchase amount by age bar chart',legend=False)\nz3.get_figure()\nx=np.arange(ageAmount.index.shape[0])\ny=np.array(ageAmount['Purchase'])\nfor i,j in zip(x,y):\n    plt.text(i,j+10000000,format(j,','),ha='center',color='blue')\nplt.xticks(range(ageAmount.index.shape[0]),ageAmount.index,rotation=0)\nplt.ylabel('Amount')\nplt.xlabel('Age')\nplt.show()","f8c06b85":"GenderGroup=original.groupby(by='Gender')\nGendersum=GenderGroup.sum()\nGenderSum=pd.DataFrame(Gendersum.loc[:,'Purchase'])","095938b1":"z4=plt.figure(figsize=(15,14))\nlabels=['Female','Male']\nexplode=[0,0.05]\ny=np.array(GenderSum['Purchase'])\nplt.title('Black Friday purchase amount by gender pie chart',fontsize='large')\nplt.pie(y,labels=labels,explode=explode,autopct='%1.2f%%')\nplt.show()","61c3e090":"z5=GenderSum.plot.bar(figsize=(15,14),legend=False,width=0.3)\nz5.get_figure()\nplt.title('Black Friday purchase amount by gender bar chart',fontsize='large')\nplt.xticks(range(2),['Female','Male'],rotation=0)\nx=np.arange(GenderSum.index.shape[0])\ny=np.array(GenderSum['Purchase'])\nfor i,j in zip(x,y):\n    plt.text(i,j+10000000,format(j,','),ha='center',color='blue')\nelse:\n    pass\nplt.show()","231baf7e":"original.head()","14578002":"original.dtypes","3150450a":"data=original.loc[:,['Gender','Occupation','Age','City_Category','Stay_In_Current_City_Years',\n                    'Marital_Status','Product_Category_1','Purchase']]\ndata.head()","3ef97917":"predata=data.sample(n=10000)","95b1a79e":"predata.head()","a5fee766":"for i in range(predata.index.shape[0]):\n    if predata.iloc[i,0]=='F':\n        predata.iloc[i,0]=0\n    else:\n        predata.iloc[i,0]=1","e66cb6e6":"predata['Age'].unique()","1b65fde3":"for i in range(predata.index.shape[0]):\n    if predata.iloc[i,2]=='0-17':\n        predata.iloc[i,2]=0\n    elif predata.iloc[i,2]=='18-25':\n        predata.iloc[i,2]=1\n    elif predata.iloc[i,2]=='26-35':\n        predata.iloc[i,2]=2\n    elif predata.iloc[i,2]=='36-45':\n        predata.iloc[i,2]=3\n    elif predata.iloc[i,2]=='46-50':\n        predata.iloc[i,2]=4\n    elif predata.iloc[i,2]=='51-55':\n        predata.iloc[i,2]=5\n    else:\n        predata.iloc[i,2]=6","5c35f4ff":"predata['City_Category'].unique()","adce7870":"for i in range(predata.index.shape[0]):\n    if predata.iloc[i,3]=='A':\n        predata.iloc[i,3]=0\n    elif predata.iloc[i,3]=='B':\n        predata.iloc[i,3]=1\n    else:\n        predata.iloc[i,3]=2","162d4d11":"predata['Stay_In_Current_City_Years'].unique()","b39c5ed2":"for i in range(predata.index.shape[0]):\n    if predata.iloc[i,4]=='4+':\n        predata.iloc[i,4]=5","8249c7df":"print(predata.head())\nprint(predata.dtypes)","047e6ea4":"predata['Stay_In_Current_City_Years']=predata['Stay_In_Current_City_Years'].astype('int64')","8390f075":"pm=pd.DataFrame(predata.corr(method='pearson'))\npm.sort_values(by='Purchase',ascending=False)","ae469751":"data=predata.iloc[:,0:7]\ntarget=predata.loc[:,'Purchase']\ndata.head()","fe6ae175":"pcamodel=PCA(n_components=7).fit(data)\nprint(pcamodel.explained_variance_ratio_)","85654143":"pcaModel=PCA(n_components=2).fit(data)\npcaData=pcaModel.transform(data)","43bdd0d6":"train_pca_data,test_pca_data, \\\ntrain_pca_target,test_pca_target = \\\ntrain_test_split(pcaData,target,train_size=0.6)","a3de39ff":"pcaGBR=GradientBoostingRegressor(learning_rate=0.2).fit(train_pca_data,train_pca_target)","4b2e501b":"pcaGBR","73709d6e":"pcaGBRpre=pcaGBR.predict(train_pca_data)\nprint('mean_absolute_error:%1.2f'%mean_absolute_error(train_pca_target,pcaGBRpre))\nprint('mean_squared_error:%1.2f'%mean_squared_error(train_pca_target,pcaGBRpre))\nprint('r2_score:%1.2f'%(r2_score(train_pca_target,pcaGBRpre)))","574207ff":"pcaGBRpredict=pcaGBR.predict(test_pca_data)\nprint('mean_absolute_error:%1.2f'%mean_absolute_error(test_pca_target,pcaGBRpredict))\nprint('mean_squared_error:%1.2f'%mean_squared_error(test_pca_target,pcaGBRpredict))\nprint('r2_score:%1.2f'%r2_score(test_pca_target,pcaGBRpredict))","c7177464":"pcaDTR=DecisionTreeRegressor(max_depth=7).fit(train_pca_data,train_pca_target)\npcaDTR","7264da9b":"pcaDTRpre=pcaDTR.predict(train_pca_data)\nprint('mean_absolute_error:%1.2f'%mean_absolute_error(train_pca_target,pcaDTRpre))\nprint('mean_squared_error:%1.2f'%mean_squared_error(train_pca_target,pcaDTRpre))\nprint('r2_score:%1.2f'%(r2_score(train_pca_target,pcaDTRpre)))","e838dea5":"pcaDTRpredict=pcaDTR.predict(test_pca_data)\nprint('mean_absolute_error:%1.2f'%mean_absolute_error(test_pca_target,pcaDTRpredict))\nprint('mean_squared_error:%1.2f'%mean_squared_error(test_pca_target,pcaDTRpredict))\nprint('r2_score:%1.2f'%r2_score(test_pca_target,pcaDTRpredict))","84de4ce9":"# Kaggle-Black Friday dataset\n\n## 2019-04-11 start","db002c39":"## Summary\n\n- Data is dispersion\n\n\n- Mode of data is 6,855\n\n\n- percentage of each age\n\n\nAge | percentage\n---- | --------------- |\n0-17 | 2.64% |\n18-25 | 17.97% |\n26-35 | 39.85% |\n36-45 | 20.14% |\n46-50 | 8.24% |\n51-55 | 7.21% |\n55+ | 3.94% |\n\n\n- 26-35 has more consumption than other age\n\n\n- Male has more consumption than female,which accounts for 76.79 percent of purchase amount\n\n\n- The correlation of features are weak\n\n\n- Using pca data may better than choosing features to train models \n\n\n- Using Gradient Boosting Regressor may be better than Decision Tree Regressor","d5e52e51":"### Summary\n\n- The correlation coefficient is normally small\n\n\n- The correlation between purchase and other features is weak\n\n\nWith using Pearson coefficient,finding that the correlation between every features is weak,\n\nIf use choosing features to train models,may not be very well\n\nSo choosing other method may be better,\n\nbelow this,will do principal component analysis.\n\nTo find the best number of n_components,\n\nand use pca data to train models.","9852a78f":"### Summary\n\n- Two ways:Gradient Boosting Regressor and Decision Tree Regressor\n\n\n\n- Using Gradient Boosting Regressor with learning_rate=0.2,\n  \n  r2 score is well,and mean absolute error seems to be reasonable\n\n\n\n- Using Decision Tree Regressor with max_depth=7,\n\n  r2 socre is well,and mean absolute error seems to be reasonable\n\n\n\n- According to r2 score,Gradient Boosting Regressor may be better than Decision Tree Regressor\n\n\n\n- Using pca data seems to be fine","d031b31d":"## Data Preproccesing","49e39344":"## Predict","5e4b86aa":"## Correlation analysis--Pearson coefficient matrix","02063d22":"## Question definition\n\n- What is the percentage of every age?\n\n\n- Which age range is the most group of consumption?\n\n\n- Male or Female has most consumption?\n\n\n- With using machine learning,can we predict purchase amount?","18fa5e67":"## Summary\n\n- Standard deviation is large,coefficient of variation is 50 percent,\n  \n  and range of purchase is 23776,which means this data is dispersion.\n  \n  \n- Skewness value is 0.6,which is bigger than 0,means data distribution\n  \n  is skewed frequency distribution,and data is possitive distribution\n\n\n- Kurtosis value is -0.3,which is smaller than 0,means kurtosis is platykurtic\n\n\n- Data distribution is more distributed under mean of data\n\n\n- According to Central Limit Theroem,distribution is close to normal distribution","1b5b7702":"## Predict--GradientBoostingRegressor","e5bf0d41":"### Summary\n\nWith using sklearn.decomposition.PCA,\n\nand finding explained variance ratio,\n\nfind the best number of n_components is 2.\n\nSo using n_components=2 to fit the data and transform,\n\nand using this data to train models.","d9488181":"## Predict--Decision Tree Regressor","4369f29b":"## Data preprocessing","6e6b7f0e":"## Gender","3acf549a":"## Describe Statistics--Purchase\n\nFind:\n\n- five-number summary(\u4e94\u6578\u6458\u8981)\n\n\n- skewness\n\n\n- kurtosis\n\n\n- coefficient of variation\n\n\n- mode\n\n\n- range\n","6493032b":"## Summary\n\n\n- 26-35 has the highest proportion,\n\n  which accounts for 39.85 percent of Black Friday purchase amount\n  \n  \n- 36-45 has second higher proportion,\n\n  which accounts for 20.14 percent of Black Friday purchase amount\n  \n  \n- 55+ has more proportion than 0-17\n\n\n- 0-17 has least proportion,\n\n  which accounts for 2.64 percent of Black Friday purchase amout","42502509":"## Principal Component Analysis","b7eee9e5":"## Summary\n\n- Male's consumption is much more higher than female's\n\n\n- Male accounts for 76.79 percentage of Black Friday purchase amount\n\n\n- Female accounts for 23.21 percentage of Black Friday purchase amount\n\n\n- The deviation of male's consumption and female's consumption is about 2.7 ten million(dollars)","b19ea313":"## Age"}}