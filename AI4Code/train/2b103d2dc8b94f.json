{"cell_type":{"90ace0db":"code","178210bd":"code","3fc50675":"code","7ec24c68":"code","0bfbb571":"code","2e370e72":"code","96a8a867":"code","4ac4988c":"code","b9b4658b":"code","665ec5ae":"code","ed21cbbb":"code","8fd200d6":"code","b20de7cc":"code","6f4d3316":"code","b411821f":"code","f2b72146":"code","10e412ca":"code","01552a02":"code","103943a7":"code","5319f47c":"markdown","00d3c9a5":"markdown","b1378ef3":"markdown","01b4a510":"markdown","3b09a38c":"markdown","ad0aae97":"markdown","c191c060":"markdown","19f58716":"markdown","1053e98f":"markdown","1cf45902":"markdown","6608494b":"markdown","ce251b19":"markdown","7c1efd07":"markdown"},"source":{"90ace0db":"import pandas as pd\nimport numpy as np\nimport librosa\nimport librosa.display\nfrom keras import layers\nfrom keras.models import Sequential\nfrom sklearn.model_selection import train_test_split\nfrom sklearn import preprocessing\nfrom sklearn.metrics import classification_report\nimport os\nimport warnings\nfrom IPython.display import HTML, display\nimport time\nwarnings.filterwarnings('ignore')","178210bd":"data=pd.read_csv(\"\/kaggle\/input\/speech-accent-archive\/speakers_all.csv\",index_col='speakerid')\ndata.head()","3fc50675":"data.info()","7ec24c68":"data.drop(data.columns[8:11],axis=1,inplace=True)\ndata=data.fillna('NaN')\ndata.head()","0bfbb571":"from pathlib import Path\ndirectory_path='\/kaggle\/input\/speech-accent-archive\/recordings\/recordings\/'\ndef feature_engineering(directory_path,data):\n    p=0\n    \n    df=pd.DataFrame()\n    tmp={}\n    #p=1\n    for index, row in data.iterrows():\n        if os.path.isfile(directory_path+row['filename']+'.mp3')==False:\n            print('File '+str(row['filename'])+\".mp3 doesn't exist\")\n            data=data.drop([index])\n            continue\n        tmp['filename']=row['filename']\n        tmp['country']=row['country']\n        y, sr=librosa.load(os.path.join(os.path.abspath(directory_path),row['filename']+'.mp3'))\n        tmp['rms']=np.mean(librosa.feature.rms(y=y))\n        tmp['chroma_stft']=np.mean(librosa.feature.chroma_stft(y=y, sr=sr))\n        tmp['spec_cent']=np.mean(librosa.feature.spectral_centroid(y=y,sr=sr))\n        tmp['spec_bw']=np.mean(librosa.feature.spectral_bandwidth(y=y, sr=sr))\n        tmp['rolloff']=np.mean(librosa.feature.spectral_rolloff(y=y,sr=sr))\n        tmp['zcr']=np.mean(librosa.feature.zero_crossing_rate(y))\n        mfcc=librosa.feature.mfcc(y=y, sr=sr)\n        i=0\n        for e in mfcc: \n            tmp['mfcc'+str(i)]=np.mean(e)\n            i+=1\n        df=df.append([tmp])\n        print(p)\n        p+=1\n    return df\n    ","2e370e72":"df=feature_engineering(directory_path,data)","96a8a867":"df.to_csv('processed_metadata.csv')","4ac4988c":"data_to_fit=pd.read_csv('processed_metadata.csv')","b9b4658b":"data_to_fit.head()","665ec5ae":"data_to_fit['country'].value_counts()","ed21cbbb":"freq=data_to_fit['country'].value_counts()\nfrequent_values=freq[freq>=35].index\ndata_to_fit=data_to_fit[data_to_fit['country'].isin(frequent_values)]\ndata_to_fit=data_to_fit.drop(data_to_fit[data_to_fit['country']=='usa'].sample(frac=.90).index)\ndata_to_fit=data_to_fit.drop(data_to_fit[data_to_fit['country']=='china'].sample(frac=.45).index)\ndata_to_fit=data_to_fit.drop(data_to_fit[data_to_fit['country']=='india'].sample(frac=.4).index)\ndata_to_fit=data_to_fit.drop(data_to_fit[data_to_fit['country']=='canada'].sample(frac=.1).index)\ndata_to_fit=data_to_fit.drop(data_to_fit[data_to_fit['country']=='south korea'].sample(frac=.1).index)\ndata_to_fit=data_to_fit.drop(data_to_fit[data_to_fit['country']=='uk'].sample(frac=.4).index)\ndata_to_fit['country'].value_counts()","8fd200d6":"le=preprocessing.LabelEncoder()\ndata_to_fit['country']=le.fit_transform(data_to_fit['country'].astype(str))","b20de7cc":"(data_to_fit['country'].unique())","6f4d3316":"x_train, x_test, y_train, y_test=train_test_split(data_to_fit.drop(columns=['country','filename','Unnamed: 0']), data_to_fit['country'],test_size=0.2)","b411821f":"model=Sequential()\nmodel.add(layers.Dense(100, activation='relu',input_shape=(x_train.shape[1],)))\nmodel.add(layers.Dense(200, activation='relu'))\nmodel.add(layers.Dense(100, activation='relu'))\nmodel.add(layers.Dense(9, activation='softmax'))\nmodel.compile(optimizer='adam', loss='sparse_categorical_crossentropy',metrics=['accuracy'])\nclassifier=model.fit(x_train, y_train, epochs=1300)","f2b72146":"#Testing as per assignment\ndf_test=pd.DataFrame({'filename':['shivam_sharma'],'country':['india']})\nmetadata_test=feature_engineering('..\/input\/test-audio\/',df_test)","10e412ca":"metadata_test.drop(labels=['filename','country'],inplace=True,axis=1)","01552a02":"le.inverse_transform([model.predict_classes(metadata_test)])","103943a7":"from sklearn.metrics import classification_report\nprint(classification_report(y_test, model.predict_classes(x_test), target_names=['belgium', 'brazil','canada','india', 'china','south korea','turkey', 'uk','usa']))","5319f47c":"**Reading Metadata**","00d3c9a5":"**Importing Required Libraries**","b1378ef3":"**Label Encoding**","01b4a510":"**Saving the processed metadata inorder to reduce time further**","3b09a38c":"**Reading Metadata**","ad0aae97":"**Creating Testing Dataset as per Assignment**","c191c060":"**Dropping Columns:8-10 as they have null values**","19f58716":"**Model Creation**","1053e98f":"**Data Type of given columns**","1cf45902":"**Determing Frequency features of wave**","6608494b":"Note: From the above table we can infer that the data is imbalanced.","ce251b19":"**Sampling Dataset**","7c1efd07":"**Dividing data for cross validation**"}}