{"cell_type":{"aaaf2a1b":"code","af633d6d":"code","9e0b08d6":"code","b7782f03":"code","becbbb76":"code","b0d2bd64":"code","5ebb43d0":"code","a718c777":"code","826acca5":"code","cc0cadb4":"markdown","d874a18a":"markdown","efa068c0":"markdown","a331a009":"markdown","45ea918f":"markdown","3cf5507a":"markdown","effc82a1":"markdown","52c32e64":"markdown","3759c5d8":"markdown","54f9b4a3":"markdown"},"source":{"aaaf2a1b":"import glob\nimport pandas  as pd\nimport numpy   as np\nimport nibabel as nib\nimport matplotlib.pyplot as plt","af633d6d":"# Read and examine metadata\nraw_data = pd.read_csv('..\/input\/covid19-ct-scans\/metadata.csv')\nraw_data.sample(5)","9e0b08d6":"def read_nii(filepath):\n    '''\n    Reads .nii file and returns pixel array\n    '''\n    ct_scan = nib.load(filepath)\n    array   = ct_scan.get_fdata()\n    array   = np.rot90(np.array(array))\n    return(array)","b7782f03":"# Read sample\nsample_ct   = read_nii(raw_data.loc[0,'ct_scan'])\nsample_lung = read_nii(raw_data.loc[0,'lung_mask'])\nsample_infe = read_nii(raw_data.loc[0,'infection_mask'])\nsample_all  = read_nii(raw_data.loc[0,'lung_and_infection_mask'])","becbbb76":"# Examine Shape\nsample_ct.shape","b0d2bd64":"def plot_sample(array_list, color_map = 'nipy_spectral'):\n    '''\n    Plots and a slice with all available annotations\n    '''\n    fig = plt.figure(figsize=(18,15))\n\n    plt.subplot(1,4,1)\n    plt.imshow(array_list[0], cmap='bone')\n    plt.title('Original Image')\n\n    plt.subplot(1,4,2)\n    plt.imshow(array_list[0], cmap='bone')\n    plt.imshow(array_list[1], alpha=0.5, cmap=color_map)\n    plt.title('Lung Mask')\n\n    plt.subplot(1,4,3)\n    plt.imshow(array_list[0], cmap='bone')\n    plt.imshow(array_list[2], alpha=0.5, cmap=color_map)\n    plt.title('Infection Mask')\n\n    plt.subplot(1,4,4)\n    plt.imshow(array_list[0], cmap='bone')\n    plt.imshow(array_list[3], alpha=0.5, cmap=color_map)\n    plt.title('Lung and Infection Mask')\n\n    plt.show()","5ebb43d0":"# Examine one slice of a ct scan and its annotations\nplot_sample([sample_ct[...,120], sample_lung[...,120], sample_infe[...,120], sample_all[...,120]])","a718c777":"def bulk_plot_sample(array_list, index_list):\n    '''\n    Plots multiple slices, wrapper of plot_sample\n    '''\n    for index_value in index_list:\n        plot_sample([array_list[0][...,index_value], array_list[1][...,index_value], array_list[2][...,index_value], array_list[3][...,index_value]])","826acca5":"# Examine multiple slices of a ct scan and its annotations\nbulk_plot_sample([sample_ct, sample_lung, sample_infe, sample_all], index_list=[100,110,120,130,140,150])","cc0cadb4":"From here on you should be able to model the data to your hearts content!\n\nFor any requests let me know here in this kernel or in the discussion.\n\nThank you!","d874a18a":"# COVID-Getting Started","efa068c0":"To make things easier, I created a `metadata.csv` file with all the filepaths organized in it.","a331a009":"The files are provided in NifTi format (\\*.nii) to read it we'll make use of the `nibabel` package.\n\nNote: images were rotated in the source, so we'll add `np.rot90` to account for that.","45ea918f":"Now lets inspect the images, as well as annotations that we have available:","3cf5507a":"Note that `512x512` is the common resolution for ct images, also there are `301` slices in this ct scan.","effc82a1":"This is a simple kernel to show how to use this dataset, as well as explain its contents.","52c32e64":"There are 3 annotations available:\n- Lung Segmentation (contains different values to account for left and right lung)\n- Infection Segmentation (segmentation of radiological findings that could be COVID)\n- Lung + Infection (for the sake of making it simplier)","3759c5d8":"That's an example from a single slice, lets do the same for multiple slices in the same exam.","54f9b4a3":"Let's examine a file and all available annotations"}}