{"cell_type":{"badf2ad0":"code","4d3228b8":"code","42b25ba5":"code","ceac947d":"code","5274a92c":"code","343f08b4":"code","8d8067ea":"code","a00f8eca":"code","83f439c3":"code","43afcddc":"code","8321dc66":"code","e28d212e":"code","b51b3d08":"code","9886d5c2":"code","a68960ab":"code","03da88fb":"code","73e41b36":"markdown","9ca204dd":"markdown","3dc816a4":"markdown"},"source":{"badf2ad0":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport warnings\nwarnings.filterwarnings('ignore')\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","4d3228b8":"#Code by Hitesh Kumar https:\/\/www.kaggle.com\/hitzz97\/emotion-detection\n\nimport tensorflow as tf \nfrom tensorflow.keras.models import Sequential\nfrom tensorflow.keras.layers import Conv2D, MaxPooling2D, BatchNormalization, Flatten, LeakyReLU, Dense, Dropout\nimport matplotlib.pyplot as plt \nfrom tensorflow.keras.callbacks import Callback, EarlyStopping, ReduceLROnPlateau","42b25ba5":"#We have train\/test so let's see how  it works\n\ntrain_path = \"\/kaggle\/input\/snake-dataset-india\/Snake Images\/train\"\ntest_path = \"\/kaggle\/input\/snake-dataset-india\/Snake Images\/test\/\"","ceac947d":"#Code by Hitesh Kumar https:\/\/www.kaggle.com\/hitzz97\/emotion-detection\n\nx = plt.imread(\"\/kaggle\/input\/snake-dataset-india\/Snake Images\/train\/Venomous\/king-cobra-head1.jpg\")\nx.shape","5274a92c":"datagen = tf.keras.preprocessing.image.ImageDataGenerator(rescale=1\/255.)","343f08b4":"#Code by Hitesh Kumar https:\/\/www.kaggle.com\/hitzz97\/emotion-detection\n\ntrain = datagen.flow_from_directory(train_path,target_size=(48,48),class_mode=\"sparse\", seed=1, color_mode=\"grayscale\", batch_size=128)\ntest = datagen.flow_from_directory(test_path,target_size=(48,48),class_mode=\"sparse\", seed=1, color_mode=\"grayscale\", batch_size=128)","8d8067ea":"dir(train)","a00f8eca":"#Code by Hitesh Kumar https:\/\/www.kaggle.com\/hitzz97\/emotion-detection\n\nprint(train.class_indices)\nvenom_dict = {0: \"Non-Venomous\", 1: \"Venomous\"}","83f439c3":"#Code by Hitesh Kumar https:\/\/www.kaggle.com\/hitzz97\/emotion-detection\n\nx, y = train.next()\nprint(x.shape, y.shape)\ntrain.reset()","43afcddc":"#Code by Hitesh Kumar https:\/\/www.kaggle.com\/hitzz97\/emotion-detection\n\nmodel = Sequential([\n    Conv2D(32, (3,3), input_shape=(48,48,1),padding=\"same\"),\n    LeakyReLU(),\n    Conv2D(32, (3,3), padding=\"same\"),\n    LeakyReLU(),\n    BatchNormalization(),\n    MaxPooling2D((2,2)),\n    Dropout(0.2),\n    \n    Conv2D(64,(3,3),padding=\"same\"),\n    LeakyReLU(),\n    Conv2D(64,(3,3), padding=\"same\"),\n    LeakyReLU(),\n    BatchNormalization(),\n    MaxPooling2D((2,2)),\n    Dropout(0.3),\n    \n    Conv2D(128,(3,3),padding=\"same\"),\n    LeakyReLU(),\n    Conv2D(128,(3,3), padding=\"same\"),\n    LeakyReLU(),\n    Conv2D(128,(3,3), padding=\"same\"),\n    LeakyReLU(),\n    BatchNormalization(),\n    MaxPooling2D((2,2)),\n    Dropout(0.4),\n    \n    Flatten(),\n#     tf.keras.layers.GlobalAveragePooling2D(),\n#     Dropout(0.4),\n    \n    Dense(128, activation='relu'),\n    Dropout(0.4),\n#     Dense(64, activation=\"relu\"),\n    \n    Dense(len(train.class_indices), activation=\"softmax\")\n])\nmodel.summary()\nmodel.compile(\n    optimizer=tf.keras.optimizers.RMSprop(learning_rate=1e-3), \n    loss='sparse_categorical_crossentropy', \n    metrics=['accuracy']\n)","8321dc66":"#Code by Hitesh Kumar https:\/\/www.kaggle.com\/hitzz97\/emotion-detection\n\nnet = Sequential(name='DCNN')\n\nnet.add(\n    Conv2D(\n        filters=64,\n        kernel_size=(5,5),\n        input_shape=(48, 48, 1),\n        activation='elu',\n        padding='same',\n        kernel_initializer='he_normal',\n        name='conv2d_1'\n    )\n)\nnet.add(BatchNormalization(name='batchnorm_1'))\nnet.add(\n    Conv2D(\n        filters=64,\n        kernel_size=(5,5),\n        activation='elu',\n        padding='same',\n        kernel_initializer='he_normal',\n        name='conv2d_2'\n    )\n)\nnet.add(BatchNormalization(name='batchnorm_2'))\n\nnet.add(MaxPooling2D(pool_size=(2,2), name='maxpool2d_1'))\nnet.add(Dropout(0.4, name='dropout_1'))\n\nnet.add(\n    Conv2D(\n        filters=128,\n        kernel_size=(3,3),\n        activation='elu',\n        padding='same',\n        kernel_initializer='he_normal',\n        name='conv2d_3'\n    )\n)\nnet.add(BatchNormalization(name='batchnorm_3'))\nnet.add(\n    Conv2D(\n        filters=128,\n        kernel_size=(3,3),\n        activation='elu',\n        padding='same',\n        kernel_initializer='he_normal',\n        name='conv2d_4'\n    )\n)\nnet.add(BatchNormalization(name='batchnorm_4'))\n\nnet.add(MaxPooling2D(pool_size=(2,2), name='maxpool2d_2'))\nnet.add(Dropout(0.4, name='dropout_2'))\n\nnet.add(\n    Conv2D(\n        filters=256,\n        kernel_size=(3,3),\n        activation='elu',\n        padding='same',\n        kernel_initializer='he_normal',\n        name='conv2d_5'\n    )\n)\nnet.add(BatchNormalization(name='batchnorm_5'))\nnet.add(\n    Conv2D(\n        filters=256,\n        kernel_size=(3,3),\n        activation='elu',\n        padding='same',\n        kernel_initializer='he_normal',\n        name='conv2d_6'\n    )\n)\nnet.add(BatchNormalization(name='batchnorm_6'))\n\nnet.add(MaxPooling2D(pool_size=(2,2), name='maxpool2d_3'))\nnet.add(Dropout(0.5, name='dropout_3'))\n\nnet.add(Flatten(name='flatten'))\n\nnet.add(\n    Dense(\n        128,\n        activation='elu',\n        kernel_initializer='he_normal',\n        name='dense_1'\n    )\n)\nnet.add(BatchNormalization(name='batchnorm_7'))\n\nnet.add(Dropout(0.6, name='dropout_4'))\n\nnet.add(\n    Dense(\n        7,\n        activation='softmax',\n        name='out_layer'\n    )\n)\n\nnet.compile(\n    loss='sparse_categorical_crossentropy',\n    optimizer='adam',\n    metrics=['accuracy']\n)\n\nnet.summary()","e28d212e":"model.compile(optimizer=tf.keras.optimizers.Adam(learning_rate=1e-4), loss='sparse_categorical_crossentropy', metrics=['accuracy'])","b51b3d08":"#Code by Hitesh Kumar https:\/\/www.kaggle.com\/hitzz97\/emotion-detection\n\nearly_stopping = EarlyStopping(\n    monitor='val_accuracy',\n    min_delta=0.00005,\n    patience=11,\n    verbose=1,\n    restore_best_weights=True,\n)\n\nlr_scheduler = ReduceLROnPlateau(\n    monitor='val_accuracy',\n    factor=0.5,\n    patience=7,\n    min_lr=1e-7,\n    verbose=1,\n)\n\ncallbacks = [\n    early_stopping,\n    lr_scheduler,\n]","9886d5c2":"model.fit(train, validation_data=test, epochs=20, callbacks=callbacks)","a68960ab":"#Code by Hitesh Kumar https:\/\/www.kaggle.com\/hitzz97\/emotion-detection\n\nx,y = test.next()\npreds = model.predict(x)\nidx = np.argmax(preds, axis = 1)\n# idx.shape\nprint('correct prediction:', np.sum((y == idx)*1)\/128)","03da88fb":"#Code by Hitesh Kumar https:\/\/www.kaggle.com\/hitzz97\/emotion-detection\n\nfig = plt.figure(1, (14, 14))\n\nk = 0\nfor j in range(49):\n    px = x[j]\n    k += 1\n    ax = plt.subplot(7, 7, k)\n    ax.imshow(px, cmap='gray')\n    ax.set_xticks([])\n    ax.set_yticks([])\n    \n    if  venom_dict[y[j]] == venom_dict[idx[j]]:\n        for axis in ['top','bottom','left','right']:\n            ax.spines[axis].set_linewidth(5)\n            ax.spines[axis].set_color('green')\n        ax.set_title(venom_dict[idx[j]])\n\n    else:\n        for axis in ['top','bottom','left','right']:\n            ax.spines[axis].set_linewidth(5)\n            ax.spines[axis].set_color('red')\n        ax.set_title('P:'+venom_dict[idx[j]]+\" C:\"+venom_dict[y[j]])\n    plt.tight_layout()","73e41b36":"#The same numbers of the other Dataset?","9ca204dd":"#I had no clue how to fix that \n\nUnknownError:  UnidentifiedImageError: cannot identify image file <_io.BytesIO object at 0x7f9988aafb90>\n\nPIL.UnidentifiedImageError: cannot identify image file <_io.BytesIO object at 0x7f9988aafb90>\n","3dc816a4":"#Acknowledgement\n\nHitesh Kumar https:\/\/www.kaggle.com\/hitzz97\/emotion-detection"}}