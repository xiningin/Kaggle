{"cell_type":{"47949235":"code","2f230dac":"code","d4714e2d":"code","dc32a59c":"code","9e5c9345":"code","c50b960c":"code","9fcfc090":"code","36531ce4":"code","c3feaf2f":"code","39b6cd55":"code","e0ea224e":"code","4fccfc0e":"code","45327246":"code","41fb116b":"code","1291b5ef":"code","e27b6a04":"code","b0e309ae":"code","aeb5964a":"code","6f1911e3":"code","2588a598":"code","3dc790a3":"code","31b3eb29":"code","5dc01e9d":"code","8ee4fa90":"code","bf6f11c0":"code","35969c6c":"code","cca4e63e":"code","6aed8cd6":"code","ed5b4793":"code","9e47338b":"code","128ed480":"code","409a25a7":"code","895b35bd":"code","d2e5645b":"code","430c17f1":"markdown","d340aed9":"markdown","1f0a36ba":"markdown","30c0d7ea":"markdown","e4e56ddb":"markdown","4b344adc":"markdown","47dd0cd2":"markdown","c44a4e1d":"markdown","d63d072e":"markdown","f3de21b4":"markdown","a1331649":"markdown","0c09a04b":"markdown","604d485c":"markdown","13842c3a":"markdown","f98312ac":"markdown","f6de2ea5":"markdown","e0f858f8":"markdown","83db12b6":"markdown","6544e6eb":"markdown","d031703c":"markdown","3694f4db":"markdown","693c4695":"markdown","4251c29c":"markdown","4c640fe4":"markdown","3dcd2a28":"markdown","3063f35c":"markdown","0f6777cf":"markdown","27860beb":"markdown","a406d4dc":"markdown","e407752b":"markdown"},"source":{"47949235":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\n#for dirname, _, filenames in os.walk('\/kaggle\/input'):\n     #   print(os.path.join(dirname, filename))\nfiles = os.listdir(\"..\/input\")\nprint(files)\nprint('trainlabels.csv' in files)\nprint(len(files))\n# Any results you write to the current directory are saved as output.","2f230dac":"from fastai import *\nfrom fastai.vision import *\nimport matplotlib as plt\nimport pandas as pd\nfrom fastai.widgets import ClassConfusion\nfrom fastai.widgets import *","d4714e2d":"print('Make sure cuda is installed:', torch.cuda.is_available())\nprint('Make sure cudnn is enabled:', torch.backends.cudnn.enabled)","dc32a59c":"train_df =  pd.read_csv(\"..\/input\/aptos2019-blindness-detection\/train.csv\")\nvalid_df =  pd.read_csv(\"..\/input\/aptos2019-blindness-detection\/test.csv\")\n","9e5c9345":"train_df.head(10)","c50b960c":"valid_df.head(10)","9fcfc090":"train_df['diagnosis'].hist(figsize = (10, 5))\n","36531ce4":"#tfms = get_tranforms(do_flip=True,)\ntfms=get_transforms(do_flip = True,flip_vert = True,max_rotate=360,max_zoom = 1.1)\n\n","c3feaf2f":"data = (ImageList.from_df(train_df,\"..\/input\/aptos2019-blindness-detection\/train_images\",suffix='.png').\n       split_by_rand_pct(0.1).\n       label_from_df(1).\n       transform(tfms,size=256).\n       databunch(bs = 16).\n       normalize(imagenet_stats))","39b6cd55":"data.show_batch()","e0ea224e":"learn = cnn_learner(data, models.resnet101, metrics=accuracy,model_dir=\"\/kaggle\/working\")\n","4fccfc0e":"learn.lr_find()","45327246":"learn.recorder.plot()","41fb116b":"learn.fit_one_cycle(5,slice(2e-5,2e-3),wd=0.1,moms=(0.8,0.9))","1291b5ef":"learn.fit_one_cycle(2,max_lr=slice(2.5e-3),wd=0.1,moms=(0.8,0.9))","e27b6a04":"learn.fit_one_cycle(2,slice(2.5e-5),wd=0.01,moms=(0.8,0.9))","b0e309ae":"learn.fit_one_cycle(6,max_lr=slice(1e-3,1e-4),wd=0.1,moms=0.9)","aeb5964a":"learn.save('stage-1')","6f1911e3":"learn.load('stage-1')","2588a598":"learn.freeze()","3dc790a3":"learn.recorder.plot_losses()","31b3eb29":"learn.show_results()","5dc01e9d":"learn.get_preds()","8ee4fa90":"interp = ClassificationInterpretation.from_learner(learn)\n\nlosses,idxs = interp.top_losses()\n\nlen(data.valid_ds)==len(losses)==len(idxs)","bf6f11c0":"interp.plot_top_losses(9, figsize=(15,11))","35969c6c":"interp.plot_confusion_matrix()","cca4e63e":"interp.most_confused()","6aed8cd6":"Tf = partial(Image.apply_tfms,tfms=get_transforms(do_flip=True, flip_vert = True)[0][1:]+get_transforms(do_flip=True, flip_vert = True)[1],size = 512)  ","ed5b4793":"sub = pd.read_csv(\"..\/input\/aptos2019-blindness-detection\/sample_submission.csv\")","9e47338b":"print(sub)","128ed480":"img = open_image(\"..\/input\/aptos2019-blindness-detection\/test_images\/020f6983114d.png\")\npre = learn.predict(img)\nx = pre[1]\nx = int(x)\nprint(x)","409a25a7":"\nfor i in range(len(sub.id_code)):\n    s=0\n    id = sub.id_code[i]\n    img=open_image(\"..\/input\/aptos2019-blindness-detection\/test_images\/\"+sub.id_code[i]+\".png\")\n    \"\"\"\n    for i in range(10):\n            Img = Tf(img)\n            p = learn.predict(Img)\n            p = p[1]\n            p = int(p)\n            #print(p) \n            s=s+p\n    \"\"\"\n            \n    Img = Tf(img)\n    s = learn.predict(Img)\n    s = s[1]\n    s = int(s)\n    print(s)\n    sub.diagnosis[i]=s\n    print(sub.diagnosis[i])","895b35bd":"\nsub.to_csv(\"submission.csv\",index=False)","d2e5645b":" print(sub) ","430c17f1":"# **Reading the data**\n\n\n---\n\n\nRead the data which is given in an csv ","d340aed9":"> ClassificationInterpretation","1f0a36ba":"show all predictions of Test data","30c0d7ea":"# **Model Training**\n\n\n---\n\n\n\nHere learning rate is slice(2e-5,2e-3) which means first layer will have the learning rate as 2e-5 and last layer(not an output layer) will have learning rate of 2e-3 other all hidden layers will have learning rate of in between 2e-5 to 2e-3","e4e56ddb":"#                            Diabetic Rectiopathy detection using Deep learning\n\n---\n\n\n                         \n                         \n  Diabetic rectiopathy is an disease of eye caused to an person due to diabetes,it is the condition in which person's eye is damaged due to mellitus present in human eye. It is basically occurs when the blood form several droplets on to the retina and it remain collected at that perticular place and this affect the person and if it occur in more extent then an person can lead towards blindliness due to the cause called Diabetic Rectiopathy.\n   present in human eye.\n  \n>![](http:\/\/www.koreabiomed.com\/news\/photo\/201710\/1687_1860_3515.gif) \n\n\n\n\n\n\n\n\n\n\nhere is an image of an normal person retina image and in front of it an image of an person having diabetic rectiopathy.\n\n\n\n\n> ![](https:\/\/afamilyoptician.co.uk\/wp-content\/uploads\/2017\/05\/diabetic-retinopathy-v01.png)\n\n\n---\n\n\n\n# Diabetic rectiopathy has several stages\n\n---\n\n\n\n\n0 - No DR\n\n1 - Mild\n\n2 - Moderate\n\n3 - Severe\n\n4 - Proliferative DR\n\n\n---\n\n\n# Content\n\n\n---\n\n\n\n* Over 285 million peoples are suffering from Diabetic rectiopathy world wide out of which 31.7 million from india alone.\n\n* Approximately 1 in 3 people living with diabetes have some degree of DR and 1 in 10 will develop a vision threatening form of the disease. DR is the leading cause of vision loss in working age adults (20- 65 years).\n\n* In front of this there are very few doctors to analize the disease.\n\n* So Deep learning can help to solve this problem\nhere is an model that predicts whether an person has diabetic rectiopathy or not on the basis of there retina images.\n","4b344adc":"> Checking if an GPU is enabled or not\nMake sure that cuda is installed and is available.","47dd0cd2":"# **Learning Rate finder**\n\n\n---\n\n\nFor finding appropriate learning rate we go through the data once and plot the graph of it.","c44a4e1d":"# **Submission.csv file**\n\n\n---\n\n","d63d072e":"show results will display the result of any batch in this case first batch.","f3de21b4":"> Display the data\nlook at the images after listing them together according to the batch size.\n* Example if I choose batch size of 16 then the first 16 images will be shown here.","a1331649":"# **Transforming the images**\n\n\n---\n\n\n\nTransforming the images for bettor model training \n\n\nTransform the images of same type\nExample all the images are initially not of the same size and shape so we have to transform them in specific order for the better trainig the neural network.\nHere it rotate the image either vertical or flip or zoom it according to its need.","0c09a04b":"# **Plot the losses**\n\n\n---\n\n","604d485c":"plot the graph of learning rate finder.","13842c3a":"# **Importing required libraries**\n\n\n---\n\n\n\nFirst of all import the required libraries\nI am using fastai library for my project at this time as this an type of image classification problem I am using fatai.vision to solve the problem.","f98312ac":"> Predicting the images and writting the prediction on submission.csv file for submission","f6de2ea5":"# **Creating Databunch**\n\n\n---\n\n\n1. Now the data is ready to Bunch them together to fit the model for Trainig.\n2. Here I use ImageList to bunch them together.\n3. Am also splitting them by and random.\n4.  labbelling them according to the indexes.\n5.  and finnaly normalize them here normalization means arranging the things in specific order ","e0f858f8":"# **Testing on an single image**\n\n\n---\n\n","83db12b6":"Freeze the weights for not furthur modification","6544e6eb":"Train a bit more","d031703c":"> Look through the training data","3694f4db":"# **Confusion matrix**\n\n\n---\n\n","693c4695":"Loading the Trained Model named \"stage-1\"","4251c29c":"# **Most confused**\n\n\n---\n\n","4c640fe4":"# **Save the model**\n\n\n---\n\n\nNow we got enough accurate results so save the Trained weights.","3dcd2a28":"> Transforming the images for prediction","3063f35c":"Look at the data i.e dataframe of train images and also for the test images.","0f6777cf":" ## **Introduction**\n\n---\n\n","27860beb":"# **Classification Interpretation**\n\n\n---\n\n","a406d4dc":"# **Creating an learner**\n\n\n---\n\n\nmaking an Architecture\ncreate learn(A object for the neural network) here I am choosing Pretrained Model resnet101 for my problem to solve.","e407752b":"# **Reading the submission.csv file**\n\n\n---\n\n"}}