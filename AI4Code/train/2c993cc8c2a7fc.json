{"cell_type":{"903eaa26":"code","888c65ad":"code","4b105c77":"code","6b387f39":"code","8ac9ca52":"code","c4285d69":"code","26e35b87":"code","50a4262a":"code","c9db7a52":"code","afa397d3":"code","67185800":"code","9b789dd3":"code","68fd9944":"code","a00445d7":"code","c42315dd":"code","fc4c2d6a":"code","2f4ef32d":"code","d5a6e31f":"code","93d520b0":"code","71dd7d06":"code","9ba3919f":"markdown","a9facc50":"markdown","c82ea47c":"markdown","722b4bf9":"markdown","072856dd":"markdown","e28c4f04":"markdown","0377cd7f":"markdown","a13195ae":"markdown","9bbfd4a2":"markdown","3c84079b":"markdown"},"source":{"903eaa26":"import numpy as np  \nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom scipy.stats import norm\nfrom sklearn.model_selection import train_test_split\nimport xgboost as xgb\nfrom lightgbm import LGBMRegressor\nfrom sklearn.model_selection import KFold\nfrom sklearn.metrics import mean_squared_error\nfrom scipy import stats\nfrom tqdm import tqdm\nimport warnings\nwarnings.filterwarnings('ignore')\n","888c65ad":"train=pd.read_csv('..\/input\/tabular-playground-series-jan-2021\/train.csv')\ntest=pd.read_csv('..\/input\/tabular-playground-series-jan-2021\/test.csv')\ntest_id=test['id']","4b105c77":"train.head()","6b387f39":"list(train.columns)","8ac9ca52":"train['target'].describe()","c4285d69":"plt.figure(figsize=(10,7))\nsns.distplot(train['target'], color= \"R\" )\nplt.title('Distribution of Target', fontsize=18)\nplt.show()\nprint(\"Skewness: %f\" % train['target'].skew())\nprint(\"Kurtosis: %f\" % train['target'].kurt())","26e35b87":"plt.figure(figsize=(10,7))\nax =sns.boxplot(x=train[\"target\"],color='R')\nplt.title('Distribution of Target', fontsize=18)\nplt.show()","50a4262a":"plt.figure(figsize=(10,7))\nres = stats.probplot(train['target'], plot=plt)\nplt.show()","c9db7a52":"f, ax = plt.subplots(figsize=(18, 10))\ncorrmat = train.corr().sort_values(by='target',ascending=False).T\nmask=np.triu(np.ones_like(train.corr(), dtype=bool))\nsns.heatmap(corrmat, vmax=.2,annot=True,mask=mask,cmap=\"Reds\")\nplt.title('Correlation Table')\nplt.show()","afa397d3":"cols = corrmat.nlargest(6, 'target')['target'].index\nsns.pairplot(train[cols], size = 2.5)\nplt.show()","67185800":"f, ax = plt.subplots(nrows=4, ncols=4, figsize=(18, 12))\nsns.kdeplot(train.iloc[:,1], shade=True,ax=ax[0,0],color='red')\nsns.kdeplot(train.iloc[:,2], shade=True,ax=ax[0,1],color='red')\nsns.kdeplot(train.iloc[:,3], shade=True,ax=ax[0,2],color='red')\nsns.kdeplot(train.iloc[:,4], shade=True,ax=ax[0,3],color='red')\n\nsns.kdeplot(train.iloc[:,5], shade=True,ax=ax[1,0],color='red')\nsns.kdeplot(train.iloc[:,6], shade=True,ax=ax[1,1],color='red')\nsns.kdeplot(train.iloc[:,7], shade=True,ax=ax[1,2],color='red')\nsns.kdeplot(train.iloc[:,8], shade=True,ax=ax[1,3],color='red')\n\nsns.kdeplot(train.iloc[:,9], shade=True,ax=ax[2,0],color='red')\nsns.kdeplot(train.iloc[:,10], shade=True,ax=ax[2,1],color='red')\nsns.kdeplot(train.iloc[:,11], shade=True,ax=ax[2,2],color='red')\nsns.kdeplot(train.iloc[:,12], shade=True,ax=ax[2,3],color='red')\n\nsns.kdeplot(train.iloc[:,13], shade=True,ax=ax[3,0],color='red')\nsns.kdeplot(train.iloc[:,14], shade=True,ax=ax[3,1],color='red')\n\nf.delaxes(ax[3, 2])\nf.delaxes(ax[3, 3])\nplt.tight_layout()\nplt.show()\n","9b789dd3":"fig, ((ax1, ax2), (ax3, ax4))= plt.subplots(nrows=2, ncols=2, figsize=(14,8))\nvar1 = cols[1]\ndata = pd.concat([train['target'], train[var1]], axis=1)\nsns.regplot(y=var1, x='target', data=data, fit_reg=True, ax=ax1)\n\n\nvar2 = cols[2]\ndata = pd.concat([train['target'], train[var2]], axis=1)\nsns.regplot(y=var2, x='target', data=data, fit_reg=True, ax=ax2,color='red', marker='s')\n\nvar3 =  cols[3]\ndata = pd.concat([train['target'], train[var3]], axis=1)\nsns.regplot(y=var3, x='target', data=data, fit_reg=True, ax=ax3,color='orange', marker='^')\n\nvar4 = cols[4]\ndata = pd.concat([train['target'], train[var4]], axis=1)\nsns.regplot(y=var4, x='target', data=data, fit_reg=True, ax=ax4,color='green', marker='+')\n\nplt.show()","68fd9944":"test=test.drop('id',axis=1)\nX=train.iloc[:,1:-1]\ny=train.iloc[:,-1]\nX_train, X_test, y_train, y_test = train_test_split(X,y,test_size=.1,random_state=42,shuffle=True)","a00445d7":"regressor = xgb.XGBRegressor(learning_rate=0.02,max_depth=10,\n                            n_estimators=7000,reg_alpha=0.9,\n                            reg_lambda=0.9,subsample=0.9,seed=42\n                            ,metric_period=100,silent=1)\nregressor.fit(X_train, y_train, early_stopping_rounds=6, eval_set=[(X_test, y_test)], verbose=1)","c42315dd":"pred_1 = regressor.predict(test)","fc4c2d6a":"X = train.drop(['id','target'], axis=1)\nXtest = test\ny = train['target']\n\nt= int(len(X)*0.9)\nX_train, X_test = X.iloc[:t], X.iloc[t:]\ny_train, y_test = y.iloc[:t], y.iloc[t:]","2f4ef32d":"params = {'objective': 'regression',\n 'metric': 'rmse',\n 'verbosity': -1,\n 'boosting_type': 'gbdt',\n 'feature_pre_filter': False,\n 'learning_rate': 0.005,\n 'num_leaves': 102,\n 'min_child_samples': 20,\n 'sub_feature': 0.4,\n 'sub_row': 1,\n 'subsample_freq': 0,\n 'lambda_l1': 4.6,\n 'lambda_l2': 1.9}","d5a6e31f":"N_FOLDS = 5\n\nkf = KFold(n_splits = N_FOLDS)\noof = np.zeros(len(y))\noof_vanilla = np.zeros(len(y))\npreds = np.zeros(len(Xtest))\nparams['learning_rate'] = 0.005\nparams['num_iterations'] = 5000\nfor train_ind, test_ind in tqdm(kf.split(X)):\n    X_train = X.iloc[train_ind]\n    X_test = X.iloc[test_ind]\n    y_train = y.iloc[train_ind]\n    y_test = y.iloc[test_ind]\n\n    model = LGBMRegressor(**params)\n    vanilla_model = LGBMRegressor()\n    \n    model.fit(X_train, y_train, eval_set = ((X_test,y_test)), early_stopping_rounds = 50, verbose = 0)\n    vanilla_model.fit(X_train, y_train)\n    p = model.predict(X_test)\n    p_vanilla = vanilla_model.predict(X_test)\n    oof[test_ind] = p\n    oof_vanilla[test_ind] = p_vanilla\n    \n    preds += model.predict(Xtest)\/N_FOLDS\n    \nprint(f'mean square error (vanilla model): {np.round(mean_squared_error(y, oof_vanilla, squared=False),5)}')    \nprint(f'mean square error  (with optuna tuning): {np.round(mean_squared_error(y, oof, squared=False),5)}')","93d520b0":"results = [y + -x*0.01 for x, y in zip(pred_1, preds)]","71dd7d06":"result = pd.DataFrame({\"id\":test_id, \"target\":results})\nresult.to_csv('submission.csv', index=False)","9ba3919f":"# See Ya","a9facc50":"#  Tabular Playground Series - Jan 2021","c82ea47c":"# Overview to all Data","722b4bf9":"# RegPlot","072856dd":"# Correlation Table","e28c4f04":"# Overview to target","0377cd7f":"it's hard to analyze this data but im gonna try","a13195ae":"columns just cont1:14","9bbfd4a2":"Top column affecting target (con7 : cont2) both = 0.067 ","3c84079b":"# Machine Learning"}}