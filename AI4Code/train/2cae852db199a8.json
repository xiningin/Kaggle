{"cell_type":{"10d9a2d7":"code","1d4e16c5":"code","1ef0fa25":"code","c61c1a8c":"code","4fe22db2":"code","a1577e16":"code","603e7bb4":"code","06a90165":"code","c4fc6525":"code","6b4cac3a":"code","a97e0873":"code","3349200a":"code","a0e14c48":"code","b0031f75":"code","70f324d3":"code","6bf7728c":"code","33ab1dad":"code","eaf6e786":"code","237fcc86":"code","6209314e":"code","1ac12abb":"code","13515135":"code","6d5edb71":"code","0f2ab724":"code","281ee46c":"code","58cce075":"code","49fce564":"code","f6249c9d":"code","bd89346a":"code","a5917d1d":"code","a15d80a9":"code","e5941c05":"code","85d3f8cf":"code","4abc17b9":"code","9d02a5f4":"code","b202fff9":"code","7854b44f":"code","cdb3d2b5":"code","1d0a77c5":"code","918267d2":"code","ea23fcfd":"code","1e389081":"code","333a6756":"code","dfd97909":"code","4dab3978":"code","e993d4b1":"code","9fa6b65a":"code","ba0307f9":"code","fd7accc6":"code","f373f4b7":"code","554752ba":"code","26e35f26":"code","d66b1bd2":"code","b2b145c2":"code","0efc4514":"code","63b5e2be":"code","1d3d3e63":"code","93bcee9e":"code","605cfe17":"code","69c2348c":"code","991eb02e":"code","352415a3":"code","90c17751":"code","bc1dc9f2":"code","f3fbe6f4":"code","040b76e6":"code","1e3450bd":"code","fc5eabc6":"markdown","a34c7d7d":"markdown","7bd4d3c9":"markdown","443de699":"markdown","c3ae8b6d":"markdown","1fd8ce2b":"markdown","853c8169":"markdown","6cd42459":"markdown","4187e754":"markdown","8441a30a":"markdown","92fb5408":"markdown","e036f48d":"markdown","aefe1d34":"markdown","d1fa1bff":"markdown","b3de4ab5":"markdown","eeaa6321":"markdown","2d13a397":"markdown","02c88ea8":"markdown","03d520ae":"markdown","751f1784":"markdown","3122150a":"markdown","690cd94f":"markdown","0a29563d":"markdown","28f95449":"markdown","3bce1ac7":"markdown","f8226480":"markdown","cf7653e7":"markdown","742a2de6":"markdown","9ccdab57":"markdown","77ae708b":"markdown","367502f5":"markdown","d1111eda":"markdown","81773887":"markdown"},"source":{"10d9a2d7":"import numpy as np \nimport pandas as pd ","1d4e16c5":"df_yield = pd.read_csv('..\/input\/crop-yield-prediction-dataset\/yield.csv')\ndf_yield.shape","1ef0fa25":"df_yield.head()","c61c1a8c":"df_yield.tail()","4fe22db2":"# rename columns.\ndf_yield = df_yield.rename(index=str, columns={\"Value\": \"hg\/ha_yield\"})\ndf_yield.head()","a1577e16":"# drop unwanted columns.\ndf_yield = df_yield.drop(['Year Code','Element Code','Element','Year Code','Area Code','Domain Code','Domain','Unit','Item Code'], axis=1)\ndf_yield.head()","603e7bb4":"df_yield.describe()","06a90165":"df_yield.info()","c4fc6525":"df_rain = pd.read_csv('..\/input\/crop-yield-prediction-dataset\/rainfall.csv')\ndf_rain.head()","6b4cac3a":"df_rain = df_rain.rename(index=str, columns={\" Area\": 'Area'})","a97e0873":"# check data types \ndf_rain.info()","3349200a":"# convert average_rain_fall_mm_per_year from object to float\ndf_rain['average_rain_fall_mm_per_year'] = pd.to_numeric(df_rain['average_rain_fall_mm_per_year'],errors = 'coerce')\ndf_rain.info()","a0e14c48":"df_rain = df_rain.dropna()","b0031f75":"df_rain.describe()","70f324d3":"# merge yield dataframe with rain dataframe by year and area columns \nyield_df = pd.merge(df_yield, df_rain, on=['Year','Area'])","6bf7728c":"yield_df.shape","33ab1dad":"yield_df.head()","eaf6e786":"yield_df.describe()","237fcc86":"df_pes = pd.read_csv('..\/input\/crop-yield-prediction-dataset\/pesticides.csv')\ndf_pes.head()","6209314e":"df_pes = df_pes.rename(index=str, columns={\"Value\": \"pesticides_tonnes\"})\ndf_pes = df_pes.drop(['Element','Domain','Unit','Item'], axis=1)\ndf_pes.head()","1ac12abb":"df_pes.describe()","13515135":"df_pes.info()","6d5edb71":"# merge Pesticides dataframe with yield dataframe \nyield_df = pd.merge(yield_df, df_pes, on=['Year','Area'])\nyield_df.shape","0f2ab724":"yield_df.head()","281ee46c":"avg_temp=  pd.read_csv('..\/input\/crop-yield-prediction-dataset\/temp.csv')","58cce075":"avg_temp.head()","49fce564":"avg_temp.describe()","f6249c9d":"avg_temp = avg_temp.rename(index=str, columns={\"year\": \"Year\", \"country\":'Area'})\navg_temp.head()","bd89346a":"yield_df = pd.merge(yield_df,avg_temp, on=['Area','Year'])\nyield_df.head()","a5917d1d":"yield_df.shape","a15d80a9":"yield_df.describe()","e5941c05":"yield_df.isnull().sum()","85d3f8cf":"yield_df.groupby('Item').count()","4abc17b9":"yield_df.describe()","9d02a5f4":"yield_df['Area'].nunique()","b202fff9":"yield_df.groupby(['Area'],sort=True)['hg\/ha_yield'].sum().nlargest(10)","7854b44f":"yield_df.groupby(['Item','Area'],sort=True)['hg\/ha_yield'].sum().nlargest(10)","cdb3d2b5":"import sklearn\nimport seaborn as sns\nimport matplotlib.pyplot as plt","1d0a77c5":"correlation_data=yield_df.select_dtypes(include=[np.number]).corr()\n\nmask = np.zeros_like(correlation_data, dtype=np.bool)\nmask[np.triu_indices_from(mask)] = True\n\nf, ax = plt.subplots(figsize=(11, 9))\n\n# Generate a custom diverging colormap\ncmap = sns.palette=\"vlag\"\n\n# Draw the heatmap with the mask and correct aspect ratio\nsns.heatmap(correlation_data, mask=mask, cmap=cmap, vmax=.3, center=0,\n            square=True, linewidths=.5, cbar_kws={\"shrink\": .5});","918267d2":"yield_df.head()","ea23fcfd":"from sklearn.preprocessing import OneHotEncoder","1e389081":"yield_df_onehot = pd.get_dummies(yield_df, columns=['Area',\"Item\"], prefix = ['Country',\"Item\"])\nfeatures=yield_df_onehot.loc[:, yield_df_onehot.columns != 'hg\/ha_yield']\nlabel=yield_df['hg\/ha_yield']\nfeatures.head()","333a6756":"features = features.drop(['Year'], axis=1)","dfd97909":"features.info()","4dab3978":"features.head()","e993d4b1":"from sklearn.preprocessing import MinMaxScaler\nscaler=MinMaxScaler()\nfeatures=scaler.fit_transform(features) ","9fa6b65a":"features","ba0307f9":"from sklearn.model_selection import train_test_split\ntrain_data, test_data, train_labels, test_labels = train_test_split(features, label, test_size=0.3, random_state=42)","fd7accc6":"#write final df to csv file \n#yield_df.to_csv('..\/input\/crop-yield-prediction-dataset\/yield_df.csv')","f373f4b7":"from sklearn.model_selection import train_test_split\ntrain_data, test_data, train_labels, test_labels = train_test_split(features, label, test_size=0.3, random_state=42)","554752ba":"from sklearn.metrics import r2_score\ndef compare_models(model):\n    model_name = model.__class__.__name__\n    fit=model.fit(train_data,train_labels)\n    y_pred=fit.predict(test_data)\n    r2=r2_score(test_labels,y_pred)\n    return([model_name,r2])","26e35f26":"from sklearn.ensemble import RandomForestRegressor\nfrom sklearn.ensemble import GradientBoostingRegressor\nfrom sklearn import svm\nfrom sklearn.tree import DecisionTreeRegressor\n\nmodels = [\n    GradientBoostingRegressor(n_estimators=200, max_depth=3, random_state=0),\n     RandomForestRegressor(n_estimators=200, max_depth=3, random_state=0),\n    svm.SVR(),\n   DecisionTreeRegressor()\n]","d66b1bd2":"model_train=list(map(compare_models,models)) ","b2b145c2":"print(*model_train, sep = \"\\n\")","0efc4514":"yield_df_onehot = yield_df_onehot.drop(['Year'], axis=1)","63b5e2be":"yield_df_onehot.head()","1d3d3e63":"#setting test data to columns from dataframe and excluding 'hg\/ha_yield' values where ML model should be predicting \n\ntest_df=pd.DataFrame(test_data,columns=yield_df_onehot.loc[:, yield_df_onehot.columns != 'hg\/ha_yield'].columns) \n\n# using stack function to return a reshaped DataFrame by pivoting the columns of the current dataframe\n\ncntry=test_df[[col for col in test_df.columns if 'Country' in col]].stack()[test_df[[col for col in test_df.columns if 'Country' in col]].stack()>0]\ncntrylist=list(pd.DataFrame(cntry).index.get_level_values(1))\ncountries=[i.split(\"_\")[1] for i in cntrylist]\nitm=test_df[[col for col in test_df.columns if 'Item' in col]].stack()[test_df[[col for col in test_df.columns if 'Item' in col]].stack()>0]\nitmlist=list(pd.DataFrame(itm).index.get_level_values(1))\nitems=[i.split(\"_\")[1] for i in itmlist]","93bcee9e":"test_df.head()","605cfe17":"test_df.drop([col for col in test_df.columns if 'Item' in col],axis=1,inplace=True)\ntest_df.drop([col for col in test_df.columns if 'Country' in col],axis=1,inplace=True)\ntest_df.head()","69c2348c":"test_df['Country']=countries\ntest_df['Item']=items\ntest_df.head()","991eb02e":"clf=DecisionTreeRegressor()\nmodel=clf.fit(train_data,train_labels)\n\ntest_df[\"yield_predicted\"]= model.predict(test_data)\ntest_df[\"yield_actual\"]=pd.DataFrame(test_labels)[\"hg\/ha_yield\"].tolist()\ntest_group=test_df.groupby(\"Item\")\ntest_group.apply(lambda x: r2_score(x.yield_actual,x.yield_predicted))","352415a3":"# So let's run the model actual values against the predicted ones \n\nfig, ax = plt.subplots() \n\nax.scatter(test_df[\"yield_actual\"], test_df[\"yield_predicted\"],edgecolors=(0, 0, 0))\n\nax.set_xlabel('Actual')\nax.set_ylabel('Predicted')\nax.set_title(\"Actual vs Predicted\")\nplt.show()","90c17751":"def adjusted_r_squared(y,yhat,x):\n    score=1- (((1-(r2_score(y,yhat)))*(len(y)-1))\/(len(y)-x.shape[1]-2))\n    return score\n\ntest_group.apply(lambda x: adjusted_r_squared(x.yield_actual,x.yield_predicted,x))","bc1dc9f2":"varimp= {'imp':model.feature_importances_,'names':yield_df_onehot.columns[yield_df_onehot.columns!=\"hg\/ha_yield\"]}","f3fbe6f4":"a4_dims = (8.27,16.7)\n\nfig, ax = plt.subplots(figsize=a4_dims)\ndf=pd.DataFrame.from_dict(varimp)\ndf.sort_values(ascending=False,by=[\"imp\"],inplace=True)\ndf=df.dropna()\nsns.barplot(x=\"imp\",y=\"names\",palette=\"vlag\",data=df,orient=\"h\",ax=ax);","040b76e6":"#7 most important factors that affect crops \na4_dims = (16.7, 8.27)\n\nfig, ax = plt.subplots(figsize=a4_dims)\ndf=pd.DataFrame.from_dict(varimp)\ndf.sort_values(ascending=False,by=[\"imp\"],inplace=True)\ndf=df.dropna()\ndf=df.nlargest(7, 'imp')\nsns.barplot(x=\"imp\",y=\"names\",palette=\"vlag\",data=df,orient=\"h\",ax=ax);","1e3450bd":"#Boxplot that shows yield for each item \na4_dims = (16.7, 8.27)\n\nfig, ax = plt.subplots(figsize=a4_dims)\nsns.boxplot(x=\"Item\",y=\"hg\/ha_yield\",palette=\"vlag\",data=yield_df,ax=ax);","fc5eabc6":"The final dataframe starts from 1990 and ends in 2013, that's 23 years worth of data for 101 countries. ","a34c7d7d":"Getting only top 7 of features importance in the model:","7bd4d3c9":"Next, droping any empty rows from dataset and merge yield dataframe with rain dataframe by year and area columns","443de699":"## Training Data: \n\nThe dataset will be split to two datasets, the training dataset and test dataset. The data is usually tend to be split inequality because training the model usually requires as much data-points as possible.The common splits are 70\/30 or 80\/20 for train\/test.\n\nThe training dataset is the intial dataset used to train ML algorithm to learn and produce right predictions. (70% of dataset is training dataset)\n\nThe test dataset, however, is used to assess how well ML algorithm is trained with the training dataset. You can\u2019t simply reuse the training dataset in the testing stage because ML algorithm will already \u201cknow\u201d the expected output, which defeats the purpose of testing the algorithm. (30% of dataset is testing dataset) \n\n","c3ae8b6d":"### Climate Data : Rainfall \nThe climatic factors include rainfall and temperature. They are abiotic components, including pesticides and soil, of the environmental factors that influence plant growth and development.\n\n\nRainfall has a dramatic effect on agriculture. For this project rain fall per year information was gathered from World Data Bank. ","1fd8ce2b":"We can see that now the years start from the first yield dataframe the starting year was 1961, now it's 1985 because that's when the rainfall data begins. ","853c8169":"**yield_df** is the final obtained dataframe; ","6cd42459":"### Encoding Categorical Variables:\nThere are two categorical columns in the dataframe, categorical data are variables that contain label values rather than numeric values. The number of possible values is often limited to a fixed set, like in this case, items and countries values.\nMany machine learning algorithms cannot operate on label data directly. They require all input variables and output variables to be numeric.\n\nThis means that categorical data must be converted to a numerical form. One hot encoding is a process by which categorical variables are converted into a form that could be provided to ML algorithms to do a better job in prediction. For that purpose, One-Hot Encoding will be used to convert these two columns to one-hot numeric array.\n\nThe categorical value represents the numerical value of the entry in the dataset. This encoding will create a binary column for each category and returns a matrix with the results. \n","4187e754":"The crop being potatoes has the highest importance in the decision making for the model, where it's the highest crops in the dataset. Cassava too, then as expected we see the effect of pesticides, where its the third most important feature, and then if the crop is sweet potatoes, we see some of the highest crops in features importance in dataset. \n\nIf the crop is grown in India, makes sense since Indis has the largest crops sum in the dataset. Then comes rainfall and temprature. Thr first assumption about these features were correct, where they all significanally impact the expected crops yield in the model. ","8441a30a":"Looking at the columns in the csv, we can rename **Value** to **hg\/ha_yield** to make it easier to recognise that this is our crops yields production value. In addition to removal of unnecessary coloumns like Area Code, Domain, Item Code, etc.","92fb5408":"So average temprature starts from 1743 and ends at 2013, with some empty rows that we have to drop.","e036f48d":"### Average Temprature: \n\nAverage Temprature for each country was colleced from World Bank Data. ","aefe1d34":"It can be seen from the above correlation map that there is no correlation between any of the colmuns in the dataframe. ","d1fa1bff":"# Model Comparison & Selection \n","b3de4ab5":"The rainfall dataframe begins at 1985 and ends at 2016. ","eeaa6321":"The dataframe has 101 Countries, ordering these by 10 the highest yield production: ","2d13a397":"Great, no empty values!","02c88ea8":"Now, exploring the relationships between the colunms of the dataframe, a good way to quickly check correlations among columns is by visualizing the correlation matrix as a heatmap.","03d520ae":"\n### Scaling Features: \n\nTaking a look at the dataset above, it contains features highly varying in magnitudes, units and range. The features with high magnitudes will weigh in a lot more in the distance calculations than features with low magnitudes.\n\nTo supress this effect, we need to bring all features to the same level of magnitudes. This can be acheived by scaling.","751f1784":"# Model Results & Conclusions\n\n","3122150a":"The evaluation metric is set based on **R^2 (coefficient of determination)** regression score function, that will represents the proportion of the variance for items (crops) in the regression model. **R^2** score shows how well terms (data points) fit a curve or line.\n\n**R^2** is a statistical measure between 0 and 1 which calculates how similar a regression line is to the data it\u2019s fitted to. If it\u2019s a 1, the model 100% predicts the data variance; if it\u2019s a 0, the model predicts none of the variance. \n\nFrom results viewd above, **Decision Tree Regressor** has the highest R^2 score 0f **96%**, **GradientBoostingRegressor** comes second. \n\n\n I'll also calculate **Adjusted R^2** also indicates how well terms fit a curve or line, but adjusts for the number of terms in a model. If you add more and more useless variables to a model, adjusted r-squared will decrease. If you add more useful variables, adjusted r-squared will increase.\nAdjusted R2 will always be less than or equal to R2. ","690cd94f":"After dropping year column in addition to scaling all values in features, the resulting array will look something like this : ","0a29563d":"<img src='https:\/\/i.imgur.com\/ibzHl8U.png' width=\"1200\" height=\"1000\">","28f95449":"India has the highest yield production in the dataset. Inclusing items in the groupby:","3bce1ac7":"India is the highest for production of cassava and potatoes. Potatoes seems to be the dominated crop in the dataset, being the highest in 4 countries. ","f8226480":"### Pesticides Data:\nPesticides used for each item and country was also collected from FAO database.  ","cf7653e7":"Now, we view the final shape of the dataframe and info of values:","742a2de6":"# Data Preprocessing","9ccdab57":"# Data Exploration\n\n","77ae708b":"It can be noticed the high variance in the values for each columns, later on I'll account for that will scaling. ","367502f5":"# Crop Yield Analysis\n \nThe science of training machines to learn and produce models for future predictions is widely used, and not for nothing.\nAgriculture plays a critical role in the global economy. With the continuing expansion of the human population understanding worldwide crop yield is central to addressing food security challenges and reducing the impacts of climate change. \n\nCrop yield prediction is an important agricultural problem. The Agricultural yield primarily depends on weather conditions (rain, temperature, etc), pesticides and accurate information about history of crop yield is an important thing for making decisions related to agricultural risk management and future predictions.  The basic ingredients that sustain humans are similar. We eat a lot of corn, wheat, rice and other simple crops. In this project the prediction of top 10 most consumed yields all over the world is established by applying machine learning techniques. It consist of 10 most consumed crops. It is a regression problem\n \n These corps include :\n\n- Cassava                \n- Maize                  \n- Plantains and others   \n- Potatoes                \n- Rice, paddy             \n- Sorghum                \n- Soybeans               \n- Sweet potatoes       \n- Wheat                  \n- Yams             ","d1111eda":"Data Preprocessing is a technique that is used to convert the raw data into a clean data set. In other words, whenever the data is gathered from different sources it is collected in raw format which is not feasible for the analysis.  \n\n\n","81773887":"# Gathering & Cleaning Data\n\n### Crops Yield Data:\n\n\n \nAfter importing required libraries, crops yield of ten most consumed crops around the world was downloaded from FAO webiste.The collected data include country, item, year starting from 1961 to 2016 and yield value. "}}