{"cell_type":{"3e1bd156":"code","d830043d":"code","fd4f8a19":"code","2b256a96":"code","5a53179a":"code","ef46062a":"code","a80d1eae":"code","00bd29c5":"code","0658023e":"code","662b73d3":"code","5c996d93":"code","7c183e47":"code","79a5e413":"code","49cb444f":"code","85a5bb33":"code","c8b396ba":"code","158a2e46":"code","e1b79801":"code","dff82c56":"code","77eb420c":"code","cedc9ced":"code","9d0c27f7":"code","30b2f50c":"code","eb25088c":"code","b05f6bbb":"code","a78bb501":"code","18668612":"code","32543bc4":"code","2e96c193":"code","b79e5ec0":"code","0a18ea15":"code","d347278c":"code","138e8207":"code","1f6b3a76":"code","aa35b603":"code","038135f8":"code","0e566d54":"code","b8c1426c":"code","3acc4a40":"code","7dd4ab2f":"code","640b9279":"code","7e13df70":"code","7a578d0f":"code","ca536f46":"code","0284bf4e":"code","58af7083":"code","bfcfe28b":"code","f4323cfd":"code","72ee5891":"code","6e742cd6":"code","910845d1":"code","a8d21bb1":"code","eb7d9e01":"code","34890442":"code","6d2e4bef":"code","96256cfd":"code","f226a76d":"code","c6f7a985":"code","1e0c628c":"code","6e0619b9":"markdown","16b9f2dd":"markdown","5b61cf07":"markdown","3bda663d":"markdown","18b09e3c":"markdown","5bc5f00d":"markdown","8e5668d1":"markdown","f30be6d5":"markdown","f6791b74":"markdown","a5030490":"markdown","be7e019a":"markdown","5a68d5e6":"markdown","886d199e":"markdown","095f9972":"markdown"},"source":{"3e1bd156":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","d830043d":"!pip install pycaret[full]","fd4f8a19":"#Importings\nimport pandas as pd\nimport numpy as np\nfrom pycaret.classification import *\nimport matplotlib.pyplot as plt\nimport seaborn as sns","2b256a96":"#Data loading\ndata = pd.read_csv(\"..\/input\/bank-marketing\/bank-additional-full.csv\", sep=\";\")","5a53179a":"data.head()","ef46062a":"data.tail()","a80d1eae":"data.info()","00bd29c5":"#Target distribution\nfig, ax = plt.subplots(figsize = (8, 5))\nsns.countplot(x= 'y', data= data, palette='rocket')\nplt.xlabel(\"Target\") \nplt.ylabel('Number of Clients')\nplt.title(\"Target distribution\")  \nplt.show()\n#Finding the percentages of our target\nper_target= (data['y'] == 'yes').value_counts().to_frame('q')\nn_target_q = per_target.q.iloc[0]\ny_target_q = per_target.q.iloc[1]\ntotal=per_target.q.sum() \nprint('The amount of \"no\" target is =  {:,}'.format(n_target_q))\nprint('The amount of \"yes\" target is = {:,}'.format(y_target_q))\nprint(f'The percentage of \"no\" target is = {round((n_target_q\/total)*100,2)}','%')\nprint(f'The percentage of \"yes\" target is = {round((y_target_q\/total)*100,2)}','%')","0658023e":"categorical_cols = data.select_dtypes(include=\"object\").columns.to_list()\ncategorical_cols.remove(\"y\")\ncategorical_cols","662b73d3":"numerical_cols = data.select_dtypes(include=[np.number]).columns.to_list()\nnumerical_cols","5c996d93":"for cat in categorical_cols:\n    print(f\"Column: {cat} unique values\")\n    print(data[cat].unique())","7c183e47":"plt.figure(figsize = (20,20))\nplt.subplot(5, 2, 1)\nsns.boxplot(data = data, x= 'age', palette = 'colorblind')\nplt.title('Age boxplot')\nplt.xlabel('Age')\n\nplt.subplot(5, 2, 2)\nsns.boxplot(data = data, x= 'duration', palette = 'colorblind')\nplt.title('Duration boxplot')\nplt.xlabel('Duration')\n\nplt.subplot(5, 2, 3)\nsns.boxplot(data = data, x= 'campaign', palette = 'colorblind')\nplt.title('Campaign boxplot')\nplt.xlabel('Campaign')\n\nplt.subplot(5, 2, 4)\nsns.boxplot(data = data, x= 'pdays', palette = 'colorblind')\nplt.title('pdays boxplot')\nplt.xlabel('pdays')\n\nplt.subplot(5, 2, 5)\nsns.boxplot(data = data, x= 'previous', palette = 'colorblind')\nplt.title('Previous boxplot')\nplt.xlabel('Previous')\n\nplt.subplot(5, 2, 6)\nsns.boxplot(data = data, x= 'emp.var.rate', palette = 'colorblind')\nplt.title('emp.var.rate boxplot')\nplt.xlabel('emp.var.rate')\n\nplt.subplot(5, 2, 7)\nsns.boxplot(data = data, x= 'cons.price.idx', palette = 'colorblind')\nplt.title('cons.price.idx boxplot')\nplt.xlabel('cons.price.idx')\n\nplt.subplot(5, 2, 8)\nsns.boxplot(data = data, x= 'cons.conf.idx', palette = 'colorblind')\nplt.title('cons.conf.idx boxplot')\nplt.xlabel('cons.conf.idx')\n\nplt.subplot(5, 2, 9)\nsns.boxplot(data = data, x= 'euribor3m', palette = 'colorblind')\nplt.title('euribor3m boxplot')\nplt.xlabel('euribor3m')\n\nplt.subplot(5, 2, 10)\nsns.boxplot(data = data, x= 'nr.employed', palette = 'colorblind')\nplt.title('nr.employed boxplot')\nplt.xlabel('nr.employed')\n\nplt.tight_layout()\nplt.show()","79a5e413":"# Outlier filter\n\ndef remove_outliers(dfx):\n    q1 = dfx.quantile(0.25)\n    q3 = dfx.quantile(0.75)\n    iqr = q3 - q1\n    cut_off = iqr*1.5\n    \n    df_filtred = dfx[~((dfx < (dfx.quantile(0.25) - cut_off)) | (dfx > (dfx.quantile(0.75) + cut_off))).any(axis=1)]\n    \n    \n    return df_filtred","49cb444f":"data2 = remove_outliers(data)","85a5bb33":"data2.reset_index(drop=True, inplace=True)\ndata2.info()","c8b396ba":"data2.job.value_counts()","158a2e46":"sns.countplot(data=data2, y='job',hue ='y', edgecolor ='black')\nprint('##############################################')\nprint('Unkown job clients = ', data2[(data2['job'] =='unknown')].shape[0])\nprint('##############################################')\nprint(\"Percentage of unknown client's job =\" ,round(data2[(data2['job'] =='unknown')].shape[0]\/data2.shape[0]*100,2),'%')","e1b79801":"data2.marital.value_counts()","dff82c56":"sns.countplot(data=data2, x='marital',hue ='y', edgecolor ='black')\nprint('##############################################')\nprint('Unkown job clients = ', data2[(data2['marital'] =='unknown')].shape[0])\nprint('##############################################')\nprint(\"Percentage of unknown client's marital =\" ,round(data2[(data2['marital'] =='unknown')].shape[0]\/data2.shape[0]*100,2),'%')","77eb420c":"data2.education.value_counts()","cedc9ced":"sns.countplot(data=data2, y='education',hue ='y', edgecolor ='black')\nprint('##############################################')\nprint('Unkown job clients = ', data2[(data2['education'] =='unknown')].shape[0])\nprint('##############################################')\nprint(\"Percentage of unknown client's education level =\" ,round(data2[(data2['education'] =='unknown')].shape[0]\/data2.shape[0]*100,2),'%')","9d0c27f7":"data2.default.value_counts()","30b2f50c":"sns.countplot(data=data2, y='default',hue ='y', edgecolor ='black')\nprint('##############################################')\nprint('Unkown job clients = ',data2[(data2['default'] =='unknown')].shape[0])\nprint('##############################################')\nprint(\"Percentage of unknown client's default =\" ,round(data2[(data2['default'] =='unknown')].shape[0]\/data2.shape[0]*100,2),'%')","eb25088c":"data2.housing.value_counts()","b05f6bbb":"sns.countplot(data=data2, y='housing',hue ='y', edgecolor ='black')\nprint('##############################################')\nprint('Unkown job clients = ', data2[(data2['housing'] =='unknown')].shape[0])\nprint('##############################################')\nprint(\"Percentage of unknown client's default =\" ,round(data2[(data2['housing'] =='unknown')].shape[0]\/data2.shape[0]*100,2),'%')","a78bb501":"data2.loan.value_counts()","18668612":"sns.countplot(data=data2, y='housing',hue ='y', edgecolor ='black')\nprint('##############################################')\nprint('Unkown job clients = ', data2[(data2['housing'] =='unknown')].shape[0])\nprint('##############################################')\nprint(\"Percentage of unknown client's default =\" ,round(data2[(data2['housing'] =='unknown')].shape[0]\/data2.shape[0]*100,2),'%')","32543bc4":"data2.replace('unknown', np.nan, regex=True,inplace=True)\ndata2.head()","2e96c193":"data2.isna().sum().plot.bar()\nplt.ylabel(\"NAs\")","b79e5ec0":"eliminacion = data2.copy()\neliminacion = eliminacion.dropna()\nprint(data2.shape[0]-eliminacion.shape[0], 'rows were eliminated')\nprint('Equivalent to',round(((data2.shape[0]-eliminacion.shape[0])\/data2.shape[0])*100,2),' % of the original dataset')\nprint( 'Current dataset size = ',eliminacion.shape[0])","0a18ea15":"data3 = eliminacion.copy()\ndata3 = data3.drop(\"default\", axis=1)","d347278c":"#Numerical features\n\nnumerical = data3.select_dtypes(include=[np.number])\nnumerical_cols = numerical.columns.to_list()\nnumerical.describe()","138e8207":"numerical.hist(bins = 15, figsize = (10,10), xlabelsize = 0.1, ylabelsize = 0.1)\nplt.show()","1f6b3a76":"data4 = data3.drop([\"pdays\", \"previous\"], axis=1)","aa35b603":"final_ds = data4.copy()\n\nprint(final_ds.shape)\nfinal_ds.head()","038135f8":"categorical_cols = final_ds.select_dtypes(include=\"object\").columns.to_list()\ncategorical_cols.remove(\"y\")\nnumerical_cols = final_ds.select_dtypes(include=[np.number]).columns.to_list()","0e566d54":"categorical_cols","b8c1426c":"clfs = setup(data = final_ds, target = 'y',\n             session_id=234, normalize=True, transformation = True,\n             numeric_features=numerical_cols, categorical_features=categorical_cols, \n             remove_multicollinearity = True, multicollinearity_threshold = 0.95, \n             fix_imbalance=True, data_split_stratify=True,\n             silent=True\n             )","3acc4a40":"top3 = compare_models(n_select=3, sort =\"AUC\")","7dd4ab2f":"tuned_models = [tune_model(i, n_iter=100, search_library=\"optuna\", optimize=\"AUC\", verbose=False) for i in top3]","640b9279":"catboost = create_model(\"catboost\", verbose=False)\nxgb = create_model(\"xgboost\", verbose=False)\nlgbm = create_model(\"lightgbm\", verbose=False)","7e13df70":"tuned_ctb = tune_model(catboost, optimize='auc', n_iter=20)","7a578d0f":"plot_model(tuned_ctb, plot='class_report' )","ca536f46":"plot_model(tuned_ctb, plot='confusion_matrix')","0284bf4e":"tuned_xgb = tune_model(xgb, n_iter=20, optimize='auc')","58af7083":"plot_model(tuned_xgb, plot='class_report' )","bfcfe28b":"plot_model(tuned_xgb , plot='confusion_matrix')","f4323cfd":"tuned_lgbm = tune_model(lgbm, n_iter=20, optimize='auc')","72ee5891":"plot_model(tuned_lgbm, plot='class_report' )","6e742cd6":"plot_model(tuned_lgbm , plot='confusion_matrix')","910845d1":"blender = blend_models(top3, method = 'soft', optimize=\"auc\")","a8d21bb1":"plot_model(blender)","eb7d9e01":"plot_model(blender, plot=\"confusion_matrix\")","34890442":"plot_model(blender, plot=\"class_report\")","6d2e4bef":"best_model = automl(optimize='auc')","96256cfd":"best_model","f226a76d":"plot_model(best_model, plot=\"calibration\")","c6f7a985":"best_model_cal = calibrate_model(best_model)","1e0c628c":"plot_model(best_model_cal, plot=\"calibration\")","6e0619b9":"### Best model","16b9f2dd":"### 1. Catboost Classifier","5b61cf07":"**Problem Statement:** ABC Bank wants to sell it's term deposit product to customers and before launching the product they want to develop a model which help them in understanding whether a particular customer will buy their product or not (based on customer's past interaction with bank or other Financial Institution).","3bda663d":"**Data Set Information :** The data is related with direct marketing campaigns of a Portuguese banking institution. The marketing campaigns were based on phone calls. Often, more than one contact to the same client was required, in order to access if the product (bank term deposit) would be ('yes') or not ('no') subscribed. The classification goal is to predict if the client will subscribe (yes\/no) a term deposit (variable y).","18b09e3c":"**Objective:** Obtain a model that determines whether or not X customer will buy your product, based on past interactions with the bank and other financial institutions. To apply pycaret machine modeling library.","5bc5f00d":"## Exploratory Data Analysis","8e5668d1":"# Introduction","f30be6d5":"### Let's install pycaret","f6791b74":"### 2. Extreme Gradient Boosting","a5030490":"**Why ML Model:** Bank wants to use ML model to shortlist customer whose chances of buying the product is more so that their marketing channel (tele marketing, SMS\/email marketing etc)  can focus only to those customers whose chances of buying the product is more. This will save resource and their time ( which is directly involved in the cost ( resource billing)).","be7e019a":"### Categorical features analysis","5a68d5e6":"# Modeling","886d199e":"### 3. Light Gradient Boosting Machine","095f9972":"### Blending"}}