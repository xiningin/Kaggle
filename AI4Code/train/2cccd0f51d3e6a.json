{"cell_type":{"bfc19b8f":"code","801bdbe5":"code","24e454b4":"code","18e144dc":"code","63082270":"code","db0c7664":"code","e47ded3c":"code","f0520c76":"code","103d33fa":"code","a6d71ddd":"code","050c2c2c":"code","ceea6ebe":"code","30025815":"code","ddffcd34":"code","3eab2184":"code","a67a68e8":"code","3ccd049e":"code","658732e0":"code","787c58f1":"code","a512635b":"code","211c2ca1":"code","f00db991":"code","5d816811":"code","44637d47":"code","5c7e8e39":"code","83e69597":"code","a622d29d":"code","398417ab":"code","8de731df":"code","e982baf8":"code","f8048a01":"code","bd5cfa73":"code","52983fc8":"code","11eaee9e":"code","bb265dd3":"code","70f7771e":"code","e4db6b77":"code","a366c971":"code","24c4e69d":"code","541b5140":"code","69c0c17e":"code","1f80d6d0":"code","180429c5":"code","9d1a71e9":"code","566a130d":"code","a8bb5cfc":"code","a7530222":"code","5566cf4f":"code","65635589":"code","7db7de91":"code","82985e72":"code","555de17f":"code","30a2c043":"code","0627d551":"code","6c71145d":"code","cca58566":"code","279b9bbf":"code","524207e5":"code","9d01d637":"code","2cefbfb4":"code","e0a6d5b9":"code","45f6c492":"markdown","63c7abc9":"markdown","bf2b652e":"markdown","b0c8effd":"markdown","7f933853":"markdown","180d55f9":"markdown","30e2c89b":"markdown","f848fab9":"markdown","f150cf47":"markdown","6a509285":"markdown","abcb5436":"markdown","c926a0e5":"markdown","b17cd42b":"markdown","b66c0c98":"markdown","26d27883":"markdown","d5b024d4":"markdown","704c6918":"markdown","47afb161":"markdown","ceaa6e4c":"markdown"},"source":{"bfc19b8f":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport gc, sys, math, random\nimport datetime\nimport re\nimport json\nfrom pandas.io.json import json_normalize\nfrom tqdm._tqdm_notebook import tqdm_notebook as tqdm\n\nimport warnings\nwarnings.filterwarnings('ignore')\n\nsns.set_style('darkgrid')\n\npd.options.display.float_format = '{:,.3f}'.format\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","801bdbe5":"# Memory saving function credit to https:\/\/www.kaggle.com\/gemartin\/load-data-reduce-memory-usage\ndef reduce_mem_usage(df):\n    \"\"\" iterate through all the columns of a dataframe and modify the data type\n        to reduce memory usage.\n    \"\"\"\n    start_mem = df.memory_usage().sum() \/ 1024**2\n    \n    for col in df.columns:\n        col_type = df[col].dtype\n        \n        if col_type != object:\n            c_min = df[col].min()\n            c_max = df[col].max()\n            if str(col_type)[:3] == 'int':\n                if c_min > np.iinfo(np.int8).min and c_max < np.iinfo(np.int8).max:\n                    df[col] = df[col].astype(np.int8)\n                elif c_min > np.iinfo(np.int16).min and c_max < np.iinfo(np.int16).max:\n                    df[col] = df[col].astype(np.int16)\n                elif c_min > np.iinfo(np.int32).min and c_max < np.iinfo(np.int32).max:\n                    df[col] = df[col].astype(np.int32)\n                elif c_min > np.iinfo(np.int64).min and c_max < np.iinfo(np.int64).max:\n                    df[col] = df[col].astype(np.int64)  \n            else:\n                if c_min > np.finfo(np.float16).min and c_max < np.finfo(np.float16).max:\n                    df[col] = df[col].astype(np.float16)\n                elif c_min > np.finfo(np.float32).min and c_max < np.finfo(np.float32).max:\n                    df[col] = df[col].astype(np.float32)\n                else:\n                    df[col] = df[col].astype(np.float64)\n        #else:\n            #df[col] = df[col].astype('category')\n\n    end_mem = df.memory_usage().sum() \/ 1024**2\n    print('Memory usage of dataframe is {:.2f} MB --> {:.2f} MB (Decreased by {:.1f}%)'.format(\n        start_mem, end_mem, 100 * (start_mem - end_mem) \/ start_mem))\n    return df","24e454b4":"%%time\n\ntrain = pd.read_csv('..\/input\/data-science-bowl-2019\/train.csv')\ntest = pd.read_csv('..\/input\/data-science-bowl-2019\/test.csv')\ntrain_labels = pd.read_csv('..\/input\/data-science-bowl-2019\/train_labels.csv')\nspecs = pd.read_csv('..\/input\/data-science-bowl-2019\/specs.csv', converters={'args': json.loads})\n\ntrain = reduce_mem_usage(train)\ntest = reduce_mem_usage(test)","18e144dc":"train.info()","63082270":"train.head()","db0c7664":"specs.info()","e47ded3c":"specs.head()","f0520c76":"train_labels.info()","103d33fa":"train_labels.head()","a6d71ddd":"train['event_id'].nunique(), test['event_id'].nunique()","050c2c2c":"train['game_session'].nunique(), test['game_session'].nunique()","ceea6ebe":"common_sesseion = set(train['game_session'].unique()) & set(test['game_session'].unique())\nlist(common_sesseion)","30025815":"print('train: ', train['timestamp'].min(), 'to', train['timestamp'].max()) \nprint('test:  ', test['timestamp'].min(), 'to', test['timestamp'].max())","ddffcd34":"_='''\nSTART_DATE = '2019-07-23T00:00:00+0000'\nstartdate = pd.to_datetime(START_DATE)\ntrain_day = train['timestamp'].apply(lambda x: (pd.to_datetime(x) - startdate).total_seconds() \/\/ (24 * 60 * 60))\ntrain_day.hist()\n'''","3eab2184":"max_events_game_session = train[train['event_count'] == train['event_count'].max()]['game_session'].values[0]\nsubset = train[train['game_session'] == max_events_game_session][['game_session','event_count','timestamp','game_time']]\nsubset['timestamp'] = pd.to_datetime(subset['timestamp'])\n\nmin_ts = subset['timestamp'].min()\nsubset['timestamp_diff_sec'] = subset['timestamp'].apply(lambda x: int((x - min_ts).total_seconds() * 1000))\nsubset","a67a68e8":"train['installation_id'].nunique(), test['installation_id'].nunique()","3ccd049e":"common_installation = set(train['installation_id'].unique()) & set(test['installation_id'].unique())\nlist(common_installation)","658732e0":"game_session_count = train.groupby('installation_id')['game_session'].nunique()\ngame_session_count.describe()","787c58f1":"train_corrected = train['event_data'].str.contains('\"correct\":true')\ntest_corrected = test['event_data'].str.contains('\"correct\":true')\n\nfig, ax = plt.subplots(1, 2, figsize=(12,3))\n\ntrain_subset = train[train_corrected]\ntrain_subset['event_code'].value_counts().plot.bar(ax=ax[0])\nprint('train:', train_subset['type'].unique(), train_subset['event_code'].unique())\n\ntest_subset = test[test_corrected]\ntest_subset['event_code'].value_counts().plot.bar(ax=ax[1], color='limegreen')\nprint('test:', test_subset['type'].unique(), test_subset['event_code'].unique())","a512635b":"fig, ax = plt.subplots(1, 2, figsize=(12,3))\n\ntrain_corrected.value_counts().plot.bar(ax=ax[0])\ntest_corrected.value_counts().plot.bar(ax=ax[1], color='limegreen')","211c2ca1":"train['event_count'].hist(bins=100,figsize=(12,3))\ntrain['event_count'].describe().to_frame()","f00db991":"test['event_count'].hist(bins=100,figsize=(12,3), color='limegreen')\ntest['event_count'].describe().to_frame()","5d816811":"train['event_code'].nunique(), test['event_code'].nunique() ","44637d47":"fig, ax = plt.subplots(2, 1, figsize=(12,7))\n\ntrain['event_code'].value_counts().plot.bar(ax=ax[0])\ntest['event_code'].value_counts().plot.bar(ax=ax[1], color='limegreen')","5c7e8e39":"train['title'].nunique(), test['title'].nunique()","83e69597":"np.sort(train['title'].unique())","a622d29d":"train['title'].value_counts().plot.bar(figsize=(12,3))","398417ab":"test['title'].value_counts().plot.bar(figsize=(12,3), color='limegreen')","8de731df":"train_title = train['title'].unique()\ntest_title = train['title'].unique()\n[n for n in train_title if n not in test_title] + [n for n in test_title if n not in train_title]","e982baf8":"# type & world is unique in same title\nprint('[title + type] unique count:', (train['title'] + '-' +  train['type']).nunique())\nprint('[title + world] unique count:', (train['title'] + '-' +  train['world']).nunique())","f8048a01":"cols = ['world','type','title']\ntrain[cols].drop_duplicates().sort_values(by=cols).reset_index(drop=True)","bd5cfa73":"train['type'].unique()","52983fc8":"fig, ax = plt.subplots(1, 2, figsize=(12,3))\n\ntrain['type'].value_counts().plot.bar(ax=ax[0])\ntest['type'].value_counts().plot.bar(ax=ax[1], color='limegreen')","11eaee9e":"for t in train['type'].unique():\n    print(f'events of {t}:\\n', np.sort(train[train['type'] == t]['event_code'].unique()))","bb265dd3":"train[(train['event_code'] == 4100) | (train['event_code'] == 4110)]['type'].value_counts().plot.bar()","70f7771e":"train['world'].unique()","e4db6b77":"fig, ax = plt.subplots(1, 2, figsize=(12,3))\n\ntrain['world'].value_counts().plot.bar(ax=ax[0])\ntest['world'].value_counts().plot.bar(ax=ax[1], color='limegreen')","a366c971":"print('nunique event_id:', train['event_id'].nunique())\nprint('nunique event_code:', train['event_code'].nunique())\nprint('nunique event_id&event_code:', (train['event_id'] + '-' + train['event_code'].astype(str)).nunique())","24c4e69d":"train.groupby('event_code')['event_id'].unique().to_frame()","541b5140":"# start event\ntrain[train['event_count'] == 1]['event_code'].value_counts()","69c0c17e":"subset = train[(train['event_code'] == 4100) | (train['event_code'] == 4110)]\nsubset","1f80d6d0":"specs['event_id'].nunique(), len(specs)","180429c5":"specs['info'][0]","9d1a71e9":"json_normalize(specs['args'][0])","566a130d":"print('max(args array size):', max(specs['args'].apply(len)))","a8bb5cfc":"max_colwidth = pd.get_option('display.max_colwidth')\nmax_rows = pd.get_option(\"display.max_rows\")","a7530222":"_='''\npd.set_option('display.max_colwidth', 1000)\npd.set_option(\"display.max_rows\", 500)\n\nsubset = train[['event_code','event_id']]\nsubset = subset[~subset.duplicated()]\nevent_info = pd.merge(subset, specs[['event_id','info']]).sort_values(by=['event_code','info'])\nevent_info.to_csv(\"event_info.csv\", index=False)\ndisplay(event_info)\n\npd.set_option('display.max_colwidth', max_colwidth)\npd.set_option(\"display.max_rows\", max_rows)\n'''","5566cf4f":"train_labels.head()","65635589":"max(train_labels['num_correct'] + train_labels['num_incorrect'])","7db7de91":"print('[train] sessions:', train['game_session'].nunique(), ', installations:', train['installation_id'].nunique(), ', len:', len(train))\nprint('[test] sessions:', test['game_session'].nunique(), ', installations:', test['installation_id'].nunique(), ', len:', len(test))\nprint('[labels] sessions:', train_labels['game_session'].nunique(), ', installations:', train_labels['installation_id'].nunique(), ', len:', len(train_labels))","82985e72":"s = '77b8ee947eb84b4e'\nsubset = train[train['game_session'] == s]\nsubset['event_code'].value_counts().to_frame().T","555de17f":"s = '9501794defd84e4d'\nsubset = train[train['game_session'] == s]\nsubset['event_code'].value_counts().to_frame().T","30a2c043":"'''\nAssessment attempts are captured in event_code 4100 for all assessments except for Bird Measurer, \nwhich uses event_code 4110. If the attempt was correct, it contains \"correct\":true.\n'''\n# except for\ntrain[(train['title'] == 'Bird Measurer (Assessment)') & ((train['event_code'] == '4100') | (train['event_code'] == '4110'))]","0627d551":"%%time\n\ntrain['event_data.correct'] = ''\ntrain.loc[train['event_data'].str.contains('\"correct\":true'), 'event_data.correct'] = 'true'\ntrain.loc[train['event_data'].str.contains('\"correct\":false'), 'event_data.correct'] = 'false'\n\ntrain['event_code_correct'] = train['event_code'].astype(str) + train['event_data.correct'].apply(lambda x: x if x == '' else f'({x})')\ntrain_events = train.groupby('game_session').apply(lambda x: x['event_code_correct'].value_counts().to_frame().T.reset_index(drop=True))\ntrain_events = train_events.reset_index().drop('level_1', axis=1)\ntrain_events.head()","6c71145d":"train_events['_event_correct'] = train_events[['2010','2030','4100(true)','4110(true)']].sum(axis=1) # ,3021,3121\ntrain_events['_event_incorrect'] = train_events[['4100(false)','4110(false)']].sum(axis=1) #'3020','3120',\ntrain_events.fillna(0, inplace=True)\n\nsession_events = pd.merge(train_labels, train_events)\n\ncols = ['num_correct','num_incorrect']\nsession_events[cols + list(train_events.columns[1:])].corr()[cols].sort_index()","cca58566":"session_events['_calc_accuracy_group'] = 0\nsession_events.loc[(session_events['_event_incorrect'] == 0) & (session_events['_event_correct'] > 0),'_calc_accuracy_group'] = 3\nsession_events.loc[(session_events['_event_incorrect'] == 1) & (session_events['_event_correct'] > 0),'_calc_accuracy_group'] = 2\nsession_events.loc[(session_events['_event_incorrect'] >= 2) & (session_events['_event_correct'] > 0),'_calc_accuracy_group'] = 1\n\nsession_events['_calc_accuracy_group'].value_counts().plot.bar()","279b9bbf":"session_events[['accuracy_group','_event_correct','_event_incorrect','_calc_accuracy_group']]","524207e5":"ins_last_session = test.drop_duplicates(subset=['installation_id'], keep='last')\nins_last_session.head()","9d01d637":"# last session contains only start-event\nins_last_session['event_count'].unique(), ins_last_session['event_code'].unique()","2cefbfb4":"ins_last_session = ins_last_session[['installation_id','game_session']]\nins_last_session['last_session'] = 1\n\ntest = pd.merge(test, ins_last_session, how='left')\ntest['last_session'].fillna(0, inplace=True)\n\ntest['last_session'].value_counts()","e0a6d5b9":"print('last session events(mean): ', np.mean(test[test['last_session'] == 1].groupby('game_session')['event_id'].count()))","45f6c492":"### type","63c7abc9":"### event_id & event_code","bf2b652e":"### installation_id","b0c8effd":"### event_count","7f933853":"# Data analysis","180d55f9":"## train_labels.csv\n\nThis file demonstrates how to compute the ground truth for the assessments in the training set.\n\n- game_session\n- installation_id\n- title\n- num_correct\n- num_incorrect\n- accuracy\n- accuracy_group\n\nThe outcomes in this competition are grouped into 4 groups (labeled accuracy_group in the data):\n\n- 3: the assessment was solved on the first attempt\n- 2: the assessment was solved on the second attempt\n- 1: the assessment was solved after 3 or more attempts\n- 0: the assessment was never solved","30e2c89b":"### event_id","f848fab9":"# Load data","f150cf47":"<span style=\"font-size:large;color:blue\">We have to predict to last sessions accuracy group.<\/span>","6a509285":"### game_session","abcb5436":"### world","c926a0e5":"### timestamp","b17cd42b":"### title","b66c0c98":"### event_code","26d27883":"### event_data","d5b024d4":"## specs.csv\n\nThis file gives the specification of the various event types.\n\n- event_id - Global unique identifier for the event type. Joins to event_id column in events table.\n- info - Description of the event.\n- args - JSON formatted string of event arguments. Each argument contains:\n- name - Argument name.\n- type - Type of the argument (string, int, number, object, array).\n- info - Description of the argument.","704c6918":"<a id=\"h1\"><\/a> <br>\n# What to predict?","47afb161":"## train.csv & test.csv\n\nThese are the main data files which contain the gameplay events.\n\n- event_id - Randomly generated unique identifier for the event type. Maps to event_id column in specs table.\n- game_session - Randomly generated unique identifier grouping events within a single game or video play session.\n- timestamp - Client-generated datetime\n- event_data - Semi-structured JSON formatted string containing the events parameters. Default fields are: event_count, event_code, and game_time; otherwise fields are determined by the event type.\n- installation_id - Randomly generated unique identifier grouping game sessions within a single installed application instance.\n- event_count - Incremental counter of events within a game session (offset at 1). Extracted from event_data.\n- event_code - Identifier of the event 'class'. Unique per game, but may be duplicated across games. E.g. event code '2000' always identifies the 'Start Game' event for all games. Extracted from event_data.\n- game_time - Time in milliseconds since the start of the game session. Extracted from event_data.\n- title - Title of the game or video.\n- type - Media type of the game or video. Possible values are: 'Game', 'Assessment', 'Activity', 'Clip'.\n- world - The section of the application the game or video belongs to. Helpful to identify the educational curriculum goals of the media. Possible values are: 'NONE' (at the app's start screen), TREETOPCITY' (Length\/Height), 'MAGMAPEAK' (Capacity\/Displacement), 'CRYSTALCAVES' (Weight).","ceaa6e4c":"## [What to predict?](#h1)\n> For each installation_id represented in the test set, you must predict the accuracy_group of the last assessment for that installation_id. "}}