{"cell_type":{"d3ed655a":"code","53fce5a5":"code","d4618066":"code","7e4c9021":"code","445585a1":"code","ce52e8b1":"code","bff4af31":"code","9b6e42eb":"markdown","e6c37578":"markdown","599c0503":"markdown","76c86c54":"markdown","bf4be62e":"markdown"},"source":{"d3ed655a":"import os\n\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nfrom skimage.io import imread\nfrom tqdm.notebook import tqdm","53fce5a5":"PATH = '..\/input\/alaska2-image-steganalysis'\nSRNet = '..\/input\/alaska2-srnet-baseline-inference'\nsub = pd.read_csv(os.path.join(SRNet, 'submission.csv'))","d4618066":"class JPEGImageCompressionRateDeterminer:\n    def __call__(self, image_path):\n        image = imread(image_path)\n        w, h, c = image.shape\n        \n        # theoretical image size\n        b = w*h*3\n        \n        # real image file size in bytes\n        s = os.stat(image_path).st_size\n        return (b - s) \/ b ","7e4c9021":"compression_rate_determiner = JPEGImageCompressionRateDeterminer()\n\ncompressions = {}\n\ndir_path = os.path.join(PATH, 'Test')\nfor impath in tqdm(sub.Id.values):\n    c = compression_rate_determiner(os.path.join(dir_path, impath))\n    compressions[impath] = c\n    if c > 0.95:\n        sub.loc[sub.Id == impath, 'Label'] = 1. - 1e-3","445585a1":"plt.figure(figsize=(10,10))\n\nplt.axvline(0.75, color='orange')\nplt.axvline(0.90, color='orange')\nplt.axvline(0.95, color='orange')\nplt.axvspan(0., 0.95, color='green', alpha=0.25)\nplt.axvspan(0.95, 1.0, color='red', alpha=0.25)\nsns.distplot(list(compressions.values()));","ce52e8b1":"sub.to_csv('submission.csv', index=None)","bff4af31":"sub.head()","9b6e42eb":"## Reference\n* [ALASKA2: SRNet baseline inference](https:\/\/www.kaggle.com\/naivelamb\/alaska2-srnet-baseline-inference)","e6c37578":"## Empiric improvement\nEmpiric improvement based on punct 4 in data description.\n> \"4.The images are all compressed with one of the three following JPEG quality factors: 95, 90 or 75.\"\n\nSo images with compression rate more then 0.95 are prohibited.","599c0503":"Current notebook is empiric improvment current [top decision](https:\/\/www.kaggle.com\/naivelamb\/alaska2-srnet-baseline-inference) by [Xuan Cao](https:\/\/www.kaggle.com\/naivelamb).","76c86c54":"## Submission","bf4be62e":"## Compression Rate\nMay we have an RGB image with height H and width W. The theoretical number bytes B for this image is $$B = H * W * 3$$\nTherefor if the real size of image is S, then compression rate C is $$ C = (B - S) \/ B$$"}}