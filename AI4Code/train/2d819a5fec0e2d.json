{"cell_type":{"6538c3ee":"code","91a54fb0":"code","71b0963b":"code","c963658b":"code","9354009c":"code","bdee10e0":"code","90de3a45":"code","54218323":"code","e3e83018":"code","7ee1e60c":"code","2a5ae257":"code","62f67928":"code","36385782":"code","af624a50":"code","9f07fcf0":"code","89107dde":"code","92120a2e":"code","bdafffa9":"code","a7286f0b":"code","996116da":"code","42c56461":"code","d7eec4af":"code","b736b91a":"code","a7e62e33":"code","ee7b0473":"code","e9d688ce":"code","316981f6":"code","ba4ca601":"code","26deaf83":"code","8dc49ded":"code","c58aaa14":"code","282adf52":"code","487c018b":"code","2f9eaed9":"code","e85732b7":"code","93d26419":"code","9a8ab516":"code","0ed7ddae":"code","a5d84a32":"code","72386555":"code","2546cef7":"code","b3c6816b":"code","bfaff30e":"code","53359a06":"code","20798a29":"code","9929a295":"code","0e4bf4d2":"code","f3351b12":"markdown","6c835d88":"markdown","d621e190":"markdown","beefd18d":"markdown","f9100b60":"markdown","a1422049":"markdown","82ce5a6f":"markdown","ee6126f6":"markdown","3d4cbf2e":"markdown","7ba7c078":"markdown","cc6857c9":"markdown","da784d8b":"markdown","230b30f2":"markdown","9c68471b":"markdown","c0041828":"markdown"},"source":{"6538c3ee":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","91a54fb0":"import tensorflow as tf\nfrom tensorflow import keras\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt","71b0963b":"df=pd.read_csv(\"\/kaggle\/input\/covid19-global-forecasting-week-4\/train.csv\")","c963658b":"df.info()","9354009c":"df[df[\"Province_State\"]==\"New York\"]","bdee10e0":"df1=df[df[\"Province_State\"]==\"New York\"]","90de3a45":"df1[\"days\"]=[x for x in range(1,82)]","54218323":"df1.tail()","e3e83018":"\ntime=df1.iloc[:,6]\ny=df1.iloc[:,4]\ntime=time.to_numpy(dtype=\"float32\")\nseries=y.to_numpy(dtype=\"float32\")\ntime.shape","7ee1e60c":"plt.figure(figsize=(20, 12))\n\nplt.plot(time, series)\nplt.title(\"Confirmed Cases in New York\")\nplt.ylabel(\"Confirmed Cases\")\nplt.xlabel(\"Days\")","2a5ae257":"time=np.array(time)\nseries=np.array(series)\nsplit_time = 78\ntime_train = time[:split_time]\nx_train = series[:split_time]\ntime_valid = time[split_time:]\nx_valid = series[split_time:]","62f67928":"window_size = 3\nbatch_size = 3\nshuffle_buffer_size = 79","36385782":"def windowed_dataset(series, window_size, batch_size, shuffle_buffer):\n    dataset = tf.data.Dataset.from_tensor_slices(series)\n    dataset = dataset.window(window_size + 1, shift=1, drop_remainder=True)\n    dataset = dataset.flat_map(lambda window: window.batch(window_size + 1))\n    dataset = dataset.shuffle(shuffle_buffer).map(lambda window: (window[:-1], window[-1]))\n    dataset = dataset.batch(batch_size).prefetch(1)\n  \n    return dataset","af624a50":"dataset = windowed_dataset(x_train, window_size, batch_size=batch_size, shuffle_buffer=shuffle_buffer_size)","9f07fcf0":"tf.keras.backend.clear_session()\ndataset = windowed_dataset(x_train, window_size, batch_size, shuffle_buffer_size)\n\nmodel = tf.keras.models.Sequential([\n  tf.keras.layers.Lambda(lambda x: tf.expand_dims(x, axis=-1),\n                      input_shape=[None]),\n  tf.keras.layers.Bidirectional(tf.keras.layers.GRU(75, return_sequences=True,activation=\"relu\")),\n  tf.keras.layers.Bidirectional(tf.keras.layers.GRU(50,activation=\"relu\")),\n  tf.keras.layers.Dense(1),\n  tf.keras.layers.Lambda(lambda x: x * 100.0)\n])\n\n\nmodel.compile(loss=tf.keras.losses.Huber(), optimizer=\"adam\",metrics=[\"mae\"])\nhistory = model.fit(dataset,epochs=1000)","89107dde":"forecast=[]\nfor time in range(len(series) - window_size):\n    forecast.append(model.predict(series[time:time + window_size][np.newaxis]))\n\nforecast = forecast[split_time-window_size:]\nresults = np.array(forecast)[:, 0, 0]\nprint(forecast)\n\nplt.figure(figsize=(20, 12))\n\nplt.plot( time_valid, x_valid,label=\"Real\")\nplt.plot(time_valid, results,label=\"Forecasted\")\nplt.title(\"Bidirectionl LSTM Forecasting\")\nplt.ylabel(\"Confirmed Cases\")\nplt.xlabel(\"Days\")\nplt.legend()","92120a2e":"df2=pd.read_csv(\"\/kaggle\/input\/covid19-global-forecasting-week-4\/test.csv\")","bdafffa9":"df2.info()","a7286f0b":"df2=df2[df2[\"Province_State\"]==\"New York\"]","996116da":"df2.info()","42c56461":"df3=pd.read_csv(\"\/kaggle\/input\/covid19-global-forecasting-week-4\/submission.csv\")","d7eec4af":"df3.head()","b736b91a":"df2.head()","a7e62e33":"df4=pd.DataFrame()\ndf4[\"days_test\"]=[x for x in range(1,124)]","ee7b0473":"df5=df1.reset_index()\ndf4=df4.reset_index()\ndf6 = [df5, df4]\ndf_test = pd.concat(df6, axis=1)","e9d688ce":"df_test.tail()","316981f6":"time=df_test.iloc[:,9]\ny=df_test.iloc[:,5]\ntime=time.to_numpy(dtype=\"float32\")\nseries=y.to_numpy(dtype=\"float32\")","ba4ca601":"time=np.array(time)\nseries=np.array(series)\nsplit_time = 79\ntime_valid = time[split_time:]\nx_valid = series[split_time:]","26deaf83":"window_size = 3\nbatch_size = 3","8dc49ded":"forecast=[]\nfor time in range(len(series) - window_size):\n    z=model.predict(series[time:time + window_size][np.newaxis])\n    if time >= 76:\n        series[time+window_size]=z\n    forecast.append(model.predict(series[time:time + window_size][np.newaxis]))\n    \n\nforecast1 = forecast[split_time-window_size:]\nresults = np.array(forecast1)[:, 0, 0]\n\n\nplt.figure(figsize=(20, 10))\n\nplt.plot(time_valid, results,label=\"Forecasted\")\nplt.title(\"Bidirectionl GRU Forecasting\")\nplt.ylabel(\"Confirmed Cases\")\nplt.xlabel(\"Days\")\nplt.legend()","c58aaa14":"print(len(forecast1))","282adf52":"df3.info()","487c018b":"df2.info()","2f9eaed9":"df_s=df3.merge(df2,on=\"ForecastId\")","e85732b7":"df_s.info()","93d26419":"forecast2=forecast1[1:]","9a8ab516":"forecast3=[int(i) for i in forecast2]","0ed7ddae":"print(forecast3)","a5d84a32":"print(len(forecast3))","72386555":"df_s[\"ConfirmedCases\"]=forecast3","2546cef7":"df_s.head()","b3c6816b":"df_s=df_s[[\"ForecastId\",\"ConfirmedCases\",\"Fatalities\"]]","bfaff30e":"df_s.head()","53359a06":"df_s.tail()","20798a29":"L=0\nfor i in df_s[\"ForecastId\"]:\n    df3.iloc[i-1,1]=forecast3[L]\n    L=L+1\n","9929a295":"df3.iloc[11610]","0e4bf4d2":"df3.to_csv(\"submission.csv\",index=False)","f3351b12":"**Now you can go back and train the model with the full training data by selecting split time as 81.However, I will proceed with current model to predict test set. **","6c835d88":"**Data exist for 80 days**","d621e190":"**In this Notebook I will use bi directional GRU to make time series forecasting for confirmed cases in Newyork city. ** ","beefd18d":"**Use Keras to train a GRU**","f9100b60":"**Assign days to variable time and Confirmed cases to y in order to visualize data**","a1422049":"**Import Libraries **","82ce5a6f":"****Check the model on validation set****","ee6126f6":"**Filter the data only for NY**","3d4cbf2e":"**In this notebook the only feature used is time (time series). It will be interesting to see how the results change with addition of more features. Please let me know of any ideas you may have through comments.**","7ba7c078":"**43 days prediction required**","cc6857c9":"**Add a column called days. This will be used as \"time\".**","da784d8b":"**Below are the forecasting for next 43 days**","230b30f2":"**Split the training Set into training and Validation. Training set is until 77 days last 3 days will be predicted. Afterwards the forecasting will be done for the next 2 to 3 weeks.**","9c68471b":"**The method will use 3 days sequence to predict the next one day (window size=3). This parameter is a hyperparameter and can be changed to any number. For example can be changed to 7 days sequence to predict next one day. The batch size will be 3, this means that 3 batches of 3 day sequences will be used. The batch size is also a hyperparameter.**","c0041828":"**Check Training Data**"}}