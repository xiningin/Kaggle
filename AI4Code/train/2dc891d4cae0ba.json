{"cell_type":{"0a91da64":"code","40a7ada2":"code","159374ac":"code","f59d312c":"code","7da66144":"code","27732e6e":"code","2c724aef":"code","e642ab20":"code","248408a5":"code","79b5b230":"code","42f78bf3":"code","fd2257d5":"code","8730e99a":"code","97f49145":"code","98125279":"code","c09a4e84":"code","f87705ab":"code","47784bc8":"code","df1200c4":"code","c8ddbb0d":"code","e96ec2ec":"code","55bba699":"code","a13cb7ea":"code","13febde9":"code","98d5f129":"markdown","581b867d":"markdown","16bd2619":"markdown"},"source":{"0a91da64":"!pip install pyspark\nfrom pyspark.sql import SparkSession\nimport pandas as pd","40a7ada2":"#initialization of spark session\nsk = SparkSession.builder.appName(\"Project\").getOrCreate()\n\n#load the datasets\ndf = sk.read.format(\"csv\").option(\"header\", \"true\").load(\"..\/input\/summer-olympics-medals\/Summer-Olympic-medals-1976-to-2008.csv\")\nexceptions = sk.read.format(\"csv\").option(\"header\",\"true\").load(\"..\/input\/didnotparticipate1976to2008\/Did-Not-Participate-1976-to-2008.csv\")","159374ac":"#Structure of the datasets\ndf.printSchema()\nexceptions.printSchema()","f59d312c":"%%time\n#Q1: Which country won the most gold medals?\n\n#The only useful columns are \"Country\" and \"Medal\" so we select them\nimp = df.rdd.map(lambda x: (x[8],x[10]))\n#We are only interested in gold medals so we filter the others out, we then create tuples (\"Country\",number of gold medals)\nmed = imp.filter(lambda x: x[1] == \"Gold\").map(lambda x: (x[0],1)).reduceByKey(lambda acc,x: x + acc)\n#Finally we sort the result in descending order\nresult = med.map(lambda x: (x[1],x[0])).sortByKey(0).collect()","7da66144":"for e in result:\n    print(e)","27732e6e":"%%time\n#Q2: What disciplines are mixed (both male and female compete against each other)?\n\n#Select the columns containing discipline and gender of the event\nimp = df.rdd.map(lambda x: (x[3],x[9]))\n#In the \"Event_gender\" column an \"X\" marks mixed events\nmed = imp.filter(lambda x: x[1] == \"X\").groupByKey()\n#Return the name of the disciplines with at least one mixed event\nresult = med.map(lambda x: x[0]).collect()","2c724aef":"for e in result:\n    print(e)","e642ab20":"%%time\n#Q3: In mixed sports, are the gold medals winners composed of more male or female athletes?\n\n#Select the columns containing gender of the athlete, gender of the events and medals\nimp = df.rdd.map(lambda x: (x[6],x[9],x[10]))\n#Keep only mixed events and count the number of gold medals for the 2 genders\nmed = imp.filter(lambda x: x[1] == \"X\" and x[2] == \"Gold\").map(lambda x: (x[0],1)).reduceByKey(lambda acc,x: x + acc)\n#Sort and format result\nresult = med.map(lambda x: (x[1],x[0])).sortByKey(0).map(lambda x: (x[1],x[0])).collect()","248408a5":"for e in result:\n    print(e)","79b5b230":"%%time\n#Q4: Which disciplines are only for man or only for women?\n\n#Select disciplines and gender of events\nimp = df.rdd.map(lambda x: (x[3],x[9]))\n#Keep the disciplines with male events with no repetitions\nmed = imp.filter(lambda x: x[1] == \"M\").map(lambda x: ((x[0]),x[1])).distinct()\n#Keep the disciplines with female events with no repetitions\nmed2 = imp.filter(lambda x: x[1] == \"W\").map(lambda x: ((x[0]),x[1])).distinct()\n#Join the 2 results and keep only the disciplines that are either men only or women only\nmed3 = med.fullOuterJoin(med2).filter(lambda x: x[1][0] is None or x[1][1] is None)\n#Format the result\nr1 = med3.filter(lambda x: x[1][1] is None).map(lambda x: (\"Men Only\",x[0])).reduceByKey(lambda acc,x: x + \", \" + acc).collect()\nr2 = med3.filter(lambda x: x[1][0] is None).map(lambda x: (\"Women Only\",x[0])).reduceByKey(lambda acc,x: x + \", \" + acc).collect()\nresult = [r1,r2]","42f78bf3":"for e in result:\n    print(e)","fd2257d5":"%%time\n#Q5: Top 3 countries which gained most and least medals in team sports?\n\n#Select all the columns except name and gender of the athlete (the only 2 things that differentiate between teammates)\nimp = df.rdd.map(lambda x: (x[0],x[1],x[2],x[3],x[4],x[7],x[8],x[9],x[10]))\n#Sum the number of team members for each winning team\nmed = imp.map(lambda x: ((x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8]),1)).reduceByKey(lambda acc,x: x + acc)\n#For each country sum the number of team members after removing the teams with only one member (single athlete sports)\nmed2 = med.map(lambda x: (x[0][6],x[1])).filter(lambda x: x[1]>1).reduceByKey(lambda acc,x: x + acc).map(lambda x: (x[1],x[0]))\n#Sort the number of won medals and keep only the 3 best and worst results\nr1 = med2.sortByKey(0).take(3)\nr2 = med2.sortByKey(1).take(3)\nresult = [r1,r2]","8730e99a":"for e in result:\n    print(e)","97f49145":"%%time\n#Q6: Which countries didn't gain any medals from team sports?\n\n#Select all the columns except name and gender of the athlete (the only 2 things that differentiate between teammates) \nimp = df.rdd.map(lambda x: (x[0],x[1],x[2],x[3],x[4],x[7],x[8],x[9],x[10]))\n#Sum the number of team members for each winning team\nmed = imp.map(lambda x: ((x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8]),1)).reduceByKey(lambda acc,x: x + acc)\n#For each country sum the number of team members after removing the teams with only one member (single athlete sports) \nmed2 = med.map(lambda x: (x[0][6],x[1])).filter(lambda x: x[1]>1).reduceByKey(lambda acc,x: x + acc)\n#Create the list of all the countries in the dataset\nref = df.rdd.map(lambda x: (x[8],\"\")).distinct()\n#Return only the countries that won no medals for team sports\nresult = ref.leftOuterJoin(med2).filter(lambda x: x[1][1] is None).map(lambda x: x[0]).collect()","98125279":"for e in result:\n    print(e)","c09a4e84":"%%time\n#Q7: Which country won more medals for each discipline?\n\n#Select the columns containing disciplines, countries and medals\nimp = df.rdd.map(lambda x: (x[3],x[8],x[10]))\n#Sum the number of medals for each country for each discipline\nmed = imp.map(lambda x: ((x[0],x[1]),1)).reduceByKey(lambda acc,x: x + acc)\n#Keep only the countries that won the most medals for each discipline\nmed2 = med.map(lambda x: (x[0][0],(x[0][1],x[1]))).reduceByKey(lambda acc,x: x if x[1] > acc[1] else acc)\n#Format the result\nresult = med2.map(lambda x: (x[0],x[1][0],x[1][1])).collect()","f87705ab":"for e in result:\n    print(e)","47784bc8":"%%time\n#Q8: Which country won the most gold medals the year it hosted the olympics?\n\n#First we need to create a table that contains to which country does the city where the olympics took place belong\nlookup = sk.sparkContext.parallelize([(\"Montreal\",\"Canada\"),(\"Moscow\",\"Soviet Union\"),(\"Los Angeles\",\"United States\"),(\"Seoul\",\"Korea, South\"),(\"Barcelona\",\"Spain\"),(\"Atlanta\",\"United States\"),(\"Sydney\",\"Australia\"),(\"Athens\",\"Greece\"),(\"Beijing\",\"China\")])\n#Select the columns containing the olympic city, country and medals\nimp = df.rdd.map(lambda x: (x[0],x[8],x[10]))\n#Keep only the gold medals and group them for each country for each city\nmed = imp.filter(lambda x: x[2] == \"Gold\").map(lambda x: ((x[0],x[1]),1)).reduceByKey(lambda acc,x: x + acc)\n#Keep only the olympics where each country won the most gold medals\nmed2 = med.map(lambda x: (x[0][1],(x[0][0],x[1]))).reduceByKey(lambda acc,x: x if x[1] > acc[1] else acc)\n#Check with the table we created if a country won the most gold medals when the city hosting the olympics belonged to that country\nmed3 = med2.map(lambda x: (x[1][0],(x[0],x[1][1]))).join(lookup).filter(lambda x: x[1][0][0] == x[1][1])\n#Format the result\nresult = med3.map(lambda x: (x[0],x[1][1],x[1][0][1])).collect()","df1200c4":"for e in result:\n    print(e)","c8ddbb0d":"%%time\n#Q9: Which athletes won at least a medal in most olympics?\n\n#Select name of the athlete and olympic year without repetitions (more than one medal won in that year)\nimp = df.rdd.map(lambda x: (x[5],x[1])).distinct()\n#Calculate in how many olympics did the athlete win a medal\nmed = imp.map(lambda x: (x[0],1)).reduceByKey(lambda acc,x: x + acc).map(lambda x: (x[1],x[0]))\n#Sort the result\nresult = med.sortByKey(0).collect()","e96ec2ec":"for e in result:\n    print(e)","55bba699":"%%time\n#Q10: What is the average number of medals that each country won?\n\n#Select the columns containing the countries and the year of the olympics\nimp = df.rdd.map(lambda x: (x[8],x[1]))\n#Sum up the number of medals for each country for each year\nmed = imp.map(lambda x: ((x[0],x[1]),1)).reduceByKey(lambda acc,x: x + acc)\n#Create the list of all the olympics in the dataset\nref = df.rdd.map(lambda x: (x[1])).distinct()\n#Create the list of all the countries in the dataset, then cartesian product them together with the list of olympics\nref2 = df.rdd.map(lambda x: (x[8])).distinct().cartesian(ref).map(lambda x: ((x[0],x[1]),\"\"))\n#From the result remove the couple (country, year) if the country didn't participate that year\nref3 = exceptions.rdd.map(lambda x: ((x[0],x[1]),\"\")).rightOuterJoin(ref2).filter(lambda x: x[1][0] is None).map(lambda x: (x[0],\"\"))\n#If the country did participate but didn't have any medals for that year it should count as having \"won\" 0 medals\nmed2 = ref3.leftOuterJoin(med).map(lambda x: (x[0][0],x[1][1]) if x[1][1] is not None else (x[0][0],0))\n#Calculate the average\nmed3 = med2.aggregateByKey((0,0),lambda a,b: (a[0]+b, a[1]+1),lambda a,b: (a[0]+b[0],a[1]+b[1])).mapValues(lambda x: x[0]\/x[1])\n#Sort and format the result\nresult = med3.map(lambda x: (x[1],x[0])).sortByKey(0).collect()","a13cb7ea":"#Final result\nfor e in result:\n    print(e)","13febde9":"sk.stop()","98d5f129":"Since I don't use Kaggle that much, this notebook is also a way to interact with the submitter of this dataset,\n1.  Thanks for the interesting and complete dataset you provided.\n2.  I wanted to ask if it was ok for you to add a secondary file to this dataset that i created.\n\nIn the next cell i load a file called \"Did-Not-Participate-1976-to-2008.csv\", it is a csv file that contains only 2 columns.\n* the first one contains the name of all the countries that are present in the original csv you provided.\n* the second one contains all the year where the corresponding country didn't participate to the olympics.\n\nI did this because for question 10 I wanted to know the average number of medals won by all the countries.\n\n**But** countries that won a decent number of medals in a single olympic and then never again would show better than they should in the rankings because the original dataset contains lines only for winning athletes.\n\n**So** the solution was to create all the countries in the \"Country\" column from the dataset and saying that if a country belongs to this column but there is no corresponding line for all the 9 olympics then it means that in some olympics the country won 0 medals.\n\nThat does mean that the average got fairer but there was still a problem, many countries didn't participate to all the olympics!\n\n* The fall of the Soviet Union\n* The unification of Germany\n* The dissolution of Yugoslavia\n* The split of Czechoslovakia\n* The african boycott of the 1976 olympics\n* The american boycott of the 1980 olympics\n* The soviet boycott of the 1984 olympics\n* The Unified Team and Independent Olympic Participants of the 1992 olympics\n\nAnd i'm sure i forgot some...\n\nAs such i created the new csv by checking for every country that appears in the original dataset on Wikipedia which years they didn't send any athletes to the olympics.","581b867d":"This Python notebook is being used for a university exam, the project i chose consists in utilizing the Apache Spark functionalities to perform a very basic data analysis on a dataset I could choose.\nSince i'm not a data scientist and the project required a condensed amount of work hours, the \"data analysis\" is in the form of different questions, from some that are very basic to others a bit less so, that once answered could return some interesting insight.","16bd2619":"The project should also highlight if there is any performance improvement between executing the code in a local machin or in a dedicated cluster.\nSo all the %%time are calculating the local time."}}