{"cell_type":{"b85ce7ee":"code","1f2bc4bf":"code","36dde275":"code","3fb74769":"code","fc2b35eb":"code","61428620":"markdown","5f5213e1":"markdown","97518f16":"markdown"},"source":{"b85ce7ee":"# Importing modules\nimport pyproj\nimport pandas as pd\nfrom bokeh.plotting import figure, show\nfrom bokeh.tile_providers import get_provider, Vendors\nfrom bokeh.io import output_notebook\nfrom bokeh.models import ColumnDataSource\n\n# This makes bokeh to show plots in notebook\noutput_notebook()","1f2bc4bf":"# Reading our data\ndf = pd.read_csv('..\/input\/Rus_schools_final.csv', encoding = 'windows-1251')\ndf.head()","36dde275":"# Transforming coords to UTM\nlat = df['lat'].values\nlon = df['lon'].values\n\nproject_projection = pyproj.Proj(\"+init=EPSG:4326\")\ngoogle_projection = pyproj.Proj(\"+init=EPSG:3857\")\n\nx, y = pyproj.transform(project_projection, google_projection, lon, lat)","3fb74769":"df['lat_x'] = x\ndf['lon_y'] = y","fc2b35eb":"# Splitting data to be able to make different styles of plots\nmunic = df.loc[df['struct'] == '(\u041c\u0443\u043d\u0438\u0446\u0438\u043f\u0430\u043b\u044c\u043d\u043e\u0435 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u0443\u0447\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0435)']\ngov = df.loc[df['struct'] == '(\u0413\u043e\u0441\u0443\u0434\u0430\u0440\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0435 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u0443\u0447\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0435)']\nnot_gov = df.loc[df['struct'] == '(\u041d\u0435\u0433\u043e\u0441\u0443\u0434\u0430\u0440\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0435 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u0443\u0447\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0435)']\nvedom = df.loc[df['struct'] == '(\u0412\u0435\u0434\u043e\u043c\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0435 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u0443\u0447\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0435)']\n\n# Creating sources\nsource_munic = ColumnDataSource(munic)\nsource_gov = ColumnDataSource(gov)\nsource_not_gov = ColumnDataSource(not_gov)\nsource_vedom = ColumnDataSource(vedom)\n\n# Tooltips for each school\nTOOLTIPS = [('Name:', '@name'), ('Addr:', '@addr'), ('Coords:', '(@lat, @lon)')]\n\n# Plotting time\np = figure(x_range=(2000000, 18000000), y_range=(6000000, 11000000),\n            plot_width=900, plot_height=500, x_axis_type=\"mercator\", y_axis_type=\"mercator\",\n          tools = \"pan,wheel_zoom,box_zoom,reset, hover\", active_scroll=\"wheel_zoom\", tooltips = TOOLTIPS)\np.add_tile(get_provider(Vendors.CARTODBPOSITRON_RETINA))\np.circle('lat_x', 'lon_y', size=5, fill_color=\"red\", source = source_gov)\np.diamond('lat_x', 'lon_y', size=5, fill_color=\"green\", source = source_not_gov)\np.x('lat_x', 'lon_y', size=3, fill_color=\"blue\", source = source_munic)\np.triangle('lat_x', 'lon_y', size=3, fill_color=\"yellow\", source = source_vedom)\nshow(p)","61428620":"WARNING: A lot of cyrilic","5f5213e1":"We can see some errors here - all these schools that plotted outside of Russia territory. Looks like it is happening because of geocoder failure when it works with cyrilic (I used HERE geocoder), but, even so, we can see a picture here - there are a bunch of schools in southern and western parts of Russia, but very few of them in northern and eastern parts.","97518f16":"Well it is another short kernel where I'm trying to plot data on map, so let's start:"}}