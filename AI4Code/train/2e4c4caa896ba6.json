{"cell_type":{"2798d441":"code","32ef3963":"code","b4e14e29":"code","075b7852":"code","439f8530":"code","17622543":"code","c693e3c3":"code","fa9af19d":"code","1534ebf1":"code","0f6ea1c6":"code","ad8e2dc7":"code","55e30dc9":"code","0d04b1b8":"code","74c4ebe4":"code","ed62625e":"code","3e5092a1":"code","e6d71c26":"code","9010eff3":"code","2eb9a007":"code","ae739694":"code","de5ed718":"code","923111fd":"code","b89253d0":"code","90ae7656":"code","8872fe06":"code","f0c72044":"code","fe9aabd0":"code","b8770eb0":"code","4bea1d6b":"code","59841e4a":"code","89a0f510":"code","2d0ef08b":"code","c3c0b807":"code","ae661630":"code","6c86a44d":"code","e782c12c":"code","a231ed97":"code","153da4a4":"markdown","aa2b91d2":"markdown","618d5517":"markdown","635ed8e9":"markdown","f8558072":"markdown","18669ae4":"markdown","904d2b20":"markdown","3a421dc4":"markdown","096fe27b":"markdown","ab4add74":"markdown","0f8efeab":"markdown","e2c106b1":"markdown","98a3338c":"markdown","4f0bfaff":"markdown","7f217b49":"markdown","4e3ecf9c":"markdown","6249c6f5":"markdown","554cc704":"markdown","9f7408c0":"markdown","706494d0":"markdown","62f70723":"markdown","fe0a9006":"markdown","71505012":"markdown","5d083e1d":"markdown","1f9c3e39":"markdown","7dd2ac35":"markdown","7aa89161":"markdown","8856a26f":"markdown","671849d2":"markdown"},"source":{"2798d441":"import numpy as np \nimport pandas as pd \n\nimport matplotlib.pyplot as plt\nimport matplotlib.lines as mlines\nfrom matplotlib.ticker import AutoMinorLocator\nimport matplotlib.gridspec as gridspec\nimport seaborn as sns\n%matplotlib inline\n\npd.set_option('max_columns', 200)\npd.set_option('max_rows', 100)","32ef3963":"df = pd.read_csv('..\/input\/cusersmarildownloadspopolazionecsv\/popolazione.csv', delimiter=';', \n                 encoding=\"ISO-8859-1\", dtype={'value': np.int64}, thousands='.')\n\ndf.head()","b4e14e29":"df[['year', 'quarter']] = df['time'].str.split('-', expand=True)\ndf['year'] = df.year.astype(int)\ndf['quarter'] = df.quarter.fillna('total')\ndel df['time']  # we already have 2 columns about it\ndel df['seleziona periodo']  # redundant\ndel df['tipo dato']  # only one value\ndel df['tipo_dato_fol']  # only one value\ndel df['itter107']  # only a code for terriory (territorio)\n\ndf.head()","075b7852":"tmp = df.copy()\ntmp['magnitude'] = np.log10(tmp['value']).astype(int)\n\ntmp['max_value'] = tmp.groupby(['territorio', 'sesso', 'eta1', \n                                       'condizione_prof', 'condizione_prof_eu', 'year']).magnitude.transform('max')\n\ntmp['difference'] = tmp['max_value'] - tmp['magnitude']  # this goes as high as 4\n\ntmp['value_new'] = tmp['value'] * 10**tmp['difference'] \n\ndf['value'] = tmp['value_new']\n\ndf.head()","439f8530":"pd.crosstab(df['condizione professionale'], df['condizione professionale europea'])","17622543":"df = df[df['condizione professionale europea'] == 'totale'].copy()\ndel df['condizione professionale europea']\ndel df['condizione_prof_eu']","c693e3c3":"df[(df.quarter == 'total') & \n   (df.sesso == 'totale') & \n   (df['condizione professionale'] == 'totale')].groupby(['year','eta1','condizione_prof'], \n                                                                 as_index=False).value.sum()","fa9af19d":"tmp = df.copy()\ntmp['eta1'] = tmp['eta1'].str.replace('_', '-')\ntmp['condizione_prof'] = tmp['condizione_prof'].str.replace('_', '-')\nprof_cond = tmp[['condizione_prof', 'condizione professionale']].drop_duplicates()\n\n# Start manipulating\ntmp = pd.pivot_table(tmp, index=['year', 'territorio'], \n                     columns=['sesso', 'eta1', 'condizione_prof', 'quarter'], values='value', fill_value=0) \ntmp.columns = ['_'.join(col).strip() for col in tmp.columns.values]\n\nfor gender in ['femmine', 'maschi', 'totale']:\n    for con_prof in ['3-4', '99', '2', '1-2', '1', '3D', '3A-3B-3C']:\n        for quarter in ['total', 'Q1', 'Q2', 'Q3', 'Q4']: # \n            tmp[gender+'_Y65-74_'+con_prof+'_'+quarter] = tmp[gender+'_Y15-74_'+con_prof+'_'+quarter] - tmp[gender+'_Y15-64_'+con_prof+'_'+quarter]\n            tmp[gender+'_Y-GE75_'+con_prof+'_'+quarter] = tmp[gender+'_Y-GE15_'+con_prof+'_'+quarter] - tmp[gender+'_Y15-74_'+con_prof+'_'+quarter]\n            tmp[gender+'_Y-GE65_'+con_prof+'_'+quarter] = tmp[gender+'_Y-GE15_'+con_prof+'_'+quarter] - tmp[gender+'_Y15-64_'+con_prof+'_'+quarter]\n            try:\n                tmp[gender+'_Total_'+con_prof+'_'+quarter] = tmp[gender+'_Y-GE15_'+con_prof+'_'+quarter] + tmp[gender+'_Y0-14_'+con_prof+'_'+quarter]\n            except KeyError:\n                tmp[gender+'_Total_'+con_prof+'_'+quarter] = tmp[gender+'_Y-GE15_'+con_prof+'_'+quarter]\n\ntmp = tmp.reset_index()\ntmp = pd.melt(tmp, id_vars=['year', 'territorio'])\ntmp[['sesso', 'eta1', 'condizione_prof', 'quarter']] = tmp['variable'].str.split('_', expand=True)\ndel tmp['variable']\n\ndf_cleaned = pd.merge(tmp, prof_cond, on='condizione_prof', how='left')\n\ndf_cleaned.head()","1534ebf1":"df_cleaned[(df_cleaned.eta1=='Total') & \n           (df_cleaned.sesso=='totale') & \n           (df_cleaned.quarter == 'total') & \n           (df_cleaned.condizione_prof == '99')].groupby('year', as_index=False).value.sum()","0f6ea1c6":"by_year = df[(df.quarter == 'total') & \n         (df['condizione professionale'] == 'totale')].groupby(['year','eta1', 'sesso'], as_index=False).value.sum()\n\nfig, ax = plt.subplots(1,2, figsize=(16, 6), facecolor='#f7f7f7')\n\nmen = by_year[(by_year.sesso == 'maschi') & (by_year.eta1 == 'Y_GE15')]\nwomen = by_year[(by_year.sesso == 'femmine') & (by_year.eta1 == 'Y_GE15')]\n\nax[0].plot(men.year, men.value, label='Men', color='green')\nax[0].plot(women.year, women.value, label='Women', color='red')\nax[0].set_title('Population 15+', fontsize=14)\nax[0].legend()\n\nmen = by_year[(by_year.sesso == 'maschi') & (by_year.eta1 == 'Y0-14')]\nwomen = by_year[(by_year.sesso == 'femmine') & (by_year.eta1 == 'Y0-14')]\n\nax[1].plot(men.year, men.value, label='Men', color='green')\nax[1].plot(women.year, women.value, label='Women', color='red')\nax[1].set_title('Population 0-14', fontsize=14)\nax[1].legend()\n\nfig.suptitle('Pupulation in Italy 1996-2018', fontsize=18)\n\nplt.show()","ad8e2dc7":"piv_year = pd.pivot_table(by_year, index='year', columns=['eta1', 'sesso'], values='value')\npiv_year.columns = ['_'.join(col).strip() for col in piv_year.columns.values]\n\nfor gender in ['femmine', 'maschi', 'totale']:\n    piv_year['Y65-74_'+gender] = piv_year['Y15-74_'+gender] - piv_year['Y15-64_'+gender]\n    piv_year['Y_GE75_'+gender] = piv_year['Y_GE15_'+gender] - piv_year['Y15-74_'+gender]\n    piv_year['All_'+gender] = piv_year['Y_GE15_'+gender] + piv_year['Y0-14_'+gender]\n\npiv_year.head()","55e30dc9":"fig, ax = plt.subplots(5,1, figsize=(16, 24), facecolor='#f7f7f7')\nfig.subplots_adjust(top=0.95)\n\nyears = piv_year.index\n\ni = 0\nfor sel in ['All', 'Y0-14', 'Y15-64', 'Y65-74', 'Y_GE75']:\n    piv_year[sel + '_maschi'].plot(ax=ax[i], label='Men', color='green')\n    piv_year[sel + '_femmine'].plot(ax=ax[i], label='Women', color='red')\n    ax[i].legend()\n    ax[i].set_xticks(years)\n    i += 1\n\nax[0].set_title('Total population', fontsize=14)\nax[1].set_title('Population 0-14', fontsize=14)\nax[2].set_title('Population 15-64', fontsize=14)\nax[3].set_title('Population 65-74', fontsize=14)\nax[4].set_title('Population 75+', fontsize=14)\n\n\nfig.suptitle('Pupulation in Italy 1996-2018', fontsize=18)\n\nplt.show()","0d04b1b8":"def newline(ax, p1, p2, color='black'):\n    l = mlines.Line2D([p1[0],p2[0]], [p1[1],p2[1]], color=color)\n    ax.add_line(l)\n    return ax\n\ndef plot_pop_change(data, pop, title, range_pop='Full', prof_cond='totale'):\n    fig, ax = plt.subplots(1,1,figsize=(14,14), facecolor='#f7f7f7')\n    fig.subplots_adjust(top=0.95)\n\n    by_year = data[(data.quarter == 'total') & (data.sesso == 'totale') & (data.eta1 == pop) &\n             (data['condizione professionale'] == prof_cond)].groupby(['year','eta1', 'territorio'], as_index=False).value.sum()\n\n    y_1996 = by_year[by_year.year == 1996].reset_index(drop=True)\n    y_2018 = by_year[by_year.year == 2018].reset_index(drop=True)\n\n    ax.scatter(y=y_1996['territorio'], x=y_1996['value'], s=80, color='#0e668b', alpha=0.5)\n    ax.scatter(y=y_2018['territorio'], x=y_2018['value'], s=160, color='#ff0000', alpha=0.6)\n    \n    fig.suptitle(title, fontsize=18)\n\n    for i, p1, p2 in zip(y_1996['territorio'], y_1996['value'], y_2018['value']):\n        ax = newline(ax, [p1, i], [p2, i])\n    \n    if range_pop == 'Full':\n        ax.set(xlim=(0,10500000), xlabel='Population')\n        ax.vlines(x=2000000, ymin='Abruzzo', ymax='Veneto', color='black', alpha=1, linewidth=1, linestyles='dotted')\n        ax.vlines(x=6000000, ymin='Abruzzo', ymax='Veneto', color='black', alpha=1, linewidth=1, linestyles='dotted')\n        ax.set_xticks([0, 2000000, 4000000, 6000000, 8000000, 10000000])\n        ax.set_xticklabels(['0', '2M', '4M', '6M', '8M', '10M'])\n    elif range_pop == 'Reduced':\n        ax.set(xlim=(0,1200000), xlabel='Population')\n        ax.vlines(x=300000, ymin='Abruzzo', ymax='Veneto', color='black', alpha=1, linewidth=1, linestyles='dotted')\n        ax.vlines(x=700000, ymin='Abruzzo', ymax='Veneto', color='black', alpha=1, linewidth=1, linestyles='dotted')\n    elif range_pop == 'Employed':\n        ax.set(xlim=(0,5000000), xlabel='Population')\n        ax.vlines(x=1000000, ymin='Abruzzo', ymax='Veneto', color='black', alpha=1, linewidth=1, linestyles='dotted')\n        ax.vlines(x=3000000, ymin='Abruzzo', ymax='Veneto', color='black', alpha=1, linewidth=1, linestyles='dotted')\n    \n    plt.show()\n\nplot_pop_change(df_cleaned, 'Total', 'Variation in the Italian population by region, 1996 vs 2018')","74c4ebe4":"plot_pop_change(df_cleaned, 'Y15-64', 'Variation in the 15-64 population by region, 1996 vs 2018')","ed62625e":"plot_pop_change(df_cleaned, 'Y65-74', 'Variation in the 65-74 population by region, 1996 vs 2018', range_pop='Reduced')","3e5092a1":"plot_pop_change(df_cleaned, 'Y-GE75', 'Variation in the 75+ population by region, 1996 vs 2018', range_pop='Reduced')","e6d71c26":"cond_prof = {'forze lavoro': 'workforce',  # the sum of employed and unemployed\n             'occupati': 'employed', \n             'disoccupati': 'unemployed', \n             'inattivi': 'inactive',  # whoever is not workforce, people that can't work or are not looking for a job\n             'totale': 'total',  # the sum of workforce and inactive\n             'non cercano e non disponibili a lavorare': 'not_looking',  # part of the inactives\n             \"zona grigia dell'inattivit\u00e0\": 'inactive_greyzone'}  # honestly don't know, but it the other half of the inactive\n\ndf_cleaned['prof_cond'] = df_cleaned['condizione professionale'].map(cond_prof)","9010eff3":"def group_year_profcond(data, gender, age='Y15-64', regions=False):\n    \n    if regions:\n        by_year = data[(data.quarter == 'total') & \n           (data.sesso == gender) & \n           (data.eta1 == age)].groupby(['year', 'territorio', 'prof_cond']).value.sum().unstack(2).reset_index()\n    else:\n        by_year = data[(data.quarter == 'total') & \n           (data.sesso == gender) & \n           (data.eta1 == age)].groupby(['year', 'prof_cond']).value.sum().unstack()\n    \n    # some entries are inconsistent when we consider the gender split, we fix them here\n    by_year['workforce'] = by_year['employed'] + by_year['unemployed']\n    try:\n        by_year['total'] = by_year['workforce'] + by_year['inactive']\n        by_year['inactive_perc'] = by_year['inactive'] \/ by_year['total']\n        by_year['unemployed_overInac'] = by_year['unemployed'] \/ by_year['inactive']\n    except KeyError:\n        pass\n    \n    \n    # calculation of rates\n    by_year['employed_overWF'] = by_year['employed'] \/ by_year['workforce']\n    by_year['employed_perc'] = by_year['employed'] \/ by_year['total']\n    by_year['unemployed_overWF'] = by_year['unemployed'] \/ by_year['workforce']\n    by_year['unemployed_perc'] = by_year['unemployed'] \/ by_year['total']\n    \n    try:\n        del by_year['inactive_greyzone']\n        del by_year['not_looking']\n        #del by_year['total']\n    except KeyError:\n        pass\n    \n    return by_year\n\ntotal_year = group_year_profcond(df_cleaned, 'totale')\nmales_year = group_year_profcond(df_cleaned, 'maschi')\nfemales_year = group_year_profcond(df_cleaned, 'femmine')\n\ntotal_year.head()","2eb9a007":"def multiple_proportions(total_year, males_year, females_year, title, inactives=True):\n    if inactives:\n        fig, ax = plt.subplots(3,2, figsize=(15, 18), facecolor='#f7f7f7')\n    else:\n        fig, ax = plt.subplots(2,2, figsize=(15, 12), facecolor='#f7f7f7')\n    fig.subplots_adjust(top=0.95)\n\n    def plot_proportions(data, label, color, inactives=True):\n\n        data['employed_perc'].plot(ax=ax[0][0], label=label, color=color)\n        data['unemployed_perc'].plot(ax=ax[0][1], label=label, color=color)\n        data['employed_overWF'].plot(ax=ax[1][0], label=label, color=color)\n        data['unemployed_overWF'].plot(ax=ax[1][1], label=label, color=color)\n        if inactives:\n            data['inactive_perc'].plot(ax=ax[2][0], label=label, color=color)\n            data['unemployed_overInac'].plot(ax=ax[2][1], label=label, color=color)\n\n        return fig, ax\n\n    fig, ax = plot_proportions(total_year, 'Total', 'black', inactives)\n    fig, ax = plot_proportions(males_year, 'Males', 'green', inactives)\n    fig, ax = plot_proportions(females_year, 'Females', 'red', inactives)\n\n    ax[0][0].set_ylim((0, 1))\n    ax[0][1].set_ylim((0, 1))\n    ax[1][0].set_ylim((0, 1))\n    ax[1][1].set_ylim((0, 1))\n    ax[0][0].legend()\n    ax[0][1].legend()\n    ax[1][0].legend()\n    ax[1][1].legend() \n    ax[0][0].set_title('Employed over Population', fontsize=14)\n    ax[0][1].set_title('Unemployed over Population', fontsize=14)\n    ax[1][0].set_title('Employed over Workforce', fontsize=14)\n    ax[1][1].set_title('Unemployed over Workforce', fontsize=14)\n    \n    if inactives:\n        ax[2][0].set_ylim((0, 1))\n        ax[2][1].set_ylim((0, 1))\n        ax[2][0].legend()\n        ax[2][1].legend()\n        ax[2][0].set_title('Inactives over Population', fontsize=14)\n        ax[2][1].set_title('Unemployed over Inactives', fontsize=14)\n        \n    fig.suptitle(title, fontsize=18)\n\n    plt.show()\n    \n    \nmultiple_proportions(total_year, males_year, females_year, 'Employed, Unemployed, and Inactives (15-64)')","ae739694":"fig, ax = plt.subplots(3,2, figsize=(15, 15), facecolor='#f7f7f7')\nfig.subplots_adjust(top=0.92)\n\nax[0][0].pie(total_year[total_year.index==1996][['employed_perc', 'unemployed_perc', 'inactive_perc']].values[0], \n        labels=['Employed', 'Unemployed', 'Inactive'], autopct='%.0f%%')\nax[0][1].pie(total_year[total_year.index==2018][['employed_perc', 'unemployed_perc', 'inactive_perc']].values[0], \n        labels=['Employed', 'Unemployed', 'Inactive'], autopct='%.0f%%')\nax[1][0].pie(males_year[males_year.index==1996][['employed_perc', 'unemployed_perc', 'inactive_perc']].values[0], \n        labels=['Employed', 'Unemployed', 'Inactive'], autopct='%.0f%%')\nax[1][1].pie(males_year[males_year.index==2018][['employed_perc', 'unemployed_perc', 'inactive_perc']].values[0], \n        labels=['Employed', 'Unemployed', 'Inactive'], autopct='%.0f%%')\nax[2][0].pie(females_year[females_year.index==1996][['employed_perc', 'unemployed_perc', 'inactive_perc']].values[0], \n        labels=['Employed', 'Unemployed', 'Inactive'], autopct='%.0f%%')\nax[2][1].pie(females_year[females_year.index==2018][['employed_perc', 'unemployed_perc', 'inactive_perc']].values[0], \n        labels=['Employed', 'Unemployed', 'Inactive'], autopct='%.0f%%')\n\nax[0][0].set_title('Total Population - 1996', fontsize=14)\nax[0][1].set_title('Total Population - 2018', fontsize=14)\nax[1][0].set_title('Males - 1996', fontsize=14)\nax[1][1].set_title('Males - 2018', fontsize=14)\nax[2][0].set_title('Females - 1996', fontsize=14)\nax[2][1].set_title('Females - 2018', fontsize=14)\n\nfig.suptitle('Employed, Unemployed, and Inactive - 15-64 - 1996 vs 2018', fontsize=18)\n\nplt.show()","de5ed718":"fig, ax = plt.subplots(3,1, figsize=(18, 16), facecolor='#f7f7f7')\n\ntotal_year['employed_perc'].plot(ax=ax[0], color='k')\ntotal_year['unemployed_perc'].plot(ax=ax[1], color='k')\ntotal_year['inactive_perc'].plot(ax=ax[2], color='k')\n\nax[0].set_title('Employement', fontsize=14)\nax[1].set_title('Unemployement', fontsize=14)\nax[2].set_title('Inactive', fontsize=14)\n\nfor axes in ax:\n    axes.axvspan(1996, 2001, facecolor='r', alpha=0.2)  # 3 goverments + 1 technical goverment\n    axes.axvline(x=2001, linestyle='--')\n    axes.axvspan(2001, 2006, facecolor='b', alpha=0.2)  # 2 goverments \n    axes.axvline(x=2006, linestyle='--')\n    axes.axvspan(2006, 2008, facecolor='r', alpha=0.2)  # 1 goverment\n    axes.axvline(x=2008, linestyle='--')\n    axes.axvspan(2008, 2011, facecolor='b', alpha=0.2)  # 1 goverment\n    axes.axvline(x=2011, linestyle='--')\n    axes.axvline(x=2012, linestyle='--')\n    axes.axvspan(2012, 2016, facecolor='r', alpha=0.2)  # 2 governments\n    axes.axvline(x=2016, linestyle='--')\n    axes.axvline(x=2018, linestyle='--')\n    axes.set_yticklabels(['{:,.0%}'.format(x) for x in axes.get_yticks()])","923111fd":"macro_regions = {'Abruzzo': 'South', \n                 'Basilicata': 'South', \n                 'Calabria': 'South', \n                 'Campania': 'South', \n                 'Emilia-Romagna': 'North-East', \n                 'Friuli-Venezia Giulia': 'North-East', \n                 'Lazio': 'Center', \n                 'Liguria': 'North-West', \n                 'Lombardia': 'North-West', \n                 'Marche': 'Center', \n                 'Molise': 'South', \n                 'Piemonte': 'North-West', \n                 'Provincia Autonoma Bolzano \/ Bozen': 'North-East', \n                 'Provincia Autonoma Trento': 'North-East', \n                 'Puglia': 'South', \n                 'Sardegna': 'Islands', \n                 'Sicilia': 'Islands', \n                 'Toscana': 'Center', \n                 'Trentino Alto Adige \/ S\u00fcdtirol': 'North-East', \n                 'Umbria': 'Center', \n                 \"Valle d'Aosta \/ Vall\u00e9e d'Aoste\": 'North-West', \n                 'Veneto': 'North-East'}","b89253d0":"total_regions = group_year_profcond(df_cleaned, 'totale', regions=True)\n\ntotal_regions['macro_region'] = total_regions.territorio.map(macro_regions)\n\nmacros = total_regions.groupby(['year', \n                             'macro_region'], as_index=False)[['employed', \n                                                               'unemployed', \n                                                               'inactive', \n                                                               'total']].sum().set_index('year')\n\nmacros['employed_perc'] = macros['employed'] \/ macros['total']\nmacros['unemployed_perc'] = macros['unemployed'] \/ macros['total']\nmacros['inactive_perc'] = macros['inactive'] \/ macros['total']\n\n\nfig, ax = plt.subplots(3,1, figsize=(18, 16), facecolor='#f7f7f7')\n\nfor region in macros.macro_region.unique():\n    macros[macros.macro_region == region]['employed_perc'].plot(ax=ax[0], label=region, alpha=0.7)\n    macros[macros.macro_region == region]['unemployed_perc'].plot(ax=ax[1], label=region, alpha=0.7)\n    macros[macros.macro_region == region]['inactive_perc'].plot(ax=ax[2], label=region, alpha=0.7)\n    \ntotal_year['employed_perc'].plot(ax=ax[0], color='k', label='Total')\ntotal_year['unemployed_perc'].plot(ax=ax[1], color='k', label='Total')\ntotal_year['inactive_perc'].plot(ax=ax[2], color='k', label='Total')\n\nax[0].set_title('Employement', fontsize=14)\nax[1].set_title('Unemployement', fontsize=14)\nax[2].set_title('Inactive', fontsize=14)\n\nfor axes in ax:\n    axes.legend()\n    axes.set_yticklabels(['{:,.0%}'.format(x) for x in axes.get_yticks()])","90ae7656":"fig, ax = plt.subplots(2,1, figsize=(18, 10), facecolor='#f7f7f7')\nfig.subplots_adjust(top=0.92)\n\nfor region in ['South', 'Islands']:\n    macros[macros.macro_region == region]['employed_perc'].plot(ax=ax[0], label=region, alpha=0.7)\n    macros[macros.macro_region == region]['unemployed_perc'].plot(ax=ax[1], label=region, alpha=0.7)\n    \ntotal_year['employed_perc'].plot(ax=ax[0], color='k', label='Total')\ntotal_year['unemployed_perc'].plot(ax=ax[1], color='k', label='Total')\n\nax[0].set_title('Employement', fontsize=14)\nax[1].set_title('Unemployement', fontsize=14)\n\nfor axes in ax:\n    axes.axvspan(1996, 2001, facecolor='r', alpha=0.2)  # 3 goverments + 1 technical goverment\n    axes.axvline(x=2001, linestyle='--')\n    axes.axvspan(2001, 2006, facecolor='b', alpha=0.2)  # 2 goverments \n    axes.axvline(x=2006, linestyle='--')\n    axes.axvspan(2006, 2008, facecolor='r', alpha=0.2)  # 1 goverment\n    axes.axvline(x=2008, linestyle='--')\n    axes.axvspan(2008, 2011, facecolor='b', alpha=0.2)  # 1 goverment\n    axes.axvline(x=2011, linestyle='--')\n    axes.axvline(x=2012, linestyle='--')\n    axes.axvspan(2012, 2016, facecolor='r', alpha=0.2)  # 2 governments\n    axes.axvline(x=2016, linestyle='--')\n    axes.axvline(x=2018, linestyle='--')\n    axes.set_yticklabels(['{:,.0%}'.format(x) for x in axes.get_yticks()])\n    axes.legend()\n    \nfig.suptitle('Cyclic decline in Employement for southern regions and governement changes', fontsize=18)\nplt.show()","8872fe06":"plot_pop_change(df_cleaned, 'Y15-64', 'Variation in the number of Employed by region, 1996 vs 2018', \n                prof_cond='occupati', range_pop='Employed')","f0c72044":"def plot_pop_sidebyside(data, title, prof_cond='occupati'):\n    fig, ax = plt.subplots(1,2,figsize=(16,6), facecolor='#f7f7f7')\n    fig.subplots_adjust(top=0.87)\n\n    by_year = data.groupby(['year', 'macro_region'], as_index=False).sum()\n\n    y_1996 = by_year[by_year.year == 1996].reset_index(drop=True)\n    y_2018 = by_year[by_year.year == 2018].reset_index(drop=True)\n\n    ax[0].scatter(y=y_1996['macro_region'], x=y_1996['total'], s=80, color='#0e668b', alpha=0.5)\n    ax[0].scatter(y=y_2018['macro_region'], x=y_2018['total'], s=160, color='#ff0000', alpha=0.6)\n    ax[1].scatter(y=y_1996['macro_region'], x=y_1996[prof_cond], s=80, color='#0e668b', alpha=0.5)\n    ax[1].scatter(y=y_2018['macro_region'], x=y_2018[prof_cond], s=160, color='#ff0000', alpha=0.6)\n\n    fig.suptitle(title, fontsize=18)\n\n    for i, p1, p2 in zip(y_1996['macro_region'], y_1996['total'], y_2018['total']):\n        ax[0] = newline(ax[0], [p1, i], [p2, i])\n    for i, p1, p2 in zip(y_1996['macro_region'], y_1996[prof_cond], y_2018[prof_cond]):\n        ax[1] = newline(ax[1], [p1, i], [p2, i])\n        \n    ax[0].set(xlim=(0,10500000), xlabel='Population')\n    ax[0].set_title('Population', fontsize=14)\n    ax[1].set(xlim=(0,10500000), xlabel=prof_cond.capitalize())\n    ax[1].set_title(f'{prof_cond.capitalize()}', fontsize=14)\n    for axes in ax:\n        axes.set_xticks([0, 2000000, 4000000, 6000000, 8000000, 10000000])\n        axes.set_xticklabels(['0', '2M', '4M', '6M', '8M', '10M'])\n\n    plt.show()\n    \nplot_pop_sidebyside(total_regions, 'Variation by Macro Regions (15-64), 1996 vs 2018', prof_cond='employed')","fe9aabd0":"by_year = total_regions.groupby(['year', 'macro_region'], as_index=False).sum()\n\nby_year['employed_perc'] = by_year['employed'] \/ by_year['total']\nby_year['unemployed_perc'] = by_year['unemployed'] \/ by_year['total']\nby_year['inactive_perc'] = by_year['inactive'] \/ by_year['total']\n\nfig, ax = plt.subplots(5,2, figsize=(15, 25), facecolor='#f7f7f7')\nfig.subplots_adjust(top=0.95)\n\nfor axes, region in zip(ax[:,0], ['South', 'North-West', 'North-East', 'Islands', 'Center']):\n    axes.pie(by_year[(by_year.year==1996) & \n                     (by_year.macro_region==region)][['employed_perc', 'unemployed_perc', 'inactive_perc']].values[0], \n        labels=['Employed', 'Unemployed', 'Inactive'], autopct='%.0f%%')\n    axes.set_title(f'{region} - 1996', fontsize=14)\n\nfor axes, region in zip(ax[:,1], ['South', 'North-West', 'North-East', 'Islands', 'Center']):\n    axes.pie(by_year[(by_year.year==2018) & \n                     (by_year.macro_region==region)][['employed_perc', 'unemployed_perc', 'inactive_perc']].values[0], \n        labels=['Employed', 'Unemployed', 'Inactive'], autopct='%.0f%%')\n    axes.set_title(f'{region} - 2018', fontsize=14)\n\nfig.suptitle('Employed, Unemployed, and Inactive - 15-64 - 1996 vs 2018', fontsize=18)\n\nplt.show()","b8770eb0":"def region_overview(data, region):\n    total_year = group_year_profcond(data[data.territorio==region], 'totale', regions=True)\n    males_year = group_year_profcond(data[data.territorio==region], 'maschi', regions=True)\n    females_year = group_year_profcond(data[data.territorio==region], 'femmine', regions=True)\n    \n    total_year = total_year[total_year.year < 2019]\n    males_year = males_year[males_year.year < 2019]\n    females_year = females_year[females_year.year < 2019]\n\n    fig = plt.figure(figsize=(18, 10), facecolor='#f7f7f7') \n    fig.suptitle(region, fontsize=18)\n\n    spec = fig.add_gridspec(ncols=3, nrows=2, height_ratios=[5, 3])\n\n    ax0 = fig.add_subplot(spec[0,:])\n    ax1 = fig.add_subplot(spec[1,0])\n    ax2 = fig.add_subplot(spec[1,1])\n    ax3 = fig.add_subplot(spec[1,2])\n\n    ax0.set_title('Population trend by labour status (15-64)', fontsize=14)\n    ax1.set_title('Employed, Unemployed, Inactive (2018)', fontsize=12)\n    ax2.set_title('Males (15-64)', fontsize=12)\n    ax3.set_title('Females (15-64)', fontsize=12)\n    \n    total_year.set_index('year').employed_perc.plot(ax=ax0, label='Employed')\n    total_year.set_index('year').unemployed_perc.plot(ax=ax0, label='Unemployed')\n    total_year.set_index('year').inactive_perc.plot(ax=ax0, label='Inactive')\n    \n    ax1.pie(total_year[total_year.year==2018][['employed_perc', 'unemployed_perc', 'inactive_perc']].values[0], \n            labels=['Employed', 'Unemployed', 'Inactive'], autopct='%.0f%%')\n    \n    males_year.set_index('year').employed.plot(ax=ax2, label='Empl.')\n    males_year.set_index('year').unemployed.plot(ax=ax2, label='Unempl.')\n    males_year.set_index('year').inactive.plot(ax=ax2, label='Inact.')\n    females_year.set_index('year').employed.plot(ax=ax3, label='Empl.')\n    females_year.set_index('year').unemployed.plot(ax=ax3, label='Unempl.')\n    females_year.set_index('year').inactive.plot(ax=ax3, label='Inact.')\n    \n    for axes in [ax0, ax2, ax3]:\n        axes.set_xticks([1997, 2002, 2007, 2012, 2017])\n        \n    ax0.legend()\n    ax0.set_ylim((0,1))\n    ax0.set_ylabel('Percentage')\n    ax0.set_yticklabels(['{:,.0%}'.format(x) for x in ax0.get_yticks()])\n\n    plt.show()","4bea1d6b":"region_overview(df_cleaned, \"Lombardia\")","59841e4a":"region_overview(df_cleaned, \"Emilia-Romagna\")","89a0f510":"region_overview(df_cleaned, \"Veneto\")","2d0ef08b":"region_overview(df_cleaned, \"Friuli-Venezia Giulia\")","c3c0b807":"region_overview(df_cleaned, \"Lazio\")","ae661630":"region_overview(df_cleaned, \"Abruzzo\")","6c86a44d":"region_overview(df_cleaned, \"Campania\")","e782c12c":"region_overview(df_cleaned, \"Sardegna\")","a231ed97":"region_overview(df_cleaned, \"Sicilia\")","153da4a4":"## Center\n\nAgain, good stability. We have regions that never changed colors (like Toscana being with a government from the left since always) but the interesting one, I think, is Lazio.\n\nWe have seen above that it was the region with the largest increase in the 15-64 population and, to make it more interesting, changed colors several times\n\n* Left until 2000\n* Right until 2005\n* Left until 2010\n* Right until 2013\n* Left since then\n\nAt least under these metrics, the color of the local government does not matter as in the region of the capital Rome there is a steady increase in occupation. On the contrary of other regions, we can also observe a slight increase in unemployment since 2011 that still failed to climb down.","aa2b91d2":"Next, we will focus on the age range that better reflects the workforce: 15-64. We could focus on the 15+ population as well but, since we know that **the population grew older in the past 22 years, every trend would result artificially negative** as more and more people would fall into the `inactive` category as they get to the retirement age.","618d5517":"We have some problematic columns, `value` above all (being the most important information of this dataset). We can see this in the fourth row, where the original data clearly misses a trailing 0. We propose a simple cleaning procedure.","635ed8e9":"The other region is Sicilia, which is, not only geographically, much closer to the South with more inactive than employed, a big gender gap that doesn't look is closing down, and a decrease in occupation among Males.","f8558072":"All that being said, the disparity between North and South is evident and does not look like it is going to reduce any time soon. We indeed see that the only regions where the number of employed increased in the past 22 years are in the North or Center and, considering that the 15-64 population essentially remained stable in this period, we can conclude that the southern regions not only were starting from a lower employed ratio, but also have seen the gap with the rest of country increase.","18669ae4":"This is of course more evident if we look at the macro regions","904d2b20":"We thus see how every macro-region, except the center, saw a **reduction in the 15-64 population but only the Center and the North had an increase in the Employed population**. Once again, we see that the biggest change can be found in the proportion of inactive. This can be because in the past it was possible to retire and receive a good pension relatively young while now is much rarer to see someone with less than 65 years of age receiving a pension. Another reason can be that in the past it was much more common to work without contracts (for official purposes, if you don't declare you are working and you are not searching, you are inactive, even if you have a job) and this phenomenon has been fought as a measure to reduce tax evasion and increase workers rights. The only macro-region not showing this trend is the one of the Islands (Sicilia and Sardegna), while the South is the only one that remained pretty much unchanged in the past 22 years.\n\n# Italy, regions, local governments, and employment\n\nAfter getting a general idea about the macro-regions of Italy, we conclude this analysis by zooming into the regions that show a peculiar pattern. On the contrary of the national politics, the local governments tend to change color less often but, even though the influence of local governments on the employment of the population is somewhat limited, we will try to study potentially interesting situations.\n\n## North-West\n\nWe have seen already the stability of this macro-region in the past 22 years, with a steady increase in occupation. We can see this by looking at the biggest of the 4 regions: Lombardia.","3a421dc4":"We then see again that in 2010 there is an error for 0-14 females but that, overall, we can still form our first ideas about the Italian population.\n\n* The population has remained stable in the late '90s and saw a steady increase from 2003 to 2013.\n* Since 2013, the Italian population is slightly decreasing\n* The decrease involves the population up to 65 years of age.\n* The population 65+ kept increasing, and the stability of the 75+ is undeniable.\n* This is in line with the common knowledge that the Italian population is getting older\n\nThe increase in population could be attributed to the increase in the number of immigrants of the mid-2000s but this is not something we can extract from this dataset (other sources on the ISTAT website might help on this matter). \n\n(*However, if this was the case, it would debunk a fairly popular myth in Italy that says that all the immigrants are males and we can clearly see here that the increase is identical for males and females*). \n\nWe will try to further expand on this point once that the appropriate data becomes available.\n\nNext, we notice that the split by gender is not giving extra insights (as the plots are nearly parallel to one another) and we thus drop it for now, focusing instead on how the population changed from 1996 (in blue) to 2018 (in red)","096fe27b":"The region shows much more instability in the employment ratio, in particular around the 2 financial crises of 2008 and 2011.\n\nTo find more stability we can look at Friuli-Venezia Giulia, which passed through a lot of local presidents from the right and one from the left (2013-2018) by showing the same steady improvement in employment. Maybe where working is not a problem, work is not a factor at the local elections. Or maybe the fact that this region is an autonomous region (has different legislation, different administration, and different taxes, to some extent) is guaranteeing the stability.","ab4add74":"So in 2018 we have about 53M people 15+ years old and about 8M people in the 0-14 class. It all makes sense.\n\nBefore moving on, there is some more data wrangling to get a better view of the italian population to do. Namely, we can appropriately combine age groups to get more granular data.","0f8efeab":"To sense check our cleaning, I want to see if the population size matches the known value (about 61 million italians this year).","e2c106b1":"As they are still incomplete in this dataset, we will ignore the entries from 2019.\n\n# Population trends in Italy\n\nThe first thing we can do is to see how the population evolved over they years","98a3338c":"Or Campania, that sadly has more inactive than employed, especially among women","4f0bfaff":"Something really odd in 2010, it appears to be a problem that comes from the data source. \n\nHowever, we can see how in the late '90s the 0-14 population started decreasing, which resulted in a lower increase rate a few years later in the 15+ population. The worrisome trend is the one started around 2013 but I guess we will see the effects of that in a few years.\n\nThis first graph suggests that we need a bit more granularity to have a better view of the Italian population.","7f217b49":"This gives us a better view of the previous insights.\n\n* The population grew in very few regions: Lombardia, Lazio, Emilia Romagna, and Veneto.\n* The remaining regions essentially kept their population intact for 22 years.\n* However, if we focus on the population 15-64, we observe that this growth disappears in almost all the regions\n* Lazio is the only exception, with a visible growth\n* Liguria and Piemonte had a visible decrease in the 15-64 population. This is surprising as these regions (especially Piemonte) have been historically the destination of many Italians looking for jobs in big industries. Big industries that experienced a quite strong crisis from the late '90s.\n* All the growth in population, in any region, should be largely attributed to growth in the 65+ population\n\nTo summarize, the Italian population has been increasing in the past 22 years, an increase that was evident in the 2003-2013 period. However, the increase comes from a higher life expectancy rather than an increase in births. As a result, the 0-65 population has been substantially stable, while the 65+ has been steadily increasing.\n\nWith this knowledge, we can head to the main subject of this analysis\n\n# Is there a job crisis in Italy?\n\nFirst of all, we should translate to English and broaden our audience.","4e3ecf9c":"This notebook aims to explore the situation in Italy by looking at its demographic composition and labor status. The data covers the period between 1996 and 2018, with quarterly observations by region (or territory). \n\nWe will try to grasp from the data how the gender and the geographical disparities have evolved in the past 22 years. We will see how one of these disparities has been reduced in this period, while the other didn't show any improvement.\n\nA word of caution before proceeding, this analysis has 2 big limitations (that I can point out, I can't exclude there are more):\n\n* while seeing an increase or a decrease in the number of employed can tell us something, it can't tell us about working conditions and perspectives.\n* The population is here broke down into a few age categories and, unfortunately, the size of these categories is not ideal to point out potential generational issues.\n\nMoreover, even though the data are coming from the Italian Statistical Institute (ISTAT) and they are as official as they can be, we will find some anomalies, either directly from the source or during the upload here on Kaggle. For this reason, please keep in mind that, as always, this analysis is limited by the quality of the data that generates it.","6249c6f5":"Unfortunately, we see again some anomalies but also the increase in occupation among Women. The change is less strong than the Lombardia case but we have to consider that in 1996's Emilia-Romagna the majority of women was not considered inactive, i.e. situation was a bit better.\n\nThe first major change, however, is about the financial crisis of 2011. Here, we can observe a visible effect and the employment ratio is barely back at the pre-crisis level now.\n\nOn the opposite side (so to speak) of the political spectrum, we find Veneto, which also never changed government colors as Lombardia.","554cc704":"We can see that dramatic drops in the employment ratio lead to a change in the government (although not always to a change in the Parliament). The 2 financial crises happened to be during 2 different governments of the Democratic Party who, one way or the other, has also be a protagonist of the technical or center governments. We also see how the economic crises lead to an increase in the inactives rather than of the unemployed. \n\nTo answer the question, yes, it seems to matter. However, this analysis is incapable of excluding macroeconomic factors (like financial crises) and therefore, as often happens in the political debate, we have to leave the interpretation on the governments' role to the reader.\n\n# Regional disparity\n\nWe can now try to zoom in again and focus on how the labor status changed in the various Italian regions. Again, we need to simplify the discussion a bit and we focus on macro-regions first, defined in the next cell.","9f7408c0":"And the same can be seen in all the other regions of the South.\n\n## Islands\n\nBoth regions here are autonomous, like Friuli-Venezia Giulia above, but we have seen that they do not show the same stability.\n\nThe interesting periodic behavior observed before was due to the contribution of Sardegna, which shows also the improvement in the labor status for Women. It also the same region where we find a visible (other times was not visible due to data anomalies) in the number of employed Males since 2007.\n\nThe local government changed quite a lot too, basically changing from left to right every 2-5 years","706494d0":"We thus see how the North-West of the country kept increasing the fraction of the employed population, substantially unaffected by any crisis or change in government. On the other hand, a similarly rich region like the North-East appears to have dramatically felt the crises, which raises concerns also on the integrity of our data.\n\nThe South and the Islands have historically a lower employment level and display some seasonality in the unemployment level. Interestingly, if we overlay the government changes we notice how every decline in employment in the Islands comes after a government in the left category.","62f70723":"Besides a few anomalies in the data for the unemployed when split by gender, we see a steady decrease in the inactive Females as well as an increase in employment. The local government has been essentially the same since 1995, with a coalition of what we can call Berlusconi's party and the old fashioned Lega Nord (now called just Lega).\n\n## North-East\n\nHere, we have seen that the financial crises had quite a strong impact on the employment rate and, although we should consider that this could be a data anomaly, it is worth investigating. Since we have just seen a region that never changed government colors in these 22 years, we can start from Emilia-Romagna, which had some parties from the left always in charge since Italy is a Republic.","fe0a9006":"For the issue mentioned above about the column `value`, we can try something with a groupby","71505012":"Initially, there were years with more people in the 15-64 age category than in the 15-74 one. Luckily, this small fix of the trailing 0's solved the issue.\n\nI am now curios about what is the difference between professional condition (condizione professionale) and european professional condition (condizione professionale europea) as I can't find the definition on the ISTAT's website","5d083e1d":"# Conclusions\n\nIn 1995, Italy was the 5th largest economy by GDP and the 7th by GDP per person. \n\nIn 2005, it was the 7th largest economy by GDP and the 10th by GDP per person.\n\nIn 2015, it was the 8th largest economy by DGP and it felt off the top 10 for GDP per person.\n\nIn that span of time, the population got older and older, many big industries (from automotive, to chemistry, to siderurgy) went through several crises and the economy relied more and more on tourism and luxury products. \n\nThe historical gap between men and women got smaller with time but, unfortunately, only in some regions, stressing out even more the disparities between the North and South of the country. If we can observe an overall improvement in the proportion of the population with a job, this was not uniform across the country. Moreover, some regions appear to be more prepared than others to absorb the effects of financial crises on a global scale.\n\nLocal governments seem to be irrelevant in altering any trend of occupation and the influence of the national government appears to be limited with, at best, short term solutions.\n\nThe situation doesn't look promising at all but not even so grim as one may think. The main problem here, in my opinion, is the disparity, both between genders and between regions. The first one has deep roots in the Italian culture and we can expect is going to take time, but we can't deny that steps in the right direction were made. It is more difficult to explain how an economic difference that comes from the creation of the country (1861) is still visible in a nation so small. \n\nFrom this analysis, which is limited to the observation of the workforce, we can see that every improvement came from reducing one of these inequalities, confirming that it is always better to do things together. ","1f9c3e39":"Let's start by having a look at the data.","7dd2ac35":"## Does the government matter?\n\nWe can now kick the wasp nest and overlay the evolution of the employment ratio with the changes that happened in the parliament. By oversimplifying because there are not enough colors to cover all the shades of Italian politics, we will split the governments into 3 categories: Right, Left, Center. \n\nOn the right, we have 3 Berlusconi's governments together with other parties, like Lega, which will show up later as a center. On the left, we have what is now called the Democratic Party, first with a multitude of smaller parties, then alone (and will also show up as a center at the end). At the center, we find the technical government of Monti, following the economic and political crisis of the last Berlusconi's government, the government with both the Democratic Party and Berlusconi (although the Democratic Party had the majority of the seats), and the 2 governments where the 5 Star Movements has the majority of the seats (one with Lega, one with the Democratic Party), which will show up when we extend the data to after 2018.\n\nIt is a fairly arbitrary division, but a necessary one to have some order. In red the left, in blue the right, in white the center.\n\n*Note: probably in a future version we will do it quarterly for a better view of the government change*","7aa89161":"## South\n\nHere the situation, we have already seen this, is worse if we consider the employment ratio and we can now observe that even considering individual regions the situation is not changing enough since 1996. For example, for the first time in this analysis, we find a region that did not improve the situation of inactive women: Abruzzo","8856a26f":"It doesn't make much sense to me to have both, I am just keeping the total (totale) value of `condizione professionale europea` (I promise I will rename the columns later for a more international audience)","671849d2":"We observe a stable growth in employment from 1996 to 2008, the year of the first economic crisis. Italy then bounced back but felt the second crisis of 2013, which was also longer. After that, the growth in employment resumed.\n\nThe employment rate is historically higher for Males but we can observe a positive trend in the Females' employment rate. This has to be attributed to a decrease in the proportions of Inactives among women 15-64 since 1996, a trend that appears to be reversed since 2015. In other words, more women started to look for a job over the years and they also found a job. In 2013 and 2014 it appears to be a massive increase in women's employment, coming out of the inactivity status, but this got reversed in 2015. (*Note: we can't exclude this is an error in the data for those years as the information about the 2 genders provided are less accurate*)\n\nOn the other hand, the employment rate has seen a significant drop for men since 2013 (the year of the last economic crisis). Given that the proportion of Inactives among men has been substantially stable, this means that we have more and more unemployed among men, bringing the unemployment rates for men and women to be nearly identical.\n\nThe next chart shows better how the increase in employment among Italians is due to a larger proportion of women coming out of the inactive category (which is very broad, going from students to people that stop looking for a job) and finding a job."}}