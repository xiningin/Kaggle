{"cell_type":{"71777ee9":"code","67ab4232":"code","8812f2f6":"code","533735dc":"code","1bba7ffd":"code","fff8952c":"code","c608e4e3":"code","ece63ef0":"code","f122d66a":"code","58def5ff":"code","ad25c7b2":"code","c4a5a847":"code","c3e470d8":"code","4a173895":"code","bbe5196c":"code","0968a6c2":"code","c63b8a47":"code","af690f30":"code","c371f780":"code","ad07b14e":"code","6bc10f39":"code","0c3abc3b":"code","c96f57e6":"code","c6364218":"code","9dfa49f6":"code","82e2c219":"code","251f9378":"code","5ed6b1c1":"code","f369330b":"code","44e35726":"code","5100542f":"code","caa8a9e5":"code","7dffdc82":"code","6ff9449f":"code","cae6adf5":"code","bdf920d2":"code","60407278":"code","917109d7":"code","6fdddd08":"code","e839fdb5":"code","70866a01":"code","1f4ac0c3":"code","49aea61a":"code","8cb05016":"code","407c59b9":"code","afd812c4":"code","21539adb":"code","315cf6a2":"code","24283f4a":"code","872d9976":"code","ad85e069":"code","655f65ab":"code","4c30ef97":"code","fc4fb3f7":"code","9470f02a":"code","cd61101d":"code","e1da6c3d":"code","296216cc":"code","9f32f353":"code","148e731a":"code","995d840a":"code","0e03c0b2":"code","7111347d":"code","bc2d86b5":"code","d7963cf4":"code","a80e99a9":"code","1f90733a":"code","48338c4d":"code","4f67fd55":"code","bac4d02e":"code","2b35490f":"code","4d1aee34":"code","ee5c54b5":"code","f67397aa":"code","54ded49a":"code","aa03e1e5":"markdown","4609b572":"markdown","58c5ef5a":"markdown","2ecf354d":"markdown","a9cf123c":"markdown","627bf1fd":"markdown","bd2ca841":"markdown","ab3f6586":"markdown","55a6a6ac":"markdown","06eb6e71":"markdown","eb2ebea5":"markdown"},"source":{"71777ee9":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","67ab4232":"health_df=pd.read_csv(\"..\/input\/Big_Cities_Health_Data_Inventory.csv\")\nhealth_df.shape","8812f2f6":"health_df.describe()","533735dc":"health_df.info()","1bba7ffd":"sum_value=health_df.isna().sum()\nprint(\"=========Null Value========\")\nprint(sum_value)\nprint(\"=========Null Percentage=======\")\nprint((sum_value)\/len(health_df)*100)","fff8952c":"health_df[health_df.duplicated()]","c608e4e3":"health_df.columns","ece63ef0":"import matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline","f122d66a":"health_df.head(20)","58def5ff":"health_df.nunique()","ad25c7b2":"num_var=['Year','Value']\ncat_var=[]\nfor i in health_df.columns:\n    if i not in num_var:\n        cat_var.append(i)\ncat_var","c4a5a847":"categorical=['Indicator Category','Gender','Race\/ Ethnicity','Year']\nfig, ax = plt.subplots(2, 2, figsize=(30, 40))\nfor variable, subplot in zip(categorical, ax.flatten()):\n    cp=sns.countplot(health_df[variable], ax=subplot,order = health_df[variable].value_counts().index)\n    cp.set_title(variable,fontsize=40)\n    for label in subplot.get_xticklabels():\n        label.set_rotation(90)\n        label.set_fontsize(36)                \n    for label in subplot.get_yticklabels():\n        label.set_fontsize(36)        \n        cp.set_ylabel('Count',fontsize=40)    \nplt.tight_layout()","c3e470d8":"plt.figure(figsize=(25,12))\ncp=sns.countplot(x=health_df['Place'],data=health_df,order = health_df['Place'].value_counts().index)\ncp.set_xticklabels(cp.get_xticklabels(),rotation=90,fontsize=18)\ncp.set_xlabel('Year',fontsize=15)\ncp.set_ylabel('Count',fontsize=18)","4a173895":"#health_df['Place'].value_counts()\nhealth_df['State']=health_df['Place'].apply(lambda x: x.split(\",\")).str[1]\n\n","bbe5196c":"plt.figure(figsize=(25,12))\ncp=sns.countplot(x=health_df['State'],data=health_df,order = health_df['State'].value_counts().index)\ncp.set_xticklabels(cp.get_xticklabels(),rotation=90,fontsize=18)\ncp.set_xlabel('State',fontsize=15)\ncp.set_ylabel('Count',fontsize=18)","0968a6c2":"plt.figure(figsize=(25,12))\ncp=sns.countplot(x=health_df['Year'],data=health_df)\ncp.set_xticklabels(cp.get_xticklabels(),rotation=90,fontsize=18)\ncp.set_xlabel('Year',fontsize=15)\ncp.set_ylabel('Count',fontsize=18)","c63b8a47":"plt.figure(figsize=(25,12))\ncp=sns.countplot(x=health_df['Indicator Category'],data=health_df,hue=health_df['Gender'],order = health_df['Indicator Category'].value_counts().index)\ncp.set_xticklabels(cp.get_xticklabels(),rotation=90,fontsize=18)\ncp.set_xlabel('Year',fontsize=15)\ncp.set_ylabel('Count',fontsize=18)","af690f30":"plt.figure(figsize=(20, 10))\nsns.boxplot(data=health_df)","c371f780":"# Importing necessary package for creating model\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import mean_absolute_error, mean_squared_error,r2_score","ad07b14e":"cat_col=['Indicator Category','Gender','State','Race\/ Ethnicity','Year']\nnum_col=['Value']\nnum_col","6bc10f39":"print(health_df.shape)\nhealth_df_nona=health_df[(health_df['Value'].isna()==False) & (health_df['Value']!=0)]\nhealth_df_nona.shape","0c3abc3b":"# one-hot encoding\n\none_hot=pd.get_dummies(health_df_nona[cat_col])\nhealth_procsd_df=pd.concat([health_df_nona[num_col],one_hot],axis=1)\nhealth_procsd_df.head(10)","c96f57e6":"health_procsd_df.isna().sum()","c6364218":"#using one hot encoding\nX=health_procsd_df.drop(columns=['Value'])\ny=health_procsd_df[['Value']]","9dfa49f6":"train_X, test_X, train_y, test_y = train_test_split(X,y,test_size=0.3,random_state=1234)","82e2c219":"model = LinearRegression()\n\nmodel.fit(train_X,train_y)","251f9378":"# Print Model intercept and co-efficent\nprint(\"Model intercept\",model.intercept_,\"Model co-efficent\",model.coef_)\n","5ed6b1c1":"cdf = pd.DataFrame(data=model.coef_.T, index=X.columns, columns=[\"Coefficients\"])\ncdf","f369330b":"# Print various metrics\nfrom sklearn.metrics import mean_absolute_error, mean_squared_error,r2_score\n\nprint(\"Predicting the train data\")\ntrain_predict = model.predict(train_X)\nprint(\"Predicting the test data\")\ntest_predict = model.predict(test_X)\nprint(\"MAE\")\nprint(\"Train : \",mean_absolute_error(train_y,train_predict))\nprint(\"Test  : \",mean_absolute_error(test_y,test_predict))\nprint(\"====================================\")\nprint(\"MSE\")\nprint(\"Train : \",mean_squared_error(train_y,train_predict))\nprint(\"Test  : \",mean_squared_error(test_y,test_predict))\nprint(\"====================================\")\nimport numpy as np\nprint(\"RMSE\")\nprint(\"Train : \",np.sqrt(mean_squared_error(train_y,train_predict)))\nprint(\"Test  : \",np.sqrt(mean_squared_error(test_y,test_predict)))\nprint(\"====================================\")\nprint(\"R^2\")\nprint(\"Train : \",r2_score(train_y,train_predict))\nprint(\"Test  : \",r2_score(test_y,test_predict))\nprint(\"MAPE\")\nprint(\"Train : \",np.mean(np.abs((train_y - train_predict) \/ train_y)) * 100)\nprint(\"Test  : \",np.mean(np.abs((test_y - test_predict) \/ test_y)) * 100)","44e35726":"#Plot actual vs predicted value\nplt.figure(figsize=(10,7))\nplt.title(\"Actual vs. predicted expenses\",fontsize=25)\nplt.xlabel(\"Actual Value\",fontsize=18)\nplt.ylabel(\"Predicted Value\", fontsize=18)\nplt.scatter(x=test_y,y=test_predict)","5100542f":"len(train_predict[train_predict==0])","caa8a9e5":"test_predict","7dffdc82":"#cat_var_main=['Indicator Category','Gender','Race\/ Ethnicity','Place']\n#fig, ax = plt.subplots(3, 4, figsize=(20, 10))\n#for variable, subplot in zip(cat_var, ax.flatten()):\n    #sns.countplot(health_df[variable], ax=subplot)\n    #for label in subplot.get_xticklabels():\n        #label.set_rotation(90)","6ff9449f":"#sns.countplot(data=health_df,y=health_df[\"Value\"])\n#health_df.groupby(\"Indicator Category\").agg('mean','median','mode')\n#agg_funcs = dict(Size='size', Sum='sum', Mean='mean', Std='std', Median='median')\n#health_df.set_index(['Indicator Category','State']).stack().shape\nagg_func=dict(Count='count',Avg='mean',Median='median',Deviation='std',Min='min',Max='max')\nhealth_df.groupby(\"Indicator Category\").agg({\n        'Value': agg_func,\n    }).sort_values(('Value', 'Count'))","cae6adf5":"plt.figure(figsize=(30, 20))\nsns.boxplot(data=health_df,x=health_df[\"Indicator Category\"],y=health_df[\"Value\"])\n","bdf920d2":"plt.figure(figsize=(30, 20))\ncp=sns.boxplot(data=health_df,x=health_df[\"Indicator Category\"],y=health_df[\"Value\"],showfliers=False)\ncp.set_xticklabels(cp.get_xticklabels(),rotation=90,fontsize=18)\n#cp.set_yticklabels(cp.get_yticklabels(),fontsize=18)\ncp.set_xlabel(\"Race\/ Ethnicity\",fontsize=15)\ncp.set_ylabel('Value',fontsize=18)","60407278":"agg_func=dict(Count='count',Avg='mean',Median='median',Deviation='std',Min='min',Max='max')\nhealth_df.groupby(\"State\").agg({\n        'Value': agg_func,\n    }).sort_values(('Value', 'Count'))","917109d7":"plt.figure(figsize=(30, 20))\nsns.boxplot(data=health_df,x=health_df[\"State\"],y=health_df[\"Value\"])","6fdddd08":"plt.figure(figsize=(30, 20))\ncp=sns.boxplot(data=health_df,x=health_df[\"State\"],y=health_df[\"Value\"],showfliers=False)\ncp.set_xticklabels(cp.get_xticklabels(),rotation=90,fontsize=18)\n#cp.set_yticklabels(cp.get_yticklabels(),fontsize=18)\ncp.set_xlabel(\"Race\/ Ethnicity\",fontsize=15)\ncp.set_ylabel('Value',fontsize=18)","e839fdb5":"agg_func=dict(Count='count',Avg='mean',Median='median',Deviation='std',Min='min',Max='max')\nhealth_df.groupby(\"Gender\").agg({\n        'Value': agg_func,\n    }).sort_values(('Value', 'Count'))","70866a01":"plt.figure(figsize=(30, 20))\nsns.boxplot(data=health_df,x=health_df[\"Gender\"],y=health_df[\"Value\"])","1f4ac0c3":"plt.figure(figsize=(30, 20))\ncp=sns.boxplot(data=health_df,x=health_df[\"Gender\"],y=health_df[\"Value\"],showfliers=False)\ncp.set_xticklabels(cp.get_xticklabels(),rotation=90,fontsize=18)\n#cp.set_yticklabels(cp.get_yticklabels(),fontsize=18)\ncp.set_xlabel(\"Race\/ Ethnicity\",fontsize=15)\ncp.set_ylabel('Value',fontsize=18)","49aea61a":"agg_func=dict(Count='count',Avg='mean',Median='median',Deviation='std',Min='min',Max='max')\nhealth_df.groupby(\"Race\/ Ethnicity\").agg({\n        'Value': agg_func,\n    }).sort_values(('Value', 'Count'))","8cb05016":"plt.figure(figsize=(30, 20))\nsns.boxplot(data=health_df,x=health_df[\"Race\/ Ethnicity\"],y=health_df[\"Value\"])","407c59b9":"plt.figure(figsize=(30, 20))\ncp=sns.boxplot(data=health_df,x=health_df[\"Race\/ Ethnicity\"],y=health_df[\"Value\"],showfliers=False)\ncp.set_xticklabels(cp.get_xticklabels(),rotation=90,fontsize=18)\n#cp.set_yticklabels(cp.get_yticklabels(),fontsize=18)\ncp.set_xlabel(\"Race\/ Ethnicity\",fontsize=15)\ncp.set_ylabel('Value',fontsize=18)","afd812c4":"agg_func=dict(Count='count',Avg='mean',Median='median',Deviation='std',Min='min',Max='max')\nhealth_df.groupby(\"Year\").agg({\n        'Value': agg_func,\n    }).sort_values(('Value', 'Count'))","21539adb":"len(health_procsd_df[health_procsd_df.Value==0])","315cf6a2":"health_df.head(10)","24283f4a":"pd.crosstab(health_df[\"State\"],health_df[\"Indicator Category\"], values=health_df.Value, aggfunc=['mean'],dropna=False,margins=True,margins_name=\"Total Mean\")","872d9976":"pd.crosstab(health_df[\"State\"],health_df[\"Indicator Category\"], values=health_df.Value, aggfunc='median',dropna=False,margins=True,margins_name=\"Total Mean\")","ad85e069":"pd.crosstab(health_df[\"Race\/ Ethnicity\"],health_df[\"Indicator Category\"], values=health_df.Value, aggfunc='mean',dropna=False,margins=True,margins_name=\"Total Mean\")","655f65ab":"pd.crosstab(health_df[\"Race\/ Ethnicity\"],health_df[\"Indicator Category\"], values=health_df.Value, aggfunc='median',dropna=False,margins=True,margins_name=\"Total Mean\")","4c30ef97":"table=pd.crosstab(health_df[\"Gender\"],health_df[\"Indicator Category\"], values=health_df.Value, aggfunc='mean',dropna=False,margins=True,margins_name=\"Total Mean\")\ntable","fc4fb3f7":"pd.crosstab(health_df[\"Gender\"],health_df[\"Indicator Category\"], values=health_df.Value, aggfunc='median',dropna=False,margins=True,margins_name=\"Total Mean\")\n","9470f02a":"health_df[health_df.duplicated()==True]","cd61101d":"lower_bnd = lambda x: x.quantile(0.25) - 1.5 * ( x.quantile(0.75) - x.quantile(0.25) )\nupper_bnd = lambda x: x.quantile(0.75) + 1.5 * ( x.quantile(0.75) - x.quantile(0.25) )\n","e1da6c3d":"health_df.shape","296216cc":"health_df_clean = health_df[(health_df[\"Value\"] >= lower_bnd(health_df[\"Value\"])) & (health_df[\"Value\"] <= upper_bnd(health_df[\"Value\"])) ] ","9f32f353":"health_df_clean.shape","148e731a":"print(health_df_clean.shape)\nhealth_df_clean_nona=health_df_clean[(health_df_clean['Value'].isna()==False) & (health_df_clean['Value']!=0)]\nhealth_df_clean_nona.shape","995d840a":"# one-hot encoding\n\none_hot=pd.get_dummies(health_df_clean_nona[cat_col])\nhealth_procsd_df=pd.concat([health_df_clean_nona[num_col],one_hot],axis=1)\nhealth_procsd_df.head(10)","0e03c0b2":"#using one hot encoding\nX=health_procsd_df.drop(columns=['Value'])\ny=health_procsd_df[['Value']]","7111347d":"train_X, test_X, train_y, test_y = train_test_split(X,y,test_size=0.3,random_state=1234)","bc2d86b5":"model = LinearRegression()\n\nmodel.fit(train_X,train_y)","d7963cf4":"# Print Model intercept and co-efficent\nprint(\"Model intercept\",model.intercept_,\"Model co-efficent\",model.coef_)\n","a80e99a9":"# Print various metrics\nfrom sklearn.metrics import mean_absolute_error, mean_squared_error,r2_score\n\nprint(\"Predicting the train data\")\ntrain_predict = model.predict(train_X)\nprint(\"Predicting the test data\")\ntest_predict = model.predict(test_X)\nprint(\"MAE\")\nprint(\"Train : \",mean_absolute_error(train_y,train_predict))\nprint(\"Test  : \",mean_absolute_error(test_y,test_predict))\nprint(\"====================================\")\nprint(\"MSE\")\nprint(\"Train : \",mean_squared_error(train_y,train_predict))\nprint(\"Test  : \",mean_squared_error(test_y,test_predict))\nprint(\"====================================\")\nimport numpy as np\nprint(\"RMSE\")\nprint(\"Train : \",np.sqrt(mean_squared_error(train_y,train_predict)))\nprint(\"Test  : \",np.sqrt(mean_squared_error(test_y,test_predict)))\nprint(\"====================================\")\nprint(\"R^2\")\nprint(\"Train : \",r2_score(train_y,train_predict))\nprint(\"Test  : \",r2_score(test_y,test_predict))\nprint(\"MAPE\")\nprint(\"Train : \",np.mean(np.abs((train_y - train_predict) \/ train_y)) * 100)\nprint(\"Test  : \",np.mean(np.abs((test_y - test_predict) \/ test_y)) * 100)","1f90733a":"#Plot actual vs predicted value\nplt.figure(figsize=(10,7))\nplt.title(\"Actual vs. predicted expenses\",fontsize=25)\nplt.xlabel(\"Actual Value\",fontsize=18)\nplt.ylabel(\"Predicted Value\", fontsize=18)\nplt.scatter(x=test_y,y=test_predict)","48338c4d":"chk_val=pd.DataFrame(pd.np.column_stack([test_y,test_predict]))\nchk_val[2]=(chk_val[0]-chk_val[1])\nchk_val","4f67fd55":"agg_func=dict(Count='count',Avg='mean',Median='median',Deviation='std',Min='min',Max='max')\nhealth_df.groupby([\"Indicator Category\",\"Race\/ Ethnicity\"]).agg({\n        'Value': agg_func,\n    }).sort_values(('Value', 'Count'))","bac4d02e":"from sklearn.neighbors import KNeighborsRegressor\nfrom sklearn.metrics import accuracy_score\nfrom math import sqrt","2b35490f":"X_train, X_test, y_train, y_test = train_test_split(\nX, y, test_size = 0.3, random_state = 100)\ny_train=np.ravel(y_train)\ny_test=np.ravel(y_test)","4d1aee34":"rmse_train_dict={}\nrmse_test_dict={}\ndf_len=round(sqrt(len(health_procsd_df)))\n#Train Model and Predict  \nfor k in range(3,df_len):\n    neigh = KNeighborsRegressor(n_neighbors = k+1).fit(X_train,y_train)\n    yhat_train = neigh.predict(X_train)\n    yhat = neigh.predict(X_test)\n    test_rmse=sqrt(mean_squared_error(y_test,yhat))\n    train_rmse=sqrt(mean_squared_error(y_train,yhat_train))\n    rmse_train_dict.update(({k:train_rmse}))\n    rmse_test_dict.update(({k:test_rmse}))\n    print(\"RMSE for train : \",train_rmse,\" test : \",test_rmse,\" difference between train and test :\",abs(train_rmse-test_rmse),\" with k =\",k)\n","ee5c54b5":"elbow_curve_train = pd.Series(rmse_train_dict,index=rmse_train_dict.keys())\nelbow_curve_test = pd.Series(rmse_test_dict,index=rmse_test_dict.keys())\nelbow_curve_train.head(10)","f67397aa":"ax=elbow_curve_train.plot(title=\"RMSE of train VS Value of K \")\nax.set_xlabel(\"K\")\nax.set_ylabel(\"RMSE of train\")","54ded49a":"ax=elbow_curve_test.plot(title=\"RMSE of test VS Value of K \")\nax.set_xlabel(\"K\")\nax.set_ylabel(\"RMSE of test\")","aa03e1e5":"**Above subplot was created inspired by Reference \"https:\/\/towardsdatascience.com\/how-to-perform-exploratory-data-analysis-with-seaborn-97e3413e841d\".\n\nObservation:\n\nFrom Dataset we draw subplot, we get to know distribution count of categorical variables \n\n1) with indicator category , we see following order\n\n    1) HIV\/AIDS\n    2) Injury & violence\n    3) Nutrition,Physical activity & obesity\n    4) Infectious Disease\n    5) Cancer\n    6) Maternal and child health\n    7) Behavioural health \/ abuse\n    8) Food safety\n    9) Life Expectancy\n    10) Demographics \n    11) Tobacco\n2) with Gender category, we see distribution is more on both, followed by female and male\n\n3) with Race category , we see distribution falls in below order\n\n    1) All\n    2) White\n    3) Black\n    4) Hispanic\n    5) Asian\n    6) Other\n    7) Native American\n    8) Multiracial\n    9) American indian\n    \n4) with respect to year category , we see more death in 2012 followed by 2013,2011,2010 & 2014    \n\n**","4609b572":"**We will try to implement knn for this Linear regression to see how accuracy calculated**","58c5ef5a":"we see more data in place category. From the data , We see that we can extract new feature state and see distribution for state variable","2ecf354d":"**Above graph shows that there is no relationship between gender and Indicator. however for some value like Cancer, we see more female prone to it than male. Sameway for maternal health it has only female value which is obvious here**","a9cf123c":"**Since outlier spoils visualization, we can show it filtering outliers using showfliers=False**","627bf1fd":"**Now we can compare value against two categorical variable. Crosstab gives good way to compare two categorical value with Target value. Various usage of crosstab was inspired by below link**\n\nhttps:\/\/pbpython.com\/pandas-crosstab.html","bd2ca841":"**From the above output we see RMSE value remains low for train and test with k=17**","ab3f6586":"**I Tried increase K value from 3 to 11 and found that k-value lower for K=5 . will try to validate same in elbow curve**","55a6a6ac":"**CA state has more death followed by TX,AZ,FL,NY....**","06eb6e71":"**Model is not predicting value correctly inspite of cleaned outlier (value=0 or nan). After removing nan or value=0 able to correct MAPE value which gives Infinity one. Need to futher pre-process data to achieve better result**","eb2ebea5":"**Clearly we see outliers there when we do comparison between mean and median values**"}}