{"cell_type":{"f3252465":"code","597eac32":"code","6955088a":"code","98025218":"code","346b8983":"code","92fbdb8b":"code","2e211871":"code","48c62c2a":"code","c10b4f09":"markdown","702ea32a":"markdown","3f14e9de":"markdown"},"source":{"f3252465":"!pip install google-cloud-bigquery -U\n!pip install pandas -U","597eac32":"import numpy as np\nimport pandas as pd\nimport os\nimport time\nimport zipfile\nfrom tqdm import tqdm\nfrom google.cloud import bigquery\nclient = bigquery.Client()","6955088a":"def query_to_csv(sql, output_path): \n    df = client.query(sql).to_dataframe(progress_bar_type='tqdm_notebook')\n    df.to_csv(output_path, mode='a', index=False, header=not os.path.exists(output_path), compression='gzip')\n    ","98025218":"transactions_sql= '''\nSELECT \n    t.hash,\n    to_address,\n    from_address,\n    value,\n    block_timestamp,\n    gas_price,\n    gas as gas_limit,\n    block_number,\n    receipt_gas_used as gas_used\nFROM \n    `bigquery-public-data.crypto_ethereum.transactions` t\nWHERE \n    block_timestamp BETWEEN '2021-01-01' AND '2021-01-15'\nORDER BY block_timestamp DESC\n'''\nquery_to_csv(transactions_sql, \"transactions.csv.gz\")\n\ntransactions_sql= '''\nSELECT \n    t.hash,\n    to_address,\n    from_address,\n    value,\n    block_timestamp,\n    gas_price,\n    gas as gas_limit,\n    block_number,\n    receipt_gas_used as gas_used\nFROM \n    `bigquery-public-data.crypto_ethereum.transactions` t\nWHERE \n    block_timestamp BETWEEN '2021-01-16' AND '2021-02-01'\nORDER BY block_timestamp DESC\n'''\nquery_to_csv(transactions_sql, \"transactions.csv.gz\")","346b8983":"token_transactions_sql='''\nSELECT \n    transaction_hash,\n    to_address,\n    from_address,\n    token_address,\n    value,\n    block_timestamp\nFROM \n    `bigquery-public-data.crypto_ethereum.token_transfers`\nWHERE \n    block_timestamp BETWEEN '2021-01-01' AND '2021-01-15'\nORDER BY block_timestamp DESC\n'''\nquery_to_csv(token_transactions_sql, \"token_transactions.csv.gz\")\n\ntoken_transactions_sql='''\nSELECT \n    transaction_hash,\n    to_address,\n    from_address,\n    token_address,\n    value,\n    block_timestamp\nFROM \n    `bigquery-public-data.crypto_ethereum.token_transfers`\nWHERE \n    block_timestamp BETWEEN '2021-01-16' AND '2021-02-01'\nORDER BY block_timestamp DESC\n'''\nquery_to_csv(token_transactions_sql, \"token_transactions.csv.gz\")","92fbdb8b":"blocks_sql='''\nSELECT \n    timestamp,\n    number,\n    miner,\n    difficulty,\n    gas_limit,\n    gas_used,\n    transaction_count,\n    size\nFROM `bigquery-public-data.crypto_ethereum.blocks` \nWHERE timestamp BETWEEN '2021-01-01' AND '2021-02-01'\n'''\nquery_to_csv(blocks_sql, \"blocks.csv.gz\")","2e211871":"tokens_sql = '''\nSELECT \n    address,\n    symbol,\n    name\nFROM `bigquery-public-data.crypto_ethereum.amended_tokens`\n'''\nquery_to_csv(tokens_sql, \"tokens.csv.gz\")","48c62c2a":"ls -l --block-size=MB","c10b4f09":"We update pandas & google-cloud-bigquery. \nIn order to make it work, you might need to enable `Internet` in the settings config. ","702ea32a":"We are using pagination to retrieve the data as fetching all the month at once reach the RAM limit","3f14e9de":"I uploaded a modified version of `tokens.csv` adding some missing tokens. You can find it under `ethereum-price-and-tokens` dataset\nNot all the tokens are in the bigquery dataset`ethereum-blockchain` because of the limitations of ethereum-etl. The code that populates big query dataset. [here for more info](https:\/\/ethereum-etl.readthedocs.io\/en\/latest\/limitations\/) "}}