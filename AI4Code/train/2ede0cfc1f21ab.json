{"cell_type":{"c0f56921":"code","920281d0":"code","38d9b894":"code","7187a50e":"code","95f7418a":"code","10bcd702":"code","9d8cb858":"code","377b4f42":"markdown","77a3e511":"markdown","8b668689":"markdown","2e46c479":"markdown","039311ae":"markdown","cdb03ec1":"markdown","4c3112e5":"markdown","87a7e704":"markdown"},"source":{"c0f56921":"import os\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns","920281d0":"sns.set()","38d9b894":"input_data_df = {}\n\nfor dirname, _, filenames in os.walk(\"\/kaggle\/input\"):\n    for filename in filenames:\n        base = os.path.splitext(filename)[0]\n        input_data_df[base] = pd.read_csv(os.path.join(dirname, filename))","7187a50e":"calendar_df = input_data_df[\"calendar\"].copy()\ncalendar_df.head(5)","95f7418a":"def get_snap_means(filter):\n    snap_days = calendar_df[filter][\"d\"].values\n    data_df = input_data_df[\"sales_train_validation\"].copy()\n    feats = [\"id\", \"item_id\", \"dept_id\", \"cat_id\", \"store_id\", \"state_id\"] + list(snap_days)\n    data_df = data_df.loc[:, feats]\n    data_df.dropna(how=\"all\", axis=1, inplace=True)\n\n    snap_days_in_data = []\n    for c in data_df.columns:\n        if c.startswith(\"d_\"):\n            snap_days_in_data.append(c)\n\n    agg_dicts = {}\n    for d in snap_days_in_data:\n        agg_dicts[d] = np.sum\n\n    snap_means_df = data_df.groupby([\"cat_id\", \"state_id\"]).agg(agg_dicts)\n    snap_means_df = pd.DataFrame(snap_means_df.T.mean())\n    \n    return snap_means_df\n\nsnap_means_df = get_snap_means(calendar_df[\"snap_TX\"] == 0).drop([0], axis=1)\nfor category in [\"CA\", \"TX\", \"WI\"]:\n    for w in [0, 1]:\n        snap_means_df = pd.merge(snap_means_df, get_snap_means(calendar_df[\"snap_{}\".format(category)] == w), left_index=True, right_index=True, how=\"left\")\n        snap_means_df.rename(columns={0: \"{}\/ snap_{}\".format(\"w\" if w else \"wo\", category)}, inplace=True)","10bcd702":"snap_means_df","9d8cb858":"fig = plt.figure(figsize=(12.0, 12.0))\n\nfor i, category in enumerate([\"FOODS\", \"HOBBIES\", \"HOUSEHOLD\"]):\n    for j, state in enumerate([\"CA\", \"TX\", \"WI\"]):\n        ax = fig.add_subplot(33*10 + i * 3 + j + 1)\n        index = np.arange(3)\n        bar_width = 0.35\n        labels = snap_means_df.loc[category].index\n        ax.bar(index, snap_means_df.loc[category][\"wo\/ snap_{}\".format(state)], bar_width,\n               color=\"b\", label=\"wo\/ snap_{}\".format(state))\n        ax.bar(index + bar_width, snap_means_df.loc[category][\"w\/ snap_{}\".format(state)], bar_width,\n               color=\"r\", label=\"w\/ snap_{}\".format(state))\n        ax.set_title(\"Number of {} (snap_{})\".format(category, state))\n        ax.set_xlabel(\"state_id\")\n        ax.set_ylabel(\"Average Number of Items\")\n        ax.set_xticks(index + bar_width \/ 2)\n        ax.set_xticklabels(labels)\n        ax.legend()\n\nfig.tight_layout()","377b4f42":"As we expected first, sales are increased by SNAP.  \nAnd we noticed the interesting features from this plot.\n\n* SNAP increases sales not only \"FOODS\", but also \"HOBBIES\" and \"HOUSEHOLD\".\n* If SNAP is held on other state, sales tend to be increased.\n   * But this comes from the fact that date of SNAP is almost overlapped described [here](https:\/\/www.kaggle.com\/c\/m5-forecasting-accuracy\/discussion\/133614#764158).","77a3e511":"# Relation between sales and evnet\/SNAP (EDA calendar.csv)\n\ncalendar.csv has event\/SNAP information for each day.  \nSNAP is a Supplemental Nutrition Assistance Program which is already discussed [here](https:\/\/www.kaggle.com\/c\/m5-forecasting-accuracy\/discussion\/133614)\n\nIntuitively, sales relates to a day which is held a specific event or SNAP.  \nThis notebook shows the investigation result of this assumption.\n\n\n## Import Packages","8b668689":"## Sold Items against Event\n\nThis is now in progress...","2e46c479":"## Plot\n\nLet's plot them.","039311ae":"## Load data","cdb03ec1":"## Sales against SNAP\n\nsales_train_validation.csv includes number of sales for each day.  \nSo, we can investigate the sales effect of SNAP with using calendar.csv and sales_train_validation.csv.","4c3112e5":"At first glance, we can conifirm that SNAP increases the sale...","87a7e704":"calendar.csv includes following event related features.\n\n* `event_name_1`: Event name\n* `event_type_1`: Event type\n* `event_name_2`: Event name\n* `event_type_2`: Event type\n* `snap_CA`: SNAP in CA (If SNAP is conducted on CA, this value becomes 1)\n* `snap_TX`: SNAP in TX (If SNAP is conducted on TX, this value becomes 1)\n* `snap_WI`: SNAP in WI (If SNAP is conducted on WI, this value becomes 1)"}}