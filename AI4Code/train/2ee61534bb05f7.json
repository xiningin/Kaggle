{"cell_type":{"440df43e":"code","1b9858be":"code","d16b0089":"code","68336b95":"code","1873e3c4":"code","1318c0ff":"code","4b1d258b":"code","5888c0f2":"code","5e24f144":"code","cedc8b93":"code","66950540":"code","af10d502":"code","3cf923af":"code","4abc242d":"code","2b1aeaaa":"code","a1a74911":"markdown","0af62497":"markdown","5370e9ed":"markdown","a0f4da25":"markdown","7cbc8a2c":"markdown"},"source":{"440df43e":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport pandas as pd\nimport datetime as dt\nfrom sklearn.metrics import mean_squared_error\nfrom math import sqrt\nfrom mpl_toolkits.basemap import Basemap\n\n# Import BOKEH libraries \nfrom bokeh.plotting import figure, output_file, show, ColumnDataSource\nfrom bokeh.models import HoverTool\nfrom bokeh.layouts import gridplot\nfrom bokeh.io import output_notebook\noutput_notebook()\n\n# Import PLOTLY libraries \nfrom plotly.offline import init_notebook_mode, iplot\nimport plotly.graph_objs as go\ninit_notebook_mode(connected=True)\nimport plotly.offline as offline\noffline.init_notebook_mode()\nfrom plotly import tools\nimport plotly.tools as tls","1b9858be":"calls = pd.read_csv('..\/input\/police-department-calls-for-service.csv')\nprint (\"Calls Dataset: Rows, Columns: \", calls.shape)\n\nnotice = pd.read_csv('..\/input\/change-notice-police-department-incidents.csv')\nprint (\"Notice Dataset: Rows, Columns: \", notice.shape)","d16b0089":"calls.head()","68336b95":"# creating additional columns for splitting the date time\n\ncalls['call_date'] = pd.to_datetime(calls['Call Date Time'])\ncalls['call_year'] = calls['call_date'].dt.year\ncalls['call_month'] = calls['call_date'].dt.month\ncalls['call_monthday'] = calls['call_date'].dt.day\ncalls['call_weekday'] = calls['call_date'].dt.weekday\n\n#dropping the unwanted columns \ncalls = calls.drop(['Call Date', 'Call Date Time'], axis=1)\ncalls.head()","1873e3c4":"from wordcloud import WordCloud, STOPWORDS\n\n# mask = np.array(Image.open('..\/input\/word-cloud-masks\/gun.png'))\ntxt = \" \".join(calls['Original Crime Type Name'].dropna())\nwc = WordCloud(max_words=1200, stopwords=STOPWORDS, colormap='copper', background_color='White').generate(txt)\nplt.figure(figsize=(18,10))\nplt.imshow(wc)\nplt.axis('off')\nplt.title('');","1318c0ff":"df1 = calls\nx = df1['call_month']\nhist, edges = np.histogram(x, bins=12)\n\np1 = figure(title=\"Histogram of monthly calls\",tools=\"save\",\n            background_fill_color=\"#E8DDCB\")\np1.quad(top=hist, bottom=0, left=edges[:-1], right=edges[1:],\n        fill_color=\"#036564\", line_color=\"#033649\")\np1.legend.location = \"center_right\"\np1.legend.background_fill_color = \"darkgrey\"\np1.xaxis.axis_label = 'Months'\np1.yaxis.axis_label = 'Frequency'\n\n\n\nx = df1['call_monthday']\nhist, edges = np.histogram(x, bins=31)\n\np2 = figure(title=\"Histogram of month_Day calls\",tools=\"save\",\n            background_fill_color=\"#E8DDCB\")\np2.quad(top=hist, bottom=0, left=edges[:-1], right=edges[1:],\n        fill_color=\"#036564\", line_color=\"#033649\")\np2.legend.location = \"center_right\"\np2.legend.background_fill_color = \"darkgrey\"\np2.xaxis.axis_label = 'Month_Day'\np2.yaxis.axis_label = 'Frequency'\n\n\n\n\nx = df1['call_weekday']\nhist, edges = np.histogram(x, bins=7)\np3 = figure(title=\"Histogram of Week_day calls\",tools=\"save\",\n            background_fill_color=\"#E8DDCB\")\np3.quad(top=hist, bottom=0, left=edges[:-1], right=edges[1:],\n        fill_color=\"#036564\", line_color=\"#033649\")\np3.legend.location = \"center_right\"\np3.legend.background_fill_color = \"darkgrey\"\np3.xaxis.axis_label = 'Week_Day'\np3.yaxis.axis_label = 'Frequency'\n\noutput_file('histogram.html', title=\" \")\n\nshow(gridplot(p1,p2,p3, ncols=3, plot_width=400, plot_height=400, toolbar_location=None))","4b1d258b":"grp_1 = pd.DataFrame(calls.groupby([ 'Call Time']).count()).reset_index() \ntempdf = grp_1\ntrace1 = go.Bar(\n    x=tempdf['Call Time'],\n    y=tempdf['Crime Id'],\n    name='Location Types',\n    orientation = 'v',\n    marker=dict(color='red'),\n    opacity=0.7\n)\n\ndata = [trace1]\nlayout = go.Layout(\n    height=400,\n    margin=dict(b=150),\n    barmode='group',\n    legend=dict(dict(x=-.1, y=1.2)),\n    title = 'Number of Phone Calls in different hours of the day',\n)\n\nfig = go.Figure(data=data, layout=layout)\niplot(fig, filename='grouped-bar')","5888c0f2":"notice.head()","5e24f144":"# creating additional columns for splitting the date time\n\nnotice['Date'] = pd.to_datetime(notice['Date'])\nnotice['Year'] = notice['Date'].dt.year\nnotice['Month'] = notice['Date'].dt.month\nnotice['Monthday'] = notice['Date'].dt.day\nnotice['Day_of_Week'] = notice['Date'].dt.weekday\nnotice.head()","cedc8b93":"grp_0 = pd.DataFrame(notice.groupby([ 'PdDistrict']).count()).reset_index() \ngrp_0.head(n=10)","66950540":"df_test = notice\ndf = df_test.loc[df_test['PdDistrict'] == 'TENDERLOIN']\n# X = df[\"X\"].mean()\n# Y = df[\"Y\"].mean()\nprint (\"X: \", df[\"X\"].mean())\nprint (\"Y: \", df[\"Y\"].mean())","af10d502":"d = {'District': ['BAYVIEW', 'CENTRAL', 'INGLESIDE', 'MISSION', 'NORTHERN',\n                 'PARK', 'RICHMOND','SOUTHERN', 'TARAVAL', 'TENDERLOIN'], \n     'count': [221000, 226255, 194180, 300076, 272713,125479, 116818, 399785, 166971, 191746],\n     'X': [-122.39348575465807,-122.40955408209737, -122.42880918975492,-122.41947208237181, \n           -122.42651941834849,-122.44538250133472, -122.47073603937096,-122.40514832144576,\n           -122.4775493762299, -122.4121701007921\n          ],\n     'Y': [37.741045584280045, 37.79784019858191, 37.728485850396815, 37.76035586908415,\n           37.79219117621023, 37.77198029829212, 37.7867277022189, 37.78283485237802,\n           37.73971978721108, 37.7930189259414\n          ],\n    'pos': [(-122.39348575465807,37.741045584280045),(-122.40955408209737,37.79784019858191),\n           ( -122.42880918975492,37.728485850396815),(-122.41947208237181,37.76035586908415),\n           (-122.42651941834849,37.79219117621023),(-122.44538250133472,37.77198029829212),\n           (-122.47073603937096,37.7867277022189),(-122.40514832144576,37.78283485237802),\n           (-122.4775493762299,37.73971978721108),(-122.4121701007921,37.7930189259414)]}\narea = pd.DataFrame(data=d)\narea","3cf923af":"# Basemap Documentation: https:\/\/matplotlib.org\/basemap\/api\/basemap_api.html\n    \n#  Source Code: https:\/\/github.com\/jamalmoir\/notebook_playground\/blob\/master\/uk_2015_houseprice.ipynb\n\nimport matplotlib.pyplot as plt\nfrom mpl_toolkits.basemap import Basemap\n\nfig, ax = plt.subplots(figsize=(10,20))\n\nm = Basemap(resolution='l', # c, l, i, h, f or None\n            projection='aeqd',\n            lat_0=37.75, lon_0=-122.42,\n            llcrnrlon=-122.50, llcrnrlat= 37.67, urcrnrlon= -122.30, urcrnrlat=37.90)  \n\nm.drawmapboundary(fill_color='#46bcec')\nm.fillcontinents(color='#f2f2f2',lake_color='#46bcec')\nm.drawcoastlines()\n    \ndef plot_area(pos):\n    count = area.loc[area.pos == pos]['count']\n    x, y = m(pos[0], pos[1])\n    size = (count\/1000000) ** 2 + 3\n    m.plot(x, y, 'o', markersize=size, color='#444444', alpha=0.8)\n    \narea['pos'].apply(plot_area)\n\nm","4abc242d":"grp_2 = pd.DataFrame(notice.groupby([ 'Category']).count()).reset_index() \ntempdf = grp_2.sort_values('IncidntNum', ascending = False)\ntrace1 = go.Bar(\n    x=tempdf['Category'],\n    y=tempdf['IncidntNum'],\n    name='Location Types',\n    orientation = 'v',\n    marker=dict(        \n        color=tempdf.IncidntNum,\n        colorscale = 'Jet',\n        reversescale = True),\n    opacity=0.7\n)\n\ndata = [trace1]\nlayout = go.Layout(\n    height=400,\n    margin=dict(b=150),\n    barmode='group',\n    legend=dict(dict(x=-.1, y=1.2)),\n    title = 'Number of Crimes in California 2002 - 2018 (till July)',\n)\n\nfig = go.Figure(data=data, layout=layout)\niplot(fig, filename='grouped-bar')","2b1aeaaa":"df2 = notice\nx = df2['Month']\nhist, edges = np.histogram(x, bins=12)\n\np1 = figure(title=\"Histogram of MOnthly Incidents\",tools=\"save\",\n            background_fill_color=\"#E8DDCB\")\np1.quad(top=hist, bottom=0, left=edges[:-1], right=edges[1:],\n        fill_color=\"#036564\", line_color=\"#033649\")\np1.legend.location = \"center_right\"\np1.legend.background_fill_color = \"darkgrey\"\np1.xaxis.axis_label = 'Months'\np1.yaxis.axis_label = 'Frequency'\n\n\nx = df2['Monthday']\nhist, edges = np.histogram(x, bins=31)\n\np2 = figure(title=\"Histogram of Month_Date Incidents\",tools=\"save\",\n            background_fill_color=\"#E8DDCB\")\np2.quad(top=hist, bottom=0, left=edges[:-1], right=edges[1:],\n        fill_color=\"#036564\", line_color=\"#033649\")\np2.legend.location = \"center_right\"\np2.legend.background_fill_color = \"darkgrey\"\np2.xaxis.axis_label = 'Month_Day'\np2.yaxis.axis_label = 'Frequency'\n\n\nx = df2['Day_of_Week']\nhist, edges = np.histogram(x, bins=19)\np3 = figure(title=\"Histogram of WeekDay Incidents\",tools=\"save\",\n            background_fill_color=\"#E8DDCB\")\np3.quad(top=hist, bottom=0, left=edges[:-1], right=edges[1:],\n        fill_color=\"#036564\", line_color=\"#033649\")\np3.legend.location = \"center_right\"\np3.legend.background_fill_color = \"darkgrey\"\np3.xaxis.axis_label = 'Week_Day'\np3.yaxis.axis_label = 'Frequency'\n\n\nx = df2['Year']\nhist, edges = np.histogram(x, bins=16)\np4 = figure(title=\"Histogram of Yearly Incidents\",tools=\"save\",\n            background_fill_color=\"#E8DDCB\")\np4.quad(top=hist, bottom=0, left=edges[:-1], right=edges[1:],\n        fill_color=\"#036564\", line_color=\"#033649\")\n            \np4.legend.location = \"center_right\"\np4.legend.background_fill_color = \"darkgrey\"\np4.xaxis.axis_label = 'Years'\np4.yaxis.axis_label = 'Frequency'\n\nshow(gridplot(p1,p2,p3,p4, ncols=2, plot_width=400, plot_height=400, toolbar_location=None))","a1a74911":"Lets draw a Word Cloud , to understand the maximum occurance of the Crime type:\n\n**Crime type Word Cloud**","0af62497":"We can see that there is an unprecedented spike in calls between 16:00 to 19:00 hours of the day. Which is almost 20% more than the average number of calls per day.\n","5370e9ed":"We can see that most of the incidents are reported during Summer. There is **no significant pattern** in Day of the Month and\/or Weekday reports.\n\nLets look at the Number of Phone Calls in Different hours of the day..\n","a0f4da25":"Lets plot the DIfferent categories of Crime recorded in SF, California","7cbc8a2c":"We can see that most common crime is Theft, followed by \"Other Offenses\" in which major Traffic violations are recorded and Non-Criminal offenses.\nInterestingly 'Assault', 'Drugs', 'Vandalism' and 'Vehicle Theft' is also pretty comon offenses in this state.\n\n"}}