{"cell_type":{"f6b30b74":"code","4b60ffc4":"code","4a0bde69":"code","15d2eb62":"code","1e10b331":"code","e2d01388":"code","9c8e4025":"code","c6ff5dad":"code","757b0918":"code","7c19338f":"code","4c301620":"code","ccc116dc":"code","f0f2ca5e":"code","3466fa71":"code","f38be59a":"code","6a028e3b":"code","43df19be":"code","e2764eeb":"code","b0ef39a5":"code","0259524c":"code","3e36edd7":"code","df019cca":"code","45d3e24c":"code","46d38128":"code","44ae6224":"code","3f01c861":"code","6f8d9755":"code","763425a0":"code","df1fad2f":"code","b615d2c8":"code","b479bb31":"code","f91dd9c7":"code","da4c3140":"code","51d311ec":"code","fac6cf7d":"code","b4c0c440":"code","224385c9":"code","e4a0881b":"code","d2579e82":"code","e36cec16":"code","cc89f42d":"code","dab87111":"code","f418e974":"code","0bbf85ef":"code","5022f983":"code","d2c3b84a":"markdown","62953837":"markdown","9bf339bd":"markdown","2756c042":"markdown","72c25b8e":"markdown","99d008bf":"markdown","1fd5931d":"markdown","dd89c816":"markdown","5e64e891":"markdown","fa58748c":"markdown","6a4264b7":"markdown","15b7b8a6":"markdown","57e08154":"markdown"},"source":{"f6b30b74":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport datetime as dt # for dates manipulation\nimport seaborn as sns # for cool graphics if needed\nimport warnings # to get rid of anoying warnings\nimport matplotlib.pyplot as plt\nimport string\nimport warnings\n\n# To make some predictions\nimport statsmodels.api as sm\nfrom statsmodels.tsa.holtwinters import ExponentialSmoothing # Winters-Holt method - Triple Exponential Smoothing\n\n#To ignore some warnings\nwarnings.filterwarnings (\"ignore\")\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","4b60ffc4":"df = pd.read_csv('\/kaggle\/input\/avocado-prices-2020\/avocado-updated-2020.csv')\ndf.head()","4a0bde69":"# Let's change the PLU codes by small, large, extra_large as we are talking about Hass varietal\n\ndf = df.rename(columns={'4046':'small_medium', '4225':'large', '4770':'extra_large'})\ndf.head()","15d2eb62":"df.info()","1e10b331":"# Let's create a datetime type\ndf['date_time'] = pd.to_datetime(df['date'], format='%Y-%m-%d')\n\n# and add some extra features\ndf['date_month'] = df['date_time'].dt.month\ndf['date_week'] = df['date_time'].dt.week\n\n# To avoid scientific notation\npd.options.display.float_format = '{:.2f}'.format\n\n#Checking\ndf.info()","e2d01388":"#To see how many unique names are there\ndf['geography'].nunique()","9c8e4025":"#To see the unique names\ndf['geography'].unique()","c6ff5dad":"#Let's work with sub-totals first\nthese=['West', 'Southeast', 'South Central', 'Plains', 'Northeast', 'Midsouth', 'Great Lakes', 'Grand Rapids']\ndf[df['geography'].isin(these)]['geography'].unique()","757b0918":"# Quick but complex EDA table here\ndf[df['geography'].isin(these)][['geography', 'type', 'date', 'date_month', 'date_week', 'average_price', 'total_volume', 'small_medium', 'large', 'extra_large']].groupby(['date', 'geography', 'type']).mean()","7c19338f":"# Filtering and creating a new dataframe\ndfg = df[df['geography'].isin(these)]\ndfg.head()","4c301620":"# Set the style\nsns.set_style('whitegrid')\n\n# Describe the average_price per month per geography and type:\nfor g in list(dfg['geography'].unique()):\n    # Prepare the canvas size\n    plt.figure(figsize=(12,8))\n    plt.title('average_price per month in {}'.format(g))\n    sns.boxplot(x='date_month', y='average_price', hue='type', data=dfg, palette='pastel')\n    plt.show()","ccc116dc":"# Describe the average_price per year per geography and type:\nfor g in list(dfg['geography'].unique()):\n    # Prepare the canvas size\n    plt.figure(figsize=(12,8))\n    plt.title('average_price per year in {}'.format(g))\n    sns.boxplot(x='year', y='average_price', hue='type', data=dfg, palette='pastel')\n    plt.show()","f0f2ca5e":"dfg = df[df['geography'].isin(these)]","3466fa71":"dfyg=dfg.groupby(['year','geography','type'])['geography','total_volume','small_medium','large','extra_large'].sum().reset_index()\ndfyg","f38be59a":"sns.factorplot(x='geography', y='small_medium', col='type', hue='year', data=dfyg, kind='bar', height=5, aspect=2).set_xticklabels(rotation=45)","6a028e3b":"sns.factorplot(x='geography', y='large', col='type', hue='year', data=dfyg, kind='bar', height=5, aspect=2).set_xticklabels(rotation=45)","43df19be":"sns.factorplot(x='geography', y='extra_large', col='type', hue='year', data=dfyg, kind='bar', height=5, aspect=2).set_xticklabels(rotation=45)","e2764eeb":"sns.factorplot(x='geography', y='total_volume', col='type', hue='year', data=dfyg, kind='bar', height=5, aspect=2).set_xticklabels(rotation=45)","b0ef39a5":"# Let's work now at city level\nthese=['Albany', 'Atlanta', 'Baltimore\/Washington', 'Boise', 'Boston','Buffalo\/Rochester', 'Charlotte', 'Chicago', 'Cincinnati\/Dayton', 'Columbus', 'Dallas\/Ft. Worth', 'Denver', 'Harrisburg\/Scranton','Hartford\/Springfield', 'Houston', 'Indianapolis', 'Jacksonville', 'Las Vegas', 'Los Angeles', 'Louisville', 'Miami\/Ft. Lauderdale','Nashville', 'New Orleans\/Mobile', 'New York', 'Northern New England', 'Orlando', 'Philadelphia','Phoenix\/Tucson', 'Pittsburgh', 'Portland','Raleigh\/Greensboro', 'Richmond\/Norfolk', 'Roanoke', 'Sacramento','San Diego', 'San Francisco', 'Seattle','Spokane', 'St. Louis', 'Syracuse','Tampa']\ndf[df['geography'].isin(these)]['geography'].unique()","0259524c":"dfc = df[df['geography'].isin(these)]\ndfc.head()","3e36edd7":"# Set the style\nsns.set_style('whitegrid')\n\n# Describe the average_price per month per geography\/city and type:\nfor g in list(dfc['geography'].unique()):\n    # Prepare the canvas size\n    plt.figure(figsize=(12,8))\n    plt.title('average_price per month in {}'.format(g))\n    sns.boxplot(x='date_month', y='average_price', hue='type', data=dfc, palette='pastel')\n    plt.show()","df019cca":"# Describe the average_price per year per geography\/city and type:\nfor g in list(dfc['geography'].unique()):\n    # Prepare the canvas size\n    plt.figure(figsize=(12,8))\n    plt.title('average_price per year in {}'.format(g))\n    sns.boxplot(x='year', y='average_price', hue='type', data=dfc, palette='pastel')\n    plt.show()","45d3e24c":"dfyc=dfc.groupby(['year','geography','type'])['geography','total_volume','small_medium','large','extra_large'].sum().reset_index()\ndfyc","46d38128":"sns.factorplot(x='geography', y='small_medium', col='type', hue='year', data=dfyc, kind='bar', height=5, aspect=2).set_xticklabels(rotation=90)","44ae6224":"sns.factorplot(x='geography', y='large', col='type', hue='year', data=dfyc, kind='bar', height=5, aspect=2).set_xticklabels(rotation=90)","3f01c861":"sns.factorplot(x='geography', y='extra_large', col='type', hue='year', data=dfyc, kind='bar', height=5, aspect=2).set_xticklabels(rotation=90)","6f8d9755":"# Let's try to do a fancy graphic here about 'median' weekly consumption per city across all observations\npd.pivot_table(dfc, index='geography', aggfunc='median', values=['small_medium', 'large', 'extra_large']).plot.bar(figsize=(20,8),title='median weekly consumption per city', stacked=True)","763425a0":"# Let's try to do another graphic here about consumption per city\npd.pivot_table(dfc, index=['geography', 'type'], values=['average_price'], columns='year', aggfunc=[np.mean])","df1fad2f":"pt = pd.pivot_table(dfc, index=['geography'], values=['average_price'], columns='year', aggfunc=[np.mean])\nprint(pt.columns.levels)\npt.nsmallest(5, ('mean', 'average_price', 2020)) # Top 5 smallest, by last year","b615d2c8":"pt.nlargest(5, ('mean', 'average_price', 2020)) # Top 5 largest, by last year","b479bb31":"plt.figure(figsize=(20,12))\nsns.heatmap(data=pt, annot=True, cmap=\"coolwarm\").set_xlabel('average_price')","f91dd9c7":"sns.clustermap(data=pt, annot=True, cmap=\"coolwarm\", col_cluster=False, figsize=(20,17))","da4c3140":"a = pd.pivot_table(dfc, index=['geography'], values=['average_price'], aggfunc=[np.mean])\na.nlargest(5, ('mean', 'average_price')) # Top 5 largest","51d311ec":"a.nsmallest(5, ('mean', 'average_price')) # Top 5 smallest","fac6cf7d":"# Let's repeat the graph but for states grouping\n\nptg = pd.pivot_table(dfg, index=['geography'], values=['average_price'], columns='year', aggfunc=[np.mean])\nptg\nplt.figure(figsize = (15,8))\nsns.heatmap(data=ptg, annot=True, cmap=\"coolwarm\").set_xlabel('average_price')","b4c0c440":"sns.clustermap(data=ptg, annot=True,  col_cluster=False, cmap=\"coolwarm\", figsize = (15,12))","224385c9":"a = pd.pivot_table(dfg, index=['geography'], values=['average_price'], aggfunc=[np.mean])\na.nlargest(3, ('mean', 'average_price')) # Top 3 largest","e4a0881b":"a.nsmallest(3, ('mean', 'average_price')) # Top 3 smallest","d2579e82":"# Filter the whole data just for Chicago\nchicago = df[df['geography']=='Chicago'][['date_time', 'average_price', 'type']]\nchicago['weekday'] = chicago['date_time'].dt.weekday","e36cec16":"# In order to work all days representing the week need to be sunday, i.e., weekday=6 (the other need to be shifted to closest sunday or dropped)\nchicago['weekday'].unique()","cc89f42d":"# We need to understand the data which hits weekday=0, i.e., monday and change it to its closest sunday date\n# This can be done using Series.resample('W').first() (.last() or .mean()) for each created series or use resample to month Series.resample('M').first() (.last() or .mean()) \nchicago[chicago['weekday'] == 0]","dab87111":"# Conventional type Series for Chicago\ncon_s = chicago[chicago['type']=='conventional'][['date_time', 'average_price']].set_index('date_time')\ncon_s.rename({'average_price': 'average_price_con'}, axis='columns', inplace=True)\ncon_s = con_s.resample('M').mean()\ncon_s.index.freq = 'M'\ncon_s.index.length = len(con_s.index)\n\n# Organic type Series for Chicago\norg_s = chicago[chicago['type']=='organic'][['date_time', 'average_price']].set_index('date_time')\norg_s.rename({'average_price': 'average_price_org'}, axis='columns', inplace=True)\norg_s = org_s.resample('M').mean()\norg_s.index.freq = 'M'\norg_s.index.length = len(org_s.index)","f418e974":"# Comparing predictions conventional - Chicago\nmodel_con = ExponentialSmoothing(con_s['average_price_con'],trend='add',seasonal='add',seasonal_periods=12).fit()\ncon_s['model_con'] = model_con.fittedvalues\ncon_s_forecast_predictions = model_con.forecast(48)\n\n# Comparative Plot\ncon_s.plot(title='Average price variation and predictions - Hass avocado - Conventional type - Chicago',figsize=(12,8)).autoscale(axis='x',tight=True)\ncon_s_forecast_predictions.plot(label='predictions_con', legend=True)\n\n# Comparing predictions organic - Chicago\nmodel_org = ExponentialSmoothing(org_s['average_price_org'],trend='add',seasonal='add',seasonal_periods=12).fit()\norg_s['model_org'] = model_org.fittedvalues\norg_s_forecast_predictions = model_org.forecast(48)\n\n# Comparative Plot\norg_s.plot(title='Average price variation and predictions - Hass avocado - Organic type - Chicago',figsize=(12,8)).autoscale(axis='x',tight=True)\norg_s_forecast_predictions.plot(label='predictions_org', legend=True)","0bbf85ef":"# Last but not least we will rearrange the series to reflec average prices variations of organic vs. conventional in Chicago across the years\napr = chicago[chicago['type']=='organic'][['date_time', 'average_price']].set_index('date_time')\/chicago[chicago['type']=='conventional'][['date_time', 'average_price']].set_index('date_time') # Average price ratio between organic and conventional\napr.rename({'average_price': 'average_price_ratio_org_vs_con'}, axis='columns', inplace=True)\napr = apr.resample('M').mean()\napr.index.freq = 'M'\napr.index.length = len(apr.index)","5022f983":"# Comparing predictions organic vs. conventional - Chicago\nmodel_apr = ExponentialSmoothing(apr['average_price_ratio_org_vs_con'],trend='add',seasonal='add',seasonal_periods=12).fit()\napr['model_apr'] = model_apr.fittedvalues\napr_forecast_predictions = model_apr.forecast(48)\n\n# Comparative Plot\napr.plot(title='Average price ratio and predictions - Hass avocado - Organic\/Conventional types - Chicago',figsize=(12,8)).autoscale(axis='x',tight=True)\napr_forecast_predictions.plot(label='predictions_apr', legend=True)","d2c3b84a":"<h3>\n<br>Regarding <b>extra-large<\/b> size consumption we can observe:<\/br>\n<li>It shows <b>conventional<\/b> type is the most sold accross all states by far<\/li>\n<li>Is more or less similar across the years in <b>West<\/b> states with a drop in year 2020<\/li>\n<li>Is decreasing across the years in <b>Midsouth<\/b> and <b>Great Lakes<\/b> states<\/li>\n<li><b>Grand Rapids<\/b> states are where are less consumed but this is increasing across the years<\/li>\n<li><b>South Central<\/b>, <b>Southeast<\/b> and <b>Northeast<\/b> states there are no clear trends but their seem decreasing there<\/li>\n<\/h3>","62953837":"**Across the years one might encounter the best prices for Avocados in 'South Central' ('Great Lakes' and 'West' follow) and the worst prices in 'Northeast' ('Grand Rapids' and 'Midsouth' follow)**","9bf339bd":"**Across the years one might encounter the best prices for avocados in 'Houston' ('Dallas\/Ft. Worth' and 'Phoenix\/Tucson' follow) and the worst prices in 'Hartford\/Springfield' ('San Franciso' and 'New York' follow)**","2756c042":"**This is a best way to compare prices between these two types across years. Now, it is more fair saying that by 2023 the prices of organic avocados - Hass varietal - while decreasing, will be in a range of aprox. 30% to 40% above conventional type prices in Chicago. So the trends give us the equalization of these prices to 1 beyond 2027+!. Sorry guys, no signal anytime soon of \"green\" consumption habits in Chicago for avocados until passed 2027!!!**","72c25b8e":"**Since the organic type does not sell well let's try to simplify the graph to get a glimpse of a heatmap of prices across years by city**","99d008bf":"<h3>\n<br>Regarding <b>large<\/b> size consumption we can observe:<\/br>\n<li>It shows <b>conventional<\/b> type is the most sold accross all states by far<\/li>\n<li>Is more or less similar across the years in <b>Northeast<\/b> and <b>Plains<b> states<\/li>\n<li>Is decreasing across the years in <b>West<\/b>, <b>South Central<\/b>, <b>Midsouth<\/b> and <b>Great Lakes<\/b> states<\/li>\n<li><b>Grand Rapids<\/b> states are where are less consumed<\/li>\n<\/h3>","1fd5931d":"**Another thing to consider is that it seems one of the reasons why organic type is not sold well is due to its comparatively high price, so now let's consider price trends and predictions for an interesting city like Chicago where large size organic type consumption is increasing, while its large size conventional type comsumption is decreasing (we will compare both predictions trends)**","dd89c816":"<center><a href='https:\/\/live.staticflickr.com\/65535\/51457618225_d65f31b370_b.jpg'><img src='https:\/\/live.staticflickr.com\/65535\/51457618225_d65f31b370_b.jpg'><\/a><\/center>\n<p style=\"text-align:right; font-size:150%\"><i><strong> \u201cSuper duper avocado\u201d <\/i>\u2013 Perla Jaimes<\/strong><\/p>\n\n<div style=\"display:fill;\n           border-radius:10px;\n           border-width:200%;\n           font-size:100%;\n           letter-spacing:0.5px;\n           background-color:Aquamarine;\n           color:White;\n           font-family:Helvetica;\n            opacity:0.8;\n           \">\n    <h2 style=\"text-align:left;font-weight: bold;color:black;\"><br>\n        About avocados... \n        <\/br>\n    <\/h2>\n<\/div>\n\n<center><a><img width=\"600\" height=\"400\" src='https:\/\/upload.wikimedia.org\/wikipedia\/commons\/thumb\/0\/07\/Hass_avocado_-white_background.jpg\/220px-Hass_avocado_-white_background.jpg'><\/a><\/center>\n<center><em><a style=\"color:blue;font-size:150%;font-weight:bold;\" href='https:\/\/en.wikipedia.org\/wiki\/Avocado'>Hass varietal<\/a><\/em><\/center>\n\n<h3>\n<br>There are several varietals or cultivars of avocados, one of the most popular is the <b>Hass varietal<\/b>, which was patented by the U.S. postman Rudolph Hass in 1935 (patents in the U.S. are valid for 20 years from its earliest filing date at most). It produces fruit year-round and accounts for 80% of cultivated avocados in the world!<\/br>\n<\/h3>\n_______\n<h3>\n<br>In the U.S. the Hass avocado is also classified according to their <b>Size<\/b> & <b>P<\/b>roduct <b>L<\/b>ook <b>U<\/b>p codes (PLU) as follows:<\/br>\n<li>Small\/Medium Hass Avocado (~3-5 oz avocado), its PLU is #4046<\/li>\n<li>Large Hass Avocado (~8-10 oz avocado), its PLU is #4225<\/li>\n<li>Extra Large Hass Avocado (~10-15 oz avocado), its PLU is #4770 <\/li>\n<br><\/br>\n<br>That is the reason behind these numeric column names in the dataframe, it is just another way to say: <b>small\/medium<\/b>, <b>large<\/b> and <b>extra-large<\/b> avocados of Hass varietal. For this reason we will rename the columns using plain text names.<\/br>\n<br><\/br>\n<br>If these avocados are produced using artificially created fertilizers, pesticides, soil enrichment or includes any kind of mechanization in the farming process we call them <b>conventional<\/b> type, on the contrary we call them <b>organic<\/b> type. As this refers as conventional or organic farming.<\/br>\n<\/h3>","5e64e891":"<h3>\n<br>It is clear that in the US the prices of organic avocados go up between Jun and Oct every year. However the year 2017 was when the prices were at a maximum for both types (organic and conventional).<\/br>\n<br><\/br>\n<br>The year 2017 was characterized by extreme weather disasters in the U.S., from hot temperatures causing severe droughts and wildfires in California and it also was a year where did not snow in Chicago during winter (the last time it happened was almost 150 years ago!). It was the last and possible the worst year in the period 2011-2017. That could be the reason behind such avocados prices increased that year everywhere in the U.S.<a href=\"https:\/\/www.climate.gov\/news-features\/blogs\/beyond-data\/2017-us-billion-dollar-weather-and-climate-disasters-historic-year\"> (source) <\/a><\/br>\n<\/h3>","fa58748c":"**According to predictions, it seems by 2023 the prices of conventional and organic avocados - Hass varietal - will be more or less similar in Chicago**","6a4264b7":"<h3>\n<br>Regarding <b>small_medium<\/b> size consumption we can observe:<\/br>\n<li>It shows <b>conventional<\/b> type is the most sold accross all states by far<\/li>\n<li>Is more or less similar across the years in <b>South Central<\/b>, <b>Southeast<\/b> and <b>Plains<b> states<\/li>\n<li>Is decreasing across the years in <b>West<\/b> states<\/li>\n<li>Is increasing across the years in <b>Midsouth<\/b>, <b>Great Lakes<\/b> and <b>Northeast<\/b><\/li>\n<li><b>Grand Rapids<\/b> states are where are less consumed<\/li>\n<\/h3>","15b7b8a6":"<h3>\n<br>Regarding overall consumption we can observe:<\/br>\n<li>It shows <b>conventional<\/b> type is the most sold accross all states by far<\/li>\n<li>Is more or less similar across the years in <b>Grand Rapid<\/b> states (seems stagnated there)<\/li>\n<li>It appears to be a steady increment in consumption across the years it altmost all but <b>Grand Rapids<\/b> states<\/li>\n<li><b>Grand Rapids<\/b> states are where are less consumed but this is increasing across the years<\/li>\n<li>In the case of organic type, even is the less sold it seems its consuption is gaining popularity in <b>Great Lakes<\/b>, <b>Midsouth\/<b>, <b>Northeast<\/b>, <b>South Central<\/b> and <b>West states<\/b><\/li>\n<br><\/br>    \n<br>It is clear that in the US the prices of organic avocados go up between Jun and Oct every year. However the year 2017 was when the prices were at a maximum for both types (organic and conventional).<\/br>\n<br><\/br>\n<br>The year 2017 was characterized by extreme weather disasters in the U.S., from hot temperatures causing severe droughts and wildfires in California and it also was a year where did not snow in Chicago during winter (the last time it happened was almost 150 years ago!). It was the last and possible the worst year in the period 2011-2017. That could be the reason behind such avocados prices increased that year everywhere in the U.S.<a href=\"https:\/\/www.climate.gov\/news-features\/blogs\/beyond-data\/2017-us-billion-dollar-weather-and-climate-disasters-historic-year\"> (source) <\/a><\/br>\n<\/h3>","57e08154":"<h3>\n<br>There are several conclusions, but the most relevant are:<\/br>\n<li>The shift in <b>small\/medium<\/b> and <b>large<\/b> sizes avocado's consumption in <b>Los Angeles<\/b> towards <b>extra-large<\/b> size across the years.<\/li>\n<li>The shift in <b>large<\/b> and <b>exra-large<\/b> sizes avocado's consumption in <b>Chicago<\/b> towards <b>small\/medium<\/b> size across the years.<\/li>\n<\/h3>"}}