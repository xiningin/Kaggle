{"cell_type":{"6ee81f6a":"code","e1307743":"code","c61fc7e4":"code","ed5a49c9":"code","51226017":"code","be59feb0":"code","c6fb163a":"code","e474d8b1":"code","b88d1957":"code","19a99b02":"code","eb773a96":"code","4f3ad9fa":"code","3c6ec4cb":"code","d00e3371":"code","e56bb1a3":"code","3c02cd4e":"code","eeeb519e":"code","17174b13":"code","316a11ed":"code","d9efe4b9":"code","3f6ede37":"code","335c6033":"code","a622f0ce":"code","c8b2700e":"code","eecc653f":"code","f5f7dc95":"code","e4408b39":"code","8c035ec0":"code","3538d06b":"code","947bc624":"code","5e998974":"code","f8dfe17b":"code","14a181c8":"code","8968c365":"code","5c5a1872":"code","8747293a":"code","c4fdec19":"code","7e75bdbd":"code","dd0bc78e":"code","c1fc72ad":"code","2d901203":"code","51c1324b":"code","3e5f4419":"code","c278ccee":"code","6ca47f86":"code","324f76a0":"code","385c7933":"code","f563e034":"code","9fa533c8":"code","fc440c99":"code","90b13fc2":"markdown","a6dea959":"markdown","b2b1f248":"markdown","453ca1a0":"markdown","21769124":"markdown","885bf292":"markdown","2cb6a666":"markdown","ec155f7a":"markdown","8a36a07c":"markdown","d30428f9":"markdown","13c6b746":"markdown","4f600565":"markdown","1ee4f2f7":"markdown","335d47f6":"markdown","788455b0":"markdown","7765b378":"markdown"},"source":{"6ee81f6a":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\npd.set_option('display.max_columns', 60)","e1307743":"dtype_dict= {'CCN': str,    \n             'Network': str, \n             'ZipCode': str}\n\ndfr=pd.read_csv(\"..\/input\/activity-two-blend-acs-data\/InterimDataset2.csv\", parse_dates=True, dtype=dtype_dict)\nprint(\"\\nThe DFR data frame has {0} rows or facilities and {1} variables or columns\\n\".format(dfr.shape[0], dfr.shape[1]))","c61fc7e4":"dfr[\"ChainOwner\"].describe()","ed5a49c9":"len(dfr[dfr['ChainOwner'].isnull()])  ","51226017":"chain_dict = {'DAVITA': 'DaVita',\n              'FRESENIUS MEDICAL CARE': 'FMC'}      \n\ndef get_owner(owner):\n    if owner is np.NaN:\n        return 'Independent'\n    elif owner in chain_dict.keys():\n        return chain_dict[owner]\n    else:\n        return \"Other Chains\"\n\ndfr[\"ChainOwner\"] = dfr[\"ChainOwner\"].apply(get_owner)      \ndfr['ChainOwner'].value_counts()","be59feb0":"dfr['ChainOwner'].value_counts().sort_index() # sort by index. This is the default. so we can omit .sort_index()","c6fb163a":"dfr['ChainOwner'].value_counts().sort_values() # sort by value","e474d8b1":"plt.figure(figsize=(10,6))\nplt.title(\"Numbere of Facilities by Chain Owner\")\ndfr['ChainOwner'].value_counts().plot(kind='bar')   # This is Pandas plot, not as fancy as Seaborn","b88d1957":"plt.figure(figsize=(10,6))\n# plt.ylabel(\"Number of Facilities\")     # did not work\nplt.xticks(rotation=-45)                                 # control the display of the categories\nsort_order = dfr['ChainOwner'].value_counts().index\nax = sns.countplot(x='ChainOwner', data=dfr, order=sort_order)   # This is Seaborn plot\nax.set(ylabel='Number of Facilities', xlabel=\"Dialysis Chain Owner\")","19a99b02":"dict2 = {\n(1,879): 'Short Term Hospitals',\n(2000,2299): 'Long Term Hospitals',\n(2300,2499): 'Hospital-Based Facilities',\n(2500,2899): 'Non-Hospital Facilities',\n(2900,2999): 'Non-Hospital Facilities (Special Purpose)',\n(3300,3399): 'Children\u2019s Hospitals',\n(3500,3699): 'Hospital Satellites Facilities',\n(3700,3799): 'Hospital-Based Facilities (Special Purpose)'\n       }\n\ndict = {\n(1,879): 'Hospitals',\n(2000,2299): 'Hospitals',\n(2300,2499): 'Hospital-Based Facilities',\n(2500,2899): 'Non-Hospital Facilities',\n(2900,2999): 'Non-Hospital Facilities',\n(3300,3399): 'Hospitals',\n(3500,3699): 'Hospital Satellites Facilities',\n(3700,3799): 'Hospital-Based Facilities'\n       }\n\ndef get_facility_type(ccn):\n    last_four = int(ccn[2:6])\n    fac_type = 'Unknown'\n    for key in dict: \n        lower_bound, upper_bound = key # unpacking the lower and upper bounds in the the range\n        if lower_bound <= last_four and last_four <= upper_bound:\n            fac_type = dict[key]\n            break\n        else: \n            next\n    return fac_type\n\ndfr[\"HospitalAffiliation\"] = dfr['CCN'].apply(get_facility_type)    # how elegant\ndfr[\"HospitalAffiliation\"].value_counts()","eb773a96":"dfr[dfr['HospitalAffiliation'].isnull()]","4f3ad9fa":"plt.figure(figsize=(10,6))\n# plt.ylabel(\"Number of Facilities\")     # did not work\nplt.xticks(rotation=-45)                                 # control the display of the categories\nsort_order = dfr['HospitalAffiliation'].value_counts().index\nax = sns.countplot(x='HospitalAffiliation', data=dfr, order=sort_order)   # This is Seaborn plot\nax.set(ylabel='Number of Facilities', xlabel=\"Hospital Affiliation\")","3c6ec4cb":"dfr[\"StateCode\"].describe()","d00e3371":"dfr['StateCode'].unique()","e56bb1a3":"column_dict ={'State Code':'StateCode'}  # change the column name to match with DFR dataset\nregion = pd.read_csv(\"..\/input\/rmudsc\/Census-Bureau-Regions.csv\")\nregion.rename(columns=column_dict, inplace=True)\nregion.info()","3c02cd4e":"region.head()","eeeb519e":"region.Region.value_counts()","17174b13":"plt.figure(figsize=(10,6))\nregion.Region.value_counts().plot(kind=\"bar\")","316a11ed":"set(dfr['StateCode'].unique()) - set(region['StateCode'].unique())","d9efe4b9":"dfr = pd.merge(dfr, region, on='StateCode', how='left')\ndfr.Region.unique()","3f6ede37":"dfr[dfr[\"Region\"].isnull()].sample(3)","335c6033":"dfr['Region'].fillna('Oversea', inplace=True)\ndfr.Region.unique()","a622f0ce":"dfr['Division'].unique()","c8b2700e":"# replace the null value with \"Oversea\" to represent the oversea territories\ndfr['Division'].fillna('Oversea', inplace=True)\ndfr.Division.unique()","eecc653f":"dtype_dict={'ZIPCODEN':str}\ncolumn_dict={'ZIPCODEN': 'ZipCode',\n            'RUCA30': 'RUCA'}\nrural=pd.read_csv(\"..\/input\/rmudsc\/URCA-310.csv\", dtype=dtype_dict, usecols=column_dict.keys())\nrural.rename(columns=column_dict, inplace=True)\nrural.info()","f5f7dc95":"dfr = pd.merge(dfr, rural, on='ZipCode', how='left')\ndfr.shape","e4408b39":"def get_urban(ruca):\n    if ruca < 4:      # 1.x, 2.x, and 3.x\n        return 'Metropolitan'\n    elif ruca < 7:    # 4.x, 5.x, and 6.x\n        return 'Micropolitan'   \n    elif ruca < 10:   # 7.x, 8.x, and 9.x\n        return \"Small Town\"\n    elif ruca < 11:   # 10.x\n        return \"Rural Area\"\n    else:             # NaN\n        return 'Unknown'\n# 1,2,and 3 are considered urban, 4 to 10 are considered rural.    \n\ndfr['Urbanicity'] = dfr['RUCA'].apply(get_urban)","8c035ec0":"#dfr[dfr['Urbanicity'] == 'Unknown']\ndfr['Urbanicity'].unique()","3538d06b":"dfr.Urbanicity.value_counts().plot(kind=\"bar\")","947bc624":"def get_urban(ruca):\n    if ruca < 4:      # 1.x, 2.x, and 3.x\n        return 'Urban'\n    elif ruca < 11:   # 4 to 10\n        return \"Rural\"\n    else:             # NaN\n        return 'Unknown'\n# 1,2,and 3 are considered urban, 4 to 10 are considered rural.    \n\ndfr['Urbanicity2'] = dfr['RUCA'].apply(get_urban)","5e998974":"dfr.Urbanicity2.value_counts().plot(kind=\"bar\")","f8dfe17b":"dfr['InitCertDate2'] =  pd.to_datetime(dfr['InitCertDate'], format='%d%b%Y')\ndfr[['InitCertDate', 'InitCertDate2']].sample(5)","14a181c8":"dec_31_2016 = pd.to_datetime('2016-12-31')\ndfr['YearsInOps'] =  ((dec_31_2016 - dfr['InitCertDate2'])\/np.timedelta64(1, 'Y'))\n#dfr['Months In Ops'] =  ((dec_31_2016 - dfr['Init. Cert. Date 2'])\/np.timedelta64(1, 'M'))\ndfr[dfr['YearsInOps'].isnull() == True]","8968c365":"#  Rreview all columns \ndfr.columns","5c5a1872":"# Drop the unused ones\ndrop_columns = [\"Unnamed: 0\", \n                \"RUCA\",\n                'InitCertDate',\n                'InitCertDate2']\n                \ndfr.drop(drop_columns, axis=1, inplace=True)  \ndfr.columns","8747293a":"# Review data elements from five random facilities \ndfr.sample(5)","c4fdec19":"# DialyzerReuse has missing values\n# Python built-in number NaN is Not-a-Numberrepresenting missing values)\ndfr['DialyzerReuse'].dtype","7e75bdbd":"dfr['DialyzerReuse'].describe()","dd0bc78e":"# Find out how many facilities do not reuse dialyzer\nlen(dfr[dfr['DialyzerReuse'].isnull()])  ","c1fc72ad":"# Convert the data from float to string\ndfr['DialyzerReuse'] = dfr['DialyzerReuse'].astype(str)\ndfr['DialyzerReuse'].describe()","2d901203":"def convert_dialyzer_reuse(dialyzer_reuse):\n    if dialyzer_reuse == '1.0':    \n        return 'Dialyzer Reuse'\n    else:             # NaN\n        return 'No Dialyzer Reuse'\ndfr['DialyzerReuse'] = dfr['DialyzerReuse'].apply(convert_dialyzer_reuse)\ndfr['DialyzerReuse'].describe()","51c1324b":"## EveningShift has missing values\n# Python built-in number NaN is Not-a-Numberrepresenting missing values)\ndfr['EveningShift'].describe()","3e5f4419":"# Find out how many facilities do not offer evening shift\nlen(dfr[dfr['EveningShift'].isnull()])  ","c278ccee":"# Convert the data from float to string\ndfr['EveningShift'] = dfr['EveningShift'].astype(str)\ndfr['EveningShift'].describe()","6ca47f86":"def convert_evening_shift(evening_shift):\n    if evening_shift == '1.0':    \n        return 'Evening Shift'\n    else:             # NaN\n        return 'No Evening Shift'\ndfr['EveningShift'] = dfr['EveningShift'].apply(convert_evening_shift)\ndfr['EveningShift'].describe()","324f76a0":"dfr['ComplianceStatus'].dtype","385c7933":"dfr['ComplianceStatus'] = dfr['ComplianceStatus'].astype(str)\ndfr['ComplianceStatus'].describe()","f563e034":"dfr['ComplianceStatus'].value_counts()","9fa533c8":"def convert_compliance(status):\n    if status == '0.0':     \n        return 'Compliant'\n    elif status == '1.0':   \n        return \"Not Compliant\"\n    elif status == '2.0':  \n        return \"Not Compliant\"\n    else:                          # NaN\n        return 'Unknown'\ndfr['ComplianceStatus'] = dfr['ComplianceStatus'].apply(convert_compliance)","fc440c99":"dfr.to_csv(\"DialysisCareQualityData.csv\")","90b13fc2":"Convert the compliance status from numeric to categorical.\nCompliance Status\n* 0 - met requirements,\n* 1 - did not meet requirements but had an acceptable plan of correction,\n* 2 - did not meet requirements \n* null - unknown","a6dea959":"The DFR dataset has more state codes. Find out the differences. It turns out the Census dataset only has 50 states and the District of Columbia. The DFR data set includes 50 states + DC + the five oversea territories: \n\n* AS = American Samoa \n* GU = Guan \n* MP = Northern Mariana Islands \n* PR = Perto Rico \n* VI = US Virgin Islands","b2b1f248":"#### Activity Six - Determine urbanicity","453ca1a0":"The count of chain owners 5794 is less than the totla count of facilities 6574. This indicates there are facilities with null value in chain owner. Let's find out how many facilities don't have a chain owner. These are considered independent facilities.","21769124":"#### Activity Three -  Determine chain ownership","885bf292":"#### Activity Four - Determine Hospital Affiliation\n\n### 2779J - ESRD CMS Certification Numbers\n(Rev. 29, Issued: 04-20-07; Effective\/Implementation Dates: 10-01-2007)\n\nIt is important for both reimbursement and survey purposes to assign the ESRD facility\nthe correct CCN in accordance with the guidelines contained in \u00a72779.A.1.\n\nESRD facilities and their CCN are as follows:\n* 0001-0879 Short Term (General and Specialty) Hospitals\n* 2000-2299 Long Term Hospitals\n* 2300-2499 Chronic Renal Disease Facilities (Hospital-Based)\n* 2500-2899 Non-Hospital Renal Disease Treatment Centers\n* 2900-2999 Independent Special Purpose Renal Disease Facilities\n* 3300-3399 Children\u2019s Hospitals\n* 3500-3699 Renal Disease Treatment Centers (Hospital Satellites)\n* 3700-3799 Hospital-Based Special Purpose Renal Dialysis Facilities\n\nSource: https:\/\/www.cms.gov\/Regulations-and-Guidance\/Guidance\/Manuals\/Downloads\/som107c02.pdf","2cb6a666":"Merge the two datasets based on state code.","ec155f7a":"#### Activity Eight - Final clean-up","8a36a07c":"DaVita has the most number of facilities 2,384 followed by FMC 2,285","d30428f9":"There are 56 state codes. 50 states, 1 District of Columbia, and 5 territories","13c6b746":"This is due to the fact that there are 780 independent facilities. Transform this column into the following four levels:\n* DaVita\n* FMC\n* Other Chains\n* Independent","4f600565":"#### Activity Seven - Determine years in operation","1ee4f2f7":"### Step Two - Blend Data\n#### Activity Three - Determine chain ownership\n#### Activity Four - Determine hospital affiliation\n#### Activity Five - Determine geograohical region & division\n#### Activity Six - Determine urbanicity\n#### Activity Seven - Determine years in operation\n#### Activity Eight - Final Clean-up\n\nData sources:\n\n* Dialysis Facility Report 2018\n* CMS Manual - Facility Type Based on CCN Range Table\n* US Census State Region Division Table\n* Rural Urban Area Code","335d47f6":"#### Activity Five - Determine geograohical region & division","788455b0":"51 state codes. 50 states, 1 District ofColumbia. It does not include the 5 territories","7765b378":"THE END of Activity Three to Seven."}}