{"cell_type":{"a8c24b77":"code","58e4a682":"code","e09f8b2b":"code","eca95ab2":"code","d1a3a49c":"code","2e490656":"code","52ed3c0e":"code","9c4f0533":"code","7ffb1e64":"code","50c86747":"code","f982e706":"code","9e490e10":"code","7cfdc6bf":"code","7e0d48dd":"code","39615933":"code","4033f356":"code","1a72c43a":"code","41396808":"code","72fd09fa":"code","c6fd1eb0":"markdown","62f6bba6":"markdown","bd8966b7":"markdown","7053ff38":"markdown","d9daf6ff":"markdown","fc37611c":"markdown","a75dfca8":"markdown","846863bb":"markdown","cc81c9e5":"markdown","40f56251":"markdown","ad0eba0f":"markdown","f7351403":"markdown"},"source":{"a8c24b77":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nplt.rcParams['figure.figsize'] = (16, 9)","58e4a682":"# load data\ndf = pd.read_csv('..\/input\/human-resources-data-set\/HRDataset_v13.csv')","e09f8b2b":"df.dropna(how='all',inplace=True)\ndf.head()","eca95ab2":"# Missing Values\nmissings = df.isnull().sum()\nprint(missings[missings>0])","d1a3a49c":"# Missing values\ndf['DaysLateLast30'] = df['DaysLateLast30'].fillna(-1)\n# Conversion to datatime\ndf['DateofHire'] = pd.to_datetime(df['DateofHire'], dayfirst = False)\ndf['DOB'] = pd.to_datetime(df['DOB'], dayfirst = False)\ndf['DateofTermination'] = pd.to_datetime(df['DateofTermination'], dayfirst = False)\ndf['LastPerformanceReview_Date'] = pd.to_datetime(df['LastPerformanceReview_Date'], dayfirst = False)\n \n#df['Last_Name'] = df['Employee_Name'].apply(lambda name: name.split(',')[0].strip())\n#df['first_Name'] = df['Employee_Name'].apply(lambda name: name.split(',')[1].strip() if (\",\" in name) else \"\")\n\n# Cleaning\ndf[\"Sex\"] = df[\"Sex\"].str.strip()\n# bining PayRate\nbins = [10,20,30,40,50,60,70,80,90]\nlabels = [10,20,30,40,50,60,70,80]\ndf[\"PayRateBin10\"] = pd.cut(df[\"PayRate\"], bins)","2e490656":"df['LastDayWorked'] = df['DateofTermination']\ndf['LastDayWorked'].fillna(df['LastPerformanceReview_Date'].max(),inplace=True)\ndf['NbrDayWorked'] = (df['LastDayWorked']-df['DateofHire'])\/\/np.timedelta64(1,'D')\ndel df['LastDayWorked']\nprint(df['NbrDayWorked'].max(),df['NbrDayWorked'].min())","52ed3c0e":"df[\"PayRateMedianPosition\"] = df.groupby(['Position'])[\"PayRate\"].transform('median')\ndf[\"PayRateEcart\"] = df[\"PayRate\"] - df[\"PayRateMedianPosition\"]","9c4f0533":"# Columns to keep by nature\nkeepColId = ['MarriedID', 'FromDiversityJobFairID','Termd']\nkeepColNum = ['NbrDayWorked','PayRateEcart', 'EngagementSurvey', 'EmpSatisfaction','SpecialProjectsCount']\nkeepColCat = ['Sex', 'MaritalDesc', 'CitizenDesc','Department', 'PerformanceScore']\n\n# Normalization\nfrom sklearn.preprocessing import StandardScaler\nscaler = StandardScaler()\nscaledData = scaler.fit_transform(df[keepColNum])\nscaledData=pd.DataFrame(scaledData,columns=keepColNum)\n\n# OneHotEncoding\ndata = pd.concat([scaledData,df[keepColId], pd.get_dummies(df[keepColCat]),df['EmploymentStatus']], axis=1)\n\n# Features\nX=data.loc[data['EmploymentStatus'].isin(['Active','Voluntarily Terminated'])].copy()\n# Target\ny=X['Termd']\n\nX.drop([\"Termd\",'EmploymentStatus'], axis=1, inplace=True)","7ffb1e64":"pd.crosstab(df['Termd'], df['EmploymentStatus'])","50c86747":"pd.crosstab(df['EmpStatusID'], df['EmploymentStatus'])","f982e706":"from sklearn import tree\nimport graphviz \n\nclf = tree.DecisionTreeClassifier()\nclf.fit(X, y)\n\ndot_data = tree.export_graphviz(clf, out_file=None, \n                     feature_names=X.columns,  \n                     filled=True, rounded=True,  \n                     special_characters=True)  \ngraph = graphviz.Source(dot_data)  \ngraph ","9e490e10":"columns = X.columns\nimportances = list(zip(clf.feature_importances_,columns))\nimportances.sort(reverse=True)\npd.DataFrame(importances, index=[x for (_,x) in importances]).plot(kind = 'bar');","7cfdc6bf":"scatter = plt.scatter(X[\"NbrDayWorked\"], X[\"SpecialProjectsCount\"],c=y)\nplt.xlabel(\"NbrDayWorked\")\nplt.ylabel(\"SpecialProjectsCount\")\nplt.legend(*scatter.legend_elements(),title=\"Classes\")\nplt.show()\n\nscatter = plt.scatter(X[\"PayRateEcart\"], X[\"MaritalDesc_Divorced\"],c=y)\nplt.xlabel(\"PayRateEcart\")\nplt.ylabel(\"MaritalDesc_Divorced\")\nplt.legend(*scatter.legend_elements(),title=\"Classes\")\nplt.show()","7e0d48dd":"pd.crosstab(X['Sex_F'], y)","39615933":"pd.crosstab(X['Department_Production       '], y)","4033f356":"scatter = plt.scatter(df[\"NbrDayWorked\"], df[\"PayRate\"],c=df['EmpStatusID'])\nplt.xlabel(\"NbrDayWorked\")\nplt.ylabel(\"PayRate\")\nplt.legend(handles=scatter.legend_elements()[0],labels=['Active','Future Start','Leave of Absence','Terminated for Cause','Voluntarily Terminated'])\nplt.show()","1a72c43a":"from sklearn.linear_model import LogisticRegression    \nfrom sklearn.metrics import f1_score\nfrom matplotlib.colors import ListedColormap, colorConverter, LinearSegmentedColormap\n\ndef visualize_coefficients(coefficients, feature_names, n_top_features=25):\n    coefficients = coefficients.squeeze()\n    if coefficients.ndim > 1:\n        # this is not a row or column vector\n        raise ValueError(\"coeffients must be 1d array or column vector, got\"\n                         \" shape {}\".format(coefficients.shape))\n    coefficients = coefficients.ravel()\n\n    if len(coefficients) != len(feature_names):\n        raise ValueError(\"Number of coefficients {} doesn't match number of\"\n                         \"feature names {}.\".format(len(coefficients),\n                                                    len(feature_names)))\n    # get coefficients with large absolute values\n    coef = coefficients.ravel()\n    positive_coefficients = np.argsort(coef)[-n_top_features:]\n    negative_coefficients = np.argsort(coef)[:n_top_features]\n    interesting_coefficients = np.hstack([negative_coefficients,\n                                          positive_coefficients])\n    # plot them\n    plt.figure(figsize=(20, 7))\n    cm = ListedColormap(['#0000aa', '#ff2020'])\n    colors = [cm(1) if c < 0 else cm(0)\n              for c in coef[interesting_coefficients]]\n    plt.bar(np.arange(2 * n_top_features), coef[interesting_coefficients],\n            color=colors)\n    feature_names = np.array(feature_names)\n    plt.subplots_adjust(bottom=0.3)\n    plt.xticks(np.arange(1, 1 + 2 * n_top_features),\n               feature_names[interesting_coefficients], rotation=60,\n               ha=\"right\")\n    plt.ylabel(\"Coefficient magnitude\")\n    plt.xlabel(\"Features\")","41396808":"logreg = LogisticRegression()\nlogreg.fit(X, y)\ny_predict = logreg.predict(X)\nprint(\"\\n LogisticRegression f1_score: {:.5f}\\n\".format(f1_score(y, y_predict, average='weighted')))","72fd09fa":"visualize_coefficients(logreg.coef_, X.columns,n_top_features=10)","c6fd1eb0":"## Data exploration with a logistic regression","62f6bba6":"## Preprocessing and feature engineering","bd8966b7":"**New column : Gap to median of the pay rate in the position group**","7053ff38":"<div class=\"alert alert-block alert-info\">\nVisually, the feature NbrDayWorked is really relevant,<br\/>\n<b>the longer the person stays in the company, the lower the probability of leaving<\/b>\n<\/div>","d9daf6ff":"## Normalization of the data\n","fc37611c":"<div class=\"alert alert-block alert-danger\">\nto be continued ...<br\/>\n<b>if you like my try, please upvote<\/b>\n<\/div>","a75dfca8":"<div class=\"alert alert-block alert-info\">\nThe features that have the most importances in the decision are :\n<\/div>\n\n","846863bb":"## Data description\nDescription of fields is available here : https:\/\/rpubs.com\/rhuebner\/HRCodebook-13\n\n* Employee Name : Employee\u2019s full name\n* EmpID : Employee ID is unique to each employee\n* MarriedID : Is the person married (1 or 0 for yes or no)\n* MaritalStatusID : Marital status code that matches the text field MaritalDesc\n* EmpStatusID : Employment status code that matches text field EmploymentStatus\n* DeptID : Department ID code that matches the department the employee works in\n* PerfScoreID : Performance Score code that matches the employee\u2019s most recent performance score\n* FromDiversityJobFairID : Was the employee sourced from the Diversity job fair? 1 or 0 for yes or no\n* PayRate : The person\u2019s hourly pay rate. All salaries are converted to hourly pay rate\n* Termd : Has this employee been terminated - 1 or 0\n* PositionID : An integer indicating the person\u2019s position\n* Position : The text name\/title of the position the person has\n* State : The state that the person lives in\n* Zip : The zip code for the employee\n* DOB : Date of Birth for the employee\n* Sex : Sex - M or F\n* MaritalDesc : The marital status of the person (divorced, single, widowed, separated, etc)\n* CitizenDesc : Label for whether the person is a Citizen or Eligible NonCitizen\n* HispanicLatino : Yes or No field for whether the employee is Hispanic\/Latino\n* RaceDesc : Description\/text of the race the person identifies with\n* DateofHire : Date the person was hired\n* DateofTermination : Date the person was terminated, only populated if, in fact, Termd = 1\n* TermReason : A text reason \/ description for why the person was terminated\n* EmploymentStatus : A description\/category of the person\u2019s employment status. Anyone currently working full time = Active\n* Department : Name of the department that the person works in\n* ManagerName : The name of the person\u2019s immediate manager\n* ManagerID : A unique identifier for each manager.\n* RecruitmentSource : The name of the recruitment source where the employee was recruited from\n* PerformanceScore : Performance Score text\/category (Fully Meets, Partially Meets, PIP, Exceeds)\n* EngagementSurvey : Results from the last engagement survey, managed by our external partner\n* EmpSatisfaction : A basic satisfaction score between 1 and 5, as reported on a recent employee satisfaction survey\n* SpecialProjectsCount : The number of special projects that the employee worked on during the last 6 months\n* LastPerformanceReviewDate : The most recent date of the person\u2019s last performance review.\n* DaysLateLast30 : The number of times that the employee was late to work during the last 30 days","cc81c9e5":"# Human Resources : who is going to quit ?\n\n> <div class=\"alert alert-block alert-info\">\nThe purpose of the notebook is to try to determine the factors that can alert a resignation.\n<\/div>\n\n\n","40f56251":"## Data exploration with a decision tree\n> <div class=\"alert alert-block alert-info\">\nThe purpose is to see the factors that have the most importance in a decision tree.<br\/>\nThe target decision is Terminated or Not Terminated\n<\/div>\n\nThe employment status are :\n* Active = 1\n* Future Start = 2\n* Leave of Absence = 3 \n* Terminated for Cause = 4\n* Voluntarily Terminated = 5 \n\nTermd column :\n* Termd = 0 means No Terminated, i.e. [Active,Future Start,Leave of Absence]\n* Termd = 1 means Terminated, i.e. [Terminated for Cause, Voluntarily Terminated]\n","ad0eba0f":"### let's see that with scatters plot\n\nTermd column :\n* Termd = 0 means No Terminated, i.e. [Active,Future Start,Leave of Absence]\n* Termd = 1 means Terminated, i.e. [Terminated for Cause, Voluntarily Terminated]","f7351403":"**New column : Number of days present in the company  **\n\n* if terminated (DateofTermination - DateofHire)\n* else (Today - DateofHire)\n\nWhat is today ? \n\nI've taken the last performance review date \n"}}