{"cell_type":{"34687e16":"code","09182185":"code","604d53e3":"code","8c5813d8":"code","7a1eb71b":"code","75d640f1":"code","c5e03ea2":"code","783ea99f":"code","e7a97ff6":"code","9f5e8b63":"code","e7dc8e06":"code","7b755527":"code","af3a6fde":"code","a3bcf3fa":"code","abe82d4d":"code","8ed79aac":"code","76ac1f7b":"code","184477df":"markdown"},"source":{"34687e16":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nfrom keras.models import Sequential\nfrom keras.utils import np_utils\nfrom keras.layers import Dense, Dropout,Activation,Conv2D,MaxPooling2D,Flatten\nfrom keras.optimizers import Adam\n\nfrom sklearn.model_selection import train_test_split\n\nimport os\nprint(os.listdir(\"..\/input\"))\n","09182185":"train = pd.read_csv('..\/input\/train.csv').values.astype('int32')\ntest = pd.read_csv('..\/input\/test.csv').values.astype('int32')","604d53e3":"x_train, x_test, y_train, y_test= train_test_split(train[:,1:],train[:,0],test_size=0.2)","8c5813d8":"x_train.shape,x_test.shape","7a1eb71b":"plt.imshow(x_train[0].reshape(28,28),cmap='Greys')","75d640f1":"x_train = x_train.reshape(-1,28,28,1)\nx_test = x_test.reshape(-1,28,28,1)","c5e03ea2":"scale = np.max(x_train)\nx_train = x_train.astype('float32') \/scale\nx_test = x_test.astype('float32') \/scale","783ea99f":"y_train = np_utils.to_categorical(y_train,10)\ny_test = np_utils.to_categorical(y_test,10)","e7a97ff6":"y_train.shape,y_test.shape","9f5e8b63":"model = Sequential()\nmodel.add(Conv2D(32,(3,3),padding='same',activation='relu',input_shape=(28,28,1)))\nmodel.add(MaxPooling2D(pool_size=(2,2)))\nmodel.add(Dropout(0.15))\n\nmodel.add(Conv2D(64,(3,3),padding='same',activation='relu'))\nmodel.add(MaxPooling2D(pool_size=(2,2)))\nmodel.add(Dropout(0.15))\n\nmodel.add(Flatten())\n\nmodel.add(Dense(200,activation='relu'))\nmodel.add(Dropout(0.15))\nmodel.add(Dense(400,activation='relu'))\nmodel.add(Dropout(0.30))\n\nmodel.add(Dense(10,activation='softmax'))","e7dc8e06":"model.compile(loss='categorical_crossentropy',optimizer=Adam(lr=1e-4),metrics=['accuracy'])","7b755527":"model.fit(x_train,y_train,epochs=10,batch_size=16,validation_split=0.1,verbose=2)","af3a6fde":"loss,accuracy = model.evaluate(x_test,y_test,verbose=0)\nprint('loss score:{0:.4f}, final score:{1:.4f}'.format(loss,accuracy))","a3bcf3fa":"pick = np.random.randint(1,8400,5)\nfor i in range(5):\n    plt.subplot(1,5,i+1)\n    plt.imshow(x_test[pick[i]].reshape(28,28),cmap='Greys')\n    plt.axis('off')","abe82d4d":"X_test = test.astype('float32')\nX_test = X_test.reshape(-1,28,28,1)\/255.\npredict = model.predict_classes(X_test)","8ed79aac":"model_json = model.to_json()\nopen('digit_recognizer_model_cnn.json','w').write(model_json)\nmodel.save_weights('digit_recognizer_weights_model_cnn.h5')","76ac1f7b":"def write_predict(predict,name):\n    pd.DataFrame({'ImageId':list(range(1,len(predict)+1)),'label':predict}).to_csv(name,index=False,header=True)\n    \nwrite_predict(predict,'keras_digit_recognizer_by_cnn.csv')","184477df":"### HI!! It is my first keras kernel\n### I happy to receive your comment and suggestion"}}