{"cell_type":{"df1a4d44":"code","2b315ff0":"code","5b5c4cfa":"code","db306884":"code","82dd5c09":"code","9613bc18":"code","03c282f1":"code","17d8e5e7":"code","8a5bd05b":"code","a88ef8ba":"code","f8ea1ea9":"code","59d7ef77":"code","8737306d":"code","87714725":"code","27347788":"code","5e236930":"code","38635258":"code","a3fd9815":"code","ca700daf":"code","1ac3297b":"code","663754e4":"code","52794687":"code","aaf90607":"code","32c15d8e":"code","96a9d0af":"code","780f763f":"code","caadb594":"code","28b9bc73":"code","9042e118":"code","366d748d":"code","48d83740":"code","aa92b2a7":"code","162bbf0d":"markdown","462b7a60":"markdown","17bf6484":"markdown","4bab8ee4":"markdown","f78d18cc":"markdown","3b62d341":"markdown","cc0f821f":"markdown","2af5e4ca":"markdown","00fceaaf":"markdown","de809c73":"markdown","fe3722c3":"markdown","2605d2b6":"markdown","fd605795":"markdown","8273af04":"markdown"},"source":{"df1a4d44":"import pandas as pd\nimport numpy as np\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set_style('whitegrid')\nplt.style.use(\"fivethirtyeight\")\n%matplotlib inline\n\nfrom datetime import datetime","2b315ff0":"from matplotlib import rc,rcParams\n\nrc('text', usetex=False)\nrc('axes', linewidth=2)\nrc('font', weight='bold')","5b5c4cfa":"import json\nimport pickle\nimport warnings\nwarnings.filterwarnings('ignore')","db306884":"file = '..\/input\/financial-services-nifty-index\/data.pkl'\nwith open(file, 'rb') as handle:\n    data_dict = pickle.load(handle)","82dd5c09":"data_dict.keys()","9613bc18":"stocks_under_cosideration = ['AXISBANK', 'BAJFINANCE', 'BAJAJHLDNG', 'CHOLAFIN', 'HDFCBANK', 'ICICIBANK','KOTAKBANK', 'SBIN']","03c282f1":"data_filtered = {}\nfor stocks in stocks_under_cosideration:\n    data_filtered[stocks] = data_dict[stocks]","17d8e5e7":"data_filtered.keys()","8a5bd05b":"data_filtered['AXISBANK']","a88ef8ba":"for key in data_filtered.keys():\n    data_filtered[key].reset_index(inplace = True, drop = True)\n    data_filtered[key]['co_stkdate'] = pd.to_datetime(data_filtered[key]['co_stkdate'],format='%d-%m-%Y')\n    data_filtered[key]['co_stkdate'] = data_filtered[key]['co_stkdate'].dt.strftime('%Y-%m-%d')\n    data_filtered[key]['daily_return'] = data_filtered[key]['nse_closing_price'].pct_change()\n    data_filtered[key].set_index('co_stkdate', inplace = True)","f8ea1ea9":"data_filtered['AXISBANK'] ","59d7ef77":"# summary stats\ndata_filtered['AXISBANK'].describe()","8737306d":"# closing price\n\nplt.figure(figsize=(24, 18))\n#plt.subplots_adjust(top=14, bottom=13) \nfor i, company in enumerate(data_filtered.keys(), 1):\n    plt.subplot(4, 2, i)\n    plt.tight_layout()\n    data_filtered[company]['nse_closing_price'].plot()\n    plt.ylabel('Closing price')\n    plt.xlabel(None)\n    plt.xticks(rotation = '45')\n    plt.title(f\"{company}\")\nplt.show()","87714725":"# volume traded\nplt.figure(figsize=(24, 18))\n#plt.subplots_adjust(top=14, bottom=13) \nfor i, company in enumerate(data_filtered.keys(), 1):\n    plt.subplot(4, 2, i)\n    plt.tight_layout()\n    data_filtered[company]['nse_traded_qty'].plot()\n    plt.ylabel('Volume of traded per day')\n    plt.xlabel(None)\n    plt.xticks(rotation = '45')\n    plt.title(f\"{company}\")\nplt.show()\nplt.close()","27347788":"# Moving Averages\nma_day = [10, 20, 50, 100, 150]\nfor ma in ma_day:\n    for company in data_filtered.keys():\n        column_name = f\"MA for {ma} days\"\n        data_filtered[company][column_name] = data_filtered[company]['nse_closing_price'].rolling(ma).mean()\n\nplt.figure(figsize=(24, 18))\n#plt.subplots_adjust(top=14, bottom=13) \nfor i, company in enumerate(data_filtered.keys(), 1):\n    plt.subplot(4, 2, i)\n    plt.tight_layout()\n    # data_filtered[company]['nse_closing_price'].plot()\n    data_filtered[company]['nse_closing_price'].plot(legend = 'nse_closing_price')\n    data_filtered[company][ 'MA for 100 days'].plot(legend = 'MA for 100 days')\n    data_filtered[company][ 'MA for 150 days'].plot(legend = 'MA for 150 days')\n    plt.ylabel('Closing price')\n    plt.xlabel(None)\n    plt.xticks(rotation = '45', fontsize = 'x-large')\n    plt.title(f\"{company}\")\n    plt.legend(loc = 'upper left', fontsize = 'large')\nplt.show()","5e236930":"plt.figure(figsize=(24, 18))\n#plt.subplots_adjust(top =14, bottom=13) \nfor i, company in enumerate(data_filtered.keys(), 1):\n    plt.subplot(4, 2, i)\n    plt.tight_layout()\n    data_filtered[company]['nse_closing_price'][200:1200].plot()\n    plt.ylabel('Closing price')\n    plt.xlabel(None)\n    plt.axvline(550, color = 'red')\n    plt.axvline(850, color = 'red')\n    plt.xticks(rotation = '45')\n    plt.title(f\"{company}\")\nplt.show()","38635258":"start_date = '2007-12-31'\nend_date = '2009-03-24'\ndf_crisis = pd.DataFrame(columns=['company_name', 'closing_price_start_date ' + start_date, 'closing_price_end_date ' + end_date, 'mean_daily_return'])\nfor i, company in enumerate(data_filtered.keys(), 0):\n    #df_crisis['company_name'].loc[i] = company\n    df_crisis.loc[i] = [company, data_filtered[company]['nse_closing_price'].loc[start_date],\n                        data_filtered[company]['nse_closing_price'].loc[end_date], \n                        data_filtered[company]['nse_returns'].loc[start_date:end_date].mean()]\ndf_crisis","a3fd9815":"start_date = '2009-03-24'\nend_date = '2011-03-24'\ndf_post_crisis = pd.DataFrame(columns=['company_name', 'closing_price_start_date ' + start_date, 'closing_price_end_date ' + end_date, 'mean_daily_return'])\nfor i, company in enumerate(data_filtered.keys(), 0):\n    df_post_crisis.loc[i] = [company, data_filtered[company]['nse_closing_price'].loc[start_date],\n                             data_filtered[company]['nse_closing_price'].loc[end_date],\n                             data_filtered[company]['nse_returns'].loc[start_date:end_date].mean()]\n\ndf_post_crisis","ca700daf":"start_date = '2005-12-30'\nend_date = '2007-12-31'\ndf_pre_crisis = pd.DataFrame(columns=['company_name', 'closing_price_start_date ' + start_date, 'closing_price_end_date ' + end_date, 'mean_daily_return'])\nfor i, company in enumerate(data_filtered.keys(), 0):\n    #df_crisis['company_name'].loc[i] = company\n    df_pre_crisis.loc[i] = [company, data_filtered[company]['nse_closing_price'].loc[start_date],\n                            data_filtered[company]['nse_closing_price'].loc[end_date],\n                            data_filtered[company]['nse_returns'].loc[start_date:end_date].mean()]\n    \ndf_pre_crisis","1ac3297b":"plt.plot(df_crisis['company_name'], df_crisis['mean_daily_return'], label = 'During Crisis')\nplt.title('Mean Daily Returns before, during and after the crisis')\nplt.xticks(rotation = '45')\nplt.plot(df_pre_crisis['company_name'], df_pre_crisis['mean_daily_return'], label = 'Pre Crisis')\nplt.plot(df_post_crisis['company_name'], df_post_crisis['mean_daily_return'], label = 'Post Crisis')\nplt.legend(loc = 'best')\nplt.axhline(y = 1, color = 'black', linewidth = 0.7)\nplt.ylabel('Mean Daily Return')\nplt.show()","663754e4":"df_close_price = pd.DataFrame(columns= data_filtered.keys())\n#print(list(df_pre_crisis['closing_price_start_date 2005-12-30']))\ndf_close_price.loc[0] = list(df_pre_crisis['closing_price_start_date 2005-12-30'])\ndf_close_price.loc[1] =  list(df_crisis['closing_price_start_date 2007-12-31'])\ndf_close_price.loc[2] =  list(df_post_crisis['closing_price_start_date 2009-03-24'])\ndf_close_price.loc[3] = list(df_post_crisis['closing_price_end_date 2011-03-24'])\ndf_close_price['Date'] = ['2005-12-30', '2007-12-31', '2009-03-24', '2011-03-24']\ndf_close_price['Date'] = pd.to_datetime(df_close_price['Date']).dt.strftime('%Y-%m-%d')\ndf_close_price.set_index(df_close_price['Date'], inplace = True)\ndf_close_price.drop(labels = 'Date', axis = 1, inplace = True)","52794687":"df_close_price","aaf90607":"df_close_price.plot()\nplt.title(\"Comparision of closing prices at different time intervals\")\nplt.show()","32c15d8e":"#fig, ax = plt.subplots(nrows=1, ncols=2)\n#ax[0].plot(data_filtered['AXISBANK']['nse_closing_price'].loc['2014-05-28':'2014-08-30'])\n\n#ax[1].plot(data_filtered['AXISBANK']['nse_traded_qty'].loc['2014-05-28':'2014-08-30'])\n#plt.show()\n\nplt.figure(figsize=(24, 6))\nplt.suptitle('AXISBANK Stock split July  2014', size = 24)\nplt.subplot(1,2,1)\nplt.tight_layout()\ndata_filtered['AXISBANK']['nse_closing_price'].loc['2014-05-28':'2014-08-30'].plot()\nplt.ylabel('Closing Price',  size = 18)\nplt.xlabel(None)\nplt.xticks(rotation = '45')\nplt.subplot(1,2,2)\nplt.tight_layout()\ndata_filtered['AXISBANK']['nse_traded_qty'].loc['2014-05-28':'2014-08-30'].plot()\nplt.ylabel('Quantity Traded',  size = 18)\nplt.xlabel(None)\nplt.xticks(rotation = '45')\nplt.show()","96a9d0af":"plt.figure(figsize=(24, 6))\nplt.suptitle('ICICIBANK Stock split December 2014', size = 24)\nplt.subplot(1,2,1)\nplt.tight_layout()\ndata_filtered['ICICIBANK']['nse_closing_price'].loc['2014-11-10':'2014-12-30'].plot()\nplt.ylabel('Closing Price',  size = 18)\nplt.xticks(rotation = '45')\nplt.xlabel(None)\n\nplt.subplot(1,2,2)\nplt.tight_layout()\ndata_filtered['ICICIBANK']['nse_traded_qty'].loc['2014-11-10':'2014-12-30'].plot()\nplt.ylabel('Quantity Traded',  size = 18)\nplt.xticks(rotation = '45')\nplt.xlabel(None)\nplt.show()","780f763f":"plt.figure(figsize=(24, 6))\nplt.suptitle('SBIN Stock split November 2014', size = 24)\nplt.subplot(1,2,1)\nplt.tight_layout()\ndata_filtered['SBIN']['nse_closing_price'].loc['2014-11-1':'2014-12-10'].plot()\nplt.ylabel('Closing Price', size = 18)\nplt.xticks(rotation = '45')\nplt.xlabel(None)\nplt.subplot(1,2,2)\nplt.tight_layout()\ndata_filtered['SBIN']['nse_traded_qty'].loc['2014-11-1':'2014-12-10'].plot()\nplt.ylabel('Quantity Traded',  size = 18)\nplt.xticks(rotation = '45')\nplt.xlabel(None)\nplt.show()","caadb594":"plt.figure(figsize=(24, 6))\nplt.suptitle('BAJFINANCE Stock split August 2016', size = 24)\nplt.subplot(1,2,1)\nplt.tight_layout()\ndata_filtered['BAJFINANCE']['nse_closing_price'].loc['2016-08-30':'2016-09-20'].plot()\nplt.ylabel('Closing Price', size = 18)\nplt.xticks(rotation = '45')\nplt.xlabel(None)\nplt.subplot(1,2,2)\nplt.tight_layout()\ndata_filtered['BAJFINANCE']['nse_traded_qty'].loc['2016-08-30':'2016-09-20'].plot()\nplt.ylabel('Quantity Traded',  size = 18)\nplt.xticks(rotation = '45')\nplt.xlabel(None)\nplt.show()","28b9bc73":"plt.figure(figsize=(24, 18))\n#plt.subplots_adjust(top=14, bottom=13) \nfor i, company in enumerate(data_filtered.keys(), 1):\n    plt.subplot(4, 2, i)\n    plt.tight_layout()\n    data_filtered[company]['nse_returns'].plot(legend=True, linestyle='--')\n    plt.ylabel('Daily Returns')\n    plt.xlabel(None)\n    plt.xticks(rotation = '45')\n    plt.title(f\"{company}\")\nplt.show()","9042e118":"plt.figure(figsize=(24, 18))\n#plt.subplots_adjust(top=14, bottom=13) \nfor i, company in enumerate(data_filtered.keys(), 1):\n    plt.subplot(4, 2, i)\n    plt.tight_layout()\n    sns.distplot(data_filtered[company]['nse_returns'].clip(0.9, 1.1), bins = 10, color='purple')\n    plt.ylabel('Daily Returns')\n    plt.xlabel(None)\n    plt.title(f\"{company}\")\nplt.show()","366d748d":"fin_rets = pd.DataFrame(columns= data_filtered.keys(), index = data_filtered['AXISBANK'].index)\nclosings_df = pd.DataFrame(columns = data_filtered.keys(), index = data_filtered['AXISBANK'].index)\nfor key in data_filtered.keys():\n    fin_rets[key] = data_filtered[key]['nse_returns']\n    closings_df[key] = data_filtered[key]['nse_closing_price']","48d83740":"sns.heatmap(fin_rets.corr(), annot=True, cmap='summer')","aa92b2a7":"rets = fin_rets.dropna()\n\narea = np.pi*20\n\nplt.figure(figsize=(12, 10))\nplt.scatter(rets.mean(), rets.std(), s=area)\nplt.xlabel('Expected return')\nplt.ylabel('Risk')\n\nfor label, x, y in zip(rets.columns, rets.mean(), rets.std()):\n    plt.annotate(label, xy=(x, y), xytext=(50, 50), textcoords='offset points', ha='right', va='bottom', \n                 arrowprops=dict(arrowstyle='-', color='blue', connectionstyle='arc3,rad=-0.3'))","162bbf0d":"### Financial crisis of 2007\u20132008\nUpon further inspection of the closing prices, we see that the Indian banking sector was affected by the Global Finacial Crisis of 2007-08. From the plots below it is evident that the stock prices begin to tank at the beginning of the year 2008 and keep depreciating till early 2009.\nThe first impact of the global crisis on India was felt in the stock market in January 2008. This came through the reversal of inflows from foreign institutional investors (FIIs) into the  country.  India  had  received  about  US  17.7  billion  as  net  equity  investment  nflows  from  FIIs  during  2007.  This  turned  into  a  net  disinvestment  of  US  13.3  billion  during  the period from January 2008 to February 2009. This was the direct result of the massive de-leveraging  of  US  banks  after  the  financial  meltdown.  The  FIIs  withdrew  funds  from  all over the emerging markets for meeting the liquidity requirements of their principals in the US.  ","462b7a60":"As expected we see that number of trades increases proportional to the decrease in the stock price, thus keeping the underlying value same and as a result of lower prices more investors are attracted to buy those shares at an affordable price.","17bf6484":"We can see that some of the highly correlated stocks in terms ofreturns are ICICIBANK and SBIN, ICICIBANK and AXISBANK, ICICIBANK and HDFCBANK,","4bab8ee4":"## Returns Analysis","f78d18cc":"Some of the drastic increase in net quanity traded per day can be explained due to the phenomenon called 'Share Split' which will be discussed in detail later","3b62d341":"We next focus on building a simple Time Series ARIMA model for few stocks present in the index, which can be found here - https:\/\/www.kaggle.com\/ashishsinha5\/time-series-model-for-nifty-indices","cc0f821f":"These are the closing prices of our set of selected stocks over the time period ranging from starting of 2005 till the end of 2019.\nWe see that there some regions of systemetic sharp decline for all the stocks. We will attemp to answer the causes of these depreciation of stocks values.","2af5e4ca":"## Correlation Between the stocks","00fceaaf":"Due to stock split we cannot do the analysis of the returns using percentange change in closing prices. We will instead use nse_returns atribute of prowess dx.\n\nThe returns are not calculated simply based on the prices of the scrip on the exchange. Returns are calculated to measure all the benefits that accrued to the holder of the scrip by way of change in the market value of the scrip compared to the earlier trading day, dividends earned from the scrip and any gain or loss due to any capital actions of the company.\n\nThe returns are expressed as a ratio of the closing price, gains\/losses arising due to capital action and dividend per share (if any) to the closing price of previous day. A ratio of more than one indicates a positive return whereas a ratio less than one denotes negative returns.","de809c73":"This is an EDA notebook in which I aim to pick up useful insights from the visualisations of various attributes of the stock market data.\n\nI aim to perform exploratory data analysis (EDA) on Nifty Financial Services Indices which comprises of 20 stocks that are listed on the National Stock Exchange (NSE). Some of themare namely BAJAJHLDNG (Bajaj Holdings And Investment Ltd), SBIN (State Bank of India), ICICIPRULI (IciciPrudential Life Insurance Comp Ltd), AXISBANK (Axis Bank Ltd), CHOLAFIN (Cholamandalam Investmentand Fin Co Ltd) , etc. \n\nThe full code along with data prepration and Time Series Models following this EDA can accessed on my github [page](https:\/\/github.com\/AshishSinha5\/nifty_financial_services_eda).","fe3722c3":"I will consider only the following stocks for my analysis - \n\n- 'AXISBANK'\n- 'BAJFINANCE'\n- 'BAJAJHLDNG'\n- 'CHOLAFIN'\n- 'HDFCBANK'\n- 'ICICIBANK'\n- 'KOTAKBANK'\n- 'SBIN'\n","2605d2b6":"## Stock Split History of Banks and other Finantial Institutes\n\nFrom the plots of closing price history of stocks above, we see some dates of sharp decline in the closing prices, e.g. Axis Bank around July 2014, ICICI Bank in December 2014, SBI in November 2014. This is not because to any kind of economic crisis but due to phenomenon called 'Stock Split'. \n\nWhen a company declares a stock split, the number of shares of that company increases, but the market cap remains the same. Existing shares split, but the underlying value remains the same. As the number of shares increases, price per share goes down.\n\nStock split is done to infuse liquidity and to make shares affordable for various investors who could not buy the shares of that company before due to high prices.","fd605795":"Similarly due to stock split we again use nse_returns atribute of prowess dx","8273af04":"In ideal case, we would want a stock to be in the bottom right area of theplot with low risk and high return, but we don\u2019t see that in our case. We seeBAJFINANCE with high volatility but with high returns and SBIN performingrather poorly with lowest returns and relatively high risks."}}