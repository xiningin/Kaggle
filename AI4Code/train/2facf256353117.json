{"cell_type":{"2fb2e769":"code","15c74dda":"code","cf6e8d90":"code","fc851baa":"code","dbcf8ebe":"code","6db3a94e":"code","b2d8ce33":"code","f25f957e":"code","fe6345b1":"code","e2528cfe":"code","bccbc14d":"code","4159ca9a":"code","dd407d40":"markdown","d0c2f933":"markdown","41a78562":"markdown","4e9802dc":"markdown","b21200a2":"markdown","be9c5c70":"markdown","f300d587":"markdown","ff1fb5b7":"markdown","2595df1a":"markdown","c1199e72":"markdown","cd1974cf":"markdown","4c06306f":"markdown","d0100a7e":"markdown","95c795da":"markdown"},"source":{"2fb2e769":"from zipfile import ZipFile\nimport nibabel as nib\nimport SimpleITK as sitk\nimport sys\nimport numpy as np","15c74dda":"!wget --header=\"Host: smart-stats-tools.org\" --header=\"User-Agent: Mozilla\/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/89.0.4389.114 Safari\/537.36\" --header=\"Accept: text\/html,application\/xhtml+xml,application\/xml;q=0.9,image\/avif,image\/webp,image\/apng,*\/*;q=0.8,application\/signed-exchange;v=b3;q=0.9\" --header=\"Accept-Language: en-US,en;q=0.9,ar;q=0.8,fr;q=0.7\" --header=\"Referer: https:\/\/smart-stats-tools.org\/lesion-challenge-2015\" --header=\"Cookie: _ga=GA1.2.1518335268.1617513544; has_js=1; _gid=GA1.2.99159776.1617874894; _gat=1\" --header=\"Connection: keep-alive\" \"https:\/\/smart-stats-tools.org\/sites\/default\/files\/lesion_challenge\/training_final_v4.zip\" -c -O 'training_final_v4.zip' --no-check-certificate","cf6e8d90":"file_name=\".\/training_final_v4.zip\"\n# opening the zip file in read me mode\nwith ZipFile(file_name,'r') as zip:\n    print(\"Extracting of the file now\")\n    zip.extractall()\n    print(\"done\")","fc851baa":"def load_img(file_path):\n    data = nib.load(file_path)\n    data = data.get_fdata() \n    #data = np.asarray(data.dataobj)\n    return data","dbcf8ebe":"p='.\/training\/training01\/preprocessed\/training01_04_t2_pp.nii'\nimg_data=load_img(p)\nimg_data.shape\n","6db3a94e":"file=nib.load(p)\nfile_header = file.header\n#if file_header['pixdim'][0] !=1 and file_header['pixdim'][0]!=-1:\n#print(p,file_header['pixdim'][0])\nprint(file_header)","b2d8ce33":"reader = sitk.ImageFileReader()\nreader.SetFileName(p)\nreader.LoadPrivateTagsOn()\nreader.ReadImageInformation()\nfor k in reader.GetMetaDataKeys():\n    v = reader.GetMetaData(k)\n    print(f\"({k}) = = \\\"{v}\\\"\")\n\nprint(f\"Image Size: {reader.GetSize()}\")\nprint(f\"Image PixelType: {sitk.GetPixelIDValueAsString(reader.GetPixelID())}\")","f25f957e":"p='.\/training\/training04\/preprocessed\/training04_02_mprage_pp.nii'\nimg_data=load_img(p)","fe6345b1":"reader = sitk.ImageFileReader()\nreader.SetFileName(p)\nreader.LoadPrivateTagsOn()\nreader.ReadImageInformation()\nfor k in reader.GetMetaDataKeys():\n    v = reader.GetMetaData(k)\n    print(f\"({k}) = = \\\"{v}\\\"\")","e2528cfe":"# files has iisue\nroot_path='.\/training\/'\ni='04'\np1=root_path+'training'+i+'\/masks\/training'+i+'_02_mask2.nii'\np2=root_path+'training'+i+'\/preprocessed\/training'+i+'_02_mprage_pp.nii'\np3=root_path+'training'+i+'\/preprocessed\/training'+i+'_02_flair_pp.nii'\npaths=[p1,p2,p3]","bccbc14d":"for path in paths:    \n    img_data=load_img(path)\n    nib.save(nib.Nifti1Image(img_data, np.eye(4)),  path)","4159ca9a":"#add to anaconda note\n# Anaconda easy to install. By default it does a user-level installation, not system-level, so you don\u2019t need administrative privileges. And it supports both Python 2 and Python 3.","dd407d40":"## get image data with simple itk","d0c2f933":"## get image header","41a78562":"# Image file format\n* Image file formats provide a standardized way to store the information describing an image in a computer file.\n>* Neuroimaging Informatics Technology Initiative (Nifti), \n>* Minc\n>* Digital Imaging and Communications in Medicine (Dicom).\n\nThe file format describes how the image data are organized inside the image file and how the pixel data should be interpreted by a software for the correct loading and visualization","4e9802dc":"# The Blood-Brain Barrier\n* The blood-brain barrier is made up of tightly packed cells in the brain\u2019s capillaries that prevent harmful substances from entering the brain. It protects your brain from injury and disease while also letting in substances that your brain needs, like oxygen and water. While it performs an important function in keeping your brain healthy, it can also cause challenges in treating some brain conditions when medications can\u2019t cross the blood-brain barrier.\n* The blood-brain barrier serves a filter, controlling which molecules can pass from the blood into the brain. Because the endothelial cells are positioned so closely together, they keep out any harmful toxins or pathogens from reaching your brain. \n\n* While the blood-brain barrier keeps many things out of the central nervous system, it is not impermeable. Some essential molecules, like oxygen, can get past the blood-brain barrier. Fat-soluble substances with small molecules can also pass through the barrier, including caffeine and alcohol. Other substances, like glucose, can be transported from the blood to the brain by a system of transport proteins\n","b21200a2":"# References\n* Larobina, Michele, and Loredana Murino. \u201cMedical image file formats.\u201d Journal of digital imaging vol. 27,2 (2014): 200-6. doi:10.1007\/s10278-013-9657-9\n* https:\/\/www.fda.gov\/radiation-emitting-products\/medical-imaging\/mri-magnetic-resonance-imaging\n* https:\/\/www.verywellhealth.com\/what-is-the-blood-brain-barrier-3980707\n* https:\/\/www.verywellhealth.com\/gadolinium-enhanced-lesion-2440506\n* \n","be9c5c70":"# What are the differences between enhancing and nonenhancing lesions in MRI?\n","f300d587":"# issue happen when working with ISBI Dataset\n## some files header contain corrupted data \n* pixdim[0] (qfac) should be 1 (default) or -1; setting qfac to 1\n* when read with nifti it updated automatically\n* when read it with simpleitk can find actual value of the pixdim values","ff1fb5b7":"## load image data","2595df1a":"# Gadolinium\n* Gadolinium, also called \"contrast,\" is a large, chemical compound that is injected into a person's vein during an MRI scan by a technician.\n* why and how \"contrast\" (gadolinium) is used in MRIs to diagnosis or monitor multiple sclerosis.\n\n* Gadolinium normally cannot pass from the bloodstream into the brain or spinal cord due to a layer of protection in a person's body called the blood-brain barrier. But during active inflammation within the brain or spinal cord, as during an MS relapse, the blood-brain barrier is disrupted, allowing gadolinium to pass through.\n\n* Gadolinium can then enter the brain or spinal cord and leak into an MS lesion, lighting it up, and creating a highlighted spot on an MRI\n* The purpose of a gadolinium-enhanced magnetic resonance imaging (MRI) scan is to give your doctor an indication of the age of your MS lesions, like whether an MS relapse is happening now or whether one occurred awhile ago.\n\n* If a lesion on the MRI lights up, it means that active inflammation has occurred usually within the last two to three months. Active inflammation means that myelin (the fatty sheath that insulates nerve fibers) is being damaged and\/or destroyed by a person's immune cells.\n\n\n* If a lesion on an MRI does not light up after gadolinium is injected, then it's likely an older lesion\u2014one that occurred more than 2 to 3 months ago. In other words, the use of contrast helps a neurologist determine the age of a lesion. \n\n\n* Even so, it's important to understand that an MS lesion seen on an MRI does not necessarily cause symptoms. These lesions are referred to as \"silent\" lesions. Likewise, it can be tricky sometimes to correlate a specific symptom with a specific lesion on the brain or spinal cord.\n\n* Also, not all lesions represent MS, which is why an MRI cannot be used alone to diagnose or monitor a person's MS. Lesions seen on an MRI can be the result of aging or other health conditions like stroke, trauma, infection, or a migraine. Sometimes, people have one or more lesions on their MRIs, and doctors cannot explain why.\n\n* In addition, lesions do interesting things. Sometimes they get inflamed over and over again and eventually form black holes, which represent areas of permanent or severe myelin and axon damage. Research suggests that black holes correlate with a person's MS-related disability.2\ufeff Sometimes lesions heal and repair themselves (and even disappear)\n## gadolinium-based contrast agents (GBCAs)\nFor some MRI exams, intravenous (IV) drugs, such as gadolinium-based contrast agents (GBCAs) are used to change the contrast of the MR image. Gadolinium-based contrast agents are rare earth metals that are usually given through an IV in the arm.\n* The terms 'enhancing' or 'non-enhancing' lesion refer to the uptake of Gadolinium-based contrast agent in the lesion. Typically, this property is assessed using a T1-weighted acquisition: Gd shortens the longitudinal relaxation rate of tissue, which causes a signal enhancement.\n* The difference between enhancing and non-enhancing is very pronounced in brain tissue, where the blood-brain barrier effectively hinders Gd-based contrast agent from accumulating in the tissue in normal circumstances. When the blood-brain barrier is leaking, e.g. due to an inflammatory process in a lesion or due to cancerous angiogenesis, Gd can extravasate and accumulate in the tissue.\n* Specifically in Multiple Sclerosis, 'active' and 'chronic' MS lesions are often differentiated based on their contrast enhancement, based on the fact that an active lesion exhibits acute inflammation and breakdown of the BBB, whereas chronic MS lesions usually don't enhance.\n* In MRI field, usually the term \"enhancing\" is coupled with \"gadolinium\" or \"contrast\". Therefore, an enhancing lesion is a lesion that assumes contrast medium. In some cases this contrast-enhancing lesion may be acute (e.g. an acute multiple sclerosis lesion), but in other cases an enhancement may be even related to non-acute findings (e.g. vascular malformation)\n* The differences between enhancing and nonenhancing lesions in MRI are obvious. Normally with T1 contrast agents at a usual dosage, the enhancing lesions appear hyperintense on MR images and nonenhancing lesions appear isointense or without signal changes in comparison to that on precontrast MR images. Whereas with T2 contrast agents, the enhancing lesions appear hypointense on MR images and nonenhancing lesions appear isointense or without signal changes relative to that on precontrast MR images. Whether a lesion is enhanced or not reflects the blood perfusion, vascular permeability and extracellular space of the lesion.\n* Just to add, any breakdown of the BBB can cause Gd enhancing lesions, which is not necessary of inflammatory etiology but also seen with e.g. vascular lesion a few days after acute stroke.\n* Any lesion able to increase vascularization or to be responsible of neoangyogenesis -inflamatory or tumoral are the most frequent - will produce an enhancing image at MRI. \n","c1199e72":"# Work with ISBI Data Set","cd1974cf":"## save the automatically updated image ","4c06306f":"# Terms\n# Magnetic Resonance Imaging (MRI) \n* is a medical imaging procedure for making images of the internal structures of the body. MRI scanners use strong magnetic fields and radio waves (radiofrequency energy) to make images. The signal in an MR image comes mainly from the protons in fat and water molecules in the body.\n* During an MRI exam, an electric current is passed through coiled wires to create a temporary magnetic field in a patient\u2019s body. Radio waves are sent from and received by a transmitter\/receiver in the machine, and these signals are used to make digital images of the scanned area of the body. A typical MRI scan last from 20 - 90 minutes, depending on the part of the body being imaged.\n* ","d0100a7e":"# Basic concepts common to all image file formats\n\n","95c795da":"# Medical Imaging\n* Medical imaging is the technique and process of imaging the interior of a body for clinical analysis and medical intervention, as well as visual representation of the function of some organs or tissues (physiology). Medical imaging seeks to reveal internal structures hidden by the skin and bones, as well as to diagnose and treat disease. Medical imaging also establishes a database of normal anatomy and physiology to make it possible to identify abnormalities. Although imaging of removed organs and tissues can be performed for medical reasons, such procedures are usually considered part of pathology instead of medical imaging.\n* Amedical image data set consists typically of \n>* one or more images representing the projection of an anatomical volume onto an image plane (projection or planar imaging), \n>* a series of images representing thin slices through a volume (tomographic or multislice two-dimensional imaging), \n>* a set of data from a volume (volume or three-dimensional imaging), \n>* multiple acquisition of the same tomographic or volume image over time to produce a dynamic series of acquisitions (four- dimensional imaging). \n\n\n* A medical image is the representation of the internal structure or function of an anatomic region in the form of an array of picture elements called pixels or voxels. It is a discrete representation resulting from a sampling\/reconstruction process that maps numerical values to positions of the space. The number ofpixels used to describe the field-of-view ofa certain acquisition modality is an expression of the detail with which the anatomy or function can be depicted. \n* What the numerical value ofthe pixel expresses depends on:\n>* the imaging modality, \n>* the acquisition protocol, \n>* the reconstruction, \n>* the post-processing.\n\n* As a discipline and in its widest sense, it is part of biological imaging and incorporates radiology, which uses the imaging technologies of \n>* X-ray radiography, \n>* magnetic resonance imaging (MRI) \n>* ultrasound, \n>* endoscopy, \n>* elastography, \n>* tactile imaging, \n>* thermography, \n>* medical photography, \n>* nuclear medicine functional imaging techniques as positron emission tomography (PET) and single-photon emission computed tomography (SPECT)."}}