{"cell_type":{"021b1405":"code","6958a200":"code","959eb627":"code","67a2ab40":"code","7ee1133c":"code","efc69d62":"code","717081c6":"code","60b5f16a":"code","272f1c01":"code","f5e2161c":"code","34f987ea":"code","e7360db3":"code","6c36d6c4":"code","cb8c11eb":"code","b504df36":"code","380d5132":"code","bfa1438a":"code","0f3434a5":"code","f8ceaa42":"code","40029968":"code","0c244c14":"code","d1c288bc":"code","3b8271b3":"code","112cf2c5":"code","42dd06de":"code","1491d2c8":"code","f6fd26df":"code","80e9f9e3":"code","eafcae34":"code","ae590da5":"code","6a5dadd2":"code","de539dc0":"code","e26c7929":"code","f7c47393":"code","be5481df":"code","c4bd492f":"code","72ef959f":"code","62c53207":"code","b7159080":"code","16b17823":"code","cf263516":"code","c1669034":"code","77eba566":"code","928be41a":"code","ae3a6c8e":"code","18b609b3":"code","af9d2740":"code","1380627e":"code","d9484649":"code","ec8c0239":"code","0cf8e835":"code","ecae20c6":"code","57d6bf05":"code","509132f8":"code","c1ac5f12":"code","1bb44708":"code","2370a240":"code","b8135ed1":"code","971f7501":"code","9426948e":"code","4b12867e":"code","6901aa5c":"code","f57b0daa":"code","b1545022":"code","98214284":"code","8b1d13ba":"code","2f2335b7":"code","b5eba1ec":"code","24cecc32":"code","54f44289":"code","b6e1333a":"code","4a08d18c":"markdown","3482612c":"markdown","3b21104f":"markdown","4d67c225":"markdown","9205e8f4":"markdown","49f9a66e":"markdown","2d2f2e50":"markdown","6f4a9cd9":"markdown","53cc36c6":"markdown","d5ee6953":"markdown","a07ff4c4":"markdown","abee140d":"markdown","115a081f":"markdown","3b661b4c":"markdown","a026da57":"markdown","28e48779":"markdown","7655c6f7":"markdown","38970b65":"markdown","273e1e2e":"markdown","e79c17a9":"markdown","de2d47a8":"markdown","8988104d":"markdown","7902dbd5":"markdown","30160f1c":"markdown","93904eb7":"markdown","242ea59d":"markdown","6f03a431":"markdown","a7f162a9":"markdown","ee8d82ff":"markdown","f8403610":"markdown","02a0b1c9":"markdown","35ad54c9":"markdown","5a3bd7c6":"markdown","c7fcef27":"markdown"},"source":{"021b1405":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \nimport matplotlib.pyplot as plt\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport seaborn as sns\nimport gc\nfrom scipy.stats import norm\nimport matplotlib.ticker as mticker\nimport scipy.stats as stats\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","6958a200":"traindf = pd.read_csv(\"..\/input\/train.csv\")\ntestdf = pd.read_csv(\"..\/input\/test.csv\")","959eb627":"print(traindf.shape,testdf.shape)","67a2ab40":"for c in traindf.columns:\n    if c not in testdf.columns.values:\n        print(c)","7ee1133c":"all_data = traindf.drop('SalePrice',axis=1).append(testdf).reset_index(drop=True)","efc69d62":"all_data.info()","717081c6":"(mu, sigma) = stats.norm.fit(traindf[\"SalePrice\"])\nprint(\"mu:{:.3f} and sigma:{:.3f}\".format(mu,sigma))\nplt.figure(figsize=(12,7))\nsns.distplot(traindf['SalePrice'],fit=stats.norm)\nplt.xlabel(\"Price\")\nplt.ylabel(\"Frequency\")\nplt.title(\"Distribution SalePrice\")\nplt.legend(['Normal dist.( $\\mu=$ {:.3f} and $\\sigma=$ {:.3f} )'.format(mu,sigma)],loc='best')\nplt.show()","60b5f16a":"fig = plt.figure()\nstats.probplot(traindf['SalePrice'],plot=plt)\nplt.show()","272f1c01":"print('Skewness: %f' % traindf['SalePrice'].skew())\nprint('Kurtosis: %f' % traindf['SalePrice'].kurt())","f5e2161c":"(mu,sigma) = stats.norm.fit(np.log(traindf['SalePrice']))\nfig = plt.figure()\nsns.distplot(np.log(traindf['SalePrice']),fit=stats.norm)\nplt.title(\"Distribution of SalePrice after Log conversion\")\nplt.ylabel(\"Frequency\")\nplt.legend([\"Normal dist.($\\mu=$ {:0.3f} and $\\sigma=${:.3f})\".format(mu,sigma)],loc='best')\nplt.show()\n\nplt.figure()\nstats.probplot(np.log(traindf['SalePrice']),plot=plt)\nplt.show()\nprint('Skewness: %f' % np.log(traindf['SalePrice']).skew())\nprint('Kurtosis: %f' % np.log(traindf['SalePrice']).kurt())","34f987ea":"number_cols = [c for c in all_data._get_numeric_data().columns]\ncategorical_cols = all_data.select_dtypes(include=['object']).columns.values","e7360db3":"print(categorical_cols[:5])\nprint(number_cols[:5])","6c36d6c4":"contsant_columns = [c for c in all_data.columns if traindf[c].nunique()==1]\ncontsant_columns\n","cb8c11eb":"missing_values  = (all_data.isnull().sum()\/all_data.shape[0])*100\nmissing_values = missing_values[missing_values>0]\nplt.figure(figsize=(13,5))\nmissing_values = missing_values.sort_values(ascending=False)\nmissing_values.plot.bar()\nplt.title(\"MissingValues in Dataset by each column\")\nplt.xlabel(\"Columns\")\nplt.ylabel(\"Missing Values Ratio\")\nplt.show()\npd.DataFrame({\"Missing Ratio\":missing_values})","b504df36":"columns_cat1 = missing_values[missing_values>40].index\nall_data[columns_cat1] = all_data[columns_cat1].fillna(\"None\")\n","380d5132":"all_data[\"LotFrontage\"] = all_data[\"LotFrontage\"].fillna(all_data['LotFrontage'].mean())","bfa1438a":"for col in ('GarageType', 'GarageFinish', 'GarageQual', 'GarageCond'):\n    all_data[col] = all_data[col].fillna('None')","0f3434a5":"for col in ('GarageYrBlt', 'GarageArea', 'GarageCars'):\n    all_data[col] = all_data[col].fillna(0)","f8ceaa42":"for col in ('BsmtFinSF1', 'BsmtFinSF2', 'BsmtUnfSF','TotalBsmtSF', 'BsmtFullBath', 'BsmtHalfBath'):\n    all_data[col] = all_data[col].fillna(0)","40029968":"for col in ('BsmtQual', 'BsmtCond', 'BsmtExposure', 'BsmtFinType1', 'BsmtFinType2'):\n    all_data[col] = all_data[col].fillna('None')","0c244c14":"all_data[\"MasVnrType\"] = all_data[\"MasVnrType\"].fillna(\"None\")\nall_data[\"MasVnrArea\"] = all_data[\"MasVnrArea\"].fillna(0)","d1c288bc":"all_data['MSZoning'] = all_data['MSZoning'].fillna(all_data['MSZoning'].mode()[0])\nall_data[\"Functional\"] = all_data[\"Functional\"].fillna(\"Typical\")\nall_data['Electrical'] = all_data['Electrical'].fillna(all_data['Electrical'].mode()[0])\nall_data['KitchenQual'] = all_data['KitchenQual'].fillna(all_data['KitchenQual'].mode()[0])\nall_data['Exterior1st'] = all_data['Exterior1st'].fillna(all_data['Exterior1st'].mode()[0])\nall_data['Exterior2nd'] = all_data['Exterior2nd'].fillna(all_data['Exterior2nd'].mode()[0])\nall_data['SaleType'] = all_data['SaleType'].fillna(all_data['SaleType'].mode()[0])\nall_data['MSSubClass'] = all_data['MSSubClass'].fillna(\"None\")\n","3b8271b3":"for c in all_data.columns:\n    if np.any(all_data[c].isnull().sum()>0):\n        print(c)","112cf2c5":"sns.countplot(traindf[\"Utilities\"])","42dd06de":"all_data = all_data.drop(\"Utilities\",axis=1)","1491d2c8":"cols_cat2 = [\"MSSubClass\",\"MoSold\",\"YrSold\",\"OverallQual\",\"OverallCond\"] \nfor c in cols_cat2:\n    all_data[c] = all_data[c].astype(str)","f6fd26df":"all_data['TotalArea'] = all_data['TotalBsmtSF'] + all_data[\"1stFlrSF\"] + all_data[\"2ndFlrSF\"]","80e9f9e3":"trainData = all_data[:traindf.shape[0]]\ntrainData['SalePrice'] = traindf['SalePrice']\nfig,ax= plt.subplots(1,3,figsize=(17,5))\nsns.swarmplot(x=\"PavedDrive\",y='SalePrice',data=trainData,ax=ax[0])\nsns.swarmplot(x=\"GarageFinish\",y ='SalePrice',data=trainData,ax=ax[1])\nsns.swarmplot(x=\"LandSlope\",y='SalePrice',data=trainData,ax=ax[2])","eafcae34":"fig,ax= plt.subplots(2,2,figsize=(15,8))\nsns.countplot(x='OverallCond',data=all_data,ax=ax[0,0])\nsns.countplot(x=\"OverallQual\",data=all_data,ax=ax[0,1])\nsns.stripplot(x='OverallCond',y=\"SalePrice\",data=trainData,ax=ax[1,0])\nsns.stripplot(x='OverallQual',y='SalePrice',data=trainData,ax=ax[1,1])\nax[0,0].set_title(\"Overall Condtion of the house\")\nax[0,1].set_title(\"Overall Quality of material and finish of the house\")","ae590da5":"fig,ax= plt.subplots(2,2,figsize=(15,8))\nsns.boxplot(x='MSZoning',y='SalePrice',data=trainData,ax=ax[0,0])\n# ax[0,0].set_xticklabels([\"Residential Low Density\",\"Residential Medium Density\",\"Commercial\",\"Floating Village Residential\",\"Residential High Density\"],rotation=45)\n\nsns.boxplot(x='LotShape',y='SalePrice',data=trainData,ax=ax[0,1])\nsns.boxplot(x='LotConfig',y='SalePrice',data=trainData,ax=ax[1,0])\nsns.boxplot(x='Foundation',y='SalePrice',data=trainData,ax=ax[1,1])","6a5dadd2":"plt.figure(figsize=(15,8))\nsns.swarmplot(x='SaleCondition',y='SalePrice',hue='SaleType',data=trainData)","de539dc0":"Number_cols = [c for c in trainData.drop(\"Id\",axis=1)._get_numeric_data().columns]","e26c7929":"sns.pairplot(trainData,x_vars=Number_cols,y_vars=[\"SalePrice\"])\n","f7c47393":"sns.scatterplot(x=\"GrLivArea\",y='SalePrice',data=trainData)","be5481df":"trainData = trainData.drop(trainData[(trainData[\"GrLivArea\"]>4000) & (trainData[\"SalePrice\"]<400000)].index)\nsns.scatterplot(x=\"GrLivArea\",y='SalePrice',data=trainData)","c4bd492f":"sns.scatterplot(x=\"LotArea\",y='SalePrice',data=trainData)","72ef959f":"# catg_cols = all_data.select_dtypes(include=[\"object\"]).columns.values\n# from sklearn.preprocessing import LabelEncoder\n# for c in catg_cols:\n#     LE = LabelEncoder()\n#     LE.fit(list(all_data[c].values))\n#     all_data[c] = LE.transform(list(all_data[c].values))","62c53207":"skew = []\nfor c in Number_cols:\n    if c not in ['SalePrice'] and abs(all_data[c].skew())>0.75:\n        skew.append(c)\nprint(\"there are total {} skewed features present in the data set\".format(len(skew)))","b7159080":"for c in skew:\n    all_data[c] = np.log1p(all_data[c])","16b17823":"all_data = pd.get_dummies(all_data)","cf263516":"train = all_data[:traindf.shape[0]]\ntest  = all_data[traindf.shape[0]:]","c1669034":"corr_matrix = trainData.corr()\nplt.figure(figsize=(24,24))\nsns.heatmap(corr_matrix,annot=True,xticklabels=corr_matrix.columns.values,yticklabels=corr_matrix.columns.values)","77eba566":"all_data = all_data.drop([\"TotalBsmtSF\",\"GrLivArea\",\"GarageCars\",\"TotRmsAbvGrd\"],axis=1)","928be41a":"from sklearn.preprocessing import StandardScaler,RobustScaler\nscaler =RobustScaler()\ntrainX= scaler.fit_transform(train.values)","ae3a6c8e":"testX= scaler.fit_transform(test.values)","18b609b3":"from sklearn.linear_model import LinearRegression,Lasso,Ridge,ElasticNet,SGDRegressor\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.svm import SVR","af9d2740":"regressor=[]\nrd = Ridge(alpha=9)\nlr = LinearRegression()\nls = Lasso(alpha=0.1,random_state=2)\n#mtl = MultiTaskLasso(alpha=0.1,random_state=2)\nen = ElasticNet(alpha=0.1,random_state=42)\nrf = RandomForestRegressor(100,max_depth=100)\ndtr = DecisionTreeRegressor(max_depth=100,max_features=\"auto\")\nsvr = SVR()\nregressor.extend([rd,lr,ls,en,rf,dtr,svr])\n","1380627e":"from sklearn.model_selection import KFold,cross_val_score\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.pipeline import make_pipeline\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.metrics import make_scorer\nfrom sklearn.metrics import mean_squared_error","d9484649":" trainY = np.log(traindf['SalePrice'])\ntrainx,testx,trainy,testy = train_test_split(trainX,trainY,test_size=0.30,random_state=42)\nprint(trainx.shape,testx.shape)\n","ec8c0239":"def rmse(model,n_CV):\n        kf = KFold(n_CV,random_state=42,shuffle=True).get_n_splits()\n        score = np.sqrt(-cross_val_score(model,trainx,trainy,scoring=\"neg_mean_squared_error\",cv=kf))\n        return(score)","0cf8e835":"cv_score = []\nrmse_score=[]\nfor model in regressor:\n    score = rmse(model,5)\n    mean_score = np.mean(score)\n    cv_score.append(score)\n    rmse_score.append(mean_score)","ecae20c6":"CV_std = [np.std(x) for x in cv_score]\nmodels_result = pd.DataFrame({\"CVmeans\":rmse_score,\"Algorithms\":[\"Ridge\",\"LinearRegression\",\"Lasso\",\"ElasticNet\",\"RandomForestRegressor\",\"DecisiontreeRegressor\",\"SupportVectorRgression\"],\"CVstd\":[np.std(x) for x in cv_score]})\nmodels_result","57d6bf05":"sns.barplot(x=\"CVmeans\",y=\"Algorithms\",data=models_result,**{\"xerr\":CV_std})\nplt.title(\"Models performance\")\nplt.xlabel(\"avg rmse value for cross validation\")\nplt.show()","509132f8":"rd_params ={\"alpha\":[0,1,9,50,100,500],\"solver\":[\"sag\",\"saga\",\"auto\"]}\nrf_params = {\"max_depth\":[100,200,400,500],\"bootstrap\":[True,False]}\nlasso_params = {\"alpha\":[0.0001,0.0005,0.001,0.01,0.1,1,3,9,50,100,500,1000]}\nsvm_params = {\"kernel\":[\"rbf\",\"poly\"],\"degree\":[3,5],\"gamma\":[\"auto\",\"scale\"]}","c1ac5f12":"\ndef rmse_val(actual, predict):\n        return -np.sqrt(mean_squared_error(actual,predict))\nridge =Ridge()\nmy_scorer = make_scorer(rmse_val,greater_is_better=True)\ngrid_ridge = GridSearchCV(ridge,param_grid=rd_params,cv=5,scoring=my_scorer,n_jobs=-1,verbose=1)\ngrid_ridge.fit(trainx,trainy)","1bb44708":"grid_ridge.best_params_","2370a240":"grid_ridge.best_score_","b8135ed1":"# ridge =Ridge(alpha=9,solver=\"auto\")\n# ridge.fit(trainx,trainy)\n# predc = ridge.predict(testx)\n# np.mean(rmse(ridge,10))","971f7501":"grid_rf = GridSearchCV(rf,param_grid = rf_params,scoring=my_scorer,n_jobs=-1,verbose=1,cv=10)\ngrid_rf.fit(trainx,trainy)","9426948e":"grid_rf.best_params_","4b12867e":"grid_rf.best_score_","6901aa5c":"rf = RandomForestRegressor(bootstrap=True, max_depth= 200)\nnp.mean(rmse(rf,10))","f57b0daa":"lsg=Lasso(random_state=42)\nlasso_grid = GridSearchCV(lsg,param_grid=lasso_params,cv=10,n_jobs=-1,verbose=1,scoring=my_scorer)\nlasso_grid.fit(trainx,trainy)","b1545022":"lasso_grid.best_params_","98214284":"lsg_1=Lasso(random_state=42,alpha=0.0005)\nnp.mean(rmse(lsg_1,10))","8b1d13ba":"import  lightgbm as lgb\nimport xgboost as xgb","2f2335b7":"lgb_model=lgb.LGBMRegressor(objective='regression',num_leaves=10,learning_rate=0.05,n_estimators=720,max_bin = 55,min_data_in_leaf =6)\nlgb_model.fit(trainx,trainy)","b5eba1ec":"xgb_model = xgb.XGBRegressor(colsample_bytree=0.4603, gamma=0.0468, \n                             learning_rate=0.05, max_depth=3, \n                             min_child_weight=1.7817, n_estimators=2200,\n                             reg_alpha=0.4640, reg_lambda=0.8571,\n                             subsample=0.5213, silent=1,\n                             random_state =7, nthread = -1)\nnp.mean(rmse(xgb_model,5))","24cecc32":"pred = lgb_model.predict(testX)","54f44289":"prediction = np.exp(pred)","b6e1333a":"my_submission =pd.DataFrame({\"Id\":testdf.Id,\"SalePrice\":prediction})\nmy_submission.to_csv(\"output.csv\",index=False)","4a08d18c":"first we will see the scatter plots of numerical variables and will find outliers if present in any variable.","3482612c":" if we see carefully in description data file we can see that many of these feature exactly dont contain missing values because N\/A means Not present for example feature \"PoolQC\" has approx 99% in N\/A in data set but that does not mean those are missing values , actually those represent not available Pool for those house data. so we will not eliminate these values, we will replace those values with \"None\" so that we find another categoy. ","3b21104f":"\n\n\n\nto check how many features contain single constant value, since those features are trash, we will eliminate those feature from our dataset","4d67c225":"Now we will convert these variables into normal dist using log1p method ","9205e8f4":"These feature contains N\/A values which are replace by either \"None\" or mean\/mode","49f9a66e":"we can see that distribution of our target feature(\"SalePrice\") is skewed left side, since most of statistical models  are applicable on Normal distribution therefor we should convert the feature distribution in normal distribution which is obtained by taking logarithimic values of the data, we will do that later \n\nNow we will see two important parameters for mesuring normal distribution, skewness and kurtosis, skewness which measures how symmetric is the data around the mean value and kurtosis tell the pointyness or flatness of the curve  as we can see from the plot, it is skewed left and also pointy ","2d2f2e50":"Printing shapes of train and test data  ","6f4a9cd9":"we will take all categorical variables and do  oneHotEncode","53cc36c6":"**Skewed Feature Testing**","d5ee6953":"we will make two lists one will contain all the numerical variables of the dataset and another one will contain all the categorical variable ","a07ff4c4":"**Ridge**","abee140d":"Lotfrontage is actually a numerical and we will replace with mean value","115a081f":"we should not remove the points lies on the right because their values of saleprice are not so low and there are other factors which are actually affecting the price of that point","3b661b4c":"**Some Insights**","a026da57":"we will get the dummies variable for the categorical variables","28e48779":"perfect normal distribution curve have zero kurtosis and zero skewness \n1. kurt > 0 => pointier than normal distribution . \n2. kurt < 0 => represent flatness of the curve \n","7655c6f7":"**RandomForest**","38970b65":"all those features which has more than 50% missing ratio are not actually missing(see description.txt for clarification) so we will replace these N\/A will None","273e1e2e":" Nice!","e79c17a9":"**Outliers Detection**","de2d47a8":"As we can see there are two values present in the training set which has very low value of saleprice for very high value of area therefor we should remove those values","8988104d":"**Lasso**","7902dbd5":"Since there are variable which are actually not actually numericals instead those are categorical variables such as OverallQual,MSSubClass and OverallCond. so we shold transform these variable in string data type ","30160f1c":"We will combine both train and test data sets into single data set which help later to eliminate all the null values in one task and also our insights of features should contains all the data  ","93904eb7":" since most of values are AllPub therefor we can consider this as a constant feature which won't help us in model therefor we can eliminate this feature from the dataset","242ea59d":"**Missing Values handling**","6f03a431":"after converting the traget value into log values we can see the curve is more like normal distribution curve and we can see both parameters skew and kurt degraded to near zero value","a7f162a9":"**More feature Engineering**","ee8d82ff":"Not clearly but we can see from scatter matrix, there are multiple feature exist in which outliers can be present such as LotFrontage, LotArea and GrLivArea  therfor we will see these variables one by one","f8403610":"we should count missing values in each feature, we dont want missing values in our dataset because that will create problem for training our dataset(there are still some algorithms available which support missing values such as KNN) therefor we should handle those missing values in some way. There are multiple ways one can handle the missing values \n1. deleting rows which contains missing values, since this method losses the data therefor it is not preferable\n2. Replacing with mean\/mode or median values of the same feature\n3. predicting the missing values etc.\n","02a0b1c9":"GrLivArea","35ad54c9":"for all other garage related variables we can replace N\/A with None ","5a3bd7c6":"**GradientBooster**","c7fcef27":"LotArea"}}