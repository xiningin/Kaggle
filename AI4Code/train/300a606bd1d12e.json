{"cell_type":{"00fabdfe":"code","314ffa83":"code","dcc59028":"code","91beeb0d":"code","c37f540c":"code","9b54c4f7":"code","c0670ef5":"code","e3d1fef7":"code","1eee609a":"code","913e1e7d":"markdown","0d044d0b":"markdown","795d1a1b":"markdown","b65f7683":"markdown","6e7df3ee":"markdown","daa1bfc0":"markdown","6963099e":"markdown","1790f097":"markdown"},"source":{"00fabdfe":"from fastai.vision.all import *","314ffa83":"path = Path('\/kaggle\/input\/petfinder-pawpularity-score\/')\npath.ls()","dcc59028":"df = pd.read_csv(path\/'train.csv')\ndf.head(5)","91beeb0d":"def get_x(r): return path\/'train'\/(r['Id']+'.jpg')\ndef get_y(r): return r['Pawpularity'] \ndb = DataBlock(blocks=(ImageBlock, RegressionBlock), \n               item_tfms=RandomResizedCrop(128, min_scale=0.35), \n               batch_tfms=Normalize,\n               get_x=get_x, get_y=get_y,\n               splitter=TrainTestSplitter(test_size=0.2, random_state=42))","c37f540c":"dls = db.dataloaders(df)\ndls.show_batch(nrows=2, ncols=3)","9b54c4f7":"learn = cnn_learner(dls, resnet18, y_range=(0, 100))\nlearn.model.cuda()\nx, y = dls.train.one_batch()\nactivs = learn.model(x)\nactivs.shape","c0670ef5":"res = learn.lr_find(stop_div=False)\nmin_grad_lr, steep_grad_lr = res.lr_min, res.lr_steep","e3d1fef7":"learn.fine_tune(10, base_lr=min_grad_lr)\nlearn.export('resnet18.pkl')","1eee609a":"df_t = pd.read_csv(path\/'test.csv')\nfnames = [path\/'test'\/(x+'.jpg') for x in df_t['Id']]\npred, _ = learn.get_preds(dl=learn.dls.test_dl(fnames, bs=128))\nsub = pd.read_csv(path\/'sample_submission.csv')\nsub['Pawpularity'] = pred.flatten().tolist()\nsub.to_csv('submission.csv', index=False)\nsub","913e1e7d":"Now we know good learning rate then let's train the model!  \nfastai's learner has function to execute fine tuning (pretrained with ImageNet).  \nYou don't have to freeze the model's weights explicitly.  ","0d044d0b":"# Build an End2End baseline REAL FAST with fastai\n\n![summary.png](attachment:4320dcba-9eff-4091-9feb-7c05b9fd572b.png)\n\nIn this competiton, we try to tackle the regression task which predicts the numeric values called `Pawpularity` from the images.\n\nIn this notebook, we try to make baseline FAST with fastai module.  \nYou don't need to define neither datasets nor dataloaders by yourself.  \n\n---\n## Preparation\nFirst of all, import EVERYTHING with ONE line.  \nIt's ok to use `*` because fastai module automatically select what we need.  ","795d1a1b":"Now we have `DataBlock` that works.  \nLet's get dataloaders from `DataBlock`, then check what their batch have.","b65f7683":"### Defining `DataBlock`\nAs mentioned before, we don't need to define neither datasets nor dataloaders.  \nAll you need to do is just selecting class and function for DataBlock parameters from fastai reference.\n\n- **blocks**  \nAt this competition, we predict numerical value called \"Pawpularity\" from image.  \nThat means you should select `ImageBlock` and `RegressionBlock` for `blocks`  \n- **get_x**  \nImage path is provided in `Id` column of train.csv.  \nYou can give image path to the `DataBlock` by defining function that takes a row from dataframe and returns filepath. \n- **get_y**  \nLabel is provided in `Pawpularity` column of train.csv.  \nYou can give label to the `DataBlock` by defining function like we did for `get_x` parameter.\n- **item_tfms**, **batch_tfms**  \ntfms means transform, you can specify some transform you want to apply.\n- **splitter**  \nHere you can specify how to split train data and valid data.  \n<!-- You can also specify it by giving each indices as tuple. -->","6e7df3ee":"Defining model is done!  \n\nBefore starting training, let's find better learning rate.","daa1bfc0":"Dataloaders are done!  \n\n---\n## Training\nNow let's define a model and check if the model can process data to the output.\n\n<!-- maybe setting y_range to -1 ~ +1 does work?? -->","6963099e":"---\n## Inference\nPrediction looks not good for now, but we submit it anyway.  \nTo do that, we give filepath to `learn.dls.test_dl` and let the learner predicts.","1790f097":"### Loading metadata\nThis is baseline so we only care about `Id` column which guild us to the filepath of the input images."}}