{"cell_type":{"bcabbf9a":"code","7795e9e0":"code","257193c9":"code","3257832c":"code","e105e70a":"code","a80ccea4":"code","0d11fa0b":"code","5c6a8d7f":"code","c84c9c68":"code","38561c8b":"code","4b4372ec":"code","1981e34b":"code","0baaf89a":"code","c29ddeec":"code","460a54a0":"code","883a01da":"code","fb7b05bf":"code","0c567926":"code","35f67e13":"code","b9e902f4":"code","d30387ea":"code","6f01475b":"code","6c1d5b08":"code","0abee649":"code","d6ad498c":"code","505ac81c":"code","c21670e0":"code","7435f23c":"code","89acf569":"code","31ecc8ce":"code","64747f2e":"code","08c52850":"code","bcc8feec":"code","ff051914":"code","46c20638":"code","2996685c":"code","341aed27":"code","1c2e071c":"code","9ec5aa60":"code","cc9557c2":"code","e9a1ae41":"code","fe7e253c":"code","6043154f":"code","0cff50c4":"code","6c2126e0":"code","84349840":"code","9bea9896":"code","e060a396":"code","d0e8e378":"code","ac4854ce":"code","1194f527":"code","c4475ce5":"code","ad5349c3":"code","29584315":"code","0931bc5b":"code","8b60dba2":"code","a2dc8974":"code","76b34270":"code","669d3598":"code","5b0b8194":"code","32b5019d":"code","313644f3":"code","d6958d98":"code","15277657":"code","d7ab2319":"code","9934bbe8":"code","41ae9e90":"code","454bd10c":"code","f0d6882b":"code","5b5bbe0f":"code","ee8ab514":"code","ad95578d":"code","b9cbc4d1":"code","5e2ebf4d":"code","60ef473d":"code","7f927380":"code","0375a54c":"code","2af58c5a":"code","2f281154":"code","abd3e05b":"code","ee94c553":"code","3523c5a4":"code","28cb917e":"code","5b5d6bb6":"code","bf2cc3ec":"code","30f8f84f":"code","2bc6126a":"code","b5cda70d":"code","cb666ee6":"code","c9a23d0e":"code","355d86de":"markdown","a0547f24":"markdown","2d908c3c":"markdown","3df3e1f1":"markdown","680b0449":"markdown","948cbb6c":"markdown","e3ed3af3":"markdown","ba2135d1":"markdown","3feaf732":"markdown","95a94e49":"markdown","232fe880":"markdown","6b64ea06":"markdown","47f4a544":"markdown","c150476a":"markdown","dee6cc88":"markdown","b1fb08cb":"markdown"},"source":{"bcabbf9a":"!pip install bs4","7795e9e0":"from shapely.geometry import Point\nimport pandas as pd\nimport geopandas as gpd\nimport contextily\nimport folium\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nimport os\nfrom urllib.request import urlretrieve\nimport requests\nimport zipfile\nfrom bs4 import BeautifulSoup","257193c9":"sns.set(font_scale=1.4)\nsns.set_style({'font.family': 'serif',\n               'fontname': 'Times New Roman'})","3257832c":"df = pd.read_csv('..\/input\/queimadas-brasil-2020\/Focos_2020-01-01_2020-12-31.csv')","e105e70a":"type(df)","a80ccea4":"df.head()","0d11fa0b":"df.shape","5c6a8d7f":"geometry = [Point(xy) for xy in zip(df['longitude'], df['latitude'])]","c84c9c68":"queimadas_brasil_2020 = gpd.GeoDataFrame(df, crs='EPSG:4326', geometry=geometry)","38561c8b":"queimadas_brasil_2020.head()","4b4372ec":"queimadas_brasil_2020.shape","1981e34b":"type(queimadas_brasil_2020)","0baaf89a":"queimadas_brasil_2020 = queimadas_brasil_2020.to_crs(crs='EPSG:3857')","c29ddeec":"queimadas_brasil_2020.crs.to_string()","460a54a0":"queimadas_brasil_2020.head()","883a01da":"ax = queimadas_brasil_2020.plot(figsize=(15, 10), markersize=1, color='red')\ncontextily.add_basemap(ax)\nax.set_axis_off()\nplt.show()","fb7b05bf":"if not os.path.exists('\/kaggle\/working\/mapas'):\n    os.makedirs('\/kaggle\/working\/mapas')","0c567926":"url_brasil_malhas_municipios = 'https:\/\/geoftp.ibge.gov.br\/organizacao_do_territorio\/malhas_territoriais\/malhas_municipais\/municipio_2020\/Brasil\/BR\/BR_Municipios_2020.zip'","35f67e13":"%%time\n\nurlretrieve(url_brasil_malhas_municipios, '\/kaggle\/working\/mapas\/BR_Municipios_2020.zip')","b9e902f4":"with zipfile.ZipFile('\/kaggle\/working\/mapas\/BR_Municipios_2020.zip', 'r') as zip_ref:\n    zip_ref.extractall('\/kaggle\/working\/mapas\/')","d30387ea":"os.remove('\/kaggle\/working\/mapas\/BR_Municipios_2020.zip')","6f01475b":"brasil_malhas_municipios = gpd.read_file('\/kaggle\/working\/mapas\/BR_Municipios_2020.shp')","6c1d5b08":"brasil_malhas_municipios.shape","0abee649":"brasil_malhas_municipios.head()","d6ad498c":"brasil_malhas_municipios.iloc[0].geometry","505ac81c":"brasil_malhas_municipios.crs.to_string()","c21670e0":"brasil_malhas_municipios.to_crs(epsg=3857, inplace=True)","7435f23c":"brasil_malhas_municipios.crs.to_string()","89acf569":"ax = brasil_malhas_municipios.plot(figsize=(15, 10), edgecolor='black', facecolor='none')\ncontextily.add_basemap(ax)\nax.set_axis_off()\nplt.show()","31ecc8ce":"url_brasil_localidades = 'https:\/\/geoftp.ibge.gov.br\/organizacao_do_territorio\/estrutura_territorial\/localidades\/Shapefile_SHP\/'","64747f2e":"req = requests.get(url_brasil_localidades)","08c52850":"dados_ibge = BeautifulSoup(req.text, \"html.parser\")\ndados_ibge","bcc8feec":"%%time\n\nfor arq in dados_ibge.find_all('a'):\n    if 'BR_Localidades' in arq.get_text():\n        print(arq.get_text())\n        req = requests.get(url_brasil_localidades + arq[\"href\"])\n        print(req.status_code)\n        open('\/kaggle\/working\/mapas\/' + arq['href'], 'wb').write(req.content)","ff051914":"brasil_localidades = gpd.read_file('\/kaggle\/working\/mapas\/BR_Localidades_2010_v1.shp')","46c20638":"brasil_localidades.shape","2996685c":"brasil_localidades.head()","341aed27":"brasil_localidades.crs.to_string()","1c2e071c":"brasil_localidades.to_crs(epsg=3857, inplace=True)","9ec5aa60":"ax = brasil_localidades.plot(figsize=(15, 10), markersize=1, color='blue')\ncontextily.add_basemap(ax)\nax.set_axis_off()\nplt.show()","cc9557c2":"queimadas_brasil_2020.head()","e9a1ae41":"queimadas_brasil_2020['bioma'].unique()","fe7e253c":"plt.figure(figsize=(12,5))\nax = sns.countplot(x='bioma', data=queimadas_brasil_2020)\nax.set_xlabel('Bioma')\nax.set_ylabel('Qtd. de queimadas')\nplt.show()","6043154f":"ax = queimadas_brasil_2020.plot(figsize=(15, 10), column='bioma', markersize=1, legend=True)\ncontextily.add_basemap(ax)\nax.set_axis_off()\nplt.show()","0cff50c4":"queimadas_brasil_2020.head()","6c2126e0":"queimadas_brasil_2020['riscofogo'] == 1","84349840":"queimadas_risco_alto = queimadas_brasil_2020[queimadas_brasil_2020['riscofogo'] == 1]\nqueimadas_risco_alto.head()","9bea9896":"plt.figure(figsize=(12,5))\nax = sns.countplot(x='bioma', data=queimadas_risco_alto)\nax.set_xlabel('Bioma')\nax.set_ylabel('Qtd. de queimadas')\nplt.show()","e060a396":"ax = queimadas_risco_alto.plot(figsize=(15, 10), column='bioma', markersize=1, legend=True)\ncontextily.add_basemap(ax)\nax.set_axis_off()\nplt.show()","d0e8e378":"brasil_localidades.head()","ac4854ce":"brasil_localidades.columns","1194f527":"brasil_localidades['NM_CATEGOR'].unique()","c4475ce5":"plt.figure(figsize=(20,5))\nax = sns.countplot(x='NM_CATEGOR', data=brasil_localidades)\nax.set_xlabel('Categoria')\n\nlabels = [l.replace(' ', '\\n') for l in brasil_localidades['NM_CATEGOR'].unique()]\nax.set_xticklabels(labels=labels)\n\nax.set_ylabel('Quantidade')\nplt.show()","ad5349c3":"aldeias_indigenas = brasil_localidades[brasil_localidades['NM_CATEGOR'] == 'ALDEIA IND\u00cdGENA']\naldeias_indigenas.head()","29584315":"ax = aldeias_indigenas.plot(figsize=(15, 10), markersize=1, color='orange')\ncontextily.add_basemap(ax)\nax.set_axis_off()\nplt.show()","0931bc5b":"brasil_localidades[brasil_localidades['NM_UF'] == 'RORAIMA'].head()","8b60dba2":"ax = brasil_localidades[brasil_localidades['NM_UF'] == 'RORAIMA'].plot(figsize=(15, 10), markersize=20, column='NM_CATEGOR', legend=True)\ncontextily.add_basemap(ax)\nax.set_axis_off()\nplt.show()","a2dc8974":"aldeias_indigenas.head()","76b34270":"aldeia = aldeias_indigenas.loc[11, 'geometry']","669d3598":"dist_aldeia = queimadas_risco_alto.distance(aldeia)\ndist_aldeia","5b0b8194":"dist_aldeia.min()","32b5019d":"agregados = gpd.sjoin(queimadas_risco_alto, brasil_malhas_municipios, op='within')","313644f3":"agregados.head()","d6958d98":"queimadas_muni = agregados.groupby(by='NM_MUN').size()\nqueimadas_muni = queimadas_muni.sort_values(ascending=False)\nqueimadas_muni","15277657":"queimadas_muni_RR = agregados[agregados['SIGLA_UF'] == 'RR'].groupby(by='NM_MUN').size()\nqueimadas_muni_RR = queimadas_muni_RR.sort_values(ascending=False)\nqueimadas_muni_RR_df = queimadas_muni_RR.to_frame()\nqueimadas_muni_RR_df['MUN'] = queimadas_muni_RR_df.index.values\nqueimadas_muni_RR_df.columns = ['qtd_queimadas','MUN']\nqueimadas_muni_RR_df['AREA'] = 0\nqueimadas_muni_RR_df['NORM'] = 0\nqueimadas_muni_RR_df","d7ab2319":"for mun in queimadas_muni_RR_df['MUN'].unique():\n    print(mun)\n    print(agregados[agregados['NM_MUN'] == mun]['AREA_KM2'].values[0])\n    print(queimadas_muni_RR_df[queimadas_muni_RR_df['MUN'] == mun]['qtd_queimadas'].values[0])\n    print('--------')\n    \n    queimadas_muni_RR_df.at[mun, 'AREA'] = agregados[agregados['NM_MUN'] == mun]['AREA_KM2'].values[0]\n    queimadas_muni_RR_df.at[mun, 'NORM'] = agregados[agregados['NM_MUN'] == mun]['AREA_KM2'].values[0] \/ queimadas_muni_RR_df[queimadas_muni_RR_df['MUN'] == mun]['qtd_queimadas'].values[0]","9934bbe8":"queimadas_muni_RR_df","41ae9e90":"coord_centro_brasil = [-14.235004, -51.925282]","454bd10c":"mapa = folium.Map(location=coord_centro_brasil, zoom_start=4)\nmapa","f0d6882b":"queimadas_muni","5b5bbe0f":"queimadas_muni_df = queimadas_muni.to_frame()\nqueimadas_muni_df","ee8ab514":"queimadas_muni_df = queimadas_muni_df.reset_index()\nqueimadas_muni_df.columns = ['NM_MUN', 'qtd_queimadas']\nqueimadas_muni_df","ad95578d":"type(queimadas_muni_df)","b9cbc4d1":"queimadas_muni_geom_df = pd.merge(brasil_malhas_municipios, queimadas_muni_df, on='NM_MUN')\nqueimadas_muni_geom_df","5e2ebf4d":"type(queimadas_muni_geom_df)","60ef473d":"queimadas_muni_geom_RR_df = queimadas_muni_geom_df[queimadas_muni_geom_df['SIGLA_UF'] == 'RR']\nqueimadas_muni_geom_RR_df","7f927380":"folium.Choropleth(geo_data = queimadas_muni_geom_RR_df,\n                  name = 'geometry',\n                  data = queimadas_muni_geom_RR_df,\n                  columns = ['NM_MUN', 'qtd_queimadas'],\n                  key_on = 'feature.properties.NM_MUN',\n                  fill_color = 'YlGnBu',\n                  fill_opacity = 0.75,\n                  line_opacity = 0.5,\n                  legend_name = 'Quantidade de queimadas por munic\u00edpio').add_to(mapa)\n\nmapa","0375a54c":"mapa.save('queimadas_muni_RR_mapa.html')","2af58c5a":"queimadas_muni_RR_df","2f281154":"queimadas_muni_RR_geom_df = pd.merge(brasil_malhas_municipios[brasil_malhas_municipios['SIGLA_UF'] == 'RR'], \n                                     queimadas_muni_RR_df, on='NM_MUN')\nqueimadas_muni_RR_geom_df","abd3e05b":"coord_centro_brasil = [-14.235004, -51.925282]\nmapa = folium.Map(location=coord_centro_brasil, zoom_start=4)","ee94c553":"folium.Choropleth(geo_data = queimadas_muni_RR_geom_df,\n                  name = 'geometry',\n                  data = queimadas_muni_RR_geom_df,\n                  columns = ['NM_MUN', 'NORM'],\n                  key_on = 'feature.properties.NM_MUN',\n                  fill_color = 'Spectral',\n                  fill_opacity = 0.75,\n                  line_opacity = 0.5,\n                  legend_name = 'Quantidade de queimadas por munic\u00edpio').add_to(mapa)\n\nmapa","3523c5a4":"mapa.save('queimadas_muni_RR_NORM_mapa.html')","28cb917e":"agregados = gpd.sjoin(queimadas_risco_alto, brasil_malhas_municipios, op='within')\nagregados.head()","5b5d6bb6":"queimadas_muni = agregados.groupby(by=['NM_MUN','bioma']).size()\nqueimadas_muni = queimadas_muni.sort_values(ascending=False)\nqueimadas_muni","bf2cc3ec":"queimadas_muni_df = queimadas_muni.to_frame()\nqueimadas_muni_df","30f8f84f":"queimadas_muni_df = queimadas_muni_df.reset_index()\nqueimadas_muni_df.columns = ['NM_MUN', 'Bioma', 'qtd_queimadas']\nqueimadas_muni_df","2bc6126a":"queimadas_muni_geom_df = pd.merge(brasil_malhas_municipios, queimadas_muni_df, on='NM_MUN')\nqueimadas_muni_geom_df","b5cda70d":"coord_centro_brasil = [-14.235004, -51.925282]\nmapa = folium.Map(location=coord_centro_brasil, zoom_start=4)","cb666ee6":"folium.Choropleth(geo_data = queimadas_muni_geom_df[queimadas_muni_geom_df['Bioma'] == 'Pantanal'],\n                  name = 'Bioma: Pantanal',\n                  data = queimadas_muni_geom_df[queimadas_muni_geom_df['Bioma'] == 'Pantanal'],\n                  columns = ['NM_MUN', 'qtd_queimadas'],\n                  key_on = 'feature.properties.NM_MUN',\n                  fill_color = 'YlGnBu',\n                  fill_opacity = 0.75,\n                  line_opacity = 0.5,\n                  legend_name = 'Quantidade de queimadas por munic\u00edpio (Pantanal)').add_to(mapa)\n\nfolium.Choropleth(geo_data = queimadas_muni_geom_df[queimadas_muni_geom_df['Bioma'] == 'Cerrado'],\n                  name = 'Bioma: Cerrado',\n                  data = queimadas_muni_geom_df[queimadas_muni_geom_df['Bioma'] == 'Cerrado'],\n                  columns = ['NM_MUN', 'qtd_queimadas'],\n                  key_on = 'feature.properties.NM_MUN',\n                  fill_color = 'YlGnBu',\n                  fill_opacity = 0.75,\n                  line_opacity = 0.5,\n                  legend_name = 'Quantidade de queimadas por munic\u00edpio (Cerrado)').add_to(mapa)\n\nfolium.LayerControl().add_to(mapa)","c9a23d0e":"mapa.save(\"biomas_queimadas_mapa.html\")","355d86de":"### 1.1) Queimadas no Brasil em 2020\n\n* Fonte: [Instituto Nacional de Pesquisas Espaciais (INPE)](http:\/\/queimadas.dgi.inpe.br\/queimadas)","a0547f24":"### 3.2) Agregando dados de duas camadas","2d908c3c":"### 2.3) Entendendo as categorias das localidades","3df3e1f1":"### 3.1) Verificando dist\u00e2ncias entre dados de duas camadas","680b0449":"### 1.2) Malhas municipais do Brasil\n\n* Fonte: [Instituto Brasileiro de Geografia e Estat\u00edstica (IBGE)](https:\/\/www.ibge.gov.br\/geociencias\/downloads-geociencias.html)","948cbb6c":"### 2.2) Filtrando e visualizando o risco de fogo","e3ed3af3":"### 3.3) Normalizando os dados: Exemplo com RR","ba2135d1":"### 1.3) Localidades brasileiras\n\n* Fonte: [Instituto Brasileiro de Geografia e Estat\u00edstica (IBGE)](https:\/\/www.ibge.gov.br\/geociencias\/downloads-geociencias.html)","3feaf732":"### 4.2) Visualizando biomas em camadas","95a94e49":"## 4) Trabalhando com o mapas interativos","232fe880":"## 1) Fontes de dados","6b64ea06":"### 4.1) Visualizando queimadas por meio de mapas coropl\u00e9ticos","47f4a544":"### 2.1) Queimadas e biomas","c150476a":"# An\u00e1lise de Queimadas no Brasil (2020)\n\n## Resumo\n\nNeste notebook, iremos explorar dados territoriais e de queimadas no Brasil utilizando a linguagem Python e as bibliotecas Folium, Shapely e GeoPandas.","dee6cc88":"## 2) O que podemos extrair de informa\u00e7\u00f5es dos dados?","b1fb08cb":"## 3) Trabalhando com camadas de dados"}}