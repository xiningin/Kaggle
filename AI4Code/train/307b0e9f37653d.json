{"cell_type":{"70216f7f":"code","761976f9":"code","6e7dc9af":"code","5507c638":"code","d197910b":"code","f5476fa4":"code","8d665f95":"code","61a6cde6":"code","33c8c987":"code","7c0b8541":"code","3e2cc958":"code","2d41ebf2":"code","76c213a5":"code","e20bab68":"code","dfd46b57":"code","6331663f":"code","1db51565":"code","5ba235a0":"code","afb9b871":"code","23a0afdb":"code","6db53c8a":"code","b2e89212":"code","2cc98762":"code","e156a2d2":"code","3bed655d":"code","d82d653d":"code","7b03ad2a":"code","92f2dd8d":"code","fb30de39":"code","97cdb665":"code","427446d6":"code","39a88bd3":"code","b6295a9f":"code","e9389c8a":"code","64b08c2b":"code","a000677d":"code","6ff3e4ab":"code","73dec7dc":"code","3cb27bef":"code","a66e1eae":"code","21315018":"code","477c4bfb":"code","9090204b":"code","040b5611":"code","e461537a":"code","a5f44125":"code","286c3e20":"code","17df49a0":"markdown","4ac1b3d7":"markdown","5f16029a":"markdown","e1be7f9b":"markdown","4ec8d07d":"markdown","2ef52f61":"markdown","23109f8d":"markdown","4285180c":"markdown","50ae3442":"markdown","d61e008b":"markdown","04e0b80c":"markdown","7be6460b":"markdown","11ba2861":"markdown","fbf3582b":"markdown","13ba0566":"markdown","79516485":"markdown","5362583f":"markdown","2eceae9a":"markdown","79ac437b":"markdown","c31ba7fb":"markdown","0bfe1038":"markdown","fa407cb3":"markdown","a92d2166":"markdown","44fd3bcd":"markdown","7e174f1d":"markdown","160e8af6":"markdown","9aab0c6a":"markdown","21f85e9d":"markdown","f887f1a0":"markdown","7e117246":"markdown","6795d376":"markdown","0c9d2d4c":"markdown","0d25ef1c":"markdown","703699f4":"markdown","34c17280":"markdown","1d95845d":"markdown","0e712c1e":"markdown","cb846d66":"markdown","da1c6a00":"markdown","2d63ba3c":"markdown","69f85ad9":"markdown","2ec404d4":"markdown","15fe9785":"markdown","fcc2371e":"markdown","345f3421":"markdown","bec113f9":"markdown","2416a5ee":"markdown","b2f94397":"markdown","9469ba47":"markdown","f053a237":"markdown","236e79a0":"markdown","2eed9414":"markdown","1be5c22f":"markdown","8bfb8070":"markdown","e1dc44c7":"markdown","d694c121":"markdown","c3b82491":"markdown","2c1b2325":"markdown","18df4a0e":"markdown","dcc54bf1":"markdown","9b5fa78e":"markdown","ea0ab761":"markdown"},"source":{"70216f7f":"import pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport numpy as np","761976f9":"from sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.model_selection import cross_val_score\nfrom sklearn.metrics import accuracy_score\nfrom sklearn import preprocessing\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.impute import KNNImputer","6e7dc9af":"adult_train = pd.read_csv('..\/input\/adult-pmr3508\/train_data.csv', na_values='?')\nadult_train.set_index('Id',inplace=True)\n\nadult_test = pd.read_csv('..\/input\/adult-pmr3508\/test_data.csv', na_values='?')\nadult_test.set_index('Id', inplace=True)\n\nnewnames = {\n    \"education.num\" : \"education_num\",\n    \"marital.status\" : \"marital_status\",\n    \"capital.gain\" : \"capital_gain\",\n    \"capital.loss\" : \"capital_loss\",\n    \"hours.per.week\" : \"hours_per_week\",\n    \"native.country\" : \"native_country\"\n}\n\nadult_train = adult_train.rename(columns = newnames)\nadult_test = adult_test.rename(columns = newnames)\n\nprint(adult_train.shape)\nprint(adult_test.shape)","5507c638":"adult_train.head()","d197910b":"adult_test.head()","f5476fa4":"adult_train.isnull().sum().sort_values(ascending = False)","8d665f95":"adult_train = adult_train.apply(lambda x:x.fillna(x.value_counts().index[0]))\nadult_train.isnull().sum().sort_values(ascending = False)","61a6cde6":"adult_test.isnull().sum().sort_values(ascending = False)","33c8c987":"adult_test = adult_test.apply(lambda x:x.fillna(x.value_counts().index[0]))\nadult_test.isnull().sum().sort_values(ascending = False)","7c0b8541":"print(adult_train.shape)\nprint(adult_test.shape)","3e2cc958":"adult_train.sample(5)","2d41ebf2":"adult_train.info()","76c213a5":"adult_train.describe()","e20bab68":"adult_train['native_country'].value_counts()","dfd46b57":"is_us = adult_train['native_country'].map(lambda x: x=='United-States')\nis_us.value_counts().plot(kind='pie',autopct='%1.0f%%')","6331663f":"adult_train['capital_gain'].value_counts()","1db51565":"adult_train['capital_loss'].value_counts()","5ba235a0":"cg0 = adult_train['capital_gain'].map(lambda x: x==0)\ncg0.value_counts().plot(kind='pie',autopct='%1.0f%%')","afb9b871":"cl0 = adult_train['capital_loss'].map(lambda x: x==0)\ncl0.value_counts().plot(kind='pie',autopct='%1.0f%%')","23a0afdb":"sns.violinplot(x='sex', y='age', hue='income', data=adult_train, split=True)","6db53c8a":"sns.barplot(x='income', y='hours_per_week', data=adult_train)","b2e89212":"sns.barplot(x='income', y='education_num', data=adult_train, hue='sex')","2cc98762":"sns.barplot(x='income', y='education_num', data=adult_train)","e156a2d2":"def barplot_percent(x_axis,hue):\n  x,y = hue, x_axis\n\n  df1 = adult_train.groupby(x)[y].value_counts(normalize=True)\n  df1 = df1.mul(100)\n  df1 = df1.rename('percentage').reset_index()\n\n  g = sns.catplot(x=y,y='percentage',hue=x,kind='bar',data=df1)\n  g.ax.set_ylim(0,100)","3bed655d":"barplot_percent('income','sex')","d82d653d":"barplot_percent('income', 'race')","7b03ad2a":"barplot_percent('income', 'occupation')","92f2dd8d":"barplot_percent('income','workclass')","fb30de39":"adult_test.sample(5)","97cdb665":"adult_test.info()","427446d6":"adult_test.describe()","39a88bd3":"x = adult_train[['age','education_num','capital_gain', 'capital_loss', 'hours_per_week']]\ny = adult_train['income']\n\nSEED = 158020\nnp.random.seed(SEED)\nxtrain, xtest, ytrain, ytest = train_test_split(x, y, test_size = 0.25,\n                                                         stratify = y)","b6295a9f":"knn = KNeighborsClassifier(n_neighbors=3)\n\nscores = cross_val_score(knn, xtrain, ytrain, cv=10)\nscores.mean()","e9389c8a":"knn.fit(xtrain,ytrain)\npredict = knn.predict(xtest)\npredict","64b08c2b":"accuracy_score(ytest,predict)","a000677d":"numadult_train = adult_train[['age','workclass','education_num','capital_gain',\n                      'capital_loss', 'hours_per_week','marital_status',\n                      'occupation','relationship','race','sex']].apply(preprocessing.LabelEncoder().fit_transform)\nnumadult_train","6ff3e4ab":"def predict_model(n):\n  x = numadult_train\n  y = adult_train['income']\n\n  SEED = 158020\n  np.random.seed(SEED)\n  xtrain, xtest, ytrain, ytest = train_test_split(x, y, test_size = 0.25,\n                                                          stratify = y)\n  \n  scaler = StandardScaler()\n  scaler.fit(xtrain)\n  xtrain = scaler.transform(xtrain)\n  xtest = scaler.transform(xtest)\n\n  knn = KNeighborsClassifier(n_neighbors=n)\n  knn.fit(xtrain,ytrain)\n  scores = cross_val_score(knn, xtrain, ytrain, cv=10)\n  return scores.mean()","73dec7dc":"x=[]\nfor i in range(1,40):\n  x.append(predict_model(i))","3cb27bef":"plt.plot(x)","a66e1eae":"predict_model(18)","21315018":"adult_test.sample(10)","477c4bfb":"numadult_test = adult_test[['age','workclass','education_num','capital_gain',\n                      'capital_loss', 'hours_per_week','marital_status',\n                      'occupation','relationship','race','sex']].apply(preprocessing.LabelEncoder().fit_transform)\nnumadult_test","9090204b":"x = numadult_train\ny = adult_train['income']\n\nSEED = 158020\nnp.random.seed(SEED)\nxtrain, xtest, ytrain, ytest = train_test_split(x, y, test_size = 0.25,\n                                                          stratify = y)\n  \nscaler = StandardScaler()\nscaler.fit(xtrain)\nxtrain = scaler.transform(xtrain)\nxtest = scaler.transform(xtest)\n\nknn = KNeighborsClassifier(n_neighbors=18)\nknn.fit(xtrain,ytrain)\npredict = knn.predict(xtest)\naccuracy_score(ytest,predict)","040b5611":"scaler = StandardScaler()\nscaler.fit(numadult_test)\nxadult_test = scaler.transform(numadult_test)\n\nimputer = KNNImputer(n_neighbors=18)\nimputer.fit(xtrain)\nxadult_test = imputer.transform(xadult_test)","e461537a":"predict = knn.predict(xadult_test)\nlen(predict)","a5f44125":"submission = pd.DataFrame()\nsubmission[0] = adult_test.index\nsubmission[1] = predict\nsubmission.columns = ['Id','income']\nsubmission['income'].value_counts()","286c3e20":"submission.to_csv('my_submission.csv',index = False)","17df49a0":"Now let's take a look on the first 5 rows of the \"adult_train\" dataset.","4ac1b3d7":"There are 6 numerical columns: \"age\", \"fnlwgt\", \"education_num\", \"capital_gain\", \"capital_loss\" and \"hours_per_week\". The rest are filled with labels for \"native_country\", \"sex\", \"race\", etc","5f16029a":"First, let's see how many null values there are in each column of the \"adult_train\" dataset","e1be7f9b":"The plot shows us that around 90% of \"Female\" subjects and 70% of \"Male\" subjects earn less than 50K, highlighting the impact of sex on income","4ec8d07d":"By what we can observe, the \"adult_test\" dataset has similar information to the \"adult_train\" dataset, meaning that our prediction model will be appropriated for our final objective","2ef52f61":"# PMR3508 - Aprendizado de M\u00e1quina e Reconhecimento de Padr\u00f5es\n\nAuthor: Gabriel Pinheiro Date: 10 \/ 09 \/ 2020","23109f8d":"The mean from the cross validation method gives us around 80.8% accuracy","4285180c":"Knowing that, we are going to use the \"most common\" method to fill these null values","50ae3442":"After all that, we can see that the shape of both datasets remain untouched","d61e008b":"After that we have to decide which informations are necessary to our model, and which arent. Through many tests, we discovered that the columns \"fnlwgt\", \"education\" and \"native_country\" don't help making the model more accurate.\n\nFinally, we'll define a function that uses: \"age\", \"workclass\", \"education_num\", \"capital_gain\", \"capital_loss\", \"hours_per_week\", \"marital_status\", \"occupation\", \"relationship\", \"race\" and \"sex\" to predict the \"income\".","04e0b80c":"Next, let's create a new DataFrame to populate with our predictions","7be6460b":"With k = 18 we get around 85.2% of accuracy, this is a 4.4% increase from the primitive model.","11ba2861":"On average, people that earn less than 50K work 40 hours per week, while people that earn more than 50K work around 46 hours per week. It seems that people earning less than 50K are employed on regular jobs (9 to 5 jobs) whilst the other group have more fluid work hours.","fbf3582b":"And finally, we submit our newly created DataFrame as \"submission.csv\"","13ba0566":"And these are the libraries that will be used to build the prediction model","79516485":"## 2.Data import\nIn this next section both datasets are going to be imported, \"adult_train\" represents \"train_data.csv\" and \"adult_test\" represents \"test_data.csv\". Notice that the \"adult_train\" dataset has both more columns and more rows than the \"adult_test\".","5362583f":"As we can see on the graph, \"Female\" subjects tend to have a higher education on their income group if compared to the \"Male\" subjects, this evidenciates the inequality of payment between both sex groups.","2eceae9a":"Now we take a look on the 5 first rows of the \"adult_test\" dataset","79ac437b":"In the function \"predict_model\" we use the preprocessing function \"StandadScaler\" so we can create a more accurate model","c31ba7fb":"Next, we'll analyze the impact of race on income","0bfe1038":"By what we can observe from the violin plot, both \"Male\" and \"Female\" subjects start to earn an income grater than 50K when they get closer to 40 years of age. On the 20 years mark, it seems that the vast majority earns less than 50K. ","fa407cb3":"For the following plots, we are going to bulid a function that shows relations by percentage","a92d2166":"As we can see, government workers and people in the \"Self-emp-inc\" group tend to earn more than 50K","44fd3bcd":"For this next analysis, we are going to see the impact of age to the income result","7e174f1d":"### 4.1 \"Train\" dataset\nBecause we are going to base our model on the \"adult_train\" dataset, it's going to receive a more robust analysis compared to the \"adult_test\" dataset","160e8af6":"The \"predict\" is an array filled with \">50K\" and \"<=50K\". Let's see it's accuracy","9aab0c6a":"With the function \"barplot_percent\" defined, we can take a look on how the groups \"Female\" and \"Male\" are distributed by income","21f85e9d":"## 5. Submission\nNow for our submission. First we need to transform all the columns in the dataset \"adult_test\" in numerical ones","f887f1a0":"By what we saw on the column \"native_country\", it seems that there is a predominance of individuals from the USA.","7e117246":"Now, let's observe the impact of occupation on the income","6795d376":"Now, we're going to analyse how the income is affected by sex and education","0c9d2d4c":"As we already know, only the \"income\" column is missing, but let's see if this dataset has the same general information","0d25ef1c":"Next, we are going to create models with different K values, with this we will discover what's the optimal number of nearest neighbours","703699f4":"Next, we are going to build our model with k = 18","34c17280":"The previous graph shows us that \"Exec-managerial\" and \"Prof-specialty\" stand out by having more than 40% of it's individuals earning more than 50K","1d95845d":"As we can see, both datasets have the same columns, except for one: \"income\". This column will be built by our prediction model later on.","0e712c1e":"As we can see the accuracy hasn't really changed from our previous test","cb846d66":"As expected, people with a higher education generally earn more than 50K","da1c6a00":"Our suspection is confirmed by these last graphs","2d63ba3c":"## 3.Treating missing data\nNext, we'll be treating any missing data from our dataset","69f85ad9":"To conclude this section, let's take a look on how income and workclass relate to each other","2ec404d4":"Now let's see our model doing the predictions","15fe9785":"## 4. Data analysis","fcc2371e":"### 5.2 Bettering the model\nNow, to build a more robust model, we first need to make all the columns we are going to use, in numerical columns","345f3421":"Creating the model for k = 3, and testing it with cross_val_score, also from sklearn","bec113f9":"First of all, let's get a random sample from the \"adult_train\" dataset, just so we can remember it's rows and columns","2416a5ee":"## 5. Model training\nAfter understanding our datasets, we can finally build our prediction model. For this we'll be using the KNN method. We'll be using KNeighborsClassifier() from sklearn to build our models","b2f94397":"### 5.1 Primitive model training","9469ba47":"Next, we are going to take a look on the \"capital_gain\" and \"capital_loss\" columns, because it seems that there is a grater appearance of \"0\" values for both columns","f053a237":"Firstly, we are going to build a really simple model, just to get a primitive result","236e79a0":"We are only going to work with the numerical columns for this first model","2eed9414":"Then we'll use \".info()\" to get some general information","1be5c22f":"Next, we'll analyze the effect of education on the income","8bfb8070":"In this notebook we'll be analysing the Adult dataset. With this we'll try to understand the dataset and how it represents the world around us. Then we'll use that information to build a model that predicts the income of any given individual.","e1dc44c7":"## 1. Importing Libraries\nThe following libraries will be used for the data analysis section of the notebook","d694c121":"This number is really close to what we got through the cross validation method","c3b82491":"As we can see, we filled all null values from \"adult_train\". Now let's do the same thing with the \"adult_test\" dataset","2c1b2325":"### 4.2 \"Test\" dataset\nNow, let's take a observe how the \"adult_test\" dataset is built","18df4a0e":"Also, we are going to use \".describe()\" some important statistical information about the numerical columns","dcc54bf1":"Next, we'll see how hours worked per week impact on the income","9b5fa78e":"The last conclusion is corroborated by the previous graph. As we can see, 91% of the people on this dataset are american citizens","ea0ab761":"On this case, \"Asian-Pac-Islander\" and \"White\" subjects have a similar distribution between income, around 30% of them earn more than 50K. In comparison, \"Black\", \"Amer-Indian-Eskimo\" and \"Other\" subjects are highly condensed on the \"<=50K\" group"}}