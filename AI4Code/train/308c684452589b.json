{"cell_type":{"a415a5f2":"code","6b31d184":"code","1f92c067":"code","6890a4c5":"code","d04b2ab5":"code","a3b2952a":"code","9131d58d":"code","350082ce":"code","aa24e823":"code","7e3a0306":"code","75d353d0":"code","fd2b0b7f":"code","6ca28a05":"code","be8a6b99":"code","4749a7b8":"code","4338862d":"code","4c6f61c6":"code","6e68757f":"code","9a508205":"code","0f3a51db":"code","67472c24":"code","26c2a986":"code","62f23de7":"code","1bf439f7":"markdown","25fcef4b":"markdown","8e1ebdf2":"markdown","0f891369":"markdown","03c6e3d5":"markdown","580b5666":"markdown","e650b522":"markdown","ad6ae076":"markdown","e743fd6f":"markdown","11ca54b8":"markdown","12258a38":"markdown","fb39ed94":"markdown","17984f82":"markdown","d1c00892":"markdown","42221348":"markdown","f8cab0f3":"markdown","93a601e6":"markdown","1958834f":"markdown","8976ca64":"markdown","48ce927e":"markdown","cc62cccd":"markdown"},"source":{"a415a5f2":"import pandas as panda\nimport numpy as np\n\n## lets create a very simple data frame\n\nanimals = ['horse','cat','dog','tiger','whale','dog','tiger','horse','cat','rat','cat']\nweight = [245,12,15,200,780,17,176,234,12,9,15]\nage = [14,15,4,17,34,2,21,21,2,5,15]\na = panda.DataFrame(\n    {\n        'animal': animals,\n        'weight': weight,\n        'age' : age,\n        # 'color' : ['']\n\n    }\n)\n\na","6b31d184":"group_by_animal = a.groupby(by = ['animal'])\n\n## groupby returns pandas.core.groupby.DataFrameGroupBy or SeriesGroupBy\n## when resultant is multi columns - DataFrameGroupBy\n## when resultant is single column - SeriesGroupBy\n## try this and see a = panda.DataFrame({'id':np.random.randint(1,10,(6))})\n##a.groupby(by=['id'])\n\nprint(type(group_by_animal)) ## \n","1f92c067":"\n## what if i want to know the group names\nprint('\\n The group names are :',group_by_animal.groups.keys())\n","6890a4c5":"\n##what if i want to know how the grouping has been done\n## essentially which are the groups..which indices form those groups\nprint('\\n My different groups and the indices they belong to :',group_by_animal.groups)\n\n","d04b2ab5":"\n## how do i view the groupby.. one very simple method is list\nprint('\\n i would like to see the group : \\n' , list(group_by_animal))\n","a3b2952a":"\n## view by iterating\n\nfor name, group in group_by_animal:\n    print('\\n Group name: ', name , ' \\n group is :', group)","9131d58d":"group_by_animal_and_age = a.groupby(['animal','age'])\n\nfor name, group in group_by_animal_and_age:\n    print('\\n name is :', name)\n    print('\\n group is : \\n', group)","350082ce":"i_know_group_key = 'cat'\ni_know_another_group_key = ('whale', 34)\nprint(group_by_animal.get_group(i_know_group_key),'\\n\\n', group_by_animal_and_age.get_group(i_know_another_group_key))","aa24e823":"\n\n## group_by_animal['age'] is simple syntactic sugar.\n\ngroup_by_animal['age'].max()","7e3a0306":"\n# or you may you aggregate\ngroup_by_animal['age'].agg(np.max)","75d353d0":"## example using aggregate\ngroup_by_animal['age'].aggregate(np.max)","fd2b0b7f":"## pass in a list of aggregation function in the add parameter\ngroup_by_animal['age'].agg([np.max, np.mean])","6ca28a05":"## you will notice in the above example that our group keys becomes our index.\n## If you would like to change that, simply use reset_index\ngroup_by_animal['age']\\\n    .agg([np.max, np.mean])\\\n        .reset_index()\n","be8a6b99":"# i do not like the column names of the output .\n# i would like to give it my own column names\n\ngroup_by_animal['age'].agg({'i_am_the_max_age':np.max,'i_am_the_mean_age':np.mean})","4749a7b8":"# another way to rename the columns using method chaining\n\ngroup_by_animal['age']\\\n    .agg([np.max, np.mean])\\\n        .rename(columns = {'amax':'i am the max age', 'mean': 'i am the mean age'})\\\n            .reset_index()","4338862d":"my_own_custom = lambda x : np.mean(x)-10\ngroup_by_animal['age']\\\n        .agg({'max':np.max,'mean':np.mean,'mean_minus_10':my_own_custom})\\\n            .reset_index()","4c6f61c6":"group_by_animal_and_age['weight'].agg(np.max)","6e68757f":"group_by_animal_and_age['weight'].agg(np.max).reset_index()","9a508205":"mean_age = group_by_animal['age']\\\n        .agg({'mean_age':np.mean})\\\n                .reset_index()\nprint(mean_age.shape, a.shape) ## you will see very clearly how the row counts differ\n\nprint(mean_age)","0f3a51db":"## we merge the mean back with the original data set\nb = a.merge(mean_age, how='inner', on='animal')\nb['diff_in_age_with_mean'] = b.age -b.mean_age\nb","67472c24":"a[\"diff_in_age_from_mean\"] = group_by_animal[\"age\"].transform(lambda x: x -x.mean())\na","26c2a986":"a.index = a.animal\na","62f23de7":"def is_animal_ending_with_at(animal_name):\n    if animal_name.endswith('at'):\n        return 'animals_ending_with_at'\n    else:\n        return 'other animals'\n\nlist(a.groupby(by = is_animal_ending_with_at))\n    ","1bf439f7":"**Quick Tip: ****what you see above is an example of method chaining","25fcef4b":"### **1. I would like to group  by the animal breed**\n\nThis is a simple .groupby(by=['list of columns'] operation. What we will learn?\n* the returned type\n* how the returned type changes\n* how to display the group names\n* how to display the group itself","8e1ebdf2":"*What is happening in the above syntax?? How are we achieving everything in one single line of code???*\n\ntransform function : achieves a combination effect on the grouped by splits. Specifically, it achieves a transformation on the whole data set  ensuring the output shape is same as the input shape. The way to think of transformation is :\n\n1. groupby divides data in chunks\n2. transform combines the chunks while applying some transformation. in our case it subtracts from the mean age","0f891369":"### **8. I would like to display how the age differs from the mean age of animals**\n\nThis is a tricky part. If you look at the query a second time, there are two things:\n\n1. It requires a group by. since we need to find mean\n2. The resultant dataset needs to be same as original data set , since we need to show diff between age and mean age\n3. NOTE: groupby will mostly reduce the len of datasets\n\nWe will see two different ways of achieving the same result","03c6e3d5":"***Useful Trick* **: groupby returns data by default sorted according to order of appearance. If you do not need a sorted appearance send sorted = False (eg a.groupby(by =['animal'],sorted=False) . This will improve performance","580b5666":"Total List of Aggregate Functions\n\n\n**Function\t : Description** <br>\nmean()\t     :Compute mean of groups <br>\nsum()\t      :Compute sum of group values<br>\nsize()\t       :Compute group sizes<br>\ncount()\t      :Compute count of group<br>\nstd()\t        :Standard deviation of groups<br>\nvar()\t        :Compute variance of groups<br>\nsem()\t      :Standard error of the mean of groups<br>\ndescribe()\t:Generates descriptive statistics<br>\nfirst()\t         :Compute first of group values<br>\nlast()\t        :Compute last of group values<br>\nnth()\t       :Take nth value, or a subset if n is a list<br>\nmin()\t      :Compute min of group values<br>\nmax()\t     :Compute max of group values<br>","e650b522":"### **9. How can we group using our own custom function**\n\nPandas support grouping by a callable. One big caveat though: callable function runs on the index of the dataframe\n\nTo look at this example, we will change our animal data set such that indices are no longer RangeIndex but infact the animal name","ad6ae076":"# Panda Group by:  all about group by","e743fd6f":"### **4. I would like to display max age by animal : First Technique**\n\nThis is a clear call to aggregation. When you hear words like max,count, mean,sum,etc in a query immediately think of grouping by and then running an aggregation function","11ca54b8":"### **6. I would like to display max age by animal and my own custom function**\n\n","12258a38":"### **2. I would like to group  by the animal breed and age **","fb39ed94":"### **7. I would like to display max weight of  data grouped by animal and age **","17984f82":"***Jumping right into code...***","d1c00892":"Just like max, you can use many other aggregation functions such as sum\/count\/mean\/std deviation, etc. ","42221348":"### **4. I would like to display max age by animal : Second Technique**\n","f8cab0f3":"### **5. I would like to display max age by animal and the mean age as well**\n\nThis is a clear call to two aggregation on same data set. Lets see how we can use agg() function to achieve the result","93a601e6":"While there is absolutely nothing wrong with the above approach, we have to be careful while using merge. Merge is computationally expensive and for larger datasets can lead to out of memory error\n\nLets look at a builtin panda technique","1958834f":"### **3. I would like to display group where i know the group name\/key **\n","8976ca64":"## Things you will learn:\n\n* **how to group by a single column**\n* **how to group by multiple columns**\n* ** what do i get when i run a groupby operation**\n* **what kind of operations can i execute on the returned groupby object**\n* **how can i aggregate my data**\n* **how can i aggregate and use custom names for the resultant columns**\n* **how can i aggregate based on my own custom function**\n* **how can i change the multi indexed structure to simple table when i aggregate on multi column group by**\n* **how can i apply a transformation**\n* **how can i group by using my own custom function**","48ce927e":"You can see above that the data is presented in hierarchical format, since we have grouped by two columns.\nHow can we fix that? easy.. use reset index","cc62cccd":"You cant ever work on data without coming across the need to aggregate. If you are working with pandas, it means you will have to work with GroupBy Objects. \n\nPandas groupby is interesting..by that i mean it can be deceptively simple. You think you know everything ..and BAM!! something new comes along\n\nI promise , once you read this, you will know all about group by operations .(except multi index ..coz i hate hateeee hierarchical data :) )\n\n"}}