{"cell_type":{"8fc99ac3":"code","e6b654d0":"code","81ef614b":"code","f2aa07c7":"code","4fabf2b3":"code","fd6f4fe9":"code","feb5568c":"code","f5c2f2df":"code","d9ea4641":"code","858acf5a":"code","99bc5ce6":"code","1dfd7e06":"code","d50c1cc2":"markdown","247a0c72":"markdown","5246999b":"markdown"},"source":{"8fc99ac3":"import pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport os\nfrom sklearn.model_selection import train_test_split\nprint(os.listdir(\"..\/input\"))","e6b654d0":"df = pd.read_csv('..\/input\/PS_20174392719_1491204439457_log.csv')\nprint(df.shape)\ndf = df.rename(columns={'oldbalanceOrg':'oldBalanceOrigin', 'newbalanceOrig':'newBalanceOrigin',\"step\":\"time\", \\\n                        'oldbalanceDest':'oldBalanceDestination', 'newbalanceDest':'newBalanceDestination', \"isFlaggedFraud\":\"flag_rule_fraud_largeTransaction\"})\ndf.head()","81ef614b":"df['time'] = pd.to_datetime(\"01\/01\/2017\") + pd.to_timedelta(df['time'], unit='h')\ndf['time'].sample(5)","f2aa07c7":"df_train, df_test = train_test_split(df, stratify=df.isFraud, test_size=0.05)","4fabf2b3":"print(df_test.shape)\nprint(df_test.isFraud.sum())\n# df_test.isFraud.describe()","fd6f4fe9":"df_pos = df_train.loc[(df_train.isFraud == 1) | (df_train.flag_rule_fraud_largeTransaction == 1) ]\nprint(df_pos.shape)\ndf_neg = df_train.loc[(df_train.isFraud == 0) ]\nprint(df_neg.shape)\n\ndf_neg = df_neg.sample(frac=0.05)\nprint(df_neg.shape)","feb5568c":"df_train = pd.concat([df_pos,df_neg]).sample(frac=0.3)\nprint(\"downsampled, subsampled train data size:\", df_train.shape )\nprint(\"subsampled Fraud cases: \",df_train.isFraud.sum())","f5c2f2df":"# customers OR merchants can be in orig or Dest for this dataset (unlike BankSim)\ncustomer_sampled = set(df_train.nameOrig).union(set(df_test.nameOrig)).union(set(df_test.nameDest)).union(set(df_test.nameDest))\nlen(customer_sampled)","d9ea4641":"print(\"full data:\",df.shape[0])\ndf_context = df.loc[(df.nameOrig.isin(customer_sampled)) | (df.nameDest.isin(customer_sampled))]\nprint(df_context.shape[0])","858acf5a":"df_train.tail(3)","99bc5ce6":"df_train.to_csv(\"Train-creditcardsfraud_sampled.csv.gz\",index=False,compression=\"gzip\")\ndf_test.to_csv(\"Test-creditcardsfraud.csv.gz\",index=False,compression=\"gzip\")","1dfd7e06":"df_context.to_csv(\"context_filtered_OrigDest.csv.gz\",index=False,compression=\"gzip\")","d50c1cc2":"## Downsample data for modelling\n* We will keep a test set with the original distribution","247a0c72":"##### Save\/export our data\n\n* We may wish to get also the transactions for all customers +- merchants in the downsampled train\/test data *only* for creating features. ","5246999b":"## Convert steps to time\n* Each step is ~ 1 hour. Set arbitrary start time\n* https:\/\/stackoverflow.com\/questions\/46081457\/pandas-add-seconds-from-a-column-to-datetime-in-other-column"}}