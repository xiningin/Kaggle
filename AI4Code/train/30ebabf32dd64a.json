{"cell_type":{"d389eab4":"code","27a8b024":"code","6b1bb652":"code","9528f12a":"code","5b27fb33":"code","6fd4182d":"code","1fcf9df7":"code","b9b0acad":"code","daa3ef0b":"code","a5451ba5":"code","72333ce4":"code","09a53986":"code","b11cfe98":"code","d4615a3f":"code","041a352a":"code","e24e6429":"code","342d3f3d":"code","301e21a0":"code","280ae89b":"code","8eed1fdf":"code","c7f41be1":"code","3b0205d6":"code","de319bc9":"code","3c0d42d3":"code","40c20f56":"code","32bb48fd":"code","15a11791":"markdown","7c35e3e6":"markdown","71b7cc1a":"markdown","6b7745a8":"markdown","59eff60d":"markdown","607ccf96":"markdown","d9427bb0":"markdown","1c1d5db1":"markdown","e24bd81a":"markdown","f88424a7":"markdown"},"source":{"d389eab4":"import warnings\nwarnings.filterwarnings('ignore')","27a8b024":"from google.cloud import bigquery\n\n# Create a \"Client\" object\nclient = bigquery.Client()\n\n# Construct a reference to the \"chicago_crime\" dataset\ndataset_ref = client.dataset(\"chicago_crime\", project=\"bigquery-public-data\")\n\n# API request - fetch the dataset\ndataset = client.get_dataset(dataset_ref)\n\n# Construct a reference to the \"crime\" table\ntable_ref = dataset_ref.table(\"crime\")\n\n# API request - fetch the table\ntable = client.get_table(table_ref)\n\n# Preview the first five lines of the table\nclient.list_rows(table, max_results=5).to_dataframe()","6b1bb652":"import bq_helper\nfrom bq_helper import BigQueryHelper\nbq_assistant = BigQueryHelper(\"bigquery-public-data\", \"chicago_crime\")","9528f12a":"bq_assistant.table_schema(\"crime\")","5b27fb33":"def show_amount_of_data_scanned(query):\n    # dry_run lets us see how much data the query uses without running it\n    dry_run_config = bigquery.QueryJobConfig(dry_run=True)\n    query_job = client.query(query, job_config=dry_run_config)\n    print('Data processed: {} GB'.format(round(query_job.total_bytes_processed \/ 10**9, 3)))","6fd4182d":"category_query = \"\"\"SELECT\n  primary_type,\n  description,\n  COUNTIF(year = 2019) AS arrests_2019,\n  COUNTIF(year = 2020) AS arrests_2020,\n  FORMAT('%3.2f', (COUNTIF(year = 2020) - COUNTIF(year = 2019)) \/ COUNTIF(year = 2019)*100) AS pct_change_2019_to_2020\nFROM\n  `bigquery-public-data.chicago_crime.crime`\nWHERE\n  arrest = TRUE\n  AND year IN (2019,\n    2020)\nGROUP BY\n  primary_type,\n  description\nHAVING COUNTIF(year = 2019) > 1 AND (COUNTIF(year = 2019) > 1000 OR COUNTIF(year = 2020) > 1000)\nORDER BY\n  ABS(COUNTIF(year = 2020) - COUNTIF(year = 2019)) \/ COUNTIF(year = 2019) DESC\n        \"\"\"\ncategory = client.query(category_query).result().to_dataframe()\n\nimport pandas as pd\n\npd.set_option(\"display.max_rows\", None, \"display.max_columns\", None)\n\ncategory","1fcf9df7":"arrest_query = \"\"\"SELECT\n  COUNTIF(year = 2019) AS arrests_2019,\n  COUNTIF(year = 2020) AS arrests_2020\nFROM\n  `bigquery-public-data.chicago_crime.crime`\nWHERE\n    arrest = TRUE\n    AND year IN (2019, 2020)\n    \"\"\"\n\narrest = client.query(arrest_query).result().to_dataframe()\narrest","b9b0acad":"type_query = \"\"\"SELECT\n  primary_type,\n  COUNTIF(year = 2019) AS arrests_2019,\n  COUNTIF(year = 2020) AS arrests_2020,\n  FORMAT('%3.2f', (COUNTIF(year = 2020) - COUNTIF(year = 2019)) \/ COUNTIF(year = 2019)*100) AS pct_change_2019_to_2020\nFROM\n  `bigquery-public-data.chicago_crime.crime`\nWHERE\n  arrest = TRUE\n  AND year IN (2019,\n    2020)\nGROUP BY\n  primary_type\nHAVING COUNTIF(year = 2019) > 1 AND ((COUNTIF(year = 2019) > 365 OR COUNTIF(year = 2020) > 365))\nORDER BY\n  ABS(COUNTIF(year = 2020) - COUNTIF(year = 2019)) \/ COUNTIF(year = 2019) DESC\n        \"\"\"\ntype = client.query(type_query).result().to_dataframe()\n\ntype","daa3ef0b":"type.plot.bar(x='primary_type', rot=90)","a5451ba5":"month_query = \"\"\"SELECT\n  EXTRACT(MONTH FROM\n      date) AS month,\n      EXTRACT(YEAR\n    FROM\n      date) AS year,\n  COUNT(*) AS incidents\nFROM `bigquery-public-data.chicago_crime.crime`\n  WHERE primary_type = 'MOTOR VEHICLE THEFT'\n  GROUP BY\n    year,\n    month\nORDER BY\n  incidents DESC\n        \"\"\"\n\nshow_amount_of_data_scanned(month_query)","72333ce4":"month_query = \"\"\"SELECT\n  EXTRACT(MONTH FROM\n      date) AS month,\n      EXTRACT(YEAR\n    FROM\n      date) AS year,\n  COUNT(*) AS incidents\nFROM `bigquery-public-data.chicago_crime.crime`\n  WHERE primary_type = 'MOTOR VEHICLE THEFT'\n  GROUP BY\n    year,\n    month\nORDER BY\n  incidents DESC\n        \"\"\"\n\nmonth = client.query(month_query).result().to_dataframe()\n\nmonth.head()","09a53986":"month.groupby('month')['incidents'].sum()","b11cfe98":"month.groupby('month')['incidents'].sum().idxmax()","d4615a3f":"month_summary = month.groupby('month')['incidents'].sum()\n\nmonth_summary = month_summary.to_frame()\n\nmonth_summary","041a352a":"month_summary.reset_index(level=0, inplace=True)","e24e6429":"month_summary.sort_values(by='incidents', ascending=False)","342d3f3d":"import seaborn as sns\n\nsns.barplot(x=month_summary['month'], y=month_summary['incidents'])","301e21a0":"month.groupby('month')['incidents'].max().idxmax()","280ae89b":"community_query = \"\"\"SELECT\n  community_area,\n  COUNT(*) AS incidents\nFROM `bigquery-public-data.chicago_crime.crime`\n  WHERE arrest = TRUE\n    AND year = 2021\n  GROUP BY\n    community_area\nORDER BY\n  incidents DESC\n        \"\"\"\n\nshow_amount_of_data_scanned(month_query)","8eed1fdf":"community_query = \"\"\"SELECT\n  community_area,\n  COUNT(*) AS arrests\nFROM `bigquery-public-data.chicago_crime.crime`\n  WHERE arrest = TRUE\n    AND year = 2021\n  GROUP BY\n    community_area\nORDER BY\n  arrests DESC\n        \"\"\"\n\ncommunity = client.query(community_query).result().to_dataframe()\n\ncommunity.head()","c7f41be1":"community2020_query = \"\"\"SELECT\n  community_area,\n  COUNTIF(year = 2019) AS arrests_2019,\n  COUNTIF(year = 2020) AS arrests_2020,\n  FORMAT('%3.2f', (COUNTIF(year = 2020) - COUNTIF(year = 2019)) \/ COUNTIF(year = 2019)*100) AS pct_change_2019_to_2020\nFROM\n  `bigquery-public-data.chicago_crime.crime`\nWHERE\n  arrest = TRUE\n  AND year IN (2019,\n    2020)\nGROUP BY\n  community_area\nHAVING COUNTIF(year = 2019) > 1\nORDER BY\n  ABS(COUNTIF(year = 2020) - COUNTIF(year = 2019)) \/ COUNTIF(year = 2019) DESC\n        \"\"\"\ncommunity2020 = client.query(community2020_query).result().to_dataframe()\n\ncommunity2020.head()","3b0205d6":"areas_names = pd.read_csv(\"..\/input\/chicagocsv\/chicago_area.csv\", sep=';')\n\nareas_names.columns","de319bc9":"community2020_join = pd.merge(areas_names, community2020, left_on='dropoff_community_area', right_on=\"community_area\")\n\ndel community2020_join['dropoff_community_area']\n\ncommunity2020_join.head()","3c0d42d3":"community2020_join.dtypes","40c20f56":"community2020_join[\"pct_change_2019_to_2020\"] = pd.to_numeric(community2020_join[\"pct_change_2019_to_2020\"])","32bb48fd":"pd.plotting.register_matplotlib_converters()\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\n\ncommunity2020_join.plot.bar(x='community_name', y='pct_change_2019_to_2020', rot=90)\n\nplt.gcf().set_size_inches(20, 10)\n\nplt.title(\"Change in number of arrests, by Community Areas\")\nplt.ylabel(\"Difference between 2019 and 2020 (in percent)\")\nplt.xlabel(\"Chicago Community Areas\")","15a11791":"![](https:\/\/images.unsplash.com\/photo-1570541510210-02630d54258b?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=1050&q=80)","7c35e3e6":"# Part 2 \/ Teil 2\n\n**Which month generally has the greatest number of motor vehicle thefts?**\n\n***Welcher Monat hat die h\u00f6chste Zahl von Autodiebst\u00e4hle? ***","71b7cc1a":"# Part 1 \/ Teil 1\n\n**What categories of crime exhibited the greatest year-over-year decrease in the lockdown year?**\n\n***Welche Kriminalit\u00e4tskategorien hatten die gr\u00f6\u00dfte Ver\u00e4nderung zwischen 2019 und 2020?***","6b7745a8":"We see above that there was a great increase in some crime categories, but it seems to have something to do with bureaucracy. Look only at the line 0 and at the line 5, they both deal with the same type of crime. That's why I will work further with the \"primary_type\" column and not with the \"description\" column.\n\n*Oben sehen wir, dass in manchen Kategorien die Zahl der Festnahmen im Lockdownjahr stark gestiegen ist. Aber es scheint mehr mit B\u00fcrokratie zu tun, vergleichen Sie nur die Zeile Nummer 0 mit der Zeile Nummer 5. Deswegen arbeite ich weiter mit der primary_type Spalte und nicht mit der description Spalte.*","59eff60d":"# Bonus\n\nIn this part we'll check which community area of Chicago saw the biggest decrease in crime.\n\n*In diesem Teil werden wir sehen, welche Chicagos Bezirke den st\u00e4rksten R\u00fcckgang in Kriminalit\u00e4t hatten.*","607ccf96":"Let's check the number of arrests.\n\n*Sehen wir die Zahl der Festnahmen.*","d9427bb0":"In the first part of this notebook we'll see what categories of crime exhibited the greatest year-over-year decrease in the lockdown year. In the second part we'll see which month generally has the greatest number of motor vehicle thefts. And as a bonus we'll see which community area of Chicago saw the biggest decrease in crime. But let's start by importing necessary tools from biquery and bq_helper and looking at the description of columns, I'll comment my work in both English and German.\n\n*Im ersten Teil dieses Notebooks werden wir sehen, welche Kriminalit\u00e4tskategorien die gr\u00f6\u00dfte Ver\u00e4nderung im Lockdownjahr hatten. Im zweiten Teil antworten wir auf die Frage, welcher Monat die h\u00f6chste Zahl von Autodiebst\u00e4hle hat. Zum Schluss sehen wir, welche Chicagos Bezirke den st\u00e4rksten R\u00fcckgang in Kriminalit\u00e4t hatten. Aber wir starten mit dem Importieren von Werkzeuge aus bigquery und bq_helper. Unterwegs mache ich Kommentare auf Deutsch und Englisch.*","1c1d5db1":"I set some thresholds to my first query, for example the number of arrests for any crime category should be over 1000\n\n*Ich setze manche Schwellenwerte zu meiner ersten Abfrage, zum Beispiel die Zahl der Festnahmen muss \u00fcber 1000 sein.*","e24bd81a":"We see that July in general has the highest number of motor vehicle thefts, and October 2001 has the highest number of them ever.\n\n*Wir sehen, dass im Juli die meisten Autodiebst\u00e4hle passieren und Oktober 2001 die gr\u00f6\u00dfte Zahl der Autodiebst\u00e4hle denn je hatte.*","f88424a7":"On the picture above we see that there is a decrease in almost every crime category in the lockdown year. The only exception are Weapons Violations.\n\n*Auf der Grafik sehen wir, dass im Lockdownjahr die Zahl der Festnahmen fast in jeder Kategorie einen deutlichen R\u00fcckgang hatte. Verstosse gegen das Waffengesetz sind die einzige Ausnahme.*"}}