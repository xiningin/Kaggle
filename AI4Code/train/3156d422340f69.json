{"cell_type":{"ba8735c7":"code","a812fd10":"code","8d2d558b":"code","08609fb1":"code","11fa854c":"code","807b96fc":"code","9a8f9ffe":"code","f767f217":"code","4c1a41a8":"code","c047a835":"code","ab79979f":"code","10f3c119":"code","5a7e8f55":"code","d533c2fb":"code","6573a444":"code","88d26333":"code","f9df520c":"code","fa01a0de":"code","504c62ad":"code","3a16415d":"code","fa0650e4":"code","b96e297a":"code","98cc7b7f":"code","089cfcc8":"code","358af9f4":"code","0cd19cf8":"code","39fd4888":"code","b2617bb5":"code","d9c8f0e8":"code","44f531d2":"code","cb5feae5":"code","f2ef727e":"code","9619ad48":"code","35a54198":"code","2b17575a":"code","f51d1c93":"code","8971d35d":"code","86945b9d":"code","822d7e0a":"code","71832140":"code","6967d0a8":"code","03ee04e8":"code","2e4ea084":"code","cc197269":"code","596d63c6":"code","4be765e1":"code","bb6f18d1":"code","299ccf30":"code","2eef5100":"code","134408d7":"code","f9bc221e":"markdown","d27207e2":"markdown","8cb5d611":"markdown","a5c9f60f":"markdown","8a13c9c1":"markdown","da5be2eb":"markdown","9846dba8":"markdown","d27485fb":"markdown","e60e7c3c":"markdown","f495edd6":"markdown","0eb38eca":"markdown","65244eb1":"markdown","a9981ab6":"markdown","5887a02b":"markdown","a3526b25":"markdown","f10f05f6":"markdown","05fc699a":"markdown","dddc5323":"markdown","9c359f04":"markdown","a0efe92f":"markdown","58f102c8":"markdown","9b7492de":"markdown","9693ca6c":"markdown","218d8c85":"markdown","d614e523":"markdown","139f337c":"markdown","da7cd6a0":"markdown","b8d936d7":"markdown","db2f0733":"markdown","d6703487":"markdown","56020436":"markdown","4dba4d80":"markdown","c04aef8e":"markdown","0e1fae1d":"markdown","732eea35":"markdown","bdc35a76":"markdown","00622aa5":"markdown","b30b4e65":"markdown","562bf8d9":"markdown","308844fc":"markdown","0e75481f":"markdown","20351d3a":"markdown","3295ce43":"markdown","0c5b5ca8":"markdown","518c0783":"markdown","a3843d55":"markdown","f626fff5":"markdown","629e27aa":"markdown","d1c80389":"markdown","950d6bdf":"markdown","0e8b1c41":"markdown","df09556b":"markdown","750e5bdd":"markdown","b3ca174e":"markdown","d557e613":"markdown","605c00f2":"markdown"},"source":{"ba8735c7":"import pandas as pd\nimport requests, json, statistics\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom bs4 import BeautifulSoup\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.feature_selection import mutual_info_regression\nfrom scipy import stats\nfrom scipy.stats.stats import pearsonr\nfrom sklearn.preprocessing import PolynomialFeatures\nfrom sklearn.linear_model import LinearRegression","a812fd10":"df = pd.read_csv(\"..\/input\/covid19pandemic-dataset\/Covid-19 Dataset.csv\", \n                 parse_dates = [\"Date\"])\n\ndf.head()","8d2d558b":"df.dtypes","08609fb1":"url = \"https:\/\/covid19.saglik.gov.tr\/TR-66935\/genel-koronavirus-tablosu.html#\"\nr = requests.get(url)\nprint(r.status_code)","11fa854c":"soup = BeautifulSoup(r.content, \"xml\")\n\nprint(soup.title)","807b96fc":"script = soup.find_all(\"script\")[16].text[26:-4]\ndata = json.loads(script)\nturkeyfirst = pd.DataFrame.from_records(data)","9a8f9ffe":"df = df[df[\"Country\"] == \"Turkey\"][[\"Date\",\"Confirmed\", \"Deaths\", \"Death Rate(%)\",\"Increase\",\"day_xth\"]]\n\ndf.set_index(\"day_xth\",inplace = True)\n\ndf = df[df[\"Date\"] > \"2020-03-10\"]","f767f217":"df.head()","4c1a41a8":"turkey = turkeyfirst[['tarih', 'gunluk_test', 'gunluk_vaka', \n                      'gunluk_hasta', 'gunluk_vefat', 'gunluk_iyilesen', \n                      'toplam_test', 'toplam_vefat', 'toplam_iyilesen', \n                      'hastalarda_zaturre_oran', 'agir_hasta_sayisi',\n                      'toplam_hasta']]\n\nturkey.rename(columns = {'tarih': 'Date', 'gunluk_test': 'Inc_Test', 'gunluk_vaka':'Inc_Case',\n                         'gunluk_hasta':'Inc_Patient', 'gunluk_vefat': 'Inc_Deaths', \n                         'gunluk_iyilesen' : 'Inc_Recovered', 'toplam_test' : \"Total_Tests\", \n                         'toplam_vefat':'Total_Deaths', 'toplam_iyilesen':'Total_Recovered', \n                         'agir_hasta_sayisi':'Heavily_Ill','toplam_hasta':'Total_Patient', \n                         'hastalarda_zaturre_oran':'Pneumonia_Ratio'}, inplace = True)\n\nturkey = turkey.reindex(columns = ['Date', 'Inc_Test', 'Inc_Case', \n                                   'Inc_Patient', 'Inc_Deaths',\n                                    'Inc_Recovered', 'Total_Tests', \n                                   'Total_Patient', 'Total_Deaths',\n                                   'Total_Recovered', 'Heavily_Ill', \n                                   'Pneumonia_Ratio'])","c047a835":"turkey.dtypes","ab79979f":"turkey[\"Date\"] = pd.to_datetime(turkey.Date, dayfirst = True)\nturkey.sort_values(by=[\"Date\"], inplace = True)\nturkey = turkey.reset_index(drop=True)","10f3c119":"turkey.head()","5a7e8f55":"intcolumns = turkey.columns[1:-1]\nfloatcolumns = turkey.columns[-1:]","d533c2fb":"turkey[intcolumns] = turkey[intcolumns].applymap(lambda x: \n                                                 x.replace('.', ''))\nturkey[intcolumns] = turkey[intcolumns].replace(\"\", 0, regex = True)\nturkey[floatcolumns] = turkey[floatcolumns].replace(\"\", 0, regex = True)\nturkey[floatcolumns] = turkey[floatcolumns].replace(\",\", \".\", regex = True)\nturkey[floatcolumns] = turkey[floatcolumns].replace(\" saat\", \"\", \n                                                    regex = True)","6573a444":"turkey[intcolumns] = turkey[intcolumns].astype(int)\nturkey[floatcolumns] = turkey[floatcolumns].astype(float)\nturkey.dtypes","88d26333":"turkey.shape","f9df520c":"df[\"IncreaseDeath\"] = df[\"Deaths\"].diff().fillna(0).astype(int)\ndf[\"Increase\"] = df[\"Increase\"].astype(int)","fa01a0de":"frame = df.merge(turkey, left_on=\"Date\", right_on=\"Date\")\nframe.head()","504c62ad":"frame[\"Check\"] = frame[\"IncreaseDeath\"] - frame[\"Inc_Deaths\"]\nframe[frame[\"Check\"] !=0]","3a16415d":"frame.loc[frame[\"Inc_Case\"] == 0, \"Inc_Case\"] = frame[\"Increase\"]","fa0650e4":"frame[frame[\"Date\"] > \"2020-11-24\"].head()","b96e297a":"frame[\"Death15\"] = 0\n\nfor cell in range(len(frame)):\n   \n    if cell + 15 < (len(frame)):\n        \n        frame[\"Death15\"].loc[cell] = frame[\"IncreaseDeath\"].loc[cell + 15]\n        \n    else:\n        \n        break","98cc7b7f":"frame.tail(17)","089cfcc8":"frame = frame.drop([\"Inc_Deaths\",\"Total_Deaths\",\"Total_Recovered\",\"Check\"], axis=1)","358af9f4":"frame.head()","0cd19cf8":"thegap = frame[(frame[\"Date\"] > \"2020-07-28\") & \n               (frame[\"Date\"] < \"2020-11-25\")].copy()\n\nmasked0 = frame[(frame[\"Date\"] <= \"2020-07-28\") | \n                (frame[\"Date\"] >= \"2020-11-25\")].copy()\n\nmasked1 = frame[((frame[\"Date\"] <= \"2020-07-28\") | \n                 (frame[\"Date\"] >= \"2020-11-25\") & (frame[\"Death15\"] != 0))].copy().drop([\"Pneumonia_Ratio\", \"Heavily_Ill\", \"Inc_Patient\",\"Total_Patient\"], axis=1)\n\nmasked1 = masked1[masked1[\"Inc_Test\"] != 0]\n\nmasked2 = frame[(frame[\"Date\"] >= \"2020-11-25\") & (frame[\"Death15\"] != 0)].copy()","39fd4888":"masked1.head(5)","b2617bb5":"plt.figure(figsize=(5, 8))\nsns.heatmap(masked1.corr()[[\"Inc_Case\"]].sort_values(by = \"Inc_Case\", \n                                                     ascending = False), annot = True)","d9c8f0e8":"corlist = []\n\nX = masked1.loc[:,masked1.columns != \"Inc_Case\"]\nX = X.loc[:,X.columns != \"Date\"]\ny = masked1.loc[:,\"Inc_Case\"]\n\nfor col in X.columns:\n    \n    cor = pearsonr(X[col], y)\n    corlist.append([col, cor[0], cor[1]])\n\ncordf = pd.DataFrame(corlist, columns = [\"Features\", \"Correlation\", \n                                         \"p-value\"])\n\ncordf.sort_values(by = \"p-value\", inplace = True)\ncordf","44f531d2":"corlist2 = []\n\nX2 = masked2.loc[:,masked2.columns != \"Inc_Case\"]\nX2 = X2.loc[:,X2.columns != \"Date\"]\ny2 = masked2.loc[:,\"Inc_Case\"]\n\nfor col in X2.columns:\n    \n    cor2 = pearsonr(X2[col], y2)\n    corlist2.append([col, cor2[0], cor2[1]])\n\ncordf2 = pd.DataFrame(corlist2, columns = [\"Features\", \"Correlation\", \n                                           \"p-value\"])\n\ncordf2.sort_values(by = \"p-value\", inplace = True)\ncordf2","cb5feae5":"plt.figure(figsize=(8, 8))\nax = sns.regplot(x=\"Death15\", y=\"Inc_Case\", data=masked1)","f2ef727e":"sns.lmplot(x = \"Death15\", y = \"Inc_Case\", data = masked1, order=2, height = 7)","9619ad48":"sns.lmplot(x = \"Inc_Test\", y = \"Inc_Case\", data = masked1, order=2, height = 7)","35a54198":"plt.figure(figsize=(8, 8))\nax = sns.regplot(x=\"Inc_Recovered\", y=\"Inc_Case\", data=masked1)","2b17575a":"X = masked1[[\"Death15\", \"Inc_Test\", \"Inc_Recovered\"]]\n\ny = masked1[[\"Inc_Case\"]]\n\nPolyReg = LinearRegression()\n\npolynom = PolynomialFeatures(degree = 2) \n\nscores = []\n\nfor i in range(10):\n    \n    X_train, X_test, y_train, y_test = train_test_split(polynom.fit_transform(X), y, test_size=0.2, random_state=i)\n    \n    PolyReg.fit(X_train, y_train)\n\n    scores.append(PolyReg.score(X_test, y_test))\n    \nstatistics.mean(scores)","f51d1c93":"PolyReg.fit(polynom.fit_transform(X), y)\n\nthegap[\"Estimated\"] = PolyReg.predict(polynom.fit_transform(thegap[[\"Death15\", \"Inc_Test\", \"Inc_Recovered\"]]))","8971d35d":"thegap.Estimated.sum()","86945b9d":"print(((thegap.Estimated.sum()*100)\/1159626).round(2), \"percent of the cases are predicted.\") ","822d7e0a":"plt.figure(figsize = [10,6])\nplt.plot(thegap[\"Date\"],thegap[\"Inc_Case\"], label = \"Patients\")\nplt.plot(thegap[\"Date\"],thegap[\"Estimated\"], label = \"Estimated\")\nplt.xlabel(\"Date\")\nplt.legend()\nplt.show()","71832140":"masked0[\"Estimated\"] = None","6967d0a8":"final = masked0.append(thegap, ignore_index = True)\nfinal.sort_values(by=[\"Date\"], inplace = True)\nfinal = final.reset_index(drop=True)","03ee04e8":"plt.figure(figsize = [10,6])\nplt.plot(final[\"Date\"],final[\"Inc_Case\"], label = \"Cases\/Patients\")\nplt.plot(final[\"Date\"],final[\"Estimated\"], label = \"Estimated\")\nplt.xlabel(\"Date\")\nplt.legend()\nplt.show()","2e4ea084":"for i in range(len(final) - 1):\n    \n    if final[\"Estimated\"].loc[i] != None:\n    \n        final[\"Adjusted\"] = (1159626*final[\"Estimated\"])\/(final[\"Estimated\"].sum())\n    \n    else:\n    \n        final[\"Adjusted\"] = None","cc197269":"final.Adjusted.sum()","596d63c6":"final[\"Estimated\"] = final[\"Estimated\"].round()\nfinal[\"Adjusted\"] = final[\"Adjusted\"].round()","4be765e1":"thegap = final[(final[\"Date\"] > \"2020-07-14\") & \n               (final[\"Date\"] < \"2020-12-09\")].copy()","bb6f18d1":"plt.figure(figsize = [10,6])\nplt.plot(thegap[\"Date\"],thegap[\"Inc_Case\"], label = \"Patients\")\nplt.plot(thegap[\"Date\"],thegap[\"Estimated\"], label = \"Estimated\")\nplt.plot(thegap[\"Date\"],thegap[\"Adjusted\"], label = \"Adjusted\")\nplt.xlabel(\"Date\")\nplt.legend()\nplt.show()","299ccf30":"final = final.drop([\"Increase\", \"Inc_Patient\", \"Total_Patient\", \n                    \"Heavily_Ill\", \"Pneumonia_Ratio\"], axis=1)","2eef5100":"final.to_csv(\"TurkeyAdjusted.csv\", index = False)","134408d7":"final.tail()","f9bc221e":"# Table of Contents\n\n1. [Introduction](#Introduction)\n\n    1.1 [Acknowledgments](#Acknowledgments)\n\n    1.2 [The Problem](#The-Problem)\n    \n    1.3 [The Goal of the Project](#The-Goal-of-the-Project)\n    \n    1.4 [Timeline](#Timeline)\n    \n    1.5 [Methodology](#Methodology)\n2. [Importing the Necessary Libraries](#Importing-the-Necessary-Libraries)\n3. [Importing Data](#Importing-Data)\n\n    3.1 [Preprocessed Data](#Preprocessed-Data)\n    \n    3.2 [Raw Data](#Raw-Data-from-the-Ministry-of-Health-in-Turkey)\n4. [Data Cleaning and Wrangling](#Data-Cleaning-and-Wrangling)\n5. [Regression](#Regression)\n\n    5.1 [Creating Filters](#Creating-Filters)\n    \n    5.2 [Feature Selection](#Feature-Selection)\n    \n    5.3 [Prediction](#Prediction)\n    \n    5.4 [Adjustment](#Adjustment)\n6. [Saving the Dataset](#Saving-the-Dataset)\n    ","d27207e2":"Difference between \"Increase\" and \"Inc_Case\" can be seen above. The correct one is \"Inc_Case\"","8cb5d611":"P.S. This could be done with SelectKBest as well.","a5c9f60f":"#### Visualization","8a13c9c1":"### Creating Filters","da5be2eb":"Removing unnecessary columns.","9846dba8":"# Regression","d27485fb":"### Acknowledgments\n\n##### This project has 2 different datasets from 2 different sources. I have prepared one of them in another project which used data from \"COVID-19 Data Repository by the Center for Systems Science and Engineering (CSSE) at Johns Hopkins University\", link to their repo is https:\/\/github.com\/CSSEGISandData\/COVID-19\n\n##### The second dataset is processed with the data from the Ministry of Health in Turkey \n\n##### Several studies inspired me to create a new feature. These studies are;\n\nJombart T, van Zandvoort K, Russell TW et al. Inferring the number of COVID-19 cases from recently reported deaths [version 1; peer review: 2 approved]. Wellcome Open Res 2020, 5:78 (https:\/\/doi.org\/10.12688\/wellcomeopenres.15786.1)\n\nPueyo T. Coronavirus: Why You Must Act Now (https:\/\/tomaspueyo.medium.com\/coronavirus-act-today-or-people-will-die-f4d3d9cd99ca)\n\nLinton NM, Kobayashi T, Yang Y, Hayashi K et al. Incubation Period and Other Epidemiological Characteristics of 2019 Novel Coronavirus Infections with Right Truncation: A Statistical Analysis of Publicly Available Case Data. Journal of Clinical Medicine. 2020; 9(2):538. (https:\/\/doi.org\/10.3390\/jcm9020538)","e60e7c3c":"##### Cleaning of the Problematic Characters","f495edd6":"In percentage","0eb38eca":"### Preprocessed Data","65244eb1":"# Importing Data","a9981ab6":"cross_val_score method does not work well with this dataset(especially in the first folds) since it is ordered by time. As an alternative, multiple train test split methods are used and the average scores are recorded. \n\nThe code below has the best features and the best degree of these features(even though \"Inc_Recovered\" seems like it might be a linear equation, it works better as a polynomial) that I found. Feel free to change the variables to test it yourself. \n\nNote that cumulative values of the predictions were considered as a method to measure accuracy as well, since we know the total case values in the gap from official sources. For example, the third order of the features resulted in a slightly higher accuracy while the cumulative value of the cases was closer to the actual value in the second order. Visualization methods are also used to observe predicted line with the actual values. One can see which predicted line fits better on the graphs.","5887a02b":"### Timeline\n###### On the 29th of July 2020, the phrase \"Case\" changed to \"Patient\" on the graphs that the Ministry of Health shares with the public\n            Turkey started to announce only the symptomatic cases.\n            Secondary repositories kept recording these numbers as cases.\n            \n###### On the 25th of November 2020, the Ministry started to announce the cases once again\n            There were not any adjustments for the previous cases.\n            \n###### On the 10th of December 2020, the Ministry revealed missing previous cases cumulatively\n            Secondary repositories kept this number as if the cases were \n            discovered that day.","a3526b25":"Creating a column to check the differences of increase in deaths columns.","f10f05f6":"The dataset called \"turkey\" already has the increase in deaths, yet it has some missing values. This column is created for comparison.","05fc699a":"These dates mean nothing important. They are just there for scaling purposes.","dddc5323":"Sum of the estimations is supposed to be equal to 1,159,626","9c359f04":"#### Correlations with p-values","a0efe92f":"Checking the code.","58f102c8":"This feature is explained in the methodology section.","9b7492de":"Columns \"Increase\" and \"Inc_Patient\" must differ after the 25th of November.","9693ca6c":"#### Increase of the deaths which is taken from 15 days later","218d8c85":"#### Changing Types","d614e523":"# Introduction","139f337c":"### Methodology\n\n  Linear correlation, p-value, cross-validation and comparing with the cumulative cases for the gap are used to measure the accuracy of the model and the relations.\n\n  Daily tests and recovered cases are used as features in the model.\n  \n  The most related feature was the increase in deaths from 15 days later. This feature is created to acquire a stronger relation. It takes approximately 15 days to die from Covid-19 (Linton et al., 2020). Inspirations of this feature were mentioned in the acknowledgments section.\n  \n  Estimations are also used as coefficients to distribute cumulative cases that were announced on the 10th of December 2020 as an adjustment.","da7cd6a0":"#### Web Scraping","b8d936d7":"#### Filtering Turkey and Necessary Columns from the First Set","db2f0733":"Empty cells in this column may affect our results. It is partially empty because the increase of the cases was being kept in \"Inc_Patient\" column until the 29th of July 2020. Yet \"Increase\" column is not fully correct either. Therefore, they must be combined to acquire an accurate column.","d6703487":"Since we have the total number of cases, we can distribute them to each day as if our estimations were coefficients.","56020436":"I have realized that correlation is a better way to explore relations for this dataset instead of mutual information. Therefore, correlation scores are used as indicators of the relations.","4dba4d80":"Inc_ indicates the daily increase in the related field.","c04aef8e":"# Data Cleaning and Wrangling","0e1fae1d":"The file called \"Covid-19 Dataset.csv\" was created in another project. The making of this dataset is [here](https:\/\/github.com\/ocaktans\/Gathering-Covid-19-Data). The updated dataset is [here](https:\/\/www.kaggle.com\/ocaktan\/covid19pandemic-dataset).","732eea35":"#### Filling Empty Cells with One of the Preprocessed Columns","bdc35a76":"These values should be integers.","00622aa5":"We have to choose between the quantity of the features and our sample size since various cells are empty on certain dates. We do not have access to all attributes from day one.\n\n\"thegap\" masks the days that we want to predict.\n\n\"masked0\" simply includes outside of the gap. It will be used for merging purposes in the next sections.\n\n\"masked1\" has a bigger size than \"masked2\", yet we have to exclude some columns(deleted columns are partially empty for these dates).\n\n\"masked2\" has more features with less size.","b30b4e65":"### The Goal of the Project\n\nThis project aims to estimate daily increases of case numbers for these days. There are several facts and data that make it possible to build a highly accurate machine learning model to solve this problem. \n\nThese facts are:\n\n    1. Total case numbers are known.\n    \n    2. This policy only took part of the total duration of the pandemic and \n       it was in the middle. \n       We know the case numbers of the first months and the last months. \n        ","562bf8d9":"# An Estimation for Asymptomatic Covid-19 Cases of Turkey\n### A multivariate polynomial regression model","308844fc":"#### Accuracy of the Model","0e75481f":"### Prediction ","20351d3a":"##### Same feature as a quadratic equation","3295ce43":"#### Filtering for a Closer Look with the Visualization ","0c5b5ca8":"### Raw Data from the Ministry of Health in Turkey","518c0783":"### Feature Selection","a3843d55":"It can be seen that there are some empty cells in the data from the ministry which caused the most of the difference. Two rows(with the indexes 494 and 495) appear to be faulty because of the first source. Similar differences appear in total death columns as well. We will chose to continue with \"IncreaseDeath\" and \"Deaths\" columns. The row with the index 494 will be dropped in the next sections.","f626fff5":"Sum of the adjusted column should be equal to 1,159,626 if the code above is correct.","629e27aa":"##### Masking Integer and Float columns","d1c80389":"#### Cleaning Columns from the Second Dataset and Translation","950d6bdf":"# Importing the Necessary Libraries","0e8b1c41":"#### Merging the Datasets ","df09556b":"# Saving the Dataset","750e5bdd":"### Creating New Columns","b3ca174e":"Merging before adding more columns.","d557e613":"### Adjustment ","605c00f2":"### The Problem\n\nThe Republic of Turkey was one of the countries which announce only symptomatic Covid-19 cases. Yet, this policy only took about 3 months.\n\nThe Ministry referred to these numbers as \"patients\" rather than \"cases\". They started to announce asymptomatic cases once again and revealed the total case numbers in the country. \n\nSecondary repositories kept these numbers as if they were case numbers and this caused significant changes in the recording standards for the country. Actual case numbers are now known but we still do not have the daily increases for this gap."}}