{"cell_type":{"83d6a98f":"code","5b90e391":"code","081574a7":"code","f2b2a314":"code","43f22ebc":"code","b6f3ceb6":"code","1a4e9e8f":"code","cd4c2009":"code","4b15f323":"code","e2f3e829":"code","6a52282e":"code","9047c8e9":"code","916cda71":"code","557c84d3":"code","ec97332b":"code","38863340":"code","09753ad4":"code","5e12ff32":"code","57c565e4":"code","aea8ab90":"code","72cc130e":"code","c91b4473":"code","a162b7c7":"code","58b8e5a3":"code","806d0c22":"code","d0b3b2e5":"code","577735e8":"code","eb558d07":"code","b6d667fc":"code","9fd4cdad":"code","2932bfa2":"code","cd925de2":"code","15a0bc53":"code","da90e0d7":"code","a8775cbc":"code","356dc42b":"code","c355c5bc":"code","28bdba1f":"code","0182266f":"code","d58a2450":"code","92381d82":"code","39d7890f":"code","75ab2c88":"code","ef566a66":"code","e70b1d87":"code","d90c7047":"code","3129793c":"code","c777f897":"code","98a4425a":"code","bc37aa21":"code","f443282d":"code","a0731e12":"code","08a04716":"code","915c97ab":"code","da53c4a5":"code","18573387":"code","f8de504e":"code","9ead05b8":"code","dd6466a7":"code","7ad4d3d7":"code","c5288eba":"code","5209d761":"code","a369a588":"code","d54abcfe":"code","abd2c899":"code","355977c9":"code","207833ec":"code","1237a777":"code","36206ea0":"code","7b7f60c0":"code","600d8fbc":"code","d01e86a1":"code","5cfa26b0":"code","4b9a8c3d":"code","3c5019d5":"code","6c908837":"code","bedaab85":"code","15296c92":"code","21d37710":"code","2526497c":"code","396c0f22":"code","486639d8":"code","0927cde7":"code","578b7431":"code","62faf14f":"code","6eab0286":"code","4ebf9c16":"code","a2c0adab":"code","adcb6195":"code","21bf8b81":"code","c6740b5e":"code","b6e34c53":"markdown","19ec5f70":"markdown","0a297c67":"markdown","973086fe":"markdown","ece6bef6":"markdown","5e1a8789":"markdown","913955dd":"markdown","26bc03ce":"markdown","3034c367":"markdown","9b4f5093":"markdown","dea60b1a":"markdown","f533291b":"markdown","183ecc6c":"markdown","563dfc32":"markdown","2a7db4ab":"markdown","689d291f":"markdown","376d1eae":"markdown","fb926611":"markdown","c7258042":"markdown","f5857cb5":"markdown","02bcebbb":"markdown"},"source":{"83d6a98f":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport pprint #better dictionary printing\nimport plotly.offline as py\npy.init_notebook_mode(connected=True)\nimport plotly.graph_objs as go\nimport plotly.tools as tls\nimport plotly.figure_factory as ff\nimport plotly.express as px","5b90e391":"churn = pd.read_csv('..\/input\/telco-customer-churn\/WA_Fn-UseC_-Telco-Customer-Churn.csv')","081574a7":"churn.head()","f2b2a314":"churn.info()","43f22ebc":"print('Rows: ', churn.shape[0])\nprint('Columns: ', churn.shape[1])\nprint('\\nFeatures:\\n ', churn.columns.tolist())\nprint('\\nUnique Value Count:\\n ', churn.nunique())\nprint('\\nMissing Value:\\n ', churn.isnull().sum())","b6f3ceb6":"def values(cols):\n    d = {}\n    for col in cols:\n        x = churn[col].unique()\n        d[col] = x\n    pprint.pprint(d)","1a4e9e8f":"print('Feature Values: \\n')\nvalues(churn.columns)","cd4c2009":"churn.TotalCharges.min()","4b15f323":"churn['TotalCharges'] = churn['TotalCharges'].replace(' ',np.nan)","e2f3e829":"churn.head()","6a52282e":"churn = churn[churn['TotalCharges'].notnull()]","9047c8e9":"churn['TotalCharges'] = churn['TotalCharges'].astype(float)","916cda71":"churn['SeniorCitizen'] = churn['SeniorCitizen'].replace({1: 'Yes', 0: 'No'})","557c84d3":"churn['tenure'].min()","ec97332b":"churn['tenure'].max()","38863340":"def tenure_slabs(value):\n    if value <= 12:\n        return 'ten_0-12'\n    elif (value > 12) & (value <= 24):\n        return 'ten_12-24'\n    elif (value > 24) & (value <= 36):\n        return 'ten_24-36'\n    elif (value > 36) & (value <= 48):\n        return 'ten_36-48'\n    elif (value > 48) & (value <= 60):\n        return 'ten_48-60'\n    elif (value > 60) & (value <= 72):\n        return 'ten_60-72'","09753ad4":"churn['tenure_duration'] = churn['tenure'].apply(tenure_slabs) #to categorical column","5e12ff32":"def make_df(data, col):\n    df = pd.DataFrame(data[col].value_counts(normalize = True)*100)\n    df = df.reset_index()\n    return df","57c565e4":"gen = make_df(churn, 'gender')\ngen.head()","aea8ab90":"px.bar(gen, x = 'index', y = 'gender', title = 'Gender Distribution: Overall data')","72cc130e":"sen = make_df(churn, 'SeniorCitizen')\nsen.head()","c91b4473":"px.bar(sen, x = 'index', y = 'SeniorCitizen', title = 'Senior Citizen Distribution: Overall data')","a162b7c7":"labels = churn['Churn'].value_counts().keys().tolist()\nvals = churn['Churn'].value_counts().values.tolist()\n\nfig = go.Figure(data = go.Pie(labels = labels, values = vals))\nfig.update_traces(hoverinfo = 'label+value', marker = dict(colors = ['rgb(124,185,232)', 'gold']), hole = .5)\nfig.update(layout_title_text = 'Customer Churn Data: Overall data', layout_showlegend = True)\nfig.show()","58b8e5a3":"churn.shape","806d0c22":"y_churn = churn[churn['Churn'] == 'Yes'] #customers who have left the network\nn_churn = churn[churn['Churn'] == 'No'] #customers who have stayed with the network","d0b3b2e5":"print('Number of people who left the telecom:', y_churn.shape[0])\nprint('Number of people who did not left the telecom:', n_churn.shape[0])","577735e8":"def plot_pie(labels, values):\n    fig = go.Figure(data = go.Pie(labels = labels, values = values))\n    fig.update_traces(hoverinfo='label+value', marker = dict(colors = ['royal blue', 'gold']), hole = .5)\n    fig.show()\n    \ndef label(col, churn):\n    if churn == 1:\n        x = y_churn[col].value_counts().keys().tolist()\n        return x\n    else:\n        x = n_churn[col].value_counts().keys().tolist()\n        return x\n\ndef values(col, churn):\n    if churn == 1:\n        x = y_churn[col].value_counts().values.tolist()\n        return x\n    else: \n        x = n_churn[col].value_counts().values.tolist()\n        return x","eb558d07":"from plotly.subplots import make_subplots","b6d667fc":"def make_pies(column, title):\n    specs = [[{'type':'domain'}, {'type':'domain'}]]\n    colors = ['rgb(124,185,232)','rgb(255,213,0)','rgb(25,77,0)','rgb(255,126,0)','rgb(153,255,102)']\n    fig = make_subplots(rows = 1, cols = 2, specs = specs)\n    fig.add_trace(go.Pie(labels = label(column, 1), values = values(column, 1), name = 'Churn', marker_colors = colors), 1,1)\n    fig.add_trace(go.Pie(labels = label(column, 0), values = values(column, 0), name = 'Non-churn', marker_colors = colors), 1,2)\n    fig.update_traces(hoverinfo = 'label+value', hole = 0.6)\n    fig.update(layout_title_text = title +': Churn Vs. Non-churn customers')\n    fig.update_layout(annotations = [dict(text = 'Churn',x=0.18, y=0.5, font_size=20, showarrow=False),\n                                    dict(text = 'Non-churn',x=0.85, y=0.5, font_size=20, showarrow=False)])\n    fig.show()","9fd4cdad":"make_pies('gender', 'Gender')","2932bfa2":"make_pies('SeniorCitizen', 'Senior Citizen')","cd925de2":"make_pies('DeviceProtection', 'Device Protection')","15a0bc53":"make_pies('OnlineBackup', 'Online Backup')","da90e0d7":"make_pies('OnlineSecurity', 'Online Security')","a8775cbc":"make_pies('StreamingMovies', 'Streaming Movies')","356dc42b":"make_pies('StreamingTV','Streaming TV')","c355c5bc":"make_pies('TechSupport', 'Tech Support')","28bdba1f":"make_pies('Contract','Contract')","0182266f":"make_pies('SeniorCitizen', 'Senior Citizen')","d58a2450":"make_pies('Partner','Partner')","92381d82":"make_pies('Dependents', 'Dependents')","39d7890f":"make_pies('PhoneService', 'Phone Service')","75ab2c88":"make_pies('PaperlessBilling', 'Paperless Billing')","ef566a66":"make_pies('PaymentMethod', 'Payment Method')","e70b1d87":"def make_hist(column, title):\n    #fig = make_subplots(rows = 1, cols = 2)\n    fig = go.Figure()\n    fig.add_trace(go.Histogram(x = n_churn[column], name = 'Non-churn'))\n    fig.add_trace(go.Histogram(x = y_churn[column], name = 'Churn'))\n    #fig.append_trace(h1, 1,1)\n    #fig.append_trace(h2, 1,2)\n    fig.update_layout(title_text = title+': Churn Vs. Non-churn customers', \n                      xaxis_title_text = 'Value', yaxis_title_text = 'Count',\n                     bargap = 0.2,\n                     bargroupgap = 0.1\n                     )\n    fig.show()","d90c7047":"make_hist('TotalCharges', 'Total Charge')","3129793c":"make_hist('tenure_duration', 'Tenure Duration')","c777f897":"avg_charges = churn.groupby('tenure_duration').mean().reset_index()","98a4425a":"fig = px.bar(avg_charges, x = 'tenure_duration', y = 'MonthlyCharges')\nfig.show()","bc37aa21":"churn.columns.tolist()","f443282d":"churn.nunique()","a0731e12":"category_cols = []\nfor col in churn.columns.tolist():\n    if (churn[col].nunique() <= 6):\n        category_cols.append(col)\nprint(category_cols)","08a04716":"from sklearn import preprocessing\n\nchurn2 = churn.copy()\nle = preprocessing.LabelEncoder()\nchurn2[category_cols] = churn2[category_cols].apply(le.fit_transform)\nchurn2.head()","915c97ab":"numeric_cols = ['tenure', 'MonthlyCharges', 'TotalCharges']","da53c4a5":"from sklearn.preprocessing import StandardScaler\n\nscaler = StandardScaler()\n\nscaled_values = scaler.fit_transform(churn2[numeric_cols])\nscaled_values = pd.DataFrame(scaled_values, columns = numeric_cols)\nscaled_values.head()","18573387":"scaled_values.isnull().sum()","f8de504e":"churn2.isnull().sum()","9ead05b8":"churn2 = churn2.drop(columns = numeric_cols, axis = 1)\nchurn2 = churn2.merge(scaled_values, how = 'left', left_index = True, right_index = True)\nchurn2.head()\nchurn2 = churn2.dropna()","dd6466a7":"correlation = churn2.corr()\ncorrelation","7ad4d3d7":"corr_col = correlation.columns.tolist()\n","c5288eba":"fig = go.Figure(data = go.Heatmap(z = correlation,\n                                 x = corr_col,\n                                 y = corr_col)\n               )\n\nfig.update_layout(title = 'Correlation Matrix', width = 800, height = 800)\nfig.update_xaxes(tickangle = 90)\nfig.show()","5209d761":"from sklearn.model_selection import train_test_split\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.metrics import confusion_matrix,accuracy_score,classification_report\nfrom sklearn.metrics import roc_auc_score,roc_curve,scorer","a369a588":"t_cols = []\nfor i in churn2.columns:\n    if (i != 'Churn') & (i != 'customerID'):\n        t_cols.append(i)","d54abcfe":"train_data = churn2[t_cols]\ntarget = churn2['Churn']","abd2c899":"x_train, x_test, y_train, y_test = train_test_split(train_data, target, test_size = 0.3, random_state = 1)\n\nlr = LogisticRegression(solver = 'liblinear')\n\nlr.fit(x_train, y_train)","355977c9":"predictions_lr = lr.predict(x_test)","207833ec":"probs = lr.predict_proba(x_test)","1237a777":"acc_lr = lr.score(x_test, y_test)\nprint('The accuracy of this model is:', round(acc_lr, 3)*100, '%')\nprint('\\n')\n\nprint('Classification Report:\\n')\nclf_report_lr = classification_report(y_test, predictions_lr)\nprint(clf_report_lr)\nprint('\\n')\n\ncon_matrix = confusion_matrix(y_test, predictions_lr)\nprint('Confusion Matrix:\\n')\nprint(con_matrix)\nprint('\\n')\n\nroc_auc = roc_auc_score(y_test, predictions_lr)\nprint('Area under the curve:',roc_auc)","36206ea0":"#plotting confusion matrix\nfig = go.Figure(data = go.Heatmap(z = con_matrix,\n                                 x = ['Not Churn', 'Churn'],\n                                 y = ['Not Churn', 'Churn'],\n                                 colorscale = 'Cividis',\n                                 showscale = False))\nfig.update_layout(title = 'Confusion Matrix')\nfig.show()","7b7f60c0":"import scikitplot as skplt","600d8fbc":"#plotting ROC curve\nskplt.metrics.plot_roc(y_test, probs, figsize = (8,8), title = 'ROC Curves: Logistic Regression Model')","d01e86a1":"from sklearn.tree import DecisionTreeClassifier","5cfa26b0":"tree = DecisionTreeClassifier()","4b9a8c3d":"tree.fit(x_train, y_train)","3c5019d5":"predict_tree = tree.predict(x_test)","6c908837":"def model_metrics(algo, x, y, preds):\n    score = algo.score(x,y)\n    print('The accuracy of this model is:', round(score, 3)*100, '%')\n    print('\\n')\n    \n    print('Classification Report:\\n')\n    clf_report = classification_report(y, preds)\n    print(clf_report_lr)\n    print('\\n')\n    \n    con_matrix = confusion_matrix(y, preds)\n    print('Confusion Matrix:\\n')\n    print(con_matrix)\n    print('\\n')\n    \n    roc_auc = roc_auc_score(y, preds)\n    print('Area under the curve:',roc_auc)\n    \n    return con_matrix","bedaab85":"c = model_metrics(tree, x_test, y_test, predict_tree )","15296c92":"def plot_confusion(con_mat, model_name):\n    fig = go.Figure(data = go.Heatmap(z = con_mat,\n                                      x = ['Not Churn','Churn'],\n                                      y = ['Not Churn','Churn'],\n                                      colorscale = 'Cividis',\n                                      showscale = False\n                                     ))\n    fig.update_layout(title = 'Confusion Matrix: '+ model_name)\n    fig.show()","21d37710":"plot_confusion(c, 'Decision Tree')","2526497c":"from sklearn.feature_selection import RFE\n\nlr = LogisticRegression(solver = 'liblinear')\nrfe = RFE(lr,10)\nrfe = rfe.fit(x_train, y_train.values.ravel())\n\nrfe.support_\nrfe.ranking_\n","396c0f22":"churn_rfe = pd.DataFrame({\"rfe_support\" :rfe.support_,\n                       \"columns\" : [i for i in churn2.columns if i not in churn2[['customerID', 'Churn']]],\n                       \"ranking\" : rfe.ranking_,\n                      })\nrfe_cols = churn_rfe[churn_rfe[\"rfe_support\"] == True][\"columns\"].tolist()","486639d8":"rfe_cols","0927cde7":"rfe_xtrain = x_train[rfe_cols]\nrfe_ytrain = y_train\nrfe_xtest = x_test[rfe_cols]\nrfe_ytest = y_test","578b7431":"lr.fit(rfe_xtrain, rfe_ytrain)","62faf14f":"predictions_rfe_lr = lr.predict(rfe_xtest)\nprobs_rfe = rfe.predict_proba(x_test)","6eab0286":"print(rfe_xtest.shape)\nprint(rfe_ytest.shape)\n#acc_rfe_lr = lr.score(rfe_xtest, rfe_ytest)\n#print('Model Accuracy is:', acc_rfe_lr*100, '%')","4ebf9c16":"predictions_rfe_lr","a2c0adab":"acc_lr_rfe = lr.score(rfe_xtest, rfe_ytest)\nprint('The accuracy of this model is:', round(acc_lr_rfe, 3)*100, '%')","adcb6195":"c_rfe = model_metrics(rfe, x_test, y_test, predictions_rfe_lr)","21bf8b81":"plot_confusion(c_rfe, 'Recursive Feature Elimination')","c6740b5e":"skplt.metrics.plot_roc(y_test, probs_rfe, figsize = (8,8), title = 'ROC Curve: RFE Model')","b6e34c53":"Replacing 'No Internet Service' to 'No' in columns:\n- DeviceProtection\n- OnlineBackup\n- OnlineSecurity\n- StreamingMovies\n- StreamingTV\n- TechSupport","19ec5f70":"# Modelling\n\nNow we have converted all the columns in numeric form and can start modelling.","0a297c67":"## Deep Dive","973086fe":"We will scale numeric value columns.","ece6bef6":"We will now use LabelEncoder to encode our data in numeric form which is necessary for ML models.","5e1a8789":"Let's plot people with\/without internet service.","913955dd":"# Customer Churn Rate\n\n\n**Wikipedia** defines **[churn rate](https:\/\/en.wikipedia.org\/wiki\/Churn_rate) (sometimes called attrition rate), in its broadest sense, is a measure of the number of individuals or items moving out of a collective group over a specific period. It is one of two primary factors that determine the steady-state level of customers a business will support.**\n\nThe term is used in many contexts, but is most widely applied in business with respect to a contractual customer base, for example in businesses with a subscriber-based service model such as mobile telephone networks and pay TV operators. The term is also used to refer to participant turnover in peer-to-peer networks. Churn rate is an input into customer lifetime value modeling, and can be part of a simulator used to measure return on marketing investment using marketing mix modeling.\n\n---\n\n# Objective\n\nPredict customers who are likely to leave the network so that we can specifically target them and try retaining them.\n\n# Benefit\nRetention cost is always less than customer acquisition cost. If we focus and try to retain customers who might leave but have not yet left, we could save a substantial amount of money.\n\n---\n\n### Dataset info\nThis dataset contains information regarding telecom subscribers. Based on this information, we will build a model to identify customers  who are most likely to leave the network to some other service provider.\n\nThe datasets can be found [here](https:\/\/www.kaggle.com\/blastchar\/telco-customer-churn).\n\nThe data set includes information about:\n\n- Customers who left within the last month \u2013 the column is called Churn\n- Services that each customer has signed up for \u2013 phone, multiple lines, internet, online security, online backup, device -protection, tech support, and streaming TV and movies\n- Customer account information \u2013 how long they\u2019ve been a customer, contract, payment method, paperless billing, monthly charges, and total charges\n- Demographic info about customers \u2013 gender, age range, and if they have partners and dependents","26bc03ce":"# Decision Tree Model","3034c367":"Let us now deep dive by separating the dataset based on customers who have left the telecom network and those who have stayed with the network.","9b4f5093":"# Data Manipulation","dea60b1a":"## change","f533291b":"TotalCharges column contains spaces which we will replace with nan.","183ecc6c":"# EDA","563dfc32":"### New train and test data based on RFE","2a7db4ab":"# Conclusion\n\nWe will use the first model based on logistic regression as that gives us the highest accuracy of 79.9%.","689d291f":"~16% of the users are senior citizens.","376d1eae":"# Preprocessing","fb926611":"## Visualizing Model Performance ","c7258042":"We have almost equal number of male and females in the dataset.","f5857cb5":"# Recursive Feature Elimination","02bcebbb":"# Data Overview\n\nLet us get to know our data."}}