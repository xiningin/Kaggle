{"cell_type":{"05148caa":"code","a45e2998":"code","d09e93a7":"code","4bf6d0e4":"code","f890f591":"code","de7f07f0":"code","0fcc7815":"code","b63c4088":"code","e6a3b407":"code","87f329de":"code","b3df7831":"code","c9e43d9c":"code","e523db4c":"code","c1eea755":"code","7d8df635":"code","3acfa6dc":"code","955d39c2":"code","a9590b77":"code","9990c108":"code","75d26d87":"code","86711387":"markdown","58b7c02a":"markdown","7ce6192a":"markdown","9bf98f3f":"markdown","530381a0":"markdown","4acc7f0f":"markdown","6e170ee0":"markdown","35ef29bf":"markdown","32549375":"markdown"},"source":{"05148caa":"# packages\n\n# standard\nimport numpy as np\nimport pandas as pd\nimport time\n\n# plots\nimport matplotlib.pyplot as plt\nimport plotly.express as px\nimport seaborn as sns\n\n# Maps\nimport folium","a45e2998":"# files\n!ls -l ..\/input\/bike-traffic-in-munich\/","d09e93a7":"# load location data\ndf_locations = pd.read_csv('..\/input\/bike-traffic-in-munich\/radzaehlstellen.csv')\ndf_locations","4bf6d0e4":"# translate columns to English\ndf_locations = df_locations.rename(columns = \n                                   {'zaehlstelle' : 'measuring_station',\n                                    'zaehlstelle_lang': 'measuring_station_long',\n                                    'richtung_1' : 'direction_1',\n                                    'richtung_2' : 'direction_2',\n                                    'besonderheiten' : 'notes'},\n                                    inplace = False)\n\ndf_locations","f890f591":"# load daily stats\ndf_days = pd.read_csv('..\/input\/bike-traffic-in-munich\/rad_tage.csv')\ndf_days.head()","de7f07f0":"# translate columns to English\ndf_days = df_days.rename(columns = \n                         {'datum' : 'date',\n                          'uhrzeit_start': 'time_start',\n                          'uhrzeit_ende': 'time_end',\n                          'zaehlstelle' : 'measuring_station',\n                          'richtung_1' : 'direct_1',\n                          'richtung_2' : 'direct_2',\n                          'gesamt' : 'total',\n                          'niederschlag' : 'precipitation',\n                          'bewoelkung' : 'cloud_cover_perc',\n                          'sonnenstunden' : 'sun_hours'},\n                          inplace = False)\n\ndf_days.head()","0fcc7815":"# structure of data frame\ndf_days.info()","b63c4088":"# plot development of total by measuring station\nfig, ax = plt.subplots(figsize=(16,6))\nax = sns.lineplot(data=df_days, x='date', y='total',\n                  hue = df_days.measuring_station,\n                  alpha = 0.5)\nax.xaxis.set_major_locator(plt.MaxNLocator(20)) # reduce number of x-labels\nplt.title('Total by Measuring Station')\nplt.xticks(rotation=90)\nplt.grid()\nplt.show()","e6a3b407":"# same plot but y-axis in log scale\nfig, ax = plt.subplots(figsize=(16,6))\nax = sns.lineplot(data=df_days, x='date', y='total',\n                  hue = df_days.measuring_station,\n                  alpha = 0.5)\nax.xaxis.set_major_locator(plt.MaxNLocator(20)) # reduce number of x-labels\nplt.xticks(rotation=90)\nplt.yscale('log')\nplt.legend(loc='lower left')\nplt.title('Total by Measuring Station')\nplt.grid()\nplt.show()","87f329de":"# scatter plots by station\nsns.pairplot(df_days[['sun_hours','precipitation','cloud_cover_perc',\n                      'total','measuring_station']],\n             hue='measuring_station',\n             plot_kws = dict(alpha=0.25, s=5),\n             diag_kws = dict(alpha=0.25))\nplt.show()","b3df7831":"# pick only one location\ndf_days_sel = df_days[df_days.measuring_station=='Arnulf']\nsns.pairplot(df_days_sel[['sun_hours','precipitation','cloud_cover_perc',\n                          'total','measuring_station']],\n             hue='measuring_station', \n             plot_kws = dict(alpha=0.25, s=10),\n             diag_kws = dict(alpha=0.25))\nplt.show()","c9e43d9c":"# plot development\nfig, ax = plt.subplots(figsize=(16,6))\nax = sns.lineplot(data=df_days_sel, x='date', y='total',\n                  alpha=0.5)\nax.xaxis.set_major_locator(plt.MaxNLocator(20)) # reduce number of x-labels\nplt.title('Total for Measuring Station \"Arnulf\"')\nplt.xticks(rotation=90)\nplt.grid()\nplt.show()","e523db4c":"df_days_means = df_days.groupby(['measuring_station'], as_index=False).mean()\ndf_days_means","c1eea755":"# show total by station, split in directions\nfig, ax = plt.subplots(figsize=(11,5))\nax.bar(df_days_means.measuring_station, df_days_means.direct_1, \n       label='Direction 1')\nax.bar(df_days_means.measuring_station, df_days_means.direct_2,\n       bottom= df_days_means.direct_1,\n       label='Direction 2')\nax.set_ylabel('Average by Station and Direction')\nax.set_title('')\nax.legend()\nplt.grid()\nplt.show()","7d8df635":"# add calculated stats to locations table\ndf_locations_x = df_locations.merge(df_days_means, on='measuring_station')\n# show merged table\ndf_locations_x","3acfa6dc":"# interactive map\nzoom_factor = 11.5 # inital map size\n\nmy_map_1 = folium.Map(location=[48.14,11.55], zoom_start=zoom_factor)\n\nfor i in range(0,df_locations_x.shape[0]):\n   folium.Circle(\n      location=[df_locations_x.iloc[i]['latitude'], df_locations_x.iloc[i]['longitude']],\n      radius=10*np.sqrt(df_locations_x.iloc[i]['total']),      \n      popup='Location: ' + df_locations_x.iloc[i]['measuring_station'] + \n           ' - Total: ' + str(np.round(df_locations_x.iloc[i]['total'],2)),\n      color='blue',\n      fill=True,\n      fill_color='blue'\n   ).add_to(my_map_1)\n\nmy_map_1 # display","955d39c2":"# transpose values per station into new columns\ndf_days_pivot = pd.pivot_table(data=df_days[['date','measuring_station','total']],\n                                # class_id is used as dummy column for counting only\n                                index='date', # arrange by date\n                                columns=['measuring_station'], # new column for each station\n                                fill_value=0,\n                                aggfunc='sum')\n# simpliy column name hierarchy\ndf_days_pivot.columns = df_days_pivot.columns.droplevel(0).tolist()\ndf_days_pivot.head()","a9590b77":"# summary stats by station\ndf_days_pivot.describe()","9990c108":"# correlations\ncorr_pearson = df_days_pivot.corr(method='pearson')\ncorr_spearman = df_days_pivot.corr(method='spearman')\n\nplt.figure(figsize=(15,5))\nax1 = plt.subplot(1,2,1)\nsns.heatmap(corr_pearson, annot=True, cmap='RdYlGn', vmin=0, vmax=+1)\nplt.title('Pearson Correlation')\n\nax2 = plt.subplot(1,2,2, sharex=ax1)\nsns.heatmap(corr_spearman, annot=True, cmap='RdYlGn', vmin=0, vmax=+1)\nplt.title('Spearman Correlation')\nplt.show()","75d26d87":"# pairwise scatter plot\nsns.pairplot(df_days_pivot, \n             kind='reg',\n             plot_kws={'line_kws':{'color':'magenta'}, \n                       'scatter_kws': {'alpha': 0.2}})\nplt.show()\n","86711387":"#### Using logarithmic y-axis:","58b7c02a":"# Table of Contents\n* [Import and Data Preparation](#1)\n* [Development by Station](#2)\n* [Averages and Visualization](#3)\n* [Stats by Station and Correlations](#4)","7ce6192a":"### Visualize Measuring Stations:","9bf98f3f":"<a id='1'><\/a>\n# Import and Data Preparation","530381a0":"<a id='3'><\/a>\n# Averages and Visualization","4acc7f0f":"### Pick only one station:","6e170ee0":"<a id='2'><\/a>\n# Development by Station","35ef29bf":"<a id='4'><\/a>\n# Stats by Station and Correlations","32549375":"### Calc averages by measuring station:"}}