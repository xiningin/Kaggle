{"cell_type":{"98ad9656":"code","fec0ee94":"code","06b89942":"code","3622b916":"code","2ca9d1ce":"code","8b693546":"code","7b92e459":"code","9d652a28":"code","655e0237":"code","a49cdacc":"code","1c97e2eb":"code","e88c0db8":"code","cff1ce7c":"code","4cc34ac6":"code","210f1467":"code","06ef4f53":"code","b7d8a029":"code","47007cab":"code","2503f348":"code","12e6c4cb":"code","3b5cbf4b":"code","b93b36d0":"markdown"},"source":{"98ad9656":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport missingno as msno\nimport datetime as dt\nfrom PIL import Image\nimport xlrd\nfrom sklearn.preprocessing import MinMaxScaler    \n\npd.set_option('display.max_rows', None)\npd.set_option('display.max_columns', None)\nfrom warnings import filterwarnings\nfilterwarnings('ignore')\nfrom IPython.core.display import HTML\n","fec0ee94":"data=pd.read_excel(\"..\/input\/turkish-market-sales-dataset-with-9000items\/MarketSales.xlsx\")","06b89942":"def data_understanding(data):\n    print(\"DATA INFORMATION\",\"\\n\\n\")\n    print(\"Shape:\", data.shape )\n    float_cols=[col for col in data.columns if data[col].dtype==\"float64\"]\n    obj_cols=[col for col in data.columns if data[col].dtype==\"O\"]\n    int_cols=[col for col in data.columns if data[col].dtype==\"int64\"]\n    date_cols=[col for col in data.columns if col not in obj_cols and col not in float_cols and col not in int_cols ]\n    print(\"\\n\\n\",\"DATA COLUMNS\",\"\\n\\n\")\n    print(\"Float columns:\", float_cols)\n    print(\"\\n\",\"Object columns:\", obj_cols)\n    print(\"\\n\",\"Integer columns:\", int_cols)\n    print(\"\\n\",\"Datetime columns:\", date_cols)\n    display(HTML(data.to_html(max_rows=1)))\n    print(\"NULL VALUES\")\n    print(\"Total number of rows which have null data: \", data.shape[0]-data.dropna().shape[0])\n    print( \"Percentage of null data\", \"%.3f\" % ((data.shape[0]-data.dropna().shape[0])\/data.shape[0]))\n    msno.bar(data)\n    msno.heatmap(data)\n    plt.show()\n    print( \"CORRELATION\")\n    plt.figure(figsize=(14,12))\n    sns.heatmap(data.corr(), annot=True, cmap=\"BuPu\");","3622b916":"df=data.copy( )","2ca9d1ce":"data_understanding(df)","8b693546":"df.head(3)","7b92e459":"df.shape ","9d652a28":"df1=df[[\"CLIENTCODE\",\"DATE_\",\"FICHENO\", \"AMOUNT\", \"PRICE\",\"LINENETTOTAL\"]]\ndf1.isnull().sum()","655e0237":"df2=df1.dropna()\ndf2.head()","a49cdacc":"# Calculate the the range of purchase date(like tenure), number of transactions, sum of quantities and sum of total price \ndf3=df2.groupby(\"CLIENTCODE\").agg({\"DATE_\": lambda date: (date.max()-date.min()).days,\n                      \"FICHENO\": lambda num: len(num),\n                       \"AMOUNT\": lambda quant: quant.sum(),\n                       \"LINENETTOTAL\": lambda price: price.sum()\n                      })","1c97e2eb":"# Change the name of columns\ndf3.columns=[\"numdays\", \"numtransactions\",\"numunits\", \"spentmoney\"]\ndf3.head()","e88c0db8":"# Calculate avg order value\n# birim ba\u015f\u0131na kazan\u00e7\ndf3[\"avg_order_value\"]=df3[\"spentmoney\"]\/df3[\"numtransactions\"]\ndf3.head()","cff1ce7c":"# ki\u015finin yapt\u0131\u011f\u0131 i\u015flem say\u0131s\u0131\/t\u00fcm i\u015flemler\npurchase_frequency=sum(df3[\"numtransactions\"])\/df3.shape[0]\npurchase_frequency","4cc34ac6":"# m\u00fc\u015fteri al\u0131\u015fveri\u015f yapt\u0131ktan sonra die olur, 1 kere al\u0131\u015fveri\u015f yapanlar\u0131n oran\u0131n\u0131 bulduk\nchurn_rate=df3[df3[\"numtransactions\"]<=1].shape[0]\/df3.shape[0]\nchurn_rate","210f1467":"repeat_rate=1-churn_rate\nrepeat_rate","06ef4f53":"purchase_frequency, repeat_rate, churn_rate","b7d8a029":"# her sat\u0131\u015ftan %5 kar etti\u011fimizi varsayarsak\ndf3[\"profit_margin\"]=df3[\"spentmoney\"]*0.05\ndf3.head()","47007cab":"# (birim ba\u015f\u0131na ortalama kazan\u00e7*ki\u015finin yapt\u0131\u011f\u0131 t\u00fcm i\u015flemler)\/ m\u00fc\u015fterinin \u00f6lme oran\u0131(sdc 1 al\u0131\u015fveri\u015f yapanlar \u00f6ld\u00fc)\ndf3[\"CV\"]=(df3[\"avg_order_value\"]*purchase_frequency)\/churn_rate\ndf3.head()","2503f348":"df3[\"CLTV\"]=df3[\"CV\"]*df3[\"profit_margin\"]","12e6c4cb":"df3.head()","3b5cbf4b":"scaler = MinMaxScaler(feature_range=(1, 100))\nscaler.fit(df3[[\"CLTV\"]])\ndf3[\"SCALED_CLTV\"] = scaler.transform(df3[[\"CLTV\"]])\ndf3[\"segment\"] = pd.qcut(df3[\"SCALED_CLTV\"], 4, labels=[\"D\", \"C\", \"B\", \"A\"])\ndf3.head()","b93b36d0":"# DATA EXPLANATION\n\ndf=data.copy()\n##### - This dataset contains a supermarket data in Turkish Language. \n##### - There are more than 600.000 sales rows, contains\n##### - 52.000+ unique Turkish customername,gender,age,birthdate etc.\n##### - 9.000+ Categorized and subcategorized items with category1,category2,category3,category4\n##### - 81 Stores\n##### - 1200+ Salesman\n##### - Geographic location information (Latitude, longitude)\n##### - The data contains 3 month sales.\n##### - All the data was artificial. Sales created randomly according to population of the cities. \n##### Also all customernames are artificial too."}}