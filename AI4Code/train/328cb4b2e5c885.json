{"cell_type":{"cc4e8a14":"code","4de0e099":"code","9ef2d842":"code","ee185540":"code","7dd328db":"code","094260be":"code","4ebc25d2":"code","33e35502":"code","6916ba0f":"code","f98e5991":"code","4f565938":"code","ddbc16c3":"code","02212fa4":"code","2993c09d":"code","681b2861":"code","f8f55c2f":"code","4783cccd":"code","dee947bf":"code","c60294e2":"code","8609c059":"code","15cb2bf9":"code","4dd0b3f0":"code","858352fe":"code","213c839e":"code","3a2a0494":"code","767e7254":"code","5c7d88f3":"code","2e41a64d":"code","577e2163":"code","66250ef0":"code","7046847b":"code","f7c0b5b7":"markdown","e04e584b":"markdown","95794849":"markdown","96982957":"markdown"},"source":{"cc4e8a14":"DATASET_DIR = \"..\/input\/covid19-global-forecasting-week-2\"\nTRAIN_FILE = DATASET_DIR + \"\/train.csv\"\nTEST_FILE = DATASET_DIR + \"\/test.csv\"","4de0e099":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt \n%matplotlib inline\nimport seaborn as sns\nfrom datetime import datetime","9ef2d842":"df_train = pd.read_csv(TRAIN_FILE)\ndf_train.head()","ee185540":"df_test = pd.read_csv(TEST_FILE)\ndf_test.head(5)","7dd328db":"df_train.info()","094260be":"df_train[\"Province_State\"].isnull().sum()","4ebc25d2":"df_train.isnull().sum()","33e35502":"df_train[df_train[\"Province_State\"].notnull()]","6916ba0f":"# reformat dates\ndf_train['Date'] = pd.to_datetime(df_train['Date'], infer_datetime_format=True)\ndf_test['Date'] = pd.to_datetime(df_test['Date'], infer_datetime_format=True)","f98e5991":"df_train.loc[:2,:'Date']","4f565938":"pd.plotting.register_matplotlib_converters()\ngrouped_data = df_train.groupby('Date')['Date', 'ConfirmedCases', 'Fatalities'].sum().reset_index()\ngrouped_data = grouped_data.sort_values(by=['Date'], ascending=True) \ngrouped_data['ConfirmedCases'] = grouped_data['ConfirmedCases'].astype(int)\ngrouped_data['Fatalities'] = grouped_data['Fatalities'].astype(int)\ngrouped_data.head()","ddbc16c3":"df_train['Date'] = pd.to_datetime(df_train['Date'])\ngrouped_data = df_train.groupby(['Date'],as_index=True).agg({'ConfirmedCases': 'max','Fatalities': 'max'})\ngrouped_data['ConfirmedCases'] = grouped_data['ConfirmedCases'].astype(int)\ngrouped_data['Fatalities'] = grouped_data['Fatalities'].astype(int)\ndisplay(grouped_data.head())","02212fa4":"grouped_data = df_train.groupby('Date').sum()[['ConfirmedCases', 'Fatalities']]\nsns.set(style = 'whitegrid')\ngrouped_data.plot(kind='line', figsize = (15,7) , marker='o',linewidth=2)\nplt.bar(grouped_data.index, grouped_data['ConfirmedCases'],alpha=0.3,color='g')\nplt.xlabel('Days', fontsize=15)\nplt.ylabel('Number of cases', fontsize=15)\nplt.title('Worldwide Covid-19 cases - Confirmed & Fatalities',fontsize=20)\nplt.legend()\nplt.show()","2993c09d":"grouped_data = df_train[df_train['Country_Region']=='Morocco'].groupby('Date').sum()[['ConfirmedCases', 'Fatalities']]\nsns.set(style = 'whitegrid')\ngrouped_data.plot(kind='line', figsize = (15,7) , marker='o',linewidth=2)\nplt.bar(grouped_data.index, grouped_data['ConfirmedCases'],alpha=0.3,color='g')\nplt.xlabel('Days', fontsize=15)\nplt.ylabel('Number of cases', fontsize=15)\nplt.title('Morocco Covid-19 cases - Confirmed & Fatalities',fontsize=20)\nplt.legend()\nplt.show()","681b2861":"grouped_data = df_train[(df_train['Country_Region']=='Morocco') & (df_train['ConfirmedCases']>0)].groupby('Date').sum()[['ConfirmedCases', 'Fatalities']]\nsns.set(style = 'whitegrid')\ngrouped_data.plot(kind='line', figsize = (15,7) , marker='o',linewidth=2)\nplt.bar(grouped_data.index, grouped_data['ConfirmedCases'],alpha=0.3,color='g')\nplt.xlabel('Days', fontsize=15)\nplt.ylabel('Number of cases', fontsize=15)\nplt.title('Morocco Covid-19 cases - Confirmed & Fatalities',fontsize=20)\nplt.legend()\nplt.show()","f8f55c2f":"grouped_data = df_train.groupby('Country_Region')['ConfirmedCases', 'Fatalities'].sum().reset_index()\ngrouped_data = grouped_data.sort_values(by=['ConfirmedCases'], ascending=False) \ngrouped_data['ConfirmedCases'] = grouped_data['ConfirmedCases'].astype(int)\ngrouped_data['Fatalities'] = grouped_data['Fatalities'].astype(int)\ngrouped_data.head(10)","4783cccd":"grouped_data = df_train.groupby('Country_Region')['ConfirmedCases', 'Fatalities'].sum().reset_index()\ngrouped_data_sort_confirmed_cases = grouped_data.sort_values(by=['ConfirmedCases', 'Fatalities'], ascending=False)[:10] \ngrouped_data_sort_fatalities = grouped_data.sort_values(by=['Fatalities', 'ConfirmedCases'], ascending=False)[:10] ","dee947bf":"sns.barplot(x=\"ConfirmedCases\", y=\"Country_Region\", data=grouped_data_sort_confirmed_cases)\nplt.xticks(rotation=45)\nplt.xlabel(\"Confirmed Cases\")\nplt.ylabel(\"Country\")\nplt.title(\"Confirmed Cases By Countries\")\nplt.show()","c60294e2":"sns.barplot(x=\"Fatalities\", y=\"Country_Region\", data=grouped_data_sort_fatalities)\nplt.xticks(rotation=45)\nplt.xlabel(\"Fatalities\")\nplt.ylabel(\"Country\")\nplt.title(\"Fatalities By Countries\")\nplt.show()","8609c059":"df_china = df_train[df_train['Country_Region'] == \"China\"]\ndf_china = df_china[df_china['Date'] == max(df_china['Date'])]\ngrouped_data = df_china.groupby('Province_State')['ConfirmedCases', 'Fatalities'].max().reset_index()\n\ngrouped_data_sort = grouped_data.sort_values(by=['ConfirmedCases', 'Fatalities'], ascending=False)[:10] \n\nfig = sns.barplot(x=\"ConfirmedCases\", y=\"Province_State\", data=grouped_data_sort)\n\nplt.xticks(rotation=45)\nplt.xlabel(\"Confirmed Cases\")\nplt.ylabel(\"Province\")\nplt.title(\"Confirmed Cases By Provinces In China\")\nplt.show()","15cb2bf9":"df_china = df_train[df_train['Country_Region'] == \"US\"]\ndf_china = df_china[df_china['Date'] == max(df_china['Date'])]\ngrouped_data = df_china.groupby('Province_State')['ConfirmedCases', 'Fatalities'].max().reset_index()\n\ngrouped_data_sort = grouped_data.sort_values(by=['ConfirmedCases', 'Fatalities'], ascending=False)[:10] \n\nfig = sns.barplot(x=\"ConfirmedCases\", y=\"Province_State\", data=grouped_data_sort, label=\"Confirmed Fatalities In China\")\n\nplt.xticks(rotation=45)\nplt.xlabel(\"Confirmed Cases\")\nplt.ylabel(\"State\")\nplt.title(\"Confirmed Cases By States In US\")\nplt.show()","4dd0b3f0":"train_data = df_train.copy()\n# train_data.drop('Province_State',axis=1,inplace=True)\n\ntest_data = df_test.copy()\n# test_data.drop('Province_State',axis=1,inplace=True)\n\ntrain_data['Date'] = train_data['Date'].dt.strftime(\"%m%d\").astype(int)\ntest_data['Date'] = test_data['Date'].dt.strftime(\"%m%d\").astype(int)\n","858352fe":"train_data['Province_State'] = train_data['Province_State'].fillna(\"N\/D\")\ntest_data['Province_State'] = test_data['Province_State'].fillna(\"N\/D\")","213c839e":"from sklearn.preprocessing import LabelEncoder\nLE=LabelEncoder()\n\ntrain_data['Province_State']=LE.fit_transform(train_data['Province_State'])\ntest_data['Province_State']=LE.transform(test_data['Province_State'])\n\ntrain_data['Country_Region']=LE.fit_transform(train_data['Country_Region'])\ntest_data['Country_Region']=LE.transform(test_data['Country_Region'])","3a2a0494":"train_data.tail()","767e7254":"x_cols = ['Date','Province_State', 'Country_Region']\ny_cols = ['ConfirmedCases', 'Fatalities']\n\ntrain_data[x_cols].head(10)","5c7d88f3":"from sklearn.ensemble import AdaBoostRegressor\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.model_selection import RandomizedSearchCV\n\nmodel_dtr = DecisionTreeRegressor(max_depth=None) \nparam_grid = {\n    'n_estimators': [100, 200, 300],\n    'learning_rate': [0.1, 0.01, 0.001]\n             }\nmodel_abr = AdaBoostRegressor(base_estimator=model_dtr)\n\nmodel = RandomizedSearchCV(estimator = model_abr, param_distributions = param_grid,\n                    n_iter = 100, cv =10, verbose=0, random_state=2020, n_jobs = -1)\nmodel.fit(train_data[x_cols], train_data[y_cols[0]])\npredictions1 = model.predict(test_data[x_cols])\n\nmodel = RandomizedSearchCV(estimator = model_abr, param_distributions = param_grid,\n                    n_iter = 100, cv = 10, verbose=0, random_state=2020, n_jobs = -1)\nmodel.fit(train_data[x_cols], train_data[y_cols[1]])\npredictions2 = model.predict(test_data[x_cols])","2e41a64d":"predictions1[:50]","577e2163":"predictions2[:50]","66250ef0":"submission = pd.DataFrame({'ForecastId':test_data['ForecastId'],'ConfirmedCases':predictions1,'Fatalities':predictions2})\nsubmission['ConfirmedCases'] = submission['ConfirmedCases'].astype(int)\nsubmission['Fatalities'] = submission['Fatalities'].astype(int)\nsubmission.head(50)","7046847b":"filename = 'submission.csv'\nsubmission.to_csv(filename,index=False)\nprint('Saved file: ' + filename)","f7c0b5b7":"## Model","e04e584b":"## Generate Predictions","95794849":"## Data cleaning","96982957":"## EDA "}}