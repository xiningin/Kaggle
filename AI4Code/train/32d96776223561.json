{"cell_type":{"b1c35297":"code","c85607dc":"code","c6b82513":"code","73f2262d":"code","6a85d616":"code","a557905b":"code","e2bf0947":"code","1cab8ac0":"code","63937922":"code","9d718770":"code","a98d627b":"code","97010663":"code","9b483c84":"code","5be0e25e":"code","872f27e9":"code","bafc7480":"code","06abfa48":"code","bfa97f90":"code","ca895ccd":"code","5a8bf479":"code","5da8b382":"code","a7bf804e":"code","09ff124c":"code","0746b3fb":"code","908e4e2b":"code","b0150c74":"code","9736baae":"code","5beed5d7":"code","5cffd915":"markdown","35809e9e":"markdown","01781f11":"markdown","e1c3b8f1":"markdown","00196cc5":"markdown","8e543ff9":"markdown"},"source":{"b1c35297":"import pandas as pd\nimport numpy as np\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nplt.rcParams[\"figure.figsize\"] = (10, 8)","c85607dc":"book = pd.read_parquet('..\/input\/optiver-realized-volatility-prediction\/book_train.parquet\/stock_id=0')\ntrade =  pd.read_parquet('..\/input\/optiver-realized-volatility-prediction\/trade_train.parquet\/stock_id=0')","c6b82513":"book = book.set_index('time_id')\ntrade = trade.set_index('time_id')","73f2262d":"book.head()","6a85d616":"trade.head()","a557905b":"book","e2bf0947":"def log_return(list_stock_prices):\n    return np.log(list_stock_prices).diff() \n\ndef realized_volatility(series_log_return):\n    return np.sqrt(np.sum(series_log_return**2))\n\n# More to come...\ndef calc_stats(df):\n    df['size_spread_l1'] = df['ask_size1'] - df['bid_size1']\n    df['size_spread_l2'] = df['ask_size2'] - df['bid_size2']\n    \n    df['price_spread_l1'] = df['ask_price1'] - df['bid_price1']\n    df['price_spread_l2'] = df['ask_price2'] - df['bid_price2']\n    \n    df['wap'] = (df['bid_price1'] * df['ask_size1'] + df['ask_price1'] * df['bid_size1']) \/ (df['bid_size1']+ df['ask_size1'])\n    \n    df.loc[:,'log_return'] = log_return(df['wap'])\n    df = df[~df['log_return'].isnull()]\n    \n    # This is wrong\n    df['realized_vol'] = realized_volatility(df['log_return'])\n    \n    return df","1cab8ac0":"book = calc_stats(book)","63937922":"book","9d718770":"book.describe()","a98d627b":"plt.plot(book['size_spread_l1'])\nplt.title('Layer 1 Size Spread on Stock 0')\nplt.xlabel('Time ID')\nplt.ylabel('Spread')\nplt.show()","97010663":"plt.hist(book['size_spread_l1'], bins='auto')\nplt.title('Layer 1 Size Spread on Stock 0 Distribution')\nplt.yscale('log')\nplt.xlabel('Time ID')\nplt.ylabel('Spread')\nplt.show()","9b483c84":"plt.hist(book['size_spread_l1'], bins='auto')\nplt.title('Layer 1 Size Spread on Stock 0 Distribution')\nplt.xlabel('Time ID')\nplt.ylabel('Spread')\nplt.show()","5be0e25e":"book['size_spread_l1'].describe()","872f27e9":"plt.plot(book['size_spread_l2'])\nplt.title('Layer 2 Size Spread on Stock 0')\nplt.xlabel('Time ID')\nplt.ylabel('Spread')\nplt.show()","bafc7480":"plt.hist(book['size_spread_l2'], bins='auto')\nplt.title('Layer 2 Size Spread on Stock 0 Distribution')\nplt.yscale('log')\nplt.xlabel('Time ID')\nplt.ylabel('Spread')\nplt.show()","06abfa48":"plt.hist(book['size_spread_l2'], bins='auto')\nplt.title('Layer 2 Size Spread on Stock 0 Distribution')\nplt.xlabel('Time ID')\nplt.ylabel('Spread')\nplt.show()","bfa97f90":"book['size_spread_l2'].describe()","ca895ccd":"book.head()","5a8bf479":"plt.plot(book['bid_price1'], c='b', label='Bid Price')\nplt.plot(book['ask_price1'], c='r', label='Ask Price', alpha=0.7)\nplt.title('Best Bid\/Ask Prices')\nplt.xlabel('Time ID')\nplt.ylabel('Price')\nplt.legend()\nplt.show()","5da8b382":"plt.plot(book[:100000]['bid_price1'], c='b', label='Bid Price')\nplt.plot(book[:100000]['ask_price1'], c='r', label='Ask Price', alpha=0.7)\nplt.title('Best Bid\/Ask Prices')\nplt.xlabel('Time ID')\nplt.ylabel('Price')\nplt.legend()\nplt.show()","a7bf804e":"plt.plot(book['bid_price2'], c='b', label='Bid Price')\nplt.plot(book['ask_price2'], c='r', label='Ask Price', alpha=0.7)\nplt.title('L2 Bid\/Ask Prices')\nplt.xlabel('Time ID')\nplt.ylabel('Price')\nplt.legend()\nplt.show()","09ff124c":"plt.plot(book[:100000]['bid_price2'], c='b', label='Bid Price')\nplt.plot(book[:100000]['ask_price2'], c='r', label='Ask Price', alpha=0.7)\nplt.title('L2 Bid\/Ask Prices')\nplt.xlabel('Time ID')\nplt.ylabel('Price')\nplt.legend()\nplt.show()","0746b3fb":"plt.hist(book['bid_price1'], bins='auto', label='Best Bids')\nplt.hist(book['bid_price2'], bins='auto', label='L2 Bids', alpha=0.7)\nplt.title('Bids on Stock 0 Distribution')\nplt.xlabel('Time ID')\nplt.ylabel('Bid Value')\nplt.legend()\nplt.show()","908e4e2b":"plt.hist(book['bid_price1'], bins='auto', label='Best Bids')\nplt.hist(book['bid_price2'], bins='auto', label='L2 Bids', alpha=0.7)\nplt.title('Bids on Stock 0 Distribution')\nplt.xlabel('Time ID')\nplt.ylabel('Bid Value')\nplt.yscale('log')\nplt.legend()\nplt.show()","b0150c74":"plt.hist(book['ask_price1'], bins='auto', label='Best Ask')\nplt.hist(book['ask_price2'], bins='auto', label='L2 Ask', alpha=0.7)\nplt.title('Asks on Stock 0 Distribution')\nplt.xlabel('Time ID')\nplt.ylabel('Ask Value')\nplt.legend()\nplt.show()","9736baae":"plt.hist(book['ask_price1'], bins='auto', label='Best Ask')\nplt.hist(book['ask_price2'], bins='auto', label='L2 Ask', alpha=0.7)\nplt.title('Asks on Stock 0 Distribution')\nplt.xlabel('Time ID')\nplt.ylabel('Ask Value')\nplt.yscale('log')\nplt.legend()\nplt.show()","5beed5d7":"plt.plot(book['log_return'], label='Log Returns')\nplt.title('Log Returns on Stock 0')\nplt.xlabel('Time ID')\nplt.ylabel('Returns')\nplt.legend()\nplt.show()","5cffd915":"# Returns Analysis","35809e9e":"# Size Spread Plots","01781f11":"# Calculate Orderbook Statistics","e1c3b8f1":"# Import Libraries","00196cc5":"Reference: https:\/\/www.kaggle.com\/munumbutt\/wip-eda-on-the-orderbook","8e543ff9":"# Price Spread Plots"}}