{"cell_type":{"6890b713":"code","a6334b0c":"code","c05c55bb":"code","4fd06bda":"code","dfc6da66":"code","71ef074c":"code","e755a9b9":"code","39ee9266":"code","ba8ea320":"code","2c7ddd12":"code","156c6856":"code","57df3b9f":"code","882fe1dd":"code","777c850b":"code","f444309d":"code","414aeecc":"code","1a1f46a6":"code","5bd0f835":"code","30b2ebf8":"code","8cfe6566":"code","6f802dc4":"code","7af9842c":"code","d7acefd5":"markdown","f9a4a2f2":"markdown","de82721f":"markdown","76f92b70":"markdown"},"source":{"6890b713":"import os\nimport warnings\nfrom pathlib import Path\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport seaborn as sns\nimport matplotlib.pylab as plt\nfrom fastai.tabular.core import df_shrink\n\nwarnings.simplefilter(action='ignore', category=FutureWarning)","a6334b0c":"ROOT_TRAIN = Path('..\/input\/data-science-spring-osaka-2021')\n\n# \u4e00\u89a7\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\ndf_train = pd.read_csv('..\/input\/data-science-spring-osaka-2021\/train.csv')\ndf_test = pd.read_csv('..\/input\/data-science-spring-osaka-2021\/test.csv')\ndf_action = pd.read_csv('..\/input\/data-science-spring-osaka-2021\/actions.csv')","c05c55bb":"# \u5f8c\u306e\u30d5\u30a3\u30eb\u30bf\u30fc\u3068\u3057\u3066\u30d5\u30a3\u30eb\u540d\u3092\u6e96\u5099\ndf_train['filename'] = df_train['file_path'].apply(lambda x: x.split('\/', -1)[-1])","4fd06bda":"# train \u3068 test \u30d5\u30a9\u30eb\u30c0\u4e8c\u3064\u3042\u308a\u307e\u3059\u2190\u7d50\u5408\u5bfe\u8c61\n!ls -l {ROOT_TRAIN}","dfc6da66":"# \u7d50\u5408\u5bfe\u8c61\u306e\u30ea\u30b9\u30c8\u3092\u751f\u6210\n# https:\/\/stackoverflow.com\/a\/56883447\/5990952\nlist_train = sorted((ROOT_TRAIN\/'train').glob('*.csv'))\nlist_test = sorted((ROOT_TRAIN\/'test').glob('*.csv'))","71ef074c":"# \u7d50\u5408\u7528\u306e\u30e1\u30bd\u30c3\u30c9\u3001\u4eca\u56de\u30d5\u30a1\u30a4\u30eb\u6570\u5c11\u306a\u3044\uff06\u30b5\u30a4\u30ba\u5c0f\u3055\u3044\u306e\u3067\u3001\u4e26\u5217\u51e6\u7406\u3092\u8003\u3048\u305a\u306b\u3059\u308b\ndef get_data(list_files):\n    dfs = []\n    for file in list_files:\n        df = pd.read_csv(file)\n        df['filename'] = file.name\n        dfs.append(df)\n    return pd.concat(dfs)","e755a9b9":"%%time\ndf_train_s = get_data(list_train)\ndf_test_s = get_data(list_test)\n# train \/ test \u3092\u660e\u793a\ndf_train_s['type'] = 'train'\ndf_test_s['type'] = 'test'\nprint(\"\u5b66\u7fd2\", df_train_s.shape, \"\u30c6\u30b9\u30c8\", df_test_s.shape)\n# \u4e00\u3064\u306b\u7d50\u5408\u3059\u308b\ndf_sensor = pd.concat([df_train_s, df_test_s], ignore_index=True)\n# \u30e9\u30d9\u30eb\u3068\u7d50\u5408\ndf_sensor = pd.merge(df_sensor, df_train[['action_seq', 'filename']], on='filename', how='left')\n## \u30c6\u30b9\u30c8\u3092\"test\"\u3068\u3057\u3066\u88dc\u9593\ndf_sensor['action_seq'] = df_sensor['action_seq'].fillna('test')\nprint(\"\u5168\u4f53\", df_sensor.shape)","39ee9266":"df_sensor.head()","ba8ea320":"# \u30c7\u30fc\u30bf\u306e\u30b5\u30a4\u30ba\u78ba\u8a8d\nprint(f'\u30c7\u30fc\u30bf\u30b5\u30a4\u30baAsIs: {df_sensor.memory_usage().sum()\/1024} KB')","2c7ddd12":"# \u4eca\u56de\u91cd\u8981\u3067\u306f\u306a\u3044\u304c\u3001\u30b5\u30a4\u30ba\u304c\u5927\u304d\u304f\u306a\u3063\u3066\u3044\u308b\u969b\u306b\u3001\u51e6\u7406\u304c\u9045\u304f\u306a\u308b\u306e\u3067\u3001\n# \u60c5\u5831\u91cf\u6e1b\u3089\u305b\u306a\u3044\u524d\u63d0\u3067\u30b5\u30a4\u30ba\u30c0\u30a6\u30f3\u3057\u307e\u3059\u3002\n# 1\/4\u307e\u3067\u6e1b\u3089\u305b\u305f\u306e\u306f\u52b9\u679c\u7684\uff01\n# https:\/\/gist.github.com\/simecek\/9d0fa3be4afbce5b884dfed6b57b0931\ndf_sensor = df_shrink(df_sensor)\nprint(f'\u30c7\u30fc\u30bf\u30b5\u30a4\u30baAsIs: {df_sensor.memory_usage().sum()\/1024} KB')","156c6856":"# \u524a\u6e1b\u5f8c\u306e\u5148\u982d\u884c\u3092\u78ba\u8a8d\ndf_sensor.head()","57df3b9f":"df_sensor.info()","882fe1dd":"# \u7d50\u5408\u3057\u305f\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\n# \u30ed\u30fc\u30c9\u3059\u308b\u969b\u3001\u30c7\u30fc\u30bf\u30bf\u30a4\u30d7\u3092\u4fdd\u6301\u3059\u308b\u305f\u3081\u3001parquet\u3067\u4fdd\u5b58\ndf_sensor.to_parquet('sensor.parquet')","777c850b":"# df_sensor\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3057\u3066\u3001\u518d\u5ea6\u30ed\u30fc\u30c9\u3057\u3066\u307f\u308b\n# \u540c\u3058\u30c7\u30fc\u30bf\u30bf\u30a4\u30d7\u3092\u78ba\u8a8d\u3067\u304d\u308b\ndel df_sensor\ndf_sensor = pd.read_parquet(\"sensor.parquet\")\ndf_sensor.info()","f444309d":"# \u5b66\u7fd2\u30c7\u30fc\u30bf\ndf_train.head()","414aeecc":"g = sns.countplot(df_train['action_seq'])\ng.set_xticklabels(g.get_xticklabels(), rotation=90)","1a1f46a6":"# \uff11\u30d5\u30a1\u30a4\u30eb\u3092\u53ef\u8996\u5316\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u3002\u3002\u3055\u3063\u3071\u308a\u30c8\u30ec\u30f3\u30c9\u304c\u63b4\u3081\u306a\u3044\ndf_sensor.loc[df_sensor['filename'] == df_sensor['filename'].iloc[0]].plot()","5bd0f835":"%%time\n# feature impact\u4e0a\u4f4d\u306e\"GYRO_Y\"\n# \u4e00\u90e8\u4f3c\u3066\u3044\u308b\u3067\u3042\u308b\u306f\u305a\u306e\"jab-jab-bodyupper\"&\"jab-jab-upper\"\u3092\u898b\u3066\u307f\u3088\u3046\n# \u2192\n# 4000\u4ee5\u964d\u306f\u52d5\u304d\u306f\u306a\u3044\u3088\u3046\u3067\u3001\u7d5e\u308a\u8fbc\u3081\u3088\u3046\nfig, ax = plt.subplots(figsize=(8,6))\ndf_sensor.loc[(df_sensor['type']=='train')\n             &(df_sensor['action_seq']=='jab-jab-bodyupper')].groupby(by='filename')\\\n    .plot(kind='line', x='Time', y='GYRO_Y', legend=False, color='grey', ax=ax)\ndf_sensor.loc[(df_sensor['type']=='train')\n             &(df_sensor['action_seq']=='jab-jab-upper')].groupby(by='filename')\\\n    .plot(kind='line', x='Time', y='GYRO_Y', legend=False, color='blue', alpha=0.5, ax=ax)\nplt.show()","30b2ebf8":"%%time\n\"\"\"\n\u518d\u5ea6\u30d7\u30ed\u30c3\u30c8\u3057\u3066\u307f\u308b\n\u3084\u306f\u308a\u8272\u6fc3\u3044\u306e\u3067\u3001\u8584\u304f\u3057\u307e\u3057\u3087\u3046\n\u2192\nbodyupper\u306f\u6bd4\u8f03\u7684\u306b\u307e\u3068\u307e\u3063\u3066\u3044\u308b\u3088\u3046\u306b\u898b\u3048\u308b\u304c\u3001\nupper\u540c\u5fd7\u306e\u5f62\u72b6\u306f\u4f3c\u3066\u3044\u308b\u304c\u3001\u30bf\u30a4\u30df\u30f3\u30b0\u306f\u30d0\u30e9\u30d0\u30e9\u306b\u898b\u3048\u308b\n\u3082\u3046\u5c11\u3057\u7d30\u304b\u304f\u5206\u3051\u3066\u53ef\u8996\u5316\u3057\u305f\u307b\u3046\u304c\u3044\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3067\u3059\u306d\n\"\"\"\nfig, ax = plt.subplots(figsize=(8,6))\ndf_sensor.loc[(df_sensor['type']=='train')\n             &(df_sensor['action_seq']=='jab-jab-bodyupper')\n             &(df_sensor['Time']<4000)].groupby(by='filename')\\\n    .plot(kind='line', x='Time', y='GYRO_Y', legend=False, color='grey', ax=ax)\ndf_sensor.loc[(df_sensor['type']=='train')\n             &(df_sensor['action_seq']=='jab-jab-upper')\n             &(df_sensor['Time']<4000)].groupby(by='filename')\\\n    .plot(kind='line', x='Time', y='GYRO_Y', legend=False, color='blue', alpha=0.3, ax=ax)\nplt.show()","8cfe6566":"%%time\n\"\"\"\n\u518d\u5ea6upper\u306b\u30d5\u30a9\u30fc\u30ab\u30b9\u3057\u3066\u30d7\u30ed\u30c3\u30c8\u3057\u3066\u307f\u308b\n\u8272\u306e\u7d71\u4e00\u3092\u3084\u3081\u3066\u3001\u30a2\u30af\u30b7\u30e7\u30f3\u3054\u3068\u306b\u898b\u3048\u308b\u3088\u3046\u306b\u3059\u308b\n\u6570\u304c\u591a\u304f\u306a\u308b\u3068\u5206\u304b\u308a\u8f9b\u3044\u306e\u3067\u3001\u30b5\u30f3\u30d7\u30eb\u7684\u306b5\u3064\u30d7\u30ed\u30c3\u30c8\u3059\u308b\n\u2192\n\u5f62\u72b6\u306f\u4f3c\u3066\u3044\u3066\u3001\u63c3\u3063\u305f\u307b\u3046\u304c\u898b\u3084\u3059\u304f\u306a\u308b\u304b\u3082\uff1f\n\"\"\"\ndf_plot = df_sensor.loc[(df_sensor['type']=='train')\n             &(df_sensor['action_seq']=='jab-jab-upper')\n             &(df_sensor['Time'].between(500,4000))]\ndf_plot = df_plot.loc[df_plot['filename'].isin(df_plot['filename'].unique()[:5])]\ndf_plot['filename'] = df_plot['filename'].astype(str)\nfig, ax = plt.subplots(figsize=(8,6))\ndf_plot.groupby(by='filename').plot(kind='line', x='Time', y='GYRO_Y', legend=False, ax=ax)\nplt.show()","6f802dc4":"# \u9078\u629e\u80a2\u305d\u306e\uff12\u3001saeborn\u3067\u30d7\u30ed\u30c3\u30c8\u3059\u308b\nsns.lineplot(x='Time', y='GYRO_Y', hue='filename', data=df_plot, legend=False)","7af9842c":"# train&test\u3092\u30d7\u30ed\u30c3\u30c8\u3057\u3066\u307f\u308b\nfig, ax = plt.subplots(figsize=(8,6))\ndf_sensor.loc[(df_sensor['type']=='train')].groupby(by='filename')\\\n    .plot(kind='line', x='Time', y='GYRO_Y', legend=False, color='grey', ax=ax)\ndf_sensor.loc[(df_sensor['type']=='test')].groupby(by='filename')\\\n    .plot(kind='line', x='Time', y='GYRO_Y', legend=False, color='blue', alpha=0.3, ax=ax)\nplt.show()","d7acefd5":"\u30af\u30e9\u30b9\u9593\u30c7\u30fc\u30bf\u6570\u306e\u5dee\u306f\u305d\u3053\u307e\u3067\u591a\u304f\u306a\u3044\u3067\u3059","f9a4a2f2":"## \u30bb\u30f3\u30b5\u30fc\u30c7\u30fc\u30bf","de82721f":"# EDA","76f92b70":"# \u30c7\u30fc\u30bf\u30ed\u30fc\u30c9"}}