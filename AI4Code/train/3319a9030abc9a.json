{"cell_type":{"9cfad73d":"code","12c7fc84":"code","de67d3a1":"code","65294cfa":"code","9a552992":"code","5964a8f2":"code","07ef2c01":"code","ff3c8187":"code","49dac15a":"code","2c5338ac":"code","fa684b48":"code","03ae8f75":"code","12e6aabe":"markdown","b4b8906e":"markdown","68861e91":"markdown","5d87cefe":"markdown","356972a1":"markdown","04307d98":"markdown","ee9a819b":"markdown","fc61b0a9":"markdown"},"source":{"9cfad73d":"import numpy as np\nimport pandas as pd\nimport pickle\nimport os, sys\nimport gc\nimport math\nimport random\nfrom tqdm import tqdm\nfrom typing import List, NoReturn, Union, Tuple, Optional, Text, Generic, Callable, Dict\n\nfrom tqdm import tqdm\n\n# visualize\nimport matplotlib.pyplot as plt\nimport matplotlib.style as style\nimport seaborn as sns\nfrom matplotlib_venn import venn2\nfrom matplotlib import pyplot\nfrom matplotlib.ticker import ScalarFormatter\nsns.set_context(\"talk\")\nstyle.use('seaborn-colorblind')\npd.options.display.max_columns = None\n\nimport warnings\nwarnings.filterwarnings('ignore')","12c7fc84":"%%time\ntrain_targets = pd.read_csv('..\/input\/lish-moa\/train_targets_scored.csv')\ntrain_targets_non = pd.read_csv('..\/input\/lish-moa\/train_targets_nonscored.csv')\n# train_features = pd.read_csv('..\/input\/lish-moa\/train_features.csv')\n# test_features = pd.read_csv('..\/input\/lish-moa\/test_features.csv')\n    \n# ss = pd.read_csv('..\/input\/lish-moa\/sample_submission.csv')","de67d3a1":"print(train_targets.shape)\ntrain_targets.head()","65294cfa":"print(train_targets_non.shape)\ntrain_targets_non.head()","9a552992":"scored_targets = train_targets.columns.values[1:].tolist()\nnon_scored_targets = train_targets_non.columns.values[1:].tolist()\n\nprint('There are {:,} scored targets and {:,} non-scored targets.'.format(len(scored_targets), len(non_scored_targets)))","5964a8f2":"fig, ax = plt.subplots(1, 2, figsize=(12, 5))\nax = ax.flatten()\n\n# scored targets\nsns.heatmap(train_targets[scored_targets], cbar=False, ax=ax[0])\n\n# non-scored targets\nsns.heatmap(train_targets_non[non_scored_targets], cbar=False, ax=ax[1])\n\nplt.tight_layout()","07ef2c01":"def target_category_maker(targets):\n    targets_category = {'agonist': [], 'antagonist': [], 'agent': [], 'others': []}\n    for t in targets:\n        if ('_agonist' in t) | ('_activator' in t) | ('_stimulant' in t) | ('_secretagogue' in t) | ('_sensitizer' in t):\n            targets_category['agonist'].append(t)\n        elif ('_antagonist' in t) | ('_inhibitor' in t) | ('_blocker' in t):\n            targets_category['antagonist'].append(t)\n        elif ('_agent' in t) | ('_medium' in t):\n            targets_category['agent'].append(t)\n        else:\n            targets_category['others'].append(t)\n    return targets_category\n\ndef show_positive_ratio(train_targets, targets_category):\n    # positive label ratio\n    for k in list(targets_category.keys()):\n        print('')\n        print('----------------------------')\n        print('{} ({:,} features)'.format(k, len(targets_category[k])))\n        print('----------------------------')\n        for t in targets_category[k]:\n            print('{}: {:,} ({:.3f} %) positive.'.format(t, train_targets[t].sum(), 100 * train_targets[t].sum() \/ train_targets.shape[0]))\n    \nprint('SCORED TARGETS')\nscored_targets_category = target_category_maker(scored_targets)\nshow_positive_ratio(train_targets, scored_targets_category)","ff3c8187":"print('NON-SCORED TARGETS')\nnon_scored_targets_category = target_category_maker(non_scored_targets)\nshow_positive_ratio(train_targets_non, non_scored_targets_category)","49dac15a":"# def plot_target_corr(train_targets, targets):\n#     # Compute the correlation matrix\n#     corr = train_targets.loc[train_targets[targets].sum(axis=1) > 0, targets].corr()\n\n#     # Set up the matplotlib figure\n#     f, ax = plt.subplots(figsize=(11, 9))\n\n#     # Generate a custom diverging colormap\n#     cmap = sns.diverging_palette(220, 10, as_cmap=True)\n\n#     # Draw the heatmap with the mask and correct aspect ratio\n#     sns.heatmap(corr, cmap=cmap, annot=True, \n#                 square=True, linewidths=.5, cbar_kws={\"shrink\": .5}, ax=ax)\n#     ax.set_ylim(corr.shape[0], 0)\n#     plt.yticks(rotation=0)\n    \n# print('SCORED TARGETS CORRELATION')\n# plot_target_corr(train_targets, scored_targets)","2c5338ac":"def get_cooccur(train_targets, targets):\n    d = train_targets[targets].T @ train_targets[targets]\n    co = np.tril(d.values, k=-1)\n    df = {'target1': [], 'target2': [], 'co_occurrence': []}\n    for i, t in enumerate(targets):\n        l = [(t, k, co[j, i]) for j, k in enumerate(targets) if co[j, i] > 0]\n        df['target1'] += [f[0] for f in l]\n        df['target2'] += [f[1] for f in l]\n        df['co_occurrence'] += [f[2] for f in l]\n    df = pd.DataFrame.from_dict(df)\n    return df\n\nprint('SCORED TARGETS CO-OCCURENCE')\nscored_df = get_cooccur(train_targets, scored_targets)\nscored_df = scored_df.sort_values(by=['co_occurrence'], ascending=False)\nscored_df.style.background_gradient(cmap='viridis')","fa684b48":"print('NON-SCORED TARGETS CO-OCCURENCE')\nnon_scored_df = get_cooccur(train_targets_non, non_scored_targets)\nnon_scored_df = non_scored_df.sort_values(by=['co_occurrence'], ascending=False)\nnon_scored_df.style.background_gradient(cmap='viridis')","03ae8f75":"print('ALL TARGETS CO-OCCURENCE')\nall_df = get_cooccur(pd.concat([train_targets, train_targets_non], axis=1), scored_targets + non_scored_targets)\nall_df = all_df.sort_values(by=['co_occurrence'], ascending=False)\nall_df.style.background_gradient(cmap='viridis')","12e6aabe":"# Libraries","b4b8906e":"# Targets Sparseness\nLet's visualize how sparse our targets are.","68861e91":"# Correlation among Targets\nIt would be interesting to know target correlations.","5d87cefe":"# Target Co-Occurrence Analysis\nLet's see whether some targets co-occur. Seemingly the co-occurrence is rare but there are some notable ones such as 'nfkb_inhibitor' & 'proteasome_inhibitor' (718 co-occurred!). It looks like there are many inhibitor-inhibitor pairs with co-occurrence. Also, there are too many '6 co-occurrences'...corresponding to 6 samples per drug in this experimental setup.","356972a1":"As you might already know, our targets (incl. non-scored ones) are very sparse. They are all binary targets, so I'm interested in how they co-occur...hopefully to find some patterns.","04307d98":"They look like a beautiful starry sky, but they don't. They are our targets. The non-scored targets are more sparce than the scored ones --- including actually many only-0 targets.\n\nOur targets have some naming patterns --- let's categorize them manually for now.","ee9a819b":"TO BE CONTINUED...","fc61b0a9":"# Load data"}}