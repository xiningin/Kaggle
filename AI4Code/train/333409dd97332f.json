{"cell_type":{"aca3dbde":"code","ec6925fd":"code","04a592e7":"code","932bf900":"code","b1088d86":"code","9c96f32b":"code","372e71f1":"code","303faa9d":"code","e9e55e8d":"code","957272cb":"code","ba48f28f":"code","3d1b039f":"code","d7d98228":"code","46f53ea4":"code","e8566ea1":"code","c47fcd8c":"code","d5a75e7f":"code","0809b5e8":"code","2d9ef7e4":"code","6a9a8c48":"markdown","8e19fcb2":"markdown","9c7a13a7":"markdown","3281535b":"markdown"},"source":{"aca3dbde":"import numpy as np\nimport pandas as pd\n\n\ntrain = pd.read_csv('..\/input\/titanic\/train.csv')\ntest = pd.read_csv('..\/input\/titanic\/test.csv')\ngender_submission = pd.read_csv('..\/input\/titanic\/gender_submission.csv')\n\ndata = pd.concat([train, test], sort=False)\n\ndata['Sex'].replace(['male', 'female'], [0, 1], inplace=True)\ndata['Embarked'].fillna(('S'), inplace=True)\ndata['Embarked'] = data['Embarked'].map({'S': 0, 'C': 1, 'Q': 2}).astype(int)\ndata['Fare'].fillna(np.mean(data['Fare']), inplace=True)\ndata['Age'].fillna(data['Age'].median(), inplace=True)\ndata['FamilySize'] = data['Parch'] + data['SibSp'] + 1\ndata['IsAlone'] = 0\ndata.loc[data['FamilySize'] == 1, 'IsAlone'] = 1","ec6925fd":"data.head()","04a592e7":"delete_columns = ['Name', 'PassengerId', 'Ticket', 'Cabin']\ndata.drop(delete_columns, axis=1, inplace=True)\n\ntrain = data[:len(train)]\ntest = data[len(train):]\n\ny_train = train['Survived']\nX_train = train.drop('Survived', axis=1)\nX_test = test.drop('Survived', axis=1)","932bf900":"X_train.head()","b1088d86":"from sklearn.model_selection import train_test_split\n\n\nX_train, X_valid, y_train, y_valid = \\\n    train_test_split(X_train, y_train, test_size=0.3,\n                                 random_state=0, stratify=y_train)","9c96f32b":"categorical_features = ['Embarked', 'Pclass', 'Sex']","372e71f1":"params = {\n    'objective': 'binary'\n}","303faa9d":"import lightgbm as lgb\n\n\nlgb_train = lgb.Dataset(X_train, y_train,\n                                         categorical_feature=categorical_features)\nlgb_eval = lgb.Dataset(X_valid, y_valid, reference=lgb_train,\n                                         categorical_feature=categorical_features)\n\nmodel = lgb.train(params, lgb_train,\n                               valid_sets=[lgb_train, lgb_eval],\n                               verbose_eval=10,\n                               num_boost_round=1000,\n                               early_stopping_rounds=10)\n\ny_pred = model.predict(X_test, num_iteration=model.best_iteration)","e9e55e8d":"y_pred[:10]","957272cb":"params = {\n    'objective': 'binary',\n    'max_bin': 300,\n    'learning_rate': 0.05,\n    'num_leaves': 40\n}","ba48f28f":"lgb_train = lgb.Dataset(X_train, y_train,\n                                         categorical_feature=categorical_features)\nlgb_eval = lgb.Dataset(X_valid, y_valid, reference=lgb_train,\n                                         categorical_feature=categorical_features)\n\nmodel = lgb.train(params, lgb_train,\n                               valid_sets=[lgb_train, lgb_eval],\n                               verbose_eval=10,\n                               num_boost_round=1000,\n                               early_stopping_rounds=10)\n\ny_pred = model.predict(X_test, num_iteration=model.best_iteration)","3d1b039f":"y_pred[:10]","d7d98228":"y_pred = (y_pred > 0.5).astype(int)\ny_pred[:10]","46f53ea4":"sub = pd.read_csv('..\/input\/titanic\/gender_submission.csv')\n\nsub['Survived'] = y_pred\nsub.to_csv('submission_lightgbm_handtuning.csv', index=False)\n\nsub.head()","e8566ea1":"import optuna\nfrom sklearn.metrics import log_loss\n\n\ndef objective(trial):\n    params = {\n        'objective': 'binary',\n        'max_bin': trial.suggest_int('max_bin', 255, 500),\n        'learning_rate': 0.05,\n        'num_leaves': trial.suggest_int('num_leaves', 32, 128),\n    }\n\n    lgb_train = lgb.Dataset(X_train, y_train,\n                                             categorical_feature=categorical_features)\n    lgb_eval = lgb.Dataset(X_valid, y_valid, reference=lgb_train,\n                                            categorical_feature=categorical_features)\n\n    model = lgb.train(params, lgb_train,\n                                   valid_sets=[lgb_train, lgb_eval],\n                                   verbose_eval=10,\n                                   num_boost_round=1000,\n                                   early_stopping_rounds=10)\n\n    y_pred_valid = model.predict(X_valid, num_iteration=model.best_iteration)\n    score = log_loss(y_valid, y_pred_valid)\n    return score","c47fcd8c":"study = optuna.create_study(sampler=optuna.samplers.RandomSampler(seed=0))\nstudy.optimize(objective, n_trials=40)","d5a75e7f":"study.best_params","0809b5e8":"params = {\n    'objective': 'binary',\n    'max_bin': study.best_params['max_bin'],\n    'learning_rate': 0.05,\n    'num_leaves': study.best_params['num_leaves']\n}\n\nlgb_train = lgb.Dataset(X_train, y_train,\n                                         categorical_feature=categorical_features)\nlgb_eval = lgb.Dataset(X_valid, y_valid, reference=lgb_train,\n                                         categorical_feature=categorical_features)\n\nmodel = lgb.train(params, lgb_train,\n                               valid_sets=[lgb_train, lgb_eval],\n                               verbose_eval=10,\n                               num_boost_round=1000,\n                               early_stopping_rounds=10)\n\ny_pred = model.predict(X_test, num_iteration=model.best_iteration)","2d9ef7e4":"y_pred = (y_pred > 0.5).astype(int)\n\nsub['Survived'] = y_pred\nsub.to_csv('submission_lightgbm_optuna.csv', index=False)\n\nsub.head()","6a9a8c48":"# \u624b\u52d5\u3067\u8abf\u6574","8e19fcb2":"## LightGBM","9c7a13a7":"# Optuna\u3092\u4f7f\u3046","3281535b":"This notebook is a sample code with Japanese comments.\n\n# 2.6 \u6a5f\u68b0\u5b66\u7fd2\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u304a\u6c17\u6301\u3061\uff1f\uff01\u3000\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8abf\u6574\u3057\u3066\u307f\u3088\u3046"}}