{"cell_type":{"c5b2d498":"code","4acb03e6":"code","d79dea3a":"code","34d91185":"code","4ad74303":"code","c0859f96":"code","2b52ab46":"code","a29dc23e":"code","a302fc51":"code","a6e481ec":"code","17e622d2":"code","dda3d9ef":"code","f6902ad5":"code","8338d870":"markdown","82f9ea96":"markdown","540a1c69":"markdown","b048d107":"markdown","be633e41":"markdown","1c68613f":"markdown","8defcc72":"markdown","aafcf4b5":"markdown"},"source":{"c5b2d498":"from fastai.vision import *","4acb03e6":"!ls \/kaggle\/input\/rps-cv-images\/","d79dea3a":"def random_seed(seed_value, use_cuda=True):\n    '''Set random seeds for databunch and model training\n        source: https:\/\/forums.fast.ai\/t\/lesson1-reproducible-results-setting-seed-not-working\/37921\/5)'''\n    np.random.seed(seed_value) # cpu vars\n    torch.manual_seed(seed_value) # cpu  vars\n    random.seed(seed_value) # Python\n    if use_cuda: \n        torch.cuda.manual_seed(seed_value)\n        torch.cuda.manual_seed_all(seed_value) # gpu vars\n        torch.backends.cudnn.deterministic = True  #needed\n        torch.backends.cudnn.benchmark = False","34d91185":"random_seed(42)\ndata = (ImageList.from_folder('\/kaggle\/input\/rps-cv-images\/') \n        .split_by_rand_pct()            \n        .label_from_folder()            \n        # TODO: there might be more transformations we can apply\n        .transform(get_transforms(),size=32)      \n        .databunch())","4ad74303":"data.show_batch()","c0859f96":"learn = cnn_learner(data, models.resnet50, metrics=[error_rate,accuracy],path='\/kaggle\/working',callback_fns=ShowGraph)","2b52ab46":"%%time \nlearn.fit_one_cycle(10)","a29dc23e":"learn.save('res50-pretrained')","a302fc51":"interp = ClassificationInterpretation.from_learner(learn)\ninterp.plot_confusion_matrix(title='Confusion matrix')\ninterp.plot_top_losses(4)","a6e481ec":"%%time\nlearn.load('res50-pretrained')\nlearn.lr_find()\nlearn.recorder.plot(suggestion=True)","17e622d2":"%%time\n# note: lr finder graph could vary based on randomness... need to find if its possible to use a seed value\nlearn.unfreeze()\nlearn.fit_one_cycle(10, max_lr=slice(1e-3,1e-2))","dda3d9ef":"learn.save('res50-finetuned')","f6902ad5":"interp = ClassificationInterpretation.from_learner(learn)\ninterp.plot_confusion_matrix(title='Confusion matrix')\ninterp.plot_top_losses(4)","8338d870":"Resources\n* https:\/\/www.kaggle.com\/drgfreeman\/rockpaperscissors\n* https:\/\/docs.fast.ai\/vision.html","82f9ea96":"Evaluate pretrained resnet50 performance","540a1c69":"Finetuned resnet performs much better","b048d107":"Pre trained resnet50 does fairly well. Let's try to make it better by training all layers","be633e41":"**Create a databunch**","1c68613f":"**Transfer Learning with resnet 50**","8defcc72":"**Finetuning resnet50**","aafcf4b5":"Evaluate finetuned resnet50 performance"}}