{"cell_type":{"74b3440e":"code","0b29811e":"code","3298fd8e":"code","61080a56":"code","6e6cdd7f":"code","a8700a15":"code","b335d085":"code","8b1f5047":"code","4e83d342":"code","cdaccf6d":"code","d4f23ca8":"code","870e52bf":"code","d0dfea3d":"code","805ec2fa":"code","dc4335d8":"code","4814c768":"code","912d949d":"code","cdcb1acd":"code","569b8421":"code","956707d3":"markdown","dcdb1375":"markdown","a3a418c4":"markdown","dba105b1":"markdown","c255b171":"markdown","bef87a7c":"markdown","cbc91c25":"markdown","df8be8fc":"markdown","55b93220":"markdown","1ea4a097":"markdown","26c12285":"markdown","b9e0f5f8":"markdown","7e28bb18":"markdown","f8bc65fc":"markdown","80ccc162":"markdown"},"source":{"74b3440e":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nplt.style.use('fivethirtyeight')\n\nfrom plotly import tools\nimport plotly.offline as py\npy.init_notebook_mode(connected=True)\nimport plotly.graph_objs as go","0b29811e":"df_population = pd.read_csv('..\/input\/population.csv')\ndf_births = pd.read_csv('..\/input\/births.csv')\ndf_deaths = pd.read_csv('..\/input\/deaths.csv')","3298fd8e":"df_population.head()","61080a56":"df_population.isnull().sum().sum()","6e6cdd7f":"population_per_year = df_population.groupby('Year')['Number'].sum().reset_index()\nax = sns.lineplot(x=\"Year\", y=\"Number\", data=population_per_year)\nax.set_xticks(population_per_year.Year)\nax.set_title('Population per year')\nax.set_ylabel('Population')\nfig=plt.gcf()\nfig.set_size_inches(18,6)","a8700a15":"df_population[(df_population.Year == 2014) & (df_population.Gender=='Male')].Number.sum()","b335d085":"df_population.groupby(['Year', 'Gender'])['Number'].sum().unstack().plot.bar(title='Population per year and gender')\nfig=plt.gcf()\nfig.set_size_inches(18,6)","8b1f5047":"year = 2017\npopulation_age_gender = df_population[df_population.Year == year].groupby(['Age', 'Gender'])['Number'].sum().unstack().reset_index()\npopulation_age_gender['order'] = [0, 2, 3, 4, 5, 6, 7, 8, 9, 1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]\npopulation_age_gender = population_age_gender.sort_values('order')\n\nwomen_bins = population_age_gender['Female'].values \nmen_bins = population_age_gender['Male'].values * (-1)\n\nages = population_age_gender['Age'].values\n\nlayout = go.Layout(yaxis=go.layout.YAxis(title='Age'),\n                   xaxis=go.layout.XAxis(\n                       range=[-80000, 80000],\n                       tickvals=np.arange(-80000, 80001, 10000),\n                       ticktext=np.arange(-80000, 80001, 10000),\n                       title='Number'),\n                   barmode='overlay',\n                   bargap=0.1)\n\ndata = [go.Bar(y=ages,\n               x=men_bins,\n               orientation='h',\n               name='Men',\n               text=-1 * men_bins.astype('int'),\n               hoverinfo='text',\n               marker=dict(color='powderblue')\n               ),\n        go.Bar(y=ages,\n               x=women_bins,\n               orientation='h',\n               name='Women',\n               text=women_bins.astype('int'),\n               hoverinfo='text',\n               marker=dict(color='seagreen')\n               )]\n\npy.iplot(dict(data=data, layout=layout), filename='population-pyramid') ","4e83d342":"f,ax = plt.subplots(1,2, figsize=(25,9))\n\ndistrict_populations = df_population.groupby('District.Name')['Number'].sum().reset_index().sort_values('Number',ascending=False)\nsns.barplot(x='Number', y='District.Name', data=district_populations, ax=ax[0])\nax[0].set_title('Population by District')\nax[0].set_xlabel('Population')\n\nneighborhood_populations = df_population.groupby('Neighborhood.Name')['Number'].sum().reset_index().sort_values('Number',ascending=False).iloc[0:10]\nsns.barplot(x='Number', y='Neighborhood.Name', data=neighborhood_populations, ax=ax[1])\nax[1].set_title('Population by Neighborhood (Top 10 most populated)')\nax[1].set_xlabel('Population')\n\nplt.subplots_adjust(hspace=0.3,wspace=0.6)\nax[0].tick_params(labelsize=15)\nax[1].tick_params(labelsize=15)\nplt.show()","cdaccf6d":"f,ax = plt.subplots(1,1, figsize=(20,7))\n\nneighborhood_populations = df_population.groupby('Neighborhood.Name')['Number'].sum().reset_index().sort_values('Number',ascending=True).iloc[0:10]\nsns.barplot(x='Number', y='Neighborhood.Name', data=neighborhood_populations, ax=ax)\nax.set_title('Population by Neighborhood (Top 10 less populated)')\nax.set_xlabel('Population')\nax.tick_params(labelsize=15)\nplt.show()","d4f23ca8":"# population_discrict_year = df_population.groupby(['District.Name', 'Year'])['Number'].sum().reset_index()\npopulation_discrict_year = df_population.groupby(['District.Name', 'Year'])['Number'].sum().reset_index()\ndistricts = district_populations.sort_values('Number', ascending=False)['District.Name'].values[0:10]\n\ndiff_population_district_2016 = []\ndiff_population_district_2013 = []\nfor district in districts:\n    df_district = population_discrict_year[population_discrict_year['District.Name'] == district].sort_values('Year', ascending=True)\n    diff_population_district_2016.append(df_district[df_district['Year'] == 2017]['Number'].values[0] - df_district[df_district['Year'] == 2016]['Number'].values[0])\n    diff_population_district_2013.append(df_district[df_district['Year'] == 2017]['Number'].values[0] - df_district[df_district['Year'] == 2013]['Number'].values[0])\n    \ndf_district_growth = pd.DataFrame()\ndf_district_growth['District'] = districts\ndf_district_growth['Population Growth from 2016'] = diff_population_district_2016\ndf_district_growth['Population Growth from 2013'] = diff_population_district_2013\ndf_district_growth = df_district_growth.sort_values('Population Growth from 2016', ascending=False)\n\n\nf,ax = plt.subplots(1,2, figsize=(25,9))\n\nsns.barplot(x='Population Growth from 2016', y='District', data=df_district_growth, ax=ax[0])\nax[0].set_title('Population Growth by District from 2016')\n#ax[0].set_xlabel('Population')\n\ndf_district_growth = df_district_growth.sort_values('Population Growth from 2013', ascending=False)\nsns.barplot(x='Population Growth from 2013', y='District', data=df_district_growth, ax=ax[1])\nax[1].set_title('Population Growth by District from 2013')\n#ax[0].set_xlabel('Population')\n\nplt.subplots_adjust(hspace=0.2,wspace=0.2)\nax[0].tick_params(labelsize=15)\nax[1].tick_params(labelsize=15)\nplt.show()","870e52bf":"def plot_population_grow(column='District.Name', topk=10, sort_ascending=False, wspace=0.2):\n    population_year = df_population.groupby([column, 'Year'])['Number'].sum().reset_index()\n    locations = population_year[column].unique()\n    \n    diff_population_2016 = []\n    diff_population_2013 = []\n    \n    for location in locations:\n        df_location = population_year[population_year[column] == location].sort_values('Year', ascending=True)\n        diff_population_2016.append(df_location[df_location['Year'] == 2017]['Number'].values[0] - df_location[df_location['Year'] == 2016]['Number'].values[0])\n        diff_population_2013.append(df_location[df_location['Year'] == 2017]['Number'].values[0] - df_location[df_location['Year'] == 2013]['Number'].values[0])   \n    \n    \n    df_growth = pd.DataFrame()\n    df_growth[column] = locations\n    df_growth['Population Growth since 2016'] = diff_population_2016\n    df_growth['Population Growth since 2013'] = diff_population_2013\n    df_growth = df_growth.sort_values('Population Growth since 2016', ascending=sort_ascending)\n\n    f,ax = plt.subplots(1,2, figsize=(25,9))\n\n    sns.barplot(x='Population Growth since 2016', y=column, data=df_growth.head(topk), ax=ax[0])\n    ax[0].set_title('Population Growth by ' + column + ' since 2016')\n    #ax[0].set_xlabel('Population')\n\n    df_growth = df_growth.sort_values('Population Growth since 2013', ascending=sort_ascending)\n    sns.barplot(x='Population Growth since 2013', y=column, data=df_growth.head(topk), ax=ax[1])\n    ax[1].set_title('Population Growth by ' + column + ' since 2013')\n    #ax[0].set_xlabel('Population')\n\n    plt.subplots_adjust(hspace=0.2,wspace=wspace)\n    ax[0].tick_params(labelsize=15)\n    ax[1].tick_params(labelsize=15)\n    plt.show()","d0dfea3d":"plot_population_grow(column='District.Name')","805ec2fa":"plot_population_grow(column='Neighborhood.Name', sort_ascending=False, wspace=0.6)","dc4335d8":"plot_population_grow(column='Neighborhood.Name', sort_ascending=True)","4814c768":"grouped_death = df_deaths.groupby('District.Name')['Number'].sum().to_frame().reset_index()\ngrouped_births = df_births.groupby('District Name')['Number'].sum().to_frame().reset_index()\ngrouped_death_births = grouped_death.merge(grouped_births, how='left', left_on='District.Name', right_on='District Name', suffixes=('_death', '_birth'))\ngrouped_death_births['natural_growth'] = grouped_death_births['Number_birth'] - grouped_death_births['Number_death']\n\nf,ax = plt.subplots(1,1, figsize=(15,5))\n\nsns.barplot(x='District.Name', y='natural_growth', data=grouped_death_births.sort_values('natural_growth'), ax=ax)\nax.set_title('Natural growth per discrict since 2013')\n\nplt.show()","912d949d":"grouped_death = df_deaths.groupby('Neighborhood.Name')['Number'].sum().to_frame().reset_index()\ngrouped_births = df_births.groupby('Neighborhood Name')['Number'].sum().to_frame().reset_index()\ngrouped_death_births = grouped_death.merge(grouped_births, how='left', left_on='Neighborhood.Name', right_on='Neighborhood Name', suffixes=('_death', '_birth'))\ngrouped_death_births['natural_growth'] = grouped_death_births['Number_birth'] - grouped_death_births['Number_death']\n\nf,ax = plt.subplots(1,2, figsize=(18,6))\n\nsns.barplot(x='natural_growth', y='Neighborhood.Name', data=grouped_death_births.sort_values('natural_growth', ascending=False).head(10), ax=ax[0])\nax[0].set_title('Natural growth per Neighborhood since 2013')\n\nsns.barplot(x='natural_growth', y='Neighborhood.Name', data=grouped_death_births.sort_values('natural_growth', ascending=True).head(10), ax=ax[1])\nax[1].set_title('Natural growth per Neighborhood since 2013')\n\nplt.subplots_adjust(hspace=0.1,wspace=0.3)\nax[0].tick_params(labelsize=10)\nax[1].tick_params(labelsize=10)\nplt.show()","cdcb1acd":"year = 2017\npopulation_age_gender = df_population[(df_population.Year == year) & (df_population['Neighborhood.Name'] == 'el Poble Sec')].groupby(['Age', 'Gender'])['Number'].sum().unstack().reset_index()\npopulation_age_gender['order'] = [0, 2, 3, 4, 5, 6, 7, 8, 9, 1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]\npopulation_age_gender = population_age_gender.sort_values('order')\n\nwomen_bins = population_age_gender['Female'].values \nmen_bins = population_age_gender['Male'].values * (-1)\n\nages = population_age_gender['Age'].values\n\nlayout = go.Layout(yaxis=go.layout.YAxis(title='Age'),\n                   xaxis=go.layout.XAxis(\n                       range=[-4000, 4000],\n                       tickvals=np.arange(-4000, 4001, 4000),\n                       ticktext=np.arange(-4000, 4001, 4000),\n                       title='Population in el Poble Sec'),\n                   barmode='overlay',\n                   bargap=0.1)\n\ndata = [go.Bar(y=ages,\n               x=men_bins,\n               orientation='h',\n               name='Men',\n               text=-1 * men_bins.astype('int'),\n               hoverinfo='text',\n               marker=dict(color='powderblue')\n               ),\n        go.Bar(y=ages,\n               x=women_bins,\n               orientation='h',\n               name='Women',\n               text=women_bins.astype('int'),\n               hoverinfo='text',\n               marker=dict(color='seagreen')\n               )]\n\npy.iplot(dict(data=data, layout=layout), filename='population-pyramid') ","569b8421":"year = 2017\npopulation_age_gender = df_population[(df_population.Year == year) & (df_population['Neighborhood.Name'] == 'el Raval')].groupby(['Age', 'Gender'])['Number'].sum().unstack().reset_index()\npopulation_age_gender['order'] = [0, 2, 3, 4, 5, 6, 7, 8, 9, 1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]\npopulation_age_gender = population_age_gender.sort_values('order')\n\nwomen_bins = population_age_gender['Female'].values \nmen_bins = population_age_gender['Male'].values * (-1)\n\nages = population_age_gender['Age'].values\n\nlayout = go.Layout(yaxis=go.layout.YAxis(title='Age'),\n                   xaxis=go.layout.XAxis(\n                       range=[-4000, 4000],\n                       tickvals=np.arange(-4000, 4001, 4000),\n                       ticktext=np.arange(-4000, 4001, 4000),\n                       title='Population in el Raval'),\n                   barmode='overlay',\n                   bargap=0.1)\n\ndata = [go.Bar(y=ages,\n               x=men_bins,\n               orientation='h',\n               name='Men',\n               text=-1 * men_bins.astype('int'),\n               hoverinfo='text',\n               marker=dict(color='powderblue')\n               ),\n        go.Bar(y=ages,\n               x=women_bins,\n               orientation='h',\n               name='Women',\n               text=women_bins.astype('int'),\n               hoverinfo='text',\n               marker=dict(color='seagreen')\n               )]\n\npy.iplot(dict(data=data, layout=layout), filename='population-pyramid') ","956707d3":"Total population","dcdb1375":"We see that Eixample had the highest growth from 2016 to 2017. However, the district with highest increase in population from 2013 is Sarria-Sant Gervasi. \nCiutat Vella and Sants-Montju\u00efc have lost population since 2013\n\nNow let's see the neighborhoods","a3a418c4":"It might be interesting also see the less populated neighborhoods","dba105b1":"Looking at the population pyramid we see that the difference of number population of males and females is coming from older ages. This is quite normal since life expectancy is usually higher for women.","c255b171":"There is no nulls in this dataframe","bef87a7c":"Now let's see the population by districts and neighborhoods","cbc91c25":"We see the population in el Raval in ages 25-45 is quite higher than in el Poble Sec, so that helps to more natality.\n","df8be8fc":"Overall, there is more female population. Let's see at the Age","55b93220":"We saw before that Sarria-Sant Gervasi and Sant Mart\u00ed were the neighborhoods with more growth since 2013. We see that Sant Mart\u00ed have clearly a high natural growth, so that can be one of the reasons that growth. Actually the natural growth in Sant Mart\u00ed is higher than the total population growth, so it must be some reason that is making the population decrease as well. For Sarria-Sant Gervasi, the natural growth seems to be one of the causes, but it doesn't explain the total growth of around 4000.\n\nOn the other hand, we see a positive natural growth in Ciutat Vella, so there must be some other reason that makes the population decrease.","1ea4a097":"Let's check the population gender","26c12285":"Now we can try to relate the births and deaths with the most\/less  growing neighborhoods","b9e0f5f8":"el Raval and el Poble Sec were the two neighborhood with the most negative population growth since 2013. While el Poble Sec has a negative natural growth, el Raval is the neighborhood with higher positive natural growth. \n\nLet's check the population pyramid of these two neighborhoods in 2017 (should be similar for previous years)","7e28bb18":"Let's see which districs have had higher growth last years","f8bc65fc":"We can see that el Raval is the Neighborhood that has lost more population since 2013","80ccc162":"**1. Population**"}}