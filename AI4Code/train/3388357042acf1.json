{"cell_type":{"3356e135":"code","4f6f8660":"code","29e1825c":"code","f9c8a437":"code","b7ea5702":"code","72fba478":"code","75031d08":"code","d199b93f":"code","a4c146b7":"code","e025d8b6":"code","a8fe1680":"code","3d864668":"code","1cc8eec9":"code","b6058c39":"code","218f4ddf":"code","97d625a0":"code","2de554e0":"code","969d8b58":"code","f4ffda64":"code","b41e61a6":"code","01bbd7b3":"code","82f1b297":"code","2f6c1991":"code","10f388a5":"code","36c18b77":"code","b578f4e6":"code","499c8fa0":"code","6c735413":"code","d1fb8c89":"code","4b77f316":"code","e8dec39a":"code","0bd3ea25":"code","1a05776b":"code","56fbc9a6":"code","a3d91689":"markdown","ec4d66f1":"markdown","b912745a":"markdown","127dd902":"markdown","2aee320f":"markdown","4fce11ca":"markdown","334754ad":"markdown","d86040af":"markdown","68dfb979":"markdown","41d22b48":"markdown","bde9689c":"markdown","ccbfd2fc":"markdown","502d9369":"markdown","4ae52abf":"markdown","7174ccde":"markdown","cb5e713d":"markdown","ffbf94a7":"markdown","35c85890":"markdown","36de9f91":"markdown","283c7c63":"markdown","09f7165e":"markdown","baa76ec6":"markdown"},"source":{"3356e135":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","4f6f8660":"# load data\ndf = pd.read_excel(\"\/kaggle\/input\/covid-in-europe-time-peaksgenderage-group-study\/11bb715b-9833-4eda-97e1-8ffa5a7810a5.xlsx\")\ndf.head()","29e1825c":"#check size of the datatset\ndf.shape","f9c8a437":"#clean data: drop rows, containing unknown or empty age group and gender\ndf_clean= df.drop(df[(df['Age group'] == \"-\") | (df['Gender'] == \"-\") | (df['Gender'] == \"Unknown\")].index)\ndf_clean.shape","b7ea5702":"#in order to make dataframe better plotable, I set up datetime format\ndf_clean[\"week\"] = df_clean[\"Reporting week\"].str.extract('.*(\\d{2})', expand = False) \ndf_clean.head()","72fba478":"df_clean[\"year\"] = [2020]*47068\ndf_clean.head()","75031d08":"#create date column in datetime format \ndf_clean['date'] = pd.to_datetime(df_clean.week.astype(str)+\n                           df_clean.year.astype(str).add('-2') ,format='%W%Y-%w')\ndf_clean.date.head()","d199b93f":"# drop unnessessary columns ['Reporting week',\"Onset week\", \"Source\", \"week\", \"year\"]\n# drop columns \"Cases\" and \"Deaths\", as they contain only one \"0\" value\ndf_clean.drop(['Reporting week',\"Onset week\", \"Source\", \"week\", \"year\", \"Cases\" , \"Deaths\"], axis=1, inplace=True) \n\ndf_clean.head()","a4c146b7":"# genaral descriptive statistics\ndf_clean.describe(include='all')","e025d8b6":"df_clean[\"Reporting country\"].value_counts().head(10)","a8fe1680":"df_clean[\"Age group\"].value_counts()","3d864668":"df_clean[\"Gender\"].value_counts()","1cc8eec9":"# available data about hospitalisation\ndf_clean[\"Hospitalisation\"].value_counts()","b6058c39":"df_clean[\"Intensive care\"].value_counts()","218f4ddf":"df_clean[\"Outcome\"].value_counts()","97d625a0":"df_clean[\"Country of infection\"].value_counts().head(10)\n# would be interesting to map the migrations for covid infection","2de554e0":"# I would like to check development of all possible outcomes for patientes with confirmed Covid-19 in time\n# for this I first make a grouping \ntime_outcome_count= df_clean.groupby(['date',\"Outcome\"]).size().reset_index(name='count')\ntime_outcome_count.head()","969d8b58":"#plot possible Outcomes for patientes with confirmed covid-19 in Europe: development over time\n\nimport matplotlib.pyplot as plt\n\ntime_outcome_count.pivot_table(index=\"date\", columns=\"Outcome\", values=\"count\", fill_value=0).plot\\\n                                                                    (figsize=(13, 6)).\\\n                                                                                        legend(loc=2, \n                                                                                     fontsize=  'large',\n                                                                                     edgecolor=\"None\", \n                                                                                     borderpad=1.5,\n                                                                                    title=\"Outcomes\",\n                                                                                     title_fontsize=14)\n\nplt.rc('axes', edgecolor='gray')  # axis color\nplt.ylabel('Number of cases', fontsize=12).set_color('gray')\nplt.xlabel(\"Reporting date\", fontsize=12).set_color('gray')\nplt.tick_params(axis='x', labelsize=9, colors='gray', which='both')\nplt.tick_params(axis='y', labelsize=9, colors='gray', which='both')\n\nplt.annotate('The data provided by \\n European Centre for Disease Prevention and Control', \n             xy=(0.98, 0.9), xycoords='axes fraction', size=10,\n             ha='right', #horisontal alignment\n             va='baseline').set_color('gray')# add text about origin of data\nplt.title('Weekly development of outcomes for patientes with confirmed Covid-19 in Europe', fontsize=16)","f4ffda64":"# in order to look at number of confirmed covid-19 patients and their outcomes in European countries\n# first step  is grouping:\ndf_clean.groupby([\"Reporting country\",\"Outcome\"]).size().reset_index(name='count').head()","b41e61a6":"# pivot this grouping table for plotting\ncountry_outcomes_pivot = df_clean.groupby([\"Reporting country\",\"Outcome\"]).size().reset_index(name='count').\\\n        pivot_table(index=\"Reporting country\", columns='Outcome', values=\"count\", fill_value=0)\ncountry_outcomes_pivot.head()","01bbd7b3":"# sort pivot table adscending by sum of all columns (total nb of registred cases) and \n# plot with horisontal stacked bars\ncountry_outcomes_pivot.\\\nassign(tmp=country_outcomes_pivot.sum(axis=1)).sort_values('tmp', ascending=True).drop('tmp', 1).\\\nplot.barh(stacked=True, figsize=(12, 7), width=0.8).\\\nlegend(fontsize='small',#loc=1,\n       edgecolor=\"None\", borderpad=1.2)\nplt.rcParams[\"legend.labelspacing\"] = 0.02 # vertical space between legend entries\nplt.xlabel('Number of cases', fontsize=10)\nplt.annotate('The data provided by European Centre for Disease Prevention and Control', \n             xy=(0.03, 0.02), xycoords='axes fraction', size=10).set_color('gray')# add text about origin of data\nplt.title('Outcomes for patientes with confirmed Covid-19', fontsize=16)","82f1b297":"# reshape df: count cumularive cases number per reporting week\ncountry_date_outcome = df_clean.groupby([\"Reporting country\",\"date\",\"Outcome\"]).size().reset_index(name='Count').pivot_table(index=[\"Reporting country\",\"date\"], columns=\"Outcome\", values=\"Count\", fill_value=0).reset_index()\n\ncountry_date_outcome = country_date_outcome.assign(Total_cases=country_date_outcome.sum(axis=1))\ncountry_date_outcome.head()","2f6c1991":"#subset selected countries and columns\ncountry_date_outcome[(country_date_outcome[\"Reporting country\"]==\n                      \"Austria\")|(country_date_outcome[\"Reporting country\"]== \n                    \"Germany\")#|(country_date_outcome[\"Reporting country\"]== \"Italy\")\n                    |(country_date_outcome[\"Reporting country\"]== \n                    \"Czechia\")|(country_date_outcome[\"Reporting country\"]== \n                    \"Poland\")|(country_date_outcome[\"Reporting country\"]== \n                    \"Portugal\")|(country_date_outcome[\"Reporting country\"]== \n                    \"Finland\")#|(country_date_outcome[\"Reporting country\"]==  \"Netherlands\")\n                   |(country_date_outcome[\"Reporting country\"]== \n                    \"Norway\")|(country_date_outcome[\"Reporting country\"]== \"Sweden\")][['Reporting country', \n                                'date','Fatal',\n                                'Total_cases']].head()","10f388a5":"# melt 2 columns (Fatal and Total_cases) in one (Outcome) with value equal to Fatal or Total_cases value\ntable_to_plot=country_date_outcome[(country_date_outcome[\"Reporting country\"]==\n                      \"Austria\")|(country_date_outcome[\"Reporting country\"]== \n                    \"Germany\")#|(country_date_outcome[\"Reporting country\"]== \"Italy\")\n                    |(country_date_outcome[\"Reporting country\"]== \n                    \"Czechia\")|(country_date_outcome[\"Reporting country\"]== \n                    \"Poland\")|(country_date_outcome[\"Reporting country\"]== \n                    \"Portugal\")|(country_date_outcome[\"Reporting country\"]== \n                    \"Finland\")#|(country_date_outcome[\"Reporting country\"]==  \"Netherlands\")\n                   |(country_date_outcome[\"Reporting country\"]== \n                    \"Norway\")|(country_date_outcome[\"Reporting country\"]== \"Sweden\")][['Reporting country', \n                                'date','Fatal',\n                                'Total_cases']].melt(id_vars=['Reporting country', 'date']).rename(columns={\"value\": \"Confirmed cases\"})\ntable_to_plot.head()","36c18b77":"#plot facets with seaborn\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n#sns.set(style=\"ticks\") #to get rig gray background\n#sns.set_context(\"paper\", rc={\"axes.labelsize\":16}) \nsns.set(rc={\"font.size\":20,\"axes.titlesize\":18,\"axes.labelsize\":14},style=\"ticks\")\n\ng = sns.relplot(x=\"date\", y=\"Confirmed cases\",\n                 col=\"Reporting country\", \n                hue=\"Outcome\",#style=\"Outcome\",\n                 kind=\"line\", \n                legend=False, \n                data=table_to_plot, col_wrap=4,\n                height=4, aspect=1)#.set(title = \"Total amount of confirmed covid-19 cases to death cases in the selected European countries\")\n\ng.set_ylabels(\"Number of cases\")\ng.set_xlabels(\"Date\")\n\n#g.legend(fontsize='x-large', title_fontsize='20')\ng.fig.subplots_adjust(top=0.9)\ng.fig.suptitle('Total amount of confirmed Covid-19 cases and deaths in the selected European countries')\n\nplt.legend((\"Deaths\", \"Total cases\"),loc='upper right',fontsize='medium',\n           edgecolor=\"None\", borderpad=1 )\n","b578f4e6":"# in order to plot age distribution in two subplots: total cases and fatal (death) cases, I create 2 pivot tables: \n\n#First, for selected countries:\ncountry_age_total_pivot=df_clean[(df_clean[\"Reporting country\"]==\n                      \"Austria\")|(df_clean[\"Reporting country\"]== \n                    \"Germany\")|(df_clean[\"Reporting country\"]== \n                    \"Czechia\")|(df_clean[\"Reporting country\"]== \n                    \"Poland\")|(df_clean[\"Reporting country\"]== \n                    \"Portugal\")|(df_clean[\"Reporting country\"]== \n                    \"Finland\")|(df_clean[\"Reporting country\"]== \n                    \"Norway\")|(df_clean[\"Reporting country\"]== \"Sweden\")].\\\n    groupby([\"Reporting country\",\"Age group\"]).size().reset_index(name='count').\\\n    pivot_table(index=\"Reporting country\", columns=\"Age group\", values=\"count\",\n               fill_value=0)\ncountry_age_total_pivot.head()","499c8fa0":"#Second, for selected countries and dead patiensts:\ncountry_age_death_pivot = df_clean[(df_clean.Outcome == \"Fatal\")& ((df_clean[\"Reporting country\"]==\n                      \"Austria\")|(df_clean[\"Reporting country\"]== \n                    \"Germany\")|(df_clean[\"Reporting country\"]== \n                    \"Czechia\")|(df_clean[\"Reporting country\"]== \n                    \"Poland\")|(df_clean[\"Reporting country\"]== \n                    \"Portugal\")|(df_clean[\"Reporting country\"]== \n                    \"Finland\")|(df_clean[\"Reporting country\"]== \n                    \"Norway\")|(df_clean[\"Reporting country\"]== \"Sweden\"))].\\\ngroupby([\"Reporting country\",\"Age group\"]).size().reset_index(name='count').\\\npivot_table(index=\"Reporting country\", columns=\"Age group\", values=\"count\",\n               fill_value=0)\ncountry_age_death_pivot.head()","6c735413":"#its occur, that one age group is missing in death dataframe. I set it to \"0\"\ncountry_age_death_pivot['05-14']=0\ncountry_age_death_pivot = country_age_death_pivot[['00-04','05-14' ,'15-24', '25-49', '50-64', '65-79', '80+']]\ncountry_age_death_pivot.head()","d1fb8c89":"#plot two pivots as subplots\nimport matplotlib.pyplot as plt\n\nfig, axes = plt.subplots(nrows=1, ncols=2)#, sharey=True)\nfig.set_size_inches(15, 4)\nplt.subplots_adjust(top=0.8)\nfig.suptitle('Age groups for patients with confirmed Covid-19 in Europe', fontsize=20)\nplt.annotate('The data provided by European Centre for Disease Prevention and Control', \n             xy=(0.1, 0.02), xycoords='axes fraction',  fontsize=10).set_color('gray')\n \ncountry_age_total_pivot.assign(tmp=country_age_total_pivot.sum(axis=1)).sort_values('tmp', ascending=True).drop('tmp', 1).\\\nplot(kind=\"barh\", stacked=True, ax=axes[0], legend=False).\\\nlegend(fontsize=12,\n      title=\"Age group\", edgecolor=\"None\")\naxes[0].set_title(\"Total cases\", fontsize=14)\naxes[0].set_xlabel('Number of cases', fontsize=12)#.set_color('gray')\naxes[0].set_ylabel( \"Reporting country\", fontsize=12)#.set_color('gray')\n\ncountry_age_death_pivot.assign(tmp=country_age_death_pivot.sum(axis=1)).sort_values('tmp', ascending=True).drop('tmp', 1).\\\nplot(kind=\"barh\", stacked=True, ax=axes[1]).\\\nlegend(fontsize=12,#loc=3, \n    title=\"Age group\",edgecolor=\"None\", borderpad=1)\nplt.rcParams[\"legend.facecolor\"] = \"None\"\nplt.rcParams[\"legend.framealpha\"] = 0.1\naxes[1].set_title(\"Fatal cases\", fontsize=14)\naxes[1].set_xlabel('Number of cases', fontsize=12)\naxes[1].set_ylabel('')\naxes[1].tick_params(axis='y', labelleft=False, left=True)\n\nplt.subplots_adjust(wspace=0.05)","4b77f316":"# in order to plot age distribution in two subplots: total cases and fatal (death) cases, I create 2 pivot tables: \n\n#First, for all confirmed covid-19 cases:\nds_total = df_clean[[\"Age group\",\"Gender\"]].groupby([\"Age group\",\"Gender\"]).size().reset_index(name='count').pivot_table(index=\"Age group\", columns=\"Gender\", values=\"count\",\n               fill_value=0)\nds_total.loc['Total',:] = ds_total.sum(axis=0)\nds_total","e8dec39a":"#Second, for all fatal covid-19 cases:\nds_death=df_clean[df_clean.Outcome == \"Fatal\"][[\"Age group\",\"Gender\"]].groupby([\"Age group\",\"Gender\"]).size().reset_index(name='count').pivot_table(index=\"Age group\", columns=\"Gender\", values=\"count\",\n               fill_value=0)#.plot(kind=\"barh\", stacked=False)\nds_death.loc['Total',:] = ds_death.sum(axis=0)\nds_death","0bd3ea25":"#plot two pivots as subplots\nfig, axes = plt.subplots(nrows=1, ncols=2)#, sharey=True)\nfig.set_size_inches(12, 4)\nplt.subplots_adjust(top=0.8)\nfig.suptitle('Age vs gender groups for patients with confirmed Covid-19 in Europe', fontsize=18)\nplt.annotate('The data provided by European Centre for Disease Prevention and Control', \n             xy=(-0.9, 0.02), xycoords='axes fraction',  fontsize=8).set_color('gray')\n\nds_total.plot(kind=\"barh\", stacked=False, color=['tab:red', \"tab:blue\"], ax=axes[0]).legend(loc='lower right')#, \n                                                                                            #title=\"Gender\")\naxes[0].set_title(\"Total cases\", fontsize=14)\naxes[0].set_xlabel('Number of cases', fontsize=12)#.set_color('gray')\naxes[0].set_ylabel('Age group', fontsize=12)\n\nds_death.plot(kind=\"barh\", stacked=False, color=['tab:red', \"tab:blue\"], ax=axes[1]).legend(loc='lower right')#, title=\"Gender\")\n#plt.rcParams[\"legend.framealpha\"] = 0.1\naxes[1].set_title(\"Fatal cases\", fontsize=14)\naxes[1].set_xlabel('Number of cases', fontsize=12)#.set_color('gray')\naxes[1].set_ylabel('')#.set_color('gray')\naxes[1].tick_params(axis='y', labelleft=False, left=True)\nplt.subplots_adjust(wspace=0.05)","1a05776b":"# create table to plot\nicu= df_clean[(df_clean[\"Intensive care\"] != \"Unknown\")][[\"Intensive care\", \n                                                     \"Outcome\" ]].\\\ngroupby([\"Intensive care\",\"Outcome\"]).size().reset_index(name='count').\\\npivot_table(index=\"Intensive care\", columns=\"Outcome\", values=\"count\",fill_value=0)\nicu","56fbc9a6":"ax= icu.plot(figsize=(11,4), width=0.5,\n            kind=\"barh\", stacked=True)\nax.legend(fontsize='x-small',\n          edgecolor=\"None\", \n          borderpad=1.8)\n# find the values in plot-patches, calculate respecive value in % and insert as text \nfor i,j in enumerate (ax.patches):\n    if j.get_width()>500:\n        if i % 2: #even\n            ax.text( j.get_x()+200,j.get_y()+0.2, str(round(j.get_width()*100\/icu.sum(axis=1)[1], 0))+'%', fontsize=9) \n        else: #odd\n            ax.text( j.get_x()+200,j.get_y()+0.2, str(round(j.get_width()*100\/icu.sum(axis=1)[0], 0))+'%', fontsize=9)\n                \nplt.xlabel('Number of cases', fontsize=12)\nplt.ylabel('', fontsize=14)\nplt.annotate('The data provided by European Centre for Disease Prevention and Control', \n             xy=(0.36, 0.05), xycoords='axes fraction',  fontsize=10).set_color('gray')# add text about origin of data\nplt.title(\"Outcomes by the ICU (Intensive care unit) treatment vs hospitalisation without ICU\", fontsize=16)\n","a3d91689":"# Question 1. Define peak of the pandemy in Europe over time","ec4d66f1":"# Questtion 2. Total number of of confirmed covid-19 patients and their outcomes in Europe","b912745a":"Most of the confirmed cases belong to \"25-49\" and \"50-64\" age groups.","127dd902":"Data includes info on 47068 confirmed covid cases, from 26 EU countries, from  22 weeks period, \ndescribe 7 age groups and gender info. For part of the data it is known about hospitalisation and if intensive care were applyed. Also sourse of infection (from which country patient was infected).","2aee320f":"# Conclusions:\n\n**1. Timing peak of the pandemy**\nIn general, the peak of the covid-19 pandemie in European countries reffer to beginning of April. There are regional differences: e.g. shifted peak to end of April - beginning of May in Italy and Poland, and \"flatted\" peak extended from April to June in Sweden. Moreover for Sweden and Finland the smallest amount of cases are registered.\n \n**2. Infection risc for different age groups**\nThere are small differences between size of groups for  patients older than 15 y.o. The most of confirmed covid-19 cases are in age diapason 25-79 y.o. for presented european countries. Fatal cases show bigger risc for patients of over 65 years old. There are no registered deaths of young patients younger 25 years.\nTotal frequency of confirmed covid-19 cases are more often between patients, who older than 25 y.o.\n\n**3. Infection rate between age group and gender**\nIn general, the available dataset doesn not show big differences in frequency of infection or death for males and females of varying age groups.  However male patients are dominated (ca 1000 cases!) in total number of registered covid-19 cases. This trend is more prominent for fatal cases: male patients with fatal outcome are dominated in all age groups, except of 80+ (possibly because there are in general less males, than females in that age group). \n\n**4. How intensive care unit influence to survival rate**\nThere are death cases in both, ICU and no ICU groups. For known cases, where ICU was applyed, it was effective in over 41% of cases, while 31% of patients were dead. Without ICU patients were died in 9% of cases. Pehaps, those part of patients, who died without ICU, were diagnosted or\/and hospitalzsed too late, or ICU was not possible for some reasons.","4fce11ca":"There are small differences between size of groups for 15+ years old patients with confirmed covid-19 in presented European countries. There are more cases in age diapason 25-79 y.o. for most of the countries. Fatal cases show bigger risc for patients of over 65 years old. There are no registered deaths of patients of young patients younger 24 years.","334754ad":"# Question 6. Does intensive care unit influence to survival rate?","d86040af":"I find extremely valuable, that Outcome cases contains not only \"Fatal\", but also \"Died from other causes\".","68dfb979":"\nThe most of the confirmed cases are reported from Germany... It is actually different from media news, which we used to know","41d22b48":"# Question 4. Age groups distribution for patients with total confirmed covid-19 cases and death cases in selected European countries","bde9689c":"The peak of the covid-19 pandemie in European countries reffer to beginning of April.","ccbfd2fc":"While overall peak of the pandemie in European countries correspond to beginning of April, there is a shift to end of April - beginning of May in Italy and Poland, and \"flatted\" peak extended from April to June in Sweden. Also for Sweden and Finland the smallest amount of cases are registered.","502d9369":"It seems like the best documented data are coming from Germany. Therefore, later I would like to study this part of the dataset with more details. Especially strange looks data from Italy, Netherlands, Denmark, UK, France, Belgium... In athe next steps I would exclude those countries, and look partition \"all confirmed covid cases\" to \"death cases\" in the rest of the countries.","4ae52abf":"# dala load and cleaning","7174ccde":"# Visualisation","cb5e713d":"There are 27085 unknown cases, but also exact indication, that  3348 patienten were treated by ICU \n(Intensive care unit) and 16635 patienten were treated without. Later, i will look to % of deaths in those both groups","ffbf94a7":"# first descriptive study","35c85890":"For known cases, where ICU was applyed, part of alive and death patients are comparable (ca 41% vs ca 31%). Obviously, ICU applyed for hard patients, however it is effective only in ca 31% of cases. Patients are died in 9% of cases without ICU. Pehaps they were fond not hard enought for ICU, or were hospitalzsed too late, or ICU was not possible for some reasons.","36de9f91":"# Question 5. Is there differentiation between age group and gender: all cases vs deaths","283c7c63":"Left figure show, that frequency of confirmed covid-19 cases are more frequent between patients, who older than 25 y.o. Gender seems to play not important role for chance to get infections: its only minor differences between gender groups within all possible age groups. However male patients are dominated (ca 1000 cases!) in total number of registered covid-19 cases. This trend is more prominent for fatal cases, shown in right figure. Male patients with fatal outcome are dominated in all age groups, except of 80+ (possibly because there are in general less males, than females in that age group). In the presented dataset was no registered fatal cases for patients younger 25 years.","09f7165e":"in general there are more confirmed cases for males","baa76ec6":"# Question 3. Is pandemy peak is varying over the Europe? Plot \"all confirmed covid cases\" and \"death cases\" in the selected European countries."}}