{"cell_type":{"a17a979e":"code","05c396b7":"code","1c004f16":"code","b8608de3":"code","14d7018d":"code","476bae78":"code","830f6278":"code","4e3ae9de":"code","84d2ac2b":"code","6a6ed480":"code","f19e3936":"code","6869c6fc":"code","7b295b7a":"code","8dfde294":"code","4b7e2099":"code","42b9c792":"code","a48788e4":"code","b298b984":"code","58eb065f":"code","13242a43":"code","590e072f":"code","e468c237":"code","5923b0f7":"code","a7a2f185":"code","27462465":"code","8748e062":"code","7640aed5":"code","260f21af":"code","592f5820":"code","0efceaed":"markdown","2fc090d0":"markdown","ab3e731b":"markdown","f50cc97d":"markdown","4281d979":"markdown","ed4742d5":"markdown","58c12b74":"markdown","74f06967":"markdown","fc790bb3":"markdown","2572115e":"markdown","d828e501":"markdown","4d86a22b":"markdown","4c5ccbf4":"markdown","36481dd1":"markdown","d53c06cd":"markdown","0e73a959":"markdown","375cd11e":"markdown","60269365":"markdown","2ec028d3":"markdown","ee19d33c":"markdown","7de6818e":"markdown","6d402c87":"markdown","520785d3":"markdown","8690c28a":"markdown","206c506f":"markdown","81745c56":"markdown","a7fedac6":"markdown","a356b439":"markdown"},"source":{"a17a979e":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","05c396b7":"train_set = pd.read_csv(\"..\/input\/titanic\/train.csv\")\ntest_set = pd.read_csv(\"..\/input\/titanic\/test.csv\")","1c004f16":"test_set_duplicate = test_set.copy() #for future use","b8608de3":"train_set.isnull().sum() ","14d7018d":"test_set.isnull().sum()","476bae78":"test_set.loc[test_set.Fare.isnull()]","830f6278":"test_set.groupby(\"Pclass\").Fare.describe()","4e3ae9de":"missing_fare = np.where(test_set.Fare.isnull())\n\nfor row in missing_fare:\n    test_set.iloc[row] = test_set.iloc[row].fillna(12.459678)","84d2ac2b":"train_set.Sex = train_set.Sex.replace({\n    'female' : 1,\n    'male' : 0,\n})\n\ntest_set.Sex = test_set.Sex.replace({\n    'female' : 1,\n    'male' : 0,\n})","6a6ed480":"train_set.groupby(\"Sex\").describe()","f19e3936":"from sklearn.model_selection import train_test_split\n\nX_train, X_test, = train_test_split(train_set, train_size = 0.8, test_size = 0.2, random_state = 25)","6869c6fc":"y_train = X_train[\"Survived\"]\ny_test = X_test[\"Survived\"]\n\nX_train = X_train.drop([\"Survived\"], axis = 1)\nX_test = X_test.drop([\"Survived\"], axis = 1)","7b295b7a":"X_train.describe(include = \"all\")","8dfde294":"X_test = X_test.drop([\"Embarked\", \"Cabin\"], axis = 1)\nX_train = X_train.drop([\"Embarked\", \"Cabin\"], axis = 1)\n\ntest_set = test_set.drop([\"Embarked\", \"Cabin\"], axis = 1)","4b7e2099":"miss_mean_age_test = X_test.loc[X_test.Name.str.contains(\"Miss.\")].Age.mean(skipna = True)\nmr_mean_age_test = X_test.loc[X_test.Name.str.contains(\"Mr. \")].Age.mean(skipna = True)\nmrs_mean_age_test = X_test.loc[X_test.Name.str.contains(\"Mrs. \")].Age.mean(skipna = True)\nmaster_mean_age_test = X_test.loc[X_test.Name.str.contains(\"Master.\")].Age.mean(skipna = True)\n\nprint('X_test')\nprint('Mr: ', mr_mean_age_test)\nprint('Mrs: ', mrs_mean_age_test)\nprint('Master: ', master_mean_age_test)\nprint('Miss: ', miss_mean_age_test)\n\nmiss_mean_age_train = X_train.loc[X_train.Name.str.contains(\"Miss.\")].Age.mean(skipna = True)\nmr_mean_age_train = X_train.loc[X_train.Name.str.contains(\"Mr. \")].Age.mean(skipna = True)\nmrs_mean_age_train = X_train.loc[X_train.Name.str.contains(\"Mrs. \")].Age.mean(skipna = True)\nmaster_mean_age_train = X_train.loc[X_train.Name.str.contains(\"Master.\")].Age.mean(skipna = True)\n\nprint('X_train')\nprint('Mr: ', mr_mean_age_train)\nprint('Mrs: ', mrs_mean_age_train)\nprint('Master: ', master_mean_age_train)\nprint('Miss: ', miss_mean_age_train)\n\nmiss_mean_age_test_set = test_set.loc[test_set.Name.str.contains(\"Miss.\")].Age.mean(skipna = True)\nmr_mean_age_test_set = test_set.loc[test_set.Name.str.contains(\"Mr. \")].Age.mean(skipna = True)\nmrs_mean_age_test_set = test_set.loc[test_set.Name.str.contains(\"Mrs. \")].Age.mean(skipna = True)\nmaster_mean_age_test_set = test_set.loc[test_set.Name.str.contains(\"Master.\")].Age.mean(skipna = True)\n\nprint('test_set')\nprint('Mr: ', mr_mean_age_test_set)\nprint('Mrs: ', mrs_mean_age_test_set)\nprint('Master: ', master_mean_age_test_set)\nprint('Miss: ', miss_mean_age_test_set)","42b9c792":"X_train.loc[((X_train.Name.str.contains(\"Mr. \") |\n           X_train.Name.str.contains(\"Mrs. \") |\n           X_train.Name.str.contains(\"Master.\") |\n           X_train.Name.str.contains(\"Miss.\")) == False) & X_train.Age.isnull()]","a48788e4":"doc_row = np.where(((X_train.Name.str.contains(\"Mr. \") |\n           X_train.Name.str.contains(\"Mrs. \") |\n           X_train.Name.str.contains(\"Master.\") |\n           X_train.Name.str.contains(\"Miss.\")) == False) & X_train.Age.isnull())\n\nfor row in doc_row:\n    X_train.iloc[row] = X_train.iloc[row].fillna(mr_mean_age_train)","b298b984":"test_set.loc[((test_set.Name.str.contains(\"Mr. \") |\n           test_set.Name.str.contains(\"Mrs. \") |\n           test_set.Name.str.contains(\"Master.\") |\n           test_set.Name.str.contains(\"Miss.\")) == False) & test_set.Age.isnull()]","58eb065f":"ms_row = np.where(((test_set.Name.str.contains(\"Mr. \") |\n           test_set.Name.str.contains(\"Mrs. \") |\n           test_set.Name.str.contains(\"Master.\") |\n           test_set.Name.str.contains(\"Miss.\")) == False) & test_set.Age.isnull())\n\nfor row in ms_row:\n    test_set.iloc[row] = test_set.iloc[row].fillna(mrs_mean_age_test_set)","13242a43":"mr_cols_test = np.where(X_test.Age.isnull() & X_test.Name.str.contains(\"Mr.\"))\nmrs_cols_test = np.where(X_test.Age.isnull() & X_test.Name.str.contains(\"Mrs. \"))\nmaster_cols_test = np.where(X_test.Age.isnull() & X_test.Name.str.contains(\"Master.\"))\nmiss_cols_test = np.where(X_test.Age.isnull() & X_test.Name.str.contains(\"Miss.\"))\n\nfor row in mr_cols_test:\n    X_test.iloc[row] = X_test.iloc[row].fillna(mr_mean_age_test)\n    \nfor row in mrs_cols_test:\n    X_test.iloc[row] = X_test.iloc[row].fillna(mrs_mean_age_test)\n    \nfor row in master_cols_test:\n    X_test.iloc[row] = X_test.iloc[row].fillna(master_mean_age_test)\n    \nfor row in miss_cols_test:\n    X_test.iloc[row] = X_test.iloc[row].fillna(miss_mean_age_test)\n    \n\nmr_cols_train = np.where(X_train.Age.isnull() & X_train.Name.str.contains(\"Mr.\"))\nmrs_cols_train = np.where(X_train.Age.isnull() & X_train.Name.str.contains(\"Mrs. \"))\nmaster_cols_train = np.where(X_train.Age.isnull() & X_train.Name.str.contains(\"Master.\"))\nmiss_cols_train = np.where(X_train.Age.isnull() & X_train.Name.str.contains(\"Miss.\"))\n\nfor row in mr_cols_train:\n    X_train.iloc[row] = X_train.iloc[row].fillna(mr_mean_age_train)\n    \nfor row in mrs_cols_train:\n    X_train.iloc[row] = X_train.iloc[row].fillna(mrs_mean_age_train)\n    \nfor row in master_cols_train:\n    X_train.iloc[row] = X_train.iloc[row].fillna(master_mean_age_train)\n    \nfor row in miss_cols_train:\n    X_train.iloc[row] = X_train.iloc[row].fillna(miss_mean_age_train)\n    \nmr_cols_test_set = np.where(test_set.Age.isnull() & test_set.Name.str.contains(\"Mr.\"))\nmrs_cols_test_set = np.where(test_set.Age.isnull() & test_set.Name.str.contains(\"Mrs. \"))\nmaster_cols_test_set = np.where(test_set.Age.isnull() & test_set.Name.str.contains(\"Master.\"))\nmiss_cols_test_set = np.where(test_set.Age.isnull() & test_set.Name.str.contains(\"Miss.\"))\n\nfor row in mr_cols_test_set:\n    test_set.iloc[row] = test_set.iloc[row].fillna(mr_mean_age_test_set)\n    \nfor row in mrs_cols_test_set:\n    test_set.iloc[row] = test_set.iloc[row].fillna(mrs_mean_age_test_set)\n    \nfor row in master_cols_test_set:\n    test_set.iloc[row] = test_set.iloc[row].fillna(master_mean_age_test_set)\n    \nfor row in miss_cols_test_set:\n    test_set.iloc[row] = test_set.iloc[row].fillna(miss_mean_age_test_set)","590e072f":"def isChild(row):\n    \n    if row[\"Age\"] < 18:\n        return 1\n    else:\n        return 0","e468c237":"X_train['isChild'] = X_train.apply(lambda row: isChild(row), axis = 1)\n\nX_test['isChild'] = X_test.apply(lambda row: isChild(row), axis = 1)\n\ntest_set['isChild'] = test_set.apply(lambda row: isChild(row), axis = 1)","5923b0f7":"X_train['Family'] = X_train['SibSp'] + X_train['Parch']\nX_test['Family'] = X_test['SibSp'] + X_test['Parch']\ntest_set['Family'] = test_set['SibSp'] + test_set['Parch']","a7a2f185":"X_train = X_train.drop([\n    \"PassengerId\",\n    \"Name\",\n    \"Ticket\",\n], axis = 1)\n\nX_test = X_test.drop([\n    \"PassengerId\",\n    \"Name\",\n    \"Ticket\",\n], axis = 1)\n\ntest_set = test_set.drop([\n    \"PassengerId\",\n    \"Name\",\n    \"Ticket\",\n], axis = 1)","27462465":"X_train.head()","8748e062":"from sklearn.preprocessing import StandardScaler\n\nscaling = StandardScaler()\nscaling_list = ['Age', 'Family', 'Fare', 'SibSp', 'Parch']\n\nX_train[scaling_list] = scaling.fit_transform(X_train[scaling_list])\nX_test[scaling_list] = scaling.fit_transform(X_test[scaling_list])\ntest_set[scaling_list] = scaling.fit_transform(test_set[scaling_list])","7640aed5":"from catboost import CatBoostClassifier\n\n\nmodel = CatBoostClassifier(iterations = 1000, \n                           learning_rate = 0.02,\n                           loss_function = \"CrossEntropy\")\n\nmodel.fit(X_train, y_train, \n         eval_set = (X_test, y_test),\n         early_stopping_rounds = 10,\n         use_best_model = True,\n         verbose = False,)\n\npreds = model.predict(test_set)","260f21af":"from sklearn.metrics import accuracy_score\n\npreds_test = model.predict(X_test)\nprint(accuracy_score(preds_test, y_test) * 100)","592f5820":"submission = pd.DataFrame({\n    \"PassengerId\" : test_set_duplicate[\"PassengerId\"],\n    \"Survived\" : preds,\n})\n\nsubmission.to_csv(\"submission.csv\", index = False)","0efceaed":"After filling in all the missing values, we now create a new feature, `isChild`. If a passenger's `Age` < 18, `isChild = 1`","2fc090d0":"From this, we can see that there are patterns in age depending on the name, however we encounter a problem","ab3e731b":"# Model","f50cc97d":"Note that this also fills in `12.459678` in the  `Cabin` column, however this does not matter as `Cabin` is dropped later","4281d979":"We can now get on to scaling","ed4742d5":"Getting an insight into the data,","58c12b74":"We will first look at the missing fare in `test_set`","74f06967":"We can see that there is a doctor that has not been accounted for, As this doctor is obviously and adult male, we will use `mr_mean_age_train`","fc790bb3":"# Preprocessing","2572115e":"I chose to drop `PassengerId`, `Name` and `Ticket` as I felt that they were not relevant to the model","d828e501":"Now, we can fill in the rest of the gaps","4d86a22b":"From this, we can see that females had a much higher chance of survival","4c5ccbf4":"We can check the accuracy on the training set using `accuracy_score` in scikit-learn","36481dd1":"# Final Score\n\nThis particular submission got a score of 0.77751","d53c06cd":"# Introduction\n\nThis is a solution to the Titanic Dataset Competition using concepts from pandas and machine learning.","0e73a959":"For the model, I will use `CatBoostClassifier`","375cd11e":"Let's take a look at how many missing values there are in the dataset","60269365":"We will also combine the `SibSp` and `Parch` features to create a new feature, `Family`","2ec028d3":"We will store this file in `submission.csv`","ee19d33c":"We will first replace the values in the `Sex` column using 1 for female and 0 for male for convenience","7de6818e":"Before preprocessing, we should split the training set in order to avoid data leakage","6d402c87":"We see that he was in 3rd class, so we look at the mean fare for 3rd class","520785d3":"We see that the mean was `12.459678`, which is what we will use to fill in this gap","8690c28a":"We can see that there is a Ms that has also not been accounted for, we will use `mrs_mean_age_test_set` to fill in this gap","206c506f":"# Submission","81745c56":"# Reading in the Data","a7fedac6":"We know we have a lot of missing ages, so we can fill in these values by looking at their names and in their names, specifically their title.\n\nFor example, those with 'Master.' will be younger than those with 'Mr.' or 'Mrs.' as 'Master.'  is generally used as a title for children","a356b439":"Now that we have no missing values, we will choose the features we want"}}