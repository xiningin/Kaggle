{"cell_type":{"814b53c9":"code","a1d84f61":"code","52ef1b40":"code","2618be98":"code","7e655f98":"code","8eee97d6":"code","c49177ff":"code","5020f39e":"code","41e9d6bd":"code","623a65c2":"code","7186f037":"code","1e72d58b":"code","7999c94d":"code","d12054e9":"code","424dc3dd":"code","08b444ae":"code","852badbf":"code","56a70f4e":"code","65a08dec":"code","10170672":"code","c42732c5":"code","1b89d4f3":"code","3b301a2d":"code","4dd110ee":"code","a7e98cd1":"code","ad82f871":"code","9051ca34":"code","673c0080":"code","6f1430e6":"code","6f58193d":"code","01bc7c19":"code","6efd335f":"markdown"},"source":{"814b53c9":"import numpy as np\nimport pandas as pd\nimport re\nimport string\nimport nltk\nfrom nltk.corpus import stopwords\nfrom fuzzywuzzy import process, fuzz","a1d84f61":"dataset=pd.read_csv('..\/input\/gufhtugu-publications-dataset-challenge\/GP Orders - 5.csv')\ncitiesdb=pd.read_csv('..\/input\/pakistan-cities-and-postal-codes\/Pakistan Cities and Zip Codes.csv')","52ef1b40":"dataset.head()","2618be98":"dataset.City.value_counts()","7e655f98":"dataset.City=dataset.City.astype('str')","8eee97d6":"# lowering the text\ndataset.City=dataset.City.apply(lambda x:x.lower() )\n\ndataset.City.head()","c49177ff":"dataset.City=dataset.City.str.split(':',expand=True)\ndataset.City=dataset.City.str.split(',',expand=True)\ndataset.City=dataset.City.str.split('\/',expand=True)","5020f39e":"dataset.City.value_counts()","41e9d6bd":"dataset.City","623a65c2":"token=nltk.tokenize.RegexpTokenizer(r'\\w+')\n#applying token\ndataset.City=dataset.City.apply(lambda x:token.tokenize(x))\n\n#view\ndisplay(dataset.City.head())","7186f037":"#removing stop words\ndataset.City=dataset.City.apply(lambda x:[w for w in x if w not in stopwords.words('english')])\n\n#view\ndataset.City.head()","1e72d58b":"dataset.City=dataset.City.apply(lambda x:\" \".join(x))\n#View\ndataset.City.head()","7999c94d":"dataset.City.value_counts()","d12054e9":"unique_city = dataset['City'].unique().tolist()\nunique_city[4:10] ","424dc3dd":"process.extract('islamabad', unique_city, scorer=fuzz.token_sort_ratio)","08b444ae":"process.extract('rajanpur', unique_city, scorer=fuzz.token_sort_ratio)","852badbf":"score_sort = [(x,) + i\n             for x in citiesdb.Area_Name \n             for i in process.extract(x, unique_city,     scorer=fuzz.token_sort_ratio)]","56a70f4e":"similarity_sort = pd.DataFrame(score_sort, columns=['City_sort','match_sort','score_sort'])\nsimilarity_sort.head()","65a08dec":"similarity_sort['sorted_City_sort'] = np.minimum(similarity_sort['City_sort'], similarity_sort['match_sort'])\nsimilarity_sort.head()","10170672":"high_score_sort = similarity_sort[(similarity_sort['score_sort'] >= 95) &\n                (similarity_sort['City_sort'] !=  similarity_sort['match_sort']) &\n                (similarity_sort['sorted_City_sort'] != similarity_sort['match_sort'])]\nhigh_score_sort = high_score_sort.drop('sorted_City_sort',axis=1).copy()","c42732c5":"high_score_sort","1b89d4f3":"high_score_sort.groupby(['City_sort','score_sort']).agg(\n                        {'match_sort': ', '.join}).sort_values(\n                        ['score_sort'], ascending=False)","3b301a2d":"for x in range(len(high_score_sort.City_sort)):\n    dataset.City= dataset.City.replace([high_score_sort.match_sort.iloc[x]],[high_score_sort.City_sort.iloc[x]])","4dd110ee":"dataset.City=dataset.City.str.title()","a7e98cd1":"dataset.City.value_counts()","ad82f871":"dataset.head()","9051ca34":"original=pd.read_csv('..\/input\/gufhtugu-publications-dataset-challenge\/GP Orders - 5.csv')","673c0080":"original['Diff']=(original['City'].str.len())-(dataset['City']).str.len()","6f1430e6":"original.loc[original['Diff'] != 0, 'Changed?'] = True \noriginal.loc[original['Diff'] == 0, 'Changed?'] = False","6f58193d":"print(original['Changed?'].sum(),\"Changes were made\")","01bc7c19":"dataset.to_csv('clean_city.csv')","6efd335f":"# I have improved \ud83e\udd17 the data but there is alot more work to be done to get only names. In this Notebook I have use fuzzywuzzy and nltk for extracting and then improving overall cities name. If you like my work do Upvote \ud83d\udc46"}}