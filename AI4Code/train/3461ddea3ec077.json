{"cell_type":{"ecac35de":"code","41526530":"code","59ca8818":"code","c5fe47fa":"code","9c2a92a3":"code","283f549a":"code","810fb7ed":"code","b525ff69":"code","aa8c4139":"code","73c23824":"code","9a475b9d":"code","eb5ffe7e":"code","80b07f0f":"code","ab0fbf0b":"code","8990a708":"code","d9fa9297":"code","aa782d86":"code","21115cbe":"code","dde6456f":"code","ccb1e595":"code","ca422d22":"code","1c50506c":"code","c5b44304":"code","bc3ce9c9":"code","1bc0e7c4":"code","5fb0b6ff":"code","aaae7301":"code","4e95c5fa":"code","ed7b3ea5":"code","94737a9b":"code","1b8618d3":"code","7a28ac89":"code","021eee0c":"code","0aeb0166":"code","c28f3e80":"code","06729124":"code","e178c1ec":"code","2fef8555":"code","cacd739c":"code","5018c568":"markdown","b7b69c7c":"markdown","beeefa14":"markdown","b8b8d8b2":"markdown","7150d321":"markdown","d58909d6":"markdown","8f65e54a":"markdown","b793609c":"markdown","a18358d7":"markdown","bb5c6ac9":"markdown","3b9f9a00":"markdown","ed3d8112":"markdown","eb841935":"markdown","c3cf68fc":"markdown","bcbe2938":"markdown","bee2e639":"markdown","97aa2aab":"markdown","6e2d206f":"markdown","94883209":"markdown","5689ed23":"markdown","4942f112":"markdown","3d96b39c":"markdown","96331fbd":"markdown","42af97d2":"markdown","0ef8ecb2":"markdown","89431c89":"markdown","4154b2a7":"markdown","0c860c43":"markdown","dca7ecb0":"markdown","885877ae":"markdown","f2e5fdfa":"markdown"},"source":{"ecac35de":"import numpy as np\nimport pandas as pd\nimport cv2\nimport os\nimport shutil\nimport matplotlib.pyplot as plt\n\ninput_dir = \"\/kaggle\/input\/siim-isic-melanoma-classification\"\ntrain_dir = os.path.join(input_dir, \"jpeg\/train\")\ntest_dir = os.path.join(input_dir, \"jpeg\/test\")\n\n\ntrain_csv = pd.read_csv(os.path.join(input_dir,\"train.csv\"))\ntest_csv = pd.read_csv(os.path.join(input_dir,\"test.csv\"))","41526530":"train_csv.head()","59ca8818":"train_csv[\"preffix_id\"] = train_csv[\"patient_id\"].apply(lambda x: x.split(\"_\")[0])\ntrain_csv[\"suffix_id\"] = train_csv[\"patient_id\"].apply(lambda x: x.split(\"_\")[-1])\n\ntest_csv[\"preffix_id\"] = test_csv[\"patient_id\"].apply(lambda x: x.split(\"_\")[0])\ntest_csv[\"suffix_id\"] = test_csv[\"patient_id\"].apply(lambda x: x.split(\"_\")[-1])","c5fe47fa":"train_csv[\"preffix_id\"].value_counts()","9c2a92a3":"test_csv[\"preffix_id\"].value_counts()","283f549a":"print(\"\\tTRAIN SUFFIX ID VALUE COUNTS\\n---\\n\")\nprint(train_csv[\"suffix_id\"].value_counts())\nprint(\"-----------------------------------\")\nprint(\"\\tTEST SUFFIX ID VALUE COUNTS\\n---\\n\")\nprint(test_csv[\"suffix_id\"].value_counts())","810fb7ed":"train_csv[\"suffix_id\"].apply(lambda x: len(x)).value_counts()","b525ff69":"list(set(train_csv[\"suffix_id\"].unique()) & set(test_csv[\"suffix_id\"].unique()))","aa8c4139":"plt.figure(figsize=(25,10))\nplt.ylabel(\"Age count (in # of entry)\")\nplt.xlabel(\"Age\")\n\nax_tr = train_csv[\"age_approx\"].plot(kind='hist')\nax_te = test_csv[\"age_approx\"].plot(kind='hist')\n\nax_tr.set_label(\"Train set\")\nax_te.set_label(\"Test set\")\n\nL=plt.legend()\nL.get_texts()[0].set_text('Train set')\nL.get_texts()[1].set_text('Test set')\n\nplt.plot()","73c23824":"plt.close()","9a475b9d":"print(\"\\tTRAIN AGE DESCRIPTION\\n---\\n\")\nprint(train_csv[\"age_approx\"].describe())\nprint('-----------------------------')\nprint(\"\\tTEST AGE DESCRIPTION\\n---\\n\")\nprint(test_csv[\"age_approx\"].describe())","eb5ffe7e":"print(\"Train age unique values: \",np.sort(train_csv[\"age_approx\"].unique()))\nprint(\"Test age unique values: \",np.sort(test_csv[\"age_approx\"].unique()))","80b07f0f":"print(f\"{train_csv['age_approx'].isnull().sum()} rows have a 'nan' age out of {len(train_csv)} total rows\").","ab0fbf0b":"train_csv[train_csv['age_approx'].isnull()]","8990a708":"train_csv[train_csv[\"age_approx\"].isnull()][\"suffix_id\"].value_counts()","d9fa9297":"train_csv[train_csv[\"age_approx\"].isnull() & train_csv[\"sex\"].isnull()][\"suffix_id\"].value_counts()","aa782d86":"nan_age = ['5205991', '9835712', '0550106']\ntrain_csv[train_csv[\"suffix_id\"].apply(lambda x: x in nan_age)]","21115cbe":"train_csv_cp = train_csv.copy()\ntrain_csv_cp[\"sex\"] = train_csv_cp[\"sex\"].fillna(\"null\")\ntest_csv_cp = test_csv.copy()\ntest_csv_cp[\"sex\"] = test_csv_cp[\"sex\"].fillna(\"null\")","dde6456f":"print(\"\\tTRAIN SEX VALUE COUNTS\\n---\\n\")\nprint(train_csv_cp[\"sex\"].value_counts())\nprint(\"-----------------------------------\")\nprint(\"\\tTEST SEX VALUE COUNTS\\n---\\n\")\nprint(test_csv_cp[\"sex\"].value_counts())","ccb1e595":"train_csv[train_csv[\"sex\"].isnull()][\"suffix_id\"].value_counts()","ca422d22":"print(\"\\tTRAIN ANATOM SITE VALUE COUNTS:\\n---\\n\")\nprint(train_csv[\"anatom_site_general_challenge\"].fillna(\"null\").value_counts())\nprint('--------------------------------------')\nprint(\"\\tTEST ANATOM SITE VALUE COUNTS:\\n---\\n\")\nprint(test_csv[\"anatom_site_general_challenge\"].fillna(\"null\").value_counts())","1c50506c":"plt.figure(figsize=(25,10))\nplt.ylabel(\"Anatomy site count (in frequency)\")\nplt.xlabel(\"Anatomy site\")\n\nax_tr = train_csv[\"anatom_site_general_challenge\"].fillna(\"null\").value_counts(normalize=True).plot()\nax_te = test_csv[\"anatom_site_general_challenge\"].fillna(\"null\").value_counts(normalize=True).plot()\n\nax_tr.set_label(\"Train set\")\nax_te.set_label(\"Test set\")\n\nL=plt.legend()\nL.get_texts()[0].set_text('Train set')\nL.get_texts()[1].set_text('Test set')\n\nplt.plot()","c5b44304":"print(\"\\tTRAIN NULL VALUE COUNTS:\\n---\\n\")\nprint(train_csv[train_csv[\"anatom_site_general_challenge\"].isnull()][\"suffix_id\"].value_counts())\nprint(\"-----------------------\")\nprint(\"\\tTEST NULL VALUE COUNTS:\\n---\\n\")\nprint(test_csv[test_csv[\"anatom_site_general_challenge\"].isnull()][\"suffix_id\"].value_counts())","bc3ce9c9":"print(train_csv[train_csv[\"anatom_site_general_challenge\"].isnull()][\"benign_malignant\"].value_counts())","1bc0e7c4":"print(\"\\tBENIGN DIAGNOSIS VALUE COUNT:\\n---\\n\")\nprint(train_csv[train_csv[\"benign_malignant\"] == \"benign\"][\"diagnosis\"].value_counts())\nprint('------------------------')\nprint(\"\\tMALIGNANT DIAGNOSIS VALUE COUNT:\\n---\\n\")\nprint(train_csv[train_csv[\"benign_malignant\"] != \"benign\"][\"diagnosis\"].value_counts())","5fb0b6ff":"train_csv[\"benign_malignant\"].value_counts()","aaae7301":"new_train_csv = train_csv.copy()\nto_drop = [\"image_name\", \"diagnosis\", \"benign_malignant\", \"preffix_id\", \"patient_id\"]","4e95c5fa":"new_train_csv[\"is_female\"] = new_train_csv[\"sex\"].apply(lambda x: 0 if type(x) != float and x.lower() == 'male' else 1 if type(x) != float else -1)\nto_drop.append(\"sex\")\nnew_train_csv.head()","ed7b3ea5":"anatom_classes = {\n    val: i for i, val in enumerate(new_train_csv[\"anatom_site_general_challenge\"].unique())\n}\nprint(\"String to class: \"+str(anatom_classes))\nnew_train_csv[\"anatom_classes\"] = new_train_csv[\"anatom_site_general_challenge\"].apply(lambda x: anatom_classes[x])\nto_drop.append(\"anatom_site_general_challenge\")\nnew_train_csv.head()","94737a9b":"new_train_csv[\"reduced_age\"] = new_train_csv[\"age_approx\"].apply(lambda x: int(x\/5) if np.isnan(x) == False else -1)\nto_drop.append(\"age_approx\")\nnew_train_csv.head()","1b8618d3":"suffix_classes = {\n\n    val: i for i,val in enumerate(new_train_csv[\"suffix_id\"].unique())\n\n}\n\nnew_train_csv[\"suffix_classes\"] = new_train_csv[\"suffix_id\"].apply(lambda x: suffix_classes[x])\nto_drop.append(\"suffix_id\")\nto_drop.append(\"suffix_classes\")\nnew_train_csv.head()\n","7a28ac89":"y = new_train_csv.drop(to_drop, axis=1).iloc[:, 0].to_numpy()\nX = new_train_csv.drop(to_drop, axis=1).iloc[:, 1:].to_numpy()","021eee0c":"from sklearn.model_selection import train_test_split\nfrom sklearn.metrics import confusion_matrix, roc_auc_score\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=42)","0aeb0166":"from sklearn.cluster import KMeans\nN_CLUSTERS = 200","c28f3e80":"clf = KMeans(N_CLUSTERS)","06729124":"kmeans = clf.fit(X_train)","e178c1ec":"class_per_cluster = {}\npreds = kmeans.predict(X_train)\n\nfor i in range(N_CLUSTERS):\n    classes = y_train[np.where(preds == i)]\n    c, counts = np.unique(classes, return_counts=True)\n    s = sum(counts)\n    \n    counts = counts\/s\n        \n    class_per_cluster[i] = counts","2fef8555":"y_preds = kmeans.predict(X_test)","cacd739c":"y_preds_classes = []\nfor pred in y_preds:\n    probs = class_per_cluster[pred]\n    \n    c = np.random.choice(list(range(len(probs))), p=probs)\n    \n    y_preds_classes.append(c)\n    \nprint(roc_auc_score(y_preds_classes, y_test))","5018c568":"#### **1.2.c Patient sex**\n---\nType: Categorical\n\nDescription: Identifies the sex of the patient","b7b69c7c":"The training set seems to suffer from nan ages. How many are there ?","beeefa14":"Both train and test sets have missing values. Distributions look similar, let's plot frequency of each value for both sets.","b8b8d8b2":"We see here that there only exists a single preffix in the *id* field being *IP*.","7150d321":"#### 1.2.e Diagnosis\n---\nType: Categorical\n\nDescription: Provide details about the diagnosis. Is only found in the train dataset.\n","d58909d6":"The individuals with missing sex are the same than for missing age.","8f65e54a":"#### 1.2.d anatom_site_general_challenge\n---\nType: Categorical\n\nDescription: Defines the location of the picture on the patient's body.","b793609c":"| Column                        | Type        | Description                                                                                    |\n|-------------------------------|-------------|------------------------------------------------------------------------------------------------|\n| image_name                    | String      | Identifies the name of the image file corresponding to the given row. Should not be redundant. |\n| patient_id                    | String      | Identifier of the patient from whom the skin picture has been taken. Could be redundant.       |\n| sex                           | Categorical | Identifies the sex of the patient.                                                             |\n| age_approx                    | Integer     | Age rounded to the nearest multiple of 5.                                                      |\n| anatom_site_general_challenge | Categorical | Defines the location of the picture on the patient's body.                                     |\n| diagnosis                     | Categorical | Provide details about the diagnosis. Is only found in the train dataset.                       |\n| benign_malignant              | Categorical | Target classes to be predicted (benign=0, malignant=1)                                         |","a18358d7":"# SIIM Playground EDA\n\nIn this notebook, I will focus on exploring through EDA the tabular data joined with the images and compare properties between the training and testing set to see if they have similarities.\n\n## 1. Introduction: Overview of the data\n\n### 1.1 Imports","bb5c6ac9":"#### 2.d Patient id\n---","3b9f9a00":"### 2. Using ML algorithms to find correlations between variables.\n\nWe will now try to develop a predictive algorithm that will only use the table data to predict benign\/malignant in order to figure out eventual correlations. The diagnosis column will be removed from this procedure and new features will be created.","ed3d8112":"While having very similar distribution, the only noticeable difference we can find between these two descriptions are:\n\n- mean value being slightly higher for the test set (but it is almost not noticeable);\n- the value is **not skewed** as the mean and the median are almost equal for both sets;\n- the training set has very young patients, while the test sets only have patients older than 10.","eb841935":"#### 1.2.b Patient age \n---\nType: Integer\n\nDescription: Age rounded to the nearest multiple of 5.","c3cf68fc":"### 1.2 Features analysis\n\nIn this part, I will work on the previously described features and try to gain insights on data properties.\n\n#### 1.2.a Patient Id\n---\nThe '*patient_id*' column is a patient identifier. Using it, we could know if a same single patient has been taken care of multiple times and try to see how redundant this feature is within the dataset.\n\nWe will first split it to see if the nomenclature always stays the same (i.e '*IP_XXXX*' where '*XXXX*' consists of 7 numbers). ","bcbe2938":"Dataframes are of the **same size** => patient without age are never labelled as having an age.","bee2e639":"We noticed Nan values before, how often are they found ? Also, what is the distribution of men\/women in both sets ? Is there any missing sex in test set ?","97aa2aab":"These two patients neither have gender nor age. Are all entries of these patients without an age ?","6e2d206f":"Which individuals have missing sex ?","94883209":"3 patients have null age. Let's check their sex column now.","5689ed23":"It seems like none are shared between the two sets.","4942f112":"#### 2.e Cleaning\/splitting data and creating classifier","3d96b39c":"We seem to notice that the sex column is also empty (nan here).","96331fbd":"Which patients have 'nan' age ?","42af97d2":"Distributions are indeed very similar.\nAre the null values coming from the same patients (as for age or sex ?). Here it would seem unlikely except if multiple spots have been photographed for the same patients at the same body parts.","0ef8ecb2":"#### 2.a Sex\n---","89431c89":"Ids are redundant: same patients seem to be present multiple times. Are the ids always the same size (7 characters) ?","4154b2a7":"Are some patient both in the test **and** in the train set ?","0c860c43":"This seems to indicate that benign diagnosis are left unknown, while at least being sure that what is observed is **NOT** a melanoma.\n\n#### 1.2.f Benign\/Malignant\n---\nType: Categorical\n\nDescription: Target variable, describes if the spot is benign or not.","dca7ecb0":"#### 2.b Anatom Site General Challenge\n---","885877ae":"#### 2.c Age Approx\n---","f2e5fdfa":"- Train missing values come from 220 different patients, with 102 rows coming from a same single patient \u20183057277\u2019.\n- Test missing values come from 61 different patients, with 240 rows coming from a same single patient \u20183579794\u2019."}}