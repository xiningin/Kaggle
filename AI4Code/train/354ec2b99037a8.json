{"cell_type":{"4b6f8ca1":"code","8414b06e":"code","a22ddbef":"code","a40a7f3c":"code","ba8c4483":"code","8a10d1e1":"code","c85ea4f9":"code","89c4026a":"code","c962dff4":"code","08602666":"code","e2e3bc62":"code","9ad48ea7":"code","ca8ef011":"code","60e65700":"code","597cac3c":"code","dbbfdc05":"code","ca0f2f59":"code","4f6c20c6":"code","52df49be":"code","d5cc51fd":"code","d0c69d88":"markdown","344fc4b9":"markdown","368b6326":"markdown","f5e01db0":"markdown","d81acae2":"markdown","387db956":"markdown","9cf595d5":"markdown","0b868d75":"markdown","0d390fb9":"markdown","161ec270":"markdown","49957ef4":"markdown","a9df7ee2":"markdown","dddc24a3":"markdown"},"source":{"4b6f8ca1":"# Imports\n\nimport numpy as np\nimport pandas as pd\n\nimport matplotlib.pyplot as plt\nfrom matplotlib import gridspec","8414b06e":"# Reading in the files\ntrain = pd.read_csv('..\/input\/tabular-playground-series-jan-2022\/train.csv', parse_dates=['date'])\n\n# Dropping the 'row_id' column\ntrain.drop(['row_id'], inplace=True, axis=1)\n\n# Removing Kaggle from store and product\ntrain['product'] = train['product'].apply(lambda row: row.split(' ')[1])\ntrain['store'] = train['store'].str[6:]\n\n# Viewing the first few observations\ntrain.head()","a22ddbef":"train.info()\nprint('-'*50)\n\ntrain.describe()","a40a7f3c":"# Describing the categorical variables\n\n## Function that creates a description on categorical features\ndef describe_categorical(X):     \n    from IPython.display import display, HTML     \n    display(HTML(X[X.columns[X.dtypes==\"object\"]].describe().to_html()))\n    \n## Describing the categorical features\ndescribe_categorical(train)","ba8c4483":"# Helper Functions for Plotting\n\nfontsize = {\n    'title':18,\n    'label':16,\n    'tick':14,\n}\n\nmonths = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec']\n\ncolors = ['salmon', 'steelblue', '#029386', '#AF8FE9']\n\n## Plotting data by month\ndef plot_time_series(df, cat, g='month', ax=None, xax=True, lw=5):\n    if not ax:\n        fig = plt.figure(figsize=(20,6))\n        ax = fig.add_subplot(1,1,1)\n    for label, color in zip(df[cat].unique(), colors):\n        y = df.loc[df[cat]==label,]\n        ax.plot(y[g], y['num_sold'], c=color, label=label, linewidth=lw)\n    plt.legend(title=f\"{cat.capitalize()}\")\n    plt.xlabel(f'{g.capitalize()}', fontsize=fontsize['label'])\n    plt.xticks(fontsize=fontsize['tick'])\n    if xax:\n        plt.xticks(df[g].unique())\n    if g == 'month':\n        ax.set_xticklabels(months)\n    plt.yticks(fontsize=fontsize['tick'])\n    plt.ylabel('Items Sold', fontsize=fontsize['label'])\n    plt.title(f'{g.capitalize()}ly Sales by {cat.capitalize()}', fontsize=fontsize['title'])\n    ax.spines['top'].set_visible(False)\n    ax.spines['right'].set_visible(False);\n\ndef addtext(x,y):\n    for idx, val in enumerate(x):\n        plt.text(val,round(y[idx])-40,round(y[idx]), ha = 'center', fontdict={'color':'white','weight': 'bold'})\n    \n## Plotting bar graph\ndef plot_bar(df, cat, legend=False, ax=None):\n    if not ax:\n        fig = plt.figure()\n        ax = fig.add_subplot(1,1,1)\n    df = df.reset_index().sort_values(by='num_sold', ascending=False)\n    ax.bar(df[cat], df['num_sold'], color='steelblue')\n    for idx, val in enumerate(df[cat].unique()):\n        plt.text(val,round(df['num_sold'][idx])-40,round(df['num_sold'][idx]), ha = 'center', fontdict={'color':'white','weight': 'bold', 'size':14})\n    plt.xticks(fontsize=fontsize['tick'])\n    plt.xlabel(cat.capitalize(), fontsize=fontsize['label'])\n    plt.yticks(fontsize=fontsize['tick'])\n    plt.ylabel('Items Sold', fontsize=fontsize['label'])\n    plt.title(f'Average Items Sold by {cat.capitalize()}', fontsize=fontsize['title'])\n    if legend:\n        plt.legend(title=f\"{cat.capitalize()}\")\n    ax.spines['top'].set_visible(False)\n    ax.spines['right'].set_visible(False)\n    ax.spines['bottom'].set_visible(False)\n    ax.spines['left'].set_visible(False)\n    plt.gca().get_yaxis().set_visible(False);\n    \n## function to add annotations\ndef addlabels(x,y):\n    for idx, val in enumerate(x):\n        plt.text(val, round(y[idx])-40, round(y[idx]), ha = 'center', fontdict={'color':'white','weight': 'bold', 'size':12})\n        \n## Plotting pie chart        \ndef plot_pie(df, ax=None, title=None):\n    if not ax:\n        fig, ax = plt.subplots()\n    patches, texts, pcts = ax.pie(\n        df['num_sold'],\n        labels=df.index,\n        colors=colors,\n        autopct='%.1f%%',\n        wedgeprops={'linewidth': 3.0, 'edgecolor': 'white'},\n        textprops={'size': 'large'},\n        startangle=90\n    )\n    for i, patch in enumerate(patches):\n        texts[i].set_color(colors[i])\n    plt.setp(pcts, color='white', fontweight=500, fontsize=fontsize['tick'])\n    plt.setp(texts, fontweight=600, fontsize=fontsize['label'])\n    plt.tight_layout()\n    if title:\n        ax.set_title(title, fontsize=fontsize['title'])        ","8a10d1e1":"# Viewing the range of time\n\nprint(f\"Range of time series: {train['date'].min()} -> {train['date'].max()}\")","c85ea4f9":"# Extracting year and month\n\ntrain['year'] = train['date'].dt.year\ntrain['month'] = train['date'].dt.month\ntrain['week'] = train['date'].dt.isocalendar().week\ntrain['day'] = train['date'].dt.day","89c4026a":"# Grouping by month and year\n\ntime = train.groupby(['year', 'month']).agg({'num_sold':'mean'}).reset_index()","c962dff4":"fig = plt.figure(figsize=(20,6))\nax = fig.add_subplot(1,1,1)\nplot_time_series(train, 'year', 'date', ax, xax=False, lw=.4)","08602666":"# Plotting Monthly items sold\n\nplot_time_series(time, 'year')","e2e3bc62":"# Grouping data to get mean of 'country', 'product', 'store'\n\ncountry = train.groupby(['country']).agg({'num_sold':'mean'}).sort_values(by='num_sold', ascending=False)\nproduct = train.groupby(['product']).agg({'num_sold':'mean'}).sort_values(by='num_sold', ascending=False)\nstore = train.groupby(['store']).agg({'num_sold':'mean'}).sort_values(by='num_sold', ascending=False)\nyear = train.groupby(['year']).agg({'num_sold':'mean'}).sort_values(by='num_sold', ascending=False)","9ad48ea7":"# Plotting pie charts\n\nfig, axs = plt.subplots(1, 4, figsize=(20, 8))\nfig.tight_layout()\nplot_pie(df=country, ax=axs[0], title='Country Sales')\nplot_pie(df=product, ax=axs[1], title='Product Sales')\nplot_pie(df=store, ax=axs[2], title='Store Sales')\nplot_pie(df=year, ax=axs[3], title='Yearly Sales')","ca8ef011":"# Group by 'country' AND 'month' and 'country' \n\ncountry_group = train.groupby('country').agg({'num_sold':'mean'}).reset_index().sort_values(by='num_sold', ascending=False)\ncountry_time = train.groupby(['month', 'country']).agg({'num_sold':'mean'}).reset_index()","60e65700":"## Creating a figure\nfig = plt.figure(figsize=(20,6))\n\n## Creating a grid for different subplots\nspec = gridspec.GridSpec(\n    ncols=2, nrows=1,\n    width_ratios=[1, 2], wspace=0.2,\n)\n\n## Plotting the bar graph\nax = fig.add_subplot(spec[0])\nplot_bar(country, cat='country', ax=ax)\n\n## Plotting the time series\nax2 = fig.add_subplot(spec[1])\nplot_time_series(country_time, 'country', ax=ax2)","597cac3c":"# Viewing the average items sold by store by month\n\nstore_time = train.groupby(['month', 'store']).agg({'num_sold':'mean'}).reset_index()","dbbfdc05":"# Grouping store values\n\nt = train.groupby(['store', 'country']).agg({'num_sold':'mean'}).reset_index().sort_values(by=['country', 'store'], ascending=False)\nswe_store = t[t['country']=='Sweden']['num_sold'].values\nfin_store = t[t['country']=='Finland']['num_sold'].values\nnor_store = t[t['country']=='Norway']['num_sold'].values","ca0f2f59":"## Creating a figure\nfig = plt.figure(figsize=(20,6))\n\n## Creating a grid for different subplots\nspec = gridspec.GridSpec(\n    ncols=2, nrows=1,\n    width_ratios=[1, 2], wspace=0.2,\n)\n\n## Plotting the bar graph\nax = fig.add_subplot(spec[0])\n\nbarWidth = 0.20\nbr1 = np.arange(store_time['store'].nunique())\nbr2 = [x + barWidth for x in br1]\nbr3 = [x + barWidth for x in br2]\n\nax.bar(br1, fin_store, color='steelblue', width=barWidth, label='Finland')\naddlabels(br1, fin_store)\n\nax.bar(br2, nor_store, color='salmon', width=barWidth, label='Norway')\naddlabels(br2, nor_store)\n\nax.bar(br3, swe_store, color='teal', width=barWidth, label='Sweden')\naddlabels(br3, swe_store)\n\nax.set_xticks((br2[0],br2[1]), ('Rama', 'Mart'), fontsize=fontsize['tick'])\n# plt.xticks(fontsize=fontsize['tick'])\nplt.xlabel('Store', fontsize=fontsize['label'])\nax.legend(title='Country')\nplt.title('Average Items Sold by Store', fontsize=fontsize['title'])\nax.spines['top'].set_visible(False)\nax.spines['right'].set_visible(False)\nax.spines['bottom'].set_visible(False)\nax.spines['left'].set_visible(False)\nplt.gca().get_yaxis().set_visible(False);\n\n## Plotting the \nax2 = fig.add_subplot(spec[1])\nplot_time_series(store_time, 'store', ax=ax2)","4f6c20c6":"# More group bys\n\nproduct_time = train.groupby(['month','product']).agg({'num_sold':'mean'}).reset_index()\ngp = train.groupby(['country', 'store', 'product']).agg({'num_sold':'mean'}).sort_values(by='num_sold', ascending=True)","52df49be":"# Plotting time vs product sales\n\nplot_time_series(df=product_time, cat='product');","d5cc51fd":"# Plotting the sales by 'country', 'store', 'product'\n\ngp.plot(kind='barh', figsize=(18,8), legend=False, title=\"Sales by Country, Store, Product\");","d0c69d88":"# Store","344fc4b9":"## Insights by Year\n* There is a yearly seasonality for all years\n    * around Christmas time, there is a huge spike\n    * around the summer the sales go down and hits s minimum on August and September\n* the sales are increasing from year to year","368b6326":"# EDA","f5e01db0":"# Dealing with Time","d81acae2":"## Items Sold by Country, Product, Store","387db956":"## Insights on Country by Year\n* the country that makes the most sales is in Norway\n    * by about 150 more per month\n* each country follows the same seasonal pattern as the year","9cf595d5":"## Description of Data","0b868d75":"# Products\n\n","0d390fb9":"## Insights on Products\n* Hats follow the trend of the yearly cycle\n    * It makes sense, people wear hats during the winter times and not the summer\n* Mugs almost follows a different pattern\n    * It does spike around winter time\n    * Levels off rest of the year\n* Stickers are leveled off\n    * Yhis makes sense since the time of the year will not affect the decision to buy a sticker or not\n    * Might be better off not modeling this feature","161ec270":"## Insights on Sales\n* Norway makes the most sales\n* Hats are the #1 sellers\n* The store Rama makes the most sells\n* Sales are increasing yearly","49957ef4":"## Insights on Stores\n* There are only two different stores\n* Rama makes the most sales compared to Mart\n* The yearly cycle is the same even in the store level ","a9df7ee2":"# Data Preparation","dddc24a3":"# Country"}}