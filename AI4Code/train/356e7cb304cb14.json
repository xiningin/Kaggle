{"cell_type":{"b86ca018":"code","766ca7df":"code","1ee1da02":"code","074b2802":"code","a913a0cf":"code","27d0534b":"code","81c0e561":"code","1da5b541":"code","316b415f":"code","5d2253b8":"code","432e0682":"code","cca26a0a":"code","910b98c2":"code","95478ca8":"code","03bc940b":"code","fc377668":"code","c31369f0":"code","88ab4b5a":"code","d113b27b":"markdown","474f2f4c":"markdown"},"source":{"b86ca018":"!pip install --quiet mlflow","766ca7df":"!pip install --quiet nyaggle","1ee1da02":"import nyaggle\n\nnyaggle.__version__","074b2802":"import numpy as np\nimport pandas as pd\n\ntrain = pd.read_csv(\"..\/input\/titanic\/train.csv\")\ntest = pd.read_csv(\"..\/input\/titanic\/test.csv\")\ngender_submission = pd.read_csv(\"..\/input\/titanic\/gender_submission.csv\")","a913a0cf":"target_col = 'Survived'\ntarget = train[target_col]\ntrain.drop(columns=[target_col], inplace=True)","27d0534b":"is_train = 'is_train'\ntrain[is_train] = 1\ntest[is_train] = 0","81c0e561":"data = pd.concat([train, test], sort=False).reset_index(drop=True)","1da5b541":"data.head()","316b415f":"import nyaggle.feature_store as fs\n\n@fs.cached_feature(\"all_feature\")\ndef all_feature(df: pd.DataFrame) -> pd.DataFrame:\n    df['Sex'] = df['Sex'].replace(['male','female'], [0, 1])\n    df['Embarked'] = df['Embarked'].fillna(('S'))\n    df['Embarked'] = df['Embarked'].map( {'S': 0, 'C': 1, 'Q': 2} ).astype(int)\n    df['Fare'] = df['Fare'].fillna(np.mean(df['Fare']))\n    df['Age'] = df['Age'].fillna(df['Age'].median())\n    delete_columns = ['Name', 'PassengerId', 'SibSp', 'Parch', 'Ticket', 'Cabin']\n    df = df.drop(delete_columns, axis=1)\n    return df","5d2253b8":"_all_feature = all_feature(data)\n# _embarked_feature = embarked_feature(data)","432e0682":"%ls features\/","cca26a0a":"_all_feature.head()","910b98c2":"del _all_feature","95478ca8":"_all_feature = all_feature(data)","03bc940b":"train, test = _all_feature[_all_feature[is_train] == 1], _all_feature[_all_feature[is_train] == 0]\ntrain.drop(columns=[is_train], inplace=True)\ntest.drop(columns=[is_train], inplace=True)","fc377668":"from nyaggle.hyper_parameters import list_hyperparams\n\nlist_hyperparams()","c31369f0":"from sklearn.metrics import roc_auc_score\nfrom sklearn.model_selection import StratifiedKFold\nfrom nyaggle.experiment import run_experiment\n\nskf = StratifiedKFold(4)\n\nlgb_params = {'num_leaves': 8,\n  'min_data_in_leaf': 42,\n  'objective': 'binary',\n  'max_depth': 16,\n  'learning_rate': 0.03,\n  'boosting': 'gbdt',\n  'bagging_freq': 5,\n  'bagging_fraction': 0.8,\n  'feature_fraction': 0.8201,\n  'reg_alpha': 1.7289,\n  'reg_lambda': 4.984,\n  'metric': 'auc',\n  'subsample': 0.81,\n  'min_gain_to_split': 0.01,\n  'min_child_weight': 19.428}\n\nfit_params = {\n    \"early_stopping_rounds\": 100,\n    \"verbose\": 100\n}\n\nresult = run_experiment(lgb_params,\n                        train, target, test, fit_params=fit_params,\n                        cv=skf, eval_func=roc_auc_score, sample_submission=gender_submission,\n                        with_mlflow=True)","88ab4b5a":"# !mlflow ui","d113b27b":"## Install nyaggle\nYou can install nyaggle via [pip](https:\/\/pypi.org\/project\/nyaggle\/)","474f2f4c":"# Tutorial for nyaggle\nThis Jupyter Notebook basic usage.\n\n1. Intall nyaggle"}}