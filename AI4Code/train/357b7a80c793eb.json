{"cell_type":{"05018e8d":"code","5f0f9be5":"code","500ed439":"code","b3d48b4d":"markdown"},"source":{"05018e8d":"import numpy as np\nimport torch\n\nBATCH = 1\nFEATURE = 2\n\n\nconv_batchnorm_output = [\n    # conv_batchnorm_output ch0\n    [\n        1,1,1,1,1,1,1,1,1,1,1,\n        1,1,1,1,1,1,1,1,1,1,1,\n        1,1,1,1,1,1,1,1,1,1,1,\n        1,1,1,1,1,1,1,1,1,1,1,\n        1,1,1,1,1,1,1,1,1,1,1,\n        1,1,1,1,1,1,1,1,1,1,1,\n        1,1,1,1,1,1,1,1,1,1,1,\n    ],\n    # conv_batchnorm_output ch1 \n    [\n        3,3,0,0,0,0,0,0,0,0,0,\n        3,3,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,2,2,2,0,0,0,0,\n        0,0,0,0,2,2,2,0,0,0,0,\n        0,0,0,0,2,2,2,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        4,0,0,0,0,0,0,0,0,0,0,\n    ],\n]\n\nheads = [\n    [   \n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,1,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n    ],\n    [   \n        1,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n    ],\n    [   \n        0,0,0,0,0,0,0,0,0,0,1,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n    ],\n    [   \n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        1,0,0,0,0,0,0,0,0,0,0,\n    ],\n]\nbodies = [\n    [   \n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,1,1,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n    ],\n    [   \n        0,1,1,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,0,\n    ],\n    [   \n        0,0,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,0,1,\n        0,0,0,0,0,0,0,0,0,0,1,\n        0,0,0,0,0,0,0,0,0,0,1,\n        0,0,0,0,0,0,0,0,0,0,1,\n        0,0,0,0,0,0,0,0,0,0,1,\n        0,0,0,0,0,0,0,0,0,0,0,\n    ],\n    [   \n        0,0,0,1,1,1,1,0,0,0,0,\n        0,1,1,1,0,0,0,0,0,0,0,\n        0,1,0,0,0,0,0,0,0,0,0,\n        0,1,0,0,0,0,0,0,0,0,0,\n        0,1,0,0,0,0,0,0,0,0,0,\n        1,1,0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,1,1,0,0,0,\n    ],\n]","5f0f9be5":"x = torch.Tensor(np.array([conv_batchnorm_output]*BATCH).reshape(BATCH,FEATURE,7,11))\n\nprint(\"conv_batchnorm_output\")\nprint(x)\n\nprint(\"heads\")\nheads_ = torch.Tensor(np.array([heads]*BATCH).reshape(BATCH,4,7,11))\nprint(heads_)\n\nprint(\"conv_batchnorm_output * heads\")\nx_ = (x.unsqueeze(1) * heads_.unsqueeze(2))\nprint(x_.shape)\nprint(x_)\n\nprint(\"h_head\")\nh_head = (x.unsqueeze(1) * heads_.unsqueeze(2)).sum(4, keepdim=True).sum(3, keepdim=True)\nprint(h_head.shape)\nprint(h_head)","500ed439":"print(\"bodies\")\nbodies_ = torch.Tensor(np.array([bodies]*BATCH).reshape(BATCH,4,7,11))\nh_body = (h_head * bodies_.unsqueeze(2)).sum(1)\nprint(bodies_)\n\nprint(\"h_body\")\nprint(h_body.shape)\nprint(h_body)","b3d48b4d":"This code will help you understand Head expansion, which is mentioned in the HandyRL team's solution.\n\nhttps:\/\/www.kaggle.com\/c\/hungry-geese\/discussion\/263279"}}