{"cell_type":{"0450002e":"code","4b89c034":"code","0e63b0c8":"code","230410ac":"code","ca50ff4f":"code","28fcfd7d":"code","af75915c":"code","c468b605":"code","43ebcfc2":"code","bb274999":"code","16ac93bf":"code","f48e0bc7":"code","8590da74":"code","2df65424":"code","48c8a24f":"code","de1252ea":"code","85b0b0c8":"markdown","40b55aec":"markdown","6f292544":"markdown","3a485a73":"markdown","8306d323":"markdown","2ac28eab":"markdown","94d23f96":"markdown","3d019b6a":"markdown","52e9c726":"markdown","efc106cf":"markdown"},"source":{"0450002e":"!pip install geotext mapclassify","4b89c034":"import numpy as np \nimport pandas as pd\nimport geopandas as gpd\nimport matplotlib.pyplot as plt\n\nimport os\nimport geotext # extracting \"cities\"","0e63b0c8":"df_companies = pd.read_csv(\"..\/input\/free-7-million-company-dataset\/companies_sorted.csv\")","230410ac":"df_companies.head()","ca50ff4f":"df_companies.dropna(subset=['name', 'industry', 'country'], inplace=True)\ndf_companies['locality'].fillna('missing',inplace = True)\n\nprint('Column-wise distribution of null values in the dataset')\nprint(df_companies.isnull().sum())","28fcfd7d":"df_companies = df_companies[df_companies['current employee estimate'] > 0]","af75915c":"df_companies.locality = df_companies.locality.str.title()\ndf_companies.country = df_companies.country.str.title()","c468b605":"def get_city(x: str) -> str:\n    geo = geotext.GeoText(x).cities\n    if len(geo) > 0:\n        return geo[0]\n    return x.split(',')[0] # first part of the text as a possible city\n\ndf_companies['city'] = df_companies.locality.map(get_city)\ndf_companies['country_city'] = df_companies['country'] + '; ' + df_companies['city']","43ebcfc2":"sorted(set(df_companies.industry.tolist()))","bb274999":"IT_industries = [\n 'animation',\n 'biotechnology',\n 'computer & network security',\n 'computer games',\n 'computer hardware',\n 'computer networking',\n 'computer software',\n 'consumer electronics',\n 'defense & space',\n 'e-learning',\n 'industrial automation',\n 'information services',\n 'information technology and services',\n 'internet',\n 'mechanical or industrial engineering',\n 'program development',\n 'telecommunications',\n 'wireless'\n]","16ac93bf":"it_frame = df_companies[df_companies.industry.isin(IT_industries)]","f48e0bc7":"it_cities = it_frame[it_frame.city != 'Missing'].country_city.value_counts().sort_values(ascending=False)\\\n            .reset_index().rename(columns={'index':'country_city', 'country_city': 'count'})\nit_cities.to_csv('count_of_it_companies_by_cities.csv')\nit_cities.head(10)","8590da74":"it_counted = it_frame[['country', 'name']].groupby(['country',], as_index=False).count().rename(columns={'name':'count'})\nit_counted.sort_values(by='count', ascending=False).reset_index(drop=True).head(10)","2df65424":"gdf = gpd.read_file(gpd.datasets.get_path('naturalearth_lowres'))[['name', 'geometry']]\ngdf.columns = ['country', 'geometry']\nprint(gdf.head())\n\nantarctic_index = int(gdf[gdf['country'] == 'Antarctica'].index.values)\ngdf = gdf.drop(gdf.index[antarctic_index])\n\nreplace = {\n    \"United States of America\": 'United States',\n    \"Bosnia and Herz.\": 'Bosnia And Herzegovina',\n    \"Central African Rep.\": 'Central African Republic',\n    \"C\u00f4te d'Ivoire\": 'C\u00f4te D\u2019Ivoire',\n    \"Dominican Rep.\": 'Dominican Republic',\n    \"Dem. Rep. Congo\": 'Democratic Republic Of The Congo', # 'Congo' remains vague, sorry\n    \"Eq. Guinea\": 'Equatorial Guinea',\n    \"Dominican Rep.\": 'Dominican Republic',\n    \"Solomon Is.\": 'Solomon Islands',\n    \"Trinidad and Tobago\": 'Trinidad And Tobago',\n    \"S. Sudan\": 'South Sudan',\n}\n\nfor (n_old, n_new) in replace.items():  \n    gdf.country.loc[gdf['country'] == n_old] = n_new\n\nit_countries = set(it_frame.country.tolist())\nprint(\"Countries, that are either missed in any of datasets, or named differently:\")\nprint(sorted(it_countries.symmetric_difference(set(gdf.country))))","48c8a24f":"merged = gdf.merge(it_counted, left_on='country', right_on='country', how = 'left')\nmerged.head()","de1252ea":"fig, ax = plt.subplots(1, figsize=(20,15))\n\nmerged.plot(color='grey', ax=ax, label = 'No data')\nmerged.dropna().plot(column='count', cmap='rainbow', ax=ax, scheme='natural_breaks', k=7, legend=True, legend_kwds={'loc': 'lower left'})\n\nplt.title('Count of IT companies by countries')\n\n#fixing floating-point counts, making them integer:\nleg = ax.get_legend()\nfor text in leg.get_texts():\n    text.set_text(text.get_text().replace('.00', ''))\n\nplt.axis('off')\n\nplt.savefig('it_by_countries.png', bbox_inches='tight')","85b0b0c8":"And finally playing with countries:","40b55aec":"Observing and cleaning the data:","6f292544":"Here I'm going to show some starter code for visualization of IT companies by countries.\n\nStarting by installation of additional libraries (for plotting and for an attempt to gain statistics by cities).","3a485a73":"Getting Natural Earth maps' database and adapting for our data:","8306d323":"Getting full list of industries and manually selecting those related to IT (my selection is not very critical and is subjective):","2ac28eab":"Looking for top IT cities:","94d23f96":"We are only interested in companies, where at least one current employee is presented:","3d019b6a":"Finally the picture!","52e9c726":"Extracting the smallest part of location, that is a city at least sometimes, so I save it as 'city':","efc106cf":"Capitalizing locations for further work (and especially for geotext):"}}