{"cell_type":{"aad421eb":"code","94da8e42":"code","d9d3c96c":"code","9395513f":"code","2ae9c01e":"code","9b385040":"markdown","be9dc79c":"markdown","2e741984":"markdown","d0395cc8":"markdown","883255e4":"markdown","3e032df9":"markdown"},"source":{"aad421eb":"# Set up feedback system\nfrom learntools.core import binder\nbinder.bind(globals())\nfrom learntools.sql_advanced.ex4 import *\nprint(\"Setup Complete\")","94da8e42":"# Fill in your answer\nquery_to_optimize = 3\n\n# Check your answer\nq_1.check()","d9d3c96c":"# Lines below will give you a hint or solution code\n#q_1.hint()\n#q_1.solution()","9395513f":"# Line below will give you a hint\n#q_2.hint()","2ae9c01e":"# View the solution (Run this code cell to receive credit!)\nq_2.solution()","9b385040":"# Conclusion\n\nCongratulations!  You have made it to the end of the micro-course.  You should be proud of all of your hard work!\n\nThere is still a lot of room to build knowledge and experience.  In particular, you're encouraged to look through our BigQuery **[datasets](https:\/\/kaggle.com\/datasets)** to practice your new skills.","be9dc79c":"# Exercises\n\n### 1) You work for Pet Costumes International.\n\nYou need to write three queries this afternoon. You have enough time to write working versions of all three, but only enough time to think about optimizing one of them.  Which of these queries is most worth optimizing?\n\n1. A software engineer wrote an app for the shipping department, to see what items need to be shipped and which aisle of the warehouse to go to for those items. She wants you to write the query. It will involve data that is stored in an `orders` table, a `shipments` table and a `warehouseLocation` table. The employees in the shipping department will pull up this app on a tablet, hit refresh, and your query results will be shown in a nice interface so they can see what costumes to send where.\n\n\n2. The CEO wants a list of all customer reviews and complaints\u2026 which are conveniently stored in a single `reviews` table. Some of the reviews are really long\u2026 because people love your pirate costumes for parrots, and they can\u2019t stop writing about how cute they are.\n\n\n3. Dog owners are getting more protective than ever. So your engineering department has made costumes with embedded GPS trackers and wireless communication devices. They send the costumes\u2019 coordinates to your database once a second. You then have a website where owners can find the location of their dogs (or at least the costumes they have for those dogs). For this service to work, you need a query that shows the most recent location for all costumes owned by a given human. This will involve data in a `CostumeLocations` table as well as a `CostumeOwners` table.\n\nSo, which of these could benefit most from being written efficiently?  Set the value of the `query_to_optimize` variable below to one of `1`, `2`, or `3`.  (Your answer should have type **integer**.)","2e741984":"---\n**[Advanced SQL Home Page](https:\/\/www.kaggle.com\/learn\/advanced-sql)**\n\n\n\n\n\n*Have questions or comments? Visit the [Learn Discussion forum](https:\/\/www.kaggle.com\/learn-forum) to chat with other Learners.*","d0395cc8":"# Introduction\n\nNow, you'll use what you learned in the previous tutorial to improve the efficiency of several queries.\n\nBefore you get started, run the following cell to set everything up.","883255e4":"### 2) Make it easier to find Mitzie! \n\nYou have the following two tables:\n\n![](https:\/\/i.imgur.com\/E9jikOQ.png)\n\nThe `CostumeLocations` table shows timestamped GPS data for all of the pet costumes in the database, where `CostumeID` is a unique identifier for each costume.  \n\nThe `CostumeOwners` table shows who owns each costume, where the `OwnerID` column contains unique identifiers for each (human) owner.  Note that each owner can have more than one costume!  And, each costume can have more than one owner: this allows multiple individuals from the same household (all with their own, unique `OwnerID`) to access the locations of their pets' costumes.\n\nSay you need to use these tables to get the current location of one pet in particular: Mitzie the Dog recently ran off chasing a squirrel, but thankfully she was last seen in her hot dog costume!\n\nOne of Mitzie's owners (with owner ID `MitzieOwnerID`) logs into your website to pull the last locations of every costume in his possession.  Currently, you get this information by running the following query:\n\n```sql\nWITH LocationsAndOwners AS \n(\nSELECT * \nFROM CostumeOwners co INNER JOIN CostumeLocations cl\n   ON co.CostumeID = cl.CostumeID\n),\nLastSeen AS\n(\nSELECT CostumeID, MAX(Timestamp)\nFROM LocationsAndOwners\nGROUP BY CostumeID\n)\nSELECT lo.CostumeID, Location \nFROM LocationsAndOwners lo INNER JOIN LastSeen ls \n\tON lo.Timestamp = ls.Timestamp AND lo.CostumeID = ls.CostumeID\nWHERE OwnerID = MitzieOwnerID\n```\n\nIs there a way to make this faster or cheaper?","3e032df9":"**[Advanced SQL Home Page](https:\/\/www.kaggle.com\/learn\/advanced-sql)**\n\n---\n"}}