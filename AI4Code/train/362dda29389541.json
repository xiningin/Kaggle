{"cell_type":{"d4c40bb9":"code","87e132d6":"code","da9e2794":"code","1e1d2ac1":"code","21d1b1bb":"code","de3e47e1":"code","c8e44d4e":"code","9c9f927b":"code","d8cdad89":"code","2d46f144":"code","ee976d49":"code","6b5a0477":"code","e2e0ab17":"code","243a939f":"code","345125d3":"code","1050dabc":"code","11c6269c":"code","b24ef593":"code","e07814b8":"code","be59965c":"code","ad92d323":"code","63de92d7":"code","1134ec1b":"code","b8964bb7":"code","cfb87ae2":"code","106fd853":"code","e4717cd9":"code","62ea8050":"code","b5ebb276":"code","1f4ab44e":"code","29521020":"code","3617fc1c":"code","568fb3a4":"code","4355f95a":"markdown","17bf9902":"markdown","903cd996":"markdown","9e6bdc57":"markdown","922a5205":"markdown","62a2369f":"markdown","f7a19254":"markdown","242666d1":"markdown","0d284dda":"markdown","627d3981":"markdown","26c48ccf":"markdown","38e786a7":"markdown","dbcda70a":"markdown","f658a4e7":"markdown"},"source":{"d4c40bb9":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport plotly.graph_objects as go # graphic objects plots \nfrom plotly.subplots import make_subplots # create multiple plots side by side\nimport plotly.express as px # plotly express\n\nfrom sklearn.preprocessing import OrdinalEncoder # Encode Countries and Regions\nfrom sklearn.metrics import mean_squared_error # Compare Models using the same metric\nfrom sklearn.model_selection import cross_val_score # Avoid Overfitting","87e132d6":"report21 = pd.read_csv(\"\/kaggle\/input\/world-happiness-report-2021\/world-happiness-report-2021.csv\")\nreport21","da9e2794":"historic_report = pd.read_csv(\"\/kaggle\/input\/world-happiness-report-2021\/world-happiness-report.csv\")\n\nhistoric_report['year'] = historic_report['year'].astype(int)\n\nhistoric_report = historic_report[(historic_report['year'] >= 2006) & (historic_report['year'] <= 2020)]\n\nhistoric_report.describe()","1e1d2ac1":"new_names = {\n    'Country name': 'country',\n    'Freedom to make life choices': 'freedom',\n    'Generosity': 'generosity',\n    'Healthy life expectancy': 'life_expectancy_21',\n    'Healthy life expectancy at birth': 'life_expectancy_h',\n    'Ladder score': 'ladder_score',\n    'Life Ladder': 'life_ladder',\n    'Logged GDP per capita': 'log_gdp_21',\n    'Log GDP per capita': 'log_gdp_h',\n    'lowerwhisker': 'lower_whisker',\n    'Negative affect': 'negative_affect',\n    'Perceptions of corruption': 'corruption',\n    'Positive affect': 'positive_affect',\n    'Regional indicator': 'region',\n    'Social support': 'social_support',\n    'Standard error of ladder score': 'ladder_score_std',\n    'upperwhisker': 'upper_whisker',\n    'year': 'year'\n}","21d1b1bb":"historic_report = historic_report.rename(columns=new_names)","de3e47e1":"# I am more interested in the first 13 columns\nreport21 = report21.iloc[:, :12]\nreport21 = report21.rename(columns=new_names)\n\nreport21 = report21.drop(['ladder_score_std', 'upper_whisker', 'lower_whisker'], axis=1)","c8e44d4e":"columns_to_plot = [column for column in report21.columns if column not in ['country', 'region']]\n\n\nfig = make_subplots(\n    rows=(len(columns_to_plot)\/\/2)+1, \n    cols=2,\n    subplot_titles=[\n        'Ladder Score', 'Logged GDP per capita', 'Social Support', 'Healthy Life Expectancy', 'Freedom to make Life Choices', \n        'Generosity', 'Perceptions of Corruption'\n    ]\n)\n\nfor i, column in enumerate(columns_to_plot):\n    trace = go.Histogram(x=report21[column])\n    fig.append_trace(trace, (i\/\/2)+1, (i%2)+1)\n\nfig.update_layout(showlegend=False, height=1500,)\n    \nfig.show()","9c9f927b":"columns_to_plot = [column for column in report21.columns if column not in ['country', 'region', 'ladder_score']]\n\n\nfig = make_subplots(\n    rows=(len(columns_to_plot)\/\/2), \n    cols=2,\n)\n\nfor i, column in enumerate(columns_to_plot):\n    trace = go.Scatter(\n        x=report21[column], \n        y=report21['ladder_score'],\n        hovertext=report21['country'],\n        mode='markers',\n        marker=dict(color=report21['ladder_score'])\n    )\n    fig.append_trace(trace, (i\/\/2)+1, (i%2)+1)\n    \n    original_column_name = [ key for key, value in new_names.items() if value == column]\n    \n    fig.update_xaxes(title_text=original_column_name[0], row=(i\/\/2)+1, col=(i%2)+1)\n    fig.update_yaxes(title_text=\"Ladder Score\", row=(i\/\/2)+1, col=(i%2)+1)\n\nfig.update_layout( \n    showlegend=False, \n    height=1000,\n)\n    \nfig.show()","d8cdad89":"# Countries where people perceive their government to be corrupt (> 70%)\n\ncorrupt_countries = report21[report21.corruption > 0.7]\n\nprint(f\"{int((corrupt_countries.shape[0]\/report21.shape[0])*100)}% of governments are perceived as corrupt\")","2d46f144":"# Is generosity linked to happiness?\n\ntop25 = report21[:25]\nbottom25 = report21[-26:]\n\nprint(f\"Average generosity in the top 25 countries: {round(top25.generosity.mean(), )}\")\nprint(f\"Average generosity in the bottom 25 countries: {round(bottom25.generosity.mean(), )}\")","ee976d49":"# Correlation matrix\ncm = report21.corr()\n\nfig = px.imshow(cm)\nfig.show()","6b5a0477":"# One more beautiful correlation matrix\n\ndata = []\n\nfor index, row in cm.iterrows():\n    for c in cm.columns:\n        data.append([c, index, row[c]])\n        \ndata = pd.DataFrame(data, columns=['Indicators X', 'Indicators Y', 'Correlation'])\n\nfig = px.scatter(\n    data,\n    x = 'Indicators X',\n    y = 'Indicators Y',\n    color = 'Correlation',\n    size = abs(data['Correlation'])\n)\nfig.show()","e2e0ab17":"X = report21.drop(['country', 'region', 'ladder_score'], axis=1).copy()\ny = report21['ladder_score'].copy()","243a939f":"from sklearn.linear_model import LinearRegression","345125d3":"slrmodel = LinearRegression(\n    fit_intercept = False, # default = True\n    normalize = False, # default = False\n    copy_X = True, # default = True\n    n_jobs = -1, # default=None\n    positive = False # default = False\n)\nslrmodel.fit(X, y)\n\ny_pred = slrmodel.predict(X)\nmse = mean_squared_error(y, y_pred)\nrmse = np.sqrt(mse)\n\nslrscores = cross_val_score(slrmodel, X, y, cv=10, scoring='neg_root_mean_squared_error')\n\nprint(f\"Model RMSE: {rmse} Cross-Validation Mean RMSE: {round(slrscores.mean(), 2)}\")","1050dabc":"from sklearn.ensemble import RandomForestRegressor","11c6269c":"rfrmodel = RandomForestRegressor(\n    n_estimators = 100, # default = 100\n    criterion = \"mse\", # {\"mse\", \"mae\"}, default = \"mse\"\n    max_depth = 20, # default = None\n    min_samples_split = 2, # default = 2\n    min_samples_leaf = 1, # default = 1\n    min_weight_fraction_leaf = 0.0, # default = 0.0\n    max_features = \"auto\", # {\"auto\", \"sqrt\", \"log2\"}, default=\"auto\"\n    max_leaf_nodes = None, # default = None\n    min_impurity_decrease = 0.0, # default = 0.0\n    min_impurity_split = None, # default = None\n    bootstrap = True, # default = True\n    oob_score = False, # default = False\n    n_jobs = -1, # default = None\n    random_state = None, # default = None\n    verbose = 0, # default = 0\n    warm_start = False, # default = False\n    ccp_alpha = 0.0, # default = 0.0\n    max_samples = None # default = None\n)\nrfrmodel.fit(X, y)\n\ny_pred = rfrmodel.predict(X)\nmse = mean_squared_error(y, y_pred)\nrmse = np.sqrt(mse)\n\nrfrscores = cross_val_score(rfrmodel, X, y, cv=10, scoring='neg_root_mean_squared_error')\n\nprint(f\"Model RMSE: {rmse} Cross-Validation Mean RMSE: {round(rfrscores.mean(), 2)}\")","b24ef593":"from sklearn.neighbors import KNeighborsRegressor","e07814b8":"knnmodel = KNeighborsRegressor(\n    n_neighbors = 10, # default = 5\n    weights = \"uniform\", # {\"uniform\", \"distance\"}, default = \"uniform\"\n    algorithm = \"auto\", # {\"auto\", \"ball_tree\", \"kd_tree\", \"brute\"}, default = \"auto\"\n    leaf_size = 30, # default = 30\n    p = 2, # default = 2\n    metric = \"minkowski\", # default = \"minkowski\"\n    metric_params = None, # default = None\n    n_jobs = -1, # default = None\n)\nknnmodel.fit(X, y)","be59965c":"knn_scores = []\nks = [k for k in range(1, 100, 3)]\n\nfor k in ks:\n    knnmodel = KNeighborsRegressor(n_neighbors=k).fit(X, y)\n    cvscores = cross_val_score(knnmodel, X, y, cv=10, scoring='neg_root_mean_squared_error')\n    knn_scores.append(cvscores.mean())\n    \nfig = px.line(x=ks, y=knn_scores)\n\nfig.update_layout(\n    title=\"K value vs Accuracy\",\n    xaxis_title=\"K\",\n    yaxis_title=\"Accuracy\",\n)\n\nfig.show()","ad92d323":"y_pred = knnmodel.predict(X)\nmse = mean_squared_error(y, y_pred)\nrmse = np.sqrt(mse)\n\nknnscores = cross_val_score(knnmodel, X, y, cv=10, scoring='neg_root_mean_squared_error')\n\nprint(f\"Model RMSE: {rmse} Cross-Validation Mean RMSE: {round(knnscores.mean(), 2)}\")","63de92d7":"from sklearn.cluster import KMeans","1134ec1b":"kmeans = KMeans(n_clusters=3, random_state=0).fit(X)","b8964bb7":"import pycountry\n\ndef try_get_iso(country_name):\n    try:\n        iso = pycountry.countries.search_fuzzy(country_name)[0].alpha_3\n        return iso\n    except:\n        return None\n\nreport21['iso_alpha'] = report21['country'].apply(lambda x : try_get_iso(x))\n","cfb87ae2":"report21_with_isocode = report21[report21.iso_alpha.notnull()].copy()\ny_pred = kmeans.predict(report21_with_isocode[X.columns])\n\nfig = px.choropleth(\n    report21_with_isocode, \n    locations=\"iso_alpha\",\n    color=y_pred,\n    hover_name=\"country\"\n)\n\nfig.update_layout(\n    showlegend=False,\n    coloraxis_showscale = False,\n    title=\"What did k-means find? First, Second and Third world countries maybe.\"\n)\n\nfig.show()","106fd853":"fig = px.line(\n    historic_report, \n    x=\"year\", \n    y=\"life_ladder\",\n    color=\"country\",\n    hover_name=\"country\"\n)\nfig.show()","e4717cd9":"# fix for category_orders\nyears = [x for x in range(historic_report[\"year\"].min(),historic_report[\"year\"].max())]","62ea8050":"fig = px.scatter(\n    historic_report, \n    x=\"log_gdp_h\", \n    y=\"life_ladder\", \n    animation_frame=\"year\", \n    category_orders={\"year\": years},\n    animation_group=\"country\",\n    color=\"country\", \n    hover_name=\"country\",\n    range_x=[historic_report[\"log_gdp_h\"].min(),historic_report[\"log_gdp_h\"].max()], \n    range_y=[historic_report[\"life_ladder\"].min(),historic_report[\"life_ladder\"].max()]\n)\n\nfig.update_layout(\n    title=\"How important has the gdp been for the happiness of citizens over the years?\"\n)\n\nfig.show()","b5ebb276":"fig = px.scatter(\n    historic_report, \n    x=\"social_support\", \n    y=\"life_ladder\", \n    animation_frame=\"year\", \n    category_orders={\"year\": years},\n    animation_group=\"country\",\n    color=\"country\", \n    hover_name=\"country\",\n    range_x=[historic_report[\"social_support\"].min(),historic_report[\"social_support\"].max()], \n    range_y=[historic_report[\"life_ladder\"].min(),historic_report[\"life_ladder\"].max()]\n)\n\nfig.update_layout(\n    title=\"How important has the social support been for the happiness of citizens over the years?\"\n)\n\nfig.show()","1f4ab44e":"fig = px.scatter(\n    historic_report, \n    x=\"life_expectancy_h\", \n    y=\"life_ladder\", \n    animation_frame=\"year\", \n    category_orders={\"year\": years},\n    animation_group=\"country\",\n    color=\"country\", \n    hover_name=\"country\",\n    range_x=[historic_report[\"life_expectancy_h\"].min(),historic_report[\"life_expectancy_h\"].max()], \n    range_y=[historic_report[\"life_ladder\"].min(),historic_report[\"life_ladder\"].max()]\n)\n\nfig.update_layout(\n    title=\"How important has the life expectancy been for the happiness of citizens over the years?\"\n)\n\nfig.show()","29521020":"fig = px.scatter(\n    historic_report, \n    x=\"freedom\", \n    y=\"life_ladder\", \n    animation_frame=\"year\", \n    category_orders={\"year\": years},\n    animation_group=\"country\",\n    color=\"country\", \n    hover_name=\"country\",\n    range_x=[historic_report[\"freedom\"].min(),historic_report[\"freedom\"].max()], \n    range_y=[historic_report[\"life_ladder\"].min(),historic_report[\"life_ladder\"].max()]\n)\n\nfig.update_layout(\n    title=\"How important has the freedom been for the happiness of citizens over the years?\"\n)\n\nfig.show()","3617fc1c":"fig = px.scatter(\n    historic_report, \n    x=\"generosity\", \n    y=\"life_ladder\", \n    animation_frame=\"year\", \n    category_orders={\"year\": years},\n    animation_group=\"country\",\n    color=\"country\", \n    hover_name=\"country\",\n    range_x=[historic_report[\"generosity\"].min(),historic_report[\"generosity\"].max()], \n    range_y=[historic_report[\"life_ladder\"].min(),historic_report[\"life_ladder\"].max()]\n)\n\nfig.update_layout(\n    title=\"How important has the generosity been for the happiness of citizens over the years?\"\n)\n\nfig.show()","568fb3a4":"fig = px.scatter(\n    historic_report, \n    x=\"corruption\", \n    y=\"life_ladder\", \n    animation_frame=\"year\", \n    category_orders={\"year\": years},\n    animation_group=\"country\",\n    color=\"country\", \n    hover_name=\"country\",\n    range_x=[historic_report[\"corruption\"].min(),historic_report[\"corruption\"].max()], \n    range_y=[historic_report[\"life_ladder\"].min(),historic_report[\"life_ladder\"].max()]\n)\n\nfig.update_layout(\n    title=\"How important has the perception of corruption been for the happiness of citizens over the years?\"\n)\n\n\nfig.show()","4355f95a":"# Scatter \nHow does each country behave individually?","17bf9902":"# Features Seleccion","903cd996":"# Data","9e6bdc57":"# Correlation\n","922a5205":"## Model 2. Random Forest","62a2369f":"## Model 3. K Nearest Neighbors","f7a19254":"# Animations\nHow have the indicators changed over the years?","242666d1":"# What can we get from K-Means?\nDoes third world countries exist? Which ones are really at each group?","0d284dda":"# Historical Data","627d3981":"## Histograms\nIs the majority of the world happy?","26c48ccf":"# Can we predict the ladder score?","38e786a7":"# Plot Time","dbcda70a":"## Model 1. Linear Regression","f658a4e7":"# This is a work in progress, next version will have:\n\n* Future Predictions\n* More ML Models \n* Better description of the data"}}