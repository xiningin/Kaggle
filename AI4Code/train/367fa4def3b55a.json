{"cell_type":{"10c05d9c":"code","7854424a":"code","c1ab0109":"code","bccb1e24":"code","ff1486b8":"code","e619d0de":"code","7e5ad04a":"code","eab2b3d0":"code","336b3085":"code","85201389":"code","3279581b":"code","aa1e50a5":"code","d5f2d434":"code","7ab753c4":"code","58db397c":"code","fad894b4":"code","dabbed85":"code","ceb96842":"code","16b08387":"code","99af9fa5":"code","22ec1ba4":"code","2ef3db95":"code","0b335561":"code","83b95a02":"code","14a6788d":"code","e639c74d":"code","4414e51c":"code","bd27afcc":"markdown","186c0757":"markdown","b423038f":"markdown","c0b26ef6":"markdown","5dfbbcaa":"markdown","0224b984":"markdown","5fe0a0a4":"markdown","b09991e0":"markdown","43723014":"markdown","9e6dfa8c":"markdown","4ae92433":"markdown","cfe715b8":"markdown","bf9c2e3a":"markdown","095f57b4":"markdown","0f489d7e":"markdown","2a4d3046":"markdown","a3316c7f":"markdown","bf3cf037":"markdown","47dbb150":"markdown","7df75b8e":"markdown","885a9d26":"markdown","8fdabf9f":"markdown","c60073e7":"markdown","c347f61a":"markdown","7de13d33":"markdown","e7f1bbb9":"markdown","f8d67b4e":"markdown"},"source":{"10c05d9c":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport seaborn as sns","7854424a":"a= pd.read_csv('\/kaggle\/input\/lish-moa\/train_features.csv')\nb= pd.read_csv('\/kaggle\/input\/lish-moa\/test_features.csv')\nc=pd.read_csv('\/kaggle\/input\/lish-moa\/train_targets_nonscored.csv')\nd=pd.read_csv('\/kaggle\/input\/lish-moa\/train_targets_scored.csv')\n\nmerged=pd.concat([a,b])\n\n#Datasets for treated and control experiments\ntreated= a[a['cp_type']=='trt_cp']\ncontrol= a[a['cp_type']=='ctl_vehicle']\n\n#Treatment time datasets\ncp24= a[a['cp_time']== 24]\ncp48= a[a['cp_time']== 48]\ncp72= a[a['cp_time']== 72]\n\n#Merge scored and nonscored labels\nall_drugs= pd.merge(d, c, on='sig_id', how='inner')\n\n#Treated drugs without control\ntreated_list = treated['sig_id'].to_list()\ndrugs_tr= d[d['sig_id'].isin(treated_list)]\n\n#adt= All Drugs Treated\nadt= all_drugs[all_drugs['sig_id'].isin(treated_list)]","c1ab0109":"def plotd(f1):\n    plt.style.use('seaborn')\n    sns.set_style('whitegrid')\n    fig = plt.figure(figsize=(15,5))\n    #1 rows 2 cols\n    #first row, first col\n    ax1 = plt.subplot2grid((1,2),(0,0))\n    plt.hist(control[f1], bins=4, color='mediumpurple',alpha=0.5)\n    plt.title(f'control: {f1}',weight='bold', fontsize=18)\n    #first row sec col\n    ax1 = plt.subplot2grid((1,2),(0,1))\n    plt.hist(treated[f1], bins=4, color='darkcyan',alpha=0.5)\n    plt.title(f'Treated with compound: {f1}',weight='bold', fontsize=18)\n    plt.show()\n    \ndef plott(f1):\n    plt.style.use('seaborn')\n    sns.set_style('whitegrid')\n    fig = plt.figure(figsize=(15,5))\n    #1 rows 2 cols\n    #first row, first col\n    ax1 = plt.subplot2grid((1,3),(0,0))\n    plt.hist(cp24[f1], bins=3, color='deepskyblue',alpha=0.5)\n    plt.title(f'Treatment duration 24h: {f1}',weight='bold', fontsize=14)\n    #first row sec col\n    ax1 = plt.subplot2grid((1,3),(0,1))\n    plt.hist(cp48[f1], bins=3, color='lightgreen',alpha=0.5)\n    plt.title(f'Treatment duration 48h: {f1}',weight='bold', fontsize=14)\n    #first row 3rd column\n    ax1 = plt.subplot2grid((1,3),(0,2))\n    plt.hist(cp72[f1], bins=3, color='gold',alpha=0.5)\n    plt.title(f'Treatment duration 72h: {f1}',weight='bold', fontsize=14)\n    plt.show()\n\ndef plotf(f1, f2, f3, f4):\n    plt.style.use('seaborn')\n    sns.set_style('whitegrid')\n\n    fig= plt.figure(figsize=(15,10))\n    #2 rows 2 cols\n    #first row, first col\n    ax1 = plt.subplot2grid((2,2),(0,0))\n    plt.hist(a[f1], bins=3, color='orange', alpha=0.7)\n    plt.title(f1,weight='bold', fontsize=18)\n    plt.yticks(weight='bold')\n    plt.xticks(weight='bold')\n    #first row sec col\n    ax1 = plt.subplot2grid((2,2), (0, 1))\n    plt.hist(a[f2], bins=3, alpha=0.7)\n    plt.title(f2,weight='bold', fontsize=18)\n    plt.yticks(weight='bold')\n    plt.xticks(weight='bold')\n    #Second row first column\n    ax1 = plt.subplot2grid((2,2), (1, 0))\n    plt.hist(a[f3], bins=3, color='red', alpha=0.7)\n    plt.title(f3,weight='bold', fontsize=18)\n    plt.yticks(weight='bold')\n    plt.xticks(weight='bold')\n    #second row second column\n    ax1 = plt.subplot2grid((2,2), (1, 1))\n    plt.hist(a[f4], bins=3, color='green', alpha=0.7)\n    plt.title(f4,weight='bold', fontsize=18)\n    plt.yticks(weight='bold')\n    plt.xticks(weight='bold')\n\n    return plt.show()\n\ndef ploth(data, w=15, h=9):\n    plt.figure(figsize=(w,h))\n    sns.heatmap(data.corr(), cmap='hot')\n    plt.title('Correlation between the drugs', fontsize=18, weight='bold')\n    return plt.show()","bccb1e24":"a.head()","ff1486b8":"plt.style.use('seaborn')\nsns.set_style('whitegrid')\nfig = plt.figure(figsize=(15,5))\n#1 rows 2 cols\n#first row, first col\nax1 = plt.subplot2grid((1,2),(0,0))\nsns.countplot(x='cp_type', data=a, palette='pastel')\nplt.title('Train: Control and treated samples', fontsize=15, weight='bold')\n#first row sec col\nax1 = plt.subplot2grid((1,2),(0,1))\nsns.countplot(x='cp_dose', data=a, palette='Purples')\nplt.title('Train: Treatment Doses: Low and High',weight='bold', fontsize=18)\nplt.show()","e619d0de":"plt.figure(figsize=(15,5))\nsns.distplot( a['cp_time'], color='red', bins=5)\nplt.title(\"Train: Treatment duration \", fontsize=15, weight='bold')\nplt.show()","7e5ad04a":"plotf('c-10', 'c-50', 'c-70', 'c-90')","eab2b3d0":"plotd(\"c-30\")","336b3085":"plott('c-30')","85201389":"#Select the columns c-\nc_cols = [col for col in a.columns if 'c-' in col]\n#Filter the columns c-\ncells=treated[c_cols]\n#Plot heatmap\nplt.figure(figsize=(12,6))\nsns.heatmap(cells.corr(), cmap='coolwarm', alpha=0.9)\nplt.title('Correlation: Cell viability', fontsize=15, weight='bold')\nplt.xticks(weight='bold')\nplt.yticks(weight='bold')\nplt.show()","3279581b":"plotf('g-10','g-100','g-200','g-400')","aa1e50a5":"plotd('g-510')","d5f2d434":"plott('g-510')","7ab753c4":"#Select the columns g-\ng_cols = [col for col in a.columns if 'g-' in col]\n#Filter the columns g-\ngenes=treated[g_cols]\n#Plot heatmap\nplt.figure(figsize=(15,7))\nsns.heatmap(genes.corr(), cmap='coolwarm', alpha=0.9)\nplt.title('Gene expression: Correlation', fontsize=15, weight='bold')\nplt.show()","58db397c":"#Count unique values per column\ncols = drugs_tr.columns.to_list() # specify the columns whose unique values you want here\nuniques = {col: drugs_tr[col].nunique() for col in cols}\nuniques=pd.DataFrame(uniques, index=[0]).T\nuniques=uniques.rename(columns={0:'count'})\nuniques= uniques.drop('sig_id', axis=0)\n\n\n#Calculate the mean values\naverage=d.mean()\naverage=pd.DataFrame(average)\naverage=average.rename(columns={ 0: 'mean'})\naverage['percentage']= average['mean']*100\n#Filter just the drugs with mean >0.01\naverage_filtered= average[average['mean'] > 0.01]\naverage_filtered= average_filtered.reset_index()\naverage_filtered= average_filtered.rename(columns={'index': 'drug'})","fad894b4":"plt.style.use('seaborn')\nsns.set_style('whitegrid')\nfig = plt.figure(figsize=(15,5))\n#1 rows 2 cols\n#first row, first col\nax1 = plt.subplot2grid((1,2),(0,0))\nsns.countplot(uniques['count'], color='deepskyblue', alpha=0.75)\nplt.title('Unique elements per drug [0,1]', fontsize=15, weight='bold')\n#first row sec col\nax1 = plt.subplot2grid((1,2),(0,1))\nsns.distplot(average['percentage'], color='orange', bins=40)\nplt.title(\"The drugs mean distribution\", fontsize=15, weight='bold')\nplt.show()","dabbed85":"plt.figure(figsize=(7,7))\nplt.scatter(average_filtered['percentage'].sort_values(), average_filtered['drug'], color=sns.color_palette('Reds',22))\nplt.title('Drugs with higher presence in train samples', weight='bold', fontsize=15)\nplt.xticks(weight='bold')\nplt.yticks(weight='bold')\nplt.xlabel('Percentage', fontsize=13)\nplt.show()","ceb96842":"ploth(drugs_tr)","16b08387":"#Correlation between drugs\ncorre= drugs_tr.corr()\n#Unstack the dataframe\ns = corre.unstack()\nso = s.sort_values(kind=\"quicksort\", ascending=False)\n#Create new dataframe\nso2= pd.DataFrame(so).reset_index()\nso2= so2.rename(columns={0: 'correlation', 'level_0':'Drug 1', 'level_1': 'Drug2'})\n#Filter out the coef 1 correlation between the same drugs\nso2= so2[so2['correlation'] != 1]\n#Drop pair duplicates\nso2= so2.reset_index()\npos = [1,3,5,7,9]\nso2= so2.drop(so2.index[pos])\nso2= so2.round(decimals=4)\nso3=so2.head(4)\n#Show the first 10 high correlations\ncm = sns.light_palette(\"Red\", as_cmap=True)\ns = so2.head().style.background_gradient(cmap=cm)\ns","99af9fa5":"plt.figure(figsize=(8,10))\nthe_table =plt.table(cellText=so3.values,colWidths = [0.35]*len(so3.columns),\n          rowLabels=so3.index,\n          colLabels=so3.columns\n          ,cellLoc = 'center', rowLoc = 'center',\n          loc='left', edges='closed', bbox=(1,0, 1, 1)\n         ,rowColours=sns.color_palette('Reds',10))\nthe_table.auto_set_font_size(False)\nthe_table.set_fontsize(10.5)\nthe_table.scale(2, 2)\nplt.scatter(average_filtered['percentage'].sort_values(), average_filtered['drug'], color=sns.color_palette('Reds',22))\nplt.title('Drugs with higher presence in train samples', weight='bold', fontsize=15)\nplt.xlabel('Percentage', weight='bold')\nplt.xticks(weight='bold')\nplt.yticks(weight='bold')\nplt.axhline(y=13.5, color='black', linestyle='-')\nplt.axhline(y=18.5, color='black', linestyle='-')\nplt.show()","22ec1ba4":"#Correlation between drugs\ncorre= adt.corr()\n#Unstack the dataframe\ns = corre.unstack()\nso = s.sort_values(kind=\"quicksort\", ascending=False)\n#Create new dataframe\nso2= pd.DataFrame(so).reset_index()\nso2= so2.rename(columns={0: 'correlation', 'level_0':'Drug 1', 'level_1': 'Drug2'})\n#Filter out the coef 1 correlation between the same drugs\nso2= so2[so2['correlation'] != 1]\n#Drop pair duplicates\nso2= so2.reset_index()\npos = [1,3,5,7,9, 11,13,15,17,19,21,23, 25, 27, 29, 31,33,35, 37, 39, 41, 43, 45]\nso2= so2.drop(so2.index[pos])\n#so2= so2.round(decimals=4)\nso3=so2.head()\n#Show the first 10 high correlations\ncm = sns.light_palette(\"Red\", as_cmap=True)\ns = so2.head(16).style.background_gradient(cmap=cm)\ns","2ef3db95":"#High correlation adt 22 pairs\nadt15= so2.head(22)\n#Filter the drug names\nadt_1=adt15['Drug 1'].values.tolist()\nadt_2=adt15['Drug2'].values.tolist()\n#Join the 2 lists\nadt3= adt_1 + adt_2\n#Keep unique elements and drop duplicates\nadt4= list(dict.fromkeys(adt3))\n#Filter out the selected drugs from the \"all drugs treated\" adt dataset\nadt5= adt[adt4]","0b335561":"ploth(adt5)","83b95a02":"plt.style.use('seaborn')\nsns.set_style('whitegrid')\nfig = plt.figure(figsize=(15,5))\n#1 rows 2 cols\n#first row, first col\nax1 = plt.subplot2grid((1,2),(0,0))\nsns.countplot(x='cp_type', data=b, palette='rainbow')\nplt.title('Test: Control and treated samples', fontsize=15, weight='bold')\n#first row sec col\nax1 = plt.subplot2grid((1,2),(0,1))\nsns.countplot(x='cp_dose', data=b, palette='PiYG')\nplt.title('Test: Treatment Doses: Low and High',weight='bold', fontsize=18)\nplt.show()","14a6788d":"plt.figure(figsize=(15,5))\nsns.distplot( a['cp_time'], color='gold', bins=5)\nplt.title(\"Test: Treatment duration \", fontsize=15, weight='bold')\nplt.show()","e639c74d":"#Filter out just the treated samples\ntreated2= b[b['cp_type']=='trt_cp']\ntreated_list2 = treated2['sig_id'].to_list()\nfull_tr= b[b['sig_id'].isin(treated_list2)]\n\n#Select the columns c-\nc_cols2 = [col for col in full_tr.columns if 'g-' in col]\n#Filter the columns c-\ncells2=treated2[c_cols2]\n#Plot heatmap\nplt.figure(figsize=(15,6))\nsns.heatmap(cells2.corr(), cmap='coolwarm', alpha=0.9)\nplt.title('Test: Correlation gene expression', fontsize=15, weight='bold')\nplt.xticks(weight='bold')\nplt.yticks(weight='bold')\nplt.show()","4414e51c":"#Select the columns c-\nc_cols3 = [col for col in b.columns if 'c-' in col]\n#Filter the columns c-\ncells3=treated[c_cols3]\n#Plot heatmap\nplt.figure(figsize=(12,6))\nsns.heatmap(cells3.corr(), cmap='coolwarm', alpha=0.9)\nplt.title('Correlation: Cell viability', fontsize=15, weight='bold')\nplt.xticks(weight='bold')\nplt.yticks(weight='bold')\nplt.show()","bd27afcc":"* **We have both negative and positive correlations here between genes. Interesting!** *(The control samples were not included, so the negative correlation between some genes is not related to the control\/treated samples).*\n***\n# 4- Drugs *(Targets)*:\n***\n> ## 4-1 Scored targets:\n\nThis is a multi-label classification, we have 207 drugs and we have to find out the efficiency of these drugs on the cell lines, a single sample can be a target of many drugs, so we have to predict the mechanism of action of each drug.\n\n*We will filter the **train_targets_scored** dataset and keep just the treated rows (we discard the control rows because they are not treated with the drugs).*\n","186c0757":"* **Few control samples.**\n* **The low and high doses were applied equally.**\n* **3 treatment durations: 24h, 48h and 72h.**","b423038f":"This is just a first impression after checking multiple cell lines *(We need to check all the cell lines to draw conclusions).* It seems that the treated samples have higher cell viability than control sample.\n\n> **Next, let's see the impact of the treatment time on the cell viability.**","c0b26ef6":"*(work in progress)*\n\n> **Next let's see the correlation between cell viability features (in the treated samples, no control).**","5dfbbcaa":"Again, we have to check all the genes to draw conclusions, but after checking multiple genes, it seems that the samples treated with the compounds have higher gene expression levels.\n\n**Next, let's check the impact of the treatment time on the gene expression.**","0224b984":"# 1-Overview: Features","5fe0a0a4":"***How to interpret those values?***\n\nGene expression levels are calculated by the ratio between the expression of the target gene (i.e., the gene of interest) and the expression of one or more reference genes (often household genes). [3]\n\n> To understand this better, let's compare the samples treated with the drugs and the control samples.","b09991e0":"* It seems we have 2 outliers here: **Tubulin_inhibitor** and **sodium_channel_inhibitor.** Next, let's check the correlation between the drugs\n***\n### Correlation between drugs:","43723014":"### [WORK IN PROGRESS]\n\n***\n# References:\n\n[1] Viability assay https:\/\/en.wikipedia.org\/wiki\/Viability_assay\n\n[2] COVID-19 viral proteins identification https:\/\/www.kaggle.com\/amiiiney\/covid-19-proteins-identification-with-biopython\n\n[3] Gene expression level https:\/\/www.sciencedirect.com\/topics\/biochemistry-genetics-and-molecular-biology\/gene-expression-level","9e6dfa8c":"**First glimpse: 876 features with:**\n* Features g- signify gene expression data.\n* c- signify cell viability data.\n* cp_type indicates samples treated with a compound.\n* (cp_vehicle) or with a control perturbation (ctrl_vehicle); control perturbations have no MoAs.\n* cp_time and cp_dose indicate treatment duration (24, 48, 72 hours) and dose (high or low).","4ae92433":"# 2- `c-` Features are related to cell viability. What is cell viability? \n\nA viability assay is an assay that is created to determine the ability of organs, cells or tissues to maintain or recover a state of survival. Viability can be distinguished from the all-or-nothing states of life and death by the use of a quantifiable index that ranges between the integers of 0 and 1 or, if more easily understood, the range of 0% and 100%. Viability can be observed through the physical properties of cells, tissues, and organs. Some of these include mechanical activity, motility, such as with spermatozoa and granulocytes, the contraction of muscle tissue or cells, mitotic activity in cellular functions, and more. Viability assays provide a more precise basis for measurement of an organism's level of vitality.[1]","cfe715b8":"* All the drugs are present in at least one sample.\n* The presence of the drugs is very low in the samples (Mostly less than 0.5%).\n* Some drugs *(outliers)* have a higher presence in comparison with the rest of drugs with a percentage in the range (1.5%, 3.5%).\n\n> **Let's have a look over some of these drugs**","bf9c2e3a":"\n***\n\n\n\n# 3- `g-` features are related to gene expression. What is gene expression?\n\nGene expression is the process by which information from a gene is used in the synthesis of a functional gene product. These products are often proteins. You can refer to my notebook [COVID_19: Viral proteins identification](https:\/\/www.kaggle.com\/amiiiney\/covid-19-proteins-identification-with-biopython) to understand more how gene expression works.\n\nIn short, the mechanism of action of the 207 drugs in this study will activate some genes, gene expression will take place and byproducts (proteins) will be synthesized.","095f57b4":"We can see several high positive and negative correlations between some genes, same as in the train set. However more investigation is needed to find some patterns and differences in gene expression in the test set.\n\n> ## 5-3 Cell viability:","0f489d7e":"***First observation in this EDA:***\n\nAs mentioned in the definition, cell viability should range between the integers 0 and 1. Here, we have values in the range -10 and 6. I need to investigate more and learn if those are just failed experiments or if those numbers are due to a different method used in this study. *(I will update this section in the future).*\n\nAnyways, let's see the difference between the cell viability in a control and treated sample.","2a4d3046":"*(work in progress)*\n\n> **Next, let's see the correlation between gene expression features. (in the treated samples, no control)**","a3316c7f":"**Great!** This nonscored dataset seems promising. \n\nIf in the `scored_target` dataset we had just 4 drug pairs with +0.7 correlation, by merging both datasets we have more than 15 drug pairs highly correlated.\n\n### Heatmap of the 31 drugs with high correlation","bf3cf037":"Most of the drugs have 0 correlation. It is worth recalling that the presence of active drugs in the samples in very low (mainly 1 or 2 drugs per sample).\n\nHowever, we notice some yellow dots *(high correlation)* between some drugs. Let's have a closer look over those drugs.\n\n#### Drugs with the highest MoA correlation","47dbb150":"**Interesting!** Even though this is just a visual representation of the table above, here we can clearly see that many drugs from the `scored_target` dataset have high correlation with several drugs from the `nonscored_targets`.\n***\n\n# 5- Test set:\nAfter understanding the relationship between the features and the labels, we move on to the test test to understand the features and their relationship with the train features.\n> ## 5-1 Features:","7df75b8e":"* **Observations:**\n\n>1. **Two drug pairs** have +0.9 correlation and are highly presented in the samples (within the black boudaries).\n2.  **Kit_inhibtor** is highly correlated with 2 drugs: **pdgfr_inhibitor and flt3_inhibitor**.\n3. flt3_inhibitor has slightly less presence in the samples than the other highly correlated drugs.\n4. The *outliers* **sodium_channel_inhibitor and tubulin_inhibitor** are highly present in the samples but have low correlation with the rest of drugs. *(This needs further investigation)*\n\nThe samples having +2 active drugs most probably include those 4 drug pairs.\n***\n> ## 4-2 Nonscored targets:\n\nIn this section, we will have a look over the dataset provided that will not be used in the score. This dataset has 402 drugs *(more than the 206 drugs in the targets_scored dataset that will be used in the score).* \n\nLet's first merge both scored and nonscored targets datasets and try to find patterns and and relationships between the drugs in both datasets. ","885a9d26":"> Read the datasets","8fdabf9f":"Again, the frist impression is that all the cell viability features have high correlation, same as in the train set. With some specific cell types having low correlation than others *(c-24, c-22, c-73, c-73...).","c60073e7":"* **Many high correlations between c- features. This is something to be taken into consideration in feature engineering.**","c347f61a":"> Helper functions","7de13d33":"Everything seems similar to the train set:\n* The doses are equally applied.\n* Very few control samples.\n* Same treatment duration 24h, 48h and 72h.\n\n**Good news!** It seems that both train and test datasets are similar in terms of *experiments conditions.* The variation would be in the gene expression and cell viability since the samples used in the test set are different than the train set.\n\nLet's see how different are those samples!\n\n> ## 5-2 Gene expression:","e7f1bbb9":"# Mechanisms of Action (MoA) Prediction: EDA","f8d67b4e":"* **2 drug-pairs have +0.9 correlation:** \n\nThose drug pairs must be in the few samples that have more than two active drugs. The functionality of these drugs and their distribution is something to be taken into consideration because in this case, we have **a multi-label classification problem**, where the correlation between the labels is also important and the model selection should be based on the labels correlation. Select a model that finds patterns not just in the train data but also in the **multi-label target data.**\n\nBelow, we will try to connect the dots and try to match the high correlated drugs with the drugs with the most presence in the samples."}}