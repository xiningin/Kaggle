{"cell_type":{"ba72a178":"code","8568fe7d":"code","031f3cd9":"code","44a0ce9b":"code","913d8b4f":"code","7060bced":"code","173a5e7e":"code","cd72e57e":"code","6c888aeb":"code","75c14e6c":"markdown","48585eb2":"markdown","1b380a38":"markdown","55740694":"markdown"},"source":{"ba72a178":"import numpy as np\nimport pandas as pd\n\nimport tensorflow as tf\nimport matplotlib.pyplot as plt\nfrom sklearn.utils import shuffle\nfrom IPython.display import clear_output\n\nfrom sklearn.model_selection import train_test_split","8568fe7d":"path = '..\/input\/sofia-air-quality-dataset\/2017-07_bme280sof.csv'\ndf = pd.read_csv(path)\ndf = df[['pressure','temperature','humidity']]\ndf.head()","031f3cd9":"df_idx = pd.DataFrame({'idx':np.arange(len(df))})\ndf = pd.concat([df, df_idx], axis=1)\ndf.head()","44a0ce9b":"# use the humidity as labels\n# low humidity < 30\n# middle humidity > 30, < 70\n# highi humidity > 70\n\nlow_index = df[df['humidity'] <= 30].index\nmid_index = df[(df['humidity'] > 30)&(df['humidity'] < 70)].index\nhigh_index = df[df['humidity'] >= 70].index","913d8b4f":"df.loc[low_index, 'humidity'] = 0\ndf.loc[mid_index, 'humidity'] = 1\ndf.loc[high_index, 'humidity'] = 2\ndf['humidity'] = df['humidity'].astype(int)\n\ndf_orig = df.copy()\nmax_len = len(df)\n\nindexes = []\nresults = []\nfirst = True\n\ndf = df.sample(frac=0.05)\ndf_train, df_test = train_test_split(df, test_size=0.3, shuffle=True, random_state=42)","7060bced":"while(len(indexes) < max_len):\n    \n    # split the train and test depending on the indexes\n    if(first == False):\n        if(len(indexes) > 0):\n            df_temp = df_test[df_test['idx'].isin(indexes)]\n            df = pd.concat([df, df_temp])\n        else:\n            df = df_orig.sample(frac=0.01)\n        \n    df_temp_test = df_orig[~df_orig.idx.isin(indexes)].sample(frac=0.1)\n    df = pd.concat([df, df_temp_test])\n    \n    df_train, df_test = train_test_split(df, test_size=0.1, shuffle=True, random_state=42)\n    \n    NUM_EXAMPLES = len(df_train)\n\n    def make_input_fn(X, y, n_epochs=None, shuffle=True):\n        def input_fn():\n            dataset = tf.data.Dataset.from_tensor_slices((dict(X), y))\n            if shuffle:\n                dataset = dataset.shuffle(NUM_EXAMPLES)\n            # For training, cycle thru dataset as many times as need (n_epochs=None).\n            dataset = dataset.repeat(n_epochs)\n            # In memory training doesn't use batching.\n            dataset = dataset.batch(NUM_EXAMPLES)\n            return dataset\n        return input_fn\n\n    # Training and evaluation input functions.\n    train_input_fn = make_input_fn(df_train, df_train['humidity'])\n    eval_input_fn = make_input_fn(df_test, df_test['humidity'], shuffle=False, n_epochs=1)\n    \n    \n    if(first == True):\n        NUMERIC_COLUMNS = ['pressure', 'temperature']\n\n        feature_columns = []\n        for feature_name in NUMERIC_COLUMNS:\n            feature_columns.append(tf.feature_column.numeric_column(feature_name,\n                                                   dtype=tf.float32))\n\n        est = tf.estimator.BoostedTreesClassifier(feature_columns,\n                                                  n_classes=3,\n                                                  n_batches_per_layer=8)\n    \n    # train boost tree\n    est.train(train_input_fn, max_steps=300)\n    \n    # get results and predictions\n    result = est.evaluate(eval_input_fn)\n    predictor = est.predict(eval_input_fn)\n\n    # list of indexes\n    index_arr = list(df_test.index)\n\n    for i, pred in enumerate(predictor):\n        if(pred['probabilities'].max() > 0.95):\n            indexes.append(index_arr[i])\n            \n    clear_output(wait=True)\n    print('nr_index:{:}'\n          .format(len(indexes)))\n    print(pd.Series(result))\n    results.append(result)\n            \n    first = False","173a5e7e":"accs, losses = [], []\nfor result in results:\n    accs.append(result['accuracy'])\n    losses.append(result['average_loss'])","cd72e57e":"plt.figure(figsize=(14,8))\nplt.title('Accuracies')\nplt.plot(accs)","6c888aeb":"plt.figure(figsize=(14,8))\nplt.title('Losses')\nplt.plot(losses)","75c14e6c":"<h1 id=\"dataset\" style=\"color:#549f98; background:#e3ebeb; border:0.5px dotted;\"> \n    <center>Dataset\n        <a class=\"anchor-link\" href=\"#dataset\" target=\"_self\">\u00b6<\/a>\n    <\/center>\n<\/h1>","48585eb2":"<h1 id=\"implementation\" style=\"color:#549f98; background:#e3ebeb; border:0.5px dotted;\"> \n    <center>Implementation\n        <a class=\"anchor-link\" href=\"#implementation\" target=\"_self\">\u00b6<\/a>\n    <\/center>\n<\/h1>","1b380a38":"<h1 id=\"analysis\" style=\"color:#549f98; background:#e3ebeb; border:0.5px dotted;\"> \n    <center>Analysis\n        <a class=\"anchor-link\" href=\"#analysis\" target=\"_self\">\u00b6<\/a>\n    <\/center>\n<\/h1>","55740694":"<div>\n    <img src='https:\/\/storage.googleapis.com\/kaggle-datasets-images\/340483\/674955\/c74e20b41b2cdacf6915881df995a5d8\/dataset-cover.png'\/>\n<\/div>"}}