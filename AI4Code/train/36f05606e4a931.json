{"cell_type":{"bcacf7e6":"code","7406b151":"code","ec6c803c":"code","5b69a170":"code","6e0bad8d":"code","4f8c9d3e":"markdown","904a0e6c":"markdown","e5935326":"markdown","0c5d013d":"markdown","739a419a":"markdown"},"source":{"bcacf7e6":"# !pip install nb_black\n# %load_ext nb_black\nimport numpy as np\nimport pandas as pd\nimport plotly.express as px\nimport plotly.io as pio\nfrom IPython.core.display import display, HTML\nimport pickle\nimport itertools\nfrom tqdm.auto import trange\npio.templates.default = \"plotly_white\"","7406b151":"with open(\"..\/input\/ashrae-data-wrangling-train\/train.pickle\", \"rb\") as f:\n    train = pickle.load(f)","ec6c803c":"correlation = pd.DataFrame(columns={\"building_id\", \"energy_aspects\", \"correlation\"})\n\nfor building_id in trange(0, 1449):\n    energy = train[train[\"building_id\"] == str(building_id)]\n    energy_aspects = energy[\"meter\"].unique().to_list()\n    if len(energy_aspects) > 1:\n        for combination in itertools.combinations(energy_aspects, 2):\n            ea0 = energy[energy[\"meter\"] == combination[0]][\"meter_reading\"]\n            ea1 = energy[energy[\"meter\"] == combination[1]][\"meter_reading\"]\n            corr = np.ma.corrcoef(np.ma.masked_invalid(ea0), np.ma.masked_invalid(ea1))[\n                0, 1\n            ]\n            correlation = correlation.append(\n                {\n                    \"building_id\": building_id,\n                    \"energy_aspects\": \"-\".join(combination),\n                    \"correlation\": corr,\n                },\n                ignore_index=True,\n            )\n\ncorrelation.to_csv('correlation.csv')\ndisplay(correlation)\ndisplay(HTML(f'There are {correlation.shape[0]} combinations between energy aspects for the buildings with more than one energy aspect.'))","5b69a170":"fig = px.histogram(\n    correlation,\n    x=\"correlation\",\n    color=\"energy_aspects\",\n    facet_row=\"energy_aspects\",\n    nbins=50,\n    height=1200,\n)\nfig.update_layout(showlegend=False, xaxis=dict(range=[-1, 1], dtick = 0.2))\nfor i in range(0, 6):\n    fig.layout.annotations[i].text = fig.layout.annotations[i].text.replace(\n        \"energy_aspects=\", \"\"\n    )\nfig.show()","6e0bad8d":"correlation[abs(correlation[\"correlation\"]) > 0.80].sort_values(\n    by=\"correlation\", ascending=False\n)","4f8c9d3e":"Some positive correlation is seen in the combination between electricity and chilled water. Maybe the electricity and the chilled water are consumed at the same time, or the chilled water are produced with electricity and its counted double?.\n\nElectricity and hotwater doesn't seem correlated.\n\nChilled water with hot water and with steam have some light negative correlation. When one is consumed, the other not. ","904a0e6c":"# Import data","e5935326":"# Get all the correlations between energy aspects","0c5d013d":"# Introduction\n\nThe aim on this notebook is to find out if there is some correlation between energy aspects, as stated in [this post](https:\/\/www.kaggle.com\/c\/ashrae-energy-prediction\/discussion\/116748).\n\nWhat can be suposed is that different energy aspects (electricity, hot water, chilled water and steam) measure different energy sources.\nIn instance, for hot water is used natural gas.\n\nCould be that the building use electricity for heat the water, and the same energy is measured twice? One as electricity and other as hotwater?\n\nIt is supposed to be some correlation, because when there are people in the building, they consume electricity and also hotwater, chilled water and steam. When the building has no activity, the consumption decreases for all energy aspects.","739a419a":"There are some buildings with high correlated energy aspects.\n\nIn building 1156, the electricity consumption is very constant where there isn't chilled water. And when there is, the electricity consumption is proportional to chilled water. Can be deduced, that in this building, the chilled water is produced with electricity, and both are measured.\n\n![](https:\/\/www.googleapis.com\/download\/storage\/v1\/b\/kaggle-user-content\/o\/inbox%2F645169%2F8108b9b321ec5be9357090438f95bfaf%2Fbuilding_id-1156-site_id-13-Lodging-residential-electricity-chilledwater-steam.png?generation=1573593723628143&alt=media)\n\nThe same happens with building 1031, 1164, 1201, 1151. All of them are lodging residential type."}}