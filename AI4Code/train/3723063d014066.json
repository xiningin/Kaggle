{"cell_type":{"cb1afc56":"code","51265a06":"code","e91578d6":"code","a287bf38":"code","fab1795d":"code","1e918808":"code","fbf05fad":"code","01e52dca":"code","3f6572c4":"code","c2014fcb":"code","8a264d54":"code","509e2aa6":"code","e6606a21":"markdown","dd544141":"markdown","3beea9b0":"markdown","2ab91861":"markdown","c7a7d642":"markdown","a0d14dcf":"markdown"},"source":{"cb1afc56":"import pandas as pd\nimport numpy as np\nimport os \nimport gc \nfrom PIL import Image\n\n\nfrom tensorflow.keras.models import load_model\nfrom keras.preprocessing.image import load_img,img_to_array\n\nfrom tensorflow_addons.metrics import F1Score","51265a06":"test_dir='..\/input\/plant-pathology-2021-fgvc8\/test_images'\n\nimg_size=(256,256)","e91578d6":"sample_sub=pd.read_csv('..\/input\/plant-pathology-2021-fgvc8\/sample_submission.csv')\nsample_sub","a287bf38":"f1_score=F1Score(num_classes=6,average='macro',name='f1_score')","fab1795d":"def load_images(test_path,image):\n    '''load image from given path'''\n    img=load_img(test_path +'\/' + image)\n    img=img.resize(img_size)\n    img=img_to_array(img)\n    img=np.expand_dims(img,axis=0)\n    img=img\/255\n    \n    return img","1e918808":"label_classes=['complex', 'frog_eye_leaf_spot', 'healthy', 'powdery_mildew', 'rust', 'scab']","fbf05fad":"# loading pretrained models\nmodel1=load_model('..\/input\/plant-pathology-apple-leaf-diseases\/model_0.h5')\nmodel2=load_model('..\/input\/plant-pathology-apple-leaf-diseases\/model_1.h5')\nmodel3=load_model('..\/input\/plant-pathology-apple-leaf-diseases\/model_2.h5')","01e52dca":"def get_label(prediction_prob,thresh=0.3):\n    '''get label for a class that satisfies given threshold'''\n    \n    prediction_prob=prediction_prob[0]\n    prediction_prob=list(prediction_prob)\n    labels=[label_classes[x] for x,prob in enumerate(prediction_prob) if prob >=thresh]\n    \n    labels=' '.join(labels)\n    \n    return labels","3f6572c4":"def predict(test_path,threshold):\n    '''predict on test set, using given threshold'''\n    \n    images,labels=[],[]\n    \n    for image in os.listdir(test_path):\n        \n        #loading images         \n        img=load_images(test_path,image)\n        \n        #mean prediction from 3 models\n        pred_prob=(1\/3* model1.predict(img)) + (1\/3* model2.predict(img)) + (1\/3* model3.predict(img))\n        \n        #getting prediction\n        preds=get_label(pred_prob,thresh=threshold)\n        \n        #saving image name and predicted label\n        images.append(image)\n        labels.append(preds)\n        \n    return images,labels\n        \n","c2014fcb":"#predicting using above func\nimage_ids,labels=predict(test_dir,threshold=0.2)","8a264d54":"#submission file:\nsubmission_file=pd.DataFrame({'image':image_ids,'labels':labels})\n\n#saving submissions\nsubmission_file.to_csv('submission.csv',index=False)","509e2aa6":"submission_file","e6606a21":"**Link to Training Notebook** [ https:\/\/www.kaggle.com\/virajkadam\/plant-pathology-apple-leaf-diseases ]","dd544141":"# Imports","3beea9b0":"**test Directory**","2ab91861":"# Loading pre-trained models (on folds)","c7a7d642":"**metric**","a0d14dcf":"# **Load Image**"}}