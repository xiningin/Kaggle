{"cell_type":{"723e7fbf":"code","dae0fdc6":"code","e7cc5e9f":"code","805dd702":"code","ba02a22d":"code","ff5cbc68":"code","8e76421b":"code","becea546":"code","5106bbac":"code","5c84b6e3":"code","923788cb":"code","49a9c5dc":"code","4edffcbb":"code","c2c66fd3":"code","b7dbd71a":"code","4db80c2a":"code","e51a23bb":"code","b5214573":"code","43543817":"code","e6b23664":"code","47e597e3":"code","18d6626a":"code","16f2c315":"code","1e21eb30":"code","213f9098":"code","c54671a6":"code","cf74a6d4":"code","5888b51c":"code","ff545f43":"code","81d35745":"code","873fb59c":"code","9ce398e3":"code","b7174717":"code","6a556511":"code","55fa6456":"code","cccf6cd1":"code","5b609aef":"code","44666d13":"code","ae179f6f":"code","5ee5075d":"code","48a900c2":"code","783ac752":"code","bcd46275":"code","9243cf5d":"code","1cd70d44":"code","066f602c":"code","39f83b19":"code","371c6645":"code","da8eae02":"code","673d32f5":"code","d1e77ca0":"code","35593e71":"code","a3afe685":"code","b63a41fe":"code","f6449e54":"code","6733cf6a":"code","9605c897":"code","b9d00e3b":"code","bf5fcd3d":"code","24c18c16":"code","a8490403":"code","ae11df03":"code","2e666236":"code","d193c7f6":"code","5f67ce66":"code","cc1b37ca":"code","80ea0611":"code","ec008d18":"code","1a7416b8":"code","18aa42de":"code","2c4fa3f9":"code","b2d5bd5e":"code","0658d449":"code","38a450ed":"code","71b52ecb":"code","34122f93":"code","f59aceeb":"code","b0680c31":"code","535bded8":"code","d600268b":"code","ef04f7f1":"code","40c46d09":"code","1929b50e":"code","8f13adf0":"code","2132abea":"code","cc6a9459":"code","546cfc84":"code","0ec5ebaf":"code","761ac64a":"code","ad0012e3":"code","5ffc6e7e":"code","6176b136":"code","05475f26":"code","0fd9e8de":"code","0025aaf3":"code","8bc370ce":"code","41533fe2":"code","c6222a14":"code","9149368e":"code","038916ab":"code","64aa534a":"code","e2466946":"code","98010983":"markdown","51385c40":"markdown","f25e493d":"markdown","ad567705":"markdown","dc9e4244":"markdown","9c6ecc15":"markdown","b4104a0f":"markdown","6c42bdb7":"markdown","3a1eb2b1":"markdown","2c627de4":"markdown","281045dd":"markdown","e17f4863":"markdown","d18ecbcd":"markdown","cc9f799e":"markdown","5024fe1b":"markdown","71096836":"markdown","1a92bf06":"markdown","3af5be58":"markdown","5a02eed3":"markdown","e825b95a":"markdown","df80442f":"markdown","35cdce73":"markdown","f560a0ed":"markdown","cfce8207":"markdown","cfd13e29":"markdown","a2fc8d08":"markdown","24199a89":"markdown","9e45703c":"markdown","ffe44daa":"markdown","5e292c49":"markdown","73aff8ab":"markdown","439f6810":"markdown","906c27dc":"markdown","9887b7c8":"markdown","38e44183":"markdown","93ba85c9":"markdown","679ff6f0":"markdown","d0790460":"markdown","addf7870":"markdown","55bd89f8":"markdown","9854d089":"markdown","92386abd":"markdown","c3612906":"markdown","816ec14f":"markdown","50e12534":"markdown","756d4683":"markdown","42438762":"markdown","e1d991c9":"markdown","4abf72a3":"markdown","ab033c04":"markdown","c94e12ce":"markdown","39c6c0c7":"markdown","72069cb7":"markdown","fb758b6e":"markdown","0f18e3da":"markdown","8db82ebc":"markdown","58158d3b":"markdown","46595df5":"markdown","00cf1983":"markdown","8ec9562c":"markdown","6b25b491":"markdown","e7a93fa4":"markdown","2fa2542a":"markdown","ee60d9e9":"markdown","1405421a":"markdown","27cbc26b":"markdown","9d7b20fd":"markdown","ad0354ec":"markdown","acbc8379":"markdown","f7c39267":"markdown","2b20a895":"markdown","56c0864c":"markdown","6401c4d0":"markdown","5f54ced9":"markdown","ff20fa47":"markdown","e965a5c9":"markdown","b70a20db":"markdown","89925ce2":"markdown"},"source":{"723e7fbf":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline\nsns.set()\n\n# plotly library\nimport plotly.graph_objs as go\nfrom plotly import tools\nfrom plotly.offline import init_notebook_mode, iplot\ninit_notebook_mode(connected=True)\n\n\nimport warnings\nwarnings.filterwarnings(\"ignore\", category=DeprecationWarning)\nwarnings.filterwarnings(\"ignore\", category=FutureWarning)\n#warnings.filterwarnings(\"ignore\")\n#warnings.filterwarnings(module='sklearn*', action='ignore', category=DeprecationWarning)\n#warnings.filterwarnings(action='once')\n\nfrom sklearn.utils.testing import ignore_warnings\n\nfrom subprocess import check_output\nprint(check_output([\"ls\", \"..\/input\"]).decode(\"utf8\"))","dae0fdc6":"def warn(*args, **kwargs):\n    pass\nimport warnings\nwarnings.warn = warn","e7cc5e9f":"def get_best_score(model):\n    \n    print(model.best_score_)    \n    print(model.best_params_)\n    print(model.best_estimator_)\n    \n    return model.best_score_\n\n\ndef plot_feature_importances(model, columns):\n    nr_f = 10\n    imp = pd.Series(data = model.best_estimator_.feature_importances_, \n                    index=columns).sort_values(ascending=False)\n    plt.figure(figsize=(7,5))\n    plt.title(\"Feature importance\")\n    ax = sns.barplot(y=imp.index[:nr_f], x=imp.values[:nr_f], orient='h')","805dd702":"df_train = pd.read_csv(\"..\/input\/train.csv\")\ndf_test = pd.read_csv(\"..\/input\/test.csv\")","ba02a22d":"df_train.head()","ff5cbc68":"df_test.head()","8e76421b":"df_train.info()","becea546":"df_test.info()","5106bbac":"fig, ax = plt.subplots(figsize=(9,5))\nsns.heatmap(df_train.isnull(), cbar=False, cmap=\"YlGnBu_r\")\nplt.show()","5c84b6e3":"fig, ax = plt.subplots(figsize=(9,5))\nsns.heatmap(df_test.isnull(), cbar=False, cmap=\"YlGnBu_r\")\nplt.show()","923788cb":"cols = ['Survived', 'Sex', 'Pclass', 'SibSp', 'Parch', 'Embarked']","49a9c5dc":"nr_rows = 2\nnr_cols = 3\n\nfig, axs = plt.subplots(nr_rows, nr_cols, figsize=(nr_cols*3.5,nr_rows*3))\n\nfor r in range(0,nr_rows):\n    for c in range(0,nr_cols):  \n        \n        i = r*nr_cols+c       \n        ax = axs[r][c]\n        sns.countplot(df_train[cols[i]], hue=df_train[\"Survived\"], ax=ax)\n        ax.set_title(cols[i], fontsize=14, fontweight='bold')\n        ax.legend(title=\"survived\", loc='upper center') \n        \nplt.tight_layout()   ","4edffcbb":"bins = np.arange(0, 80, 5)\ng = sns.FacetGrid(df_train, row='Sex', col='Pclass', hue='Survived', margin_titles=True, size=3, aspect=1.1)\ng.map(sns.distplot, 'Age', kde=False, bins=bins, hist_kws=dict(alpha=0.6))\ng.add_legend()  \nplt.show()  ","c2c66fd3":"df_train['Fare'].max()","b7dbd71a":"bins = np.arange(0, 550, 50)\ng = sns.FacetGrid(df_train, row='Sex', col='Pclass', hue='Survived', margin_titles=True, size=3, aspect=1.1)\ng.map(sns.distplot, 'Fare', kde=False, bins=bins, hist_kws=dict(alpha=0.6))\ng.add_legend()  \nplt.show()  ","4db80c2a":"sns.barplot(x='Pclass', y='Survived', data=df_train)\nplt.ylabel(\"Survival Rate\")\nplt.title(\"Survival as function of Pclass\")\nplt.show()","e51a23bb":"sns.barplot(x='Sex', y='Survived', hue='Pclass', data=df_train)\nplt.ylabel(\"Survival Rate\")\nplt.title(\"Survival as function of Pclass and Sex\")\nplt.show()","b5214573":"sns.barplot(x='Embarked', y='Survived', data=df_train)\nplt.ylabel(\"Survival Rate\")\nplt.title(\"Survival as function of Embarked Port\")\nplt.show()","43543817":"sns.barplot(x='Embarked', y='Survived', hue='Pclass', data=df_train)\nplt.ylabel(\"Survival Rate\")\nplt.title(\"Survival as function of Embarked Port\")\nplt.show()","e6b23664":"sns.countplot(x='Embarked', hue='Pclass', data=df_train)\nplt.title(\"Count of Passengers as function of Embarked Port\")\nplt.show()","47e597e3":"sns.boxplot(x='Embarked', y='Age', data=df_train)\nplt.title(\"Age distribution as function of Embarked Port\")\nplt.show()","18d6626a":"sns.boxplot(x='Embarked', y='Fare', data=df_train)\nplt.title(\"Fare distribution as function of Embarked Port\")\nplt.show()","16f2c315":"cm_surv = [\"darkgrey\" , \"lightgreen\"]","1e21eb30":"fig, ax = plt.subplots(figsize=(13,7))\nsns.swarmplot(x='Pclass', y='Age', hue='Survived', split=True, data=df_train , palette=cm_surv, size=7, ax=ax)\nplt.title('Survivals for Age and Pclass ')\nplt.show()","213f9098":"fig, ax = plt.subplots(figsize=(13,7))\nsns.violinplot(x=\"Pclass\", y=\"Age\", hue='Survived', data=df_train, split=True, bw=0.05 , palette=cm_surv, ax=ax)\nplt.title('Survivals for Age and Pclass ')\nplt.show()","c54671a6":"g = sns.factorplot(x=\"Pclass\", y=\"Age\", hue=\"Survived\", col=\"Sex\", data=df_train, kind=\"swarm\", split=True, palette=cm_surv, size=7, aspect=.9, s=7)","cf74a6d4":"g = sns.factorplot(x=\"Pclass\", y=\"Age\", hue=\"Survived\", col=\"Sex\", data=df_train, kind=\"violin\", split=True, bw=0.05, palette=cm_surv, size=7, aspect=.9, s=7)","5888b51c":"for df in [df_train, df_test] :\n    \n    df['FamilySize'] = df['SibSp'] + df['Parch'] +1\n    \n    df['Alone']=0\n    df.loc[(df.FamilySize==1),'Alone'] = 1\n    \n    df['NameLen'] = df.Name.apply(lambda x : len(x)) \n    df['NameLenBin']=np.nan\n    for i in range(20,0,-1):\n        df.loc[ df['NameLen'] <= i*5, 'NameLenBin'] = i\n    \n    \n    df['Title']=0\n    df['Title']=df.Name.str.extract(r'([A-Za-z]+)\\.') #lets extract the Salutations\n    df['Title'].replace(['Mlle','Mme','Ms','Dr','Major','Lady','Countess','Jonkheer','Col','Rev','Capt','Sir','Don'],\n                    ['Miss','Miss','Miss','Mr','Mr','Mrs','Mrs','Other','Other','Other','Mr','Mr','Mr'],inplace=True)","ff545f43":"print(df_train[['NameLen' , 'NameLenBin']].head(10))","81d35745":"grps_namelenbin_survrate = df_train.groupby(['NameLenBin'])['Survived'].mean().to_frame()\ngrps_namelenbin_survrate","873fb59c":"plt.subplots(figsize=(10,6))\nsns.barplot(x='NameLenBin' , y='Survived' , data = df_train)\nplt.ylabel(\"Survival Rate\")\nplt.title(\"Survival as function of NameLenBin\")\nplt.show()","9ce398e3":"fig, ax = plt.subplots(figsize=(9,7))\nsns.violinplot(x=\"NameLenBin\", y=\"Pclass\", data=df_train, hue='Survived', split=True, \n               orient=\"h\", bw=0.2 , palette=cm_surv, ax=ax)\nplt.show()","b7174717":"g = sns.factorplot(x=\"NameLenBin\", y=\"Survived\", col=\"Sex\", data=df_train, kind=\"bar\", size=5, aspect=1.2)","6a556511":"grps_title_survrate = df_train.groupby(['Title'])['Survived'].mean().to_frame()\ngrps_title_survrate","55fa6456":"plt.subplots(figsize=(10,6))\nsns.barplot(x='Title' , y='Survived' , data = df_train)\nplt.ylabel(\"Survival Rate\")\nplt.title(\"Survival as function of Title\")\nplt.show()","cccf6cd1":"pd.crosstab(df_train.FamilySize,df_train.Survived).apply(lambda r: r\/r.sum(), axis=1).style.background_gradient(cmap='summer_r')","5b609aef":"plt.subplots(figsize=(10,6))\nsns.barplot(x='FamilySize' , y='Survived' , data = df_train)\nplt.ylabel(\"Survival Rate\")\nplt.title(\"Survival as function of FamilySize\")\nplt.show()","44666d13":"for df in [df_train, df_test]:\n\n    # Title\n    df['Title'] = df['Title'].fillna(df['Title'].mode().iloc[0])\n\n    # Age: use Title to fill missing values\n    df.loc[(df.Age.isnull())&(df.Title=='Mr'),'Age']= df.Age[df.Title==\"Mr\"].mean()\n    df.loc[(df.Age.isnull())&(df.Title=='Mrs'),'Age']= df.Age[df.Title==\"Mrs\"].mean()\n    df.loc[(df.Age.isnull())&(df.Title=='Master'),'Age']= df.Age[df.Title==\"Master\"].mean()\n    df.loc[(df.Age.isnull())&(df.Title=='Miss'),'Age']= df.Age[df.Title==\"Miss\"].mean()\n    df.loc[(df.Age.isnull())&(df.Title=='Other'),'Age']= df.Age[df.Title==\"Other\"].mean()\n    df = df.drop('Name', axis=1)\n\n\n","ae179f6f":"# Embarked\ndf_train['Embarked'] = df_train['Embarked'].fillna(df_train['Embarked'].mode().iloc[0])\ndf_test['Embarked'] = df_test['Embarked'].fillna(df_test['Embarked'].mode().iloc[0])\n\n# Fare\ndf_train['Fare'] = df_train['Fare'].fillna(df_train['Fare'].mean())\ndf_test['Fare'] = df_test['Fare'].fillna(df_test['Fare'].mean())","5ee5075d":"for df in [df_train, df_test]:\n    \n    df['Age_bin']=np.nan\n    for i in range(8,0,-1):\n        df.loc[ df['Age'] <= i*10, 'Age_bin'] = i\n        \n    df['Fare_bin']=np.nan\n    for i in range(12,0,-1):\n        df.loc[ df['Fare'] <= i*50, 'Fare_bin'] = i        \n    \n    # convert Title to numerical\n    df['Title'] = df['Title'].map( {'Other':0, 'Mr': 1, 'Master':2, 'Miss': 3, 'Mrs': 4 } )\n    # fill na with maximum frequency mode\n    df['Title'] = df['Title'].fillna(df['Title'].mode().iloc[0])\n    df['Title'] = df['Title'].astype(int)        ","48a900c2":"df_train_ml = df_train.copy()\ndf_test_ml = df_test.copy()\n\npassenger_id = df_test_ml['PassengerId']","783ac752":"df_train_ml.info()","bcd46275":"df_test_ml.info()","9243cf5d":"df_train_ml = pd.get_dummies(df_train_ml, columns=['Sex', 'Embarked', 'Pclass'], drop_first=True)\ndf_test_ml = pd.get_dummies(df_test_ml, columns=['Sex', 'Embarked', 'Pclass'], drop_first=True)\n\ndf_train_ml.drop(['PassengerId','Name','Ticket', 'Cabin', 'Age', 'Fare_bin'],axis=1,inplace=True)\ndf_test_ml.drop(['PassengerId','Name','Ticket', 'Cabin', 'Age', 'Fare_bin'],axis=1,inplace=True)\n\n#df_train_ml.drop(['PassengerId','Name','Ticket', 'Cabin', 'Age_bin', 'Fare_bin'],axis=1,inplace=True)\n#df_test_ml.drop(['PassengerId','Name','Ticket', 'Cabin', 'Age_bin', 'Fare_bin'],axis=1,inplace=True)\n","1cd70d44":"df_train_ml.dropna(inplace=True)","066f602c":"for df in [df_train_ml, df_test_ml]:\n    df.drop(['NameLen'], axis=1, inplace=True)\n\n    df.drop(['SibSp'], axis=1, inplace=True)\n    df.drop(['Parch'], axis=1, inplace=True)\n    df.drop(['Alone'], axis=1, inplace=True)","39f83b19":"df_train_ml.head()","371c6645":"df_test_ml.fillna(df_test_ml.mean(), inplace=True)\ndf_test_ml.head()","da8eae02":"from sklearn.preprocessing import StandardScaler\nscaler = StandardScaler()\n\n# for df_train_ml\nscaler.fit(df_train_ml.drop(['Survived'],axis=1))\nscaled_features = scaler.transform(df_train_ml.drop(['Survived'],axis=1))\ndf_train_ml_sc = pd.DataFrame(scaled_features) # columns=df_train_ml.columns[1::])\n\n# for df_test_ml\ndf_test_ml.fillna(df_test_ml.mean(), inplace=True)\n#scaler.fit(df_test_ml)\nscaled_features = scaler.transform(df_test_ml)\ndf_test_ml_sc = pd.DataFrame(scaled_features) # , columns=df_test_ml.columns)","673d32f5":"df_train_ml_sc.head()","d1e77ca0":"df_test_ml_sc.head()","35593e71":"df_train_ml.head()","a3afe685":"X = df_train_ml.drop('Survived', axis=1)\ny = df_train_ml['Survived']\nX_test = df_test_ml\n\nX_sc = df_train_ml_sc\ny_sc = df_train_ml['Survived']\nX_test_sc = df_test_ml_sc","b63a41fe":"from sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.svm import SVC\nfrom sklearn import tree\n\n\nfrom sklearn.metrics import accuracy_score\n","f6449e54":"from sklearn.model_selection import cross_val_score","6733cf6a":"svc = SVC(gamma = 0.01, C = 100)\nscores_svc = cross_val_score(svc, X, y, cv=10, scoring='accuracy')\nprint(scores_svc)\nprint(scores_svc.mean())","9605c897":"svc = SVC(gamma = 0.01, C = 100)\nscores_svc_sc = cross_val_score(svc, X_sc, y_sc, cv=10, scoring='accuracy')\nprint(scores_svc_sc)\nprint(scores_svc_sc.mean())","b9d00e3b":"rfc = RandomForestClassifier(max_depth=5, max_features=6)\nscores_rfc = cross_val_score(rfc, X, y, cv=10, scoring='accuracy')\nprint(scores_rfc)\nprint(scores_rfc.mean())","bf5fcd3d":"from sklearn.model_selection import RandomizedSearchCV\nfrom sklearn.model_selection import GridSearchCV\nfrom scipy.stats import uniform","24c18c16":"model = SVC()\nparam_grid = {'C':uniform(0.1, 5000), 'gamma':uniform(0.0001, 1) }\nrand_SVC = RandomizedSearchCV(model, param_distributions=param_grid, n_iter=100)\nrand_SVC.fit(X_sc,y_sc)\nscore_rand_SVC = get_best_score(rand_SVC)","a8490403":"param_grid = {'C': [0.1,10, 100, 1000,5000], 'gamma': [1,0.1,0.01,0.001,0.0001], 'kernel': ['rbf']}\nsvc_grid = GridSearchCV(SVC(), param_grid, cv=10, refit=True, verbose=1)\nsvc_grid.fit(X_sc,y_sc)\nsc_svc = get_best_score(svc_grid)","ae11df03":"pred_all_svc = svc_grid.predict(X_test_sc)\n\nsub_svc = pd.DataFrame()\nsub_svc['PassengerId'] = df_test['PassengerId']\nsub_svc['Survived'] = pred_all_svc\nsub_svc.to_csv('svc.csv',index=False)","2e666236":"knn = KNeighborsClassifier()\nleaf_range = list(range(3, 15, 1))\nk_range = list(range(1, 15, 1))\nweight_options = ['uniform', 'distance']\nparam_grid = dict(leaf_size=leaf_range, n_neighbors=k_range, weights=weight_options)\nprint(param_grid)\n\nknn_grid = GridSearchCV(knn, param_grid, cv=10, verbose=1, scoring='accuracy')\nknn_grid.fit(X, y)\n\nsc_knn = get_best_score(knn_grid)","d193c7f6":"pred_all_knn = knn_grid.predict(X_test)\n\nsub_knn = pd.DataFrame()\nsub_knn['PassengerId'] = df_test['PassengerId']\nsub_knn['Survived'] = pred_all_knn\nsub_knn.to_csv('knn.csv',index=False)","5f67ce66":"from sklearn.tree import DecisionTreeClassifier\ndtree = DecisionTreeClassifier()\n\nparam_grid = {'min_samples_split': [4,7,10,12]}\ndtree_grid = GridSearchCV(dtree, param_grid, cv=10, refit=True, verbose=1)\ndtree_grid.fit(X_sc,y_sc)\n\nprint(dtree_grid.best_score_)\nprint(dtree_grid.best_params_)\nprint(dtree_grid.best_estimator_)","cc1b37ca":"pred_all_dtree = dtree_grid.predict(X_test_sc)\n\nsub_dtree = pd.DataFrame()\nsub_dtree['PassengerId'] = df_test['PassengerId']\nsub_dtree['Survived'] = pred_all_dtree\nsub_dtree.to_csv('dtree.csv',index=False)","80ea0611":"from sklearn.ensemble import RandomForestClassifier\nrfc = RandomForestClassifier()\n\nparam_grid = {'max_depth': [3, 5, 6, 7, 8], 'max_features': [6,7,8,9,10],  \n              'min_samples_split': [5, 6, 7, 8]}\n\nrf_grid = GridSearchCV(rfc, param_grid, cv=10, refit=True, verbose=1)\nrf_grid.fit(X_sc,y_sc)\nsc_rf = get_best_score(rf_grid)","ec008d18":"plot_feature_importances(rf_grid, X.columns)","1a7416b8":"pred_all_rf = rf_grid.predict(X_test_sc)\n\nsub_rf = pd.DataFrame()\nsub_rf['PassengerId'] = df_test['PassengerId']\nsub_rf['Survived'] = pred_all_rf\nsub_rf.to_csv('rf.csv',index=False)","18aa42de":"from sklearn.ensemble import ExtraTreesClassifier\nextr = ExtraTreesClassifier()\n\nparam_grid = {'max_depth': [6,7,8,9], 'max_features': [7,8,9,10],  \n              'n_estimators': [50, 100, 200]}\n\nextr_grid = GridSearchCV(extr, param_grid, cv=10, refit=True, verbose=1)\nextr_grid.fit(X_sc,y_sc)\nsc_extr = get_best_score(extr_grid)","2c4fa3f9":"plot_feature_importances(extr_grid, X.columns)","b2d5bd5e":"pred_all_extr = extr_grid.predict(X_test_sc)\n\nsub_extr = pd.DataFrame()\nsub_extr['PassengerId'] = df_test['PassengerId']\nsub_extr['Survived'] = pred_all_extr\nsub_extr.to_csv('extr.csv',index=False)","0658d449":"from sklearn.ensemble import GradientBoostingClassifier\ngbc = GradientBoostingClassifier()\n\nparam_grid = {'n_estimators': [50, 100], \n              'min_samples_split': [3, 4, 5, 6, 7],\n              'max_depth': [3, 4, 5, 6]}\ngbc_grid = GridSearchCV(gbc, param_grid, cv=10, refit=True, verbose=1)\ngbc_grid.fit(X_sc,y_sc)\nsc_gbc = get_best_score(gbc_grid)","38a450ed":"plot_feature_importances(gbc_grid, X.columns)","71b52ecb":"pred_all_gbc = gbc_grid.predict(X_test_sc)\n\nsub_gbc = pd.DataFrame()\nsub_gbc['PassengerId'] = df_test['PassengerId']\nsub_gbc['Survived'] = pred_all_gbc\nsub_gbc.to_csv('gbc.csv',index=False)","34122f93":"from xgboost import XGBClassifier\nxgb = XGBClassifier()\nparam_grid = {'max_depth': [5,6,7,8], 'gamma': [1, 2, 4], 'learning_rate': [0.1, 0.2, 0.3, 0.5]}\n\nwith ignore_warnings(category=DeprecationWarning):\n    xgb_grid = GridSearchCV(xgb, param_grid, cv=10, refit=True, verbose=1)\n    xgb_grid.fit(X_sc,y_sc)\n    sc_xgb = get_best_score(xgb_grid)","f59aceeb":"plot_feature_importances(xgb_grid, X.columns)","b0680c31":"with ignore_warnings(category=DeprecationWarning):\n    pred_all_xgb = xgb_grid.predict(X_test_sc)\n\nsub_xgb = pd.DataFrame()\nsub_xgb['PassengerId'] = df_test['PassengerId']\nsub_xgb['Survived'] = pred_all_xgb\nsub_xgb.to_csv('xgb.csv',index=False)","535bded8":"from sklearn.ensemble import AdaBoostClassifier\nada = AdaBoostClassifier()\n\nparam_grid = {'n_estimators': [30, 50, 100], 'learning_rate': [0.08, 0.1, 0.2]}\nada_grid = GridSearchCV(ada, param_grid, cv=10, refit=True, verbose=1)\nada_grid.fit(X_sc,y_sc)\nsc_ada = get_best_score(ada_grid)\n\npred_all_ada = ada_grid.predict(X_test_sc)","d600268b":"plot_feature_importances(ada_grid, X.columns)","ef04f7f1":"sub_ada = pd.DataFrame()\nsub_ada['PassengerId'] = df_test['PassengerId']\nsub_ada['Survived'] = pred_all_ada\nsub_ada.to_csv('ada.csv',index=False)","40c46d09":"from catboost import CatBoostClassifier\ncat=CatBoostClassifier()\n\nparam_grid = {'iterations': [100, 150], 'learning_rate': [0.3, 0.4, 0.5], 'loss_function' : ['Logloss']}\n\ncat_grid = GridSearchCV(cat, param_grid, cv=10, refit=True, verbose=1)\ncat_grid.fit(X_sc,y_sc, verbose=False)\nsc_cat = get_best_score(cat_grid)\n\npred_all_cat = cat_grid.predict(X_test_sc)","1929b50e":"plot_feature_importances(cat_grid, X.columns)","8f13adf0":"sub_cat = pd.DataFrame()\nsub_cat['PassengerId'] = df_test['PassengerId']\nsub_cat['Survived'] = pred_all_cat\nsub_cat['Survived'] = sub_cat['Survived'].astype(int)\nsub_cat.to_csv('cat.csv',index=False)","2132abea":"import lightgbm as lgb\nlgbm = lgb.LGBMClassifier(silent=False)\nparam_grid = {\"max_depth\": [8,10,15], \"learning_rate\" : [0.008,0.01,0.012], \n              \"num_leaves\": [80,100,120], \"n_estimators\": [200,250]  }\nlgbm_grid = GridSearchCV(lgbm, param_grid, cv=10, refit=True, verbose=1)\nlgbm_grid.fit(X_sc,y_sc, verbose=True)\nsc_lgbm = get_best_score(lgbm_grid)\n\npred_all_lgbm = lgbm_grid.predict(X_test_sc)","cc6a9459":"plot_feature_importances(lgbm_grid, X.columns)","546cfc84":"sub_lgbm = pd.DataFrame()\nsub_lgbm['PassengerId'] = df_test['PassengerId']\nsub_lgbm['Survived'] = pred_all_lgbm\nsub_lgbm.to_csv('lgbm.csv',index=False)","0ec5ebaf":"from sklearn.ensemble import VotingClassifier","761ac64a":"from sklearn.linear_model import LogisticRegression\nfrom sklearn.naive_bayes import GaussianNB\n\nclf1 = LogisticRegression(random_state=1)\nclf2 = RandomForestClassifier(random_state=1)\nclf3 = GaussianNB()\n\neclf = VotingClassifier(estimators=[('lr', clf1), ('rf', clf2), ('gnb', clf3)], voting='soft')\n\nparams = {'lr__C': [1.0, 100.0], 'rf__n_estimators': [20, 200],}\n\nwith ignore_warnings(category=DeprecationWarning):\n    votingclf_grid = GridSearchCV(estimator=eclf, param_grid=params, cv=10)\n    votingclf_grid.fit(X_sc,y_sc)\n    sc_vot1 = get_best_score(votingclf_grid)","ad0012e3":"clf4 = GradientBoostingClassifier()\nclf5 = SVC()\nclf6 = RandomForestClassifier()\n\neclf_2 = VotingClassifier(estimators=[('gbdt', clf4), \n                                      ('svc', clf5), \n                                      ('rf', clf6)], voting='soft')\n\nparams = {'gbdt__n_estimators': [50], 'gbdt__min_samples_split': [3],\n          'svc__C': [10, 100] , 'svc__gamma': [0.1,0.01,0.001] , 'svc__kernel': ['rbf'] , 'svc__probability': [True],  \n          'rf__max_depth': [7], 'rf__max_features': [2,3], 'rf__min_samples_split': [3] } \n\nwith ignore_warnings(category=DeprecationWarning):\n    votingclf_grid_2 = GridSearchCV(estimator=eclf_2, param_grid=params, cv=10)\n    votingclf_grid_2.fit(X_sc,y_sc)\n    sc_vot2_cv = get_best_score(votingclf_grid_2)","5ffc6e7e":"with ignore_warnings(category=DeprecationWarning):    \n    pred_all_vot2 = votingclf_grid_2.predict(X_test_sc)\n\nsub_vot2 = pd.DataFrame()\nsub_vot2['PassengerId'] = df_test['PassengerId']\nsub_vot2['Survived'] = pred_all_vot2\nsub_vot2.to_csv('vot2.csv',index=False)","6176b136":"from mlxtend.classifier import StackingClassifier","05475f26":"# Initializing models\nclf1 = xgb_grid.best_estimator_\nclf2 = gbc_grid.best_estimator_\nclf3 = rf_grid.best_estimator_\nclf4 = svc_grid.best_estimator_\n\nlr = LogisticRegression()\nst_clf = StackingClassifier(classifiers=[clf1, clf1, clf2, clf3, clf4], meta_classifier=lr)\n\nparams = {'meta_classifier__C': [0.1,1.0,5.0,10.0] ,\n          #'use_probas': [True] ,\n          #'average_probas': [True] ,\n          'use_features_in_secondary' : [True, False]\n         }\nwith ignore_warnings(category=DeprecationWarning):\n    st_clf_grid = GridSearchCV(estimator=st_clf, param_grid=params, cv=5, refit=True)\n    st_clf_grid.fit(X_sc, y_sc)\n    sc_st_clf = get_best_score(st_clf_grid)","0fd9e8de":"with ignore_warnings(category=DeprecationWarning):    \n    pred_all_stack = st_clf_grid.predict(X_test_sc)\n\nsub_stack = pd.DataFrame()\nsub_stack['PassengerId'] = df_test['PassengerId']\nsub_stack['Survived'] = pred_all_stack\nsub_stack.to_csv('stack_clf.csv',index=False)","0025aaf3":"list_scores = [sc_knn, sc_rf, sc_extr, sc_svc, sc_gbc, sc_xgb, \n               sc_ada, sc_cat, sc_lgbm, sc_vot2_cv, sc_st_clf]\n\nlist_classifiers = ['KNN','RF','EXTR','SVC','GBC','XGB',\n                    'ADA','CAT','LGBM','VOT2','STACK']","8bc370ce":"score_subm_svc   = 0.80861\nscore_subm_vot2  = 0.78947\nscore_subm_ada   = 0.78468\nscore_subm_lgbm  = 0.78468\nscore_subm_rf    = 0.77990\nscore_subm_xgb   = 0.77033\nscore_subm_dtree = 0.76076\nscore_subm_extr  = 0.76076\nscore_subm_gbc  = 0.74641\nscore_subm_cat   = 0.74162\nscore_subm_knn   = 0.69856\n\nscore_subm_stack = 0.76076","41533fe2":"subm_scores = [score_subm_knn, score_subm_rf, score_subm_extr, score_subm_svc, \n               score_subm_gbc, score_subm_xgb, score_subm_ada, score_subm_cat, \n               score_subm_lgbm, score_subm_vot2, score_subm_stack]","c6222a14":"trace1 = go.Scatter(x = list_classifiers, y = list_scores,\n                   name=\"Validation\", text = list_classifiers)\ntrace2 = go.Scatter(x = list_classifiers, y = subm_scores,\n                   name=\"Submission\", text = list_classifiers)\n\ndata = [trace1, trace2]\n\nlayout = dict(title = \"Validation and Submission Scores\", \n              xaxis=dict(ticklen=10, zeroline= False),\n              yaxis=dict(title = \"Accuracy\", side='left', ticklen=10,),                                  \n              legend=dict(orientation=\"v\", x=1.05, y=1.0),\n              autosize=False, width=750, height=500,\n              )\n\nfig = dict(data = data, layout = layout)\niplot(fig)","9149368e":"predictions = {'KNN': pred_all_knn, 'RF': pred_all_rf, 'EXTR': pred_all_extr, \n               'SVC': pred_all_svc, 'GBC': pred_all_gbc, 'XGB': pred_all_xgb, \n               'ADA': pred_all_ada, 'CAT': pred_all_cat, 'LGBM': pred_all_lgbm, \n               'VOT2': pred_all_vot2, 'STACK': pred_all_stack}\ndf_predictions = pd.DataFrame(data=predictions) \ndf_predictions.corr()","038916ab":"plt.figure(figsize=(9, 9))\nsns.set(font_scale=1.25)\nsns.heatmap(df_predictions.corr(), linewidths=1.5, annot=True, square=True, \n                fmt='.2f', annot_kws={'size': 10}, \n                yticklabels=df_predictions.columns , xticklabels=df_predictions.columns\n            )\nplt.yticks(rotation=0)\nplt.show()","64aa534a":"imp_rf   = pd.Series(data = rf_grid.best_estimator_.feature_importances_, index=X.columns)\nimp_extr = pd.Series(data = extr_grid.best_estimator_.feature_importances_, index=X.columns)\nimp_gbc = pd.Series(data = gbc_grid.best_estimator_.feature_importances_, index=X.columns)\nimp_xgb = pd.Series(data = xgb_grid.best_estimator_.feature_importances_, index=X.columns)\nimp_ada = pd.Series(data = ada_grid.best_estimator_.feature_importances_, index=X.columns)\nimp_cat = pd.Series(data = cat_grid.best_estimator_.feature_importances_ \/ 100, index=X.columns)\nimp_lgbm = pd.Series(data = lgbm_grid.best_estimator_.feature_importances_ \/ 10000, index=X.columns)\nimp_lgbm \/= imp_lgbm.sum()","e2466946":"models=['RF', 'EXTR', 'GBC', 'XGB', 'ADA', 'CAT', 'LGBM']\n\nfig = go.Figure(data=[\n    go.Bar(name=models[0],  x=imp_rf.index,   y=imp_rf.values),\n    go.Bar(name=models[1],  x=imp_extr.index, y=imp_extr.values),\n    go.Bar(name=models[2],  x=imp_gbc.index,  y=imp_gbc.values),   \n    go.Bar(name=models[3],  x=imp_xgb.index,  y=imp_xgb.values),    \n    go.Bar(name=models[4],  x=imp_ada.index,  y=imp_ada.values),        \n    go.Bar(name=models[5],  x=imp_cat.index,  y=imp_cat.values),  \n    go.Bar(name=models[6],  x=imp_lgbm.index, y=imp_lgbm.values),  \n])\n\nfig.update_layout(barmode='group')\nfig.update_layout(title=go.layout.Title(\n                  text=\"Feature importances for Ensemble models\",\n                  xref=\"paper\",\n                  x=0.5))\nfig.show()","98010983":"Passengers embarked in \"C\" had largest proportion of Pclass 1 tickets.  \nAlmost all Passengers embarked in \"Q\" had Pclass 3 tickets.  \nFor every class, the largest count of Passengers  embarked in \"S\".","51385c40":"### First Voting  \nfor the first voting ensemble I use three simple models (LR, RF, GNB)","f25e493d":"**submission for knn**","ad567705":"## Feature Engineering\n**New Features: 'FamilySize'  ,  'Alone' , 'NameLen' and 'Title'**","dc9e4244":"### SVC : GridSearchCV","9c6ecc15":"* **TODO:**  \n \ncompare feature importances  \ncomplete documentation","b4104a0f":"### Decision Tree","6c42bdb7":"### SVC : RandomizedSearchCV","3a1eb2b1":"Looks like the feature Cabin has lots of missing data, also some data for Age and Embarked is missing.  \nLets plot the seaborn heatmap of the isnull matrix for the train and test data","2c627de4":"**submission for svc**","281045dd":"## Data Wrangling","e17f4863":"### Second Voting\n\nfor the 2nd voting ensemble I use the three models (together with the optimal parameters found by GridSearchCV)  \nthat had the best test score based on the cross validations above ","d18ecbcd":"### SVC, features scaled  ","cc9f799e":"**Looks like there is very strong correlation of Survival rate and Name length**","5024fe1b":"### New Feature: Title","71096836":"### Bar and Box plots","1a92bf06":"### scores from GridSearchCV","3af5be58":"**Fill NaN with mean or mode**","5a02eed3":"**submission for GradientBoostingClassifier**","e825b95a":"# Part 2: Data Wrangling and Feature Engineering","df80442f":"Default mode for seaborn barplots is to plot the mean value for the category.  \nAlso, the standard deviation is indicated.  \nSo, if we choose Survived as y-value, we get a plot of the survival rate as function   \nof the categories present in the feature chosen as x-value.","35cdce73":"**In the following we apply GridSearchCV and RandomizedSearchCV for these Classification models:**  \n**KNN, Decision Tree, Random Forest, SVC**","f560a0ed":"**Chance to survive increases with length of name for all Passenger classes**","cfce8207":"### Review: k fold cross validation  \njust a short review of this technique that we already studied in the first kernel","cfd13e29":"# Part 3: Optimization of Classifier parameters, Boosting, Voting and Stacking","a2fc8d08":"### Seaborn heatmaps  \nmissing data in df_train and df_test","24199a89":"### Bining for Age and Fare, convert Title to numerical","9e45703c":"**RandomizedSearchCV  and GridSearchCV apply k fold cross validation on a chosen set of parameters**\n**and then find the parameters that give the best performance.**  \nFor GridSearchCV, all possible combinations of the specified parameter values are tried out, resulting in a parameter grid.  \nFor RandomizedSearchCV, a fixed number of parameter settings is sampled from the specified distributions. The number of parameter settings that are tried is given by n_iter.","ffe44daa":"Of the 891 passengers in df_test, less than 350 survive.  \nMuch more women survive than men.  \nAlso, the chance to survive is much higher in Pclass 1 and 2 than in Class 3.  \nSurvival rate for passengers travelling with SibSp or Parch is higher than for those travelling alone.  \nPassengers embarked in C and Q are more likely to survie than those embarked in S.","5e292c49":"**double-check for missing values**","73aff8ab":"* With this kernel we studied EDA with **Seaborn** including some unusual plots like violin and swarm.   \n* Based on the EDA we filled missing values according to related features and developed new features (**Feature Engineering**) to improve model performance.  \n* In Part 3 we learned basics of applying **ensemble models** for classification like **Boosting**, **Stacking** and **Voting**.   \n* For this we applied libraries like: **sklearn, mlxtend, lightgbm, catboost, xgboost**","439f6810":"### Comparison plot for best models","906c27dc":"**Increase of survival rate with length of name most important for male passengers**","9887b7c8":"# Part 0: Imports, Functions","38e44183":"### Compare feature importances","93ba85c9":"Here, the high survival rate for kids in Pclass 2 is easily observed.  \nAlso, it becomes more obvious that for passengers older than 40 the best chance to survive is in Pclass 1,  \nand smallest chance in Pclass 3   ","679ff6f0":"### New Feature: NameLenBin","d0790460":"### RFC, features not scaled  ","addf7870":"<img src=\"https:\/\/upload.wikimedia.org\/wikipedia\/commons\/6\/6e\/St%C3%B6wer_Titanic.jpg\" width=\"520\">","55bd89f8":"### CatBoost\nlibrary for gradient boosting on decision trees with categorical features support","9854d089":"**submission for ExtraTreesClassifier**","92386abd":"### SVC, features not scaled  \nSupport Vector Machine Classifier","c3612906":"### Swarm and Violin plots\nAlthough the following swarm and violin plots show the same data like the countplots or distplots before,  \nthey can reveal ceratin details that disappear in other plots. However, it takes more time to study these plots in detail.","816ec14f":"**References**  \nWhile this notebook contains some work work based on my ideas, it is also a collection of approaches  \nand techniques from these kaggle notebooks:","50e12534":"### StackingClassifier","756d4683":"### eXtreme Gradient Boosting - XGBoost","42438762":"Passengers embarked in \"S\" had the lowest survival rate, those embarked in \"C\" the highest.  \nAgain, with hue we see the survival rate as function of Embarked and Pclass.","e1d991c9":"Best chances to survive for male passengers was in Pclass 1 or being below 5 years old.  \nLowest survival rate for female passengers was in Pclass 3 and being older than 40.  \nMost passengers were male, in Pclass 3 and between 15-35 years old.","4abf72a3":"**convert categorical to numerical : get_dummies**","ab033c04":"**This is my second notebook for the Titanic classification competition.**\n\nIf you are new to Machine Learning, have a look at  **[my first Titanic notebook](https:\/\/www.kaggle.com\/dejavu23\/titanic-survival-for-beginners-eda-to-ml)** where  I studied the  \nbasics of EDA with Pandas and Matplotlib and how to do Classification with the scikit-learn library.  ","c94e12ce":"## Hyperparameter tuning with RandomizedSearchCV and GridSearchCV","39c6c0c7":"**loading the data**","72069cb7":"**Boxplot**","fb758b6e":"# Titanic Survival: Seaborn and Ensembles\n**My second Titanic kernel**\n\n**[Part 0: Imports, Functions](#Part-0:-Imports,-Functions)** \n\n**[Part 1: Exploratory Data Analysis](#Part-1:-Exploratory-Data-Analysis)** \n\n* Seaborn [heatmaps](#Seaborn-heatmaps) : missing data in df_train and df_test\n* Seaborn [countplots](#Seaborn-Countplots) : Number of (Non-)Survivors as function of features\n* Seaborn [distplots](#Seaborn-Distplots) : Distribution of Age and Fare as function of Pclass, Sex and Survived  \n* [Bar and Box plots](#Bar-and-Box-plots) for categorical features : Pclass and Embarked\n* Seaborn [violin and swarm plots](#Swarm-and-Violin-plots) : Survivals as function of Age, Pclass and Sex\n\n**[Part 2: Data Wrangling and Feature Engineering](#Part-2:-Data-Wrangling-and-Feature-Engineering)**  \n\n* [Feature Engineering](#Feature-Engineering): include new features to improve the performance of the classifiers and to fill missing values:  \nFamily size, Alone, Name length, Title\n* [Data Wrangling](#Data-Wrangling): fill NaN, convert categorical to numerical, [Standard Scaler](#Standard-Scaler), create X, y and X_test for Part 3\n\n\n**[Part 3: Optimization of Classifier parameters, Boosting, Voting and Stacking](#Part-3:-Optimization-of-Classifier-parameters,-Boosting,-Voting-and-Stacking)**  \n\n* Review: [k fold cross validation](#Review:-k-fold-cross-validation) for SVC and Random Forest: \n * SVC, features not scaled \n * SVC, features scaled \n * Random Forest Classifier, RFC, features not scaled \n* Hyperparameter tuning with GridSearchCV and RandomizedSearchCV for: \n * Support Vector Machine Classifier, [SVC](#SVC-:-RandomizedSearchCV) \n * K Nearest Neighbor, [KNN](#KNN)\n * [Decision Tree](#Decision-Tree)\n * [Random Forest Classifier](#Random-Forest), RFC\n\n* study Ensemble models like Boosting, Stacking and Voting:  \n * [ExtraTreesClassifier](#ExtraTreesClassifier)\n * Gradient Boost Decision Tree - [GBDT](#Gradient-Boost-Decision-Tree-GBDT)\n * eXtreme Gradient Boosting - [XGBoost](#eXtreme-Gradient-Boosting---XGBoost)   \n * Adaptive Boosting - [AdaBoost](#Ada-Boost)\n * [CatBoost](#CatBoost)\n * lightgbm [LGBM](#lightgbm-LGBM)\n * Voting: [VotingClassifier 1](#First-Voting), [VotingClassifier 2](#Second-Voting)  \n * Stacking : [StackingClassifier](#StackingClassifier)  \n* Compare Classifier performance based on the validation score : [comparison plot](#Comparison-plot-for-best-models)\n* Correlation of prediction results : [correlation matrix](#Correlation-of-prediction-results)","0f18e3da":"# Part 1: Exploratory Data Analysis","8db82ebc":"As we know from the first Titanic kernel, survival rate decreses with Pclass.  \nThe hue parameter lets us see the difference in survival rate for male and female. ","58158d3b":"### Ada Boost  ","46595df5":"### submission scores","00cf1983":"### Standard Scaler","8ec9562c":"### Correlation of prediction results","6b25b491":"Highest survival rate (>0.9) for women in Pclass 1 or 2.  \nLowest survival rate (<0.2) for men in Pclass 3.","e7a93fa4":"But survival rate alone is not good beacuse its uncertainty depends on the number of samples.  \nWe also need to consider the total number (count) of passengers that embarked.","2fa2542a":"Mean fare for Passengers embarked in \"C\" was higher.","ee60d9e9":"### New Feature: Family size","1405421a":"### Seaborn Countplots  \nfor all categorical columns","27cbc26b":"### KNN","9d7b20fd":"### **Conclusion**","ad0354ec":"**submission for random forest**","acbc8379":"### ExtraTreesClassifier","f7c39267":"**submission for decision tree**","2b20a895":"### VotingClassifier","56c0864c":"**Disribution of Fare as function of Pclass, Sex and Survived**","6401c4d0":"### lightgbm LGBM","5f54ced9":"This violinplot shows exactly the same info like the swarmplot before.","ff20fa47":"### Gradient Boost Decision Tree GBDT \n","e965a5c9":"### Seaborn Distplots \n**Distribution of Age as function of Pclass, Sex and Survived**","b70a20db":"**some useful functions**","89925ce2":"### Random Forest"}}