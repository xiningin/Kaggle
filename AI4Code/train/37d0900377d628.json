{"cell_type":{"d6c3f65c":"code","e9026716":"code","5422250b":"code","ebe79214":"code","7685aa1c":"code","d34026db":"code","73af4bd6":"code","97eee075":"code","af8e687b":"code","d3b5a8f3":"code","37eab480":"markdown","0a918dfc":"markdown","9a18970d":"markdown","4df1d046":"markdown","d4d8db9d":"markdown","8eea72ce":"markdown","5ae75f46":"markdown","38696453":"markdown","c58170b8":"markdown","08354e36":"markdown"},"source":{"d6c3f65c":"import numpy as np\nimport pandas as pd\nfrom pathlib import Path\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n        \nimport matplotlib.pyplot as plt\n\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import roc_auc_score\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.naive_bayes import GaussianNB\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.ensemble import AdaBoostClassifier\n\nfrom sklearn.ensemble import RandomForestClassifier, GradientBoostingClassifier\nfrom sklearn.ensemble import VotingClassifier\n\nimport matplotlib.pyplot as plt\n        \ninput_path = Path('\/kaggle\/input\/tabular-playground-series-mar-2021\/')","e9026716":"train = pd.read_csv(input_path \/ 'train.csv', index_col='id')\ndisplay(train.head())","5422250b":"test = pd.read_csv(input_path \/ 'test.csv', index_col='id')\ndisplay(test.head())","ebe79214":"submission = pd.read_csv(input_path \/ 'sample_submission.csv', index_col='id')\ndisplay(submission.head())","7685aa1c":"for c in train.columns:\n    if train[c].dtype=='object': \n        lbl = LabelEncoder()\n        lbl.fit(list(train[c].values) + list(test[c].values))\n        train[c] = lbl.transform(train[c].values)\n        test[c] = lbl.transform(test[c].values)\n        \ndisplay(train.head())","d34026db":"i = 0\nj = 0\n\nlargestCorrelation = 0\nlargestCorrelationXIndex = 0\nlargestCorrelationYIndex = 0\nlargestCorrelationCol = \"\"\nlargestCorrelationOtherCol = \"\"\n\nlargestCorrelation2 = 0\nlargestCorrelationXIndex2 = 0\nlargestCorrelationYIndex2 = 0\nlargestCorrelationCol2 = \"\"\nlargestCorrelationOtherCol2 = \"\"\n\nlargestCorrelation3 = 0\nlargestCorrelationXIndex3 = 0\nlargestCorrelationYIndex3 = 0\nlargestCorrelationCol3 = \"\"\nlargestCorrelationOtherCol3 = \"\"\n\nlargestCorrelation4 = 0\nlargestCorrelationXIndex4 = 0\nlargestCorrelationYIndex4 = 0\nlargestCorrelationCol4 = \"\"\nlargestCorrelationOtherCol4 = \"\"\n\nlargestCorrelation5 = 0\nlargestCorrelationXIndex5 = 0\nlargestCorrelationYIndex5 = 0\nlargestCorrelationCol5 = \"\"\nlargestCorrelationOtherCol5 = \"\"\n\ncorrelations = np.zeros((31,31))\nfor col in train.columns:\n    for col2 in train.columns:\n        colArr = np.array(train[col]).reshape(-1, 1)\n        col2Arr = np.array(train[col2])\n        reg = LinearRegression().fit(colArr, col2Arr)\n        correlations[i,j] = reg.score(colArr, col2Arr)\n        \n        colsChecked = [largestCorrelationCol, largestCorrelationOtherCol, largestCorrelationCol2, largestCorrelationOtherCol2, largestCorrelationCol3, largestCorrelationOtherCol3, largestCorrelationCol4, largestCorrelationOtherCol4, largestCorrelationCol5, largestCorrelationOtherCol5]\n        \n        if col not in colsChecked and col2 not in colsChecked:   \n        \n            if correlations[i,j] > largestCorrelation and i != j:\n\n                largestCorrelation5 = largestCorrelation4\n                largestCorrelationXIndex5 = largestCorrelationXIndex4\n                largestCorrelationYIndex5 = largestCorrelationYIndex4\n                largestCorrelationCol5 = largestCorrelationCol4\n                largestCorrelationOtherCol5 = largestCorrelationOtherCol4\n\n                largestCorrelation4 = largestCorrelation3\n                largestCorrelationXIndex4 = largestCorrelationXIndex3\n                largestCorrelationYIndex4 = largestCorrelationYIndex3\n                largestCorrelationCol4 = largestCorrelationCol3\n                largestCorrelationOtherCol4 = largestCorrelationOtherCol3\n\n                largestCorrelation3 = largestCorrelation2\n                largestCorrelationXIndex3 = largestCorrelationXIndex2\n                largestCorrelationYIndex3 = largestCorrelationYIndex2\n                largestCorrelationCol3 = largestCorrelationCol2\n                largestCorrelationOtherCol3 = largestCorrelationOtherCol2\n\n                largestCorrelation2 = largestCorrelation\n                largestCorrelationXIndex2 = largestCorrelationXIndex\n                largestCorrelationYIndex2 = largestCorrelationYIndex\n                largestCorrelationCol2 = largestCorrelationCol\n                largestCorrelationOtherCol2 = largestCorrelationOtherCol\n\n                largestCorrelation = correlations[i,j]\n                largestCorrelationXIndex = i\n                largestCorrelationYIndex = j\n                largestCorrelationCol = col\n                largestCorrelationOtherCol = col2\n\n            elif correlations[i,j] > largestCorrelation2 and i != j:\n\n                largestCorrelation5 = largestCorrelation4\n                largestCorrelationXIndex5 = largestCorrelationXIndex4\n                largestCorrelationYIndex5 = largestCorrelationYIndex4\n                largestCorrelationCol5 = largestCorrelationCol4\n                largestCorrelationOtherCol5 = largestCorrelationOtherCol4\n\n                largestCorrelation4 = largestCorrelation3\n                largestCorrelationXIndex4 = largestCorrelationXIndex3\n                largestCorrelationYIndex4 = largestCorrelationYIndex3\n                largestCorrelationCol4 = largestCorrelationCol3\n                largestCorrelationOtherCol4 = largestCorrelationOtherCol3\n\n                largestCorrelation3 = largestCorrelation2\n                largestCorrelationXIndex3 = largestCorrelationXIndex2\n                largestCorrelationYIndex3 = largestCorrelationYIndex2\n                largestCorrelationCol3 = largestCorrelationCol2\n                largestCorrelationOtherCol3 = largestCorrelationOtherCol2\n\n                largestCorrelation2 = correlations[i,j]\n                largestCorrelationXIndex2 = i\n                largestCorrelationYIndex2 = j\n                largestCorrelationCol2 = col\n                largestCorrelationOtherCol2 = col2\n\n            elif correlations[i,j] > largestCorrelation3 and i != j:\n\n                largestCorrelation5 = largestCorrelation4\n                largestCorrelationXIndex5 = largestCorrelationXIndex4\n                largestCorrelationYIndex5 = largestCorrelationYIndex4\n                largestCorrelationCol5 = largestCorrelationCol4\n                largestCorrelationOtherCol5 = largestCorrelationOtherCol4\n\n                largestCorrelation4 = largestCorrelation3\n                largestCorrelationXIndex4 = largestCorrelationXIndex3\n                largestCorrelationYIndex4 = largestCorrelationYIndex3\n                largestCorrelationCol4 = largestCorrelationCol3\n                largestCorrelationOtherCol4 = largestCorrelationOtherCol3\n\n                largestCorrelation3 = largestCorrelation2\n                largestCorrelationXIndex3 = largestCorrelationXIndex2\n                largestCorrelationYIndex3 = largestCorrelationYIndex2\n                largestCorrelationCol3 = largestCorrelationCol2\n                largestCorrelationOtherCol3 = largestCorrelationOtherCol2\n\n            elif correlations[i,j] > largestCorrelation4 and i != j:\n\n                largestCorrelation5 = largestCorrelation4\n                largestCorrelationXIndex5 = largestCorrelationXIndex4\n                largestCorrelationYIndex5 = largestCorrelationYIndex4\n                largestCorrelationCol5 = largestCorrelationCol4\n                largestCorrelationOtherCol5 = largestCorrelationOtherCol4\n\n                largestCorrelation4 = largestCorrelation3\n                largestCorrelationXIndex4 = largestCorrelationXIndex3\n                largestCorrelationYIndex4 = largestCorrelationYIndex3\n                largestCorrelationCol4 = largestCorrelationCol3\n                largestCorrelationOtherCol4 = largestCorrelationOtherCol3\n\n            elif correlations[i,j] > largestCorrelation5 and i != j:\n\n                largestCorrelation5 = correlations[i,j]\n                largestCorrelationXIndex5 = i\n                largestCorrelationYIndex5 = j\n                largestCorrelationCol5 = col\n                largestCorrelationOtherCol5 = col2\n            \n        j+=1\n    j=0\n    i+=1\n\nprint(largestCorrelation)\nprint(largestCorrelationCol)\nprint(largestCorrelationOtherCol)\n\nprint(largestCorrelation2)\nprint(largestCorrelationCol2)\nprint(largestCorrelationOtherCol2)\n\nprint(largestCorrelation3)\nprint(largestCorrelationCol3)\nprint(largestCorrelationOtherCol3)\n\nprint(largestCorrelation4)\nprint(largestCorrelationCol4)\nprint(largestCorrelationOtherCol4)\n\nprint(largestCorrelation5)\nprint(largestCorrelationCol5)\nprint(largestCorrelationOtherCol5)\n\ndel train[largestCorrelationCol]\ntrain.shape","73af4bd6":"target = train.pop('target')\nX_train, X_test, y_train, y_test = train_test_split(train, target, train_size=0.60)","97eee075":"clf = GradientBoostingClassifier(n_estimators=200, max_depth=7)\nclf1 = RandomForestClassifier(n_estimators=50, random_state=1)\nclf2 = AdaBoostClassifier(n_estimators=100, random_state=0)\n\neclf = VotingClassifier(estimators=[('rf', clf1), ('gnb', clf2), ('gbc', clf)],voting='soft')\n\n#clf.fit(X_train, y_train)\n#y_pred = clf.predict_proba(X_test)[:, 1] # This grabs the positive class prediction\n\n# eclf.fit(X_train, y_train)\n# y_pred = eclf.predict_proba(X_test)[:, 1] # This grabs the positive class prediction\n\n# score = roc_auc_score(y_test, y_pred)\n# print(f'{score:0.5f}') # 0.87323 shows we're doing better than a dummy model","af8e687b":"plt.figure(figsize=(8,4))\nplt.hist(y_pred[np.where(y_test == 0)], bins=100, alpha=0.75, label='neg class')\nplt.hist(y_pred[np.where(y_test == 1)], bins=100, alpha=0.75, label='pos class')\nplt.legend()\nplt.show()","d3b5a8f3":"# clf = GradientBoostingClassifier(n_estimators=200, max_depth=7)\n\ndel test[largestCorrelationCol]\n\neclf.fit(train, target)\nsubmission['target'] = eclf.predict_proba(test)[:, 1]\nsubmission.to_csv('submission.csv')","37eab480":"# Simple Random Forest\n\nIn previous Tabular Playground Series competition, when the target was continuous, we created a \"naive\" dummy model, that just predicted the average of the target. That approach is less useful when the scoring metric is AUC, since any constant prediction will score 0.5. So we'll skip that this time, and note that we want to score better than 0.5 for our model to be considered better than naive or random.\n\n*Note: I moved away from the random forest towards an XGBoost classifier, which improved performance even more than the feature engineering did.*","0a918dfc":"## Now you should save your Notebook (blue button in the upper right), and then when that's complete go to the notebook viewer and make a submission to the competition. :-)\n\n## There's lots of room for improvement. What things can you try to get a better score?","9a18970d":"# Let's train it on all the data and make a submission!","4df1d046":"# Which variables are correlated with each other?","d4d8db9d":"## We need to encode the categoricals.\n\nThere are different strategies to accomplish this, and different approaches will have different performance when using different algorithms.  You may decide to encode features with high cardinality (e.g., more distinct values) diffirently than features with low cardinality. For this starter notebook, we'll use simple encoding.","8eea72ce":"This block was the key piece I added to improve my score a bit. I used the print statements to prove to myself that the code was running as expected.\n\nOne experiment that didn't work out so well was replacing the two most correlated columns with their averages--it was better to just remove the column in question.\n\nGoing forward, I'd like to look for the top five correlations, rather than just the top one. ","5ae75f46":"## Pull out the target, and make a validation split","38696453":"## Let's take a look at how the model predicted the various classes\n\nThe graph below shows that the model does well with most of the negative observations, but struggles with many of the positive observations.","c58170b8":"In this notebook, you will learn how to make your first submission to the [Tabular Playground Series - Mar 2021 competition.](https:\/\/www.kaggle.com\/c\/tabular-playground-series-mar-2021)\n\n# Make the most of this notebook!\n\nYou can use the \"Copy and Edit\" button in the upper right of the page to create your own copy of this notebook and experiment with different models. You can run it as is and then see if you can make improvements.","08354e36":"# Read in the data files"}}