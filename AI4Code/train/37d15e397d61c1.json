{"cell_type":{"dfe09735":"code","a475f8c9":"code","1d30636f":"code","4ee09d4c":"code","0a497eaf":"code","1893378e":"code","0f8905f3":"code","07d89579":"code","751abedc":"code","1f81420f":"code","e1c58ec3":"code","d21e197b":"code","c3e716ef":"code","b90dc39b":"code","619880e9":"code","aadd40af":"code","2bdfd4a4":"code","8eb89def":"code","0402cc07":"code","2a33f2ec":"code","2b865e54":"code","987356fb":"code","8d7f3032":"code","08a6cfa8":"markdown","ad4b927b":"markdown","5329e739":"markdown","c02ce58d":"markdown","b7d184c5":"markdown","01810cdf":"markdown","74ff3a0e":"markdown","4f747b30":"markdown","2538d434":"markdown","c8f893d1":"markdown","d34fe8c4":"markdown"},"source":{"dfe09735":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pylab as plt\nimport os\nplt.style.use('ggplot')\n\n# For interactive plots\nfrom plotly import offline\nimport plotly.graph_objs as go\n\n\npd.set_option('max.columns', None)\noffline.init_notebook_mode()\nconfig = dict(showLink=False)","a475f8c9":"# Read the input data\nppd = pd.read_csv('..\/input\/player_punt_data.csv')\ngd = pd.read_csv('..\/input\/game_data.csv')\npprd = pd.read_csv('..\/input\/play_player_role_data.csv')\nvr = pd.read_csv('..\/input\/video_review.csv')\nvfi = pd.read_csv('..\/input\/video_footage-injury.csv')\npi = pd.read_csv('..\/input\/play_information.csv')","1d30636f":"gd.head()","4ee09d4c":"gd.plot(kind='scatter', x='Week', y='Temperature', figsize=(15, 5), title='NFL Game Data Week vs. Temperature')\nplt.show()","0a497eaf":"gd['count'] = 1\ngd.groupby('Turf') \\\n    .count()[['count']] \\\n    .sort_values('count', ascending=False) \\\n    .plot(kind='bar', figsize=(15, 5), rot=85, title='Count of Games by Turf Type')\nplt.show()","1893378e":"gd.groupby('Start_Time') \\\n    .count()[['count']] \\\n    .plot(kind='bar', figsize=(15, 5), rot=85, title='Count of Games by Start Time', color='g')\nplt.show()","0f8905f3":"vr.shape","07d89579":"vr.head()","751abedc":"vr['count'] = 1\nvr.groupby('Player_Activity_Derived') \\\n    .count()[['count']] \\\n    .sort_values('count', ascending=False) \\\n    .plot(kind='barh', figsize=(15, 5), title='Count of Player Activity Derived')\n\nplt.show()","1f81420f":"vr['count'] = 1\nvr.groupby('Primary_Partner_Activity_Derived') \\\n    .count()[['count']] \\\n    .sort_values('count', ascending=False) \\\n    .plot(kind='barh', figsize=(15, 5), title='Count of Primary Partner Activity Derived', color='g')\n\nplt.show()","e1c58ec3":"vr['count'] = 1\nvr.groupby('Primary_Impact_Type') \\\n    .count()[['count']] \\\n    .sort_values('count', ascending=False) \\\n    .plot(kind='barh', figsize=(15, 5), title='Count of Primary Impact Type', color='b')\nplt.show()","d21e197b":"pi.head()","c3e716ef":"pi['count'] = 1\npi.groupby('Poss_Team').count()[['count']] \\\n    .sort_values('count', ascending=False) \\\n    .plot(kind='bar', figsize=(15, 5), title='Count of punts per team', color='k')\nplt.show()","b90dc39b":"# They are all punts!!! :D\npi['Play_Type'].unique()","619880e9":"# Loading and plotting functions\n\ndef load_plays_for_game(GameKey):\n    \"\"\"\n    Returns a dataframe of play data for a given game (GameKey)\n    \"\"\"\n    play_information = pd.read_csv('..\/input\/play_information.csv')\n    play_information = play_information[play_information['GameKey'] == GameKey]\n    return play_information\n\n\ndef load_game_and_ngs(ngs_file=None, GameKey=None):\n    \"\"\"\n    Returns a dataframe of player movements (NGS data) for a given game\n    \"\"\"\n    if ngs_file is None:\n        print(\"Specifiy an NGS file.\")\n        return None\n    if GameKey is None:\n        print('Specify a GameKey')\n        return None\n    # Merge play data with NGS data    \n    plays = load_plays_for_game(GameKey)\n    ngs = pd.read_csv(ngs_file, low_memory=False)\n    merged = pd.merge(ngs, plays, how=\"inner\", on=[\"GameKey\", \"PlayID\", \"Season_Year\"])\n    return merged\n\n\ndef plot_play(game_df, PlayID, player1=None, player2=None, custom_layout=False):\n    \"\"\"\n    Plots player movements on the field for a given game, play, and two players\n    \"\"\"\n    game_df = game_df[game_df.PlayID==PlayID]\n    \n    GameKey=str(pd.unique(game_df.GameKey)[0])\n    HomeTeam = pd.unique(game_df.Home_Team_Visit_Team)[0].split(\"-\")[0]\n    VisitingTeam = pd.unique(game_df.Home_Team_Visit_Team)[0].split(\"-\")[1]\n    YardLine = game_df[(game_df.PlayID==PlayID) & (game_df.GSISID==player1)]['YardLine'].iloc[0]\n    \n    traces=[]   \n    if (player1 is not None) & (player2 is not None):\n        game_df = game_df[ (game_df['GSISID']==player1) | (game_df['GSISID']==player2)]\n        for player in pd.unique(game_df.GSISID):\n            player = int(player)\n            trace = go.Scatter(\n                x = game_df[game_df.GSISID==player].x,\n                y = game_df[game_df.GSISID==player].y,\n                name='GSISID '+str(player),\n                mode='markers'\n            )\n            traces.append(trace)\n    else:\n        print(\"Specify GSISIDs for player1 and player2\")\n        return None\n    \n    if custom_layout is not True:\n        layout = load_layout()\n        layout['title'] =  HomeTeam + \\\n        ' vs. ' + VisitingTeam + \\\n        '<br>Possession: ' + \\\n        YardLine.split(\" \")[0] +'@'+YardLine.split(\" \")[1]\n    data = traces\n    fig = dict(data=data, layout=layout)\n    play_description = game_df[(game_df.PlayID==PlayID) & (game_df.GSISID==player1)].iloc[0][\"PlayDescription\"]\n    print(\"\\n\\n\\t\",play_description)\n    offline.iplot(fig, config=config)\n    \ndef load_layout():\n    \"\"\"\n    Returns a dict for a Football themed Plot.ly layout \n    \"\"\"\n    layout = dict(\n        title = \"Player Activity\",\n        plot_bgcolor='darkseagreen',\n        showlegend=True,\n        xaxis=dict(\n            autorange=False,\n            range=[0, 120],\n            showgrid=False,\n            zeroline=False,\n            showline=True,\n            linecolor='black',\n            linewidth=1,\n            mirror=True,\n            ticks='',\n            tickmode='array',\n            tickvals=[10,20, 30, 40, 50, 60, 70, 80, 90, 100, 110],\n            ticktext=['Goal', 10, 20, 30, 40, 50, 40, 30, 20, 10, 'Goal'],\n            showticklabels=True\n        ),\n        yaxis=dict(\n            title='',\n            autorange=False,\n            range=[-3.3,56.3],\n            showgrid=False,\n            zeroline=False,\n            showline=True,\n            linecolor='black',\n            linewidth=1,\n            mirror=True,\n            ticks='',\n            showticklabels=False\n        ),\n        shapes=[\n            dict(\n                type='line',\n                layer='below',\n                x0=0,\n                y0=0,\n                x1=120,\n                y1=0,\n                line=dict(\n                    color='white',\n                    width=2\n                )\n            ),\n            dict(\n                type='line',\n                layer='below',\n                x0=0,\n                y0=53.3,\n                x1=120,\n                y1=53.3,\n                line=dict(\n                    color='white',\n                    width=2\n                )\n            ),\n            dict(\n                type='line',\n                layer='below',\n                x0=10,\n                y0=0,\n                x1=10,\n                y1=53.3,\n                line=dict(\n                    color='white',\n                    width=10\n                )\n            ),\n            dict(\n                type='line',\n                layer='below',\n                x0=20,\n                y0=0,\n                x1=20,\n                y1=53.3,\n                line=dict(\n                    color='white'\n                )\n            ),\n            dict(\n                type='line',\n                layer='below',\n                x0=30,\n                y0=0,\n                x1=30,\n                y1=53.3,\n                line=dict(\n                    color='white'\n                )\n            ),\n            dict(\n                type='line',\n                layer='below',\n                x0=40,\n                y0=0,\n                x1=40,\n                y1=53.3,\n                line=dict(\n                    color='white'\n                )\n            ),\n            dict(\n                type='line',\n                layer='below',\n                x0=50,\n                y0=0,\n                x1=50,\n                y1=53.3,\n                line=dict(\n                    color='white'\n                )\n            ),\n            dict(\n                type='line',\n                layer='below',\n                x0=60,\n                y0=0,\n                x1=60,\n                y1=53.3,\n                line=dict(\n                    color='white'\n                )\n            ),dict(\n                type='line',\n                layer='below',\n                x0=70,\n                y0=0,\n                x1=70,\n                y1=53.3,\n                line=dict(\n                    color='white'\n                )\n            ),dict(\n                type='line',\n                layer='below',\n                x0=80,\n                y0=0,\n                x1=80,\n                y1=53.3,\n                line=dict(\n                    color='white'\n                )\n            ),\n            dict(\n                type='line',\n                layer='below',\n                x0=90,\n                y0=0,\n                x1=90,\n                y1=53.3,\n                line=dict(\n                    color='white'\n                )\n            ),dict(\n                type='line',\n                layer='below',\n                x0=100,\n                y0=0,\n                x1=100,\n                y1=53.3,\n                line=dict(\n                    color='white'\n                )\n            ),\n            dict(\n                type='line',\n                layer='below',\n                x0=110,\n                y0=0,\n                x1=110,\n                y1=53.3,\n                line=dict(\n                    color='white',\n                    width=10\n                )\n            )\n        ]\n    )\n    return layout\n\nlayout = load_layout()","aadd40af":"# Load the movements of players in GameKey 280. \ngame280 = load_game_and_ngs('..\/input\/NGS-2016-reg-wk13-17.csv',GameKey=280)","2bdfd4a4":"# Plot a single play, with two players\nplot_play(game_df=game280, PlayID=2918, player1=32864, player2=32725)","8eb89def":"def plot_play_all_players(game_df, PlayID, custom_layout=False):\n    \"\"\"\n    Plots player movements on the field for a given game, play, and two players\n    \"\"\"\n    game_df = game_df[game_df.PlayID==PlayID]\n    \n    GameKey=str(pd.unique(game_df.GameKey)[0])\n    HomeTeam = pd.unique(game_df.Home_Team_Visit_Team)[0].split(\"-\")[0]\n    VisitingTeam = pd.unique(game_df.Home_Team_Visit_Team)[0].split(\"-\")[1]\n    player1 = game_df[(game_df.PlayID==PlayID)]['GSISID'].values[0]\n    YardLine = game_df[(game_df.PlayID==PlayID) & (game_df.GSISID==player1)]['YardLine'].iloc[0]\n    \n    traces=[]   \n    for player in pd.unique(game_df.GSISID):\n        player = int(player)\n        trace = go.Scatter(\n            x = game_df[game_df.GSISID==player].x,\n            y = game_df[game_df.GSISID==player].y,\n            name='GSISID '+str(player),\n            mode='markers'\n        )\n        traces.append(trace)\n    if custom_layout is not True:\n        layout = load_layout()\n        layout['title'] =  HomeTeam + \\\n        ' vs. ' + VisitingTeam + \\\n        '<br>Possession: ' + \\\n        YardLine.split(\" \")[0] +'@'+YardLine.split(\" \")[1]\n    data = traces\n    fig = dict(data=data, layout=layout)\n    play_description = game_df[(game_df.PlayID==PlayID) & (game_df.GSISID==player1)].iloc[0][\"PlayDescription\"]\n    print(\"\\n\\n\\t\",play_description)\n    offline.iplot(fig, config=config)","0402cc07":"plot_play_all_players(game_df=game280, PlayID=2918)","2a33f2ec":"pprd.head()","2b865e54":"\n# inputs\ncustom_layout = False\ngame_df=game280\nPlayID=2918\n\n\n# Function code\ngame_df = game_df[game_df.PlayID==PlayID]\n\nGameKey=str(pd.unique(game_df.GameKey)[0])\nHomeTeam = pd.unique(game_df.Home_Team_Visit_Team)[0].split(\"-\")[0]\nVisitingTeam = pd.unique(game_df.Home_Team_Visit_Team)[0].split(\"-\")[1]\nplayer1 = game_df[(game_df.PlayID==PlayID)]['GSISID'].values[0]\nYardLine = game_df[(game_df.PlayID==PlayID) & (game_df.GSISID==player1)]['YardLine'].iloc[0]\n\ntraces=[]   \nfor player in pd.unique(game_df.GSISID):\n    player = int(player)\n    trace = go.Scatter(\n        x = game_df[game_df.GSISID==player].x,\n        y = game_df[game_df.GSISID==player].y,\n        name='GSISID '+str(player),\n        mode='markers'\n    )\n    traces.append(trace)\nif custom_layout is not True:\n    layout = load_layout()\n    layout['title'] =  HomeTeam + \\\n    ' vs. ' + VisitingTeam + \\\n    '<br>Possession: ' + \\\n    YardLine.split(\" \")[0] +'@'+YardLine.split(\" \")[1]\ndata = traces\nfig = dict(data=data, layout=layout)\nplay_description = game_df[(game_df.PlayID==PlayID) & (game_df.GSISID==player1)].iloc[0][\"PlayDescription\"]\nprint(\"\\n\\n\\t\",play_description)\noffline.iplot(fig, config=config)","987356fb":"pprd.shape","8d7f3032":"pprd.head()","08a6cfa8":"# NFL Punt Analytics Competition - Starter EDA\n\n![punt](https:\/\/nbcprofootballtalk.files.wordpress.com\/2018\/12\/gettyimages-1067771316-e1543962247286.jpg?w=560&h=316&crop=1)\n\nIn this competition we are tasked with analzying punt plays for player safety and proposing rule changes.","ad4b927b":"## Data Overview\n- **Game Data**: Game level data that specifies the type of season (pre, reg, post), week, and hosting city and team. Each game is uniquely identified across all seasons\nusing `GameKey`.\n- **Play Information**: Play level data that describes the type of play, possession team, score and a brief narrative of each play. Plays are uniquely identified using a\nits `PlayID` along with the corresponding `GameKey`. `PlayIDs` are not unique.\n- **Player Punt Data**: Player level data that specifies the traditional football position for each player. Each player is identified using his `GSISID`.\n- **Play Player Role Data**: Play and player level data that specifies a punt specific player role. This dataset will specify each player that played in each play. A\nplayer\u2019s role in a play is uniquely defined by the `Gamekey` `PlayID` and `GSISID`.\n- **Video Review**: Injury level data that provides a detailed description of the concussion-producing event. Video Review data are only available in cases in which the\ninjury play can be identified. Each video review case can be identified using a combination of `GameKey`, `PlayID`, and `GSISID`. A brief narrative of the play events is\nprovided.\n- **NGS**: Next Gen Stats \u2013 player level data that describes the movement of each player during a play. NGS data is processed by BIOCORE to produce relevant speed and\ndirection data. The NGS data is identified using `GameKey`, `PlayID`, and `GSISID`. Player data for each play is provided as a function of time (Time) for the duration of\nthe play.\n\n![](https:\/\/storage.googleapis.com\/kaggle-media\/competitions\/NFL%20player%20safety%20analytics\/key_variables.jpg)","5329e739":"# Play information Dataset\n- 6681 Plays with information\n- Team names and Score\n- Position on the field\n- Time of play\n- All plays are punts","c02ce58d":"# Video Review Data (*concussion-producing event*)\n- 37 Video Review plays\n- 6 Have Friendly Fire, 28 don't, and 1 it's unclear ","b7d184c5":"## Player Role Data","01810cdf":"## Try modifying to see all player in a play","74ff3a0e":"A few notes after plotting all players:\n- It looks like anyone to stepped on the field during the time of the play is picked up. \n- This could just be players who were close on the sideline, or players who are coming on for the next play?\n- I think our main concern would be with the players most likely to take a high impact or the players injured.","4f747b30":"# Using @crawford 's starter code\n## Using provided starter code from here: https:\/\/www.kaggle.com\/crawford\/nfl-punt-analytics-starter-kernel","2538d434":"## Lets explore the smaller datasets","c8f893d1":"## Add player position to plots","d34fe8c4":"# Game Data `gd` for 666 games\n\n* Season_Year: NFL Season (YYYY)\n* Season_Type: Preseason (Pre), Regular season (Reg), Post season (Post)\n* GameKey: Numeric game identifier, unique across seasons (####)\n* Game_Date: Date of game (MM\/DD\/YYYY)\n* Week: Week number, defined within Season_Type (##)\n* Game_Day: Day of the week (text)\n* Game_Site: Hosting city (text)\n* Start_Time: Time at start of game (24:00:00)\n* Home_Team: Long format of hosting team (text)\n* HomeTeamCode Team abbreviation (ABC)\n* Visit_Team: Long format of visiting team (text)\n* VisitTeamCode: Team abbreviation (ABC)\n* Stadium: Stadium Name (text)\n* StadiumType: Indoor, outdoor or closure type - semi categorical (text)\n* Turf: Natural or type of synthetic turf (text)\n* GameWeather: Description of indoor weather, same as \"OutdoorWeather\" for open stadiums (text)\n* Temperature: Stadium temperature (Degrees F)\n* OutdoorWeather: Description of outdoor weather (free-form text)"}}