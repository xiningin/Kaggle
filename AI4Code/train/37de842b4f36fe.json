{"cell_type":{"9f8e3e0a":"code","fc652455":"code","1cbb6193":"code","91e2bda8":"code","8265c4d1":"code","5abc5428":"code","545ea806":"code","a41bc2d9":"code","8f93f3c3":"code","350b1cf9":"code","c2c1a913":"code","103e6919":"code","29455726":"code","410cd781":"code","4ea5d882":"code","8a219209":"code","9b58886d":"code","020c6c08":"code","2ae379e8":"code","92434789":"code","32682759":"code","4b19e94a":"code","b3036a52":"code","1961c7bb":"code","5bca956e":"code","881f7f4c":"code","5741b89c":"code","99463991":"code","005a4d1a":"code","733ff35e":"code","eb76dfc0":"code","1ba730dd":"code","b0918fd8":"code","049703cd":"code","cc899f78":"code","24a3f6cb":"code","844ce4bb":"code","c07bacc2":"code","db7e8444":"code","64eb1121":"markdown","2a9573ed":"markdown","64a20829":"markdown","7bd0dd73":"markdown","cdb3cbb9":"markdown","71e277ad":"markdown","9fb19b5e":"markdown","40593c30":"markdown","bfe678cd":"markdown","5e33f923":"markdown","d8af8599":"markdown","2d105845":"markdown","0721f416":"markdown","79fbe241":"markdown","45de3da6":"markdown","07e01668":"markdown"},"source":{"9f8e3e0a":"\nimport numpy as np \nimport pandas as pd\nimport seaborn as sns\nimport warnings\nfrom scipy.stats import chi2, chi2_contingency\n\n\nimport math as mt\nfrom scipy.stats import norm\nfrom scipy import stats\nimport matplotlib.pyplot as plt\nwarnings.simplefilter('ignore')","fc652455":"data = pd.read_csv(\"\/kaggle\/input\/ab-testing\/AdSmartABdata.csv\")","1cbb6193":"control = data[data['experiment'] == 'control']\nexposed = data[data['experiment'] == 'exposed']","91e2bda8":"control =control.reset_index(drop=True)\ncontrol","8265c4d1":"exposed =exposed.reset_index(drop=True)\nexposedParticipate = exposed[~((exposed['yes']== 0) & (exposed['no']== 0))]\nexposedNotParticipate =  exposed[(exposed['yes']== 0) & (exposed['no']== 0)]\ncontrol =control.reset_index(drop=True)\ncontrolParticipate = control[~((control['yes']== 0) & (control['no']== 0))]\ncontrolNotParticipate =  control[(control['yes']== 0) & (control['no']== 0)]","5abc5428":"print(len(exposedParticipate))\nprint(len(exposedNotParticipate))\nprint(len(exposed))","545ea806":"print(len(controlParticipate))\nprint(len(controlNotParticipate))\nprint(len(control))","a41bc2d9":"exposedParticipate= exposedParticipate.drop(columns='no')\ncontrolParticipate= controlParticipate.drop(columns='no')\nexposedNotParticipate= exposedNotParticipate.drop(columns='no')\ncontrolNotParticipate= controlNotParticipate.drop(columns='no')","8f93f3c3":"controlParticipate['clicked'] = 1\nexposedParticipate['clicked'] = 1\ncontrolNotParticipate['clicked']= 0\nexposedNotParticipate['clicked'] = 0 ","350b1cf9":"controlParticipate=controlParticipate.append(controlNotParticipate,ignore_index = True)\nexposedParticipate=exposedParticipate.append(exposedNotParticipate,ignore_index = True)","c2c1a913":"exposedParticipate = exposedParticipate.rename(columns={'yes': 'aware'})\ncontrolParticipate = controlParticipate.rename(columns={'yes': 'aware'})","103e6919":"print(len(controlParticipate))\nprint(len(exposedParticipate))","29455726":"metrics_control = controlParticipate[['date','clicked','aware', 'experiment']]\nmetrics_exposed = exposedParticipate[['date','clicked','aware','experiment']]","410cd781":"total =metrics_control.append(metrics_exposed)","4ea5d882":"total=total.groupby('experiment').sum()","8a219209":"total.loc['control', 'users' ]= 4071\ntotal.loc['exposed', 'users' ]= 4006\ntotal= total.T\ntotal=total.sort_values('control', ascending=False)","9b58886d":"total","020c6c08":"control_user = total.loc['users','control']\ncontrol_clicks = total.loc['clicked','control']\ncontrol_aware = total.loc['aware', 'control']\n\nexp_user = total.loc['users','exposed']\nexp_clicks = total.loc['clicked', 'exposed']\nexp_aware = total.loc['aware', 'exposed']\n\nuser_total = control_user + exp_user\nclicks_total = control_clicks + exp_clicks\naware_total = control_aware + exp_aware","2ae379e8":"def get_z_score(alpha):\n    return norm.ppf(alpha)","92434789":"p=0.5\nalpha=0.05\np_hat=round(control_user\/(user_total),4)\nsd=mt.sqrt(p*(1-p)\/(user_total))\nME=round(get_z_score(1-(alpha\/2))*sd,4)\nprint (\"The confidence interval is between\",p-ME,\"and\",p+ME,\"; Is\",p_hat,\"inside this range?\")","32682759":"ME","4b19e94a":"p_hat=round(control_clicks\/clicks_total,4)\nsd=mt.sqrt(p*(1-p)\/clicks_total)\nME=round(get_z_score(1-(alpha\/2))*sd,4)\nprint (\"The confidence interval is between\",p-ME,\"and\",p+ME,\"; Is\",p_hat,\"inside this range?\")","b3036a52":"control_ctp = control_clicks \/ control_user\nexp_ctp = exp_clicks \/ exp_user\nd_hat = round(exp_ctp - control_ctp,4)\np_pooled =  clicks_total\/ user_total\nsd_pooled = np.sqrt(p_pooled * (1 - p_pooled * (1 \/ control_user + 1 \/ exp_user)))\nME=round(get_z_score(1-(alpha\/2))*sd_pooled,4)\nprint (\"The confidence interval is between\",0-ME,\"and\",0+ME,\"and d_hat is\",d_hat)","1961c7bb":"AW_cont= control_aware\/control_clicks\nAW_exp=exp_aware\/exp_clicks\nAW_pooled=(control_aware+exp_aware)\/(control_clicks+exp_clicks)\nAW_sd_pooled=mt.sqrt(AW_pooled*(1-AW_pooled)*(1\/control_clicks+1\/exp_clicks))\nAW_ME=round(get_z_score(1-alpha\/2)*AW_sd_pooled,4)\nAW_diff=round(AW_exp-AW_cont,4)\nprint(\"The change due to the experiment is\",AW_diff*100,\"%\")\nprint(\"Confidence Interval: [\",AW_diff-AW_ME,\",\",AW_diff+AW_ME,\"]\")\nprint (\"The change is statistically significant if the CI doesn't include 0.\")","5bca956e":"l = metrics_control.groupby('date').sum()\nn = metrics_exposed.groupby('date').sum()","881f7f4c":"n","5741b89c":" metrics =l.join(n, on=None, how='left', lsuffix='_contr', rsuffix='_expos', sort=False)","99463991":"metrics","005a4d1a":"# Perfect! Now, derive a new column for each metric, so we have it's daily values\n# We need a 1 if the experiment value is greater than the control value\nmetrics['rate_aware_cont']=metrics['aware_contr']\/metrics['clicked_contr']\nmetrics['rate_aware_exp']=metrics['aware_expos']\/metrics['clicked_expos']\nmetrics['AW'] = np.where(metrics['rate_aware_cont']< metrics['rate_aware_exp'],1,0)\nmetrics","733ff35e":"aw_x = metrics.AW[metrics['AW']==1].count()\nn = metrics.AW.count()\n","eb76dfc0":"def get_prob(x,n):\n    p=round(mt.factorial(n)\/(mt.factorial(x)*mt.factorial(n-x))*0.5**x*0.5**(n-x),4)\n    return p\n#next a function to compute the pvalue from probabilities of maximum x\ndef get_2side_pvalue(x,n):\n    p=0\n    for i in range(0,x+1):\n        p=p+get_prob(i,n)\n    return 2*p","1ba730dd":"print (\"Awareness Change is significant if\",get_2side_pvalue(aw_x,n),\"is greater than 0.05\")","b0918fd8":"!pip install git+https:\/\/github.com\/dmarinere\/Sequential-Probability-Ratio-Test","049703cd":"import sprt as sprt","cc899f78":"total","24a3f6cb":"h0 = control_clicks\/clicks_total\nh1 = exp_clicks\/clicks_total","844ce4bb":"values = control.yes[~((control['yes']== 0) & (control['no']== 0))].values\n","c07bacc2":"\n# Type I error rate = 0.05\nalpha = 0.05\n# Type II error rate = 0.2\nbeta = 0.2\ntest = sprt.SPRTBinomial(h0 = h0, h1 = h1, alpha = alpha, beta = beta, values = values)","db7e8444":"test.plot()","64eb1121":" Next we check the Click through Probability","2a9573ed":"### Sanity Check on our total number of Users\n","64a20829":"There was an increase everyday, which was measured here, but the increase wasn't much across board, the Binomial Probability cannot measure this efffectively, we are not taking this into account","7bd0dd73":"Creating our null and Alternative Hypothesis","cdb3cbb9":"yes it is so we have passed another sanity check since clicks in the control in the range of our upper and lower interval","71e277ad":"Yes it is so we can move to checking if the Click in our data  ","9fb19b5e":"### Hypothesis Testing Notebook","40593c30":"We notice and increase in awareness of our brand almost everyday, except on the 10th which is the last day and assumption are that maybe we stopped early","bfe678cd":"Creating our values data which signify those who participated in the survey","5e33f923":" > ### Parametric Method","d8af8599":"### Sequential Testing of our Hypothesis ","2d105845":"### We can now do our analysis for the increase in the number of yes, which is our metrics to prove increase in Brand Awareness, we would use Parametric and Non Parametric Methods","0721f416":"### Importing a library that would make it easier to do sequential testing","79fbe241":"The Click Through Probability which represents the number of people who filled our survey is around the same confidence interval for both Control and Exposed, we can now start our Analysis","45de3da6":"According to this result there was a change due to the experiment,the change include zero which means it is not statistically significant, it still occurs in the range of our Control Data\n","07e01668":"Let us try to find the change perday for our metric\n"}}