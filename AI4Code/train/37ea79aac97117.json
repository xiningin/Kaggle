{"cell_type":{"605c90da":"code","5de7fdf0":"code","d107f8e8":"code","582f1cd1":"code","1ffb93d3":"code","0ac13452":"code","a4030dd1":"code","0c3f6052":"code","f2465ad7":"code","48fcf32a":"code","f69d87a7":"code","2cab888f":"code","96aa4f7e":"code","d741a370":"code","0871c830":"code","c4327a7a":"code","f719f301":"code","c6c5bc55":"code","4a628f8e":"code","49a1d317":"code","1e6a815d":"code","64c2df23":"code","a5256275":"code","8bd8736a":"code","3d6cb727":"code","6c4e241e":"code","9c4318da":"code","bd4e0611":"code","7b7aa359":"code","5f308432":"code","204d7f3d":"markdown","746adc72":"markdown","f911b337":"markdown","b0d96d84":"markdown","8bb8ccd2":"markdown","c6aaef6a":"markdown"},"source":{"605c90da":"#!pip install spacy","5de7fdf0":"#!python -m spacy download en_core_web_sm","d107f8e8":"#!python -m spacy validate","582f1cd1":"#all necessary imports\nimport spacy\nimport numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nfrom collections import defaultdict\nimport glob\nimport re","1ffb93d3":"files = glob.glob('..\/input\/avatar-the-last-airbender-transcripts-subtitles\/*.csv')","0ac13452":"def get_book_number(item):\n    m = re.search(\"_(\\d)_(\\d*).*\\.csv\",item)\n    return int(m.string[m.start(1):m.end(1)])","a4030dd1":"def get_eisode_number(item):\n    m = re.search(\"_(\\d)_(\\d*).*\\.csv\",item)\n    return int(m.string[m.start(2):m.end(2)])","0c3f6052":"files.sort(key=get_eisode_number)\nfiles.sort(key=get_book_number)","f2465ad7":"df_list = []\nfor f in files:\n    df = pd.read_csv(f, sep=\",\", header=None, names=[\"Character\", \"Utterance\"])\n    episode_number = get_eisode_number(f)\n    book_number = get_book_number(f)\n    df[\"Book\"] = book_number\n    df[\"Episode\"] = episode_number\n    df_list.append(df)\n    \ntranscripts = pd.concat(df_list, axis=0, ignore_index=True)","48fcf32a":"transcripts.sample(3, random_state=20)['Utterance'].to_list()","f69d87a7":"transcripts[['Book','Episode']].drop_duplicates().shape[0]","2cab888f":"transcripts.info()","96aa4f7e":"ax = sns.barplot(x=\"Book\", y=\"Utterance\", data=transcripts.groupby('Book').count().reset_index())\nax.set_title(\"Total number of lines per book\")\nplt.show()","d741a370":"total_lines_per_person = transcripts.groupby(\"Character\").count()","0871c830":"top_15_characters_lines = total_lines_per_person.sort_values(by=\"Utterance\", ascending=False).head(15).reset_index()","c4327a7a":"plt.figure(figsize=(20,4))\nax = sns.barplot(x=\"Character\", y=\"Utterance\", data=top_15_characters_lines)\nax.set_title(\"Top 15 characters with the most lines overall\")\nplt.show()","f719f301":"top_15_characters = top_15_characters_lines['Character'].to_list()\ntotal_lines_per_book = transcripts.groupby([\"Character\", \"Book\"]).count().loc[top_15_characters].reindex(top_15_characters, level=0)","c6c5bc55":"plt.figure(figsize=(20,4))\nax = sns.barplot(x=\"Character\", y=\"Utterance\", hue=\"Book\", data=total_lines_per_book.reset_index(), palette=\"rocket\")\nax.set_title(\"Number of lines per Book for the same top 15 characters\")\nplt.show()","4a628f8e":"nlp = spacy.load(\"en_core_web_sm\")","49a1d317":"def count_verbs_adj_noun(texts):\n    verb_count = defaultdict(int)\n    adj_count = defaultdict(int)\n    noun_count = defaultdict(int)\n\n    for line in texts:\n        doc = nlp(line)\n        for token in doc:\n            if token.is_stop:\n                continue\n            if token.pos_ == 'VERB':\n                verb_count[token.lemma_] += 1\n            elif token.pos_ == 'ADJ':\n                adj_count[token.lemma_] += 1\n            elif token.pos_ == 'NOUN':\n                noun_count[token.lemma_] += 1\n    return verb_count, adj_count, noun_count","1e6a815d":"def top_10_tokens(tokens_dict):\n    return sorted(tokens_dict.items(), key=lambda kv: kv[1], reverse=True)[:10]","64c2df23":"verb_count, adj_count, noun_count = count_verbs_adj_noun(transcripts['Utterance'].to_list())","a5256275":"top_10_verbs = top_10_tokens(verb_count)\ntop_10_adjectives = top_10_tokens(adj_count)\ntop_10_nouns = top_10_tokens(noun_count)","8bd8736a":"fig, axes = plt.subplots(1, 3, figsize=(26, 6))\naxes[0].bar([x[0] for x in top_10_verbs], [x[1] for x in top_10_verbs])\naxes[0].set_title(\"Top 10 verbs\")\naxes[1].bar([x[0] for x in top_10_adjectives], [x[1] for x in top_10_adjectives])\naxes[1].set_title(\"Top 10 adjectives\")\naxes[2].bar([x[0] for x in top_10_nouns], [x[1] for x in top_10_nouns])\naxes[2].set_title(\"Top 10 nouns\")\nplt.show()","3d6cb727":"zuko_lines = transcripts[transcripts[\"Character\"] == \"Zuko\"][\"Utterance\"].to_list()\nzuko_verb_count, zuko_adj_count, zuko_noun_count = count_verbs_adj_noun(zuko_lines)\nzuko_top_10_verbs = top_10_tokens(zuko_verb_count)\nzuko_top_10_adjectives = top_10_tokens(zuko_adj_count)\nzuko_top_10_nouns = top_10_tokens(zuko_noun_count)","6c4e241e":"fig, axes = plt.subplots(1, 3, figsize=(26, 6))\naxes[0].bar([x[0] for x in zuko_top_10_verbs], [x[1] for x in zuko_top_10_verbs])\naxes[0].set_title(\"Top 10 verbs spoken by Zuko\")\naxes[1].bar([x[0] for x in zuko_top_10_adjectives], [x[1] for x in zuko_top_10_adjectives])\naxes[1].set_title(\"Top 10 adjectives spoken by Zuko\")\naxes[2].bar([x[0] for x in zuko_top_10_nouns], [x[1] for x in zuko_top_10_nouns])\naxes[2].set_title(\"Top 10 nouns spoken by Zuko\")\nplt.show()","9c4318da":"def count_non_punct_tokens(text):\n    count = 0\n    doc = nlp(text)\n    for token in doc:\n        if not token.is_punct:\n            count += 1\n    return count","bd4e0611":"transcripts[\"Word_count\"] = transcripts[\"Utterance\"].apply(count_non_punct_tokens)","7b7aa359":"longest_lines = transcripts.sort_values(by=\"Word_count\", ascending=False).head(10).reset_index()","5f308432":"plt.figure(figsize=(20,8))\nax = sns.barplot(x=longest_lines[\"Word_count\"], y=longest_lines.index, orient='h')\nax.set_xlabel(\"Word count\")\nax.set_title(\"10 longest lines\")\nax.set_yticklabels(longest_lines[\"Character\"].to_list())\nfor index, item in enumerate(longest_lines[\"Utterance\"].to_list()):\n    ax.text(3, index, item[:175 + (-index)*6] + \"...\", color='white')\nplt.show()","204d7f3d":"### Using spacy's medium-sized English language model","746adc72":"Unsurprisingly, it's the main trio (Aang, Sokka & Katara) that speak the most.","f911b337":"## Avatar : The Last Airbender - EDA\n\nThis notebook analyses all transcipts downloaded via the scrape_episode_urls.py script. \n\nNote on the vocabulary used: A \"Book\" is equivalent to a season. An \"utterance\" or \"line\" is one or more sentences spoken by the same character; one line in the CSV files will correspond to one utterance.","b0d96d84":"There are 9912 total lines and 61 episodes split over 3 Books (seasons). ","8bb8ccd2":"It's interesting to see that Zuko's most-used nouns include the words \"father\", \"uncle\" and \"honor\".","c6aaef6a":"### Exploring the data"}}