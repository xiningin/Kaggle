{"cell_type":{"1b2b56c0":"code","a288379d":"code","df4d56f0":"code","7fb4394c":"code","95d2f27d":"code","e599e5bc":"code","2fd45c72":"code","8a6af69d":"code","7cb9d89f":"code","a89ee130":"code","cbaf0da4":"code","1a63fa1c":"code","e2b1bc4e":"code","bd8142a3":"code","99b5f07a":"code","28af3f29":"code","00a4d362":"code","55a13fe6":"code","b32c9652":"code","f5912f37":"code","488a29cb":"code","4c12de38":"code","97bf1f80":"code","da1d7cc0":"code","22ac27d2":"code","50c21a61":"markdown","296df4d8":"markdown","58c9c2a7":"markdown","0a56df59":"markdown","cb876ffa":"markdown","1858316f":"markdown","14341636":"markdown","6092d077":"markdown","733f6a54":"markdown","e236054e":"markdown","07ea99f7":"markdown","e164eda1":"markdown","7ed40b06":"markdown","0a6df84d":"markdown","d01c26dc":"markdown","8f514ef4":"markdown","e50af3cd":"markdown","5eab25eb":"markdown","b5a36ae5":"markdown","99a74797":"markdown","0b256a5f":"markdown","3ca59119":"markdown","0c4a2b76":"markdown","72d1db90":"markdown","c49d25a0":"markdown","bef7c70e":"markdown","8a6a4f1d":"markdown","825df34a":"markdown","d7c45eb5":"markdown","4676b59a":"markdown","da4b143d":"markdown","3f8d678a":"markdown","a0b876a0":"markdown","8aa31849":"markdown"},"source":{"1b2b56c0":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport seaborn as sns\nsns.set(context=\"notebook\", palette=\"Spectral\", style = 'darkgrid' ,font_scale = 1.5, color_codes=True)\nimport warnings\nwarnings.filterwarnings('ignore')\nimport os\nimport matplotlib.pyplot as plt","a288379d":"ad_data = pd.read_csv('..\/input\/Advertising.csv',index_col='Unnamed: 0')","df4d56f0":"ad_data.info()","7fb4394c":"ad_data.describe()","95d2f27d":"p = sns.pairplot(ad_data)","e599e5bc":"# visualize the relationship between the features and the response using scatterplots\np = sns.pairplot(ad_data, x_vars=['TV','Radio','Newspaper'], y_vars='Sales', size=7, aspect=0.7)","2fd45c72":"x = ad_data.drop([\"Sales\"],axis=1)\ny = ad_data.Sales","8a6af69d":"from sklearn.preprocessing import StandardScaler\nsc = StandardScaler()\nX = sc.fit_transform(x)","7cb9d89f":"from sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(X, y,random_state = 0,test_size=0.25)","a89ee130":"from sklearn.metrics import mean_absolute_error\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn.metrics import r2_score\nfrom sklearn import linear_model\n\nregr = linear_model.LinearRegression()\nregr.fit(X_train,y_train)\ny_pred = regr.predict(X_train)","cbaf0da4":"print(\"R squared: {}\".format(r2_score(y_true=y_train,y_pred=y_pred)))","1a63fa1c":"residuals = y_train.values-y_pred\nmean_residuals = np.mean(residuals)\nprint(\"Mean of Residuals {}\".format(mean_residuals))","e2b1bc4e":"p = sns.scatterplot(y_pred,residuals)\nplt.xlabel('y_pred\/predicted values')\nplt.ylabel('Residuals')\nplt.ylim(-10,10)\nplt.xlim(0,26)\np = sns.lineplot([0,26],[0,0],color='blue')\np = plt.title('Residuals vs fitted values plot for homoscedasticity check')","bd8142a3":"import statsmodels.stats.api as sms\nfrom statsmodels.compat import lzip\nname = ['F statistic', 'p-value']\ntest = sms.het_goldfeldquandt(residuals, X_train)\nlzip(name, test)","99b5f07a":"from scipy.stats import bartlett\ntest = bartlett( X_train,residuals)\nprint(test)","28af3f29":"p = sns.distplot(residuals,kde=True)\np = plt.title('Normality of error terms\/residuals')","00a4d362":"plt.figure(figsize=(10,5))\np = sns.lineplot(y_pred,residuals,marker='o',color='blue')\nplt.xlabel('y_pred\/predicted values')\nplt.ylabel('Residuals')\nplt.ylim(-10,10)\nplt.xlim(0,26)\np = sns.lineplot([0,26],[0,0],color='red')\np = plt.title('Residuals vs fitted values plot for autocorrelation check')","55a13fe6":"from statsmodels.stats import diagnostic as diag\nmin(diag.acorr_ljungbox(residuals , lags = 40)[1])","b32c9652":"import statsmodels.api as sm","f5912f37":"# autocorrelation\nsm.graphics.tsa.plot_acf(residuals, lags=40)\nplt.show()","488a29cb":"# partial autocorrelation\nsm.graphics.tsa.plot_pacf(residuals, lags=40)\nplt.show()","4c12de38":"plt.figure(figsize=(20,20))  # on this line I just set the size of figure to 12 by 10.\np=sns.heatmap(ad_data.corr(), annot=True,cmap='RdYlGn',square=True)  # seaborn has very simple solution for heatmap","97bf1f80":"from sklearn.tree import DecisionTreeRegressor\n\ndec_tree = DecisionTreeRegressor(random_state=0)\ndec_tree.fit(X_train,y_train)\ndec_tree_y_pred = dec_tree.predict(X_train)\nprint(\"Accuracy: {}\".format(dec_tree.score(X_train,y_train)))\nprint(\"R squared: {}\".format(r2_score(y_true=y_train,y_pred=dec_tree_y_pred)))","da1d7cc0":"from sklearn.ensemble import RandomForestRegressor\n\nrf_tree = RandomForestRegressor(random_state=0)\nrf_tree.fit(X_train,y_train)\nrf_tree_y_pred = rf_tree.predict(X_train)\nprint(\"Accuracy: {}\".format(rf_tree.score(X_train,y_train)))\nprint(\"R squared: {}\".format(r2_score(y_true=y_train,y_pred=rf_tree_y_pred)))","22ac27d2":"from sklearn.svm import SVR\n\nsvr = SVR()\nsvr.fit(X_train,y_train)\nsvr_y_pred = svr.predict(X_train)\nprint(\"Accuracy: {}\".format(svr.score(X_train,y_train)))\nprint(\"R squared: {}\".format(r2_score(y_true=y_train,y_pred=svr_y_pred)))","50c21a61":"### Since p value is more than 0.05 in Goldfeld Quandt Test, we can't reject it's null hypothesis that error terms are homoscedastic. Good.","296df4d8":"##  Goldfeld Quandt Test\nChecking heteroscedasticity : Using Goldfeld Quandt we test for heteroscedasticity.\n* Null Hypothesis: Error terms are homoscedastic\n* Alternative Hypothesis: Error terms are heteroscedastic.","58c9c2a7":"### Bartlett\u2019s test tests the null hypothesis that all input samples are from populations with equal variances. ","0a56df59":"### Since p value is quite less than 0.05 in Bartlett, it's null hypothesis that error terms are homoscedastic gets rejected, that's not good for a regression.","cb876ffa":"### Now we will be applying tests. \nA tip is to keep in mind that if we want 95% confidence on our findings and tests then the p-value should be less than 0.05 to be able to reject the null hypothesis. Remember, a researcher or data scientist would always aim to reject the null hypothesis.","1858316f":"### Very close to zero so all good here.","14341636":"### Residuals as we know are the differences between the true value and the predicted value. One of the assumptions of linear regression is that the mean of the residuals should be zero. So let's find out.\n","6092d077":"## This notebook explains the assumptions of linear regression in detail. One of the most essential steps to take before applying linear regression and depending solely on accuracy scores is to check for these assumptions.","733f6a54":"Table of Content\n<br><a href=\"#linearity\">1. Linearity<\/a>\n<br><a href=\"#mean\">2. Mean of Residuals<\/a>\n<br><a href=\"#homo\">3. Check for Homoscedasticity<\/a>\n<br><a href=\"#normal\">4. Check for Normality of error terms\/residuals<\/a>\n<br><a href=\"#auto\">5. No autocorrelation of residuals<\/a>\n<br><a href=\"#multico\">6. No perfect multicollinearity<\/a>\n<br><a href=\"#other\">7. Other Models for comparison<\/a>\n","e236054e":"### Note that the scores are high because I have used the same data for training and testing. This also shows how significant data splitting, train_test_split() etc. are. This is only for model exploration purposes. Moreover there's almost no hyperparameter tuning done at this point to make this a simple representation but tuning can highly improve the kind of learning that the model can achieve and keep overfitting away.","07ea99f7":"### Look for correlation of rows where the dependent variable (Sales in this case) is not involved because if a variable is correlated with the dependent variable then this would be a good sign for our model. Correlation within dependent variables is what we need to look for and avoid. This data doesn't contain perfect multicollinearity among independent variables. In case there was any then we would try to remove one of the correlated variables depending on which was more important to our regression model.","e164eda1":"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX","7ed40b06":"### When the residuals are autocorrelated, it means that the current value is dependent of the previous (historic) values and that there is a definite unexplained pattern in the Y variable that shows up in the error terms. Though it is more evident in time series data.\n\n#### In plain terms autocorrelation takes place when there's a pattern in the rows of the data. This is usual in time series data as there is a pattern of time for eg. Week of the day effect which is a very famous pattern seen in stock markets where people tend to buy stocks more towards the beginning of weekends and tend to sell more on Mondays. There's been great study about this phenomenon and it is still a matter of research as to what actual factors cause this trend.\n\n### There should not be autocorrelation in the data so the error terms should not form any pattern.","0a6df84d":"## <a id=\"mean\">2. Mean of Residuals<\/a>","d01c26dc":"### Since p value is less than 0.05 we reject the null hypothesis that error terms are not autocorrelated.","8f514ef4":"### The results show signs of autocorelation since there are spikes outside the red confidence interval region. This could be a factor of seasonality in the data.","e50af3cd":"## <a id=\"normal\">4. Check for Normality of error terms\/residuals<\/a>","5eab25eb":"### Fitting the linear model","b5a36ae5":"## <a id=\"auto\">5. No autocorrelation of residuals<\/a>","99a74797":"### In regression, multicollinearity refers to the extent to which independent variables are correlated. Multicollinearity affects the coefficients and p-values, but it does not influence the predictions, precision of the predictions, and the goodness-of-fit statistics. If your primary goal is to make predictions, and you don\u2019t need to understand the role of each independent variable, you don\u2019t need to reduce severe multicollinearity.","0b256a5f":"# So most of the major assumptions of Linear Regression are successfully through. Great! Since this was one of the simplest data sets it demonstrated the steps well. These steps can be applied on other problems to be able to make better decisions about which model to use. I hope this acts as a decent template of sort to be applied to data.","3ca59119":"### Homoscedasticity means that the residuals have equal or almost equal variance across the regression line. By plotting the error terms with predicted terms we can check that there should not be any pattern in the error terms.","0c4a2b76":"### The residual terms are pretty much normally distributed for the number of test points we took. Remember the central limit theorem which says that as the sample size increases the distribution tends to be normal. A skew is also visible from the plot. It's very difficult to get perfect curves, distributions in real life data.","72d1db90":"### By looking at the plots we can see that with the Sales variable the none of the independent variables form an accurately linear shape but TV and Radio do still better than Newspaper which seems to hardly have any specific shape. So it shows that a linear regression fitting might not be the best model for it. A linear model might not be able to *efficiently* explain the data in terms of variability, prediction accuracy etc. \n\nA tip is to remember to always see the plots from where the dependent variable is on the y axis. Though it wouldn't vary the shape much but that's how linear regression's intuition is, to put the dependent variable as y and independents as x(s).","c49d25a0":"## <a id=\"linearity\">1. Linearity<\/a>\n","bef7c70e":"### Now rest of the assumptions require us to perform the regression before we can even check for them. So let's perform regression on it.","8a6a4f1d":"# <a id=\"other\"> 7. Some other model evaluations for fun<\/a>","825df34a":"## <a id=\"multico\">6. No perfect multicollinearity<\/a>","d7c45eb5":"## <a id=\"homo\">3. Check for Homoscedasticity<\/a>","4676b59a":"### Detecting heteroscedasticity! \nGraphical Method: Firstly do the regression analysis and then plot the error terms against the predicted values( Yi^). If there is a definite pattern (like linear or quadratic or funnel shaped) obtained from the scatter plot then heteroscedasticity is present.","da4b143d":"#  Assumptions for Linear Regression","3f8d678a":"### Checking for autocorrelation To ensure the absence of autocorrelation we use Ljungbox test.\n* Null Hypothesis: Autocorrelation is absent.\n* Alternative Hypothesis: Autocorrelation is present.","a0b876a0":"Reference:\n* http:\/\/r-statistics.co\/Assumptions-of-Linear-Regression.html\n* https:\/\/www.statisticssolutions.com\/assumptions-of-linear-regression\/","8aa31849":" ### Linear regression needs the relationship between the independent and dependent variables to be linear.  Let's use a pair plot to check the relation of independent variables with the Sales variable"}}