{"cell_type":{"4337f740":"code","48b835f4":"code","f7bdb712":"code","b3f53b9c":"code","41c02b0a":"code","871a5add":"code","bc88c720":"code","c1393e72":"code","c36cca7b":"code","289e4841":"code","daedee7c":"code","cda7d87f":"code","dd52b761":"code","f2f5e733":"code","b79d088c":"code","9161b293":"code","f2167323":"code","423dc743":"code","b6275e66":"code","04e653e9":"code","97afa702":"code","a5ee8ecd":"code","1dfbe41a":"code","92b48fa9":"code","a5047a66":"code","0fcff21d":"code","b9e1edfa":"code","911c618b":"code","e2f72046":"code","44b18a65":"code","67fdc1db":"code","f6b120fa":"code","e7be667b":"code","5d3d46cd":"code","a21113d8":"code","48553531":"code","77a82770":"code","a89049c6":"code","90e047d8":"code","9b99b991":"code","ac765112":"code","905dacc0":"code","fee8b3c9":"code","3ee8b6dd":"code","20a52e83":"code","0bc177ff":"code","431265a3":"code","2a8899f8":"code","cb56675f":"code","07666625":"code","d16078fa":"code","e50d608a":"code","95b6a7ac":"code","f3e25b93":"code","57a82287":"code","c8385277":"code","4929aae7":"code","15536624":"code","d57abe19":"code","3e675207":"code","14edc580":"code","bf0acfd5":"code","fe92eed2":"code","11eb00ab":"code","f622e841":"code","4f547b33":"code","8e18587a":"code","c9daeab3":"code","f2dbf973":"code","efa8c0cc":"code","63141487":"code","088b1632":"code","afda3348":"code","245b6f9d":"code","32c9062f":"code","5b6da752":"code","0e70b54c":"code","8344df7c":"code","c999e18d":"code","43717681":"code","e47bd04c":"code","6978d36e":"code","bbc81159":"code","8cea6274":"code","d8c3eb30":"code","1245a175":"code","7f7a008b":"code","7ba7576b":"code","304fbf69":"code","bb27b12a":"code","738dfb75":"code","33f85f5a":"code","a3fb0397":"code","1b5bdb6b":"markdown","8593e9d2":"markdown","a289c300":"markdown","9b5ab03a":"markdown","d2deae63":"markdown","7c21dca7":"markdown","b41da14b":"markdown","7b765501":"markdown","fdf9e681":"markdown","af3fb630":"markdown","0c4bf579":"markdown"},"source":{"4337f740":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv\nfrom xgboost import XGBRegressor\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.model_selection import RandomizedSearchCV,cross_val_score\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn.metrics import make_scorer\nfrom itertools import product\nimport re\nimport nltk\nfrom nltk import word_tokenize\nfrom nltk.corpus import stopwords\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\n# Any results you write to the current directory are saved as output.","48b835f4":"!pip install pymorphy2\n!pip install pymorphy2-dicts\n!pip install DAWG-Python","f7bdb712":"import pymorphy2","b3f53b9c":"sample_submissions=pd.read_csv(\"..\/input\/competitive-data-science-predict-future-sales\/sample_submission.csv\")\nsales_train_df=pd.read_csv(\"..\/input\/competitive-data-science-predict-future-sales\/sales_train.csv\")\ntest_df=pd.read_csv(\"..\/input\/competitive-data-science-predict-future-sales\/test.csv\")\nitems_df=pd.read_csv(\"..\/input\/competitive-data-science-predict-future-sales\/items.csv\")\nshops_df=pd.read_csv(\"..\/input\/competitive-data-science-predict-future-sales\/shops.csv\")\nitem_categories_df=pd.read_csv(\"..\/input\/competitive-data-science-predict-future-sales\/item_categories.csv\")","41c02b0a":"sample_submissions.head()","871a5add":"sales_train_df.head()","bc88c720":"sales_train_df.info()","c1393e72":"test_df.head()","c36cca7b":"test_df.info()","289e4841":"sales_train_df.describe()","daedee7c":"test_df.describe()","cda7d87f":"# Reduce data size if running on kernel\nimport os\n\ndef debug_mode():\n    kaggle_kernel_run_type = os.environ.get('KAGGLE_KERNEL_RUN_TYPE','')\n\n    if kaggle_kernel_run_type == 'Batch':\n        debug_mode = False\n    elif kaggle_kernel_run_type == 'Interactive':\n        debug_mode = True\n    elif kaggle_kernel_run_type == '':\n        debug_mode = True\n    return debug_mode\n\ndebug_mode = debug_mode()","dd52b761":"if debug_mode:\n    frac = 0.001\n    #frac = 1.0\n    sales_train_df = sales_train_df.sample(frac=frac, random_state=42)\n    print(sales_train_df.shape)","f2f5e733":"sales_train_df=sales_train_df.join(shops_df.set_index(\"shop_id\"),on=\"shop_id\",how=\"left\").join(\nitems_df.set_index(\"item_id\"),on=\"item_id\",how=\"left\").join(item_categories_df.set_index(\"item_category_id\")\n                                                              ,on=\"item_category_id\",how=\"left\")","b79d088c":"test_df=test_df.join(shops_df.set_index(\"shop_id\"),on=\"shop_id\",how=\"left\").join(\nitems_df.set_index(\"item_id\"),on=\"item_id\",how=\"left\").join(item_categories_df.set_index(\"item_category_id\")\n                                                              ,on=\"item_category_id\",how=\"left\")\ntest_df.head().T","9161b293":"plt.figure(figsize=(20,6))\nsales_train_df[\"item_category_id\"].hist(bins=84)","f2167323":"plt.figure(figsize=(20,6))\ntest_df[\"item_category_id\"].hist(bins=84)","423dc743":"sns.relplot(x=\"item_price\",y=\"item_cnt_day\",height=9,aspect=1,data=sales_train_df)","b6275e66":"sales_train_df[sales_train_df.item_cnt_day>2000]","04e653e9":"sales_train_df[sales_train_df.item_category_id==9][\"item_cnt_day\"].mean()","97afa702":"sales_train_df[sales_train_df.item_id==11373][\"item_cnt_day\"].mean()","a5ee8ecd":"sales_train_df[(sales_train_df.shop_id==12)&(sales_train_df.item_id==11373)][\"item_cnt_day\"].mean()","1dfbe41a":"sales_train_df=sales_train_df[~sales_train_df.isin(sales_train_df[sales_train_df.item_cnt_day>2000])]","92b48fa9":"sales_train_df[sales_train_df.item_price>50000]","a5047a66":"sales_train_df=sales_train_df[~sales_train_df.isin(sales_train_df[sales_train_df.item_price>50000])]","0fcff21d":"sales_train_df[sales_train_df.item_cnt_day>800]","b9e1edfa":"sales_train_df[sales_train_df.item_id==20949][\"item_cnt_day\"].mean()","911c618b":"sales_train_df[(sales_train_df.shop_id==12)&(sales_train_df.item_id==20949)][\"item_cnt_day\"].mean()","e2f72046":"sales_train_df=sales_train_df[~sales_train_df.isin(sales_train_df[sales_train_df.item_cnt_day>800])]","44b18a65":"item_id_uniq=pd.unique(sales_train_df[\"item_id\"])","67fdc1db":"test_unique_items=test_df[~test_df[\"item_id\"].isin(item_id_uniq)]\ntest_unique_items.head()","f6b120fa":"%%time\ntrain=[]\ncol=[\"date_block_num\",\"shop_id\",\"item_id\"]\nfor i in range(34):\n  sales=sales_train_df[sales_train_df.date_block_num==i]\n  train.append(np.array(list(product([i],sales.shop_id.unique(),sales.item_id.unique())),dtype=\"int16\"))\ntrain=pd.DataFrame(np.vstack(train),columns=col)\ntrain[\"date_block_num\"]=train[\"date_block_num\"].astype(np.int8)\ntrain[\"shop_id\"]=train[\"shop_id\"].astype(np.int8)\ntrain[\"item_id\"]=train[\"item_id\"].astype(np.int16)","e7be667b":"month_df=sales_train_df[[\"date_block_num\",\"shop_id\",\"item_id\",\"item_cnt_day\"]].groupby([\"date_block_num\",\"shop_id\",\"item_id\"]).sum()","5d3d46cd":"date_block_total=month_df.reset_index()\ndate_block_total_group=date_block_total[[\"date_block_num\",\"item_cnt_day\"]].groupby(\"date_block_num\",as_index=False).sum()","a21113d8":"date_block_total[\"year\"]=date_block_total.date_block_num.apply(lambda x:((x\/\/12)+2013))\ndate_block_total[\"month\"]=date_block_total.date_block_num.apply(lambda x: (x%12))","48553531":"total_month=date_block_total[[\"month\",\"item_cnt_day\"]].groupby(\"month\",as_index=False).sum()","77a82770":"total_year=date_block_total[[\"year\",\"item_cnt_day\"]].groupby(\"year\",as_index=False).sum()","a89049c6":"train[\"year\"]=train.date_block_num.apply(lambda x:((x\/\/12)+2013))\ntrain[\"month\"]=train.date_block_num.apply(lambda x: (x%12))\ntrain[\"year\"]=train[\"year\"].astype(np.int16)\ntrain[\"month\"]=train[\"month\"].astype(np.int8)\ntrain.head()","90e047d8":"test_df=pd.read_csv(\"..\/input\/competitive-data-science-predict-future-sales\/test.csv\")\ntest_df[\"date_block_num\"]=34 # treat test set as 34th-month\ntest_df[\"year\"]=((34\/\/12)+2013)\ntest_df[\"month\"]=(34%12)\ntest_df[\"date_block_num\"]=test_df[\"date_block_num\"].astype(np.int8)\ntest_df[\"shop_id\"]=test_df[\"shop_id\"].astype(np.int8)\ntest_df[\"item_id\"]=test_df[\"item_id\"].astype(np.int16)\ntest_df[\"year\"]=test_df[\"year\"].astype(np.int16)\ntest_df[\"month\"]=test_df[\"month\"].astype(np.int8)\ntest_df.head()","9b99b991":"# Save categorical cols for later label encoding\ncategorical=[\"year\",\"month\"]","ac765112":"train=train.join(month_df,on=[\"date_block_num\",\"shop_id\",\"item_id\"],how=\"left\")\ntrain[\"item_cnt_day\"]=train[\"item_cnt_day\"].fillna(0).clip(0,20).astype(np.float16)","905dacc0":"train=pd.concat([train,test_df],ignore_index=True,sort=False,keys=col)\ntrain.fillna(0,inplace=True)","fee8b3c9":"def create_lag_features(df,feature):\n    numeric_features=[]\n    for i in range(1,7):\n        lagged=df.copy()\n        lagged=lagged[[\"date_block_num\",\"shop_id\",\"item_id\",feature]]\n        lagged.columns=[\"date_block_num\",\"shop_id\",\"item_id\",feature+\"_lag_\"+str(i)]\n        numeric_features.append(feature+\"_lag_\"+str(i))\n        lagged[\"date_block_num\"]+=i\n        df=df.join(lagged.set_index([\"date_block_num\",\"shop_id\",\"item_id\"]),on=[\"date_block_num\",\"shop_id\",\"item_id\"],how=\"left\")\n    return df,numeric_features","3ee8b6dd":"%%time\ntrain,n_col=create_lag_features(train,\"item_cnt_day\")\ntrain=train.fillna(0)\nnumeric=n_col","20a52e83":"total_cnt_for_items=sales_train_df[[\"date_block_num\",\"item_id\",\"item_cnt_day\"]].groupby([\"date_block_num\",\"item_id\"]).sum()\ntotal_cnt_for_items.columns=[\"total_cnt_for_items\"]","0bc177ff":"train=train.join(total_cnt_for_items,on=[\"date_block_num\",\"item_id\"],how=\"left\")\ntrain.fillna(0,inplace=True)\ntrain[\"total_cnt_for_items\"]=train[\"total_cnt_for_items\"].astype(np.float16)","431265a3":"%%time\ntrain,n_col=create_lag_features(train,\"total_cnt_for_items\")\ntrain=train.fillna(0)\ntrain=train.drop([\"total_cnt_for_items\"],axis=1)\nnumeric=numeric+n_col","2a8899f8":"total_cnt_for_shops=sales_train_df[[\"date_block_num\",\"shop_id\",\"item_cnt_day\"]].groupby([\"date_block_num\",\"shop_id\"]).sum()\ntotal_cnt_for_shops.columns=[\"total_cnt_for_shops\"]","cb56675f":"sum_cnt_shops=total_cnt_for_shops.reset_index()\ncnt_shops=sum_cnt_shops[[\"shop_id\",\"total_cnt_for_shops\"]].groupby(\"shop_id\",as_index=False).mean()\ncnt_shops=cnt_shops.join(shops_df.set_index([\"shop_id\"]),on=\"shop_id\",how=\"left\")","07666625":"cnt_shops.loc[cnt_shops.shop_name == '\u0421\u0435\u0440\u0433\u0438\u0435\u0432 \u041f\u043e\u0441\u0430\u0434 \u0422\u0426 \"7\u042f\"', 'shop_name'] = '\u0421\u0435\u0440\u0433\u0438\u0435\u0432\u041f\u043e\u0441\u0430\u0434 \u0422\u0426 \"7\u042f\"'\ncnt_shops['shop_city'] = cnt_shops['shop_name'].str.split(' ').map(lambda x: x[0])\ncnt_shops.loc[cnt_shops.shop_city == '!\u042f\u043a\u0443\u0442\u0441\u043a', 'shop_city'] = '\u042f\u043a\u0443\u0442\u0441\u043a'\ncnt_shops['shop_type'] = cnt_shops['shop_name'].str.split(' ').map(lambda x: x[1])","d16078fa":"sum_cnt_shop_city=cnt_shops[[\"shop_city\",\"total_cnt_for_shops\"]].groupby(\"shop_city\",as_index=False).sum()","e50d608a":"sum_cnt_shop_type=cnt_shops[[\"shop_type\",\"total_cnt_for_shops\"]].groupby(\"shop_type\",as_index=False).mean()","95b6a7ac":"train=train.join(cnt_shops[[\"shop_id\",\"shop_city\",\"shop_type\"]].set_index([\"shop_id\"]),on=\"shop_id\",how=\"left\")\ntrain.fillna(0,inplace=True)\ntrain[\"shop_city\"]=train[\"shop_city\"].astype(str)\ntrain[\"shop_type\"]=train[\"shop_type\"].astype(str)","f3e25b93":"categorical=categorical+[\"shop_city\",\"shop_type\"]","57a82287":"train=train.join(total_cnt_for_shops,on=[\"date_block_num\",\"shop_id\"],how=\"left\")\ntrain.fillna(0,inplace=True)\ntrain[\"total_cnt_for_shops\"]=train[\"total_cnt_for_shops\"].astype(np.float16)","c8385277":"%%time\ntrain,n_col=create_lag_features(train,\"total_cnt_for_shops\")\ntrain=train.fillna(0)\ntrain=train.drop([\"total_cnt_for_shops\"],axis=1)\nnumeric=numeric+n_col","4929aae7":"total_cnt_for_item_categories=sales_train_df[[\"date_block_num\",\"item_category_id\",\"item_cnt_day\"]].groupby([\"date_block_num\",\"item_category_id\"]).sum()\ntotal_cnt_for_item_categories.columns=[\"total_cnt_for_item_categories\"]","15536624":"sum_cnt_for_item_category=total_cnt_for_item_categories.reset_index()\nsum_cnt_for_item_category=sum_cnt_for_item_category[[\"item_category_id\",\"total_cnt_for_item_categories\"]].groupby(\"item_category_id\",as_index=False).sum()\nsum_cnt_for_item_category=sum_cnt_for_item_category.join(item_categories_df.set_index(\"item_category_id\"),on=[\"item_category_id\"],how=\"left\")","d57abe19":"sum_cnt_for_item_category[\"category\"]=sum_cnt_for_item_category.item_category_name.str.split(\"-\").str[0]\nsum_cnt_for_item_category[\"subcategory\"]=sum_cnt_for_item_category.item_category_name.str.split(\"-\").str[1]","3e675207":"sum_cnt_category=sum_cnt_for_item_category[[\"category\",\"total_cnt_for_item_categories\"]].groupby(\"category\",as_index=False).sum()","14edc580":"sum_cnt_subcategory=sum_cnt_for_item_category[[\"subcategory\",\"total_cnt_for_item_categories\"]].groupby(\"subcategory\",as_index=False).sum()","bf0acfd5":"train=train.join(items_df.set_index([\"item_id\"]),on=[\"item_id\"],how=\"left\")\ntrain=train.join(sum_cnt_for_item_category[[\"item_category_id\",\"category\",\"subcategory\"]].set_index([\"item_category_id\"]),on=[\"item_category_id\"],how=\"left\")\ntrain.fillna(0,inplace=True)\ntrain[\"category\"]=train[\"category\"].astype(str)\ntrain[\"subcategory\"]=train[\"subcategory\"].astype(str)","fe92eed2":"categorical=categorical+[\"category\",\"subcategory\"]","11eb00ab":"train=train.join(total_cnt_for_item_categories,on=[\"date_block_num\",\"item_category_id\"],how=\"left\")\ntrain.fillna(0,inplace=True)\ntrain[\"total_cnt_for_item_categories\"]=train[\"total_cnt_for_item_categories\"].astype(np.float16)","f622e841":"%%time\ntrain,n_col=create_lag_features(train,\"total_cnt_for_item_categories\")\ntrain=train.fillna(0)\ntrain=train.drop([\"total_cnt_for_item_categories\"],axis=1)\nnumeric=numeric+n_col","4f547b33":"mean_price=sales_train_df[[\"date_block_num\",\"shop_id\",\"item_id\",\"item_price\"]].groupby([\"date_block_num\",\"shop_id\",\"item_id\"]).mean()\nmean_price.columns=[\"mean_price\"]","8e18587a":"train=train.join(mean_price,on=[\"date_block_num\",\"shop_id\",\"item_id\"],how=\"left\")\ntrain.fillna(0,inplace=True)\ntrain[\"mean_price\"]=train[\"mean_price\"].astype(np.float16)","c9daeab3":"%%time\ntrain,n_col=create_lag_features(train,\"mean_price\")\ntrain=train.fillna(0)\ntrain=train.drop([\"mean_price\"],axis=1)\nnumeric=numeric+n_col","f2dbf973":"mean_price_for_items=sales_train_df[[\"date_block_num\",\"item_id\",\"item_price\"]].groupby([\"date_block_num\",\"item_id\"]).mean()\nmean_price_for_items.columns=[\"mean_price_for_items\"]","efa8c0cc":"train=train.join(mean_price_for_items,on=[\"date_block_num\",\"item_id\"],how=\"left\")\ntrain.fillna(0,inplace=True)\ntrain[\"mean_price_for_items\"]=train[\"mean_price_for_items\"].astype(np.float16)","63141487":"%%time\ntrain,n_col=create_lag_features(train,\"mean_price_for_items\")\ntrain=train.fillna(0)\ntrain=train.drop([\"mean_price_for_items\"],axis=1)\nnumeric=numeric+n_col","088b1632":"mean_price_for_item_categories=sales_train_df[[\"date_block_num\",\"item_category_id\",\"item_price\"]].groupby([\"date_block_num\",\"item_category_id\"]).mean()\nmean_price_for_item_categories.columns=[\"mean_price_for_item_categories\"]","afda3348":"train=train.join(mean_price_for_item_categories,on=[\"date_block_num\",\"item_category_id\"],how=\"left\")\ntrain.fillna(0,inplace=True)\ntrain[\"mean_price_for_item_categories\"]=train[\"mean_price_for_item_categories\"].astype(np.float16)","245b6f9d":"%%time\ntrain,n_col=create_lag_features(train,\"mean_price_for_item_categories\")\ntrain=train.fillna(0)\ntrain=train.drop([\"mean_price_for_item_categories\"],axis=1)\nnumeric=numeric+n_col","32c9062f":"sales_train_df[\"revenue\"]=sales_train_df[\"item_price\"]*sales_train_df[\"item_cnt_day\"]\ntotal_revenue=sales_train_df[[\"date_block_num\",\"shop_id\",\"revenue\"]].groupby([\"date_block_num\",\"shop_id\"]).sum()\ntotal_revenue.columns=[\"total_shop_revenue\"]","5b6da752":"train=train.join(total_revenue,on=[\"date_block_num\",\"shop_id\"],how=\"left\")\ntrain[\"total_shop_revenue\"]=train[\"total_shop_revenue\"].astype(np.float32)\ntrain.fillna(0,inplace=True)","0e70b54c":"%%time\ntrain,n_col=create_lag_features(train,\"total_shop_revenue\")\ntrain=train.fillna(0.0)\ntrain=train.drop([\"total_shop_revenue\"],axis=1)\nnumeric=numeric+n_col","8344df7c":"test_df=train[train.date_block_num==34]\ntrain=train[train.date_block_num<34]\ntrain=train[~train[\"date_block_num\"].isin([0,1,2,3,4,5])].reset_index(drop=True)\ntrain.head().T","c999e18d":"groups = train.groupby(train.date_block_num).groups\nsorted_groups = [value for (key, value) in sorted(groups.items())]\ncv=[(np.concatenate(sorted_groups[:8]),np.concatenate(sorted_groups[8:])),\n    (np.concatenate(sorted_groups[:16]),np.concatenate(sorted_groups[16:])),\n    (np.concatenate(sorted_groups[:24]),np.concatenate(sorted_groups[24:]))]","43717681":"y_train=train[\"item_cnt_day\"]","e47bd04c":"X_train_categorical=train[categorical]\nX_test_categorical=test_df[categorical]\nX_train_categorical[\"subcategory\"]=X_train_categorical[\"subcategory\"].astype(str)\nX_test_categorical[\"subcategory\"]=X_test_categorical[\"subcategory\"].astype(str)\nX_test_categorical[\"year\"]=X_test_categorical[\"year\"].astype(np.int16)\nX_test_categorical[\"month\"]=X_test_categorical[\"month\"].astype(np.int8)\nX_test_categorical.loc[X_test_categorical.category==\"PC \",\"category\"]=\"\u0418\u0433\u0440\u044b PC \"\nX_test_categorical.loc[X_test_categorical.subcategory==\" \u0413\u0430\u0440\u043d\u0438\u0442\u0443\u0440\u044b\/\u041d\u0430\u0443\u0448\u043d\u0438\u043a\u0438\",\"subcategory\"]=\" \u0410\u043a\u0441\u0435\u0441\u0441\u0443\u0430\u0440\u044b \u0434\u043b\u044f \u0438\u0433\u0440\"","6978d36e":"# Note: Make sure test set doesn't contain unseen labels in train set!\nfor feature in categorical:\n    le=LabelEncoder()\n    print(feature)\n    X_train_categorical[feature]=le.fit_transform(X_train_categorical[feature])\n    X_test_categorical[feature]=le.transform(X_test_categorical[feature])","bbc81159":"X_train_numeric=train[numeric]\nX_test_numeric=test_df[numeric]","8cea6274":"label_cat_not_num_train=pd.concat([X_train_categorical,X_train_numeric],axis=1)\nlabel_cat_not_num_train.head().T","d8c3eb30":"label_cat_not_num_test=pd.concat([X_test_categorical,X_test_numeric],axis=1)\nlabel_cat_not_num_test.head().T","1245a175":"label_cat_not_num_train.shape","7f7a008b":"def downcast_type(df):\n    for feature in categorical:\n        df[feature]=df[feature].astype(np.int8)","7ba7576b":"downcast_type(label_cat_not_num_train)\nlabel_cat_not_num_train.info()","304fbf69":"def RMSE(y,predictions):\n    return  np.sqrt(mean_squared_error(y,predictions))\nscorer=make_scorer(RMSE,False)","bb27b12a":"'''\n%%time \nbaseline = -cross_val_score(\n    XGBRegressor(max_depth=10,\n                 subsample=0.8,\n                 colsample_bytree=0.9,\n                 colsample_bylevel=0.7,\n                 min_child_weight=200,\n                 n_estimators=1000,\n                 learning_rate=0.025,\n                 objective=\"reg:squarederror\",\n                 tree_method=\"hist\"), label_cat_not_num_train, y_train, scoring=scorer,cv=cv\n).mean()\nprint(baseline)\n'''","738dfb75":"%%time\nestimator=XGBRegressor(max_depth=10,\n                       subsample=0.8,\n                       colsample_bytree=0.9,\n                       colsample_bylevel=0.7,\n                       min_child_weight=200,\n                       n_estimators=1000,\n                       learning_rate=0.025,\n                       objective=\"reg:squarederror\",\n                       tree_method=\"hist\")\nestimator.fit(label_cat_not_num_train,y_train)\nimportances=estimator.feature_importances_\npredictions=estimator.predict(label_cat_not_num_test)","33f85f5a":"importances","a3fb0397":"sample_submissions[\"item_cnt_month\"]=predictions\nsample_submissions.to_csv(f\"submission.csv\",index=False)\nsample_submissions.head()","1b5bdb6b":"Two variable categories and a sibcategory can be extracted from the category name.","8593e9d2":"Create Features For item_price","a289c300":"## Merge input dfs","9b5ab03a":"# Initialize","d2deae63":"## Target based features","7c21dca7":"It seems that this point is really an outlier.","b41da14b":"The graphs show that to build a test set for each shop, we took all all the item-shop pairs that are present in the test dataset. You can build such a dataset from the training set by taking for each month all the unique item-shop pairs present in the test dataset.","7b765501":"From this graph we see that in the dataset there are two points that can be outliers. One with sales over 2000. Another with a price of over 50000.","fdf9e681":"We will add pairs (item, shop) to each month and encode them using the median of sales for the category, \nwhich this item belongs in the corresponding month. \nFirst, join all the datasets with each other.","af3fb630":"Overview on data","0c4bf579":"# Feature Engineering"}}