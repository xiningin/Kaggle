{"cell_type":{"bf1e1b80":"code","25c887ef":"code","ea877f7b":"code","571461af":"code","c0749c4d":"code","a868dfa0":"code","d71b4d38":"code","4f61e75a":"markdown","6e94ac92":"markdown","ea9021c2":"markdown","e132969e":"markdown","4ac667e1":"markdown"},"source":{"bf1e1b80":"import numpy as np\nimport pandas as pd\n\nimport os\nimport json\nfrom pathlib import Path\n\nimport matplotlib.pyplot as plt\nfrom matplotlib import colors\nimport numpy as np\n\n%matplotlib inline\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.metrics import mean_absolute_error as MAE\n\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    print(dirname)\n\n\ntrain = pd.read_csv('\/kaggle\/input\/weather-data-for-covid19-data-analysis\/training_data_with_weather_info_week_2.csv')\n#train.drop('Unnamed: 0', axis=1, inplace=True)\ntest = pd.read_csv('\/kaggle\/input\/covid19-global-forecasting-week-2\/test.csv')\ndisplay(train.head())\ndisplay(test.head())","25c887ef":"df = train[train['country+province']=='Italy-']\ndf = df[df['ConfirmedCases']>0]\nsns.lineplot(data=df.set_index('day_from_jan_first')['ConfirmedCases'])","ea877f7b":"sns.lineplot(data=df.set_index('day_from_jan_first')[['temp', 'min', 'max']])","571461af":"col = 'ConfirmedCases'\n\ns = df[col].shift(periods=1).fillna(0)\ndf[col + '_diff'] = df[col]-s\ndf[col + '_new_percent'] = (df[col] \/ s) - 1\ndf[col + '_new_percent'].replace([np.inf, -np.inf], 1, inplace=True)\n\nsns.lineplot(data=df.set_index('day_from_jan_first')[['ConfirmedCases_diff']])","c0749c4d":"sns.lineplot(data=df.set_index('day_from_jan_first')[['ConfirmedCases_new_percent']])","a868dfa0":"corrmat = df[['ConfirmedCases', 'Fatalities', \n       'temp', 'min', 'max', 'stp', 'wdsp', 'prcp', 'fog', 'ConfirmedCases_diff',\n       'ConfirmedCases_new_percent']].corr()\nplt.subplots(figsize=(25,25))\nsns.heatmap(corrmat, vmax=0.9, square=True, annot=True)","d71b4d38":"df['t'] = df.day_from_jan_first - df.day_from_jan_first.min()\ndf['t^2'] = df['t']**2\n\nX = df[df['t'] < (df['t'].max() - 7)]\nX_t = df[df['t'] >= (df['t'].max() - 7)]\ny = X.ConfirmedCases_diff.apply(np.log).replace([np.inf, -np.inf], 0)\ny_t = X_t.ConfirmedCases_diff.apply(np.log).replace([np.inf, -np.inf], 0)\ncols = ['temp', 'min', 'max', 'stp', 'wdsp', 'prcp',\n       'fog', 't', 't^2']\n\nprint('Target mean is : {}'.format(y.mean()))\nprint('Target std is : {}'.format(y.std()))\n\nregressor = DecisionTreeRegressor()\nregressor.fit(X[cols], y)\npred = regressor.predict(X_t[cols])\nprint('MAE: {}'.format(MAE(y_t, pred)))\n\nsns.lineplot(data=pd.DataFrame({'validation target': y_t, 'predictions': pred}))","4f61e75a":"Let's see correlation:","6e94ac92":"Let's separate one week of data for validation. In this validation set actual weather data appears--one would need accurate forecasts in prediction of future spread.\n\nWe will try to predict the logarithm of `ConfirmedCases_diff`. We also add a time feature `t` measuring the days since the first case in Italy, and its square `t^2` because I'm assuming `ConfirmedCases_diff` has a growth similar to $e^{(t-t_{max})^2}$.","ea9021c2":"# Data relative to Italy\n\nLet's concentrate on one country.","e132969e":"Let's create features that measure how many new cases appeared in each day:","4ac667e1":"In this notebook I show how weather data can be used in relation to data analysis and prediction of spread of COVID-19."}}