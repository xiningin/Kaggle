{"cell_type":{"7f0b8fc9":"code","2499626f":"code","238b7b26":"code","0eaafc85":"code","06a005a4":"code","762957d6":"markdown","5aea8621":"markdown","f98ed57e":"markdown"},"source":{"7f0b8fc9":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport matplotlib\nimport matplotlib.pyplot as plt\n\nfrom plotly.subplots import make_subplots\nimport plotly.graph_objects as go\n\n\n\ndef country_normalization (x):\n    if x == 'Iran, Islamic Republic of...':\n        x = 'Iran'\n    elif x == 'United Kingdom of Great Britain and Northern Ireland':\n        x = \"United Kingdom\"\n    elif x == 'United States of America':\n        x = \"USA\"\n    elif x == 'United States':\n        x = \"USA\"\n    elif x == 'Vietnam':\n        x = \"Viet Nam\"\n    elif x == 'Korea South':\n        x = 'South Korea'\n    elif x == 'Taiwan (2020 IFM Estimates)':\n        x = 'Taiwan'\n    elif x == 'Hong Kong (S.A.R.)':\n        x = 'Hong Kong'\n    return x\n\ndef create_age_2017 (x):\n    if 18 <= x and x <=21:\n        x = '18-21'\n    elif 22 <= x and x <=24:\n        x = '22-24'\n    elif 25 <= x and x <=29:\n        x = '25-29'\n    elif 30 <= x and x <=34:\n        x = '30-34'\n    elif 35 <= x and x <=39:\n        x = '35-39'\n    elif 40 <= x and x <=44:\n        x = '40-44'\n    elif 45 <= x and x <=49:\n        x = '45-49'\n    elif 50 <= x and x <=54:\n        x = '50-54'\n    elif 55 <= x and x <=59:\n        x = '55-59'\n    elif 60 <= x and x <=69:\n        x = '60-69'\n    elif 70 <= x :\n        x = '70+'\n    else:\n        x = 'other'\n    return x\n\ndef count_then_return_percent(dataframe,column_name):\n    \n    counts = dataframe[column_name].value_counts(dropna=False)\n    counts = counts.sort_index()\n\n    percentages = round(counts*100\/(dataframe[column_name].count()),1)\n    return percentages\n\ndef count(dataframe,column_name):\n    counts = dataframe[column_name].value_counts(dropna=False)\n    counts = counts.sort_index()\n    \n    return counts\n\ndef plotly_compare_bar_charts( response_counts, text, title, subplot_titles, orientation, x_range ): \n\n    fig = make_subplots(\n        rows=1, cols=len(response_counts),\n        \n        specs=[[{\"type\": \"bar\"}] * len(response_counts) ],\n        shared_yaxes  = True,\n        shared_xaxes  = True,\n        subplot_titles = subplot_titles\n    )\n\n    for i in range(len(response_counts)):\n        fig.add_trace(go.Bar( \n            y=response_counts[i].index, \n            x=response_counts[i].values, \n            text = text[i].values,\n            textposition='auto',     \n            orientation=orientation),\n                      row=1, col=i+1)\n\n    fig.update_layout(height=500, showlegend=False, title=title_for_chart)\n    fig.update_xaxes(range=x_range)\n    fig.show()    \n\ndef plot_custom_question_distribution (survey, title_for_chart,  question_name, countries, x_range = [0, 36] ):\n    \n    title_for_y_axis = '% of respondents'\n    orientation_for_chart = 'h'    \n\n\n    response_counts = []    \n    text = []\n    subplot_titles = []\n    \n    all_percentages = count_then_return_percent(survey,question_name).sort_index()\n    all_counts = count(survey,question_name).sort_index()\n    all_total = all_counts.sum()\n    \n    response_counts.append (all_percentages)\n    text.append (all_counts)\n    subplot_titles.append (f\"All [#{all_total:,}]\")\n    \n    data = []\n    for country in countries:\n        country_percentages = count_then_return_percent(survey.query(\"Q3 == @country\"),question_name).sort_index()\n        country_counts = count(survey.query(\"Q3 == @country\"),question_name).sort_index()\n        country_total = country_counts.sum()\n        \n        response_counts.append (country_percentages)\n        text.append (country_counts)\n        subplot_titles.append (f\"{country} [#{country_total:,}]\")\n\n        \n    plotly_compare_bar_charts(response_counts = response_counts, \n                              text = text,    \n                              title = title_for_chart , \n                              subplot_titles = subplot_titles, \n                              orientation =orientation_for_chart,\n                              x_range = x_range)   \n    \ndef load_surveys ():\n    surveys = {}\n\n    survey_2021 = pd.read_csv(\"..\/input\/kaggle-survey-2021\/kaggle_survey_2021_responses.csv\", low_memory=False)\n    survey_2021[\"Q3\"] = survey_2021[\"Q3\"].map (lambda x: country_normalization(x))\n    survey_2021 = survey_2021[1:]\n\n    surveys[2021] = survey_2021 \n\n    survey_2020 = pd.read_csv(\"\/kaggle\/input\/kaggle-survey-2020\/kaggle_survey_2020_responses.csv\", low_memory=False)\n    survey_2020[\"Q3\"] = survey_2020[\"Q3\"].map (lambda x: country_normalization(x))\n    survey_2020 = survey_2020[1:]\n\n    surveys[2020] = survey_2020 \n\n\n    survey_2019 = pd.read_csv(\"\/kaggle\/input\/kaggle-survey-2019\/multiple_choice_responses.csv\", low_memory=False)\n    survey_2019[\"Q3\"] = survey_2019[\"Q3\"].map (lambda x: country_normalization(x))\n    survey_2019 = survey_2019[1:]\n\n    surveys[2019] = survey_2019 \n\n    survey_2018 = pd.read_csv(\"\/kaggle\/input\/kaggle-survey-2018\/multipleChoiceResponses.csv\", low_memory=False)\n    survey_2018[\"Q2\"] = survey_2018[\"Q2\"].map (lambda x: '70+' if x in ('70-79', '80+') else x) \n    survey_2018[\"Q3\"] = survey_2018[\"Q3\"].map (lambda x: country_normalization(x))\n    survey_2018 = survey_2018[1:]\n\n    surveys[2018] = survey_2018 \n\n    survey_2017 = pd.read_csv(\"\/kaggle\/input\/kaggle-survey-2017\/multipleChoiceResponses.csv\", encoding = \"ISO-8859-1\",  low_memory=False)\n    survey_2017[\"Q1\"] = survey_2017[\"Age\"].map(lambda x:create_age_2017(x))\n    survey_2017[\"Q3\"] = survey_2017[\"Country\"].map (lambda x: country_normalization(x))\n    survey_2017 = survey_2017[1:]\n\n    surveys[2017] = survey_2017 \n    \n    return surveys\n    \n    ","2499626f":"surveys = load_surveys()\ncountries = [ \"India\", \"USA\", \"Italy\"]\n","238b7b26":"for year in [2021, 2020, 2019]:\n    title_for_chart = f'Age Distribution - Kaggle Survey {year}'\n    survey = surveys[year]\n    question_name = 'Q1'\n    plot_custom_question_distribution (survey, title_for_chart, question_name, countries)\n    \nfor year in [2018]:\n    title_for_chart = f'Age Distribution - Kaggle Survey {year}'\n    survey = surveys[year]\n    question_name = 'Q2'\n    plot_custom_question_distribution (survey, title_for_chart, question_name, countries)\n    ","0eaafc85":"answer_abbrvs = {'Some college\/university study without earning a bachelor\u2019s degree':'Some college\/university study'} \ncat_order = pd.CategoricalDtype(\n    ['I prefer not to answer', 'No formal education past high school', \n     answer_abbrvs['Some college\/university study without earning a bachelor\u2019s degree'],\n     'Professional doctorate', \"Bachelor\u2019s degree\",  \"Master\u2019s degree\", 'Doctoral degree'], \n    ordered=True\n)\n\n\nfor year in [2021]:\n    title_for_chart = f'Highest level of formal education - Kaggle Survey {year}'\n    survey = surveys[year]\n    question_name = 'Q4'\n    survey[question_name] = survey[question_name].fillna(\"I prefer not to answer\")\n    survey[question_name] = survey[question_name].map (lambda x: answer_abbrvs.get(x,x) ) \n    survey[question_name] = survey[question_name].astype(cat_order)\n    plot_custom_question_distribution (survey, title_for_chart, question_name, countries, x_range=[0,55])\n\ncat_order = pd.CategoricalDtype(\n    ['I prefer not to answer', 'No formal education past high school', \n     answer_abbrvs['Some college\/university study without earning a bachelor\u2019s degree'],\n     'Professional degree',  \"Bachelor\u2019s degree\",  \"Master\u2019s degree\", 'Doctoral degree'], \n    ordered=True\n)\n\nfor year in [2020,2019]:\n    title_for_chart = f'Highest level of formal education - Kaggle Survey {year}'\n    survey = surveys[year]\n    question_name = 'Q4'\n    survey[question_name] = survey[question_name].fillna(\"I prefer not to answer\")\n    survey[question_name] = survey[question_name].map (lambda x: answer_abbrvs.get(x,x) ) \n    survey[question_name] = survey[question_name].astype(cat_order)\n    plot_custom_question_distribution (survey, title_for_chart, question_name, countries, x_range=[0,55])\n","06a005a4":"cat_order = pd.CategoricalDtype(\n    ['I have never written code', '< 1 years', '1-3 years', '3-5 years', '5-10 years', '10-20 years', '20+ years'], \n    ordered=True\n)\n\nfor year in [2021]:\n    title_for_chart = f'Developer seniority - Kaggle Survey {year}'\n    survey = surveys[year]\n    question_name = 'Q6'\n    survey[question_name] = survey[question_name].astype(cat_order)\n    plot_custom_question_distribution (survey, title_for_chart, question_name, countries)\n\ncat_order = pd.CategoricalDtype(\n    ['I have never written code', '< 1 years', '1-2 years', '3-5 years', '5-10 years', '10-20 years', '20+ years'], \n    ordered=True\n)\n    \nfor year in [2020]:\n    title_for_chart = f'Developer seniority - Kaggle Survey {year}'\n    survey = surveys[year]\n    question_name = 'Q6'\n    survey[question_name] = survey[question_name].astype(cat_order)\n    plot_custom_question_distribution (survey, title_for_chart, question_name, countries)\n\nfor year in [2019]:\n    title_for_chart = f'Developer seniority - Kaggle Survey {year}'\n    survey = surveys[year]\n    question_name = 'Q15'\n    survey[question_name] = survey[question_name].astype(cat_order)\n    plot_custom_question_distribution (survey, title_for_chart, question_name, countries)","762957d6":"## Age Distribution","5aea8621":"##  Highest level of formal education ","f98ed57e":"## Developer seniority"}}