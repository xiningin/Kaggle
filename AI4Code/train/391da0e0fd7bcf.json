{"cell_type":{"8ce7930a":"code","2ebe2045":"code","530fbdb4":"code","639710e9":"code","a6ad4c6d":"code","c213d94e":"code","35c442e9":"code","367b8d36":"code","2dbbe12d":"code","18dfb900":"code","2188a3f8":"code","b98b6757":"code","91543aa1":"code","bf3068bf":"code","a6f021ef":"code","43e081e0":"code","95e0a05f":"code","cbdad7f7":"markdown","239d3dc9":"markdown","75194d6b":"markdown","81a2a19a":"markdown","23225946":"markdown","9eba089e":"markdown","95f83e12":"markdown","a6b9efcb":"markdown","c5bb33a8":"markdown","f36a4f93":"markdown","78f00150":"markdown","19eeb9bb":"markdown","9d938952":"markdown","8de46c2a":"markdown","0076591a":"markdown","43158684":"markdown","e8c46f52":"markdown","d580fdbf":"markdown","043db5ef":"markdown","dfe5c295":"markdown"},"source":{"8ce7930a":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport os\nimport glob\nimport matplotlib.pyplot as plt\nimport random\nimport cv2","2ebe2045":"root_dir = \"\/kaggle\/input\/landmark-retrieval-2020\/\"\ntrain_dir = os.path.join(root_dir,\"train\/\")\ntest_dir = os.path.join(root_dir,\"test\/\")\nindex_dir = os.path.join(root_dir,\"index\/\")\ntrain_csv = os.path.join(root_dir,\"train.csv\")\nlandmark_id_mapping_csv = \"\/kaggle\/input\/glrc2020-landmarkid-mapping\/glrc2020_landmarkid_mapping.csv\"","530fbdb4":"df_train = pd.read_csv(train_csv)","639710e9":"df_train.loc[df_train['id'].isnull(),:]","a6ad4c6d":"df_train.loc[df_train['landmark_id'].isnull(),:]","c213d94e":"# of images in train folder => train query images\nsum_train=0\nfor dirname, _, filenames in os.walk(train_dir):\n    for filename in filenames:\n        if \".jpg\" in filename:\n            sum_train= sum_train + 1\nprint(\"Number of images in train folder = {}\".format(sum_train))","35c442e9":"# of images in test folder => test query images\nsum_test=0\nfor dirname, _, filenames in os.walk(test_dir):\n    for filename in filenames:\n        if \".jpg\" in filename:\n            sum_test= sum_test + 1\nprint(\"Number of images in test folder = {}\".format(sum_test))","367b8d36":"# of images in index folder\n# The index images are the images you retrieve. \n# i.e. if the \"query\" test set image is a picture of the Taj Mahal, \n# you are retrieving the images in the index set that you believe match the same landmark.\nsum_index=0\nfor dirname, _, filenames in os.walk(index_dir):\n    for filename in filenames:\n        if \".jpg\" in filename:\n            sum_index= sum_index + 1\nprint(\"Number of images in index folder = {}\".format(sum_index))","2dbbe12d":"# Histogram distribution for landmark_ids\nfig, ax =plt.subplots(figsize=(8,8))\nax.hist(df_train['landmark_id'],bins=1000,density=False)\nplt.show()","18dfb900":"xdf = pd.DataFrame(df_train['landmark_id'].value_counts(dropna=False)).reset_index(inplace=False)\nxdf.columns = ['landmark_id','count']","2188a3f8":"xdf.boxplot(column='count')","b98b6757":"xdf.loc[xdf['count']<1000,:].boxplot(column='count')","91543aa1":"#fig = plt.figure()\n#ax = fig.add_subplot(111)\nfig, ax =plt.subplots(nrows=2,ncols=2,figsize=(16,8),squeeze=False)\nax[0,0].scatter(xdf['landmark_id'],xdf['count'],c=xdf['landmark_id'],s=50)\nax[0,0].tick_params(axis='x',rotation=45)\nax[0,0].title.set_text('scatter plot: landmark_id v\/s count ')\n\nfilterdf = xdf.loc[xdf['count']<1000,:]\n\nax[0,1].scatter(filterdf['landmark_id'],filterdf['count'],c=filterdf['landmark_id'],s=50)\nax[0,1].tick_params(axis='x',rotation=45)\nax[0,1].title.set_text('scatter plot: landmark_id v\/s count ')\n\nfilterdf = xdf.loc[xdf['count']<500,:]\n\nax[1,0].scatter(filterdf['landmark_id'],filterdf['count'],c=filterdf['landmark_id'],s=50)\nax[1,0].tick_params(axis='x',rotation=45)\nax[1,0].title.set_text('scatter plot: landmark_id v\/s count ')\n\n\nfilterdf = xdf.loc[xdf['count']<100,:]\n\nax[1,1].scatter(filterdf['landmark_id'],filterdf['count'],c=filterdf['landmark_id'],s=50)\nax[1,1].tick_params(axis='x',rotation=45)\nax[1,1].title.set_text('scatter plot: landmark_id v\/s count ')\n\nfig.tight_layout(pad=3.0)\n\nplt.show()","bf3068bf":"# No. of landmarks which are predominant\nxdf.shape[0]-xdf.loc[xdf['count']<1000,:].shape[0]","a6f021ef":"landmark_mapping_df = pd.read_csv(landmark_id_mapping_csv)\nlandmark_mapping ={}\nfor l_id, cat in zip(list(landmark_mapping_df['landmark_id']),list(landmark_mapping_df['category'])):\n    landmark_mapping[l_id]=cat","43e081e0":"for l_id in list(xdf.loc[xdf['count']>1000,:]['landmark_id']):\n    print(l_id)\n    print(landmark_mapping[l_id])","95e0a05f":"nc_df = df_train[df_train['landmark_id']==20409]\n\nfig, ax = plt.subplots(3, 3, figsize=(16, 8))\nfor r in range(3):\n    for c in range(3):\n        img_id = random.choice(list(nc_df['id']))\n        img_path = os.path.join(os.path.join(os.path.join(os.path.join(train_dir,img_id[0]),img_id[1]),img_id[2]),img_id)+\".jpg\"\n        img = cv2.imread(img_path)\n        ax[r,c].imshow(cv2.cvtColor(img, cv2.COLOR_BGR2RGB))\n        ax[r,c].set_axis_off()","cbdad7f7":"### As we have seen the folder structure in detail, lets deep-dive into landmark ","239d3dc9":"# References\n1. https:\/\/www.kaggle.com\/seriousran\/google-landmark-retrieval-2020-eda\n2. https:\/\/www.kaggle.com\/c\/landmark-retrieval-2020\/discussion\/163390","75194d6b":"No null values found here as well. So we are clear here","81a2a19a":"![image.png](attachment:image.png)","23225946":"#### Its given image_ids are uniques, still lets check\n#### What we also have here is: each image has only one landmark","9eba089e":"## Now lets examine traincsv","95f83e12":"### Setting important directories","a6b9efcb":"# Understanding structure\n\n![image.png](attachment:image.png)","c5bb33a8":"Lets look at these outliers landmarks - \nTo do so, we will need to bring a dataset referred in the competition and also in this discussion\nhttps:\/\/www.kaggle.com\/c\/landmark-retrieval-2020\/discussion\/163390","f36a4f93":"### Lets being by importing neccessary packages","78f00150":"#### Lets take an example of landmark_id = 20409, which as per the mapping is Noraduz Cemetery present in Armenia","19eeb9bb":"#### Checking for null values => None found","9d938952":"#### Lets filter dataframe wrt this landmark_id and check whether images within train image directory actually contain these landmarks.. lets look at 9 images","8de46c2a":"So we can see somes spikes in the distribution, so there is a possibility that some landmark images might be occurring more frequently. We will look at that, once we analyze the train, test & index folders","0076591a":"# Objective\n\n**Given Problem statement:** \nTo retrieve relevant database images to a given query image (ie, the model should retrieve database images containing the same landmark as the query)\n\n**What this notebook explores:**\nThis notebook looks at the datasets and the structure provided along with an EDA pipeline to explore this.\n\nLets jump right in !!!","43158684":"Now lets match with the image data we have in the train folder","e8c46f52":"#### Checking for null values with landmark_id column:","d580fdbf":"For all the above visualizations, we can infer:\n\ni.) 7 images are clear outliers i.e. there are 7 landmarks which are occuring at a higher frequency i.e. more than 1000 times in the given set of 1580470 image_ids\n\nii.) then we have a moderate number in the range of above 100\n\niii.) Majority of landmark sightings are in the range 1-100\n","043db5ef":"So we have been able to successfully able to correlate multuple datsets. Basis our exploration we have understood certain landmarks are more predominant in the image set. Moreover, we also understand spatial orientation among others will play an important role also discussed in this thread:\n\nhttps:\/\/www.kaggle.com\/c\/landmark-retrieval-2020\/discussion\/163287","dfe5c295":"# Lets understand the given data"}}