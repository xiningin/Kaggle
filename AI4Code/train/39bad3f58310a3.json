{"cell_type":{"718499f4":"code","3343c600":"code","09fdd617":"code","298bdae7":"code","6d69c011":"code","fb554dd5":"code","25b45009":"code","8703c6d2":"code","1f363ff7":"code","e1335ca0":"code","d4c463c3":"code","0c9b5192":"code","431233bb":"code","d0504c42":"code","3aca577d":"code","ade4e3ac":"code","d14906aa":"code","31fa07cb":"code","b5674521":"code","11e7b5d9":"code","8b106cd7":"code","4cf94815":"code","b8afab7b":"code","8caf45e0":"code","ca7d0d72":"code","ff866242":"code","6b52680a":"markdown","1edd07ee":"markdown","3c6953ff":"markdown","674ca1f4":"markdown","f5cc79f2":"markdown","e65b4192":"markdown"},"source":{"718499f4":"import pandas as pd\nfrom mlxtend.frequent_patterns import apriori, association_rules","3343c600":"df_ = pd.read_excel(\"..\/input\/uci-online-retail-ii-data-set\/online_retail_II.xlsx\", sheet_name=\"Year 2010-2011\")\ndf = df_.copy()","09fdd617":"print(\"##################### Shape #####################\")\nprint(df.shape)\nprint(\"##################### Types #####################\")\nprint(df.dtypes)\nprint(\"##################### Head #####################\")\nprint(df.head())\nprint(\"##################### Tail #####################\")\nprint(df.tail())\nprint(\"##################### NA #####################\")\nprint(df.isnull().sum())\nprint(\"##################### Describe ##############\")\nprint(df.describe([0.10,0.25,0.50,0.75,0.90,0.95,0.99]).T)","298bdae7":"# Eksik De\u011fer Kontrol\u00fc\ndf.isnull().sum()","6d69c011":"# Eksik de\u011ferlerin veri setinden d\u00fc\u015f\u00fcr\u00fclmesi\ndf.dropna(inplace=True)","fb554dd5":"# Hangi \u00fcr\u00fcnden ka\u00e7 adet var \ndf[\"StockCode\"].value_counts()","25b45009":"df[\"Country\"].value_counts()","8703c6d2":"# En \u00e7ok sipari\u015f edilen \u00fcr\u00fcnler\ndf.groupby(\"StockCode\").agg({\"Quantity\":\"sum\"}).sort_values(by=\"Quantity\",ascending=False).head(5)","1f363ff7":"# Faturalardaki \u2018C\u2019 iptal edilen i\u015flemleri g\u00f6stermektedir. \u0130ptal edilen i\u015flemleri veri setinden \u00e7\u0131kart\u0131yoruz.\ndf = df[~df[\"Invoice\"].str.contains(\"C\", na=False)]","e1335ca0":"# Quantity ve Price de\u011fi\u015fkenleri i\u00e7in 0'dan b\u00fcy\u00fck de\u011ferleri al\u0131yoruz.\ndf = df[df[\"Quantity\"] > 0]\ndf = df[df[\"Price\"] > 0]","d4c463c3":"#Say\u0131sal ve Ayn\u0131 Zamanda Kategorik olmayan De\u011fi\u015fkenleri Yakal\u0131yoruz\nnum_cols = [col for col in df.columns if df[col].dtypes != \"O\"]\nnum_but_cat = [col for col in df.columns if df[col].nunique() < 10 and df[col].dtypes != \"O\"]\nnum_cols = [col for col in num_cols if col not in num_but_cat]\nnum_cols","0c9b5192":"# Replace with Thresholds\nfor col in num_cols:\n    q1 = df[col].quantile(0.25)\n    q3 = df[col].quantile(0.75)\n    iqr = q3 - q1\n    up_limit = q3 + 1.5 * iqr\n    low_limit = q1 - 1.5 * iqr\n    df.loc[(df[col] < low_limit), col] = low_limit\n    df.loc[(df[col] > up_limit), col] = up_limit\n    if df[df[col] > up_limit].any(axis=None):\n        print(col,\"YES\",(low_limit,up_limit))\n    elif df[df[col] < low_limit].any(axis=None):\n        print(col,\"YES\",(low_limit,up_limit))\n    else: \n        print(col,\"NO\",(low_limit,up_limit))","431233bb":"# Norway m\u00fc\u015fterileri \u00fczerinden birliktelik kurallar\u0131 \u00fcretece\u011fiz.\ndf_gr = df[df['Country'] == \"Germany\"]","d0504c42":"# HANG\u0130 \u00dcR\u00dcNDEN KA\u00c7 TANE ALINMI\u015e?\ndf_gr.groupby(['Invoice', 'Description']).agg({\"Quantity\": \"sum\"}).head(20)","3aca577d":"# Veri setini istedi\u011fimiz forma d\u00f6v\u00fc\u015ft\u00fcr\u00fcyoruz. Unstack fonksiyonu parametrelerini kullanarak NA de\u011ferleri \ndf_gr.groupby(['Invoice', 'Description']).agg({\"Quantity\": \"sum\"}).unstack(fill_value= \"0\").iloc[0:5, 0:5]","ade4e3ac":"#   Applymap fonksiyonu ile i\u015flemi b\u00fct\u00fcn g\u00f6zlemlere uyguluyoruz 0'dan b\u00fcy\u00fcklere 1, geri kalanlara 0 atamas\u0131 yapt\u0131k.\ndf_gr.groupby(['Invoice', 'Description']).agg({\"Quantity\": \"sum\"}).unstack().fillna(0).applymap(\n    lambda x: 1 if x > 0 else 0).iloc[0:5, 0:5]","d14906aa":"# Post bar\u0131nd\u0131ran ifadeler posta \u00fccretleridir. Bunlarla ilgili i\u015flem yapmayaca\u011f\u0131m\u0131z i\u00e7in veri setinden \u00e7\u0131karaca\u011f\u0131z.\ndf_gr[df_gr[\"StockCode\"] == \"POST\"]","31fa07cb":"# Post bar\u0131nd\u0131ran ifadeleri \u00e7\u0131kart\u0131yoruz.\ndf_gr = df_gr[~df_gr[\"StockCode\"].str.contains(\"POST\", na=False)]","b5674521":"# Post ifadeleri kontrol edelim.\ndf_gr[df_gr[\"StockCode\"] == \"POST\"]","11e7b5d9":"# Invoice de\u011ferlerimizi sepet StockCode de\u011ferlerimizi sepetimizde ki \u00fcr\u00fcnler olarak de\u011ferlerdirebilece\u011fimiz formata \u00e7eviriyoruz.\ngr_inv_pro_df = df_gr.groupby(['Invoice', \"StockCode\"])['Quantity'].sum().unstack().fillna(0). \\\n            applymap(lambda x: 1 if x > 0 else 0)","8b106cd7":"gr_inv_pro_df.head()","4cf94815":"# SUPPORT DE\u011eERLER\u0130N\u0130 ELDE ETME\n\n# T\u00fcm olas\u0131 \u00fcr\u00fcn birlikteliklerinin olas\u0131l\u0131klar\u0131 i\u00e7in aprioriyi kullan\u0131yoruz\n# Min support bizim belirledi\u011fimiz threshold de\u011feri\n# use_colnames: S\u00fctun isimlerini kullan diyoruz ama bize \u00fcr\u00fcnlerin idleri gelcek\nfrequent_itemsets = apriori(gr_inv_pro_df, min_support=0.01, use_colnames=True, low_memory=True)","b8afab7b":"# D\u0130\u011eER B\u00dcT\u00dcN METR\u0130KLER\u0130 HESAPLIYORUZ\nrules = association_rules(frequent_itemsets, metric=\"support\", min_threshold=0.01)\nrules.sort_values(\"support\", ascending=False).head()","8caf45e0":"sorted_rules = rules.sort_values(\"lift\", ascending=False)\nrules.sort_values(\"lift\", ascending=False).head(5)","ca7d0d72":"# \u00dcR\u00dcN \u00d6NERME\n\nproduct_id = 23235\n\nrecommendation_list = []\n\nfor i, product in enumerate(sorted_rules[\"antecedents\"]):\n    for j in list(product):\n        if j == product_id:\n            recommendation_list.append(list(sorted_rules.iloc[i][\"consequents\"])[0])\n            \n# \u00d6nerilen ilk 2 \u00fcr\u00fcn \nrecommendation_list[0:2]","ff866242":"# \u00d6nerilen \u00fcr\u00fcnlerin isimleri nelerdir ? \nfor name in recommendation_list[0:2]:\n    product_name = df[df[\"StockCode\"] == name][[\"Description\"]].values[0].tolist()\n    print(product_name)","6b52680a":"# 4) ARL Veri Yap\u0131s\u0131n\u0131 Haz\u0131rlama (Invoice-Product Matrix)\n\nElimizdeki \u00f6l\u00e7\u00fcm ihtiyac\u0131 olan \u015feyleri \u00f6l\u00e7mek i\u00e7in \u00f6ncelikle bunlar\u0131 matematiksel forma d\u00f6n\u00fc\u015ft\u00fcrmek gerekir.\nVerinin gelmesini istedi\u011fimiz durum:\nBizim istedi\u011fimiz formda faturalara sepet muamelesi yap\u0131yoruz. Elde etmek istedi\u011fimiz sonu\u00e7: S\u00fctunlara b\u00fct\u00fcn olas\u0131 \u00fcr\u00fcnleri koyup, bir sepette bu \u00fcr\u00fcnlerden varsa 1 yoksa 0 yazd\u0131r\u0131ca\u011f\u0131z.","1edd07ee":"# Association Rule Learning( Birliktelik Kural\u0131 \u00d6\u011frenimi)\n\nKullan\u0131c\u0131lara baz\u0131 teknikleri kullanarak \u00f6nerme i\u015flemleri yap\u0131labilen y\u00f6ntemlerden birisidir. Veri i\u00e7erisindeki \u00f6r\u00fcnt\u00fcleri(ili\u015fki, yap\u0131) bulmak i\u00e7in kullan\u0131lan kural tabanl\u0131 bir makine \u00f6\u011frenmesi tekni\u011fidir. \n\n# Apriori Algoritmas\u0131:\nBir sepet analizi y\u00f6ntemidir. \u00dcr\u00fcn birlikteliklerini ortaya \u00e7\u0131karmak i\u00e7in kullan\u0131l\u0131r. \n\n**N: B\u00fct\u00fcn g\u00f6zlemler**\n\n**Support(X,Y)** = Freq(X,Y)\/N\n\n*X ve Y nin birlikte g\u00f6r\u00fclme olas\u0131l\u0131\u011f\u0131*\n\n**Confidence(X,Y)** = Freq(X,Y) \/ Freq(X)\n\n*X sat\u0131n al\u0131nd\u0131\u011f\u0131nda Y\u2019nin sat\u0131lmas\u0131 olas\u0131l\u0131\u011f\u0131*\n\n**Lift** = Support(X,Y) \/ (Support(X) * Support(Y))\n\n*X sat\u0131n al\u0131nd\u0131\u011f\u0131nda Y\u2019nin sat\u0131n al\u0131nma olas\u0131l\u0131\u011f\u0131 lift kat kadar artar.*\n\nBurada iteratif olarak \u015funlar yap\u0131lacak:\n\n\u2022 \u00d6nce ikili \u00fcr\u00fcn \u00e7iftlerine bak\u0131lacak. Belirli bir support e\u015fik de\u011feri belirlenecek. Support e\u015fik de\u011ferinden k\u00fc\u00e7\u00fck olan \u00fcr\u00fcn \u00e7iftleri elenecek.\n\n\u2022 \u0130kinci turda \u00fc\u00e7l\u00fc \u00fcr\u00fcn kombinasyonlar\u0131na bak\u0131lacak. Belirlenen e\u015fik support de\u011ferinin alt\u0131nda olanlar tekrar elenecek.\n\n\u2022 D\u00f6rtl\u00fc kombinasyonlar\u0131na bak\u0131l\u0131p Support de\u011ferinin alt\u0131nda kalan k\u00fcme yine elenecek.\n\nBu \u015fekilde olas\u0131 b\u00fct\u00fcn kombinasyonlar \u00e7\u0131kar\u0131ld\u0131ktan sonra elimizde bir liste kalacak. Bu liste \u00fczerinden \u00fcr\u00fcnlerin support, confidence ve lift de\u011ferleri basit bir liste halinde elimizde olacak. \u015eu tip yorumlar getirilebilecek: \n\n\"X \u00fcr\u00fcn\u00fc al\u0131nd\u0131\u011f\u0131nda Y nin al\u0131nma olas\u0131l\u0131\u011f\u0131 \u015fuymu\u015f.\" \n\n\"E\u011fer benim web sitemde kullan\u0131c\u0131 X \u00fcr\u00fcn\u00fc sepetine eklerse ona hemen Y \u00fcr\u00fcn\u00fcn\u00fc \u00f6neriyim.\" \u015feklinde yorumlar getirebiliriz. \n\n\nBunu filtreleme i\u00e7in yap\u0131yoruz. \u00c7\u00fcnk\u00fc ger\u00e7ek hayatta \u00e7ok fazla \u00fcr\u00fcn bulunmakta ve bizim eleme yapmam\u0131z gerekir. \n\n\n","3c6953ff":"**antecedent** : X\n\n**consequent** : Y\n\n**antecedent support**: Tek ba\u015f\u0131na X olas\u0131l\u0131\u011f\u0131\n\n**consequent support**: Tek ba\u015f\u0131na Y olas\u0131l\u0131\u011f\u0131\n\n**support**: \u0130kisinin birlikte g\u00f6r\u00fclme olas\u0131l\u0131\u011f\u0131\n\n**confidence**: X al\u0131nd\u0131\u011f\u0131nda Y al\u0131nma olas\u0131l\u0131\u011f\u0131.\n\n**lift**: X al\u0131nd\u0131\u011f\u0131nda Y al\u0131nma olas\u0131l\u0131\u011f\u0131 .. kat artar.\n\n**conviction**: Y olmadan X'in beklenen frekans\u0131\n\n**leverage** : Kald\u0131ra\u00e7 demek lift'e benzer. Lift kullan\u0131l\u0131r.\n\u00c7\u00fcnk\u00fc leverage supportu y\u00fcksek de\u011ferlere \u00f6ncelik verme e\u011filimi vard\u0131r.\n\nEticarette \u00fcr\u00fcn \u00e7iftlerinde \u00e7ok s\u0131k iki \u00fcr\u00fcn birlikte al\u0131nd\u0131\u011f\u0131nda di\u011ferini \u00f6nermek mant\u0131kl\u0131 olacakt\u0131r.\n\nBurada daha g\u00fcvenli diye d\u00fc\u015f\u00fcn\u00fclebilecek confidence' a odaklan\u0131labilir. Ama asl\u0131nda bu metriklerin kesi\u015fimi kullan\u0131l\u0131r.\n- \u00d6rne\u011fin support'u A dan b\u00fcy\u00fck lift'i B'den b\u00fcy\u00fck olanlar\u0131 filtrele gibi her birinden bir \u00e7iftte yakalanabilir.\n\nKullan\u0131c\u0131 online olup sepetine bir \u00fcr\u00fcn ekledi\u011finde bizim o \u00fcr\u00fcn\u00fcn id sini al\u0131p support, confidence ve lift de\u011ferlerine g\u00f6re ona  tavsiye edilecek \u00fcr\u00fcn\/\u00fcr\u00fcnleri bulup kar\u015f\u0131s\u0131na getirmemiz laz\u0131m.","674ca1f4":"# 2) Veri \u00d6n \u0130\u015fleme (Data Preprocessing)","f5cc79f2":"# 1) Ke\u015fif\u00e7i Veri Analizi (EDA)","e65b4192":"# 3) Ayk\u0131r\u0131 De\u011ferler (Outliers)"}}