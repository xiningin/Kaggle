{"cell_type":{"82655661":"code","db81b989":"code","d6888f7c":"code","1874e575":"code","9583d159":"code","ecf17562":"code","6004630f":"code","87fb6cde":"code","f6553097":"code","3239ecc7":"code","0859db70":"code","bce4e386":"code","fb865a5e":"code","08e1f940":"code","0c649820":"code","074c9481":"code","dbfbca98":"code","20b4f110":"code","a067adbe":"code","41ff2e6c":"code","9c8a4e97":"code","3885ecae":"code","02ea930e":"code","2232f73b":"markdown","3804b739":"markdown","d976641b":"markdown","8bc9ded9":"markdown"},"source":{"82655661":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport os\nimport zipfile  # for processing the zip files\n\nimport cv2  # for image processing\n\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nimport random\nimport gc  # garbage collector","db81b989":"for dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","d6888f7c":"TRAIN_ZIP = '..\/input\/dogs-vs-cats-redux-kernels-edition\/train.zip'\nzip_ref = zipfile.ZipFile(TRAIN_ZIP, 'r')\nzip_ref.extractall('training')\nzip_ref.close()","1874e575":"TEST_ZIP = '..\/input\/dogs-vs-cats-redux-kernels-edition\/test.zip'\nzip_ref = zipfile.ZipFile(TEST_ZIP, 'r')\nzip_ref.extractall('test_all')\nzip_ref.close()","9583d159":"TRAIN_DIR = '\/kaggle\/working\/training\/train\/'\nTEST_DIR = '\/kaggle\/working\/test_all\/test\/'\n\ntrain_dogs = [TRAIN_DIR + i for i in os.listdir(TRAIN_DIR) if 'dog' in i]\ntrain_cats = [TRAIN_DIR + i for i in os.listdir(TRAIN_DIR) if 'cat' in i]\n\ntest_imgs = [TEST_DIR + i for i in os.listdir(TEST_DIR)]\n\n# take trianing images from both classes\ntrain_imgs = train_dogs[:2500] + train_cats[:2500]\nrandom.shuffle(train_imgs)  # randomly shuffle the images\n\ndel train_dogs\ndel train_cats\ngc.collect()","ecf17562":"# view some sample images\nimport matplotlib.image as mpimg\n\nfor image in train_imgs[:10]:\n    img = mpimg.imread(image)\n    plt.figure()\n    plt.imshow(img)","6004630f":"def process_images(list_of_images):\n    x = []  # holds images\n    y = []  # hold labels\n    \n    for image in list_of_images:\n        x.append(\n            cv2.resize(\n                cv2.imread(image, cv2.IMREAD_COLOR),\n                (height, width),\n                interpolation=cv2.INTER_CUBIC\n            )\n        )\n        \n        if 'dog' in image:\n            y.append(1)\n        if 'cat' in image:\n            y.append(0)\n    \n    return x, y","87fb6cde":"height = 200\nwidth = 200\nplanes = 3  # for color image\n\nX, y = process_images(train_imgs)\n\ndel train_imgs\ngc.collect()","f6553097":"X = np.asarray(X)\ny = np.asarray(y)\n\nimport seaborn as sns\nsns.countplot(y)\nplt.title('Labels')\n\nprint(\"Train image array shape:\", X.shape)\nprint(\"Label array shape:\", y.shape)","3239ecc7":"from sklearn.model_selection import train_test_split\n\nX_train, X_val, Y_train, Y_val = train_test_split(X, y, test_size=0.2, random_state=2)\n\ndel X\ndel y\ngc.collect()\n\nnum_of_train_imgs = len(X_train)\nnum_of_val_imgs = len(X_val)","0859db70":"from keras.models import Sequential\nfrom keras.layers import Conv2D, MaxPooling2D, Flatten, Dropout, Dense\nfrom keras.preprocessing.image import ImageDataGenerator, img_to_array, load_img\nfrom tensorflow.keras.optimizers import RMSprop","bce4e386":"model = Sequential()\n\nmodel.add(Conv2D(32, (3,3), activation='relu', input_shape=(200, 200, 3)))\nmodel.add(MaxPooling2D((2,2)))\n\nmodel.add(Conv2D(64, (3,3), activation='relu'))\nmodel.add(MaxPooling2D((2,2)))\n\nmodel.add(Conv2D(128, (3,3), activation='relu'))\nmodel.add(MaxPooling2D((2,2)))\n\nmodel.add(Conv2D(128, (3,3), activation='relu'))\nmodel.add(MaxPooling2D((2,2)))\n\nmodel.add(Flatten())\nmodel.add(Dropout(0.3))\nmodel.add(Dense(512, activation='relu'))\nmodel.add(Dense(1, activation='sigmoid'))\n\nmodel.compile(loss='binary_crossentropy', optimizer=RMSprop(lr=0.001), metrics=['acc'])\nmodel.summary()","fb865a5e":"# image generation\n\ntrain_image_gen = ImageDataGenerator(rescale=1.0\/255,\n                                    rotation_range=50,\n                                    width_shift_range=0.2,\n                                    height_shift_range=0.2,\n                                    shear_range=0.2,\n                                    zoom_range=0.2,\n                                    horizontal_flip=True,\n                                    vertical_flip=True)\n\nval_image_gen= ImageDataGenerator(rescale=1.0\/255)","08e1f940":"batch_size = 32\n\ntrain_image_generator = train_image_gen.flow(X_train, Y_train, batch_size=batch_size)\nval_image_generator = val_image_gen.flow(X_val, Y_val, batch_size=batch_size)","0c649820":"history = model.fit_generator(train_image_generator,\n                     steps_per_epoch=num_of_train_imgs \/\/ batch_size,\n                     epochs=50,\n                     validation_data=val_image_generator,\n                     validation_steps=num_of_val_imgs \/\/ batch_size)","074c9481":"train_loss = history.history['loss']\nval_loss = history.history['val_loss']\n\ntrain_acc = history.history['acc']\nval_acc = history.history['val_acc']\n\nepochs = range(1, len(train_acc) + 1)\n\n# train and val acc\nplt.plot(epochs, train_acc, 'b', label='Training acc')\nplt.plot(epochs, val_acc, 'r', label='Val acc')\nplt.title('Training and Validation accuracy')\nplt.legend()\n\n# train and val loss\nplt.figure()\nplt.plot(epochs, train_loss, 'b', label='Training loss')\nplt.plot(epochs, val_loss, 'r', label='Val loss')\nplt.title('Training and Validation loss')\nplt.legend()\n\nplt.show()","dbfbca98":"del X_train\ndel Y_train\ndel X_val\ndel Y_val\n\ngc.collect()","20b4f110":"# print(test_imgs[0][30:-4])\nids = [a[30:-4] for a in test_imgs]\nprint(ids[:10])","a067adbe":"x_test, y_test = process_images(test_imgs)\nX = np.asarray(x_test)\n\ndel x_test\ngc.collect()\n\ntest_datagen = ImageDataGenerator(rescale=1.0\/255)\ntest_generator = test_datagen.flow(X, batch_size=1, shuffle=False)","41ff2e6c":"predictions = model.predict_generator(test_generator, verbose=1)","9c8a4e97":"predictions = predictions.flatten()","3885ecae":"res = []\nfor i in predictions:\n    if i >=0.5:\n        res.append(1)\n    else:\n        res.append(0)","02ea930e":"sub_df = pd.DataFrame({\"id\": ids, \"label\": predictions})\nsub_df.to_csv(\"dogs_cats_predict.csv\", index = False)\nsub_df.head()","2232f73b":"# prediction","3804b739":"# Create the model","d976641b":"# Resizing the images","8bc9ded9":"# Train test splitting"}}