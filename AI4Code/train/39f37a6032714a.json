{"cell_type":{"63e1643a":"code","5d3d9cad":"code","5d060d57":"code","894fd9f8":"code","2bc0475c":"code","a587cb84":"code","b2369efb":"code","2c2774bb":"code","b82bfa83":"code","81d58b75":"code","f89d472d":"code","95ffd4d1":"code","5eef1cd4":"code","e009a74a":"code","ea04dfc4":"code","3a1721e3":"code","cab36f6a":"code","6d4d670e":"code","0086d7b4":"code","27bfe013":"code","f6b0c12b":"code","d6508177":"code","0294a46d":"code","d800af72":"code","7c195eef":"code","3dbb1639":"code","ab3b9233":"code","b3fac3e4":"code","0688925b":"code","ae1e3764":"code","c1916db7":"markdown","b63ebd02":"markdown","c3fd27e5":"markdown","92e56165":"markdown","6d40d013":"markdown","cd21c559":"markdown","3e00d30c":"markdown","cea5c01d":"markdown","0565f630":"markdown","b747f6be":"markdown","d7478af2":"markdown","a1636751":"markdown","01b302a3":"markdown","ff7eaf88":"markdown","6540e08a":"markdown","c8d200a1":"markdown","c38b67a7":"markdown","1a279faa":"markdown","e45f0f59":"markdown","feac2dfe":"markdown","a24eae82":"markdown","c31ac087":"markdown","e9244d57":"markdown","5986f3ff":"markdown","961e5879":"markdown","6a8ab0ae":"markdown","4daf7a60":"markdown"},"source":{"63e1643a":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport folium\nfrom folium.plugins import HeatMap","5d3d9cad":"# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","5d060d57":"train_df=pd.read_csv(\"\/kaggle\/input\/bigquery-geotab-intersection-congestion\/train.csv\")\ntest_df=pd.read_csv(\"\/kaggle\/input\/bigquery-geotab-intersection-congestion\/test.csv\")","894fd9f8":"train_df.head()","2bc0475c":"train_df.isnull().sum()","a587cb84":"#Finding the columns whether they are categorical or numerical\ncols = train_df.columns\nnum_cols = train_df._get_numeric_data().columns\nprint(\"Numerical Columns\",num_cols)\ncat_cols=list(set(cols) - set(num_cols))\nprint(\"Categorical Columns:\",cat_cols)","b2369efb":"train=train_df\ntrain_df=train_df.dropna()","2c2774bb":"train_df.City.unique()","b82bfa83":"Atlanda=train_df[train_df['City']=='Atlanta']\nBoston=train_df[train_df['City']=='Boston']\nChicago=train_df[train_df['City']=='Chicago']\nPhiladelphia=train_df[train_df['City']=='Philadelphia']","81d58b75":"Atlanda['TotalTimeWaited']=Atlanda['TotalTimeStopped_p20']+Atlanda['TotalTimeStopped_p40']+Atlanda['TotalTimeStopped_p50']+Atlanda['TotalTimeStopped_p60']+Atlanda['TotalTimeStopped_p80']\nBoston['TotalTimeWaited']=Boston['TotalTimeStopped_p20']+Boston['TotalTimeStopped_p40']+Boston['TotalTimeStopped_p50']+Boston['TotalTimeStopped_p60']+Boston['TotalTimeStopped_p80']\nChicago['TotalTimeWaited']=Chicago['TotalTimeStopped_p20']+Chicago['TotalTimeStopped_p40']+Chicago['TotalTimeStopped_p50']+Chicago['TotalTimeStopped_p60']+Chicago['TotalTimeStopped_p80']\nPhiladelphia['TotalTimeWaited']=Philadelphia['TotalTimeStopped_p20']+Philadelphia['TotalTimeStopped_p40']+Philadelphia['TotalTimeStopped_p50']+Philadelphia['TotalTimeStopped_p60']+Philadelphia['TotalTimeStopped_p80']","f89d472d":"fig, axes = plt.subplots(nrows=2, ncols=2)\nfig = plt.figure(figsize=(20,16))\ntemp_1=Atlanda.groupby('EntryStreetName')['TotalTimeWaited'].mean().sort_values().tail(10)\ntemp_1.plot(kind='barh',ax=axes[0,0],figsize=(20,16),title='Highest traffic startng street in Atlanta')\n\ntemp_2=Boston.groupby('EntryStreetName')['TotalTimeWaited'].mean().sort_values().tail(10)\ntemp_2.plot(kind='barh',ax=axes[0,1],figsize=(20,16),title='Highest traffic startng street in Boston')\n\ntemp_3=Chicago.groupby('EntryStreetName')['TotalTimeWaited'].mean().sort_values().tail(10)\ntemp_3.plot(kind='barh',ax=axes[1,0],figsize=(20,16),title='Highest traffic startng street in Chicago')\n\ntemp_4=Philadelphia.groupby('EntryStreetName')['TotalTimeWaited'].mean().sort_values().tail(10)\ntemp_4.plot(kind='barh',ax=axes[1,1],figsize=(20,16),title='Highest traffic startng street in Philadelphia')\n","95ffd4d1":"fig, axes = plt.subplots(nrows=2, ncols=2)\nfig = plt.figure(figsize=(20,16))\ntemp_1=Atlanda.groupby('ExitStreetName')['TotalTimeWaited'].mean().sort_values().tail(10)\ntemp_1.plot(kind='barh',ax=axes[0,0],figsize=(20,16),title='Highest Traffic ending streets in Atlanta')\n\ntemp_2=Boston.groupby('ExitStreetName')['TotalTimeWaited'].mean().sort_values().tail(10)\ntemp_2.plot(kind='barh',ax=axes[0,1],figsize=(20,16),title='Highest Traffic ending streets Boston')\n\ntemp_3=Chicago.groupby('ExitStreetName')['TotalTimeWaited'].mean().sort_values().tail(10)\ntemp_3.plot(kind='barh',ax=axes[1,0],figsize=(20,16),title='Highest Traffic ending streets Chicago')\n\ntemp_4=Philadelphia.groupby('ExitStreetName')['TotalTimeWaited'].mean().sort_values().tail(10)\ntemp_4.plot(kind='barh',ax=axes[1,1],figsize=(20,16),title='Highest Traffic ending streets Philadelphia')","5eef1cd4":"fig, axes = plt.subplots(nrows=2, ncols=2)\nfig = plt.figure(figsize=(20,16))\ntemp_1=Atlanda.groupby('Path')['TotalTimeWaited'].mean().sort_values().tail(10)\ntemp_1.plot(kind='barh',ax=axes[0,0],figsize=(20,16),title='Wait time in Atlanta')\n\ntemp_2=Boston.groupby('Path')['TotalTimeWaited'].mean().sort_values().tail(10)\ntemp_2.plot(kind='barh',ax=axes[0,1],figsize=(20,16),title='Wait time in Boston')\n\ntemp_3=Chicago.groupby('Path')['TotalTimeWaited'].mean().sort_values().tail(10)\ntemp_3.plot(kind='barh',ax=axes[1,0],figsize=(20,16),title='Wait time in Chicago')\n\ntemp_4=Philadelphia.groupby('Path')['TotalTimeWaited'].mean().sort_values().tail(10)\ntemp_4.plot(kind='barh',ax=axes[1,1],figsize=(20,16),title='Wait time in Philadelphia')","e009a74a":"fig , axes = plt.subplots(nrows=2, ncols=2)\n\n\nA_hr=Atlanda.groupby('Hour')['TotalTimeStopped_p80'].mean()\nA_hr.plot(ax=axes[0,0],title=\"Atlanda's waiting time hourwise trend\",figsize=(20,16))\n\n\nB_hr=Boston.groupby('Hour')['TotalTimeStopped_p80'].mean()\nB_hr.plot(ax=axes[0,1],title=\"Boston's waiting time hourwise trend\",figsize=(20,16))\n\n\nC_hr=Chicago.groupby('Hour')['TotalTimeStopped_p80'].mean()\nC_hr.plot(ax=axes[1,0],title=\"Chicago's waiting time hourwise trend\",figsize=(20,16))\n\n\nP_hr=Philadelphia.groupby('Hour')['TotalTimeStopped_p80'].mean()\nP_hr.plot(ax=axes[1,1],title=\"Philadelphia's waiting time hourwise trend\",figsize=(20,16))\n","ea04dfc4":"fig , axes = plt.subplots(nrows=2, ncols=2)\n\nA_hr=pd.DataFrame(index=Atlanda.Hour.unique())\nA_hr['Weekend']=Atlanda[Atlanda['Weekend']==1].groupby(['Hour'])['TotalTimeStopped_p80'].mean()\nA_hr['Weekday']=Atlanda[Atlanda['Weekend']==0].groupby(['Hour'])['TotalTimeStopped_p80'].mean()\nA_hr=A_hr.sort_index()\nA_hr.plot(ax=axes[0,0],title=\"Weekend vs Weekday trend\",figsize=(20,16))\n\n\nB_hr=pd.DataFrame(index=Boston.Hour.unique())\nB_hr['Weekend']=Boston[Boston['Weekend']==1].groupby(['Hour'])['TotalTimeStopped_p80'].mean()\nB_hr['Weekday']=Boston[Boston['Weekend']==0].groupby(['Hour'])['TotalTimeStopped_p80'].mean()\nB_hr=B_hr.sort_index()\nB_hr.plot(ax=axes[0,1],title=\"Boston's waiting time hourwise trend\",figsize=(20,16))\n\n\nC_hr=pd.DataFrame(index=Chicago.Hour.unique())\nC_hr['Weekend']=Chicago[Chicago['Weekend']==1].groupby(['Hour'])['TotalTimeStopped_p80'].mean()\nC_hr['Weekday']=Chicago[Chicago['Weekend']==0].groupby(['Hour'])['TotalTimeStopped_p80'].mean()\nC_hr=C_hr.sort_index()\nC_hr.plot(ax=axes[1,0],title=\"Weekend vs Weekday trend\",figsize=(20,16))\n\n\nP_hr=pd.DataFrame(index=Atlanda.Hour.unique())\nP_hr['Weekend']=Philadelphia[Philadelphia['Weekend']==1].groupby(['Hour'])['TotalTimeStopped_p80'].mean()\nP_hr['Weekday']=Philadelphia[Philadelphia['Weekend']==0].groupby(['Hour'])['TotalTimeStopped_p80'].mean()\nP_hr=P_hr.sort_index()\nP_hr.plot(ax=axes[1,1],title=\"Weekend vs Weekday trend\",figsize=(20,16))","3a1721e3":"trafficdf=Atlanda.groupby(['Latitude','Longitude'])['TotalTimeStopped_p20'].count()\ntrafficdf=trafficdf.to_frame()\ntrafficdf.columns.values[0]='count1'\ntrafficdf=trafficdf.reset_index()\nlats=trafficdf[['Latitude','Longitude','count1']].values.tolist()\n    \nhmap = folium.Map(location=[min(Atlanda['Latitude']),min(Atlanda['Longitude'])], zoom_start=10, )\nhmap.add_child(HeatMap(lats, radius = 5))\nhmap\n","cab36f6a":"trafficdf=Chicago.groupby(['Latitude','Longitude'])['TotalTimeStopped_p60'].count()\ntrafficdf=trafficdf.to_frame()\ntrafficdf.columns.values[0]='count1'\ntrafficdf=trafficdf.reset_index()\nlats=trafficdf[['Latitude','Longitude','count1']].values.tolist()\n    \nhmap = folium.Map(location=[min(Chicago['Latitude']),min(Chicago['Longitude'])], zoom_start=9, )\nhmap.add_child(HeatMap(lats, radius = 5))\nhmap","6d4d670e":"trafficdf=Boston.groupby(['Latitude','Longitude'])['TotalTimeStopped_p60'].count()\ntrafficdf=trafficdf.to_frame()\ntrafficdf.columns.values[0]='count1'\ntrafficdf=trafficdf.reset_index()\nlats=trafficdf[['Latitude','Longitude','count1']].values.tolist()\n    \nhmap = folium.Map(location=[min(Boston['Latitude']),min(Boston['Longitude'])], zoom_start=10.5, )\nhmap.add_child(HeatMap(lats, radius = 5))\nhmap","0086d7b4":"trafficdf=Philadelphia.groupby(['Latitude','Longitude'])['TotalTimeStopped_p60'].count()\ntrafficdf=trafficdf.to_frame()\ntrafficdf.columns.values[0]='count1'\ntrafficdf=trafficdf.reset_index()\nlats=trafficdf[['Latitude','Longitude','count1']].values.tolist()\n    \nhmap = folium.Map(location=[min(Philadelphia['Latitude']),min(Philadelphia['Longitude'])], zoom_start=10, )\nhmap.add_child(HeatMap(lats, radius = 5))\nhmap","27bfe013":"train['EntryHeading']","f6b0c12b":"#Creating Dummies for train Data\ndfen = pd.get_dummies(train[\"EntryHeading\"],prefix = 'en')\ndfex = pd.get_dummies(train[\"ExitHeading\"],prefix = 'ex')\ntrain = pd.concat([train,dfen],axis=1)\ntrain = pd.concat([train,dfex],axis=1)\n\n#Creating Dummies for test Data\ndfent = pd.get_dummies(test_df[\"EntryHeading\"],prefix = 'en')\ndfext = pd.get_dummies(test_df[\"ExitHeading\"],prefix = 'ex')\ntest_df = pd.concat([test_df,dfent],axis=1)\ntest_df = pd.concat([test_df,dfext],axis=1)\n","d6508177":"#Training Data\nX = train[[\"IntersectionId\",\"Hour\",\"Weekend\",\"Month\",'en_E',\n       'en_N', 'en_NE', 'en_NW', 'en_S', 'en_SE', 'en_SW', 'en_W', 'ex_E',\n       'ex_N', 'ex_NE', 'ex_NW', 'ex_S', 'ex_SE', 'ex_SW', 'ex_W']]\ny1 = train[\"TotalTimeStopped_p20\"]\ny2 = train[\"TotalTimeStopped_p50\"]\ny3 = train[\"TotalTimeStopped_p80\"]\ny4 = train[\"DistanceToFirstStop_p20\"]\ny5 = train[\"DistanceToFirstStop_p50\"]\ny6 = train[\"DistanceToFirstStop_p80\"]","0294a46d":"testX = test_df[[\"IntersectionId\",\"Hour\",\"Weekend\",\"Month\",'en_E','en_N', 'en_NE', 'en_NW', 'en_S', \n              'en_SE', 'en_SW', 'en_W', 'ex_E','ex_N', 'ex_NE', 'ex_NW', 'ex_S', 'ex_SE', 'ex_SW', 'ex_W']]","d800af72":"from catboost import CatBoostRegressor\ncb_model_1 = CatBoostRegressor(iterations=700,\n                             learning_rate=0.02,\n                             depth=12,\n                             eval_metric='RMSE',\n                             random_seed = 23,\n                             bagging_temperature = 0.2,\n                             od_type='Iter',\n                             metric_period = 75,\n                             od_wait=100)\ncb_model_1.fit(X, y1)\npred_1=cb_model_1.predict(testX)","7c195eef":"cb_model_2 = CatBoostRegressor(iterations=700,\n                             learning_rate=0.02,\n                             depth=12,\n                             eval_metric='RMSE',\n                             random_seed = 23,\n                             bagging_temperature = 0.2,\n                             od_type='Iter',\n                             metric_period = 75,\n                             od_wait=100)\ncb_model_2.fit(X, y2)\npred_2=cb_model_2.predict(testX)","3dbb1639":"cb_model_3 = CatBoostRegressor(iterations=700,\n                             learning_rate=0.02,\n                             depth=12,\n                             eval_metric='RMSE',\n                             random_seed = 23,\n                             bagging_temperature = 0.2,\n                             od_type='Iter',\n                             metric_period = 75,\n                             od_wait=100)\ncb_model_3.fit(X, y3)\npred_3=cb_model_3.predict(testX)","ab3b9233":"cb_model_4 = CatBoostRegressor(iterations=700,\n                             learning_rate=0.02,\n                             depth=12,\n                             eval_metric='RMSE',\n                             random_seed = 23,\n                             bagging_temperature = 0.2,\n                             od_type='Iter',\n                             metric_period = 75,\n                             od_wait=100)\ncb_model_4.fit(X, y4)\npred_4=cb_model_1.predict(testX)","b3fac3e4":"cb_model_5 = CatBoostRegressor(iterations=700,\n                             learning_rate=0.02,\n                             depth=12,\n                             eval_metric='RMSE',\n                             random_seed = 23,\n                             bagging_temperature = 0.2,\n                             od_type='Iter',\n                             metric_period = 75,\n                             od_wait=100)\ncb_model_5.fit(X, y5)\npred_5=cb_model_5.predict(testX)","0688925b":"cb_model_6 = CatBoostRegressor(iterations=700,\n                             learning_rate=0.02,\n                             depth=12,\n                             eval_metric='RMSE',\n                             random_seed = 23,\n                             bagging_temperature = 0.2,\n                             od_type='Iter',\n                             metric_period = 75,\n                             od_wait=100)\ncb_model_6.fit(X, y6)\npred_6=cb_model_6.predict(testX)","ae1e3764":"# Appending all predictions\nprediction = []\nfor i in range(len(pred_1)):\n    for j in [pred_1,pred_2,pred_3,pred_4,pred_5,pred_6]:\n        prediction.append(j[i])\n        \nsubmission = pd.read_csv(\"..\/input\/bigquery-geotab-intersection-congestion\/sample_submission.csv\")\nsubmission[\"Target\"] = prediction\nsubmission.to_csv(\"Submission_CB.csv\",index = False)","c1916db7":"Thanks **Pulkit Mehta** for the kernel","b63ebd02":"## Exploratory Data Analysis","c3fd27e5":"**Understanding the nature of data**","92e56165":"## About the Competition","6d40d013":"**Most Traffic Path**","cd21c559":"## Feature Engineering","3e00d30c":"**Highest Traffic Starting street**","cea5c01d":"**More Traffic Area's Geospatial plot**","0565f630":"**Necessary Libraries**","b747f6be":"**Waitage time hour wise pattern**","d7478af2":"**Boston's More Traffied Area**","a1636751":"Since I'm gonna work on EDA in this kernel, I will drop the missing values","01b302a3":"**Reading the Files**","ff7eaf88":"**Philadelphia's More Trafficed Area's**","6540e08a":"The dataset for this competition includes aggregate stopped vehicle information and intersection wait times. Your task is to predict congestion, based on an aggregate measure of stopping distance and waiting times, at intersections in 4 major US cities: Atlanta, Boston, Chicago & Philadelphia.","c8d200a1":"**Highest Traffic ending street**","c38b67a7":"**Key Take Aways**\n\n Exploratory Data Analysis\n \n Extensive Modelling","1a279faa":"**Kindly upvote if you like or find useful of the kernel**","e45f0f59":"![image.png](attachment:image.png)\n","feac2dfe":"**Weekend vs WeekDays Trend**","a24eae82":"**Let's start getting insights**","c31ac087":"**Chicago's More Trafficed area**","e9244d57":"**City's Area's with more waitage time's**","5986f3ff":"**I'll be working extensively in Feature Engineering and Modelling part in coming days**\n\n","961e5879":"**Other Works**\nI have also published a kernal on the reason behind Choosing Catboost regressor. Please take a look to have a better understanding \n\n**Comparative Study of Model's**\nhttps:\/\/www.kaggle.com\/pradeepmuniasamy\/comparative-study-of-models-geotab-inertsection","6a8ab0ae":"## Modelling","4daf7a60":"Let's understand nature of the data citywise"}}