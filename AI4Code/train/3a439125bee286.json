{"cell_type":{"922991f9":"code","268dd1e4":"code","60467e74":"code","c83d5f9b":"code","7f004f49":"code","e33055aa":"code","4c44a3eb":"code","491bf69f":"code","e5fd9252":"code","8d93aa64":"code","61c823c8":"code","61ad7c65":"code","3c4fc232":"code","893e15be":"code","d84721cc":"code","a2243845":"code","9f71fc7c":"markdown","50c3826e":"markdown","4ab2712f":"markdown","28046d31":"markdown","bc7f99ff":"markdown","10aa95ac":"markdown","b0de7d11":"markdown","b995cacd":"markdown","7b26740d":"markdown","99305634":"markdown","55778908":"markdown"},"source":{"922991f9":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport random\n\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n\n# Default Configs\npd.options.display.float_format = '{:,.4f}'.format # format float\nsns.set(style=\"whitegrid\") ## white background on seaborn\nplt.style.use('seaborn')\n# Random Number\nseed = 42\nnp.random.seed(seed)\nrandom.seed(seed)","268dd1e4":"from bokeh.io import show\nfrom bokeh.plotting import figure\nfrom bokeh.models import LinearColorMapper, HoverTool, ColorBar\nfrom bokeh.palettes import magma,viridis,cividis, inferno\nfrom bokeh.models import WheelZoomTool, BoxZoomTool, ResetTool\n\ndef eda_us_states_geo_plot(geosource, df_in, title, column, state_column, low = -1, high = -1, palette = -1, plot_width=500):\n    \"\"\"\n    Generate Bokeh Plot to Brazil States:\n        geosource: GeoJSONDataSource of Bokeh\n        df_in: DataSet before transformed in GeoJSONDataSource\n        title: title of plot\n        column: column of df_in to be placed values in geoplot\n        state_column: indicate column with names of States\n        low = (optional) min value of range of color spectre\n        high = (optional) max values of range of color spectre\n        palette: (optional) can be magma, viridis, civis, inferno e etc.. (with number os colors)\n            Example: cividis(8) (8 colors to classify), cividis(256)  (256, more colors to clasify)\n    \"\"\"\n    if high == -1:\n        print(df_in.columns.tolist())\n        df_in[column] = pd.to_numeric(df_in[column],errors = 'coerce')\n        high = max(df_in[column])\n    if low == -1:\n        low = min(df_in[column])\n    if palette == -1:\n        palette = inferno(24)\n        \n    palette = palette[::-1]\n    color_mapper = LinearColorMapper(palette = palette, low = low, high = high)\n    \n    hover = HoverTool(tooltips = [ ('Team\/NOC','@{'+'name'+'}'), (column, '@{'+column+'}{%.2f}')],\n                  formatters={'@{'+column+'}' : 'printf'})\n\n    color_bar = ColorBar(color_mapper=color_mapper, label_standoff=8, width = 450, height = 20, \n                         border_line_color=None, location = (0,0),  orientation = 'horizontal')\n\n    p = figure(title = title, plot_height = 400, plot_width = plot_width, tools = [hover])\n\n    p.xgrid.grid_line_color = None\n    p.ygrid.grid_line_color = None\n    p.xaxis.visible = False\n    p.yaxis.visible = False\n\n    p.patches('xs','ys', source = geosource, line_color = 'black', line_width = 0.25,\n              fill_alpha = 1, fill_color = {'field' : str(column), 'transform' : color_mapper})\n\n    p.add_layout(color_bar, 'below')\n    p.add_tools(WheelZoomTool())\n    p.add_tools(ResetTool())\n    return p   \n\nfrom bokeh.palettes import Turbo256 \nfrom bokeh.models import ColumnDataSource\nfrom bokeh.transform import factor_cmap\nfrom bokeh.palettes import magma,viridis,cividis, inferno\n\ndef eda_bokeh_horiz_bar_ranked(df, column_target, title = '', int_top = 3, second_target = 'Team\/NOC'):\n    \"\"\"\n    Generate Bokeh Plot ranking top fists and last value:\n        df: data_frame\n        column_targe: a column of df inputed\n        title: title of plot\n        int_top: number of the tops\n        column: column of df_in to be placed values in geoplot\n        second_targe = 'state'\n    \"\"\"\n    ranked = df.sort_values(by=column_target, ascending=False).reset_index(drop = True)\n    ranked = ranked.dropna()\n    top_int = int_top\n    # top = ranked[:top_int].append(ranked[-top_int:]) # Bottom an Top\n    top = ranked[:top_int+top_int]# only Top\n    top.index = top.index + 1\n    source = ColumnDataSource(data=top)\n    list_second_target = source.data[second_target].tolist()\n    index_label = list_second_target[::-1] # reverse order label\n\n    p = figure(plot_width=500, plot_height=400, y_range=index_label, \n                toolbar_location=None, title=title)   \n\n    p.hbar(y=second_target, right=column_target, source=source, height=0.85, line_color=\"#000000\",\n          fill_color=factor_cmap(second_target, palette=inferno(24), factors=list_second_target))\n    p.x_range.start = 0  # start value of the x-axis\n\n    p.xaxis.axis_label = \"value of '\" + column_target + \"'\"\n\n    hover = HoverTool()  # initiate hover tool\n    hover.tooltips = [(\"Value\",\"@{\" + column_target + \"}{%.2f}\" ),(\"Ranking\",\"@index\u00b0\")]\n    hover.formatters={'@{'+column_target+'}' : 'printf'}\n\n    hover.mode = 'hline' # set the mode of the hover tool\n    p.add_tools(hover)   # add the hover tooltip to the plot\n\n    return p # show in notebook\n\ndef eda_geoplot_country_rank_plot(the_df, primary_column, target_column, first_title, second_title, int_top = 10,\n                                  location_column = 'Team\/NOC', ):\n    \"\"\"\n    Execute and show all together:\n    @ primary_columns must to be a float to join to make a GeoSource\n    generate_GeoJSONSource_to_districts()\n    eda_seoul_districts_geo_plot()\n    eda_bokeh_horiz_bar_ranked()\n    \"\"\"\n    the_df = the_df.rename({primary_column: target_column}, axis = 1)\n\n    geo_source = generate_GeoJSONSource(the_df)\n\n    geo = eda_us_states_geo_plot(geo_source, the_df, first_title,\n                                       target_column, location_column, palette = inferno(32))\n\n    # rank 8 bottom and Up\n    rank = eda_bokeh_horiz_bar_ranked(the_df, target_column, second_title,\n                                      int_top = int_top, second_target = 'Team\/NOC')\n\n    show( row( geo, rank ))","60467e74":"import os\nfor dirname, _, filenames in os.walk('\/kaggle\/'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","c83d5f9b":"medals_file = '\/kaggle\/input\/olympic-games-2021-medals\/Tokyo 2021 dataset.csv'\nworld_file = '\/kaggle\/input\/world-map-eckert3\/world-eckert3.geo.json'","7f004f49":"# Import Tokyo Medals file and Simple Exploratory Data Analysis\nfile_path = medals_file\n\ndf = pd.read_csv(file_path)\nprint(\"DataSet of Tokyo 2021 Medals = {:,d} rows and {} columns\".format(df.shape[0], df.shape[1]))\n\nprint(\"\\nAll Columns:\\n=>\", df.columns.tolist())\n\nquantitative = [f for f in df.columns if df.dtypes[f] != 'object']\nqualitative = [f for f in df.columns if df.dtypes[f] == 'object']\n\nprint(\"\\nStrings Variables:\\n=>\", qualitative,\n      \"\\n\\nNumerics Variables:\\n=>\", quantitative)\n\ndf.head()","e33055aa":"df.head()","4c44a3eb":"from bokeh.io import output_notebook, show\nfrom bokeh.plotting import figure\nfrom bokeh.models.tools import HoverTool\nfrom bokeh.models import GeoJSONDataSource\nfrom bokeh.layouts import row\noutput_notebook()\n\nimport geopandas as gpd\n\n# import geojson\ngeojson = gpd.read_file(world_file)\n\n# delete useless columns\nlist_to_delete = ['id', 'hc-group', 'hc-middle-x', 'hc-middle-y', 'hc-key', 'hc-a2',\n                  'labelrank', 'woe-id', 'labelrank', 'iso-a3', 'iso-a2', 'woe-id']\ngeojson = geojson.drop(list_to_delete, axis = 1) \n\n# # Replace in GEO\nreplace_dict = {'United States of America': 'USA', 'United Republic of Tanzania': 'Tanzania',\n                'Republic of Serbia': 'Serbia', 'The Bahamas':'Bahamas', 'United Kingdom': 'UK', \n               'Republic of Congo': 'Congo', 'Czech Republic': 'Czechia', 'South Korea': 'S. Korea',\n}\ngeojson = geojson.dropna().replace(replace_dict)\n\n# show\ngeojson.head(3)","491bf69f":"# fix df_tokyo 'Team\/NOC' by correct countries\ndict_replace_tokyo_medals = {\n    'Syrian Arab Republic': 'Syria',\n    'Republic of Korea': 'South Korea',\n    'Republic of Moldova': 'Moldova',\n    'Czech Republic': 'Czechia',\n    'Islamic Republic of Iran': 'Iran',\n    \"C\u00f4te d'Ivoire\": 'Ivory Coast',\n    'Great Britain': 'UK',\n    'United States of America': 'USA',\n    \"People's Republic of China\": 'China',\n    'ROC': 'Russia',\n}\ndf['Team\/NOC'] = df['Team\/NOC'].replace(dict_replace_tokyo_medals)","e5fd9252":"# Get GeoJSON, merge with tokyo_medals and out-put Bookeh GeoJSON\ndef generate_GeoJSONSource(my_df):\n    global geojson\n    geo_source_merged = geojson.merge(df, left_on = 'name', right_on = 'Team\/NOC')\n    with pd.option_context('display.max_rows', None, 'display.max_columns', None):  # more options can be specified also\n#         print(geo_source_merged)\n        print(len(geo_source_merged))\n    return GeoJSONDataSource( geojson = geo_source_merged.to_json())","8d93aa64":"# Check If exist a name in 'df['Team\/NOC']' and don't has in geojson['name']\n\ndf_column = 'Team\/NOC'\ngeojson_country_column = 'name'\n\ngeo_source_merged = geojson.merge(df, left_on = geojson_country_column, right_on = df_column, how='right') # Join\ngeo_source_merged[geojson_country_column] = geo_source_merged[geojson_country_column].fillna('mising')\n\n# list of contries in geoJSON\ngeojson_countries = geojson[geojson_country_column].tolist()\ngeojson_countries.sort()\n\n# list of contries in COVID-DATASET\ncovid_data_countries = df[df_column].tolist()\ncovid_data_countries.sort()\n\ndata_in_tokyo_not_in_geo = []\nfor country in covid_data_countries:\n    if(country not in geojson_countries):\n        data_in_tokyo_not_in_geo.append(country)\n        \ndata_in_geo_not_in_tokyo = []\nfor country in geojson_countries:\n    if(country not in covid_data_countries):\n        data_in_geo_not_in_tokyo.append(country)\n        \nprint('\\nHas in TOKYO but NOT IN GEO (SHOW TOKYO):\\n', data_in_tokyo_not_in_geo)\nprint('\\nHas in GEO but NOT IN TOKYO (SHOW GEO):\\n', data_in_geo_not_in_tokyo)","61c823c8":"# Remove Contries from Tokyo CSV\ndf = df.drop(df[df['Team\/NOC'].isin(data_in_tokyo_not_in_geo)].index, axis=0) # remove_list: removes mismatched data\ndf.head()","61ad7c65":"df_geo_all_countries = geojson.merge(df, left_on = 'name', right_on = 'Team\/NOC', how = \"left\")\n\nfor col in ['Gold Medal', 'Silver Medal', 'Bronze Medal', 'Total']:\n    df_geo_all_countries[col] = df_geo_all_countries[col].fillna(0.0)\ndf_geo_all_countries['Team\/NOC'] = df_geo_all_countries['name']\n    \ndf_geo_all_countries.head()\n","3c4fc232":"primary_col = 'Gold Medal'\n\ndf_aux = df.groupby(['Team\/NOC']).sum()[primary_col].reset_index()\n\nprint(df_aux)\n\neda_geoplot_country_rank_plot(df_aux, primary_col, primary_col,\n                           \"Total Gold Medal in World\", \"The Top 20 Countries in Gold Medal\")","893e15be":"primary_col = 'Silver Medal'\n\ndf_aux = df.groupby(['Team\/NOC']).sum()[primary_col].reset_index()\n\neda_geoplot_country_rank_plot(df_aux, primary_col, primary_col,\n                           \"Total Silver Medal in World\", \"The Top 20 Countries in Silver Medal\")","d84721cc":"primary_col = 'Bronze Medal'\n\ndf_aux = df.groupby(['Team\/NOC']).sum()[primary_col].reset_index()\n\neda_geoplot_country_rank_plot(df_aux, primary_col, primary_col,\n                           \"Total Bronze Medal in World\", \"The Top 20 Countries in Bronze Medal\")","a2243845":"primary_col = 'Total'\n\ndf_aux = df.groupby(['Team\/NOC']).sum()[primary_col].reset_index()\n\neda_geoplot_country_rank_plot(df_aux, primary_col, primary_col,\n                           \"Total of Medals on World\", \"The Top 20 Countries in Total of Medals\")","9f71fc7c":"### Bronze Medal","50c3826e":"## Df with all countries","4ab2712f":"## Snippets <a id='index02'><\/a> <a href=\"#top\" style=\"background-color: #20beff; border: none; color: white;  padding: 15px 30px;  font-family: sans-serif;  border-radius: 12px;  text-align: center;  text-decoration: none;  display: inline-block;  font-size: 16px;  margin: 4px 2px;  cursor: pointer;\" >Go to TOC<\/a>","28046d31":"## EDA: Map of Count Medals on World <a id='index05'><\/a> <a href=\"#top\" style=\"background-color: #20beff; border: none; color: white;  padding: 15px 30px;  font-family: sans-serif;  border-radius: 12px;  text-align: center;  text-decoration: none;  display: inline-block;  font-size: 16px;  margin: 4px 2px;  cursor: pointer;\" >Go to TOC<\/a>","bc7f99ff":"### Count Total of Medals","10aa95ac":"## Import GeoJson Of World <a id='index04'><\/a> <a href=\"#top\" style=\"background-color: #20beff; border: none; color: white;  padding: 15px 30px;  font-family: sans-serif;  border-radius: 12px;  text-align: center;  text-decoration: none;  display: inline-block;  font-size: 16px;  margin: 4px 2px;  cursor: pointer;\" >Go to TOC<\/a>","b0de7d11":"### Silver Medal","b995cacd":"<h1 align=\"center\"> 2021 Tokyo Olimpic Medals EDA <\/h1>\n\n<img src=\"https:\/\/encrypted-tbn0.gstatic.com\/images?q=tbn:ANd9GcT2J5-y2wFs9m8RNaAyNRLCOsddU0rsPe7V7w&usqp=CAU\" width=\"50%\" style=\"text-align: center;\"\/>\n\nCreated: 2021-08-12 || Last updated: 2021-08-12\n\nKaggle Kernel made by \ud83d\ude80 <a href=\"https:\/\/www.kaggle.com\/rafanthx13\"> Rafael Morais de Assis<\/a>\n\nDataset of Population from from [worlOmeter](https:\/\/www.worldometers.info\/coronavirus\/#countries)","7b26740d":"## Import DataSet <a id='index03'><\/a> <a href=\"#top\" style=\"background-color: #20beff; border: none; color: white;  padding: 15px 30px;  font-family: sans-serif;  border-radius: 12px;  text-align: center;  text-decoration: none;  display: inline-block;  font-size: 16px;  margin: 4px 2px;  cursor: pointer;\" >Go to TOC<\/a>","99305634":"### Top Gold Medals","55778908":"## Table Of Content (TOC) <a id=\"top\"><\/a>\n\n+ [Import Libs](#index01) \n+ [Snippets](#index02)\n+ [Import DataSet](#index03)\n+ [Import GeoJson Of World](#index04)\n+ [EDA: Map of Count Medals on World](#index05)\n\n\n  \n<!-- COMMENTS: OBS: Criado em 11\/08\/2021 => Ver a propor\u00e7ao de medalhas de ouro por habitante, e total de medalahes; Usar popula\u00e7ao do 'COVID19 WorldOMeter TEMP'; Renovar tambem o kaggle 'COVID19 WorldOMeter TEMP'; LEMBRAR DE COMENTAR MIA,S PORQUE ALUNGS SNIPPETS J\u00c1 ESTAO FICANDO CONFSUSO DE LER, DEPOIS DE QUASE 1 ANO FEITO. -->\n<!-- \u00c9 um infrne gerar o mapa. Coloque todos os dados antes de gerar o mapa. Ou seka, fa\u00e7a o WebScraping da popula\u00e7\u00e2o primerio e depois faz os maps, porque ta dando muit problema, ta um inferno sem igual (16\/08\/2021  -->\n\n## Import Libs <a id='index01'><\/a> <a href=\"#top\" style=\"background-color: #20beff; border: none; color: white;  padding: 15px 30px;  font-family: sans-serif;  border-radius: 12px;  text-align: center;  text-decoration: none;  display: inline-block;  font-size: 16px;  margin: 4px 2px;  cursor: pointer;\" >Go to TOC<\/a>"}}