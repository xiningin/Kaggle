{"cell_type":{"a98bf71f":"code","b7838720":"code","6ac37272":"code","716264e6":"code","57784dc4":"code","7622eaad":"code","0b20ef7a":"code","9a733578":"code","4a821499":"code","84fb9c79":"code","3ad1e218":"code","3d4bc690":"code","85f9db43":"code","d8fe0d38":"code","c6962a51":"code","7b8c7ba6":"code","4d56ef80":"code","53dd0062":"code","f421d16b":"code","085b56db":"code","7a2f412f":"code","5a4b1d8f":"code","2b918878":"code","40e5f628":"code","b4e31580":"code","c2a3e7de":"markdown","061cebff":"markdown","38332c53":"markdown","3c49e549":"markdown","071267a8":"markdown","fa57acd5":"markdown","ca06b770":"markdown","6ccc9b75":"markdown","806cdd36":"markdown","ad95884a":"markdown","b2f5ba4a":"markdown","ebe3f8ee":"markdown","47ced8c9":"markdown","257faa04":"markdown","bf6808d2":"markdown","9ba134bc":"markdown","4a2f6a64":"markdown","9ce2deb3":"markdown","87eb1ee4":"markdown","18e27a99":"markdown","23a4b4da":"markdown","88964043":"markdown","87c05bb5":"markdown","895f75a4":"markdown","4b155f16":"markdown","9b811306":"markdown","48591b21":"markdown","ec294953":"markdown","86b4647d":"markdown","4baa1d85":"markdown","2650c657":"markdown","8b0b5a11":"markdown","e94dfc9d":"markdown","76852d89":"markdown","60fdaeb1":"markdown","8bfc0174":"markdown","dab6788c":"markdown","9d551749":"markdown","a9b55e2f":"markdown","4af1d656":"markdown","71d6c799":"markdown","488aafe2":"markdown","e0c6b2b5":"markdown","98af9654":"markdown","2aa802e2":"markdown","df80a328":"markdown"},"source":{"a98bf71f":"import pandas as pd\nimport numpy as np\nimport matplotlib\nimport matplotlib.pyplot as plt\nimport statsmodels.tsa.api as tsa\n\n%matplotlib inline\n\nmatplotlib.style.use(\"Solarize_Light2\")\n\n    \ndef create_us_season(source_df, target_df, feature_name):\n    \"\"\"\n    Winter: December - February (12. 1, 2)\n    Spring: March - May (3. 4, 5)\n    Summer: June - August [6, 7, 8]\n    Fall: September - November (9, 10, 11)\n    \"\"\"\n    month_to_season_map = {\n        1: \"winter\",\n        2: \"winter\",\n        3: \"spring\",\n        4: \"spring\",\n        5: \"spring\",\n        6: \"summer\",\n        7: \"summer\",\n        8: \"summer\",\n        9: \"fall\",\n        10: \"fall\",\n        11: \"fall\",\n        12: \"winter\",\n    }\n    target_df.loc[:, \"us_season\"] = source_df.loc[:, feature_name].dt.month.map(\n        month_to_season_map\n    )\n    return target_df\n\n\ndef create_date_features(source_df, target_df, feature_name):\n    \"\"\"\n    Create new features related to dates\n\n    source_df : DataFrame consisting of the timestamp related feature\n    target_df : DataFrame where new features will be added\n    feature_name : Name of the feature of date type which needs to be decomposed.\n    \"\"\"\n    target_df.loc[:, \"year\"] = source_df.loc[:, feature_name].dt.year.astype(\"uint16\")\n    target_df.loc[:, \"month\"] = source_df.loc[:, feature_name].dt.month.astype(\"uint8\")\n    target_df.loc[:, \"quarter\"] = source_df.loc[:, feature_name].dt.quarter.astype(\n        \"uint8\"\n    )\n    target_df.loc[:, \"weekofyear\"] = (\n        source_df.loc[:, feature_name].dt.isocalendar().week.astype(\"uint8\")\n    )\n\n    target_df.loc[:, \"hour\"] = source_df.loc[:, feature_name].dt.hour.astype(\"uint8\")\n\n    target_df.loc[:, \"day\"] = source_df.loc[:, feature_name].dt.day.astype(\"uint8\")\n    target_df.loc[:, \"day_name\"] = source_df.loc[:, feature_name].dt.day_name()\n    target_df.loc[:, \"dayofweek\"] = source_df.loc[:, feature_name].dt.dayofweek.astype(\n        \"uint8\"\n    )\n\n    target_df.loc[:, \"day_type\"] = np.where(\n        source_df.loc[:, feature_name].dt.dayofweek < 5, \"week_day\", \"week_end\"\n    )\n    target_df.loc[:, \"dayofyear\"] = source_df.loc[:, feature_name].dt.dayofyear.astype(\n        \"uint8\"\n    )\n    target_df.loc[:, \"is_month_start\"] = source_df.loc[\n        :, feature_name\n    ].dt.is_month_start\n    target_df.loc[:, \"is_month_end\"] = source_df.loc[:, feature_name].dt.is_month_end\n    target_df.loc[:, \"is_quarter_start\"] = source_df.loc[\n        :, feature_name\n    ].dt.is_quarter_start\n    target_df.loc[:, \"is_quarter_end\"] = source_df.loc[\n        :, feature_name\n    ].dt.is_quarter_end\n    target_df.loc[:, \"is_year_start\"] = source_df.loc[:, feature_name].dt.is_year_start\n    target_df.loc[:, \"is_year_end\"] = source_df.loc[:, feature_name].dt.is_year_end\n\n    # This is of type object\n    target_df.loc[:, \"month_year\"] = source_df.loc[:, feature_name].dt.to_period(\"M\")\n\n    return target_df\n\n\ndef plt_seasonal_decomposition(df, feature, freq, freq_type=\"daily\", model=\"additive\", figsize=(20, 10)):\n    plt.rcParams[\"figure.figsize\"] = figsize\n    decomposition = tsa.seasonal_decompose(df[feature], model=model, period=freq)\n    decomposition.plot()\n    plt.title(f\"{model} {freq_type} seasonal decomposition of {feature}\")\n    plt.show()\n\n\ndef plt_seasonality(df, feature, freq, freq_type=\"daily\", model=\"additive\", figsize=(20, 10)):\n    plt.rcParams[\"figure.figsize\"] = figsize\n    decomposition = tsa.seasonal_decompose(df[feature], model=model, period=freq)\n    decomposition.seasonal.plot(color=\"blue\", linewidth=0.5)\n    plt.title(f\"{model} {freq_type} seasonality of {feature}\")\n    plt.show()\n\n\ndef plot_trend(df, feature, freq, freq_type=\"daily\", model=\"additive\", figsize=(20, 10)):\n    plt.rcParams[\"figure.figsize\"] = figsize\n    decomposition = tsa.seasonal_decompose(df[feature], model=model, period=freq)\n    decomposition.trend.plot(color=\"blue\", linewidth=0.5)\n    plt.title(f\"{model} {freq_type} seasonality of {feature}\")\n    plt.show()\n\n    \ndef plot_ts_line_groupby(df, ts_index_feature, groupby_feature, value_feature, title, xlabel, ylabel, figsize=(15, 8)):\n    fig, ax = plt.subplots(figsize=figsize)\n    for label, df in df.groupby(groupby_feature):\n        df.set_index(ts_index_feature)[value_feature].plot(\n            kind=\"line\", alpha=0.3, ax=ax, color=\"blue\", linewidth=0.5)\n    plt.title(title)\n    plt.xlabel(xlabel)\n    plt.ylabel(ylabel)\n    plt.show()\n\n    \ndef plot_multiple_seasonalities(df, feature_name, figsize=(20, 6)):\n    period_names = [\"daily\", \"weekly\", \"monthly\", \"quarterly\"]\n    periods = [24, 24*7, 24*30, 24*90]\n\n    for name, period in zip(period_names, periods):\n        plt_seasonality(df.set_index(\"date_time\")[0: period*3], feature=feature_name, freq=period, freq_type=name, figsize=(20, 6))\n\n\ndef plot_boxh_groupby(df, feature_name, by):\n    \"\"\"\n    Box plot with groupby feature\n    \"\"\"\n    df.boxplot(column=feature_name, by=by, vert=False, figsize=(10, 6), color=\"blue\")\n    plt.title(f\"Distribution of {feature_name} by {by}\")\n    plt.show()\n\n\nDATA_DIR = \"\/kaggle\/input\/tabular-playground-series-jul-2021\/\"\ntrain_df = pd.read_csv(f\"{DATA_DIR}\/train.csv\", parse_dates=[\"date_time\"])\ntest_df = pd.read_csv(f\"{DATA_DIR}\/test.csv\", parse_dates=[\"date_time\"])\n\ntrain_df = train_df.sort_values(by=\"date_time\")\n\ntest_df = test_df.sort_values(by=\"date_time\")\n\ntrain_df = create_date_features(train_df, train_df, \"date_time\")\ntrain_df = create_date_features(train_df, train_df, \"date_time\")\ntrain_df = create_us_season(train_df, train_df, \"date_time\")","b7838720":"plot_ts_line_groupby(\n    train_df, \n    ts_index_feature=\"hour\",\n    groupby_feature=\"day\",\n    value_feature=\"target_carbon_monoxide\",\n    title=\"target_carbon_monoxide vs hour of the day\",\n    xlabel=\"Hour of the day\",\n    ylabel=\"target_carbon_monoxide\"\n)","6ac37272":"plot_ts_line_groupby(\n    train_df, \n    ts_index_feature=\"hour\",\n    groupby_feature=\"day\",\n    value_feature=\"target_benzene\",\n    title=\"target_benzene vs hour of the day\",\n    xlabel=\"Hour of the day\",\n    ylabel=\"target_benzene\"\n)","716264e6":"plot_ts_line_groupby(\n    train_df, \n    ts_index_feature=\"hour\",\n    groupby_feature=\"day\",\n    value_feature=\"target_nitrogen_oxides\",\n    title=\"target_nitrogen_oxides vs hour of the day\",\n    xlabel=\"hour of the day\",\n    ylabel=\"target_nitrogen_oxides\"\n)","57784dc4":"plot_ts_line_groupby(\n    train_df, \n    ts_index_feature=\"hour\",\n    groupby_feature=\"day\",\n    value_feature=\"deg_C\",\n    title=\"deg_C vs hour of the day\",\n    xlabel=\"hour of the day\",\n    ylabel=\"deg_C\"\n)","7622eaad":"plot_ts_line_groupby(\n    train_df, \n    ts_index_feature=\"hour\",\n    groupby_feature=\"day\",\n    value_feature=\"relative_humidity\",\n    title=\"relative_humidity vs hour of the day\",\n    xlabel=\"hour of the day\",\n    ylabel=\"relative_humidity\"\n)","0b20ef7a":"plot_ts_line_groupby(\n    train_df, \n    ts_index_feature=\"hour\",\n    groupby_feature=\"day\",\n    value_feature=\"absolute_humidity\",\n    title=\"absolute_humidity vs hour of the day\",\n    xlabel=\"hour of the day\",\n    ylabel=\"absolute_humidity\"\n)","9a733578":"plot_ts_line_groupby(\n    train_df, \n    ts_index_feature=\"hour\",\n    groupby_feature=\"day\",\n    value_feature=\"sensor_1\",\n    title=\"sensor_1 vs hour of the day\",\n    xlabel=\"hour of the day\",\n    ylabel=\"sensor_1\"\n)","4a821499":"plot_ts_line_groupby(\n    train_df, \n    ts_index_feature=\"hour\",\n    groupby_feature=\"day\",\n    value_feature=\"sensor_2\",\n    title=\"sensor_2 vs hour of the day\",\n    xlabel=\"hour of the day\",\n    ylabel=\"sensor_2\"\n)","84fb9c79":"plot_ts_line_groupby(\n    train_df, \n    ts_index_feature=\"hour\",\n    groupby_feature=\"day\",\n    value_feature=\"sensor_3\",\n    title=\"sensor_3 vs hour of the day\",\n    xlabel=\"hour of the day\",\n    ylabel=\"sensor_3\"\n)","3ad1e218":"plot_ts_line_groupby(\n    train_df, \n    ts_index_feature=\"hour\",\n    groupby_feature=\"day\",\n    value_feature=\"sensor_4\",\n    title=\"sensor_4 vs hour of the day\",\n    xlabel=\"hour of the day\",\n    ylabel=\"sensor_4\"\n)","3d4bc690":"plot_ts_line_groupby(\n    train_df, \n    ts_index_feature=\"hour\",\n    groupby_feature=\"day\",\n    value_feature=\"sensor_5\",\n    title=\"sensor_5 vs hour of the day\",\n    xlabel=\"hour of the day\",\n    ylabel=\"sensor_5\"\n)","85f9db43":"plt_seasonal_decomposition(train_df.set_index(\"date_time\"), feature=\"target_carbon_monoxide\", freq=24, freq_type=\"daily\", figsize=(15, 6), model=\"additive\")","d8fe0d38":"plt_seasonality(train_df.set_index(\"date_time\"), feature=\"target_carbon_monoxide\", freq=24, freq_type=\"daily\", figsize=(20, 6), model=\"additive\")","c6962a51":"plt_seasonality(train_df.set_index(\"date_time\")[0:24*4], feature=\"target_carbon_monoxide\", freq=24, freq_type=\"daily\", figsize=(20, 6), model=\"additive\")","7b8c7ba6":"plt_seasonality(train_df.set_index(\"date_time\"), feature=\"target_carbon_monoxide\", freq=24*7, freq_type=\"weekly\", figsize=(20, 6), model=\"additive\")","4d56ef80":"plt_seasonality(train_df.set_index(\"date_time\")[0:24*7*2], feature=\"target_carbon_monoxide\", freq=24*7, freq_type=\"weekly\", figsize=(20, 6), model=\"additive\")","53dd0062":"plt_seasonality(train_df.set_index(\"date_time\"), feature=\"target_carbon_monoxide\", freq=24*30, freq_type=\"monthly\", figsize=(20, 6), model=\"additive\")","f421d16b":"plt_seasonality(train_df.set_index(\"date_time\")[0:24*30*3], feature=\"target_carbon_monoxide\", freq=24*30, freq_type=\"monthly\", figsize=(20, 6), model=\"additive\")","085b56db":"plt_seasonality(train_df.set_index(\"date_time\"), feature=\"target_carbon_monoxide\", freq=24*90, freq_type=\"quarterly\", figsize=(20, 6), model=\"additive\")","7a2f412f":"plot_multiple_seasonalities(train_df, feature_name=\"target_benzene\")","5a4b1d8f":"plot_multiple_seasonalities(train_df, feature_name=\"target_nitrogen_oxides\")","2b918878":"periods = [\"day_name\", \"day_type\", \"weekofyear\", \"month\", \"quarter\", \"us_season\"]\nfor period in periods:\n    plot_boxh_groupby(df=train_df, feature_name=\"target_carbon_monoxide\", by=period)","40e5f628":"periods = [\"day_name\", \"day_type\", \"weekofyear\", \"month\", \"quarter\", \"us_season\"]\n\nfor period in periods:\n    plot_boxh_groupby(df=train_df, feature_name=\"target_benzene\", by=period)","b4e31580":"periods = [\"day_name\", \"day_type\", \"weekofyear\", \"month\", \"quarter\", \"us_season\"]\n\nfor period in periods:\n    plot_boxh_groupby(df=train_df, feature_name=\"target_nitrogen_oxides\", by=period)","c2a3e7de":"Again, the plot below clearly shows a repeatative patten indicating monthly seasonality. To understand the pattern better, I will pick up only 2 months of data.","061cebff":"### Plot relative_humidity against hour of the day","38332c53":"## Variation of target_benzene","3c49e549":"1. target_carbon_monoxide has a strong dependency on hour of the day. \n2. During the early morning hours, it's value is lesser. \n3. The value starts increasing 6 AM onwards. \n3. There are two sharp, well defined peaks (around 8 AM & 6PM). This is the time when people usually travel to and from office. ","071267a8":"### Plot sensor_3 against hour of the day","fa57acd5":"target_benzene's behavior is similar to target_carbon_monoxide:\n\n1. Strong dependency on hour of the day. \n2. During the early morning hours, it's value is lesser. \n3. The value starts increasing 6 AM onwards. \n3. There are two peaks (around 8 AM & 6 PM). This is the time when people usually travel to and from office.\n","ca06b770":"The plot below clearly shows a repeatative patten indicating daily seasonality. However, the pattern is not clear enough. Let's zoom in. I will pick up only 4 days data to understand how data repeats itself.","6ccc9b75":"The seasonal component clearly shows that there are two peaks: one in the morning and one in the afternoon. This matches with our seasonality plot without statistics.","806cdd36":"### Seasonality for target_nitrogen_oxides","ad95884a":"### Let's check if there is quaterly seasonality in `target_carbon_monoxide` data","b2f5ba4a":"## Variation of target_carbon_monoxide","ebe3f8ee":"However, on a close look, it seems that the seasonality is mostly weekly in nature.","47ced8c9":"To understand seasonality using statistical decomposition, I will pick up one the variable **carbon monxide** (target_carbon_monoxide)\n\nFollowing is the seasonal decomposition plot where `target_carbon_monoxide` is broken down into trend, seasonality and residuals.\n\nHowever, next we will focus mostly on seasonality.","257faa04":"1. Sensor_1 has strong dependency with 2 peaks (one in the morning and one in the evening)\n2. Value dips during the early morning and increases during the day time\n3. The dip in the value during the early morning seems to be higher compared to sensor 1.","bf6808d2":"# Understanding Seasonality without Statistics","9ba134bc":"For target_benzene, daily, weekly and quarterly seasonalities are evident. I am little confused about monthly. But it looks like there are two periodic dips around 11th and 27th of every month.","4a2f6a64":"### Plot target_benzene against hour of the day","9ce2deb3":"For target_nitrogen_oxides, daily, weekly and quarterly seasonalities are evident. For monthly seasonality, it looks like there are two periodic dips (by-weekly?)","87eb1ee4":"- target_carbon_monoxide varies significantly between weekend and weekdays\n- Variation across weekdays are not that prominent for our bare eyes.\n- Variations across subsequent weeks are not that significant. But weeks which are significantly separated show variations.\n- Variataions across quareters and seasons are also prominent.\n\n### We will have similar observation for other two target variables as well.","18e27a99":"### Plot sensor_4 against hour of the day","23a4b4da":"For sensor_5, the plot looks similar to sensor 1 and 2. Strong dependency on hours. Two sharp, well defined peaks.","88964043":"## Seasonality for target_benzene","87c05bb5":"# Understanding Seasonality with Statistical Decomposition","895f75a4":"1. Sensor_3 has strong dependency with 2 **downward** peaks (one in the morning and one in the evening)\n2. Value increases during the late night\/early morning and decreases during the day time","4b155f16":"absolute_humidity doesn't show any dependency with the hour of the day. It seems the values are spread out through out the day.","9b811306":"For sensor_6, the plot looks similar to sensor 1 and 2. Strong dependency on hours. Two sharp, well defined peaks.","48591b21":"### Plot deg_C against hour of the day","ec294953":"### Let's check if there is daily seasonality in `target_carbon_monoxide` data","86b4647d":"1. target_nitrogen_oxides indicates higher values during the day time compared to night\/early morning.\n2. The peaks are not that prominent here (unlike target_benzene and target_carbon_monoxide). \n3. Also the peaks during office hours are little spread out (diffused).","4baa1d85":"# Boxplot to understand variation of data across different time periods","2650c657":"### Plot target_carbon_monoxide against hour of the day","8b0b5a11":"1. Sensor_1 has strong dependency with 2 peaks (one in the morning and one in the evening)\n2. Value dips during the early morning and increases during the day time","e94dfc9d":"### Let's check if there is monthly seasonality in `target_carbon_monoxide` data","76852d89":"## Variation of target_nitrogen_oxides","60fdaeb1":"Here, we don't need to zoom in. This plot itself show the pattern which repeats itself every three months.\n\n### Overall, `target_carbon_monoxide` data shows clear daily, weekly, quarterly seasonality","8bfc0174":"### Plot absolute_humidity against hour of the day","dab6788c":"Clearly the seasonal component is minimum during the weekends and higher on the weekdays (Specially on Momday & Wednesdays)","9d551749":"Again, the plot below clearly shows a repeatative patten indicating weekly seasonality. To understand the pattern better, I will pick up only 2 weeks of data.","a9b55e2f":"### Let's check if there is weekly seasonality in `target_carbon_monoxide` data","4af1d656":"### Plot target_nitrogen_oxides against hour of the day","71d6c799":"relative_humidity has a dependency with hour of the day. The value drops during the day.","488aafe2":"### Plot sensor_5 against hour of the day","e0c6b2b5":"### Plot sensor_2 against hour of the day","98af9654":"### Plot sensor_1 against hour of the day","2aa802e2":"In this notebook, I am trying to understand seasonality in the data\n- without using any statistical techniques\n- with statistical decomposition technique\n\nIn other notebooks, we have seen how statistical decomposition helps in filtering\/displaying different components like trend, seasonality and residuals. Here we are going to focus only on seasonality. \n\n### Concept of seasonality helps us to understand why time based features (hour of the day, day of the week, season\/quarter) are helpful in building models.\n\nAt the end of the notebook, we will understand the variation of data across weekdays vs weekends, various months, quarters and seasons using box plots.","df80a328":"Temperature of the day is of course dependent with hour of the day. No surprise here."}}