{"cell_type":{"021ae655":"code","5554dd72":"code","7281a86d":"code","ef615e19":"code","049d92de":"code","87bd21fd":"code","9f427069":"code","0e90512b":"code","930029aa":"code","14ea4948":"code","678b3f25":"code","17352704":"code","460f1531":"code","18c8fcf5":"code","114ae842":"code","86e7310b":"code","8e9ad795":"code","e1cade6e":"code","38c7cce6":"code","270e4a8a":"code","46ad4187":"code","3cce20cc":"code","c6429ee3":"markdown","681c518a":"markdown","ce9e596d":"markdown","a4ff0ae0":"markdown","95187436":"markdown","9c6971a4":"markdown","3e261b9a":"markdown","ca349aa8":"markdown","b9fd5e4c":"markdown","d87337a1":"markdown","4e0c5fbe":"markdown"},"source":{"021ae655":"from pathlib import Path\n\nfrom IPython.display import display\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\nimport seaborn as sns\nfrom scipy.stats import norm, probplot","5554dd72":"%matplotlib inline","7281a86d":"INPUT_PATH = Path('\/kaggle', 'input', 'ashrae-energy-prediction')\nTRAIN_PATH = INPUT_PATH \/ 'train.csv'","ef615e19":"df_train = pd.read_csv(TRAIN_PATH, parse_dates=['timestamp'])\ndf_train.head()","049d92de":"df_train['timestamp'].min(), df_train['timestamp'].max()","87bd21fd":"df_train.info()","9f427069":"display(df_train.describe().T)\ndisplay(pd.DataFrame([df_train[col].nunique() for col in df_train.columns],\n             index=df_train.columns, columns=['nunique']))","0e90512b":"df_train['timestamp'].min(), df_train['timestamp'].max()","930029aa":"ax = sns.distplot(df_train['building_id'].value_counts(),\n                  kde=False, hist_kws=dict(density=True));\nax.set_title('Histogram of the frequencies of building_id');","14ea4948":"METER_MAPPER = {0: 'electricity', 1: 'chilledwater', 2: 'steam', 3: 'hotwater'}","678b3f25":"_, ax = plt.subplots()\n\ndf_train['meter'].value_counts().plot.bar(ax=ax)\nax.set_xlabel(\"Meter\")\nax.set_ylabel('Count')\nax.set_xticklabels(METER_MAPPER.values());","17352704":"ax = sns.countplot(df_train.groupby('building_id')['meter'].nunique())\nax.set_title(\"Frequencies of count of meter per building_id\");","460f1531":"sns.distplot(df_train['meter_reading']);","18c8fcf5":"df_train['meter_reading'].describe()","114ae842":"_, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 4))\nsns.distplot(np.log1p(df_train['meter_reading']), fit=norm, ax=ax1)\n_ = probplot(np.log1p(df_train['meter_reading']), plot=ax2);","86e7310b":"df_train.loc[df_train['meter_reading'] == 0].shape[0]","8e9ad795":"non_zero_meter_readings = df_train.loc[df_train['meter_reading'] != 0, 'meter_reading']\n\n_, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 4))\nsns.distplot(np.log1p(non_zero_meter_readings), fit=norm, ax=ax1)\n_ = probplot(np.log1p(non_zero_meter_readings), plot=ax2);","e1cade6e":"df_train['log1p_meter_reading'] = np.log1p(df_train['meter_reading'])\ndf_train.head()","38c7cce6":"_, axes = plt.subplots(1, 2, figsize=(14, 4))\n\nsns.barplot(x='meter', y='log1p_meter_reading', data=df_train, ax=axes[0])\nsns.violinplot(x='meter', y='log1p_meter_reading', data=df_train, ax=axes[1])\n\nfor ax in axes:\n    ax.set_xticklabels(METER_MAPPER.values());","270e4a8a":"frequencies_grouper = [\n    ('H', 'hour'),\n    ('D', 'day'),\n    ('D', 'dayofweek'),\n    ('W', 'week'),\n    ('MS', 'month'),\n]","46ad4187":"for _, g in frequencies_grouper:\n    df_train[g] = getattr(df_train['timestamp'].dt, g)\ndf_train.head()","3cce20cc":"fig = plt.figure(figsize=(18, 8), tight_layout=True)\n\ngs = fig.add_gridspec(2, 6)\n\naxes = np.array([\n    fig.add_subplot(gs[0, :3]),\n    fig.add_subplot(gs[0, 3:]),\n    fig.add_subplot(gs[1, :2]),\n    fig.add_subplot(gs[1, 2:4]),\n    fig.add_subplot(gs[1, 4:]),\n])\n\nfor (f, g), ax in zip(frequencies_grouper, axes):\n    grouper = (df_train.groupby(pd.Grouper(freq=f, key='timestamp'))\\\n               .agg(average=('meter_reading', 'mean')))\n    grouper[g] = getattr(grouper.index, g)\n    sns.barplot(x=g, y='average', data=grouper, ax=ax)\n    ax.set_xlabel(g)\n    ax.set_ylabel(f\"Average meter reading\")","c6429ee3":"### To be continued...","681c518a":"Electricity is the most common energy type, by far.","ce9e596d":"Far from lognormal, we have a spike around 0 (e.g log1p(0)), that means we have a lot of reading_meters close or equals to 0.","a4ff0ae0":"### Variations over time","95187436":"Most `building_id` have only one energy source, some have 2 or 3 while very few have 4.  \nIs there some temporality, e.g. buildings have changed their energy source over the years?","9c6971a4":"Looking a bit better but still not close to a normal probplot, cutting the purely zero-valued meter is not enough, there seems to be a huge amount of non-zero small values.","3e261b9a":"This is looking like a power-law, let's see the impact of a log transform.","ca349aa8":"Hard to see small periods trends like this, but we can see that for the year 2016, average meter readings for months 3, 4, 5 and 6 were particularly high.","b9fd5e4c":"The training set covers 1 year of data (test set might covers the 2 other years), from 01\/01\/2016 to 12\/31\/2016.","d87337a1":"Indeed, close to 2 millions of meter readings are zero-valued, that's almost 10%.","4e0c5fbe":"Seems there is a pattern in the number of occurences of `building_ids`. We see 3 modes, around 10000, 18000 and 27000. That means, the building_ids have not been sampled randomly."}}