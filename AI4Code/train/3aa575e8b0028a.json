{"cell_type":{"58f78426":"code","087f72d7":"markdown"},"source":{"58f78426":"import time\n\nfrom selenium import webdriver\nfrom selenium.webdriver.common.keys import Keys\nfrom selenium.webdriver.common.by import By\nimport pandas as pd\nfrom selenium import webdriver\nfrom selenium.webdriver.chrome.options import Options\nfrom selenium.webdriver.common.by import By\nimport requests\nfrom bs4 import BeautifulSoup\nimport os\n\n\noptions = Options()\noptions.add_argument('--headless')\noptions.add_argument('--disable-gpu') \n\noptions.add_experimental_option('prefs', {\n\"download.default_directory\": r\"C:\\Scraping Cenipa\\relatorios\", #Change default directory for downloads\n\"download.prompt_for_download\": False, #To auto download the file\n\"download.directory_upgrade\": True,\n\"plugins.always_open_pdf_externally\": True #It will not show PDF directly in chrome\n})\ndriver = webdriver.Chrome(chrome_options=options,executable_path=r'chromedriver.exe')\n\nfor x in range(1,28):\n\tdriver.get(f\"http:\/\/sistema.cenipa.aer.mil.br\/cenipa\/paginas\/relatorios\/relatorios?&?&pag={x}\")\n\tdriver.execute_script(\"return document.body.outerHTML\")\n\tk=driver.page_source\n\tsoup=BeautifulSoup(k,features=\"html.parser\")\n\tRela=soup.findAll(\"tr\")\n\n\n\tfor x1 in range(1,len(Rela)):\n\t\ttry:\n\t\t\telement=driver.find_element_by_xpath(f'\/\/*[@id=\"lista\"]\/tbody\/tr[{x1}]\/td[8]\/a')\n\t\t\tname = driver.find_element_by_xpath(f'\/\/*[@id=\"lista\"]\/tbody\/tr[{x1}]\/td[1]').text\n\t\t\tname=name.replace(\"\/\",\"_\")\n\t\t\telement.click()\n\n\t\t\ttry:\n\t\t\t\telement = driver.find_element_by_xpath(f'\/\/*[@id=\"lista\"]\/tbody\/tr[{x1}]\/td[8]\/a[2]')\n\t\t\t\telement.click()\n\t\t\t\ttime.sleep(5)\n\t\t\texcept:\n\t\t\t\tprint(\"ok\")\n\n\t\t\ttime.sleep(5)\n\t\t\talligator=0\n\t\t\tfor file in os.listdir(r\"C:\\Scraping Cenipa\\relatorios\"):\n\n\t\t\t\ttry:\n\t\t\t\t\tif file !=\"final\" and alligator<2:\n\n\t\t\t\t\t\tpath = rf\"C:\\Scraping Cenipa\\relatorios\\{file}\"\n\t\t\t\t\t\tnewpath=rf\"C:\\Scraping Cenipa\\relatorios\\final\\{name}.pdf\"\n\n\t\t\t\t\t\tprint(file)\n\t\t\t\t\t\tos.rename(path,newpath)\n\t\t\t\t\tif file !=\"final\" and alligator==2:\n\t\t\t\t\t\tpath=rf\"C:\\Scraping Cenipa\\relatorios\\{file}\"\n\t\t\t\t\t\tnewpath=rf\"\\Scraping Cenipa\\relatorios\\final\\{name}(EN).pdf\"\n\t\t\t\t\t\tos.rename(path,newpath)\n\n\t\t\t\t\talligator=alligator+1\n\t\t\t\texcept:\n\t\t\t\t\tprint(\"Deu Erro\")\n\n\t\texcept:\n\t\t\tprint(\"n\u00e3o tem relatorio\")","087f72d7":"### Scraping Relat\u00f3rio\n\nRapazes este c\u00f3digo eu usei para fazer o download dos relat\u00f3rios finais dos acidentes, e acrescentar o numero do relat\u00f3rio do acidente no nome do relat\u00f3rio. Infelizmente n\u00e3o funcionou para todos mas em sua grande maioria deu certo!!\n\nObserva\u00e7\u00f5es:\n\n-Alguns acidentes tinha relat\u00f3rios em ingl\u00eas, o nome do relat\u00f3rio est\u00e1 como \"nomerelatorio (EN).pdf\";\n\n-No site do Cenipa apresentava mais de 3000 relat\u00f3rios, por\u00e9m alguns numeros de acidentes n\u00e3o tinha relat\u00f3rio dispon\u00edvel para baixar. Por isso h\u00e1 uma diferen\u00e7a na quantidade relat\u00f3rios que eu baixei;\n\n-Alguns Relat\u00f3rios estavam com o final \"nomerelatorio###.pdf\" e isso implicou na hora de eu trocar o nome dos relat\u00f3rios (eu s\u00f3 percebi isso depois que eu tinha upado no Kaggle).\n\n\nQualquer d\u00favida me chama!\n\n(11) 94937-0306 |Whatsapp|\nmarcus.rodrigues4003@gmail.com |email|\n\nAtenciosamente Marcus Vinicius!"}}