{"cell_type":{"14ae5bc4":"code","26ca96e7":"code","6eb4818e":"code","e8e73085":"code","c4818d76":"code","fdf9897f":"code","0690630d":"code","7c5c0150":"code","36ca2ebd":"markdown","928a2288":"markdown","183e80aa":"markdown","faede04d":"markdown","9c5abdee":"markdown","69841665":"markdown"},"source":{"14ae5bc4":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.model_selection import train_test_split\n\ndef PrepareData():\n    df = pd.read_csv('\/kaggle\/input\/default-of-credit-card-clients-dataset\/UCI_Credit_Card.csv')\n    df = df.rename(columns={'default.payment.next.month': 'def_pay', \n                            'PAY_0': 'PAY_1'})\n    \n    features = ['LIMIT_BAL', 'SEX', 'EDUCATION', 'MARRIAGE', 'AGE', 'PAY_1', 'PAY_2',\n           'PAY_3', 'PAY_4', 'PAY_5', 'PAY_6', 'BILL_AMT1', 'BILL_AMT2',\n           'BILL_AMT3', 'BILL_AMT4', 'BILL_AMT5', 'BILL_AMT6', 'PAY_AMT1',\n           'PAY_AMT2', 'PAY_AMT3', 'PAY_AMT4', 'PAY_AMT5', 'PAY_AMT6','def_pay']\n    X = df[features].copy()\n    return X\n\ndf = PrepareData()\ndf.head()","26ca96e7":"def getTwoVarInteraction(df, col1, col2, dep_var, bins = 3, cardinality=10):\n    # generate plot\n    f, (ax1, ax2) = plt.subplots(1,2, figsize = (20,6))\n    \n    # count uniques in col1 and col2\n    col1_uniq = len(df[col1].unique()) \n    col2_uniq = len(df[col2].unique()) \n    \n    # if cardinality of col1 > cardinality that means numeric hence cut into 3 buckets\n    if col1_uniq > cardinality:\n        df[col1+'_cut'] = pd.qcut(df[col1], bins)\n        \n        # if cardinality of col1 > cardinality that means numeric hence cut into 3 buckets\n        if col2_uniq > cardinality:\n            df[col2+'_cut'] = pd.qcut(df[col2], bins)\n            sns.pointplot(x=col1+'_cut', y=dep_var, hue=col2+\"_cut\",data=df, dodge=False, ax=ax1, capsize=0.05)\n            sns.countplot(x=col1+'_cut', data=df, ax=ax2, hue=col2+\"_cut\")\n        # else use col2 as is\n        else:\n            sns.pointplot(x=col1+'_cut', y=dep_var, hue=col2, data=df, dodge=False, ax=ax1, capsize=0.05)\n            sns.countplot(x=col1+'_cut', data=df, ax=ax2, hue=col2)\n    # else use both cols as is\n    else:\n        sns.pointplot(x=col1, y=dep_var, hue=col2, data=df, dodge=False, ax=ax1, capsize=0.05, title='')\n        plt.title(f'Interaction between {col1} and {col2}', hue=col2)\n        sns.countplot(x=col1+'_cut', data=df, ax=ax2)\n    \n    plt.show()","6eb4818e":"getTwoVarInteraction(df, 'LIMIT_BAL', 'SEX', 'def_pay', 3)","e8e73085":"getTwoVarInteraction(df, 'AGE', 'SEX', 'def_pay', 3)","c4818d76":"def getThreeVarInteraction(df, col1, col2, col3, dep_var, bins = 3, cardinality=10):\n    \n    # count uniques in col1 and col2\n    col1_uniq = len(df[col1].unique()) \n    col2_uniq = len(df[col2].unique()) \n    col3_uniq = len(df[col3].unique()) \n    \n    if col1_uniq > cardinality:\n        df[col1+'_cut'] = pd.qcut(df[col1], bins)\n        col1_facet = col1+'_cut'\n    else:\n        col1_facet = col1\n        \n    if col2_uniq > cardinality:\n        df[col2+'_cut'] = pd.qcut(df[col2], bins)\n        col2_facet = col2+'_cut'\n    else:\n        col2_facet = col2\n        \n    if col3_uniq > cardinality:\n        df[col3+'_cut'] = pd.qcut(df[col3], bins)\n        col3_facet = col3+'_cut'\n    else:\n        col3_facet = col3\n        \n    # generate plot\n    sns.catplot(x=col1_facet, y=dep_var, hue=col2_facet, col=col3_facet, data=df, kind=\"point\", dodge=True)\n    plt.show()\n    sns.catplot(x=col1_facet, hue=col2_facet, col=col3_facet, data=df, kind=\"count\", dodge=True)\n    plt.show()","fdf9897f":"getThreeVarInteraction(df, 'LIMIT_BAL',  'SEX', 'BILL_AMT5', 'def_pay', bins = 3, cardinality=10)","0690630d":"getThreeVarInteraction(df, 'LIMIT_BAL',  'SEX', 'EDUCATION', 'def_pay', bins = 3, cardinality=10)","7c5c0150":"df = pd.read_csv('..\/input\/default-of-credit-card-clients-dataset\/UCI_Credit_Card.csv')\ncat_vars = ['SEX', 'EDUCATION', 'MARRIAGE', 'AGE', 'PAY_0', 'PAY_2', 'PAY_3', 'PAY_4', 'PAY_5', 'PAY_6']\nnum_vars = ['BILL_AMT1', 'BILL_AMT2','BILL_AMT3', 'BILL_AMT4', 'BILL_AMT5', 'BILL_AMT6', 'PAY_AMT1','PAY_AMT2', 'PAY_AMT3', 'PAY_AMT4', 'PAY_AMT5', 'PAY_AMT6']\ndep_var = 'default.payment.next.month'\nfor var in cat_vars:\n    means = df[[var,dep_var]].groupby(var).mean()[dep_var]\n    df[var+'_enc'] = df[var].map(means) \ncorr = df[num_vars + [x+'_enc' for x in cat_vars]].corr()\nlinks = corr.stack().reset_index()\nlinks.columns = ['var1', 'var2', 'value']\nlinks_filtered=links.loc[ (links['value'] > 0.2) & (links['var1'] != links['var2']) ]\n \nG=nx.from_pandas_edgelist(links_filtered, 'var1', 'var2', edge_attr=[\"value\"])\nplt.figure(figsize=(15,8))\nnx.draw(G, with_labels=True, node_color='orange', node_size=1000, edge_color='gray', width=links_filtered.value.values*3, font_size=8)\nplt.show()","36ca2ebd":"## Prepare Dataset","928a2288":"We see that there are two groups of variables that are similar to one another. ","183e80aa":"## Correlation Network Graphs\n2D representation of the relationships (correlation) in a dataset. The correlation graph allows us to see groups of correlated variables, identify irrelevant variables, and discover or verify important, complex relationships that machine learning models should incorporate, all in two dimensions.\n\nThe graph shown below is generated on [Default of Credit Card Clients Dataset](https:\/\/www.kaggle.com\/uciml\/default-of-credit-card-clients-dataset). Categorical variables were first replaced with target encoding using means of dependent variable - default.payment.next.month","faede04d":"# Model Interpretability - Identifying & Quantifying variable interactions\n\nExplaining models through deeper study of variables and interactions\n\n* Using seaborn's pointplots and countplots, two-way and three-way plots can be constructed to understand variable interactions. Numerical variables are handled by binning and then plotting\n* Correlation Network Graphs to understand similarity between variables and groups of variables","9c5abdee":"## Plot two-way interactions\nTwo-way interactions defined as how does the change in the first variable (moderator) affects the outcome due to change in second variable","69841665":"## Three Variable Interactions\nThese are two-way interactions plotted as small multiples faceted by the third variable"}}