{"cell_type":{"c7ad196f":"code","90cf794c":"code","ba1d4c89":"code","f8a5ed64":"code","ac2cf4b4":"code","71b82638":"code","b3703589":"code","8697b773":"code","4a1a5e1e":"markdown","6f98270c":"markdown","24cd5123":"markdown","d815425b":"markdown","5fdb53c6":"markdown"},"source":{"c7ad196f":"from sklearn.neighbors import NearestNeighbors\nfrom tqdm import tqdm\nimport pickle\nimport random\nimport matplotlib.pyplot as plt\nimport matplotlib.image as mpimg\n%matplotlib inline","90cf794c":"with open('..\/input\/digixfeatures\/gallery_features.pkl', 'rb') as f:\n    g_dict = pickle.load(f)\nwith open('..\/input\/digixfeatures\/query_features.pkl', 'rb') as f:\n    q_dict = pickle.load(f)","ba1d4c89":"ng, nq = len(g_dict['name']), len(q_dict['name'])\nng, nq","f8a5ed64":"neigh = NearestNeighbors(n_neighbors=10)\nneigh.fit(g_dict['feature'])\nsub_dict = {}\nfor i in tqdm(range(nq)):\n    query = q_dict['feature'][i].reshape(1, -1)\n    _, ten_gallery_indices = neigh.kneighbors(query)\n    sub_dict[q_dict['name'][i]] = [g_dict['name'][j] for j in ten_gallery_indices[0]]\nsub_dict","ac2cf4b4":"#random choose a output\nq_name, retrieve_names = random.choice(list(sub_dict.items()))\ntop1_name = retrieve_names[0]\nq_name, top1_name","71b82638":"q_im_path, top1_im_path = f'..\/input\/digixcv\/test_data_A\/test_data_A\/query\/{q_name}', f'..\/input\/digixcv\/test_data_A\/test_data_A\/gallery\/{top1_name}'\nq_im_path, top1_im_path","b3703589":"q_img, top1_img = mpimg.imread(q_im_path), mpimg.imread(top1_im_path)\nf = plt.figure()\nf.add_subplot(1,2, 1)\nplt.imshow(q_img)\nf.add_subplot(1,2, 2)\nplt.imshow(top1_img)\nplt.show(block=True)","8697b773":"with open('submission.csv', 'w') as f:\n    for q_name, top_ten_results in tqdm(sub_dict.items()):\n        text = q_name + ',' + '{'\n        for name in top_ten_results:\n            name += ','\n            text += name\n        text = text[:-1]\n        text += '}'\n        f.write(text)\n        f.write('\\n')","4a1a5e1e":"# check","6f98270c":"# generate submission.csv","24cd5123":"# read pkl files","d815425b":"# KNN","5fdb53c6":"# import deps"}}