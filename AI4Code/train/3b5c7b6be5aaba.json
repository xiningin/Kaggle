{"cell_type":{"0a76335c":"code","2de1aabb":"code","4cdd5d23":"code","dd936232":"code","799b015c":"code","9bfe48aa":"code","be9b8ee3":"code","3a38dd5f":"code","c0cd41e2":"code","6c014b09":"markdown","d2bf0b3f":"markdown","153d08c7":"markdown","fb14cd6c":"markdown","9512f25b":"markdown","79fa9f4c":"markdown","d4e53b32":"markdown","67c431cc":"markdown","bea1c550":"markdown","b89f5445":"markdown","9f434608":"markdown"},"source":{"0a76335c":"# Downloading the hierarchy json\n# !wget https:\/\/storage.googleapis.com\/openimages\/2018_04\/bbox_labels_600_hierarchy.json # --> old link\n!wget https:\/\/storage.googleapis.com\/openimages\/challenge_2019\/challenge-2019-label500-hierarchy.json\n\n# Downloading class names\n!wget https:\/\/storage.googleapis.com\/openimages\/challenge_2019\/challenge-2019-classes-description-500.csv\n# used to be https:\/\/storage.googleapis.com\/openimages\/v5\/class-descriptions-boxable.csv\n    \n# Downlaoding class-annotations\n!wget https:\/\/storage.googleapis.com\/openimages\/challenge_2019\/challenge-2019-train-detection-bbox.csv\n# used to be https:\/\/storage.googleapis.com\/openimages\/2018_04\/train\/train-annotations-bbox.csv","2de1aabb":"import pandas as pd\ncls=pd.read_csv('challenge-2019-classes-description-500.csv', header=None)\nclasses2name={i:j for i,j in zip(cls[0], cls[1])}\nname2classes={j:i for i,j in zip(cls[0], cls[1])}\ncls.tail()","4cdd5d23":"trn=pd.read_csv('challenge-2019-train-detection-bbox.csv')\ntrn.head()","dd936232":"import json\nhier = json.load(open('challenge-2019-label500-hierarchy.json','r'))\nlevel1=[]\nlevel2=[]\nlevel3=[]\nfor l2 in hier['Subcategory']:\n    print(classes2name[l2['LabelName']])\n    level3.append(classes2name[l2['LabelName']])\n    try:\n        for j in l2['Subcategory']:\n            print('----> ',classes2name[j['LabelName']])\n            level2.append(classes2name[j['LabelName']])\n            try:\n                for k in j['Subcategory']:\n                    print('\\t----> ',classes2name[k['LabelName']])\n                    level1.append(classes2name[k['LabelName']])\n            except:\n                pass\n    except:\n        pass\n        \nlevel1 = set(level1)\nlevel2 = set(level2)\nlevel3 = set(level3)","799b015c":"print('Classes count in level 1 is {}'.format(len(level1)))\nprint('Classes count in level 2 is {}'.format(len(level2)))\nprint('Classes count in level 3 is {}'.format(len(level3)))\nprint('Total unique class counts are {}'.format(len(level1)+len(level2)+len(level3)))","9bfe48aa":"print('level1 and level2 overlaps = {}'.format(len(level2&level1)))\nprint('level2 and level3 overlaps = {}'.format(len(level2&level3)))\nprint('level1 and level3 overlaps = {}'.format(len(level3&level1)))","be9b8ee3":"res=trn['LabelName'].value_counts()\ntrn_classes=[]\nfor idx, (i,j) in enumerate(zip(res.index, res)):\n    trn_classes.append(classes2name[i])\n    print('{} \\t {} \\t {}'.format(idx+1, classes2name[i], j))","3a38dd5f":"all_training_classes = set(list(cls[1]))\nall_json_classes = level1.union(level2).union(level3)\nprint('There are {} classes from JSON file and {} classes from training file'.format(len(all_json_classes), len(all_training_classes)))\nprint('Thus there are {} missing classes'.format(len(all_training_classes)-len(all_json_classes)))","c0cd41e2":"all_training_classes-all_json_classes","6c014b09":"### Classes count\n\nWe can see that we obtain 3 levels of classes hierarchy. ","d2bf0b3f":"This is a fork of [very useful notebook](https:\/\/www.kaggle.com\/thanatoz\/understanding-open-image-v5-classes-hierarchy) that has helped me and others understand label classes and how they relate. The only problem was that public dataset anotations have 600 classes while competition uses annotations with class count reduced to 500. Original kernel has incorrectly used labels and class descriptions from public instead of competition dataset and thus found too many classes missing from the class hierarchy. After fixing data sources, there are still classes missing from the hierarchy, but this time only 19, \n\nIf you feel that I am wrong anywhere, feel free to comment below and help improvise this kernel. ","153d08c7":"### Classes along with counts \n\nThe index of the classes in a list along with the value count in the training dataset.","fb14cd6c":"> These annotation files cover the 500 boxable object classes, and span the 1,743,042 training images where we annotated bounding boxes, object segmentations, and visual relationships, as well as the full validation (41,620 images) and test (125,436 images) sets.","9512f25b":"So there are 483 unique classes that we obtain from the json provided to us. But there could be classes overlap. Lets run a quick check over this.","79fa9f4c":"Lets now print the classes from the Attached JSON given with the dataset. \nHere you can understand the heirarchy level as per the name indentation.","d4e53b32":"### Classes that could be missing\n\nWe have seen that we are provided with 500 classes but we obtained lesser classes from the classes hierarchy JSON. So lets try to print the classes that could be missing.","67c431cc":"So the missing classes could be these.","bea1c550":"### Downloading the required files\n\nI am using the annotation files and the class_names files. So download them from the given link.","b89f5445":"With 2 oveplapping classes, that makes effective number of unique classes in the hierarchy 481.","9f434608":"# Exploring classes and Heirarchy (fixed)\n"}}