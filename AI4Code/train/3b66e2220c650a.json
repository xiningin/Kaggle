{"cell_type":{"b8253210":"code","6e835ec8":"code","c91ee661":"code","2e3e938a":"code","8f936359":"code","944926d3":"markdown"},"source":{"b8253210":"#make a dictionary with file paths of all image ids\n#necessary because dataset is divided into 20 parts!\nimport os\nimport pickle\nimport pandas as pd\n\nimgid_paths={}\nsource_folders=[\"..\/input\/hpa-composite-images-{}-of-20\".format(i+1) for i in range(20)]\nfor folder in source_folders:\n    files = [os.path.splitext(filename)[0] for filename in os.listdir(folder)]\n    imgid_paths.update(dict.fromkeys(files, folder))","6e835ec8":"#add paths to dataframe\nhpa_data_df=pd.read_pickle(\"..\/input\/hpadata\/hpa_data_df.pkl\")\nhpa_data_df[\"path\"] = hpa_data_df.apply(lambda x: imgid_paths[x.ID]+\"\/\"+x.ID+\"_\"+x.cell+\".png\", axis=1)\nhpa_data_df","c91ee661":"#exceeds 9h kaggle runtime. must therefore be done in parts in parallel in different notebooks\n#also results in 20 datasets when done in 20 parts\nimport cv2\nfrom tqdm import tqdm\n\nfor index, row in tqdm(hpa_data_df.iterrows()):  \n    oldfile=row[\"path\"]\n    newfile=\".\/cropped\/\"+row[\"ID\"]+\"_\"+str(row[\"cell\"])+\".png\"\n    image = cv2.imread(oldfile)\n    ymin=int(row[\"ymin\"])\n    ymax=int(row[\"ymax\"])\n    xmin=int(row[\"xmin\"])\n    xmax=int(row[\"xmax\"])\n    crop = image[ymin:ymax, xmin:xmax]\n    cv2.imwrite(newfile, crop)\n    if index==100:  ## just 100 cell images only for visualization\n        break","2e3e938a":"import shutil\nzip_name = 'cropped'\ndirectory_name = 'cropped'\n\nshutil.make_archive(zip_name, 'zip', directory_name)","8f936359":"rm -r cropped","944926d3":"#### this notebook is part of the documentation on my HPA approach  \n    -> main notebook: https:\/\/www.kaggle.com\/philipjamessullivan\/0-hpa-approach-summary\n\n# 3: crop individual cells\n ## INPUT:\n **images:** All of the HPA images as merged RGB images\n     -> saved as 20 parts, one dataset per part in \"hpa-composite-images-{}-of-20\"  \n **data:** dataframe with all bbox coordinates\n     -> saved as dataframe (pickled) \"hpa_data_df.pkl\" in \"hpadata\"\n ## RESULTS:\n**dataset name:** 20 datasets with names \"hpa-cropped-cells-{}20\" (linked to this notebook)  \n**file type:** png files  \n**contents:** all individual cells from HPA dataset as RGB images in original resolutions "}}