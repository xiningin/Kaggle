{"cell_type":{"8fdad85f":"code","a7f18c2e":"code","527cce0c":"code","629de03d":"code","d75cf826":"code","bb1880f6":"code","fc6337e8":"code","32fad131":"code","157dc0ea":"code","fafb0caa":"code","6b5d9ee8":"code","3f674766":"code","ef7c5ddb":"code","42295248":"code","b1cb34ac":"code","64b95fff":"code","e0757900":"code","167309b6":"code","f96a3cea":"code","b6ad3505":"code","7582bf91":"code","c1fd7313":"code","04ccba09":"code","fe47b45d":"markdown","f59177a4":"markdown","2b9fe65d":"markdown","6cbcd7e0":"markdown","c5a48672":"markdown","00f37b94":"markdown","c8dec986":"markdown","a13412e7":"markdown","749797e4":"markdown","2f09535b":"markdown","9e37c977":"markdown","8b9407e4":"markdown","b5b76598":"markdown","3796df8c":"markdown","56a59f7f":"markdown","1bb29a4a":"markdown","1d4bb677":"markdown","b17f05fb":"markdown","5a90ebe4":"markdown","94c464a8":"markdown","2a64ee47":"markdown","5c129349":"markdown","33d04b8d":"markdown","549258f5":"markdown","dcec4086":"markdown","db5516cb":"markdown","bf28f79c":"markdown","e17df593":"markdown","69554206":"markdown","29ea2c1b":"markdown"},"source":{"8fdad85f":"#@title Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n# https:\/\/www.apache.org\/licenses\/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.","a7f18c2e":"from __future__ import absolute_import, division, print_function, unicode_literals\n\nimport os\nimport numpy as np\nimport glob\nimport shutil\nimport matplotlib.pyplot as plt","527cce0c":"#import packages\nimport tensorflow as tf\nimport tensorflow.keras as keras\nfrom keras.layers import Dense, Flatten, Dropout, Conv2D, MaxPool2D\nfrom keras.models import Sequential\n\nfrom keras.preprocessing.image import ImageDataGenerator","629de03d":"_URL = \"https:\/\/storage.googleapis.com\/download.tensorflow.org\/example_images\/flower_photos.tgz\"\n\nzip_file = tf.keras.utils.get_file(origin=_URL,\n                                   fname=\"flower_photos.tgz\",\n                                   extract=True)\n\nbase_dir = os.path.join(os.path.dirname(zip_file), 'flower_photos')","d75cf826":"classes = ['roses', 'daisy', 'dandelion', 'sunflowers', 'tulips']","bb1880f6":"for cl in classes:\n  img_path = os.path.join(base_dir, cl)\n  images = glob.glob(img_path + '\/*.jpg')\n  print(\"{}: {} Images\".format(cl, len(images)))\n  train, val = images[:round(len(images)*0.8)], images[round(len(images)*0.8):]\n\n  for t in train:\n    if not os.path.exists(os.path.join(base_dir, 'train', cl)):\n      os.makedirs(os.path.join(base_dir, 'train', cl))\n    shutil.move(t, os.path.join(base_dir, 'train', cl))\n\n  for v in val:\n    if not os.path.exists(os.path.join(base_dir, 'val', cl)):\n      os.makedirs(os.path.join(base_dir, 'val', cl))\n    shutil.move(v, os.path.join(base_dir, 'val', cl))","fc6337e8":"train_dir = os.path.join(base_dir, 'train')\nval_dir = os.path.join(base_dir, 'val')","32fad131":"batch_size = 100\nIMG_SHAPE = 150","157dc0ea":"image_gen = ImageDataGenerator(\n        rescale=1.\/255,\n        horizontal_flip=True)\n\ntrain_data_gen = image_gen.flow_from_directory(\n    train_dir, \n    target_size=(IMG_SHAPE,IMG_SHAPE),\n    batch_size=batch_size,\n    shuffle=True\n)","fafb0caa":"# This function will plot images in the form of a grid with 1 row and 5 columns where images are placed in each column.\ndef plotImages(images_arr):\n    fig, axes = plt.subplots(1, 5, figsize=(20,20))\n    axes = axes.flatten()\n    for img, ax in zip( images_arr, axes):\n        ax.imshow(img)\n    plt.tight_layout()\n    plt.show()\n\n\naugmented_images = [train_data_gen[0][0][0] for i in range(5)]\nplotImages(augmented_images)","6b5d9ee8":"image_gen = ImageDataGenerator(\n                rescale=1.\/255,\n                rotation_range=45\n)\n\ntrain_data_gen = image_gen.flow_from_directory(\n                train_dir,\n                target_size=(IMG_SHAPE, IMG_SHAPE),\n                batch_size=batch_size,\n                shuffle=True\n)","3f674766":"augmented_images = [train_data_gen[0][0][0] for i in range(5)]\nplotImages(augmented_images)","ef7c5ddb":"image_gen = ImageDataGenerator(\n    rescale=1.\/255,\n    zoom_range=0.5\n)\n\ntrain_data_gen = image_gen.flow_from_directory(train_dir, target_size=(IMG_SHAPE, IMG_SHAPE),\n                                               batch_size=batch_size, shuffle=True)","42295248":"augmented_images = [train_data_gen[0][0][0] for i in range(5)]\nplotImages(augmented_images)","b1cb34ac":"image_gen_train = ImageDataGenerator(\n            rescale=1.\/255,\n            rotation_range=45,\n            horizontal_flip=True,\n            width_shift_range=0.15,\n            height_shift_range=0.15,\n            zoom_range=0.5\n)\n\n\ntrain_data_gen = image_gen_train.flow_from_directory(\n                train_dir, batch_size=batch_size,\n                target_size=(IMG_SHAPE,IMG_SHAPE), shuffle=True,\n                class_mode='sparse'\n)","64b95fff":"augmented_images = [train_data_gen[0][0][0] for i in range(5)]\nplotImages(augmented_images)","e0757900":"image_gen_val = ImageDataGenerator(rescale=1.\/255)\nval_data_gen = image_gen_val.flow_from_directory(val_dir, target_size=(IMG_SHAPE,IMG_SHAPE),\n                                                 batch_size=batch_size,class_mode='sparse')","167309b6":"model = Sequential([\n    Conv2D(16, (3,3), padding='same', activation='relu', input_shape=(IMG_SHAPE, IMG_SHAPE, 3)),\n    MaxPool2D(2,2),\n    Dropout(0.2),\n    \n    Conv2D(32, (3,3), padding='same',activation='relu'),\n    MaxPool2D(2,2),\n    Dropout(0.2),\n\n    Conv2D(64, (3,3), padding='same',activation='relu'),\n    MaxPool2D(2,2),\n    Dropout(0.2),\n\n    Flatten(),\n    Dropout(0.2),\n    Dense(512, activation='relu'),\n    Dropout(0.2),\n    Dense(5, activation='softmax')\n])\n\n# model.summary()","f96a3cea":"# Compile the model\nmodel.compile(optimizer='adam', loss='sparse_categorical_crossentropy', metrics=['accuracy'])","b6ad3505":"model.summary()","7582bf91":"epochs = 80\n\nhistory = model.fit_generator(train_data_gen, \n                              steps_per_epoch=int(np.ceil(train_data_gen.n \/ float(batch_size))),\n                              epochs=epochs, \n                              validation_data=val_data_gen,\n                              validation_steps=int(np.ceil(val_data_gen.n \/ float(batch_size)))\n                              )","c1fd7313":"history.history.keys()","04ccba09":"acc = history.history['accuracy']\n\nval_acc = history.history['val_accuracy']\n\nloss = history.history['loss']\nval_loss = history.history['val_loss']\n\nepochs_range = range(epochs)\n\nplt.figure(figsize=(16,10))\nplt.subplot(1, 2, 1)\nplt.plot(epochs_range, acc, label='Training Accuracy')\nplt.plot(epochs_range, val_acc, label='Validation Accuracy')\nplt.legend(loc='lower right')\nplt.title('Training and Validation Accuracy')\n\nplt.subplot(1, 2 ,2)\nplt.plot(epochs_range, loss, label='Training Loss')\nplt.plot(epochs_range, val_loss, label='Validation Loss')\nplt.legend(loc='lower right')\nplt.title('Training and Validation Loss')\n\nplt.show()","fe47b45d":"### TODO: Apply Random Zoom\n\nIn the cell below, use ImageDataGenerator to create a transformation that rescales the images by 255 and then applies a random zoom of up to 50%. Then use the `.flow_from_directory` method to apply the above transformation to the images in our training set. Make sure you indicate the batch size, the path to the directory of the training images, the target size for the images, and to shuffle the images. ","f59177a4":"In this Colab you will classify images of flowers. You will build an image classifier using `tf.keras.Sequential` model and load data using `tf.keras.preprocessing.image.ImageDataGenerator`.\n\n","2b9fe65d":"Let's start by importing required packages. **os** package is used to read files and directory structure, **numpy** is used to convert python list to numpy array and to perform required matrix operations and **matplotlib.pyplot** is used to plot the graph and display images in our training and validation data.","6cbcd7e0":"In order to build our image classifier, we can begin by downloading the flowers dataset. We first need to download the archive version of the dataset and after the download we are storing it to \"\/tmp\/\" directory.","c5a48672":"### TODO: Put It All Together\n\nIn the cell below, use ImageDataGenerator to create a transformation that rescales the images by 255 and that applies:\n\n- random 45 degree rotation\n- random zoom of up to 50%\n- random horizontal flip\n- width shift of 0.15\n- height shift of 0.15\n\nThen use the `.flow_from_directory` method to apply the above transformation to the images in our training set. Make sure you indicate the batch size, the path to the directory of the training images, the target size for the images, to shuffle the images, and to set the class mode to `sparse`.","00f37b94":"##### Copyright 2018 The TensorFlow Authors.","c8dec986":"# TODO: Compile the Model\n\nIn the cell below, compile your model using the ADAM optimizer, the sparse cross entropy function as a loss function. We would also like to look at training and validation accuracy on each epoch as we train our network, so make sure you also pass the metrics argument.","a13412e7":"Let's take 1 sample image from our training examples and repeat it 5 times so that the augmentation can be applied to the same image 5 times over randomly, to see the augmentation in action.","749797e4":"### TODO: Create a Data Generator for the Validation Set\n\nGenerally, we only apply data augmentation to our training examples. So, in the cell below, use ImageDataGenerator to create a transformation that only rescales the images by 255. Then use the `.flow_from_directory` method to apply the above transformation to the images in our validation set. Make sure you indicate the batch size, the path to the directory of the validation images, the target size for the images, and to set the class mode to `sparse`. Remember that it is not necessary to shuffle the images in the validation set. ","2f09535b":"The dataset we downloaded contains images of 5 types of flowers:\n\n1. Rose\n2. Daisy\n3. Dandelion\n4. Sunflowers\n5. Tulips\n\nSo, let's create the labels for these 5 classes: ","9e37c977":"# TODO: Train the Model\n\nIn the cell below, train your model using the **fit_generator** function instead of the usual **fit** function. We have to use the `fit_generator` function because we are using the **ImageDataGenerator** class to generate batches of training and validation data for our model. Train the model for 80 epochs and make sure you use the proper parameters in the `fit_generator` function.","8b9407e4":"# Data Loading","b5b76598":"Let's take 1 sample image from our training examples and repeat it 5 times so that the augmentation can be applied to the same image 5 times over randomly, to see the augmentation in action.","3796df8c":"### TODO: Import TensorFlow and Keras Layers\n\nIn the cell below, import Tensorflow as `tf` and the Keras layers and models you will use to build your CNN. Also, import the `ImageDataGenerator` from Keras so that you can perform image augmentation.","56a59f7f":"<table class=\"tfo-notebook-buttons\" align=\"left\">\n  <td>\n    <a target=\"_blank\" href=\"https:\/\/colab.research.google.com\/github\/tensorflow\/examples\/blob\/master\/courses\/udacity_intro_to_tensorflow_for_deep_learning\/l05c03_exercise_flowers_with_data_augmentation.ipynb\"><img src=\"https:\/\/www.tensorflow.org\/images\/colab_logo_32px.png\" \/>Run in Google Colab<\/a>\n  <\/td>\n  <td>\n    <a target=\"_blank\" href=\"https:\/\/github.com\/tensorflow\/examples\/blob\/master\/courses\/udacity_intro_to_tensorflow_for_deep_learning\/l05c03_exercise_flowers_with_data_augmentation.ipynb\"><img src=\"https:\/\/www.tensorflow.org\/images\/GitHub-Mark-32px.png\" \/>View source on GitHub<\/a>\n  <\/td>\n<\/table>","1bb29a4a":"# Data Augmentation","1d4bb677":"### TOO: Apply Random Rotation\n\nIn the cell below, use ImageDataGenerator to create a transformation that rescales the images by 255 and then applies a random 45 degree rotation. Then use the `.flow_from_directory` method to apply the above transformation to the images in our training set. Make sure you indicate the batch size, the path to the directory of the training images, the target size for the images, and to shuffle the images. ","b17f05fb":"# Image Classification using tf.keras","5a90ebe4":"# TODO: Create the CNN\n\nIn the cell below, create a convolutional neural network that consists of 3 convolution blocks. Each convolutional block contains a `Conv2D` layer followed by a max pool layer. The first convolutional block should have 16 filters, the second one should have 32 filters, and the third one should have 64 filters. All convolutional filters should be 3 x 3. All max pool layers should have a `pool_size` of `(2, 2)`.\n\nAfter the 3 convolutional blocks you should have a flatten layer followed by a fully connected layer with 512 units. The CNN should output class probabilities based on 5 classes which is done by the **softmax** activation function. All other layers should use a **relu** activation function. You should also add Dropout layers with a probability of 20%, where appropriate. ","94c464a8":"## Experiment with Various Image Transformations\n\nIn this section you will get some practice doing some basic image transformations. Before we begin making transformations let's define our `batch_size` and our image size. Remember that the input to our CNN are images of the same size. We therefore have to resize the images in our dataset to the same size.\n\n### TODO: Set Batch and Image Size\n\nIn the cell below, create a `batch_size` of 100 images and set a value to `IMG_SHAPE` such that our training data consists of images with width of 150 pixels and height of 150 pixels.","2a64ee47":"# TODO: Experiment with Different Parameters\n\nSo far you've created a CNN with 3 convolutional layers and followed by a fully connected layer with 512 units. In the cells below create a new CNN with a different architecture. Feel free to experiment by changing as many parameters as you like. For example, you can add more convolutional layers, or more fully connected layers. You can also experiment with different filter sizes in your convolutional layers, different number of units in your fully connected layers, different dropout rates, etc... You can also experiment by performing image augmentation with more image transformations that we have seen so far. Take a look at the [ImageDataGenerator Documentation](https:\/\/keras.io\/preprocessing\/image\/) to see a full list of all the available image transformations. For example, you can add shear transformations, or you can vary the brightness of the images, etc... Experiment as much as you can and compare the accuracy of your various models. Which parameters give you the best result?","5c129349":"### TODO: Apply Random Horizontal Flip\n\nIn the cell below, use ImageDataGenerator to create a transformation that rescales the images by 255 and then applies a random horizontal flip. Then use the `.flow_from_directory` method to apply the above transformation to the images in our training set. Make sure you indicate the batch size, the path to the directory of the training images, the target size for the images, and to shuffle the images. ","33d04b8d":"After downloading the dataset, we need to extract its contents.","549258f5":"Also, the dataset we have downloaded has following directory structure.\n\n<pre style=\"font-size: 10.0pt; font-family: Arial; line-height: 2; letter-spacing: 1.0pt;\" >\n<b>flower_photos<\/b>\n|__ <b>diasy<\/b>\n|__ <b>dandelion<\/b>\n|__ <b>roses<\/b>\n|__ <b>sunflowers<\/b>\n|__ <b>tulips<\/b>\n<\/pre>\n\nAs you can see there are no folders containing training and validation data. Therefore, we will have to create our own training and validation set. Let's write some code that will do this.\n\n\nThe code below creates a `train` and a `val` folder each containing 5 folders (one for each type of flower). It then moves the images from the original folders to these new folders such that 80% of the images go to the training set and 20% of the images go into the validation set. In the end our directory will have the following structure:\n\n\n<pre style=\"font-size: 10.0pt; font-family: Arial; line-height: 2; letter-spacing: 1.0pt;\" >\n<b>flower_photos<\/b>\n|__ <b>diasy<\/b>\n|__ <b>dandelion<\/b>\n|__ <b>roses<\/b>\n|__ <b>sunflowers<\/b>\n|__ <b>tulips<\/b>\n|__ <b>train<\/b>\n    |______ <b>daisy<\/b>: [1.jpg, 2.jpg, 3.jpg ....]\n    |______ <b>dandelion<\/b>: [1.jpg, 2.jpg, 3.jpg ....]\n    |______ <b>roses<\/b>: [1.jpg, 2.jpg, 3.jpg ....]\n    |______ <b>sunflowers<\/b>: [1.jpg, 2.jpg, 3.jpg ....]\n    |______ <b>tulips<\/b>: [1.jpg, 2.jpg, 3.jpg ....]\n |__ <b>val<\/b>\n    |______ <b>daisy<\/b>: [507.jpg, 508.jpg, 509.jpg ....]\n    |______ <b>dandelion<\/b>: [719.jpg, 720.jpg, 721.jpg ....]\n    |______ <b>roses<\/b>: [514.jpg, 515.jpg, 516.jpg ....]\n    |______ <b>sunflowers<\/b>: [560.jpg, 561.jpg, 562.jpg .....]\n    |______ <b>tulips<\/b>: [640.jpg, 641.jpg, 642.jpg ....]\n<\/pre>\n\nSince we don't delete the original folders, they will still be in our `flower_photos` directory, but they will be empty. The code below also prints the total number of flower images we have for each type of flower. ","dcec4086":"# Importing Packages","db5516cb":"For convenience, let us set up the path for the training and validation sets","bf28f79c":"Overfitting generally occurs when we have small number of training examples. One way to fix this problem is to augment our dataset so that it has sufficient number of training examples. Data augmentation takes the approach of generating more training data from existing training samples, by augmenting the samples via a number of random transformations that yield believable-looking images. The goal is that at training time, your model will never see the exact same picture twice. This helps expose the model to more aspects of the data and generalize better.\n\nIn **tf.keras** we can implement this using the same **ImageDataGenerator** class we used before. We can simply pass different transformations we would want to our dataset as a form of arguments and it will take care of applying it to the dataset during our training process. ","e17df593":"Let's visualize how a single image would look like 5 different times, when we pass these augmentations randomly to our dataset. ","69554206":"Let's take 1 sample image from our training examples and repeat it 5 times so that the augmentation can be applied to the same image 5 times over randomly, to see the augmentation in action.","29ea2c1b":"# TODO: Plot Training and Validation Graphs.\n\nIn the cell below, plot the training and validation accuracy\/loss graphs."}}