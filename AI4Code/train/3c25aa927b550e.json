{"cell_type":{"416c60cf":"code","77bcdaee":"code","9f2bc747":"code","a7281fae":"code","ff8890a6":"code","9847f6d0":"code","61f6ffb5":"code","37d00b91":"code","e965e331":"code","7f2a91e7":"code","de774907":"code","ba0c24d6":"code","a4d08873":"code","ddbccf57":"code","6e5da06c":"code","9f1bce82":"code","4d8fdc4f":"code","f141fee2":"code","9557a31f":"code","b073ce24":"code","42b3c585":"code","e311327c":"code","69e41b9d":"code","c46212d1":"code","760404a1":"code","1a8c5aac":"code","d9b829a4":"code","00b86156":"code","89c2eaf4":"code","db5a7070":"code","8855ed6d":"code","928cf598":"markdown","69e1b691":"markdown","074edd33":"markdown","3718379d":"markdown","f43df990":"markdown","5cbb15c7":"markdown","c4648675":"markdown","f2c38095":"markdown"},"source":{"416c60cf":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor file_or_dir in os.listdir('\/kaggle\/input\/new-plant-diseases-dataset'):\n    print(file_or_dir)\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","77bcdaee":"# Imports\n\nimport os\nimport glob\nimport numpy as np\nimport pandas as pd\n\nfrom pprint import pprint\n\nimport tensorflow as tf\n\nfrom tensorflow.keras.applications.inception_v3 import InceptionV3\nfrom tensorflow.keras import Model, layers, Sequential, optimizers\nfrom tensorflow.keras.preprocessing.image import ImageDataGenerator\nfrom keras.callbacks import ModelCheckpoint\n\nimport matplotlib.pyplot as plt","9f2bc747":"# download weights\n!wget --no-check-certificate \\\n    https:\/\/storage.googleapis.com\/mledu-datasets\/inception_v3_weights_tf_dim_ordering_tf_kernels_notop.h5 \\\n    -O inception_v3_weights.h5","a7281fae":"print(\"GPUs Available: \", tf.config.experimental.list_physical_devices('GPU'))","ff8890a6":"# Paths\n\nlocal_weights_file = '.\/inception_v3_weights.h5'\n\ntrain_path = \"..\/input\/new-plant-diseases-dataset\/New Plant Diseases Dataset(Augmented)\/New Plant Diseases Dataset(Augmented)\/train\"\nvalid_path = \"..\/input\/new-plant-diseases-dataset\/New Plant Diseases Dataset(Augmented)\/New Plant Diseases Dataset(Augmented)\/valid\"\ntest_path = \"..\/input\/new-plant-diseases-dataset\/test\"","9847f6d0":"training_images = []\n\nfor root, dirs, files in os.walk(train_path):\n    for file in files:\n        training_images.append(os.path.join(root, file))\n                               \nvalidation_images = []\n\nfor root, dirs, files in os.walk(valid_path):\n    for file in files:\n        validation_images.append(os.path.join(root, file))","61f6ffb5":"print(\"Training:\")\nprint(\"Training Path:\" + train_path)\nprint(\"Training Classes:\" + str(len(os.listdir(train_path))))\nprint(\"Training Images:\" + str(len(training_images)))\n\nprint(\"\\n\")\n\nprint(\"Validation:\")\nprint(\"Validation Path:\" + valid_path)\nprint(\"Validation Classes:\" + str(len(os.listdir(valid_path))))\nprint(\"Validation Images:\" + str(len(validation_images)))\n\nprint(\"\\n\")\n\nprint(\"Testing:\")\nprint(\"Testing Path:\" + test_path)\nprint(\"Testing Images:\" + str(len(os.listdir(os.path.join(test_path, 'test')))))","37d00b91":"train_datagen = ImageDataGenerator(\n    rescale=1\/255,\n    width_shift_range=0.2,\n    height_shift_range=0.2,\n    zoom_range=0.2,\n    shear_range=0.2,\n    fill_mode='nearest'\n)\n\nvalidation_datagen = ImageDataGenerator(rescale=1\/255)\n\ntest_datagen = ImageDataGenerator(rescale=1\/255)","e965e331":"batch_size = 32","7f2a91e7":"train_generator = train_datagen.flow_from_directory(\n    train_path,\n    batch_size = batch_size,\n    class_mode = 'categorical',\n    target_size = (150, 150),\n    color_mode=\"rgb\",\n    shuffle=True\n)\n\nvalidation_generator =  validation_datagen.flow_from_directory(\n    valid_path,\n    batch_size  = batch_size,\n    class_mode  = 'categorical',\n    target_size = (150, 150),\n    color_mode=\"rgb\",\n    shuffle=True\n)\n\ntest_generator = test_datagen.flow_from_directory(\n    test_path,\n    batch_size  = 1,\n    class_mode  = None,\n    target_size = (150, 150),\n    color_mode=\"rgb\",\n    shuffle=False\n)\n","de774907":"class_dict = train_generator.class_indices\npprint(class_dict)","ba0c24d6":"class_list = list(class_dict.keys())\npprint(class_list)","a4d08873":"train_num = train_generator.samples\nvalid_num = validation_generator.samples","ddbccf57":"# Creating Instence of pre-trained model from Keras Application\ninception_model = InceptionV3(input_shape= (150, 150, 3),\n                                include_top = False,\n                                weights = None)\n\ninception_model.load_weights(local_weights_file)","6e5da06c":"# Freezing all Layers of Inception V3 Model\nfor layer in inception_model.layers:\n    layer.trainable = False","9f1bce82":"inception_model.summary()","4d8fdc4f":"# Taking output from 'mixed8' layer\nlast_layer = inception_model.get_layer('mixed9')\nprint('Last Layer Output Shape:', last_layer.output_shape)\nlast_output = last_layer.output","f141fee2":"# Adding our own layers at the end of Inception Network\n\n# Flatten the output layer to 1 dimension\nx = layers.Flatten()(last_output)\n\n# Add a fully connected layer with 1024 hidden units and ReLU activation\nx = layers.Dense(2048, activation='relu')(x)\n\n# Add a fully connected layer with 1024 hidden units and ReLU activation\nx = layers.Dense(1024, activation='relu')(x)\n\n# Add a dropout rate of 0.2\nx = layers.Dropout(0.2)(x)\n\n# Add a final sigmoid layer for classification\nx = layers.Dense(len(class_dict), activation='softmax')(x)\n\nmodel = Model(inception_model.input, x)","9557a31f":"model.compile(optimizer=optimizers.RMSprop(lr=0.0001),\n              loss = 'categorical_crossentropy',\n              metrics = ['accuracy'])","b073ce24":"# # checkpoint\n# weightpath = \"best_weights.hdf5\"\n# checkpoint = ModelCheckpoint(weightpath, monitor='val_acc', verbose=1, save_best_only=True, save_weights_only=True, mode='max')\n# callbacks_list = [checkpoint]","42b3c585":"history = model.fit(\n    train_generator,\n    steps_per_epoch=train_num\/\/batch_size,\n    validation_data = validation_generator,\n    validation_steps=valid_num\/\/batch_size,\n    epochs = 30,\n#     callbacks=callbacks_list,\n    verbose = 1\n)","e311327c":"model.evaluate_generator(\n    generator=validation_generator,\n    steps=valid_num\/\/batch_size\n)","69e41b9d":"saved_model_path = \"saved_models\/1\"\nmodel.save(saved_model_path)","c46212d1":"from zipfile import ZipFile \nimport os \n\ndef get_all_file_paths(directory): \n  \n    # initializing empty file paths list \n    file_paths = [] \n  \n    # crawling through directory and subdirectories \n    for root, directories, files in os.walk(directory): \n        for filename in files: \n            # join the two strings in order to form the full filepath. \n            filepath = os.path.join(root, filename) \n            file_paths.append(filepath) \n  \n    # returning all file paths \n    return file_paths         ","760404a1":"# path to folder which needs to be zipped \ndirectory = 'saved_models\/'\n\n# calling function to get all file paths in the directory \nfile_paths = get_all_file_paths(directory) \n\n# printing the list of all files to be zipped \nprint('Following files will be zipped:') \nfor file_name in file_paths: \n    print(file_name) \n\n# writing files to a zipfile \nwith ZipFile('saved_models.zip','w') as zip: \n    # writing each file one by one \n    for file in file_paths: \n        zip.write(file) \n\nprint('All files zipped successfully!')       ","1a8c5aac":"# model_path = \"InceptionV3.hdf5\"\n# model.save(model_path)","d9b829a4":"test_generator.reset()\npred=model.predict_generator(\n    test_generator,\n    steps=test_generator.n\/\/test_generator.batch_size,\n    verbose=1\n)","00b86156":"predicted_class_indices=np.argmax(pred,axis=1)\npredicted_class_indices","89c2eaf4":"class_dict = {v:k for k,v in class_dict.items()}\npredictions = [class_dict[k] for k in predicted_class_indices]","db5a7070":"my_submission = pd.DataFrame({'ImageId': range(1, len(predictions)+1), 'Label': predictions})\nmy_submission.head()","8855ed6d":"# you could use any filename. We choose submission here\nmy_submission.to_csv('submission.csv', index=False)","928cf598":"# Model Creation","69e1b691":"## Fitting Model","074edd33":"## Initializing Model","3718379d":"## Evaluating Model","f43df990":"## Saving Model","5cbb15c7":"## Prediction on Unseen Data","c4648675":"# Preparing Data","f2c38095":"# Imports & Loading Data"}}