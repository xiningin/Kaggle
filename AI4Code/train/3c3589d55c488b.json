{"cell_type":{"11c57610":"code","88287338":"code","7a225023":"code","3037d267":"code","c312c928":"code","e4758393":"code","3eac8161":"code","14655f0c":"code","06efd3ae":"code","e7e245dd":"code","c932ef7a":"code","9adf962b":"code","5d6c38f5":"code","95242ccb":"code","de7eb095":"code","81b8fba2":"code","7a4c67ba":"code","63a1fde4":"code","8b81cc32":"code","fcfe6d09":"code","07bb9fbb":"code","9f615968":"code","af5c1e3b":"code","68bd7d6f":"code","55fb9e29":"code","b1ad3a5b":"code","442d7a85":"code","3b840f3d":"code","3f39df16":"code","714e7620":"code","877b35cf":"code","92b5c046":"code","ddb87f9d":"code","e3a45f36":"code","39957349":"code","543febab":"code","d13e282e":"code","9c09392f":"code","3a04c1c4":"code","70f75fe8":"code","1d7befbf":"code","be6660b0":"code","7f20bd2c":"code","a9138e6c":"code","a3a32eac":"code","9459a745":"code","49f4b28b":"code","f442d0f6":"code","ae0411af":"code","769dbc69":"markdown","321c6c7d":"markdown","6938a140":"markdown","c6897aff":"markdown","a7a41047":"markdown","29e2bc8c":"markdown","beb86c08":"markdown","12a6bd69":"markdown","63a4d8a5":"markdown","4e6ed8a1":"markdown","ff7da0ee":"markdown","ed256786":"markdown","d602c37d":"markdown","340a71fa":"markdown","ff081ef9":"markdown","8cf61a45":"markdown","b145f976":"markdown","57119bd8":"markdown","e3756add":"markdown","ce3a2a60":"markdown","9f58522f":"markdown","2033f8bf":"markdown","40db2d83":"markdown","0c9b317a":"markdown","7d3018b8":"markdown","f8cb9e00":"markdown","753dd24b":"markdown","b6b12bbf":"markdown","5349983d":"markdown","54ab9e05":"markdown","b4053c57":"markdown","10104b21":"markdown","f3d00654":"markdown","fb83843d":"markdown","c8904518":"markdown","b3a565c3":"markdown","ee974b2c":"markdown","44dbe4b9":"markdown","9a016952":"markdown","148554fa":"markdown","865dea75":"markdown","c156a1fa":"markdown","6274a16e":"markdown","bd928434":"markdown","e2ec7570":"markdown","2cc50ef3":"markdown","c539c474":"markdown","850d5244":"markdown","7e71f9e4":"markdown","b87273f6":"markdown","8ee8bbc1":"markdown","e26f049f":"markdown","7cf8d772":"markdown","aa5dbf38":"markdown","db6cb22a":"markdown","127db02a":"markdown","0c7a2ced":"markdown"},"source":{"11c57610":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\nimport warnings\nwarnings.filterwarnings('ignore')\n\n%matplotlib inline","88287338":"df = pd.read_csv(\"..\/input\/hotel-booking-demand\/hotel_bookings.csv\")","7a225023":"df.head()","3037d267":"df.columns","c312c928":"df.describe()","e4758393":"df.info()","3eac8161":"def missing_percent(df):\n    nan_percent= 100*(df.isnull().sum()\/len(df))\n    nan_percent= nan_percent[nan_percent>0].sort_values()\n    return nan_percent","14655f0c":"missing_percent(df)","06efd3ae":"df = df.drop(\"company\",axis = 1)","e7e245dd":"df[\"agent\"].value_counts()","c932ef7a":"df[\"agent\"] = df[\"agent\"].fillna(method='ffill')","9adf962b":"df = df.dropna()","5d6c38f5":"# df[]","95242ccb":"# phone_code = df[\"phone-number\"].apply(lambda p : p.split(\"-\")[0])\n# phone_code.value_counts()","de7eb095":"# df[\"phone_code\"] = phone_code.astype(\"str\")\ndf[\"agent\"] = df[\"agent\"].astype(\"str\")","81b8fba2":"# df = df.drop([\"email\",\"name\"], axis = 1)","7a4c67ba":"sns.countplot(df[\"is_canceled\"])","63a1fde4":"sns.countplot(df[\"reservation_status\"], hue=df[\"is_canceled\"])","8b81cc32":"sns.histplot(df[\"lead_time\"])\nplt.xlim(0,500)","fcfe6d09":"sns.countplot(df[\"hotel\"], hue=df[\"is_canceled\"])","07bb9fbb":"fig, ax =plt.subplots(2,1)\nsns.barplot(x = df[\"arrival_date_year\"], y = df[\"is_canceled\"], ax = ax[0])\nsns.barplot(x = df[\"arrival_date_month\"], y = df[\"is_canceled\"], ax = ax[1])\nplt.xticks(rotation=90)\nplt.show()","9f615968":"sns.barplot(x = df[\"customer_type\"], y = df[\"is_canceled\"])","af5c1e3b":"sns.barplot(x = df[\"is_canceled\"], y = df[\"previous_cancellations\"], hue = df[\"is_repeated_guest\"])","68bd7d6f":"sns.barplot(x = df[\"is_canceled\"], y = df[\"days_in_waiting_list\"])","55fb9e29":"sns.barplot(y = df[\"is_canceled\"], x = df[\"deposit_type\"])","b1ad3a5b":"month = pd.to_datetime(df[\"reservation_status_date\"]).dt.month\nyear = pd.to_datetime(df[\"reservation_status_date\"]).dt.year\n","442d7a85":"fig, ax =plt.subplots(2,1)\nsns.countplot(month, ax = ax[0])\nsns.countplot(year, ax = ax[1])","3b840f3d":"a = df.corr()\nplt.figure(figsize=(12,12))\nk = 15\ncols = a.nlargest(k, 'is_canceled')['is_canceled'].index\ncm = np.corrcoef(df[cols].values.T)\nsns.set(font_scale=1.25)\nhm = sns.heatmap(cm, annot=True, square=True, fmt='.2f', annot_kws={'size': 12}, yticklabels=cols.values, xticklabels=cols.values)\nplt.show()","3f39df16":"cor = (df.corr()**2)**0.5\ncor_mat = cor[\"is_canceled\"].sort_values(ascending=True)\ncor_mat*100","714e7620":"df.drop(['days_in_waiting_list', 'arrival_date_year', 'arrival_date_year', 'assigned_room_type', 'booking_changes',\n               'reservation_status', 'country', 'days_in_waiting_list'], axis = 1, inplace=True)","877b35cf":"df.columns","92b5c046":"data = df.columns\ncatg = []\nfor i in data:\n    if df[i].dtype == 'O':\n        catg.append(i)\ncatg = df[catg]\ncatg","ddb87f9d":"num = df.drop(catg,axis = 1)\nnum = num.drop(\"is_canceled\", axis = 1)\nnum","e3a45f36":"num['lead_time'] = np.log(num['lead_time'] + 1)\nnum['arrival_date_week_number'] = np.log(num['arrival_date_week_number'] + 1)\nnum['arrival_date_day_of_month'] = np.log(num['arrival_date_day_of_month'] + 1)\nnum['adr'] = np.log(num['adr'] + 1)","39957349":"# Extracting reservation\n\ncatg[\"reservation_status_date\"] = pd.to_datetime(catg[\"reservation_status_date\"])\n\ncatg[\"year\"] = catg[\"reservation_status_date\"].dt.year\ncatg[\"month\"] = catg[\"reservation_status_date\"].dt.month\ncatg[\"day\"] = catg[\"reservation_status_date\"].dt.day\n\ncatg = catg.drop(\"reservation_status_date\", axis = 1)","543febab":"from sklearn.preprocessing import LabelEncoder\n\nlabel = LabelEncoder()\n\ncolumns = catg.columns\nfor col in columns:\n    catg[col] = label.fit_transform(catg[col])\ncatg","d13e282e":"catg = catg.drop([\"agent\"],axis =1)","9c09392f":"X = catg.join(num).drop(\"adr\",axis = 1)\ny = df[\"is_canceled\"]","3a04c1c4":"from sklearn.model_selection import train_test_split\n\nX_train, X_test, y_train, y_test = train_test_split(X,y, test_size=0.33, random_state=42)","70f75fe8":"from sklearn.tree import DecisionTreeClassifier\n\ntree_model = DecisionTreeClassifier()\ntree_model.fit(X_train, y_train)\ny_pred = tree_model.predict(X_test)","1d7befbf":"from sklearn.metrics import confusion_matrix,classification_report\n\nprint(classification_report(y_test,y_pred))","be6660b0":"from sklearn.model_selection import GridSearchCV\n\nparam_dist = {\n    \"criterion\" : [\"gini\", \"entropy\"],\n    \"max_depth\" : [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,None]\n}\n\ngrid = GridSearchCV(tree_model, param_grid=param_dist, cv = 10,n_jobs = -1)\ngrid.fit(X_train,y_train)\ngrid.best_estimator_","7f20bd2c":"tree_model = DecisionTreeClassifier(criterion=\"entropy\", max_depth=30)\ntree_model.fit(X_train, y_train)\ny_pred = tree_model.predict(X_test)\nprint(classification_report(y_test,y_pred))","a9138e6c":"from sklearn.preprocessing import MinMaxScaler\n\nsc = MinMaxScaler()\nX_train = sc.fit_transform(X_train)\nX_test = sc.fit_transform(X_test)","a3a32eac":"from sklearn.linear_model import LogisticRegressionCV\n\nlog_model = LogisticRegressionCV(max_iter=1000)\nlog_model.fit(X_train,y_train)\ny_pred = log_model.predict(X_test)","9459a745":"print(classification_report(y_test,y_pred))","49f4b28b":"from sklearn.preprocessing import StandardScaler\n\nsc = StandardScaler()\nX_train = sc.fit_transform(X_train)\nX_test = sc.fit_transform(X_test)","f442d0f6":"from sklearn.neighbors import KNeighborsClassifier\nknn_model = KNeighborsClassifier()\nknn_model.fit(X_train, y_train)\ny_pred = knn_model.predict(X_test)","ae0411af":"print(classification_report(y_test,y_pred))","769dbc69":"__Hotel Booking__ - Notebook to perform EDA on hotel booking data and build a model to predict cancellation of bookings\n\n","321c6c7d":"### MinMax Scaling features for Logistic Regression","6938a140":"Extracted some useful insights from `reservation_status_date` and then created `month` and `year` lists.","c6897aff":"__88% Accuracy with KNN__","a7a41047":"As we can see `phone_code` is something that might be useful in future. so we'll make a new columns and then drop the `phone-number`","29e2bc8c":"We must definitely consider `customer_type` in our model. ","beb86c08":"Let's first split our categorical and continous data into two different lists.","12a6bd69":"36 Columns so we must check columns first.","63a4d8a5":"## 8. Feature Selection","4e6ed8a1":"## 3. Data overview","ff7da0ee":"__96% Accuracy with decision tree__","ed256786":"## 5. Dropping columns","d602c37d":"* Canceling rate is pretty much high.\n* 70000> not canceled Vs. 40000> canceled.","340a71fa":"Too many missing values for `company` lets just drop it.","ff081ef9":"## 2. Loading dataset","8cf61a45":"First of all let's extract some useful information from `reservation_status_date` and then encode the `catg`.","b145f976":"## 7. Feature engineering","57119bd8":"Finally took the abs value of the cor matrix and then sorted it.","e3756add":"Although we might have overfitted our model for only 1 percent.","ce3a2a60":"### Standar Scaling features for Logistic Regression","9f58522f":"Greater canceling rate for `City Hotel`. this could help us with our model.","2033f8bf":"With decision trees typically we don't use `one hot encoding` with many features, like the situation here. so instead of that we just go with label encoding.","40db2d83":"Same agrument goes for `email` and `name`. But what about `phone-number`? Could we extract something meaningful out of it? ","0c9b317a":"Since our main target is `is_canceled` let's jump into it. and then explore everything related.","7d3018b8":"### 1. Decision Tree","f8cb9e00":"Our objective is to predict cancellation so many factors should play a role.","753dd24b":"Dropped columns with cor < 3%.","b6b12bbf":"With these lists, we can conclude that reservation status date plays a huge role whether a guest cancels or not.\n","5349983d":"Likewise, cancelation varies with year.","54ab9e05":"## 6. EDA","b4053c57":"As we can see, in the `lead_time` we're dealing with an exponential distrubition!","10104b21":"For sure `credit_card` doesn't have any valuable information, dropped!","f3d00654":"More days in waiting list, more chance of cancelling","fb83843d":"## 4. Data Cleaning","c8904518":"Now just drop every other missing row.","b3a565c3":"Now let's deal with the `agent` column.","ee974b2c":"## 10. Creating the model","44dbe4b9":"So it seems like `children` , `stays_in_weekend_nights` , `stays_in_week_nights` , `arrival_date_year`, `arrival_date_week_number`, `arrival_date_day_of_month` ,  `babies` don't contribute much to our model. ","9a016952":"Normalized the numerical feautres for better performance.","148554fa":"![](https:\/\/media-cdn.tripadvisor.com\/media\/photo-s\/16\/1a\/ea\/54\/hotel-presidente-4s.jpg)","865dea75":"Now we know what parameteres we're dealing with!","c156a1fa":"Now let's check with Grid Search whether we can perform better with hypertuning or not.","6274a16e":"It almost shows that `arrival_date_year` and `arrival_date_month` don't play a heavy role here. So mayber we should less complexify our model and remove these columns","bd928434":"## 1. Loading libraries","e2ec7570":"## 9. Spliting features ","2cc50ef3":" We can see as we get close to the end of the year, cancelations tend to decrease after a sudden rise in July. (which could be an account for the summer travels)","c539c474":"For more information check this article: <a href=\"https:\/\/kiwidamien.github.io\/are-you-getting-burned-by-one-hot-encoding.html\"> Are You Getting Burned By One-Hot Encoding? <a\/>","850d5244":"First we split the data into categorical and numerical.","7e71f9e4":"Now let's compare the cancelings between two hotels.","b87273f6":"__Got 97% Accuracy with `entropy` and `max_depth` of 30.__","8ee8bbc1":"As we can see we got a pretty cheat code. `reservation_status` is `is_canceled` + some `No-show`s so if we want to predict the canceling guests, it's necessary to remove this column.","e26f049f":"* Customers with the history of cancellation tend to cancel more often.\n* Interestingly repeated guests tend to cancel more!","7cf8d772":"Now we're good to go. Let's just drop unrelated columns.","aa5dbf38":"* Non Refundable payments tends to cancel more.\n* No deposit and Refundable type are more or less the same.","db6cb22a":"So let's just replace the `NaN` with the last value of that column. and then convert it to `str` type.","127db02a":"__79% Accuracy with Logistic Regression__","0c7a2ced":"### 2. Logistic Regression"}}