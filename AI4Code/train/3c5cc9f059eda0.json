{"cell_type":{"57654662":"code","c9f35ba1":"code","3baa8af8":"code","a66d62c9":"code","a732859b":"code","6908776e":"code","3daaa60a":"code","905fa5b3":"code","7ca7be80":"code","dcd7c38f":"code","a642984f":"code","4ea97234":"code","908cf79b":"code","f064dfdd":"code","c37b86a9":"code","e95c0674":"code","2ae042fd":"code","817dc9c5":"code","e9dc583b":"code","eaf73d5c":"code","322c0c9a":"code","5d7f4abb":"code","b09fc16a":"code","8fbf05c1":"code","746af8fe":"code","8f518985":"code","dc599ca8":"code","6c3cb3c6":"code","1795e99f":"code","574c7602":"code","f7573789":"code","07d2d88c":"code","2dbbd1b9":"code","9488d383":"code","097673b4":"code","6730e05e":"code","a4f7cc26":"code","0ee78d40":"code","42e7b0e1":"code","96993c13":"markdown","45ce340e":"markdown","6d98d781":"markdown","b3c30873":"markdown","6e9fd03c":"markdown","b2f061c8":"markdown","d86ed8a8":"markdown","dce7b710":"markdown","90d1c9ba":"markdown","65cdde92":"markdown","b04360b2":"markdown","b4a4618c":"markdown","c2a8e19a":"markdown","09821e68":"markdown","4e50b2bd":"markdown","9ce5fa29":"markdown","196a03fd":"markdown","c30ab64e":"markdown","6a00ace8":"markdown","2e43b34d":"markdown","78faeec9":"markdown","8034baad":"markdown","5746f0e4":"markdown","5ac8aac1":"markdown","2f16fb18":"markdown","c1210987":"markdown","54d21f9e":"markdown","9156c358":"markdown","e682e176":"markdown","1c5d4aad":"markdown","3369a458":"markdown","23087563":"markdown","2b9c18ea":"markdown"},"source":{"57654662":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport missingno as msno\nimport plotly.express as px\nimport plotly.graph_objects as go\nimport calendar\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import accuracy_score, precision_score,confusion_matrix\nfrom sklearn.linear_model import LogisticRegression\n#from sklearn.pipeline import Pipeline\n#from sklearn.compose import ColumnTransformer\n#from sklearn.preprocessing import OneHotEncoder, MinMaxScaler\n#from category_encoders import BinaryEncoder\n#from sklearn.pipeline import Pipeline\n#from sklearn.impute import SimpleImputer\nfrom sklearn.metrics import classification_report\nimport warnings\nwarnings.filterwarnings('ignore')\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","c9f35ba1":"#### Load the dataset ######\nHotel_Df = pd.read_csv('..\/input\/hotel-booking-demand\/hotel_bookings.csv')","3baa8af8":"## Finding the shape of the dataset\nprint(Hotel_Df.shape)","a66d62c9":"### Printing the information of the dataset\nprint(Hotel_Df.info())","a732859b":"### Print the length of the dataset\nprint('Length of the dataset:',len(Hotel_Df))","6908776e":"####### top 5 dataset information ###\nprint(Hotel_Df.head(5))","3daaa60a":"### Printing the statistics of the dataset ###\nprint(Hotel_Df.describe())","905fa5b3":"## Duplicate or null values in the dataset\nprint(Hotel_Df.isnull().sum())","7ca7be80":"## Bar plot to see the Null values after filling with 0\nmsno.bar(Hotel_Df)","dcd7c38f":"### Dropping the columns that have null values.\nHotel_Book_DF = Hotel_Df.copy()\nHotel_Book_DF = Hotel_Book_DF.drop(['company', 'agent','arrival_date_week_number'], axis=1)\nHotel_Book_DF = Hotel_Book_DF.dropna(subset=['country', 'children'], axis=0)\nHotel_Book_DF = Hotel_Book_DF.reset_index(drop=True)\nHotel_Book_DF.head()","a642984f":"## Check for Null values again\nprint(Hotel_Book_DF.isnull().sum())","4ea97234":"## Bar plot to see the Null values after filling with 0\nmsno.bar(Hotel_Book_DF)","908cf79b":"##Find the Numerical Columns \nnumerical_cols = Hotel_Book_DF.columns[Hotel_Book_DF.dtypes != object]","f064dfdd":"print(numerical_cols)","c37b86a9":"## Print the Categorical Variables\ncategorical_cols = Hotel_Book_DF.columns[Hotel_Book_DF.dtypes == object]","e95c0674":"print(categorical_cols)","2ae042fd":"#After cleaning the dataset the above chart gives a clear understanding of the dataset\nBook_Hotel_DF = Hotel_Book_DF.copy()\nBook_Hotel_DF = Book_Hotel_DF.copy().hist(figsize=(20,14))\nplt.show()","817dc9c5":"## Number of bookings cancelled at the hotel\nBook_Hotel_DF = Hotel_Book_DF.copy()\nsns.set(style = \"darkgrid\")\nplt.title(\"Is Booking Canceled or not\", fontdict = {'fontsize': 20})\nax = sns.countplot(x = \"is_canceled\", data = Book_Hotel_DF)","e9dc583b":"#How many Bookings were Cancelled by Hotel Type?\nBook_Hotel_DF = Hotel_Book_DF.copy()\nsns.set(style = \"darkgrid\")\nplt.title(\"Is Canceled or not by Hotel Type\", fontdict = {'fontsize': 20})\nax = sns.countplot(x = \"hotel\", hue = 'is_canceled', data = Book_Hotel_DF)","eaf73d5c":"## Overview of arrival period\nlst3 = ['hotel', 'arrival_date_year', 'arrival_date_month','arrival_date_day_of_month' ]\nperiod_arrival = Book_Hotel_DF[lst3]\nsns.countplot(data = period_arrival, x = 'arrival_date_year', hue = 'hotel')","322c0c9a":"### Count of Bookings by month cancelled vs Non-Cancelled\nBook_Hotel_DF = Hotel_Book_DF.copy()\nplt.figure(figsize=(15, 5));\nplt.title(\"Count of orders by month\");\nsns.countplot(Book_Hotel_DF.arrival_date_month, hue=Book_Hotel_DF.is_canceled, palette=\"mako\", order=calendar.month_name[1:]);","5d7f4abb":"# Which Month is the Most Occupied with Bookings at the Hotel?\nBook_Hotel_DF = Hotel_Book_DF.copy()\nmonth_sorted = ['January','February','March','April','May','June','July','August','September','October','November','December']\nplt.figure(figsize=(14,6))\nplt.title(\"what times of the year do we have the highest bookings\", fontdict = {'fontsize': 20})\nsns.countplot(Book_Hotel_DF['arrival_date_month'], palette='tab10', order = month_sorted)\nplt.xticks(rotation = 90)\nplt.show()","b09fc16a":"## Based on Reservation room type average daily rate of hotel\nplt.figure(figsize=(12,6))\nds=Book_Hotel_DF[Book_Hotel_DF['is_canceled']==0]\nsns.violinplot(x = 'reserved_room_type', y = 'adr',data=ds,hue='hotel',palette='Set1')","8fbf05c1":"### Number of Booking records based on Countries\ncountry_freq = Book_Hotel_DF['country'].value_counts().to_frame()\ncountry_freq.columns = ['count']\nfig = px.choropleth(country_freq, color='count',\n                    locations=country_freq.index,\n                    hover_name=country_freq.index,\n                    color_continuous_scale=px.colors.sequential.Magenta)\nfig.update_traces(marker=dict(line=dict(color='#000000', width=1)))\nfig.update_layout(title_text='Number of Records by Countries',\n                  title_x=0.5, title_font=dict(size=22))  # Location and the font size of the main title\nfig.show()","746af8fe":"## Company Booking IDs vs Types of hotel\nsns.boxplot(x='company',y='hotel',data=Hotel_Df) ## with the whole dataset","8f518985":"## Percentage of reservation status\nreservation_status = Book_Hotel_DF['reservation_status'].value_counts()\nfig = go.Figure(data=[go.Pie(labels=reservation_status.index, values=reservation_status, opacity=0.8)])\nfig.update_traces(textinfo='percent+label', marker=dict(line=dict(color='#000000', width=2)))\nfig.update_layout(title_text='Distribution of the Reservation Status', title_x=0.5, title_font=dict(size=32))\nfig.show()","dc599ca8":"### Count of bookings based on month for all three years\ncanceled = Book_Hotel_DF[Book_Hotel_DF['is_canceled'] == 1]\ncanceled_by_month_year = canceled.pivot_table(index=\"arrival_date_year\", columns=\"arrival_date_month\", aggfunc=\"count\").fillna(0).adr.T\n\n\ncanceled_by_month_year = canceled_by_month_year.reindex(calendar.month_name[1:])\nplt.figure(figsize=(15, 5));\nplt.title(\"Count of canceled orders by month and year\");\nsns.lineplot(data=canceled_by_month_year, palette=\"mako_r\", linewidth=2);","6c3cb3c6":"### Count of bookings based on month for all three years\ncanceled = Book_Hotel_DF[Book_Hotel_DF['is_canceled'] == 0]\ncanceled_by_month_year = canceled.pivot_table(index=\"arrival_date_year\", columns=\"arrival_date_month\", aggfunc=\"count\").fillna(0).adr.T\n\n\ncanceled_by_month_year = canceled_by_month_year.reindex(calendar.month_name[1:])\nplt.figure(figsize=(15, 5));\nplt.title(\"Count of Non-Cancelled booking by month and year\");\nsns.lineplot(data=canceled_by_month_year, palette=\"mako_r\", linewidth=2);","1795e99f":"### children staying in a hotel on a week day vs weekend\nplt.figure(figsize=(5, 4), dpi=100)\nsns.scatterplot(data=Book_Hotel_DF, x='stays_in_week_nights', y='stays_in_weekend_nights', \n                hue='children',style='children', palette='bright')","574c7602":"## Correlation matrix of Hotel Booking\nBook_Hotel_DF = Hotel_Book_DF.copy()\nplt.figure(figsize=(15, 8))\ncorrelation = sns.heatmap(Book_Hotel_DF.corr(), vmin=-1, vmax=1, annot=True, linewidths=1, linecolor='black', cmap = \"viridis\")\ncorrelation.set_title('Correlation Matrix of the Hotel Booking', fontdict={'fontsize': 24})","f7573789":"hotel = Book_Hotel_DF.drop(['meal','country','reserved_room_type','assigned_room_type','deposit_type','reservation_status','reservation_status_date'], axis=1)\nhotel = pd.concat([hotel, \n                 pd.get_dummies(hotel['hotel'], drop_first=True), \n                 pd.get_dummies(hotel['arrival_date_month'], drop_first=True), \n                 pd.get_dummies(hotel['market_segment'], drop_first=True),\n                 pd.get_dummies(hotel['distribution_channel'], drop_first=True),\n                 pd.get_dummies(hotel['customer_type'], drop_first=True)\n                 ], axis=1)\nhotel = hotel.drop(['hotel','arrival_date_month','market_segment','distribution_channel','customer_type'], axis=1)","07d2d88c":"from sklearn.model_selection import train_test_split\ny = hotel['is_canceled']\nX = hotel.drop('is_canceled', axis = 1)\nX_train, X_test, y_train, y_test = train_test_split(X,y,random_state=101,test_size=0.3)","2dbbd1b9":"from sklearn.preprocessing import StandardScaler\nscaler = StandardScaler()\nX_train = scaler.fit_transform(X_train)\nX_test = scaler.transform(X_test)","9488d383":"from sklearn.linear_model import LogisticRegressionCV\n\nreg_model = LogisticRegressionCV(max_iter=1000)\nreg_model.fit(X_train,y_train)\ny_pred_reg = reg_model.predict(X_test)\nacc_reg = accuracy_score(y_test, y_pred_reg)\nprint(\"Classification Report of Logistic Regression:\")\nprint(classification_report(y_test,y_pred_reg))\nprint(\"Confusion Matrix:\\n\",confusion_matrix(y_test,y_pred_reg))\nprint(\"Training Score:\\n\",reg_model.score(X_train,y_train)*100)\nprint(f\"Accuracy Score of Logistic Regression is : {acc_reg}\")","097673b4":"X = hotel.iloc[:, 1:].values\ny = hotel.iloc[:, 0].values\n#from sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.25, random_state = 0)","6730e05e":"# Empty dictionary of model accuracy results\nmodel_accuracy_results = {}\n\n# Function for calculating accuracy from confusion matrix\n#from sklearn.metrics import confusion_matrix\ndef model_accuracy(y_test, y_pred):\n    cm = confusion_matrix(y_test, y_pred)\n    accuracy = ((cm[0,0] + cm [1,1]) * 100 \/ len(y_test)).round(2)\n    return accuracy","a4f7cc26":"# Fit and train\nfrom sklearn.neighbors import KNeighborsClassifier\nclassifier = KNeighborsClassifier(n_neighbors = 10)\nclassifier.fit(X_train,y_train)\n\n# Predict\ny_pred = classifier.predict(X_test)\n\n#from sklearn.metrics import classification_report, confusion_matrix, accuracy_score\nresult = confusion_matrix(y_test, y_pred)\nprint(\"Confusion Matrix:\")\nprint(result)\nresult1 = classification_report(y_test, y_pred)\nprint(\"Classification Report:\",)\nprint (result1)\n\n# Computing accuracy\nmodel_accuracy_results['KNearestNeighbors'] = model_accuracy(y_test, y_pred)","0ee78d40":"# Fit and train\nfrom sklearn.ensemble import RandomForestClassifier\nclassifier = RandomForestClassifier(n_estimators=10, criterion='entropy', random_state=0)\nclassifier.fit(X_train,y_train)\n\n# Predict\ny_pred = classifier.predict(X_test)\n\n#from sklearn.metrics import classification_report, confusion_matrix, accuracy_score\nresult = confusion_matrix(y_test, y_pred)\nprint(\"Confusion Matrix:\")\nprint(result)\nresult1 = classification_report(y_test, y_pred)\nprint(\"Classification Report:\",)\nprint (result1)\n# Computing accuracy\nmodel_accuracy_results['RandomForest'] = model_accuracy(y_test, y_pred)","42e7b0e1":"acurracies = pd.DataFrame(list(model_accuracy_results.values()), index=model_accuracy_results.keys(), columns=['Accuracy'])\nacurracies","96993c13":"Train and Test Data sets","45ce340e":"The dataset contains 32 columns with a total length of 119390. \nDisplayed above dataset types for different columns\nFew columns have wrong data types like children","6d98d781":"After dropping the columns now we have 29 columns to explore.","b3c30873":"August has the highest number of bookings and \nJanuary has the lowest number of cancellations.","6e9fd03c":"2016 seems to be the year where hotel booking is at its highest at City Hotel and the same year Resort hotel also has the highest but its less than the city hotel.","b2f061c8":"Resort hotel has more number of bookings than City hotel \nCity hotel has outliers","d86ed8a8":"Displayed the top 5 rows of the dataset. There are records with Nan values.","dce7b710":"The Darker color represents the country with highest number of bookings\nPRT (Portugal) has the highest number of booking records.","90d1c9ba":"### Bivariant Analysis ###","65cdde92":"From the pie chart we infer that 62.9% of customers stayed in the hotel and check out\n36.1% customers have cancelled the bookings and only 1.01% customers have not showed after booking the reservations.","b04360b2":"There are no more null values.","b4a4618c":"### Pre-Processing of the Data Set ###","c2a8e19a":"## Feature Engineering to Predict the Model","09821e68":" ### Exploratory Data Analysis for Hotel Data Set ###","4e50b2bd":"Most of the time there are no children stayed during the Week nights ","9ce5fa29":"August has the highest number of bookings might be its summer and \nJanuary has the lowest number of bookings could be because of winter","196a03fd":"## Pearson Corelation Matrix","c30ab64e":"Shape explains that the dataset has 119390 records with 32 columns ","6a00ace8":" There is no clear and strong relationship between any of the features and the cancelation maybe we must include more factors in the dataset.","2e43b34d":"From the above graph we can infer that more than 70,000 records of the bookings were not cancelled \nand around 45000 of the bookings were cancelled.","78faeec9":"### Logistic Regression ###","8034baad":"There are three columns Children, Country, agent and company has null columns. ","5746f0e4":"For the year 2017 the count of cancellations are high in May\nFor the year 2016 the count of cancellations are high in October\nFor the year 2015 the count of cancellations are high in September","5ac8aac1":"Now the graph looks good with all the bars equally lined up","2f16fb18":"For the year 2016 has highest number of non-cancelled bookings \nFor the year 2015 has lowest number of non-cancelled bookings\nFor the year 2017 has moderate number of non-cancelled bookings","c1210987":"Calculate the mean, standard deviation, minimum , maximum and quantitle values.","54d21f9e":"Training Score: 78.69 %\nAccuracy score of Logistic Regression = 79.08 %","9156c358":"From the above plot we infer that the average price per room depends on its type and the standard deviation.\nAverage daily rate is high for City hotel with room type G.","e682e176":"Company column has more than 94 % of the data as null\nCompany column represents the ID of the company that made booking.\nAgent column represents the ID of the booking agent.\nPlan to drop these column in the upcoming steps","1c5d4aad":"Scalling for logistic regression","3369a458":"Dropping few columns that is not required for predicting","23087563":"Splitting the dataset again for KNN and Random Forest Prediction","2b9c18ea":"City Hotel has the highest canceled booked and also the highest that not canceled booked."}}