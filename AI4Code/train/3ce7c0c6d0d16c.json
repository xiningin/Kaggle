{"cell_type":{"6e76f7d4":"code","fb28eb5c":"code","ba266d4a":"code","35e05f0d":"code","9b64b939":"code","99d2a54b":"code","a2c031a5":"code","5d38ec9d":"code","b2f4bdb0":"code","5b82cf7c":"code","f0d70cd9":"code","c9367e65":"code","2c020468":"code","a74235f6":"code","0a4a3e53":"code","aad5d3d7":"code","0e214b8c":"code","256c708f":"code","8dae89af":"code","b4643b99":"code","aed55225":"code","e027285c":"code","02d3b2bb":"code","e12a0d50":"code","09adebf9":"code","8fb837b7":"code","2977a581":"code","38f19c50":"code","31990409":"code","45de07ff":"code","827d68fd":"code","a32a9857":"code","d73a2538":"code","cc80b1ba":"markdown","59c83798":"markdown","7f657a19":"markdown","121c9f6e":"markdown","8931d147":"markdown","ffed07ca":"markdown","3cb2ff17":"markdown","35f9df3c":"markdown","34db0bac":"markdown","31d1bc55":"markdown","e8d3ec7a":"markdown","08d247d3":"markdown","34501b78":"markdown","b706d717":"markdown","4e3d5665":"markdown","aea3a507":"markdown","826110ce":"markdown","30bd83f4":"markdown","0ff0b163":"markdown","fd5fbbd3":"markdown","158d3456":"markdown","44d81a3a":"markdown","54154ffe":"markdown"},"source":{"6e76f7d4":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","fb28eb5c":"import ast\nimport nltk\nfrom nltk.tokenize import word_tokenize\nfrom sklearn.feature_extraction.text import CountVectorizer\nfrom sklearn.metrics.pairwise import cosine_similarity\n\n# Getting more than one output Line\nfrom IPython.core.interactiveshell import InteractiveShell\nInteractiveShell.ast_node_interactivity = \"all\"","ba266d4a":"dfmm=pd.read_csv('..\/input\/movies_metadata.csv')\ndfc=pd.read_csv('..\/input\/credits.csv')\ndfk=pd.read_csv('..\/input\/keywords.csv')\ndfr=pd.read_csv('..\/input\/ratings_small.csv')\ndfmm.head()\ndfc.head()\ndfk.head()\ndfr.head()","35e05f0d":"dfmm=dfmm.drop([19730, 29503, 35587])\ndfr=dfr.drop([19730, 29503, 35587])\ndfmm.shape\ndfc.shape\ndfk.shape\ndfr.shape","9b64b939":"dataframes=[dfmm, dfc, dfk]\nfor dataframe in dataframes:\n    dataframe['id']=dataframe['id'].astype('int')","99d2a54b":"newdf=dfmm.merge(dfc, on='id')\nnewdf=newdf.merge(dfk, on='id')\nnewdf.head()","a2c031a5":"newdf['overview'].fillna('', inplace=True)\nnewdf.drop(newdf[newdf['vote_average'].isnull()].index, inplace=True)","5d38ec9d":"def get_words(x):\n    bagofwords=[]\n    for i in x:\n        if i[1]=='NN':\n            bagofwords.append(i[0])\n        elif i[1]=='NNS':\n            bagofwords.append(i[0])\n        elif i[1]=='NNP':\n            bagofwords.append(i[0])\n        elif i[1]=='NNPS':\n            bagofwords.append(i[0])\n        elif i[1]=='JJ':\n            bagofwords.append(i[0])\n        elif i[1]=='JJR':\n            bagofwords.append(i[0])\n        elif i[1]=='JJS':\n            bagofwords.append(i[0])\n        elif i[1]=='RB':\n            bagofwords.append(i[0])\n        elif i[1]=='RBR':\n            bagofwords.append(i[0])\n        elif i[1]=='RBS':\n            bagofwords.append(i[0])\n    return bagofwords","b2f4bdb0":"def clean_words(x):\n    b=nltk.pos_tag(word_tokenize(x))\n    result=get_words(b)\n    return result","5b82cf7c":"newdf['bagofwords']=newdf['overview'].apply(clean_words)","f0d70cd9":"features = ['cast', 'crew', 'keywords', 'genres']\nfor feature in features:\n    newdf.loc[:, feature] = newdf.loc[:, feature].apply(ast.literal_eval)","c9367e65":"def get_keywords(x):\n    names=[i['name'] for i in x]\n    if len(names)>6:\n        names=names[:6]\n    return names","2c020468":"def get_director_producer(x):\n    names=[]\n    for i in x:\n        if i['job']=='Director':\n            names.append(i['name'])\n        elif i['job']=='Producer':\n            names.append(i['name'])\n    return names\n            ","a74235f6":"features_new = ['cast', 'keywords', 'genres']\nfor feature in features_new:\n    newdf[feature]=newdf[feature].apply(get_keywords)\nnewdf['crew']=newdf['crew'].apply(get_director_producer)\nnewdf['crew']=newdf['crew'].map(lambda x: [i.replace(\" \", \"\") for i in x])\nnewdf['cast']=newdf['cast'].map(lambda x: [i.replace(\" \", \"\") for i in x])","0a4a3e53":"newdf['document']=newdf['genres']+newdf['cast']+newdf['crew']+newdf['keywords']+newdf['bagofwords']\nnewdf['document']=newdf['document'].map(lambda x: ' '.join(x))\nnewdf['document'].head()","aad5d3d7":"pd.qcut(newdf['vote_average'], 10).values\npd.qcut(newdf['vote_count'], 4).values","0e214b8c":"newdf=newdf[(newdf['vote_average']>3.5) & (newdf['vote_count']>34)]\nnewdf.reset_index(drop=True, inplace=True)","256c708f":"vectorizer = CountVectorizer(stop_words='english')\nmatrix = vectorizer.fit_transform(newdf['document'])","8dae89af":"similarity = cosine_similarity(matrix, matrix)\nsimilarity","b4643b99":"def recommendation(x):\n    dataset=newdf.copy()\n    ind=dataset[dataset['original_title']==x].index[0]\n    sim=sorted(enumerate(similarity[ind]), key=lambda x: x[1], reverse=True)[1:11]\n    ind2, scores=zip(*sim)\n    recommendation=dataset.loc[ind2, 'original_title']\n    return recommendation","aed55225":"recommendation('The Matrix')","e027285c":"recommendation('The Prestige')","02d3b2bb":"dfmm['id']=dfmm['id'].astype('int')\ndfr['movieId']=dfr['movieId'].astype('int')","e12a0d50":"titles=dfmm['original_title'].tolist()\nids=dfmm['id'].tolist()\nthe_map=dict(zip(ids, titles))","09adebf9":"dfr['title']=dfr['movieId'].map(the_map)\ndfr.shape","8fb837b7":"user_item=dfr.pivot_table(index='userId', columns='title', values='rating')","2977a581":"user_item.fillna(0, inplace=True)","38f19c50":"user_similarity = cosine_similarity(user_item, user_item)\nuser_similarity","31990409":"item_user=user_item.T\nitem_user.head()","45de07ff":"item_similarity = cosine_similarity(item_user, item_user)\nitem_similarity","827d68fd":"def filtering_recommendations(x, a):\n    dataset=item_user.copy()\n    df=dataset.reset_index()\n    ind=df[df['title']==x].index[0]\n    sim=sorted(enumerate(item_similarity[ind]), key=lambda x: x[1], reverse=True)[1:51]\n    ind2, scores=zip(*sim)\n    recommendation=df.loc[ind2, 'title']\n    dataset1=user_item.copy()\n    df2=dataset1.reset_index()\n    ind=df2[df2['userId']==a].index[0]\n    sim=sorted(enumerate(user_similarity[ind]), key=lambda x: x[1], reverse=True)[1:51]\n    ind2, scores=zip(*sim)\n    recommendation2=df2.loc[ind2, 'userId']\n    dictionary={}\n    for i in recommendation.index:\n        lis=[]\n        for j in recommendation2.index:\n            if (user_item.iloc[j, i]==0):\n                continue\n            else:\n                lis.append(user_item.iloc[j, i])\n        dictionary[i]=np.mean(lis)\n    keys=[]\n    for i in dictionary.keys():\n        keys.append(i)\n    values=[]\n    for i in dictionary.values():\n        values.append(i)\n    ourdf=pd.Series(values, index=keys)\n    sim3=ourdf.fillna(0).sort_values(ascending=False)[0:9].index\n    combined_recommendation=df.loc[sim3, 'title']\n    return combined_recommendation","a32a9857":"filtering_recommendations('1984', 2)","d73a2538":"filtering_recommendations('1984', 200)","cc80b1ba":"First let's Load the datasets","59c83798":"Merge the tables with ratings and titles","7f657a19":"Compute the cosine similarity of each user","121c9f6e":"To extract content from overviews, we tokenize each overview and apply part of speech tagging to each token. We will extract nouns, adjectives and adverbs and use only these words from overviews in our final model","8931d147":"compute the cosine similarity of each item","ffed07ca":"The get_keywords function can extract the names of cast, genres and each keyword in keywords.","3cb2ff17":"Before we feed the count vectorizer with the \"document\" feature. We will rule out films with too low vote_average and too low vote_count to ensure recommendation quality","35f9df3c":"Collaborative filtering construct a user-item matrix with user as the index and items as the columns. The value of each cell is the rating the user give the item. For a user-based filtering, we compute euclidean distance between each row to identify similar users, and recommend items similar users have watched. For a item-based filtering, we compute euclidean distance between each column to to identify similar items, and recommend items that are similar to the given item.","34db0bac":"**Content Based Recommender**","31d1bc55":"Compute the Cosine Similarity matrix based on the count matrix","e8d3ec7a":"Drop rows with improper ids and observe the shape of each dataframe","08d247d3":"The get_director_producer function can extract the names of the director and producer of the film.","34501b78":"Pivot the table so the user is the index, title is the column and value of the cell is the rating","b706d717":"In order to personalize the recommendation given a user U and a film I, we will get the most similar films of film I and the most similar users of the user U.  Then we average their ratings for each item of the similar films, counting only those among the similar users who have rated the item.  We will recommend only the items that have higher average ratings given by the users","4e3d5665":"Check null values in the features","aea3a507":"Create the final \"document\" by combining all the content from genres, cast, crew, keywords, and bag of words","826110ce":"Transform cast, crew, keywords and genres to the forms we need. And get rid of white space between first names and last names of the all the names, combining first names with last names as single names result in stronger identifiers. For examle, for \"Tom Hanks\", there are many people named \"Tom\", but \"TomHanks would be a strong indicator of whom we are referring to","30bd83f4":"Convert the datatype of feature 'id' to integer","0ff0b163":"Films with vote_average less than 90 percent of all the films have vote_average less than 3.5, these films have very limited values to be recommended. Films with vote_count of less than 75 percent of all the films have vote_counts less than 49, these films have too small samples to be considered as statistically significant.","fd5fbbd3":"**Collaborative filtering**","158d3456":"The Content based recommendation is great in recommending films based on content similarity between films. But a major flaw in content based recommender is that it does not take personal affections into account. If a user watches \"The Dark Knight\", it could either mean that the user likes Batman or the user likes Christopher Nolan, or it could be other reasons.","44d81a3a":"For the first part of the recommender system, we are going to build a content based recommender. We are going to extract content from overview, genres, cast, crew and keywords, vectorize the content of each film and compare similarities between films using cosine similarity. The recommender will recommend ten most similar documents given the target document.","54154ffe":"We compute count vectors for each document. Combining this vectors will give us a matrix where each row represents a document(a movie) and each column represent a word that occurs in the overall vocabulary. The value of each cell is the count of the word occur in the document."}}