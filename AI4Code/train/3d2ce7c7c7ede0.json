{"cell_type":{"1e28dc69":"code","b26e47f7":"code","15922310":"code","2816fb2a":"code","cde96ac3":"code","c73e0de9":"code","1c79bc2f":"code","44bd7850":"code","667a33ae":"code","566fbb1d":"code","2d7b2018":"code","9a34a9d4":"markdown","2d72c505":"markdown","ac55459a":"markdown","2f9f1a0c":"markdown","121a3e31":"markdown"},"source":{"1e28dc69":"import os\n\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nfrom skimage.io import imread\nfrom tqdm.notebook import tqdm","b26e47f7":"PATH = '..\/input\/alaska2-image-steganalysis'\nsub = pd.read_csv(os.path.join(PATH, 'sample_submission.csv'))\nsub","15922310":"sub2 = pd.read_csv(os.path.join(PATH, 'sample_submission.csv'))\nsub2","2816fb2a":"sub3 = pd.read_csv(os.path.join(PATH, 'sample_submission.csv'))\nsub3","cde96ac3":"class JPEGImageCompressionRateDeterminer:\n    def __call__(self, image_path):\n        image = imread(image_path)\n        w, h, c = image.shape\n        \n        # theoretical image size\n        b = w*h*3\n        \n        # real image file size in bytes\n        s = os.stat(image_path).st_size\n        return (b - s) \/ b ","c73e0de9":"compression_rate_determiner = JPEGImageCompressionRateDeterminer()\n\ncompressions = {}\n\ndir_path = os.path.join(PATH, 'Test')\nfor impath in tqdm(sub.Id.values):\n    c = compression_rate_determiner(os.path.join(dir_path, impath))\n    compressions[impath] = c\n    sub.loc[sub.Id == impath, 'Label'] = c","1c79bc2f":"compression_rate_determiner = JPEGImageCompressionRateDeterminer()\n\ncompressions = {}\n\ndir_path = os.path.join(PATH, 'Test')\nfor impath in tqdm(sub.Id.values):\n    c = compression_rate_determiner(os.path.join(dir_path, impath))\n    compressions[impath] = c\n    sub2.loc[sub.Id == impath, 'Label'] = c**2","44bd7850":"compression_rate_determiner = JPEGImageCompressionRateDeterminer()\n\ncompressions = {}\n\ndir_path = os.path.join(PATH, 'Test')\nfor impath in tqdm(sub.Id.values):\n    c = compression_rate_determiner(os.path.join(dir_path, impath))\n    compressions[impath] = c\n    if c < 0.75:\n        sub3.loc[sub.Id == impath, 'Label'] = 0.000001\n    elif c >= 0.75 and c < 0.90:\n        sub3.loc[sub.Id == impath, 'Label'] = 1. - 1e-3 - (c - 0.75)\n    elif c >= 0.90 and c < 0.95:\n        sub3.loc[sub.Id == impath, 'Label'] = 1. - 1e-3 - (c - 0.90)\n    else:\n        sub3.loc[sub.Id == impath, 'Label'] = 1. - 1e-3 - (c - 0.95)","667a33ae":"plt.figure(figsize=(10,10))\n\nplt.axvline(0.75, color='orange')\nplt.axvline(0.90, color='orange')\nplt.axvline(0.95, color='orange')\nplt.axvspan(0., 0.95, color='green', alpha=0.25)\nplt.axvspan(0.95, 1.0, color='red', alpha=0.25)\nsns.distplot(list(compressions.values()));","566fbb1d":"sub.to_csv('submission.csv', index=None)\nsub2.to_csv('submission2.csv', index=None)\nsub3.to_csv('submission3.csv', index=None)","2d7b2018":"sub.head()","9a34a9d4":"## Compression Rate\nMay we have an RGB image with height H and width W. The theoretical number bytes B for this image is $$B = H * W * 3$$\nTherefor if the real size of image is S, then compression rate C is $$ C = (B - S) \/ B$$","2d72c505":"## Submission","ac55459a":"## Empiric improvement\nEmpiric improvement based on punct 4 in data description.\n> \"4.The images are all compressed with one of the three following JPEG quality factors: 95, 90 or 75.\"\n\nSo images with compression rate more then 0.95 are prohibited.","2f9f1a0c":"## Reference\n* [ALASKA2: SRNet baseline inference](https:\/\/www.kaggle.com\/naivelamb\/alaska2-srnet-baseline-inference)","121a3e31":"Current notebook is empiric improvment current [top decision](https:\/\/www.kaggle.com\/naivelamb\/alaska2-srnet-baseline-inference) by [Xuan Cao](https:\/\/www.kaggle.com\/naivelamb)."}}