{"cell_type":{"d7835546":"code","89eb59d0":"code","1b165a74":"code","6ca1793b":"code","d0e11f35":"code","ed586afd":"code","c2dad23b":"code","5a7563da":"code","2a47031a":"code","1fc740da":"code","1e5d8fe5":"code","4229c50f":"markdown","01a9ad9d":"markdown","f7d9155c":"markdown","d1cc417a":"markdown","458dfe69":"markdown","b99ce266":"markdown","153d1e88":"markdown","d1e05cc2":"markdown","7ebf378a":"markdown"},"source":{"d7835546":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom xgboost import XGBClassifier\nfrom catboost import CatBoostClassifier","89eb59d0":"train_meta = pd.read_csv(\"..\/input\/siim-isic-melanoma-classification\/train.csv\")\ntest_meta = pd.read_csv(\"..\/input\/siim-isic-melanoma-classification\/test.csv\")\n\nuseful_cols = ['sex',\"age_approx\",\"anatom_site_general_challenge\"]\nTARGET = \"target\"\nID = \"image_name\"\ntrain_meta = train_meta[useful_cols+[TARGET,ID]]","1b165a74":"train_meta.isna().sum()","6ca1793b":"train_meta['anatom_site_general_challenge'] = train_meta['anatom_site_general_challenge'].fillna(\"unknown_site\")\ntest_meta['anatom_site_general_challenge'] = test_meta['anatom_site_general_challenge'].fillna(\"unknown_site\")","d0e11f35":"train_meta.dropna(inplace=True)","ed586afd":"from sklearn.preprocessing import LabelEncoder\nfrom collections import defaultdict\n\nencoders = defaultdict(LabelEncoder)\nfor column in train_meta.select_dtypes(\"object\").columns:\n    if column in [ID,TARGET]:\n        continue\n    encoder = LabelEncoder()\n    train_meta[column] = encoder.fit_transform(train_meta[[column]])\n    encoders[column] = encoder","c2dad23b":"train_meta.shape","5a7563da":"X = train_meta.drop([ID,TARGET],axis=1)\nY = train_meta[[TARGET]]\n\nfrom sklearn.model_selection import KFold\nfolds = KFold(n_splits=5,shuffle=True)\n\nparams ={\n    \"od_type\":\"Iter\",\n    'od_wait':100,\n    \"eval_metric\":\"AUC\",\n    'loss_function':'Logloss',\n    \"iterations\":1000,\n    \"verbose\":100\n}\n\nscores = []\n\nmax_score = -np.inf\nfor (train_idx,test_idx),i in zip(folds.split(X,Y),range(0,5)):\n    print(\"Working On fold \",i)\n    model = CatBoostClassifier(**params)\n    model.fit(X.iloc[train_idx],Y.iloc[train_idx],\n              eval_set=(X.iloc[test_idx],Y.iloc[test_idx]),\n              cat_features = [\"sex\",\"anatom_site_general_challenge\"])\n    \n    score = model.score(model.predict(X.iloc[test_idx]),Y.iloc[test_idx])\n    print(\"Achieved AUC Score :\" ,score)\n    scores.append(score)\n    print(scores)\n    if score > max_score:\n        best_idx = (train_idx,test_idx)\n        max_score = score\n        \n    print(\"-\"*100)\n    \n\nprint(\"Final Results from 5 KFOLD\")\nprint(\"Min Score\",min(scores))\nprint(\"Mean Score\",sum(scores)\/len(scores))\nprint(\"Max Score\",max(scores))","2a47031a":"model = CatBoostClassifier(**params)\nmodel.fit(X.iloc[best_idx[0]],Y.iloc[best_idx[0]],\n              eval_set=(X.iloc[best_idx[1]],Y.iloc[best_idx[1]]),\n              cat_features = [\"sex\",\"anatom_site_general_challenge\"])\n\nscore = model.score(model.predict(X.iloc[test_idx]),Y.iloc[test_idx])\nprint(\"Achieved AUC Score :\" ,score)\n    ","1fc740da":"for key in encoders.keys():\n    test_meta[key] = encoders[key].transform(test_meta[key])\ntest_meta.head()","1e5d8fe5":"testing = test_meta.drop([ID,'patient_id'],axis=1)\npredictions = model.predict_proba(testing)\npredictions = [i[1] for i in predictions]\ntest_meta[TARGET] = predictions\ntest_meta[[ID,TARGET]].to_csv(\"catboost_submission.csv\",index=None)","4229c50f":"Final Touch to submit  csv file.","01a9ad9d":"I have used the best indices provided from above experiment to prepare my model for final submission","f7d9155c":"We use LabelEncoder to encode the string columns present in our dataset. and store respective encoders for each column into a dictionary so that it can be used in test data also.","d1cc417a":"converting classes back to there respective encoded values using LabelEncoders we trained before.","458dfe69":"Importing All useful Libraries","b99ce266":"## Submission Time","153d1e88":"Now comes the main model part.\nI have implemented 5 kfold ,to examine my model performance.","d1e05cc2":"We see that we have some Nan values in repective columns , so as test data also contains anatom_site_general_challenge wit some nan values ,hence we fill a new class into these nan positions and drop records where age or sex are provided as nan.","7ebf378a":"With this code , i was able to achieve 0.7 score on public leaderboard.\nI know this is not much to be used , but atleast it can be useful for some one.\n\nWill be updating this notebook after hyperparameter tuning .\n\nKindly comment if you like or dislike something in this notebook, and if you lked please upvote it too.\nand also do share some suggestions which can be used to improve it.\n\nThank You."}}