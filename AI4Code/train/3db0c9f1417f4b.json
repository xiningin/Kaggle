{"cell_type":{"14f6e320":"code","3c280c0e":"code","c14d39d3":"code","002f98df":"code","578cb2f3":"code","a374c089":"code","6dfce26e":"code","eea438ec":"code","e15d98d4":"code","992762f1":"code","2e163201":"code","7cf331a2":"code","ea9d0a1a":"code","b068dce7":"code","622dc97a":"code","3f96d2ff":"code","2d59e368":"code","18ff64e5":"code","1481571e":"code","49dd0d06":"code","2b6eb470":"code","110331ae":"code","a1400d7d":"code","789a1362":"code","504f7610":"code","6df51e9d":"code","c98e2f5d":"code","5750a53c":"code","dd59750e":"code","13ea15a3":"code","f089e4da":"code","7c7ea03c":"code","95bf1141":"code","b91d9fb8":"markdown","29256a60":"markdown","326ac90e":"markdown","8c9f3345":"markdown","5bc8f17b":"markdown","51592bc1":"markdown","98390c82":"markdown","f55f4f26":"markdown","35208fb7":"markdown","d4f35bbc":"markdown","bc91be72":"markdown","ee00f9a1":"markdown","5aa55298":"markdown"},"source":{"14f6e320":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport statsmodels.formula.api as sm\n\n\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns               # Provides a high level interface for drawing attractive and informative statistical graphics\n%matplotlib inline\nsns.set()\nfrom subprocess import check_output\n\nimport warnings                                            # Ignore warning related to pandas_profiling\nwarnings.filterwarnings('ignore') \n\ndef annot_plot(ax,w,h):                                    # function to add data to plot\n    ax.spines['top'].set_visible(False)\n    ax.spines['right'].set_visible(False)\n    for p in ax.patches:\n         ax.annotate(f\"{p.get_height() * 100 \/ df.shape[0]:.2f}%\", (p.get_x() + p.get_width() \/ 2., p.get_height()),\n         ha='center', va='center', fontsize=11, color='black', rotation=0, xytext=(0, 10),\n         textcoords='offset points')             \ndef annot_plot_num(ax,w,h):                                    # function to add data to plot\n    ax.spines['top'].set_visible(False)\n    ax.spines['right'].set_visible(False)\n    for p in ax.patches:\n        ax.annotate('{0:.1f}'.format(p.get_height()), (p.get_x()+w, p.get_height()+h))\n\nimport os\nprint(os.listdir(\"..\/input\"))\n","3c280c0e":"df = pd.read_csv('..\/input\/WA_Fn-UseC_-Marketing-Customer-Value-Analysis.csv')","c14d39d3":"df.shape","002f98df":"df.head()","578cb2f3":"\ndf['Engaged'] = df.Response.apply(lambda x: 0 if x =='No' else 1)","a374c089":"df.head()","6dfce26e":"\nengagement_rate_df = pd.DataFrame(df.groupby(by='Engaged').count()['Response'] \/ df.shape[0] * 100)\nengagement_rate_df","eea438ec":"engagement_rate_df.T","e15d98d4":"engagement_by_sales_channel_df = pd.pivot_table(df, values='Response', index='Sales Channel', columns='Engaged', aggfunc=len).fillna(0.0)\nengagement_by_sales_channel_df.columns = ['Not Engaged', 'Engaged']","992762f1":"engagement_by_sales_channel_df","2e163201":"engagement_by_sales_channel_df.plot(\n    kind='pie',\n    figsize=(15, 7),\n    startangle=90,\n    subplots=True,\n    autopct=lambda x: '%0.1f%%' % x\n)\n\nplt.show()","7cf331a2":"ax = df[['Engaged', 'Total Claim Amount']].boxplot(by='Engaged', showfliers=False, figsize=(10,7))\n\nax.set_xlabel('Engaged')\nax.set_ylabel('Total Claim Amount')\nax.set_title('Total Claim Amount Distributions by Enagements')\n\nplt.suptitle(\"\")\nplt.show()\n","ea9d0a1a":"ax = df[['Engaged', 'Total Claim Amount']].boxplot(\n    by='Engaged',\n    showfliers=True,\n    figsize=(10,7)\n)\n\nax.set_xlabel('Engaged')\nax.set_ylabel('Total Claim Amount')\nax.set_title('Total Claim Amount Distributions by Enagements')\n\nplt.suptitle(\"\")\nplt.show()","b068dce7":"df.describe()\n","622dc97a":"df['Customer Lifetime Value'].dtype","3f96d2ff":"df['Income'].dtype","2d59e368":"continuous_vars = [\n                    'Customer Lifetime Value', 'Income', 'Monthly Premium Auto', \n                    'Months Since Last Claim', 'Months Since Policy Inception', \n                    'Number of Open Complaints', 'Number of Policies', \n                    'Total Claim Amount'\n                ]","18ff64e5":"\nlogit = sm.Logit(df['Engaged'], df[continuous_vars])","1481571e":"logit_fit = logit.fit()","49dd0d06":"logit_fit.summary()","2b6eb470":"gender_values, gender_labels = df['Gender'].factorize()\ndf['GenderFactorized'] = gender_values","110331ae":"gender_values","a1400d7d":"gender_labels","789a1362":"df","504f7610":"categories = pd.Categorical(df['Education'], categories=['High School or Below', 'Bachelor', 'College', 'Master', 'Doctor'])","6df51e9d":"df['EducationFactorized'] = categories.codes","c98e2f5d":"df.head()","5750a53c":"logit = sm.Logit(df['Engaged'], df[['GenderFactorized','EducationFactorized']])","dd59750e":"logit_fit = logit.fit()","13ea15a3":"logit_fit.summary()","f089e4da":"logit = sm.Logit(\n    df['Engaged'], \n    df[['Customer Lifetime Value',\n        'Income',\n        'Monthly Premium Auto',\n        'Months Since Last Claim',\n        'Months Since Policy Inception',\n        'Number of Open Complaints',\n        'Number of Policies',\n        'Total Claim Amount',\n        'GenderFactorized',\n        'EducationFactorized'\n    ]]\n)","7c7ea03c":"logit_fit = logit.fit()","95bf1141":"logit_fit.summary()","b91d9fb8":"# Engagement rate:\n\nThe first thing that we are going to look at is the aggregate engagement rate. This engagement rate is simply the percentage of customers that responded to the marketing calls.\n\n","29256a60":"Looking at this model output, we can see that\u00a0Income, Monthly Premium Auto, Months Since Last Claim, Months Since Policy Inception, and Number of Policies\u00a0variables have significant relationships with the output variable, Engaged. For example,\u00a0Number of Policies variable is significant and is negatively correlated with Engaged. This suggests that the more policies that the customers have, the less likely they are to respond to marketing calls. \n\n\n","326ac90e":"**Total claim amounts**\n\nThe last thing that we are going to look at before we dive into the regression analysis are the differences in the distributions of\u00a0Total Claim Amount between the engaged and non-engaged groups. We are going to visualize this by using box plots.","8c9f3345":"**Sales Channels**\n\nNow, let's see whether we can find any noticeable patterns in the sales channel and engagement. We are going to analyze how the engaged and non-engaged customers are distributed among different sales channels\n\n","5bc8f17b":"**Categorical variables**","51592bc1":"**Regression Analysis with Both Continuous and Categorical Variables**","98390c82":"\nRefrence: https:\/\/www.amazon.com\/Hands-Data-Science-Marketing-strategies\/dp\/1789346347\n\n**Importing libraries**\n\n\n","f55f4f26":"As you can see, about 14% of the customers have responded to marketing calls, and the remaining 86% of the customers have not responded.","35208fb7":"#  Data Loading","d4f35bbc":"#  Exploratory Data Analysis:\nBefore we dive into regression analysis, we will first take a more detailed look at the data, in order to have a better understanding of what data points we have and what patterns we can see in the data. If you look at the data, you will notice a column named Response. It contains information on whether a customer responded to marketing calls. We will use this field as a measure of customer engagement. For future computations, it will be better to encode this field with numerical values\n","bc91be72":"As you have noticed in the previous section, there are significantly more customers that are not engaged with the marketing efforts, so it is quite difficult to look at the differences in the sales channel distributions between the engaged and non-engaged customers from raw numbers. To make the differences more visually identifiable, we can build pie charts ","ee00f9a1":"So far, we have analyzed the types of fields that we have in the data and how the patterns differ between the engaged group and the non-engaged group. Now,We will first build a logistic regression model with continuous variables. ","5aa55298":"To make this easier to read, we can transpose the DataFrame, meaning that we can flip the rows and columns in the DataFrame. You can transpose a pandas DataFrame by using the\u00a0T attribute of a DataFrame\n\n"}}