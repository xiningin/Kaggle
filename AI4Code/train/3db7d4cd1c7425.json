{"cell_type":{"533e73c1":"code","965c6a92":"code","7f51b10a":"code","04942991":"code","f4df14a3":"code","73c7c143":"code","4b0e533b":"code","585a8ed3":"code","624ccec5":"code","c4981fc9":"code","18de30fd":"code","7b5535b5":"code","642d42c1":"code","7f969f8a":"code","3e69e0c1":"code","09586694":"code","b3b22b62":"code","00c7072b":"code","cd08c0e9":"code","6537dfd5":"code","451ec47d":"code","36aacbbb":"code","ee5bab45":"code","c54c8e3e":"code","e259f4bd":"code","bcf25335":"code","32c7b55f":"code","7eb0fae3":"code","c5993d15":"code","6ab75c7f":"code","52e57ddb":"code","bedc7f3b":"code","766ce17e":"code","a1888d76":"code","86bb9350":"code","003c4f30":"code","ba703fdc":"code","84afdcbf":"markdown","3608983b":"markdown","f75d3940":"markdown","2625dce2":"markdown","5309e348":"markdown","7bfb1213":"markdown","b4ec1087":"markdown","629efd22":"markdown","39255dae":"markdown","99cecb45":"markdown","10c5bfc2":"markdown","ff27c1c8":"markdown","22b17385":"markdown","2a96a919":"markdown","4705c097":"markdown","b3f260f9":"markdown","165f5501":"markdown","6a6cdf7c":"markdown","c1146b4b":"markdown","bc906b00":"markdown","177b4f7f":"markdown","c330bd7d":"markdown","2ce7c50d":"markdown","9e4a1f6a":"markdown","de544b9e":"markdown","0619c611":"markdown","f5d79c22":"markdown","33437afc":"markdown","919592e2":"markdown","d06c2917":"markdown","3e1f058a":"markdown","3d87820d":"markdown","f16b7851":"markdown","f51c975d":"markdown","85ecb978":"markdown","218d2a6a":"markdown","906c1278":"markdown","8c4743b4":"markdown","66dc8318":"markdown","8a1c8865":"markdown","f8744ae1":"markdown","02dc655c":"markdown","3f9c3a7f":"markdown","ec63c656":"markdown","1d723d28":"markdown","5d01f93b":"markdown","c2d66b25":"markdown","d916110f":"markdown"},"source":{"533e73c1":"import numpy as np \nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sn\nimport warnings\nwarnings.filterwarnings('ignore')\nimport os\nprint(os.listdir(\"..\/input\"))\n\n","965c6a92":"Bike_df=pd.read_csv(\"..\/input\/day.csv\")\nBike_df.shape\n","7f51b10a":"Bike_df.head(10)","04942991":"Bike_df.dtypes","f4df14a3":"#clean up attribute names\nBike_df.rename(columns={'instant':'rec_id',\n                        'dteday':'datetime',\n                        'holiday':'is_holiday',\n                        'workingday':'is_workingday',\n                       'weathersit':'weather_condition',\n                       'hum':'humidity',\n                       'mnth':'month',\n                       'cnt':'total_count',\n                       'yr':'year'},inplace=True)","73c7c143":"Bike_df.head(10)","4b0e533b":"#date time conversion\nBike_df['datetime']=pd.to_datetime(Bike_df.datetime)\n\n# Categorical variables\nBike_df['season']=Bike_df.season.astype('category')\nBike_df['is_holiday']=Bike_df.is_holiday.astype('category')\nBike_df['is_workingday']=Bike_df.is_workingday.astype('category')\nBike_df['weekday']=Bike_df.weekday.astype('category')\nBike_df['weather_condition']=Bike_df.weather_condition.astype('category')\nBike_df['month']=Bike_df.month.astype('category')\nBike_df['year']=Bike_df.year.astype('category')\n","585a8ed3":"#Descriptive statistics for each column\nnp.round(Bike_df.describe(),2)","624ccec5":"# Visualizing monthly raidershp counts across the seasons\nfig,ax=plt.subplots(figsize=(20,8))\nsn.pointplot(data=Bike_df[['month','total_count','season']],x='month',\n             y='total_count',\n             hue='season',ax=ax)\nax.set(title='Season wise montly distribution of raidership counts ')","c4981fc9":"fig,ax=plt.subplots(figsize=(20,8))\nsn.pointplot(data=Bike_df[['month','total_count','weekday']],x='month',y='total_count',\n            hue='weekday',ax=ax)\nax.set(title='Weekday wise monthly distribution of raidership counts')","18de30fd":"fig,ax=plt.subplots(figsize=(20,8))\nsn.barplot(data=Bike_df[['month','total_count']],x='month',y='total_count',ax=ax)\nax.set(title='Month-wise raidership distribution')","7b5535b5":"# Violin plot is used for Year-wise distribution\nfig,ax=plt.subplots(figsize=(20,8))\nsn.violinplot(data=Bike_df[['year','total_count']],x='year',y='total_count',ax=ax)\nax.set(title='Year-wise distribution of raidership counts')\n","642d42c1":"fig,(ax1,ax2)=plt.subplots(ncols=2,figsize=(20,8))\nsn.boxplot(data=Bike_df[['total_count','casual','registered']],ax=ax1)\nsn.boxplot(data=Bike_df[['temp','windspeed','humidity']],ax=ax2)","7f969f8a":"# Correlation matrix to find correlations between data attributes\nCorrMat=Bike_df[['temp','atemp','humidity','windspeed',\n                 'casual','registered','total_count']].corr()\nmask=np.array(CorrMat)\nmask[np.tril_indices_from(mask)]=False\n#Heat map to plot the Correlation matrix\nfig,ax=plt.subplots(figsize=(20,8))\nsn.heatmap(CorrMat,mask=mask,\n          vmax=0.8,square=True,annot=True,ax=ax)","3e69e0c1":"from sklearn.model_selection import train_test_split\nX_train,X_test,y_train,y_test=train_test_split(Bike_df.iloc[:,0:-3],Bike_df.iloc[:,-1],\n                                  test_size=0.3, random_state=42)\n#Reset train index values\nX_train.reset_index(inplace=True)\ny_train=y_train.reset_index()\n# Reset train index values\nX_test.reset_index(inplace=True)\ny_test=y_test.reset_index()\n","09586694":"train_attributes=X_train[['season','month','year','weekday','is_holiday','is_workingday','weather_condition',\n                         'humidity','temp','windspeed']]\ntest_attributes=X_test[['season','month','year','weekday','is_holiday','is_workingday',\n                       'humidity','temp','windspeed','weather_condition']]\ncat_attributes=['season','is_holiday','is_workingday','weather_condition','year']\nnum_attributes=['temp','windspeed','humidity','month','weekday']","b3b22b62":"#Transform categorical Variables\nBike_train=pd.get_dummies(train_attributes,columns=cat_attributes)\nprint('Shape of transfomed dataframe::',Bike_train.shape)\nBike_train.head(5)\n","00c7072b":"X=Bike_train\ny=y_train.total_count.values","cd08c0e9":"from sklearn import linear_model\nlin_reg=linear_model.LinearRegression()\nlr_model=lin_reg.fit(X,y)\nprint('R-squared score for training dataset::',np.round(lr_model.score(X,y),3))\nprint('Model coefficients::',np.round(lr_model.coef_,3))\nprint('Model intercept value::',np.round(lr_model.intercept_,3))\n\n","6537dfd5":"# 3 fold cross validation (cv=3)\nfrom sklearn.model_selection import cross_val_predict,cross_val_score\npredicted=cross_val_predict(lr_model,X,y,cv=3)","451ec47d":"fig,ax=plt.subplots(figsize=(15,8))\nax.scatter(y,y-predicted)\nax.axhline(lw=2,color='black')\nax.set_title('Residual plot for Cross validation')\nax.set_xlabel('Observed')\nax.set_ylabel('Residual')\nplt.show()","36aacbbb":"#R-squared\nr2_score=cross_val_score(lr_model,X,y,cv=3)\nR2_score=np.average(r2_score)\nprint('R-squared Score for cross validation dataset::',np.round(R2_score,2))","ee5bab45":"# Tranform categorical data to numerical data for tesing dataset\nBike_test=pd.get_dummies(test_attributes,columns=cat_attributes)\nprint('Shape of transformed dataframe::',Bike_test.shape)\nBike_test.head(5)\n","c54c8e3e":"from sklearn.metrics import r2_score\n# Test dataset for model testing\nX_t=Bike_test\ny_t=y_test.total_count.values\n#predict the model performance\ny_pred=lr_model.predict(X_t)\nresiduals=y_t-y_pred\n#predicted score\nprint('R-squared score for testing dataset::',np.round(r2_score(y_t,y_pred),3))\n","e259f4bd":"fig,ax=plt.subplots(figsize=(15,8))\nax.scatter(y_t, residuals)\nax.axhline(lw=2,color='black')\nax.set_title('Residual plot for testing dataset')\nax.set_xlabel('Observed')\nax.set_ylabel('Resduals')\nplt.show()","bcf25335":"X_d=Bike_train\ny_d=y_train.total_count.values\nX_d.shape,y_d.shape","32c7b55f":"#Decision tree regressor\nfrom sklearn.tree import DecisionTreeRegressor\ndtr=DecisionTreeRegressor(max_depth=5,min_samples_split=8,max_leaf_nodes=40,min_samples_leaf=3)\ndtr.fit(X_d,y_d)\n","7eb0fae3":"print('R-squared score::',np.round(dtr.score(X_d,y_d),2))","c5993d15":"from sklearn import tree\nimport pydot\nimport graphviz\ndtr_data=tree.export_graphviz(dtr,out_file=None)\ndtr_graph=graphviz.Source(dtr_data)\ndtr_graph","6ab75c7f":"from sklearn.metrics import r2_score\n# Test dataset for model testing\nX_dt=Bike_test\ny_dt=y_test.total_count.values\n#predict the model performance\ny_dpred=dtr.predict(X_dt)\nresiduals=y_dt-y_dpred\n#predicted score\nprint('R-squared score for testing dataset::',np.round(r2_score(y_dt,y_dpred),3))","52e57ddb":"residuals=y_dt-y_dpred\nfig,ax=plt.subplots(figsize=(15,8))\nax.scatter(y_dt, residuals)\nax.axhline(lw=2,color='black')\nax.set_title('Residual plot for testing dataset')\nax.set_xlabel('Observed')\nax.set_ylabel('Resduals')\nplt.show()","bedc7f3b":"# Train dataset\nX_rf_tr=Bike_train\ny_rf_tr=y_train.total_count.values\nX_rf_tr.shape,y_rf_tr.shape","766ce17e":"#Test dataset\nX_rf_ts=Bike_test\ny_rf_ts=y_test.total_count.values\nX_rf_ts.shape,y_rf_ts.shape","a1888d76":"# import the model\nfrom sklearn.ensemble import RandomForestRegressor\n# Assign no. of decision trees = 1000\nrf=RandomForestRegressor(n_estimators=1000, random_state=42)\n# Train the model on the training data\nrf.fit(X_rf_tr,y_rf_tr)","86bb9350":"# R-squared score for trained data\nprint('R-squared score for trained dataset::',np.round(rf.score(X_rf_tr,y_rf_tr),3))","003c4f30":"#Use the forest's predict method\ny_pred_rf=rf.predict(X_rf_ts)\n\n# R-squared score for predictions\nprint('R-squared score for predictions::',np.round(r2_score(y_rf_ts,y_pred_rf),3))","ba703fdc":"#Dataframe for models\nModel = ['Linear Regression','Decision tree','Random Forest']\ndf1=pd.DataFrame(Model,columns=['Model'])\nR2_score = [0.846,0.84,0.897]\ndf2=pd.DataFrame(R2_score,columns=['R2_score'])\nModel_df=pd.merge(df1,df2,left_index=True,right_index=True)\nprint('Model evaluation on test data:\\n',Model_df)","84afdcbf":"\n**The Bike sharing platforms from across the world are hotspots of all sorts of data, ranging from travel time, start and end location,weather conditions,traffic , demographics of riders, and son on.\nThe bike sharing dataset which is used for current data analysis, contains bike sharing details with weather information.**","3608983b":"The R-squared score is 0.80,  which means the predictor is only able to explain 80% of the variance in the target variable. ","f75d3940":"**Final training dataset for building models**","2625dce2":"In above plots, the casual, windspeed, & humidity data shows the outliers.","5309e348":"\n\nLoad the day level data","7bfb1213":"Now, will predict our model performance for testing dataset","b4ec1087":"**Let's look at the distribution at year level**","629efd22":"Model performance on test dataset","39255dae":"**Linear Regression model**","99cecb45":"The above distribution shows the lowest raidership count for Spring season, then count increases in summer season.This count is constant throughout Rainy season.This count reaches peak at the start of winter season, then falls afterwards.","10c5bfc2":"From the R2_score, it is concluded that, the Random Forest based regression has higest score among all models. Hence, the Random Forest based Regression is best for predicting the Bike sharing demand.","ff27c1c8":"\n\nThe above distribution shows highest raidership counts for the month June-September & lowest count for January month.","22b17385":"**Model Evaluation**","2a96a919":"**Preprocessing**\n","4705c097":"**Random Forest based Regression**","b3f260f9":"Scatter plot to analyze our predictions","165f5501":"Next, we need to check what datatypes the pandas has inferred & if any of the features require data conversions.","6a6cdf7c":"**k-fold cross validation**\n","c1146b4b":"Evaluating the models to select best model for prediction","bc906b00":"The above plot is the the output correlation matrix (heatmap) showing values in lower triangular form\n> Keyponts from plot:\n*  Variables temp & atemp have strong correlation\n*  Variables humidity & windspeed have slight negative correlation .i.e, independent to each other\n*  Variables casual & registered have strong correlation to total_count\n\n","177b4f7f":"Our dataset contains **year** values **0** for representing **2011** and **2** for representing **2012**.","c330bd7d":"Let's test our model on un-seen dataset ( testing dataset)","2ce7c50d":"Train dataset for Decision tress based regression","9e4a1f6a":" Train & Test Datasets for Random Forest based regression","de544b9e":"**Season representations in above distribution,\n> 1- Spring season,\n> 2- Summer season,\n> 3- Rainy season,\n> 4- Winter season**","0619c611":"**Correlations**","f5d79c22":"The dataset after preprocessing is ready for visual inspection","33437afc":"Now, we check outliers in the dataset for better modeling & results.\n","919592e2":"**Modeling**","d06c2917":"\nThe above distribution clearly helps us to understand the multimodal distribution in both 2011 and 2012 raidership counts.The distribution for 2012 has peaks at highest values as compared with the distribution for 2011.","3e1f058a":"**Simlarly, will see the month-wise raidership distribution**","3d87820d":"Residual plot for testing dataset\n","f16b7851":"\nCorrelations help us to understand the relationship between different attributes of the data to build better models.","f51c975d":"Residual plot for test data","85ecb978":"From the R-squared score, it is evedent that,the Decision tree based regression model permance is comparable with linear regression model.","218d2a6a":"\n\nThe dataset contains 731 observations with 16 attributes. Let's check top few rows to see how the data looks.","906c1278":"The bike sharing dataset contains hour level and day level data. The day level data is considered for the current data analysis.","8c4743b4":"Plot the learnt model","66dc8318":"The attribute **dteday** would require type conversion from **object** or **string** type to **timestamp**. Attributes like season, holiday, workingday, & so on are require type conversion from **integer** to **categorical** for proper understanding.\nTo make the data more understandable, clean up the attribute names.","8a1c8865":"**Similarly, will see the weekday wise distribution of raidership counts.**","f8744ae1":"In above distribution,\n> year 0 - 2011 ,\n> year 1 - 2012","02dc655c":"Making predictions on the test dataset\n","3f9c3a7f":"**Model Testing**","ec63c656":"\nNow, let's jump into modeling.","1d723d28":"Although the linear regression model is performing equally on both training & testing datasets, the model is unable to model the data to generate decent results due to non-linearty & other factors.","5d01f93b":"Split the dataset into training (70%) & testing(30%) sets to evaluate the performance of models","c2d66b25":"**R-squared score or Coefficient of determination to measure model performance for cross validation**","d916110f":"**Decision tree based Regression**"}}