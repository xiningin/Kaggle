{"cell_type":{"57de0011":"code","a89a6231":"markdown"},"source":{"57de0011":"'''\nSolve system of non-linear equations to determine exact weights after probing\n'''\n\nimport numpy as np\nfrom scipy.optimize import fsolve\n\n# Class probing results and name for the weight var in fsolve below\ncd = {\n    '99' : (30.701, 'a'),\n    '95' : (32.620, 'b'),\n    '92' : (32.620, 'c'),\n    '90' : (32.620, 'd'),\n    '88' : (32.620, 'e'),\n    '67' : (32.620, 'f'),\n    '65' : (32.620, 'g'),\n    '64' : (30.692, 'h'),\n    '62' : (32.620, 'i'),\n    '53' : (32.622, 'j'),\n    '52' : (32.620, 'k'),\n    '42' : (32.620, 'l'),\n    '16' : (32.620, 'm'),\n    '15' : (30.702, 'n'),\n    '6' : (32.620, 'o'),\n}\n\n# Build non-linear system of equations expression\nfinal_str = ''\nfor i, (v, var) in enumerate(cd.values()):\n    sum_except = ''\n    sum_all = ''\n    for j, (v2, var2) in enumerate(cd.values()):\n        sum_all += var2\n        if j != i:\n            sum_except += var2\n        else:\n            sum_except += '0'\n        if j < len(cd.values()) - 1:\n            sum_all += ' + '\n            sum_except += ' + '\n    final_str = final_str + f'{-np.log(1e-15)} * ({sum_except}) \/ ({sum_all}) - {str(v)},'\n\n#print(final_str)\n\n# Solve non-linear system of eqs\ndef eqs(aa):\n    a, b, c, d, e, f, g, h, i, j, k, l, m, n, o = aa\n    return (eval(final_str))\n\nres = fsolve(eqs, np.ones(15))\n\n# Normalize weights for convenience\nres = res \/ np.min(res)\n\n# Print exact weights\nfor _class, weight in zip(cd.keys(), res):\n    print(f'Weight for class {_class} = {weight:.5f}')","a89a6231":"Small script to calculate exact class weights using probing results from :  https:\/\/www.kaggle.com\/c\/PLAsTiCC-2018\/discussion\/67194 "}}