{"cell_type":{"eaee45a0":"code","df088af8":"code","da28b674":"code","17164b4b":"code","f5e33d1f":"code","e5c6d616":"code","b6fdf3eb":"code","f9932b9a":"code","29af305f":"code","c7ff65c3":"code","cf963658":"code","83053073":"code","60854af7":"code","e9a60eb6":"code","ed5ae8f5":"code","1a3e6144":"code","15a59014":"code","a52393e8":"code","11acc8a6":"code","ccec178e":"code","8aeb1a38":"code","d2e05d9c":"code","d680e222":"code","9d60fe92":"code","25f7215a":"code","358e265a":"code","311c171d":"code","69ead834":"code","fa55e937":"code","596e8c7a":"code","05d9aaba":"code","06c80c25":"code","44233f9a":"code","71e32309":"code","d2868dba":"code","da978663":"markdown","ee739e2e":"markdown","33a1d2b2":"markdown","a832be4b":"markdown","53566ddb":"markdown","d7d4d382":"markdown","9ef6fcf7":"markdown","6a72d27a":"markdown"},"source":{"eaee45a0":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","df088af8":"# DataFrame\nimport pandas as pd\n\n# Matplot\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\n# Scikit-learn\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.metrics import confusion_matrix, classification_report, accuracy_score\nfrom sklearn.manifold import TSNE\nfrom sklearn.feature_extraction.text import TfidfVectorizer\n\n# Keras\nfrom keras.preprocessing.text import Tokenizer\nfrom keras.preprocessing.sequence import pad_sequences\nfrom keras.models import Sequential\nfrom keras.layers import Activation, Dense, Dropout, Embedding, Flatten, Conv1D, MaxPooling1D, LSTM\nfrom keras import utils\nfrom keras.callbacks import ReduceLROnPlateau, EarlyStopping\n\n# nltk\nimport nltk\nfrom nltk.corpus import stopwords\nfrom  nltk.stem import SnowballStemmer\n\n# Word2vec\nimport gensim\n\n# Utility\nimport re\nimport numpy as np\nimport os\nfrom collections import Counter\nimport logging\nimport time\nimport pickle\nimport itertools\n\n# Set log\nlogging.basicConfig(format='%(asctime)s : %(levelname)s : %(message)s', level=logging.INFO)","da28b674":"nltk.download('stopwords')","17164b4b":"# DATASET\n#DATASET_COLUMNS = [\"textID\", \"text\", \"selected_text\", \"sentiment\"]\nDATASET_ENCODING = \"ISO-8859-1\"\nTRAIN_SIZE = 0.8\n\n# TEXT CLENAING\nTEXT_CLEANING_RE = \"@\\S+|https?:\\S+|http?:\\S|[^A-Za-z0-9]+\"\n\n# WORD2VEC \nW2V_SIZE = 300\nW2V_WINDOW = 7\nW2V_EPOCH = 32\nW2V_MIN_COUNT = 10\n\n# KERAS\nSEQUENCE_LENGTH = 300\nEPOCHS = 8\nBATCH_SIZE = 1024\n\n# SENTIMENT\nPOSITIVE = \"POSITIVE\"\nNEGATIVE = \"NEGATIVE\"\nNEUTRAL = \"NEUTRAL\"\nSENTIMENT_THRESHOLDS = (0.4, 0.7)\n\n# EXPORT\nKERAS_MODEL = \"model.h5\"\nWORD2VEC_MODEL = \"model.w2v\"\nTOKENIZER_MODEL = \"tokenizer.pkl\"\nENCODER_MODEL = \"encoder.pkl\"","f5e33d1f":"dataset_filename = \"\/kaggle\/input\/tweet-sentiment-extraction\/train.csv\"\ntest = \"\/kaggle\/input\/tweet-sentiment-extraction\/test.csv\"\nsub_sample = \"\/kaggle\/input\/tweet-sentiment-extraction\/sample_submission.csv\"\ndataset_path = os.path.join(\"..\",\"\/kaggle\/input\",dataset_filename)\ntest_path = os.path.join(\"..\",\"\/kaggle\/input\",test)\nsub_path = os.path.join(\"..\",\"\/kaggle\/input\",sub_sample)\nprint(\"Open file:\", dataset_path)\nprint(\"Open file:\", test)\nprint(\"Open file:\", sub_sample)\ndf = pd.read_csv(dataset_path, encoding =DATASET_ENCODING , engine = 'python')\ntest_df = pd.read_csv(test, encoding =DATASET_ENCODING, engine = 'python')\nsubmission = pd.read_csv(sub_path)","e5c6d616":"print(\"Dataset size:\", len(df))","b6fdf3eb":"df.head(5)","f9932b9a":"target_cnt = Counter(df.sentiment)\n\nplt.figure(figsize=(16,8))\nplt.bar(target_cnt.keys(), target_cnt.values())\nplt.title(\"Dataset labels distribuition\")","29af305f":"stop_words = stopwords.words(\"english\")\nstemmer = SnowballStemmer(\"english\")","c7ff65c3":"def preprocess(text, stem=False):\n    # Remove link,user and special characters\n    text = re.sub(TEXT_CLEANING_RE, ' ', str(text).lower()).strip()\n    tokens = []\n    for token in text.split():\n        if token not in stop_words:\n            if stem:\n                tokens.append(stemmer.stem(token))\n            else:\n                tokens.append(token)\n    return \" \".join(tokens)","cf963658":"%%time\ndf.text = df.text.apply(lambda x: preprocess(x))\ndf.selected_text = df.selected_text.apply(lambda x: preprocess(x))","83053073":"print(\"TRAIN size:\", len(df))\nprint(\"TEST size:\", len(test_df))","60854af7":"%%time\ndocuments = [_text.split() for _text in df.text]\ndocuments1 = [_text.split() for _text in df.selected_text]","e9a60eb6":"w2v_model = gensim.models.word2vec.Word2Vec(size=W2V_SIZE, \n                                            window=W2V_WINDOW, \n                                            min_count=W2V_MIN_COUNT, \n                                            workers=8)","ed5ae8f5":"w2v_model.build_vocab(documents)","1a3e6144":"words = w2v_model.wv.vocab.keys()\nvocab_size = len(words)\nprint(\"Vocab size\", vocab_size)","15a59014":"%%time\nw2v_model.train(documents, total_examples=len(documents), epochs=W2V_EPOCH)","a52393e8":"w2v_model.most_similar(\"love\")","11acc8a6":"%%time\ntokenizer = Tokenizer()\ntokenizer.fit_on_texts(df.text)\n\nvocab_size = len(tokenizer.word_index) + 1\nprint(\"Total words\", vocab_size)","ccec178e":"%%time\ntrain = pad_sequences(tokenizer.texts_to_sequences(df.text), maxlen=SEQUENCE_LENGTH)\ntest = pad_sequences(tokenizer.texts_to_sequences(test_df.text), maxlen=SEQUENCE_LENGTH)","8aeb1a38":"labels = df.sentiment.unique().tolist()\n#labels.append(NEUTRAL)\nlabels","d2e05d9c":"encoder = LabelEncoder()\nencoder.fit(df.sentiment.tolist())\n\ny_train = encoder.transform(df.sentiment.tolist())\ny_test = encoder.transform(test_df.sentiment.tolist())\n\ny_train = y_train.reshape(-1,1)\ny_test = y_test.reshape(-1,1)\n\nprint(\"y_train\",y_train.shape)\nprint(\"y_test\",y_test.shape)","d680e222":"print(\"train\", train.shape)\nprint(\"y_train\", y_train.shape)\nprint()\nprint(\"test\", test_df.shape)\nprint(\"y_test\", y_test.shape)","9d60fe92":"y_train[:10]","25f7215a":"embedding_matrix = np.zeros((vocab_size, W2V_SIZE))\n\nfor word, i in tokenizer.word_index.items():\n    \n      if word in w2v_model.wv:\n        embedding_matrix[i] = w2v_model.wv[word]\nprint(embedding_matrix.shape)","358e265a":"embedding_layer = Embedding(vocab_size, W2V_SIZE, weights=[embedding_matrix], input_length= 300, trainable=False)","311c171d":"model = Sequential()\nmodel.add(embedding_layer)\nmodel.add(Dropout(0.5))\nmodel.add(LSTM(200, dropout=0.2, recurrent_dropout=0.2))\nmodel.add(Dense(3, activation='softmax'))\n\nmodel.summary()","69ead834":"model.compile(loss='sparse_categorical_crossentropy',\n              optimizer=\"adam\",\n              metrics=['accuracy'])","fa55e937":"callbacks = [ ReduceLROnPlateau(monitor='val_loss', patience=5, cooldown=0),\n              EarlyStopping(monitor='val_acc', min_delta=1e-4, patience=5)]","596e8c7a":"%%time\nhistory = model.fit(train, y_train,\n                    batch_size=BATCH_SIZE,\n                    epochs=EPOCHS,\n                    validation_split=0.1,\n                    verbose=1,\n                    callbacks=callbacks)","05d9aaba":"%%time\nscore = model.evaluate(test, y_test, batch_size=BATCH_SIZE)\nprint()\nprint(\"ACCURACY:\",score[1])\nprint(\"LOSS:\",score[0])","06c80c25":"acc = history.history['accuracy']\nval_acc = history.history['val_accuracy']\nloss = history.history['loss']\nval_loss = history.history['val_loss']\n \nepochs = range(len(acc))\n \nplt.plot(epochs, acc, 'b', label='Training acc')\nplt.plot(epochs, val_acc, 'r', label='Validation acc')\nplt.title('Training and validation accuracy')\nplt.legend()\n \nplt.figure()\n \nplt.plot(epochs, loss, 'b', label='Training loss')\nplt.plot(epochs, val_loss, 'r', label='Validation loss')\nplt.title('Training and validation loss')\nplt.legend()\n \nplt.show()","44233f9a":"def decode_sentiment(score, include_neutral=True):\n    if include_neutral:        \n        label = NEUTRAL\n        if score <= SENTIMENT_THRESHOLDS[0]:\n            label = NEGATIVE\n        elif score >= SENTIMENT_THRESHOLDS[1]:\n            label = POSITIVE\n\n        return label\n    else:\n        return NEGATIVE if score < 0.5 else POSITIVE     ","71e32309":"def predict(text, include_neutral=True):\n    start_at = time.time()\n    # Tokenize text\n    x_test = pad_sequences(tokenizer.texts_to_sequences([text]), maxlen=SEQUENCE_LENGTH)\n    # Predict\n    score = model.predict([x_test])[0]\n    #print(score)\n    # Decode sentiment\n    label = decode_sentiment(score, include_neutral=include_neutral)\n\n    return {\"label\": label, \"score\": float(score),\n       \"elapsed_time\": time.time()-start_at}  ","d2868dba":"predict(\"I love the music\")","da978663":"### Evaluation","ee739e2e":"## Next : Submission report, classification report and Evaluation Metrices","33a1d2b2":"### Tokenization","a832be4b":"## Word2Vec","53566ddb":"## Data Cleaning","d7d4d382":"## Embedding Layer","9ef6fcf7":"## Prediction","6a72d27a":"### Label Encoder"}}