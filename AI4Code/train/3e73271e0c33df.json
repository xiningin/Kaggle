{"cell_type":{"21cd0ce3":"code","ab981c83":"code","561c1a08":"code","f61b05dc":"code","5cfb5c91":"code","858819d7":"code","85842183":"code","6772fccd":"code","a8364dc9":"code","b1986fc2":"code","2273294c":"code","06cb2de9":"code","6d2d8644":"code","8b757d2e":"code","736f3746":"code","c475b036":"code","c6c6eec1":"code","44773cb1":"code","f99426aa":"code","6ff4c012":"code","50a4e155":"code","fce5239c":"code","8fcd2a79":"code","3338b6cc":"code","0978370a":"code","68baff1a":"code","91a178a2":"code","ccaa6eb9":"code","db0c0979":"code","c03f2d6e":"code","de912c17":"code","21e5403a":"code","0dfb55ed":"code","dc3bd757":"code","a1047038":"code","1df31fb8":"code","e863cf4a":"code","119742a5":"code","3d307b6c":"code","7351c80f":"code","e43a3685":"code","3682ae32":"code","9806d789":"code","6b7948bb":"code","806aa849":"code","d4677a75":"code","4caa5c27":"code","de345881":"code","460840e7":"code","018042b6":"code","33438583":"code","c666b29b":"code","9c18a341":"code","6b0f9ac0":"code","8f135551":"code","9bf577c9":"code","297ac300":"code","e8da5b92":"code","53bcac98":"code","60805df7":"code","2cceb654":"code","acba8dc7":"code","897c0058":"code","4427cb90":"code","6dbbe5f3":"code","dcf5269d":"code","7f4b540d":"code","1b61bcf4":"code","2d99dc6b":"code","80e0892b":"markdown","dba73376":"markdown","081d62e4":"markdown","fd65da62":"markdown","bed5da0a":"markdown","6d3a8d49":"markdown","ff486049":"markdown","6bd70bd6":"markdown","20a14308":"markdown","728c9e06":"markdown","f1ca5317":"markdown","fc606070":"markdown","438cba69":"markdown","a8e619f2":"markdown","7a9f801a":"markdown","722ba2ac":"markdown","1bd85b3c":"markdown","1b56b8ca":"markdown","da1f5724":"markdown","56026dbc":"markdown","a3a8dc28":"markdown","ef3aff33":"markdown","e6656815":"markdown","2e794abc":"markdown","e22b7507":"markdown","5fb14838":"markdown","992dfdc6":"markdown","39b8dae9":"markdown","26e53943":"markdown","12874377":"markdown","44b2af01":"markdown"},"source":{"21cd0ce3":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\nimport warnings\nwarnings.filterwarnings('ignore')\n\nfrom sklearn.model_selection import KFold\nfrom sklearn.model_selection import train_test_split \nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.preprocessing import StandardScaler\n\nfrom sklearn.linear_model import LinearRegression \nfrom sklearn.linear_model import Lasso\nfrom sklearn.linear_model import Ridge\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.linear_model import ElasticNet\n\nfrom sklearn import metrics\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn.model_selection import cross_val_score\n\nfrom scipy import stats","ab981c83":"#Reading Dataset\ndf = pd.read_csv('..\/input\/nyc-rolling-sales.csv')","561c1a08":"# Little peek into the dataset\ndf.head()","f61b05dc":"#Dropping column as it is empty\ndel df['EASE-MENT']\n#Dropping as it looks like an iterator\ndel df['Unnamed: 0']\n\ndel df['SALE DATE']","5cfb5c91":"#Checking for duplicated entries\nsum(df.duplicated(df.columns))","858819d7":"#Delete the duplicates and check that it worked\ndf = df.drop_duplicates(df.columns, keep='last')\nsum(df.duplicated(df.columns))","85842183":"#shape of dataset\ndf.shape","6772fccd":"#Description of every column\ndf.info()","a8364dc9":"#Let's convert some of the columns to appropriate datatype\n\ndf['TAX CLASS AT TIME OF SALE'] = df['TAX CLASS AT TIME OF SALE'].astype('category')\ndf['TAX CLASS AT PRESENT'] = df['TAX CLASS AT PRESENT'].astype('category')\ndf['LAND SQUARE FEET'] = pd.to_numeric(df['LAND SQUARE FEET'], errors='coerce')\ndf['GROSS SQUARE FEET']= pd.to_numeric(df['GROSS SQUARE FEET'], errors='coerce')\n#df['SALE DATE'] = pd.to_datetime(df['SALE DATE'], errors='coerce')\ndf['SALE PRICE'] = pd.to_numeric(df['SALE PRICE'], errors='coerce')\ndf['BOROUGH'] = df['BOROUGH'].astype('category')","b1986fc2":"#checking missing values\n\ndf.columns[df.isnull().any()]","2273294c":"miss=df.isnull().sum()\/len(df)\nmiss=miss[miss>0]\nmiss.sort_values(inplace=True)\nmiss","06cb2de9":"miss=miss.to_frame()\nmiss.columns=['count']\nmiss.index.names=['Name']\nmiss['Name']=miss.index\nmiss","6d2d8644":"#plot the missing values\nsns.set(style='whitegrid',color_codes=True)\nsns.barplot(x='Name', y='count',data=miss)\nplt.xticks(rotation=90)\nsns","8b757d2e":"# For time being, let's fill these up with mean values.\ndf['LAND SQUARE FEET']=df['LAND SQUARE FEET'].fillna(df['LAND SQUARE FEET'].mean())\ndf['GROSS SQUARE FEET']=df['GROSS SQUARE FEET'].fillna(df['GROSS SQUARE FEET'].mean())","736f3746":"# Splitting dataset \ntest=df[df['SALE PRICE'].isna()]\ndata=df[~df['SALE PRICE'].isna()]","c475b036":"test = test.drop(columns='SALE PRICE')","c6c6eec1":"# Print first 5 rows of test\nprint(test.shape)\ntest.head()","44773cb1":"#Printing first rows of our data\nprint(data.shape)\ndata.head(10)","f99426aa":"#correlation between the features\ncorr = data.corr()\nsns.heatmap(corr)","6ff4c012":"#numeric correlation\ncorr['SALE PRICE'].sort_values(ascending=False)","50a4e155":"numeric_data=data.select_dtypes(include=[np.number])\nnumeric_data.describe()","fce5239c":"plt.figure(figsize=(15,6))\n\nsns.boxplot(x='SALE PRICE', data=data)\nplt.ticklabel_format(style='plain', axis='x')\nplt.title('Boxplot of SALE PRICE in USD')\nplt.show()","8fcd2a79":"sns.distplot(data['SALE PRICE'])","3338b6cc":"# Remove observations that fall outside those caps\ndata = data[(data['SALE PRICE'] > 100000) & (data['SALE PRICE'] < 5000000)]","0978370a":"sns.distplot(data['SALE PRICE'])","68baff1a":"#skewness of SalePrice\ndata['SALE PRICE'].skew()","91a178a2":"sales=np.log(data['SALE PRICE'])\nprint(sales.skew())\nsns.distplot(sales)","ccaa6eb9":"plt.figure(figsize=(10,6))\nsns.boxplot(x='GROSS SQUARE FEET', data=data,showfliers=False)","db0c0979":"plt.figure(figsize=(10,6))\nsns.boxplot(x='LAND SQUARE FEET', data=data,showfliers=False)","c03f2d6e":"data = data[data['GROSS SQUARE FEET'] < 10000]\ndata = data[data['LAND SQUARE FEET'] < 10000]","de912c17":"plt.figure(figsize=(10,6))\nsns.regplot(x='GROSS SQUARE FEET', y='SALE PRICE', data=data, fit_reg=False, scatter_kws={'alpha':0.3})","21e5403a":"plt.figure(figsize=(10,6))\nsns.regplot(x='LAND SQUARE FEET', y='SALE PRICE', data=data, fit_reg=False, scatter_kws={'alpha':0.3})","0dfb55ed":"data[[\"TOTAL UNITS\", \"SALE PRICE\"]].groupby(['TOTAL UNITS'], as_index=False).count().sort_values(by='SALE PRICE', ascending=False)","dc3bd757":"data = data[(data['TOTAL UNITS'] > 0) & (data['TOTAL UNITS'] != 2261)] ","a1047038":"plt.figure(figsize=(10,6))\nsns.boxplot(x='TOTAL UNITS', y='SALE PRICE', data=data)\nplt.title('Total Units vs Sale Price')\nplt.show()","1df31fb8":"plt.figure(figsize=(10,6))\nsns.boxplot(x='COMMERCIAL UNITS', y='SALE PRICE', data=data)\nplt.title('Commercial Units vs Sale Price')\nplt.show()","e863cf4a":"plt.figure(figsize=(10,6))\nsns.boxplot(x='RESIDENTIAL UNITS', y='SALE PRICE', data=data)\nplt.title('Residential Units vs Sale Price')\nplt.show()","119742a5":"cat_data=data.select_dtypes(exclude=[np.number])\ncat_data.describe()","3d307b6c":"# Starting with TAX CLASS AT PRESENT\ndata['TAX CLASS AT PRESENT'].unique()","7351c80f":"pivot=data.pivot_table(index='TAX CLASS AT PRESENT', values='SALE PRICE', aggfunc=np.median)\npivot","e43a3685":"pivot.plot(kind='bar', color='black')","3682ae32":"#  TAX CLASS AT TIME OF SALE\ndata['TAX CLASS AT TIME OF SALE'].unique()","9806d789":"pivot=data.pivot_table(index='TAX CLASS AT TIME OF SALE', values='SALE PRICE', aggfunc=np.median)\npivot","6b7948bb":"pivot.plot(kind='bar', color='red')","806aa849":"# BOROUGH\ndata['BOROUGH'].unique()","d4677a75":"pivot=data.pivot_table(index='BOROUGH', values='SALE PRICE', aggfunc=np.median)\npivot","4caa5c27":"pivot.plot(kind='bar', color='blue')","de345881":"# BUILDING CLASS CATEGORY\nprint(data['BUILDING CLASS CATEGORY'].nunique())\n\npivot=data.pivot_table(index='BUILDING CLASS CATEGORY', values='SALE PRICE', aggfunc=np.median)\npivot","460840e7":"pivot.plot(kind='bar', color='Green')","018042b6":"del data['ADDRESS']\ndel data['APARTMENT NUMBER']","33438583":"data.info()","c666b29b":"numeric_data.columns","9c18a341":"#transform the numeric features using log(x + 1)\nfrom scipy.stats import skew\nskewed = data[numeric_data.columns].apply(lambda x: skew(x.dropna().astype(float)))\nskewed = skewed[skewed > 0.75]\nskewed = skewed.index\ndata[skewed] = np.log1p(data[skewed])","6b0f9ac0":"\nscaler = StandardScaler()\nscaler.fit(data[numeric_data.columns])\nscaled = scaler.transform(data[numeric_data.columns])\n\nfor i, col in enumerate(numeric_data.columns):\n       data[col] = scaled[:,i]","8f135551":"data.head()","9bf577c9":"#Dropping few columns\ndel data['BUILDING CLASS AT PRESENT']\ndel data['BUILDING CLASS AT TIME OF SALE']\ndel data['NEIGHBORHOOD']","297ac300":"#Select the variables to be one-hot encoded\none_hot_features = ['BOROUGH', 'BUILDING CLASS CATEGORY','TAX CLASS AT PRESENT','TAX CLASS AT TIME OF SALE']\n","e8da5b92":"# Convert categorical variables into dummy\/indicator variables (i.e. one-hot encoding).\none_hot_encoded = pd.get_dummies(data[one_hot_features])\none_hot_encoded.info(verbose=True, memory_usage=True, null_counts=True)","53bcac98":"# Replacing categorical columns with dummies\nfdf = data.drop(one_hot_features,axis=1)\nfdf = pd.concat([fdf, one_hot_encoded] ,axis=1)","60805df7":"fdf.info()","2cceb654":"Y_fdf = fdf['SALE PRICE']\nX_fdf = fdf.drop('SALE PRICE', axis=1)\n\nX_fdf.shape , Y_fdf.shape","acba8dc7":"X_train ,X_test, Y_train , Y_test = train_test_split(X_fdf , Y_fdf , test_size = 0.3 , random_state =34)","897c0058":"# Training set\nX_train.shape , Y_train.shape","4427cb90":"#Testing set\nX_test.shape , Y_test.shape","6dbbe5f3":"# RMSE\ndef rmse(y_test,y_pred):\n      return np.sqrt(mean_squared_error(y_test,y_pred))","dcf5269d":"linreg = LinearRegression()\nlinreg.fit(X_train, Y_train)\nY_pred_lin = linreg.predict(X_test)\nrmse(Y_test,Y_pred_lin)","7f4b540d":"alpha=0.00099\nlasso_regr=Lasso(alpha=alpha,max_iter=50000)\nlasso_regr.fit(X_train, Y_train)\nY_pred_lasso=lasso_regr.predict(X_test)\nrmse(Y_test,Y_pred_lasso)","1b61bcf4":"ridge = Ridge(alpha=0.01, normalize=True)\nridge.fit(X_train, Y_train)\nY_pred_ridge = ridge.predict(X_test)\nrmse(Y_test,Y_pred_ridge)","2d99dc6b":"rf_regr = RandomForestRegressor()\nrf_regr.fit(X_train, Y_train)\nY_pred_rf = rf_regr.predict(X_test)\nrmse(Y_test,Y_pred_rf)","80e0892b":"**One hot encoding categorical columns**","dba73376":"Last row represents the correlation of different features with SALE PRICE","081d62e4":"Removing rows with TOTAL UNITS == 0 and one outlier with 2261 units","fd65da62":"### 4.4. RandomForest Regressor","bed5da0a":"**TAX CLASS AT TIME OF SALE**","6d3a8d49":"### 4.3. Ridge Regression","ff486049":"**Normalising and Transforming Numerical columns**","6bd70bd6":"# 5. Conclusion","20a14308":"Let's Check Again","728c9e06":"**BUILDING CLASS CATEGORY**","f1ca5317":"**SQUARE FEET**","fc606070":"## Train\/Test Split","438cba69":"**Let's see our dataset again**","a8e619f2":"**Let's Visualize Numerical data**","7a9f801a":"# 3. Data Pre Processing","722ba2ac":"### 4.1 Linear Regression","1bd85b3c":"SALE PRICE is highly right skewed. So, we will log transform it so that it give better results.","1b56b8ca":"# 4. Modelling","da1f5724":"# 1.Loading libraries and Dataset","56026dbc":"**We can see that Random Forest Regressor works best for this dataset with RSME score of 0.588**","a3a8dc28":"There are many missing values in the columns : \n* LAND SQUARE FEET\n* GROSS SQUARE FEET\n* SALE PRICE\n\nWe can drop the rows with missing values or we can fill them up with their mean, median or any other relation.\n\nFor time being, let's fill these up with mean values.<br>\nFurther, We will try to predict the value of SALE PRICE as test data.","ef3aff33":"**Total Units, Commercial Units, Residential Units**","e6656815":"***It means max sale price is of BOROUGH==1 that is Manhattan.***","2e794abc":"\n**SALE PRICE**","e22b7507":"**Please UPVOTE if found useful !**","5fb14838":"Well now we can see the symmetry and thus it is normalised.","992dfdc6":"# 2.Data Inspection & Visualization","39b8dae9":"**BOROUGH**","26e53943":"**TAX CLASS AT PRESENT**","12874377":"### 4.2. Lasso Regression","44b2af01":"**Let's Visualize categorical data**"}}