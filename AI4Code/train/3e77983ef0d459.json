{"cell_type":{"cae2a354":"code","bef39dbe":"code","f3791704":"code","e12c4442":"code","31950d44":"markdown"},"source":{"cae2a354":"import numpy as np, pandas as pd, os\nfrom sklearn.cross_decomposition import PLSRegression\nfrom sklearn.preprocessing import PolynomialFeatures\nfrom sklearn.model_selection import StratifiedKFold\nfrom sklearn.feature_selection import VarianceThreshold\nfrom sklearn.metrics import roc_auc_score\n\ntrain = pd.read_csv('..\/input\/train.csv')\ntest = pd.read_csv('..\/input\/test.csv')\n\ntrain.head()","bef39dbe":"# INITIALIZE VARIABLES\ncols = [c for c in train.columns if c not in ['id', 'target']]\ncols.remove('wheezy-copper-turtle-magic')\noof = np.zeros(len(train))\npreds = np.zeros(len(test))\n\n# BUILD 512 SEPARATE MODELS\nfor i in range(512):\n    # ONLY TRAIN WITH DATA WHERE WHEEZY EQUALS I\n    train2 = train[train['wheezy-copper-turtle-magic']==i]\n    test2 = test[test['wheezy-copper-turtle-magic']==i]\n    idx1 = train2.index; idx2 = test2.index\n    train2.reset_index(drop=True,inplace=True)\n    \n    \n    X_train = train2[cols].values\n    X_test = test2[cols].values\n    \n    poly = PolynomialFeatures(2)\n    X_train = poly.fit_transform(X_train)\n    X_test = poly.fit_transform(X_test)\n    \n    y_train = train2['target'].values\n    \n    # STRATIFIED K-FOLD\n    skf = StratifiedKFold(n_splits=11, random_state=42, shuffle=True)\n    for train_index, test_index in skf.split(X_train, y_train):\n        \n        # MODEL AND PREDICT WITH PLSR\n        clf = PLSRegression(copy=True, max_iter=10000, n_components=512, scale=True,\n        tol=3e-04)\n        clf.fit(X_train[train_index], y_train[train_index])\n        oof[idx1[test_index]] = np.hstack(clf.predict(X_train[test_index]))\n        preds[idx2] += np.hstack(clf.predict(X_test)) \/ skf.n_splits\n       \n    if i%16==0: print(i)\n        \n# PRINT CV AUC\nauc = roc_auc_score(train['target'],oof)\nprint('PLSR scores CV =',round(auc,5))","f3791704":"sub = pd.read_csv(\"..\/input\/sample_submission.csv\")\nsub[\"target\"] = preds\n\nsub.to_csv(\"submission.csv\",index=False)\n\nimport matplotlib.pyplot as plt\nplt.hist(preds,bins=100)\nplt.title(\"Final Test.csv predictions\")\nplt.show()","e12c4442":"sub.head(10)","31950d44":"# remark"}}