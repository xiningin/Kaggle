{"cell_type":{"c8d8e257":"code","7ddd4e23":"code","9aab6db1":"code","c42f7c7b":"code","6f281ba5":"code","0e7f8196":"code","6c6f2f3e":"code","2feb0d22":"code","29aae7ed":"code","7e5780b4":"code","c5c26b8c":"code","045c91c6":"code","2aef22ae":"code","2a65ea30":"code","2ddc1760":"code","1c7ed229":"code","f57f1d23":"code","abdb3c8a":"code","44549616":"code","afcb5fee":"code","586fa540":"code","253094ff":"code","471bc5b4":"code","b37bbc6d":"code","b72efe90":"code","c5b952be":"code","0bb5fff3":"code","1f039336":"code","71359fa6":"code","31656561":"markdown","2fddef96":"markdown","f5d283f6":"markdown","3aca53ca":"markdown","970b1915":"markdown","b4a17199":"markdown","d494a4f9":"markdown","b0e70fd6":"markdown","0d8b2297":"markdown","732f986e":"markdown","7aecf4e4":"markdown","b904030a":"markdown","cf0cf95a":"markdown","286548bd":"markdown","88d69657":"markdown","f68ebf2d":"markdown","e314b6fc":"markdown","a2f1f22b":"markdown","ad7d21ff":"markdown","3b68e5a9":"markdown","4889b28b":"markdown","31d7f677":"markdown"},"source":{"c8d8e257":"# Required packages\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns","7ddd4e23":"# Importing dataset\nkchp=pd.read_csv('..\/input\/kc_house_data.csv')","9aab6db1":"# Viewing the first 5 rows of the dataset\nkchp.head()","c42f7c7b":"# Checking if there are any missing values\nkchp.isnull().sum()","6f281ba5":"# Information about the dataset\nkchp.info()","0e7f8196":"# Using the date column to obtain the year that the house was sold\nkchp['date']=kchp['date'].astype('str')\n\nfor i in range(len(kchp.index)):\n    kchp.loc[i,'date']=kchp.loc[i,'date'][0:4]\n    \nkchp['date']=kchp['date'].astype('int64')","6c6f2f3e":"# Renaming the column date as year_sold\nkchp.rename(columns={'date':'year_sold'},inplace=True)\n\n# If the sqft_living, sqft_living15 and sqft_lot, sqft_lot15 columns are not the same then it implies  \n# that the house has been renovated. A column renovated is created with 1 - renovated, 0 - not renovated\n# kchp.loc[:,['sqft_living','sqft_lot','sqft_living15','sqft_lot15','yr_renovated']].head(10)\nkchp['renovated']=np.where((kchp['sqft_living']!=kchp['sqft_living15'])|(kchp['sqft_lot']!=kchp['sqft_lot15']),1,0)\n# kchp.loc[:,['sqft_living','sqft_lot','sqft_living15','sqft_lot15','yr_renovated','renovated']].head(20)\n\n# The yr_renovated column has mostly 0 values and we have obtained the renovation information, so it is dropped\n# Columns id, sqft_living and sqft_lot won't be used, so they are dropped as well\nkchp.drop(['id','sqft_living','sqft_lot','yr_renovated'],axis=1,inplace=True)\n\n# The age of the buidlding at the time it is sold is added as a new column\nkchp['age_of_building']=kchp['year_sold']-kchp['yr_built']\n\n# Column yr_built is now  dropped since column age_of_building is created\nkchp.drop('yr_built',axis=1,inplace=True)\n\n# Columns bathrooms and floors have float values wihich is not possible, so they are floored\nkchp['bathrooms']=np.floor(kchp['bathrooms'])\nkchp['floors']=np.floor(kchp['floors'])\n\n# Columns are changed to appropriate data types\nkchp['waterfront']=kchp['waterfront'].astype('category')\nkchp['condition']=kchp['condition'].astype('category')\nkchp['grade']=kchp['grade'].astype('category')\nkchp['bathrooms']=kchp['bathrooms'].astype('int64')\nkchp['floors']=kchp['floors'].astype('int64')\nkchp['renovated']=kchp['renovated'].astype('category')\nkchp['zipcode']=kchp['zipcode'].astype('category')","2feb0d22":"# Viewing the first 5 rows and information about the dataset after the changes made\nprint(kchp.head())\nprint(kchp.info())","29aae7ed":"sns.set(rc={'figure.figsize':(15,15)})\nfig=plt.figure()\n\nax1=fig.add_subplot(4,3,1)\nsns.boxplot(y=kchp['price'],ax=ax1,width=0.3,color='turquoise')\nax1.set_title('Price of the houses')\n\nax2=fig.add_subplot(4,3,2)\nsns.boxplot(y=kchp['bedrooms'],ax=ax2,width=0.3,color='royalblue')\nax2.set_title('Number of bedrooms')\n\nax3=fig.add_subplot(4,3,3)\nsns.boxplot(y=kchp['bathrooms'],ax=ax3,width=0.3,color='cyan')\nax3.set_title('Number of bathrooms')\n\nax4=fig.add_subplot(4,3,4)\nsns.boxplot(y=kchp['floors'],ax=ax4,width=0.3,color='gold')\nax4.set_title('Number of floors')\n\nax5=fig.add_subplot(4,3,5)\nsns.boxplot(y=kchp['view'],ax=ax5,width=0.3,color='plum')\nax5.set_title('Number of times viewed')\n\nax6=fig.add_subplot(4,3,6)\nsns.boxplot(y=kchp['sqft_above'],ax=ax6,width=0.3,color='red')\nax6.set_title('Square footage of house apart from basement')\n\nax7=fig.add_subplot(4,3,7)\nsns.boxplot(y=kchp['sqft_basement'],ax=ax7,width=0.3,color='indigo')\nax7.set_title('Square footage of basement')\n\nax8=fig.add_subplot(4,3,8)\nsns.boxplot(y=kchp['sqft_living15'],ax=ax8,width=0.3,color='salmon')\nax8.set_title('Living room area')\n\nax9=fig.add_subplot(4,3,9)\nsns.boxplot(y=kchp['sqft_lot15'],ax=ax9,width=0.3,color='silver')\nax9.set_title('Lot size area')\n\nax10=fig.add_subplot(4,3,10)\nsns.boxplot(y=kchp['age_of_building'],ax=ax10,width=0.3,color='mediumaquamarine')\nax10.set_title('Age of buiding')\n\nplt.show()","7e5780b4":"print(kchp.loc[:,['bedrooms','price','sqft_above']].head())\nprint(kchp.loc[kchp['bedrooms']>10,['bedrooms','price','sqft_above']])","c5c26b8c":"# Number of bedrooms is changed from 33 to 3\nkchp.loc[kchp['bedrooms']==33,'bedrooms']=3\n# kchp.loc[15870,'bedrooms']","045c91c6":"kchp['sqft_lot15'].describe()","2aef22ae":"sns.set(rc={'figure.figsize':(10,25)})\nsns.boxplot(y=kchp['sqft_lot15'],width=0.3,color='silver')\nplt.show()","2a65ea30":"pd.set_option('display.max_columns',None)","2ddc1760":"print(kchp.loc[kchp['sqft_lot15']>100000,['sqft_lot15','price','bedrooms','bathrooms','sqft_above',\n                                          'sqft_basement']].head())\nprint(kchp.loc[kchp['sqft_lot15']>400000,['sqft_lot15','price','bedrooms','bathrooms','sqft_above',\n                                          'sqft_basement']])","1c7ed229":"kchp['sqft_above'].describe()","f57f1d23":"print(kchp.groupby(['bedrooms'])['sqft_above','price'].mean())","abdb3c8a":"kchp.loc[(kchp['bedrooms']==0)&(kchp['bathrooms']==0),['bedrooms','bathrooms','floors','price']]","44549616":"len(kchp.loc[(kchp['bedrooms']==0)|(kchp['bathrooms']==0),['bedrooms','bathrooms','floors','price']].index)","afcb5fee":"# Removing rows with zero bedrooms or bathrooms\nindices=kchp.loc[(kchp['bedrooms']==0)|(kchp['bathrooms']==0),['bedrooms','bathrooms','floors','price']].index\nkchp.drop(labels=indices,axis=0,inplace=True)","586fa540":"fig1=plt.figure()\n\nsns.set(rc={'figure.figsize':(15,33)})\n\nax01=fig1.add_subplot(5,2,1)\nsns.regplot(x='bedrooms', y='price', data=kchp,fit_reg=False,ax=ax01,color='turquoise')\nax01.set_title('Association between Number of bedrooms and Price')\n\nax11=fig1.add_subplot(5,2,2)\nsns.regplot(x='bathrooms', y='price', data=kchp,fit_reg=False,ax=ax11,color='royalblue')\nax11.set_title('Association between Number of bathrooms and Price')\n\nax21=fig1.add_subplot(5,2,3)\nsns.regplot(x='floors', y='price', data=kchp,fit_reg=False,ax=ax21,color='rebeccapurple')\nax21.set_xticks([1,2,3])\nax21.set_title('Association between Number of floors and Price')\n\nax31=fig1.add_subplot(5,2,4)\nsns.regplot(x='view', y='price', data=kchp,fit_reg=False,ax=ax31,color='orangered')\nax31.set_xticks([0,1,2,3,4])\nax31.set_title('Association between Number of times viewed and Price')\n\nax41=fig1.add_subplot(5,2,5)\nsns.regplot(x='sqft_above', y='price', data=kchp,fit_reg=False,ax=ax41,color='plum')\nax41.set_title('Association between Square footage of house apart from basement and Price')\n\nax51=fig1.add_subplot(5,2,6)\nsns.regplot(x='sqft_basement', y='price', data=kchp,fit_reg=False,ax=ax51,color='darkorange')\nax51.set_title('Association between Square footage of basement and Price')\n\nax61=fig1.add_subplot(5,2,7)\nsns.regplot(x='sqft_living15', y='price', data=kchp,fit_reg=False,ax=ax61,color='indigo')\nax61.set_title('Association between Living room area and Price')\n\nax71=fig1.add_subplot(5,2,8)\nsns.regplot(x='sqft_lot15', y='price', data=kchp,fit_reg=False,ax=ax71,color='salmon')\nax71.set_title('Association between Lot size area and Price')\n\nax81=fig1.add_subplot(5,2,9)\nsns.regplot(x='age_of_building', y='price', data=kchp,fit_reg=False,ax=ax81,color='mediumaquamarine')\nax81.set_title('Association between Age of building and Price')\n\nplt.show()\n","253094ff":"fig=plt.figure()\n\nsns.set(rc={'figure.figsize':(15,12)})\n\nax0=fig.add_subplot(2,2,1)\nsns.boxplot(x=\"waterfront\", y=\"price\", data=kchp,dodge=False,palette=\"gist_rainbow\",width=0.4,ax=ax0)\nax0.set_xticklabels(['No','Yes'])\nax0.set_title('Waterfront vs. Price')\n\nax1=fig.add_subplot(2,2,2)\nsns.boxplot(x=\"condition\", y=\"price\", data=kchp,dodge=False,palette=\"gist_rainbow\",width=0.4,ax=ax1)\nax1.set_title('Condition vs. Price')\n\nax2=fig.add_subplot(2,2,3)\nsns.boxplot(x=\"grade\", y=\"price\", data=kchp,dodge=False,palette=\"bright\",width=0.4,ax=ax2)\nax2.set_title('Grade vs. Price')\n\nax3=fig.add_subplot(2,2,4)\nsns.boxplot(x=\"renovated\", y=\"price\", data=kchp,dodge=False,palette=\"gist_rainbow\",width=0.4,ax=ax3)\nax3.set_xticklabels(['No','Yes'])\nax3.set_title('Renovated vs. Price')\nplt.show()","471bc5b4":"# Obtaining the mean price for all zipcodes\nzipinfo=kchp.groupby('zipcode')['price'].mean()\nzipinfo=pd.DataFrame(zipinfo)\nzipinfo.reset_index(inplace=True)\n\n# Obtaining one of the latitude and longitude values corresponding to the zipcodes\nlatitude=[]\nlongitude=[]\nfor zipc in zipinfo['zipcode']:\n    lt=kchp.loc[kchp['zipcode']==zipc,'lat']\n    latitude.append(lt.iloc[0])\n    lg=kchp.loc[kchp['zipcode']==zipc,'long']\n    longitude.append(lg.iloc[0])\n\nzipinfo['lat']=latitude\nzipinfo['long']=longitude","b37bbc6d":"# Plotting the mean price for each zipcode using the zipinfo dataframe in the map\nimport folium\nkchp['price']=kchp['price'].astype('str')\nlocation = kchp['lat'].mean(), kchp['long'].mean()\n\nlocationlist = zipinfo[['lat','long']].values.tolist()\nzips=zipinfo['zipcode'].values.tolist()\nlabels = kchp['price'].values.tolist()\n\n# Empty map\nmap1 = folium.Map(location=location, zoom_start=14)\n\n# Accesing the latitude\nfor point in range(1,len(zipinfo.index)): \n    popup = folium.Popup('Price : {} , Zipcode : {}'.format(labels[point],zips[point]), parse_html=True)\n    folium.Marker(locationlist[point], popup=popup).add_to(map1)\n\nmap1\n\n# Click the marker to view price and zipcode information","b72efe90":"# Changing the data type of price back to float64\nkchp['price']=kchp['price'].astype('float64')","c5b952be":"# Dividing the dataset into development and validation dataset\ny=kchp.loc[:,'price']\nx=kchp.loc[:,['year_sold', 'bedrooms', 'bathrooms', 'floors', 'waterfront',\n       'view', 'condition', 'grade', 'sqft_above', 'sqft_basement', 'zipcode',\n       'sqft_living15', 'sqft_lot15', 'renovated', 'age_of_building']]\n\nfrom sklearn.model_selection import train_test_split\nx_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.20, random_state=42)\n","0bb5fff3":"from sklearn.ensemble import RandomForestRegressor\n\nn_estimators_options=[50,100,150,200,250,300]\nfor n_est in n_estimator_options :\n    rf = RandomForestRegressor(n_estimators = n_est,criterion='mse',oob_score = True, n_jobs = -1,\n                               random_state =50, max_features = \"sqrt\", min_samples_leaf = 50)\n    rf.fit(x_train, y_train)\n#     train dataset\n    predictions_tr = rf.predict(x_train)\n    abs_errors_tr = abs(predictions_tr - y_train)\n    ape_tr = 100 * (abs_errors_tr \/ predictions_tr)\n    accuracy_tr = 100 - np.mean(ape_tr)\n#     test dataset\n    predictions = rf.predict(x_test)\n    abs_errors = abs(predictions - y_test)\n    ape = 100 * (abs_errors \/ predictions)\n    accuracy = 100 - np.mean(ape)\n    print('n_estimators:{}\\n'.format(n_est),'Accuracy for development dataset :',\n          round(accuracy_tr, 2), '%.\\n','Accuracy for validation dataset :', round(accuracy, 2), '%.\\n')\n","1f039336":"# Random Forest with number of estimators equal to 200\nrf = RandomForestRegressor(n_estimators = 150,criterion='mse',oob_score = True, n_jobs = -1,\n                               random_state =50, max_features = \"sqrt\", min_samples_leaf = 50)\nrf.fit(x_train, y_train)\nprint(rf.feature_importances_)","71359fa6":"# Feature Importance\nfeature_importance=pd.DataFrame({'Variable':x_train.columns,'Importance':rf.feature_importances_})\nfeature_importance.sort_values(by='Importance', ascending=False, inplace=True)\nprint(feature_importance)\nsns.barplot(x='Importance',y='Variable',data=feature_importance,orient=\"h\",palette='Blues_r')\nplt.show()","31656561":"The accuracy increases as the number of trees increases upto 150 and then decreases. So we choose the number of trees equal to 150 and the accuracy for the validation dataset is 78%.","2fddef96":"**Data preprocessing**","f5d283f6":"The boxplot of Lot size appears to have all values of the five point summary equal to zero.","3aca53ca":"An outlier value of 33 is observed. The number of bedrooms cannot be such a large value since sqft_above is not proportionately large either. So it must be a typo. 3 might have been wrongly entered as 33 so we change the value to 3.","970b1915":"**Boxplots to view to distribution of all continuous variables**","b4a17199":"**Box plot to view the distribution of price for each category of the categorical variables**","d494a4f9":"It can be observed that most of the houses facing the ocean or a lake have high prices which was evident from the waterfront variable as well.","b0e70fd6":"After looking at the number of bedrooms, bathrooms and square footage information corresponding to large lot size it can be concluded that it must be a valid measurement even though it is an outlier compared to the rest of the data.","0d8b2297":"**Scatter plot between Price and other continuous variables to view the relationship between them**","732f986e":"** Random Forest model**","7aecf4e4":"From the above bar plot it can be observed that the most important variable in determining the price of the house is grade, followed by Living area size, Square footage (excluding basement) and number of bathrroms.","b904030a":"The boxplot of Lot size area appears the way it does because the minimum value is so far away from the maximum value. A large boxplot is displayed below.","cf0cf95a":"**Predictive model**","286548bd":"The five point summary of Square footage (excluding basement) shows that the value of square footage for maximum Lot area is above the the 75th percentile. ","88d69657":"* It can be observed that the median price of houses with water front is greater than that of houses without waterfront. But the maximum house price is for a house without waterfront.\n* The median price is the same for all condition ratings but the maximum price for each condition increases upto 4th rating and then decreases.\n* The price increases as the grade increases.\n* The median price for houses that are renovated and not renovated is the same.\n","f68ebf2d":"The house price, number of bedrooms and bathrooms, square footage (excluding basement), square footage of basement for a few houses with Lot area > 1,00,000 and all houses with Lot area > 4,00,000 are observed.","e314b6fc":"Viewing the first 5 rows of the dataset and houses with more than 10 bedrooms","a2f1f22b":"From the box plot zero values are observed in the number of bedrroms and bathrooms.","ad7d21ff":"**Exploration based on boxplot**","3b68e5a9":"**Using zipcode, latitude and longitude information to get a glimpse of the geographical location**","4889b28b":"* The price is low when the number of bedrooms is very low or very high. The price seems to be high when the number of bedrooms is around 5\n* A conclusion similar to the previous one can be made for the relationship between floors and price\n* The maximum price of houses (for each value of number of bathrooms) increases as number of bathrooms increases.\n* The prices are almost similar irrespective of the number of times the house has been viewed. But the highest prices are for those that have been viewed 2 or more times\n* There seems to be a positive relationship between Square footage apart from basement, square footage of basement, living area and price i.e the price increases as the value of these variables increase.\n* The maximum price of houses (for each each lot size) decreases as lot size increases.\n* There seems to be no relationship between the age of the building and the price.\n","31d7f677":"There are houses with zero bedrooms and bathrooms but one or more floors and a high price. This implies that the data might be incorrect and are hence removed. There are rows where one of the values i.e. either number of bedrooms or bathrooms equal to zero, these are also removed. In total 91 rows are removed. "}}