{"cell_type":{"0c35f4db":"code","b807f6ed":"code","7359527a":"code","b2831502":"code","3a7f71d6":"code","bc5cba75":"code","1d16b63d":"code","1a09ed70":"code","16a39e3a":"code","5984f02e":"code","2ef662e3":"code","2de0f21d":"code","ee1565a9":"code","b22373d5":"code","b4931d91":"code","4d4b4d5d":"markdown","381aa40f":"markdown","3ebfd4e0":"markdown","de26e9d8":"markdown","75561d9c":"markdown","f62833a1":"markdown","ed3a694e":"markdown","82060133":"markdown"},"source":{"0c35f4db":"train_dir = \"..\/input\/face-mask-12k-images-dataset\/Face Mask Dataset\/Train\/\"\nvalid_dir = \"..\/input\/face-mask-12k-images-dataset\/Face Mask Dataset\/Validation\/\"\ntest_dir  = \"..\/input\/face-mask-12k-images-dataset\/Face Mask Dataset\/Test\/\"","b807f6ed":"import numpy as np\nimport cv2\n\nfrom tensorflow.keras.preprocessing.image import ImageDataGenerator, array_to_img, img_to_array, load_img\nfrom tensorflow.keras.utils import to_categorical\n\nfrom tensorflow.keras import models, layers\nfrom tensorflow.keras.regularizers import l2\nfrom tensorflow.keras.callbacks import ModelCheckpoint\nfrom sklearn.metrics import classification_report, confusion_matrix","7359527a":"target_size=(96,96)\nbatch_size = 16","b2831502":"train_datagen = ImageDataGenerator(\n    rescale=1.\/255,\n    rotation_range=40,\n    width_shift_range=0.2,\n    height_shift_range=0.2,\n    shear_range=0.2,\n    zoom_range=0.2,\n    horizontal_flip=True,\n    vertical_flip=True)\n\ntrain_generator = train_datagen.flow_from_directory(\n    train_dir,\n    target_size=target_size,\n    batch_size=batch_size,\n    color_mode='rgb',    \n    shuffle=True,\n    seed=42,\n    class_mode='categorical')","3a7f71d6":"valid_datagen = ImageDataGenerator(rescale=1.\/255)\n\nvalid_generator = valid_datagen.flow_from_directory(\n    valid_dir,\n    target_size=target_size,\n    batch_size=batch_size,\n    color_mode='rgb',\n    shuffle=False,    \n    class_mode='categorical')","bc5cba75":"test_datagen = ImageDataGenerator(rescale=1.\/255)\n\ntest_generator = test_datagen.flow_from_directory(\n    test_dir,\n    target_size=target_size,\n    batch_size=batch_size,\n    color_mode='rgb', \n    shuffle=False,    \n    class_mode='categorical')","1d16b63d":"num_classes = 2 # WithMask, WithoutMask\ninput_shape = (96,96,3)","1a09ed70":"# Build Model\nmodel = models.Sequential()\n# 1st Conv layer\nmodel.add(layers.Conv2D(16, (3, 3), activation='relu', padding='same', input_shape=input_shape))\nmodel.add(layers.MaxPooling2D((2, 2)))\n# 2nd Conv layer\nmodel.add(layers.Conv2D(32, (3, 3), activation='relu', padding='same'))\nmodel.add(layers.MaxPooling2D((2, 2)))\n# 3rd Conv layer\nmodel.add(layers.Conv2D(64, (3, 3), activation='relu', padding='same'))\nmodel.add(layers.MaxPooling2D((2, 2)))\n# 4th Conv layer\nmodel.add(layers.Conv2D(96, (3, 3), activation='relu', padding='same'))\nmodel.add(layers.MaxPooling2D((2, 2)))\n# 5th Conv layer\nmodel.add(layers.Conv2D(128, (3, 3), activation='relu', padding='same'))\nmodel.add(layers.MaxPooling2D((2, 2)))\n# FC layers\nmodel.add(layers.Flatten())\n#model.add(layers.Dense(1024, kernel_regularizer=l2(0.01), bias_regularizer=l2(0.01)))\nmodel.add(layers.Dense(1024))\n#model.add(layers.Dropout(0.2))\n\n#model.add(layers.Dense(64, kernel_regularizer=l2(0.01), bias_regularizer=l2(0.01)))\nmodel.add(layers.Dense(64))\n#model.add(layers.Dropout(0.2))\n\nmodel.add(layers.Dense(num_classes, activation='softmax'))\n\nmodel.summary()","16a39e3a":"# Compile Model\nmodel.compile(loss='categorical_crossentropy', optimizer='Adam',  metrics=['accuracy'])","5984f02e":"STEP_SIZE_TRAIN=train_generator.n\/\/train_generator.batch_size\nSTEP_SIZE_VALID=valid_generator.n\/\/valid_generator.batch_size\nSTEP_SIZE_TEST =test_generator.n\/\/test_generator.batch_size\nnum_epochs = 50","2ef662e3":"# Train Model\nmodel.fit_generator(train_generator,steps_per_epoch=STEP_SIZE_TRAIN,epochs=num_epochs, validation_data=valid_generator, validation_steps=STEP_SIZE_VALID) #, callbacks=[checkpoint])","2de0f21d":"models.save_model(model, \"facemask_cnn.h5\")","ee1565a9":"score = model.evaluate_generator(test_generator, steps=STEP_SIZE_TEST)\nprint(score)","b22373d5":"predY=model.predict_generator(test_generator)\ny_pred = np.argmax(predY,axis=1)\n#y_label= [labels[k] for k in y_pred]\ny_actual = test_generator.classes\ncm = confusion_matrix(y_actual, y_pred)\nprint(cm)","b4931d91":"# report\nlabels = ['withMask', 'withoutMask']\nprint(classification_report(y_actual, y_pred, target_names=labels))","4d4b4d5d":"## Confusion Matrix","381aa40f":"## [Face Mask 12K images Dataset](https:\/\/www.kaggle.com\/ashishjangra27\/face-mask-12k-images-dataset)\n![image.png](attachment:image.png)","3ebfd4e0":"## Train Model","de26e9d8":"## Evaluate Model","75561d9c":"## Data Augmentation","f62833a1":"## Save Model","ed3a694e":"## Build Model","82060133":"# FaceMask Image Classification\n### withMask, withoutMask"}}