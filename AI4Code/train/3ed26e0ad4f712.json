{"cell_type":{"dcea0e80":"code","dbdf1a5c":"code","4d853755":"code","f0165475":"code","7fd41d3d":"code","0ff08d65":"code","94efea2e":"code","4202cc1a":"code","1cfd6798":"code","d49fee72":"code","c5083cad":"code","144f93eb":"code","8bdf05c6":"code","6cf3acff":"code","d369b230":"code","6cb45f27":"code","e45a3d91":"code","6448fcdc":"code","033eb88e":"code","031b8529":"code","31794a98":"code","8ec74f24":"code","5423de4f":"code","2f76cc2d":"code","3e3a19b5":"code","440179ba":"code","5d492308":"code","8dd17870":"code","405fa4e9":"code","c76a4eec":"code","85b67bb6":"markdown","fe5e23f8":"markdown","95b8f7bc":"markdown","712caed3":"markdown","0626914a":"markdown","a0ff1d35":"markdown","860495f5":"markdown","b99892bb":"markdown","428f21f7":"markdown","cc7d6725":"markdown","c7b52480":"markdown","293fb5c4":"markdown","9c924b1e":"markdown","8e301205":"markdown","c1d12430":"markdown","243cda57":"markdown","1100935a":"markdown","c9460bcd":"markdown","e03f416f":"markdown","4d61f08b":"markdown","9b43b079":"markdown"},"source":{"dcea0e80":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\ndf = pd.read_csv(\"..\/input\/attendance-of-medical-appointments-in-brazil\/noshowappointments-kagglev2-may-2016.csv\")","dbdf1a5c":"df.rename(columns= {\"PatientId\": \"patient_id\", \"AppointmentID\": \"appointment_id\", \"Gender\": \"gender\", \"Age\": \"age\", \"Neighbourhood\": \"neighborhood\", \"Scholarship\": \"scholarship\", \"Hipertension\": \"hypertension\", \"Diabetes\": \"diabetes\", \"Alcoholism\": \"alcoholism\", \"Handcap\": \"handicap\", \"SMS_received\": \"SMS_received\", \"No-show\": \"no_show\", \"ScheduledDay\" : \"scheduled_day\", \"AppointmentDay\" : \"appointment_day\", }, inplace=True)","4d853755":"df.info()","f0165475":"df[\"scheduled_day\"] = pd.to_datetime(df[\"scheduled_day\"])\ndf[\"appointment_day\"] = pd.to_datetime(df[\"appointment_day\"],yearfirst=True)\ndf[\"time_diff\"] = df[\"appointment_day\"] - df[\"scheduled_day\"]\n","7fd41d3d":"df.head()","0ff08d65":"plt.style.use(\"seaborn-talk\")\n\nax = df[\"time_diff\"].astype('timedelta64[D]').plot.hist(title=\"Turnaround for Scheduled Appointments\", figsize=(12, 5));\nax.set_xlabel(\"Days\");","94efea2e":"df.time_diff.describe()","4202cc1a":"t = [-1, 1, 3, 14, 179]\nt_bins = pd.to_timedelta(t, unit='days')\nlabels = [\"same day\", \"1 to 3 days\", \"4 to 14 days\", \"More than 14 days\"]\n\ndf['time_diff_bins'] = pd.cut(df['time_diff'], bins=t_bins, labels=labels)\ndf.groupby(\"time_diff_bins\").no_show.value_counts()","1cfd6798":"df[\"time_diff\"] = df[\"time_diff\"].astype('timedelta64[D]')\ndf.drop(df.index[(df.time_diff <= -2.0)], inplace=True)","d49fee72":"df[\"handicap\"].unique()\ndf[\"handicap\"].value_counts()\ndf[\"any_handicap\"] = pd.cut(df[\"handicap\"], bins=[-1, 0, 4], labels=[\"No Handicap\", \"Handicap\"])\ndf[\"any_handicap\"].value_counts()","c5083cad":"df[\"age\"].value_counts()\nprint(df.query(\"age > 100\"))","144f93eb":"sum(df.duplicated())\nprint(len(df[\"appointment_id\"].unique()))\nprint(len(df[\"patient_id\"].unique()))\nprint(len(df[\"patient_id\"]))\nprint(110522 - 62299)","8bdf05c6":"print(df[\"no_show\"].value_counts())\nno_shows = 22314\nprint((no_shows \/ df.shape[0])*100)","6cf3acff":"#Boolstring describes the condition you want a percentage of and characteristic is a string describing it\ndef no_show_percentage(bool_string, characteristic): \n    query1_total = len(df.query(bool_string + \"and no_show == 'Yes'\" ))\n    query2_total = len(df.query(bool_string))\n    return_pct = (query1_total \/ query2_total) * 100\n    print(\"Percentage of patients {} who were no-show:\".format(characteristic), return_pct)\n\nno_show_percentage(\"scholarship == 1\", \"receiving scholarship\" )\nno_show_percentage(\"scholarship == 0\", \"receiving no scholarship\" )","d369b230":"no_show_percentage(\"any_handicap == 'Handicap'\", \"with handicaps\")\nno_show_percentage(\"any_handicap == 'No Handicap'\", \"with no handicaps\")","6cb45f27":"no_show_percentage(\"hypertension == 1\", \"with hypertension\")\nno_show_percentage(\"hypertension == 0\", \"without hypertension\")","e45a3d91":"no_show_percentage(\"diabetes == 1\", \"with diabetes\")\nno_show_percentage(\"diabetes == 0\", \"without diabetes\")","6448fcdc":"df[\"age_range\"] = pd.cut(df[\"age\"], bins=[-2, 12, 25, 35, 45, 55, 65, 75, 115], \n                    labels= [\"Under 12\", \"13 to 25\", \"26 to 35\", \"36 to 45\", \"46 to 55\", \n                              \"56 to 65\", \"66 to 75\", \"76 and up\"])\n","033eb88e":"def return_no_show_pct(bool_string): \n    query1_total = len(df.query(bool_string + \"and no_show == 'Yes'\" ))\n    query2_total = len(df.query(bool_string))\n    return_pct = (query1_total \/ query2_total) * 100\n    return return_pct\n\npct_under_12 = return_no_show_pct(\"age_range == 'Under 12'\")\npct_13_25 = return_no_show_pct(\"age_range == '13 to 25'\")\npct_26_35 = return_no_show_pct(\"age_range == '26 to 35'\")\npct_36_45 = return_no_show_pct(\"age_range == '36 to 45'\")\npct_46_55 = return_no_show_pct(\"age_range == '46 to 55'\")\npct_56_65 = return_no_show_pct(\"age_range == '56 to 65'\")\npct_66_75 = return_no_show_pct(\"age_range == '66 to 75'\")\npct_76_up = return_no_show_pct(\"age_range == '76 and up'\")\n\n\n\n\nage_percentages = [pct_under_12, pct_13_25, pct_26_35, pct_36_45, pct_46_55, \n                    pct_56_65, pct_66_75, pct_76_up]\nlabels = (\"Under 12\", \"13 to 25\", \"26 to 35\", \"36 to 45\", \"46 to 55\", \n                              \"56 to 65\", \"66 to 75\", \"76 and up\")\ny_pos = np.arange(len(labels))\n\nplt.style.use(\"seaborn-talk\")\n\n\nplt.figure(figsize=(12, 4))\nplt.bar(y_pos, age_percentages, color='b');\nplt.xticks(y_pos, labels);\nplt.ylabel(\"Percentage of No Shows\");\nplt.xlabel(\"Age Group\");\nplt.title(\"Percentage of No Shows by Age Group\");\n","031b8529":"ages_13_25 = df[(df[\"age\"] > 13) & (df[\"age\"] <= 25)]","31794a98":"no_show_percentage(\"gender == 'F'\", \"female\")\nno_show_percentage(\"gender == 'M'\", \"male\")","8ec74f24":"r = '#b35806'\np = '#542788'\nplt.figure(figsize=(9,4))\nsns.countplot(data=df, x='time_diff_bins', hue='no_show', palette=[r, p]);\nplt.legend([\"Attended\", \"No-show\"])\nplt.xlabel(\"Turnaround for Scheduled Appointments\");\nplt.ylabel(\"Number of Appointments\")\nplt.title(\"Distribution of No-Shows vs. Attended by Time Turnaround\");","5423de4f":"#convert 'yes'\/'no' in no_show column to integers to calculate percentages\n\ndf['no_show_num'] = 0\ndf.loc[df['no_show'] == 'Yes', 'no_show_num'] = 1\ndf.loc[df['no_show'] == 'No', 'no_show_num'] = 0\ndf['no_show_num'] = df['no_show_num'].astype(int)","2f76cc2d":"no_show_by_turnaround = pd.DataFrame(df.groupby(\"time_diff_bins\").no_show_num.mean())","3e3a19b5":"plt.figure(figsize=(9,4))\nsns.barplot(data=no_show_by_turnaround, x=no_show_by_turnaround.index, y='no_show_num',\n            color='b')\nplt.title(\"Percentage of No-Shows by Appointment Turnaround Time\")\nplt.xlabel(\"Number of Days Away from Time Appointment was Scheduled\")\nplt.title(\"Proportion of No Shows\");","440179ba":"\nsns.countplot(data=df, x='SMS_received', hue='no_show', palette=[p, r])\nplt.legend([\"Attended\", \"No Show\"])\nplt.xticks([0, 1], [\"No SMS Reminder\", \"SMS Reminder\"])\nplt.xlabel('');\nplt.title(\"Appointment Attendance by Text Message Reminder\");","5d492308":"sms_rec = df[df[\"SMS_received\"] == 1]\nno_sms = df[df[\"SMS_received\"] == 0]\nsms_rec = sms_rec.no_show_num.mean() * 100\nno_sms = no_sms.no_show_num.mean() * 100\nprint(sms_rec, no_sms)","8dd17870":"plt.figure(figsize=(5,4))\n\nplt.bar([0,1], sms_rec, color=r)\nplt.bar(0, 100 - sms_rec, bottom=sms_rec, color=p)\nplt.bar(1, no_sms, color = r)\nplt.bar(1, 100 - no_sms, bottom=no_sms, color=p)\nplt.xticks([0, 1], [\"SMS reminder\", \"No SMS reminder\"])\nplt.legend([\"No Show\", \"Attended\"])\nplt.title(\"Appointment Attendance by Text Message Reminder\")\nplt.text(0, 23.2, '{:0.1f}%'.format(sms_rec), color='white', fontsize=12)\nplt.text(1, 12.1, '{:0.1f}%'.format(no_sms), color='white', fontsize=12);","405fa4e9":"print(\"Patients who received a SMS reminder AND had a same day ppt:\", \n              len(df.query(\"SMS_received == 1 and time_diff_bins == 'same day'\")))\nprint(\"Patients who received a SMS reminder:\", len(df.query(\"SMS_received == 1\")))\nprint(df.groupby(\"SMS_received\").time_diff_bins.value_counts())","c76a4eec":"SMS_received_adjusted = return_no_show_pct(\"SMS_received == 1 & time_diff_bins != 'same day'\")\nno_SMS_received_adjusted = return_no_show_pct(\"SMS_received == 0 & time_diff_bins != 'same day'\")\n\nplt.style.use(\"seaborn-talk\")\n\nplt.figure(figsize=(5,6))\n\nplt.bar([0,1], SMS_received_adjusted, color=r)\nplt.bar(0, 100 - SMS_received_adjusted, bottom=SMS_received_adjusted, color=p)\nplt.bar(1, no_SMS_received_adjusted, color = r)\nplt.bar(1, 100 - no_SMS_received_adjusted, bottom=no_SMS_received_adjusted, color=p)\nplt.xticks([0, 1], [\"SMS reminder\", \"No SMS reminder\"])\nplt.legend([\"No Show\", \"Attended\"])\nplt.title(\"Appointment Attendance by Text Message Reminder \\n Excluding Same Day Appts\")\nplt.text(0, 23.2, '{:0.1f}%'.format(SMS_received_adjusted), color='white', fontsize=12)\nplt.text(1, 26.3, '{:0.1f}%'.format(no_SMS_received_adjusted), color='white', fontsize=12);","85b67bb6":"The graph above has a weakness because each age range has a different amount. We can solve this by doing percentages of no shows. \nI made a new function based on the no_show_percentage function that will only return the float percentage for a given characteristic. ","fe5e23f8":"This shows that there are no missing values as all columns have 110,527 data points.\n\nI want to examine the relationship between the time between the appointment was scheduled and the actual date of the appointment; were patients more likely to show up to appointments scheduled recently? So I want to convert the ScheduledDay and AppointmentDay columns into datetime objects. I had to import the datetime package below.","95b8f7bc":"<a id='Datawrangling'><\/a>\n## Data Wrangling and Cleaning\nI inspected the data set using head(), info(), describe(), unique() functions to determine where my cleaning and wrangling efforts should be focused.","712caed3":"When we view the breakdown by the time difference between scheduling the appointment and the date of the appointment, it is clear that the longer the time difference gets, the more likely a patient is to be a no-show. Same day appointments had a 93.4% attendance rate vs 32.7% once the appointment was made 2 weeks out. \n\n**Question 5- How did receiving an SMS reminder impact appointment attendance?**","0626914a":"Another outlier in the data revealed by the describe() function is the age: 115 is not an impossible age but unlikely. The minimum age is -1 which the dataset documentation indicates represents a medical appointment for a fetus. When we look into the value counts by age, 5 appointments were scheduled for a person of age 115 years. If it is not the same person, it may be an error in the data. Let's examine the rows where age was above 100. That shows that there are 2 unique patient IDs with age of 115 which is more realistic. ","a0ff1d35":"## Introduction\n\nThis dataset contains information about patients in Brazil, their characteristics and appointment information, and whether they attended the appointment or not (a no-show). For each patient ID, the data lists the appointment ID, the patient's gender, the day on which appointment was scheduled, the day of the appointment, the age of the patient, the neighborhood in which the patient resides, whether the patient is covered by Bolsa Fam\u00edlia, a social welfare program in Brazil (scholarship), whether the patient has diagnoses of hypertension, diabetes, alcoholism or a handicap, whether the patient received a text message appointment reminder (SMS) and finally whether or not the patient was a No-Show. If they attended the appointment, this column indicates they were \"No\" not a no-show. If they did NOT attend the appointment, this column indicates \"yes\", they were a no-show.\n\nI explored the data to find out what made a patient more or less likely to be a no-show:\n\n- Did Bolsa Familia recipients have a higher or lower rate of no-show?\n- Did patients with diagnoses or handicaps have a higher or lower rate of no-show?\n- Did age or gender impact appointment attendance?\n- What was the impact of the time difference between the day the appointment was scheduled and the day of the appointment?\n- How did receiving an SMS reminder impact appointment attendance?","860495f5":"<a id=\"Conclusion\"><\/a>\n\n## Conclusion\n\nThe two most significant factors that determined whether a patient would make or miss an appointment were when the appointment was scheduled and the age of the patient. Same day appointments had by far the lowest percentage of no-shows, and as the time between appointment scheduled date and appointment date grew, the number of no-shows grew as well. The majority of appointments in this dataset were same day, and that practice can be beneficial for avoiding no-shows. This data suggests that enabling patients to schedule their appointments for less than a week out would lead to less no-shows.\nAdditionally, ages 56 and 75, followed by 12 and under, were most likely to make their appointments. \n\nChronic illness and disability did not seem to deter patients for making appointments, and there was even slight evidence that it increased the chance a patient would make an appointment. Gender had little affect on appointment attendance. \n\nExcluding same day appointments as those patients logically did not receive SMS reminders, patients who received SMS reminders had a higher rate of attendance by 3%. This practice is beneficial but not as beneficial as scheduling appointments within a week.\n\nMy analysis of course has limitations: these conclusions do not include information on the type of appointment or where the appointment was. One would expect the urgency of an appointment or the distance between the patient's home and doctor's office to impact no-show rate as well. Furthermore, this data only spans information for less than 50,000 unique patients and 110,000 appointments, so alone these results are subject to sample size errors.\n\n \n","b99892bb":"The next column of data I analyzed for cleaning\/wrangling was \"handicap\". Unlike Scholarship, Hipertension, Diabetes and Alcoholism, where 0 means no diagnosis and 1 means there is a diagnosis, the handicap column lists the number of disabilities a patient has. We can add a column to indicate whether a patient is handicapped or not by using bins to group the data into handicapped and not handicapped.","428f21f7":"**Question 3 - Did age or gender impact appointment attendance?**\nI wanted to look at two aspects of age- the distribution in the dataset and whether or not that impacted No-show status. The age distribution in our dataset shows that there is a slight left skew towards younger patients although with the interquartile range being 18 to 55 we can fairly assume any significant correlation with age to no-show will not be attributed to unequal sample sizes for age data.","cc7d6725":"**Question 2: - Did patients with diagnoses or handicaps have a higher or lower rate of no-show?**\n\nThough there was not a significant decrease in no-shows for handicapped or chronic illness-diagnosed patients, there was a consistent drop in no-shows when patients had a handicap or chronic illness ranging from 2-3%. See the results in the cells below.","c7b52480":"When looking at the number of days between when an appointment was scheduled and the date of the appointment, we see the data is skewed to the right. Some appointments were scheduled over 70 days in advance, but most appointments were scheduled for within 15 days. I binned the time turnaround by making the first bin for same day appointments, and the remaining bins be by quartile.","293fb5c4":"\nOne problem that emerges with our new column showing time difference is that when there was a same day appointment, the time scheduled was included in ScheduledDay but AppointmentDay defaulted to 0:00:00. Therefore, we can consider all timedeltas less than 0 (such as -1 day) as same-day appointments.\n\nI searched for any rows where the time difference was more than -1 day (which means same day appointment). Five rows were found: all five were no-shows and the appointment was indicated as being scheduled at least one day before the appointment. I dropped these rows of data as the scheduled day should not precede the appointment day.\n","9c924b1e":"I created a new function that prints the percentage of no-shows for a given characteristic.","8e301205":"I grouped patient's ages into groups to more effectively study how each group fared with appointment attendance. I used the histogram above to guide my age group selections seen below split using the cut() function.","c1d12430":"\nAn Analysis of Attendance of Medical Appointments in Brazil\n===========\n\n\n\n\n\n## Table of Contents\n<ul>\n<li> <a href=\"#intro\">Introduction<\/a> <\/li>\n<li> <a href=\"#Datawrangling\">Data Wrangling and Cleaning<\/a> <\/li>\n<li> <a href=\"#ExploratoryDataAnalysis\">Exploratory Data Analysis<\/a> <\/li>\n<li> <a href=\"#Conclusion\">Conclusion<\/a> <\/li>\n<\/ul>","243cda57":"## <a id='ExploratoryDataAnalysis'><\/a>\n## Exploratory Data Analysis\nI use a combination of visualizations and Pandas data grouping functions to explore what variables have the most significant impact and are worthy of further exploration.\n\n**Question 1: - Did Bolsa Familia recipients have a higher or lower rate of no-show?**\nFirst, I found out the overall rate for no-shows for the entire data set: 20.2%. This can be used to compare whether the independent variables I am examining pushed the rate over or below the overall rate of no-shows. Patients receiving Bolsa Familia actually had a higher rate of no-shows by about 4%. ","1100935a":"Above, you can see that there is NO overlap between patients who received a text message reminder and patients who scheduled same day appointments. The same day appointment no-show rate is dramatically lower than the overall rate, so since none of the same day appointments received SMS reminders, this may be skewing the data. I used the table above created by the groupby function isolate the values for SMS received without including same day appointments.","c9460bcd":"Next step is to check for duplicates: There were no duplicate rows. Of the 110,522 unique appointment IDs, there are 48,223 repeat patients. Some of those patients appear in the dataset upwards of 50 times. Considering that I will be looking at factors that affect the no-show, I will be keeping in the duplicate patients the factors surrounding their appointment differ and therefore add valuable information to my analysis. ","e03f416f":"So far, the most significant factors in predicting whether an appointment will result in a no-show are when an appointment is scheduled and whether the patient received a text message reminder. Surprisingly, patients who received a SMS text message were LESS likely to make their appointments. I want to see what the overlap is with those two factors.","4d61f08b":"This visualization allows us to see that the age range with the highest rate of no-shows is 13-25.With the exception of the very young (under 10), no-shows seem to decrease by age although there's a very slight uptick after age 81. \n\nBelow, I grouped no-shows by gender which showed a difference of less than 1%. Gender does not affect no-show by any statistical significance.","9b43b079":"**Question 4 - What was the impact of the time difference between the day the appointment was scheduled and the day of the appointment?**\n\nThese indicators that I have explored all involve characteristics of the patient.  Now I look at two variables that are unrelated to the patient's profile: the time difference between the day the appointment was scheduled and the day of the appointment, and whether or not a text message reminder was sent. "}}