{"cell_type":{"c361715b":"code","727f6416":"code","11a71806":"code","8bc084b1":"code","e89f81dc":"code","00c603a8":"code","5a237056":"code","f00273eb":"code","c813f4fc":"code","aba71c5f":"code","24cd8f12":"code","38958995":"code","6431637a":"code","4d620b34":"code","d42736ba":"code","05965398":"markdown","96137a0f":"markdown","47cefa65":"markdown","75558473":"markdown","715e225e":"markdown","e6c54173":"markdown","7b955af5":"markdown","9b1cce85":"markdown"},"source":{"c361715b":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport os\nfrom tqdm import tqdm\nimport ast\nimport cv2","727f6416":"os.mkdir('labels')","11a71806":"train_csv_path = '..\/input\/global-wheat-detection\/train.csv'\noutput_path = 'labels\/'\nimg_path = '..\/input\/global-wheat-detection\/train\/'","8bc084b1":"train_csv = pd.read_csv(train_csv_path)\ntrain_csv.head()","e89f81dc":"train_csv.info()","00c603a8":"type(train_csv['bbox'][0])","5a237056":"train_csv['bbox'] = train_csv['bbox'].apply(ast.literal_eval)","f00273eb":"type(train_csv['bbox'][0])","c813f4fc":"#groupby all images\ndf = train_csv.groupby('image_id')['bbox'].apply(list).reset_index()\ndf.head()","aba71c5f":"cnt = 0\nremoved = pd.DataFrame(columns=['img_id','bb'])\nfor i,row in tqdm(df.iterrows(),total = len(df)):\n    image_name = row['image_id']\n    bboxes = row['bbox']\n    yolo_labels = []\n    for bb in bboxes:\n        xmin = bb[0]\n        ymin = bb[1]\n        w    = bb[2]\n        h    = bb[3]\n        \n        # Removing very small and very large bounding boxes \n        # This value is choose by trial and error method\n        if w*h>120000 or w*h <700.0:\n            cnt += 1\n            removed.loc[cnt,'img_id'] = image_name\n            removed.loc[cnt,'bb'] = bb\n            continue\n        \n        # converting into YOLO format\n        x_center = (xmin + w\/2)\/1024.0\n        y_center = (ymin + h\/2)\/1024.0\n        w = w\/1024.0\n        h = h\/1024.0\n        yolo_labels.append([0,x_center,y_center,w,h])\n    yolo_labels = np.array(yolo_labels)\n    \n    # Saving images.\n    np.savetxt(output_path+image_name+'.txt',yolo_labels,fmt=['%d', '%f', '%f', '%f', '%f'])\n        ","24cd8f12":"print('Total Removed Bounding Boxes: {}'.format(len(removed)))","38958995":"removed = removed.groupby('img_id')['bb'].apply(list).reset_index()\nplt.figure(figsize=(24,24))\nfor i,img_id in enumerate(range(116,132)):\n    img = plt.imread(img_path + removed.loc[img_id,'img_id']+'.jpg')\n\n    for box in removed.loc[img_id,'bb']:\n        x,y,w,h = box\n\n        cv2.rectangle(img,(int(x),int(y)),(int(x+w),int(y+h)),(255,0,0),5)\n    plt.subplot(4,4,i+1)\n    plt.axis('off')\n    plt.imshow(img)\nplt.show()","6431637a":"print('Total labels: {}'.format(len(os.listdir('labels\/'))))\nprint('Total images: {}'.format(len(os.listdir(img_path))))","4d620b34":"with open('labels\/'+os.listdir('labels\/')[1],'r') as f:\n    temp_file = f.read()","d42736ba":"temp_file.split('\\n')","05965398":"# Converting into YOLO format and saving","96137a0f":"Loop through extracting bb from csv and saving it yolo format","47cefa65":"# Data Processing ","75558473":"* This notebook is for make yolo label txt files from given csv file.\n\n* **NOTE:** I removing very small and very large Bounding boxes from dataset in this notebook, becuase it might effect accuracy of model.\n\n* If you want all bounding boxes data check our [Github repo](https:\/\/github.com\/DhruvMakwana\/Global-Wheat-Detection).\n\n* I got removing very large and small idea from [aleksandradeis](https:\/\/www.kaggle.com\/aleksandradeis) 's EDA [notebook](https:\/\/www.kaggle.com\/aleksandradeis\/globalwheatdetection-eda).","715e225e":"**NOTE** 49 images is without labels, so you have to remove that 49 images from your dataset.","e6c54173":"# Check some labels","7b955af5":"Here data type of **train_csv['bbox']** is string so now convert it into LIST.","9b1cce85":"# Visualizing removed labels\n\nMost of small labels are near corner and edge of image so you have to see images carefully."}}