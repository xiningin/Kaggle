{"cell_type":{"97edfaa9":"code","04dd6ca2":"code","a50957f2":"code","919a9f8d":"code","bc68b6ae":"code","63e27a8f":"markdown"},"source":{"97edfaa9":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport os\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib\nimport matplotlib.pyplot as plt\nimport cv2\n\nmatplotlib.style.use('fivethirtyeight')\n","04dd6ca2":"path = \"..\/input\"\nimage_path = os.path.join(path, 'train')\nfile_masks = pd.read_csv(os.path.join(path , 'train_ship_segmentations.csv'))\nimg_ids = file_masks.groupby('ImageId').size().reset_index(name='counts')\n\nfile_data = dict(zip(img_ids['ImageId'], [[] for x in range(0, len(img_ids))] ));\nfor i,code in  file_masks.values:\n    file_data[i].append(code)\n\ndata =  [(i.split('.')[0],\n        os.path.join(image_path,'{}'.format(i)),\n        code,\n        ) for i,code in  file_data.items()  ] \n\nprint(len(data))\nprint(data[0])\n","a50957f2":"def rle_decode(mask_rle, shape):\n    '''\n    mask_rle: run-length as string formated (start length)\n    shape: (height,width) of array to return \n    Returns numpy array, 1 - mask, 0 - background\n    '''\n    if not isinstance( mask_rle, str ):\n        return np.zeros( shape )\n    \n    s = mask_rle.split()\n    starts, lengths = [np.asarray(x, dtype=int) for x in (s[0:][::2], s[1:][::2])]\n    starts -= 1\n    ends = starts + lengths\n    img = np.zeros(shape[0]*shape[1], dtype=np.uint8)\n    for lo, hi in zip(starts, ends):\n        img[lo:hi] = 1\n    return img.reshape(shape).T\n\ndef lincomb(im1,im2,mask,alpha=0.5):\n    im = im1.copy()      \n    row, col = np.where(mask != 0)\n    for i in range( len(row) ):\n        r,c = row[i],col[i]\n        im[r,c,0] = im1[r,c,0]*(1-alpha) + im2[r,c,0]*(alpha)\n        im[r,c,1] = im1[r,c,1]*(1-alpha) + im2[r,c,1]*(alpha)\n        im[r,c,2] = im1[r,c,2]*(1-alpha) + im2[r,c,2]*(alpha)\n    return im\n\ndef setcolor(im, mask, color):    \n    tmp=im.copy()\n    tmp=np.reshape( tmp, (-1, im.shape[2])  )   \n    mask = np.reshape( mask, (-1,1))      \n    tmp[ np.where(mask>0)[0] ,:] = color\n    im=np.reshape( tmp, (im.shape)  )\n    return im\n\ndef makecolormask( masks ):\n    cmap = plt.get_cmap('jet_r')\n    colormask = np.zeros( (masks.shape[1], masks.shape[2], 3) )    \n    for i,mask in enumerate(masks):\n        color = cmap(float(i)\/masks.shape[0] )\n        colormask = setcolor(colormask, mask, color[:3] )        \n    return colormask\n\ndef codes2masks( codes ):\n    masks = []\n    for code in codes:\n        masks.append( rle_decode(code, image.shape[:2]) )\n    masks = np.stack(masks, axis=0)  \n    return masks\n","919a9f8d":"idname, ipath, codes = data[ 50 ]\nimage = cv2.imread(ipath)[:,:,(2,1,0)]\nmasks = codes2masks(codes)\n\nplt.figure( figsize=(8,8) )\nplt.imshow( lincomb( image\/255, makecolormask(masks), masks.max(axis=0) , alpha=0.8 ) )\nplt.axis('off')\n\nplt.show()\n","bc68b6ae":"matplotlib.rcParams['font.size'] = 9\nmatplotlib.rcParams['figure.figsize'] = (12,19)\n\nnumRows = 9; numCols = 5\n\nplt.figure()\nfor k in range(numRows*numCols):\n    idname, ipath, codes = data[ np.random.randint( len(data) ) ]\n    image = cv2.imread(ipath)[:,:,(2,1,0)]\n    masks = codes2masks(codes)    \n    plt.subplot(numRows,numCols,k+1); \n    plt.imshow( lincomb( image\/255, makecolormask(masks), masks.max(axis=0) , alpha=0.8 ) )\n    plt.title( idname ); \n    plt.axis('off')\n    \n    ","63e27a8f":"   # Airbus Ship Detection Load data\nPedro Diamel Marrero Fernandez"}}