{"cell_type":{"64076755":"code","50135ce2":"code","6d07aa5e":"code","97a4d11c":"code","f130d0c4":"code","80be9f5a":"code","2ed3727c":"code","2ccb4d81":"code","a629a5b2":"code","ee3b12a9":"code","9aaab385":"code","7f698f78":"code","db26896d":"code","e5bea1ac":"code","819f54be":"code","703c8dfb":"code","141e3c46":"code","88eda371":"code","dec4bfb9":"code","f873fb61":"markdown","fd677b01":"markdown","b733517a":"markdown","377dbe12":"markdown","95dcacc1":"markdown","95ff39ee":"markdown","52f222b5":"markdown","2e91e2e8":"markdown","09074873":"markdown","d1aac773":"markdown","6b9b3e50":"markdown","8996c77b":"markdown"},"source":{"64076755":"import os\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport random\nimport cv2 as cv\n\nfrom keras.preprocessing.image import ImageDataGenerator\nfrom keras import Sequential\nfrom keras.applications import DenseNet169\nfrom keras.layers import GlobalAveragePooling2D, Dense, Dropout\nfrom keras.callbacks import ModelCheckpoint, EarlyStopping, ReduceLROnPlateau","50135ce2":"base_dir = \"..\/input\/chest-xray-pneumonia\/chest_xray\/\"\n\ntrain_dir = base_dir + \"train\/\"\nval_dir = base_dir +\"val\/\"\ntest_dir = base_dir +\"test\/\"","6d07aa5e":"directories = [train_dir, val_dir, test_dir]\nlabels = [\"NORMAL\", \"PNEUMONIA\"]\nnormal = pneumonia = train = test = val = 0","97a4d11c":"for dr in directories:\n    \n    for lbl in labels:\n        \n        path = os.path.join(dr, lbl)\n        length = len(os.listdir(path))\n        \n        if dr == train_dir:\n            train += length        \n            if lbl == \"NORMAL\":\n                normal += length\n            else:\n                pneumonia += length\n                \n        elif dr == test_dir:\n            test += length\n            if lbl == \"NORMAL\":\n                normal += length\n            else:\n                pneumonia += length\n                \n        else:\n            val += length\n            if lbl == \"NORMAL\":\n                normal += length\n            else:\n                pneumonia += length","f130d0c4":"fig, axs = plt.subplots(1, 2, figsize=(15,15))\nplt.style.use(\"ggplot\")\n\naxs[0].pie(x=[normal, pneumonia], \n        explode=(0, 0.1),\n        colors=[\"#05c46b\", \"#485460\"],\n        labels=labels, \n        autopct=\"%1.1f%%\", \n        shadow=True, \n        startangle=90,\n        )\naxs[0].title.set_text(\"Label Distribution of Dataset\")\n\naxs[1].pie(x=[train, test, val],\n        labels=[\"Train\", \"Test\", \"Val\"],\n        explode=(0.1,0.1,0.1),\n        colors=[\"#ef5777\", \"#ffdd59\", \"#575fcf\"],\n        autopct=\"%1.1f%%\",  \n        startangle=90,\n       )\naxs[1].title.set_text(\"Splits of Dataset\")\n\nplt.show();","80be9f5a":"def random_plot(label):\n\n    path = os.path.join(train_dir, label)\n    imgs = os.listdir(path)\n    random_imgs = random.sample(imgs, 3)\n    fig = plt.figure(figsize=(20,10))\n    \n    for i in range(len(random_imgs)):\n        \n        img_path = os.path.join(path, random_imgs[i])\n        img = plt.imread(img_path)\n        fig.add_subplot(1,3,i+1)\n        plt.imshow(img, cmap=\"bone\")","2ed3727c":"random_plot(\"NORMAL\")","2ccb4d81":"random_plot(\"PNEUMONIA\")","a629a5b2":"def canny(label):\n    \n    path = os.path.join(train_dir, label)\n    imgs = os.listdir(path)\n    random_imgs = random.sample(imgs, 3)\n    fig = plt.figure(figsize=(20,10))\n    \n    for i in range(len(random_imgs)):\n        \n        img_path = os.path.join(path, random_imgs[i])\n        img = plt.imread(img_path)\n        fig.add_subplot(1,3,i+1)\n        can = cv.Canny(img, 60, 60)\n        plt.imshow(can)","ee3b12a9":"canny(\"NORMAL\")","9aaab385":"canny(\"PNEUMONIA\")","7f698f78":"train_datagen = ImageDataGenerator(\n                                \n    rotation_range=60,\n    width_shift_range=0.2,\n    height_shift_range=0.2,\n    brightness_range=(0.6,1.2),\n    shear_range=0.2,\n    zoom_range=0.3,\n    horizontal_flip=True,\n    vertical_flip=True,\n    rescale=1.\/255,\n)\n\ntest_datagen = ImageDataGenerator(rescale=1.\/255)","db26896d":"train_generator = train_datagen.flow_from_directory(\n    \n    train_dir,\n    target_size=(256,256),\n    class_mode=\"binary\",\n    batch_size=16,\n    shuffle=True,\n    seed=44,\n)\n\ntest_generator = test_datagen.flow_from_directory(\n    \n    test_dir,\n    target_size=(256,256),\n    class_mode=\"binary\",\n    batch_size=16,\n    \n)\n\nval_generator = test_datagen.flow_from_directory(\n    \n    val_dir,\n    target_size=(256,256),\n    class_mode=\"binary\",\n    batch_size=8,\n    \n)","e5bea1ac":"augmented = next(train_generator)","819f54be":"fig = plt.figure(figsize=(20,20))\n\nfor i in range(len(augmented[0])):\n    \n    img = augmented[0][i]\n    label = augmented[1][i]\n    \n    fig.add_subplot(4,4,i+1)\n    plt.imshow(img)\n    \n    if label == 0:\n        plt.title(\"NORMAL\")\n    elif label == 1:\n        plt.title(\"PNEUMONIA\")","703c8dfb":"base_model = DenseNet169(\n    \n    include_top=False,\n    weights=\"imagenet\",\n    input_shape=(256,256,3),\n)\n\nfor layer in base_model.layers:\n    layer.trainable = False\n    \n\nmodel = Sequential([\n    \n    base_model,\n    GlobalAveragePooling2D(),\n    Dense(128, activation=\"relu\"),\n    Dropout(0.3),\n    Dense(1, activation=\"sigmoid\"),\n])\n\nmodel.summary()","141e3c46":"model.compile(optimizer=\"adam\", loss='binary_crossentropy', metrics=[\"accuracy\"])\n\nes = EarlyStopping(monitor='accuracy', patience=4)\nmc = ModelCheckpoint(\".\/\", monitor=\"accuracy\", save_best_only=True)\nrl = ReduceLROnPlateau(monitor=\"accuracy\", factor=0.2, patience=2, min_lr=0.00001)\n\nhistory = model.fit(\n    \n    train_generator, \n    validation_data=val_generator, \n    steps_per_epoch = 100, \n    epochs=20, \n    callbacks=[es,mc,rl],\n)","88eda371":"plt.figure(figsize=(12,6))\n\nplt.subplot(121)\nplt.plot(history.history[\"accuracy\"], label=\"Train accuracy\")\nplt.plot(history.history[\"val_accuracy\"], label=\"Val accuracy\")\nplt.title(\"Accuracy\")\nplt.legend()\n\nplt.subplot(122)\nplt.plot(history.history[\"loss\"], label=\"Train loss\")\nplt.plot(history.history[\"val_loss\"], label=\"Val loss\")\nplt.title(\"Loss\")\nplt.legend();","dec4bfb9":"model.evaluate(test_generator)","f873fb61":"![normal vs pneumonia](https:\/\/www.bmj.com\/content\/bmj\/370\/bmj.m2426\/F4.large.jpg?width=800&height=600)\n<a href=\"https:\/\/www.bmj.com\/content\/370\/bmj.m2426\">Normal VS Pneumonia<\/a>","fd677b01":"# Useful Libraries<a id = \"library\"><\/a>\n#### [Return2Contents](#contents)","b733517a":"### Random Plot","377dbe12":"# Results<a id=\"results\"><\/a>\n#### [Return2Contents](#contents)","95dcacc1":"# Contents<a id=\"contents\"><\/a>\n### [Useful Libraies](#library)\n### [Understanding The Data](#understand)\n### [Data Generator](#generator)\n### [Model](#model)\n### [Results](#results)","95ff39ee":"### \"Pneumonia is an infection in one or both lungs. Bacteria, viruses, and fungi cause it.\n\n### The infection causes inflammation in the air sacs in your lungs, which are called alveoli. The alveoli fill with fluid or pus, making it difficult to breathe.\n\n### Pneumonia symptoms can be mild to life-threatening. They can include:\n\n<ul>\n    <li>coughing that may produce phlegm (mucus)<\/li>\n    <li>fever<\/li>\n    <li>sweating or chills<\/li>\n    <li>shortness of breath that happens while doing normal activities or even while resting<\/li>\n    <li>chest pain that\u2019s worse when you breathe or cough<\/li>\n    <li>feelings of tiredness or fatigue<\/li>\n    <li>loss of appetite<\/li>\n    <li>nausea or vomiting<\/li>\n    <li>headaches\"<\/li>\n<\/ul>\n<a href=\"http:\/\/www.healthline.com\/health\/pneumonia\">Source<\/a>","52f222b5":"### Canny Edge Detection","2e91e2e8":"# Understanding The Data <a id = \"understand\" ><\/a>\n#### [Return2Contents](#contents)","09074873":"# Chest X-Ray Classification","d1aac773":"# Data Generator<a id=\"generator\"><\/a>\n#### [Return2Contents](#contents)","6b9b3e50":"# Model<a id=\"model\"><\/a>\n#### [Return2Contents](#contents)","8996c77b":"### Augmented Images"}}