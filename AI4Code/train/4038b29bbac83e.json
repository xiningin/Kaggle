{"cell_type":{"cf612a94":"code","ddc50015":"code","1f4da919":"code","ac1e191a":"code","f0e3a4a8":"code","f2ba9361":"code","75d84fe5":"code","cca327cc":"code","fdbf6f4a":"code","9ac3de97":"code","b8083416":"code","c4e59098":"code","7d2f8020":"code","9064340d":"code","f89da200":"code","9b519a62":"code","362e7bf1":"code","4acaed55":"code","5cc9abdb":"code","103199c1":"code","a60918cb":"code","8bae38d8":"code","5253c43e":"code","13393388":"code","0a82d08c":"code","f5e7e43b":"code","fb91995e":"code","4a73f57a":"code","b8a3ae40":"code","a2808736":"code","f15956a6":"code","883ec213":"code","46d7cde7":"code","3c0cfe35":"code","930c756e":"code","94bebfbf":"code","7bcb2904":"code","a3e79533":"code","b903db80":"code","a8607a40":"code","77056f39":"code","23e22b3a":"code","f17ba740":"code","9a701d35":"code","b00090d1":"code","4a9ddb05":"code","8df22696":"code","6d0066a6":"code","9610a6fd":"code","74656d5c":"code","181cf552":"code","1ebf51b8":"code","deab0ddb":"code","557a4acf":"code","7cebdd06":"code","12cf90a4":"code","69b586df":"code","a841acef":"code","bd828f5e":"code","7cf71af0":"code","f3649ec9":"code","4077cf2b":"code","6328f6e8":"code","f7f75fe4":"code","977a4ab6":"code","3f856fbb":"code","6e6e0d9c":"code","982df4eb":"code","03e39dbd":"code","2e272579":"code","1c3a1714":"code","e3224811":"code","7af41a03":"code","ad0aaf80":"code","f2fe1a7c":"code","15f7b4e2":"code","44b927c0":"code","76485b87":"code","31adb3a7":"code","58cef03d":"code","a9fab57c":"code","6da1cd0b":"code","ff3b4118":"code","3ce142b9":"code","7d46f1af":"code","3817b92d":"code","423af670":"code","33b8a110":"code","4a2f60db":"code","641ed970":"code","818dcc1e":"code","fb8c2fc5":"code","7f798671":"code","278713ca":"code","0234470b":"code","71484cab":"code","e51cc374":"code","33db7d32":"code","b5149396":"code","b339fa3e":"code","4a22598b":"code","1b29cdae":"code","c599f094":"code","61da64e8":"code","1cad8432":"code","e0698635":"code","b164dec7":"code","daf0b11d":"code","07077497":"code","6e5f6611":"code","2ed7acf6":"code","98e66d33":"code","df308ea2":"code","5cba4dfc":"code","82138b19":"code","cc49934d":"code","006ace8e":"code","6845f4d7":"code","0adb95e9":"code","44cd538f":"code","80fb956c":"code","26a0b1d4":"code","72f103f8":"code","fde539a9":"code","c7d0237c":"code","d2bbe239":"code","daac16a3":"code","f2d8a6ee":"code","e5608204":"code","3aab2cd3":"code","1751b049":"code","6b344938":"code","68d7762a":"code","a506c056":"code","3481fdad":"code","f0f96a7c":"code","57f0b005":"code","a3d34947":"code","948967e3":"code","deef05dc":"code","e8a926e7":"code","8a9857ad":"markdown","e79cb588":"markdown","775b5dc9":"markdown","c5b7b133":"markdown","b47e9ab1":"markdown","b3cce0eb":"markdown","d59f0688":"markdown","27b8cd84":"markdown","c95234be":"markdown","9bb6f09a":"markdown","87fab9f3":"markdown","8aca96fc":"markdown","7855bca3":"markdown","73f5f2e3":"markdown","edf6657b":"markdown","e9db29fb":"markdown","b91f2790":"markdown","bcd350e1":"markdown","9eaec027":"markdown","e0bc784e":"markdown","3d9dad83":"markdown","ec695b5a":"markdown","a83c9230":"markdown","1a06505e":"markdown","a4c7c6f0":"markdown"},"source":{"cf612a94":"!mkdir credit_samples","ddc50015":"import warnings\nwarnings.filterwarnings('ignore')\nimport gc\n","1f4da919":"import pandas as pd","ac1e191a":"application_train = pd.read_csv(\"\/kaggle\/input\/home-credit-default-risk\/application_train.csv\")","f0e3a4a8":"application_train[[\"TARGET\"]].value_counts()","f2ba9361":"application_train.sample()","75d84fe5":"application_train.info()","cca327cc":"application_train['SK_ID_CURR'].duplicated().any()\n","fdbf6f4a":"application_train['SK_ID_CURR'].nunique()","9ac3de97":"application_sample = application_train.sample(1000, random_state=0)","b8083416":"application_sample.head()","c4e59098":"application_sample.to_csv(\"credit_samples\/application_train.csv\",index=False)","7d2f8020":"# Target variable (1 - client with payment difficulties: he\/she had late payment more than X days\n# on at least one of the first Y installments of the loan in our sample,\n# 0 - all other cases)\napplication_sample[[\"TARGET\"]].value_counts()","9064340d":"application_sample.corr()['TARGET'].sort_values(ascending=False).head(10)","f89da200":"application_sample.info(verbose=True,null_counts=True)","9b519a62":"columns =  ['OWN_CAR_AGE','OCCUPATION_TYPE','EXT_SOURCE_1','EXT_SOURCE_3','EXT_SOURCE_2','APARTMENTS_AVG','BASEMENTAREA_AVG',\n         'YEARS_BEGINEXPLUATATION_AVG','COMMONAREA_AVG','YEARS_BUILD_AVG','ELEVATORS_AVG','ENTRANCES_AVG','FLOORSMAX_AVG',\n         'FLOORSMIN_AVG','LANDAREA_AVG','LIVINGAPARTMENTS_AVG','LIVINGAREA_AVG','NONLIVINGAPARTMENTS_AVG','APARTMENTS_MODE',\n         'BASEMENTAREA_MODE','YEARS_BEGINEXPLUATATION_MODE','YEARS_BUILD_MODE','COMMONAREA_MODE','ELEVATORS_MODE','ELEVATORS_MODE',\n         'ENTRANCES_MODE','FLOORSMAX_MODE','FLOORSMIN_MODE','LANDAREA_MODE','LIVINGAPARTMENTS_MODE','NONLIVINGAREA_MODE',\n         'APARTMENTS_MEDI','BASEMENTAREA_MEDI','YEARS_BEGINEXPLUATATION_MEDI','YEARS_BUILD_MEDI','COMMONAREA_MEDI','ELEVATORS_MEDI','ENTRANCES_MEDI',\n         'FLOORSMAX_MEDI','FLOORSMIN_MEDI','LANDAREA_MEDI','LIVINGAPARTMENTS_MEDI','NONLIVINGAPARTMENTS_MEDI','NONLIVINGAREA_MEDI','FONDKAPREMONT_MODE',\n         'HOUSETYPE_MODE','TOTALAREA_MODE','WALLSMATERIAL_MODE','EMERGENCYSTATE_MODE','AMT_REQ_CREDIT_BUREAU_HOUR','AMT_REQ_CREDIT_BUREAU_DAY','AMT_REQ_CREDIT_BUREAU_WEEK',\n         'AMT_REQ_CREDIT_BUREAU_MON','AMT_REQ_CREDIT_BUREAU_QRT','AMT_REQ_CREDIT_BUREAU_YEAR','NONLIVINGAREA_AVG','LIVINGAREA_MODE','LIVINGAREA_MEDI','NONLIVINGAPARTMENTS_MODE']\n\nselected_application_sample = application_sample.drop(columns=columns,axis=1)","362e7bf1":"selected_application_sample.head()","4acaed55":"selected_application_sample.info()","5cc9abdb":"selected_application_sample.columns[selected_application_sample.isnull().any()]","103199c1":"selected_application_sample['AMT_GOODS_PRICE'].fillna(selected_application_sample['AMT_GOODS_PRICE'].median(),inplace=True)","a60918cb":"selected_application_sample['NAME_TYPE_SUITE'].value_counts()","8bae38d8":"selected_application_sample['NAME_TYPE_SUITE'].fillna('Unaccompanied',inplace=True)","5253c43e":"selected_application_sample[['OBS_30_CNT_SOCIAL_CIRCLE']].head()","13393388":"selected_application_sample['OBS_30_CNT_SOCIAL_CIRCLE'].fillna(selected_application_sample['OBS_30_CNT_SOCIAL_CIRCLE'].median(),inplace=True)","0a82d08c":"selected_application_sample['DEF_30_CNT_SOCIAL_CIRCLE'].fillna(selected_application_sample['DEF_30_CNT_SOCIAL_CIRCLE'].median(),inplace=True)","f5e7e43b":"selected_application_sample['OBS_60_CNT_SOCIAL_CIRCLE'].fillna(selected_application_sample['OBS_60_CNT_SOCIAL_CIRCLE'].median(),inplace=True)","fb91995e":"selected_application_sample['DEF_60_CNT_SOCIAL_CIRCLE'].fillna(selected_application_sample['DEF_60_CNT_SOCIAL_CIRCLE'].median(),inplace=True)","4a73f57a":"selected_application_sample.head()","b8a3ae40":"# credit amount ratio relative to the income of a client\nselected_application_sample['CREDIT_INCOME_RATIO'] = selected_application_sample['AMT_CREDIT'] \/ selected_application_sample['AMT_INCOME_TOTAL']\n# loan annuity percentage relative to the income of a client\nselected_application_sample['ANNUITY_INCOME_RATIO'] = selected_application_sample['AMT_ANNUITY'] \/ selected_application_sample['AMT_INCOME_TOTAL']\n# the length of the payment in months \nselected_application_sample['CREDIT_TERM'] = selected_application_sample['AMT_ANNUITY'] \/ selected_application_sample['AMT_CREDIT']\n# days employed relative to the age of the client\nselected_application_sample['DAYS_EMPLOYED_RATIO'] = selected_application_sample['DAYS_EMPLOYED'] \/ selected_application_sample['DAYS_BIRTH']","a2808736":"# Compare the amount credit given to the clients income\nselected_application_sample['INCOME_CREDIT_RATIO'] = selected_application_sample['AMT_CREDIT'] \/ selected_application_sample['AMT_INCOME_TOTAL']","f15956a6":"# Ratio of annuity to amount of income\nselected_application_sample['ANNUITY_INCOME_RATIO'] = selected_application_sample['AMT_ANNUITY'] \/ selected_application_sample['AMT_INCOME_TOTAL']\n","883ec213":"# Difference betwwen the price of goods and the loan amount given\nselected_application_sample['GOODS_PRICE_LOAN_DIFFERENCE'] = selected_application_sample['AMT_GOODS_PRICE'] - selected_application_sample['AMT_CREDIT']","46d7cde7":"# Rate of payment\nselected_application_sample['PAYMENT_RATE'] = selected_application_sample['AMT_ANNUITY'] \/ selected_application_sample['AMT_CREDIT']\n","3c0cfe35":"loan_ids = list(application_sample['SK_ID_CURR'])","930c756e":"bureau = pd.read_csv(\"\/kaggle\/input\/home-credit-default-risk\/bureau.csv\")\nbureau.sample()","94bebfbf":"bureau_sample = bureau[ bureau['SK_ID_CURR'].isin(loan_ids)]","7bcb2904":"bureau_sample.head()","a3e79533":"bureau_sample.to_csv(\"credit_samples\/bureau.csv\",index=False)","b903db80":"bureau_sample.info()","a8607a40":"columns = ['AMT_ANNUITY']\nselected_bureau_sample = bureau_sample.drop(columns=columns,axis=1)","77056f39":"selected_bureau_sample.head()","23e22b3a":"bureaus = list(bureau_sample['SK_ID_BUREAU'])","f17ba740":"bureau_balance = pd.read_csv(\"\/kaggle\/input\/home-credit-default-risk\/bureau_balance.csv\")\nbureau_balance.sample()","9a701d35":"bureau_balance_sample = bureau_balance[ bureau_balance['SK_ID_BUREAU'].isin(bureaus)]","b00090d1":"bureau_balance_sample.info()","4a9ddb05":"bureau_balance_sample.tail()","8df22696":"bureau_balance_sample.to_csv(\"credit_samples\/bureau_balance.csv\",index=False)","6d0066a6":"previous_balance = selected_bureau_sample.merge(bureau_balance, on='SK_ID_BUREAU')","9610a6fd":"previous_balance.head()","74656d5c":"previous_balance.info()","181cf552":"previous_balance.columns[previous_balance.isnull().any()]","1ebf51b8":"previous_balance['DAYS_CREDIT_ENDDATE'].fillna(previous_balance['DAYS_CREDIT_ENDDATE'].median(),inplace=True)\nprevious_balance['DAYS_ENDDATE_FACT'].fillna(previous_balance['DAYS_ENDDATE_FACT'].median(),inplace=True)\nprevious_balance['AMT_CREDIT_SUM_DEBT'].fillna(previous_balance['AMT_CREDIT_SUM_DEBT'].median(),inplace=True)\nprevious_balance['AMT_CREDIT_MAX_OVERDUE'].fillna(previous_balance['AMT_CREDIT_MAX_OVERDUE'].median(),inplace=True)\nprevious_balance['AMT_CREDIT_SUM_LIMIT'].fillna(previous_balance['AMT_CREDIT_SUM_LIMIT'].median(),inplace=True)","deab0ddb":"previous_balance.info()","557a4acf":"previous_balance.sample(5)","7cebdd06":"previous_balance[['AMT_CREDIT_SUM_LIMIT']].describe()","12cf90a4":"def credit_sum_limit(credit_limit):\n  if credit_limit > 0:\n    limit_above_zero = 1\n  else:\n    limit_above_zero = 0\n  return limit_above_zero","69b586df":"previous_balance['CREDIT_LIMIT_ABOVE_ZERO'] = previous_balance['AMT_CREDIT_SUM_LIMIT'].apply(credit_sum_limit)","a841acef":"previous_balance['CREDIT_LIMIT_ABOVE_ZERO'].value_counts()","bd828f5e":"previous_balance[['AMT_CREDIT_SUM_DEBT']].describe()","7cf71af0":"def has_debt(debt_amount):\n  if debt_amount > 0:\n    has_debt = 1\n  else:\n    has_debt = 0\n  return has_debt","f3649ec9":"previous_balance[\"HAS_DEBT\"] = previous_balance['AMT_CREDIT_SUM_DEBT'].apply(has_debt)","4077cf2b":"previous_balance['AMT_CREDIT_SUM_OVERDUE'].describe()","6328f6e8":"def over_due_debt(debt_amount):\n  if debt_amount > 0:\n    debt_overdue = 1\n  else:\n    debt_overdue = 0\n  return debt_overdue","f7f75fe4":"previous_balance['HAS_OVERDUE_DEBT'] = previous_balance['AMT_CREDIT_SUM_OVERDUE'].apply(over_due_debt)","977a4ab6":"previous_balance['HAS_OVERDUE_DEBT'].value_counts()","3f856fbb":"credit_card_balance = pd.read_csv(\"\/kaggle\/input\/home-credit-default-risk\/credit_card_balance.csv\")\ncredit_card_balance.sample()","6e6e0d9c":"credit_card_balance_sample = credit_card_balance[ credit_card_balance['SK_ID_CURR'].isin(loan_ids)]\ncredit_card_balance_sample.head()","982df4eb":"credit_card_balance_sample.to_csv(\"credit_samples\/credit_card_balance.csv\",index=False)","03e39dbd":"credit_card_balance_sample.info()","2e272579":"credit_card_balance_sample.columns[credit_card_balance_sample.isnull().any()]","1c3a1714":"credit_card_balance_sample['AMT_DRAWINGS_ATM_CURRENT'].fillna(credit_card_balance_sample['AMT_DRAWINGS_ATM_CURRENT'].median(),inplace=True)\ncredit_card_balance_sample['AMT_DRAWINGS_POS_CURRENT'].fillna(credit_card_balance_sample['AMT_DRAWINGS_POS_CURRENT'].median(),inplace=True)\ncredit_card_balance_sample['AMT_DRAWINGS_POS_CURRENT'].fillna(credit_card_balance_sample['AMT_DRAWINGS_POS_CURRENT'].median(),inplace=True)\ncredit_card_balance_sample['AMT_INST_MIN_REGULARITY'].fillna(credit_card_balance_sample['AMT_INST_MIN_REGULARITY'].median(),inplace=True)\ncredit_card_balance_sample['AMT_PAYMENT_CURRENT'].fillna(credit_card_balance_sample['AMT_PAYMENT_CURRENT'].median(),inplace=True)\ncredit_card_balance_sample['CNT_DRAWINGS_ATM_CURRENT'].fillna(credit_card_balance_sample['CNT_DRAWINGS_ATM_CURRENT'].median(),inplace=True)\ncredit_card_balance_sample['CNT_DRAWINGS_OTHER_CURRENT'].fillna(credit_card_balance_sample['CNT_DRAWINGS_OTHER_CURRENT'].median(),inplace=True)\ncredit_card_balance_sample['CNT_DRAWINGS_POS_CURRENT'].fillna(credit_card_balance_sample['CNT_DRAWINGS_POS_CURRENT'].median(),inplace=True)\ncredit_card_balance_sample['CNT_INSTALMENT_MATURE_CUM'].fillna(credit_card_balance_sample['CNT_INSTALMENT_MATURE_CUM'].median(),inplace=True)\ncredit_card_balance_sample['AMT_DRAWINGS_OTHER_CURRENT'].fillna(credit_card_balance_sample['AMT_DRAWINGS_OTHER_CURRENT'].median(),inplace=True)\n","e3224811":"credit_card_balance_sample.rename(columns={\"MONTHS_BALANCE\": \"CREDIT_MONTHS_BALANCE\",\n                                           \"NAME_CONTRACT_STATUS\":\"CREDIT_NAME_CONTRACT_STATUS\",\n                                           \"SK_DPD\":\"CREDIT_SK_DPD\",\n                                           \"SK_DPD_DEF\":\"CURRENT_SK_DPD_DEF\",\n                                           },inplace=True)","7af41a03":"credit_card_balance_sample.head()","ad0aaf80":"# Difference between credit card limit and the balance \ncredit_card_balance_sample['BALANCE_LIMIT_DIFF'] = credit_card_balance_sample['AMT_BALANCE'] - credit_card_balance_sample['AMT_CREDIT_LIMIT_ACTUAL']","f2fe1a7c":"credit_card_balance_sample[['BALANCE_LIMIT_DIFF']].info()","15f7b4e2":"credit_card_balance_sample[['AMT_PAYMENT_TOTAL_CURRENT']].info()","44b927c0":"credit_card_balance_sample[['AMT_TOTAL_RECEIVABLE']].describe()","76485b87":"# Difference between client's total credit monthly payments and the total monthly receivable \ncredit_card_balance_sample['CREDIT_RECEIVABLE_DIFF'] = credit_card_balance_sample['AMT_TOTAL_RECEIVABLE'] - credit_card_balance_sample['AMT_PAYMENT_TOTAL_CURRENT'] ","31adb3a7":"credit_card_balance_sample[['AMT_PAYMENT_TOTAL_CURRENT']].describe()","58cef03d":"credit_card_balance_sample[['CREDIT_RECEIVABLE_DIFF']].describe()","a9fab57c":"# Total drawings\ncredit_card_balance_sample['TOTAL_DRAWINGS'] = credit_card_balance_sample['AMT_DRAWINGS_ATM_CURRENT'] + credit_card_balance_sample['AMT_DRAWINGS_CURRENT'] + credit_card_balance_sample['AMT_DRAWINGS_OTHER_CURRENT'] + credit_card_balance_sample['AMT_DRAWINGS_POS_CURRENT']","6da1cd0b":"credit_card_balance_sample['TOTAL_DRAWINGS'].describe()","ff3b4118":"credit_card_balance_sample.head()","3ce142b9":"POS_CASH_balance = pd.read_csv(\"\/kaggle\/input\/home-credit-default-risk\/POS_CASH_balance.csv\")\nPOS_CASH_balance.sample()","7d46f1af":"POS_CASH_balance_sample = POS_CASH_balance[ POS_CASH_balance['SK_ID_CURR'].isin(loan_ids)]\nPOS_CASH_balance_sample.head()","3817b92d":"POS_CASH_balance_sample.info()","423af670":"POS_CASH_balance_sample.to_csv(\"credit_samples\/POS_CASH_balance.csv\",index=False)","33b8a110":"POS_CASH_balance_sample.columns[POS_CASH_balance_sample.isnull().any()]","4a2f60db":"POS_CASH_balance_sample['CNT_INSTALMENT'].fillna(POS_CASH_balance_sample['CNT_INSTALMENT'].median(),inplace=True)\nPOS_CASH_balance_sample['CNT_INSTALMENT_FUTURE'].fillna(POS_CASH_balance_sample['CNT_INSTALMENT_FUTURE'].median(),inplace=True)","641ed970":"POS_CASH_balance_sample.head()","818dcc1e":"installments_payments = pd.read_csv(\"\/kaggle\/input\/home-credit-default-risk\/installments_payments.csv\")\ninstallments_payments.sample()","fb8c2fc5":"installments_payments_sample = installments_payments[ installments_payments['SK_ID_CURR'].isin(loan_ids)]\ninstallments_payments_sample.head()","7f798671":"installments_payments_sample.info()","278713ca":"installments_payments_sample.to_csv(\"credit_samples\/installments_payments.csv\",index=False)","0234470b":"installments_payments_sample.columns[installments_payments_sample.isnull().any()]","71484cab":"installments_payments_sample['DAYS_ENTRY_PAYMENT'].fillna(installments_payments_sample['DAYS_ENTRY_PAYMENT'].median(),inplace=True)\ninstallments_payments_sample['AMT_PAYMENT'].fillna(installments_payments_sample['AMT_PAYMENT'].median(),inplace=True)\n","e51cc374":"installments_payments_sample.head()","33db7d32":"# Ratio of installment amount and actual paid amount \ninstallments_payments_sample['INSTALMENT_PAYMENT_RATIO'] =  installments_payments_sample['AMT_PAYMENT'] \/ installments_payments_sample['AMT_INSTALMENT']","b5149396":"installments_payments_sample['INSTALMENT_PAYMENT_RATIO'].describe()","b339fa3e":"installments_payments_sample[['INSTALMENT_PAYMENT_RATIO']]","4a22598b":"previous_application = pd.read_csv(\"\/kaggle\/input\/home-credit-default-risk\/previous_application.csv\")\nprevious_application.sample()","1b29cdae":"previous_application_sample = previous_application[ previous_application['SK_ID_CURR'].isin(loan_ids)]\nprevious_application_sample.head()","c599f094":"previous_application_sample.to_csv(\"credit_samples\/previous_application.csv\",index=False)","61da64e8":"previous_application_sample.info()","1cad8432":"columns = ['AMT_DOWN_PAYMENT','RATE_DOWN_PAYMENT','RATE_INTEREST_PRIMARY','RATE_INTEREST_PRIVILEGED','DAYS_FIRST_DRAWING','DAYS_FIRST_DUE',\n           'DAYS_LAST_DUE_1ST_VERSION','DAYS_LAST_DUE','DAYS_TERMINATION','NFLAG_INSURED_ON_APPROVAL']\nselected_previous_application_sample = previous_application_sample.drop(columns=columns, axis=1)\nselected_previous_application_sample.head()","e0698635":"selected_previous_application_sample.columns[selected_previous_application_sample.isnull().any()]","b164dec7":"selected_previous_application_sample['AMT_ANNUITY'].fillna(selected_previous_application_sample['AMT_ANNUITY'].median(),inplace=True)\nselected_previous_application_sample['CNT_PAYMENT'].fillna(selected_previous_application_sample['CNT_PAYMENT'].median(),inplace=True)\n\nselected_previous_application_sample['AMT_GOODS_PRICE'].fillna(selected_previous_application_sample['AMT_GOODS_PRICE'].median(),inplace=True)\n","daf0b11d":"selected_previous_application_sample['NAME_TYPE_SUITE'].value_counts()","07077497":"selected_previous_application_sample['NAME_TYPE_SUITE'].fillna('Unaccompanied',inplace=True)\n","6e5f6611":"selected_previous_application_sample['PRODUCT_COMBINATION'].value_counts()","2ed7acf6":"selected_previous_application_sample['PRODUCT_COMBINATION'].fillna('Cash',inplace=True)","98e66d33":"selected_previous_application_sample.head()","df308ea2":"# Difference between the amount the client applied for and the awarded amount \nselected_previous_application_sample['APPLIED_AWARDED_AMOUNT_DIFF'] = selected_previous_application_sample[\"AMT_CREDIT\"] - selected_previous_application_sample[\"AMT_APPLICATION\"]","5cba4dfc":"selected_previous_application_sample['APPLIED_AWARDED_AMOUNT_DIFF'].describe()","82138b19":"# Difference between the price of goods and the loan amount the client applied for\nselected_previous_application_sample['GOODS_PRICE_APPLIED_DIFF'] = selected_previous_application_sample[\"AMT_GOODS_PRICE\"] - selected_previous_application_sample[\"AMT_APPLICATION\"]","cc49934d":"selected_previous_application_sample['GOODS_PRICE_APPLIED_DIFF'].describe()","006ace8e":"application_sample[\"NAME_TYPE_SUITE\"].value_counts()","6845f4d7":"installments_payments_sample.sample()","0adb95e9":"selected_previous_application_sample.sample()","44cd538f":"POS_CASH_balance_sample.sample()","80fb956c":"credit_card_balance_sample.sample()","26a0b1d4":"previous_balance.head()","72f103f8":"credit_card_balance_sample.merge(previous_balance,on=\"SK_ID_CURR\")","fde539a9":"dff = installments_payments_sample.merge(selected_previous_application_sample, on=['SK_ID_PREV','SK_ID_CURR']).\\\n                             merge(POS_CASH_balance_sample, on=['SK_ID_PREV','SK_ID_CURR']).\\\n                             merge(selected_application_sample,on='SK_ID_CURR')","c7d0237c":"# del installments_payments_sample \n# del selected_previous_application_sample \n# del POS_CASH_balance_sample \n# del selected_application_sample\n# gc.collect()","d2bbe239":"dff.tail()","daac16a3":"dff.info(verbose=True, show_counts=True)","f2d8a6ee":"categories = dff.select_dtypes(include=['object']).columns.tolist() \n# alternative \n# datatype = dff.dtypes\n# categories = datatype[(datatype == 'object') | (datatype == 'category')].index.tolist()","e5608204":"# pip install --upgrade scikit-learn\n","3aab2cd3":"from sklearn.preprocessing import OneHotEncoder\nfrom sklearn.compose import ColumnTransformer\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.model_selection import train_test_split\nimport xgboost as xgb\nfrom sklearn.metrics import average_precision_score, roc_auc_score, precision_score, recall_score, f1_score\n# This estimator is much faster than GradientBoostingClassifier for big datasets (n_samples >= 10 000).\n# https:\/\/scikit-learn.org\/stable\/modules\/ensemble.html#histogram-based-gradient-boosting\nfrom sklearn.ensemble import HistGradientBoostingClassifier","1751b049":"X = dff.drop([\"SK_ID_PREV\", \"SK_ID_CURR\",\"TARGET\"], axis=1)\ny = dff[\"TARGET\"]","6b344938":"random_state = 13\ntest_size = 0.3\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=test_size,\n                                                    random_state=random_state)","68d7762a":"# https:\/\/scikit-learn.org\/stable\/modules\/preprocessing.html#preprocessing-categorical-features\n# https:\/\/scikit-learn.org\/stable\/modules\/generated\/sklearn.compose.ColumnTransformer.html\ntransformer = ColumnTransformer(transformers=[('cat', OneHotEncoder(handle_unknown='ignore',drop='first'), categories)],remainder='passthrough')\n","a506c056":" # Model Parameters\nlearning_rate = 0.01\nmax_depth = 6\nmin_samples_leaf = 10\nrandom_state = 42\nmax_iter=100","3481fdad":"# Model: Define a Gradient Boosting Classifier\nmodel = HistGradientBoostingClassifier(learning_rate=learning_rate,\n                               max_depth=max_depth,\n                               max_iter=max_iter,\n                               min_samples_leaf=min_samples_leaf,\n                               random_state=random_state)\n\n# Pipeline fit\npipeline = Pipeline(steps=[('transformer', transformer), ('model', model)])\npipeline.fit(X_train, y_train)","f0f96a7c":"model.classes_[1]","57f0b005":"pipeline.classes_[1]","a3d34947":"# Predict probabilities of target\n# https:\/\/scikit-learn.org\/stable\/modules\/model_evaluation.html#roc-metrics\nprobs = pipeline.predict_proba(X_test)[:,1]\n# Calculate average precision and area under the receiver operating characteric curve (ROC AUC)\n# Precision is the ability of the classifier not to label as positive a sample that is negative, \n# and recall is the ability of the classifier to find all the positive samples.\n# AP summarizes a precision-recall curve as the weighted mean of precisions achieved at each threshold, \n# with the increase in recall from the previous threshold used as the weight. \navg_precision = average_precision_score(y_test, probs, pos_label=1)\n# The roc_auc_score function computes the area under the receiver operating characteristic (ROC) curve, \n# which is also denoted by AUC or AUROC. By computing the area under the roc curve, the curve information is summarized in one number.\n# A receiver operating characteristic (ROC), or simply ROC curve, is a graphical plot which illustrates the performance of \n# a binary classifier system as its discrimination threshold is varied. It is created by plotting the fraction of true positives out \n# of the positives (TPR = true positive rate) vs. the fraction of false positives out of the negatives (FPR = false positive rate), \n# at various threshold settings. TPR is also known as sensitivity, and FPR is one minus the specificity or true negative rate.\nauc = roc_auc_score(y_test, probs)","948967e3":"# Using the non-thresholded decision values given by the classifier.decision_function() method\nroc_auc_score(y_test, pipeline.decision_function(X_test))","deef05dc":"auc","e8a926e7":"avg_precision","8a9857ad":"### Previous application table","e79cb588":"### Application table","775b5dc9":"This is the main table, broken into two files for Train (with TARGET) and Test (without TARGET).\nStatic data for all applications. One row represents one loan in our data sample.","c5b7b133":"All previous applications for Home Credit loans of clients who have loans in our sample.\nThere is one row for each previous application related to loans in our data sample.","b47e9ab1":"### Join tables \ninstallments_payments_sample\n\nPOS_CASH_balance_sample\n\nselected_previous_application_sample\n\ncredit_card_balance_sample\n\nselected_application_sample\n\nprevious_balance","b3cce0eb":"#### Feature engineering \/ extraction\n","d59f0688":"### Model fitting","27b8cd84":"Repayment history for the previously disbursed credits in Home Credit related to the loans in our sample.\nThere is a) one row for every payment that was made plus b) one row each for missed payment.\nOne row is equivalent to one payment of one installment OR one installment corresponding to one payment of one previous Home Credit credit related to loans in our sample.","c95234be":"#### Feature engineering \/ extraction","9bb6f09a":"Monthly balance snapshots of previous credit cards that the applicant has with Home Credit.\nThis table has one row for each month of history of every previous credit in Home Credit (consumer credit and cash loans) related to loans in our sample \u2013 i.e. the table has (#loans in sample * # of relative previous credit cards * # of months where we have some history observable for the previous credit card) rows.","87fab9f3":"All client's previous credits provided by other financial institutions that were reported to Credit Bureau (for clients who have a loan in our sample).\nFor every loan in our sample, there are as many rows as number of credits the client had in Credit Bureau before the application date.","8aca96fc":"#### Feature engineering \/ extraction","7855bca3":"### Project Formulation\n\n","73f5f2e3":"Monthly balance snapshots of previous POS (point of sales) and cash loans that the applicant had with Home Credit.\nThis table has one row for each month of history of every previous credit in Home Credit (consumer credit and cash loans) related to loans in our sample \u2013 i.e. the table has (#loans in sample * # of relative previous credits * # of months in which we have some history observable for the previous credits) rows","edf6657b":"#### Feature engineering \/ extraction","e9db29fb":"### Credit card balance table","b91f2790":"#### Feature engineering \/ extraction","bcd350e1":"Monthly balances of previous credits in Credit Bureau.\nThis table has one row for each month of history of every previous credit reported to Credit Bureau \u2013 i.e the table has (#loans in sample * # of relative previous credits * # of months where we have some history observable for the previous credits) rows.","9eaec027":"Objective: Predict whether an applicant will be able to repay a loan.\n\nTarget: 1 - client with payment difficulties: he\/she had late payment more than X days on at least one of the first Y installments of the loan in our sample, 0 - all other cases\n\nFeatures: Application features, previous application features, bureau features, installment features, credit balance features, and POS cash balance features. ","e0bc784e":"### POS cash balance table","3d9dad83":"##### Feature engineering\/extraction","ec695b5a":"### Previous balance mid-level table","a83c9230":"### Bureau balance table","1a06505e":"### Bureau table","a4c7c6f0":"### Installments payments table"}}