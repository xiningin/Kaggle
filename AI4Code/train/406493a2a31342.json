{"cell_type":{"f763fef3":"code","39721500":"code","8eb4fab7":"code","eecf9d01":"code","2f5f75bc":"code","56cced2a":"code","185dc5f9":"code","80723d4c":"code","dc780672":"code","15b0029e":"code","4fe01a0c":"code","6af3ab2d":"code","c0271db2":"code","9f1f04fc":"code","21dd75a8":"code","fff5baa0":"markdown","a62016fc":"markdown","62cbdb1e":"markdown","3850d747":"markdown","28f982de":"markdown","0bb5ffe4":"markdown","d90c4454":"markdown","d32d6539":"markdown","7058194e":"markdown","53185675":"markdown","cf8ed94e":"markdown","5d19db9d":"markdown","b1454a08":"markdown","9e4417a0":"markdown","d77596b6":"markdown","01a397a3":"markdown","9befc30b":"markdown","1d80823e":"markdown","3688f60c":"markdown","dff9268c":"markdown","87533783":"markdown","e035225f":"markdown","918391c4":"markdown","3df9099b":"markdown","25458d30":"markdown","0a05b1ae":"markdown","7c132d3b":"markdown"},"source":{"f763fef3":"# Standard imports and imports for creating a .csv\nimport numpy as np\nimport os\nimport csv\nimport urllib\nimport json \nimport zipfile\nimport pandas as pd\n\n!pip install PyPDF2\n!pip install --upgrade pip\n!pip install requests\n\n\n\n# Import libraries for parsing\nimport PyPDF2 \nfrom nltk.tokenize import word_tokenize\nfrom nltk.corpus import stopwords\nimport fnmatch\n","39721500":"def get_files_words():\n    path = '..\/input\/data-science-for-good-city-of-los-angeles\/cityofla\/CityofLA\/Additional data\/PDFs'\n    filesread = 0\n        \n    filesread = 0\n    files = [os.path.join(dirpath, filename)\n        for dirpath, dirnames, files in os.walk(path)\n        for filename in files if filename.endswith('.pdf')]\n\n    filecount=len(files)\n        \n    while filesread <  filecount:\n            for file in files:\n                    csv_file_name = 'job_descriptions.csv'\n\n                    headers = ['Job Description', \"Year\"]\n                    \n                    fileerror = 0\n                    filegood = 0\n                      \n                    if os.path.isfile(csv_file_name):\n                            with open(csv_file_name, 'a') as outfile:\n                                    writer = csv.writer(outfile)\n                                    namesonly = file.split(\"\/\")\n                                    arraylen=len(namesonly)\n                                    try:\n                                        fileonly = namesonly[arraylen-1]\n                                        fileyear = namesonly[8]\n                                        writer.writerow([fileonly, fileyear])\n                                        filegood +=1\n                                    except:\n                                        fileerror +=1\n                    else:\n                            with open(csv_file_name, 'w') as outfile:\n                                    writer = csv.writer(outfile)\n                                    writer.writerow(headers)\n                                    namesonly = file.split(\"\/\")\n                                    arraylen=len(namesonly)\n                        \n                                    try:\n                                        fileonly = namesonly[arraylen-1]\n                                        fileyear = namesonly[8]\n                                        writer.writerow([fileonly, fileyear])\n                                        filegood +=1\n                                    except:\n                                        fileerror +=1\n                                        \n                    filesread +=1\n \n                    pdfFileObj = open(file,'rb')               ## open the file\n                    pdfReader = PyPDF2.PdfFileReader(pdfFileObj)   ## read the data in the file\n                    num_pages = pdfReader.numPages                 ## figure out the number of pages\n                    count = 0\n                    text = \"\"\n\n                    while count < num_pages:                       ## get a page\n                        pageObj = pdfReader.getPage(count)          \n                        count +=1\n                        text += pageObj.extractText()              ## extract the data from the page\n                        if text != \"\":\n                            text = text\n                                    \n                        else:\n                            text = textract.process(fileurl, method='tesseract', language='eng')\n                            \n                    global tokens\n                    tokens = word_tokenize(text)\n                    textlen = len(text) \n                    \n            print (filesread, \"files read\")\n            print (\"words in file: \",textlen)\n\n             \n\n","8eb4fab7":"get_files_words()","eecf9d01":"punctuations = ['(',')',';',':','[',']',',', \"$\", \"%\", \"\/\"]\nweb_characters =[ \"http\/\/\", \"http\", \".\", ['.'], \"-\", \"www\", \"\/\/\" \"https\"]\nstop_words = stopwords.words('english')","2f5f75bc":"def get_key_words():  \n    \n    keywords = [word for word in tokens if not word in stop_words \\\n                and not word in punctuations and not word in web_characters]\n\n    keywordct = len(keywords)\n    print(\"keyword count\", keywordct)\n\n\n    unique_keywords = set(keywords) \n    uniquect = len(unique_keywords)\n    print(\"unique count\", uniquect)\n\n\n    wordread = 0\n    global goodwords\n    goodwords=[]\n\n    while wordread < keywordct:\n            wordread +=1\n            \n    goodwords = [word.lower() for word in unique_keywords if word.isalpha()]\n\n    global goodwordct\n    goodwordct = len(goodwords)\n    print(\"good words\", goodwordct) \n","56cced2a":"get_key_words()","185dc5f9":"import requests\n\nindex = 0\nwordcode = 0 \n# goodwordct=10\ndictlist = []\ndropword = 0\ntwinword_key = \"null\"\n\nwhile wordcode < goodwordct:\n    myword = goodwords[index]\n    wordcode +=1\n    index +=1    \n\n    response = requests.get(\"https:\/\/twinword-language-scoring.p.rapidapi.com\/word\/\",\n            headers={\n                \"X-RapidAPI-Host\": \"twinword-language-scoring.p.rapidapi.com\",\n                \"X-RapidAPI-Key\": twinword_key,\n                \"Content-Type\": \"application\/x-www-form-urlencoded\"\n                       },\n                params={\n                  \"entry\": myword\n                }\n        )\n    \n    if response.status_code == 200:\n        try:\n            data =response.json()\n            worddiff = data.get(\"ten_degree\")\n            if type(worddiff) == int:\n                listdata = (worddiff, myword)\n                dictlist.append(listdata)\n            else:\n                print (\"Word Difficulty not found for: \", myword)\n        except:\n            dropword +=1\n        \nprint (\"words dropped\", dropword)","80723d4c":"def write_to_csv():\n    dict_list_sorted = sorted(dictlist, key=None, reverse=True)\n    output_dataframe = pd.DataFrame(dict_list_sorted,columns=[\"Word Difficulty\",'Word']) \n    csv_outfile_name = 'word_difficulty.csv'\n    output_dataframe.to_csv(csv_outfile_name , index=False)\n    ","dc780672":"write_to_csv()","15b0029e":"Male_Bias_csv = \"..\/input\/bais-word-lists\/Female-Bias-wordparts.csv\"\nwith open(Male_Bias_csv, 'r') as my_file:\n    reader = csv.reader(my_file, delimiter='\\t')\n    male_bias_words = list(reader)\nFemale_Bias_csv = \"..\/input\/bais-word-lists\/Female-Bias-wordparts.csv\"\nwith open(Female_Bias_csv, 'r') as my_file:\n    reader = csv.reader(my_file, delimiter='\\t')\n    female_bias_words = list(reader)\n","4fe01a0c":"dict_list_sorted = sorted(dictlist, key=None, reverse=True)\ngender_clean_dataframe = pd.DataFrame(dict_list_sorted)\ngender_clean_dataframe.columns = [\"Difficulty\",\"Word\"]\ngender_df =  gender_clean_dataframe[\"Word\"]\ngender_list = gender_df.values.tolist()","6af3ab2d":"male_matchbias = []\ntry:\n    male_matchbias = [s for s in gender_list if any(xs in s for xs in male_bias_words)]\nexcept:\n    pass\n\nif (len(male_matchbias)) == 0:\n    print (\"No male bias words were found\")\nelse:\n    print(\"Male bias words were found and exported\")\n    male_bias_out= pd.DataFrame(male_matchbias)\n    male_bias_out.columns = [\"Male Bias Words\"]\n    csv_outfile_name = 'Male Bias Words.csv'\n    male_bias_out.to_csv(csv_outfile_name , index=False, header =False)","c0271db2":"female_matchbias = []\ntry:\n    female_matchbias = [s for s in gender_list if any(xs in s for xs in female_bias_words)]\nexcept:\n    pass\n\n\nif (len(female_matchbias)) == 0:\n    print (\"No female bias words were found\")\nelse:\n    print(\"female bias words were found and exported\")\n    female_bias_out= pd.DataFrame(female_matchbias)\n    female_bias_out.columns = [\"female Bias Words\"]\n    csv_outfile_name = 'female Bias Words.csv'\n    female_bias_out.to_csv(csv_outfile_name , index=False, header =False)\n","9f1f04fc":"Age_Bias_csv = \"..\/input\/bais-word-lists\/age-bias-wordparts.csv\"\nwith open(Age_Bias_csv, 'r') as my_file:\n    reader = csv.reader(my_file, delimiter='\\t')\n    age_bias_words = list(reader)","21dd75a8":"age_matchbias = []\ntry:\n    age_matchbias = [s for s in gender_list if any(xs in s for xs in age_bias_words)]\nexcept:\n    pass\n\n\nif (len(age_matchbias)) == 0:\n    print (\"No age bias words were found\")\nelse:\n    print(\"Age bias words were found and exported\")\n    age_bias_out= pd.DataFrame(age_matchbias)\n    age_bias_out.columns = [\"Age Bias Words\"]\n    csv_outfile_name = 'Age Bias Words.csv'\n    female_bias_out.to_csv(csv_outfile_name , index=False, header =False)\n\n","fff5baa0":"Run the keyword extraction process","a62016fc":"Create a process to find all the PDF files on the drive, write them to list and count the number of files.  *Revised to get data from Kaggle Drive rather than Kaggle API.\n","62cbdb1e":"Note:  While this code worked successfully in my environment it required updates to run in Kaggle from not using the Kaggle API to replacing Unirest with requests (which would not install) to finding a way to not leverage Textract (which also would not install).","3850d747":"Specify words to exclude from level of difficulty tagging","28f982de":"Run the process to create the .csv","0bb5ffe4":"#### Compare words to list of known gender bias words and write output to files. ","d90c4454":"In conclusion, the City of Los Angeles Job descriptions showed no gender or age bias.\nHowever some words which may not be essential could limit accessibklity for those for whom English is not a first language.","d32d6539":"### Read the files and extract all the words \n##### Reference article: https:\/\/medium.com\/@rqaiserr\/how-to-convert-pdfs-into-searchable-key-words-with-python-85aab86c544f","7058194e":"Process for Female bias words and write matches to file","53185675":"Look up each word for level of difficulty (Twinword API) and write words and difficulty levels to a file","cf8ed94e":"Read list of age bias words from .csv (list compiles from articles)","5d19db9d":"## Part 3: Gender Bias\nReferencing this research article and acknowledging this tool: http:\/\/gender-decoder.katmatfield.com\/about#masculine, \nlook up words for contains male or femal bias words in the job description.","b1454a08":"## The goal of this project was to first extract all the \"real\" words from all the job decriptions in the Kaggle Challenge (link below) and then to look up the level of difficulty of the words to determine if language could be a barrier to diversity in hiring.\n### https:\/\/www.kaggle.com\/c\/data-science-for-good-city-of-los-angeles\/overview?utm_medium=email&utm_source=intercom&utm_campaign=data-science-for-good-2019.  ","9e4417a0":"Transform to lists for matching","d77596b6":"Test data for age bias.","01a397a3":"## Part 2: Detemine level of difficulty ","9befc30b":"Create a process to sort and output the data to a .csv file with the most difficult words at the top.","1d80823e":"Run the extraction and token process (Read all the files and words and tokenize.)","3688f60c":"## Part 1: Get the data from Kaggle and tokenize","dff9268c":"Set up libaries","87533783":"## Part 4: Age Bias","e035225f":"Compare words for age bias and write age bias words detected to .csv","918391c4":"Finally as this article points out you need to look for age bias.  \nhttps:\/\/www.linkedin.com\/in\/alison-doucette-5b40374\/","3df9099b":"Iterate through words looking up the level of difficulty and write to list.   Code replaced as Unirest could not be installed n Kaggle.","25458d30":"Process for Male bias words and write matches to file","0a05b1ae":"Import gender bias words from .csv","7c132d3b":"Create a process to extract keywords by exclusion and ensure the words are unique"}}