{"cell_type":{"8b58cd84":"code","5e5feb2f":"code","094941ff":"code","d5acd488":"code","b158a0c0":"code","ddc29026":"code","966c2a8d":"code","91d4c666":"code","15b78d75":"code","495dde9a":"code","dcf47022":"code","b24c241f":"code","6450de7b":"code","1725f1f4":"code","07952657":"code","214d3d16":"code","bebef76f":"code","3e5f5098":"code","37c7337d":"code","b83895a1":"code","d296da90":"code","de323181":"code","78fc2847":"code","a0f65b44":"code","c19c7e12":"code","2ce03fa1":"code","6e5943b1":"code","ca6f2ea8":"code","f61a1f7d":"code","5fbb1750":"code","8197d9b7":"code","d865d907":"code","fc92398e":"markdown","969890dc":"markdown","47bc435a":"markdown","0e55cbae":"markdown","5a1de6d7":"markdown","4e6a9729":"markdown","83a93780":"markdown","4d717129":"markdown","ee67f684":"markdown","96a7a96e":"markdown","52b69d19":"markdown","ba5d7d58":"markdown","3176b6a7":"markdown","5a46cca9":"markdown","9a87fbd6":"markdown","024263ce":"markdown","eaf03f21":"markdown","a202bf0a":"markdown","5bdc2335":"markdown"},"source":{"8b58cd84":"import numpy as np \nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport cv2\nimport warnings\nfrom sklearn.model_selection import train_test_split\nwarnings.filterwarnings('ignore')","5e5feb2f":"df = pd.read_csv('\/kaggle\/input\/dog-breed-identification\/labels.csv')","094941ff":"df.head(10)","d5acd488":"df.tail(10)","b158a0c0":"df.sample(10)","ddc29026":"df.describe()","966c2a8d":"breeds = df.breed.unique()\nbreeds","91d4c666":"len(breeds)","15b78d75":"row = df.iloc[0]\nimg = cv2.imread(\"\/kaggle\/input\/dog-breed-identification\/train\/\"+row.id+\".jpg\")\nplt.imshow(img)\nplt.title(row.breed)","495dde9a":"print(img.shape)\nIMAGE_WIDTH = img.shape[0]\nIMAGE_HEIGHT = img.shape[1]\nIMAGE_CHANNEL = img.shape[2]","dcf47022":"df[\"filename\"] = df['id'] + \".jpg\"\ndf.head()","b24c241f":"from tensorflow.keras.models import Sequential\nfrom tensorflow.keras.layers import Conv2D, MaxPooling2D, Flatten, Dense","6450de7b":"model = Sequential()\n\nmodel.add(Conv2D(64, kernel_size=(1, 1), activation=\"relu\", input_shape=(IMAGE_WIDTH, IMAGE_HEIGHT, IMAGE_CHANNEL)))\nmodel.add(MaxPooling2D())\n\nmodel.add(Conv2D(32, kernel_size=(1, 1), activation=\"relu\"))\nmodel.add(MaxPooling2D())\n\nmodel.add(Flatten())\nmodel.add(Dense(512, activation=\"relu\"))\nmodel.add(Dense(120, activation=\"softmax\"))\n\nmodel.compile(loss=\"categorical_crossentropy\", optimizer=\"adam\", metrics=['accuracy'])\nmodel.summary()","1725f1f4":"from tensorflow.keras.preprocessing.image import ImageDataGenerator","07952657":"# mini_df = df.groupby('breed').apply(lambda s: s.sample(50))","214d3d16":"# mini_df.head()","bebef76f":"train_df, valid_df = train_test_split(df, test_size=0.15, random_state=42)","3e5f5098":"train_gen = ImageDataGenerator(\n    rescale=1.0\/255,\n    rotation_range=15,\n    width_shift_range=0.2,\n    height_shift_range=0.2,\n    zoom_range=0.2,\n    horizontal_flip=True\n)\ntrain_generator = train_gen.flow_from_dataframe(\n    train_df,\n    directory=\"\/kaggle\/input\/dog-breed-identification\/train\", \n    x_col=\"filename\",\n    y_col=\"breed\",\n    target_size=(IMAGE_WIDTH, IMAGE_HEIGHT),\n    class_mode=\"categorical\"\n)","37c7337d":"valid_gen = ImageDataGenerator(\n    rescale=1.0\/255,\n    rotation_range=15,\n    width_shift_range=0.2,\n    height_shift_range=0.2,\n    zoom_range=0.2,\n    horizontal_flip=True\n)\nvalid_generator = train_gen.flow_from_dataframe(\n    valid_df,\n    directory=\"\/kaggle\/input\/dog-breed-identification\/train\", \n    x_col=\"filename\",\n    y_col=\"breed\",\n    target_size=(IMAGE_WIDTH, IMAGE_HEIGHT),\n    class_mode=\"categorical\"\n)","b83895a1":"from tensorflow.keras.callbacks import EarlyStopping, ReduceLROnPlateau","d296da90":"earlystop = EarlyStopping(patience=10)\nlearning_rate_reduction = ReduceLROnPlateau(patience=2, verbose=1, factor=0.5, min_lr=0.00001)","de323181":"model.fit_generator(train_generator, validation_data=valid_generator, epochs=1000, callbacks = [earlystop, learning_rate_reduction])","78fc2847":"scores = model.evaluate_generator(valid_generator)\nprint(\"Loss = \", scores[0])\nprint(\"Accuracy = \", scores[1])","a0f65b44":"model.save_weights(\"model.h5\")","c19c7e12":"test_df = pd.read_csv('\/kaggle\/input\/dog-breed-identification\/sample_submission.csv')","2ce03fa1":"test_df.head()","6e5943b1":"test_df[\"filename\"] = test_df['id'] + \".jpg\"","ca6f2ea8":"# mini_test_df = test_df.sample(300).reset_index()","f61a1f7d":"test_gen = ImageDataGenerator(rescale=1.0\/255)\ntest_generator = test_gen.flow_from_dataframe(\n    test_df,\n    directory=\"\/kaggle\/input\/dog-breed-identification\/test\", \n    x_col=\"filename\",\n    target_size=(IMAGE_WIDTH, IMAGE_HEIGHT),\n    class_mode=None\n)","5fbb1750":"predictions = model.predict_generator(test_generator)","8197d9b7":"labels = list(train_generator.class_indices.keys())\ncolumns = ['id'] + labels\nsubmission = pd.DataFrame(columns=columns)\nsubmission['id'] = mini_test_df.id\nsubmission[labels] = predictions","d865d907":"submission.head()","fc92398e":"Let create filename column","969890dc":"Image Shape","47bc435a":"# Evaluate Model","0e55cbae":"# Import Libraries","5a1de6d7":"submission.to_csv(\"submission.csv\")","4e6a9729":"See how our image look like","83a93780":"# Read test data","4d717129":"Create test generator","ee67f684":"# See Data format","96a7a96e":"# Prediction","52b69d19":"# Submission","ba5d7d58":"Create train generator","3176b6a7":"Create Validate Generator","5a46cca9":"See all breeds","9a87fbd6":"# Read Data","024263ce":"# Train model","eaf03f21":"# Define Model","a202bf0a":"Split our data into test and train","5bdc2335":"# Save our model weights"}}