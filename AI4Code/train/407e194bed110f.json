{"cell_type":{"287d47d3":"code","6c666e19":"code","1618e7d8":"code","d58f9393":"code","b63913ff":"code","1594a2af":"markdown"},"source":{"287d47d3":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport json\nfrom pprint import pprint\nimport matplotlib.pyplot as plt\nimport itertools\nfrom datetime import datetime, timedelta\n\n# import plotly\nfrom plotly import tools\nimport plotly.plotly as ply\nimport plotly.graph_objs as go\nimport folium as folium\nfrom folium.plugins import MarkerCluster\n\nfrom bokeh.plotting import figure, show, output_file\nfrom bokeh.tile_providers import CARTODBPOSITRON\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\n# print(os.listdir(\"..\/input\"))\n# Any results you write to the current directory are saved as output.\n","6c666e19":"# Get data\nstations = pd.read_csv(\"..\/input\/road-weather-information-stations.csv\")\nstations.sort_values(by=\"DateTime\")\n\n# Fix Type Casting\nstations['DateTime'] = pd.to_datetime(stations['DateTime'], format='%Y-%m-%dT%H:%M:%S')\n\nstations.reset_index(inplace=True, drop=True)\n# print(stations.columns)\n# print(stations.head())","1618e7d8":"# make a dictionary of all stations\n\nprint(stations[\"StationName\"].unique())\nstation_locs = stations[[\"StationName\", \"StationLocation\"]].drop_duplicates()\nstation_dict = {}\n\nfor i, row in station_locs.iterrows():\n    station_dict[row[\"StationName\"]] = {} \n    loc_list = row[\"StationLocation\"].replace(\"'\", '').strip(\"{}\").split(\",\")\n    loc_dict = []\n    \n    for x in loc_list:\n        loc_dict = loc_dict + x.strip().split(\":\")\n        station_dict[row[\"StationName\"]][loc_dict[0]]=0\n    loc_dict = [str(x).strip() for x in loc_dict]\n    station_dict[row[\"StationName\"]] = dict(itertools.zip_longest(*[iter(loc_dict)] * 2, fillvalue=\"\"))\n    \n# pprint(station_dict)","d58f9393":"# Map with all locations\nm = folium.Map(location=[47.6062, -122.3321], zoom_start=11, control_scale=True)\n\nfor station in station_dict:\n    latest_data = stations[stations[\"StationName\"] == station]\n    latest_time = latest_data[\"DateTime\"].max()\n    latest_data = latest_data[latest_data[\"DateTime\"] == latest_time].drop_duplicates()\n    temp = np.float(latest_data[\"RoadSurfaceTemperature\"])\n    \n    if  temp<= 32.0:\n        c = 'red'\n    elif temp <= 40.0:\n        c = 'orange'\n    else:\n        c = 'green'\n\n    m.add_child(folium.Marker(location = [np.float(station_dict[station]['latitude']),\n                                           np.float(station_dict[station]['longitude'])], icon=folium.Icon(color=c, icon='circle')))\ndisplay(m)","b63913ff":"# plot last air temp versus for last hour all stations\n# these two lines are what allow your code to show up in a notebook!\nfrom plotly.offline import init_notebook_mode, iplot\ninit_notebook_mode()\n\n# create figure\n# fig = tools.make_subplots(rows=len(stations[\"StationName\"].unique()), cols=1)\nplot_data = []\nlayout = dict(title = \"Temperature - last 24hrs reported\",\n              xaxis= dict(title= 'Date',ticklen= 5,zeroline= False))\nN = 20\ncolors = plt.cm.gist_rainbow(np.linspace(0, 1, N))\n\n# specify that we want a scatter plot with, with date on the x axis and meet on the y axis\nfor i,station in enumerate(stations[\"StationName\"].unique()):\n    data = stations[stations[\"StationName\"] == station].sort_values(by=\"DateTime\")\n    last_time = data[\"DateTime\"].max()\n    first_time = last_time - timedelta(hours=24)\n    data = data[(data[\"DateTime\"] <= last_time) & (data[\"DateTime\"] >= first_time)]\n    rs_data = go.Scatter(x=data.DateTime, y=data.RoadSurfaceTemperature, name=f'{station} Road Surface Temp')\n    at_data = go.Scatter(x=data.DateTime, y=data.AirTemperature, name=f'{station} Air Temp')\n    plot_data = [rs_data, at_data]\n# create and show our figure\nfig = dict(data = plot_data, layout = layout)\niplot(fig)","1594a2af":"**Road Temperature Measurement Stations**\n* red <= 32 deg F\n* orange <= 40 deg F\n* green > 40 deg F"}}