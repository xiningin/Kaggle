{"cell_type":{"791db579":"code","f9a50f4c":"code","2bef801c":"code","6d92ed4c":"code","f8d03451":"code","252c88d7":"code","9fc9e03a":"code","03692ca4":"code","9216f7c8":"code","dede4704":"code","472dad78":"code","814227fd":"code","fd82e2a1":"code","a83f5669":"code","662ff017":"code","fbd67a71":"code","d41893bc":"code","0b8e23b8":"code","e3d75bd6":"code","76ee0025":"code","ca555593":"code","baec05a2":"code","d7077563":"code","7f2e738a":"code","db0396bf":"code","22e9a768":"code","c26dd6d0":"code","9662b6b2":"code","719fbdeb":"code","09f17f2e":"code","4647bd5e":"markdown","a4253d6a":"markdown","46731f1c":"markdown","24fcdb2f":"markdown","a3e33583":"markdown","cc32cd89":"markdown","60e7dd77":"markdown","f3056960":"markdown","b88d6a2c":"markdown","b91e5008":"markdown","e8584ad2":"markdown","9dfefce0":"markdown","ffab108d":"markdown","fad361d6":"markdown","a29e0596":"markdown","0e58c735":"markdown","094db3d4":"markdown","bd79bddd":"markdown","243cf9c1":"markdown","92610f4b":"markdown","224c8638":"markdown","308d474b":"markdown","60c5d6ed":"markdown","bb11c1f1":"markdown","1f25f409":"markdown"},"source":{"791db579":"import warnings\n\nwarnings.simplefilter(action='ignore', category=FutureWarning)\nwarnings.simplefilter(action='ignore', category=DeprecationWarning)\n\nimport os\nimport pandas as pd\n\nDATA_DIR = '..\/input\/cand-multi-stellar-dr1'\nDASCH_DIR = os.path.join(DATA_DIR, 'dasch')","f9a50f4c":"dim_candidates = pd.read_csv(os.path.join(DATA_DIR, 'clustered-dim-candidates.csv'), dtype={'source_id': str})","2bef801c":"len(dim_candidates[dim_candidates['dasch_id'] != 'None'])","6d92ed4c":"bright_candidates = pd.read_csv(os.path.join(DATA_DIR, 'clustered-bright-candidates.csv'), dtype={'source_id': str})","f8d03451":"len(bright_candidates[bright_candidates['dasch_id'] != 'None'])","252c88d7":"normal_controls = pd.read_csv(os.path.join(DATA_DIR, 'normal-controls.csv'), dtype={'source_id': str})","9fc9e03a":"len(normal_controls[normal_controls['dasch_id'] != 'None'])","03692ca4":"# See http:\/\/dasch.rc.fas.harvard.edu\/database.php#AFLAGS_ext\nAFLAGS_BAD_BIN = 0x800000\nAFLAGS_DEFECTIVE = 0x2000000","9216f7c8":"def read_dasch_lc(source_id, dasch_id, is_gaia_dr2_id=True):\n    file_name_prefix = 'short_' + ('Gaia_DR2_' if is_gaia_dr2_id else 'TYC_') + source_id + '_' + dasch_id\n    files = os.listdir(DASCH_DIR)\n    matching_files = [file for file in files if file.startswith(file_name_prefix)]\n    lmf = len(matching_files)\n    if lmf == 0:\n        raise ValueError('No matching file starting with %s' % file_name_prefix)\n    if lmf > 1:\n        print('WARNING: More than one matching file for source_id=%s' % source_id)        \n    file_name = matching_files[0]\n    raw_table = pd.read_table(os.path.join(DASCH_DIR, file_name), skiprows=[0,2])\n    # Remove defective data points\n    aflags = raw_table['AFLAGS'];\n    is_defective = (aflags & AFLAGS_BAD_BIN != 0) | (aflags & AFLAGS_DEFECTIVE != 0) \n    corrected_table = raw_table[~is_defective]\n    # Simplify the table\n    result = pd.DataFrame()\n    result['year'] = corrected_table['year']\n    result['Date'] = corrected_table['Date']\n    result['magcal_magdep'] = corrected_table['magcal_magdep']\n    return result","dede4704":"dasch_frame_map = dict()","472dad78":"def extract_dasch_frames(gaia_frame):\n    has_tycho2_id = 'tycho2_id' in gaia_frame.columns \n    for _, row in gaia_frame.iterrows():\n        source_id = row['source_id']\n        dasch_id = row['dasch_id']\n        if dasch_id != 'None':\n            retrieval_id_column = 'tycho2_id' if has_tycho2_id else 'source_id'\n            retrieval_id = row[retrieval_id_column]\n            dasch_frame = read_dasch_lc(retrieval_id, dasch_id, is_gaia_dr2_id=not has_tycho2_id)\n            dasch_frame_map[source_id] = dasch_frame","814227fd":"extract_dasch_frames(normal_controls)\nextract_dasch_frames(dim_candidates)\nextract_dasch_frames(bright_candidates)","fd82e2a1":"from scipy import stats\nimport numpy as np\n\ndef get_trend_frame(gaia_frame, pre_mg=False):\n    has_tycho2_id = 'tycho2_id' in gaia_frame.columns\n    results = pd.DataFrame(columns=['source_id', 'tycho2_id', 'slope', 'confidence_interval', 'sigmas'])\n    for _, row in gaia_frame.iterrows():\n        source_id = row['source_id']\n        tycho2_id = row['tycho2_id'] if has_tycho2_id else ''\n        dasch_frame = dasch_frame_map.get(source_id)\n        if dasch_frame is not None:\n            if pre_mg:\n                dasch_frame = dasch_frame[dasch_frame['year'] <= 1960].reset_index(drop=True)\n            if len(dasch_frame) < 200:\n                continue\n            slope, _, _, _, std_err = stats.linregress(dasch_frame['year'] - 1880, dasch_frame['magcal_magdep'])\n            confidence_interval = 1.96 * std_err\n            slope_cent = slope * 100\n            confidence_interval_cent = confidence_interval * 100\n            results.loc[len(results)] = [source_id, tycho2_id, slope_cent, confidence_interval_cent, slope \/ std_err]\n    return results","a83f5669":"def style_function(value):\n    significant = np.abs(value) > 3.0\n    color = ('red' if value < 0 else 'blue') if significant else 'black'\n    font_weight = 'bold' if significant else 'plain'\n    return 'color: %s; font-weight: %s' % (color, font_weight,)","662ff017":"def show_results(gaia_frame, pre_mg=False):\n    trend_frame = get_trend_frame(gaia_frame, pre_mg=pre_mg)\n    return trend_frame.style.applymap(style_function, subset=['sigmas'])","fbd67a71":"show_results(dim_candidates)","d41893bc":"show_results(bright_candidates)","0b8e23b8":"show_results(dim_candidates, pre_mg=True)","e3d75bd6":"show_results(bright_candidates, pre_mg=True)","76ee0025":"from scipy.stats import ttest_ind\nimport statsmodels.stats.api as sms\n\ndef print_t_test(gaia_frame1, gaia_frame2, column_name='slope', pre_mg=False):\n    trend_frame1 = get_trend_frame(gaia_frame1, pre_mg=pre_mg)\n    trend_frame2 = get_trend_frame(gaia_frame2, pre_mg=pre_mg)\n    values1 = trend_frame1[column_name].values\n    values2 = trend_frame2[column_name].values\n    cm = sms.CompareMeans(sms.DescrStatsW(values1), sms.DescrStatsW(values2))\n    confint_low, confint_high = cm.tconfint_diff()\n    mean1 = np.mean(values1)\n    mean2 = np.mean(values2)\n    statistic, pvalue = ttest_ind(values1, values2)\n    print('Mean Difference: %.3f [95%% CI %.3f to %.3f]' % (mean1 - mean2, confint_low, confint_high,))\n    print('Statistic: %.4f | p-value: %.6f' % (statistic, pvalue,))","ca555593":"print_t_test(dim_candidates, normal_controls)","baec05a2":"print_t_test(dim_candidates, normal_controls, pre_mg=True)","d7077563":"print_t_test(bright_candidates, normal_controls)","7f2e738a":"print_t_test(bright_candidates, normal_controls, pre_mg=True)","db0396bf":"import plotly.offline as py\nimport plotly.graph_objs as go\n\npy.init_notebook_mode(connected=False)","22e9a768":"def plot_group_diffs(exp_group, title):\n    exp_trend_frame = get_trend_frame(exp_group)\n    normal_trend_frame = get_trend_frame(normal_controls)\n    trace0 = go.Box(\n        name='Candidates',\n        y=exp_trend_frame['slope']\n    )\n    trace1 = go.Box(\n        name='Ordinary stars',  \n        y=normal_trend_frame['slope']\n    )\n    data = [trace0, trace1]\n    layout = go.Layout(\n        showlegend=False,\n        title=title,\n        yaxis=dict(\n            title='DASCH slope (magnitudes \/ century)',\n        )\n    )\n    fig = go.Figure(data=data, layout=layout)\n    py.iplot(fig)","c26dd6d0":"plot_group_diffs(dim_candidates, 'Anomalously dim candidates vs. controls')","9662b6b2":"plot_group_diffs(bright_candidates, 'Anomalously bright candidates vs. controls')","719fbdeb":"def show_dasch_lightcurve(source_id, source_name):\n    dasch_frame = dasch_frame_map[source_id]\n    year_series = dasch_frame['year']\n    points_trace = go.Scatter(\n                    name='Observation',\n                    x=year_series,\n                    y=dasch_frame['magcal_magdep'],\n                    mode='markers',\n                    marker=go.scatter.Marker(color='rgb(255, 127, 14)')\n                    )\n    slope, intercept, _, _, std_err = stats.linregress(year_series, dasch_frame['magcal_magdep'])\n    line_trace = go.Scatter(x=year_series, \n                    name='Fit',\n                    y=year_series * slope + intercept,\n                    mode='lines',\n                    line=dict(color='blue', width=3)\n                    )\n    annotation = go.layout.Annotation(\n                    x=1970,\n                    y=1979 * slope + intercept - 1.5,\n                    text='%.2f \u00b1 %.2f mag\/century' % (slope * 100, 1.96 * std_err * 100,),\n                    showarrow=False,\n                    font=go.layout.annotation.Font(size=16, color='blue'),\n                  )\n    layout = go.Layout(\n                    showlegend=False,\n                    title='DASCH light curve of ' + source_name,\n                    annotations=[annotation],\n                    xaxis=dict(\n                        title='Year'\n                    ),\n                    yaxis=dict(\n                        title='Magnitude',\n                        autorange='reversed'\n                    )\n                )\n    data = [points_trace, line_trace]\n    fig = go.Figure(data=data, layout=layout)\n    py.iplot(fig)","09f17f2e":"show_dasch_lightcurve('2097850907148567424', 'TYC 3105-1212-1')","4647bd5e":"It's still significant, but not as much (~98% confidence level). The difference between group means is actually larger, but we're dealing with less data. That's why the confidence interval is wider.\n\nLet's now look at anomalously bright candidates.","a4253d6a":"## TYC 3105-1212-1\nOne of the dim candidates stands out not only because of its DASCH slope and the characteristics that make it a candidate, but we've also found it to have dimmed significantly in the last 15 to 25 years, based on a separate analysis.\n\nThe Tycho2 ID of the candidate we're singling out is **TYC 3105-1212-1**. It can also be referred to as **Gaia DR2 2097850907148567424**.\n\nLet's take a look at its DASCH light curve.","46731f1c":"Let's now load the anomalously bright candidates.","24fcdb2f":"Let's start by comparing anomalously dim candidates with ordinary controls. ","a3e33583":"## Data\nWe'll use a [dataset of Dysonian SETI candidates](https:\/\/www.kaggle.com\/solorzano\/dysonian-seti-candidates-dr1) produced by kernels *[Multi-Stellar SETI Candidate Selection Part 2](https:\/\/www.kaggle.com\/solorzano\/multi-stellar-seti-candidate-selection-part-2)* and *[Part 3](https:\/\/www.kaggle.com\/solorzano\/multi-stellar-seti-candidate-selection-part-3)*. The dataset includes century-long photometry from the DASCH archive, if available.\n\nLet's load anomalously dim candidates.","cc32cd89":"## References\nLund et al. (2016). *The Stability of F-star Brightness on Century Timescales*. arXiv:1605.02760\n\nSchaefer, B. E. (2016). *KIC 8462852 Faded at an Average Rate of 0.165+-0.013 Magnitudes Per Century\nFrom 1890 To 1989*. arXiv:1601.03256\n\nTang, S., Grindlay, J., Los, E., et al. (2013). *Improved Photometry for the DASCH Pipeline*. PASP,\n125(929):857\u2013865.","60e7dd77":"Let's load DASCH files into data frames, and put them in a dictionary whose keys are Gaia DR2 *source_id* values.","f3056960":"## Student's t-tests\nSignificant DASCH trends occur considerably more often than would be expected by chance (Lund et al. 2016) if we were to assume all stars have a Ground Truth brightness trend of zero. That's not a consequence of the type of noise. It can be shown, using bootstrapping, that the standard confidence interval is more or less accurate. Substantial trend variance does exist in DASCH data, whether its cause is systematic or astrophysical.\n\nIt is therefore reasonable to compare our candidate trends with DASCH trends of a set of ordinary control stars. The following function calculates a difference of group means, and it also performs a two-tailed Student's t-test.","b88d6a2c":"Before we show data frames with candidate results, let's define some frame styles we can use to highlight steep (> 3-sigma) dimming trends in blue and steep brightening trends in red. ","b91e5008":"The trends of dim candidates are ~0.2 magnitudes per century higher than those of ordinary controls. The p-value is highly significant in this case (~99.99% confidence level).\n\nWhat if we only look at data prior to the Menzel Gap?","e8584ad2":"## Slopes and confidence intervals\nThe following function takes one of our candidate\/control data frames and produces a new data frame with information on the DASCH slope, the 95% confidence interval, and the sigma anomaly (i.e. ratio to standard error) of the slope.","9dfefce0":"Prior to the Menzel Gap, the difference between bright candidates and ordinary controls is even more significant (~99.9% confidence level).","ffab108d":"Here the confidence level is ~98.6%.","fad361d6":"Only a fraction of these candidates were found in DASCH.","a29e0596":"## Pre-Menzel Gap\nLund et al. (2016) and others have suggested that the apparently significant DASCH dimming trend of KIC 8462852 (Schaefer 2016) is an artifact of a Menzel Gap systematic. We can show results calculated using only data prior to the Menzel Gap (which we're defining as 1960) by passing a *pre_mg* parameter to the *show_results* function.","0e58c735":"## Reading DASCH files\nWe exclude rows from DASCH tabular files that have certain quality flags set.","094db3d4":"Surprisingly, we find that 2 of the 5 \"candidates\" that are anomalously bright also have very significant brightening trends.","bd79bddd":"Now we can show our results data frame for dim candidates.\n<a id=\"dim_candidates_table\"><\/a>","243cf9c1":"Out of the 6 anomalously dim candidates with a DASCH match, 4 have a fast dimming trend with at least 3-sigma significance.\n<a id=\"bright_candidates_table\"><\/a>","92610f4b":"The dataset provides a list of ordinary stars that was produced via random sampling by [Version 3 of an early Dysonian SETI kernel](https:\/\/www.kaggle.com\/solorzano\/dysonian-seti-with-machine-learning\/output?scriptVersionId=4507617).","224c8638":"Two of the anomalously dim candidates still show dimming trends above the 3-sigma level. Additionally, TYC 1554-1671-1 has a trend above the 2-sigma level, and TYC 2114-1950-1 is near 2-sigma and above the 95% confidence level. A surprise in these findings is that TYC 7178-1183-1 has a highly significant *brightening* trend prior to the Menzel Gap, but overall seems nominal.","308d474b":"## Overview\nThe brightness trends of Dysonian SETI candidate stars are analyzed in this kernel. Candidates were obtained using a [two-metric approach](https:\/\/www.kaggle.com\/solorzano\/multi-stellar-seti-candidate-selection-part-1) based on the hypothesis that extraterrestrial civilizations capable of building detectable astroengineering would likely colonize multiple stars. Trends are calculated using century-long magnitude data from the [DASCH archive](http:\/\/dasch.rc.fas.harvard.edu\/lightcurve.php). DASCH data, spanning from 1886 to 1989, is independent from the databases used to train the [magnitude model](https:\/\/www.kaggle.com\/solorzano\/new-stellar-magnitude-model-dysonian-seti) we rely on for candidate selection.\n\nOf 45 anomalously dim candidates, only 6 were found in DASCH. Of the 6, 4 have a highly significant (> 3-sigma) dimming trend. Of 5 anomalously bright candidates with a DASCH match, 2 have a highly significant brightening trend.\n\nSignificant DASCH trends are not uncommon (Lund et al. 2016). Therefore, we also compare candidate trends with those of a control group of ordinary stars, using t-tests. We find highly significant p-values, with confidence levels ranging from 98% to 99.99%. Significance is maintained even if we only analyze data prior to the Menzel Gap (i.e. 1960).\n\n**TYC 3105-1212-1** is singled out as the star with the steepest dimming trend of those analyzed (~8.8-sigma significance). It's also anomalously dim (top 1.7% of the [magnitude anomaly](https:\/\/www.kaggle.com\/solorzano\/new-stellar-magnitude-model-dysonian-seti) metric) and its neighbors have an *anomaly* distribution that is heavily [skewed right](https:\/\/www.kaggle.com\/solorzano\/multi-stellar-seti-candidate-selection-part-2). In a separate analysis, we've also found evidence that TYC 3105-1212-1 has continued to fade significantly in the last 15 to 25 years.\n\nThe results presented in this kernel strongly argue in favor of a multi-metric approach in the search for extraterrestrial astroengineering.","60c5d6ed":"## Visualization of group differences\nLet's come up with some box plots to illustrate group differences.","bb11c1f1":"## Acknowledgments\nThis work has made use of data from the European Space Agency (ESA) mission Gaia (https:\/\/www.cosmos.esa.int\/gaia), processed by the Gaia Data Processing and Analysis Consortium (DPAC, https:\/\/www.cosmos.esa.int\/web\/gaia\/dpac\/consortium). Funding for the DPAC has been provided by national institutions, in particular the institutions participating in the Gaia Multilateral Agreement.","1f25f409":"When it comes to anomalously bright \"candidates\", their brightening trends become considerably more significant prior to the Menzel Gap. "}}