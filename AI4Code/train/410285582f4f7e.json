{"cell_type":{"4da66867":"code","8974ef54":"code","9347608e":"code","7c382b59":"code","289d269b":"code","a1770a0f":"code","ae51b718":"code","818722b2":"code","772f9a48":"code","45008e23":"code","a34b5ae6":"code","69af3b45":"code","57471890":"code","5e192e9c":"code","93ca6e84":"code","6d1f5720":"code","740a899b":"code","217811c7":"code","516dbebd":"code","d31bf58d":"code","832d9b02":"code","7feded2c":"code","967f856a":"code","3b880443":"code","de9e7311":"code","a2fe3d0e":"code","a6bb3a5c":"code","06d1b596":"markdown","8514dfac":"markdown","61631846":"markdown","7fe0cb02":"markdown","e024223f":"markdown","f01ca72b":"markdown","ea08b726":"markdown"},"source":{"4da66867":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport seaborn as sns\nsns.set()\nimport matplotlib.pyplot as plt\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","8974ef54":"data_train = pd.read_csv('..\/input\/train_users_2.csv',parse_dates=['timestamp_first_active','date_account_created','date_first_booking'])\ndata_test = pd.read_csv('..\/input\/test_users.csv',parse_dates=['timestamp_first_active','date_account_created','date_first_booking'])\ndata_train.head()","9347608e":"data_test.head()\n# Note that 'date_first_booking' is completely missing in test data","7c382b59":"# Note incorrect minimum and maximum age values\ndata_train.describe()","289d269b":"print ('Number of lines in the training data are,',data_train.shape[0])","a1770a0f":"countries = pd.read_csv('..\/input\/countries.csv')\ncountries.head(10)","ae51b718":"test_ids = data_test['id']\nNrows_train = data_train.shape[0]  \n\n# Store country names\nlabels = data_train['country_destination'].values\ndata_train1 = data_train.drop(['country_destination'], axis=1)\n\n# Combining the test and train data. If this is not done, the number of dummy variable columns do not match in test and train data.\n# Some items present in train data and are not present in test data. For example, browser type. \ndata_all = pd.concat((data_train1, data_test), axis = 0, ignore_index = True)\n\n# Dropping ids which are saved separately and date of first booking which is completely absent in the test data\ndata_all = data_all.drop(['id','date_first_booking'], axis=1)\n","818722b2":"data_all.head()","772f9a48":"print(data_all.isnull().sum())","45008e23":"data_all.gender.replace('-unknown-', np.nan, inplace=True)\ndata_all.first_browser.replace('-unknown-', np.nan, inplace=True)","a34b5ae6":"data_all.loc[data_all.age > 100, 'age'] = np.nan\ndata_all.loc[data_all.age < 18, 'age'] = np.nan","69af3b45":"# Splitting date time data for date account created\ndata_all['dac_year'] = data_all.date_account_created.dt.year\ndata_all['dac_month'] = data_all.date_account_created.dt.month\ndata_all['dac_day'] = data_all.date_account_created.dt.day\n\n# Splitting date time data for time first active\ndata_all['tfa_year'] = data_all.timestamp_first_active.dt.year\ndata_all['tfa_month'] = data_all.timestamp_first_active.dt.month\ndata_all['tfa_day'] = data_all.timestamp_first_active.dt.day\n\ndata_all.drop('date_account_created',1, inplace=True)\ndata_all.drop('timestamp_first_active',1, inplace=True)","57471890":"data_all.head()","5e192e9c":"data_all.describe()","93ca6e84":"data_all.groupby('gender').age.agg(['min','max','mean','count'])","6d1f5720":"data_all.groupby('gender').age.mean().plot(kind='bar')","740a899b":"data_all.gender.value_counts(dropna=False).plot(kind='bar')","217811c7":"data_all.dac_year.value_counts(sort=False).plot(kind='bar', title='Number of User Accounts Created in a Year')","516dbebd":"data_all.tfa_year.value_counts(sort=False).plot(kind='bar', title = 'Number of Users by First Active Year')","d31bf58d":"data_train.country_destination.value_counts(normalize=True).plot(kind='bar',title='Countries Visited by AirBNB Users')","832d9b02":"data_all.language.value_counts(sort=True)","7feded2c":"#Note no null data now left\nprint(data_all.isnull().sum())","967f856a":"# Import sklearn.preprocessing.StandardScaler\n#from sklearn.preprocessing import MinMaxScaler\n\n# Initialize a MinMax scaler, then apply it to the numerical features\n#scaler = MinMaxScaler()\n#numerical = ['age','dac_year','dac_month','dac_day','tfa_year','tfa_month','tfa_day']\n#data_all[numerical] = scaler.fit_transform(data_all[numerical])\n\n# Create categorical columns\nfeatures = ['gender','signup_method','signup_flow','language','affiliate_channel','affiliate_provider',\\\n            'first_affiliate_tracked','signup_app','first_device_type','first_browser']\n\n# get dummies\ndata_all = pd.get_dummies(data_all,columns=features)\n","3b880443":"data_all.describe()","de9e7311":"data_all.head()","a2fe3d0e":"# Splitting train and test for the classifier\nfrom xgboost.sklearn import XGBClassifier\nfrom sklearn.preprocessing import LabelEncoder\n\nV = data_all.values\nX_train = V[:Nrows_train]\nX_test = V[Nrows_train:]\n\n#Create labels\nlabler = LabelEncoder()\ny = labler.fit_transform(labels)\n\n# Implementation of the classifier (decision tree)\nxgb = XGBClassifier(max_depth=6, learning_rate=0.3, n_estimators=22,\n                    objective='multi:softprob', subsample=0.6, colsample_bytree=0.6, seed=0)               \nxgb.fit(X_train, y)\ny_pred = xgb.predict_proba(X_test) ","a6bb3a5c":"#Taking the 5 classes with highest probabilities\nids = []  #list of ids\ncts = []  #list of countries\nfor i in range(len(test_ids)):\n    idx = test_ids[i]\n    ids += [idx] * 5\n    cts += labler.inverse_transform(np.argsort(y_pred[i])[::-1])[:5].tolist()\n\n#Generate submission\nsub = pd.DataFrame(np.column_stack((ids, cts)), columns=['id', 'country'])\nsub.to_csv('submission.csv',index=False)","06d1b596":"**Countries visited by Air BnB Users**\n\nIt looks for bulk of data there is no country desitnation specified. Second most visited place by users of Air BnB users is United States. ","8514dfac":"**Preprocessing Data \n**\n\n*Normalizing Numerical Features*\n\nOnly numerical data of age, year, date, day is normalized","61631846":"**Yearly growth of number of accounts created**","7fe0cb02":"![](https:\/\/cdn-images-1.medium.com\/max\/1600\/1*yZ1LPIcXnnW6Ubmp2M-0rQ.png)","e024223f":"**Data Cleanup**\n\n1. Replace missing age and first_browser to NAN\n3. Age will be filtered between 18-100 and set to NAN\n4. Date time data of 'time_first_active' and 'timestamp_first_active' to be split into day, month and year columns\n5. Categorization of all non-numeric data such as gender, language, device type, browser type etc. \n6. Drop 'time_first_active', 'date_of_boking' and timestamp_first_active' \n7. Store IDs separately\n8. Save 'country_destination' as target variable","f01ca72b":"**Age and Gender**\n\nNow we will explore to know, genderwise split among the users through number of males\/females and average age of users in each category. \n\n* Average age of the users hovers around 35. \n* There are more females users than male. ","ea08b726":"**Number of Users by Language**\n\nIt looks like most users are English speaks. "}}