{"cell_type":{"f480da34":"code","c6dd3cff":"code","82544fbc":"code","d25e838a":"code","f56726c7":"code","642cd208":"code","39aebafd":"code","c727b370":"code","21bb8bf1":"code","55069a1b":"code","fe266e79":"code","8059035d":"code","fad9af0d":"code","6a545b40":"markdown","512d7806":"markdown","54588106":"markdown"},"source":{"f480da34":"pip install -U lightautoml","c6dd3cff":"# Standard python libraries\nimport os\nimport time\nimport re\n\n# Installed libraries\nimport numpy as np\nimport pandas as pd\nfrom sklearn.metrics import log_loss\nfrom sklearn.model_selection import train_test_split\n\n# Imports from our package\nfrom lightautoml.automl.presets.tabular_presets import TabularAutoML, TabularUtilizedAutoML\nfrom lightautoml.tasks import Task\nfrom lightautoml.dataset.roles import NumericRole","82544fbc":"train=pd.read_csv('..\/input\/tabular-playground-series-jun-2021\/train.csv')\ntest=pd.read_csv('..\/input\/tabular-playground-series-jun-2021\/test.csv')\nsub=pd.read_csv('..\/input\/tabular-playground-series-jun-2021\/sample_submission.csv')","d25e838a":"conditions = [\n    (train.target == \"Class_1\"), (train.target == \"Class_2\"), (train.target == \"Class_3\"),\n    (train.target == \"Class_4\"), (train.target == \"Class_5\"), (train.target == \"Class_6\"),\n    (train.target == \"Class_7\"), (train.target == \"Class_8\"), (train.target == \"Class_9\")\n]\nchoices = [0, 1, 2, 3, 4, 5, 6, 7, 8]\ntrain[\"target\"] = np.select(conditions, choices)","f56726c7":"#X_test = test.drop(['id'], axis=1)\n#X = train.drop(['id', 'target'], axis=1)\n#y = train.target","642cd208":"N_THREADS = 4 # threads cnt for lgbm and linear models\nN_FOLDS = 5 # folds cnt for AutoML\nRANDOM_STATE = 42 # fixed random state for various reasons\nTEST_SIZE = 0.2 # Test size for metric check\nTIMEOUT = 8 * 3600 # Time in seconds for automl run\nTARGET_NAME = 'target'\n\ntask = Task('multiclass',)\n\nroles = {\n    'target': TARGET_NAME,\n    'drop': ['id'],\n}","39aebafd":"%%time\n\nautoml = TabularUtilizedAutoML(task = task, \n                               timeout = 60*60*8,\n                               cpu_limit = N_THREADS,\n                               general_params = {\n                                   'use_algos': [['lgb_tuned', 'cb_tuned'], ['lgb_tuned', 'cb_tuned']],\n                                   'return_all_predictions': True,\n                                   'weighted_blender_max_nonzero_coef': 0.0\n                               },\n                               #tuning_params = {'max_tuning_time': 60*5},\n                               reader_params = {'n_jobs': N_THREADS},\n                               #config_path = '..\/input\/lightautoml-configs\/conf_0_sel_type_0.yml'\n                               )\noof_pred = automl.fit_predict(train, roles = roles)","c727b370":"test_pred = automl.predict(test)","21bb8bf1":"#columns = ['pred_Linear_' + str(i) for i in range(1, 10)] + \\\n#          ['pred_LGBM_' + str(i) for i in range(1, 10)] + \\\n#          ['pred_CB_' + str(i) for i in range(1, 10)] ","55069a1b":"#OOF_preds = pd.DataFrame(oof_pred.data, columns = columns)\n#TEST_preds = pd.DataFrame(test_pred.data, columns = columns)","fe266e79":"sub.iloc[:, 1:] = test_pred.data\nsub.to_csv('sub_lightautoml.csv', index = False)\n\npd.concat([train.id, pd.DataFrame(oof_pred.data, columns=['Class_' + str(i) for i in range(1, 10)] )], axis=1).\\\nto_csv('oof_lightautoml.csv', index = False)","8059035d":"#pred1 = TEST_preds.iloc[:, 0:9]\n#pred2 = TEST_preds.iloc[:, 9:18]\n#pred3 = TEST_preds.iloc[:, 18:27]\n#\n#preds = pd.DataFrame(np.mean([pred1.values, \n#                              pred2.values,\n#                              pred3.values], axis=0), \n#                     columns=['Class_' + str(i) for i in range(1, 10)])\n#\n#sub.iloc[:, 1:] = preds\n#\n#sub.to_csv('sub_lightautoml.csv', index = False)","fad9af0d":"# Export oof\n#pd.concat([train.id, OOF_preds], axis=1).to_csv('oof_lightautoml.csv', index = False)","6a545b40":"# LightAutoML","512d7806":"# Submission","54588106":"# Load dependencies"}}