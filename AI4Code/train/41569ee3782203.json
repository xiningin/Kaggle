{"cell_type":{"3eb3ccbb":"code","126e2ad9":"code","e71f90c6":"code","77776d16":"code","0e678f61":"code","fbd7ebf1":"code","14cb85ff":"code","89f3551e":"code","b9c3998d":"code","c053f858":"code","7c67be75":"code","876301cf":"code","5423054b":"code","624f730a":"code","4fdb080b":"code","898909eb":"code","9f1c710e":"code","a570e810":"code","1608af0d":"code","19a2318d":"code","34cd0650":"code","0515a181":"code","b2a841ce":"code","cc1dc5f2":"code","31e4666e":"code","2eb83e57":"code","20070d3e":"code","bf368740":"code","f5579a25":"code","48abe095":"code","731d2e8f":"code","915c6a97":"code","209551c8":"code","93a66016":"code","a093573c":"code","67c97e46":"code","49b6f68b":"code","4cfc637f":"code","862df718":"code","30e1344c":"code","b0e302ac":"code","f32b3292":"code","74289d70":"code","ada46a91":"code","bfd292f8":"code","5dc04d93":"code","91e3fa64":"code","2bbcfaec":"code","c5325d29":"code","c0188e7c":"code","29819a14":"code","594b0832":"code","8ebfd715":"code","845aa73f":"code","3b799e27":"code","f85d154d":"code","c41ff26e":"code","53da049d":"code","722223e1":"code","472eddae":"code","0c9f6ce1":"code","e96ba642":"code","cd8a6c5a":"code","1de833ff":"code","c30ab5f6":"code","3b56b957":"code","db10e7ff":"code","7798e68e":"code","926746bf":"code","a0bf7afa":"code","1b501047":"code","38acbdf4":"code","b2d653f1":"code","a250ce8a":"code","b433b9ea":"code","6f906942":"code","afa7e6dd":"code","bdb895f4":"code","a6e10420":"code","d7464e40":"code","fd548e4f":"code","53179d38":"code","5c59c852":"code","4ca77282":"code","81810055":"code","55b811b6":"code","c2731235":"code","6f2735ca":"code","bffe8758":"code","e7e82bd6":"code","50d61a49":"code","e93717ae":"code","4413a098":"code","28922f5d":"code","c2456eb6":"code","e3f08963":"code","4bd3d6b3":"code","2060735d":"code","6a8c4267":"code","7417786b":"code","6082885b":"markdown"},"source":{"3eb3ccbb":"import pandas as pd\npd.set_option('display.max_columns', None)\npromo=pd.read_csv('..\/input\/promo-abuse-detection-for-payment-apps\/Promo_Abuse_Detection_Dataset.csv')\npromo.head()","126e2ad9":"promo.nunique().sort_values(ascending=False)","e71f90c6":"promo['UserId'].value_counts().sort_values(ascending=False)[:1] #abuse detected","77776d16":"promo[promo['UserId']==13341428].head()","0e678f61":"promo.loc[promo['Unnamed: 0'] == 16, \"Target\"] = 0\npromo.loc[promo['Unnamed: 0'] == 17, \"Target\"] = 1\npromo[promo['UserId']==13341428].head()","fbd7ebf1":"promo['Device Id'].value_counts().sort_values(ascending=False)[:1]#abuse detected","14cb85ff":"fix=promo[promo['Device Id']=='iosvd:++djsadjscior34728128MSASCDMVERww38rmbe8=:2537']\nfix.head()","89f3551e":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","b9c3998d":"promo.loc[promo['Unnamed: 0'] == 950, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Device Id']=='iosvd:++djsadjscior34728128MSASCDMVERww38rmbe8=:2537']","c053f858":"promo['Ref PC AC Number'].value_counts().sort_values(ascending=False)[:6]#abuse detected","7c67be75":"fix=promo[promo['Ref PC AC Number']=='IN312XXXXX1298']\nfix.head()","876301cf":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","5423054b":"promo.loc[promo['Unnamed: 0'] == 656, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN312XXXXX1298']","624f730a":"fix=promo[promo['Ref PC AC Number']=='IN312XXXXX1299']\nfix.head()","4fdb080b":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","898909eb":"promo.loc[promo['Unnamed: 0'] == 666, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN312XXXXX1299']","9f1c710e":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1188']\nfix.head()","a570e810":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","1608af0d":"promo.loc[promo['Unnamed: 0'] == 19, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1188']","19a2318d":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1190']\nfix.head()","34cd0650":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","0515a181":"promo.loc[promo['Unnamed: 0'] == 678, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1190']","b2a841ce":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1186']\nfix.head()","cc1dc5f2":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","31e4666e":"promo.loc[promo['Unnamed: 0'] == 18, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1186']","2eb83e57":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1185']\nfix.head()","20070d3e":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","bf368740":"promo.loc[promo['Unnamed: 0'] == 658, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1185']","f5579a25":"promo['Name']=promo['FirstName']+' '+promo['LastName']\npromo.nunique().sort_values(ascending=False)","48abe095":"promo=promo.drop(['FirstName','LastName'],axis=1)\npromo.head()","731d2e8f":"promo['Name'].value_counts().sort_values(ascending=False)[:6]#abuse detected","915c6a97":"fix=promo[promo['Name']=='amit kumar']\nfix.head()","209551c8":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","93a66016":"promo.loc[promo['Unnamed: 0'] == 595, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='amit kumar']","a093573c":"fix=promo[promo['Name']=='akash gupta']\nfix.head()","67c97e46":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","49b6f68b":"promo.loc[promo['Unnamed: 0'] == 822, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='akash gupta']","4cfc637f":"fix=promo[promo['Name']=='rohit kumar']\nfix.head()","862df718":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","30e1344c":"promo.loc[promo['Unnamed: 0'] == 886, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='rohit kumar']","b0e302ac":"fix=promo[promo['Name']=='raman ralhan']\nfix.head()","f32b3292":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","74289d70":"promo.loc[promo['Unnamed: 0'] == 456, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='raman ralhan']","ada46a91":"fix=promo[promo['Name']=='sunil kumar']\nfix.head()","bfd292f8":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","5dc04d93":"promo.loc[promo['Unnamed: 0'] == 490, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='sunil kumar']","91e3fa64":"round(promo.Name.isnull().sum()*100\/len(promo),2)","2bbcfaec":"promo[['Name']]=promo[['Name']].fillna('Unknown')\nfix=promo[promo['Name']=='Unknown']#abuse detected as posssibility of hacker expected.\nfix.head()","c5325d29":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)\nlen(i)","c0188e7c":"for j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo.head()","29819a14":"round(promo.Target.isnull().sum()*100\/len(promo),2)","594b0832":"promo.Target=promo.Target.fillna(0)\nround(promo.Target.value_counts()*100\/len(promo),2)","8ebfd715":"promo[['Sim_OS','Sim_Info','Sim_User']] = promo['Sim Id'].str.split(':',expand=True)\npromo.head()","845aa73f":"promo[['Device_OS','Device_Info','Device_User']] = promo['Device Id'].str.split(':',expand=True)\npromo.head()","3b799e27":"promo=promo.drop(['Device Id','Sim Id'],axis=1)\npromo.head()","f85d154d":"promo[['LastLoginTime','PresentLoginTime']].info()","c41ff26e":"promo['LastLoginTime']=promo['LastLoginTime'].replace('01-01-1900 00:00','00:00:00')\npromo['LastLoginTime'].unique()","53da049d":"promo[['LastLoginTime_HH','LastLoginTime_MM','LastLoginTime_SS']] = promo['LastLoginTime'].str.split(':',expand=True)\npromo.head()","722223e1":"promo[['PresentLoginTime_HH','PresentLoginTime_MM','PresentLoginTime_SS']] = promo['PresentLoginTime'].str.split(':',expand=True)\npromo.head()","472eddae":"promo=promo.drop(['LastLoginTime','PresentLoginTime'],axis=1)\npromo.head()","0c9f6ce1":"promo[['Meta Data_1','Meta Data_2','Meta Data_3','Meta Data_4']] =promo['Meta Data'].str.split('-',expand=True)\npromo.head()","e96ba642":"promo[['Email_user','Email_Domain']] =promo['Email'].str.split('@',expand=True)\npromo.head()","cd8a6c5a":"promo=promo.drop(['Email','Meta Data'],axis=1)\npromo.head()","1de833ff":"promo[['Reg Client IP_1','Reg Client IP_2','Reg Client IP_3','Reg Client IP_4']] =promo['Reg Client IP'].str.split('.',expand=True)\npromo.head()","c30ab5f6":"promo=promo.drop(['Unnamed: 0','Reg Client IP'],axis=1)\npromo.head()","3b56b957":"promo.nunique().sort_values(ascending=False)","db10e7ff":"promo=promo.drop(['ProgramId','ProgramName','Meta Data_1','Meta Data_3','Status','Email_Domain','BadTryCount'],axis=1)\npromo.head()","7798e68e":"promo['Reg Referral Code']=promo['Reg Referral Code'].str.strip().str[-3:]\npromo['Reg Referral Code'].head()","926746bf":"promo['RegisteredOn']=pd.to_datetime(promo['RegisteredOn'])\npromo['Dob']=pd.to_datetime(promo['Dob'])\npromo.head()","a0bf7afa":"promo.info()","1b501047":"promo[['UserId','Mobile','PostalCode']]=promo[['UserId','Mobile','PostalCode']].astype(object)\npromo.info()","38acbdf4":"promo.nunique().sort_values(ascending=False)","b2d653f1":"promo.columns","a250ce8a":"promo.info()","b433b9ea":"(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","6f906942":"promo[['Reg Referral Code','Reg Referral Prefix']]=promo[['Reg Referral Code',\n                                                                 'Reg Referral Prefix']].fillna('Unknown')\n(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","afa7e6dd":"promo.Gender.value_counts()","bdb895f4":"promo['Gender']=promo['Gender'].fillna('U')\n(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","a6e10420":"promo.nunique().sort_values(ascending=False)","d7464e40":"promo.Name.value_counts()[:5]","fd548e4f":"!pip install pycaret","53179d38":"promo.nunique().sort_values(ascending=False)*100\/len(promo)","5c59c852":"promo.columns\n","4ca77282":"promo.info()","81810055":"promo.nunique().sort_values(ascending=False)","55b811b6":"!pip install pandas-profiling","c2731235":"from pandas_profiling import ProfileReport\nProfileReport(promo, title=\"EDA Report\")","6f2735ca":"data = promo.sample(frac=0.8, random_state=42)\ndata_unseen = promo.drop(data.index)\ndata.reset_index(inplace=True, drop=True)\ndata_unseen.reset_index(inplace=True, drop=True)\nprint('Data for Modeling: ' + str(data.shape))","bffe8758":"print('Unseen Data For Predictions: ' + str(data_unseen.shape))","e7e82bd6":"from pycaret.classification import *\npromo= setup(data =data, session_id=42,\n             target = 'Target',\n                  normalize = True, \n                  transformation = True, \n                  log_experiment = True,\n                  remove_multicollinearity = True, #rop one of the two features that are highly correlated with each other\n                  date_features=['RegisteredOn','Dob'],\n            categorical_features=[ 'Gender', 'UserId', 'Mobile', 'PostalCode',\n       'OS Type', 'Reg Referral Code', 'Reg Referral Prefix',\n       'Ref PC AC Number', 'Name', 'Sim_OS', 'Sim_Info', 'Sim_User',\n       'Device_OS', 'Device_Info', 'Device_User', 'LastLoginTime_HH',\n       'LastLoginTime_MM', 'LastLoginTime_SS', 'PresentLoginTime_HH',\n       'PresentLoginTime_MM', 'PresentLoginTime_SS', 'Meta Data_2',\n       'Meta Data_4', 'Email_user', 'Reg Client IP_1', 'Reg Client IP_2',\n       'Reg Client IP_3', 'Reg Client IP_4'],\n            high_cardinality_features =[ 'UserId', 'Mobile', 'PostalCode',\n       'OS Type', 'Reg Referral Code',\n       'Ref PC AC Number', 'Name', 'Sim_User',\n        'Device_User', 'LastLoginTime_HH',\n       'LastLoginTime_MM', 'LastLoginTime_SS', 'PresentLoginTime_HH',\n       'PresentLoginTime_MM', 'PresentLoginTime_SS',\n       'Meta Data_4', 'Email_user', 'Reg Client IP_1', 'Reg Client IP_2',\n       'Reg Client IP_3', 'Reg Client IP_4']  ,         \n            train_size = 0.8)","50d61a49":"nb = create_model('nb')","e93717ae":"print(nb)","4413a098":"tuned_nb = tune_model(nb,optimize = 'Recall')","28922f5d":"plot_model(tuned_nb, plot = 'auc')","c2456eb6":"plot_model(tuned_nb, plot = 'pr')","e3f08963":"plot_model(tuned_nb, plot = 'confusion_matrix')","4bd3d6b3":"evaluate_model(tuned_nb)","2060735d":"predict_model(tuned_nb)","6a8c4267":"unseen_predictions = predict_model(tuned_nb, data=data_unseen)\nunseen_predictions.head()","7417786b":"print(\"Confidence Score :   {}\".format(round(unseen_predictions.Score.mean(),2)))#Confidence Score","6082885b":"There are few considerations , we are working with.\n- A device can be use once\n- Cashback to same account more than once is an abuse\n- Name with same email ID is an abuse"}}