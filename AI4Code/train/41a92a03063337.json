{"cell_type":{"5b58c7f6":"code","872d3ab2":"code","ae915dee":"code","06744c4f":"code","4e601f91":"code","53af6547":"code","ab0400c2":"code","366beda2":"code","f994a65b":"code","f63ebacd":"code","043efd5f":"code","ffd356a1":"markdown","4b268ba8":"markdown","544fc88a":"markdown","0d5c0865":"markdown","d868555c":"markdown","82440a38":"markdown","8c803740":"markdown","43bd3c1f":"markdown","a89b4ec9":"markdown"},"source":{"5b58c7f6":"!pip3 install -q fastai==2.0.16","872d3ab2":"from fastai.vision.all import *","ae915dee":"working_directory = \"\/kaggle\/input\/100-bird-species\"","06744c4f":"dls = ImageDataLoaders.from_folder(working_directory, \n                 item_tfms=Resize(340),\n                 batch_tfms=aug_transforms(size=224, min_scale=0.75), bs=64)\ndls.show_batch(nrows=3, ncols=3)","4e601f91":"learn = cnn_learner(dls, resnet18, pretrained=True, metrics=accuracy, model_dir=\"\/kaggle\/working\")","53af6547":"callbacks_to_use = [SaveModelCallback(comp=np.greater, monitor='accuracy', fname=\"best_valid_accuracy\")]","ab0400c2":"learn.fine_tune(15, cbs=callbacks_to_use)","366beda2":"learn.show_results()","f994a65b":"learn.path = Path(\"\/kaggle\/working\/\")\nlearn.export('2020-10-27_1.6.0-birds-classifier-resnet18-224.pkl')","f63ebacd":"import torch\nimport os\n\ntest_dir = working_directory + \"\/test\/\"\nlist_dir = os.listdir(test_dir)\nclasses = learn.dls.categorize.vocab.items\n\ntest_predictions = []\ntarget_predictions= []\n\n\nfor folder in list_dir:\n  list_images = os.listdir(test_dir + folder + \"\/\")\n  for image_name in list_images:\n    target_predictions.append(folder)\n    prediction, _, _ = learn.predict(test_dir + folder + \"\/\" + image_name)\n    test_predictions.append(prediction)","043efd5f":"correct = 0\ntotal = 0\n\nfor element_index in range(len(test_predictions)):\n  total += 1\n  if target_predictions[element_index] == test_predictions[element_index]:\n    correct += 1\n\nprint(f\"Test set accuracy: {100*correct\/total}\")","ffd356a1":"## Test evaluation\nLet's now evaluate the test set:","4b268ba8":"Accuracy is already very high. We decide to stop experimenting since the possible improvements relative to the time spent are not worth it.\nWe however will have a quick visual check about the results to be sure there are no obvious errors:","544fc88a":"As first try, we decide to take advantage of `fine_tune()` method, using the default parameters. From experience, it appears to be a good place to start for many different problems.","0d5c0865":"Alright, we'll now export our model.","d868555c":"Specify our working directory, i.e. the one containing the dataset.","82440a38":"We observe that the images seems to be correctly loaded and transformed.\n\n## Training\n\nWe load pretrained resnet18.","8c803740":"Then import it.","43bd3c1f":"# Automatic classification of 200+ bird species\n\n## Prepare environment\n\nFirst, download last version of fastai.","a89b4ec9":"We are now ready to load the images and apply transformations to them.\n\n## Load and transform images\n\nFastai allows us to load dataset with a lot of different methods (using pandas dataframes, regex, folder, ...). \nHere we'll load our images from folder since the dataset structure is already well formated.\nWe'll first enlarge all our images to $340*340$ and then randomly crop them to size $224*224$. This way, we'll generate more diverse training images, all having at least parts of the bird shown."}}