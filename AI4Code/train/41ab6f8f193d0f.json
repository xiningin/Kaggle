{"cell_type":{"95518d78":"code","78bb1b57":"code","3949256a":"code","246b190b":"code","31cb76d4":"code","eca829c2":"code","a05da9bb":"code","97497b77":"code","4ec589c1":"code","292a4db7":"code","8b18b6a2":"code","227347e6":"code","2f4acace":"code","a9e0c0fb":"code","c2d592a0":"code","5c3cee73":"code","8bfaf424":"code","1821a452":"code","7e01f5b8":"code","3c5d7f6d":"code","e11a36a8":"code","177a4282":"code","c779197d":"code","9be505b1":"code","8958ae58":"code","0ee4de34":"code","4dc761ca":"code","3568dd23":"code","e8f4ac8c":"code","4e030a6b":"code","bb803254":"code","f4f471b0":"code","dc190bb4":"code","aa4bf3f5":"code","c1aa0ef6":"code","095b0df4":"code","1e4d7de9":"code","d01b0ada":"code","7448b57b":"code","e3ef3101":"code","9fe57ff5":"code","41132d6e":"code","803a7e23":"code","d14a150e":"code","150ff7fb":"code","2b6150c9":"code","fbd20c33":"code","68ac87fd":"code","c5f13d4a":"code","276e57a3":"code","48c5bff3":"code","6c694caa":"code","8ab1ea1a":"code","56234c60":"code","fd861714":"code","abc89bbe":"code","7243f8bd":"code","5aa89679":"markdown","20fe9c57":"markdown","d10a9ede":"markdown","b00379e3":"markdown","f3dbb8ab":"markdown","1fe165c9":"markdown","b5da7bde":"markdown","d2aefa98":"markdown","9004f04b":"markdown","37e3282e":"markdown","04e438d9":"markdown","c15f8be6":"markdown","2375658f":"markdown","e17a9a26":"markdown","209a51fa":"markdown","2d4c5d9e":"markdown","7521ad0b":"markdown","82349605":"markdown","9f174e36":"markdown","2306b14b":"markdown","1513c542":"markdown","0481359f":"markdown","bf76a9b1":"markdown","5a638e1e":"markdown","f39d9025":"markdown","462466c3":"markdown","3aefff96":"markdown","f1252ff5":"markdown","8143adc5":"markdown","c713ac15":"markdown","c9c30d0a":"markdown","bc092a46":"markdown","d99bb71a":"markdown","e0fab235":"markdown","a930975c":"markdown","c4e78153":"markdown","4772860e":"markdown","a0173b5a":"markdown","280a18e1":"markdown","a4f54cce":"markdown","63d0f3cb":"markdown","ddc54d41":"markdown","cfaf7bbe":"markdown","2b4f7e6f":"markdown","23deaae5":"markdown","7dd614fb":"markdown","2e807f1b":"markdown"},"source":{"95518d78":"import numpy as np\nimport pandas as pd\nimport matplotlib\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport warnings\nimport gc\nwarnings.simplefilter('ignore')\nmatplotlib.rcParams['figure.dpi'] = 100\nsns.set()\n%matplotlib inline","78bb1b57":"building = pd.read_csv('..\/input\/ashrae-energy-prediction\/building_metadata.csv')\nweather_train = pd.read_csv('..\/input\/ashrae-energy-prediction\/weather_train.csv')\nweather_test = pd.read_csv('..\/input\/ashrae-energy-prediction\/weather_test.csv')\ntrain = pd.read_csv('..\/input\/ashrae-energy-prediction\/train.csv')\ntest = pd.read_csv('..\/input\/ashrae-energy-prediction\/test.csv')","3949256a":"train = train.merge(building, on='building_id', how='left')\ntest = test.merge(building, on='building_id', how='left')\n\ntrain = train.merge(weather_train, on=['site_id', 'timestamp'], how='left')\ntest = test.merge(weather_test, on=['site_id', 'timestamp'], how='left')\ndel weather_train, weather_test,building\ngc.collect();","246b190b":"# Saving some memory\nd_types = {'building_id': np.int16,\n          'meter': np.int8,\n          'site_id': np.int8,\n          'primary_use': 'category',\n          'square_feet': np.int32,\n          'year_built': np.float16,\n          'floor_count': np.float16,\n          'air_temperature': np.float32,\n          'cloud_coverage': np.float16,\n          'dew_temperature': np.float32,\n          'precip_depth_1_hr': np.float16,\n          'sea_level_pressure': np.float32,\n          'wind_direction': np.float16,\n          'wind_speed': np.float32}\n\nfor feature in d_types:\n    train[feature] = train[feature].astype(d_types[feature])\n    test[feature] = test[feature].astype(d_types[feature])\n    \ntrain[\"timestamp\"] = pd.to_datetime(train[\"timestamp\"])\ntest[\"timestamp\"] = pd.to_datetime(test[\"timestamp\"])\ngc.collect();","31cb76d4":"train_data = (train.count() \/ len(train)).drop('meter_reading').sort_values().values\nind = np.arange(len(train_data))\nwidth = 0.35\n\nfig, axes = plt.subplots(1,1,figsize=(14, 6), dpi=100)\ntr = axes.bar(ind, train_data, width, color='royalblue')\n\ntest_data = (test.count() \/ len(test)).drop('row_id').sort_values().values\ntt = axes.bar(ind+width, test_data, width, color='seagreen')\n\naxes.set_ylabel('Amount of data available');\naxes.set_xticks(ind + width \/ 2)\naxes.set_xticklabels((train.count() \/ len(train)).drop('meter_reading').sort_values().index, rotation=40)\naxes.legend([tr, tt], ['Train', 'Test']);","eca829c2":"fig, axes = plt.subplots(1, 1, figsize=(14, 6), dpi=100)\ntrain[['timestamp', 'meter_reading']].set_index('timestamp').resample('H').mean()['meter_reading'].plot(ax=axes, label='By hour', alpha=0.8).set_ylabel('Meter reading', fontsize=14);\ntrain[['timestamp', 'meter_reading']].set_index('timestamp').resample('D').mean()['meter_reading'].plot(ax=axes, label='By day', alpha=1).set_ylabel('Meter reading', fontsize=14);\naxes.set_title('Mean Meter reading by hour and day', fontsize=16);\naxes.legend();","a05da9bb":"fig, axes = plt.subplots(8,2,figsize=(14, 30), dpi=100)\nfor i in range(train['site_id'].nunique()):\n    train[train['site_id'] == i][['timestamp', 'meter_reading']].set_index('timestamp').resample('H').mean()['meter_reading'].plot(ax=axes[i%8][i\/\/8], alpha=0.8, label='By hour', color='tab:blue').set_ylabel('Mean meter reading', fontsize=13);\n    train[train['site_id'] == i][['timestamp', 'meter_reading']].set_index('timestamp').resample('D').mean()['meter_reading'].plot(ax=axes[i%8][i\/\/8], alpha=1, label='By day', color='tab:orange').set_xlabel('');\n    axes[i%8][i\/\/8].legend();\n    axes[i%8][i\/\/8].set_title('site_id {}'.format(i), fontsize=13);\n    plt.subplots_adjust(hspace=0.45)","97497b77":"fig, axes = plt.subplots(8,2,figsize=(14, 30), dpi=100)\nfor i, use in enumerate(train['primary_use'].value_counts().index.to_list()):\n    try:\n        train[(train['site_id'] == 13) & (train['primary_use'] == use)][['timestamp', 'meter_reading']].set_index('timestamp').resample('H').mean()['meter_reading'].plot(ax=axes[i%8][i\/\/8], alpha=0.8, label='By hour', color='tab:blue').set_ylabel('Mean meter reading', fontsize=13);\n        train[(train['site_id'] == 13) & (train['primary_use'] == use)][['timestamp', 'meter_reading']].set_index('timestamp').resample('D').mean()['meter_reading'].plot(ax=axes[i%8][i\/\/8], alpha=1, label='By day', color='tab:orange').set_xlabel('');\n        axes[i%8][i\/\/8].legend();\n    except TypeError:\n        pass\n    axes[i%8][i\/\/8].set_title(use, fontsize=13);\n    plt.subplots_adjust(hspace=0.45)","4ec589c1":"fig, axes = plt.subplots(3,1,figsize=(14, 18), dpi=100)\nfor i in train[(train['site_id'] == 13) & (train['primary_use'] == 'Education')]['meter'].value_counts(dropna=False).index.to_list():\n    train[(train['site_id'] == 13) & (train['primary_use'] == 'Education') & (train['meter'] == i)][['timestamp', 'meter_reading']].set_index('timestamp').resample('H').mean()['meter_reading'].plot(ax=axes[i], alpha=0.8, label='By hour', color='tab:blue').set_ylabel('Mean meter reading', fontsize=13);\n    train[(train['site_id'] == 13) & (train['primary_use'] == 'Education') & (train['meter'] == i)][['timestamp', 'meter_reading']].set_index('timestamp').resample('D').mean()['meter_reading'].plot(ax=axes[i], alpha=1, label='By day', color='tab:orange').set_xlabel('');\n    axes[i].legend();\n    axes[i].set_title('Meter: ' + str(i), fontsize=13);","292a4db7":"fig, axes = plt.subplots(9,2,figsize=(14, 36), dpi=100)\nfor i, building in enumerate(train[(train['site_id'] == 13) & (train['primary_use'] == 'Education') & (train['meter'] == 2)]['building_id'].value_counts(dropna=False).index.to_list()):\n    train[(train['site_id'] == 13) & (train['primary_use'] == 'Education') & (train['meter'] == 2) & (train['building_id'] == building)][['timestamp', 'meter_reading']].set_index('timestamp').resample('H').mean()['meter_reading'].plot(ax=axes[i%9][i\/\/9], alpha=0.8, label='By hour', color='tab:blue').set_ylabel('Mean meter reading', fontsize=13);\n    train[(train['site_id'] == 13) & (train['primary_use'] == 'Education') & (train['meter'] == 2) & (train['building_id'] == building)][['timestamp', 'meter_reading']].set_index('timestamp').resample('D').mean()['meter_reading'].plot(ax=axes[i%9][i\/\/9], alpha=1, label='By day', color='tab:orange').set_xlabel('');\n    axes[i%9][i\/\/9].legend();\n    axes[i%9][i\/\/9].set_title('building_id: ' + str(building), fontsize=13);\n    plt.subplots_adjust(hspace=0.45)","8b18b6a2":"fig, axes = plt.subplots(3,1,figsize=(14, 20), dpi=100)\n\ntrain[(train['meter'] == 2) & (train['building_id'] == 1099)][['timestamp', 'meter_reading']].set_index('timestamp').resample('H').mean()['meter_reading'].plot(ax=axes[0], alpha=0.8, label='By hour', color='tab:blue').set_ylabel('Mean meter reading', fontsize=13);\ntrain[(train['meter'] == 2) & (train['building_id'] == 1099)][['timestamp', 'meter_reading']].set_index('timestamp').resample('D').mean()['meter_reading'].plot(ax=axes[0], alpha=1, label='By day', color='tab:orange').set_xlabel('');\n\ntrain[['timestamp', 'meter_reading']].set_index('timestamp').resample('H').mean()['meter_reading'].plot(ax=axes[1], alpha=0.8, label='By hour', color='tab:blue').set_ylabel('Mean meter reading', fontsize=13);\ntrain[['timestamp', 'meter_reading']].set_index('timestamp').resample('D').mean()['meter_reading'].plot(ax=axes[1], alpha=1, label='By day', color='tab:orange').set_xlabel('');\n\ntrain[~((train['meter'] == 2) & (train['building_id'] == 1099))][['timestamp', 'meter_reading']].set_index('timestamp').resample('H').mean()['meter_reading'].plot(ax=axes[2], alpha=0.8, label='By hour', color='tab:blue').set_ylabel('Mean meter reading', fontsize=13);\ntrain[~((train['meter'] == 2) & (train['building_id'] == 1099))][['timestamp', 'meter_reading']].set_index('timestamp').resample('D').mean()['meter_reading'].plot(ax=axes[2], alpha=1, label='By day', color='tab:orange').set_xlabel('');\n\naxes[0].set_title('building_id==1099 and meter==2', fontsize=13);\naxes[1].set_title('Full dataset', fontsize=13);\naxes[2].set_title('building_id 1099 excluded', fontsize=13);\nplt.subplots_adjust(hspace=0.45)","227347e6":"fig, axes = plt.subplots(1, 1, figsize=(14, 6))\ntrain['timestamp'].dt.floor('d').value_counts().sort_index().plot(ax=axes).set_xlabel('Date', fontsize=14);\ntest['timestamp'].dt.floor('d').value_counts().sort_index().plot(ax=axes).set_ylabel('Number of observations', fontsize=14);\naxes.set_title('Number of observations by day', fontsize=16);\naxes.legend(['Train', 'Test']);","2f4acace":"train_data = train['meter'].value_counts(dropna=False, normalize=True).sort_index().values\nind = np.arange(len(train_data))\nwidth = 0.35\n\nfig, axes = plt.subplots(1,1,figsize=(14, 6), dpi=100)\ntr = axes.bar(ind, train_data, width, color='royalblue')\n\ntest_data = test['meter'].value_counts(dropna=False, normalize=True).sort_index().values\ntt = axes.bar(ind+width, test_data, width, color='seagreen')\n\naxes.set_ylabel('Normalized number of observations');\naxes.set_xlabel('meter type');\naxes.set_xticks(ind + width \/ 2)\naxes.set_xticklabels(train['meter'].value_counts().sort_index().index, rotation=0)\naxes2 = axes.twinx()\nmr = axes2.plot(ind, train[['meter', 'meter_reading']].groupby('meter')['meter_reading'].mean().sort_index().values, 'D-', color='tab:orange', label='Mean meter reading');\naxes2.grid(False);\naxes2.tick_params(axis='y', labelcolor='tab:orange');\naxes2.set_ylabel('Mean meter reading by meter type', color='tab:orange');\naxes.legend([tr, tt], ['Train', 'Test'], facecolor='white');\naxes2.legend(loc=5, facecolor='white');","a9e0c0fb":"fig, axes = plt.subplots(1, 1, figsize=(14, 6))\nsns.boxplot(x='meter', y='meter_reading', data=train, showfliers=False);","c2d592a0":"tmp_df = pd.concat([train[['meter', 'air_temperature']], test[['meter', 'air_temperature']]], ignore_index=True)\ntmp_df['dataset'] = 'Train'\ntmp_df.loc[tmp_df.index > len(train), 'dataset'] = 'Test'\n\nfig, axes = plt.subplots(1, 1, figsize=(14, 6))\nsns.boxplot(x='meter', y='air_temperature', data=tmp_df, hue='dataset', palette=\"Set3\");\n\ndel tmp_df\ngc.collect();","5c3cee73":"train_data = train['site_id'].value_counts(dropna=False, normalize=True).sort_index().values\nind = np.arange(len(train_data))\nwidth = 0.35\n\nfig, axes = plt.subplots(1,1,figsize=(14, 6), dpi=100)\ntr = axes.bar(ind, train_data, width, color='royalblue')\n\ntest_data = test['site_id'].value_counts(dropna=False, normalize=True).sort_index().values\ntt = axes.bar(ind+width, test_data, width, color='seagreen')\n\naxes.set_ylabel('Normalized number of observations');\naxes.set_xlabel('site_id');\naxes.set_xticks(ind + width \/ 2)\naxes.set_xticklabels(train['site_id'].value_counts().sort_index().index, rotation=0)\naxes2 = axes.twinx()\nmr = axes2.plot(ind, train[['site_id', 'meter_reading']].groupby('site_id')['meter_reading'].mean().sort_index().values, 'D-', color='tab:orange', label='Mean meter reading');\naxes2.grid(False);\naxes2.tick_params(axis='y', labelcolor='tab:orange');\naxes2.set_ylabel('Mean meter reading by site_id', color='tab:orange');\naxes.legend([tr, tt], ['Train', 'Test'], facecolor='white');\naxes2.legend(loc=2, facecolor='white');","8bfaf424":"fig, axes = plt.subplots(1, 1, figsize=(14, 6))\nsns.boxplot(x='site_id', y='meter_reading', data=train, showfliers=False);","1821a452":"tmp_df = pd.concat([train[['site_id', 'air_temperature']], test[['site_id', 'air_temperature']]], ignore_index=True)\ntmp_df['dataset'] = 'Train'\ntmp_df.loc[tmp_df.index > len(train), 'dataset'] = 'Test'\n\nfig, axes = plt.subplots(1, 1, figsize=(14, 6))\nsns.boxplot(x='site_id', y='air_temperature', data=tmp_df, hue='dataset', palette=\"Set3\");\n\ndel tmp_df\ngc.collect();","7e01f5b8":"train_data = train['primary_use'].value_counts(dropna=False, normalize=True).sort_index().values\nind = np.arange(len(train_data))\nwidth = 0.35\n\nfig, axes = plt.subplots(1,1,figsize=(14, 6), dpi=100)\ntr = axes.bar(ind, train_data, width, color='royalblue')\n\ntest_data = test['primary_use'].value_counts(dropna=False, normalize=True).sort_index().values\ntt = axes.bar(ind+width, test_data, width, color='seagreen')\n\naxes.set_ylabel('Normalized number of observations');\naxes.set_xlabel('primary_use');\naxes.set_xticks(ind + width \/ 2)\naxes.set_xticklabels(train['primary_use'].value_counts().sort_index().index, rotation=90)\naxes2 = axes.twinx()\nmr = axes2.plot(ind, train[['primary_use', 'meter_reading']].groupby('primary_use')['meter_reading'].mean().sort_index().values, 'D-', color='tab:orange', label='Mean meter reading');\naxes2.grid(False);\naxes2.tick_params(axis='y', labelcolor='tab:orange');\naxes2.set_ylabel('Mean meter reading by primary_use', color='tab:orange');\naxes.legend([tr, tt], ['Train', 'Test'], facecolor='white');\naxes2.legend(loc=5, facecolor='white');","3c5d7f6d":"fig, axes = plt.subplots(2, 2, figsize=(14, 12))\nsns.kdeplot(train['square_feet'], ax=axes[0][0], label='Train');\nsns.kdeplot(test['square_feet'], ax=axes[0][0], label='Test');\nsns.boxplot(x=train['square_feet'], ax=axes[1][0]);\nsns.boxplot(x=test['square_feet'], ax=axes[1][1]);\npd.DataFrame({'train': [train['square_feet'].isnull().sum()], 'test': [test['square_feet'].isnull().sum()]}).plot(kind='bar', rot=0, ax=axes[0][1]);\naxes[0][0].legend();\naxes[0][0].set_title('Train\/Test KDE distribution');\naxes[0][1].set_title('Number of NaNs');\naxes[1][0].set_title('Boxplot for train');\naxes[1][1].set_title('Boxplot for test');\ngc.collect();","e11a36a8":"print(train[train['building_id'] == 0]['square_feet'].value_counts())\nprint(train[train['building_id'] == 1]['square_feet'].value_counts())\nprint(train[train['building_id'] == 100]['square_feet'].value_counts())","177a4282":"train[['building_id', 'square_feet']].sort_index(by='building_id')","c779197d":"fig, axes = plt.subplots(1,1,figsize=(14, 6))\ntrain.groupby('building_id')['meter_reading'].mean().plot();\naxes.set_title('Mean meter reading by building_id', fontsize=14);\naxes.set_ylabel('Mean meter reading', fontsize=14);","9be505b1":"train[(train['building_id']==1099) & (train['meter_reading'] > 3000000)]","8958ae58":"fig, axes = plt.subplots(1, 2, figsize=(14, 6))\ntrain['site_id'].value_counts(dropna=False, normalize=True).sort_index().plot(kind='bar', rot=0, ax=axes[0]).set_xlabel('site_id value');\ntrain[train['building_id']!=1099]['site_id'].value_counts(dropna=False, normalize=True).sort_index().plot(kind='bar', rot=0, ax=axes[1]).set_xlabel('site_id value');\nax2 = axes[0].twinx()\nax3 = axes[1].twinx()\ntrain.groupby('site_id')['meter_reading'].mean().sort_index().plot(ax=ax2, style='D-', grid=False, color='tab:orange');\ntrain[train['building_id']!=1099].groupby('site_id')['meter_reading'].mean().sort_index().plot(ax=ax3, style='D-', grid=False, color='tab:orange');\nax2.set_ylabel('Mean meter reading', color='tab:orange', fontsize=14);\nax3.set_ylabel('Mean meter reading', color='tab:orange', fontsize=14);\nax2.tick_params(axis='y', labelcolor='tab:orange');\nax3.tick_params(axis='y', labelcolor='tab:orange');\nplt.subplots_adjust(wspace=0.4)\naxes[0].set_title('WITH building_id 1099');\naxes[1].set_title('WITHOUT building_id 1099');","0ee4de34":"fig, axes = plt.subplots(1,1,figsize=(14, 6))\ntrain[train['building_id'] != 1099].groupby('building_id')['meter_reading'].mean().plot();\naxes.set_title('Mean meter reading by building_id', fontsize=14);\naxes.set_ylabel('Mean meter reading', fontsize=14);","4dc761ca":"fig, axes = plt.subplots(1,1,figsize=(14, 6))\ntrain['year_built'].value_counts(dropna=False).sort_index().plot(ax=axes).set_xlabel('year_built');\ntest['year_built'].value_counts(dropna=False).sort_index().plot(ax=axes).set_ylabel('Number of examples');\naxes.legend(['Train', 'Test']);\naxes.set_title('Number of examples per year_built', fontsize=16);","3568dd23":"fig, axes = plt.subplots(1,1,figsize=(14, 6))\ntrain.groupby('year_built')['meter_reading'].mean().plot().set_ylabel('Mean meter reading');\naxes.set_title('Mean meter reading by year_built of the building', fontsize=16);","e8f4ac8c":"fig, axes = plt.subplots(2, 2, figsize=(14, 12))\nsns.kdeplot(train['year_built'], ax=axes[0][0], label='Train');\nsns.kdeplot(test['year_built'], ax=axes[0][0], label='Test');\nsns.boxplot(x=train['year_built'], ax=axes[1][0]);\nsns.boxplot(x=test['year_built'], ax=axes[1][1]);\npd.DataFrame({'train': [train['year_built'].isnull().sum()], 'test': [test['year_built'].isnull().sum()]}).plot(kind='bar', rot=0, ax=axes[0][1]);\naxes[0][0].legend();\naxes[0][0].set_title('Train\/Test KDE distribution');\naxes[0][1].set_title('Number of NaNs');\naxes[1][0].set_title('Boxplot for train');\naxes[1][1].set_title('Boxplot for test');\ngc.collect();","4e030a6b":"fig, axes = plt.subplots(1, 2, figsize=(14, 6))\nsns.kdeplot(train['floor_count'], label='Train', ax=axes[0]);\nsns.kdeplot(test['floor_count'], label='Test', ax=axes[0]);\ntest.index += len(train)\naxes[1].plot(train['floor_count'], '.', label='Train');\naxes[1].plot(test['floor_count'], '.', label='Test');\ntest.index -= len(train)\naxes[0].set_title('Train\/Test KDE distribution');\naxes[1].set_title('Index versus value: Train\/Test distribution');\ngc.collect();","bb803254":"fig, axes = plt.subplots(1,1,figsize=(14, 6))\npd.Series(index=train['floor_count'].value_counts().index, \n          data=train.groupby('floor_count')['meter_reading'].transform('mean').value_counts().index).sort_index().plot(kind='bar', rot=0, ax=axes);\naxes.set_xlabel('Floor count');\naxes.set_ylabel('Mean meter reading');\naxes.set_title('Mean meter reading by floor count');","f4f471b0":"pd.DataFrame({'train': [train['floor_count'].isnull().sum()], 'test': [test['floor_count'].isnull().sum()]}).plot(kind='bar', rot=0);","dc190bb4":"fig, axes = plt.subplots(1,2,figsize=(14, 6), sharey=True, dpi=100)\naxes[0].plot(train['building_id'].value_counts().sort_index(), '.');\naxes[1].plot(test['building_id'].value_counts().sort_index(), '.');\naxes[0].set_title('Train', fontsize=14);\naxes[1].set_title('Test', fontsize=14);\naxes[0].set_xlabel('building_id');\naxes[1].set_xlabel('building_id');\naxes[0].set_ylabel('Number of examples');\nfig.suptitle('Number of training examples per building_id', fontsize=16);","aa4bf3f5":"fig, axes = plt.subplots(1, 2, figsize=(14, 6), dpi=100, sharey=True)\ntrain.groupby('building_id')['meter'].nunique().plot(style='.', ax=axes[0]);\ntest.groupby('building_id')['meter'].nunique().plot(style='.', ax=axes[1]);\naxes[0].set_title('Train', fontsize=14);\naxes[1].set_title('Test', fontsize=14);\naxes[0].set_xlabel('building_id');\naxes[1].set_xlabel('building_id');\naxes[0].set_ylabel('Number of meters installed');\nplt.yticks([1, 2, 3, 4]);\nfig.suptitle('Number of meters installed per building_id', fontsize=16);","c1aa0ef6":"fig, axes = plt.subplots(1,1,figsize=(14, 6), dpi=100)\ntrain[['timestamp', 'air_temperature']].set_index('timestamp').resample('H').mean()['air_temperature'].plot(ax=axes, alpha=0.8, label='By hour', color='tab:blue').set_ylabel('Mean temperature', fontsize=14);\ntest[['timestamp', 'air_temperature']].set_index('timestamp').resample('H').mean()['air_temperature'].plot(ax=axes, alpha=0.8, color='tab:blue', label='');\ntrain[['timestamp', 'air_temperature']].set_index('timestamp').resample('D').mean()['air_temperature'].plot(ax=axes, alpha=1, label='By day', color='tab:orange');\ntest[['timestamp', 'air_temperature']].set_index('timestamp').resample('D').mean()['air_temperature'].plot(ax=axes, alpha=1, color='tab:orange', label='');\naxes.legend();\naxes.text(train['timestamp'].iloc[9000000], -3, 'Train', fontsize=16);\naxes.text(test['timestamp'].iloc[29400000], 30, 'Test', fontsize=16);\naxes.axvspan(test['timestamp'].min(), test['timestamp'].max(), facecolor='green', alpha=0.2);","095b0df4":"fig, axes = plt.subplots(8,2,figsize=(14, 30), dpi=100)\nfor i in range(train['site_id'].nunique()):\n    train[train['site_id'] == i][['timestamp', 'air_temperature']].set_index('timestamp').resample('H').mean()['air_temperature'].plot(ax=axes[i%8][i\/\/8], alpha=0.8, label='By hour', color='tab:blue').set_ylabel('Mean temperature', fontsize=13);\n    test[test['site_id'] == i][['timestamp', 'air_temperature']].set_index('timestamp').resample('H').mean()['air_temperature'].plot(ax=axes[i%8][i\/\/8], alpha=0.8, color='tab:blue', label='').set_xlabel('')\n    train[train['site_id'] == i][['timestamp', 'air_temperature']].set_index('timestamp').resample('D').mean()['air_temperature'].plot(ax=axes[i%8][i\/\/8], alpha=1, label='By day', color='tab:orange')\n    test[test['site_id'] == i][['timestamp', 'air_temperature']].set_index('timestamp').resample('D').mean()['air_temperature'].plot(ax=axes[i%8][i\/\/8], alpha=1, color='tab:orange', label='').set_xlabel('')\n    axes[i%8][i\/\/8].legend();\n    axes[i%8][i\/\/8].set_title('site_id {}'.format(i), fontsize=13);\n    axes[i%8][i\/\/8].axvspan(test['timestamp'].min(), test['timestamp'].max(), facecolor='green', alpha=0.2);\n    plt.subplots_adjust(hspace=0.45)","1e4d7de9":"fig, axes = plt.subplots(1, 2, figsize=(14, 6), dpi=100)\ntrain['cloud_coverage'].value_counts(dropna=False, normalize=True).sort_index().plot(kind='bar', rot=0, ax=axes[0]).set_xlabel('cloud_coverage value');\ntest['cloud_coverage'].value_counts(dropna=False, normalize=True).sort_index().plot(kind='bar', rot=0, ax=axes[1]).set_xlabel('cloud_coverage values');\naxes[0].set_title('Distribution in train', fontsize=14);\naxes[1].set_title('Distribution in test', fontsize=14);\nax2 = axes[0].twinx()\ntrain[['cloud_coverage', 'meter_reading']].replace(np.nan, 'nan').groupby('cloud_coverage')['meter_reading'].mean().plot(ax=ax2, style='D-', grid=False, color='tab:orange');\nax2.tick_params(axis='y', labelcolor='tab:orange');\nax2.set_ylabel('Mean meter reading', color='tab:orange', fontsize=14);\nax2.set_xticklabels(train['cloud_coverage'].value_counts(dropna=False).sort_index().index)\nplt.subplots_adjust(wspace=0.4);","d01b0ada":"fig, axes = plt.subplots(1,1,figsize=(14, 6), dpi=100)\ntrain[['timestamp', 'dew_temperature']].set_index('timestamp').resample('H').mean()['dew_temperature'].plot(ax=axes, alpha=0.8, label='By hour', color='tab:blue').set_ylabel('Mean dew temperature', fontsize=14);\ntest[['timestamp', 'dew_temperature']].set_index('timestamp').resample('H').mean()['dew_temperature'].plot(ax=axes, alpha=0.8, color='tab:blue', label='');\ntrain[['timestamp', 'dew_temperature']].set_index('timestamp').resample('D').mean()['dew_temperature'].plot(ax=axes, alpha=1, label='By day', color='tab:orange');\ntest[['timestamp', 'dew_temperature']].set_index('timestamp').resample('D').mean()['dew_temperature'].plot(ax=axes, alpha=1, color='tab:orange', label='');\naxes.legend();\naxes.text(train['timestamp'].iloc[9000000], -5, 'Train', fontsize=16);\naxes.text(test['timestamp'].iloc[29400000], 16, 'Test', fontsize=16);\naxes.axvspan(test['timestamp'].min(), test['timestamp'].max(), facecolor='green', alpha=0.2);","7448b57b":"fig, axes = plt.subplots(8,2,figsize=(14, 30), dpi=100)\nfor i in range(train['site_id'].nunique()):\n    train[train['site_id'] == i][['timestamp', 'dew_temperature']].set_index('timestamp').resample('H').mean()['dew_temperature'].plot(ax=axes[i%8][i\/\/8], alpha=0.8, label='By hour', color='tab:blue').set_ylabel('Mean dew temperature', fontsize=13);\n    test[test['site_id'] == i][['timestamp', 'dew_temperature']].set_index('timestamp').resample('H').mean()['dew_temperature'].plot(ax=axes[i%8][i\/\/8], alpha=0.8, color='tab:blue', label='').set_xlabel('')\n    train[train['site_id'] == i][['timestamp', 'dew_temperature']].set_index('timestamp').resample('D').mean()['dew_temperature'].plot(ax=axes[i%8][i\/\/8], alpha=1, label='By day', color='tab:orange')\n    test[test['site_id'] == i][['timestamp', 'dew_temperature']].set_index('timestamp').resample('D').mean()['dew_temperature'].plot(ax=axes[i%8][i\/\/8], alpha=1, color='tab:orange', label='').set_xlabel('')\n    axes[i%8][i\/\/8].legend();\n    axes[i%8][i\/\/8].set_title('site_id {}'.format(i), fontsize=13);\n    axes[i%8][i\/\/8].axvspan(test['timestamp'].min(), test['timestamp'].max(), facecolor='green', alpha=0.2);\n    plt.subplots_adjust(hspace=0.45)","e3ef3101":"fig, axes = plt.subplots(1,1,figsize=(14, 6), dpi=100)\ntrain[['timestamp', 'precip_depth_1_hr']].set_index('timestamp').resample('M').mean()['precip_depth_1_hr'].plot(ax=axes, alpha=0.8, label='By month', color='tab:blue').set_ylabel('Mean precip_depth_1_hr', fontsize=14);\ntest[['timestamp', 'precip_depth_1_hr']].set_index('timestamp').resample('M').mean()['precip_depth_1_hr'].plot(ax=axes, alpha=0.8, color='tab:blue', label='');\naxes.legend();","9fe57ff5":"fig, axes = plt.subplots(1,1,figsize=(14, 6), dpi=100)\ntrain[['timestamp', 'sea_level_pressure']].set_index('timestamp').resample('H').mean()['sea_level_pressure'].plot(ax=axes, alpha=0.8, label='By hour', color='tab:blue').set_ylabel('Mean sea_level_pressure', fontsize=14);\ntest[['timestamp', 'sea_level_pressure']].set_index('timestamp').resample('H').mean()['sea_level_pressure'].plot(ax=axes, alpha=0.8, color='tab:blue', label='');\ntrain[['timestamp', 'sea_level_pressure']].set_index('timestamp').resample('D').mean()['sea_level_pressure'].plot(ax=axes, alpha=1, label='By day', color='tab:orange');\ntest[['timestamp', 'sea_level_pressure']].set_index('timestamp').resample('D').mean()['sea_level_pressure'].plot(ax=axes, alpha=1, color='tab:orange', label='');\naxes.legend();\naxes.text(train['timestamp'].iloc[9000000], 1004, 'Train', fontsize=16);\naxes.text(test['timestamp'].iloc[21000000], 1032, 'Test', fontsize=16);\naxes.axvspan(test['timestamp'].min(), test['timestamp'].max(), facecolor='green', alpha=0.2);","41132d6e":"fig, axes = plt.subplots(8,2,figsize=(14, 30), dpi=100)\nfor i in range(train['site_id'].nunique()):\n    train[train['site_id'] == i][['timestamp', 'sea_level_pressure']].set_index('timestamp').resample('H').mean()['sea_level_pressure'].plot(ax=axes[i%8][i\/\/8], alpha=0.8, label='By hour', color='tab:blue').set_ylabel('Mean sea_level_pressure', fontsize=13);\n    test[test['site_id'] == i][['timestamp', 'sea_level_pressure']].set_index('timestamp').resample('H').mean()['sea_level_pressure'].plot(ax=axes[i%8][i\/\/8], alpha=0.8, color='tab:blue', label='').set_xlabel('')\n    train[train['site_id'] == i][['timestamp', 'sea_level_pressure']].set_index('timestamp').resample('D').mean()['sea_level_pressure'].plot(ax=axes[i%8][i\/\/8], alpha=1, label='By day', color='tab:orange')\n    test[test['site_id'] == i][['timestamp', 'sea_level_pressure']].set_index('timestamp').resample('D').mean()['sea_level_pressure'].plot(ax=axes[i%8][i\/\/8], alpha=1, color='tab:orange', label='').set_xlabel('')\n    axes[i%8][i\/\/8].legend();\n    axes[i%8][i\/\/8].set_title('site_id {}'.format(i), fontsize=13);\n    axes[i%8][i\/\/8].axvspan(test['timestamp'].min(), test['timestamp'].max(), facecolor='green', alpha=0.2);\n    plt.subplots_adjust(hspace=0.45)","803a7e23":"train[train['site_id'] == 5]['sea_level_pressure'].value_counts(dropna=False)","d14a150e":"print('Number of observations with 0 degree direction in TRAIN: {} ({:.2f}%)'.format(train[train['wind_direction'] == 0].shape[0], train[train['wind_direction'] == 0].shape[0] \/ len(train)))\nprint('Number of observations with 0 degree direction in TEST: {} ({:.2f}%)'.format(test[test['wind_direction'] == 0].shape[0], test[test['wind_direction'] == 0].shape[0] \/ len(test)))\nprint('Number of observations with 360 degree direction in TRAIN: {} ({:.2f}%)'.format(train[train['wind_direction'] == 360].shape[0], train[train['wind_direction'] == 360].shape[0] \/ len(train)))\nprint('Number of observations with 360 degree direction in TEST: {} ({:.2f}%)'.format(test[test['wind_direction'] == 360].shape[0], test[test['wind_direction'] == 360].shape[0] \/ len(test)))","150ff7fb":"print('Number of observations that have calm conditions in TRAIN: {} ({:.2f}%)'.format(train[train['wind_speed'] == 0].shape[0], train[train['wind_speed'] == 0].shape[0] \/ len(train)))\nprint('Number of observations that have calm conditions in TEST: {} ({:.2f}%)'.format(test[test['wind_speed'] == 0].shape[0], test[test['wind_speed'] == 0].shape[0] \/ len(test)))","2b6150c9":"def speed_labels(bins:list, units:str) -> list:   \n    labels = list()\n    for left, right in zip(bins[:-1], bins[1:]):\n        if left == bins[0]:\n            labels.append('calm'.format(right))\n        elif np.isinf(right):\n            labels.append('>{} {}'.format(left, units))\n        else:\n            labels.append('{} - {} {}'.format(left, right, units))\n    return labels\n\ndef _convert_dir(directions, N=None):\n    if N is None:\n        N = directions.shape[0]\n    barDir = directions * np.pi\/180. - np.pi\/N\n    barWidth = 2 * np.pi \/ N\n    return barDir, barWidth\n\nspd_bins = [-1, 0, 5, 10, 15, 20, 25, 30, np.inf]\nspd_labels = speed_labels(spd_bins, units='m\/s')\n\ndir_bins = np.arange(-7.5, 370, 15)\ndir_labels = (dir_bins[:-1] + dir_bins[1:]) \/ 2","fbd20c33":"calm_count = train[train['wind_speed'] == 0].shape[0]\ntotal_count = len(train)\nrose = (train.assign(WindSpd_bins=lambda df:\n            pd.cut(df['wind_speed'], bins=spd_bins, labels=spd_labels, right=True)).assign(WindDir_bins=lambda df: pd.cut(df['wind_direction'], bins=dir_bins, labels=dir_labels, right=False)).replace({'WindDir_bins': {360: 0}}).groupby(by=['WindSpd_bins', 'WindDir_bins']).size().unstack(level='WindSpd_bins').fillna(0).assign(calm=lambda df: calm_count \/ df.shape[0]).sort_index(axis=1).applymap(lambda x: x \/ total_count * 100))\nrose.drop(rose.index[0], inplace=True)\ndirections = np.arange(0, 360, 15)","68ac87fd":"def wind_rose(rosedata, wind_dirs, palette=None):\n    if palette is None:\n        palette = sns.color_palette('inferno', n_colors=rosedata.shape[1])\n\n    bar_dir, bar_width = _convert_dir(wind_dirs)\n\n    fig, ax = plt.subplots(figsize=(10, 10), subplot_kw=dict(polar=True))\n    ax.set_theta_direction('clockwise')\n    ax.set_theta_zero_location('N')\n\n    for n, (c1, c2) in enumerate(zip(rosedata.columns[:-1], rosedata.columns[1:])):\n        if n == 0:\n            # first column only\n            ax.bar(bar_dir, rosedata[c1].values, \n                   width=bar_width,\n                   color=palette[0],\n                   edgecolor='none',\n                   label=c1,\n                   linewidth=0)\n\n        # all other columns\n        ax.bar(bar_dir, rosedata[c2].values, \n               width=bar_width, \n               bottom=rosedata.cumsum(axis=1)[c1].values,\n               color=palette[n+1],\n               edgecolor='none',\n               label=c2,\n               linewidth=0)\n\n    leg = ax.legend(loc=(0.75, 0.95), ncol=2)\n    xtl = ax.set_xticklabels(['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'])\n    \n    return fig","c5f13d4a":"fig = wind_rose(rose, directions)","276e57a3":"calm_count = test[test['wind_speed'] == 0].shape[0]\ntotal_count = len(test)\nrose = (test.assign(WindSpd_bins=lambda df:\n            pd.cut(df['wind_speed'], bins=spd_bins, labels=spd_labels, right=True)).assign(WindDir_bins=lambda df: pd.cut(df['wind_direction'], bins=dir_bins, labels=dir_labels, right=False)).replace({'WindDir_bins': {360: 0}}).groupby(by=['WindSpd_bins', 'WindDir_bins']).size().unstack(level='WindSpd_bins').fillna(0).assign(calm=lambda df: calm_count \/ df.shape[0]).sort_index(axis=1).applymap(lambda x: x \/ total_count * 100))\nrose.drop(rose.index[0], inplace=True)","48c5bff3":"fig = wind_rose(rose, directions)","6c694caa":"train['hour'] = train['timestamp'].dt.hour\ntest['hour'] = test['timestamp'].dt.hour","8ab1ea1a":"train_data = train['hour'].value_counts(dropna=False, normalize=True).sort_index().values\nind = np.arange(len(train_data))\nwidth = 0.35\n\nfig, axes = plt.subplots(1,1,figsize=(14, 6), dpi=100)\ntr = axes.bar(ind, train_data, width, color='royalblue')\n\ntest_data = test['hour'].value_counts(dropna=False, normalize=True).sort_index().values\ntt = axes.bar(ind+width, test_data, width, color='seagreen')\n\naxes.set_ylabel('Normalized number of observations');\naxes.set_xlabel('Hour');\naxes.set_xticks(ind + width \/ 2)\naxes.set_xticklabels(train['hour'].value_counts().sort_index().index, rotation=0)\naxes2 = axes.twinx()\nmr = axes2.plot(ind, train[['hour', 'meter_reading']].groupby('hour')['meter_reading'].mean().sort_index().values, 'D-', color='tab:orange', label='Mean meter reading');\naxes2.grid(False);\naxes2.tick_params(axis='y', labelcolor='tab:orange');\naxes2.set_ylabel('Mean meter reading by hour', color='tab:orange');\naxes.legend([tr, tt], ['Train', 'Test'], facecolor='white');\naxes2.legend(loc=2, facecolor='white');","56234c60":"train['day'] = train['timestamp'].dt.day\ntest['day'] = test['timestamp'].dt.day","fd861714":"train_data = train['day'].value_counts(dropna=False, normalize=True).sort_index().values\nind = np.arange(len(train_data))\nwidth = 0.35\n\nfig, axes = plt.subplots(1,1,figsize=(14, 6), dpi=100)\ntr = axes.bar(ind, train_data, width, color='royalblue')\n\ntest_data = test['day'].value_counts(dropna=False, normalize=True).sort_index().values\ntt = axes.bar(ind+width, test_data, width, color='seagreen')\n\naxes.set_ylabel('Normalized number of observations');\naxes.set_xlabel('day');\naxes.set_xticks(ind + width \/ 2)\naxes.set_xticklabels(train['day'].value_counts().sort_index().index, rotation=0)\naxes2 = axes.twinx()\nmr = axes2.plot(ind, train[['day', 'meter_reading']].groupby('day')['meter_reading'].mean().sort_index().values, 'D-', color='tab:orange', label='Mean meter reading');\naxes2.grid(False);\naxes2.tick_params(axis='y', labelcolor='tab:orange');\naxes2.set_ylabel('Mean meter reading by day of month', color='tab:orange');\naxes.legend([tr, tt], ['Train', 'Test'], facecolor='white');\naxes2.legend(loc=2, facecolor='white');","abc89bbe":"train['weekday'] = train['timestamp'].dt.weekday\ntest['weekday'] = test['timestamp'].dt.weekday","7243f8bd":"train_data = train['weekday'].value_counts(dropna=False, normalize=True).sort_index().values\nind = np.arange(len(train_data))\nwidth = 0.35\n\nfig, axes = plt.subplots(1,1,figsize=(14, 6), dpi=100)\ntr = axes.bar(ind, train_data, width, color='royalblue')\n\ntest_data = test['weekday'].value_counts(dropna=False, normalize=True).sort_index().values\ntt = axes.bar(ind+width, test_data, width, color='seagreen')\n\naxes.set_ylabel('Normalized number of observations');\naxes.set_xlabel('weekday');\naxes.set_xticks(ind + width \/ 2)\naxes2 = axes.twinx()\nmr = axes2.plot(ind, train[['weekday', 'meter_reading']].groupby('weekday')['meter_reading'].mean().sort_index().values, 'D-', color='tab:orange', label='Mean meter reading');\naxes2.grid(False);\naxes2.tick_params(axis='y', labelcolor='tab:orange');\naxes2.set_ylabel('Mean meter reading by day of week', color='tab:orange');\naxes.legend([tr, tt], ['Train', 'Test'], facecolor='white');\naxes2.legend(loc=2, facecolor='white');\n\naxes.set_xticklabels(train['weekday'].value_counts().sort_index().index.map({0: 'Monday', 1: 'Tuesday', 2: 'Wednesday', 3: 'Thursday', 4: 'Friday', 5: 'Saturday', 6: 'Sunday'}), rotation=40);","5aa89679":"And separate by site_id","20fe9c57":"<a id=\"meter\"><\/a>\n# Meter\n\nmeter - The meter id code. Read as {0: electricity, 1: chilledwater, 2: steam, hotwater: 3}. Not every building has all meter type\n\nLooks like steam is the most unefficient way of heating things up.","d10a9ede":"<a id='observ_day'><\/a>\n# Observation day of month\n\nA day of month the meter reading was recorded.\n\nNumber of observations for day 30 and 31 are lower than for other days, which makes sence - not every month have 30 or 31 days in it.\n\nAlso pay attention that number of observations for day 29 in training set is higher than in testing set. This is because training set contains observations of the year 2016, which was a leap year.","b00379e3":"Doesn't this look weird? First reading are at the avarege level from January to March, then they explode from March to June and then drop down to almost zero with some peak at November.\n\nLets take a closer look.","f3dbb8ab":"Also there is one more interesting thing, that I want to check. This building is located at site_id 13. So maybe this is some old area? Or this building is the only one consuming so much in the neighbourhood?\n\nSo I have decided to plot mean energy consumption by site_id WITH and WITHOUT this particular building included. And this is what it looks like.\n\nPay attention - the 'Mean meter reading' scale has changed by a factor of 10. So this is the only building with such an enormoush measurements.","1fe165c9":"Air temperature by site_id. Looks like some sites are more to north and some more to south.","b5da7bde":"<a id=\"data_amount\"><\/a>\n# Amount of data and NaNs","d2aefa98":"<a id=\"year_built\"><\/a>\n# year_built\n\nyear_built - Year building was opened","9004f04b":"<a id=\"1\"><\/a>\n# Loading data","37e3282e":"<a id=\"square_feet\"><\/a>\n# square_feet\n\nsquare_feet - Gross floor area of the building","04e438d9":"### Mean meter reading by primary_use for site_id==13","c15f8be6":"<a id=\"3\"><\/a>\n# Number of observations by day\n\nThis is something interesting. We can see that number of observations by day in testing dataset is always the same. But not in the training set.","2375658f":"This is a wind rose for TRAIN:","e17a9a26":"### Box plot of meter reading by site_id with outliers removed","209a51fa":"<a id=\"dew_temperature\"><\/a>\n# dew_temperature\n\ndew_temperature - Degrees Celsius","2d4c5d9e":"# Introduction\n\n<img src=\"https:\/\/upload.wikimedia.org\/wikipedia\/en\/thumb\/f\/fa\/American_Society_of_Heating%2C_Refrigerating_and_Air-Conditioning_Engineers_Logo.svg\/1200px-American_Society_of_Heating%2C_Refrigerating_and_Air-Conditioning_Engineers_Logo.svg.png\" width=200 height=200 \/>\n\nIn this competition we are to create a model to predict an energy usage per building **and** per meter. \n\nWe are given a dataset of around 1450 buildings containing such information as building id, which is a unique identifier of a building across both train and test dataset. Meter - is the type of meter that measures the data - energy consumption in kWh. Different buildings might have different meters installed. Some of them have only one type of meter, some have all four. \n\nSo we need to make a predictions for each meter of each building.\n\n\n# Content\n[Loading data](#1)\n\n[Amount of data and NaNs](#data_amount)\n\n[Mean meter reading by day](#2)\n\n[Number of observations by day](#3)\n\n### Features:\n* [Meter](#meter)\n* [Site_id](#site_id)\n* [primary_use](#primary_use)\n* [square_feet](#square_feet)\n* [year_built](#year_built)\n* [floor_count](#floor_count)\n* [building_id](#building_id)\n* [air_temperature](#air_temperature)\n* [cloud_coverage](#cloud_coverage)\n* [dew_temperature](#dew_temperature)\n* [precip_depth_1_hr](#precip_depth_1_hr)\n* [wind_direction & wind_speed](#wind_direction)\n\n### Engineered features:\n* [Observation hour](#Observation_hour)\n* [Observation day of month](#observ_day)\n* [Observation day of week](#observ_weekday)","7521ad0b":"Mean meter reading by building_id WITHOUT building_id 1099","82349605":"<a id=\"cloud_coverage\"><\/a>\n# cloud_coverage\n\ncloud_coverage - Portion of the sky covered in clouds, in [oktas](https:\/\/en.wikipedia.org\/wiki\/Okta)","9f174e36":"### Box plot of air temperature by site_id","2306b14b":"<a id=\"floor_count\"><\/a>\n# floor_count\n\nfloor_count - Number of floors of the building","1513c542":"So what do we see here?\n\n* First of all, as it was already discussed, site_id 0 starts from March. Until that time all measurements are 0's. Maybe buildings in that area were under construction? As a conclusion - we don't need al the data for this particular site_id before that date.\n\n* site_id 13 looks a lot like the overall mean meter_reading, isn't it? Lets take even a closer look.","0481359f":"One more level of conclusions:\n* site_id == 13 and primary_use == Education looks a lot like a general mean for meter reading. So it is really invest a lost into the whole data\n* site_id == 13 and primary_use == Technology\/Science also have 0's in meter readings in January. Just like site_id 0, that we found earlier.\n\nLets keep digging and see what meter type is responsible for such weird look of the meter reading for site_id 13 and primary_use Education.","bf76a9b1":"<a id=\"building_id\"><\/a>\n# building_id\n\nbuilding_id - Building id code","5a638e1e":"<a id=\"2\"><\/a>\n# Mean meter reading by day","f39d9025":"### Box plot of air temperature by meter type","462466c3":"Now lets see how many observations have calm conditions (wind speed is 0 meters per second)","3aefff96":"Lets take a look at the mean meter reading by building_id.","f1252ff5":"<a id=\"precip_depth_1_hr\"><\/a>\n# precip_depth_1_hr\nprecip_depth_1_hr - Millimeters\n\nThere are plenty of NaNs and you can see on the following plot that there is no information for Decemder 2016 - January 2017.","8143adc5":"<a id=\"observ_weekday\"><\/a>\n# Observation day of week","c713ac15":"<a id=\"wind_direction\"><\/a>\n# wind_direction & wind_speed\n\nwind_direction - Compass direction (0-360)\n\nwind_speed - Meters per second\n\n\n\nOk, plotting this is tricky, so I am going to do it using [this manual](https:\/\/gist.github.com\/phobson\/41b41bdd157a2bcf6e14)\n\nFirst of all: direction of 0\u00b0 and 360\u00b0 is the same thing. But both are presented in the datasets.","c9c30d0a":"And we have a winner. It is a building_id == 1099 (we are going to see that guy a little later again). Now lets plot it side by side with a mean meter reading for all dataset. And also see what this plot would look like if we exclude building_id 1099 from the data.","bc092a46":"### Mean meter reading by meter type for primary_use==Education and site_id==13","d99bb71a":"And wind rose for TEST","e0fab235":"### Number of NaNs in floor_count","a930975c":"# Engineered features\n\nNow lets add some new features and see if they might be usefull. First I am going to work with timeseries data.\n\n<a id='Observation_hour'><\/a>\n# Observation hour\n\nAn hour the meter reading was recorded.","c4e78153":"<a id=\"air_temperature\"><\/a>\n# air_temperature\n\nair_temperature - Degrees Celsius","4772860e":"There is an obvious outlier in data. Lets see what it is.\n\nWell, it is an educational building with no year_build or floor_count provided, so probably it is an old one.\n\nThey have a steam meter which measures such an outstanding amount of electricity used. \n\nIt seems to me that this is a really really old school with a steam heating. ","a0173b5a":"<a id=\"primary_use\"><\/a>\n# primary_use\n\nprimary_use - Indicator of the primary category of activities for the building based on [EnergyStar property type definitions](https:\/\/www.energystar.gov\/buildings\/facility-owners-and-managers\/existing-buildings\/use-portfolio-manager\/identify-your-property-type)","280a18e1":"One more evidence that train and test datasets are very well balanced. Number of observations per hour is almost the same.\n\nAlso we can see that energy consumption raises up during the day and lowers during the night hours.","a4f54cce":"<a id=\"sea_level_pressure\"><\/a>\n\n# sea_level_pressure\n\nsea_level_pressure - Millibar\/hectopascals","63d0f3cb":"### Box plot of meter reading by meter type with outliers removed","ddc54d41":"## Merging everything into two datasets: train and test","cfaf7bbe":"Mean dew temperature by site_id","2b4f7e6f":"Fine. What we have right now is that site_id 13 with primary_use Education and meter type 2 is responsible for this mess. \n\nBut we need to go deeper. There are 17 buildings that fall under these criteria. No problem. Another plot.","23deaae5":"<a id=\"site_id\"><\/a>\n# site_id\n\nsite_id - Foreign key for the weather files.\n\nIn my understanding this is a location.","7dd614fb":"square_feet is 100% the same as building_id. I am going to show that. Every building_id has only one unique value.\n\nWhich makes sence - building_id is a unique building identifier and each building can have only one possible value of square_feet. Also year_built is going to be the same per unique building_id. Just keep that in mind.","2e807f1b":"As we can see all values for site_id 5 are NaNs. Maybe there is no a pressure meter installed in that area?"}}