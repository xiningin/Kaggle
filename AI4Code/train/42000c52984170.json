{"cell_type":{"0367fc07":"code","6497e448":"code","57d297d4":"code","6cddbf55":"code","de14da80":"code","46fece97":"code","37f3a308":"code","76a95680":"code","b85ce96e":"code","b4678a95":"code","19e228d0":"code","6b13b779":"code","b0df15b8":"code","006fbd6f":"code","756594d4":"code","7c2ff7ee":"code","6732e2bd":"markdown","e205e9b5":"markdown","915f4545":"markdown","417cb2ac":"markdown","aefd75ce":"markdown","bfb403f8":"markdown","f5926d91":"markdown","b7a8c7d6":"markdown","d88f4780":"markdown"},"source":{"0367fc07":"import plotly\nimport plotly.express as px\nimport plotly.graph_objs as go\nimport plotly.offline as offline\nfrom plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot\nimport pandas as pd","6497e448":"!pip install xlrd","57d297d4":"init_notebook_mode(connected=True)\n# Names of the US regions which are also sheet titles \nregions = ['NERO', 'MARO', 'SERO', 'MWRO', 'SWRO', 'MPRO', 'WRO']\nregions_len1 = [7, 8, 8, 6, 5, 10, 9]\nregions_len2 = [8, 7, 8, 7, 7, 8, 8]\nfile_suffix = '-cleaned.xls'\nsnap_init_df = pd.read_excel('..\/input\/d\/sbengali\/publicassistance\/FY10-cleaned.xls', sheet_name=regions)\n\n# Create a dataframe containing the totals for all the states over each fiscal year of data\ncolumns = ['State', 'Fiscal Year']\ncolumns.extend(snap_init_df['NERO'].columns[1:].tolist())\nnew_columns = [c.strip() for c in columns]\nall_states_df = pd.DataFrame(columns=new_columns)\nyear = 10\nbegin = 0\nend = 14\nfor i in range(0, 11):\n    file_name = '..\/input\/d\/sbengali\/publicassistance\/FY' + str(year) + file_suffix\n    temp_df = pd.read_excel(file_name, sheet_name=regions)\n    for j in range(0, len(regions)):\n        for k in range(0, 10):\n            temp_records = temp_df[regions[j]].iloc[:,- 5:][begin:end]\n            if begin < len(temp_df[regions[j]]):\n                state = temp_df[regions[j]].iloc[begin]['Fiscal Year and Month']\n                fiscal_yr = 2000 + year\n                records = [state, fiscal_yr]\n                records.extend(temp_records.iloc[13].tolist())\n                df_length = len(all_states_df)\n                all_states_df.loc[df_length] = records\n            if year < 15:\n                # Files for fiscal years 2010-14 have two blank lines between states' records\n                begin = begin + 14 + 2\n                end = end + 14 + 2\n            else:\n                begin = begin + 14 + 1\n                end = end + 14 + 1\n        # Reset the row indices\n        begin = 0\n        end = 14\n    year = year + 1","6cddbf55":"# Read in the state abbreviations that will be required for plotting the data on a map\nstate_abbrv_df = pd.read_json('..\/input\/d\/sbengali\/publicassistance\/state-abbrvs.json')\nstate_abbrv_df.rename(columns={'abbreviation':'State-Code'}, inplace=True)\nstate_abbrv_df.rename(columns={'name':'State'}, inplace=True)\nstate_abbrv_df.drop(state_abbrv_df[state_abbrv_df['State'] == 'North Carolina'].index, inplace = True)\nstate_abbrv_df = state_abbrv_df.replace(['District Of Columbia'],'District of Columbia')\nstate_abbrv_df.reset_index(drop=True, inplace=True)","de14da80":"# Drop rows with region names in state column\nall_states_df.drop(all_states_df[all_states_df['State'].isin(regions)].index, inplace = True)\n# Drop data that can't be plotted\ndrop_states = ['North Carolina', 'Guam', 'Virgin Islands']\nall_states_df.drop(all_states_df[all_states_df['State'].isin(drop_states)].index, inplace = True)\n# Remove 2020 data because it's incomplete\nall_states_df.drop(all_states_df[all_states_df['Fiscal Year'] == 2020].index, inplace = True)\nall_states_df.reset_index(drop=True, inplace=True)","46fece97":"# Merge dataframes to include abbreviation data for the state names\nall_states_df = pd.merge(all_states_df, state_abbrv_df, on ='State', how ='inner')","37f3a308":"traces = []\n# Filter data for each year for the slider to work\nfor year in all_states_df['Fiscal Year'].unique():\n    trace_df = all_states_df[all_states_df['Fiscal Year']==year].copy()\n    trace = dict(\n                type = 'bar',\n                visible = False,\n                x=trace_df['State'],\n                y=trace_df['Cost'],\n                marker=dict(color='#157612'),\n                width=0.5,\n                showlegend=False,\n                hovertemplate=\n                \"<b>%{x}<\/b><br><br>\"\n                \"<b>$%{y}<\/b><br><br>\"\n                \"<extra><\/extra>\",\n             )\n    traces.append(trace)\n\ntraces[0]['visible'] = True\n\n# Create and add slider\nsteps_bar = []\nfor i in range(len(traces)):\n    step = dict(\n        method=\"restyle\",\n        args=['visible', [False] * len(traces)],\n        label='<b>Fiscal Year {}<\/b>'.format(i + 2010))\n    step['args'][1][i] = True\n    steps_bar.append(step)\n\n# Create the sliders from the steps\nsliders_bar = [dict(active=0, pad={\"t\": 90}, steps=steps_bar)]\nlayout_bar = go.Layout(width=900, height=700, title='Yearly Total SNAP Cost by State')\nfig_bar = go.Figure(data=traces, layout=layout_bar)\nfig_bar.update_layout(\n    sliders=sliders_bar, \n    xaxis_tickangle=-45, \n    yaxis_title='Total SNAP Cost', \n    title_x=0.5,\n    margin=dict(l=20, r=20, t=40, b=20))\nfig_bar.update_yaxes(range=[all_states_df['Cost'].min(), all_states_df['Cost'].max()])\nplotly.offline.iplot(fig_bar)","76a95680":"# Read in data for state populations\npop_df = pd.read_csv('..\/input\/d\/sbengali\/publicassistance\/state-populations.csv')\npop_df.rename(columns={'State':'State-Code'}, inplace=True)\npop_df.sort_values(by=['State-Code'], ascending=True, axis=0, inplace=True)\npop_df.rename(columns={'Year':'Fiscal Year'}, inplace=True)","b85ce96e":"# Merge dataframes to include population data for the states\nall_states_df = all_states_df.merge(pop_df, left_on=['State-Code', 'Fiscal Year'], right_on=['State-Code', 'Fiscal Year'])","b4678a95":"# Calculate percentage of state residents using SNAP benefits\nall_states_df[['Percentage Participation']] = all_states_df[['Persons Participation']].div(all_states_df['Population'].values, axis=0)\nall_states_df['Percentage Participation'] = 100 * all_states_df['Percentage Participation']","19e228d0":"all_states_df.sort_values(by=['State'], ascending=True, axis=0, inplace=True)\ntraces = []\n# Filter data for each year for the slider to work\nfor year in all_states_df['Fiscal Year'].unique():\n    trace_df = all_states_df[all_states_df['Fiscal Year']==year].copy()\n    trace_df.sort_values(by=['State'], ascending=True, axis=0, inplace=True)\n    trace = dict(\n                type = 'bar',\n                visible = False, \n                x=trace_df['State'],\n                y=trace_df['Percentage Participation'],\n                marker=dict(color='#18329B'),\n                width=0.5,\n                showlegend=False, \n                hovertemplate=\n                \"<b>%{x}<\/b><br><br>\"\n                \"<b>%{y:.2f}%<\/b><br><br>\"\n                \"<extra><\/extra>\",\n             )\n    traces.append(trace)\n\ntraces[0]['visible'] = True\n\n# Create and add slider steps\nsteps_bar = []\nfor i in range(len(traces)):\n    step = dict(\n        method=\"restyle\",\n        args=['visible', [False] * len(traces)],\n        label='<b>Fiscal Year {}<\/b>'.format(i + 2010))\n    step['args'][1][i] = True\n    steps_bar.append(step)\n\n# Create the sliders from the steps\nsliders_bar = [dict(active=0, pad={\"t\": 90}, steps=steps_bar)]\nlayout_bar = go.Layout(width=1000, height=700, title='Yearly Percentage SNAP Participation by State')\nfig_bar = go.Figure(data=traces, layout=layout_bar)\nfig_bar.update_layout(\n    sliders=sliders_bar, \n    xaxis_tickangle=-45, \n    yaxis_title='Percentage Participation', \n    title_x=0.5,\n    margin=dict(l=20, r=45, t=40, b=20))\nfig_bar.update_yaxes(range=[all_states_df['Percentage Participation'].min(), 30]) \nplotly.offline.iplot(fig_bar)","6b13b779":"snap_hist_df = pd.read_csv('..\/input\/d\/sbengali\/publicassistance\/SNAP_history_1969_2019.csv')\nsnap_hist_df['Total Costs(M)'] = 1000000 * snap_hist_df['Total Costs(M)'] # Convert to millions\nsnap_hist_df['Average Participation'] = 1000 * snap_hist_df['Average Participation'] # Convert to thousands\nsnap_hist_df = snap_hist_df.astype(float)\npov_hist_df = pd.read_csv('..\/input\/d\/sbengali\/publicassistance\/historical-poverty-data-1959-2019.csv')\n\n# Drop poverty data prior to 1969 to match with SNAP data range\npov_hist_df.drop(pov_hist_df[pov_hist_df['Year'] < 1969].index, inplace = True)\npov_hist_df['Number of poor families'] = 1000 * pov_hist_df['Number of poor families'] # Convert to thousands\npov_hist_df = pov_hist_df.astype(float)","b0df15b8":"# Plot total costs and number of poor families\nfig2 = plotly.subplots.make_subplots(rows=1, cols=2)\nfig2.add_trace(go.Scatter(x=snap_hist_df['Fiscal Year'].values, y=snap_hist_df['Total Costs(M)'].values, \n                          name='SNAP Cost', line=dict(color=\"#1E1EB1\")), row=1, col=1)\nfig2.update_yaxes(rangemode=\"tozero\", tickprefix=\"$\")\nfig2.update_xaxes(tick0=1969, dtick=10)\nfig2.add_trace(go.Scatter(x=pov_hist_df['Year'].values, y=pov_hist_df['Number of poor families'].values, \n                          name='Number of Families', line=dict(color='#CD2424')), row=1, col=2)\nfig2.update_layout(\n    title='Total SNAP Costs and Families at the Poverty Threshold',\n    title_x=0.5,\n    margin=dict(l=10, r=10, t=40, b=20),\n    width=1200, \n    height=500,\n    showlegend=False,\n)\nfig2.update_yaxes(\n    title_text='Total SNAP Cost',\n    tickfont=dict(\n        color='#1E1EB1'\n    ),\n    row=1, \n    col=1\n)\nfig2.update_yaxes(\n    title_text='Number of Families',\n    tickfont=dict(\n        color='#CD2424'\n    ),\n    row=1, \n    col=2\n)\n    \nfig2.show()","006fbd6f":"# Plot total costs and average participation in SNAP\nfig3 = plotly.subplots.make_subplots(rows=1, cols=2)\nfig3.add_trace(go.Scatter(x=snap_hist_df['Fiscal Year'].values, y=snap_hist_df['Total Costs(M)'].values, \n                          name='SNAP Cost', line=dict(color=\"#1E1EB1\")), row=1, col=1)\nfig3.update_yaxes(rangemode=\"tozero\", tickprefix=\"$\")\nfig3.update_xaxes(tick0=1969, dtick=10)\nfig3.add_trace(go.Scatter(x=snap_hist_df['Fiscal Year'].values, y=snap_hist_df['Average Participation'].values, \n                          name='Number of Participants in SNAP', line=dict(color='#C112B1')), row=1, col=2)\nfig3.update_layout(\n    title='Total SNAP Costs and Participants in SNAP',\n    title_x=0.5,\n    margin=dict(l=10, r=10, t=40, b=20),\n    width=1200, \n    height=500,\n    showlegend=False,\n)\nfig3.update_yaxes(\n    title_text='Total SNAP Cost',\n    tickfont=dict(\n        color='#1E1EB1'\n    ),\n    row=1, \n    col=1\n)\nfig3.update_yaxes(\n    title='Number of Participants',\n        tickfont=dict(\n            color='#C112B1'\n    ),\n    row=1, \n    col=2\n)\n    \nfig3.show()","756594d4":"# Plot total costs and average monthly benefit per person\nfig4 = plotly.subplots.make_subplots(rows=1, cols=2)\nfig4.add_trace(go.Scatter(x=snap_hist_df['Fiscal Year'].values, y=snap_hist_df['Total Costs(M)'].values,\n                          name='SNAP Cost', line=dict(color=\"#1E1EB1\")), row=1, col=1)\nfig4.update_yaxes(rangemode=\"tozero\", tickprefix=\"$\")\nfig4.update_xaxes(tick0=1969, dtick=10)\nfig4.add_trace(go.Scatter(x=snap_hist_df['Fiscal Year'].values, y=snap_hist_df['Average Benefit Per Person'].values, \n                          name='Monthly Benefit Per Participant', line=dict(color='#53A729')), row=1, col=2)\nfig4.update_layout(\n    title='Total SNAP Costs and Monthly SNAP Benefit per Participant',\n    title_x=0.5,\n    margin=dict(l=10, r=10, t=40, b=20),\n    width=1200, \n    height=500,\n    showlegend=False,\n)\nfig4.update_yaxes(\n    title_text='Total SNAP Cost',\n    tickfont=dict(\n        color='#1E1EB1'\n    ),\n    row=1, \n    col=1\n)\nfig4.update_yaxes(\n    title='Monthly Benefit',\n        tickfont=dict(\n            color='#53A729'\n    ),\n    row=1, \n    col=2\n)\n\nfig4.show()","7c2ff7ee":"# Plot data on monthly SNAP benefits and national food expense per person\nfood_hist_df = pd.read_csv('..\/input\/d\/sbengali\/publicassistance\/historical-food-expense.csv')\nfood_hist_df = food_hist_df.astype(float)\nfig5 = go.Figure()\nfig5.add_trace(go.Scatter(x=food_hist_df['Year'].values, y=food_hist_df['Monthly expense per person'].values, \n                          name='Monthly Food Expense Per Person Nationwide', line=dict(color=\"#661BCB\")))\nfig5.update_yaxes(rangemode=\"tozero\", tickprefix=\"$\")\nfig5.update_xaxes(dtick=4, nticks=15)\nfig5.add_trace(go.Scatter(x=snap_hist_df['Fiscal Year'].values, y=snap_hist_df['Average Benefit Per Person'].values, \n                          name='Monthly SNAP Benefit Per Participant', line=dict(color='#53A729')))\nfig5.update_layout(\n    title='Monthly Food Expense Nationwide and Monthly SNAP Benefit Per Participant',\n    title_x=0.51,\n    legend=dict(\n        yanchor=\"top\",\n        y=0.99,\n        xanchor=\"right\",\n        x=0.47\n    ),\n    margin=dict(l=20, r=20, t=40, b=20),\n    width=800, \n    height=600,\n)\n\nfig5.show()","6732e2bd":"Let's take a look at the percentage of the population of each state that participates in SNAP. This percentage changes over the years 2010 to 2019, dropping to a relative low in 2015, before rising again. ","e205e9b5":"We can see that the average monthly SNAP benefit per person has gone up over time along with total SNAP costs, but this brings up another question - how does this relate to the average cost of food which has also risen over the years?","915f4545":"## Conclusion:\nIn 2019, SNAP benefits would only cover about 28% of the bill of a month's worth of food, while in 1996, it was 34%. Clearly, in order for needy families to be able to have access to a healthy and balanced diet, an increase in the monthly SNAP benefit would be extremely beneficial. ","417cb2ac":"## SNAP Costs and Poverty Levels:\nNational participation by needy families in SNAP closely mirrors the program's costs. We can see in the next two graphs how the trends for the number of families that meet the poverty threshold (as [defined](https:\/\/www.census.gov\/data\/tables\/time-series\/demo\/income-poverty\/historical-poverty-thresholds.html) by the US Census Bureau), and the number of SNAP participants follows trends in total SNAP costs.","aefd75ce":"By filtering the data for different fiscal years, we can see which states spend more than others. (Note that North Carolina data is not visible because it was not made available to the USDA.) Costs can be affected by major events such as natural disasters. For example, Florida had higher spending in 2018, when residents were affected by hurricanes. Note the jump in SNAP costs to Florida in the year 2018. Out of all the states, California consistently spent the most on SNAP in the time frame shown above. ","bfb403f8":"## Supplemental Nutrition Assistance Program (SNAP) Data Analysis\n### What is SNAP?\nSNAP is a US Federal government funded program that provides assistance with food budgets to families in need. By examining the costs to run this program, we can discover trends associated with the economy, as well as the relation of costs to poverty levels in the country. We will also examine if SNAP benefits have kept up with the ever-increasing cost of food in the US. ","f5926d91":"First, let's look at the data by state, to see which states spend the most on SNAP. Data includes the cost of administration of the program, which is estimated to be about 8% of the total cost. ([Source](https:\/\/www.cbpp.org\/92-percent-of-federal-snap-spending-is-for-food)) The chart below shows how much each state spent from 2010 to 2019. ","b7a8c7d6":"The graph above shows us that over time, the monthly food expense per person in the US has risen quicker than the monthly SNAP benefit per person. This makes it harder to buy food solely using SNAP without any supplemental income. ","d88f4780":"## SNAP Benefits and the Cost of Food:\nNext, let's take a look at how much the average monthly SNAP benefit to each person has changed over the years."}}