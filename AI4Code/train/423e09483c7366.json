{"cell_type":{"0a55fe5a":"code","344060f5":"code","e83cb72f":"code","c8c720f7":"code","014732e8":"code","51833ecc":"code","a770c370":"code","a1275657":"code","aeaad130":"code","5781545c":"code","b9dddb1e":"code","84feeb6d":"code","b75e9c5d":"code","f85ce053":"markdown"},"source":{"0a55fe5a":"from fastai.vision.all import *","344060f5":"path = Path('..\/input\/ranzcr-clip-catheter-line-classification')","e83cb72f":"train_df = pd.read_csv(path\/'train.csv')\ntrain_df","c8c720f7":"columns = list(train_df.columns[1:12])","014732e8":"def get_x(r):\n    return path\/'train'\/(r['StudyInstanceUID']+'.jpg')\n\ndef get_y(r):\n    return r[columns].values.tolist()\n\ndef get_data(size=224, bs=128, data_df=train_df):\n    dblock = DataBlock(blocks=(ImageBlock, MultiCategoryBlock(encoded=True, vocab=columns)),\n                       splitter=RandomSplitter(seed=42),\n                       get_x = get_x,\n                       get_y = get_y,\n                       item_tfms = RandomResizedCrop(460, min_scale=0.75, ratio=(1.,1.)),\n                       batch_tfms = [*aug_transforms(size=size, flip_vert=True, max_warp=0),\n                                     Normalize.from_stats(*imagenet_stats)])\n    return dblock.dataloaders(data_df, bs=bs)\n","51833ecc":"dls = get_data()\ndls.show_batch()","a770c370":"learn = cnn_learner(dls, resnet50, metrics=accuracy_multi, cbs=MixUp).to_native_fp16()","a1275657":"learn.fine_tune(5)","aeaad130":"learn = learn.to_native_fp32()","5781545c":"submission_df = pd.read_csv(path\/'sample_submission.csv')\nsubmission_df.iloc[:,1:] = submission_df.iloc[:,1:].astype(float)\nsubmission_df","b9dddb1e":"test_data_path = submission_df['StudyInstanceUID'].apply(lambda x: path\/'test'\/(x + '.jpg'))\ntst_dl = learn.dls.test_dl(test_data_path)1\npreds, targs = lean.tta(dl= tst_dl)","84feeb6d":"submission_df[columns] =pd.DataFrame(preds, columns= columns)\nsubmission_df","b75e9c5d":"submission_df.to_csv('submission.csv', index=False)","f85ce053":"https:\/\/www.kaggle.com\/slm37102\/ranzcr-clip-fastai-starter\/"}}