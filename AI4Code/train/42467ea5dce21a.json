{"cell_type":{"660ccf75":"code","1ad01841":"code","97127e81":"code","d4dbe09c":"code","4494f6ba":"code","e3bce787":"code","fb5b4e07":"code","d70e9746":"code","ea7fc1ce":"code","5a14fbab":"code","a18e1d1e":"code","758633ca":"code","e05c2a6d":"code","1eb36e20":"code","658220fc":"code","183e25e8":"code","612fa75f":"code","9d3429b6":"code","a4b79df4":"code","3a05a6fa":"markdown"},"source":{"660ccf75":"import pandas as pd\nimport numpy as np\n\nfrom collections import Counter\nimport collections\nfrom datetime import datetime\nfrom datetime import timedelta\n\nfrom tqdm import tqdm\ntqdm.pandas()\n\nfrom sklearn.preprocessing import MinMaxScaler\nfrom sklearn.metrics import cohen_kappa_score\n\nimport xgboost as xgb\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.metrics import mean_squared_error, r2_score\nimport matplotlib.pyplot as plt\n\nfrom sklearn import linear_model\nfrom sklearn import model_selection\nfrom sklearn.metrics import classification_report\nfrom sklearn.metrics import confusion_matrix\nfrom sklearn.metrics import accuracy_score\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.svm import SVC\nfrom sklearn.multiclass import OneVsRestClassifier\nfrom sklearn.preprocessing import MultiLabelBinarizer\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.neighbors import KNeighborsClassifier\n\n\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n","1ad01841":"train=pd.read_csv(\"\/kaggle\/input\/data-science-bowl-2019\/train.csv\",sep=',',decimal='.')\ntest=pd.read_csv(\"\/kaggle\/input\/data-science-bowl-2019\/test.csv\",sep=',',decimal='.')\ntrain_labels=pd.read_csv(\"\/kaggle\/input\/data-science-bowl-2019\/train_labels.csv\",sep=',',decimal='.')\nspecs=pd.read_csv(\"\/kaggle\/input\/data-science-bowl-2019\/specs.csv\",sep=',',decimal='.')\nsample_submission=pd.read_csv(\"\/kaggle\/input\/data-science-bowl-2019\/sample_submission.csv\",sep=',',decimal='.')","97127e81":"print('Evaluaciones: ', train_labels['title'].unique())\nprint('Total de Evaluaciones: ', len(train_labels['title'].unique()))","d4dbe09c":"assessment=train_labels['title'].value_counts()\nfig = plt.figure()\nax = assessment.plot(kind='barh',grid=False, color='blue')\nplt.show()","4494f6ba":"train=train.drop(['timestamp','event_data'],axis=1)\ntest=test.drop(['timestamp','event_data'],axis=1)","e3bce787":"train=train[train.installation_id.isin(train_labels.installation_id.unique())]\ntest_assess = test[test.type == 'Assessment'].copy()\ntest_labels = sample_submission.copy()\ntest_labels['title'] = test_labels['installation_id'].progress_apply(lambda install_id: test_assess[test_assess.installation_id == install_id].iloc[-1].title)","fb5b4e07":"train=train.drop(['event_id','event_code'],axis=1)\ntest=test.drop(['event_id','event_code'],axis=1)\n\ntrain_2=(pd.get_dummies(train.drop(columns=['game_session', 'event_count', 'game_time']),\n            columns=['title', 'type', 'world']).groupby(['installation_id']).sum())\n\ntest_2=(pd.get_dummies(test.drop(columns=['game_session', 'event_count', 'game_time']),\n            columns=['title', 'type', 'world']).groupby(['installation_id']).sum())\n\ntrain_3=(train[['installation_id', 'event_count', 'game_time']].groupby(['installation_id'])\n        .agg([np.sum, np.mean, np.std, np.min, np.max]))\n            \ntest_3=(test[['installation_id', 'event_count', 'game_time']].groupby(['installation_id'])\n        .agg([np.sum, np.mean, np.std, np.min, np.max]))","d70e9746":"def parameters(group1, col):\n    return group1[['installation_id', col, 'event_count', 'game_time']\n                 ].groupby(['installation_id', col]).agg([np.mean, np.sum, np.std]).reset_index().pivot(\n        columns=col,index='installation_id')\n\n\nworld_time_stats_train = parameters(train, 'world')\ntype_time_stats_train = parameters(train, 'type')\nworld_time_stats_test = parameters(test, 'world')\ntype_time_stats_test = parameters(test, 'type')","ea7fc1ce":"new_train=train_2.join(train_3).join(world_time_stats_train).join(type_time_stats_train).fillna(0)\nnew_test=test_2.join(test_3).join(world_time_stats_test).join(type_time_stats_test).fillna(0)","5a14fbab":"titles = train_labels.title.unique()\ntitle2mode = {}\n\nfor title in titles:\n    mode = train_labels[train_labels.title == title].accuracy_group.value_counts().index[0]\n    title2mode[title] = mode\n\ntrain_labels['title_mode'] = train_labels.title.apply(lambda title: title2mode[title])\ntest_labels['title_mode'] = test_labels.title.apply(lambda title: title2mode[title])","a18e1d1e":"final_train = pd.get_dummies((train_labels.set_index('installation_id')\n        .drop(columns=['num_correct', 'num_incorrect', 'accuracy', 'game_session'])\n        .join(new_train)),columns=['title'])\n\n\n\nfinal_train = final_train.reset_index().groupby('installation_id').apply(lambda x: x.iloc[-1])\nfinal_train = final_train.drop(columns='installation_id')\n\nprint('Dimensi\u00f3n train_labels:', final_train.shape)\n\nfinal_test = pd.get_dummies(test_labels.set_index('installation_id').join(new_test), columns=['title'])\n\nprint('Dimensi\u00f3n test_labels:',final_test.shape)","758633ca":"X = final_train.drop(columns='accuracy_group').values\ny = final_train['accuracy_group'].values\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, train_size=0.85,random_state=1)\n\nprint('Dimensiones x_train: ',X_train.shape)\nprint('Dimensiones x_test: ',X_test.shape)\nprint('Dimensiones y_train: ',y_train.shape)\nprint('Dimensiones y_test: ',y_test.shape)","e05c2a6d":"scaler = MinMaxScaler()\nX_train = scaler.fit_transform(X_train)\nX_test = scaler.transform(X_test)","1eb36e20":"X2=final_train.drop(columns='accuracy_group').index\ny2=final_train['accuracy_group'].index\nX_train2, X_test2, y_train2, y_test2 = train_test_split(X2, y2, train_size=0.85,random_state=1)","658220fc":"\n\nmodel=xgb.XGBRegressor()\nmodel.fit(X_train, y_train)\n\npredictions = model.predict(X_test)","183e25e8":"dist = Counter(final_train['accuracy_group'])\nfor k in dist:\n    dist[k] \/= len(final_train)","612fa75f":"acum = 0\nbound = {}\nfor i in range(3):\n    acum += dist[i]\n    bound[i] = np.percentile(predictions, acum * 100)\n\n\ndef classify(x):\n    if x <= bound[0]:\n        return 0\n    elif x <= bound[1]:\n        return 1\n    elif x <= bound[2]:\n        return 2\n    else:\n        return 3\n    \nfinal_pred = np.array(list(map(classify, predictions)))","9d3429b6":"score=cohen_kappa_score(y_test,final_pred,weights='quadratic')\n\nprint('cohen_kappa_score :',score)\n\nprint(confusion_matrix(y_test, final_pred))\n\nprint(classification_report(y_test, final_pred))","a4b79df4":"sub=pd.DataFrame()\nsub['installation_id']=X_test2\nsub['accuracy_group']=final_pred\n\nsub.to_csv('submission.csv', index=False)","3a05a6fa":"**XGBRegressor**"}}