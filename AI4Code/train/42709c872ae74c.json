{"cell_type":{"c7a15564":"code","a5833129":"code","faa442cd":"code","956fe778":"code","eec9cffc":"code","146a6212":"code","1f9b68ce":"code","2b99ec4f":"code","61f9d1ad":"code","baa36540":"code","5dc373ce":"code","ab209c70":"code","4ca15dbe":"code","eff61835":"code","afb0de87":"code","8b3fcfc9":"code","ce51e468":"code","4955b208":"code","6a275259":"code","76d62080":"code","cfbc976a":"code","a44cb0bd":"code","7bec0154":"code","6763b283":"code","5da25a4e":"code","c2e0e058":"code","3424d99d":"code","0e2371ad":"code","8b219678":"code","93fbf32e":"code","f3c345c0":"code","45f3589f":"code","3c3a663b":"code","c0512dc1":"code","cf2aae5a":"code","7bad87d4":"code","3e2d4add":"code","6c9d0a32":"code","7374a8e5":"code","8d45bab7":"code","71236176":"code","5e0f17b0":"code","bdcc45aa":"code","59c0da1b":"code","d1c87831":"code","a6755c0d":"code","4d3f0449":"code","eeccbda4":"code","a4310c80":"code","81e066bc":"code","51e4d7f6":"code","d4986d32":"code","8175a16b":"code","7ab22c04":"code","fd7f1f16":"code","c45771d0":"code","1e85d81c":"code","f17d7462":"code","9f66712c":"code","e47a1780":"code","92b932d7":"code","2b1ac56d":"code","47a7b4bb":"code","5cb5d81f":"code","41bce3e0":"code","c501c013":"code","4f481714":"code","9d61468b":"markdown","9da79908":"markdown","fe9ab2fe":"markdown","129c1f03":"markdown","0237a27d":"markdown","671557af":"markdown","29e08303":"markdown","4e61b0bc":"markdown","d982e92b":"markdown","db537ef3":"markdown","64ac36d3":"markdown","3f1e1952":"markdown","a817904c":"markdown","46af2eb9":"markdown","f9780206":"markdown","bf98f2ef":"markdown","ef83002a":"markdown","ca31e980":"markdown","9801fa3e":"markdown","ddbc2b9b":"markdown","eebd235b":"markdown","36813a76":"markdown","5d7ddf0a":"markdown","dd1815e1":"markdown","ab44095d":"markdown","65763592":"markdown","2685e52a":"markdown","d72412d7":"markdown","ee68db86":"markdown","8341ec70":"markdown"},"source":{"c7a15564":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\n\n\nimport os\nprint(os.listdir(\"..\/input\"))\n","a5833129":"df = pd.read_csv('..\/input\/WA_Fn-UseC_-Telco-Customer-Churn.csv',index_col='customerID')","faa442cd":"df.head(15)","956fe778":"df.info()","eec9cffc":"# We need to convert the Total Charges from object type to Numeric\ndf['TotalCharges'] = df['TotalCharges'].replace(r'\\s+', np.nan, regex=True)\ndf['TotalCharges'] = pd.to_numeric(df['TotalCharges'])","146a6212":"df.info()","1f9b68ce":"df.Partner.value_counts(normalize=True).plot(kind='bar');","2b99ec4f":"df.SeniorCitizen.value_counts(normalize=True).plot(kind='bar');","61f9d1ad":"df.gender.value_counts(normalize=True).plot(kind='bar');","baa36540":"df.tenure.value_counts(normalize=True).plot(kind='bar',figsize=(16,7));","5dc373ce":"df.PhoneService.value_counts(normalize=True).plot(kind='bar');","ab209c70":"df.MultipleLines.value_counts(normalize=True).plot(kind='bar');","4ca15dbe":"df.InternetService.value_counts(normalize=True).plot(kind='bar');","eff61835":"df.Contract.value_counts(normalize=True).plot(kind='bar');","afb0de87":"df.PaymentMethod.value_counts(normalize=True).plot(kind='bar');","8b3fcfc9":"# First let's see Our Target Variable\ndf.Churn.value_counts(normalize=True).plot(kind='bar');\n","ce51e468":"# Now Let's Start Comparing.\n# Gender Vs Churn\nprint(pd.crosstab(df.gender,df.Churn,margins=True))\npd.crosstab(df.gender,df.Churn,margins=True).plot(kind='bar',figsize=(7,5));","4955b208":"print('Percent of Females that Left the Company {0}'.format((939\/1869)*100))\nprint('Percent of Males that Left the Company {0}'.format((930\/1869)*100))     ","6a275259":"# Contract Vs Churn\nprint(pd.crosstab(df.Contract,df.Churn,margins=True))\npd.crosstab(df.Contract,df.Churn,margins=True).plot(kind='bar',figsize=(7,5));","76d62080":"print('Percent of Month-to-Month Contract People that Left the Company {0}'.format((1655\/1869)*100))\nprint('Percent of One-Year Contract People that Left the Company {0}'.format((166\/1869)*100)) \nprint('Percent of Two-Year Contract People that Left the Company {0}'.format((48\/1869)*100))     ","cfbc976a":"# Internet Service Vs Churn\nprint(pd.crosstab(df.InternetService,df.Churn,margins=True))\npd.crosstab(df.InternetService,df.Churn,margins=True).plot(kind='bar',figsize=(7,5));","a44cb0bd":"print('Percent of DSL Internet-Service People that Left the Company {0}'.format((459\/1869)*100))\nprint('Percent of Fiber Optic Internet-Service People that Left the Company {0}'.format((1297\/1869)*100)) \nprint('Percent of No Internet-Service People that Left the Company {0}'.format((113\/1869)*100))     ","7bec0154":"# Tenure Median Vs Churn\nprint(pd.crosstab(df.tenure.median(),df.Churn))\npd.crosstab(df.tenure.median(),df.Churn).plot(kind='bar',figsize=(7,5));","6763b283":"# Partner Vs Dependents\nprint(pd.crosstab(df.Partner,df.Dependents,margins=True))\npd.crosstab(df.Partner,df.Dependents,margins=True).plot(kind='bar',figsize=(5,5));","5da25a4e":"print('Percent of Partner that had Dependents {0}'.format((1749\/2110)*100))\nprint('Percent of Non-Partner that had Dependents {0}'.format((361\/2110)*100))     ","c2e0e058":"# Partner Vs Churn\nprint(pd.crosstab(df.Partner,df.Churn,margins=True))\npd.crosstab(df.Partner,df.Churn,margins=True).plot(kind='bar',figsize=(5,5));","3424d99d":"plt.figure(figsize=(17,8))\nsns.countplot(x=df['tenure'],hue=df.Partner);","0e2371ad":"# Partner Vs Churn\nprint(pd.crosstab(df.Partner,df.Churn,margins=True))\npd.crosstab(df.Partner,df.Churn,normalize=True).plot(kind='bar');","8b219678":"# Senior Citizen Vs Churn\nprint(pd.crosstab(df.SeniorCitizen,df.Churn,margins=True))\npd.crosstab(df.SeniorCitizen,df.Churn,normalize=True).plot(kind='bar');","93fbf32e":"df.boxplot('MonthlyCharges');","f3c345c0":"df.boxplot('TotalCharges');","45f3589f":"df.describe()","3c3a663b":"# Let's Check the Correaltion Matrix in Seaborn\nsns.heatmap(df.corr(),xticklabels=df.corr().columns.values,yticklabels=df.corr().columns.values,annot=True);","c0512dc1":"# Checking For NULL \ndf.isnull().sum()","cf2aae5a":"df.head(15)","7bad87d4":"fill = df.MonthlyCharges * df.tenure","3e2d4add":"df.TotalCharges.fillna(fill,inplace=True)","6c9d0a32":"df.isnull().sum()","7374a8e5":"df.loc[(df.Churn == 'Yes'),'MonthlyCharges'].median()","8d45bab7":"df.loc[(df.Churn == 'Yes'),'TotalCharges'].median()","71236176":"df.loc[(df.Churn == 'Yes'),'tenure'].median()","5e0f17b0":"df.loc[(df.Churn == 'Yes'),'PaymentMethod'].value_counts(normalize = True)","bdcc45aa":"df['Is_Electronic_check'] = np.where(df['PaymentMethod'] == 'Electronic check',1,0)","59c0da1b":"df.loc[(df.Churn == 'Yes'),'PaperlessBilling'].value_counts(normalize = True)","d1c87831":"df.loc[(df.Churn == 'Yes'),'DeviceProtection'].value_counts(normalize = True)","a6755c0d":"df.loc[(df.Churn == 'Yes'),'OnlineBackup'].value_counts(normalize = True)","4d3f0449":"df.loc[(df.Churn == 'Yes'),'TechSupport'].value_counts(normalize = True)","eeccbda4":"df.loc[(df.Churn == 'Yes'),'OnlineSecurity'].value_counts(normalize = True)","a4310c80":"df= pd.get_dummies(df,columns=['Partner','Dependents',\n       'PhoneService', 'MultipleLines','StreamingTV',\n       'StreamingMovies','Contract','PaperlessBilling','InternetService'],drop_first=True)","81e066bc":"df.info()","51e4d7f6":"df.drop(['StreamingTV_No internet service','StreamingMovies_No internet service'],axis=1,inplace=True)","d4986d32":"df.drop('gender',axis=1,inplace=True)","8175a16b":"df.drop(['tenure','MonthlyCharges'],axis=1,inplace=True)","7ab22c04":"df.drop(['OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','PaymentMethod'],axis=1,inplace=True)","fd7f1f16":"df = pd.get_dummies(df,columns=['Churn'],drop_first=True)","c45771d0":"df.info()","1e85d81c":"X = df.drop('Churn_Yes',axis=1).as_matrix().astype('float')\ny = df['Churn_Yes'].ravel()","f17d7462":"# train test split\nfrom sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=0)\nprint (X_train.shape, y_train.shape)\nprint (X_test.shape, y_test.shape)","9f66712c":"# Import Logistic Regression\nfrom sklearn.linear_model import LogisticRegression","e47a1780":"# create model\nmodel_lr_1 = LogisticRegression(random_state=0)","92b932d7":"# train model\nmodel_lr_1.fit(X_train,y_train)","2b1ac56d":"from sklearn.metrics import accuracy_score, confusion_matrix, precision_score, recall_score,classification_report","47a7b4bb":"# performance metrics\n# accuracy\nprint ('accuracy for logistic regression - version 1 : {0:.2f}'.format(accuracy_score(y_test, model_lr_1.predict(X_test))))\n# confusion matrix\nprint ('confusion matrix for logistic regression - version 1: \\n {0}'.format(confusion_matrix(y_test, model_lr_1.predict(X_test))))\n# precision \nprint ('precision for logistic regression - version 1 : {0:.2f}'.format(precision_score(y_test, model_lr_1.predict(X_test))))\n# precision \nprint ('recall for logistic regression - version 1 : {0:.2f}'.format(recall_score(y_test, model_lr_1.predict(X_test))))","5cb5d81f":"print(classification_report(y_test,model_lr_1.predict(X_test)))","41bce3e0":"from xgboost import XGBClassifier\nclassifier = XGBClassifier()\nclassifier.fit(X_train, y_train)","c501c013":"# performance metrics\n# accuracy\nprint ('accuracy for xgboost- version 1 : {0:.2f}'.format(accuracy_score(y_test, classifier.predict(X_test))))\n# confusion matrix\nprint ('confusion matrix for xgboost - version 1: \\n {0}'.format(confusion_matrix(y_test, classifier.predict(X_test))))\n# precision \nprint ('precision for xgboost - version 1 : {0:.2f}'.format(precision_score(y_test, classifier.predict(X_test))))\n# precision \nprint ('recall for xgboost - version 1 : {0:.2f}'.format(recall_score(y_test, classifier.predict(X_test))))","4f481714":"print(classification_report(y_test,classifier.predict(X_test)))","9d61468b":"# Modelling Part","9da79908":"**Let's Check for Outliers in Monthly Charges And Total Charges Using Box Plots**","fe9ab2fe":"**Here We can See Tenure and Total Charges are correlated and also Monthly charges and Total Charges are also correlated with each other. So this is proving our first Hypothesis right of Considering Total charges = Monthly charges * Tenure + Additional Tax that We had Taken Above.\n**","129c1f03":"**No Null Values are there Now..**","0237a27d":"# Correlation Matrix","671557af":"**Most of the People that Left are the Ones who had Payment Method as Electronic Check so Let's Make a Seperate Variable for it so that The Model can Easily Predict our Target Variable.**","29e08303":"# First Hypothesis Using Examples ","4e61b0bc":"**We have Encoded the Categorical Variables with Numeric using get dummies Property which will make it easy for the Machine to Make Correct Prediction.**","d982e92b":"**Here we can see that Total Charges is an object variable.\nLet's Change it to float**","db537ef3":"**We will Visualize other variables as we will perform our Analysis.**","64ac36d3":"**Most of the People that Were Partner will Stay Longer with The Company. So Being a Partner is a Plus-Point For the Company as they will Stay Longer with Them.**","3f1e1952":"**Both Monthly Charges and Total Charges don't have any Outliers so we don't have to Get into Extracting Information from Outliers.**","a817904c":"** Now Let's Explore the Dataset**","46af2eb9":"**Let's Convert Our Target Variable 'Churn' for Yes or No to 1 or 0. **","f9780206":"**Now Let's Plot variables with respect to Our Target Variable.**","bf98f2ef":"**Most of the people That Left had Fiber Optic Internet-Service.**","ef83002a":"**We have got a Great Accuracy of Approx  80% with Our Logistic Regression Model. Let's Try another Model which is XG Boost Classifier.**","ca31e980":"# When Churn = 'Yes'","9801fa3e":"# Data Munging Process","ddbc2b9b":"**We can See that Gender Does'nt Play an important Role in Predicting Our Target Variable.**","eebd235b":"**We can See that People That Left the Company did'nt use Services Like Online Security , Device Protection , Tech Support and Online Backup quite often. Hence for Our Prediction these variables will not be of much Importance. We will Drop them in the End.**","36813a76":"**Now Let's Drop the variables that are not Important For us according to our Analysis.**","5d7ddf0a":"**Let's start with Logistic Regression Model because we know Our Target Variable has a Binary Outcome.**","dd1815e1":"**We can See Partners had a much larger percent of Dependents than Non-Partner this tells us that Most Partners might be Married.**","ab44095d":"**We can See here that We have 11 Null Values in Total Charges so  let's try to fill them..**","65763592":"**Now We have only 16 variables that we think are important for Our Prediction. So let's Start our Modelling Part.**","2685e52a":"**Most of the People that Left were the Ones who had Month-to-Month  Contract.**","d72412d7":"**Thanks For Reading the Whole Kernel if you have any suggestions or changes that I can Make in this Kindly tell me in the Comment Section. I'll be glad to Here them.**","ee68db86":"**Here we can see that XG Boost gives us the best results. We can also perform Parameter tuning using Cross Validation for Improving our Model Accuracy but I will keep that For you all.**","8341ec70":"**Let's Check for any Data Point **\n\n**For Second Data Point**\n\n**Our Calculation**  = 56.95 * 34(tenure) = 1936.3\n\n**Given Total Charges** = 1889.50 \n\n**Difference** = 46.8 \n\n**Let's Take Another Example**\n\n**For Fourth Data Point**\n\n**Our Calculation**  = 42.30 * 45(tenure) = 1903.5\n\n**Given Total Charges** = 1840.75\n\n**Difference** = 62.75\n\n**Here we can See we Have some difference this might be some kind of additional Tax and this must vary \nfrom monthly plan to plan.**\n\n**So According to Our Hypothesis Total-Charges should be Monthly Charges * Tenure + Additional Charges(Tax). \nWe will see Later if this Hypothesis is Correct or Not.**"}}