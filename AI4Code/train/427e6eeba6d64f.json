{"cell_type":{"eac9b60d":"code","7b1f90dc":"code","a559d977":"code","ac447072":"code","554e92c7":"code","17db71a7":"code","997c38f6":"code","61745a4a":"code","b2d13804":"code","4fa1f4f1":"code","a88e6e88":"code","e23cb506":"code","4f43f171":"code","fe1a7c9a":"code","d9849e76":"code","017d74c2":"code","ffecfcf6":"code","17d32487":"code","f73518a7":"code","64321dc9":"markdown","fb68058c":"markdown","77536471":"markdown","5ea0bcfd":"markdown","8c9c22e3":"markdown","ff69c460":"markdown","27179165":"markdown","123702d1":"markdown","8dcd3fa4":"markdown","39f98e87":"markdown"},"source":{"eac9b60d":"# import the libraries as shown below\n\nfrom keras.layers import Input, Lambda, Dense, Flatten\nfrom keras.models import Model\n\nfrom keras.applications.vgg16 import VGG16\nfrom keras.applications.vgg16 import preprocess_input\nfrom keras.preprocessing import image\nfrom keras.preprocessing.image import ImageDataGenerator\nfrom keras.models import Sequential\n\nimport tensorflow as tf\n\nfrom keras.models import load_model\nimport numpy as np\nfrom glob import glob\nimport matplotlib.pyplot as plt","7b1f90dc":"#resize the images\n#provide path for test and train data\n\nIMAGE_SIZE =[224,224]\ntrain_path = '..\/input\/chest-xray-pneumonia\/chest_xray\/train'\ntest_path = '..\/input\/chest-xray-pneumonia\/chest_xray\/test'","a559d977":"vgg = VGG16(input_shape=IMAGE_SIZE + [3], weights='imagenet', include_top=False)","ac447072":"# its important that we don't train existing weights\nfor layer in vgg.layers:\n    layer.trainable = False","554e92c7":"  # useful for getting number of output classes\nfolders = glob('..\/input\/chest-xray-pneumonia\/chest_xray\/train\/*')","17db71a7":"# our layers - you can add more if you want\nx = Flatten()(vgg.output)","997c38f6":"prediction = Dense(len(folders), activation='softmax')(x)\n\n# create a model object\nmodel = Model(inputs=vgg.input, outputs=prediction)","61745a4a":"# for viewing the structure of the model\n\nmodel.summary()","b2d13804":"# tell the model what cost and optimization method to use\nmodel.compile(\n  loss='categorical_crossentropy',\n  optimizer='adam',\n  metrics=['accuracy']\n)","4fa1f4f1":"\nfrom keras.preprocessing.image import ImageDataGenerator\n\ntrain_datagen = ImageDataGenerator(rescale = 1.\/255,\n                                   shear_range = 0.2,\n                                   zoom_range = 0.2,\n                                   horizontal_flip = True)\n\ntest_datagen = ImageDataGenerator(rescale = 1.\/255)","a88e6e88":"# Make sure you provide the same target size as initialied for the image size\ntraining_set = train_datagen.flow_from_directory('..\/input\/chest-xray-pneumonia\/chest_xray\/train',\n                                                 target_size = (224, 224),\n                                                 batch_size = 32,\n                                                 class_mode = 'categorical')","e23cb506":"test_set = test_datagen.flow_from_directory('..\/input\/chest-xray-pneumonia\/chest_xray\/test',\n                                            target_size = (224, 224),\n                                            batch_size = 32,\n                                            class_mode = 'categorical')","4f43f171":"len(training_set)\n","fe1a7c9a":"len(test_set)","d9849e76":"#fit the model\n#change the parameters according to your needs to get a better accuracy\n\n\nr = model.fit_generator(\n  training_set,\n  validation_data=test_set,\n  epochs=5,\n  steps_per_epoch= len(training_set),\n  validation_steps= len(test_set)\n)","017d74c2":"\n\nmodel.save('BEST_model.h5')","ffecfcf6":"\n\n\nmodel = load_model('BEST_model.h5')","17d32487":"\n#selecting an image from validation dataset for prediction\n\ntest_image = image.load_img('..\/input\/chest-xray-pneumonia\/chest_xray\/val\/NORMAL\/NORMAL2-IM-1427-0001.jpeg',target_size=[224,224])\ntest_image = image.img_to_array(test_image)\ntest_image = test_image\/255\ntest_image = np.expand_dims(test_image,axis=0)\nresult = model.predict(test_image)","f73518a7":"result","64321dc9":"Pneumonia is an inflammatory condition of the lung primarily affecting the small air sacs known as alveoli. Symptoms typically include some combination of productive or dry cough, chest pain, fever and difficulty breathing. The severity of the condition is variable. Pneumonia is usually caused by infection with viruses or bacteria, and less commonly by other microorganisms. Identifying the responsible pathogen can be difficult. Diagnosis is often based on symptoms and physical examination. Chest X-rays, blood tests","fb68058c":"TRAINING","77536471":"saving the model","5ea0bcfd":"PREDICTION","8c9c22e3":"**LIBRARIES**","ff69c460":"Assigning path to data","27179165":"IMAGEDATAGENERATOR","123702d1":"![](https:\/\/stanfordmlgroup.github.io\/projects\/chexnet\/img\/chest-example.png)","8dcd3fa4":"MODEL","39f98e87":"# Pneumonia detection"}}