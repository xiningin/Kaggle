{"cell_type":{"459a09e0":"code","c862a070":"code","5cfe267d":"code","9f7b8788":"code","b3f97e36":"code","d635ff74":"code","14b03d3d":"code","bd45b571":"code","62c5d962":"code","1b87a436":"code","57ea6779":"code","9007afcf":"code","69f784f5":"code","6d16ced4":"code","7a956ec4":"code","fa84fa2d":"code","90a18527":"code","8d9004be":"code","d6611374":"markdown","9e808b87":"markdown","05eb580f":"markdown","73d41454":"markdown","5d6cc0b3":"markdown","3f955ddd":"markdown"},"source":{"459a09e0":"!pip install -U git+https:\/\/github.com\/paoloripamonti\/face-recognition.git","c862a070":"from face_recognition import FaceRecognition\n\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import classification_report, roc_curve, precision_recall_curve, roc_auc_score, accuracy_score\n\nimport matplotlib.pyplot as plt\nimport os\nimport glob\nimport pandas as pd\nimport random\nimport numpy as np\nimport cv2\nimport base64\nfrom tqdm import tqdm\nimport requests\nfrom pprint import pprint","5cfe267d":"ROOT_FOLDER =\"\/kaggle\/input\/lfw-dataset\/lfw-deepfunneled\/lfw-deepfunneled\/\"\nMODEL_PATH = \"lfw_model.pkl\"","9f7b8788":"dataset = []\nfor path in glob.iglob(os.path.join(ROOT_FOLDER, \"**\", \"*.jpg\")):\n    person = path.split(\"\/\")[-2]\n    dataset.append({\"person\":person, \"path\": path})\n    \ndataset = pd.DataFrame(dataset)\ndataset = dataset.groupby(\"person\").filter(lambda x: len(x) > 10)\ndataset.head(10)","b3f97e36":"dataset.groupby(\"person\").count()[:200].plot(kind='bar', figsize=(20,5))","d635ff74":"plt.figure(figsize=(20,10))\nfor i in range(20):\n    idx = random.randint(0, len(dataset))\n    img = plt.imread(dataset.path.iloc[idx])\n    plt.subplot(4, 5, i+1)\n    plt.imshow(img)\n    plt.title(dataset.person.iloc[idx])\n    plt.xticks([])\n    plt.yticks([])\nplt.tight_layout()\nplt.show()","14b03d3d":"train, test = train_test_split(dataset, test_size=0.1, random_state=0)\nprint(\"Train:\",len(train))\nprint(\"Test:\",len(test))","bd45b571":"%%time\nfr = FaceRecognition()","62c5d962":"%%time\nfr.fit_from_dataframe(train)","1b87a436":"fr.save(MODEL_PATH)","57ea6779":"%%time\ny_test, y_pred, y_scores = [],[],[]\nfor idx in tqdm(range(len(test))):\n    path = test.path.iloc[idx]\n    result = fr.predict(path)\n    for prediction in result[\"predictions\"]:\n        y_pred.append(prediction[\"person\"])\n        y_scores.append(prediction[\"confidence\"])\n        y_test.append(test.person.iloc[idx])","9007afcf":"print(classification_report(y_test, y_pred))","69f784f5":"print(\"Accuracy: %f\" % accuracy_score(y_test, y_pred))","6d16ced4":"person = \"George_W_Bush\"\npath = test[test.person==person][\"path\"].iloc[0]\nimg = cv2.imread(path)\nimg = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)\n\nresult = fr.predict(path)\nfile_bytes = np.fromstring(base64.b64decode(result[\"frame\"]), np.uint8)\noutput = cv2.imdecode(file_bytes,1)\n\nplt.figure(figsize=(10,5))\nplt.subplot(1, 2, 1)\nplt.imshow(img)\nplt.title(person)\nplt.subplot(1, 2, 2)\nplt.imshow(output)\nplt.title(\"%s (%f)\" % (result[\"predictions\"][0][\"person\"], result[\"predictions\"][0][\"confidence\"]))\nplt.tight_layout()\nplt.show()","7a956ec4":"person = \"Jennifer_Aniston\"\npath = test[test.person==person][\"path\"].iloc[0]\nimg = cv2.imread(path)\nimg = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)\n\nresult = fr.predict(path)\nfile_bytes = np.fromstring(base64.b64decode(result[\"frame\"]), np.uint8)\noutput = cv2.imdecode(file_bytes,1)\n\nplt.figure(figsize=(10,5))\nplt.subplot(1, 2, 1)\nplt.imshow(img)\nplt.title(person)\nplt.subplot(1, 2, 2)\nplt.imshow(output)\nplt.title(\"%s (%f)\" % (result[\"predictions\"][0][\"person\"], result[\"predictions\"][0][\"confidence\"]))\nplt.tight_layout()\nplt.show()","fa84fa2d":"person = \"Michael_Schumacher\"\npath = test[test.person==person][\"path\"].iloc[0]\nimg = cv2.imread(path)\nimg = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)\n\nresult = fr.predict(path)\nfile_bytes = np.fromstring(base64.b64decode(result[\"frame\"]), np.uint8)\noutput = cv2.imdecode(file_bytes,1)\n\nplt.figure(figsize=(10,5))\nplt.subplot(1, 2, 1)\nplt.imshow(img)\nplt.title(person)\nplt.subplot(1, 2, 2)\nplt.imshow(output)\nplt.title(\"%s (%f)\" % (result[\"predictions\"][0][\"person\"], result[\"predictions\"][0][\"confidence\"]))\nplt.tight_layout()\nplt.show()","90a18527":"!wget -O img.jpg https:\/\/i.pinimg.com\/originals\/9e\/1c\/c9\/9e1cc9329b82ad0084d5c4c30757d469.jpg","8d9004be":"path = \"img.jpg\"\nimg = cv2.imread(path)\nimg = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)\n\nresult = fr.predict(path, threshold=0.3)\nfile_bytes = np.fromstring(base64.b64decode(result[\"frame\"]), np.uint8)\noutput = cv2.imdecode(file_bytes,1)\n\nplt.figure(figsize=(20,20))\nplt.subplot(1, 2, 1)\nplt.imshow(img)\nplt.title(\"Source Image\")\nplt.subplot(1, 2, 2)\nplt.imshow(output)\nplt.title(\"Output Image\")\nplt.tight_layout()\nplt.show()\n\n\npprint(result[\"predictions\"])","d6611374":"# Face Recognition\n\nSee: https:\/\/github.com\/paoloripamonti\/face-recognition.git","9e808b87":"### Split train & test","05eb580f":"### Fit Face Recognition","73d41454":"### Settings","5d6cc0b3":"### Evaluate","3f955ddd":"### Read dataset"}}