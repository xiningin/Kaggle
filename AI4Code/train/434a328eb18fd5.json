{"cell_type":{"a365231b":"code","142e06b0":"code","7c38c603":"code","f5e5ab7b":"code","188645e0":"code","2791698f":"code","3d87ba1a":"code","d6ca12fa":"code","a6f15945":"code","a69af693":"code","d88572e7":"code","480af523":"code","6d5b8031":"code","2f23cbca":"code","2834c49e":"code","066f5cec":"code","a09fd89a":"code","91a8a342":"code","62cb4854":"code","197f13d2":"code","d9f3f592":"code","b4e3c895":"code","73372beb":"code","d7ce66e8":"code","4b0d61ad":"code","9317bfa0":"code","8158187f":"code","cca889ef":"code","acfdb53c":"code","e9bc30da":"code","788e09a7":"markdown"},"source":{"a365231b":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport plotly.graph_objects as go","142e06b0":"#import all data\ntrain = pd.read_csv(\"..\/input\/amexpert-2019\/train.csv\")\ncamp_data = pd.read_csv(\"..\/input\/amexpert-2019\/campaign_data.csv\")\ncoupon_item = pd.read_csv(\"..\/input\/amexpert-2019\/coupon_item_mapping.csv\")\ncust_demo = pd.read_csv(\"..\/input\/amexpert-2019\/customer_demographics.csv\")\ncust_trans = pd.read_csv(\"..\/input\/amexpert-2019\/customer_transaction_data.csv\")\nitem_data = pd.read_csv(\"..\/input\/amexpert-2019\/item_data.csv\")\ntest = pd.read_csv(\"..\/input\/amexpert-2019\/test_QyjYwdj.csv\")","7c38c603":"id_train = train['id']\nid_test = test['id']","f5e5ab7b":"train.at[1050,'customer_id']","188645e0":"train.drop(columns = \"id\",inplace = True)\ntest.drop(columns = \"id\",inplace = True)","2791698f":"from scipy.stats import pearsonr\ndef correlation(x,y):\n    corr, _ = pearsonr(x,y)\n    print(\"Pearson Correlation coefficient: \",str(corr))    ","3d87ba1a":"#first transfer relevant ID information from item_data to coupon_item data\nitembrand = []\nitembrtype = []\nitemcat = []\n\nfor i in coupon_item['item_id']:\n    itembrand.append(item_data.loc[i-1][1])\n    itembrtype.append(item_data.loc[i-1][2])\n    itemcat.append(item_data.loc[i-1][3])\n\ncoupon_item['item_brand'] = pd.Series(itembrand)\ncoupon_item['item_brand_type'] = pd.Series(itembrtype)\ncoupon_item['item_category'] = pd.Series(itemcat)","d6ca12fa":"coupon_item.set_index(\"coupon_id\",inplace = True)\ncust_demo.set_index(\"customer_id\",inplace = True)\ncust_trans.set_index(\"customer_id\",inplace = True)\ncamp_data.set_index(\"campaign_id\",inplace = True)","a6f15945":"def split_by_dash(x):\n    return x.split('-')\ndef split_by_plus(x):\n    return x.split('+')","a69af693":"#convert range,family size and marital and children to integer\nage_low = []\nage_high = []\nmarstat = []\nnochil = []\nfam_size= []\n\nfor index,row in cust_demo.iterrows():\n    if len(row['family_size'])>1 and row['family_size'][1] == '+':\n        fam_size.append(int(split_by_plus(row['family_size'])[0]))\n    else:\n        fam_size.append(int(row['family_size']))\n    \n    if row['age_range'][2] == '-':\n        age_low.append(int(split_by_dash(row['age_range'])[0]))\n        age_high.append(int(split_by_dash(row['age_range'])[1]))\n    elif not pd.isna(row['age_range']):\n        age_low.append(int(split_by_plus(row['age_range'])[0]))\n        age_high.append(100) #assuming maximum age expectancy to be 100\n\n#0 for Single and 1 for Married\n\ncount = 0\nfor index,row in cust_demo.iterrows():\n    if pd.isna(row['marital_status']):\n        if fam_size[count]==1:\n            marstat.append(0)\n        else:\n            marstat.append(1)\n    else:\n        if row['marital_status']==\"Single\":\n            marstat.append(0)\n        else:\n            marstat.append(1)\n            \n    if pd.isna(row['no_of_children']):\n        if marstat[count] == 0:\n            nochil.append(0)\n        else:\n            if fam_size[count]-2 == -1:\n                print(row['marital_status'],row['family_size'])\n            nochil.append(fam_size[count]-2)\n    else:\n        if len(row['no_of_children'])>1 and row['no_of_children'][1]=='+':\n            nochil.append(int(split_by_plus(row['no_of_children'])[0]))\n        else:\n            nochil.append(int(row['no_of_children']))\n    count+=1","d88572e7":"cust_demo['family_size'] = fam_size\ncust_demo['age_low'] = age_low\ncust_demo['age_high'] = age_high\ncust_demo['no_of_children'] = nochil\ncust_demo['marital_status'] = marstat","480af523":"cust_demo.drop(columns = \"age_range\",inplace = True)","6d5b8031":"from datetime import date\ncampstart = []\ncampdays = []\nfor index,row in camp_data.iterrows():\n    campstart.append(int(row['start_date'][3:5]))\n    date_s = date(int(row['start_date'][6:8]),int(row['start_date'][3:5]),int(row['start_date'][0:2]))\n    date_e = date(int(row['end_date'][6:8]),int(row['end_date'][3:5]),int(row['end_date'][0:2]))\n    days = date_e-date_s\n    campdays.append(days.days)","2f23cbca":"camp_data['days'] = campdays\ncamp_data['startmonth'] = campstart\n\ncamp_data.drop(columns = ['start_date','end_date'],inplace = True)","2834c49e":"coupon_item.sort_index(inplace = True)\nunique_couponid = coupon_item.index.unique()","066f5cec":"diffids = []\ndiffbrands = []\ndifftypes = []\ndiffcat = []\nfor x in unique_couponid:\n    df = coupon_item.loc[x]\n    diffids.append(np.size(np.unique(np.array(coupon_item.loc[x]['item_id']))))\n    diffbrands.append(np.size(np.unique(np.array(coupon_item.loc[x]['item_brand']))))\n    difftypes.append(np.size(np.unique(np.array(coupon_item.loc[x]['item_brand_type']))))\n    diffcat.append(np.size(np.unique(np.array(coupon_item.loc[x]['item_category']))))","a09fd89a":"coupon_data = {'coupon_id':unique_couponid,'diffids':diffids,'difftypes':difftypes,'diffcat':diffcat}\ncoupon_data = pd.DataFrame.from_dict(coupon_data)","91a8a342":"coupon_data.set_index('coupon_id',inplace = True)","62cb4854":"train['age_mean'] = list(np.zeros(78369,dtype = np.float64))\ntrain['marital'] = \"\"\ntrain['rented'] = list(np.zeros(78369,dtype = np.int8))\ntrain['family'] = list(np.zeros(78369,dtype = np.int8))\ntrain['income'] = list(np.zeros(78369,dtype = np.int8))\n\ntrain['diffids'] = list(np.zeros(78369,dtype = np.int8))\ntrain['difftypes'] = list(np.zeros(78369,dtype = np.int8))\ntrain['diffcat'] = list(np.zeros(78369,dtype = np.int8))\n\ntrain['camp_start'] = list(np.zeros(78369,dtype = np.int8))\ntrain['days'] = list(np.zeros(78369,dtype = np.int8))\ntrain['camp_type'] = \"\"\n\nfor index,row in train.iterrows():\n    #print(row['customer_id'])\n    if row['customer_id'] in cust_demo.index:\n        train.at[index,'age_mean'] = (cust_demo.loc[row['customer_id']]['age_low'] + cust_demo.loc[row['customer_id']]['age_high']) \/ 2\n        train.at[index,'marital'] = cust_demo.loc[row['customer_id']]['marital_status']\n        train.at[index,'rented'] = cust_demo.loc[row['customer_id']]['rented']\n        train.at[index,'family'] = cust_demo.loc[row['customer_id']]['family_size']\n        train.at[index,'income'] = cust_demo.loc[row['customer_id']]['income_bracket']\n    \n    train.at[index,'diffids'] = coupon_data.loc[row['coupon_id']]['diffids']\n    train.at[index,'difftypes'] = coupon_data.loc[row['coupon_id']]['difftypes']\n    train.at[index,'diffcat'] = coupon_data.loc[row['coupon_id']]['diffcat']\n    \n    train.at[index,'camp_start'] = camp_data.loc[row['campaign_id']]['startmonth']\n    train.at[index,'campdays'] = camp_data.loc[row['campaign_id']]['days']\n    train.at[index,'camp_type'] = camp_data.loc[row['campaign_id']]['campaign_type']","197f13d2":"train.drop(columns = ['marital'],inplace = True)\nfor index,row in train.iterrows():\n    train.at[index,'camp_type'] = 0 if row['camp_type']=='X' else 1\n    train.at[index,'campdays'] = int(train.at[index,'campdays'])","d9f3f592":"l = list(train['camp_type'])\nl = pd.Series(l)\ntrain.drop(columns = 'camp_type',inplace = True)\ntrain['camp_type'] = l","b4e3c895":"from xgboost import XGBClassifier\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import accuracy_score","73372beb":"y_train = train['redemption_status']\ntrain.drop(columns = 'redemption_status',inplace = True)","d7ce66e8":"model = XGBClassifier(learning_rate = 0.05, max_depth = 4)\ntrain_x, test_x, train_Y, test_y = train_test_split(train,y_train,train_size=0.8)\nmodel.fit(train_x,train_Y)\nxgb_predict = model.predict(test_x)\n    \nprint( \"Train Accuracy :: \", accuracy_score(train_Y, model.predict(train_x)))\nprint( \"Test Accuracy  :: \", accuracy_score(test_y, xgb_predict))","4b0d61ad":"test['age_mean'] = list(np.zeros(50226,dtype = np.float64))\ntest['rented'] = list(np.zeros(50226,dtype = np.int8))\ntest['family'] = list(np.zeros(50226,dtype = np.int8))\ntest['income'] = list(np.zeros(50226,dtype = np.int8))\n\ntest['diffids'] = list(np.zeros(50226,dtype = np.int8))\ntest['difftypes'] = list(np.zeros(50226,dtype = np.int8))\ntest['diffcat'] = list(np.zeros(50226,dtype = np.int8))\n\ntest['camp_start'] = list(np.zeros(50226,dtype = np.int8))\ntest['days'] = list(np.zeros(50226,dtype = np.int8))\ntest['camp_type'] = \"\"\n\nfor index,row in test.iterrows():\n    #print(row['customer_id'])\n    if row['customer_id'] in cust_demo.index:\n        test.at[index,'age_mean'] = (cust_demo.loc[row['customer_id']]['age_low'] + cust_demo.loc[row['customer_id']]['age_high']) \/ 2\n        test.at[index,'rented'] = cust_demo.loc[row['customer_id']]['rented']\n        test.at[index,'family'] = cust_demo.loc[row['customer_id']]['family_size']\n        test.at[index,'income'] = cust_demo.loc[row['customer_id']]['income_bracket']\n    \n    test.at[index,'diffids'] = coupon_data.loc[row['coupon_id']]['diffids']\n    test.at[index,'difftypes'] = coupon_data.loc[row['coupon_id']]['difftypes']\n    test.at[index,'diffcat'] = coupon_data.loc[row['coupon_id']]['diffcat']\n    \n    test.at[index,'camp_start'] = camp_data.loc[row['campaign_id']]['startmonth']\n    test.at[index,'campdays'] = camp_data.loc[row['campaign_id']]['days']\n    test.at[index,'camp_type'] = camp_data.loc[row['campaign_id']]['campaign_type']","9317bfa0":"for index,row in test.iterrows():\n    test.at[index,'camp_type'] = 0 if row['camp_type']=='X' else 1\n    test.at[index,'campdays'] = int(test.at[index,'campdays'])","8158187f":"l = list(test['camp_type'])\nl = pd.Series(l)\ntest.drop(columns = 'camp_type',inplace = True)\ntest['camp_type'] = l","cca889ef":"xgbpred = model.predict(test)","acfdb53c":"xgbpred","e9bc30da":"submission = pd.DataFrame(id_test)\nsubmission['redemption_status'] = xgbpred \nsubmission.to_csv(\"amex1.csv\",index = False)","788e09a7":"For each coupon, now I have the number of items, brands, types and category. With this, I can input info into training data's rows"}}