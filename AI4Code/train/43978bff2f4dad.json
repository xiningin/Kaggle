{"cell_type":{"ec31ae9f":"code","b22a91cf":"code","6b5739ec":"code","7415e0a6":"code","9c9616e2":"code","014d3210":"code","b5cf83c1":"code","7dca6bd0":"code","11f59209":"code","8dd3608c":"code","63a49902":"code","482dc396":"markdown","0c8903a6":"markdown","ce65d87e":"markdown","a39617d7":"markdown","7ca21877":"markdown","50b9ee98":"markdown","94d72e49":"markdown"},"source":{"ec31ae9f":"from IPython.display import YouTubeVideo\nYouTubeVideo('22QYriWAF-U', width=800, height=450)","b22a91cf":"import numpy as np\nimport pandas as pd\nimport os\nimport bq_helper\nfrom plotly.offline import init_notebook_mode, iplot\nimport matplotlib.pyplot as plt\nimport plotly.graph_objs as go\nfrom wordcloud import WordCloud, STOPWORDS\n\ninit_notebook_mode(connected=True)\n\nfrom bq_helper import BigQueryHelper\nusa = bq_helper.BigQueryHelper(active_project=\"bigquery-public-data\",\n                                   dataset_name=\"usa_names\")\nbq_assistant = BigQueryHelper(\"bigquery-public-data\", \"usa_names\")\n#bq_assistant.list_tables()","6b5739ec":"# Review the table schema\nbq_assistant.table_schema(\"usa_1910_current\")","7415e0a6":"# Take a quick peak at the data\nbq_assistant.head(\"usa_1910_current\", num_rows=10)","9c9616e2":"query1 = \"\"\"\nWITH temp1 AS\n    (\n    SELECT\n     names1.name,\n     SUM(names1.number) AS total_occurrences\n    FROM `bigquery-public-data.usa_names.usa_1910_current` AS names1\n    GROUP BY\n     names1.name\n    )\nSELECT\n  names2.name,\n  names2.gender,\n  names2.state,\n  names2.year,\n  names2.number\nFROM       temp1\nINNER JOIN `bigquery-public-data.usa_names.usa_1910_current` AS names2\n ON temp1.name = names2.name\nWHERE\n temp1.total_occurrences <= 5\nORDER BY\n names2.name\n;\n\"\"\"\n#usa.estimate_query_size(query1)\n\nresponse1 = usa.query_to_pandas_safe(query1, max_gb_scanned=0.5)","014d3210":"response1.head(10)","b5cf83c1":"response1.tail(10)","7dca6bd0":"# aggregate by state\nunique_names_states = response1.groupby('state', as_index=False).agg({\"number\": \"sum\"})\nunique_names_states = unique_names_states.sort_values(by='number', ascending=False)\n\n# visualize on go chart that allows for user scroll over to interact with it\nx = unique_names_states.state\ny = unique_names_states.number\ntrace1 = go.Bar(x=x, y=y, opacity=0.75, name=\"state sum\")\nlayout = dict(height=400, title='Number of people by state with very unique names', legend=dict(orientation=\"h\"));\nfig = go.Figure(data=[trace1], layout=layout);\niplot(fig);","11f59209":"# aggregate by gender\nunique_names_gender = response1.groupby('gender', as_index=False).agg({\"number\": \"sum\"})\nunique_names_gender = unique_names_gender.sort_values(by='number', ascending=False)\n\n# visualize on go chart that allows for user scroll over to interact with it\nx = unique_names_gender.gender\ny = unique_names_gender.number\ntrace1 = go.Bar(x=x, y=y, opacity=0.75, name=\"gender sum\")\nlayout = dict(height=400, title='Very unique American names by gender', legend=dict(orientation=\"h\"));\nfig = go.Figure(data=[trace1], layout=layout);\niplot(fig);","8dd3608c":"# aggregate by year\nunique_names_year = response1.groupby('year', as_index=False).agg({\"number\": \"sum\"})\nunique_names_year = unique_names_year.sort_values(by='number', ascending=True)\n\n# visualize on go chart that allows for user scroll over to interact with it\nx = unique_names_year.year\ny = unique_names_year.number\ntrace1 = go.Bar(x=x, y=y, opacity=0.75, name=\"year sum\")\nlayout = dict(height=400, title='Very unique American names by year', legend=dict(orientation=\"h\"));\nfig = go.Figure(data=[trace1], layout=layout);\niplot(fig);","63a49902":"#mask = np.array(Image.open('..\/input\/word-cloud-masks\/image.png'))\n\ntxt = \" \".join(response1['name'].sample(n=300).dropna().unique())\nwc = WordCloud(max_words=300, \n               #mask=mask,\n               stopwords=STOPWORDS,\n               max_font_size=12,\n               min_font_size=6,\n               colormap='copper', \n               background_color='White').generate(txt)\nplt.figure(figsize=(16,18))\nplt.imshow(wc)\nplt.axis('off')\nplt.title('');","482dc396":"**3)** Has the occurrence of rare names changed over time?","0c8903a6":"**2)** Are these rare names more prevalent for men or women?","ce65d87e":"Below in the WITH query I sum the number of occurrences for a name throughout the entire history of the US Social Security system. Then I only keep those with 5 or less occurrences in the WHERE clause of the main SELECT.","a39617d7":"When I saw the [USA Names Dataset](https:\/\/www.kaggle.com\/datagov\/usa-names) I immediate wondered: how many Americans have such a unique name that the number of people with that name can be counted on one hand (5 or less people with that name) throughout the history of the social security recordings? This kernel explores that question.\n\nBut first a tangential song that I couldn't help but add in here as a link...","7ca21877":"**A few things I've noticed in this analysis:**\n- The drop in very unique names around the time of World War II and the decade thereafter is interesting.\n- The notable difference in number of unique names between males and females was higher than I would have expected.\n- It seems that perhaps the Social Security administration always represents \"5\" as the lowest number because I was unable to find anything less than in any of the data.","50b9ee98":"A quick word cloud for fun just to get a better look at a sample of the very unique names.","94d72e49":"Now some questions to get answered...\n\n**1)** Which state has the highest number of these rare names?"}}