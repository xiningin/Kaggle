{"cell_type":{"ab22b2dd":"code","a54d822c":"code","596b63f5":"code","68096264":"code","64609c17":"code","4dfa5ca9":"code","24498960":"code","148729ba":"code","5a9dba24":"code","ca182730":"code","9fe5b89a":"code","82f8e1c1":"code","0ec701d3":"code","383c058e":"code","b2807ee2":"code","9942400d":"code","b93e84d9":"code","e6b98d6e":"code","75e87f2c":"code","a6683351":"code","eead870d":"code","914216de":"code","4e62d2e9":"code","18a2748d":"code","4ec7f85d":"code","e08b8578":"code","cf5db52c":"code","df10a653":"code","6bee4604":"code","4107a583":"code","169e0628":"code","d33ad530":"code","753bf156":"code","488acba2":"code","53e1e598":"code","0f9dcfdb":"code","8f8158b9":"code","bb6abc34":"code","cb8d658e":"code","23f60279":"code","0ed0677a":"markdown","abc4a170":"markdown","645e6d93":"markdown","e39ad7e0":"markdown","336f899d":"markdown","0e3c68cf":"markdown","48cb3a89":"markdown","de7c6146":"markdown","2ca5cd87":"markdown","30d9665b":"markdown","bed9967e":"markdown","47f9a9e0":"markdown","aa2de043":"markdown","d6454f00":"markdown","ed3288d7":"markdown","de99ad3f":"markdown","325e129a":"markdown","b08b5d02":"markdown","de50c607":"markdown","f2e4a275":"markdown","6f56884e":"markdown","9d087fa3":"markdown","f8b871ad":"markdown","708feeea":"markdown","47fa3311":"markdown","91fd460b":"markdown","08308b2e":"markdown","4669587d":"markdown","f77a980d":"markdown","1cf394cc":"markdown","64fd4901":"markdown","4534d106":"markdown","fbe2b1bd":"markdown","e49b3c00":"markdown","9b0dda4e":"markdown"},"source":{"ab22b2dd":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom matplotlib import rcParams\n\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn import metrics\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","a54d822c":"def display_all(df):\n    with pd.option_context(\"display.max_rows\", 1000, \"display.max_columns\", 1000):\n        display(df)","596b63f5":"data = pd.read_csv(\"..\/input\/zomato.csv\")\ndisplay_all(data.head()) ","68096264":"display_all(data.describe(include='all'))","64609c17":"del data['url']\ndel data['address']\ndel data['phone']\ndel data['location']\ndel data['book_table']\n\ndata.rename(columns={'approx_cost(for two people)':'cost_for_two','listed_in(city)':'locality', 'listed_in(type)':'category'},inplace=True)","4dfa5ca9":"((data.isnull() | data.isna()).sum() * 100 \/ data.index.size).round(2)\n\ndata.rate = data.rate.replace(\"NEW\",np.nan)\ndata.dropna(how='any',inplace=True)\n((data.isnull() | data.isna()).sum() * 100 \/ data.index.size).round(2)","24498960":"# Convert rate and cost_for_two to float\ndata.rate = data.rate.astype(str)\ndata.rate = data.rate.apply(lambda x:x.replace('\/5',''))\ndata.rate = data.rate.astype(float)\n\ndata.cost_for_two = data.cost_for_two.astype(str)\ndata.cost_for_two = data.cost_for_two.apply(lambda x:x.replace(',',''))\ndata.cost_for_two = data.cost_for_two.astype(float)\n\ndata.loc[data['locality'].str.contains('Koramangala'), 'locality'] = 'Koramangala'\ndata.loc[data['locality'].str.contains('Kalyan Nagar'), 'locality'] = 'Kammanahalli'\n\n\n# Some restaurants on brigade road are wrongly marked as category=Pubs and bars, correcting the category to desserts.\n# There may be many such records in the dataset but for now lets clean up only these\ndata.loc[(~(data['rest_type'].str.contains('Pub|Bar')) & (data['category'].str.contains('Pub')) & (data['locality']=='Brigade Road'))\n          , 'category'] = 'Desserts'\n\n# standardize the data in rest_type\nvals_to_replace = {'Bar, Casual Dining':'Casual Dining, Bar'\n                   ,'Cafe, Casual Dining':'Casual Dining, Cafe'\n                   ,'Pub, Casual Dining':'Casual Dining, Bar'\n                   ,'Casual Dining, Pub':'Casual Dining, Bar'\n                   ,'Pub':'Bar'\n                   ,'Pub, Bar':'Bar'\n                   ,'Bar, Pub':'Bar'\n                   ,'Microbrewery, Bar':'Microbrewery'\n                   ,'Microbrewery, Pub':'Microbrewery'\n                   ,'Pub, Microbrewery':'Microbrewery'\n                   ,'Microbrewery, Casual Dining':'Casual Dining, Microbrewery'\n                   ,'Lounge, Casual Dining':'Casual Dining, Lounge'\n                   ,'Sweet Shop, Quick Bites':'Quick Bites, Sweet Shop'\n                   ,'Cafe, Quick Bites':'Quick Bites, Cafe'\n                   ,'Beverage Shop, Quick Bites':'Quick Bites, Beverage Shop'\n                   ,'Bakery, Quick Bites':'Quick Bites, Bakery'\n                   ,'Desert Parlor, Quick Bites':'Quick Bites, Desert Parlor'\n                   ,'Food Court, Quick Bites':'Quick Bites, Food Court'\n                   ,'Bar, Quick Bites':'Quick Bites, Bar'\n                   ,'Cafe, Lounge':'Lounge, Cafe'\n                   ,'Cafe, Bakery':'Bakery, Cafe'\n                   ,'Cafe, Dessert Parlor':'Dessert Parlor, Cafe'\n                   ,'Cafe, Beverage Shop':'Beverage Shop, Cafe'\n                   ,'Bar, Lounge':'Lounge, Bar'\n                   ,'Fine Dining, Lounge':'Lounge, Fine Dining'\n                   ,'Microbrewery, Lounge':'Lounge, Microbrewery'}\n\ndata['rest_type'] = data['rest_type'].replace(vals_to_replace)\ndata.rest_type.sort_values().unique()","148729ba":"data_unique = data.drop_duplicates(subset=['locality', 'name'], keep='first')\n\ndata_unique.reset_index(inplace=True)\nos.makedirs('tmp', exist_ok=True)\ndata_unique.to_feather('tmp\/zomato-unique')","5a9dba24":"data_unique = pd.read_feather('tmp\/zomato-unique')\ndata_unique.head()","ca182730":"fig, axes = plt.subplots(3,1,sharex=True, figsize=(20,14))\ndata_unique['cost_for_two'].plot.density(ax=axes[0], color = \"#3399cc\")\nsns.boxplot(ax=axes[1], x=data_unique['cost_for_two'], color = \"#3399cc\")\ndata_unique['cost_for_two'].plot.hist(ax=axes[2], bins=50, color = \"#3399cc\")\n\ndata_unique['cost_for_two'].describe()","9fe5b89a":"fig, ax = plt.subplots(figsize=(15,7))\nax = sns.countplot(x=\"locality\", data=data_unique, order=data_unique['locality'].value_counts().index, color = \"#3399cc\")\nax.set_title(\"Count Per Locality\")\nax.set_xticklabels(ax.get_xticklabels(), rotation=90, ha=\"right\")\nplt.show()","82f8e1c1":"data_unique['rate'].plot.hist(bins=50, color = \"#3399cc\")","0ec701d3":"data_select = data[\n                   (data['cost_for_two'] >= 400) & (data['cost_for_two'] <= 800)\n#                           & (data_top_all['category'].str.contains('Buffet'))\n#                           & (data_top_all['rest_type'].str.contains('Food Truck'))\n#                           & (data_top_all['cuisines'].str.contains('North Indian'))\n#                           & (data_top_all['online_order'].str.contains('Yes'))\n                 ]\n\ndata_top = data_select.sort_values(['locality', 'votes', 'rate', ],ascending=False)\ndata_top.drop_duplicates(subset=['locality', 'name'], keep='first', inplace=True)\ndata_top10 = data_top.groupby('locality').head(10)\ndata_top10[[\"locality\", \"name\", \"rest_type\", \"category\", \"cost_for_two\", \"votes\", \"rate\"]]","383c058e":"pd.concat(g for _, g in data_top10[[\"name\", \"locality\", \"cost_for_two\", \"votes\", \"rate\"]].groupby(\"name\") if len(g) > 1)","b2807ee2":"pd.crosstab(data_top10.name, data_top10.locality, margins=True)","9942400d":"data_bot = data_select.sort_values(['locality', 'votes', 'rate', ],ascending=[False,False,True])\ndata_bot = data_bot[data_bot['rate'] < 2.5]\ndata_bot.drop_duplicates(subset=['locality', 'name'], keep='first', inplace=True)\ndata_bot10 = data_bot.groupby('locality').head(10)\ndata_bot10[[\"locality\", \"name\",\"rest_type\", \"category\", \"cost_for_two\", \"votes\", \"rate\"]]\n","b93e84d9":"pd.concat(g for _, g in data_bot10[[\"name\", \"locality\", \"votes\", \"rate\"]].groupby(\"name\") if len(g) > 1)","e6b98d6e":"pd.merge(data_top10, data_bot10, on='name')","75e87f2c":"data_top_all = data_select.sort_values(['votes', 'rate', ],ascending=False)             \ndata_top_all.drop_duplicates(subset=['name'], keep='first', inplace=True)\ndata_top_all[[\"name\", \"cuisines\", \"locality\", \"cost_for_two\", \"votes\", \"rate\"]].head(10)\n","a6683351":"data_bot_all = data_select.sort_values(['votes', 'rate', ],ascending=[False,True])\ndata_bot_all = data_bot_all[data_bot_all['rate'] < 2.5]\ndata_bot_all.drop_duplicates(subset=['name'], keep='first', inplace=True)\ndata_bot_all[[\"name\", \"cuisines\", \"locality\", \"cost_for_two\", \"votes\", \"rate\"]].head(10) \n","eead870d":"# Cost for two vs locality\nfig, ax = plt.subplots(figsize=(15,5))\nax = sns.barplot(ax=ax, x='locality', y='cost_for_two', data=data_unique, color = \"#3399cc\")\nax.set_title(\"Cost_for_two Per Locality\")\nax.set_xticklabels(ax.get_xticklabels(), rotation=90, ha=\"right\")\nplt.show()","914216de":"# Cost for two vs restaurant type\nfig, ax = plt.subplots(figsize=(20,10))\nax = sns.barplot(ax=ax, x='rest_type', y='cost_for_two', data=data_unique, color = \"#3399cc\")\nax.set_title(\"Cost_for_two Per Restaurant Type\")\nax.set_xticklabels(ax.get_xticklabels(), rotation=90, ha=\"right\")\nplt.show()","4e62d2e9":"data_unique.pivot_table('cost_for_two', columns=['category'], index='locality' ).plot(kind='bar',figsize=(20,10))","18a2748d":"fig, ax = plt.subplots(figsize=(15,5))\nax = sns.barplot(ax=ax, x='rate', y='cost_for_two', data=data_unique, color = \"#3399cc\")\nax.set_title(\"Cost_for_two vs rating\")\nplt.show()","4ec7f85d":"fig, ax = plt.subplots(figsize=(10,5))\nax = sns.barplot(ax=ax, x='online_order', y='cost_for_two', data=data_unique, color = \"#3399cc\")\nax.set_title(\"Cost_for_two vs online_order (Yes\/No)\")\nplt.show()","e08b8578":"data_unique = pd.read_feather('tmp\/zomato-unique')\ndisplay_all(data_unique.head())","cf5db52c":"# Select columns and set the rows in random order before feeding to the model\n\ndata_unique = data.drop_duplicates(subset=['locality', 'name'], keep='first')\ndata_unique = data_unique[['locality', 'rest_type', 'category', 'rate', 'votes', 'online_order', 'cost_for_two']]\ndata_unique = data_unique.sample(frac=1).reset_index(drop=True)","df10a653":"sns.pairplot(data_unique, diag_kind='kde', plot_kws={'alpha':0.2})","6bee4604":"#1 - one hot encode string data\ndata_unique = pd.get_dummies(data_unique)\ndisplay_all(data_unique.head(10))","4107a583":"X = data_unique.drop(['cost_for_two'], axis=1)\ny = data_unique.cost_for_two","169e0628":"# Split into train and test datasets\ndef split_vals(a,n): return a[:n].copy(), a[n:].copy()\n\nn_valid = 2500\nn_trn = len(data_unique)-n_valid\nX_train, X_valid = split_vals(X,n_trn)\ny_train, y_valid = split_vals(y,n_trn)\n\nX_train.shape, y_train.shape, X_valid.shape, y_valid.shape\n","d33ad530":"# Random Forest with default number of estimators\nm = RandomForestRegressor(random_state=0, n_jobs=-1)\nm.fit(X_train, y_train)\nres = [m.score(X_train,y_train), m.score(X_valid,y_valid)]\nprint(res)","753bf156":"preds = np.stack([tree.predict(X_valid) for tree in m.estimators_])\npreds.shape, preds[:,0], np.mean(preds[:,0]), y_valid","488acba2":"m = RandomForestRegressor(random_state=0, n_estimators=1, max_depth=5, n_jobs=-1)\nm.fit(X_train, y_train)\nres = [m.score(X_train,y_train), m.score(X_valid,y_valid)]\nprint(res)","53e1e598":"from sklearn.datasets import *\nfrom sklearn import tree\nfrom sklearn.tree import export_graphviz\nfrom IPython.display import Image  \nimport graphviz\nimport pydot\n\n\ntree = m.estimators_[0]\n# Export the image to a dot file\nexport_graphviz(tree, out_file = 'tree.dot', feature_names = X_train.columns, rounded = True, precision = 1)\n# Use dot file to create a graph\n(graph, ) = pydot.graph_from_dot_file('tree.dot')\n# Show graph\nImage(graph.create_png())\n# Create PDF\n#graph.write_pdf(\"iris.pdf\")\n# Create PNG\n#graph.write_png(\"iris.png\")","0f9dcfdb":"m = RandomForestRegressor(random_state=0, n_estimators=1, n_jobs=-1)\nm.fit(X_train, y_train)\nres = [m.score(X_train,y_train), m.score(X_valid,y_valid)]\nprint(res)","8f8158b9":"# Try different numbers of n_estimators \nestimators = np.arange(10, 200, 10)\nscores = []\nfor n in estimators:\n    m.set_params(n_estimators=n)\n    m.fit(X_train, y_train)\n    scores.append(m.score(X_valid, y_valid))\nplt.title(\"Effect of n_estimators\")\nplt.xlabel(\"n_estimator\")\nplt.ylabel(\"score\")\nplt.plot(estimators, scores)","bb6abc34":"# Random Forest with 150 estimators\nm = RandomForestRegressor(random_state=0, n_estimators=150,n_jobs=-1)\nm.fit(X_train, y_train)\nres = [m.score(X_train,y_train), m.score(X_valid,y_valid)]\nprint(res)","cb8d658e":"# Calculate feature importances\nimportances = m.feature_importances_\n\n# Sort feature importances in descending order\nindices = np.argsort(importances)[::-1]\n\n# Rearrange feature names so they match the sorted feature importances\nnames = [X_train.columns[i] for i in indices]\n\nplt.figure(figsize=(15,15))\nplt.title(\"Feature Importance\")\nplt.barh(range(X.shape[1]),importances[indices], color = \"#3399cc\")\nplt.yticks(range(X.shape[1]), names)\n\nplt.show()","23f60279":"names","0ed0677a":"## Purpose of this notebook\n#### 1. Exploratory data analysis on the Zomato ratings for Restaurants in Bangalore dataset for the purpose of inference.\n#### 2. Regression using Random Forest Regressor to predict the average cost for given parameters like locality, restaurant type, rating, votes and restaurant category.\n\nThank you to the person who provided the zomato ratings dataset on kaggle. Also, really appreciate the effort of all those who previously posted kernels based on this dataset. Thanks for the inspiration.\n\nAny suggestions and feedback are most welcome. Kindly upvote if you like it.","abc4a170":"#### One hot encode string data before feeding it to the model","645e6d93":"#### Crosstab of restaurant names vs locality to find out which restaurant chains have the highest presence in the top 10 per locality.\n* Inference(from the counts in column 'All' at the extreme right):\n* * Empire Restaurant in 20 locations\n* * Onesta in 19 locations\n* * Meghana Foods in 13 locations\n* * Paradise in 11 locations\n","e39ad7e0":"## Predict cost_for_two using RandomForestRegressor on the data\n* Columns to use will be rest_type, locality, category, rate, votes, online_order, cost_for_two\n\nInference:\n* One hot encoding gives slightly better accuracy than categorical conversion of string variables\n* A noticable increase in accuracy of the model after setting the input to random sequence using df.sample(frac=1).reset_index(drop=True)\n* Train, test accuracy = [0.98, 0.88] ","336f899d":"#### Plot histogram of the ratings value\n* Inference: \n* * Most ratings are in the range of 3.5 to 4.5\n* * The lowest ratings are below 2.5","0e3c68cf":"### Data Cleanup\n* Delete columns that are not important.\n* Rename columns to have string with lower case and no special characters.","48cb3a89":"Are there any restaurant chains among these low rated restaurants?","de7c6146":"### Get the cleaned up file from feather","2ca5cd87":"### Lowest rated restaurants in all of Bangalore with cost for two in the range of Rs.400 - 800","30d9665b":"Data Cleanup (contd.)\n* Some restaurants are listed under multiple blocks in Koramangala. Hence, remove the block number and have the locality as Koramangala instead. \n* Restaurants in Kalyan Nagar and Kammanahalli also have a similar overlap. Convert all to have the locality as Kammanahalli.\n* The field rest_type has inconsistent entries. For example, rest_type = 'Casual Dining, Bar' and rest_type = 'Bar, Casual Dining'. Convert these to have a unique entry.\n* Some dessert restaurants in Brigade Road are wrongly marked as Pubs and Bars. Correct the entries.","bed9967e":"#### Plot feature importance","47f9a9e0":"Lets see how the predictions are calculated","aa2de043":"### Restaurants in each locality with the lowest ratings\n* Select records with rating < 2.5 (from the histogram of the rating we have seen that there are minimal records with rate < 2.5)\n* In each locality the restaurants with the lowest rating would be those with a high number of votes but rating < 2.5\n* Remove duplicates entries within each locality","d6454f00":"#### Set up train and test data ","ed3288d7":"### Top 10 rated restaurants in all of Bangalore with cost_for_two in the range of Rs.400 to Rs.800\n* Inference: 6 restaurants out of the top 10 are in Koramangala","de99ad3f":"### Save cleaned up file to feather\n* Remove Duplicate restaurants within a locality to get unique restaurants. This dataset will be used for all plotting purposes. It is also the input feed to the models.\n* Save this dataset to feather so that it can be accessed effciently.","325e129a":"#### Plot the number of restaurants per locality:\n* Inference: Koramangala and BTM top the list with more than 800 restaurants while most localities on an average have around 400 restaurants.\n","b08b5d02":"Data Cleanup (contd.)\n* Remove rows with NA or NULLS","de50c607":"#### View the feature correlation (numeric features only)\n\nNotice that cost_for_two is correlated with rate and votes","f2e4a275":"Are there any common names between the top 10 rated and the bottom rated restaurants?\n* Inference: No common names in the 2 lists","6f56884e":"#### Plot cost for two vs online_order (yes\/no)\n\nInference:\n* Food at restaurants with online_order=No is more expensive","9d087fa3":"### Get the cleaned up file from feather. To re-test model run code from here onwards.","f8b871ad":"#### Random Forest Regressor ","708feeea":"#### Of the top 10 rated restaurants in each locality lets find out how many are restaurant chains(restaurants with presence in multiple localities)\n* Inference: 54 restaurant chains","47fa3311":"#### Lets visualize a single tree with max_depth = 5. Double click on the chart to zoom it.","91fd460b":"### Plot Graphs\n* Plot density, histogram and boxplot of cost_for_two to see how the values are distributed.\n* Inference: The cost_for_two ranges from a minimum of Rs. 40 to a maximum of Rs. 6000. The median is at Rs. 600. ","08308b2e":"Columns 'locality', 'rest_type', 'category', 'rate', 'votes', 'online_order' impact the values in 'cost_for_two'. Therefore select only those columns in the dataset which is input to our model","4669587d":"#### Plot pivot of cost_for_two for various categories of restaurants (Buffet, Cafes, Desserts, Drinks & Nightlife, Delivery, Dine-out) per locality\n* Inference: \n* * Drinks and Nightlife, Dine-out and Buffet are among the pricier categories across most localities.\n* * All categories of restaurants are priced low at Banashankari","f77a980d":"#### Plot rate vs cost_for_two\n\nInference:\n* With the exception of a few cases, mostly higher the cost_for_two, higher is the rating","1cf394cc":"### Predict cost for two at a restaurant. What input features should we use? Lets plot the features and find out.\n\n#### Plot the average cost_for_two per locality\n* Inference: Brigade Road, Church Street, Lavelle Road, MG Road and Residency Road are among the priciest localities to eat out with the average cost_for_two around Rs. 1000 (the black vertical line at the top of each bar represents the 95% confidence interval).","64fd4901":"#### Lets see what happens if we create a deeper tree (omit specify max_depth) \n\nInference:\n* The accuracy improves","4534d106":"#### Plot cost_for_two per type of restaurant (Pub, Casual Dining, Quick bites, Cafe, Lounge etc.)\n* Inference: At the pricier end are Microbreweries, Clubs, Lounge Bars and Fine Dining Restaurants. Quick bites, Kiosks, Dessert shops, Mess are at the lower end of the price range.","fbe2b1bd":"#### How many trees will give us the best accuracy? (code for this may take a minute or two to run)\n\nInference:\n* Lets choose number of trees = 150, from the plot below, beyond this the accuracy does not get any better","e49b3c00":"### Now lets find out which 10 restaurants have been rated the highest in each locality \n* Lets select only those restaurants in the price range of Rs. 400 to Rs. 800 (This pirce range accounts for 50% of our data values).\n* Within each locality the top 10 restaurants would be those with the highest number of votes and rating.\n* Remove rows with duplicate restaurant names within the same locality. These duplicates may have crept into the data because of multiple categories assigned to a single restaurant. \n","9b0dda4e":"#### Feature importance in listed sorted order"}}