{"cell_type":{"e1987e35":"code","df36be6d":"code","cb767533":"code","0ecee357":"code","0acbae28":"code","56dde482":"code","2288c457":"code","49885a1c":"code","949e9155":"code","2d6f28fb":"code","683b54cd":"markdown","a5f649fc":"markdown","07f99c90":"markdown","1cfaf593":"markdown","e1674bd5":"markdown","23a3e7fd":"markdown","c823a9ca":"markdown","8d909c4a":"markdown"},"source":{"e1987e35":"import pandas as pd\nimport geopandas as gpd\nimport requests\nfrom datetime import datetime,timedelta","df36be6d":"# Daily update at 16:00u. I'll run and save this script on a daily base\n\n\nurl = 'https:\/\/data.rivm.nl\/covid-19\/COVID-19_aantallen_gemeente_cumulatief.json'\n\ntry:\n    data = requests.get(url, timeout=2).json()\nexcept requests.exceptions.RequestException:\n    raise Exception('Failed to connect to %s' % url) from None\n\nrivm = pd.DataFrame.from_dict(data, orient='columns')\n","cb767533":"rivm.head()","0ecee357":"#Yesterday's date \ntoday = datetime.today() - timedelta(days=1)\ntoday = today.strftime('%Y-%m-%d')+ \" 10:00:00\"\nprint(today)","0acbae28":"#Last week's date\nweekAgo = datetime.today() - timedelta(days=7)\nweekAgo = weekAgo.strftime('%Y-%m-%d')+ \" 10:00:00\"\nprint(weekAgo)","56dde482":"# maak een nieuwe df van vandaag en vorige week, de gegevens van de provincies mogen eruit\ncases_Today = rivm.loc[(rivm.Date_of_report == today)& (rivm.Municipality_name.notnull())]\ncases_weekAgo = rivm.loc[(rivm.Date_of_report == weekAgo)& (rivm.Municipality_name.notnull())]\ncases_Today.head()","2288c457":"# maak een nieuwe df met het verschil van aantal gevallen van vorige week en deze week\ncases_lastWeek = cases_Today.loc[:, ['Municipality_code', 'Municipality_name', 'Province','Total_reported']]\ncases_lastWeek['Total_reported_LastWeek'] = cases_weekAgo['Total_reported'].values\ncases_lastWeek['this_week_cases'] = cases_lastWeek['Total_reported'] - cases_lastWeek['Total_reported_LastWeek']\ncases_lastWeek.head()","49885a1c":"# Haal de kaart met gemeentegrenzen op van PDOK\ngeodata_url = 'https:\/\/geodata.nationaalgeoregister.nl\/cbsgebiedsindelingen\/wfs?request=GetFeature&service=WFS&version=2.0.0&typeName=cbs_gemeente_2019_gegeneraliseerd&outputFormat=json'\nkaart_gemeente = gpd.read_file(geodata_url)\n","949e9155":"# De covid-data kan nu gekoppeld worden aan de gemeentegrenzen met merge.\n# Koppel covid-data aan geodata met gemeentecodes\nkaart_gemeente = pd.merge(kaart_gemeente, cases_lastWeek,\n                           left_on = \"statcode\", \n                           right_on = \"Municipality_code\")\nkaart_gemeente.head()","2d6f28fb":"#Tot slot kan de thematische kaart gemaakt worden met de functie plot.\n\n\np = kaart_gemeente.plot(column='this_week_cases', \n                         figsize = (14,12), legend=True, cmap=\"Reds\")\np.axis('off')\np.set_title('Amount of absolute reported Covid cases in The Netherlands only last Week')","683b54cd":"I have to get only Today's and last week's cases for my map. To filter I need the exact Date_of_report the RIVM uses in it's timestamp. (I use Yesterday instead of Today because the update is at 16:00hrs otherwise you get an error if you run the script before 16:00hrs)","a5f649fc":"# How to inform the people to get out a lockdown?\n## Scroll down for a map\n*We need to know the actual cases so we can decide which places to avoid and in which areas we can be more relaxed. The RIVM posts the total amount of reported cases; the total of hospital admissions; the total amount of deceased people on a daily base starting at March 13, 2020. What do these numbers say about the recent situation? <br> I decided to make a map of the Netherlands with only the cases of the last week. So we know where the virus is still active. The next question is do we need absolute or relative numbers? I decided to use absolute numbers and people have to decide for themselves what to do with the numbers. Accuracy and open information is at this time very important in my view *","07f99c90":"Create two new dataframes. One of Today's cases and one of last Week. The RIVM posts the province numbers as well and I need only the cases of the municipalities so I discard the entries without a municipality name.","1cfaf593":"Merge the map data with my covid data","e1674bd5":"Import the map with municipality-borders","23a3e7fd":"Plot the map","c823a9ca":"Create a new dataframe with the two before combined and a new column with the difference between the cases of Today and last Week.","8d909c4a":"**What is the information in the json published by the RIVM? Let's call head() to see the top 5 entries**"}}