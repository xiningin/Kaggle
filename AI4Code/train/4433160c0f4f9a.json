{"cell_type":{"2fa084f2":"code","977ade48":"code","d0efce17":"code","cc005bbc":"code","ed19d7c2":"code","3abbeba6":"code","8c25dd5f":"code","9685e2f9":"code","70d216a2":"code","00446b8b":"code","18630820":"code","c921194b":"code","351096b7":"code","f5dabec0":"code","551c11b0":"code","cec2da6a":"code","c66d797f":"code","feeda132":"code","1f579b93":"code","6ba7bb5f":"code","b2d41e0c":"code","4bfba7f8":"markdown","e59f0806":"markdown","1fc293b8":"markdown","e504a1de":"markdown","7c6267a6":"markdown","4744135a":"markdown","0a5dfa1c":"markdown","5cca85c0":"markdown","54405773":"markdown","8dc9c613":"markdown","114ded99":"markdown","4fdaf562":"markdown","466fe8c0":"markdown","d0e62edd":"markdown","a9b11015":"markdown","bdcbb7a7":"markdown","1296fe02":"markdown"},"source":{"2fa084f2":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport scipy as sp\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nsns.set(style=\"darkgrid\")\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint('List of datasets: ',os.listdir(\"..\/input\"))\n\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n# Any results you write to the current directory are saved as output.","977ade48":"df = pd.read_csv('..\/input\/restaurant-scores-lives-standard.csv')\ndf.head()","d0efce17":"df.info()","cc005bbc":"# clean data, delete columns\ndf.drop(columns=['business_city', 'business_state', 'business_postal_code', 'business_location', 'business_address', 'business_phone_number'],inplace=True)","ed19d7c2":"df['inspection_type'].unique()\n\n# note there are many different types of inspections.\n# For some reason, the \"Foodborne Illness Investigration\" might be of high interest ...","3abbeba6":"# convert time to datetime of pandas\ndf['inspection_date'] = pd.to_datetime(df['inspection_date'])\ndf['inspection_month_day'] = df['inspection_date'].map(lambda x: x.strftime('%m-%d'))\ndf['inspection_year'] = df['inspection_date'].apply(lambda x: x.year)\ndf['inspection_month'] = df['inspection_date'].apply(lambda x: x.month)\n# df['inspection_year_month'] = pd.to_datetime(df['inspection_date'], format='%Y%m')\ndf['inspection_dayofweek'] = df['inspection_date'].apply(lambda x: x.weekday())","8c25dd5f":"# is there any day of the week where a surprising inspection is more likely to happen\nsns.catplot(x=\"inspection_dayofweek\", data=df[df['inspection_type']=='Routine - Unscheduled'], kind=\"count\",  height=4, aspect=1.5);\nplt.title('Number of Unscheduled Inspections for week days')\nplt.xticks(range(7),['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday',' Saturday',' Sunday']);","9685e2f9":"sns.catplot(x=\"inspection_year\", \n            data=df, \n            kind=\"count\",  height=4, aspect=1.5,sharey=False);\nplt.title('Overall number of inspections per year')\n\nsns.catplot(x=\"inspection_year\", \n            col='inspection_type',\n            data=df[(df['inspection_type']=='Routine - Scheduled') | (df['inspection_type']=='Routine - Unscheduled')| (df['inspection_type']=='Foodborne Illness Investigation')], \n            kind=\"count\",  height=4, aspect=1,sharey=False);","70d216a2":"# is there any time of the year where there are more inspections?\nsns.catplot(x=\"inspection_month\",\n            row='inspection_type', \n            col='inspection_year', \n            data=df[(df['inspection_type']=='Routine - Scheduled') | (df['inspection_type']=='Routine - Unscheduled')| (df['inspection_type']=='Foodborne Illness Investigation')], \n            kind=\"count\",  height=4, aspect=1.5,sharey=False);","00446b8b":"df_tmp = df[(df['inspection_type']=='Routine - Unscheduled')].groupby('inspection_month_day').count()\nfig, ax = plt.subplots(figsize=(30,4))\nsns.barplot(x=df_tmp.index,\n            y='inspection_year',\n            data=df_tmp,\n            ax=ax, \n            orient='v');\nplt.setp(ax.get_xticklabels(), rotation=90);","18630820":"gb = df.groupby('business_id')","c921194b":"sns.catplot(y=\"violation_description\",\n            row='risk_category', \n            data=df, kind=\"count\",  \n            height=12, aspect=1.5,\n#             hue_order=['Low Risk', 'Moderate Risk', 'High Risk'],\n            order = df['violation_description'].value_counts().index,\n            orient='v');","351096b7":"sns.boxplot(x = 'risk_category',\n            y = 'inspection_score',\n            data=df,\n            order = ['Low Risk','Moderate Risk', 'High Risk'],\n            );\nplt.title('Score per risk class');","f5dabec0":"sns.catplot(y=\"inspection_score\",\n            col='risk_category', \n            data=df, kind=\"count\",  \n            height=8, aspect=1,sharey=False, \n            orient='v',\n           );","551c11b0":"# nbr_businesses = df.groupby('business_name')['business_id'].count()\n# nbr_businesses.values\n# sns.barplot(y = nbr_businesses.index,x = 'business_id',data = nbr_businesses)\nfig, ax = plt.subplots(figsize=(30,6))\nsns.countplot(ax=ax, \n              y='business_name', \n              data=df, \n              order = df['business_name'].value_counts().iloc[:10].index,\n              );\nplt.title('Businesses with the most inspections');\n","cec2da6a":"# number of inspections to average score\ndf_unscheduled = df[(df['inspection_type']=='Routine - Unscheduled')]\ngb_count = df_unscheduled.groupby('business_id')['business_name'].count()\ngb_mean  = df_unscheduled.groupby('business_id')['inspection_score'].mean()\n\ndf_id = pd.DataFrame()\ndf_id['business_id'] = gb_count.index\ndf_id['inspection_score'] = gb_mean\ndf_id['inspection_count'] = gb_count\n\ndf_id.dropna(inplace=True)\nsns.regplot(x='inspection_score', y='inspection_count', data=df_id, scatter_kws={'alpha':0.2});\nplt.title('Inspection -  Score vs Count')","c66d797f":"df_unscheduled = pd.concat([df_unscheduled, pd.get_dummies(df_unscheduled['risk_category'])], axis=1)","feeda132":"gb_risk = df_unscheduled.groupby('business_id')['Low Risk','Moderate Risk', 'High Risk'].sum()\ngb_risk['most_severe_risk'] = gb_risk.apply(lambda x: np.argmax(x), axis=1)\n\ndf_concat = pd.concat([df_id,gb_risk['most_severe_risk']], axis=1)\ndf_concat.dropna(inplace=True)","1f579b93":"fig, ax = plt.subplots(figsize=(5,7))\nsns.scatterplot(x='inspection_score', \n                y='inspection_count', \n                data=df_concat, \n                alpha=0.7, \n                size='most_severe_risk',\n                size_order = ['High Risk','Moderate Risk','Low Risk'],\n                legend='full', \n                ax=ax);\nplt.title('Inspection -  Score vs Count');","6ba7bb5f":"df_formap = pd.concat([df_concat, df_unscheduled[['business_name','business_latitude','business_longitude']]], axis=1)\ndf_formap.dropna(inplace=True)","b2d41e0c":"import folium\n\nsf_coords = (37.76, -122.45)\n\n#create empty map zoomed in on SF\nsf_map = folium.Map(location=sf_coords, zoom_start=13)\n\nrisks = {\n    'Low Risk'      : 'green', \n    'Moderate Risk' : 'orange', \n    'High Risk'     : 'red', \n    }\n\ndef plotAddress(df):\n    '''input: series that contains a numeric named latitude and a numeric named longitude\n    this function creates a CircleMarker and adds it to your this_map'''\n    #print(\"%s\" %(risks[df.risk_category]))\n    marker_color = risks[df['most_severe_risk']]\n    folium.Marker(location=[df['business_latitude'], df['business_longitude']],\n                        popup=df['business_name'],\n                        icon=folium.Icon(color=marker_color, icon='circle',prefix='fa'),\n                        \n                       ).add_to(sf_map)\n    \ndf_formap[df_formap['inspection_score']>98].apply(plotAddress, axis = 1)\n\n\ndisplay(sf_map)","4bfba7f8":"## Risk managment\nThe question might arise: What makes a violation a *High Risk* or *Low Risk* one.\n\nThis question is answered with the following graphs. For every risk-type, the number of violations with the description is found. \n\nSo e.g. if you don't store your food cool and clean, you are in danger to get a high risk state!\n","e59f0806":"Alright, with that insight, we are now able to say by observation, which restaurant is risky to eat or not.\n\nBut if you may only have the restaurant overall score, you can only hope that it correlates with the risk category? Or can you be sure to choose wisely when only considering the score?","1fc293b8":"Even at the weekend, some inspectors are active! Watch out! ;)\n\nBut let's face the truth, most of the time, the chart looks very much like a motivation of normal worker changing during the week:\n\n**Monday:** The batteries are loaded but some still have a hangover or you are mentally still at the weekend.\n\n**Thursday and Wednesday:** You can fully concentrate on your work. That is the peek of motivation.\n\n**Tuesday and Friday:** The previous days were quite exhausiting...you start looking forward to the great social event coming on friday night and lose focus on what should really matter (if it would be up to your employer).\n\n**Weekend:** No worries you restaurant owner. The only time you will see an inspector is when he is visiting your resturant as guest. ","e504a1de":"# Cleaning and Transformations <a id=\"2\"><\/a>\n---------------","7c6267a6":"## Thank you note\nThanks for your time and patience to go through my notebook.\n\nI hope you got some insights about the San Francisco Restaurant Scene and choose wisely before going out for dinner next time!\n\nFeel free to upvote :)\n","4744135a":"Let's wrap this up:\n\nIn 2015, only very few inspection have been done. Most likely the data collection just started duirng the last weeks.\n\nDuring the next years, the overall number of inspections did not change much but decreased a bit (probably it is just because the data of december is not complete, yet). Looking at specific types of inspection, a more drastic pattern is being visible.\n\nThe *schedules routine* inspections **strongly decreased** over the last years, while the unscheduled inspections decreased less strong. It seems that while the overall inspections decreased, the focus went more into the unscheduled inspections.\n\nMore impressive are the *Foodborne Illness Investigations*. The number of inspections is more than **4x higher** in 2018 compared to 2016. Very very worrying!\n","0a5dfa1c":"# Analysis <a id=\"3\"><\/a>\n-------------------","5cca85c0":"This visualization looks a bit better then the one before. We can also see  for example the influence of the combination of risk and inspection_count on the inspection_score.\n\nEven if the number of scores are quite low, the score can be low if the risk is high!","54405773":"Now, we see a correlation between the number of inspections and the corresponding average score. We are focusing on the *Unschedules Inspections*, but the results look very similar with all inspections together since the majority of inspections are unscheduled.","8dc9c613":"There is a correlation. Lower scores means in average a higher risk and thereby a less healthy restaurant.\n\nBut there is obviously a high overlap between the risk classes. I would not count the score as a strong indicator for a reliable risk forecast. Let's go a bit more  into detail and look how the scores are disctributed for the different risk types.","114ded99":"Ok, there is no special day with an increasing inspection activity. \n\n","4fdaf562":"## Inspection Activity\nThe question arises to me, if there are specific month or times of the year, were inspectors are more active. Maybe before specific days like Thanks Giving or Christmas?","466fe8c0":"# Let's get started...<a id=\"1\"><\/a>\n---------------------------------------","d0e62edd":"There seems to be no trend or any pattern to the monthly activity. Maybe it is better visible when looking at the specific days. But stick to the *Unscheduled Routine Inspections* for the ease of simplicity.","a9b11015":"# Intro\n\n### Hi there,\nthis notebook is about the restaurant inspection data of the city of San Francisco.\n\nI will show several visualizations about scores, risks and location and their dependencies.\nFurthermore and in the beginning, I will have a look at the time dependencies.","bdcbb7a7":"## What changed over time and why should you be more picky when it comes to choosing a restaurant!","1296fe02":"## You got mapped!\n\nThe map below shows you the restaurants with the highest average score (>98). If you really want to make sure to get out with a good feeling and a belly full of healthy food, pick one of these locations with a low risk of issues found during inspections (green)."}}