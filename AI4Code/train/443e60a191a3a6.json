{"cell_type":{"5c67e64e":"code","d4c7a14d":"code","f1a970e7":"code","85e501ae":"code","d35876fa":"code","34d748cf":"code","0defb7b8":"code","a038eaaa":"code","cab51029":"code","aa5d54a1":"code","65f3dd36":"code","066adfa9":"code","325d53a0":"code","9d1328b6":"code","600a0c73":"code","c7906e90":"code","4c57a7cf":"code","e67a02eb":"code","fc561686":"code","625f6aa8":"code","1ae59006":"code","cccecbd5":"code","51d8e5b2":"code","e18245fa":"code","5507e826":"code","f865d9ee":"code","6767d6cb":"code","eb1f57f5":"code","92c30510":"code","6224cdc4":"code","b21c9873":"markdown","166dcb29":"markdown","ae79b403":"markdown","55901cbe":"markdown","c96c7bc8":"markdown","f59a65bc":"markdown"},"source":{"5c67e64e":"!pip install fastai2","d4c7a14d":"from fastai2.text.all import *","f1a970e7":"train = pd.read_csv('..\/input\/nlp-getting-started\/train.csv')\ntest = pd.read_csv('..\/input\/nlp-getting-started\/test.csv')\n\n# print the size of the training and test data\nprint(train.shape, test.shape)","85e501ae":"train.head(2)","d35876fa":"test.head(2)","34d748cf":"total = pd.concat((train.drop('target', axis=1),test), axis=0)\ntotal.shape","0defb7b8":"total.head()","a038eaaa":"dls_lm = TextDataLoaders.from_df(total, path='.', valid_pct=0.1, is_lm=True, text_col ='text')","cab51029":"dls_lm.show_batch()","aa5d54a1":"learn = language_model_learner(dls_lm, AWD_LSTM, drop_mult=0.3, metrics=[accuracy, Perplexity()])","65f3dd36":"learn.lr_find()","066adfa9":"learn.fit_one_cycle(1, 1e-1)","325d53a0":"learn.save('1epoch')","9d1328b6":"learn = learn.load('1epoch')","600a0c73":"learn.unfreeze()\nlearn.fit_one_cycle(6, 2e-3)","c7906e90":"learn.save_encoder('finetuned')","4c57a7cf":"dls_clas = TextDataLoaders.from_df(train, path='.', text_col='text', label_col='target', valid_pct=0.1, text_vocab=dls_lm.train.vocab)\ndls_clas.show_batch(max_n=4)","e67a02eb":"len(dls_clas.train.vocab[0]), len(dls_lm.train.vocab)","fc561686":"learn = text_classifier_learner(dls_clas, AWD_LSTM, drop_mult=0.5, metrics=accuracy)","625f6aa8":"learn = learn.load_encoder('finetuned')","1ae59006":"learn.fit_one_cycle(2, 2e-2)","cccecbd5":"learn.freeze_to(-2)\nlearn.fit_one_cycle(2, slice(1e-2\/(2.6**4),1e-2))","51d8e5b2":"learn.freeze_to(-3)\nlearn.fit_one_cycle(3, slice(5e-3\/(2.6**4),5e-3))","e18245fa":"learn.unfreeze()\nlearn.fit_one_cycle(4, slice(1e-3\/(2.6**4),1e-3))","5507e826":"test_dl = dls_clas.test_dl(test)","f865d9ee":"preds, _, classes = learn.get_preds(dl=test_dl, with_decoded=True)","6767d6cb":"df = pd.DataFrame({\n    'id': test_dl.get_idxs(),\n    'target': classes\n})","eb1f57f5":"df.head()","92c30510":"df = df.sort_values(by='id')\ndf = df.reset_index(drop=True)\ndf.id = test.id.values\ndf.head()","6224cdc4":"df.to_csv('submission.csv', index=False)","b21c9873":"## 5. Preparing submission file","166dcb29":"## 1. Setup the environment\n\nLet's first install the [fastaiv2](https:\/\/github.com\/fastai\/fastai2) library. The documentation of the library is available at [fastai v2 docs].(http:\/\/https:\/\/dev.fast.ai\/)","ae79b403":"## 3. Language Model","55901cbe":"## 4. Classification","c96c7bc8":"import the module of natural language processing which is named in fastai `text`.","f59a65bc":"## 2. Load the data"}}