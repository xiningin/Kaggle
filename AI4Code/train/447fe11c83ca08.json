{"cell_type":{"b180af60":"code","06c5290b":"code","3bfafcb9":"code","f73a0dda":"code","728d00af":"code","bacf4a48":"code","3c718972":"code","c964e4e4":"code","f5efa4c8":"code","e292462c":"code","40239c7f":"code","2ed4532a":"code","234fc7b6":"code","01763909":"code","421127db":"code","31517cee":"code","9df35976":"code","49ea64b4":"code","eaf50a5a":"code","401366a9":"code","78747579":"code","74da17bf":"markdown","8e039add":"markdown","afbf73d9":"markdown","ad059219":"markdown","7aada6d7":"markdown","582005c9":"markdown","b378a9cb":"markdown","b46c59bb":"markdown","70daf584":"markdown","f30ac8ba":"markdown","74bf0a7e":"markdown","a6d866a4":"markdown","e04354b3":"markdown","67f93cbb":"markdown","5f5218ba":"markdown","27a03d52":"markdown","2c60e32a":"markdown","6f7f8233":"markdown","01fc64ff":"markdown","5f89cde5":"markdown"},"source":{"b180af60":"import numpy as np\nimport pandas as pd\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nimport seaborn as sns","06c5290b":"# matplotlib setting\nmpl.rcParams['figure.dpi'] = 200\nmpl.rcParams['axes.spines.top'] = False\nmpl.rcParams['axes.spines.right'] = False","3bfafcb9":"train = pd.read_csv('..\/input\/tabular-playground-series-jun-2021\/train.csv')\ntest = pd.read_csv('..\/input\/tabular-playground-series-jun-2021\/test.csv')\nsample_submission = pd.read_csv('..\/input\/tabular-playground-series-jun-2021\/sample_submission.csv')","f73a0dda":"train = train.drop('id', axis=1)\ntest = test.drop('id', axis=1)","728d00af":"# train.describe().T.style.bar(subset=['mean'], color='#205ff2')\\\n#                             .background_gradient(subset=['std'], cmap='Reds')\\\n#                             .background_gradient(subset=['50%'], cmap='coolwarm')","bacf4a48":"# test.describe().T.style.bar(subset=['mean'], color='#205ff2')\\\n#                             .background_gradient(subset=['std'], cmap='Reds')\\\n#                             .background_gradient(subset=['50%'], cmap='coolwarm')","3c718972":"import missingno as msno\n\nfig, ax = plt.subplots(1, 2, figsize=(20, 5))\n\nmsno.matrix(train, ax=ax[0], sparkline=False)\nmsno.matrix(test, ax=ax[1], sparkline=False)\n\nax[0].set_title('Train Null Data Check (0)', fontweight='bold')\nax[1].set_title('Test Null Data Check (0)', fontweight='bold')\nplt.show()","c964e4e4":"fig = plt.figure(figsize=(12, 8))\ngs = fig.add_gridspec(7, 4)\nax = fig.add_subplot(gs[:-1,:])\nax2 = fig.add_subplot(gs[-1,:])\nax2.axis('off')\n\ntarget_cnt = train['target'].value_counts().sort_index()\ntarget_cum = target_cnt.cumsum()\nax.bar(target_cnt.index, target_cnt, color=['#d4dddd' if i%2==0 else '#fafafa' for i in range(9)],\n       width=0.55, \n       edgecolor='black', \n       linewidth=0.7)\n\n\nfor i in range(9):\n    ax.annotate(f'{target_cnt[i]}({target_cnt[i]\/len(train)*100:.3}%)', xy=(i, target_cnt[i]+1000),\n                   va='center', ha='center',\n               )\n    ax2.barh([0], [target_cnt[i]], left=[target_cum[i] - target_cnt[i]], height=0.2, \n            edgecolor='black', linewidth=0.7, color='#d4dddd' if i%2==0 else '#fafafa'\n            )\n    ax2.annotate(i+1, xy=(target_cum[i]-target_cnt[i]\/2, 0), \n                 va='center', ha='center', fontsize=10)\n\nax.set_title('Target Distribution', weight='bold', fontsize=15)\nax.grid(axis='y', linestyle='-', alpha=0.4)\n\nfig.tight_layout()\nplt.show()","f5efa4c8":"target_cnt_df = pd.DataFrame(target_cnt)\ntarget_cnt_df['ratio(%)'] = target_cnt_df\/target_cnt.sum()*100\ntarget_cnt_df.sort_values('ratio(%)', ascending=False, inplace=True)\ntarget_cnt_df['cummulated_sum(%)'] = target_cnt_df['ratio(%)'].cumsum()\ntarget_cnt_df","e292462c":"fig, ax = plt.subplots(1, 1, figsize=(15, 6))\n\ny = np.array([train[f'feature_{i}'].nunique() for i in range(75)])\ny2 = np.array([test[f'feature_{i}'].nunique() for i in range(75)])\ncomp = y-y2\n\n\nax.bar(range(75), y2, alpha=0.7, color='lightgray', label='Test Dataset')\nax.bar(range(75),  comp*(comp>0), bottom=y2, color='#336666', alpha=0.7, label='Train > Test')\nax.bar(range(75), comp*(comp<0), bottom=y2-comp*(comp<0), color='#e3120b', alpha=0.7, label='Train < Test')\n\nax.set_yticks(range(0, 110, 5))\nax.set_xticks(range(0, 75, 5))\nax.margins(0.01)\nax.grid(axis='y', linestyle='--', zorder=5)\nax.set_title('# of Features Unique Values (Train\/Test)', loc='left', fontweight='bold')\nax.legend()\nplt.show()","40239c7f":"pd.DataFrame(data={'feature' : np.arange(75)[comp>0], \n              'delta' : comp[comp>0]}, index=None)","2ed4532a":"test_mean = test.mean()\nidx = np.argsort(test_mean)\n\ntrain_mean = train.mean()[idx]\ntest_mean = test_mean.sort_values()\n\ncomp = train_mean-test_mean\n\nfig, ax = plt.subplots(1, 1, figsize=(15, 6))\n\nax.bar(range(75), test_mean, alpha=0.7, color='lightgray', label='Test Dataset')\nax.bar(range(75),  comp*(comp>0), bottom=test_mean, color='#336666', alpha=0.7, label='Train > Test')\nax.bar(range(75), comp*(comp<0), bottom=test_mean-comp*(comp<0), color='#e3120b', alpha=0.7, label='Train < Test')\n\nax.margins(0.01)\nax.grid(axis='y', linestyle='--', zorder=5)\nax.set_title('Mean of Features (Sorted by Test)', loc='left', fontweight='bold')\nax.legend()\nplt.show()","234fc7b6":"fig, axes = plt.subplots(3, 3, figsize=(15, 12))\n\ntrain_mean = train.mean().sort_values()\nmean_idx = np.argsort(train.mean())\naxes = axes.flatten()\n\nfor idx, target_feature in enumerate(sorted(train['target'].unique())):\n    sub_mean = train[train['target']==target_feature].mean()[mean_idx]\n    comp = train_mean-sub_mean\n\n    ax = axes[idx]\n    ax.bar(range(75), sub_mean, alpha=0.7, color='lightgray')\n    ax.bar(range(75),  comp*(comp>0), bottom=sub_mean, color='#336666', alpha=0.7, label=f'Train > {target_feature}')\n    ax.bar(range(75), comp*(comp<0), bottom=sub_mean-comp*(comp<0), color='#e3120b', alpha=0.7, label=f'Train < {target_feature}')\n\n    ax.margins(0.01)\n    ax.set_xticks([])\n    ax.set_yticks([])\n    ax.set_title(f'{target_feature}', fontweight='bold', loc='left', bbox=dict(boxstyle='round', fc=\"#efe8d1\", ec=\"k\"))\n    ax.spines['left'].set_visible(False)\n    ax.legend(fontsize=8)\n\nfig.supxlabel('Average by class (by Class)', ha='center', fontweight='bold')    \nplt.show()","01763909":"fig, axes = plt.subplots(15, 5, figsize=(10, 20))\n\ntarget_order = sorted(train['target'].unique())\nmean = train.groupby('target').mean().sort_index()\nstd = train.groupby('target').std().sort_index()\n\nfor idx, ax in zip(range(75), axes.flatten()):\n    ax.bar(mean[f'feature_{idx}'].index, mean[f'feature_{idx}'], \n           color=['#efe8d1' if i%2==0 else '#acc8d4' for i in range(9)],\n           edgecolor='black', \n           linewidth=0.4,\n           width=0.6)\n    \n    ax.set_xticks([])\n    ax.set_yticks([])\n    ax.set_xlabel('')\n    ax.set_ylabel('')\n    ax.margins(0.1)\n    ax.spines['left'].set_visible(False)\n    ax.set_title(f'Feature_{idx}', loc='right', weight='bold', fontsize=10)\n\nfig.supxlabel('Average by class (by feature)', ha='center', fontweight='bold')\n\nfig.tight_layout()\nplt.show()","421127db":"fig, ax = plt.subplots(1, 1, figsize=(15, 6))\n\nax.bar(range(75), 100, linewidth=0.2, edgecolor='black', alpha=0.2, color='lightgray')\nax.bar(range(75), ((train == 0).sum() \/ len(train)*100)[:-1].sort_values(), linewidth=0.2, edgecolor='black', alpha=1, color='#244747')\n\nax.set_ylim(0, 100)\nax.set_yticks(range(0, 100, 10))\n\nax.set_xticks(range(0, 75, 5))\nax.margins(0.01)\nax.grid(axis='y', linestyle='--', linewidth=0.2, zorder=5)\nax.set_title('Ratio of Zeros (Sorted)', loc='center', fontweight='bold')\nax.set_ylabel('ratio(%)', fontsize=12)\nax.legend()\nplt.show()","31517cee":"label_dict = {val:idx for idx, val in enumerate(sorted(train['target'].unique()))}\ntrain['target'] = train['target'].map(label_dict)","9df35976":"%%time\nfrom umap import UMAP\n\ntrain_sub = train.sample(50000, random_state=72)\ntarget = train_sub['target']\numap = UMAP(random_state=0)\ndr = umap.fit_transform(train_sub.iloc[:,:-1], target)","49ea64b4":"# https:\/\/www.kaggle.com\/subinium\/dark-mode-visualization-apple-version\nlight_palette = [\n    (0, 122, 255), # Blue\n    (255, 149, 0), # Orange\n    (52, 199, 89), # Green\n    (255, 59, 48), # Red\n    (175, 82, 222),# Purple\n    (255, 45, 85), # Pink\n    (88, 86, 214), # Indigo\n    (90, 200, 250),# Teal\n    (255, 204, 0)  # Yellow\n]","eaf50a5a":"fig = plt.figure(figsize=(20, 20))\ngs = fig.add_gridspec(10, 9)\nax = fig.add_subplot(gs[:-1,:])\n\nsub_axes = [None] * 9\nfor idx in range(9): \n    sub_axes[idx] = fig.add_subplot(gs[-1,idx])\n\nfor idx in range(9):\n    ax.scatter(x=dr[:,0][target==idx], y=dr[:,1][target==idx],\n              s=10, alpha=0.2\n              )\n\n    for j in range(9):\n        sub_axes[j].scatter(x=dr[:,0][target==idx], y=dr[:,1][target==idx],\n                            s=10, alpha = 0.4 if idx==j else 0.008, \n                            color = '#%02x%02x%02x' % light_palette[j] if idx==j else 'gray',\n                            zorder=(idx==j)\n                           )\n        \n    \n    sub_axes[idx].set_xticks([])\n    sub_axes[idx].set_yticks([])\n    sub_axes[idx].set_xlabel('')\n    sub_axes[idx].set_ylabel('')\n    sub_axes[idx].set_title(f'Class_{idx+1}')\n    sub_axes[idx].spines['right'].set_visible(True)\n    sub_axes[idx].spines['top'].set_visible(True)\n\nax.set_title('Dimenstion Reduction (UMAP)', fontweight='bold', fontfamily='serif', fontsize=20, loc='left')   \n    \nax.set_xticks([])\nax.set_yticks([])\nax.set_xlabel('')\nax.set_ylabel('')\nax.spines['left'].set_visible(False)\nax.spines['bottom'].set_visible(False)\n\nfig.tight_layout()\nplt.show()","401366a9":"%%time\ntest_sub = train.sample(50000, random_state=72)\ndr_test = umap.transform(test_sub)","78747579":"import matplotlib.patches as mpatches\n\n\nfig, ax = plt.subplots(1, 1, figsize=(20, 20))\nax.scatter(x=dr[:,0], y=dr[:,1], \n           color = '#%02x%02x%02x' % light_palette[0],\n           s=10, alpha=0.3, label='Train')\nax.scatter(x=dr_test[:,0], y=dr_test[:,1], \n           color = '#%02x%02x%02x' % light_palette[1],\n           s=10, alpha=0.3, label='Test')\n\n\nax.set_title('Dimenstion Reduction Compare (Train\/Test)', fontweight='bold', fontfamily='serif', fontsize=20, loc='left')   \n    \nax.set_xticks([])\nax.set_yticks([])\nax.set_xlabel('')\nax.set_ylabel('')\nax.spines['left'].set_visible(False)\nax.spines['bottom'].set_visible(False)\n\ntrain_dot = mpatches.Patch(color='#%02x%02x%02x' % light_palette[0], label='Train')\ntest_dot = mpatches.Patch(color='#%02x%02x%02x' % light_palette[1], label='Train')\nax.legend(handles=[train_dot, test_dot], loc='lower center', ncol = 2, fontsize=15)\nfig.tight_layout()\nplt.show()","74da17bf":"### Class","8e039add":"The mean according to the features is showing significance.","afbf73d9":"## Dimension Reduction with Sampling","ad059219":"Please check these features because the number of features in the train and test are different.","7aada6d7":"I tried to separate features between classes for the first time, and there is definitely a difference in tendency. I hope the model can learn this well","582005c9":"## Train \/ Test Feature EDA\n\nThere are a **total of 75 features.**\n\ntrain has **200,000** data and test has **100,000** data.\n\nIt is confirmed that there are no missing values. However, even if there are no missing values, there is a possibility that 0 or mode is a missing value because the data is anonymized.","b378a9cb":"## EDA with the Table\n\nStatistical information can be viewed through the table. This is information that can be viewed in a variety of ways through the visualization below, and is useful when looking at it briefly.\n\n- [[TPS-May] Categorical EDA](https:\/\/www.kaggle.com\/subinium\/tps-may-categorical-eda)","b46c59bb":"- Small ones have a percentage of zero, 20%, but many are close to 80%.\n- Although not visualized, the distributions of zeros in train and zeros in test are almost similar.","70daf584":"Most of them are 0, so I focused on the distribution of 0 and proceeded with the visualization.\n\nIf you look at the actual ratio of zero, it looks like this:","f30ac8ba":"## Target Distribution\n\nThe target is unbalanced.","74bf0a7e":"There are a total of 9 classes, and there are 2 classes with the highest class being 25%.","a6d866a4":"## Tabular Playground Series - JUN\n\nNow many users are using my EDA and visualizations in previous competitions.\n\n**Very happy and honored. :)**\n\n- [\u26ab Dark Mode Visualization (Apple Version)](https:\/\/www.kaggle.com\/subinium\/dark-mode-visualization-apple-version)\n- [[TPS-Apr] Highlighting the Data \u2728\u2728\u2728](https:\/\/www.kaggle.com\/subinium\/tps-apr-highlighting-the-data)\n- [[TPS-May] Categorical EDA](https:\/\/www.kaggle.com\/subinium\/tps-may-categorical-eda)\n\n\nBut then again, I'm going to use a new visualization technique to create a nice EDA.\n\n**Please enjoy.**\n\n## Introduction\n\nIn the announcement of the competition, it is said that the dataset was created through CTGAN.\n\nThe original dataset deals with predicting the category on an eCommerce product given various attributes about the listing. \n\nSimilar to May's data set, but with **9 labels** and **75 features** now, it's a bit more difficult.","e04354b3":"## Reference\n\n- color reference : https:\/\/pattern-library.economist.com\/color.html","67f93cbb":"## If the content is helpful, please upvote. :)","5f5218ba":"You can see more features of train. Handling that feature will be another issue in this competition.","27a03d52":"If you arrange them proportionally, up to 4 accounts for 75%. The other four are also less than 10%.","2c60e32a":"## Distribution by each feature","6f7f8233":"The overall mean of train and test appears to be similar.\n\nLet's check if the aspect of the mean is different for each class.","01fc64ff":"## Statistical comparison\n\nLet's sort the mean values \u200b\u200bof the train dataset and compare them with the test.","5f89cde5":"The id value is meaningless, so I will leave it out in advance."}}