{"cell_type":{"59c026ec":"code","87591725":"code","eafad103":"code","2ba51de1":"code","b1d9b5de":"code","559b7159":"code","c80a3164":"code","a942fa20":"code","6cca9789":"code","ce2b4ae5":"code","0a785c51":"code","dc59fbff":"code","31058871":"code","d8464a44":"code","6fce7316":"code","25bb4333":"code","a9bd2653":"code","6985423b":"code","f2eb31ae":"code","13001722":"code","7c1a624d":"code","b5ae2ffe":"code","c6799c53":"code","db4de8bc":"code","e6a04a0f":"code","be026787":"code","ac9060fa":"code","72d6d32c":"code","e2669ddd":"code","241317de":"code","9dc80039":"markdown"},"source":{"59c026ec":"from fastai import *\nfrom fastai.text import * \nfrom fastai.gen_doc.nbdoc import *\nfrom fastai.datasets import * \nfrom fastai.datasets import Config\nfrom pathlib import Path\nimport pandas as pd","87591725":"path = Path('..\/input\/')","eafad103":"df_test = pd.read_csv(path\/'test.csv')\ndf_test.head()","2ba51de1":"df = pd.read_csv(path\/'train.csv')#.sample(frac=0.05)\ndf.head()","b1d9b5de":"data_lm = (TextList.from_csv(path, 'train.csv', cols='question_text')\n            .random_split_by_pct(.2)\n            .label_for_lm()\n            .add_test(TextList.from_csv(path, 'test.csv', cols='question_text'))\n            .databunch())","559b7159":"data_clas = (TextList.from_csv(path, 'train.csv', cols='question_text', vocab=data_lm.vocab)\n            #.split_from_df(col='target')\n             .random_split_by_pct(.2)\n            .label_from_df(cols='target')\n            #.add_test(TextList.from_csv(path, 'test.csv', cols='question_text'))\n            .databunch(bs=32))","c80a3164":"data_clas.show_batch()","a942fa20":"MODEL_PATH = \"\/tmp\/model\/\"","6cca9789":"learn = text_classifier_learner(data_clas,model_dir=MODEL_PATH)\n#learn.load_encoder('mini_train_encoder')\nlearn.fit_one_cycle(2, slice(1e-3,1e-2))\n#learn.save('mini_train_clas')","ce2b4ae5":"learn.show_results()","0a785c51":"# Language model data\n#data_lm = TextLMDataBunch.from_csv(path, 'train.csv', cols='question_text')\n# Classifier model data\n#data_clas = TextClasDataBunch.from_csv(path, 'train.csv', vocab=data_lm.train_ds.vocab, bs=4) #32\n\n#data_lm = TextLMDataBunch.from_df(path, df)\n#data_clas = TextClasDataBunch.from_df(path, df,  vocab=data_lm.train_ds.vocab)","dc59fbff":"data_lm.show_batch()","31058871":"#??language_model_learner()","d8464a44":"learn = language_model_learner(data_lm, drop_mult=0.5, model_dir=MODEL_PATH) #bptt=65, emb_sz=400, pretrained_model=URLs.WT103","6fce7316":"acc_02 = partial(accuracy_thresh, thresh=0.2)\nf_score = partial(fbeta, thresh=0.2)\n\nlearn.metrics = metrics=[accuracy,acc_02, f_score]","25bb4333":"learn.fit_one_cycle(1, 1e-2)","a9bd2653":"learn.unfreeze()\nlearn.fit_one_cycle(1, 1e-3)","6985423b":"learn.predict(\"This is a review about\", n_words=10)","f2eb31ae":"learn.save_encoder('ft_enc')","13001722":"learn = text_classifier_learner(data_clas, drop_mult=0.5)\nlearn.load_encoder('ft_enc')","7c1a624d":"data_clas.show_batch()","b5ae2ffe":"learn.fit_one_cycle(1, 1e-2)","c6799c53":"learn.freeze_to(-2)\nlearn.fit_one_cycle(1, slice(5e-3\/2., 5e-3))\n","db4de8bc":"learn.unfreeze()\nlearn.fit_one_cycle(1, slice(2e-3\/100, 2e-3))","e6a04a0f":"learn.predict(\"This was a great movie!\")","be026787":"learn.show_results()","ac9060fa":"probs, _ = learn.get_preds(DatasetType.Test)","72d6d32c":"preds = np.argmax(probs, axis=1)","e2669ddd":"ids = df_test[\"qid\"].copy()","241317de":"submission = pd.DataFrame(data={\n    \"qid\": ids,\n    \"prediction\": preds\n})\nsubmission.to_csv(\"submission.csv\", index=False)\nsubmission.head(n=50)","9dc80039":"https:\/\/docs.fast.ai\/text.html"}}