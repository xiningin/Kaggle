{"cell_type":{"df1a61b3":"code","ef6780e7":"code","bf1c3df6":"code","36d7fdc9":"code","688d9d04":"code","2b88c948":"code","1589cb85":"code","4e2dd18e":"code","4871cd57":"code","65ba997d":"code","42a1ed6d":"code","4aeff6b7":"code","5dee622c":"code","caa6b26a":"code","42eab220":"code","929ef77b":"code","4595bb8c":"code","e9c341f6":"code","8a927e57":"code","bf23481b":"code","4ea9b8d3":"code","e5416722":"code","bb73c70f":"code","2b3cfc4b":"code","e3dae1d9":"markdown","6e9de607":"markdown","f71de76b":"markdown","a0167e33":"markdown","c7475435":"markdown","d3574226":"markdown","b86df127":"markdown"},"source":{"df1a61b3":"import warnings\nwarnings.filterwarnings('ignore')\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nimport datetime as dt\nimport sklearn\nfrom sklearn.preprocessing import MinMaxScaler\nfrom scipy.cluster.hierarchy import linkage\nfrom scipy.cluster.hierarchy import dendrogram\nfrom scipy.cluster.hierarchy import cut_tree","ef6780e7":"# read the dataset\nmall_df = pd.read_csv(\"..\/input\/customer-segmentation-tutorial-in-python\/Mall_Customers.csv\", sep=\",\", encoding=\"ISO-8859-1\", header=0)\nmall_df.head(100)","bf1c3df6":"#Check Null Values\nmall_df.isnull().sum()","36d7fdc9":"#Inspect the DataFrame\nmall_df.info()","688d9d04":"sns.violinplot(mall_df['Age']);","2b88c948":"sns.violinplot(mall_df['Annual Income (k$)']);\n","1589cb85":"sns.violinplot(mall_df['Spending Score (1-100)'])\nplt.show()","4e2dd18e":"#BIvariate Analysis\nplt.figure(figsize=(12,6))\nplt.subplot(1,2,1)\ncluster_type = mall_df.groupby(['Gender'])['Annual Income (k$)'].mean().reset_index()\nax=sns.barplot(x = 'Gender', y='Annual Income (k$)', data=cluster_type)\nfor p in ax.patches:\n    ax.annotate(str(round(p.get_height(),2)), (p.get_x() * 1.01 , p.get_height() * 1.01))\n\nplt.subplot(1,2,2)\ncluster_type = mall_df.groupby(['Gender'])['Spending Score (1-100)'].mean().reset_index()\nax=sns.barplot(x = 'Gender', y='Spending Score (1-100)', data=cluster_type)\nfor p in ax.patches:\n    ax.annotate(str(round(p.get_height(),2)), (p.get_x() * 1.01 , p.get_height() * 1.01))\n\nplt.show()","4871cd57":"#Binning the Age of the Customers\nbins = [0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75]\nslot = ['0-5','5-10','10-15','15-20','20-25','25-30','30-35','35-40','40-45','45-50','50-55','55-60','60-65','65-70','70+']\n\nmall_df['Age_Range']=pd.cut(mall_df['Age'],bins,labels=slot)","65ba997d":"#Which age People mostly visit the Mall?\nplt.figure(figsize=(12,6))\nedu=sns.countplot(x=\"Age_Range\", data=mall_df)\nedu.set_xticklabels(edu.get_xticklabels(),rotation=90)\nplt.show()","42a1ed6d":"#BIvariate Analysis\nplt.figure(figsize=(20,10))\nplt.subplot(1,2,1)\ncluster_type = mall_df.groupby(['Age_Range'])['Annual Income (k$)'].mean().reset_index()\nsns.barplot(x = 'Age_Range', y='Annual Income (k$)', data=cluster_type)\nplt.subplot(1,2,2)\ncluster_type = mall_df.groupby(['Age_Range'])['Spending Score (1-100)'].mean().reset_index()\nsns.barplot(x = 'Age_Range', y='Spending Score (1-100)', data=cluster_type)\nplt.show()","4aeff6b7":"mall_df.drop('Age_Range',axis=1,inplace=True)\nmall_df.head()","5dee622c":"from sklearn.neighbors import NearestNeighbors\nfrom random import sample\nfrom numpy.random import uniform\nimport numpy as np\nfrom math import isnan\ndef hopkins(X):\n    d = X.shape[1]\n    #d = len(vars) # columns\n    n = len(X) # rows\n    m = int(0.1 * n) # heuristic from article [1]\n    nbrs = NearestNeighbors(n_neighbors=1).fit(X.values)\n \n    rand_X = sample(range(0, n, 1), m)\n \n    ujd = []\n    wjd = []\n    for j in range(0, m):\n        u_dist, _ = nbrs.kneighbors(uniform(np.amin(X,axis=0),np.amax(X,axis=0),d).reshape(1, -1), 2, return_distance=True)\n        ujd.append(u_dist[0][1])\n        w_dist, _ = nbrs.kneighbors(X.iloc[rand_X[j]].values.reshape(1, -1), 2, return_distance=True)\n        wjd.append(w_dist[0][1])\n \n    H = sum(ujd) \/ (sum(ujd) + sum(wjd))\n    if isnan(H):\n        print(ujd, wjd)\n        H = 0\n \n    return H\n","caa6b26a":"hopkins(mall_df.drop(['CustomerID','Gender'],axis=1))","42eab220":"mall_df.head()","929ef77b":"mall_df_data=mall_df.drop(['CustomerID','Gender','Age'],axis=1)\n# instantiate\nscaler = MinMaxScaler()\n\n# fit_transform\nmall_df_scaled = scaler.fit_transform(mall_df_data)\nmall_df_scaled.shape","4595bb8c":"#Converting the scaled data to data frame\nmall_df_scaled = pd.DataFrame(mall_df_scaled)\nmall_df_scaled.columns = mall_df_data.columns\nmall_df_scaled.head()","e9c341f6":"# single linkage\nplt.figure(figsize=(30,15))\nmergings = linkage(mall_df_scaled, method=\"single\", metric='euclidean')\ndendrogram(mergings)\nplt.show()","8a927e57":"# complete linkage\nplt.figure(figsize=(30,15))\nmergings = linkage(mall_df_scaled, method='complete', metric='euclidean')\ndendrogram(mergings)\nplt.show()","bf23481b":"# 4 clusters\ncluster_l = cut_tree(mergings, n_clusters=4).reshape(-1, )\ncluster_l","4ea9b8d3":"# assign cluster labels\nmall_df['cluster_id'] = cluster_l\nmall_df.head()","e5416722":"plt.figure(figsize=(20,10))\n\nsns.scatterplot(x = 'Annual Income (k$)', y = 'Spending Score (1-100)', hue = 'cluster_id', data = mall_df, palette = 'Set1');","bb73c70f":"mall_df['cluster_id'].value_counts()","2b3cfc4b":"#Profiling the clusters\nmall_df.drop(['CustomerID','Age','Gender'],axis=1).groupby('cluster_id').mean().plot(kind='bar')\nplt.show()","e3dae1d9":"## Scaling the Data","6e9de607":"- 30-35 Age range people  visit the mall more than any other range people","f71de76b":"## Hierarchial Clustering","a0167e33":"## Hopkin Score","c7475435":"- As we can observe,Age between 25-45 has more anuual income\n- 25-30 Age People has more spending score","d3574226":"- Cluster_id 2 are the best customers to the Mall they have high Annual income and they will have spending score, so we shouldn't loose these customers as they contribute a lot to mall income\n- Cluster _id 3 have more income but they spend less so we can target these customers with some offers, so they might tend to buy and increase their spending score,when we want  market for some new products or with some special offers this cluster customers will be best\n- Cluser_id 0 are the intermediate level customers they have considerable spending score but their spending score can also be increased ,so we can go to them with some better offers and good products for marketing\n\n- cluster_id 1 are the customers where the income is low but they spend very good so these customers are sop good to our Mall","b86df127":"## EDA"}}