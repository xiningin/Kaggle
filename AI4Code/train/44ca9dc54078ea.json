{"cell_type":{"234f53cf":"code","29829a66":"code","63e3e806":"code","876510f9":"code","30acd8d6":"code","e0e02fa0":"code","c885de9c":"code","e2db579d":"code","85de8eaa":"code","ec77d2b5":"code","3e07ce41":"code","24ae8829":"code","9be6a9b1":"code","b60a395f":"code","10642069":"code","6ce11b80":"code","35f344e5":"code","9604a9cf":"code","610d2020":"code","e962a25b":"code","807fef2e":"code","ecd09b35":"code","c7397f6c":"code","e226bd3b":"code","042315d7":"code","ef6290d5":"code","2ce8cd5d":"code","e526135e":"markdown","3fd32d68":"markdown","09667560":"markdown","d71b910e":"markdown","73ff7da5":"markdown","3823dc9a":"markdown","5744b97c":"markdown","9bd23d21":"markdown","01e65661":"markdown","56ae332c":"markdown","0770dbad":"markdown","888d2793":"markdown","e0978e13":"markdown","0b8f0b58":"markdown","3d15182f":"markdown","1d51b60c":"markdown","a71024df":"markdown","bb0d2587":"markdown","75079df5":"markdown","731acb86":"markdown"},"source":{"234f53cf":"import random\nimport pandas as pd\nimport sklearn\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.model_selection import cross_val_score\nfrom sklearn.neighbors import KNeighborsClassifier\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom scipy.stats import ttest_ind","29829a66":"dados_treino = pd.read_csv('\/kaggle\/input\/adult-pmr3508\/train_data.csv', na_values='?')\ndados_treino","63e3e806":"null_val = dados_treino.isnull().sum()\nporc = (null_val\/len(dados_treino))*100\nnull_val = pd.concat([null_val, porc], axis=1).sort_values(by=1, ascending=False)\nnull_val.columns = ['Total', 'Porcentagem']\nnull_val.head(5)","876510f9":"dados_treino.fillna('Missing', inplace=True)","30acd8d6":"dados_treino.describe() #dados num\u00e9ricos","e0e02fa0":"dados_treino.describe(include=['O']) #dados categ\u00f3ricos","c885de9c":"sns.relplot('capital.loss', 'capital.gain', data=dados_treino)\nplt.xlabel('capital.loss')\nplt.ylabel('capital.gain')\nplt.show()","e2db579d":"outliers = dados_treino[dados_treino['capital.gain']==99999]\npercentual_outliers = '%.2f'%((len(outliers)\/len(dados_treino))*100)\n\npercentual_outliers","85de8eaa":"dados_treino['capital.gain'].replace(99999, dados_treino['capital.gain'].mean(), inplace=True)","ec77d2b5":"dados_treino['capital.delta'] = dados_treino['capital.gain'] - dados_treino['capital.loss']\n\ndados_treino['capital.delta'].hist()\nplt.title('Distribui\u00e7\u00e3o Varia\u00e7\u00e3o de Capital')\nplt.show()\n\ndados_treino['capital.delta'].describe()","3e07ce41":"#utilizando a biblioteca scipy stats para realizar o teste de hip\u00f3tese\ndados_maior50 = dados_treino[dados_treino['income'] == '>50K']['capital.delta'].values.tolist()\ndados_menor50 = dados_treino[dados_treino['income'] == '<=50K']['capital.delta'].values.tolist()\n\nt_test, pval = ttest_ind(random.sample(dados_maior50, 100), random.sample(dados_menor50, 100), equal_var=0)\n","24ae8829":"pval","9be6a9b1":"#plota-se o gr\u00e1fico para observar a distribui\u00e7\u00e3o por nacionalidade\npais = dados_treino[['native.country','Id']].groupby('native.country').count().reset_index(drop=False).sort_values('Id')\n\nplt.figure(figsize=(10,20))\nplt.barh('native.country', 'Id', data=pais)","b60a395f":"dados_treino['native.country.grouped'] = [nc if nc == 'United-States' else 'Others' for nc in dados_treino['native.country']]","10642069":"#plota-se o gr\u00e1fico para observar a distribui\u00e7\u00e3o por g\u00eanero\ngenero = dados_treino[['sex','Id']].groupby('sex').count().reset_index(drop=False).sort_values('Id')\n\nplt.figure()\nplt.barh('sex', 'Id', data=genero)\n","6ce11b80":"#plota-se o gr\u00e1fico para observar a distribui\u00e7\u00e3o por profiss\u00e3o\ngenero = dados_treino[['occupation','Id']].groupby('occupation').count().reset_index(drop=False).sort_values('Id')\n\nplt.figure()\nplt.barh('occupation', 'Id', data=genero)\n","35f344e5":"le = LabelEncoder()\n\ndados_treino['workclass.num'] = le.fit_transform(dados_treino['workclass'])\ndados_treino['marital.status.num'] = le.fit_transform(dados_treino['marital.status'])\ndados_treino['occupation.num'] = le.fit_transform(dados_treino['occupation'])\ndados_treino['relationship.num'] = le.fit_transform(dados_treino['relationship'])\ndados_treino['sex.num'] = le.fit_transform(dados_treino['sex'])\ndados_treino['native.country.num'] = le.fit_transform(dados_treino['native.country'])\ndados_treino['native.country.grouped.num'] = le.fit_transform(dados_treino['native.country.grouped'])\ndados_treino['race.num'] = le.fit_transform(dados_treino['race'])\ndados_treino['income.num'] = le.fit_transform(dados_treino['income'])","9604a9cf":"dados_treino[['occupation', 'occupation.num']]\n#observa-se que para cada ocupa\u00e7\u00e3o atribuiu-se um n\u00famero, o mesmo ocorre com todas as outras vari\u00e1veis","610d2020":"corr = dados_treino.corr()\nplt.figure(figsize=(15, 10))\nsns.heatmap(corr, annot=True)\nplt.show()","e962a25b":"X_treino = dados_treino[['age', 'education.num', 'hours.per.week', \n                         'capital.delta', 'marital.status.num',\n                         'relationship.num', 'sex.num']]\nY_treino = dados_treino['income.num']","807fef2e":"#inicialmente, vamos definir k, isto \u00e9, o n\u00famero de vizinhos\n\nacc = []\nfor i in range(1, 40):\n    knn = KNeighborsClassifier(n_neighbors=i, metric = 'manhattan')\n    knn.fit(X_treino, Y_treino)\n    scores = cross_val_score(knn, X_treino, Y_treino, cv=10)\n    acc.append(scores.mean())","ecd09b35":"plt.figure(figsize=(15,10))\nplt.plot(range(1, 40), acc)\nplt.ylabel('Acur\u00e1cia do modelo')\nplt.xlabel('N\u00famero de vizinhos')\nplt.grid(True)\nplt.xticks()\nplt.show()","c7397f6c":"knn = KNeighborsClassifier(n_neighbors=24, metric = 'manhattan')\n\nknn.fit(X_treino, Y_treino)\nscores = cross_val_score(knn, X_treino, Y_treino, cv=10)\nscores.mean()","e226bd3b":"dados_teste = pd.read_csv('\/kaggle\/input\/adult-pmr3508\/test_data.csv', na_values='?')\ndados_teste","042315d7":"#cria\u00e7\u00e3o e sele\u00e7\u00e3o das vari\u00e1veis, processo an\u00e1logo ao feito para a base de treino, para a base de teste\ndados_teste['capital.delta'] = dados_teste['capital.gain'] - dados_teste['capital.loss']\ndados_teste['marital.status.num'] = le.fit_transform(dados_teste['marital.status'])\ndados_teste['relationship.num'] = le.fit_transform(dados_teste['relationship'])\ndados_teste['sex.num'] = le.fit_transform(dados_teste['sex'])\ndados_teste_sel = dados_teste[['age', 'education.num', 'hours.per.week','capital.delta', 'marital.status.num','relationship.num', 'sex.num']]","ef6290d5":"Y_pred = knn.predict_proba(dados_teste_sel)\n#transforma\u00e7\u00e3o das probabilidades em classes\nclass_pred = []\nfor i in range(len(Y_pred)):\n    if Y_pred[i][0] >= Y_pred[i][1]:\n        class_pred.append('<=50K')\n    else:\n        class_pred.append('>50K')","2ce8cd5d":"submission = pd.DataFrame()\nsubmission['Id'] = dados_teste['Id']\nsubmission['income'] = class_pred\nsubmission.to_csv('.\/submission.csv', index=False)","e526135e":"Por fim, seguiremos com a substitui\u00e7\u00e3o dos dados de teste:","3fd32d68":"A primeira etapa do teste KNN consiste na **prepara\u00e7\u00e3o dos dados de treino**.","09667560":"A partir da observa\u00e7\u00e3o do mapa de calor, infere-se que a vari\u00e1vel fnlwgt n\u00e3o influencia na renda anual, que pode ser comprovado tamb\u00e9m pela baixa correla\u00e7\u00e3o com a vari\u00e1vel income.num.\n\nComo j\u00e1 concluido anteriormente, faz sentido substituir as vari\u00e1veis capital.gain e capital.loss pela vari\u00e1vel capital.change.\n\nVari\u00e1veis que apresentam baixa correla\u00e7\u00e3o com a vari\u00e1vel target s\u00e3o: native.country.num (mesmo com o agrupamento dos pa\u00edses ex-Estados Unidos), workclass.num, occupation.num e sex.num.\n\nA vari\u00e1vel Id n\u00e3o apresenta quaisquer informa\u00e7\u00f5es relevantes.\n\nDessa forma, as vari\u00e1veis Id, fnlwgt, capital.gain, capital.loss, native.contry.num, native.contry.grouped.num, workclass.num, occupation.num e sex.num ser\u00e3o exclu\u00eddas do modelo.","d71b910e":"A pr\u00f3xima etapa consiste na sele\u00e7\u00e3o das vari\u00e1veis. Para isso, vamos observar todas elas utilizando um mapa de calor:","73ff7da5":"Eliminar as linhas com dados faltantes n\u00e3o \u00e9 vi\u00e1vel, uma vez que reduzir\u00e1 muito a quantidade de dados dispon\u00edveis. Nesse sentido, vamos incluir uma nova categoria *\"Missing\"* para evidenciar as observa\u00e7\u00f5es que continham dados faltantes.","3823dc9a":"A partir do gr\u00e1fico acima, conclui-se que a melhor acur\u00e1cia do modelo ocorre quando k=24.","5744b97c":"Vamos come\u00e7ar pela an\u00e1lise das informa\u00e7\u00f5es num\u00e9ricas.","9bd23d21":"Como se obt\u00e9m um p-value menor que 0.05, rejeita-se a hip\u00f3tese nula do teste. Dessa forma, as vari\u00e1veis de ganho e perda de capital podem ser substituidas pela varia\u00e7\u00e3o.","01e65661":"Para fazer uma an\u00e1lise inicial dos dados, vamos visualizar os principais indicadores de cada atributo utilizando um *.describe()*.","56ae332c":"Passando para a an\u00e1lise das vari\u00e1veis categ\u00f3ricas.","0770dbad":"Em rela\u00e7\u00e3o \u00e0s observa\u00e7\u00f5es ligadas a g\u00eanero e profiss\u00e3o, entende-se que n\u00e3o \u00e9 necess\u00e1rio agrupar vari\u00e1veis, visto que n\u00e3o h\u00e1 correla\u00e7\u00f5es relevantes observ\u00e1veis nos gr\u00e1ficos plotados.\n\nA pr\u00f3xima etapa consiste em transformar dados n\u00e3o num\u00e9ricos em dados num\u00e9ricos. Para isso, vamos utilizar a fun\u00e7\u00e3o Label Encoder da biblioteca sklearn.","888d2793":"Agora, vamos preparar a base de testes:","e0978e13":"Observando o gr\u00e1fico acima, infere-se que talvez fa\u00e7a sentido agrupar todas as nacionalidades que n\u00e3o s\u00e3o a estadounidense, visto que h\u00e1 um n\u00famero expressivamente maior de estadounidenses observados.","0b8f0b58":"Agora, podemos come\u00e7ar a construir o modelo a partir do m\u00e9todo kNN pr\u00f3priamente dito.","3d15182f":"Percebe-se que h\u00e1 praticamente o dobro de homens em rela\u00e7\u00e3o a mulheres.","1d51b60c":"Agora, vamos visualizar a predictibilidade do modelo com os dados de teste:","a71024df":"Como o percentual de *outliers* \u00e9 muito pequeno, n\u00e3o h\u00e1 preju\u00edzos em substituir esses valores pela m\u00e9dia dos dados.","bb0d2587":"Tanto para o ganho de capital quanto para a perda de capital, h\u00e1 uma concentra\u00e7\u00e3o muito grande de valores pr\u00f3ximos ao zero. Ainda, \u00e9 poss\u00edvel observar que os valores de ganho e perda de capital apresentam uma correla\u00e7\u00e3o negativa, isto \u00e9, quanto maior o valor do ganho, menor o valor da perda e vice-versa. Por fim, \u00e9 poss\u00edvel observar que h\u00e1 alguns *outliers* para o ganho de capital, que s\u00e3o representados pelos pontos nas extremidades do gr\u00e1fico.","75079df5":"Considerando a correla\u00e7\u00e3o entre as vari\u00e1veis de ganho e perda de capital, \u00e9 poss\u00edvel avaliar a substitui\u00e7\u00e3o das duas vari\u00e1veis por apenas uma. Nesse sentido, o teste abaixo cria uma nova vari\u00e1vel, a varia\u00e7\u00e3o de capital e, por meio de um teste de hip\u00f3tese, valida a possibilidade de substituir o ganho e a perda de capital pela nova vari\u00e1vel. O teste de hip\u00f3tese deve testar a influ\u00eancia que a nova vari\u00e1vel ter\u00e1 ou n\u00e3o sobre a renda. Se tiver influ\u00eancia, pode substituir. Caso contr\u00e1rio, n\u00e3o pode. Isso ocorre pois sabe-se que o ganho e a perda de capital influenciam na renda e portanto a vari\u00e1vel oriunda deles deve influenciar tamb\u00e9m.","731acb86":"**PMR3508 - Aprendizado de M\u00e1quina e Reconhecimento de Padr\u00f5es**\n\nTestando kNN com a base adult obtida no UCI repository. Iniciando com carregamento da base e com an\u00e1lise b\u00e1sica da base e dos atributos.\n\n**Aluna: Gabriela Fonseca Fanucchi NUSP: 10770371 Data: 07\/10\/21**"}}