{"cell_type":{"e71ffa44":"code","9be46776":"code","9b027e67":"code","30cf7f52":"code","264634af":"code","d266ae48":"code","6f25d37c":"code","7bb1bacc":"code","6861d905":"code","1142956b":"code","4f2973bf":"code","f077dae7":"code","4795ec4f":"code","08103b40":"code","c2ebff42":"code","e4c4ace6":"code","fed85c6c":"code","81137fc8":"code","8319bf6e":"code","2df3eb25":"code","d1a42786":"code","9134fc19":"code","089ec44a":"code","b4473efb":"code","bd3ca818":"code","7788ec1b":"code","3ed73b84":"code","2dfe9bc2":"code","ce6d3d1f":"code","a356b24b":"code","23114948":"code","9f09250b":"markdown","88e1f341":"markdown","bdbd3bf6":"markdown","5c20c4ca":"markdown","246845ab":"markdown","b8fec9da":"markdown","d816d00c":"markdown","563909d1":"markdown","1697e28b":"markdown","bf3ff801":"markdown","4dcbb961":"markdown","3d8e9403":"markdown","31bef3cb":"markdown","05826eaa":"markdown","9b9c4dd5":"markdown","14da246c":"markdown","52b2be4e":"markdown"},"source":{"e71ffa44":"import pandas as pd\nimport numpy as np\nfrom pprint import pprint","9be46776":"df_orig = pd.read_csv(\"..\/input\/road_eqr_carpda_1_Data.csv\", encoding=\"ISO-8859-1\",na_values=[\":\"])\ndf = df_orig.copy()\nprint(df.head())\nprint(df.tail())\nprint(df.columns)","9b027e67":"print(df[\"Flag and Footnotes\"].unique())\ndf[df[\"Flag and Footnotes\"] == 'd']","30cf7f52":"# 'd' means \"definition differs\"\n# Assume for simplicity that it is the same\n\ndf = df.drop(\"Flag and Footnotes\",axis=1)","264634af":"df.UNIT.unique()","d266ae48":"df = df.drop(\"UNIT\",axis=1)","6f25d37c":"df.columns = [\"time\",\"country\",\"motor\",\"value\"]\ndf.head()","7bb1bacc":"df.country.unique()","6861d905":"df.country.replace(to_replace='Germany (until 1990 former territory of the FRG)', value='Germany', inplace=True)\ndf.country.unique()","1142956b":"df[[pd.isnull(x) for x in df.value]]","4f2973bf":"df.fillna(0,inplace=True)","f077dae7":"df.dtypes","4795ec4f":"def remove_comma(x):\n    return str(x).replace(',','')\ndf.value = df.value.apply(remove_comma).astype(int)","08103b40":"df.dtypes","c2ebff42":"df['motor'].unique()","e4c4ace6":"# Will also remove \\xa0 etc.\ndf.motor = df.motor.str.strip()\n\ndf.motor.unique()","fed85c6c":"mot_num = df[['motor','value']].groupby('motor').sum().loc[:,'value'].squeeze()\nmot_num.plot.bar()","81137fc8":"print(mot_num['Diesel'])\nprint(mot_num['Diesel (excluding hybrids)'] + mot_num['Hybrid diesel-electric'] + mot_num['Plug-in hybrid diesel-electric'])","8319bf6e":"print(df[df.motor == 'Diesel (excluding hybrids)'])","2df3eb25":"df[(df.time==2017) & (df.country=='Germany')]","d1a42786":"#df.to_csv('..\/data\/road_eqr_carpda_pre.csv',header=True,index=False)","9134fc19":"print(len(df.query('motor == \"Diesel (excluding hybrids)\" and value == 0')))\nlen(df.query('motor == \"Diesel\" and value==0'))","089ec44a":"df2 = df.copy()","b4473efb":"df2=df2[~df.motor.isin(['Diesel (excluding hybrids)','Petrol (excluding hybrids)','Alternative Energy'])]\ndf2.motor.unique()","bd3ca818":"df2.motor.replace('Petroleum products', 'petroleum', inplace=True)\ndf2.motor.replace('Diesel', 'diesel', inplace=True)\ndf2.motor.replace('Electricity', 'electricity', inplace=True)\n\ndf2.motor.replace(['Hybrid electric-petrol', 'Plug-in hybrid petrol-electric', 'Hybrid diesel-electric', 'Plug-in hybrid diesel-electric'], 'hybrid', inplace=True)\ndf2.motor.replace(['Liquefied petroleum gases (LPG)', 'Natural Gas', 'Hydrogen and fuel cells', 'Bioethanol', 'Biodiesel', 'Bi-fuel', 'Other'], 'other', inplace=True)\n\ndf2.motor.unique()","7788ec1b":"df2.describe()","3ed73b84":"df2.head()","2dfe9bc2":"df3 = pd.DataFrame(columns=df2.columns)\nfor (i,row) in df2.drop('value',axis=1).drop_duplicates().iterrows():\n    partial = df2[(df2.time==row.time) & (df2.country==row.country) & (df2.motor==row.motor)]\n    row['value'] = partial.value.sum()\n    #print(row.motor, len(partial))\n    df3 = df3.append(row)\ndf3.head()","ce6d3d1f":"df3[df3.country.isin(['Netherlands','Belgium','Norway'])].head()","a356b24b":"elec_by_country = df3[df3.motor=='electricity'].groupby('country').value.max()\nelec_by_country[elec_by_country == 0]","23114948":"#df3.to_csv('..\/data\/road_eqr_carpda_cleaned.csv',index=False,header=True)","9f09250b":"## Write end result ","88e1f341":"Source: Eurostat, dataset [road_eqr_carpda](http:\/\/appsso.eurostat.ec.europa.eu\/nui\/show.do?dataset=road_eqr_carpda&lang=en)","bdbd3bf6":"# Dataset 1: Cleaning ","5c20c4ca":"## Column: country ","246845ab":"**This dataset does not contain data on electric cars in Denmark and Italy!**","b8fec9da":"The data is inconsistent. ","d816d00c":"## Combine sparse classes in motor column","563909d1":"## Column: Flag and Footnotes","1697e28b":"## Step 2\n\n* Keep 'Diesel', 'Petroleum products' and 'Electric'\n* Combine all hybrids into one\n* Combine all alternative energies into 'other'","bf3ff801":"## Change column names ","4dcbb961":"## Column: motor type ","3d8e9403":"This is part of a [larger project](https:\/\/github.com\/maxims94\/electric-mobility-study).","31bef3cb":"## Find countries without data on electric cars","05826eaa":"## Column: value ","9b9c4dd5":"## Step 1\n\n* Drop 'X (excluding hybrids)' (due to lack of data)\n* Drop 'Alternative energy' (since it is merely the sum of 'electric' and 'other')","14da246c":"### Sanity test","52b2be4e":"## Column: UNIT "}}