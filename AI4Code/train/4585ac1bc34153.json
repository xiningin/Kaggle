{"cell_type":{"d5274912":"code","ecad2ea6":"code","de110afe":"code","3b2bd18b":"code","91d35842":"code","0d32c07d":"code","70f51a86":"code","04b82130":"markdown","36340b8f":"markdown","82e306af":"markdown","926fd23b":"markdown","afa77dc6":"markdown","50001ee0":"markdown","37a44c3c":"markdown","6c80ef81":"markdown"},"source":{"d5274912":"from pathlib import Path\nfrom datetime import datetime\n\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n\nfrom PIL import Image\nfrom PIL.ExifTags import TAGS\n\nfrom tqdm import tqdm","ecad2ea6":"def get_exif(file):\n\n    img = Image.open(file)\n\n    # check if img have exif or not\n    try:\n        exif = img._getexif()\n    except AttributeError:\n        return {}\n\n    if exif is None:\n        return {}\n\n    # prepare dict\n    exif_table = {}\n\n    # convert keys\n    for tag_id, value in exif.items():\n        exif_table[TAGS.get(tag_id, tag_id)] = value\n\n    return exif_table","de110afe":"def get_datetiems(dir_images, target_images):\n\n    datetimes = list()\n\n    for img in tqdm(target_images):\n\n        exif = get_exif(Path(dir_images) \/ img)\n\n        if 'DateTime' in exif.keys():\n            try:\n                dt = datetime.strptime(exif['DateTime'], '%Y:%m:%d %H:%M:%S')\n            except ValueError:\n                dt = ''\n            datetimes.append(dt)\n        else:\n            datetimes.append('')\n\n    return datetimes","3b2bd18b":"df = pd.read_csv('..\/input\/train.csv')\nprint(df.head())\n","91d35842":"df['DateTime'] = get_datetiems('..\/input\/train', df.Image.tolist())\nprint(df.head())\n","0d32c07d":"df['is_new_whale'] = df['Id'] == 'new_whale'\ndf = df.dropna(axis=0)\nprint('number of images which have datetime: {}'.format(len(df)))\n\ndf['year'] = df['DateTime'].dt.year\n\nnew_whales = df.query('is_new_whale==True').groupby('year').agg(len).Image\nprint('number of new_whales')\nprint(new_whales)\n\nnon_new_whales = df.query('is_new_whale==False').groupby('year').agg(len).Image\nprint('number of non new_whales')\nprint(non_new_whales)\n","70f51a86":"xticks = list(range(2003, 2019, 1))\nind = np.arange(len(xticks))\nwidth = 0.35\n\nplt.figure(figsize=(12,8))\n\np1 = plt.bar(ind, new_whales.tolist(), width)\np2 = plt.bar(ind, non_new_whales.tolist(), width, bottom=new_whales.tolist())\n\nplt.xticks(ind, xticks)\nplt.xlabel('year')\nplt.ylabel('counts')\nplt.legend((p1[0], p2[0]), ('new_whale', 'non new_whale'))\n\n\nplt.show()\n","04b82130":"## Make function to get datetime for each images","36340b8f":"Most of the image taken in 2005 are new_whale. On the other hand, more than half of images taken in 2016-2018 are not new_whale. \n\n# Conclusion\n\nExif information may be useful to indentify `new_whale`. Although we can't divide them by simple thresholding, we can use this information as one of the features. Does this feature help us ? Please your comment.","82e306af":"## Get datetimes","926fd23b":"# Introduction\n\nI found out that many image include datetime in EXIF and older images tend to be`new_whale`. \nCheck below example if you are interested.\n\n# Example\n## Import Packages\n","afa77dc6":"## Filter by Id","50001ee0":"## Load train.csv","37a44c3c":"## Make function to get EXIF","6c80ef81":"## Make the figure"}}