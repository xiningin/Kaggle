{"cell_type":{"0f21cadd":"code","9f9cc848":"code","d2051efd":"code","4bba68d9":"code","936c6b0b":"code","203ae989":"code","1ed622d7":"code","511010ff":"markdown","bde0b0a6":"markdown","c9c6e9fe":"markdown","787f3d3e":"markdown"},"source":{"0f21cadd":"%matplotlib inline\nimport numpy as np\nimport pandas as pd\nfrom IPython.core.interactiveshell import InteractiveShell\nInteractiveShell.ast_node_interactivity = \"all\"\npd.set_option('display.max_columns', 99)\npd.set_option('display.max_rows', 5000)\nfrom tqdm import tqdm\nimport plotly.express as px\nimport plotly.subplots as subplots\nimport plotly.graph_objects as go\nimport seaborn as sns\nimport os\nimport matplotlib.pyplot as plt\nfrom PIL import Image\n\nfrom plotly.offline import init_notebook_mode, iplot, plot\ninit_notebook_mode(connected=True)","9f9cc848":"comps = pd.read_csv('\/kaggle\/input\/meta-kaggle\/Competitions.csv')\ncols = ['Id', 'Title', 'EnabledDate', 'DeadlineDate', 'FinalLeaderboardHasBeenVerified',\n        'EvaluationAlgorithmName', 'RewardType', 'UserRankMultiplier', 'CanQualifyTiers', 'TotalTeams',\n       'TotalCompetitors', 'TotalSubmissions']\ncomps = comps[cols]\ncomps = comps[comps.Title.str.match('covid.+global forecasting', case=False)]\nteams = pd.read_csv('\/kaggle\/input\/meta-kaggle\/Teams.csv',  low_memory=False)\ntm = pd.read_csv('\/kaggle\/input\/meta-kaggle\/TeamMemberships.csv',  low_memory=False)\nusers = pd.read_csv('\/kaggle\/input\/meta-kaggle\/Users.csv',  low_memory=False)","d2051efd":"combined = teams.loc[teams.CompetitionId.isin(comps.Id), ['Id', 'CompetitionId', 'TeamName', 'PrivateLeaderboardRank']].copy()\ncombined = combined.merge(tm[[ 'TeamId', 'UserId']], left_on='Id', right_on='TeamId' )\ncombined = combined.merge(users[['Id', 'UserName', 'DisplayName']], left_on='UserId', right_on='Id',suffixes=['Team', 'User'])\n\nteam_size = combined.groupby('TeamId')[['UserId']].nunique().reset_index()\nteam_size.columns = ['TeamId', 'TeamSize']\ncombined = combined.merge(team_size, on='TeamId')\ncombined = combined.merge(comps[['Id', 'Title', 'UserRankMultiplier', 'TotalTeams']], left_on='CompetitionId', right_on='Id')\ncombined = combined.dropna()","4bba68d9":"combined['KagglePoints'] = combined.UserRankMultiplier * 10**5 \/ np.sqrt(combined.TeamSize) * combined.PrivateLeaderboardRank ** (-0.75) * np.log10(1 + np.log10(combined.TotalTeams))\ncombined.KagglePoints = combined.KagglePoints.astype(int)","936c6b0b":"top = combined.groupby('DisplayName')[['KagglePoints']].sum().sort_values(by='KagglePoints', ascending=False).head(665).reset_index()\ntop[top['KagglePoints'] > 0].style.background_gradient(cmap='Reds').set_precision(0)","203ae989":"ranks = combined.loc[\n    combined.DisplayName.isin(top.DisplayName),\n    ['DisplayName', 'Title', 'PrivateLeaderboardRank']\n].pivot('DisplayName', 'Title', 'PrivateLeaderboardRank')\nranks.columns = [c.split('(')[-1][:-1] for c in ranks.columns]\nranks.loc[top.DisplayName].style.background_gradient(cmap='Reds').set_precision(0)","1ed622d7":"weekly_points = combined.loc[\n    combined.DisplayName.isin(top.DisplayName),\n    ['DisplayName', 'Title', 'KagglePoints']\n].pivot('DisplayName', 'Title', 'KagglePoints').fillna(0).round(0)\nweekly_points = weekly_points.loc[top.DisplayName].astype(int)\nweekly_points.columns = [c.split('(')[-1][:-1] for c in weekly_points.columns]\ncm = sns.light_palette(\"red\", as_cmap=True)\nweekly_points.style.background_gradient(cmap=cm)","511010ff":"# Points","bde0b0a6":"# Total Ranking of all participants of COVID19 Global Forecasting Challenges\n* [COVID19 Global Forecasting (Week 5)](https:\/\/www.kaggle.com\/c\/covid19-global-forecasting-week-5)\n* [COVID19 Global Forecasting (Week 4)](https:\/\/www.kaggle.com\/c\/covid19-global-forecasting-week-4)\n* [COVID19 Global Forecasting (Week 3)](https:\/\/www.kaggle.com\/c\/covid19-global-forecasting-week-3)\n* [COVID19 Global Forecasting (Week 2)](https:\/\/www.kaggle.com\/c\/covid19-global-forecasting-week-2)\n* [COVID19 Global Forecasting (Week 1)](https:\/\/www.kaggle.com\/c\/covid19-global-forecasting-week-1)","c9c6e9fe":"This notebook is basic on the amazing notebook of @gaborfodor: [Summary - Covid19 Global Forecasting Challenges](https:\/\/www.kaggle.com\/gaborfodor\/summary-covid19-global-forecasting-challenges)\n\n**My upgrade**: I show all ranking of all 665 participants (not Top20 only) with PrivateLeaderboardRank > 0.","787f3d3e":"# Rankings"}}