{"cell_type":{"af588dfa":"code","fc739f59":"code","66f1329e":"code","12ee7ac2":"code","a838f0bc":"code","a9a4da09":"code","b8ed308a":"code","21996016":"code","7de74375":"code","4232389e":"code","c54dabca":"code","1850d9d9":"code","dce1463e":"code","a1cdce95":"code","d4f31d23":"code","d63d94a8":"code","8730b4b3":"code","0e8d94ba":"code","f5f6061c":"code","ce193f31":"code","8f66ac51":"code","e79e10ab":"code","f5d35979":"code","b9a6ee4f":"code","b4c040a0":"code","aaa27faf":"code","455056a7":"code","597722f4":"code","4f4fbfa3":"code","f3bdffd3":"code","129d1fa9":"code","13cba4dc":"code","f367d4cf":"code","0ad13d8d":"code","a2e2a4eb":"code","d52d5594":"code","5fb02a49":"code","44e6ca63":"code","d195786f":"code","789f0511":"markdown","abad3359":"markdown","55f1c618":"markdown","509da443":"markdown","32aa2da1":"markdown","a6e96ae3":"markdown","889b7613":"markdown","e4444444":"markdown","cbf23711":"markdown","caaed1ca":"markdown","99dde5ae":"markdown","5a4d0c61":"markdown","3810c468":"markdown","e3e7aff8":"markdown","e1739170":"markdown","582c01a3":"markdown","7e902ec0":"markdown","139c9a22":"markdown","057821b7":"markdown","b3d40049":"markdown","110a5887":"markdown","d3a5f55c":"markdown","4a265830":"markdown","440dba70":"markdown","568ee78f":"markdown","77bcf265":"markdown","f0bb09d2":"markdown","b3b6d0a3":"markdown","1bc06866":"markdown","7500ff0c":"markdown","5c7ba8d2":"markdown","9ed52c98":"markdown","376bd645":"markdown","ed558d18":"markdown","398a6351":"markdown","6404ff3e":"markdown","1ce050e9":"markdown","23b538c0":"markdown","33184ab2":"markdown","98b9597d":"markdown","70406c5d":"markdown","4f562373":"markdown","80b6a6a9":"markdown","9a36b677":"markdown","c80c8270":"markdown","34d8999b":"markdown","3e66e8a2":"markdown","d9c455c7":"markdown"},"source":{"af588dfa":"import pandas as pd\nimport numpy as np\n\n#visualization\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\n#Linear Regression\nfrom scipy.stats import linregress\n\n#Train_test_split\nfrom sklearn.model_selection import train_test_split\n\n#cross_val_score\nfrom sklearn.model_selection import cross_val_score\n\n#scaling\nfrom sklearn.preprocessing import StandardScaler\n\n\n\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.metrics import precision_score,recall_score, confusion_matrix, classification_report,accuracy_score, f1_score\nfrom sklearn.metrics import r2_score, mean_squared_error\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.model_selection import cross_val_score \nimport matplotlib.pyplot as plt\n#models\n\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.neighbors import KNeighborsRegressor\nfrom sklearn.ensemble import AdaBoostRegressor\nfrom sklearn.ensemble import GradientBoostingRegressor\nfrom xgboost import XGBRegressor\nfrom catboost import CatBoostRegressor\n#score\nfrom sklearn.metrics import r2_score\n\n#Importing data\ndf = pd.read_csv(\"..\/input\/insurance\/insurance.csv\")","fc739f59":"# take a look at the data\ndf.head()","66f1329e":"# statistical measuers\ndisplay(df.describe())","12ee7ac2":"# Getting some informations about the dataset\ndf.info()","a838f0bc":"fig, ax = plt.subplots(figsize=(8,6))\nsns.heatmap(df.corr(), annot=True, fmt='.1g', cmap=\"viridis\", cbar=True);","a9a4da09":"df.isna().sum()","b8ed308a":"df.describe()","21996016":"# Bmi\nsns.boxplot(df['bmi'])","7de74375":"Q1 = df.bmi.quantile(0.25)\nQ3 = df.bmi.quantile(0.75)\nQ1, Q3","4232389e":"IQR = Q3 - Q1\nIQR","c54dabca":"lower_limit = Q1 - 1.5*IQR\nupper_limit = Q3 + 1.5*IQR\nlower_limit, upper_limit","1850d9d9":"df[df['bmi'] > upper_limit]","dce1463e":"df_new = df.drop(df.index[[116,401,286,543,847,860,1047,1088,1317]])","a1cdce95":"f = plt.figure(figsize=(14,6))\nax = f.add_subplot(122)\nsns.scatterplot(x='bmi',y='charges',data=df,palette='viridis',hue='smoker')\nax.set_title('Scatter plot of Charges vs bmi')\nplt.savefig('sc.png');","d4f31d23":"df[\"bmi\"].value_counts()   # Body mass index, providing an understanding of body, ideally 18.5 to 24.9","d63d94a8":"df['weight_condition'] = np.nan\ndata = [df]\n\nfor col in data:\n    col.loc[col.bmi < 18.5, \"weight_condition\"] = \"Underweight\"\n    col.loc[(col.bmi >= 18.5) & (col.bmi < 24.986), \"weight_condition\"] = \"Normal\"\n    col.loc[(col.bmi >= 25) & (col.bmi < 29.926), \"weight_condition\"] = \"Overweight\"\n    col.loc[col.bmi >= 30, \"weight_condition\"] = \"Obese\"\n","8730b4b3":"df.drop(\"bmi\", axis = 1, inplace = True)\ndisplay(df.head())","0e8d94ba":"f = plt.figure(figsize=(14,6))\nax = f.add_subplot(121)\nsns.scatterplot(x='age',y='charges',data=df,palette='magma',hue='smoker',ax=ax)\nax.set_title('Scatter plot of Charges vs age')\n","f5f6061c":"df['age_cat'] = np.nan\nlst = [df]\n\nfor col in lst:\n    col.loc[(col['age'] >= 18) & (col['age'] <= 35), 'age_cat'] = 'Young Adult'\n    col.loc[(col['age'] > 35) & (col['age'] <= 55), 'age_cat'] = 'Senior Adult'\n    col.loc[col['age'] > 55, 'age_cat'] = 'Elder'\n    ","ce193f31":"df.drop(\"age\", axis = 1, inplace = True)\ndf.head()","8f66ac51":"plt.style.use(\"seaborn\")\nfig, ax = plt.subplots(figsize=(5,5))\nplt.pie(x=df[\"sex\"].value_counts(), \n        colors=[\"skyblue\",\"pink\"], \n        labels=[\"Male\",\"Female\"], \n        shadow = True, \n        autopct=\"%1.2f%%\", \n        explode = (0, 0.1)\n        )\nplt.show()","e79e10ab":"#Cheking the charges distributions for males and females\nx1 = sns.FacetGrid(df, row='sex', height=4, aspect=3)\nx1 = x1.map(sns.distplot, 'charges', color='cornflowerblue')\nplt.show()\n","f5d35979":"plt.style.use(\"seaborn\")\nfig, ax = plt.subplots(figsize=(6,6))\nsns.countplot(df[\"children\"], palette=\"hls\");","b9a6ee4f":"#Creating a violinplot for each category\nplt.figure(figsize=(12,4))\nsns.violinplot(x='children', y='charges', data=df, hue='sex', palette='YlGnBu')\nplt.title('Charges according to number of children', size='23')\nplt.ylabel('Charges',size=18)\nplt.xlabel('Number of children',size=18)\nplt.show()","b4c040a0":"#Countplot to compare the number of smokers and non-smokers\nplt.figure(figsize=(12,4))\nsns.countplot(x='smoker', data=df, hue='sex', palette='YlOrBr') \nplt.title('Number of smokers and non-smokers', size='23')\nplt.ylabel('Count',size=18)\nplt.xlabel('Smoker',size=18)\nplt.show()","aaa27faf":"#Countplot to compare the number of individuals from diffrent regions\nplt.figure(figsize=(12,4))\nsns.countplot(x='region', data=df, palette='husl') \nplt.title('Number of individuals from diffrent regions', size='23')\nplt.ylabel('Count',size=18)\nplt.xlabel('Region',size=18)\nplt.show()","455056a7":"from sklearn.preprocessing import LabelEncoder\nle = LabelEncoder()\nles = {}\nfor col in ['sex','smoker','region', 'weight_condition', 'age_cat']:\n    les[col] = LabelEncoder()\n    df[col]  = les[col].fit_transform(df[col])","597722f4":"df.head()","4f4fbfa3":"df =df.drop(columns=['sex','region'])\ndf.head()","f3bdffd3":"x= df.drop('charges',axis=1).values\ny =df.charges.values\nx_tr,x_tst,y_tr,y_tst = train_test_split(x,y,test_size=.2,random_state=25)","129d1fa9":"sc = StandardScaler()\nx_tr = sc.fit_transform(x_tr)\nx_tst = sc.transform(x_tst)","13cba4dc":"lr  = LinearRegression()\nknn = KNeighborsRegressor(n_neighbors=10)\ndt  = DecisionTreeRegressor(max_depth = 3)\nrf  = RandomForestRegressor(max_depth = 3, n_estimators=500)\nada = AdaBoostRegressor( n_estimators=50, learning_rate =.01)\ngbr = GradientBoostingRegressor(max_depth=2, n_estimators=100, learning_rate =.2)\nxgb = XGBRegressor(max_depth = 3, n_estimators=50, learning_rate =.2)\ncb  = CatBoostRegressor(learning_rate =.01, max_depth =5, verbose = 0)\n\nregressors = [('Linear Regression', lr), ('K Nearest Neighbours', knn),('Decision Tree', dt), ('Random Forest', rf), \n              ('AdaBoost', ada),('Gradient Boosting Regressor', gbr),('XGBRegressor', xgb),('CatBoostRegressor', cb)]\n","f367d4cf":"\nfor regressor_name, regressor in regressors:\n\n    regressor.fit(x_tr, y_tr)    \n  \n    y_pred = regressor.predict(x_tst)\n    accuracy = round(r2_score(y_tst,y_pred),3)*100\n    \n    print('{:s} : {:.0f} %'.format(regressor_name, accuracy))\n    plt.rcParams[\"figure.figsize\"] = (20,8)\n    plt.bar(regressor_name,accuracy)","0ad13d8d":"y_predict = gbr.predict(x_tst)\ngbr_r2_score = r2_score(y_tst, y_predict)\nprint('R square Score = ', round(gbr_r2_score, 5))\n\nmse = mean_squared_error(y_tst, y_predict)\nrmse_1 = np.sqrt(mse)\nprint('Root Mean Squared Error = ', round(rmse_1,5))","a2e2a4eb":"y_predict = xgb.predict(x_tst)\nxgb_r2_score = r2_score(y_tst, y_predict)\nprint('R square Score = ', round(xgb_r2_score, 5))\n\nmse = mean_squared_error(y_tst, y_predict)\nrmse_2 = np.sqrt(mse)\nprint('Root Mean Squared Error = ', round(rmse_2, 5))","d52d5594":"y_predict = cb.predict(x_tst)\ncb_r2_score = r2_score(y_tst, y_predict)\nprint('R square Score = ', round(cb_r2_score, 5))\n\nmse = mean_squared_error(y_tst, y_predict)\nrmse_3 = np.sqrt(mse)\nprint('Root Mean Squared Error = ', round(rmse_3, 5))","5fb02a49":"score = cross_val_score(xgb, x, y, cv=5)\nprint(score)","44e6ca63":"\nr2_scores = [gbr_r2_score*1000,xgb_r2_score*1000,cb_r2_score*1000]\nmodel_names = [\"Gradient Boosting R\",\"XGBRegressor\",\"CatBoostRegresso\"]\n\ntotal_bar = np.arange(len(model_names))\ncolor = ['#9edd1d', '#3edd1d', '#f7c851']\n\nfig, ax = plt.subplots(figsize=(15, 5))\nbar = plt.bar(model_names, r2_scores, alpha=1,color=color)\nplt.xticks(total_bar, model_names)\nplt.ylabel('Accuracy',fontsize=15, color='black')\nplt.xlabel('Model Name',fontsize=15, color='black')\nplt.title('Model Performance Comparison', fontsize=16, color='black', fontweight='bold')\n\ndef autolabel(bar):\n    for bar in bar:\n        height = int(bar.get_height())\n        ax.text(bar.get_x() + .4, .5*height,\n                height, va='bottom',\n                fontsize=14, color='black')\n        \nautolabel(bar)\n\nplt.show()","d195786f":"m = [rmse_1,rmse_2,rmse_3]\nmodel_names = [\"Gradient Boosting R\",\"XGBRegressor\",\"CatBoostRegresso\"]\n\ntotal_bar = np.arange(len(model_names))\ncolor = ['#9edd1d', '#3edd1d', '#f7c851']\n\nfig, ax = plt.subplots(figsize=(15, 5))\nbar = plt.bar(model_names, m, alpha=1,color=color)\nplt.xticks(total_bar, model_names)\nplt.ylabel('Accuracy',fontsize=15, color='black')\nplt.xlabel('Model Name',fontsize=15, color='black')\nplt.title('Root Mean Squared Error', fontsize=16, color='black', fontweight='bold')\n\ndef autolabel(bar):\n    for bar in bar:\n        height = int(bar.get_height())\n        ax.text(bar.get_x() + .4, .5*height,\n                height, va='bottom',\n                fontsize=14, color='black')\n        \nautolabel(bar)\n\nplt.show()","789f0511":"##### As we can see charges for smokers are much higher than charges for non-smokers. Sex doesn't have any effect on charges when you are a smoker","abad3359":"##### Almsot all the regions have equal number of individuals.","55f1c618":"### Relation between sex and charges: ","509da443":"##### The rest of the features are stable, thank God .","32aa2da1":"- Gradient Boosting Regressor","a6e96ae3":"##### Most patients do not have children","889b7613":"###  Relation between regions and charges: ","e4444444":" first we will need some statistical information...","cbf23711":"> ## Analyze by describing the data","caaed1ca":"- Feature Scaling","99dde5ae":"As we can see, almost all categories have the same range and mean of costs also the distributions are very similar, except for the people who have 5 children. This might be because of the small size of the sample of this kind of people!","5a4d0c61":"##### is there is a relationship between the features and each other?","3810c468":"- XGBRegressor\n- note : the best algorithm","e3e7aff8":"### before go  to modeling, we have to prepare the data types of the features:","e1739170":"### take a look at the features and its effect in the target \"charges\" ...\n","582c01a3":"#### Findings:\n\nThere are four numerical variables:\n    - Continuous:\n    - Age\n    - BMI\n    - Charges\n    - Discrete:\n    - children  \nThere are three categorical variables:\n    - Sex\n    - Smoker\n    - Region","7e902ec0":"### Cross Validation\nIt is a resampling procedure wich is used to evaluate the machine learning models on limited data samples. Its goal is to predict new data that is that is not tested before. ","139c9a22":"### age VS charges","057821b7":"only 9 records! we can get red of them safely ","b3d40049":" > ## Importing libraries and data\u00b6\n","110a5887":"> # label encoding:\n","d3a5f55c":"#### i got them \ud83d\ude08","4a265830":"## Conclusion:\n##### We have found out that region and gender does not bring significant difference on charges among its groups. Age, BMI,      number of children and smoking are the once that drives the charges. \nAs:\n-  age has an impact on the charges, when a person is older the health costs are larger.\n-  if you are a smoker you must expect some huge medical charges compared to non-smokers. Especially for people who have high BMI values (>35) it will result very serious health care charges.\n- no matter where you live, this won't have any impact on your medical insurance bills.\n- the number of children doesn't affect the medical costs billed by health insurance.\n-  it doesn't matter if you are a men or a women your health bills won't change.","440dba70":"### checking the missing data:","568ee78f":"### Relation between smoking and charges: ","77bcf265":"> # Splitting the data into Training data & Testing Data:","f0bb09d2":"### Best Models\n- Gradient Boosting Regressor : 88 %\n- CatBoostRegressor : 88 %\n- XGBRegressor : 88 %\n","b3b6d0a3":"- CatBoostRegressor.\n","1bc06866":"#### notice :\n- 0 for females\n- 1 for males\n------------------\n- smokers = 1: yes\n- smokers = 0: no\n\n Males tend to smoke more than females.","7500ff0c":"### Does it indicate that the data is really stable? check the outliers...","5c7ba8d2":"No missing data, cool!","9ed52c98":" ### R square (r2) Score & Root Mean Squared Error(RMSE)\n ","376bd645":"### insights:\n- Most of the people who smoke are obese people\n- Even though a person is not obese but he\/she smokes, his\/her charges tends to be higher.\n","ed558d18":"> # DEA ","398a6351":"##### Almost the same proportion...","6404ff3e":"##### As we can see the two distributions are almost the same for both women\/men, so we can affirm that there is no influence on the medical charges when it comes to the sex variable.","1ce050e9":"#### i'll do the same thing with \"age\" so that the data to be follow the same flo \ud83e\udd19\ud83c\udffb","23b538c0":"#### Let's find out which this data is..","33184ab2":"#### I see that It will be clearer if we classify people into categories according to their \"bmi\" \ud83d\udca1","98b9597d":"### We are almost ready to finally prepare the models! so let's split the data to work on it...","70406c5d":"###  let's see how many children our patients have.\n\n","4f562373":"### Model Accuracy Comparison","80b6a6a9":"Hmmm... not much","9a36b677":"##### Great \u2665\ufe0f","c80c8270":"> ## It's time to prepare our data \ud83d\ude4c\ud83c\udffb:","34d8999b":"> # Modeling :\nThere are good models, But we looking for the Best!","3e66e8a2":"- Experience 8 algorithms\n","d9c455c7":"#### Insights\n- Charges increases as the age of the person increases\n- Smokers and obese people have the highest charges regardless of their age.\n"}}