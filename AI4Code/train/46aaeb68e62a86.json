{"cell_type":{"6722b228":"code","714342c5":"code","161f1ab6":"code","903225d4":"code","94a67d6e":"code","74f4536d":"code","eff64d38":"code","778936d7":"code","795e0e94":"code","97e71e7c":"code","7d959b59":"code","c65ce95d":"code","ef4969a9":"code","2143893a":"code","8826197d":"code","593c977c":"code","24b636d3":"code","7c8347e1":"code","28906467":"code","b7062bb9":"code","6d212c65":"code","ff97e016":"code","082ccf7e":"code","43b96648":"code","48060a1d":"code","414dd562":"code","3472e11b":"code","a47479ac":"code","ceb95407":"code","22cad482":"markdown","14191581":"markdown","7032dc5f":"markdown","c16271a9":"markdown","d757ca15":"markdown","7f94d782":"markdown","15b9a8d3":"markdown","266a384e":"markdown","c3330355":"markdown","d8167d1b":"markdown","c4804aa8":"markdown","766fbba9":"markdown","3d2cf2de":"markdown","4aa56a4e":"markdown","24bd9c01":"markdown","f5651336":"markdown","2038d316":"markdown","7a819a3a":"markdown","27761f18":"markdown","66fc2306":"markdown","8adb74f9":"markdown","600fe5c1":"markdown","fa9ad531":"markdown","9d5b6c5b":"markdown","3f6d7654":"markdown","503a295a":"markdown"},"source":{"6722b228":"# Importa\u00e7\u00e3o de bibliotecas\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nimport os\nprint(os.listdir(\"..\/input\"))","714342c5":"# Importa\u00e7\u00e3o do arquivo\ndf  = pd.read_csv('..\/input\/autos.csv', sep=',', encoding='Latin1')\n\n# Lista detalhes do arquivo\ndf.info()","161f1ab6":"#Inspecionando o vendedor\nprint(df.groupby('seller').size())","903225d4":"# Removendo gewerblich\ndf = df[df.seller == 'privat']\ndf=df.drop('seller',1)\n\n# Analisando tipo da oferta\nprint(df.groupby('offerType').size())","94a67d6e":"df = df[df.offerType == 'Angebot']\ndf=df.drop('offerType',1)","74f4536d":"# Ins[[ecionando 'price'.\n# Aplicado fun\u00e7\u00e3o para remover a nota\u00e7\u00e3o cient\u00edfica ao exibir o valor.\ndf['price'].describe().apply(lambda x: format(x, 'f'))","eff64d38":"# Plotando a distribui\u00e7\u00e3o do valor\nplt.figure(figsize=(12,6))\nsns.distplot(df['price'])\nplt.xlabel('Valor')\nplt.ylabel(\"Quantidade\")\nplt.title(\"Distribui\u00e7\u00e3o do valor do ve\u00edculo\")","778936d7":"# Filtrando dados pelo pre\u00e7o\ndf = df[df.price > 100]\ndf = df[df.price < 100000]\n\n# Inspecionando a vari\u00e1vel 'price' filtrada\ndf['price'].describe().apply(lambda x: format(x, 'f'))","795e0e94":"# Plotando o resultado filtrado\nplt.figure(figsize=(12,6))\nsns.distplot(df['price'])\nplt.xlabel('Valor')\nplt.ylabel(\"Quantidade\")\nplt.title(\"Distribui\u00e7\u00e3o do valor do ve\u00edculo\")","97e71e7c":"# Inspecionando a mari\u00e1vel 'yearOfRegistration'\ndf['yearOfRegistration'].describe()","7d959b59":"# Filtrando dados por ano\ndf = df[(df.yearOfRegistration >= 1970) & (df.yearOfRegistration < 2019)]\n\n# Inspecionando os dados filtrados\ndf['yearOfRegistration'].describe()","c65ce95d":"# Inspecionando vari\u00e1vel 'powerPS'\nprint(df['powerPS'].describe())","ef4969a9":"# Filtrando varei\u00e1vel 'powerPS'\ndf = df[(df.powerPS > 50) & (df.powerPS < 900)]\n\n# Resultado da vari\u00e1vel\nprint(df['powerPS'].describe())","2143893a":"# Top 10 Maiores carros por pot\u00eancia\ndf[['name','powerPS','price']].sort_values(by=['powerPS'], ascending=False).head(10)","8826197d":"# Remove linhas que contenham valores nulo\ndf = df.dropna()\n\n# Exibe as informa\u00e7\u00f5es atuais do data frame\ndf.info()","593c977c":"# Printa exemplo dos dados\ndf.head(5)","24b636d3":"# Transformando dummies\ndummy_vehicleType = pd.get_dummies(df['vehicleType'])\ndf = pd.concat([df, dummy_vehicleType], axis = 1)\n\ndummy_gearbox = pd.get_dummies(df['gearbox'])\ndf = pd.concat([df, dummy_gearbox], axis = 1)\n\ndummy_fuelType = pd.get_dummies(df['fuelType'])\ndf = pd.concat([df, dummy_fuelType], axis = 1)\n\ndummy_brand = pd.get_dummies(df['brand'])\ndf = pd.concat([df, dummy_brand], axis = 1)\n\ndummy_notRepairedDamage = pd.get_dummies(df['notRepairedDamage'])\ndf = pd.concat([df, dummy_notRepairedDamage], axis = 1)\n\ndf.head(3)","7c8347e1":"# Importando train_test_split\nfrom sklearn.model_selection import train_test_split\ntrain, test = train_test_split(df, random_state=66)\n\ntrain.shape, test.shape","28906467":"# Importa\u00e7\u00e3o do modelo\nfrom sklearn.ensemble import RandomForestRegressor\nrf = RandomForestRegressor(random_state=66, n_estimators=200, n_jobs=-1)","b7062bb9":"# Lista de coluna a serem removidas do modelo\nremoved_cols = [\n    'dateCrawled',\n    'name',\n    'abtest',\n    'lastSeen',\n    'nrOfPictures',\n    'dateCreated',\n    'notRepairedDamage',\n    'brand',\n    'fuelType',\n    'monthOfRegistration',\n    'model',\n    'gearbox',\n    'vehicleType',\n    'postalCode',\n    'price']\n\n# Diferen\u00e7a entre as colunas a serem removidas e as demais, gera a lista de features, \n# que s\u00e3o as colunas que ser\u00e3o usadas no modelo.\nfeats = [c for c in df.columns if c not in removed_cols]","6d212c65":"# Treinamento do modelo\nrf.fit(train[feats], train['price'])\npreds = rf.predict(test[feats])","ff97e016":"# Importa\u00e7\u00e3o do modelo de erro\nfrom sklearn.metrics import mean_squared_log_error\nmean_squared_log_error(test['price'], preds)","082ccf7e":"# Criando uma coluna com o valor rpevisto na base de teste.\ntest['price_predict'] = rf.predict(test[feats])","43b96648":"# Exibindo alguns resultados comparados: preditos x reais\ntest[['price', 'price_predict']].head(30)","48060a1d":"# Exemplo radon de dados que foram preditos\nsample_data=test.sample(n=200, random_state=66)\n\n# Plota ge\u00e1fico que compara valores reais x valores preditos\nsns.regplot(x=\"price\", y=\"price_predict\", data=sample_data)\nplt.xlabel('Pre\u00e7o Real')\nplt.ylabel(\"Pre\u00e7o Predito\")\nplt.title(\"Pre\u00e7o real x Pre\u00e7o Predito\")","414dd562":"# Correla\u00e7\u00e3o entre os dados\ndf[feats[:20]].corr()","3472e11b":"# Correla\u00e7\u00e3o\nf,ax = plt.subplots(figsize=(13,15))\nsns.heatmap(df[feats[:20]].corr(), annot=True, fmt='.2f', ax=ax, linecolor='black', lw=4)\nplt.title(\"Matriz de Correla\u00e7\u00e3o\")","a47479ac":"# Avaliando a import\u00e2ncia das vari\u00e1veis\n\npd.Series(rf.feature_importances_[:15], index=feats[:15]).sort_values().plot.barh()\nplt.xlabel('Import\u00e2ncia em %')\nplt.ylabel(\"Vari\u00e1vel\")\nplt.title(\"Import\u00e2ncia das vari\u00e1veis\")","ceb95407":"# C\u00e1lculo do R2 do modelo\nscore = rf.score(train[feats], train['price'])\nprint(score)","22cad482":"Treinamos o modelo, usando a base treino, e as colunas separadas no par\u00e2metro ```features``` passando a vari\u00e1vel ```tareget``` para ser treinada, o ```price```.\n\nAp\u00f3s guardamos os resultados na vari\u00e1vel ```preds```, onde foi passado a base de teste, por\u00e9m desta vez, sem passar o resultado ```price``` cabendo ao modelo que o calcule.","14191581":"## Aplica\u00e7\u00e3o ao problema de neg\u00f3cio\n \n \n\n### An\u00e1lise da qualdiade do modelo treinado","7032dc5f":"Existem anos de fabrica\u00e7\u00e3o 1000 e maiores do que o ano atual, o que \u00e9 imposs\u00edvel.\n\nVamos tratar esses dados colocando apenas os ve\u00edculos produzidos acima de 1970.\n\nVamos tamb\u00e9m determinar que sejam, menores do que 2019.","c16271a9":"Vemos carros com PS igual a 0 e tamb\u00e9m carros com PS igual a 2000. AMbos os casos parecem suspeitos e merecem ser removidos da base.\n\nIremos considerar apenas ve\u00edculos com PS maior que 50 e menor que 900.","d757ca15":"# Data Mining e Machine Learning II\n\n\n### Proferssor Marcos Guimar\u00e3es","7f94d782":"### An\u00e1lise e limpeza de dados\n\nFaremos a an\u00e1lise de algumas vari\u00e1veis com o intu\u00edto de limpar a base de erros \/ informa\u00e7\u00f5es incorretas \/ nulas.","15b9a8d3":"Importamos o modelo para utiliza\u00e7\u00e3o ```RandomForestRegressor``` e aplicamos os par\u00e2metros de random_site(semente) igual a 66, n_estimators igual a 200 e n_jobs = -1.","266a384e":"Vemos aqui uma incid\u00eancia de valores 0, o que n\u00e3o faz sentido para o objetivo de prever valores e um carro com valor 0 n\u00e3o deve existir.\n\nTamb\u00e9m h\u00e1 ve\u00edculos com o valor impressionante de 2147483647 o que deve ser algum erro na captura, ou na cria\u00e7\u00e3o do an\u00fancio.\n\nAnalisando a distribui\u00e7\u00e3o do valor podemos observar um grande desvio na curva.\n\nVamos desta froma considerar apenas os ve\u00edculos com valor acima de 100 e menor que 100000 para nosso modelo.\n","c3330355":"O R2 do modelo \u00e9 de 0,96 o que demonstra que as features de fato explicam a vari\u00e1vel pre\u00e7o, e mudan\u00e7a nessas features ocasionar\u00e3o altera\u00e7\u00e3o na vari\u00e1vel.","d8167d1b":"### Objetivo\n\nO objetivo do presente trabalho \u00e9 verificar se \u00e9 poss\u00edvel predizer o valor de um determinado ve\u00edculo, ```target price``` usando as caracter\u00edsticas presentes em sua descri\u00e7\u00e3o, tais como quilometragem, ano, marca, etc.\n\nA base foi incorporada ao projeto e est\u00e1 presente na pasta ```.\/input``` de onde faremos a importa\u00e7\u00e3o.","c4804aa8":"Por fim iremos remover todas as linhas que tenham conte\u00fado NULO, que afetar\u00e1 nosso algorismo de predi\u00e7\u00e3o.","766fbba9":"Separamos a base em teste e treino, alocando 75% dos registros para treinamento do modelo e 25% para o teste.","3d2cf2de":"Conclu\u00edmos que o modelo apresentou um bom grau de predi\u00e7\u00e3o da vari\u00e1vel ```target``` valor, e que poderia ser usado num caso pr\u00e1tico para por exempolo procurar ```outliers``` que em caso de valores negativos da diferen\u00e7a entre o valor real e o predito, por exemplo: o modelo avaliou o ve\u00edculo em 100 e o valor real foi 70, estas situa\u00e7\u00f5es apresentam um grau elevado de oportunidade na realiza\u00e7\u00e3o de um neg\u00f3cio.\n\nTamb\u00e9m poderia ser usado para auxiliar os usu\u00e1rios a n\u00e3o pedirem valores muito distantes do encontrado no mercado, bem como evitar a perda de dinheiro por anunciar um ve\u00edculo muito abaixo dos demais concorrentes.","4aa56a4e":"Pode-se observar pelo gr\u00e1fico de import\u00e2ncia das vari\u00e1veis que a vari\u00e1vel ano de fabrica\u00e7\u00e3o do ve\u00edculo recebe um peso muito grande pelo modelo, seguido pela pot\u00eancia e em seguida pela quilomatragem que o ve\u00edculo possui, ap\u00f3s se o ve\u00edculo \u00e9 do tipo coup\u00ea e por fim, se \u00e9 autom\u00e1tico.\n\nAs demais vari\u00e1veis recebem um peso inferior a 1%.","24bd9c01":"A m\u00e9trica de erro adotada foi o ```mean_squared_log_error```, que transforma em log a soma do erros, transofrmando em um n\u00faimero pequeno e facilitando a compara\u00e7\u00e3o com outros modelos, ou o efeito que modifica\u00e7\u00f5es nas features, ou demais features engenning trazem \u00e0 predi\u00e7\u00e3o.\n\nMaiores informa\u00e7\u00f5es sobre a m\u00e9trica podem ser encontradas em sua [documenta\u00e7\u00e3o oficial](https:\/\/scikit-learn.org\/stable\/modules\/generated\/sklearn.metrics.mean_squared_log_error.html).","f5651336":"Agora os dados relativos ao ano de fabrica\u00e7\u00e3o parecem regularizados.","2038d316":"As vari\u00e1veis marca, tipo de ve\u00edculo, combust\u00edovel transmiss\u00e3o e se houve reparo foram transofrmados em dummy, uma vez que s\u00e3o vari\u00e1veis aparentemente relevantes ao neg\u00f3cio por\u00e9m como eram categ\u00f3ricas n\u00e3o podiam entrar no modelo de predi\u00e7\u00e3o.\n\nAgora que foram transformadas em dummy (0 e 1) podem ser utilizadas.","7a819a3a":"### Dados\n\nOs dados que ser\u00e3o usados \u00e9 uma base de valor de carros usados ```Used cars database```, projeto \nopensource presente no kaggle, dispon\u00edvel em: https:\/\/www.kaggle.com\/orgesleka\/used-cars-database.\n\nA base consiste em mais de 370.000 an\u00fancios de venda de ve\u00edculos. Os dados foram retirados do Ebay Alem\u00e3o e disponibilizados no Kaggle.\n\nA tradu\u00e7\u00e3o abaixo foi feita para o portugu\u00eas para entendimento das colunas e conte\u00fado dos dados:\n\n- **dateCrawled**         : Data da extra\u00e7\u00e3o dos dados\n- **name**                : Nome que o anunciante deu quando criou o an\u00fancio\n- **seller**              : 'privat'(ger)\/'privado'(pt-br) ou 'gewerblich'(ger)\/'vendedor'(pt-br)\n- **offerType**           : 'Angebot'(ger)\/'vendedor'(pt-br) ou 'Gesuch'(ger)\/'comprador'(pt-br)\n- **price**               : Valor de venda do ve\u00edculo\n- **abtest**              : Vari\u00e1vel interna do EBay\n- **vehicleType**         : TIpo do ve\u00edculo - categoria\n- **yearOfRegistration**  : Ano de registro do ve\u00edculo (fabrica\u00e7\u00e3o)\n- **gearbox**             : 'manuell'(ger)\/'manual'(pt-br) ou 'automatik'(ger)\/'autom\u00e1tico'(pt-br)\n- **powerPS**             : Pot\u00eancia do carro em PS\n- **model**               : Modelo do carro\n- **kilometer**           : Quil\u00f4metros rodados\n- **monthOfRegistration** : M\u00eas de registro do ve\u00edculo (prov\u00e3vel m\u00ebs da compra)\n- **fuelType**            : Tipo de combust~ivel\n- **brand**               : Fabricante do ve\u00edculo\n- **notRepairedDamage**   : Ve\u00edculo est\u00e1 danificado e ainda n\u00e3o foi consertado\n- **dateCreated**         : Data de cria\u00e7\u00e3o do an\u00fancio no EBay\n- **nrOfPictures**        : N\u00famero de imagens no an\u00fancio\n- **postalCode**          : CEP alem\u00e3o do local do ve\u00edculo\n- **lastSeenOnline**      : Quando foi visto a \u00faltima vez on-line o registro","27761f18":"### Predi\u00e7\u00e3o","66fc2306":"Optamos por remover esse tipo de vendedor ```gewerblich``` uma vez que seu percentual \u00e9 insignificante e em seguida removemos a coluna, uma vez que n\u00e3o ter\u00e1 utilizada j\u00e1a que todos os dados ser\u00e3o iguais.","8adb74f9":"Analisando o resultado final ficou uma curva mais parecida com a distribui\u00e7\u00e3o normal, o que auxiliar\u00e1 no processo de predi\u00e7\u00e3o usando regress\u00e3o.","600fe5c1":"Tamb\u00e9m aqui optamos por remover o tipo de an\u00fancio comprador, ou ```Gesuch```, que tamb\u00e9m \u00e9 irrelevante para o total de dados e tamb\u00e9m removemos a coluna.","fa9ad531":"Pegamos uma amostra aleat\u00f3ria de 200 dados preditos e plotamos para demonstrar visualmente a acur\u00e1cia do modelo.\n\nPodemos observar que o algor\u00edtimo est\u00e1 aparentemente bom, com os valores de erros bem pr\u00f3ximos ao real, demonstrando que as features utilizadas de fato explicam o modelo, bem como torna-se poss\u00edvel uma predi\u00e7\u00e3o de valores.","9d5b6c5b":"Em ra\u00e3o do elevado n\u00famero de vari\u00e1veis que o modelo apresenta, em raz\u00e3o de transformar alguns dados em dummy, optamos por trazer os 20 principais itens tanto na matriz de correla\u00e7\u00e3o quanto nas vari\u00e1veis de import\u00e2ncia para facilitar a visualiza\u00e7\u00e3o e entendimento.\n\nObserva-se atrav\u00e9s da matriz de correla\u00e7\u00e3o que h\u00e1 uma maior rela\u00e7\u00e3o forte, quer seja negativa, quer seja positiva, entre 3 vari\u00e1veis, quilometragem, pot\u00eancia e ano de fabrica\u00e7\u00e3o do ve\u00edculo.","3f6d7654":"### Conclus\u00e3o","503a295a":"Ap\u00f3s a limpeza de dados, atrav\u00e9s dos filtros chegamos a 240771 registros para in\u00edcio do processo de predi\u00e7\u00e3o."}}