{"cell_type":{"73303936":"code","a94986a2":"code","3aa1b53b":"code","a574e576":"code","1bc7f5d7":"code","0439b147":"code","ecbd7954":"code","23709fa6":"code","689a49d8":"code","ce77420c":"code","c8a0da18":"code","e8267ecf":"code","f376bec6":"code","39f30332":"code","71a0bc03":"code","b121ee2e":"code","8b800c82":"code","58d970fe":"code","611d0fc6":"code","40df26fc":"code","a8bf3fa5":"code","d80078e0":"code","a1c1c3ed":"code","ece46e12":"code","6bf6ca7f":"code","64198106":"code","39017921":"code","53267736":"code","20b86074":"code","1866e722":"code","5ff634f1":"code","3838b281":"code","0b945091":"code","7fe6fb46":"code","d7d8105d":"code","fa35c97e":"code","00790067":"code","343bca51":"code","59176098":"code","d70b608a":"code","f122e48b":"code","a825acb9":"code","5089a9bd":"code","2797b678":"code","188c5f35":"code","ab4ad3e4":"code","2e11ee89":"code","aae546d2":"code","edb05e01":"code","a8451a67":"code","6b8d4831":"markdown","a389bccd":"markdown","9d77cdc7":"markdown","4c065b42":"markdown","eecba5aa":"markdown","396e14ad":"markdown","877336cb":"markdown","4a3b27e6":"markdown","20ed1f49":"markdown","2e69383b":"markdown","4e81a15a":"markdown","2e2119d5":"markdown","4eab9240":"markdown","f69fc411":"markdown","a7e29e47":"markdown","ca196634":"markdown","0c38a312":"markdown","32c58e1e":"markdown","dac333b6":"markdown","4d86d875":"markdown","334af17e":"markdown","e1e4bfb6":"markdown","cd57ae36":"markdown"},"source":{"73303936":"import numpy as np\nimport pandas as pd","a94986a2":"pd.set_option('display.max_rows', 20)\npd.set_option('display.max_columns', 200)","3aa1b53b":"df = pd.read_csv('\/kaggle\/input\/cord-19-create-dataframe-may-12-update\/cord19_df.csv')","a574e576":"df.head()","1bc7f5d7":"ct_df = pd.read_csv('\/kaggle\/input\/covid-19-international-clinical-trials\/data\/ClinicalTrials.gov_COVID_19.csv')\n\nct_df.shape, ct_df.columns","0439b147":"ict_df = pd.read_csv('\/kaggle\/input\/covid-19-international-clinical-trials\/data\/ICTRP_COVID_19.csv')\n\nict_df.shape, ict_df.columns","ecbd7954":"ict_df.head(3)","23709fa6":"ict = ict_df[['TrialID', 'web address', 'Study type', 'Study design', 'Intervention', 'Primary outcome']]\nct = ct_df[['NCT Number', 'URL', 'Study Type', 'Study Designs', 'Interventions', 'Outcome Measures']]","689a49d8":"ict.columns = ['id', 'url', 'study_type', 'study_design', 'intervention', 'outcome']\nct.columns = ['id', 'url', 'study_type', 'study_design', 'intervention', 'outcome']","ce77420c":"all_trials = ict.append(ct, ignore_index=True)","c8a0da18":"all_trials.head()","e8267ecf":"# all_trials[all_trials.id.duplicated(keep=False)].sort_values('id').head()","f376bec6":"all_trials.id.duplicated().sum()","39f30332":"all_trials.drop_duplicates(subset='id', keep='last', inplace=True)","71a0bc03":"all_trials.shape","b121ee2e":"all_trials.id.str[:6].value_counts()","8b800c82":"all_trials.id","58d970fe":"all_trials.id[all_trials.id.str.startswith('EUCTR')] # use this to see the patterns","611d0fc6":"reg_nct = 'NCT[0-9]{8}'\nreg_chi = 'ChiCTR[0-9]{10}'\nreg_eu = 'EUCTR[0-9]{4}-[0-9]{6}-[0-9]{2}-[A-Z]{2}'\nreg_ir = 'IRCT[0-9]+N[0-9]{1,2}'\nreg_isrctn = 'ISRCTN[0-9]{8}'\nreg_jprn = 'JPRN-[0-9a-zA-Z]+'\nreg_tctr = 'TCTR[0-9]{11}'\nreg_actrn = 'ACTRN[0-9]{14}'\nreg_drks = 'DRKS[0-9]{8}'\nreg_nl = 'NL[0-9]{4}'\n\nregistries = [reg_nct, reg_chi, reg_eu, reg_ir, reg_isrctn, reg_jprn, reg_tctr, reg_actrn, reg_drks, reg_nl]\n\nreg = ('|').join(registries)\nreg = r'({})'.format(reg)\n\nreg","40df26fc":"pd.Series(['The trial has been registered in Chinese Clinical Trial Registry (ChiCTR2000029981). blabla NCT04275245', 'NCT04275245']).str.findall(reg)","a8bf3fa5":"all_trials.id.str.extract(reg)[0]","d80078e0":"(all_trials.id == all_trials.id.str.extract(reg)[0]).sum()","a1c1c3ed":"trials = (df.title.fillna('') + ' ' + df.abstract.fillna('') + ' ' + df.body_text.fillna('')).str.findall(reg)","ece46e12":"df['trial_id'] = trials.apply(lambda x: list(dict.fromkeys(x))) # remove multiple occurences","6bf6ca7f":"sum([len(x)!=0 for x in trials])","64198106":"# trials.notnull().sum()","39017921":"df[[len(x)!=0 for x in trials] & df.is_covid19].shape","53267736":"all_trials.set_index('id', inplace=True)","20b86074":"trials_df = pd.DataFrame(trials, columns=['trials'])","1866e722":"trials_df.trials = trials_df.trials.apply(lambda x: [i for i in pd.Index(x).intersection(all_trials.index)])","5ff634f1":"trials_df.set_index(df.cord_uid, inplace=True)","3838b281":"trials_df = trials_df[trials_df.trials.str.len() != 0]","0b945091":"all_trials.loc[all_trials.index.intersection(['NCT04276688', 'NCT04319172', 'NCT04319172'])].url.values.tolist()","7fe6fb46":"def get_urls(df, trial_ids):\n    idx = pd.Index(trial_ids)\n    if len(idx) > 0:\n        return df.loc[idx].url.values.tolist()\n    else:\n        return None","d7d8105d":"trials_df['trial_url'] = trials_df.trials.apply(lambda x: get_urls(all_trials, x))","fa35c97e":"# trials_df = trials_df.dropna(subset=['trial_url'])","00790067":"trials_df.loc['00s3wgem']","343bca51":"trials_df.head()","59176098":"trials_df.shape","d70b608a":"len(df.set_index('cord_uid')[df.set_index('cord_uid').is_covid19==True].index.intersection(trials_df.index))","f122e48b":"df.set_index('cord_uid').loc['00s3wgem'].url","a825acb9":"df.is_covid19.sum()","5089a9bd":"trials_df","2797b678":"trials_df.to_csv('trial_urls.csv')","188c5f35":"a = pd.read_csv('trial_urls.csv', index_col='cord_uid' , converters={'trial_url': eval})","ab4ad3e4":"a.head()","2e11ee89":"len(trials_df.explode(column='trials')), len(trials_df.explode(column='trial_url'))","aae546d2":"trials_exploded = trials_df.explode(column='trials')\n\ntrials_exploded.trial_url = trials_df.explode(column='trial_url').trial_url.values\n\ntrials_exploded.head()","edb05e01":"trials_exploded.to_csv('trials_exploded.csv')","a8451a67":"# def get_trials(df, trial_ids):\n#     idx = df.index.intersection(trial_ids)\n#     if len(idx) > 0:\n#         return df.loc[idx]\n#     else:\n#         return None\n\n# trials_df['trial_info'] = trials_df.trials.apply(lambda x: get_trials(all_trials, x))\n\n# trials_df = trials_df.set_index(df.paper_id).dropna(subset=['trial_info'])\n\n# trials_df.loc['188e7ff1e260864c89f266b5597de26d69a84660'].trial_info\n\n# trials_df.shape\n\n# trials_df.to_csv('trials_df.csv')\n\n# a = pd.read_csv('trials_df.csv', index_col='paper_id', converters={'trial_info': eval}) # how to load this?","6b8d4831":"# Drop Duplicates","a389bccd":"Let's export our dataframe with paper_id + trial ids and urls.","9d77cdc7":"Here we combine the information about clinical trials gathered in [this great dataset](https:\/\/www.kaggle.com\/panahi\/covid-19-international-clinical-trials) with the CORD-19 dataset by matching trial ids found in the title, abstract or the full text of the papers.","4c065b42":"# Search Trial ID in Papers","eecba5aa":"We need to come up with some regular expression to search for trial ids from different sources.","396e14ad":"We found 279 Covid-19-papers that mention registered (Covid-19) trials, some of them appear multiple times. Keep in mind though that not all papers in CORD-19 specifically deal with Covid-19. (For now, we don't consider other registered trials that might appear in non-covid19 papers)","877336cb":"We now want to match the trial ids we found in the papers with the registered trials.","4a3b27e6":"... and rename them...","20ed1f49":"# Exploded Format","2e69383b":"Total number of trial ids we found:","4e81a15a":"Sanity checks","2e2119d5":"In our papers that are marked as covid-19-papers we found 361 trial ids. (We will see later that not all of them are found in the registered trials)","4eab9240":"### Load like this to read in the lists","f69fc411":"We use the dataset that I've created in [another notebook](https:\/\/www.kaggle.com\/danielwolffram\/cord-19-create-dataframe). ","a7e29e47":"Only keep trial ids that were found in the trial registries","ca196634":"# Load Data","0c38a312":"... so we can easily combine them:","32c58e1e":"Some trial ids appear in both data sets, we drop the duplicates.","dac333b6":"Let's pick several columns that seem interesting and appear in both files...","4d86d875":"# Combine both dataframes","334af17e":"These should work:","e1e4bfb6":"Now we extract all trial ids that we can find in the title, abstract or text body.","cd57ae36":"Great, we don't lose any of the trial ids:"}}