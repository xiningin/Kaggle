{"cell_type":{"741b6bd2":"code","9787208b":"code","d2fc8725":"code","03564f1b":"code","b296b376":"code","9cb06954":"code","3615ebc7":"code","7ef6fe8b":"code","f30ac74e":"code","477648b0":"code","9fd35a8a":"code","cade4596":"code","bcd1d94a":"code","18a93cb0":"code","888dfd8d":"code","e214aec2":"code","dad47d37":"code","f902e832":"code","9a8642cf":"code","3dc1221a":"code","9d1e0eee":"code","53410590":"code","c1904a31":"code","302b852b":"code","ae4f3c94":"code","4fd4f7e5":"code","0846628e":"code","45f8c728":"code","0361f459":"code","36717dc7":"code","61d7919a":"code","71898a77":"code","c2b7bc74":"code","78fc8d37":"code","6ab68ccf":"code","9bbfa04e":"code","5f88704f":"code","1817900f":"code","1b89e28b":"code","148838d8":"code","016f7215":"code","39985072":"code","b9185974":"code","ae006532":"code","1a0e187a":"code","47e12b6e":"code","9509101e":"code","ebcdd225":"code","c8104eeb":"code","23b3230a":"code","9399c214":"code","1359d3ca":"code","eae9eba8":"code","2b152278":"code","6fe9bb64":"code","95941afa":"code","2efc2643":"code","2cf7788c":"markdown","4bc58867":"markdown","03978ca6":"markdown","f727a0de":"markdown","d98b082d":"markdown","9a2e273d":"markdown","624d43a0":"markdown","ecf3afd7":"markdown","3f9512ec":"markdown","2abf4814":"markdown","8a109244":"markdown","03f8d9c5":"markdown","4c5c1da7":"markdown","77586a51":"markdown","b3007b9b":"markdown","bbb9753d":"markdown","7997b3c1":"markdown","309a6b2b":"markdown","eaa966bb":"markdown","fa838986":"markdown","c5ca89d1":"markdown","0593514c":"markdown","a73b90bb":"markdown","a2067d25":"markdown","a5407618":"markdown","6b7bafc6":"markdown","374d9b49":"markdown","b1365f6f":"markdown","61ed3252":"markdown"},"source":{"741b6bd2":"# might come in handy when dealing with arrays and general math\nimport numpy as np\n# regular pandas also for data manipulation\nimport pandas as pd\n\nimport matplotlib.pyplot as plt\n# import matplotlib as plt\n%matplotlib inline\n# As in microcourses there was used seaborn, then I will use this as well.\nimport seaborn as sns\n\n#I start with RandomForest as this is used in ML intro course in Kaggle. And since Titanic is classification problem, then I will try to \nfrom sklearn.ensemble import RandomForestClassifier\nfrom xgboost import XGBClassifier\nfrom sklearn.preprocessing import OneHotEncoder\n# I add some other things later\n\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import accuracy_score, f1_score\n\nfrom sklearn.model_selection import cross_val_score, GridSearchCV, StratifiedKFold, learning_curve","9787208b":"#train_file_path = '.\/data\/titanic_train.csv'\n#test_file_path = '.\/data\/titanic_test.csv'\n\ntrain_file_path = \"..\/input\/titanic\/train.csv\"\ntest_file_path = \"..\/input\/titanic\/test.csv\"\n\ntrain_data = pd.read_csv(train_file_path)\ntest_data = pd.read_csv(test_file_path)","d2fc8725":"# train_data.describe(include='all')\ntrain_data.info()","03564f1b":"test_data.info()","b296b376":"train_data.describe(include='all')","9cb06954":"test_data.describe(include='all')","3615ebc7":"train_data.groupby(by=['Pclass']).count()","7ef6fe8b":"sns.countplot(x=train_data['Pclass'], hue=train_data['Survived']);\n# this has a little different version too, just for learning again.\n# sns.countplot(x = \"Pclass\", hue = \"Survived\", data = train_data, palette = 'RdPu');","f30ac74e":"fig, ax = plt.subplots(figsize = (10,6))\nax = sns.countplot(x = 'Survived', hue = 'Pclass', data = train_data, palette = 'YlOrRd')\nax.set_xlabel('Survived')\nax.set_title('Survival Rate for Passenger Classes', fontsize = 14, fontweight='bold');\n\n# This graph learned here: https:\/\/www.kaggle.com\/alenavorushilova\/data-analysis-and-data-visualization-seaborn","477648b0":"ax = sns.catplot(x=\"Pclass\", hue=\"Sex\", col=\"Survived\",\n                data=train_data, kind=\"count\",\n                height=4, aspect=.7, palette = 'OrRd');\n# This also learned from here: https:\/\/www.kaggle.com\/alenavorushilova\/data-analysis-and-data-visualization-seaborn","9fd35a8a":"sns.barplot(x=\"Pclass\", y=\"Survived\", data= train_data, palette = 'BuGn');","cade4596":"perc = train_data[['Pclass', 'Survived']].groupby(['Pclass'], as_index=False).mean().sort_values(by='Survived', ascending=False)\nperc*100\n# This line is just to get the percentages of survival","bcd1d94a":"sns.factorplot(x='Pclass', y='Survived', hue = 'Sex', data = train_data, palette = 'PRGn');\n# And one last graph from this kernel again: https:\/\/www.kaggle.com\/alenavorushilova\/data-analysis-and-data-visualization-seaborn","18a93cb0":"def extract_title(name):\n    \"\"\"This just gets the title from name column\"\"\"\n    for string in name.split():\n        if '.' in string:\n            return string[:-1]\n    # return name.split(',')[1].split('.')[0] ## My own code, still learning python too. This code taken from other kernel\n\ntrain_data['Title'] = train_data['Name'].apply(lambda n: extract_title(n))\ntest_data['Title'] = test_data['Name'].apply(lambda n: extract_title(n))\nprint(test_data['Title'].value_counts(),'\\n\\n',train_data['Title'].value_counts())\n# print(train_data['Title'].value_counts())","888dfd8d":"# Lets try to organize those titles that are less than 10 and others also\nfor dataframe in [train_data, test_data]:\n    dataframe['Title'] = dataframe['Title'].replace('Mlle', 'Miss')\n    dataframe['Title'] = dataframe['Title'].replace('Ms', 'Miss')\n    dataframe['Title'] = dataframe['Title'].replace('Mme', 'Mrs')\n\n    dataframe['Title'] = dataframe['Title'].replace(['Lady', 'Capt', 'Col','Don', 'Dr', \n                                             'Major', 'Rev', 'Sir', 'Dona', 'Countess', 'Jonkheer'], 'Other')\n\n    # Lets drop names too\n    dataframe.drop('Name', axis=1, inplace=True)\n    ","e214aec2":"plt.figure(figsize=[10,5])\nsns.countplot(x='Sex', hue='Survived', data=train_data)\nplt.xticks(rotation=20);","dad47d37":"sns.barplot(x='Sex', y='Survived', data=train_data, palette=('RdPu'));","f902e832":"print('% of survived females:', train_data['Survived'][train_data['Sex'] == 'female'].value_counts(normalize = True)[1]*100)\nprint('% of survived males:', train_data['Survived'][train_data['Sex'] == 'male'].value_counts(normalize = True)[1]*100)\n# train_data['Survived'][train_data['Sex'] == 'female'].value_counts(normalize = True)","9a8642cf":"# Another way to do this, using groupby:\ntrain_data[['Sex', 'Survived']].groupby(['Sex'], as_index=False).mean().sort_values(by='Survived', ascending=False)","3dc1221a":"train_data['FamilySize'] = train_data['SibSp'] + train_data['Parch']\ntest_data['FamilySize'] = train_data['SibSp'] + train_data['Parch']\n# Now that we have family size, we can create feature IsAlone.\ntrain_data['IsAlone'] = train_data['FamilySize'].apply(lambda fs: 1 if fs == 0 else 0)\ntest_data['IsAlone'] = test_data['FamilySize'].apply(lambda fs: 1 if fs == 0 else 0)","9d1e0eee":"sns.countplot(x='IsAlone', hue='Survived', data=train_data);","53410590":"sns.countplot(x='FamilySize', hue='Survived', data=train_data);","c1904a31":"train_data[['FamilySize', 'Survived']].groupby('FamilySize', as_index=False).mean().sort_values(by='Survived', ascending=False)","302b852b":"train_data.drop(['Parch', 'SibSp'], axis=1, inplace=True)\ntest_data.drop(['Parch', 'SibSp'], axis=1, inplace=True)","ae4f3c94":"train_data[['Ticket', 'PassengerId']].groupby('Ticket', as_index=False).count().sort_values('PassengerId', ascending=False)","4fd4f7e5":"train_data['TicketGroupSize'] = train_data.groupby(['Ticket'])['PassengerId'].transform('count') \ntest_data['TicketGroupSize'] = test_data.groupby(['Ticket'])['PassengerId'].transform('count') ","0846628e":"sns.countplot(x='TicketGroupSize', hue='Survived', data=train_data);","45f8c728":"# Lets drop ticket for now\ntrain_data.drop('Ticket', axis=1, inplace=True)\ntest_data.drop('Ticket', axis=1, inplace=True)","0361f459":"fare_median = test_data['Fare'].median()\ntest_data['Fare'] = test_data['Fare'].fillna(fare_median)","36717dc7":"train_data['HasCabin'] = train_data['Cabin'].notnull().astype('int')\ntest_data['HasCabin'] = test_data['Cabin'].notnull().astype('int')","61d7919a":"sns.countplot(x='HasCabin', hue='Survived', data=train_data);","71898a77":"train_data.drop('Cabin', axis=1, inplace=True)\ntest_data.drop('Cabin', axis=1, inplace=True)","c2b7bc74":"train_data['Embarked'].value_counts()","78fc8d37":"train_data['Embarked'] = train_data['Embarked'].fillna('S')\nsns.countplot(x='Embarked', hue='Survived', data=train_data);","6ab68ccf":"# I will concatenate datasets to get better age cover\nfull_data = pd.concat([train_data.drop('Survived', axis=1), test_data], ignore_index=True)","9bbfa04e":"full_data[['Age', 'Pclass', 'Sex', 'Embarked']].groupby(['Pclass', 'Sex', 'Embarked'])['Age'].mean()","5f88704f":"train_data[['Age', 'Pclass', 'Sex', 'Embarked']].groupby(['Pclass', 'Sex', 'Embarked'])['Age'].mean()","1817900f":"# To see how empty values count differs on training and full data set, use these lines\n# full_data[full_data['Age'].isnull()][['Pclass', 'Sex', 'Embarked', 'PassengerId']].groupby(['Pclass', 'Sex', 'Embarked'])['PassengerId'].count()\n# train_data[train_data['Age'].isnull()][['Pclass', 'Sex', 'Embarked', 'PassengerId']].groupby(['Pclass', 'Sex', 'Embarked'])['PassengerId'].count()\n\n# Same to see how filled values count differ on training and full set\n# full_data[full_data['Age'].notnull()][['Pclass', 'Sex', 'Embarked', 'PassengerId']].groupby(['Pclass', 'Sex', 'Embarked'])['PassengerId'].count()\n# train_data[train_data['Age'].notnull()][['Pclass', 'Sex', 'Embarked', 'PassengerId']].groupby(['Pclass', 'Sex', 'Embarked'])['PassengerId'].count()","1b89e28b":"fig, axes = plt.subplots(1, 3, figsize=(20,5))\n\nsns.distplot(a=train_data.Age.dropna(), kde=False, ax=axes[0], bins=30);\naxes[0].set_title('Training data distribution')\n\nsns.distplot(a=test_data.Age.dropna(), kde=False, ax=axes[1], bins=30);\naxes[1].set_title('Test data distribution')\n\naxes[2].set_title('Full data distribution')\nsns.distplot(a=full_data.Age.dropna(), kde=False, ax=axes[2], bins=30);","148838d8":"def get_age(element):\n    age = element[0]\n    pclass = element[1]\n    sex = element[2]\n    embarked = element[3]\n    if (pd.isnull(age)):\n        temp_data = full_data[(full_data['Pclass'] == pclass) & (full_data['Sex'] == sex) & (full_data['Embarked'] == embarked)]\n        mean_age = temp_data['Age'].mean()\n        # temp_data[['Age', 'Pclass', 'Sex', 'Embarked']].groupby(['Pclass', 'Sex', 'Embarked'])['Age'].mean()\n        # print(pclass, sex, embarked, mean_age)\n        return mean_age\n    return age\ntrain_data['Age'] = train_data[['Age', 'Pclass', 'Sex', 'Embarked']].apply(get_age, axis=1)\ntest_data['Age'] = test_data[['Age', 'Pclass', 'Sex', 'Embarked']].apply(get_age, axis=1)","016f7215":"# Last view over distribution\nfull_data = pd.concat([train_data.drop('Survived', axis=1), test_data], ignore_index=True)\nsns.distplot(a=full_data.Age, kde=False, bins=40);","39985072":"# Lets one hot encode on my own these sex values...\n\nsex = pd.get_dummies(train_data['Sex'], prefix='Sex', drop_first=True)\nembarked = pd.get_dummies(train_data['Embarked'], prefix='Embarked', drop_first=True)\n# pclass = pd.get_dummies(train_data['Pclass'], prefix='Pclass', drop_first=True)\ntitle = pd.get_dummies(train_data['Title'], prefix='Title', drop_first=True)\n\ntrain_data.drop(['Sex', 'Title', 'Embarked'], axis=1, inplace=True)\n\ntrain_data = pd.concat([train_data, sex, embarked, title], axis=1)","b9185974":"train_data.head()","ae006532":"# Lets do same for test data\n\nsex = pd.get_dummies(test_data['Sex'], prefix='Sex', drop_first=True)\nembarked = pd.get_dummies(test_data['Embarked'], prefix='Embarked', drop_first=True)\n# pclass = pd.get_dummies(test_data['Pclass'], prefix='Pclass', drop_first=True)\ntitle = pd.get_dummies(test_data['Title'], prefix='Title', drop_first=True)\n\ntest_data.drop(['Sex', 'Title', 'Embarked'], axis=1, inplace=True)\n\ntest_data = pd.concat([test_data, sex, embarked, title], axis=1)","1a0e187a":"test_data.head()","47e12b6e":"# Prepare data for modelling\ny_train = train_data['Survived']\nX_train = train_data.drop(['Survived', 'Fare'], axis=1)\ntest_data = test_data.drop(['Fare'], axis=1)\n# X_train, X_test, Y_train, Y_test = train_test_split(train_data_without_y, y, test_size=0.3, random_state=13)","9509101e":"kfold = StratifiedKFold(n_splits=5)\n\nrandom_state = 13","ebcdd225":"random_forest_classifier = RandomForestClassifier(random_state=random_state)\n\ncv_result = cross_val_score(random_forest_classifier, X_train, y_train, cv=kfold, scoring='accuracy')\nprint(\"CV result mean: \", cv_result.mean(), \"CV result std: \", cv_result.std())\ncv_result","c8104eeb":"xgbClassifier = XGBClassifier(random_state=random_state)\n\ncv_result = cross_val_score(xgbClassifier, X_train, y_train, cv=kfold, scoring='accuracy')\n\nprint(\"CV result mean: \", cv_result.mean(), \"CV result std: \", cv_result.std())\ncv_result","23b3230a":"rf_param_grid = {'max_depth'        :[1, 2, 3, 4, 5, 6],\n                 'max_features'     :[2, 4, 6, 8, 10],\n                 'min_samples_split':[2, 4, 6, 8, 10],\n                 'bootstrap'        :[False, True],\n                 'n_estimators'     :[50, 100, 200, 500],\n                 'criterion'        :['gini']}\n\ngrid_search_random_forest_classifier = GridSearchCV(random_forest_classifier, param_grid=rf_param_grid, cv=kfold, scoring='accuracy', n_jobs=4, verbose=1)\ngrid_search_random_forest_classifier.fit(X_train, y_train)\n\nrandom_forest_best = grid_search_random_forest_classifier.best_estimator_\n\ngrid_search_random_forest_classifier.best_score_","9399c214":"grid_search_random_forest_classifier.best_params_","1359d3ca":"xgb_param_grid={'colsample_bylevel':[0.1, 0.9, 1],\n                'colsample_bytree' :[0.2, 0.8, 1],\n                'gamma'            :[0.99, 9, 99],\n                'max_depth'        :[2, 4, 6, 8, 10],\n                'min_child_weight' :[1, 2, 4, 6, 8, 10],\n                'n_estimators'     :[10, 20, 50, 70, 100, 200, 500, 1000]}\n                # 'nthread'          :[1,2,3,4],\n                # 'silent'           :[True]}\n\ngrid_search_xgboost_classifier = GridSearchCV(xgbClassifier, param_grid=xgb_param_grid, cv=kfold, scoring='accuracy', n_jobs=4, verbose=1)\ngrid_search_xgboost_classifier.fit(X_train, y_train)\n\nxgb_best = grid_search_xgboost_classifier.best_estimator_\n\ngrid_search_xgboost_classifier.best_score_","eae9eba8":"grid_search_xgboost_classifier.best_params_","2b152278":"x_tr, x_val, y_tr, y_val = train_test_split(X_train, y_train, test_size=0.3, random_state=random_state)","6fe9bb64":"random_forest_classifier = RandomForestClassifier(n_estimators=200, max_depth=3, max_features=8, min_samples_split=2, bootstrap=True, random_state=random_state)\nrandom_forest_classifier.fit(x_tr, y_tr)\npredicted_test = random_forest_classifier.predict(x_val)\n\naccuracy_random_forest = accuracy_score(y_val, predicted_test)\nf1_random_forest = f1_score(y_val, predicted_test)\nprint(\"Random forest scores: \", accuracy_random_forest, f1_random_forest)","95941afa":"xgbClassifier = XGBClassifier(max_depth=4,n_estimators=20,gamma=9,colsample_bylevel=0.9,random_state=random_state)\n#{'colsample_bylevel': 0.9, 'colsample_bytree': 1, 'gamma': 9, 'max_depth': 4, 'min_child_weight': 1, 'n_estimators': 20}\nxgbClassifier.fit(x_tr, y_tr)\npredicted_test = xgbClassifier.predict(x_val)\n\naccuracy_xgb = accuracy_score(y_val, predicted_test)\nf1_xgb = f1_score(y_val, predicted_test)\nprint(\"XGBooster scores: \", accuracy_xgb, f1_xgb)","2efc2643":"# random_forest_classifier.fit(train_data_without_y, y)\nxgbClassifier.fit(X_train, y_train)\n# test_X = test_data.drop(labels=['Name', 'Ticket', 'Cabin', 'Embarked'], axis=1, inplace=False)\n# test_X['Fare'].fillna(method='ffill',inplace=True )\n\n# submission_prediction = random_forest_classifier.predict(test_data)\nsubmission_prediction = xgbClassifier.predict(test_data)\n\nsubmission = pd.DataFrame({\n    'PassengerId': test_data['PassengerId'],\n    'Survived': submission_prediction\n})\n# submission_file_path = '.\/data\/titanic_submission.csv'\nsubmission_file_path = '.\/titanic_submission.csv'\nsubmission.to_csv(submission_file_path, index=False)","2cf7788c":"# Name","4bc58867":"# Lets build model\n\nAs I dont have much of the insight and experience on this yet, but I in progress of learnign. I will not do some complex analysis on this data yet. And I will just try to use regular RandomForest and XGBooster to see what I get out of it.\n\nLets try some quick results on this. I promise, soon I will add some cross-validation and some more tuning of hyperparameters as I see that I am pretty much done with the data analysis itself, maybe I will update some about age and its groups or fare, but not others, I guess.","03978ca6":"# Embarked\n\nThere are some missing values in train data and lets see how these embarkations correlate with surviving","f727a0de":"Here are the 7 folded data CV calculations. I did it on my own and put it down.\n\n7-folded RFC\n\n{'bootstrap': True,\n 'criterion': 'gini',\n 'max_depth': 3,\n 'max_features': 8,\n 'min_samples_split': 2,\n 'n_estimators': 200}\n\n best result: 0.8338945005611672\n\n 7-folded XGB\n\n {'colsample_bylevel': 0.9,\n 'colsample_bytree': 1,\n 'gamma': 9,\n 'max_depth': 4,\n 'min_child_weight': 1,\n 'n_estimators': 20}\n \n best result: 0.8361391694725028","d98b082d":"Lets see how many lonely people survived?","9a2e273d":"# Cabin\n\nLets create new field for people who have cabin and those who dont have cabin.","624d43a0":"Now lets try to improve models by improving hyperparameters","ecf3afd7":"# Initial observation on test and training data <a><\/a>","3f9512ec":"# Data analyzing and cleaning. <a><\/a>\n\n## Pclass\n\nSome graphs have been learned and added from here: https:\/\/www.kaggle.com\/alenavorushilova\/data-analysis-and-data-visualization-seaborn","2abf4814":"As you can see, then some counts are quite big. Will create new feature \"TicketGroupSize\"","8a109244":"At this first update seems like RandomForest does better job than XGBoost, lets see how it works out on submission.","03f8d9c5":"# Sex\n\nSome graphs have been added from here: https:\/\/www.kaggle.com\/alenavorushilova\/data-analysis-and-data-visualization-seaborn","4c5c1da7":"As we can see most likely will survive people with a family of 3. And lets drop SibSp and Parch columns also","77586a51":"Default class: random forest scores:  0.7873134328358209 0.7164179104477613","b3007b9b":"# Ticket\n\nI found this idea in one of the kernels. Will try to look into it. See what comes up. Basically count same tickets, assuming its a group ticket or something","bbb9753d":"Lets see how the average looks now.","7997b3c1":"Lets see how big family owners survived","309a6b2b":"## Cross-validation\n\nLets try to cross validate and get the results for random forests and XGBooster","eaa966bb":"Default XGBooster scores:  0.8246268656716418 0.7614213197969544","fa838986":"# Initilize data <a><\/a>","c5ca89d1":"And lets see the same effect on training set only","0593514c":"Lets see first default model values","a73b90bb":"Lets see how it works on my data as is and then lets try to make a submit and see if and how it works...\n\nNow I will work more on improving the models. And I want to see the improvements. Need to learn more about it now.","a2067d25":"# Age\n\nAs here a lot of values are missing, then needs a little extra to fill in the values in both sets.\n\nFirst lets try to find ages over groups of Embarked, Sex and Pclass. Lets try to distribute it that way, lets see what comes out.","a5407618":"# Data transformation\n\nWe need to change Sex, Embarked and Title values, rest are numerical already. Lets do it.","6b7bafc6":"A little overview of the data from info and description:\n* PassengerId - is required only for result later.\n* Survived - we will use as a result while training the data. Only available in training data. So needs to be separated when training.\n* PcClass - is a numeric field, no need to modify nor deal with empty values as it has all the values.\n* Name - I will try now to get the titles from names and group people according to that.\n* Sex - categorical value, will transform.\n* Age - we need to fill empty values with something. Initially we will figure some logic to do so. Will try to improve the logic here.\n* SibSp and Parch - we will combine into FamilySize feature\n* Ticket - will not give much info, most likely will remove it. Had some ideas from other kernels, will look into it.\n* Fare - might give us some info, but leave it at first. Test is missing one value, most likely mean value will help us out here.\n* Cabin - seems like most people did not have cabins. Will see if PcClass will help us find some correlation here. Maybe some new feature, try to convert it, has cabin or not.\n* Embarked - misses couple of values, needs transformation","374d9b49":"# Titanic competition from beginner to beginner\n## For simplicity I use only Random Forest Classificator and XGBClassificator\n### Feel free to upvote and comment any sections. Also questions are welcome.\n\nI make this notebook as a beginner in DS and kaggle also.\nI try to follow the kaggle micro courses and make improvements in my model in this competition.\nI will edit it bunch of times to make it more nice and to show my ability to learn and improve myself hopefully.\n\nI will not do extra research, I only stick to given data here.\n\nEdit 1: Will oversee some and try to analyze features one by one...\nEdit 2: Trying to use more features and maybe create some from not so good data (Parch and SibSp => FamilySize and Names into Titles and maybe some Categorical into categorigal encoders.) Also will create my own template for EDR. Also will try to create Table of Contents.","b1365f6f":"# SibSp and Parch\n\nI will handle them together and create some new features on them","61ed3252":"# Fare\n\nLets just fill the test_data fare with mean price. This might need some extra work."}}