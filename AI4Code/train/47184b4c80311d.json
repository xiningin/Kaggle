{"cell_type":{"f4ec0c50":"code","282e95f6":"code","5a1524de":"code","0b7ba6bc":"code","f5993c61":"code","fae40d5d":"code","0c82c214":"code","b702163c":"code","4561c5bb":"code","95393c1a":"code","14b40dfa":"code","e1a215ed":"code","c8831a4a":"code","d0cc3db5":"code","7f70efd5":"code","83eaf162":"code","fc07b47c":"code","e8af01ba":"code","ba0d174a":"code","bde65e56":"code","3e229caa":"code","ce58bf52":"code","0210f182":"code","d219e569":"markdown","1569cc9b":"markdown","3e21a269":"markdown","36008aa3":"markdown","7b158d4e":"markdown","4b1f8709":"markdown","b26e269a":"markdown","b03cd4e4":"markdown","a923a5ff":"markdown","5f69af20":"markdown","47cb73aa":"markdown","ed71e304":"markdown","7a39971b":"markdown","d66d85a9":"markdown","10cbeadb":"markdown","cd33e183":"markdown","e2dc5205":"markdown","8e9638f1":"markdown"},"source":{"f4ec0c50":"# Import modules\nimport pandas as pd\nimport numpy as np\nimport seaborn as sns\n\n# Read in dataset\ndf = pd.read_csv('..\/input\/bank-data\/bank_data.csv')\n# Print the first and the last few rows of the DataFrame\ndf.head()\ndf[['recovery_strategy','expected_recovery_amount']].groupby('recovery_strategy').min()\n\n\n","282e95f6":"import matplotlib.pyplot as plt\ndf.drop(columns=['id'],inplace=False).hist(bins=50, figsize=(20,15))","5a1524de":"plt.scatter(x=df[\"expected_recovery_amount\"], y=df[\"age\"], c=\"g\", s=2)\nplt.xlim(900, 1100)\nplt.ylim(0, 60)\nplt.xlabel(\"Expected Recovery Amount\")\nplt.ylabel(\"Age\")\nplt.legend(loc=2)\nplt.show()","0b7ba6bc":"sns.boxplot(x='age', y='recovery_strategy',data=df)","f5993c61":"from scipy import stats\n\n# Compute average age just below and above the threshold\nera_900_1100 = df.loc[(df['expected_recovery_amount']<1100) & (df['expected_recovery_amount']>=900)]\nby_recovery_strategy = era_900_1100.groupby(['recovery_strategy'])\nby_recovery_strategy['age'].describe() \n\n\n\n","fae40d5d":"era_900_1100.drop(columns=['id'],inplace=False).hist(bins=80, figsize=(20,15))","0c82c214":"# Perform Kruskal-Wallis test \nLevel_0_age = era_900_1100.loc[df['recovery_strategy']==\"Level 0 Recovery\"]['age']\nLevel_1_age = era_900_1100.loc[df['recovery_strategy']==\"Level 1 Recovery\"]['age']\nstats.kruskal(Level_0_age,Level_1_age)\n","b702163c":"# Number of customers in each category\ncrosstab = pd.crosstab(df.loc[(df['expected_recovery_amount']<1100) & (df['expected_recovery_amount']>=900)]['sex'], \n                       df['recovery_strategy'])\n\nprint(crosstab)\nchi2_stat, p_val, dof, ex = stats.chi2_contingency(crosstab)\nprint(p_val)\n","4561c5bb":"sns.regplot(x='expected_recovery_amount', y = 'actual_recovery_amount', data=df)","95393c1a":"import statsmodels.api as sm\nimport statsmodels.formula.api as smf\nresults = smf.ols('actual_recovery_amount ~ expected_recovery_amount', data=df).fit()\nresults.summary()","14b40dfa":"\n# Compute average actual recovery amount just below and above the threshold\nby_recovery_strategy['actual_recovery_amount'].describe()\n","e1a215ed":"# Perform Kruskal-Wallis test\nLevel_0_actual = era_900_1100.loc[df['recovery_strategy']=='Level 0 Recovery']['actual_recovery_amount']\nLevel_1_actual = era_900_1100.loc[df['recovery_strategy']=='Level 1 Recovery']['actual_recovery_amount']\nstats.kruskal(Level_0_actual,Level_1_actual) \n","c8831a4a":"# Repeat for a smaller range of $950 to $1050\nera_950_1050 = df.loc[(df['expected_recovery_amount']<1050) & \n                      (df['expected_recovery_amount']>=950)]\nLevel_0_actual = era_950_1050.loc[df['recovery_strategy']=='Level 0 Recovery']['actual_recovery_amount']\nLevel_1_actual = era_950_1050.loc[df['recovery_strategy']=='Level 1 Recovery']['actual_recovery_amount']\n# ... YOUR CODE FOR TASK 6 ...\nstats.kruskal(Level_0_actual,Level_1_actual)","d0cc3db5":"# Create indicator (0 or 1) for expected recovery amount >= $1000\ndf['indicator_1000'] = np.where(df['expected_recovery_amount']<1000, 0, 1)\ndf\n","7f70efd5":"sns.residplot(era_900_1100['expected_recovery_amount'], era_900_1100['actual_recovery_amount'])","83eaf162":"era_900_1100 = df.loc[(df['expected_recovery_amount']<1100) & \n                      (df['expected_recovery_amount']>=900)]\n\n# Define X and y\nX = era_900_1100['expected_recovery_amount']\ny = era_900_1100['actual_recovery_amount']\nX = sm.add_constant(X)\n\n# Build linear regression model\nmodel = sm.OLS(y,X).fit()\nYpred = model.predict(X)\n\n# Print the model summary\n# ... YOUR CODE FOR TASK 8 ...\nmodel.summary()\n","fc07b47c":"ax1=sns.distplot(y, hist=False, color='r', label = 'Actual Value')\nsns.distplot(Ypred, hist=False, color='b', label='Fitted Value', ax=ax1)","e8af01ba":"\nfig, ax = plt.subplots(figsize=(8,6))\n\nax.plot(era_900_1100['expected_recovery_amount'], y, 'o', label=\"Data\")\nax.plot(era_900_1100['expected_recovery_amount'], Ypred, 'b-', label=\"Predicted\")\n\nlegend = ax.legend(loc=\"best\")","ba0d174a":"from  sklearn.metrics import mean_squared_error\n\nmean_squared_error(y,Ypred)","bde65e56":"era_900_1100 = df.loc[(df['expected_recovery_amount']<1100) & \n                      (df['expected_recovery_amount']>=900)]\n\n# Define X and y\nX = era_900_1100[['expected_recovery_amount','indicator_1000']]\ny = era_900_1100['actual_recovery_amount']\nX = sm.add_constant(X)\n\n# Build linear regression model\nmodel = sm.OLS(y,X).fit()\nYpred = model.predict(X)\n\n# Print the model summary\n# ... YOUR CODE FOR TASK 8 ...\nmodel.summary()","3e229caa":"ax1=sns.distplot(y, hist=False, color='r', label = 'Actual Value')\nsns.distplot(Ypred, hist=False, color='b', label='Fitted Value', ax=ax1)\n\n","ce58bf52":"\nfig, ax = plt.subplots(figsize=(8,6))\n\nax.plot(era_900_1100['expected_recovery_amount'], y, 'o', label=\"Data\")\nax.plot(era_900_1100['expected_recovery_amount'], Ypred, 'b-', label=\"Predicted\")\n\nlegend = ax.legend(loc=\"best\")","0210f182":"from  sklearn.metrics import mean_squared_error\n\nmean_squared_error(y,Ypred)","d219e569":"We expect that there is a positive covariance between the actual recovery amount and the expected recovery amount, therefore, we will build two model. The first one is the linear model without threshold. We first plot model without threshold for the whole data.","1569cc9b":"Since the pvalue is so big (>0.05) that the data provide strong evidence to accept the Null hyothesis (H0) that there is no discontinity in the age across the Level of Recovery strategy.","3e21a269":"A liltle review on this project: \nWhy we do not use the whole data to analyze but just a range of data with expected recovery amount from 900 to 1100: \n- The whole data is a big number of entries, so that our conventional statistic models are more likely to reject the null hypothesis, especially for the KrussalResult, the Chi-square test when we depend on the p_value to reject or accept the Null Hypothesis.\n- The whole data is not exactly normal distribution, a prerequisite condition to perform statistical test.\n- For more objective conclusion, we might be able to test a range of data with expected recovery amount of another the range just below and above the threshold of level 1 strategy, say threshold=2000.","36008aa3":"The means of age in the 5 recovery strategy do not seem to vary so large according to the plot, then, we set the null Hypothesis of the KruskalResult to test whether there is variability in the sample means so large that it seems unlikely to be from chance alone.","7b158d4e":"We can see a discontinuity in the actual value at the threshold=1000, and the MSE=63821,479 which is smaller than 68806.517, which proves that the data is more fit in the second model. In the second model, the coef of indicator_1000\n=277.6344, which means the cost at 50 dollars to gain the jump of 278 dollars is worth.","4b1f8709":"The statistics above provide an inference that there is actually a difference in the means of actual recovery amount across the two level recovery strategy, in other words, there is a discontinuity in the means of the actual recovery amount in the two level.","b26e269a":"The closer look to the data with the KrusalResult for data in a more narrow range of 950 and 1050 to see whether the two statistics are consistent.","b03cd4e4":"The p_value is significantly statistical that we accept Ho(null hypothesis) that there is no difference in the sex proportion across the strategy recovery","a923a5ff":"This is the resid between the actual value and the fitted value, we can see that the residual is independent of the X variable, which proves that we can perform the simple regression model.","5f69af20":"To get closer look to the data, we make a test to answer the question whether there is a discontinuity in the actual recovery amount just below and above the threshold 1000 for the data in the range of 900 to 1100.","47cb73aa":"Since the data given is just a sample drawn from the population, we want to make sure that whether there is a jump in the expected recovery due to the factor of age, say, whether the age distribution differs in every recovery strategy, or it is in a normal distribution, independent with the recovery strategy.","ed71e304":"The covariance between expected recovery amount and actual amount can be seen in the below regplot.","7a39971b":"The second window is the OLS regression with a threshold=1000 for data in range of 900 to 1100 in the actual recovery amount.","d66d85a9":"The following codes describe the data with threshold=1000 with additional indicator.","10cbeadb":"The first window is the OLS regression without threshold for data in range of 900 to 1100.","cd33e183":"The summary above provides the fact that there is a positive covariance between the actual recovery amount and the expected recovery amount, with the coefficent of the expected recovery amount is positive and significantly statistical.","e2dc5205":"The distribution of each set of  numerical variables","8e9638f1":"After a debt has been legally declared \"uncollectable\" by a bank, the account is considered \"charged-off.\" But that doesn't mean the bank walks away from the debt. They still want to collect some of the money they are owed. The bank will score the account to assess the expected recovery amount, that is, the expected amount that the bank may be able to receive from the customer in the future. This amount is a function of the probability of the customer paying, the total debt, and other factors that impact the ability and willingness to pay.\n\nThe bank has implemented different recovery strategies at different thresholds (1000 dollars, 2000 dollars, etc.) where the greater the expected recovery amount, the more effort the bank puts into contacting the customer. For low recovery amounts (Level 0), the bank just adds the customer's contact information to their automatic dialer and emailing system. For higher recovery strategies, the bank incurs more costs as they leverage human resources in more efforts to obtain payments. Each additional level of recovery strategy requires an additional 50 dollars per customer so that customers in the Recovery Strategy Level 1 cost the company 50 dollars more than those in Level 0. Customers in Level 2 cost 50 dollars more than those in Level 1, etc.\n\n\nThe question is whether the extra amount of the actual recovery amount worth the bank cost, say, In other words, was there a jump (also called a \"discontinuity\") of more than 50 dollars in the amount recovered at the higher strategy level? We'll find out in this notebook.\nFirst, we discover the data."}}