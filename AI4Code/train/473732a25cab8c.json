{"cell_type":{"a37231fe":"code","ed842bd9":"code","c15a4ac3":"code","a0cc0e76":"code","d87b1027":"code","2ceda8cd":"code","ca9581ac":"code","9d961193":"markdown","e7c332a8":"markdown","13b7957e":"markdown","1ac8366a":"markdown","878f82fe":"markdown"},"source":{"a37231fe":"import os\nimport gc\n\nimport numpy as np\nimport pandas as pd\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\n%matplotlib notebook\n\nfrom tqdm.auto import tqdm","ed842bd9":"for dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\ndata = pd.read_csv('..\/input\/beat-the-bookie-worldwide-football-dataset\/closing_odds.csv.gz', compression='gzip', sep=',', quotechar='\"')\nprint('Reading completed. Total rows {}'.format(len(data)))","c15a4ac3":"print(data.shape)\ndata.head(2)","a0cc0e76":"odds = data[[\"avg_odds_home_win\",\"avg_odds_draw\",\"avg_odds_away_win\"]].values\nexpectation = list()\nfor x in odds:\n    p = 1\/(1\/x[0]+1\/x[1]+1\/x[2])\n    expectation.append(p)\n\nhouse_edge = 1-np.average(expectation)\nhouse_edge","d87b1027":"_data = data.copy()\n_data[\"home_win\"] = _data[\"avg_odds_home_win\"]\n_data.loc[_data[\"home_score\"] <= _data[\"away_score\"], \"home_win\"] = 0\n_data[\"home_win_prob\"] = 1\n_data.loc[_data[\"home_score\"] <= _data[\"away_score\"], \"home_win_prob\"] = 0\n_data[\"decimal_home_odds\"] = _data[\"avg_odds_home_win\"].round(2)\ncount = _data.copy().groupby([\"decimal_home_odds\"]).count()[_data.columns[0]]\nhome_win_df = _data[[\"decimal_home_odds\", \"home_win\", \"home_win_prob\"]].groupby([\"decimal_home_odds\"]).mean()\nhome_win_df[(1 < home_win_df.index)&(home_win_df.index < 10)][\"home_win\"].plot(figsize=(15, 3), grid=True, legend=True)\nplt.show()\nhome_win_df[(1 < home_win_df.index)&(home_win_df.index < 2)][\"home_win\"].plot(figsize=(15, 3), grid=True, legend=True)\nplt.show()\nhome_win_df[(1 < home_win_df.index)&(home_win_df.index < 10)][\"home_win_prob\"].plot(figsize=(15, 3), grid=True, legend=True)","2ceda8cd":"plt.hist([round(x, 0) for x in home_win_df[(home_win_df[\"home_win\"] > 1-house_edge) & (count > 200)][\"home_win\"].index])","ca9581ac":"_data = data.copy()\n_data[\"away_win\"] = _data[\"avg_odds_away_win\"]\n_data.loc[_data[\"away_score\"] <= _data[\"home_score\"], \"away_win\"] = 0\n_data[\"away_win_prob\"] = 1\n_data.loc[_data[\"away_score\"] <= _data[\"home_score\"], \"away_win_prob\"] = 0\n_data[\"decimal_away_odds\"] = _data[\"avg_odds_away_win\"].round(2)\naway_win_df = _data[[\"decimal_away_odds\", \"away_win\", \"away_win_prob\"]].groupby([\"decimal_away_odds\"]).mean()\naway_win_df[(1 < away_win_df.index)&(away_win_df.index < 10)][\"away_win\"].plot(figsize=(15, 3), grid=True, legend=True)\nplt.show()\naway_win_df[(1 < away_win_df.index)&(away_win_df.index < 2)][\"away_win\"].plot(figsize=(15, 3), grid=True, legend=True)\nplt.show()\naway_win_df[(1 < away_win_df.index)&(away_win_df.index < 10)][\"away_win_prob\"].plot(figsize=(15, 3), grid=True, legend=True)","9d961193":"# Conclusion\n\nThe less the odds are, the more the expectation is.\n\nAs we know that house edge is almost 10%, so if there is a house edge that lower than 10%, we might be able to take advantage in the low odds without watching a game.\n\nHowever, it's going to be quite risky when you bet too much on the side of low odds due to extreme imbalance of odds.\n\nFor example, if you bet 100USD on side A with the odds of 1.1, you get 10USD profit when you win, however lose 100USD when you lose.\n\nNext step is to use Kelly criterion with bernui trial.","e7c332a8":"# What we research in this notebook\n\n- Check house edge in the dataset\n\n- odds imbalance vs expectation\n\n- odds imbalance vs winning probability\n\nAgenda:\n\n1. Imports & Loads data\n\n2. Research\n\n3. Conclusion\n","13b7957e":"# Calculate House Edge\n\nTheoretically, the expectation of three outcomes ($:= E$) can be calculated as followings.\n\n$$E = \\frac{1}{\\frac{1}{o_1}+\\frac{1}{o_2}+\\frac{1}{o_3}}$$\n\nWhere\n$o_1$ : odds of home\n$o_2$ : odds of draw\n$o_3$ : odds of away\n\nSo the house edge should be $1-E$.\n\nThe code in the next cell which shows 0.09591... means house edge is 9.59%. \n\nSo if you bet 100USD on these games, an average of payoff is 90.49USD.","1ac8366a":"## Research\n\nHere we research as followings:\n\n- odds imbalance vs expectation\n\n- odds imbalance vs winning probability\n\nMethodology:\n\n- Round odds to the second decimal place and aggregate the data","878f82fe":"## Imports & Load Data"}}