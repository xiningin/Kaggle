{"cell_type":{"a3b1d15f":"code","f3d936e1":"code","40993f4d":"code","f08c93ff":"code","112b413c":"code","61cb098e":"code","193cf536":"code","6527d398":"code","ca1d6540":"code","87ac7b58":"code","78effca0":"code","80dc1b55":"code","fdd3e826":"code","0cc75bd9":"code","4f7f65f2":"code","0f72eb92":"code","ca875743":"code","f27bab0f":"code","518daa7d":"markdown","32166b9d":"markdown","f14d2c44":"markdown"},"source":{"a3b1d15f":"import pandas as pd\nimport numpy as np\npd.set_option(\"display.max_columns\", 100)\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly.express as px","f3d936e1":"df_train = pd.read_csv(\"..\/input\/data-science-autumn-2021\/train.csv\")\ndf_test = pd.read_csv(\"..\/input\/data-science-autumn-2021\/test.csv\")","40993f4d":"df_train[\"latitude_f1\"] = df_train[[\"latitude\"]].round(1)\ndf_train[\"longitude_f1\"] = df_train[[\"longitude\"]].round(1)\ndf_test[\"latitude_f1\"] = df_test[[\"latitude\"]].round(1)\ndf_test[\"longitude_f1\"] = df_test[[\"longitude\"]].round(1)","f08c93ff":"df_train[\"latitude_f2\"] = df_train[[\"latitude\"]].round(2)\ndf_train[\"longitude_f2\"] = df_train[[\"longitude\"]].round(2)\ndf_test[\"latitude_f2\"] = df_test[[\"latitude\"]].round(2)\ndf_test[\"longitude_f2\"] = df_test[[\"longitude\"]].round(2)","112b413c":"df_mean = df_train[[\"latitude_f1\",\"longitude_f1\",\"latestPrice\"]].groupby([\"latitude_f1\",\"longitude_f1\"], as_index=False).mean()\ndf_mean.rename(columns={'latestPrice': 'lat_long_1_latestPrice'}, inplace=True)\ndf_mean","61cb098e":"df_mean2 = df_train[[\"latitude_f2\",\"longitude_f2\",\"latestPrice\"]].groupby([\"latitude_f2\",\"longitude_f2\"], as_index=False).mean()\ndf_mean2.rename(columns={'latestPrice': 'lat_long_2_latestPrice'}, inplace=True)\ndf_mean2","193cf536":"df_train = pd.merge(df_train, df_mean, on=[\"latitude_f1\",\"longitude_f1\"], how='left')\ndf_train = pd.merge(df_train, df_mean2, on=[\"latitude_f2\",\"longitude_f2\"], how='left')\ndf_train.head(3)","6527d398":"df_test = pd.merge(df_test, df_mean, on=[\"latitude_f1\",\"longitude_f1\"], how='left')\ndf_test = pd.merge(df_test, df_mean2, on=[\"latitude_f2\",\"longitude_f2\"], how='left')\ndf_test['lat_long_1_latestPrice'] = df_test['lat_long_1_latestPrice'].fillna(df_test['lat_long_1_latestPrice'].median())\ndf_test['lat_long_2_latestPrice'] = df_test['lat_long_2_latestPrice'].fillna(df_test['lat_long_2_latestPrice'].median())\ndf_test.head(3)","ca1d6540":"def visualize_trafic(df, name_=\"latestPrice\",zoom=9):\n    fig = px.scatter_mapbox(df,\n                            \n                            # Here, plotly gets, (x,y) coordinates\n                            lat=\"latitude\",\n                            lon=\"longitude\",\n                            \n                            #Here, plotly detects color of series\n                            color=name_,\n                            labels=name_,\n                            zoom=zoom,\n                            height=600,\n                            width=800)\n    fig.update_layout(mapbox_style='stamen-terrain')\n    fig.update_layout(margin={\"r\": 0, \"t\": 0, \"l\": 0, \"b\": 0})\n    fig.update_layout(title_text=\"GPS trafic\")\n    fig.show()","87ac7b58":"# (\u53c2\u8003)\u5143\u306e\u7def\u5ea6\u7d4c\u5ea6\u5358\u4f4d\ndf_train_trim = df_train[df_train.latestPrice <= df_train.latestPrice.quantile(0.95)]\nvisualize_trafic(df_train_trim)","78effca0":"# \u7def\u5ea6\u7d4c\u5ea6\u5358\u4f4d(\u5c11\u6570\u7b2c\u4e00\u4f4d\u307e\u3067)\nvisualize_trafic(df_train, name_=\"lat_long_1_latestPrice\")","80dc1b55":"# \u7def\u5ea6\u7d4c\u5ea6\u5358\u4f4d(\u5c11\u6570\u7b2c\u4e8c\u4f4d\u307e\u3067)\ndf_train_trim_2 = df_train[df_train.lat_long_2_latestPrice <= df_train.lat_long_2_latestPrice.quantile(0.95)]\nvisualize_trafic(df_train_trim_2, name_=\"lat_long_2_latestPrice\")","fdd3e826":"from sklearn.preprocessing import scale\nfrom sklearn.cluster import KMeans","0cc75bd9":"#\u30e2\u30c7\u30eb\u306e\u4f5c\u6210 \nmodel = KMeans(n_clusters=10,random_state=1234)\n#\u30c7\u30fc\u30bf\u3092\u6b63\u898f\u5316\u3057\u3001fit\u95a2\u6570\u306b\u3088\u308a\u8a13\u7df4\u3092\u5b9f\u65bd\nmodel = model.fit(scale(df_train[['latitude','longitude','lat_long_2_latestPrice']]))\ndf_model = pd.DataFrame(model.labels_)\ndf_train[\"cluster_id\"] = df_model","4f7f65f2":"df_train['cluster_id'].value_counts()","0f72eb92":"# \u30af\u30e9\u30b9\u30bf\nvisualize_trafic(df_train, name_=\"cluster_id\")","ca875743":"pred = model.predict(scale(df_test[['latitude','longitude','lat_long_2_latestPrice']])) # \u8a08\u7b97\u7d50\u679c\u304b\u3089\u30b5\u30f3\u30d7\u30eb\u30c7\u30fc\u30bf\u304c\u3069\u306e\u30af\u30e9\u30b9\u30bf\u306b\u5c5e\u3059\u308b\u304b\u3092\u8fd4\u3059\ndf_test['cluster_id'] = pred\ndf_test.head(3)","f27bab0f":"# \u30af\u30e9\u30b9\u30bf\nvisualize_trafic(df_test, name_=\"cluster_id\")","518daa7d":"# \u2461\u7def\u5ea6\u30fb\u7d4c\u5ea6\u30fb\u4fa1\u683c\u306e3\u6b21\u5143\u3067\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0","32166b9d":"### \u5730\u56f3\u4e0a\u3067\u307f\u3066\u307f\u307e\u3059","f14d2c44":"# \u2460\u7def\u5ea6\u30fb\u7d4c\u5ea6\u6bce\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u30bf\u30fc\u30b2\u30c3\u30c8\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0"}}