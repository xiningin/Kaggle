{"cell_type":{"9912c5a0":"code","710aa26f":"code","5aa0f3d0":"code","53701286":"code","df429606":"code","9905f77c":"code","15e0ab62":"code","615549c5":"code","d2b635b0":"code","e4da9938":"code","6d1106ce":"code","8bff8937":"code","f82aa5fa":"code","bbd10bca":"code","f73f6519":"code","b8a96995":"code","6ca36bda":"markdown","e7a3abf0":"markdown","b1a35ed9":"markdown","d34e8920":"markdown","fce38321":"markdown","3e318d34":"markdown","08a9c286":"markdown","e881046b":"markdown","b60f5453":"markdown","99de03dc":"markdown"},"source":{"9912c5a0":"import numpy as np\nfrom __future__ import division\nimport random\nfrom keras.callbacks import History \nfrom keras.layers import Dense, Activation, Flatten, Conv2D, Lambda\nfrom keras.layers import MaxPooling2D, Dropout, BatchNormalization\nfrom keras.utils import print_summary\nfrom keras.models import Sequential\nfrom keras.callbacks import ModelCheckpoint\nfrom keras.callbacks import EarlyStopping\nfrom keras.optimizers import Adam\nimport keras.backend as K\nimport pickle\nimport csv\nimport cv2\nimport os\nimport numpy as np\nimport scipy\nimport pickle\nimport matplotlib.pyplot as plt\nfrom itertools import islice\nimport warnings\nimport pandas as pd\nimport tensorflow as tf\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.utils import shuffle\nfrom keras.models import load_model\nimport keras.utils\n\n#For Visualizations\nfrom scipy.stats import norm, skew\nimport matplotlib\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n# Any results you write to the current directory are saved as output.","710aa26f":"print(os.listdir('..\/input\/self driving car training data\/data'))","5aa0f3d0":"features_directory = '..\/input\/self driving car training data\/data\/'\nlabels_file = '..\/input\/self driving car training data\/data\/driving_log.csv'","53701286":"def image_preprocessing(img):\n    resized_image = cv2.resize((cv2.cvtColor(img, cv2.COLOR_RGB2HSV))[:, :, 1], (40, 40))\n    return resized_image","df429606":"def Load_training(delta):\n    logs = []\n    features = []\n    labels = []\n    with open(labels_file, 'rt') as f:\n        reader = csv.reader(f)\n        for line in reader:\n            logs.append(line)\n        log_labels = logs.pop(0)\n\n    for i in range(len(logs)):\n        for j in range(3):\n            img_path = logs[i][j]\n            img_path = features_directory + 'IMG' + (img_path.split('IMG')[1]).strip()\n            img = plt.imread(img_path)\n            features.append(image_preprocessing(img))\n            if j == 0:\n                labels.append(float(logs[i][3]))\n            elif j == 1:\n                labels.append(float(logs[i][3]) + delta)\n            else:\n                labels.append(float(logs[i][3]) - delta)\n    return features, labels","9905f77c":"delta = 0.2\nfeatures, labels = Load_training(delta)\n\nfeatures = np.array(features).astype('float32')\nlabels = np.array(labels).astype('float32')\n\nwith open(\"features\", \"wb\") as f:\n    pickle.dump(features, f, protocol=4)\nwith open(\"labels\", \"wb\") as f:\n    pickle.dump(labels, f, protocol=4)","15e0ab62":"features.shape","615549c5":"labels.shape","d2b635b0":"import warnings\nimport pandas as pd\n\nwarnings.filterwarnings('ignore')\n\npan = pd.Panel(features)\ndf = pan.swapaxes(1, 2).to_frame()\ndf.index = df.index.droplevel('major')\ndf.index = df.index+1","e4da9938":"import gc\ndf.shape","6d1106ce":"%matplotlib inline\nplt.style.use('seaborn')\n\nplt.figure(figsize=(16,6))\nplt.title(\"Distribution of Skewness values per column in the Data set\")\nsns.distplot(df.skew(axis=0),color=\"blue\", kde=True,bins=120, label='train')\nplt.legend()\nplt.show()","8bff8937":"%matplotlib inline\nplt.style.use('seaborn')\n\nplt.figure(figsize=(16,6))\nplt.title(\"Distribution of Kurtosis values per column in the Data set\")\nsns.distplot(df.kurtosis(axis=0),color=\"green\", kde=True,bins=120, label='train')\nplt.legend()\nplt.show()","f82aa5fa":"def keras_model():\n    \n    model = Sequential()\n    model.add(Lambda(lambda x: x \/ 127.5 - 1., input_shape=(40, 40, 1)))\n\n    model.add(Conv2D(32, (3, 3), padding='same'))\n    model.add(Activation('relu'))\n    \n    model.add(Conv2D(32, (3, 3), padding='same'))\n    model.add(Activation('relu'))\n    model.add(MaxPooling2D((2, 2), padding='valid'))\n\n    model.add(Conv2D(64, (3, 3), padding='same'))\n    model.add(Activation('relu'))\n    \n    model.add(Conv2D(64, (3, 3), padding='same'))\n    model.add(Activation('relu'))\n    model.add(MaxPooling2D((2, 2), padding='valid'))\n\n    model.add(Conv2D(128, (3, 3), padding='same'))\n    model.add(Activation('relu'))\n    model.add(MaxPooling2D((2, 2), padding='valid'))\n    \n    model.add(Conv2D(128, (3, 3), padding='same'))\n    model.add(Activation('relu'))\n    model.add(MaxPooling2D((2, 2), padding='valid'))\n\n    model.add(Flatten())\n    model.add(Dropout(0.5))\n    \n    model.add(BatchNormalization())\n    model.add(Dense(512))\n    model.add(Dense(256))\n    model.add(Dense(64))\n    model.add(Dense(1))\n    \n    model.compile(optimizer=Adam(lr=0.0001), loss=\"mse\")\n    model.summary()\n    return model","bbd10bca":"def loadFromPickle():\n    with open(\"features\", \"rb\") as f:\n        features = np.array(pickle.load(f))\n    with open(\"labels\", \"rb\") as f:\n        labels = np.array(pickle.load(f))\n    return features, labels\n\ndef augmentData(features, labels):\n    features = np.append(features, features[:, :, ::-1], axis=0)\n    labels = np.append(labels, -labels, axis=0)\n    return features, labels","f73f6519":"warnings.filterwarnings('ignore')\n\nfeatures, labels = loadFromPickle()\nfeatures, labels = shuffle(features, labels)\n\n#do a Train Test Split\ntrain_x, val_x, train_y, val_y = train_test_split(features, labels, random_state=42, test_size=0.20)\n\ntrain_x = train_x.reshape(train_x.shape[0], 40, 40, 1)\nval_x = val_x.reshape(val_x.shape[0], 40, 40, 1)\n\nmodel = keras_model()\nfilepath = \".\/SelfDriving.h5\"\n\nes = EarlyStopping(monitor='val_loss', verbose=1)\ncheckpoint = ModelCheckpoint(filepath, verbose=1,monitor='val_loss', save_best_only=True)\nhist = History()\ncallbacks_list = [es,checkpoint,hist]\n    \nmodel.fit(train_x, train_y, validation_data=(val_x, val_y), epochs=10, batch_size=32,callbacks=callbacks_list)\n\nprint_summary(model)\n\nmodel.save(filepath)","b8a96995":"plt.plot(hist.history['loss'])\nplt.plot(hist.history['val_loss'])\nplt.title('Model Loss')\nplt.ylabel('Loss')\nplt.xlabel('Epochs')\nplt.legend(['train', 'validation'])\nplt.show()","6ca36bda":"<pre><b><a id = 4>Serialize and Augment the Data<\/b><\/a><\/pre>","e7a3abf0":"<pre><b><a id = 6>Evaluating the Model Performance<\/b><\/a><\/pre>","b1a35ed9":"<pre><b><a id = 2>Load the Training Data<\/b><\/a><\/pre>","d34e8920":"<pre><b><a id = 22>Distribution of Kurtosis values per row in the Dataset<\/b><\/a><\/pre>","fce38321":"<pre><b><a id = 5>Fit The Training Data<\/b><\/a><\/pre>\n","3e318d34":"<pre><b><a id = 21>Distribution of Skewness values per column in the Dataset<\/b><\/a><\/pre>","08a9c286":"<b><a id = 1><pre>Import Packages<\/pre><\/a><\/b>","e881046b":"<pre><b><a id = 3>Create Sequential Model<\/b><\/a><\/pre>\n<b><pre>Reference to the Orginal Paper <a href = \"https:\/\/images.nvidia.com\/content\/tegra\/automotive\/images\/2016\/solutions\/pdf\/end-to-end-dl-using-px.pdf\" target=\"_blank\">Click Here <\/a><\/pre><\/b>","b60f5453":"<html>\n    <body>\n         <img src = \"https:\/\/upload.wikimedia.org\/wikipedia\/commons\/1\/16\/Driver_free_car.jpg\" >\n        <br\/>\n        <p>\nWe all know Self Driving Cars is one of the hottest areas of research and business for the tech giants. What seemed like a science-fiction, a few years ago, now seems more like  something which is soon to become a part and parcel of our regular life. Companies like Tesla, Nissan, Cadillac do have self-driving car assistance software, but, they still require a human to keep an eye on the road and take control when needed. However, it is fascinating to see how far we have come in terms of innovation and how fast technology is advancing. So much so, that now, with the help of basic deep learning, neural network magic, we can build our own pipeline for autonomous driving using Deep Learning Methodologies.<\/p>\n        <pre>\n<a id = \"main\"><b>Contents<\/b><\/a>\n<a href = \"#1\"><b> - Import Packages<\/b><\/a>\n<a href = \"#2\"><b> - Load the Training Data<\/b><\/a>\n<a href = \"#21\"><b> - Distribution of Skewness values per column in the Dataset<\/b><\/a>\n<a href = \"#22\"><b> - Distribution of Kurtosis values per row in the Dataset<\/b><\/a>\n<a href = \"#3\"><b> - Create Sequential Model<\/b><\/a>\n<a href = \"#4\"><b> - Serialize and Augment the Data<\/b><\/a>\n<a href = \"#5\"><b> - Fit The Training Data<\/b><\/a>\n<a href = \"#6\"><b> - Evaluating the Model Performance<\/b><\/a>\n<\/pre>\n    <\/body>\n<\/html>","99de03dc":"<pre><b>I used Panel to convert the X and Y into Data Frames to perform 2-D Visualizations<\/pre><\/b>"}}