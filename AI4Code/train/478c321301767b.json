{"cell_type":{"1c096b61":"code","bd5a188f":"code","53914bdc":"code","88d06848":"code","4d2c4652":"code","40f7b8c9":"code","2aad3aad":"code","a8ffa8c4":"code","4e7d6497":"code","32dc8769":"code","a9b561e4":"code","0d76c5cb":"code","ac33197d":"code","a4a299e7":"code","0c4ae810":"code","2a8e6a8f":"code","a4d7e797":"code","6d4dc239":"code","9f3a2474":"code","de2882db":"code","3e3940d8":"code","9bbcd1d3":"markdown","f3ae1b50":"markdown","07d1074f":"markdown"},"source":{"1c096b61":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","bd5a188f":"from tensorflow.python.keras.applications import ResNet50\nfrom tensorflow.python.keras.models import Sequential\nfrom tensorflow.python.keras.layers import Dense, Flatten, GlobalAveragePooling2D, Activation, Flatten, Dropout, BatchNormalization\n\nimport h5py","53914bdc":"traindf=pd.read_csv('..\/input\/dog-breed-identification\/labels.csv')\ntestdf=pd.read_csv('..\/input\/dog-breed-identification\/sample_submission.csv')","88d06848":"\n\ntraindf.isnull().values.any()\n\n","4d2c4652":"import matplotlib.pyplot as plt\nplt.figure(figsize=(13, 6))\ntraindf['breed'].value_counts().plot(kind='bar')\nplt.show()","40f7b8c9":"def class_percentages(labels):\n    class_map={}\n    for i in labels:\n        if str(i) not in class_map:\n            class_map[str(i)]=1\n        else:\n            class_map[str(i)]+=1\n    #     print(class_map)\n    return class_map\n\np=class_percentages(traindf.breed.values)\n# print(p)\n# for i in p.items():\n#     print(i)\n\nprint(\"Class with maximum images-\"+str(max(p, key=p.get))+\"  \"+str(p[max(p, key=p.get)]))\nprint(\"Class with maximum images-\"+str(min(p,key=p.get)) +\"  \"+str(p[min(p, key=p.get)]))\n\n","2aad3aad":"traindf = traindf[:2000]\ntraindf.shape","a8ffa8c4":"num_classes = 120\nresnet_weights_path = '..\/input\/resnet50\/resnet50_weights_tf_dim_ordering_tf_kernels_notop.h5'\n\nmy_new_model = Sequential()\nmy_new_model.add(ResNet50(include_top=False, pooling='avg', weights=resnet_weights_path))\nmy_new_model.add(Dense(512))\nmy_new_model.add(Activation('relu'))\nmy_new_model.add(Dropout(0.5))\nmy_new_model.add(Dense(num_classes, activation='softmax'))\n\n# Say not to train first layer (ResNet) model. It is already trained\nmy_new_model.layers[0].trainable = False\n\nmy_new_model.compile(optimizer='sgd', loss='categorical_crossentropy', metrics=['accuracy'])\n\n","4e7d6497":"from tensorflow.python.keras.applications.resnet50 import preprocess_input\nfrom tensorflow.python.keras.preprocessing.image import ImageDataGenerator\n\nimage_size = 224\ndatagen = ImageDataGenerator(preprocessing_function=preprocess_input, \n                             rescale=1.\/255.,\n                             horizontal_flip=True,\n                             width_shift_range = 0.2,\n                             height_shift_range = 0.2,\n                             validation_split=0.1)","32dc8769":"train_generator=datagen.flow_from_dataframe(\n                        dataframe=traindf,\n                        directory=\"..\/input\/dog-breed-identification\/train\/\",\n                        x_col=\"id\",\n                        y_col=\"breed\",\n                        has_ext=False,\n                        subset=\"training\",\n                        batch_size=32,\n                        seed=50,\n                        shuffle=True,\n                        class_mode=\"categorical\",\n                        target_size=(image_size, image_size))","a9b561e4":"valid_generator=datagen.flow_from_dataframe(\n                        dataframe=traindf,\n                        directory=\"..\/input\/dog-breed-identification\/train\/\",\n                        x_col=\"id\",\n                        y_col=\"breed\",\n                        has_ext=False,\n                        subset=\"validation\",\n                        batch_size=1,\n                        seed=42,\n                        shuffle=True,\n                        class_mode=\"categorical\",\n                        target_size=(image_size, image_size))","0d76c5cb":"test_datagen=ImageDataGenerator(preprocessing_function=preprocess_input,rescale=1.\/255.)\n\ntest_generator=test_datagen.flow_from_dataframe(\n                            dataframe=testdf,\n                            directory=\"..\/input\/dog-breed-identification\/test\/\",\n                            x_col=\"id\",\n                            y_col=None,\n                            has_ext=False,\n                            batch_size=1,\n                            seed=42,\n                            shuffle=False,\n                            class_mode=None,\n                            target_size=(image_size, image_size))\n\n","ac33197d":"STEP_SIZE_TRAIN=train_generator.n\nSTEP_SIZE_VALID=valid_generator.n\n\nprint(STEP_SIZE_TRAIN)\nprint(STEP_SIZE_VALID)","a4a299e7":"my_new_model.fit_generator(generator=train_generator,\n                    steps_per_epoch=STEP_SIZE_TRAIN,\n                    validation_data=valid_generator,\n                    validation_steps=STEP_SIZE_VALID,\n                    epochs=3\n)","0c4ae810":"my_new_model.evaluate_generator(generator=valid_generator)","2a8e6a8f":"test_generator.reset()\npred=my_new_model.predict_generator(test_generator,verbose=1)","a4d7e797":"my_new_model.save(\"CNNModel.h5\")","6d4dc239":"labels = (train_generator.class_indices)\nlabels = list(labels.keys())\ndf = pd.DataFrame(data=pred,\n                 columns=labels)\n\ncolumns = list(df)\ncolumns.sort()\ndf = df.reindex(columns=columns)\n\nfilenames = testdf[\"id\"]\ndf[\"id\"]  = filenames\n\ncols = df.columns.tolist()\ncols = cols[-1:] + cols[:-1]\ndf = df[cols]\ndf.head(5)\n","9f3a2474":"from IPython.display import FileLink, FileLinks\nFileLinks('.') #lists all downloadable files on server","de2882db":"from tensorflow.python.keras.models import load_model\nmodel_new = load_model('CNNModel.h5') ","3e3940d8":"model_new.summary()","9bbcd1d3":"## Test Data Preperation","f3ae1b50":"\n## My Model using extracted features from ResNet Pretrained\n\n","07d1074f":"## Data Preperation"}}