{"cell_type":{"97e925bf":"code","d656e621":"code","f453f7eb":"code","6c09746a":"code","2672e53f":"code","bbe28254":"code","b49cb06c":"code","44507e7b":"code","6286fb19":"markdown"},"source":{"97e925bf":"# @Experto\n\nimport numpy as np\nimport sys\nimport pandas as pd\nfrom skimage.io import imread, imsave\nfrom skimage.color import gray2rgb\nfrom skimage.color import rgb2gray\nimport matplotlib.pyplot as plt\nfrom functools import reduce\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","d656e621":"def rle_encode(im):\n    '''\n    im: numpy array, 1 - mask, 0 - background\n    Returns run length as string formated\n    '''\n    pixels = im.flatten()\n    pixels = np.concatenate([[0], pixels, [0]])\n    runs = np.where(pixels[1:] != pixels[:-1])[0] + 1\n    runs[1::2] -= runs[::2]\n    return ' '.join(str(x) for x in runs)\n\ndef rle_decode(rle_mask):\n    '''\n    rle_mask: run-length as string formated (start length)\n    shape: (height,width) of array to return \n    Returns numpy array, 1 - mask, 0 - background\n\n    '''\n    s = rle_mask.split()\n    starts, lengths = [np.asarray(x, dtype=int) for x in (s[0:][::2], s[1:][::2])]\n    starts -= 1\n    ends = starts + lengths\n    img = np.zeros(101*101, dtype=np.uint8)\n    for lo, hi in zip(starts, ends):\n        img[lo:hi] = 1\n    return img.reshape(101,101)","f453f7eb":"def merge_dataframes(dfs, merge_keys):\n    dfs_merged = reduce(lambda left,right: pd.merge(left, right, on=merge_keys), dfs)\n    return dfs_merged","6c09746a":"df1 = pd.read_csv('..\/input\/submission\/crf_c_1.csv').rename(columns={'rle_mask': 'rle_mask'})\ndf2 = pd.read_csv('..\/input\/submission\/crf_c.csv').rename(columns={'rle_mask': 'rle_mask1'})\ndf3 = pd.read_csv('..\/input\/submission\/crf_c_2.csv').rename(columns={'rle_mask': 'rle_mask2'})\ndf4 = pd.read_csv('..\/input\/submission\/sub.csv').rename(columns={'rle_mask': 'rle_mask3'})\n#df4 = pd.read_csv('sub.csv')\n","2672e53f":"dfs = [df1,df2,df3,df4]\nmerge_keys=['id']\ndf = merge_dataframes(dfs, merge_keys=merge_keys)\ndf.head()","bbe28254":"# Esmaeil Zahedi\nres = df1.copy()\ni = 0\n\nwhile True:\n    if i == 18000:\n        break\n        \n    if (str(df.loc[i,'rle_mask'])!=str(np.nan)) and (str(df.loc[i,'rle_mask1'])!=str(np.nan)) and (str(df.loc[i,'rle_mask2'])!=str(np.nan))and (str(df.loc[i,'rle_mask3'])!=str(np.nan)): \n        decoded_mask1 = rle_decode(df.loc[i,'rle_mask'])\n        decoded_mask2 = rle_decode(df.loc[i,'rle_mask1'])\n        decoded_mask3 = rle_decode(df.loc[i,'rle_mask2'])\n        decoded_mask4 = rle_decode(df.loc[i,'rle_mask3'])\n        \n        decoded_mask_all1 = decoded_mask1 + decoded_mask2 + decoded_mask3 + decoded_mask4\n        \n        decoded_mask_all1[decoded_mask_all1<=2] = 0\n        decoded_mask_all1[decoded_mask_all1 >2]  = 1\n\n        mask = rle_encode(decoded_mask_all1)\n        \n        res.loc[i,'rle_mask'] = mask\n    else:\n        res.loc[i,'rle_mask'] = df1.loc[i,'rle_mask']\n        \n    i = i + 1\n","b49cb06c":"res.to_csv('blend_ez.csv',index=False)","44507e7b":"\ndft = res\ni = 0\nplt.figure(figsize=(25,12))\nplt.subplots_adjust(bottom=0.3, top=0.9, hspace=0.3) \nj = 0\nwhile True:\n    if str(dft.loc[i,'rle_mask'])!=str(np.nan):        \n        decoded_mask = rle_decode(dft.loc[i,'rle_mask'])\n        plt.subplot(1,7,j+1)\n        plt.imshow(decoded_mask)\n        plt.title(' ID: '+ df.loc[i,'id'])\n        j = j + 1\n        if j > 6:\n            break\n    i = i + 1","6286fb19":"# Loading Necessary Libraries\n"}}