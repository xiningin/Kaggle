{"cell_type":{"bb1085d5":"code","37b4d865":"code","c7f9a997":"code","112673a4":"code","4a71ac0a":"code","28324254":"code","450916d8":"code","210ad14d":"code","e9637abb":"code","7620f97b":"code","f071845b":"code","ae60d39f":"code","a72b6628":"code","9e2b3a2b":"code","9ae96a51":"code","c3cd3347":"code","4685ba1d":"code","68fdde4a":"code","9ca16628":"code","7b7b5a92":"code","16c848c2":"code","2cf4a006":"code","58f3acf5":"code","93e94f18":"code","f3c1eae8":"code","a4742c68":"code","7f3260ce":"code","03d43ba5":"code","440ce508":"code","9858cbbc":"code","a5abe454":"code","2e9fa423":"code","db61e43d":"code","d0abb54b":"code","f608af68":"code","48a820cc":"code","fb6cdd13":"code","6025f3d3":"code","67c70564":"code","b0b2bfaa":"code","ca2d1ac2":"code","a2f7743c":"code","a395f651":"code","0f730843":"code","239aa29f":"code","a1a2bbee":"code","99272cea":"code","4f7c6518":"code","9af209cd":"code","5793d996":"code","77e71551":"code","c2f674ac":"markdown","51cd3334":"markdown","102828c1":"markdown","327a7b36":"markdown","eb0f1a80":"markdown","7468af61":"markdown","38870f69":"markdown","5a5fe9cc":"markdown","871968eb":"markdown","dfe409c2":"markdown","8ce9b9ae":"markdown","01053111":"markdown","eb33a72d":"markdown","2ca3aa02":"markdown","e65226b0":"markdown","4e2c681b":"markdown","ca43852d":"markdown","4aed22ea":"markdown","7004868e":"markdown","717bb3ec":"markdown","c0925d69":"markdown","df7f5aa0":"markdown","05879a3f":"markdown","c0ef4d6b":"markdown","197eb0e2":"markdown","1fcadf37":"markdown","48b64ae1":"markdown","a344d8d6":"markdown","75dbcab1":"markdown","edf7b4b8":"markdown","a63dd055":"markdown","e0bb0716":"markdown","c664eea5":"markdown","66becc6d":"markdown","8a41e1d2":"markdown","d636a7bc":"markdown","4a7c2d20":"markdown","acd7650f":"markdown"},"source":{"bb1085d5":"import pandas as pd\nimport numpy as np\nimport itertools\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport plotly.express as px\nimport statsmodels.api as sm\nfrom statsmodels.tsa.stattools import adfuller, acf, pacf,arma_order_select_ic\nfrom statsmodels.graphics.tsaplots import plot_acf, plot_pacf\nfrom statsmodels.tsa.arima_model import ARIMA\nimport warnings\nwarnings.simplefilter('ignore')","37b4d865":"train=pd.read_csv(r\"..\/input\/covid19-global-forecasting-week-4\/train.csv\")\ntest=pd.read_csv(r\"..\/input\/covid19-global-forecasting-week-4\/test.csv\")","c7f9a997":"train.sample(6)","112673a4":"test.sample(6)","4a71ac0a":"df = train.fillna('NA').groupby(['Country_Region','Province_State','Date'])['ConfirmedCases'].sum() \\\n                          .groupby(['Country_Region','Province_State']).max().sort_values() \\\n                          .groupby(['Country_Region']).sum().sort_values(ascending = False)\n\ntop10 = pd.DataFrame(df).head(10)\ntop10","28324254":"fig = px.bar(top10, x=top10.index, y='ConfirmedCases', labels={'x':'Country'},\n             color=\"ConfirmedCases\", color_continuous_scale=px.colors.sequential.Brwnyl)\nfig.update_layout(title_text='Confirmed COVID-19 cases by country')\nfig.show()","450916d8":"df_by_date = pd.DataFrame(train.fillna('NA').groupby(['Country_Region','Date'])['ConfirmedCases'].sum().sort_values().reset_index())\n\nfig = px.bar(df_by_date.loc[(df_by_date['Country_Region'] == 'US') &(df_by_date.Date >= '2020-03-01')].sort_values('ConfirmedCases',ascending = False), \n             x='Date', y='ConfirmedCases', color=\"ConfirmedCases\", color_continuous_scale=px.colors.sequential.BuGn)\nfig.update_layout(title_text='Confirmed COVID-19 cases per day in US')\nfig.show()","210ad14d":"df_by_date = pd.DataFrame(train.fillna('NA').groupby(['Country_Region','Date'])['ConfirmedCases'].sum().sort_values().reset_index())\n\nfig = px.bar(df_by_date.loc[(df_by_date['Country_Region'] == 'Italy') &(df_by_date.Date >= '2020-03-01')].sort_values('ConfirmedCases',ascending = False), \n             x='Date', y='ConfirmedCases', color=\"ConfirmedCases\", color_continuous_scale=px.colors.sequential.BuGn)\nfig.update_layout(title_text='Confirmed COVID-19 cases per day in Italy')\nfig.show()","e9637abb":"df_by_date = pd.DataFrame(train.fillna('NA').groupby(['Country_Region','Date'])['ConfirmedCases'].sum().sort_values().reset_index())\n\nfig = px.bar(df_by_date.loc[(df_by_date['Country_Region'] == 'China') &(df_by_date.Date >= '2020-01-01')].sort_values('ConfirmedCases',ascending = False), \n             x='Date', y='ConfirmedCases', color=\"ConfirmedCases\", color_continuous_scale=px.colors.sequential.BuGn)\nfig.update_layout(title_text='Confirmed COVID-19 cases per day in China')\nfig.show()","7620f97b":"df_by_date = pd.DataFrame(train.fillna('NA').groupby(['Country_Region','Date'])['ConfirmedCases'].sum().sort_values().reset_index())\n\nfig = px.bar(df_by_date.loc[(df_by_date['Country_Region'] == 'Spain') &(df_by_date.Date >= '2020-03-01')].sort_values('ConfirmedCases',ascending = False), \n             x='Date', y='ConfirmedCases', color=\"ConfirmedCases\", color_continuous_scale=px.colors.sequential.BuGn)\nfig.update_layout(title_text='Confirmed COVID-19 cases per day in Spain')\nfig.show()","f071845b":"df_by_date = pd.DataFrame(train.fillna('NA').groupby(['Country_Region','Date'])['ConfirmedCases'].sum().sort_values().reset_index())\n\nfig = px.bar(df_by_date.loc[(df_by_date['Country_Region'] == 'Germany') &(df_by_date.Date >= '2020-03-01')].sort_values('ConfirmedCases',ascending = False), \n             x='Date', y='ConfirmedCases', color=\"ConfirmedCases\", color_continuous_scale=px.colors.sequential.BuGn)\nfig.update_layout(title_text='Confirmed COVID-19 cases per day in Germany')\nfig.show()","ae60d39f":"df_by_date = pd.DataFrame(train.fillna('NA').groupby(['Country_Region','Date'])['ConfirmedCases'].sum().sort_values().reset_index())\n\nfig = px.bar(df_by_date.loc[(df_by_date['Country_Region'] == 'India') &(df_by_date.Date >= '2020-03-01')].sort_values('ConfirmedCases',ascending = False), \n             x='Date', y='ConfirmedCases', color=\"ConfirmedCases\", color_continuous_scale=px.colors.sequential.BuGn)\nfig.update_layout(title_text='Confirmed COVID-19 cases per day in India')\nfig.show()","a72b6628":"df=train.groupby(['Date','Country_Region']).agg('sum').reset_index()\ndf.tail(5)","9e2b3a2b":"def pltCountry_cases(ConfirmedCases,*argv):\n    f, ax=plt.subplots(figsize=(16,5))\n    labels=argv\n    for a in argv: \n        country=df.loc[(df['Country_Region']==a)]\n        plt.plot(country['Date'],country['ConfirmedCases'],linewidth=3)\n        plt.xticks(rotation=40)\n        plt.legend(labels)\n        ax.set(title='Evolution of the number of cases' )\n  \n\n","9ae96a51":"def pltCountry_fatalities(Fatalities,*argv):\n    f, ax=plt.subplots(figsize=(16,5))\n    labels=argv\n    for a in argv: \n        country=df.loc[(df['Country_Region']==a)]\n        plt.plot(country['Date'],country['Fatalities'],linewidth=3)\n        plt.xticks(rotation=40)\n        plt.legend(labels)\n        ax.set(title='Evolution of the number of fatalities' )","c3cd3347":"pltCountry_cases('ConfirmedCases','China')\npltCountry_fatalities('Fatalities','China')","4685ba1d":"pltCountry_cases('ConfirmedCases', 'Germany','Spain','France','US')\npltCountry_fatalities('Fatilities','Germany','Spain','France','US')","68fdde4a":"test['Date'] = pd.to_datetime(test['Date'])\ntrain['Date'] = pd.to_datetime(train['Date'])","9ca16628":"case='ConfirmedCases'\ndef timeCompare(time,*argv):\n    Coun1=argv[0]\n    Coun2=argv[1]\n    f,ax=plt.subplots(figsize=(16,5))\n    labels=argv  \n    country=df.loc[(df['Country_Region']==Coun1)]\n    plt.plot(country['Date'],country[case],linewidth=2)\n    plt.xticks([])\n    plt.legend(labels)\n    ax.set(title=' Evolution of actual cases',ylabel='Number of cases' )\n\n    country2=df.loc[df['Country_Region']==Coun2]\n    #country2['Date']=country2['Date']-datetime.timedelta(days=time)\n    plt.plot(country2['Date'],country2[case],linewidth=2)\n    #plt.xticks([])\n    plt.legend(labels)\n    ax.set(title=' Evolution of cases in %d days difference '%time ,ylabel='Number of %s cases'%case )","7b7b5a92":"timeCompare(8,'Italy','France')\ntimeCompare(6,'Italy','Spain')\ntimeCompare(7,'Italy','Germany')\ntimeCompare(7,'Italy','US')","16c848c2":"timeCompare(8,'US','China')\ntimeCompare(6,'US','Spain')\ntimeCompare(7,'US','Germany')\ntimeCompare(7,'US','India')","2cf4a006":"case='Fatalities'\ndef timeCompare_f(time,*argv):\n    Coun1=argv[0]\n    Coun2=argv[1]\n    f,ax=plt.subplots(figsize=(16,5))\n    labels=argv  \n    country=df.loc[(df['Country_Region']==Coun1)]\n    plt.plot(country['Date'],country[case],linewidth=2)\n    plt.xticks([])\n    plt.legend(labels)\n    ax.set(title=' Evolution of actual cases',ylabel='Number of cases' )\n\n    country2=df.loc[df['Country_Region']==Coun2]\n    #country2['Date']=country2['Date']-datetime.timedelta(days=time)\n    plt.plot(country2['Date'],country2[case],linewidth=2)\n    #plt.xticks([])\n    plt.legend(labels)\n    ax.set(title=' Evolution of Fatalities in %d days difference '%time ,ylabel='Number of %s cases'%case )","58f3acf5":"timeCompare_f(8,'Italy','France')\ntimeCompare_f(6,'Italy','Spain')\ntimeCompare_f(7,'Italy','Germany')\ntimeCompare_f(7,'Italy','US')\ntimeCompare_f(7,'Italy','China')","93e94f18":"timeCompare_f(8,'US','China')\ntimeCompare_f(6,'US','Spain')\ntimeCompare_f(7,'US','Germany')\ntimeCompare_f(7,'US','India')","f3c1eae8":"sns.set(palette = 'Set1',style='darkgrid')\n#Function for making a time serie on a designated country and plotting the rolled mean and standard \ndef roll(country,case='ConfirmedCases'):\n    ts=df.loc[(df['Country_Region']==country)]  \n    ts=ts[['Date',case]]\n    ts=ts.set_index('Date')\n    ts.astype('int64')\n    a=len(ts.loc[(ts['ConfirmedCases']>=10)])\n    ts=ts[-a:]\n    return (ts.rolling(window=4,center=False).mean().dropna())\n\n\ndef rollPlot(country, case='ConfirmedCases'):\n    ts=df.loc[(df['Country_Region']==country)]  \n    ts=ts[['Date',case]]\n    ts=ts.set_index('Date')\n    ts.astype('int64')\n    a=len(ts.loc[(ts['ConfirmedCases']>=10)])\n    ts=ts[-a:]\n    plt.figure(figsize=(16,6))\n    plt.plot(ts.rolling(window=7,center=False).mean().dropna(),label='Rolling Mean')\n    plt.plot(ts[case])\n    plt.plot(ts.rolling(window=7,center=False).std(),label='Rolling std')\n    plt.legend()\n    plt.title('Cases distribution in %s with rolling mean and standard' %country)\n    plt.xticks([])","a4742c68":"tsC1=roll('China')\nrollPlot('China')","7f3260ce":"tsC2=roll('US')\nrollPlot('US')","03d43ba5":"tsC3=roll('Italy')\nrollPlot('Italy')","440ce508":"tsC4=roll('Spain')\nrollPlot('Spain')","9858cbbc":"tsC5=roll('Germany')\nrollPlot('Germany')","a5abe454":"#Decomposing the ts to find its properties\nfig=sm.tsa.seasonal_decompose(tsC1.values,freq=7).plot()","2e9fa423":"fig=sm.tsa.seasonal_decompose(tsC2.values,freq=7).plot()","db61e43d":"fig=sm.tsa.seasonal_decompose(tsC3.values,freq=7).plot()","d0abb54b":"fig=sm.tsa.seasonal_decompose(tsC4.values,freq=7).plot()","f608af68":"fig=sm.tsa.seasonal_decompose(tsC5.values,freq=7).plot()","48a820cc":"#Function to check the stationarity of the time serie using Dickey fuller test\ndef stationarity(ts):\n    print('Results of Dickey-Fuller Test:')\n    test = adfuller(ts, autolag='AIC')\n    results = pd.Series(test[0:4], index=['Test Statistic','p-value','#Lags Used','Number of Observations Used'])\n    for i,val in test[4].items():\n        results['Critical Value (%s)'%i] = val\n    print (results)\n\n#For China\ntsC=tsC1['ConfirmedCases'].values\nstationarity(tsC)","fb6cdd13":"#For US\ntsC=tsC2['ConfirmedCases'].values\nstationarity(tsC)","6025f3d3":"#For Italy\ntsC=tsC3['ConfirmedCases'].values\nstationarity(tsC)","67c70564":"#For Spain\ntsC=tsC4['ConfirmedCases'].values\nstationarity(tsC)","b0b2bfaa":"#For Germany\ntsC=tsC5['ConfirmedCases'].values\nstationarity(tsC)","ca2d1ac2":"def corr(ts):\n    plot_acf(ts,lags=12,title=\"ACF\")\n    plot_pacf(ts,lags=12,title=\"PACF\")\n    \n\n#For China\ncorr(tsC1)","a2f7743c":"#For US\ncorr(tsC2)","a395f651":"#For Italy\ncorr(tsC3)","0f730843":"#For Spain\ncorr(tsC4)","239aa29f":"#For Germany\ncorr(tsC5)","a1a2bbee":"#test['Date'] = pd.to_datetime(test['Date'])\n#train['Date'] = pd.to_datetime(train['Date'])\ntrain = train.set_index(['Date'])\ntest = test.set_index(['Date'])","99272cea":"\ndef create_features(df,label=None):\n    \"\"\"\n    Creates time series features from datetime index.\n    \"\"\"\n    df = df.copy()\n    df['Date'] = df.index\n    df['hour'] = df['Date'].dt.hour\n    df['dayofweek'] = df['Date'].dt.dayofweek\n    df['quarter'] = df['Date'].dt.quarter\n    df['month'] = df['Date'].dt.month\n    df['year'] = df['Date'].dt.year\n    df['dayofyear'] = df['Date'].dt.dayofyear\n    df['dayofmonth'] = df['Date'].dt.day\n    df['weekofyear'] = df['Date'].dt.weekofyear\n    \n    X = df[['hour','dayofweek','quarter','month','year',\n           'dayofyear','dayofmonth','weekofyear']]\n   \n    return X","4f7c6518":"train_features=pd.DataFrame(create_features(train))\ntest_features=pd.DataFrame(create_features(test))\nfeatures_and_target_train = pd.concat([train,train_features], axis=1)\nfeatures_and_target_test = pd.concat([test,test_features], axis=1)\nfrom sklearn.preprocessing import LabelEncoder\nle = LabelEncoder()\ndef FunLabelEncoder(df):\n    for c in df.columns:\n        if df.dtypes[c] == object:\n            le.fit(df[c].astype(str))\n            df[c] = le.transform(df[c].astype(str))\n    return df\nfeatures_and_target_train= FunLabelEncoder(features_and_target_train)","9af209cd":"x_train= features_and_target_train[['Country_Region','month', 'dayofyear', 'dayofmonth' , 'weekofyear']]\ny1 = features_and_target_train[['ConfirmedCases']]\ny2 =features_and_target_train[['Fatalities']]\nx_test = features_and_target_test[['Country_Region', 'month', 'dayofyear', 'dayofmonth' , 'weekofyear']]\n","5793d996":"#Mean absolute percentage error\ndef mape(y1, y_pred): \n    y1, y_pred = np.array(y1), np.array(y_pred)\n    return np.mean(np.abs((y1 - y_pred) \/ y1)) * 100\n\ndef split(ts):\n    #splitting 85%\/15% because of little amount of data\n    size = int(len(ts) * 0.85)\n    train= ts[:size]\n    test = ts[size:]\n    return(train,test)\n\n\n#Arima modeling for ts\ndef arima(ts,test):\n    p=d=q=range(0,6)\n    a=99999\n    pdq=list(itertools.product(p,d,q))\n    \n    #Determining the best parameters\n    for var in pdq:\n        try:\n            model = ARIMA(ts, order=var)\n            result = model.fit()\n\n            if (result.aic<=a) :\n                a=result.aic\n                param=var\n        except:\n            continue\n            \n    #Modeling\n    model = ARIMA(ts, order=param)\n    result = model.fit()\n    result.plot_predict(start=int(len(ts) * 0.7), end=int(len(ts) * 1.2))\n    pred=result.forecast(steps=len(test))[0]\n    #Plotting results\n    f,ax=plt.subplots()\n    plt.plot(pred,c='green', label= 'predictions')\n    plt.plot(test, c='red',label='real values')\n    plt.legend()\n    plt.title('True vs predicted values')\n    #Printing the error metrics\n    print(result.summary())        \n    \n    print('\\nMean absolute percentage error: %f'%mape(test,pred))\n    return (pred)\n\n\n\ntrain,test=split(tsC)\npred=arima(train,test)","77e71551":"#Mean absolute percentage error\ndef mape(y2, y_pred): \n    y2, y_pred = np.array(y2), np.array(y_pred)\n    return np.mean(np.abs((y2 - y_pred) \/ y2)) * 100\n\ndef split(ts):\n    #splitting 85%\/15% because of little amount of data\n    size = int(len(ts) * 0.85)\n    train= ts[:size]\n    test = ts[size:]\n    return(train,test)\n\n\n#Arima modeling for ts\ndef arima(ts,test):\n    p=d=q=range(0,6)\n    a=99999\n    pdq=list(itertools.product(p,d,q))\n    \n    #Determining the best parameters\n    for var in pdq:\n        try:\n            model = ARIMA(ts, order=var)\n            result = model.fit()\n\n            if (result.aic<=a) :\n                a=result.aic\n                param=var\n        except:\n            continue\n            \n    #Modeling\n    model = ARIMA(ts, order=param)\n    result = model.fit()\n    result.plot_predict(start=int(len(ts) * 0.7), end=int(len(ts) * 1.2))\n    pred=result.forecast(steps=len(test))[0]\n    #Plotting results\n    f,ax=plt.subplots()\n    plt.plot(pred,c='green', label= 'predictions')\n    plt.plot(test, c='red',label='real values')\n    plt.legend()\n    plt.title('True vs predicted values')\n    #Printing the error metrics\n    print(result.summary())        \n    \n    print('\\nMean absolute percentage error: %f'%mape(test,pred))\n    return (pred)\n\n\n\ntrain,test=split(tsC)\npred=arima(train,test)","c2f674ac":"Model Building","51cd3334":"Cases Distribution with Rolling mean and standard deviation","102828c1":"From the above graph we analysed timeseries of US, Germany, France, italy ,Spain : Trend , Seasonal , Residual of Confirmed Cases are analysed","327a7b36":"# Importing Necessary Packages","eb0f1a80":"Confirmed COVID-19 cases Per day in India","7468af61":"From the above graph we can conclude that with 7 days difference, US crossed Italy in Cases","38870f69":"From this graph we can say that,with in short period of time virus has spread more in US and kept in 1st place","5a5fe9cc":"Comparing a group of countries with similar evolution: Germany, Spain, France and the US","871968eb":"Italy has more fatalities than US, Germany, France, Spain but less than China initially. italy has grown its fatalities in less time period","dfe409c2":"Data Stationarity and transformation","8ce9b9ae":"Here the p-value helps us to reject the null hypothesis of the non-stationarity of the data with confidence, but that assumption is sometimes not enough, we should also consider the time series might not be an AR(auto-regression).\nThis supposedly means that the parameter i(d) will be 0 and the model would be an ARMA model.","01053111":"Spain and china has more fatalities than US. India and germany has less fatalities than US","eb33a72d":"Coronavirus disease (COVID-19) is an infectious disease caused by a newly discovered coronavirus.\n\nMost people infected with the COVID-19 virus will experience mild to moderate respiratory illness and recover without requiring special treatment. Older people, and those with underlying medical problems like cardiovascular disease, diabetes, chronic respiratory disease, and cancer are more likely to develop serious illness.\n\nThe best way to prevent and slow down transmission is be well informed about the COVID-19 virus, the disease it causes and how it spreads. Protect yourself and others from infection by washing your hands or using an alcohol based rub frequently and not touching your face.\n\nThe COVID-19 virus spreads primarily through droplets of saliva or discharge from the nose when an infected person coughs or sneezes, so it\u2019s important that you also practice respiratory etiquette (for example, by coughing into a flexed elbow).\n\nAt this time, there are no specific vaccines or treatments for COVID-19. However, there are many ongoing clinical trials evaluating potential treatments. WHO will continue to provide updated information as soon as clinical findings become available.\n\nStay informed:\n\nProtect yourself: advice for the public Myth busters Questions and answers Situation reports All information on the COVID-19 outbreak","2ca3aa02":"For day to day track of this COVID-19 Cases, Deaths please refer my another notebook [https:\/\/www.kaggle.com\/eswarchandt\/geospatial-analysis-on-covid-19](http:\/\/)","e65226b0":"Well , we have to appreaciate India in maintaining constant cases.US, Italy, China, Spain, Gemany has to take take","4e2c681b":"# EDA","ca43852d":"Nice meaning full plots","4aed22ea":"AUTO Correlation","7004868e":"Time Series in China","717bb3ec":"The confirmed Cases compared to US, China, Italy , Spain and Germany are very less in India. But once it starts spreading it will show a greater impact.","c0925d69":"# ARIMA","df7f5aa0":"From the above graph, we can say that, In china this virus has started and continued to spread. From this region, virus began to spread all parts of the world. In china the confirmed cases are increasing day by day.","05879a3f":"The above are the forecated and predicted fatalities in coming weeks","c0ef4d6b":"Confirmed COVID-19 Cases by country","197eb0e2":"Confirmed COVID-19 cases per day in Spain","1fcadf37":"In this way we can forecast or predict for each and every region","48b64ae1":"Confirmed COVID-19 Cases per day in Germany","a344d8d6":"Confirmed COVID-19 cases per day in China","75dbcab1":"Please upvote if you liked my notebook and keep me motivated ","edf7b4b8":"From the above graph, we can say that US has most Confirmed cases and followed by italy.\nThe virus has began at China but virus is showing a  greater impact on US and Italy than China","a63dd055":"![image.png](attachment:image.png)","e0bb0716":"The above obtained graphs are Forecasted and predicted cases in coming week","c664eea5":"Decomposing the data","66becc6d":"# Time evaluation","8a41e1d2":"In italy, Spreading of virus done for a long time and thus effected more people. But in US within short period the spread is more in this way US had a great impact","d636a7bc":"Confirmed COVID-19 cases per day in US","4a7c2d20":"# Introduction","acd7650f":"For day to day track and geospatial analysis refer my another notebook in which i explained detailedly and calculated Deaths, cases, Recovered day to day.\nHere is my notenok [https:\/\/www.kaggle.com\/eswarchandt\/geospatial-analysis-on-covid-19](http:\/\/)"}}