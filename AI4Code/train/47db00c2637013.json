{"cell_type":{"111cf456":"code","0a395803":"code","83b50452":"code","0f4e3909":"code","2f8cbb19":"code","49cd9fac":"code","08a14ef8":"code","c23f2675":"code","61097004":"code","a150ce7d":"code","69d4bf45":"code","23c8ad02":"code","849d9208":"code","4c60e115":"code","1aa51477":"code","a1f221f9":"code","1495bb67":"code","807f5124":"code","1b4ac482":"code","2a18127f":"code","76c41bb5":"code","f36497cc":"code","546e810a":"code","81744310":"code","998b0e63":"code","bc303d6b":"code","6f0757a3":"code","857c7bb3":"code","698e53bc":"code","06c1a7aa":"code","1bfa09ab":"code","13b9e547":"code","3f65d413":"code","2636e133":"code","89205715":"code","76eb2f25":"code","92c9d0c9":"code","fb25340e":"code","eacb1db7":"code","9b03cbcc":"code","5f577a74":"code","c454bfc4":"code","ef3fd4c0":"code","42a39feb":"markdown","d54b6b56":"markdown","b281fe92":"markdown","4366223d":"markdown","62733840":"markdown","6da98790":"markdown","840b6267":"markdown","393fbd34":"markdown","0c251360":"markdown","3a9bba44":"markdown","ba5deddb":"markdown","6eb9bb9c":"markdown"},"source":{"111cf456":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","0a395803":"from sklearn.decomposition import KernelPCA\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.multiclass import OneVsRestClassifier\nfrom sklearn.multioutput import MultiOutputRegressor\nfrom sklearn.utils import class_weight\nfrom sklearn.svm import SVR\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.utils import class_weight\nfrom sklearn.calibration import CalibratedClassifierCV\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn.model_selection import train_test_split\nfrom skmultilearn.model_selection import iterative_train_test_split\nimport pickle\nfrom keras.layers import Dense, Activation, Dropout, BatchNormalization, Input\nfrom keras.models import Sequential, Model\nfrom keras import optimizers, regularizers, initializers\nfrom keras.callbacks import ModelCheckpoint, Callback\nfrom keras import backend as K\nfrom keras.optimizers import Adam\nimport tensorflow as tf\nfrom xgboost import XGBRegressor\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport warnings\nwarnings.filterwarnings(\"ignore\")","83b50452":"NCA1 = 100\nNCA2 = 100\nDROPRATE = 0.2\nEP = 500\nBATCH_SIZE = 256\nVAL_RATIO = 0.1\nTEST_RATIO = 0.1","0f4e3909":"lipophilicity_df= pd.read_csv('..\/input\/lipophilicity_descriptors\/Lipophilicity_df_revised.csv')\nprint(lipophilicity_df.shape)\nlipophilicity_df.head()","2f8cbb19":"lipophilicity_df.drop(['smiles','CMPD_CHEMBLID'], axis=1, inplace=True)\nprint(lipophilicity_df.shape)\nlipophilicity_df.head()","49cd9fac":"# Get indices of NaN\n#inds = pd.isnull(tox21_df).any(1).nonzero()[0]","08a14ef8":"# Drop NaN from the dataframe\n#tox21_df.dropna(inplace=True)\n#print(tox21_df.shape)\n#tox21_df.head()","c23f2675":"lipophilicity_df = lipophilicity_df.fillna(0)\nlipophilicity_df.head()","61097004":"lipophilicity_descriptors_df= pd.read_csv('..\/input\/lipophilicity_descriptors\/Lipophilicity_descriptors_df.csv',low_memory=False)\nprint(lipophilicity_descriptors_df.shape)\nlipophilicity_descriptors_df.head()","a150ce7d":"# function to coerce all data types to numeric\n\ndef coerce_to_numeric(df, column_list):\n    df[column_list] = df[column_list].apply(pd.to_numeric, errors='coerce')","69d4bf45":"coerce_to_numeric(lipophilicity_descriptors_df, lipophilicity_descriptors_df.columns)\nlipophilicity_descriptors_df.head()","23c8ad02":"lipophilicity_descriptors_df = lipophilicity_descriptors_df.fillna(0)\nlipophilicity_descriptors_df.head()","849d9208":"#tox21_descriptors_df.drop(tox21_descriptors_df.index[inds],inplace=True)\n#tox21_descriptors_df.shape","4c60e115":"lipophilicity_scaler1 = StandardScaler()\nlipophilicity_scaler1.fit(lipophilicity_descriptors_df.values)\nlipophilicity_descriptors_df = pd.DataFrame(lipophilicity_scaler1.transform(lipophilicity_descriptors_df.values),\n                                            columns=lipophilicity_descriptors_df.columns)","1aa51477":"nca = NCA1\ncn = ['col'+str(x) for x in range(nca)]","a1f221f9":"lipophilicity_transformer1 = KernelPCA(n_components=nca, kernel='rbf', n_jobs=-1)\nlipophilicity_transformer1.fit(lipophilicity_descriptors_df.values)\nlipophilicity_descriptors_df = pd.DataFrame(lipophilicity_transformer1.transform(lipophilicity_descriptors_df.values),\n                                            columns=cn)\nprint(lipophilicity_descriptors_df.shape)\nlipophilicity_descriptors_df.head()","1495bb67":"X_train, X_test, y_train, y_test = train_test_split(lipophilicity_descriptors_df.values,\n                                                    lipophilicity_df.values, random_state=32,\n                                                    test_size=TEST_RATIO)","807f5124":"parameters = {'estimator__kernel':['rbf'], \n              'estimator__epsilon':[0.1,0.25,0.5],\n              'estimator__C':[1,0.5,0.25], 'estimator__gamma':['auto','scale']}\nlipophilicity_svr = GridSearchCV(MultiOutputRegressor(SVR()), \n                        parameters, cv=3, scoring='neg_mean_squared_error',n_jobs=-1)","1b4ac482":"result = lipophilicity_svr.fit(X_train, y_train)","2a18127f":"pred = lipophilicity_svr.predict(X_test)\nsvr_rmse = np.sqrt(mean_squared_error(y_test,pred))\nprint(svr_rmse)","76c41bb5":"def huber_loss(y_true, y_pred):\n        return tf.losses.huber_loss(y_true,y_pred)","f36497cc":"lipophilicity_model = Sequential()\nlipophilicity_model.add(Dense(128, input_dim=lipophilicity_descriptors_df.shape[1], \n                              kernel_initializer='he_uniform'))\nlipophilicity_model.add(BatchNormalization())\nlipophilicity_model.add(Activation('tanh'))\nlipophilicity_model.add(Dropout(rate=DROPRATE))\nlipophilicity_model.add(Dense(64,kernel_initializer='he_uniform'))\nlipophilicity_model.add(BatchNormalization())\nlipophilicity_model.add(Activation('tanh'))\nlipophilicity_model.add(Dropout(rate=DROPRATE))\nlipophilicity_model.add(Dense(32,kernel_initializer='he_uniform'))\nlipophilicity_model.add(BatchNormalization())\nlipophilicity_model.add(Activation('tanh'))\nlipophilicity_model.add(Dropout(rate=DROPRATE))\nlipophilicity_model.add(Dense(lipophilicity_df.shape[1],kernel_initializer='he_uniform',activation=None))","546e810a":"lipophilicity_model.compile(loss=huber_loss, optimizer='adam',metrics=['mse'])","81744310":"checkpoint = ModelCheckpoint('lipophilicity_model.h5', monitor='val_loss', verbose=1, save_best_only=True, save_weights_only=True, mode='min')","998b0e63":"hist = lipophilicity_model.fit(X_train, y_train, \n                               validation_split=VAL_RATIO,epochs=EP, batch_size=BATCH_SIZE, \n                               callbacks=[checkpoint])","bc303d6b":"plt.ylim(0., 1.)\nplt.plot(hist.epoch, hist.history[\"loss\"], label=\"Train loss\")\nplt.plot(hist.epoch, hist.history[\"val_loss\"], label=\"Valid loss\")","6f0757a3":"lipophilicity_model.load_weights('lipophilicity_model.h5')","857c7bb3":"pred = lipophilicity_model.predict(X_test)\nnn_rmse = np.sqrt(mean_squared_error(y_test,pred))\nprint(nn_rmse)","698e53bc":"inp = lipophilicity_model.input\nout = lipophilicity_model.layers[-2].output\nlipophilicity_model_gb = Model(inp, out)","06c1a7aa":"X_train = lipophilicity_model_gb.predict(X_train)\nX_test = lipophilicity_model_gb.predict(X_test)","1bfa09ab":"data = np.concatenate((X_train,X_test),axis=0)","13b9e547":"lipophilicity_scaler2 = StandardScaler()\nlipophilicity_scaler2.fit(data)\nX_train = lipophilicity_scaler2.transform(X_train)\nX_test = lipophilicity_scaler2.transform(X_test)","3f65d413":"data = np.concatenate((X_train,X_test),axis=0)","2636e133":"nca = NCA2","89205715":"lipophilicity_transformer2 = KernelPCA(n_components=nca, kernel='rbf', n_jobs=-1)\nlipophilicity_transformer2.fit(data)\nX_train = lipophilicity_transformer2.transform(X_train)\nX_test = lipophilicity_transformer2.transform(X_test)","76eb2f25":"nca = X_train.shape[1]\nparameters = {'estimator__kernel':['rbf'], \n              'estimator__epsilon':[0.1,0.25,0.5],\n              'estimator__C':[1,0.5,0.25], 'estimator__gamma':['auto','scale']}\nlipophilicity_svr_gb = GridSearchCV(MultiOutputRegressor(SVR()), \n                                    parameters, cv=3, scoring='neg_mean_squared_error',n_jobs=-1)","92c9d0c9":"result = lipophilicity_svr_gb.fit(X_train, y_train)","fb25340e":"pred = lipophilicity_svr_gb.predict(X_test)\nsvr_gb_rmse = np.sqrt(mean_squared_error(y_test,pred))\nprint(svr_gb_rmse)","eacb1db7":"parameters = {'estimator__learning_rate':[0.05,0.1,0.15],'estimator__n_estimators':[75,100,125], 'estimator__max_depth':[3,5,7],\n              'estimator__booster':['gbtree','dart'],'estimator__reg_alpha':[0.1,0.05],'estimator__reg_lambda':[0.5,1.]}\n\nlipophilicity_xgb_gb = GridSearchCV(MultiOutputRegressor(XGBRegressor(random_state=32)), \n                                    parameters, cv=3, scoring='neg_mean_squared_error',n_jobs=-1)","9b03cbcc":"result = lipophilicity_xgb_gb.fit(X_train, y_train)","5f577a74":"pred = lipophilicity_xgb_gb.predict(X_test)\nxgb_gb_rmse = np.sqrt(mean_squared_error(y_test,pred))\nprint(xgb_gb_rmse)","c454bfc4":"with open('lipophilicity_svr.pkl', 'wb') as fid:\n    pickle.dump(lipophilicity_svr, fid)\nwith open('lipophilicity_transformer1.pkl', 'wb') as fid:\n    pickle.dump(lipophilicity_transformer1, fid)\nwith open('lipophilicity_transformer2.pkl', 'wb') as fid:\n    pickle.dump(lipophilicity_transformer2, fid)\nwith open('lipophilicity_scaler1.pkl', 'wb') as fid:\n    pickle.dump(lipophilicity_scaler1, fid)\nwith open('lipophilicity_scaler2.pkl', 'wb') as fid:\n    pickle.dump(lipophilicity_scaler2, fid)\nwith open('lipophilicity_svr_gb.pkl', 'wb') as fid:\n    pickle.dump(lipophilicity_svr_gb, fid)\nwith open('lipophilicity_xgb_gb.pkl', 'wb') as fid:\n    pickle.dump(lipophilicity_xgb_gb, fid)","ef3fd4c0":"sns.set(style=\"whitegrid\")\nax = sns.barplot(x=[svr_rmse,nn_rmse,svr_gb_rmse,xgb_gb_rmse],\n                 y=['SVR','NN','SVC_GB','XGB_GB'])\nax.set_xlim(0.65,0.8)","42a39feb":"## For loading saved model\n\n```python\nwith open('lipophilicity_svr.pkl', 'rb') as fid:\n    lipophilicity_svr = pickle.load(fid)\n ```","d54b6b56":"## Keras Neural Network Model","b281fe92":"## Loading molecular descriptors\n\nDescriptors dataframe contains 1625 molecular descriptors (including 3D descriptors) generated on the NCI database using Mordred python module.\n\nFurther Reading:\n* https:\/\/en.wikipedia.org\/wiki\/Molecular_descriptor\n* https:\/\/github.com\/mordred-descriptor\/mordred","4366223d":"# Comparision of Results with MoleculeNet results\n\nhttp:\/\/moleculenet.ai\/full-results\n\nThe RMSE best score on the test data for the MoleculeNet models is ~0.7, the best score obtained in this kernel is ~0.72 on the test data. \n\n**Further Reading:**\n* https:\/\/arxiv.org\/pdf\/1703.00564.pdf","62733840":"## Gradient Boosting of Keras Model with SVC","6da98790":"## Loading Lipophilicity dataset\n\n**Lipophilicity:** Experimental results of octanol\/water distribution coefficient(logD at pH 7.4).","840b6267":"## RMSE","393fbd34":"## Scaling and Principal component analysis (PCA) ","0c251360":"The simplified molecular-input line-entry system (**SMILES**) is a specification in form of a line notation for describing the structure of chemical species using short ASCII strings. SMILES can be converted to molecular structure by using RDKIT module.\n\nExample: \n```python\nfrom rdkit import Chem\nm = Chem.MolFromSmiles('Cc1ccccc1')\n```\n\nFurther reading:\n* https:\/\/www.rdkit.org\/docs\/GettingStartedInPython.html","3a9bba44":"## Gradient Boosting of Keras Model with XGBoost","ba5deddb":"## Sklearn SVR Model","6eb9bb9c":"## Saving models, transformer and scaler"}}