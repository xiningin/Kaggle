{"cell_type":{"07313298":"code","a1b710fb":"code","93944897":"code","199ab8e7":"code","d5506003":"code","857933f5":"code","c7f17e75":"code","5cd05fb7":"code","e4d968ed":"code","86099252":"code","197a95e8":"code","e9dd688b":"code","ba2d5689":"code","89011804":"code","c917c324":"code","eccc6b33":"code","2491acd0":"code","d3c0ee1a":"code","3c9ea8cb":"code","e7ded2cf":"code","bf7e1268":"code","7c074dd1":"code","5084e43d":"code","6a1ced5e":"code","45527496":"code","7620a99d":"code","afb69186":"code","ccdaa51d":"code","41c817f3":"code","f7da01f6":"code","e3282988":"code","db998d9c":"code","9dce53ee":"code","cc407aa3":"code","2eb1136c":"code","9e84c51a":"code","ae2ecf75":"code","43e49aad":"code","af3b9c2b":"code","7b6e954d":"code","47828eb4":"code","f9c011f3":"code","5a4753b7":"code","aaaa1808":"code","16f31dcf":"code","5395cbdc":"code","db9ea2f6":"code","12cadde3":"code","a0de12c7":"code","f6259a17":"code","53bdba4f":"code","372d3bbb":"code","0a5fff08":"code","bebf4edb":"code","a89e774c":"code","adc32cdb":"code","bd112628":"code","b859e91b":"code","b4301846":"code","1f77549a":"code","f497bed4":"code","b708cf01":"code","00ac7bd2":"code","2f487c83":"code","d84ca1c4":"code","dfe63b63":"code","da6afafb":"code","8490a95d":"code","8103cae8":"markdown","5246e1ec":"markdown","4be41e8b":"markdown","5b236431":"markdown","e4086a08":"markdown","fe8fa1c6":"markdown","7d40cd19":"markdown","265be419":"markdown","62d96a3d":"markdown","8b81f5eb":"markdown","90f537d0":"markdown","78a6391e":"markdown","8a25e8e9":"markdown","8498717e":"markdown","65b03df6":"markdown","a0b5c5f5":"markdown","e52502f7":"markdown","9b724803":"markdown","bd9b383b":"markdown","130d1194":"markdown","b5996fe9":"markdown","15ed779e":"markdown","428b5dbe":"markdown","9c40981a":"markdown","2cb00dbe":"markdown","bc8f9b7f":"markdown","863e339c":"markdown","9f3c48f6":"markdown","1a4f619e":"markdown","30d8c813":"markdown","75405757":"markdown","6dbc6793":"markdown","4391d7fa":"markdown","7aa368ce":"markdown","4bd30ebd":"markdown","9a1202b4":"markdown","bcc606b0":"markdown","c474420b":"markdown","a7bc275a":"markdown","e439e395":"markdown","ce146dc8":"markdown","a4af6fd8":"markdown","3ee81913":"markdown","a83e414e":"markdown","e8c34983":"markdown","7913b348":"markdown","2b1fac12":"markdown","0c1f22cc":"markdown","85a85741":"markdown","07c50136":"markdown","cd6d409e":"markdown","7173cd0b":"markdown","4d052ad2":"markdown","6dd45214":"markdown","70da3411":"markdown","dd8524e3":"markdown","fe6aa309":"markdown","3851d921":"markdown","cb64a8f7":"markdown","ff184421":"markdown","5ff4c2d6":"markdown","bf0e871e":"markdown","f04cd351":"markdown","9124e0ff":"markdown","cf3df4eb":"markdown","70f7e266":"markdown","621fcf0b":"markdown","0c4afff2":"markdown","ac706b0c":"markdown","151a4033":"markdown"},"source":{"07313298":"!pip install seaborn==0.11.0\n!pip install scikit-learn==0.24.0","a1b710fb":"import numpy as np\nfrom scipy import stats\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns","93944897":"RANDOM_SEED = 42\n\nplt.rcParams['figure.figsize'] = (12, 8)\nsns.set_theme(style='whitegrid')\n\nwineBarColors = ['#ecf0f1', '#e74c3c']\nwineBinColors = ['#f39c12', '#c0392b']\n\nwineBarPalette = sns.color_palette(wineBarColors)\nwineBinPalette = sns.color_palette(wineBinColors)","199ab8e7":"raw_df = pd.read_csv('..\/input\/wine-quality\/winequalityN.csv')\n\nfull_df = raw_df.copy()","d5506003":"full_df.info()","857933f5":"full_df.head()","c7f17e75":"full_df.describe().transpose()","5cd05fb7":"missing_df = full_df.isnull().sum()\nmissing_df = missing_df.drop(missing_df[missing_df == 0].index).sort_values(ascending=False)\n\nmissing_df = pd.DataFrame({'missing_count': missing_df})\nmissing_df['missing_rate(%)'] = (missing_df['missing_count'] \/ len(full_df)) * 100\n\nmissing_df","e4d968ed":"full_df['pH'] = full_df.groupby(['type'])['pH'].transform(lambda x: x.fillna(x.mode()[0]))\n\nfor feature in ['chlorides', 'sulphates', 'residual sugar']:\n    full_df[feature] = full_df.groupby(['type'])[feature].transform(lambda x: x.fillna(x.median()))\n\nfor feature in ['fixed acidity', 'volatile acidity', 'citric acid']:\n    full_df[feature] = full_df.groupby(['type', 'pH'])[feature].transform(lambda x: x.fillna(x.median()))","86099252":"type_onehot = pd.get_dummies(full_df['type'], prefix='type')\nfull_df = pd.concat([full_df, type_onehot], axis=1)","197a95e8":"full_df.isnull().sum()","e9dd688b":"num_features = [f for f in full_df.columns if full_df.dtypes[f] != 'object']\nnum_features.remove('quality')\n\nnum_features","ba2d5689":"sns.displot(data=full_df, x='quality', hue='type', kind='kde');","89011804":"full_df['quality'].value_counts(), full_df['quality'].value_counts(normalize=True) * 100","c917c324":"def impute_quality_group(quality):\n    if quality <= 5:\n        return 0 # low\n    if quality > 5 and quality < 7:\n        return 1 # average\n    if quality >= 7:\n        return 2 # high\n\nfor dataset in [raw_df, full_df]:\n    dataset['quality_group'] = dataset['quality'].apply(impute_quality_group)","eccc6b33":"sns.displot(data=full_df, x='quality_group', hue='type', kind='kde');","2491acd0":"full_df['quality_group'].value_counts(), full_df['quality_group'].value_counts(normalize=True) * 100 ","d3c0ee1a":"_, ax = plt.subplots(4, 3, figsize=(15, 15))\n\nfor idx, feature in enumerate(num_features):\n    subplot = ax[idx % 4][idx % 3]\n    sns.histplot(data=full_df, x=feature, hue='quality_group', kde=True, palette='tab10', ax=subplot)","3c9ea8cb":"skewness_df = pd.DataFrame({\n    'feature': [], \n    'skewness': [], \n    'kurtosis': [], \n    'boxcox_test': [],\n    'boxcox_skewness': [], \n    'boxcox_kurtosis': [],\n    'log_skewness': [],\n    'log_kurtosis': [],\n    'sqrt_skewness': [],\n    'sqrt_kurtosis': [],\n})\n\ntransformed_df = full_df.copy()\n\nfor feature in num_features:\n    skewness = transformed_df[feature].skew()\n    kurtosis = transformed_df[feature].kurtosis()\n    transformed_df[feature + '_transformed'], boxcox_test = stats.boxcox(1 + full_df[feature])\n\n    boxcox_skewness = transformed_df[feature + '_transformed'].skew()\n    boxcox_kurtosis = transformed_df[feature + '_transformed'].kurtosis()\n\n    transformed_df[feature + '_transformed'] = np.log1p(transformed_df[feature])\n    log_skewness = transformed_df[feature + '_transformed'].skew()\n    log_kurtosis = transformed_df[feature + '_transformed'].kurtosis()\n\n    transformed_df[feature + '_transformed'] = np.sqrt(transformed_df[feature])\n    sqrt_skewness = transformed_df[feature + '_transformed'].skew()\n    sqrt_kurtosis = transformed_df[feature + '_transformed'].kurtosis()\n\n    skewness_df = skewness_df.append({\n            'feature': feature, \n            'skewness': skewness, \n            'kurtosis': kurtosis, \n            'boxcox_test': boxcox_test,\n            'boxcox_skewness': boxcox_skewness, \n            'boxcox_kurtosis': boxcox_kurtosis,\n            'log_skewness': log_skewness, \n            'log_kurtosis': log_kurtosis,\n            'sqrt_skewness': sqrt_skewness, \n            'sqrt_kurtosis': sqrt_kurtosis,\n        }, \n        ignore_index=True\n    )\n\nskewness_df","e7ded2cf":"features_to_transform = list(num_features)\nfeatures_to_transform.remove('density')\nfeatures_to_transform.remove('type_red')\nfeatures_to_transform.remove('type_white')\n\nfor feature in features_to_transform:\n    full_df[feature], _ = stats.boxcox(1 + full_df[feature])","bf7e1268":"for feature in features_to_transform:\n    fig, ax = plt.subplots(2, 2, constrained_layout=True)\n    \n    # plot original distribution and its probability-probability plot\n    sns.histplot(data=raw_df, x=feature, hue='quality_group', kde=True, palette='tab10', ax=ax[0][0])\n    stats.probplot(raw_df[feature], dist=stats.norm, plot=ax[1][0])\n\n    # plot transformed distribution and its probability-probability plot\n    sns.histplot(data=full_df, x=feature, hue='quality_group', kde=True, palette='tab10', ax=ax[0][1])\n    stats.probplot(full_df[feature], dist=stats.norm, plot=ax[1][1])","7c074dd1":"small_scale_features = list(set(num_features) - set(['total sulfur dioxide', 'free sulfur dioxide', 'type_white', 'type_red']))\nlarge_scale_features = ['total sulfur dioxide', 'free sulfur dioxide']\n\n_, (ax0, ax1) = plt.subplots(1, 2, figsize=(22, 10))\n\nsns.boxplot(data=full_df[small_scale_features], palette='Set3', ax=ax0)\nsns.boxplot(data=full_df[large_scale_features], palette='Set3', ax=ax1);","5084e43d":"full_df[full_df['total sulfur dioxide'] > 170][['type', 'alcohol', 'free sulfur dioxide', 'total sulfur dioxide', 'quality', 'quality_group']]","6a1ced5e":"full_df[full_df['free sulfur dioxide'] > 20][['type', 'alcohol', 'free sulfur dioxide', 'total sulfur dioxide', 'quality', 'quality_group']]","45527496":"full_df[full_df['citric acid'] > 0.75][['type', 'alcohol', 'free sulfur dioxide', 'total sulfur dioxide', 'quality', 'quality_group']]","7620a99d":"full_df['type'].value_counts()","afb69186":"sns.catplot(data=full_df, x='type', y='quality', kind='box', palette=wineBarPalette);","ccdaa51d":"red_wine_df = full_df[full_df['type'] == 'red']\nwhite_wine_df = full_df[full_df['type'] == 'white']","41c817f3":"correlation_features = list(num_features)\ncorrelation_features.append('quality')\ncorrelation_features.remove('type_red')\ncorrelation_features.remove('type_white')\n\nsns.heatmap(full_df[correlation_features].corr(), annot=True, square=True, cmap='Greens', cbar=False);","f7da01f6":"fig, (ax0, ax1) = plt.subplots(1, 2, constrained_layout=True, figsize=(18, 18))\n\nsns.heatmap(red_wine_df[correlation_features].corr(), annot=True, square=True, cmap='Greens', cbar=False, ax=ax0)\nax0.set_title('Red Wine')\n\nsns.heatmap(white_wine_df[correlation_features].corr(), annot=True, square=True, cmap='Greens', cbar=False, ax=ax1)\nax1.set_title('White Wine');","e3282988":"g = sns.PairGrid(full_df[['fixed acidity', 'volatile acidity', 'citric acid', 'pH', 'type']], hue='type', diag_sharey=False, palette=wineBinPalette)\n\ng.map_upper(sns.scatterplot, s=15)\ng.map_lower(sns.kdeplot)\ng.map_diag(sns.kdeplot, lw=2);","db998d9c":"sns.lmplot(data=full_df, x='fixed acidity', y='quality', hue='type', palette=wineBinPalette, scatter_kws={'alpha': 0.1});","9dce53ee":"sns.catplot(data=full_df, x='quality_group', y='fixed acidity', kind='box', palette='Set3')\nsns.catplot(data=full_df, x='quality_group', y='fixed acidity', hue='type', kind='box', palette=wineBarPalette);","cc407aa3":"sns.lmplot(data=full_df, x='volatile acidity', y='quality', hue='type', palette=wineBinPalette, scatter_kws={'alpha': 0.1})\n\nsns.catplot(data=full_df, x='quality_group', y='volatile acidity', kind='box', palette='Set3')\nsns.catplot(data=full_df, x='quality_group', y='volatile acidity', hue='type', kind='box', palette=wineBarPalette);","2eb1136c":"full_df['antibacterial_componets'] = full_df['citric acid'] + full_df['total sulfur dioxide'] * 0.001\n\nsns.lmplot(data=full_df, x='antibacterial_componets', y='volatile acidity', hue='type', palette=wineBinPalette, scatter_kws={'alpha': 0.1});","9e84c51a":"sns.lmplot(data=full_df, x='citric acid', y='quality', hue='type', palette=wineBinPalette, scatter_kws={'alpha': 0.1});","ae2ecf75":"sns.catplot(data=full_df, x='quality_group', y='citric acid', kind='box', palette='Set3')\nsns.catplot(data=full_df, x='quality_group', y='citric acid', hue='type', kind='box', palette=wineBarPalette);","43e49aad":"full_df['total_acidity'] = full_df['fixed acidity'] + full_df['volatile acidity'] + full_df['citric acid']\n\nsns.catplot(data=full_df, x='quality_group', y='total_acidity', kind='box', palette='Set3')\nsns.catplot(data=full_df, x='quality_group', y='total_acidity', hue='type', kind='box', palette=wineBarPalette);","af3b9c2b":"sns.lmplot(data=full_df, x='pH', y='quality', hue='type', palette=wineBinPalette, scatter_kws={'alpha': 0.1});","7b6e954d":"pH_labels = ['high', 'mod high', 'medium', 'low']\npH_bins = [2.5, 3.2, 3.3, 3.4, 4.1]\n\nfull_df['pH_groups'] = pd.cut(raw_df['pH'], bins=pH_bins, labels=pH_labels) \n\nsns.catplot(data=full_df, x='pH_groups', hue='quality_group', kind='count', palette='Set2')\nsns.catplot(data=full_df, x='pH_groups', hue='type', kind='count', palette=wineBinPalette);","47828eb4":"g = sns.PairGrid(full_df[['alcohol', 'residual sugar', 'density', 'type']], hue='type', diag_sharey=False, palette=wineBinPalette)\n\ng.map_upper(sns.scatterplot, s=15)\ng.map_lower(sns.kdeplot)\ng.map_diag(sns.kdeplot, lw=2);","f9c011f3":"sns.catplot(data=full_df, x='quality_group', y='residual sugar', hue='type', kind='box', palette=wineBarPalette);","5a4753b7":"sns.displot(data=full_df, x='residual sugar', hue='type', kind='hist', kde=True, palette=wineBinPalette);","aaaa1808":"def impute_sweetness(residual_sugar):\n    if residual_sugar < 1:\n        return 'bone-dry'\n    if residual_sugar >= 1 and residual_sugar < 9:\n        return 'dry'\n    if residual_sugar >= 9 and residual_sugar < 18:\n        return 'off-dry'\n    if residual_sugar >= 18 and residual_sugar < 50:\n        return 'semi-sweet'\n    if residual_sugar >= 50 and residual_sugar < 120:\n        return 'mid-sweet'\n    if residual_sugar >= 120:\n        return 'sweet'\n\nfull_df['sweetness'] = raw_df['residual sugar'].apply(impute_sweetness)\nwhite_wine_df['sweetness'] = white_wine_df['residual sugar'].apply(impute_sweetness)\n\nsns.catplot(data=full_df, x='sweetness', y='quality', kind='box', palette='Set3');","16f31dcf":"_, (ax0, ax1) = plt.subplots(1, 2)\n\nax0.set_title('All Wine Sweetness')\nsns.histplot(data=full_df, x='residual sugar', hue='sweetness', kde=True, ax=ax0)\n\nax1.set_title('White Wine Sweetness')\nsns.histplot(data=white_wine_df, x='residual sugar', hue='sweetness', kde=True, ax=ax1);","5395cbdc":"full_df['sugar_acidity_ratio'] = full_df['residual sugar'] \/ full_df['total_acidity']\n\nsns.lmplot(data=full_df, x='quality', y='sugar_acidity_ratio', hue='type', palette=wineBinPalette, scatter_kws={'alpha': 0.1});","db9ea2f6":"raw_df['alcohol'].describe()","12cadde3":"sns.lmplot(data=full_df, x='alcohol', y='quality', hue='type', palette=wineBinPalette, scatter_kws={'alpha': 0.1})\nsns.catplot(data=full_df, x='quality_group', y='alcohol', hue='type', kind='box', palette=wineBarPalette);","a0de12c7":"sns.histplot(data=full_df, x='alcohol', hue='type', kde=True, palette=wineBinPalette);","f6259a17":"sns.lmplot(data=full_df, x='alcohol', y='residual sugar', hue='quality_group', scatter_kws={'alpha': 0.1});","53bdba4f":"alcohol_labels = ['low', 'medium', 'mod hig', 'high']\nalcohol_bins = [0, 9.5, 11.5, 13.5, 20]\n\nfull_df['alcohol_groups'] = pd.cut(raw_df['alcohol'], bins=alcohol_bins, labels=alcohol_labels) \n\n_, (ax0, ax1) = plt.subplots(1, 2)\nsns.countplot(data=full_df, x='quality_group', hue='alcohol_groups', palette='Set2', ax=ax0)\nsns.histplot(data=full_df, x='alcohol', hue='alcohol_groups', kde=True, ax=ax1);","372d3bbb":"sns.lmplot(data=full_df, x='density', y='quality', hue='type', palette=wineBinPalette, scatter_kws={'alpha': 0.1})\nsns.catplot(data=full_df, x='quality_group', y='density', hue='type', kind='box', palette=wineBarPalette);","0a5fff08":"sns.jointplot(data=full_df, x='density', y='residual sugar', hue='type', kind='kde', palette=wineBinPalette);","bebf4edb":"g = sns.PairGrid(full_df[['free sulfur dioxide', 'total sulfur dioxide', 'sulphates', 'type']], hue='type', diag_sharey=False, palette=wineBinPalette)\n\ng.map_upper(sns.scatterplot, s=15)\ng.map_lower(sns.kdeplot)\ng.map_diag(sns.kdeplot, lw=2);","a89e774c":"sns.catplot(data=full_df, x='quality_group', y='free sulfur dioxide', hue='type', kind='box', palette=wineBarPalette)\nsns.catplot(data=full_df, x='quality_group', y='total sulfur dioxide', hue='type', kind='box', palette=wineBarPalette);","adc32cdb":"sns.jointplot(data=full_df, x='total sulfur dioxide', y='free sulfur dioxide', hue='type', kind='kde', palette=wineBinPalette);","bd112628":"full_df['bound_sulfur_dioxid'] = full_df['total sulfur dioxide'] - full_df['free sulfur dioxide']\n\nsns.catplot(data=full_df, x='quality_group', y='bound_sulfur_dioxid', hue='type', kind='box', palette=wineBarPalette);","b859e91b":"full_df['free_total_so2_rate'] = full_df['free sulfur dioxide'] \/ full_df['total sulfur dioxide']\n\nsns.catplot(data=full_df, x='quality_group', y='free_total_so2_rate', hue='type', kind='box', palette=wineBarPalette);","b4301846":"full_df['molecular_sulfur_dioxid'] = full_df['free sulfur dioxide'] \/ (1 + 10 ** (full_df['pH'] - 1.8))\nfull_df['sulfites'] = full_df['free sulfur dioxide'] - full_df['molecular_sulfur_dioxid']\nfull_df['sulfur_dioxid_pH_ratio'] = full_df['total sulfur dioxide'] - full_df['pH']\n\nsns.catplot(data=full_df, x='quality_group', y='molecular_sulfur_dioxid', hue='type', kind='box', palette=wineBarPalette)\nsns.catplot(data=full_df, x='quality_group', y='sulfites', hue='type', kind='box', palette=wineBarPalette)\nsns.catplot(data=full_df, x='quality_group', y='sulfur_dioxid_pH_ratio', hue='type', kind='box', palette=wineBarPalette);","1f77549a":"sns.catplot(data=full_df, x='quality_group', y='sulphates', hue='type', kind='box', palette=wineBarPalette);","f497bed4":"sns.lmplot(data=full_df, x='chlorides', y='quality', hue='type', palette=wineBinPalette, scatter_kws={'alpha': 0.1});","b708cf01":"sns.catplot(data=full_df, x='quality_group', y='chlorides', hue='type', kind='box', palette=wineBarPalette);","00ac7bd2":"from sklearn.decomposition import PCA\nfrom sklearn.preprocessing import StandardScaler\n\nx_processed = StandardScaler().fit_transform(full_df[num_features])","2f487c83":"pc_analyser = PCA(\n    random_state=RANDOM_SEED\n)\n\npc_analyser.fit(x_processed)\n\nplt.plot(np.cumsum(pc_analyser.explained_variance_ratio_))\nplt.xlabel('number of components')\nplt.ylabel('cumulative explained variance');","d84ca1c4":"pca2d = PCA(\n    n_components=2,\n    random_state=RANDOM_SEED\n)\n\nx2d = pca2d.fit_transform(x_processed)\n\npca_df = pd.DataFrame(data=x2d, columns=['pc1', 'pc2'])\npca_df = pd.concat([pca_df, full_df[['type', 'quality_group', 'volatile acidity']]], axis=1)\n\n_, (ax0, ax1) = plt.subplots(2, 1)\n\nsns.scatterplot(data=pca_df, x='pc1', y='pc2', hue='type', alpha=0.3, ax=ax0, palette=wineBinPalette)\nsns.scatterplot(data=pca_df, x='pc1', y='pc2', hue='quality_group', alpha=0.3, ax=ax1);","dfe63b63":"pca_features = num_features.copy()\npca_features.remove('type_red')\npca_features.remove('type_white')\n\nx_processed = StandardScaler().fit_transform(full_df[pca_features])\ny_processed = full_df[['quality_group']].copy()\ny_processed = y_processed.reset_index(drop=True)","da6afafb":"from sklearn.manifold import Isomap\n\nX_iso = Isomap(n_neighbors=20, n_components=2).fit_transform(x_processed)\n\npca_df = pd.DataFrame(data=X_iso, columns=['discr1', 'discr2'])\npca_df = pd.concat([pca_df, y_processed], axis=1)\n\nsns.scatterplot(data=pca_df, x='discr1', y='discr2', hue='quality_group', alpha=0.3);","8490a95d":"from sklearn.neighbors import NeighborhoodComponentsAnalysis\n\nnca = NeighborhoodComponentsAnalysis(init='random', n_components=2, random_state=RANDOM_SEED)\nX_nca = nca.fit_transform(x_processed, y_processed)\n\npca_df = pd.DataFrame(data=X_nca, columns=['comp1', 'comp2'])\npca_df = pd.concat([pca_df, y_processed], axis=1)\n\nsns.scatterplot(data=pca_df, x='comp1', y='comp2', hue='quality_group', alpha=0.3);","8103cae8":"**pH** shows the same picture as **fixed acidity**. **Red wine quality** becomes higher with higher acidity (lower pH value) and **white wine quality** becomes higher as acidity reduces.","5246e1ec":"# Feature Importance\n\nFeature importance was reviewed in <a href=\"https:\/\/www.kaggle.com\/glushko\/wine-quality-modelling-part-ii#Model-Inspection-%F0%9F%94%8E\">the second part of the research<\/a>.","4be41e8b":"# Wine Quality Analysis: EDA\n\n<img style=\"margin-left:0\" src=\"https:\/\/thumbor.forbes.com\/thumbor\/fit-in\/1200x0\/filters%3Aformat%28jpg%29\/https%3A%2F%2Fspecials-images.forbesimg.com%2Fdam%2Fimageserve%2F1133888244%2F0x0.jpg%3Ffit%3Dscale\" width=\"600px\" \/>\n\nThis notebook analyse a database of **red** and **white** variants of the Portuguese \"Vinho Verde\" wine based on wine **physicochemical test results** and quality scores that experts assign to each wine sample.\n\n- **If you find this notebook intresting and useful or helped you to select a good bottle of wine\ud83c\udf77, please feel free to upvote it \ud83d\udcab**\n- Modelling Part of the Analysis: https:\/\/www.kaggle.com\/glushko\/wine-quality-modelling-part-ii\n- Github: https:\/\/github.com\/roma-glushko\/kaggle-wine-quality","5b236431":"**Residual sugar** is what makes wine **dense**. Their corralation is pretty strong (**0.54**). Scatter plot shows **two outliers** with high amount of sugar and desity. The **residual sugar** and **dense** relations are **heterogeneous**:","e4086a08":"## Acidity and pH\n\n<img style=\"margin-left:0\" src=\"https:\/\/upload.wikimedia.org\/wikipedia\/commons\/thumb\/7\/70\/Wine_grape_diagram_en.svg\/2560px-Wine_grape_diagram_en.svg.png\" width=\"600px\" \/>\n\nThe **acids** in wine are an important component in both winemaking and the finished product of wine. They are present in both **grapes and wine**, having direct influences on the **color, balance and taste** of the wine as well as the **growth and vitality of yeast** during fermentation and **protecting the wine from bacteria**. \n\nHere is acidity information we have been given:\n- **fixed acidity** (tartaric acid - $g\/dm^3$) - most acids involved with wine or fixed or nonvolatile (do not evaporate readily)\n- **volatile acidity** (acetic acid - $g\/dm^3$) - the amount of acetic acid in wine, which at too high of levels can lead to an unpleasant, vinegar taste\n- **citric acid** ($g\/dm^3$) - found in small quantities, citric acid can add \"freshness\" and flavor to wines\n- **pH** - describes how acidic or basic a wine is on a scale from 0 (very acidic) to 14 (very basic); most wines are between 3-4 on the pH scale\n\nMore Info:\n- https:\/\/waterhouse.ucdavis.edu\/whats-in-wine\/fixed-acidity\n- http:\/\/www.oiv.int\/public\/medias\/3732\/oiv-ma-as313-02.pdf\n- https:\/\/waterhouse.ucdavis.edu\/whats-in-wine\/volatile-acidity\n- https:\/\/www.decanter.com\/learn\/volatile-acidity-va-45532\/\n- https:\/\/extension.psu.edu\/volatile-acidity-in-wine","fe8fa1c6":"**Alcohol** content is created from **sugar**. Generally, the **more alcohol wine** contains, the **less residual sugar** it has (**-0.54** correlation):","7d40cd19":"**Molecular SO2** and **sulfites** tended to be less in the **higher quality wines**.","265be419":"### Residual Sugar\n\n<img style=\"margin-left:0\" src=\"https:\/\/media.winefolly.com\/Residual-Sugar-wine.png\" width=\"600px\" \/>\n\n**Residual sugar** is from natural grape sugars leftover in a wine after the alcoholic fermentation finishes. It defines wine's **sweetness**.\n\nMore Info:\n- https:\/\/winefolly.com\/deep-dive\/what-is-residual-sugar-in-wine\/","62d96a3d":"## Credits\n\n- https:\/\/bibinmjose.github.io\/RedWineDataAnalysis\/\n- https:\/\/s3.amazonaws.com\/udacity-hosted-downloads\/ud651\/wineQualityInfo.txt\n- https:\/\/towardsdatascience.com\/what-makes-a-wine-good-ea370601a8e4\n- https:\/\/www.kaggle.com\/mgmarques\/wines-type-and-quality-classification-exercises","8b81f5eb":"# Want More? \ud83d\udcab\n\n- <a href=\"https:\/\/www.kaggle.com\/glushko\/house-prices-domain-driven-eda-part-i\">Ames House Prices: Domain-Driven EDA (Part I)<\/a>\n- <a href=\"https:\/\/www.kaggle.com\/glushko\/house-prices-regression-modelling-part-ii\">Ames House Prices: Modelling (Part II)<\/a>","90f537d0":"**White wine** contains more **bounded SO2** then **red wine**. Both type of wines tends to have **less bounded SO2** when **wine samples quality** goes up:","78a6391e":"The dataset is **imbalanced**. We only have access to a few records of the worst and the best wine samples. Depending on the our classification objectives, this may be a problem as we **would not have enough samples** to perform all class classification.\n\nHaving this situation, we would like to simplify quality analys by adding **low**, **average** and **high quality** quality groups:","8a25e8e9":"By reducing number of classes, we come up with **more balanced** dataset:","8498717e":"## Sulfur Dioxide and Sulphates\n\n<img style=\"margin-left:0\" src=\"https:\/\/grapesandwine.cals.cornell.edu\/sites\/grapesandwine.cals.cornell.edu\/files\/shared\/images\/101Fig1300.jpg\" width=\"600px\" \/>\n\n**Sulfur dioxide**, is thought to help rid the wine of a wide variety of bacteria (good and bad); this seems to **lower the wine quality as well** because it dulls the wine\u2019s fermentation process.\n\n- **free sulfur dioxide** ($mg\/dm^3$) - the free form of $SO_{2}$ exists in equilibrium between molecular $SO_{2}$ (as a dissolved gas) and bisulfite ion; it prevents microbial growth and the oxidation of wine\n- **total sulfur dioxide** ($mg\/dm^3$) - amount of free and bound forms of $SO_{2}$; in low concentrations, $SO_{2}$ is mostly undetectable in wine, but at free $SO_{2}$ concentrations over 50 ppm, $SO_{2}$ becomes evident in the nose and taste of wine\n- **sulphates** (potassium sulphate - $g\/dm^3$) - a wine additive which can contribute to sulfur dioxide gas ($SO_{2}$) levels, wich acts as an antimicrobial and antioxidant\n\nMore Info:\n- https:\/\/www.decanter.com\/learn\/wine-terminology\/sulfites-in-wine-friend-or-foe-295931\/\n- https:\/\/link.springer.com\/chapter\/10.1007\/978-1-4757-6255-6_12\n- https:\/\/winefolly.com\/deep-dive\/sulfites-in-wine\/\n- https:\/\/www.healthline.com\/nutrition\/sulfites-in-wine","65b03df6":"Here is what can we see immediately from countor plots:\n- **pH** negatevly correlates with **fixed acidity** and **citric acidity**. Less **pH** means more tart taste of wine.\n- **Volatile acidity** positively correlates with **pH** in **red wine samples**\n- **Citric acid** negatevly correlates with **volatile acidity**","a0b5c5f5":"# Wine Physicochemical Analysis \ud83e\uddea","e52502f7":"### Density\n\n**Density** is generally used as a measure of the **conversion of sugar to alcohol**. Prior to fermentation, wine will contain **sugars** which will make the liquid more **dense**. When the **wine** is undergoing fermentation the **sugars** in the liquid are converted by the yeast into **alcohol**. \n\n**Alcohol in water** is **less dense** than sugar in water. Density of water is **0.99984 g\/L**.\n\nAs we can see, the **wine density increases** when **wine quality** goes down:","9b724803":"**Free SO2** amount doesn't seem to have a strong correlation with **wine quality**. **Total SO2** has a little negative correlation with **red wine quality**:","bd9b383b":"We have **12 features**. Most of them are **continues numbers**. In total, dataset contains **6.4k samples**. From the first glance, it's pretty big number comparing to the number of features. Let's see if this is enough for us to explanin observation variance.\n\nFor instance, in <a href=\"https:\/\/www.kaggle.com\/glushko\/house-prices-domain-driven-eda-part-i\">Ames housing dataset<\/a> is around 3k samples and 80 features.","130d1194":"By taking a look at dataset, we can see a lot of **right skewed distributions** (fixed and volatile acidity, residual sugar, chlorides, free and total SO2, density). Only shape of **pH distribution** resemble bell shape:","b5996fe9":"**Wine quality** measures from **3 to 9** according to the observations in the training set. **Wine quality 5, 6 and 7** were the most frequent:","15ed779e":"Having list of features by type is also frequently useful:","428b5dbe":"**Total SO2** consists of **Free SO2** and **Bounded SO2** (combined with compounds such as phenols, acetaldehyde and sugar). This is the reason why they correlate strongly:","9c40981a":"**Residual sugar** distribution is binomial. **Wine type** explains only part of the left hump:","2cb00dbe":"## Wine Quality Distribution","bc8f9b7f":"## Chlorides\n\n<img style=\"margin-left:0\" src=\"https:\/\/encrypted-tbn0.gstatic.com\/images?q=tbn:ANd9GcRLeecYvHp8BIW_cEbXZEhbiwIaTxRuImVT0g&usqp=CAU\" width=\"600px\" \/>\n\n**Chloride** concentration in the wine is influenced by **geographic** and its highest levels are found in wines coming from countries where irrigation is carried out using **salty water** or in areas with brackish terrains.\n\n**Chlorides** (**sodium chloride** - $g\/dm^3$) - the amount of **salt** in the wine","863e339c":"Physicochemical test results for \"good\" and \"bad\" wines may be different for different **wine type**. So it may be helpful to **separate** our training set **by wine type** for further investigation:","9f3c48f6":"## Data Transformation","1a4f619e":"### Percentage of Alcohol\n\n<img style=\"margin-left:0\" src=\"https:\/\/media.winefolly.com\/wine-serving-size-based-on-alcohol-content1.png\" width=\"600px\" \/>\n\n**Percentage of alcohol** has a great possitive correlation with **wine quality**:","30d8c813":"**Manifold learning** approaches doesn't help to descriminate quality groups as well. However, we do see the same pattern of reducing wine quality going from the top to bottom:","75405757":"## Wine Type\n\nOur wine collection is represented in **red** and **white** wine types. Red and white wines are not only different because of the type of grapes and color. Actually, technology of producing these types of wine is quite different:\n\n- **Red wines** are fermented with the **grape skins** and **seeds** and white wines are **not**. This is because all the color in red wine comes from the **skins and seeds of the grapes**.\n\n- The largest difference between **red winemaking** and **white winemaking** is the oxidation that causes the wines to lose their floral and fruit notes in exchange for rich, nutty flavors and more smoothness.\n\nMore Info:\n- https:\/\/winefolly.com\/tips\/red-wine-vs-white-wine-the-real-differences\/\n- https:\/\/www.healthline.com\/nutrition\/red-vs-white-wine\n\nThe training set is **imbalanced** with respect to wine types: there are much more red wines than white ones (75% vs 25%):","6dbc6793":"Dataset contains some missing values. However, their ratio is little:","4391d7fa":"## Outliers","7aa368ce":"## Missing Values","4bd30ebd":"Now we are aware of outliers, but we would not take any actions on them untill we can check how our models will be be working with and without them.","9a1202b4":"Here is a quick ranges of residual sugar by wine type:\n\n**White Wine**:\n- Total: 0.6-65.8 g\/gm^3\n- In Low Tier: 0.7-17.55 g\/gm^3\n- In High Tier: 0.8-14.8 g\/gm^3\n\n**Red Wine**:\n- Total: 0.9-15.5 g\/dm^3\n- In Low Tier: 1.2-12.9 g\/dm^3\n- In High Tier: 1.4-6.4 g\/dm^3\n\n**Resigual sugar** has slightly possitive correlation with **red wine quality** and slightly negative correlation with **white wine quality**.","bcc606b0":"With increasing **sugar to acidity ratio**, the **wine quality** starts to **decrease**.","c474420b":"**Red Wine Quality Insights**:\n- **Alchohol** has possitive correlation with **Quality** (0.48)\n- **Sulphates** has possitive correlation with **Quality** (0.25)\n- **Citric Acidity** has possitive correlation with **Quality** (0.23)\n- **Fixed Acidity** has possitive correlation with **Quality** (0.12)\n- **Chlorides** has negative correlation with **Quality** (-0.13)\n- **Density** has negative correlation with **Quality** (-0.17)\n- **Total Sulfure Dioxide** has negative correlation with **Quality** (-0.19)\n- **Volatile Acidity** has negative correlation with **Quality** (-0.39)\n\n**White Wine Quality Insights**:\n- **Alchohol** has possitive correlation with **Quality** (0.44)\n- **Fixed Acidity** has negative correlation with **Quality** (-0.11)\n- **Total Sulfure Dioxide** has negative correlation with **Quality** (-0.17)\n- **Volatile Acidity** has negative correlation with **Quality** (-0.19)\n- **Chlorides** has negative correlation with **Quality** (-0.21)\n- **Density** has negative correlation with **Quality** (-0.31)\n\nGeneral wine correlations are close to **white wine** correlations. This is because number of **white wines** bigger than **red wines**.","a7bc275a":"Just in case, let's also encode our single categorical feature **type**:","e439e395":"## Sugar, Alcohol and Density\n\n<img style=\"margin-left:0\" src=\"https:\/\/upload.wikimedia.org\/wikipedia\/commons\/d\/d5\/Mthomebrew_must.JPG\" width=\"600px\" \/>\n\nThe process of **fermentation** in winemaking turns grape juice into an alcoholic beverage. During fermentation, **yeasts** transform sugars present in the juice into **alcohol** and carbon dioxide.\n\nHere is a list of wine properties related to **fermentation** process:\n\n- **residual sugar** ($g\/dm^3$) - the amount of **sugar** remaining after **fermentation stops**, it's rare to find wines with less than 1 g\/L and wines with greater than 45 g\/L are considered sweet\n- **alcohol** (% by volume) - the percent alcohol content of the wine\n- **density** ($g\/cm^3$) - the density of water is close to that of water depending on the percent alcohol and sugar content","ce146dc8":"**Free and total SO2** can be combined by ratio. Better taste wine has larger **free SO2** ratio:","a4af6fd8":"**Volatile acidity** has pretty strong negative correlations with **citric acid**, **free and total SO2** content. They might prevent wine from bacterial activities that produces **acetic acid**.\n\nWe can combine **citric acid** and **total SO2** to create something like **antibacterial_componets** variable (also scale **total SO2** to g\/L):","3ee81913":"### Citric Acid\n\n<img style=\"margin-left:0\" src=\"https:\/\/images-na.ssl-images-amazon.com\/images\/I\/41VHzHjkVvL.jpg\" width=\"600px\" \/>\n\nThe **citric acid** is found in very small quantities in wine grapes. It can be used by winemakers in acidification to boost the **wine's total acidity** and prevent **ferric hazes**. It is used less frequently than **tartaric and malic** due to the aggressive **citric flavors** it can add to the wine. When **citric acid** is added, it is always done after primary alcohol fermentation has been completed due to the tendency of yeast to convert citric into **acetic acid**. \n\nMore Info:\n- https:\/\/wineserver.ucdavis.edu\/industry-info\/enology\/methods-and-techniques\/common-chemical-reagents\/citric-acid\n\n**Citric Acidity** improves **red wine quality** and has slightly negative impact on the **white wine quality**:","a83e414e":"### Sulphates\n\n**Sulphates** are salts of sulfuric acid (that's why it has **negative correlation** with **SO2** amount). Sulfur dioxide reacts other chemical compounds (metabolites) in wine to create sulphite compounds, which heavily characterise the **chemical profile of the oldest wines**. It also adds a bit of a \"sharp\" taste:","e8c34983":"So we have 3 features that contributes to wine acidity. Let's try to create **total acidity** feature and see its affect on the wine quality:","7913b348":"**Wine quality** doesn't seem to be dependent on the wine type:","2b1fac12":"Let's notice a flavor of our dataset:","0c1f22cc":"As we can see from the plot, we can use **6 components** to explaint **90% of sample varience**.\n\nWhen we plot all observations, we see two dense groups on the figure. This is **two different types of wine** and they are being descriminated well. \n\nRegarding wine quality, there is no such a clear discrimination (at least in our low dimentional 2D space). Groups color intensity increases from top to bottom which means increasing of wine quality (according to the legend), but the pattern is not strong:","85a85741":"# Database Overview \ud83d\udd0d","07c50136":"**Acidity and sweetness** are two of five principal characteristics of the wine. We can combine them in **sugar to acidity ratio**. Sugar can soft sour taste of wine:\n\nMore Info:\n- https:\/\/winefolly.com\/deep-dive\/understanding-acidity-in-wine\/","cd6d409e":"Let's use boxplots to get overview of outliers in our dataset:","7173cd0b":"Let's see if **wine sweetness** can help to explain the rest.\n\n**Residual sugar** can be useful to group wine by **sweetness**. **Sweetness** is one of the five key wine characteristics:","4d052ad2":"**Chloride** content **decrease** as **wine quality goes up**.","6dd45214":"# Summary\n\nIn this notebook, we try to recall school chemistry and analyze wine test results and their relations with wine quality and type.\n\n**If you find this notebook intresting and useful or helped you to select a good bottle of wine\ud83c\udf77, please feel free to upvote it \ud83d\udcab**\n\nGithub: https:\/\/github.com\/roma-glushko\/kaggle-wine-quality","70da3411":"**Free SO2** consists of **molecular SO2**, **bisulfite ions (HSO3-)** and **sulfite (SO3+)**. **Molecular SO2** is directly active in\npreventing oxidation and spoilage. Bisulfites and sulfites are much less reactive components.\n\nThe effectiveness of the $SO_2$ to protect the wine from oxidation and microbial spoilage is **dependant upon the pH** of the wine. \nTherefore, the **higher the pH** a wine has, the **less effective the SO2**. Wines with higher pH levels, red or white, may require too high a total SO2 level to achieve desired free $SO_2$ levels.\n\nRather than have excessive **bound SO2** (which may give a \u201cchemical\u201d taste), it is best to rely on a combination of factors, including susceptibility to spoilage. Some pH problems can be relieved by adjusting the pH downward with tartaric acid.\n\nMore Info:\n- http:\/\/www.santarosa.edu\/~jhenderson\/Sulfur%20Dioxide.pdf\n- http:\/\/srjcstaff.santarosa.edu\/~jhenderson\/SO2.pdf","dd8524e3":"**Total SO2 and citric acid** are rich for outliers that far from -+1.5IQR. Most of the remaining features also have outliers, but they are closer to the the -+1.5IQR.\n\nWe can review founded anomalies:","fe6aa309":"Let's estimate each feature distribution **skewness and kurtosis** on the original dataset and after applying the most common data transformations (Box-Cox, log and principal square root):","3851d921":"# Principal Component Analysis \ud83d\udcc8\n\nPrincipal component analysis will help us to draw all observations in 2D space to see if there is any visual patterns we need to know about.\n\nBut first, let's check component-variance plot for the dataset:","cb64a8f7":"Generally, wines contains **9-11% of alcohol**. Let's group our samples in 4 **acohol tiers**:","ff184421":"### Fixed Acidity\n\n<img style=\"margin-left: 0\" src=\"https:\/\/pubchem.ncbi.nlm.nih.gov\/image\/imgsrv.fcgi?cid=875&t=l\" width=\"600px\" \/>\n\n**Tartaric acid** is, from a winemaking perspective, the most important in wine due to the prominent role it plays in **maintaining the chemical stability of the win and its color and finally in influencing the taste** of the finished wine.\n\nMost of the **acids** involved with wine are **fixed acids** with the notable exception of **acetic acid**, mostly found in vinegar, which is volatile and can contribute to the wine fault known as **volatile acidity**.\n\n**Fixed acidity** differently affects **red and white wine quality**:\n- **Red wine** becomes better **quality** with increasing **fixed acidity**\n- Conversing, **white wine** quality degrades with increasing **fixed acidity**","5ff4c2d6":"**Red wine** tends to have higher content of **sulfates** comparing with **white wine**. **Sulfates** slightly correlates with **wine quality**.","bf0e871e":"PP plots show that **Box-Cox** tranformation truly helped us to reach better degree of normality. In addition, the transfromation helped to reveal better feature distributions. For instance, now we clearly see that **residual sugar** and **chlorides** are binomial distributions which is not obvious at all.","f04cd351":"**Wine sweetness** doesn't help to discriminate wine quality, but it explanins **Residual sugar distribution peaks** well:","9124e0ff":"Kurtosis is a heaviness of distirbution tails which is basically outliers. **Chlorides**, **sulphates**, **free SO2**, **fixed acidity**, **residual sugar** has large kurtosis and we want to take a look at their outliers. \n\n**Box-Cox transformation** performs great for most of the features. \n**Density** is an exception. It has a small deviation (~0.002) and all values are ~0.99. Probably, this is the reason, why Box-Cox transformation replaces density values by constant. \n\nLet's skip **density** and use Box-Cox transformation for the rest of the features:","cf3df4eb":"### pH test\n\n<img style=\"margin-left:0\" src=\"https:\/\/253qv1sx4ey389p9wtpp9sj0-wpengine.netdna-ssl.com\/wp-content\/uploads\/2019\/06\/PH_level_6.jpg\" width=\"600px\" \/>\n\n**pH** stands for **power of hydrogen**, which is a measurement of the **hydrogen ion concentration** in the solution.\n\nThe **pH** scale runs from **0 to 14**, from **very acidic to very basic, or alkaline**. \n**pH** affects almost every aspect of the wine: flavor, aroma, color, and potentially even quality.\n\nLower **pH** numbers mean higher amounts of hydrogen ions, and therefore a **more acidic wine**. In comparison, lemon juice usually has a pH between 2 and 3, while orange juice and wine are generally between 3 and 4, with some wines reaching slightly beyond that, to high **2s or low 4s**. For each full point increase in pH, the level of acidity is 10 times more acidic as you go up, so the difference between a pH of 3 and a pH of 4 is very significant.\n\nMore Info:\n- https:\/\/daily.sevenfifty.com\/how-winemakers-analyze-ph-and-its-impact-on-wine\/\n- https:\/\/rstudio-pubs-static.s3.amazonaws.com\/277109_1f7df6787d344858af90b5a5d6c1ef65.html","70f7e266":"### Volatile Acidity\n\n<img style=\"margin-left:0\" src=\"https:\/\/i.insider.com\/5ef6191e5af6cc6d7604ae44?width=2000&format=jpeg&auto=webp\" width=\"600px\" \/>\n\n**Volatile acidity** is mostly caused by **bacteria** in the wine creating **acetic acid**\u200a\u2014\u200athe acid that gives vinegar its characteristic flavor and aroma\u200a\u2014\u200aand its byproduct, ethyl acetate. It is only good if it's added intensionally to the wine production and in small dozes. Increasing in **volatile acidity** is killing **wine quality**:","621fcf0b":"Most of the missing values are continues. Although, **pH** can resemble a category as well. We will impute it by the most frequent value per **wine type**. \n\nOther features could differ per wine type, so we groups the rest of imputations by **wine type**, too. **pH** could help impute **acidity-related features** more precisely:","0c4afff2":"Let's give a quick look at bi-variable relations amongs acidity features:","ac706b0c":"This is what we see on the plot: **wine quality** goes up when **volatile acidity** descreases:","151a4033":"Having wine type dataframes, we can see how **quality** of each wine type **correlates** with the rest of wine characteristics:"}}