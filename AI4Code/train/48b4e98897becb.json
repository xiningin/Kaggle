{"cell_type":{"08341f5f":"code","ade18035":"code","e2aa8dc4":"code","aac836dd":"code","7a649db2":"code","e7c4ea88":"code","d6e58bca":"code","d7139729":"code","921bed8a":"code","ac0faee3":"code","da200b8b":"code","7d612cc2":"code","077c3d8e":"code","58cdc062":"code","004317db":"code","56823e90":"code","23a56f6c":"code","28473674":"code","f5911caf":"code","ba2495a5":"code","fea87b07":"code","9da3acd7":"markdown","89d91bbe":"markdown","8996adb3":"markdown","9526f105":"markdown","a8e542bb":"markdown","63a541fe":"markdown","18c0db7d":"markdown","6dd5e6e4":"markdown","d6996034":"markdown","c72b71a6":"markdown","cdb85844":"markdown","047c8336":"markdown","b145aa7d":"markdown","bcbb00d4":"markdown"},"source":{"08341f5f":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport missingno as msno\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\nsns.set(style=\"ticks\", color_codes=True)","ade18035":"train = pd.read_csv('\/kaggle\/input\/song-popularity-prediction\/train.csv', index_col='id')\ntest = pd.read_csv('\/kaggle\/input\/song-popularity-prediction\/test.csv', index_col='id')","e2aa8dc4":"# Check the first few rows of the train data\ntrain.head()","aac836dd":"train.info()","7a649db2":"print(train.shape)","e7c4ea88":"train.iloc[:, :-1].describe().T.sort_values(by='count', ascending = False)\\\n                     .style.background_gradient(cmap='GnBu')\\\n                     .bar(subset=[\"max\"], color='red')\\\n                     .bar(subset=[\"mean\",], color='green')","d6e58bca":"msno.bar(train);","d7139729":"msno.heatmap(train);","921bed8a":"sns.countplot(x=\"song_popularity\", data=train);\nplt.title('Song Popularity', fontsize=18);","ac0faee3":"# Obtain the list of variables and remove the target\ncols = train.columns.to_list()\ncols.remove('song_popularity')\n \nplt.figure(figsize= (16,18))\nfor i,col in enumerate(cols):\n    plt.subplot(5,3, i+1)\n    sns.histplot(train[col])\n    plt.title(col, weight = 'bold')\n    plt.ylabel(\" \")\n    plt.xlabel(\" \")\n    plt.tight_layout()","da200b8b":"sns.countplot(x=\"audio_mode\", data=train);\nplt.title('Audio mode', fontsize=18, weight='bold');","7d612cc2":"sns.countplot(x=\"time_signature\", data=train);\nplt.title('Time signature', fontsize=18, weight='bold');","077c3d8e":"# We have negative values and get a warning\nsns.histplot(np.log(train['instrumentalness']))\nplt.title(\"Instrumentalness (log)\", weight = 'bold')","58cdc062":"plt.figure(figsize= (16,18))\nfor i,col in enumerate(cols):\n    plt.subplot(5,3, i+1)\n    sns.histplot(x=train[col], data=train, hue='song_popularity')\n    plt.title(col, weight = 'bold')\n    plt.ylabel(\" \")\n    plt.xlabel(\" \")\n    plt.tight_layout()","004317db":"corr = train.corr()\nfig, ax = plt.subplots()\nfig.set_size_inches(11.7, 8.27)\nsns.heatmap(corr, vmin=0, vmax=1, linewidths=2, square=True, cmap='Blues', annot=True);","56823e90":"from sklearn.model_selection import train_test_split\n\nfeature_cols = cols\nX = train[feature_cols]\n\ny = train.song_popularity\n\n# Separate data intro training and validation \nX_train, X_valid, y_train, y_valid = train_test_split(X, y)","23a56f6c":"from xgboost import XGBRFClassifier\n\nxb = XGBRFClassifier(use_label_encoder=False)\nxb.fit(X_train, y_train)","28473674":"from sklearn.metrics import roc_auc_score\n\npredictions = xb.predict(X_valid)\nprint(\"AUC score: \", roc_auc_score(predictions, y_valid))","f5911caf":"# Create submission\nX_test = test.copy()\n\ntest_predictions = xb.predict(X_test)","ba2495a5":"submission = pd.DataFrame({\n    'id': X_test.index,\n    'song_popularity': test_predictions\n})","fea87b07":"submission.to_csv('submission.csv', index=False)","9da3acd7":"## Conclusion\n\nFrom our quick exploratory analysis, we infer the following:\n\n* The data have missing values.\n* The train data is unbalanced and we might need to use oversampling or undersampling.\n* We need to normalize the train data. All of the variables have either skewed or \"weird\" distribution.\n\n\n# Baseline model\n\nFinally, we create a simple xgboot model that will serve as a basis for future models.","89d91bbe":"### Missing values takeaway\n\n* It looks like the variables have about 10% of missing values.\n* Apparently, there is no correlation amongst missing values.\n\n\n## Visualizations\n\nNow, we plot all of the variables to understand their shape.","8996adb3":"### What's the distribution of missing values?\n\nWw need to investigate further into the missing values to better understand how to handle them.","9526f105":"From the plots above, we see that instrumentalness has a very odd distribution. Also, the variables key, audio_mode, time_signature appear to be categorical. \n\nWe plot audio_mode and time_signature againg but this time as a categorical variable. In addition, we plot instrumentalness again but we log transform it.","a8e542bb":"This notebook is inspired by the following work:\n\n   * [Song Popularity EDA - Live Coding Fun](https:\/\/www.kaggle.com\/headsortails\/song-popularity-eda-live-coding-fun)\n   * [\ud83c\udfbbSong Popularity EDA-Coding Fun(Python Version)\ud83c\udfbb](https:\/\/www.kaggle.com\/snikhil17\/song-popularity-eda-coding-fun-python-version)\n   * [Song Popularity Prediction - \ud83d\udccaEDA + MODELLING\ud83d\udcca](https:\/\/www.kaggle.com\/odins0n\/song-popularity-prediction-eda-modelling)\n   \nPlease upvote these notebooks. They contain great ideas! Also, thank you Abhishek Thakur for organizing this competition and Martin Henze for the amazing explanations and notebook!","63a541fe":"### Are the missing values somehow correlated?","18c0db7d":"Now, we look at the characteristics of the data. We want to understanding how many missing values there are and also at scale of the variables.","6dd5e6e4":"### Main takeaways\n\nWe observe the following:\n\n* The shape of the train data is 40,000x14. This is a relatively small dataset.\n* There are 13 numeric variables (we removed the id column).\n* 8 out of 13 variables have missing values.\n* Scale varies a lot.","d6996034":"### What's the distribution of the target variable (song_popularity)?\n\nThe target variable *song_popularity* has values 0 and 1. Hence, we can treat it as a categorical.","c72b71a6":"# EDA\n\nFirst, we analyze the train data to find out what is the distribution of the variables and possible transformations we might do when creating a model.\n\n## Summary of the train data\n\nWe have a look at the train data characteristis. More specifically, we want to know the following:\n\n   * Shape of the data\n   * Variable types\n   * Missing values\n   * Scale (how the scale varies according to the variables)\n  ","cdb85844":"### What's the distribution of the predictors?","047c8336":"As we can see, the distribution of popular and not popular songs don't vary significantly.\n\n\n### What is the correlation amongst all of the variables?","b145aa7d":"The visualisation above shows that we have an imbalanced dataset. The majority of the data is of class 0.","bcbb00d4":"## Bivariate analysis\nNow, we look at the relation among the features and the target variables."}}