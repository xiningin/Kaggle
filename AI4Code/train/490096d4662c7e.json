{"cell_type":{"28f99540":"code","884d4b31":"code","829453f4":"code","bd54e393":"code","e3f3dfb1":"code","1244f6ae":"code","a249187f":"code","4912b04c":"code","ab57720b":"code","351eb3aa":"code","6141ad1d":"code","0771f53b":"code","05699f62":"code","0278d0b5":"code","525808a9":"code","7585438d":"code","91604adc":"code","c059c602":"code","4d6e1bc4":"code","80a155d5":"code","5233e151":"code","4819ffb8":"code","ac764cf6":"code","7aa5d52c":"code","1a3a86dc":"code","f896fe0f":"code","2b1c2795":"code","00d22725":"code","425f2046":"code","6b7f459f":"code","936f0182":"code","49405af1":"code","d80176d0":"code","d11c53ea":"code","76c1d20a":"code","16314a58":"code","0b14dbf7":"code","d3e7d0cc":"code","11807647":"code","06ed48bd":"code","e4f6ebde":"code","9c7c730e":"code","9463d16d":"code","d16c8148":"code","6b22cd61":"code","89d03b47":"code","8496c931":"code","d92a342f":"code","60d02aa5":"code","4c9a3a94":"markdown","1d1bd131":"markdown","26079b28":"markdown","6875a037":"markdown","ecb5d588":"markdown","a0afaaf1":"markdown","dbc07589":"markdown","e2b8d3e2":"markdown","430c80e1":"markdown","03483390":"markdown","09e55b3c":"markdown","c49299be":"markdown"},"source":{"28f99540":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n\n# Visualisation libraries\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\nimport plotly.express as px\nimport plotly.graph_objects as go\n# import folium \n# from folium import plugins\n\nplt.rcParams['figure.figsize'] = 15, 12\n\n# Disable warnings \nimport warnings\nwarnings.filterwarnings('ignore')\n\nfrom sklearn.preprocessing import PolynomialFeatures\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.linear_model import Ridge\nfrom math import sqrt\n\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.metrics import mean_absolute_error,mean_squared_error\nfrom sklearn.model_selection import GridSearchCV,TimeSeriesSplit\n\nfrom joblib import dump,load","884d4b31":"df = pd.read_csv('..\/input\/covid19-in-india\/covid_19_india.csv',parse_dates=True)\ndf.shape","829453f4":"df.drop('Sno',axis=1,inplace=True)","bd54e393":"df.head()","e3f3dfb1":"df.drop(['ConfirmedIndianNational','ConfirmedForeignNational'],axis=1,inplace=True)","1244f6ae":"df.head()","a249187f":"df.tail()","4912b04c":"df.dropna(how='any',axis=0,inplace=True)","ab57720b":"df['Cured']=df['Cured'].apply(lambda x: int(x))\ndf['Deaths']=df['Deaths'].apply(lambda x: int(x))\n","351eb3aa":"current_date=df['Date'].iat[-1]\ntotal_so_far = df[df['Date']==current_date]['Confirmed'].sum()\nprint(f\"Total cases in India as of {current_date} are {total_so_far}\")","6141ad1d":"df['active_cases']=df['Confirmed']-df['Cured']-df['Deaths']\ndf[df['Date']==current_date][['State\/UnionTerritory','Cured','Deaths','Confirmed']].sort_values('Confirmed',ascending=False).style.background_gradient(cmap='Reds').hide_index()\n","0771f53b":"df[df['Date']==current_date][['State\/UnionTerritory','active_cases']].sort_values('active_cases',ascending=False).rename(columns= {'active_cases':'Active Cases'}).style.background_gradient(cmap='Reds').hide_index()","05699f62":"\nf, ax = plt.subplots(figsize=(12, 10))\ndata = df[df['Date']==current_date][['State\/UnionTerritory','Cured','Deaths','Confirmed','active_cases']]\ndata.sort_values('Confirmed',ascending=False,inplace=True)\nsns.set_color_codes(\"pastel\")\nsns.barplot(x=\"Confirmed\", y=\"State\/UnionTerritory\", data=data,label=\"Total\", color=\"r\")\n\nsns.set_color_codes(\"muted\")\nsns.barplot(x=\"Cured\", y=\"State\/UnionTerritory\", data=data, label=\"Cured\", color=\"g\")\n\nmax_cases=data['Confirmed'].iat[0]\n\nax.legend(ncol=2, loc=\"lower right\", frameon=True)\nax.set(xlim=(0, max_cases), ylabel=\"\",xlabel=\"Cases\")\nsns.despine(left=True, bottom=True)","0278d0b5":"datewise_df= df[['Date','Confirmed','Cured','Deaths']].groupby(['Date'],sort=False).sum().reset_index()\n\n\ndatewise_df","525808a9":"fig = go.Figure()\nfig.add_trace(go.Scatter(x=datewise_df['Date'], y = datewise_df['Confirmed'], mode='lines+markers',name='Total Cases'))\nfig.update_layout(title_text='Trend of Coronavirus Cases in India (Cumulative cases)',xaxis_title='Date',yaxis_title='Confirmed Cases',plot_bgcolor='rgb(230, 230, 230)')\nfig.show()\n\n","7585438d":"# fig = go.Figure()\n# fig.add_trace(go.Scatter(x=datewise_df['Date'], y = np.log10(datewise_df['Confirmed']), mode='lines+markers',name='Total Cases in Log Scale'))\n# fig.update_layout(title_text='Trend of Coronavirus Cases in India (Cumulative cases)',xaxis_title='Date',yaxis_title='Confirmed Cases in Log Scale',plot_bgcolor='rgb(230, 230, 230)')\n# fig.show()\n\n","91604adc":"fig = px.bar(datewise_df, x=\"Date\", y=\"Confirmed\", barmode='group', height=400)\nfig.update_layout(title_text='Coronavirus Cases in India on daily basis',plot_bgcolor='rgb(230, 230, 230)')\n\nfig.show()","c059c602":"age_df= pd.read_csv('..\/input\/covid19-in-india\/AgeGroupDetails.csv')\nage_df.drop('Sno',axis=1,inplace=True)\n","4d6e1bc4":"age_df","80a155d5":"individual_df= pd.read_csv('..\/input\/covid19-in-india\/IndividualDetails.csv')\nindividual_df.tail()","5233e151":"total_data= pd.read_csv('https:\/\/raw.githubusercontent.com\/owid\/covid-19-data\/master\/public\/data\/owid-covid-data.csv')\ntotal_data_ind=total_data[total_data['location']=='India']","4819ffb8":"total_data_ind.tail()","ac764cf6":"total_data.columns","7aa5d52c":"fig = px.bar(total_data_ind, x=total_data_ind[\"date\"], y=total_data_ind[\"new_tests\"], barmode='group', height=400)\nfig.update_layout(title_text='New tests in India',xaxis_title='Date',yaxis_title='New Tests',plot_bgcolor='rgb(230, 230, 230)')\nfig.show()\n\n","1a3a86dc":"import datetime","f896fe0f":"days = np.array([i for i in range(len(datewise_df['Date']))]).reshape(-1,1)\nconfirmed_cases=np.array(datewise_df['Confirmed']).reshape(-1,1)\ncured_cases=np.array(datewise_df['Cured']).reshape(-1,1)\ndeath_cases=np.array(datewise_df['Deaths']).reshape(-1,1)","2b1c2795":"days_in_future=20\nfuture_forecast = np.array([i for i in range(len(datewise_df['Date'])+days_in_future)]).reshape(-1,1)\nadjusted_dates = future_forecast[:-days_in_future]\n","00d22725":"start=datewise_df['Date'].iat[0]\nstart_date = datetime.datetime.strptime(start,'%d\/%m\/%y')\nfuture_forecast_dates = []\nfor i in range(len(future_forecast)):\n    future_forecast_dates.append((start_date+datetime.timedelta(days=i)).strftime('%d\/%m\/%y'))","425f2046":"from sklearn.model_selection import train_test_split","6b7f459f":"X_train_confirmed,X_test_confirmed, y_train_confirmed, y_test_confirmed = train_test_split(days,confirmed_cases,test_size=0.25,shuffle=False,stratify=None)\n","936f0182":"poly = PolynomialFeatures(degree=3)\npoly.fit(X_train_confirmed)\npoly_X_train_confirmed = poly.transform(X_train_confirmed)\npoly_X_test_confirmed = poly. transform(X_test_confirmed)\npoly_future_forecast = poly. transform(future_forecast)","49405af1":"param_grid={'poly__degree':[2,3,4,5,6,7,8]}\npipeline = Pipeline(steps=[('poly', PolynomialFeatures()), ('ridge', Ridge())])\ntscv = TimeSeriesSplit(n_splits=2)\ngrid_search = GridSearchCV(pipeline, param_grid, cv=tscv,\n                           scoring='neg_mean_squared_error',\n                           return_train_score=True)\ngrid_search.fit(X_train_confirmed, y_train_confirmed)","d80176d0":"test_linear_pred=grid_search.predict(X_test_confirmed)\nprint(\"MAE: \",mean_absolute_error(y_test_confirmed,test_linear_pred))\nprint(\"RMSE: \",sqrt(mean_squared_error(y_test_confirmed,test_linear_pred)))","d11c53ea":"plt.plot(y_test_confirmed)\nplt.plot(test_linear_pred)\nplt.legend(['Test Data',f'Polynomial regression with d={grid_search.best_params_[\"poly__degree\"]}'])\nplt.show()","76c1d20a":"future_linear_pred=grid_search.predict(future_forecast)\n\n\npred_df=pd.DataFrame({'Date':pd.Series(future_forecast_dates),'Cases':np.array(future_linear_pred).reshape(-1,)})\n\n\nactual_df= pd.DataFrame({'Date':np.array(future_forecast_dates[:-days_in_future]).reshape(-1,),'Cases':confirmed_cases.reshape(-1,)})","16314a58":"fig = go.Figure()\nfig.add_trace(go.Scatter(x=pred_df['Date'], y = pred_df['Cases'] , mode='lines+markers',name='Prediction',line={'color':'red'}))\nfig.add_trace(go.Scatter(x=actual_df['Date'], y =actual_df['Cases'], mode='lines+markers',name='Actual so far',line={'color':'blue'}))\nfig.update_layout(title_text='Prediction of Coronavirus Cases in India',xaxis_title='Date',yaxis_title='Corona Virus Cases',plot_bgcolor='rgb(230, 230, 230)')\nfig.show()","0b14dbf7":"from IPython.display import display, Markdown\ndisplay(Markdown(f'## <font color=\"#661400\">The number of cases might reach upto {int(pred_df[\"Cases\"].iat[-1])} on {pred_df[\"Date\"].iat[-1]} as per LinearRegression predictor<\/font>'))","d3e7d0cc":"from sklearn.svm import SVR","11807647":"param_grid_svr = {'degree':[4,5,6]}\ntscv = TimeSeriesSplit(n_splits=2)\ngrid_search = GridSearchCV(SVR(kernel='poly',gamma=0.01), param_grid_svr, cv=tscv,\n                           scoring='neg_mean_squared_error',\n                           return_train_score=True,n_jobs=-1)\ngrid_search.fit(X_train_confirmed, y_train_confirmed)\n","06ed48bd":"test_svr_pred=grid_search.predict(X_test_confirmed)\nprint(\"MAE: \",mean_absolute_error(y_test_confirmed,test_svr_pred))\nprint(\"RMSE: \",sqrt(mean_squared_error(y_test_confirmed,test_svr_pred)))","e4f6ebde":"grid_search.best_params_","9c7c730e":"plt.plot(y_test_confirmed)\nplt.plot(test_svr_pred)\nplt.legend(['Test Data','SVR regression'])\nplt.show()","9463d16d":"future_svr_pred=grid_search.predict(future_forecast)\n\n\npred_df_svr=pd.DataFrame({'Date':pd.Series(future_forecast_dates),'Cases':np.array(future_svr_pred).reshape(-1,)})","d16c8148":"fig = go.Figure()\nfig.add_trace(go.Scatter(x=pred_df_svr['Date'], y = pred_df_svr['Cases'] , mode='lines+markers',name='Prediction using SVR',line={'color':'red'}))\nfig.add_trace(go.Scatter(x=actual_df['Date'], y =actual_df['Cases'], mode='lines+markers',name='Actual so far',line={'color':'blue'}))\nfig.update_layout(title_text='Prediction of Coronavirus Cases in India (SVR)',xaxis_title='Date',yaxis_title='Corona Virus Cases',plot_bgcolor='rgb(230, 230, 230)')\nfig.show()","6b22cd61":"from IPython.display import display, Markdown\ndisplay(Markdown(f'## <font color=\"#661400\">The number of cases might reach upto {int(pred_df_svr[\"Cases\"].iat[-1])} on {pred_df_svr[\"Date\"].iat[-1]} as per support vector regression predictor<\/font>'))","89d03b47":"#storing the model\nsvr_model=grid_search.best_estimator_\ndump(svr_model,'svr_model.joblib')","8496c931":"svr_model=load('svr_model.joblib')","d92a342f":"future_svr_pred=svr_model.predict(future_forecast)\npred_df_svr=pd.DataFrame({'Date':pd.Series(future_forecast_dates),'Cases':np.array(future_svr_pred).reshape(-1,)})","60d02aa5":"fig = go.Figure()\nfig.add_trace(go.Scatter(x=pred_df_svr['Date'], y = pred_df_svr['Cases'] , mode='lines+markers',name='Prediction using SVR',line={'color':'red'}))\nfig.add_trace(go.Scatter(x=actual_df['Date'], y =actual_df['Cases'], mode='lines+markers',name='Actual so far',line={'color':'blue'}))\nfig.update_layout(title_text='Prediction of Coronavirus Cases in India (SVR)',xaxis_title='Date',yaxis_title='Corona Virus Cases',plot_bgcolor='rgb(230, 230, 230)')\nfig.show()","4c9a3a94":"## First let's start with polynomial features","1d1bd131":"## Polynomial regression","26079b28":"## Predicting for future","6875a037":"## Splitting the dataset into train and test","ecb5d588":"### Log Scale Trend ","a0afaaf1":"## Statewise distribution of cases","dbc07589":"## Analyzing the trend in India","e2b8d3e2":"## Reading the dataset","430c80e1":"## Confirmed vs Cured figures","03483390":"## Predicting for future","09e55b3c":"## Active cases distribution","c49299be":"## Prediction using support vector regressor"}}