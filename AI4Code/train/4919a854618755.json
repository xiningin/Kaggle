{"cell_type":{"b29630dd":"code","a706e213":"code","8a8ce652":"code","d474294f":"code","693206ed":"code","698bb27f":"code","83ed30b4":"code","06f08f6b":"code","dea971a2":"code","d40f0886":"code","5622832b":"code","50bcfa25":"code","013d85c1":"code","d0dc01d5":"markdown","674b945c":"markdown","58f70875":"markdown","11298383":"markdown","8c7aa050":"markdown","a2f6c81e":"markdown","e7ffd860":"markdown","f7cdf074":"markdown","6be9f6d1":"markdown","d7dade1c":"markdown","bd369cf6":"markdown","3db0c5af":"markdown","41bab910":"markdown","b4d91f25":"markdown","928c4463":"markdown","b136af41":"markdown","8eb765ed":"markdown","72cbb432":"markdown"},"source":{"b29630dd":"pip install lightautoml","a706e213":"# Standard python libraries\nimport os\nimport time\n\n# Installed libraries\nimport numpy as np\nimport pandas as pd\nfrom sklearn.metrics import roc_auc_score\nfrom sklearn.model_selection import train_test_split\n\n# Imports from our package\nfrom lightautoml.automl.presets.whitebox_presets import WhiteBoxPreset\nfrom lightautoml.dataset.roles import DatetimeRole\nfrom lightautoml.tasks import Task\nfrom lightautoml.report.report_deco import ReportDecoWhitebox","8a8ce652":"N_THREADS = 4 # threads cnt for lgbm and linear models\nRANDOM_STATE = 42 # fixed random state for various reasons\nTEST_SIZE = 0.2 # Test size for metric check\nTIMEOUT = 300 # Time in seconds for automl run\nTARGET_NAME = 'TARGET' # Target column name","d474294f":"np.random.seed(RANDOM_STATE)","693206ed":"%%time\n\ndata = pd.read_csv('..\/input\/lama-datasets\/sampled_app_train.csv')\ndata.head()","698bb27f":"%%time\n\ndata['BIRTH_DATE'] = (np.datetime64('2018-01-01') + data['DAYS_BIRTH'].astype(np.dtype('timedelta64[D]'))).astype(str)\ndata['EMP_DATE'] = (np.datetime64('2018-01-01') + np.clip(data['DAYS_EMPLOYED'], None, 0).astype(np.dtype('timedelta64[D]'))\n                    ).astype(str)\n\ndata['constant'] = 1\ndata['allnan'] = np.nan\n\ndata['report_dt'] = np.datetime64('2018-01-01')\n\ndata.drop(['DAYS_BIRTH', 'DAYS_EMPLOYED'], axis=1, inplace=True)","83ed30b4":"%%time\n\ntrain_data, test_data = train_test_split(data, \n                                         test_size=TEST_SIZE, \n                                         stratify=data[TARGET_NAME], \n                                         random_state=RANDOM_STATE)\nprint('Data splitted. Parts sizes: train_data = {}, test_data = {}'\n              .format(train_data.shape, test_data.shape))","06f08f6b":"train_data.head()","dea971a2":"%%time\n\ntask = Task('binary', )","d40f0886":"%%time\n\nroles = {'target': TARGET_NAME,\n         DatetimeRole(base_date=True, seasonality=(), base_feats=False): 'report_dt',\n         }","5622832b":"%%time \n\nautoml = WhiteBoxPreset(task = task, \n                       timeout = TIMEOUT,\n                       cpu_limit = N_THREADS,\n                       general_params={'report': True})\n\nRD = ReportDecoWhitebox()\nautoml_rd = RD(automl)\n\noof_pred = automl_rd.fit_predict(train_data, roles = roles)\nprint('oof_pred:\\n{}\\nShape = {}'.format(oof_pred, oof_pred.shape))","50bcfa25":"automl.get_config(path='wb_config.yml')","013d85c1":"%%time\n\ntest_pred = automl_rd.predict(test_data, report=True)\nprint('Prediction for test data:\\n{}\\nShape = {}'.format(test_pred, test_pred.shape))\n\nprint('Check scores...')\nprint('OOF score: {}'.format(roc_auc_score(train_data[TARGET_NAME].values,\n                                           oof_pred.data[:, 0])))\nprint('TEST score: {}'.format(roc_auc_score(test_data[TARGET_NAME].values,\n                                            test_pred.data[:, 0])))","d0dc01d5":"#  ==== AutoML preset usage ====\n\n\n## Step 1. Create Task","674b945c":"# Step 0.1. Import necessary libraries ","58f70875":"## Step 4. Predict to test data and check scores","11298383":"# Step 0.6. (Optional) Data splitting for train-test ","8c7aa050":"## Step 5. Report ","a2f6c81e":"# Step 0.3. Fix torch number of threads and numpy seed ","e7ffd860":"# Step 0.5. (Optional) Some user feature preparation ","f7cdf074":"To create AutoML model here we use `WhiteBoxPreset` preset.\n\n\nAll params we set above can be send inside preset to change its configuration:","6be9f6d1":"Roles setup here set target column and base date, which is used to calculate date differences:","d7dade1c":"## Step 3. Create AutoML from preset","bd369cf6":"# Step 0.4. Example data load ","3db0c5af":"Save new config template:","41bab910":"# Step 0.2. Parameters ","b4d91f25":"Block below can be omitted if you are going to train model only or you have specific train and test files:","928c4463":"Cell below shows some user feature preparations to create task more difficult (this block can be omitted if you don't want to change the initial data):","b136af41":"Report is [here](.\/lama_report\/lama_interactive_report.html)","8eb765ed":"# Step 0. Install LAMA","72cbb432":"## Step 2. Setup columns roles"}}