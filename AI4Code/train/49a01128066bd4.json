{"cell_type":{"1d706df1":"code","60f09069":"code","22353095":"code","9c4339c3":"code","2917c230":"code","102d078d":"code","bc66ef60":"code","04455deb":"code","8081a87b":"code","7e3fd94c":"code","8e3449cd":"code","edd6726e":"code","ab226707":"code","84a3077b":"code","b3fef8eb":"code","3ebcc55a":"code","9c2ce43c":"code","71a45cae":"code","282cf154":"code","ec5a014a":"code","23247357":"code","ee4e85cf":"code","ed80ea05":"code","7270b6bd":"code","15a4f64e":"code","d0ae6f9f":"code","343d4929":"code","15476114":"code","8bd07c22":"code","123b11a6":"code","7a1be2ec":"code","f5bcfd60":"code","32504aaa":"code","c4a6ebfb":"code","44fa9b63":"code","0423a3c9":"code","30612ddd":"code","7ed6e52e":"code","6c36f319":"code","06ad9631":"code","b5a06725":"code","f5233e4a":"code","a7e5d4ef":"code","22fde734":"code","39c88a71":"code","1fd6f16c":"code","bbaf264d":"code","8d383d9c":"code","51dba2d5":"code","bba760a6":"code","9f264d37":"code","d9897824":"code","6c75d4cc":"code","32aea928":"code","4d8c06d5":"code","99e0c9f6":"code","bc9a4258":"code","640d6710":"code","c976b76c":"code","2612276d":"code","5bcd0038":"code","d09a6050":"code","7516742b":"code","9f336efb":"code","40047e32":"code","08bfdca6":"code","5633170b":"code","73372a19":"code","265e021c":"code","041dda52":"code","9cbda737":"code","52abec13":"code","eca58668":"code","08da5920":"code","0c7b69af":"code","10d8a9f6":"code","0220a4ae":"code","26767d33":"code","c42e72e8":"code","1e656f3e":"code","020d2b21":"markdown","241dbd2b":"markdown","3a135823":"markdown","cf4f256b":"markdown","c81a0bca":"markdown","e7693fc0":"markdown","3b6c8cb3":"markdown","64ab83db":"markdown","ee726fea":"markdown","bf47553c":"markdown","f1d99003":"markdown","d1ee780c":"markdown","a81cbd54":"markdown","4af960f9":"markdown","c4f35a10":"markdown","184cd500":"markdown","31b81712":"markdown","e1c7c4a6":"markdown","b493b3c3":"markdown","4de79126":"markdown","82665f08":"markdown","a1179acf":"markdown","e8b00e9f":"markdown","b2a4aeef":"markdown","dfec6237":"markdown"},"source":{"1d706df1":"# import json\n# import os","60f09069":"# file = open('\/content\/drive\/MyDrive\/datasets\/cotton_disease\/Cotton Disease\/train\/kaggle.json')\n# f = json.load(file)","22353095":"# f","9c4339c3":"# os.environ['KAGGLE_CONFIG_DIR'] = '\/content\/drive\/My Drive\/kaggle'","2917c230":"# %cd \/content\/drive\/My Drive\/kaggle","102d078d":"# os.environ['KAGGLE_USERNAME'] = \"abhishekkumarsaini\" # username from the json file\n# os.environ['KAGGLE_KEY'] = \"ed58dc4d33dd5ed05e33cf59aa9266ee\" # key from the json file","bc66ef60":"# !kaggle datasets download -d fedesoriano\/stroke-prediction-dataset","04455deb":"# !unzip \\*.zip && rm *.zip ","8081a87b":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns","7e3fd94c":"data = pd.read_csv('..\/input\/stroke-prediction-dataset\/healthcare-dataset-stroke-data.csv')","8e3449cd":"data.head()","edd6726e":"data = data.drop('id', axis=1)","ab226707":"data.info()","84a3077b":"data.describe()","b3fef8eb":"columns = ['gender', 'age', 'hypertension', 'heart_disease', 'ever_married',\n       'work_type', 'Residence_type', 'avg_glucose_level', 'bmi',\n       'smoking_status', 'stroke']","3ebcc55a":"for c in columns:\n  if data[c].dtype == 'object':\n    print(data[c].value_counts())\n    print(\" \")","9c2ce43c":"data[data.bmi == 97.600]","71a45cae":"data = data.dropna(axis=0)","282cf154":"data.info()","ec5a014a":"data.drop(data[data.gender == 'Other'].index, inplace = True)","23247357":"data['stroke'].value_counts().plot(kind = 'pie', autopct=\"%.2f\", figsize=(6,6))","ee4e85cf":"sns.catplot(x='stroke',y='age',data= data)","ed80ea05":"sns.catplot(x='stroke', y='age', kind= 'box', data=data)","7270b6bd":"sns.catplot(y=\"age\", x=\"stroke\", hue=\"gender\",\n            kind=\"violin\", data=data)","15a4f64e":"sns.catplot(x=\"Residence_type\", kind=\"count\", palette=\"ch:.25\", data=data, hue='stroke')","d0ae6f9f":"for c in columns:\n  if data[c].dtype == 'object':\n    sns.catplot(x='stroke', kind='count',hue=c,data=data)","343d4929":"corr = data.corr()\ncorr['stroke'].sort_values(ascending= False)","15476114":"categorical_columns = []\nfor c in columns:\n  if data[c].dtype == 'object':\n    categorical_columns.append(c)\n","8bd07c22":"categorical_columns","123b11a6":"from sklearn.model_selection import train_test_split","7a1be2ec":"X_train , X_test, Y_train, Y_test = train_test_split(data, data['stroke'], test_size=.25, stratify=data['stroke'])","f5bcfd60":"X_train['stroke'].value_counts()","32504aaa":"X_test['stroke'].value_counts()","c4a6ebfb":"X_train = X_train.drop('stroke', axis=1)","44fa9b63":"X_test = X_test.drop('stroke', axis=1)","0423a3c9":"numerical_columns = []\nfor c in X_train.columns:\n  if X_train[c].dtype in ['float64','int64']:\n    numerical_columns.append(c)","30612ddd":"numerical_columns","7ed6e52e":"def make_dummy(b, colm):\n  return pd.get_dummies(b, columns= colm)","6c36f319":"X_train = make_dummy(X_train, categorical_columns)","06ad9631":"X_train.shape","b5a06725":"X_test = make_dummy(X_test, categorical_columns)","f5233e4a":"X_test.shape","a7e5d4ef":"from sklearn.preprocessing import StandardScaler\nscaller = StandardScaler() ","22fde734":"X_train = scaller.fit_transform(X_train)\nX_test = scaller.transform(X_test)","39c88a71":"Y_true_train = Y_train==1\nY_true_test = Y_test==1","1fd6f16c":"from sklearn.tree import DecisionTreeClassifier\nfrom sklearn.ensemble import RandomForestClassifier, AdaBoostClassifier\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.svm import SVC\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.metrics import confusion_matrix\nfrom sklearn import metrics","bbaf264d":"models = {'dt_clf':DecisionTreeClassifier(), 'for_clf':RandomForestClassifier(), 'k_clf':KNeighborsClassifier(), 'logistic_reg':LogisticRegression(), 'ada_boost': AdaBoostClassifier()}","8d383d9c":"results = []\nfor key in models:\n  model_name = models[key]\n  model = model_name\n  model.fit(X_train, Y_train)\n  pred = model.predict(X_test)\n\n  # pred = model_name.predict(X_test)\n  print('')\n  print(key)\n  print(confusion_matrix(Y_true_test, pred),'recall=', metrics.recall_score(Y_true_test, pred))","51dba2d5":"from imblearn.combine import SMOTETomek\nfrom imblearn.under_sampling import NearMiss","bba760a6":"smk = SMOTETomek(random_state=42)\nX_res,Y_res=smk.fit_resample(X_train,Y_train)","9f264d37":"Y_true_train_res = Y_res ==1","d9897824":"from collections import Counter\nprint('Original dataset shape {}'.format(Counter(Y_train)))\nprint('Resampled dataset shape {}'.format(Counter(Y_res)))","6c75d4cc":"results = []\nfor key in models:\n  model_name = models[key]\n  model = model_name\n  model.fit(X_res, Y_res)\n  pred = model.predict(X_test)\n\n  # pred = model_name.predict(X_test)\n  print('')\n  print(key)\n  print(confusion_matrix(Y_true_test, pred),'recall=', metrics.recall_score(Y_true_test, pred))","32aea928":"from sklearn.metrics import precision_recall_curve\nfrom sklearn.model_selection import cross_val_predict","4d8c06d5":"ada = AdaBoostClassifier()\nlog_reg = LogisticRegression()","99e0c9f6":"ada.fit(X_res, Y_res)","bc9a4258":"log_reg.fit(X_res, Y_res)","640d6710":"y_score = cross_val_predict(log_reg, X_res, Y_true_train_res, cv=3, method='decision_function')","c976b76c":"y_score.shape","2612276d":"import matplotlib.pyplot as plt","5bcd0038":"precisions, recalls, thresholds = precision_recall_curve(Y_true_train_res, y_score)","d09a6050":"def plot_precision_recall_vs_threshold(precisions, recalls, thresholds):\n  plt.plot(thresholds, precisions[:-1], 'b--', label = 'precision')\n  plt.plot(thresholds, recalls[:-1], 'g-', label = 'recall')\n  [...]\nplot_precision_recall_vs_threshold(precisions, recalls, thresholds)\nplt.show()  \n","7516742b":"y_score_ada = cross_val_predict(ada, X_res, Y_true_train_res, cv=3, method='decision_function')\nprecisions_ada, recalls_ada, thresholds_ada = precision_recall_curve(Y_true_train_res, y_score_ada)\ndef plot_precision_recall_vs_threshold(precisions_ada, recalls_ada, thresholds_ada):\n  plt.plot(thresholds_ada, precisions_ada[:-1], 'b--', label = 'precision')\n  plt.plot(thresholds_ada, recalls_ada[:-1], 'g-', label = 'recall')\n  [...]\nplot_precision_recall_vs_threshold(precisions_ada, recalls_ada, thresholds_ada)\nplt.show()  ","9f336efb":"threshold = 0\nlog_scores = log_reg.decision_function(X_res)\nlog_pred_threshold = log_scores>threshold","40047e32":"threshold_2 = 0\nada_scores = ada.decision_function(X_res)\nada_pred_threshold = ada_scores>threshold_2","08bfdca6":"ada_pred_threshold","5633170b":"log_pred_threshold","73372a19":"metrics.recall_score(Y_true_train_res, log_pred_threshold)","265e021c":"metrics.precision_score(Y_true_train_res, log_pred_threshold)","041dda52":"metrics.confusion_matrix(Y_true_train_res, log_pred_threshold)","9cbda737":"metrics.recall_score(Y_true_train_res, ada_pred_threshold)","52abec13":"metrics.precision_score(Y_true_train_res, ada_pred_threshold)","eca58668":"metrics.confusion_matrix(Y_true_train_res, ada_pred_threshold)","08da5920":"threshold_2 = 0\nada_scores_test = ada.decision_function(X_test)\nada_pred_test_threshold = ada_scores_test>threshold","0c7b69af":"metrics.confusion_matrix(Y_true_test, ada_pred_test_threshold)","10d8a9f6":"metrics.recall_score(Y_true_test, ada_pred_test_threshold)","0220a4ae":"metrics.precision_score(Y_true_test, ada_pred_test_threshold)","26767d33":"threshold_2 = 0\nlog_scores_test = log_reg.decision_function(X_test)\nlog_pred_test_threshold = log_scores_test>threshold_2","c42e72e8":"metrics.recall_score(Y_true_test, log_pred_test_threshold)","1e656f3e":"metrics.precision_score(Y_true_test, log_pred_test_threshold)","020d2b21":"# **Exploratory data analysis uisng seaborn library.**","241dbd2b":"Plotting precision and recall against threshold values for logistic regression model. ","3a135823":"# Importing some important libraries, loading the dataset and gaining some basic insights about the data. ","cf4f256b":"This shows that most of the people getting the stroke are from the age group of 60 to 80.","c81a0bca":"Plotting precision and recall against threshold values for logistic regression model. ","e7693fc0":"calculating precision and recall score on ada boost model model with threshold being 0 that is selected from the precision - recall curve against the different threshold values.","3b6c8cb3":"Conclusions:\n1. people living in urban are getting more stroke.\n2. people in private sector getting more strokes.\n","64ab83db":"Now let's evaluate our models on test data too.","ee726fea":"Performing oversampling. I have selected oversampling because the amount of data available is very less.","bf47553c":"Train_Test split using stratified sampling. I used stratified sampling so that both train and test data gets same ratio of positive and negative class data.\n\n---\n\n","f1d99003":"# Below 8 line of code are for to download dataset directly to the google drive and to unzip it. This step saves a lot of time for those using google collab on a regular basis.","d1ee780c":"Seperating the categorical features from the other features and finding out the count of categories.","a81cbd54":"Listing out all categorical columns.","4af960f9":"From above testing, scores of ada boost classifier model is very promising. It is giving descent recall and precision score.","c4f35a10":"This shows that logistic regression and ada boost is having descent recall score.","184cd500":"This shows that our dataset is very unbalanced. We should keep this in mind while building our model and selecting the performance matrics. We can do undersampling or oversampling for the unbalanced dataset.","31b81712":"calculating precision and recall score on logistic regression model with threshold being 0 that is selected from the precision - recall curve against the different threshold values. ","e1c7c4a6":"decision function of the model returns the probabilities.","b493b3c3":"Standardizing both test and train data so that model training becomes fast.","4de79126":"Creating a function that will convert all categorical features into the dummy variables. It is like one_hot encoding.","82665f08":" Droping only one value that is gender[other] which have only one value.","a1179acf":"# Data preprocessing.","e8b00e9f":"Below what we are going to do is that training different classifier model and will compute recall value. I have selected the recall as the performance matrics because no person should me miss diagnosed as he\/she will not  have stroke.\n# note \nfirst i will do this step before doing any type of sampling. ","b2a4aeef":"# Any suggestions and corrections are warmly welcomed.\n# Thankyou!","dfec6237":"Conclusions:\nIt seems that our ada boost clasifier was over fitting over our training data, whereas logistics regression model perfomed well comparatively.\nWe can tune our model to achieve better recall and precision score."}}