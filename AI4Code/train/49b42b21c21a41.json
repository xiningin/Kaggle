{"cell_type":{"c6b3d726":"code","1e178617":"code","b5860010":"code","9cfccb4f":"code","19442847":"code","81f1d311":"code","68f489b4":"code","99f73fa5":"code","57f13f45":"code","b700d6a9":"code","3a1a9b46":"code","5c17b07e":"code","827c8c02":"code","1947dd8d":"code","bc4f9eef":"code","425680c7":"code","228f2fca":"code","5b9e232a":"code","b635bd16":"code","4adc5a8f":"code","bd562e95":"code","543ec3b1":"code","47364463":"code","006be5cf":"code","d284214f":"code","3bc7a4ec":"markdown","416f2e4d":"markdown","00e39098":"markdown","d6a0ae5c":"markdown","76c15910":"markdown","f8d04134":"markdown","bad44262":"markdown","4237df2b":"markdown","5693e6f2":"markdown","07cdb3b2":"markdown","afe0d623":"markdown","640d789b":"markdown","b72d1d4f":"markdown","daf840a9":"markdown","d881583f":"markdown","b169c780":"markdown","c278c8a1":"markdown","73d72b0c":"markdown","8bcb3dd3":"markdown","efca23d4":"markdown","55f50bba":"markdown","06394fe0":"markdown","d1ea1bd2":"markdown","19f834f4":"markdown","f25e7123":"markdown","0c99ea77":"markdown","6ab81a01":"markdown","f8ced12e":"markdown"},"source":{"c6b3d726":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","1e178617":"import pandas as pd\nimport numpy as np","b5860010":"df = pd.read_csv('..\/input\/vehicle-dataset-from-cardekho\/car data.csv')\ndf.head()","9cfccb4f":"import matplotlib.pyplot as plt\nimport seaborn as sns\nsns.heatmap(df.isnull(),cbar=False,yticklabels=False)\ndf.isnull().sum()","19442847":"Car_detail = df.Car_Name.unique()\nCars = pd.Series([i.split()[0] for i in Car_detail]).unique()\nCars","81f1d311":"MS_cars = Cars[:14]\nToyota_cars = Cars[14:19]\nHonda = ['Activa']\nHyundai_cars = Cars[32:]","68f489b4":"df['Car_Company'] = df['Car_Name'].apply(lambda x:x.split()[0])\ndf.Car_Company.replace(MS_cars,'Maruti Suzuki',inplace=True)\ndf.Car_Company.replace(Toyota_cars,'Toyota',inplace=True)\ndf.Car_Company.replace(Honda,'Honda',inplace=True)\ndf.Car_Company.replace(Hyundai_cars,'Hyundai',inplace=True)\ndf.Car_Company.replace(['land','Royal'],['Land Rover','Royal Enfield'],inplace=True)\ndf.Car_Company.unique()","99f73fa5":"df['Percent_resale'] = ( df['Selling_Price'] \/ df['Present_Price'] )*100","57f13f45":"sns.set_theme('paper')\nCompany_analysis = df.groupby('Car_Company')['Percent_resale'].mean()\nCompany_analysis = pd.concat([Company_analysis,100-Company_analysis],axis=1)\nCompany_analysis.plot.bar(stacked=True,legend=False,color=['Blue','Slategrey'])\nplt.ylabel('Percent Resale')\nplt.xlabel('Company')\nCompany_analysis.iloc[:,0]","b700d6a9":"import matplotlib.pyplot as plt\nimport seaborn as sns\ndf['Years_Old'] = df['Year'].apply(lambda x:2021-x)\ndf.groupby('Years_Old').Percent_resale.mean().plot(kind = 'line')\nplt.ylabel('Percent resale');","3a1a9b46":"sns.scatterplot(df['Kms_Driven'],df['Percent_resale']);","5c17b07e":"df.groupby('Fuel_Type').Percent_resale.mean().plot(kind='barh')\nplt.xlim([0,100])\nplt.xlabel('Percent resale');\ndf.groupby('Fuel_Type').Percent_resale.mean()","827c8c02":"df.groupby('Seller_Type').Percent_resale.mean().plot(kind='barh')\nplt.xlim([0,100]);","1947dd8d":"df.groupby('Transmission').Percent_resale.mean().plot(kind='barh')\nplt.xlim([0,100]);","bc4f9eef":"df.groupby('Owner').Percent_resale.mean().plot(kind='bar')\nplt.ylim([0,100]);","425680c7":"df.drop(['Car_Name','Year','Percent_resale'],axis=1,inplace=True)","228f2fca":"num_cols = df._get_numeric_data().columns\ncat_cols = list(set(df.columns) - set(num_cols))\nfor col in cat_cols:\n    cat = pd.get_dummies(df[col],drop_first=True)\n    df = pd.concat([df,cat],axis=1)\n    df.drop(col,axis=1,inplace=True)\nprint(df.shape)\ndf.head()","5b9e232a":"ax = plt.figure(figsize=(20,10))\nsns.heatmap(df.corr(),annot=True,cbar=False)","b635bd16":"from sklearn.model_selection import train_test_split\nX = df.drop(['Selling_Price'],axis=1)\ny = df['Selling_Price']\nx_train , x_test , y_train , y_test = train_test_split(X,y,test_size=0.2,random_state=22)","4adc5a8f":"from sklearn.ensemble import ExtraTreesRegressor\nfrom sklearn.metrics import mean_squared_error\ntest_model = ExtraTreesRegressor()\ntest_model.fit(x_train,y_train)\nfeat_imp = dict(zip(x_train.columns,test_model.feature_importances_))\nprint(mean_squared_error(y_test,test_model.predict(x_test)))\nfeat_imp","bd562e95":"X = df.drop(['Selling_Price','UM','Suzuki'],axis=1)\ny = df['Selling_Price']\nx_train , x_test , y_train , y_test = train_test_split(X,y,test_size=0.2,random_state=22)\ntest_model.fit(x_train,y_train)\nfeat_imp = dict(zip(x_train.columns,test_model.feature_importances_))\nprint(mean_squared_error(y_test,test_model.predict(x_test)))\nfeat_imp","543ec3b1":"from sklearn.ensemble import RandomForestRegressor\nfrom sklearn.model_selection import RandomizedSearchCV\nreg = RandomForestRegressor(bootstrap=True,oob_score=True)\nprm_grid = dict(n_estimators = [100,200,300,400,500,600,700,800,900,1000],\n               max_depth = [None , 4 , 7 , 10 , 12 , 15 , 20],\n               min_samples_split = [2,5,8,10,12,15,20])\ngrid = RandomizedSearchCV(reg , prm_grid , n_iter = 5 ,scoring ='neg_root_mean_squared_error', cv=5 , verbose = 5)\ngrid.fit(X,y)","47364463":"print(grid.best_score_)\nprint(grid.best_estimator_)\nparam = grid.best_params_\nparam","006be5cf":"reg =  RandomForestRegressor(**param , bootstrap=True,oob_score=True)\nreg.fit(X,y)\nreg.oob_score_","d284214f":"reg.predict(np.array([6.5,33000,0,8,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0]).reshape(1,-1))","3bc7a4ec":"'UM' and 'Suzuki' has really less feature importance , it  might be because we don't have sufficient data for the specific category , so its better for our model to drop these features.","416f2e4d":"**Here as well no significant difference between both categories**","00e39098":"### 2. Years\n           Its logical that the older the car will be , cheaper it would sell\n           So we will use 'Years_Old' feature rather than the feature 'Year' which tells in which year the car was\n           bought.(We will use 2021 as our present year)","d6a0ae5c":"**Clearly we can see there is a difference in average percent resale for each company, \nFor eg: we can see evident difference between percent resale of cars of Land Rover and Maruti Suzuki!**","76c15910":"### 3.Kms Driven\n        Kms_Driven is the value of how much the car has been driven since when it was purchased","f8d04134":"Dropping required columns from our data","bad44262":"# Checking for Null Values","4237df2b":"### 6.Transmission\n     Whether the car had manual transmission or automatic transmission","5693e6f2":"### 4.Fuel type\n     Diesel cars should sell better over petrol cars as they have better mileage but the contrary fact is \n     that they are hard to maintain hence that should decrease their value. Let's see what our data tells us about that.","07cdb3b2":"**We can see that the data corresponds to our assumption**","afe0d623":"### 5.Seller Type\n     It gives us information whether it's being sold by a dealer or an individual","640d789b":"# Preparing our Model","b72d1d4f":"Diesel and Petrol feature are highly negatively correlated, it makes sense as we do not have a lot of CNG cars in our data, so if a car is not a diesel car, there is a high probability that the car will be petrol. This may cause the problem of Multi Collinearity and decrease our model's performance, but as we are using Random Forest Regressor multicollinearity won't be an issue with our model.","daf840a9":"**No Null Values in our data!**","d881583f":"## Please Upvote if you find my notebook worth it.","b169c780":"**As we can see car value decreases as no. of owner increases**","c278c8a1":"**Diesel performs slightly better than petrol but the difference is not very significant, while CNG lags behind significantly**","73d72b0c":"**Getting dummy values for Categorical Data**","8bcb3dd3":"**We can't see any significant difference between both the categories**","efca23d4":"### 7. Owner\n     Whether it is being sold by first owner or second\/third , logically if the car is not from first owner \n     it should deacrease its value","55f50bba":"## Checking Impportance of Each Feature","06394fe0":"# Loading Data","d1ea1bd2":"**Splitting data into train data and validation data**","19f834f4":"### Hyper Parameter Tuning\nWe are using Random Forest regressor for our model, and its important for our model to get the right parameters , hence we will use Randomizedsearch Cross Validation for the same","f25e7123":"**It is clearly evident that the selling price drops as the total Km driven by the car increases**","0c99ea77":"# Feature Analysis","6ab81a01":"### **1. Car Name**                                       \n    Clearly Unique Car Names won't help our Model and also won't be feasible.\n    But Car Company's reputation plays a big role in deciding resale value for a car\n    so we try to extract out Company's Name from 'Car_Name'.  ","f8ced12e":"**We can Judge importance of our Features using Percent resale for each car\nWhere Percent resale is percent of original price at which it is being sold.**"}}