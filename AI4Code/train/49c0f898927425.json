{"cell_type":{"4e86b486":"code","5ef4c882":"code","ed27b500":"code","23788a02":"code","8926fc42":"code","b28bcbc9":"code","cb49653e":"code","0a81ccfb":"code","f8bb7009":"code","c46eebab":"code","26cbeb54":"code","df326842":"code","f2be596c":"code","677e7e77":"code","3055f501":"code","de4e20d4":"code","7d8a2905":"code","8308ba2f":"code","d0dd87fe":"code","e603a184":"code","9ed932d5":"code","d347798f":"code","bcc1fa05":"code","fbe3803c":"code","a83f6216":"code","908dfb37":"code","62e1f41f":"code","51d70211":"code","a6340ebb":"code","4ec70cf1":"code","e5c4f853":"code","d5635f0c":"code","77c16358":"code","3d03465e":"code","3ec2b399":"code","89351132":"code","21fa3578":"code","71764db4":"code","37f6ae2b":"code","76dcced2":"code","e980334e":"code","ac5463d7":"code","62403c5d":"code","0c053c07":"code","4a8bf231":"code","bdd2bbd7":"code","fcd0c89a":"code","930dd8c2":"code","93010df4":"code","d767f250":"code","9221ca62":"code","5180b647":"code","3f0c711e":"code","98245afe":"code","6d1f6aee":"code","306ef1ab":"code","134d5508":"markdown","8d6270bf":"markdown","0a4170ab":"markdown","dd9ddb18":"markdown","40e3111c":"markdown","aad04dba":"markdown","f4149707":"markdown","ad3ad627":"markdown","8aabdb22":"markdown","17084ba3":"markdown","5d7445cf":"markdown","d9f8a566":"markdown","a9284776":"markdown","420cd1ef":"markdown","c746a0e6":"markdown","2e7fc557":"markdown","ec8d092a":"markdown","951912b9":"markdown","1e5bd25c":"markdown","c2db33ed":"markdown","3a987ea5":"markdown","bd8d8ccf":"markdown","27d129d9":"markdown","1c1ed6a9":"markdown","c6d57dc3":"markdown","b0aa9de3":"markdown","0c8fb506":"markdown","b2ca41c2":"markdown","5d2eb14c":"markdown"},"source":{"4e86b486":"#Load libraries\n\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport datetime\n\n#Load dataset\ndf = pd.read_csv('..\/input\/marketing-data\/marketing_data.csv')\n\n#Get to know the dataset and display all columns\npd.set_option('display.max_columns', None)\ndf.head()","5ef4c882":"#Determine number of rows and columns\ndf.shape","ed27b500":"#Basic metrics\ndf.describe()","23788a02":"#Check features, datatypes and null values\ndf.info()","8926fc42":"#Remove white spaces:\ndf.columns = df.columns.str.replace(' ', '')\ndf.info()","b28bcbc9":"#Delete $\ndf['Income'] = df['Income'].str.replace('$', '')\n\n#Delete \",\"\ndf['Income'] = df['Income'].str.replace(',', '')\n\n#Convert string to float\ndf['Income'] = df['Income'].astype('float')","cb49653e":"df.info()","0a81ccfb":"#Boxplot of \"Income\" \ndf['Income'].plot(kind='box')","f8bb7009":"#Impute null values with median to minimize the effect of outliers\ndf['Income'] = df['Income'].fillna(df['Income'].median())","c46eebab":"df.info()","26cbeb54":"# Plot numerical variables\n\ndf_plot = df.drop(['ID', 'Education', 'Marital_Status', 'AcceptedCmp1', 'AcceptedCmp2', 'AcceptedCmp3', 'AcceptedCmp4', 'AcceptedCmp5', 'Response', 'Complain'], axis=1)\n\ndf_plot.plot(subplots=True, layout=(4,4), kind='box', figsize=(12,10))","df326842":"#Convert birthdate to age\nimport datetime\nnow = datetime.datetime.now()\ndf['Age'] = now.year - df['Year_Birth']","f2be596c":"df.head()","677e7e77":"df.describe()","3055f501":"#Check correlations with \"Age\"-feature\ndf_corr = df.corr(method='kendall').unstack().sort_values(kind=\"quicksort\", ascending=False).reset_index()\ndf_corr.rename(columns={\"level_0\": \"Feature 1\", \"level_1\": \"Feature 2\", 0: 'Correlation Coefficient'}, inplace=True)\ndf_corr[df_corr['Feature 1'] == 'Age']","de4e20d4":"df['Age'].median","7d8a2905":"df['Age'] = np.where(df['Age'] > 120, 51, df['Age'])\ndf.describe()","8308ba2f":"#Minors in household \ndf['Minors'] = df['Kidhome'] + df['Teenhome']\n\n#Convert Dt_Customer to Customer since\ndf['Customer_since'] = pd.DatetimeIndex(df['Dt_Customer']).year\ndf = df.drop(['Dt_Customer'], axis=1)\n\n#Total Amount Spent\ndf['TotalMnt'] = df['MntWines']+df['MntFruits']+df['MntMeatProducts']+df['MntFishProducts']+df['MntSweetProducts']+df[\"MntGoldProds\"]\n\n#Amount spent on luxury items\ndf['LuxMnt'] = df['MntWines']+df[\"MntGoldProds\"]\n\n#Number of total purchases\ndf['NumPurchases'] = df['NumDealsPurchases']+df['NumWebPurchases']+df['NumCatalogPurchases']+df['NumStorePurchases']\n\n#Number of remote purchases\ndf['RemPurchases']=df['NumWebPurchases']+df['NumCatalogPurchases'] \n\n#MarketingResonsiveness\ndf['Responsiveness'] = df['AcceptedCmp1']+df['AcceptedCmp2']+df['AcceptedCmp3']+df['AcceptedCmp4']+df['AcceptedCmp5']+df['Response']\n\n#Drop 'Year_Birth'\ndf = df.drop(['Year_Birth'], axis=1)\n\ndf.head()","d0dd87fe":"df.columns","e603a184":"df_corr = df.drop(columns=['ID', 'Kidhome', 'Teenhome']).select_dtypes(include=np.number)\n\n# Compute the correlation matrix\ncorr = df_corr.corr()\n\n# Generate a mask for the upper triangle\nmask = np.triu(np.ones_like(corr, dtype=bool))\n\n# Set up the matplotlib figure\nf, ax = plt.subplots(figsize=(19, 19))\n\n# Generate a custom diverging colormap\ncmap = sns.diverging_palette(20, 230, as_cmap=True)\n\n# Draw the heatmap with the mask and correct aspect ratio\nsns.heatmap(corr, mask=mask, cmap=cmap, vmin =-1, vmax=1, annot=True, fmt='.2f' ,center=0, square=True, linewidths=.5, cbar_kws={\"shrink\": .5})","9ed932d5":"df_corr = df.corr().unstack().sort_values(kind=\"quicksort\", ascending=False).reset_index()\ndf_corr.rename(columns={\"level_0\": \"Feature 1\", \"level_1\": \"Feature 2\", 0: 'Correlation Coefficient'}, inplace=True)\ndf_corr[df_corr['Feature 1'] == 'Income']","d347798f":"sns.boxplot(x='Education', y='Income', data=df)","bcc1fa05":"sns.boxplot(x='Minors', y='Income', data=df)","fbe3803c":"df_corr = df.corr().unstack().sort_values(kind=\"quicksort\", ascending=False).reset_index()\ndf_corr.rename(columns={\"level_0\": \"Feature 1\", \"level_1\": \"Feature 2\", 0: 'Correlation Coefficient'}, inplace=True)\ndf_corr[df_corr['Feature 1'] == 'Minors']","a83f6216":"import seaborn as sns\nsns.kdeplot(df['NumPurchases'], data = df, hue = 'Minors', fill=True)","908dfb37":"import seaborn as sns\nsns.kdeplot(df['RemPurchases'], data = df, hue = 'Minors', fill=True)","62e1f41f":"import seaborn as sns\nsns.kdeplot(df['NumWebVisitsMonth'], data = df, hue = 'Minors', fill=True)","51d70211":"df_corr = df.corr().unstack().sort_values(kind=\"quicksort\", ascending=False).reset_index()\ndf_corr.rename(columns={\"level_0\": \"Feature 1\", \"level_1\": \"Feature 2\", 0: 'Correlation Coefficient'}, inplace=True)\ndf_corr[df_corr['Feature 1'] == 'Responsiveness']","a6340ebb":"df_corr = df.corr().unstack().sort_values(kind=\"quicksort\", ascending=False).reset_index()\ndf_corr.rename(columns={\"level_0\": \"Feature 1\", \"level_1\": \"Feature 2\", 0: 'Correlation Coefficient'}, inplace=True)\ndf_corr[df_corr['Feature 1'] == 'Recency']","4ec70cf1":"sns.boxplot(x='Customer_since', y='TotalMnt', data=df)","e5c4f853":"sns.boxplot(x='Responsiveness', y='Recency', data=df)","d5635f0c":"sns.boxplot(x='Complain', y='TotalMnt', data=df)","77c16358":"sns.boxplot(x='Responsiveness', y='NumPurchases', data=df)","3d03465e":"sns.boxplot(x='Responsiveness', y='TotalMnt', data=df)","3ec2b399":"sns.catplot(x='Responsiveness', kind='count', palette='Blues', data=df)","89351132":"df_corr = df.corr().unstack().sort_values(kind=\"quicksort\", ascending=False).reset_index()\ndf_corr.rename(columns={\"level_0\": \"Feature 1\", \"level_1\": \"Feature 2\", 0: 'Correlation Coefficient'}, inplace=True)\ndf_corr[df_corr['Feature 1'] == 'NumWebVisitsMonth']","21fa3578":"df.columns","71764db4":"df_reg = df.drop(['ID'], axis=1)\ndf_reg.head()","37f6ae2b":"def create_dummies(df,column_name):\n    dummies = pd.get_dummies(df[column_name],prefix=column_name)\n    df = pd.concat([df,dummies],axis=1)\n    return df\n\ndf_reg = create_dummies(df_reg,\"Education\")\ndf_reg.head()","76dcced2":"df_reg = create_dummies(df_reg,\"Marital_Status\")\ndf_reg = create_dummies(df_reg,\"Country\")\ndf_reg.head()","e980334e":"df_reg.columns","ac5463d7":"df_reg_dropped = df_reg.drop(['Education', 'Marital_Status', 'Country', 'NumStorePurchases'], axis=1)\ndf_reg_dropped.head()","62403c5d":"X = df_reg_dropped\ny = df_reg['NumStorePurchases']","0c053c07":"from sklearn.model_selection import train_test_split\n\ntrain_X, test_X, train_y, test_y = train_test_split(df_reg_dropped, y, test_size=0.2,random_state=42)\n\nfrom sklearn.linear_model import LinearRegression \nfrom sklearn.metrics import mean_absolute_error\n\nreg = LinearRegression(normalize=True) \nreg.fit(train_X,train_y)\ny_pred = reg.predict(test_X)\nmean_absolute_error(test_y, y_pred)","4a8bf231":"import eli5\nfrom eli5.sklearn import PermutationImportance\n\nperm = PermutationImportance(reg, random_state=0).fit(test_X, test_y)\neli5.show_weights(perm, feature_names = test_X.columns.tolist(), top=10)","bdd2bbd7":"plt.figure()\ndf.groupby('Country')['NumPurchases'].sum().plot(kind='bar')\nplt.title('Number of purchases per country')\nplt.ylabel('Number of purchases')","fcd0c89a":"data = df[['MntGoldProds', 'NumStorePurchases']]\nx = df['MntGoldProds']\ny = df['NumStorePurchases']\nplt.scatter(x, y)\n\nz = np.polyfit(x, y, 1)\np = np.poly1d(z)\nplt.plot(x,p(x),\"r--\")\nplt.show()","930dd8c2":"from scipy import stats\n\ntau, p_value = stats.kendalltau(df['MntGoldProds'], df['NumStorePurchases'])\n\np_value","93010df4":"plt.figure(figsize=(25,5))\nsns.boxplot(x=df['Education'], y=df['MntFishProducts'], hue=df['Marital_Status'])","d767f250":"X = df_reg_dropped2 = df_reg.drop(['Education', 'Marital_Status', 'Country', 'MntFishProducts'], axis=1)\ny = df_reg_dropped['MntFishProducts']","9221ca62":"from sklearn.model_selection import train_test_split\n\ntrain_X, test_X, train_y, test_y = train_test_split(df_reg_dropped2, y, test_size=0.2,random_state=42)\n\nfrom sklearn.linear_model import LinearRegression \nfrom sklearn.metrics import mean_absolute_error\n\nreg = LinearRegression(normalize=True) \nreg.fit(train_X,train_y)\ny_pred = reg.predict(test_X)\nmean_absolute_error(test_y, y_pred)","5180b647":"import eli5\nfrom eli5.sklearn import PermutationImportance\n\nperm = PermutationImportance(reg, random_state=0).fit(test_X, test_y)\neli5.show_weights(perm, feature_names = test_X.columns.tolist(), top=10)","3f0c711e":"#determine acceptance rate per campaign\ncampaign_acceptance_rate = pd.DataFrame(df[['AcceptedCmp1', 'AcceptedCmp2', 'AcceptedCmp3', 'AcceptedCmp4', 'AcceptedCmp5', 'Response']].mean()*100, columns=['Percent']).reset_index()\n                     \n                               \n                               \n# plot\nfig_dims = (10, 10)\nfig, ax = plt.subplots(figsize=fig_dims)\nsns.barplot(x='index', y='Percent', data=campaign_acceptance_rate.sort_values('Percent'))\nplt.xlabel('Campaign')\nplt.ylabel('% Accepted')\n","98245afe":"#average customer \n\n#age\nage = round(df['Age'].mean())\nprint(age)\n\n#income\nincome = round(df['Income'].mean())\nprint(income)\n\n#customer since\ncustomer_since = round(df['Customer_since'].mean())\nprint(customer_since)\n\n#TotalAmountSpent\nTotalAmountspent = round(df['TotalMnt'].mean())\nprint(TotalAmountspent)\n\n#Responsiveness\nResponsiveness = df['Responsiveness'].mean()\nprint(Responsiveness)\n\n#Number of Minors in Household\nMinors = df['Minors'].value_counts()\nprint(Minors)\n\n#Education\nEducation = df['Education'].value_counts()\nprint(Education)\n\n#Marital_Status\nMarital_Status = df['Marital_Status'].value_counts()\nprint(Marital_Status)\n\n#Recency\nRecency = round(df['Recency'].mean())\nprint(Recency)","6d1f6aee":"#TotalAmountSpent\nTotalAmountspent_sum = round(df['TotalMnt'].sum())\nprint(\"Total Revenues\" + \" \" + str(TotalAmountspent_sum))\n\nWines_sum = round(df['MntWines'].sum())\nprint(\"Wine Revenues\" + \" \" + str(Wines_sum))\n\nFruits_sum = round(df['MntFruits'].sum())\nprint(\"Sweets Fruits\" + \" \" + str(Fruits_sum))\n\nMeat_sum = round(df['MntMeatProducts'].sum())\nprint(\"Meat Revenues\" + \" \" + str(Meat_sum))\n\nFish_sum = round(df['MntFishProducts'].sum())\nprint(\"Fish Revenues\" + \" \" + str(Fish_sum))\n\nSweet_sum = round(df['MntSweetProducts'].sum())\nprint(\"Sweets Revenues\" + \" \" + str(Sweet_sum))\n\nGold_sum = round(df['MntGoldProds'].sum())\nprint(\"Gold Revenues\" + \" \" + str(Gold_sum))\n","306ef1ab":"NumCatalogPurchases_sum = round(df['NumCatalogPurchases'].sum())\n\nNumWebPurchases_sum = round(df['NumWebPurchases'].sum())\n\nNumStorePurchases_sum = round(df['NumStorePurchases'].sum())\n\nNumDealsPurchases_sum = round(df['NumDealsPurchases'].sum())\n\npiechart_channel = np.array([NumCatalogPurchases_sum, NumWebPurchases_sum, NumStorePurchases_sum, NumDealsPurchases_sum])\nmylabels = [\"Catalog\", \"Web\", \"Store\", \"Deals\"]\n\nplt.pie(piechart_channel, labels = mylabels, autopct='%1.1f%%')\nplt.title(\"Channel performance\")\nplt.show() ","134d5508":"The most recent campaign had by far the highest acceptance rate.","8d6270bf":"The average customer:\n\n* is 52 years old\n* is married\n* has one minor in the household\n* has graduated\n* earns around 52k USD\n* spent 606 USD in total\n* responded to 0.4 marketing campaigns\n* is a customer since 2013\n* made the last purchase 49 days ago\n\n\n","0a4170ab":"Monthly website visits are positively correlated with:\n\n* Number of deals purchases\n* Presence of minors\n\nMonthly website visits are negatively correlated with:\n\n* Income\n* Amount spent on meat\n* Number of catalog purchases\n* Number of store purchases\n* Total amount spent\n* Amount spent on fish\n* Amount spent on sweets\n* Amount spent on fruit\n* Amount spent on luxury products\n* Amount spent on wine\n\n","dd9ddb18":"Observation\n* Null values in feature \"Income\"","40e3111c":"Section 02: Statistical Analysis\nPlease run statistical tests in the form of regressions to answer these questions & propose data-driven action recommendations to your CMO. Make sure to interpret your results with non-statistical jargon so your CMO can understand your findings.\n\nWhat factors are significantly related to the number of store purchases?\nDoes US fare significantly better than the Rest of the World in terms of total purchases?\nYour supervisor insists that people who buy gold are more conservative. Therefore, people who spent an above average amount on gold in the last 2 years would have more in store purchases. Justify or refute this statement using an appropriate statistical test.\nFish has Omega 3 fatty acids which are good for the brain. Accordingly, do \"Married PhD candidates\" have a significant relation with amount spent on fish? What other factors are significantly related to amount spent on fish? (Hint: use your knowledge of interaction variables\/effects)\nIs there a significant relationship between geographical regional and success of a campaign?","aad04dba":"Observation: \n\nMarried PhD candidates do not spend more on fish products.","f4149707":"Observation:\n* No strong correlation of \"Age\" with other feature -> will impute null values with median","ad3ad627":"# **Section 01:  Exploratory Data Analysis**\n\n* Are there any null values or outliers? How will you wrangle\/handle them?\n* Are there any variables that warrant transformations?\n* Are there any useful variables that you can engineer with the given data?\n* Do you notice any patterns or anomalies in the data? Can you plot them?","8aabdb22":"Observation:\n\n* There are outliers in feature \"Income\", some customers have a very high income -> most likely natural outliers, will leave them as they are","17084ba3":"The US do not fare better than the Rest of the World in terms of total purchases. Spain, SouthAfrica, Canada, Australia and India have a higher number of purchases compared to the US.","5d7445cf":"The majority of customers (more than 3\/4) did not respond to any of the marketing campaigns.","d9f8a566":"Observations\n\nThe presence of minors in the household is positively correlated with:\n\n* number of deals purchased\n* number of monthly website visits\n\nThe presence of minors in the household is negatively correlated with:\n\n* total amount spent\n* amount spent on fish\n* amount spent on meat\n* amount spent on sweets\n* amount spent on fruits\n* amount spent on luxury items\n* number of catalog purchases\n* number of remote purchases\n* number of store purchases\n* Income\n\nPresence of minor is negatively correlated with income and, in line with Engel's law, with the total amount spent. With more minors in the household, fewer purchases are done remotely, despite a higher number of website visits.","a9284776":"**Customer loyalty, recency, satisfaction and campaign responsiveness**","420cd1ef":"Feature engineering: \n\n* Minors = Kidhome + Teenhome\n* Total amount spent = Amount spent for wine + fruits + meat + fish + sweet + gold\n* Number of all purchases = Purchases in store + catalog + web + deals\n* Remote purchases = Purchases in catalog + web\n* Marketing responsiveness = AcceptedCmp1 + AcceptedCmp1 + AcceptedCmp1 +AcceptedCmp1 + AcceptedCmp1 + Response\n\nTransformation:\n\n* Feature \"Dt_customer\" converted to \"Customer_since\"\n* Delete \"Year_birth\", but keep \"Age\"\n","c746a0e6":"**Explore dataset with correlation matrix**","2e7fc557":"Observations:\n* Outliers can be found in many columns, probably due to individual buying behaviour\n* Birth_Date before 1900 not plausible\n\nNext step:\n* Convert \"Year_Birth\" to \"Age\"\n* Impute values for ages >120","ec8d092a":"**Explore effects of income**","951912b9":"Obervations:\n\nResponsiveness is positively correlated with:\n\n* amount spent on wine\n* amount spent on luxury items\n* total amount spent\n* number of catalog purchases\n* numer of remote purchases\n* amount spent on meat\n\nResponsiveness is negativly correlated with:\n\n* Income\n\nWe do not have any details on the type of marketing activities and what products\/channels they promoted. The data suggest that the marketing activities had a stronger effect on purchases of luxury goods and remote purchases.","1e5bd25c":"Main factors related to the amount spent on fish are amounts spent on meat and wines.","c2db33ed":"* Wines are the best performing products\n* Meat products are the 2nd best performing\n* Gold products are the 3rd best performing\n","3a987ea5":"Most important features for number of store purchases are remote purchases, number of deals purchased, number of web purchases and number of catalog purchases.","bd8d8ccf":"**Effect of minors**","27d129d9":"Observations:\n* Feature \"Income\" with space at the beginning\n* Feature \"Income\" with null values\n* Feature \"Income\" is of datatype \"object\"\n* Feature \"Income\" with missing values\n\nNext steps: \n* Remove white spaces\n* Convert \"Income\" to datatype float\n* Imputation of null values for feature \"Income\"\n","1c1ed6a9":"People who spent an above average amount on gold have indeed more in store purchases. This correlation is statistically significant, however, this does not prove causation that people who spent money on gold are more conservative and prefer buying in stores.","c6d57dc3":"Observations:\n\n* Total amount spent is negatively correlated with date of enrollment with the customer -> customer are loyal.\n* Customers that responded to campaign 2 and 3 with the shortest time since last purchase\n* Customer that responded to campaign 4(5) made the (2nd)highest number of purchases and spent the (2nd)most total amount\n* Customer with a complaint spent less\n* No strong correlations for feature \"Recency\"\n","b0aa9de3":"Observations\n\nIncome is strongly positively correlated with:\n* total amount spent\n* number of purchases\n* amount spent for wines\n* amount spent for meat\n* total amount spent for luxury items\n* number of catalog purchases \n* number of store purchases\n* higher education (above basic)\n\nIncome is negatively correlated with:\n* monthtly website visits\n* presence of minors in the household\n\nIncome is a key determinant of demand and depending on the good and the relationship between income and demand can be both, direct and inverse. In the case of luxury goods, income and demand are directly related. In case of inferior goods (e.g. basic food), income and demand are inversely related. \nThis relationship has been described by Ernst Engel, a German statistician, in the 19th century. Engel\u2019s Law states that households with lower income spend a larger proportion of their income on food compared to households with a higher income level. Nevertheless, the absolute dollar expenditures spent on food are still increasing for higher income households. \nThe observations in this dataset that shows a trend towards purchases of luxury products for higher incomes are in line with these concepts.\n","0c8fb506":"# *** Section 02: Statistical Analysis**\n\n","b2ca41c2":"# **Section 03: Data Visualization**\n\nPlease plot and visualize the answers to the below questions.\n\n* Which marketing campaign is most successful?\n* What does the average customer look like for this company?\n* Which products are performing best?\n* Which channels are underperforming?","5d2eb14c":"Store is the most successful channel, followed by Web. Catalog and Deals are the weakest channels, though we do not have any information whether the deals supported any of the other channels, e.g. special discount on web purchases."}}