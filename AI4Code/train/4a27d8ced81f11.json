{"cell_type":{"6997a924":"code","46d2751b":"code","23d5e6e3":"code","4b5e1652":"code","ecd93939":"code","5a375883":"code","7969f658":"code","20ed34d1":"code","d2e72890":"code","d19bb1c6":"code","bbab89e7":"code","bf0fbc50":"code","0b18c0ce":"code","80e07944":"code","ed609126":"code","312db5a5":"code","53ae2137":"code","d2339c1a":"code","6a331ec6":"code","c6b11160":"code","21556605":"code","f0c33e5e":"code","f210bcdc":"code","f797fe0a":"code","0922861c":"code","a4a27fda":"code","c755b8f4":"code","a7c896ed":"code","79de91c2":"code","6cb607a1":"code","0b708fc8":"code","ee0c9e1b":"code","596fd7b1":"code","a0e40e79":"code","c81e62ed":"code","3ccada16":"code","9ef9a3f1":"code","e61aeb66":"code","cee538cb":"code","c83f2006":"code","3f75bc0f":"code","1568f511":"code","a29bcac1":"code","d68afc57":"code","e854ffa8":"code","1723e93d":"code","170329f0":"markdown","a5e68e4a":"markdown","e218a1c0":"markdown","0841c6ec":"markdown","d54458c4":"markdown","abef68bd":"markdown","fc4f26ff":"markdown","63189a00":"markdown","89c02df6":"markdown","a6384cdf":"markdown","71892497":"markdown","e5294673":"markdown","e383bc02":"markdown","9db6e38a":"markdown","7738704c":"markdown","7f7ec6bb":"markdown","e4001a73":"markdown","16b8e445":"markdown","3cbadfe7":"markdown","79bd88fb":"markdown","c59d8bfc":"markdown","ec7e1fbb":"markdown","65713e31":"markdown","bdf39d4e":"markdown"},"source":{"6997a924":"import pandas as pd\nimport numpy as np\nimport os\nimport matplotlib.pyplot as plt\nimport seaborn as sns \nimport datetime as dt\nimport folium\nfrom folium.plugins import HeatMap, HeatMapWithTime\n%matplotlib inline\nimport warnings\nwarnings.filterwarnings(\"ignore\")","46d2751b":"data_df = pd.read_csv(os.path.join(\"\/kaggle\", \"input\", \"unemployment-in-european-union\", \"une_rt_m.tsv\"), sep='\\t')","23d5e6e3":"country_codes_df = pd.read_csv(os.path.join(\"\/kaggle\", \"input\", \"iso-country-codes-global\", \"wikipedia-iso-country-codes.csv\"))","4b5e1652":"data_df.shape","ecd93939":"data_df.head()","5a375883":"data_df.columns","7969f658":"country_codes_df.head()","20ed34d1":"country_codes_df.columns = ['country', 'C2', 'C3', 'numeric', 'iso']","d2e72890":"country_codes_df.head()","d19bb1c6":"data_df['C2'] = data_df['s_adj,age,unit,sex,geo\\\\time'].apply(lambda x: x.split(\",\")[-1])\ndata_df['age'] = data_df['s_adj,age,unit,sex,geo\\\\time'].apply(lambda x: x.split(\",\")[1])\ndata_df['unit'] = data_df['s_adj,age,unit,sex,geo\\\\time'].apply(lambda x: x.split(\",\")[2])\ndata_df['sex'] = data_df['s_adj,age,unit,sex,geo\\\\time'].apply(lambda x: x.split(\",\")[3])\ndata_df['s_adj'] = data_df['s_adj,age,unit,sex,geo\\\\time'].apply(lambda x: x.split(\",\")[0])","bbab89e7":"data_df.head()","bf0fbc50":"print(f\"countries:\\n{list(data_df.C2.unique())}\")","0b18c0ce":"print(f\"sex:\\n{list(data_df.sex.unique())}\")","80e07944":"print(f\"age intervals:\\n{list(data_df.age.unique())}\")","ed609126":"print(f\"unit:\\n{list(data_df.unit.unique())}\")","312db5a5":"print(f\"s_adj:\\n{list(data_df.s_adj.unique())}\")","53ae2137":"selected_cols = ['C2','age','unit','sex', 's_adj', \n                 '2020M07 ', '2020M06 ', '2020M05 ', '2020M04 ','2020M03 ','2020M02 ','2020M01 ',\n                 '2019M12 ','2019M11 ','2019M10 ','2019M09 ','2019M08 ','2019M07 ',\n                 '2019M06 ','2019M05 ','2019M04 ','2019M03 ','2019M02 ','2019M01 ',\n                '2018M12 ','2018M11 ','2018M10 ','2018M09 ','2018M08 ','2018M07 ',\n                 '2018M06 ','2018M05 ','2018M04 ','2018M03 ','2018M02 ','2018M01 ',\n                '2017M12 ','2017M11 ','2017M10 ','2017M09 ','2017M08 ','2017M07 ',\n                 '2017M06 ','2017M05 ','2017M04 ','2017M03 ','2017M02 ','2017M01 ',\n                '2016M12 ','2016M11 ','2016M10 ','2016M09 ','2016M08 ','2016M07 ',\n                 '2016M06 ','2016M05 ','2016M04 ','2016M03 ','2016M02 ','2016M01 ',\n                '2015M12 ','2015M11 ','2015M10 ','2015M09 ','2015M08 ','2015M07 ',\n                 '2015M06 ','2015M05 ','2015M04 ','2015M03 ','2015M02 ','2015M01 ']","d2339c1a":"data_sel_df = data_df[selected_cols]","6a331ec6":"data_sel_df = data_sel_df.merge(country_codes_df, on=\"C2\")","c6b11160":"data_sel_df.head()","21556605":"print(f\"selected data shape: {data_sel_df.shape}\")","f0c33e5e":"data_tr_df = data_sel_df.melt(id_vars=[\"country\", \"age\", \"unit\", \"sex\", \"s_adj\", \"C2\", \"C3\", \"numeric\", \"iso\"], \n        var_name=\"Date\", \n        value_name=\"Value\")","f210bcdc":"data_tr_df.head()","f797fe0a":"print(f\"new data shape: {data_tr_df.shape}\")","0922861c":"import re\ndata_tr_df['Value'] = data_tr_df['Value'].apply(lambda x: re.sub(r\"[a-zA-Z: ]\", \"\", x))\ndata_tr_df['Value'] = data_tr_df['Value'].apply(lambda x: x.replace(\" \",\"\"))\n\ndata_tr_df = data_tr_df.loc[~(data_tr_df.Value==\"\")]\n\ndata_tr_df['Value'] = data_tr_df['Value'].apply(lambda x: float(x))","a4a27fda":"print(f\"distinct values: {len(list(data_tr_df['Value'].unique()))}\")\nprint(f\"samples values: {data_tr_df['Value'].unique()}\")","c755b8f4":"total_y25_74_df = data_tr_df.loc[(data_tr_df.age=='Y25-74')&(data_tr_df.unit=='PC_ACT')&(data_tr_df.sex=='T')&(data_tr_df.s_adj=='TC')]","a7c896ed":"def plot_time_variation(df, y='Value', size=1, is_log=False, title=\"\"):\n    f, ax = plt.subplots(1,1, figsize=(4*size,3*size))\n\n    countries = list(df.country.unique())\n    for country in countries:\n        df_ = df[(df['country']==country)] \n        g = sns.lineplot(x=\"Date\", y=y, data=df_,  label=country)  \n        ax.text(max(df_['Date']), (df_.loc[df_['Date']==max(df_['Date']), y]), str(country))\n    plt.xticks(rotation=90)\n    plt.title(f'Total unemployment, {title}, grouped by country')\n    ax.text(max(df_['Date']), (df_.loc[df_['Date']==max(df_['Date']), y]), str(country))\n    plt.legend(loc=\"upper left\", bbox_to_anchor=(1,1))\n    if(is_log):\n        ax.set(yscale=\"log\")\n    ax.grid(color='black', linestyle='dotted', linewidth=0.75)\n    plt.show()  \n","79de91c2":"plot_time_variation(total_y25_74_df, size=4, is_log=True, title = \"age group 24-75 -\")","6cb607a1":"total_F_y25_74_df = data_tr_df.loc[(data_tr_df.age=='Y25-74')&(data_tr_df.unit=='PC_ACT')&(data_tr_df.sex=='F')&(data_tr_df.s_adj=='TC')]\nplot_time_variation(total_F_y25_74_df, size=4, is_log=True, title = \"female, age group 24-75 \")","0b708fc8":"total_M_y25_74_df = data_tr_df.loc[(data_tr_df.age=='Y25-74')&(data_tr_df.unit=='PC_ACT')&(data_tr_df.sex=='M')&(data_tr_df.s_adj=='TC')]\nplot_time_variation(total_M_y25_74_df, size=4, is_log=True, title = \"male, age group 24-75 \")","ee0c9e1b":"total_M_y25_df = data_tr_df.loc[(data_tr_df.age=='Y_LT25')&(data_tr_df.unit=='PC_ACT')&(data_tr_df.sex=='M')&(data_tr_df.s_adj=='TC')]\nplot_time_variation(total_M_y25_df, size=4, is_log=True, title = \"male, age group <25 \")","596fd7b1":"total_F_y25_df = data_tr_df.loc[(data_tr_df.age=='Y_LT25')&(data_tr_df.unit=='PC_ACT')&(data_tr_df.sex=='F')&(data_tr_df.s_adj=='TC')]\nplot_time_variation(total_F_y25_df, size=4, is_log=True, title = \"female, age group <25 \")","a0e40e79":"def plot_time_variation_age_sex(data_tr_df, y='Value', country=\"Netherlands\"):\n    c_df = data_tr_df.loc[(data_tr_df.country==country)&(data_tr_df.unit=='PC_ACT')&(data_tr_df.s_adj=='TC')]\n    f, ax = plt.subplots(1,1, figsize=(16,12))\n    sns.lineplot(x=\"Date\", y=y, data=c_df.loc[(c_df.age=='Y_LT25')&(c_df.sex=='F')],  label=\"Female, <25y\")  \n    sns.lineplot(x=\"Date\", y=y, data=c_df.loc[(c_df.age=='Y_LT25')&(c_df.sex=='M')],  label=\"Male, <25y\")  \n    sns.lineplot(x=\"Date\", y=y, data=c_df.loc[(c_df.age=='Y25-74')&(c_df.sex=='F')],  label=\"Female, 25-74y\")  \n    sns.lineplot(x=\"Date\", y=y, data=c_df.loc[(c_df.age=='Y25-74')&(c_df.sex=='M')],  label=\"Male, <25-74y\")  \n\n    plt.xticks(rotation=90)\n    plt.title(f'Total unemployment in {country}, grouped by age & sex')\n    plt.legend(loc=\"upper left\", bbox_to_anchor=(1,1))\n    ax.grid(color='black', linestyle='dotted', linewidth=0.75)\n    plt.show()  ","c81e62ed":"plot_time_variation_age_sex(data_tr_df,country=\"Netherlands\")","3ccada16":"plot_time_variation_age_sex(data_tr_df,country=\"Denmark\")","9ef9a3f1":"plot_time_variation_age_sex(data_tr_df,country=\"Sweden\")","e61aeb66":"plot_time_variation_age_sex(data_tr_df,country=\"Estonia\")","cee538cb":"plot_time_variation_age_sex(data_tr_df,country=\"Latvia\")","c83f2006":"plot_time_variation_age_sex(data_tr_df,country=\"Lithuania\")","3f75bc0f":"plot_time_variation_age_sex(data_tr_df,country=\"Romania\")","1568f511":"import plotly.express as px\n\ndef plot_animated_map(dd_df, title):\n    hover_text = []\n    for index, row in dd_df.iterrows():\n        hover_text.append((f\"country: {row['country']}<br>unemployment: {row['Value']}%<br>country code: {row['iso']}\"))\n    dd_df['hover_text'] = hover_text\n\n    fig = px.choropleth(dd_df, \n                        locations=\"C3\",\n                        hover_name='hover_text',\n                        color=\"Value\",\n                        animation_frame=\"Date\",\n                        projection=\"natural earth\",\n                        color_continuous_scale=px.colors.sequential.Plasma,\n                        width=600, height=600)\n    fig.update_geos(   \n        showcoastlines=True, coastlinecolor=\"DarkBlue\",\n        showland=True, landcolor=\"LightGrey\",\n        showocean=True, oceancolor=\"LightBlue\",\n        showlakes=True, lakecolor=\"Blue\",\n        showrivers=True, rivercolor=\"Blue\",\n        showcountries=True, countrycolor=\"DarkBlue\"\n    )\n    fig.update_layout(title = title, geo_scope=\"europe\")\n    fig.show()    ","a29bcac1":"c_df = data_tr_df.loc[(data_tr_df.unit=='PC_ACT')&(data_tr_df.s_adj=='TC')]\ndd_df=c_df.loc[(c_df.age=='Y_LT25')&(c_df.sex=='F')]\ndd_df = dd_df.sort_values(by='Date')\ntitle = 'Percent of unemployed per country<br>Female, under 25 - (hover for details)'\nplot_animated_map(dd_df, title)","d68afc57":"c_df = data_tr_df.loc[(data_tr_df.unit=='PC_ACT')&(data_tr_df.s_adj=='TC')]\ndd_df=c_df.loc[(c_df.age=='Y_LT25')&(c_df.sex=='M')]\ndd_df = dd_df.sort_values(by='Date')\ntitle = 'Percent of unemployed per country<br>Male, under 25 - (hover for details)'\nplot_animated_map(dd_df, title)","e854ffa8":"c_df = data_tr_df.loc[(data_tr_df.unit=='PC_ACT')&(data_tr_df.s_adj=='TC')]\ndd_df=c_df.loc[(c_df.age=='Y25-74')&(c_df.sex=='F')]\ndd_df = dd_df.sort_values(by='Date')\ntitle = 'Percent of unemployed per country<br>Female, 25-74 yrs. old - (hover for details)'\nplot_animated_map(dd_df, title)","1723e93d":"c_df = data_tr_df.loc[(data_tr_df.unit=='PC_ACT')&(data_tr_df.s_adj=='TC')]\ndd_df=c_df.loc[(c_df.age=='Y25-74')&(c_df.sex=='M')]\ndd_df = dd_df.sort_values(by='Date')\ntitle = 'Percent of unemployed per country<br>Male, 25-74 yrs. old - (hover for details)'\nplot_animated_map(dd_df, title)","170329f0":"\n## <a id='1'>Introduction<\/a>  \n\n\nWe analyze here the unemployment in EU in recent years. The full data (~1983 - 2020) is grouped on country, sex, age interval (<25, 25-74, total).\n\nThe dataset used is migrated from [EU Open Data Portal](https:\/\/data.europa.eu\/euodp\/en\/data\/dataset).\n\nI also use a dataset with ISO codes for countries.\n\nIn this Kernel, we show how we can extract information from this compact dataset and mix it with countries data.\n\n\n<img src=\"https:\/\/images1.westword.com\/imager\/u\/original\/11728086\/unemployment.line.1938.unsplash.jpg\"><\/img>\n\n\n","a5e68e4a":"<h1>Starter Kernel: Unemployment in EU Countries<\/h1>\n\n<a id='0'>Content<\/a>\n\n- <a href='#1'>Introduction<\/a>   \n- <a href='#2'>Data Preparation<\/a>   \n- <a href='#3'>Extract country, age, unit, sex, s_adj data<\/a>   \n- <a href='#4'>Filter columns for analysis<\/a>   \n- <a href='#5'>Data Visualization<\/a>   \n\n","e218a1c0":"### Pivot time series data using `melt`\n\nWe are using `melt` to pivot time series columns. Now for each value of time series we introduce additional rows.","0841c6ec":"Let's look to some specific countries evolution.","d54458c4":"Let's check the resulted data structure.","abef68bd":"Let's replace the column names.","fc4f26ff":"## <a id='5'>Data visualization<\/a>","63189a00":"\n## <a id='2'> Data preparation<\/a>","89c02df6":"We look as well to the data columns.","a6384cdf":"Let's look to the data we selected.","71892497":"## <a id='4'>Filter columns for analysis<\/a>\n\n\nWe select only a part of columns for further analysis.\n\nMore specificaly, we are selecting country code (2 letters), age, unit, sex, s_adj and months from Jan 2015 to June 2020.","e5294673":"Let's also look to the country codes.","e383bc02":"### Animated maps\n\nWe introduce as well animated maps for the unemployments in European countries.","9db6e38a":"We look to total values for age interval 25-74.","7738704c":"### Compare age group, sex \/ country","7f7ec6bb":"### Clean the time series data\n\n\nWe do some cleaning on the time series data. We simply filter non-digit data and trim spaces.","e4001a73":"Let's check the results.","16b8e445":"Let's check again the transformed data.","3cbadfe7":"Let's first glimpse the data.","79bd88fb":"Let's also merge with the country codes.","c59d8bfc":"The countries codes data is provided in *.csv format.","ec7e1fbb":"The unemployment data is in TSV (tab separated format). We use `read_csv` with `\\t` separator for reading the data.","65713e31":"## <a id='3'>Extract country, age, unit, sex, s_adj data<\/a>\n\n\nWe separate from the first column the various data attributes (country, age, unit, sex, s_adj) by spliting the complex data in individual values and we store them on separate columns.","bdf39d4e":"Typically time series data in EU Open Data Portal are stored with separate columns for each time value. We will have to pivot these columns during our data processing."}}