{"cell_type":{"b12a52ca":"code","050ce169":"code","b7d83003":"code","f7bf8429":"code","2f26b5f5":"code","1cdd7a72":"code","65824658":"code","41683802":"code","bf489b89":"code","23d672a8":"code","bfb5bb93":"code","79199ddf":"code","c69639ae":"code","41fd05c7":"code","cc362284":"code","b4b3f94e":"code","d486ed5f":"code","56975bf6":"code","be590091":"code","d0b08362":"code","6bd0ed64":"code","851ea22f":"code","167be7b9":"code","ea088302":"code","858d53ab":"code","880a494d":"code","868491ce":"code","a465db47":"code","fd176267":"code","aefae024":"code","b46b35ff":"code","db695d2c":"code","62e34a58":"code","437e2da6":"code","383c3846":"code","84039fa5":"code","3f59beaf":"code","3cba00fd":"code","7891b98d":"code","a9e7e7a9":"code","68c891df":"code","8433c5b7":"code","a73bf16e":"markdown","c5dd3c4c":"markdown","2fbb2aff":"markdown","f70a56ab":"markdown","54acc08c":"markdown","8309dbb4":"markdown","6e44b6b2":"markdown","c537cd69":"markdown","978bb5b6":"markdown","90717d9c":"markdown","50eb4e1a":"markdown","2bc98953":"markdown","c518be02":"markdown","dee991f8":"markdown","56c308ed":"markdown","15d344aa":"markdown","b3d81750":"markdown","0518d87f":"markdown","d1de5d98":"markdown","dacb9778":"markdown","009ea0ee":"markdown","5fa50415":"markdown","6d735db3":"markdown","c79159b5":"markdown","14e6ba44":"markdown","ca49a99d":"markdown","ceeb1e6b":"markdown","a770a3d7":"markdown","b82e6053":"markdown","d193fc1a":"markdown","c12c37c9":"markdown","a925ecc1":"markdown","4cbd4c42":"markdown","007795c3":"markdown","9361ee7b":"markdown","3ff384fb":"markdown","3df74d8c":"markdown","5c2bef4a":"markdown","2b6fd369":"markdown"},"source":{"b12a52ca":"# For importing and analysing the data\n#import opendatasets as od #used for downloading the dataset from kaggle\nimport pandas as pd #used for the main exploratory data analysis and working with the dataset\nimport numpy as np #used for numerical and statistical analysis\n","050ce169":"'''Opendatasets is great for downloading dataset from kaggle, when you run the notebook on other platforms line binder, colag or on your own computer. It not needed when you run the notebook on kaggle.com\nRemove the # and run the cell if the you get an error message.'''\n\n#!pip install opendatasets -q \n","b7d83003":"#dataset_url = 'https:\/\/www.kaggle.com\/sakshigoyal7\/credit-card-customers'\n#od.download(dataset_url)","f7bf8429":"# First, lets import the data into a dataframe by reding the csv file we downloaded\ncredit_data = pd.read_csv('..\/input\/credit-card-customers\/BankChurners.csv')\n\n\n#Second, lets make a copy of the dataframe (df) to use for the initial exploration of the data\ndf = credit_data.copy()","2f26b5f5":"# Lets look at the shape of the dataset\n\nprint('Data has {} samples or rows and {} features or columns.'.format(df.shape[0], df.shape[1]))","1cdd7a72":"df.head(10)","65824658":"list(df.columns)","41683802":"df.info()","bf489b89":"df.select_dtypes(include=np.number).columns.tolist()","23d672a8":"df.describe()","bfb5bb93":"df.describe(include=[object])  ","79199ddf":"df.drop(['Naive_Bayes_Classifier_Attrition_Flag_Card_Category_Contacts_Count_12_mon_Dependent_count_Education_Level_Months_Inactive_12_mon_1',\n          'Naive_Bayes_Classifier_Attrition_Flag_Card_Category_Contacts_Count_12_mon_Dependent_count_Education_Level_Months_Inactive_12_mon_2'], axis = 1, inplace = True)","c69639ae":"df.rename(columns = {'CLIENTNUM':'Client_nr', 'Attrition_Flag': 'Status','Customer_Age': 'Age', 'Education_Level' : 'Education'}, inplace = True)\ndf.head()","41fd05c7":"#!pip install matplotlib seaborn --upgrade --quiet","cc362284":"# Lets import the libraries we will be using in the analysis \nimport matplotlib\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline\n\n","b4b3f94e":"# Set the global plotting parameters\nsns.set_style('whitegrid') #(\"darkgrid\")\n#matplotlib.rcParams['font.size'] = 14\n#matplotlib.rcParams['font.weight'] = 'bold'\nmatplotlib.rcParams['figure.figsize'] = (10, 6)\nmatplotlib.rcParams['figure.facecolor'] = '#00000000'","d486ed5f":"gender_matrix = pd.crosstab(df['Gender'], df['Status'], \n            margins = True, \n            margins_name = \"% row\", \n            normalize='index')\ndisplay(gender_matrix)\nsns.heatmap(gender_matrix, annot=True, fmt='.0%', cmap='Blues')","56975bf6":"df.columns","be590091":"card_matrix = pd.crosstab(df['Card_Category'],df['Status'],\n            margins = True,  \n            margins_name = \"% all\", \n            normalize='all')\ndisplay(card_matrix)\nsns.heatmap(card_matrix, annot=True, fmt='.0%', cmap='Blues')","d0b08362":"sns.catplot(x=\"Card_Category\", hue=\"Gender\", col=\"Status\",\n                data=df, kind=\"count\",\n                height=4, aspect=.7);","6bd0ed64":"income_matrix = pd.crosstab(df['Income_Category'],df['Status'],\n            margins = True,  \n            margins_name = \"% all\", \n            normalize='all')\ndisplay(income_matrix)\nsns.heatmap(income_matrix, annot=True, fmt='.0%', cmap='Blues')","851ea22f":" pd.crosstab(df['Education'], df['Status'], margins = True, margins_name = \"Total\")","167be7b9":"df['Education'].value_counts(normalize=True).mul(100).round(1).astype(str) + '%' ","ea088302":"#Now lets make two sets of data for the existing and the attrited customers respectivly so its easyer to compare the two segments\n\n#Existing Customer\nec = df[df['Status'] == \"Existing Customer\"] \n#Attrited Customer\nac = df[df['Status'] == \"Attrited Customer\"]\n","858d53ab":"plt.hist(df['Age'], alpha=0.4)\n#.mul(100).round(1).astype(str) + '%' ","880a494d":"plt.hist(ec['Age'], alpha=0.4)","868491ce":"df.iloc[::,1:20].hist(figsize=(20,15))","a465db47":"#sns.relplot(x=\"Status\", y=\"Income_Category\", hue=\"Credit_Limit\", size=\"Credit_Limit\",\n          #  sizes=(60, 500), alpha=.5, #palette=\"muted\",\n          #  height=6, data=df)","fd176267":"plt.hist(ec.Months_on_book, alpha=0.4); #bins=2);\nplt.hist(ac.Months_on_book, alpha=0.4); #bins=2);\nplt.legend(['Existing Customers', 'Attrited Customers']);","aefae024":"plt.title('Distribution of Inactive months for the past year')\nplt.hist(ec.Months_Inactive_12_mon, alpha=0.4); #bins=2);\nplt.hist(ac.Months_Inactive_12_mon, alpha=0.4); #bins=2);\nplt.legend(['Existing Customers', 'Attrited Customers']);","b46b35ff":"plt.title('Distribution of Contacts Count 12 mon')\n\nplt.hist(ec.Contacts_Count_12_mon, alpha=0.4); #bins=2);\nplt.hist(ac.Contacts_Count_12_mon, alpha=0.4); #bins=2);\n\nplt.legend(['Existing Customers', 'Attrited Customers']);","db695d2c":"plt.title('Distribution of Contacts Count 12 mon')\nsns.set_style(\"darkgrid\")\nplt.hist([#ec.Months_on_book,\n          #ac.Months_on_book,\n          ec.Months_Inactive_12_mon,\n          ac.Months_Inactive_12_mon,\n          #ec.Contacts_Count_12_mon, \n          #ac.Contacts_Count_12_mon,\n          ],\n    alpha=0.4,\n         #bins=np.arange(2, 5, 0.25), \n    stacked=True);\n\nplt.legend(['Existing Customers', 'Attrited Customers']);","62e34a58":"plt.title(\"No. of months on book\")\nsns.barplot(x='Months_on_book', y='Status', hue=\"Gender\", data=df)#alpha =0.4);","437e2da6":"list(df.Income_Category.unique())","383c3846":"df.columns","84039fa5":" pd.crosstab( df['Income_Category'], df['Status'], margins = True, margins_name = \"Total\")","3f59beaf":"plt.title('Distribution of mean age for each group of customers')\n\n\nplt.hist([ec.Education, ac.Education], \n         #bins=7, \n         stacked=True);\nplt.legend(['Existing_Customer','Attrited_Customer']);","3cba00fd":"df_customers = df[['Status','Age', 'Gender', 'Dependent_count', 'Education','Marital_Status', 'Income_Category','Total_Relationship_Count','Avg_Utilization_Ratio']]\nsns.pairplot(df_customers, hue=\"Status\")","7891b98d":"df_totals = df[['Status','Total_Relationship_Count','Total_Revolving_Bal','Total_Amt_Chng_Q4_Q1', 'Total_Trans_Amt', 'Total_Trans_Ct','Total_Ct_Chng_Q4_Q1', 'Avg_Utilization_Ratio']]\nsns.pairplot(df_totals, hue=\"Status\")","a9e7e7a9":"df_corr = df[['Status', 'Months_on_book', 'Months_Inactive_12_mon', 'Total_Revolving_Bal', 'Total_Amt_Chng_Q4_Q1', 'Total_Trans_Amt',\n       'Total_Trans_Ct','Total_Ct_Chng_Q4_Q1']] \ndf_corr.corr()","68c891df":"sns.heatmap(df_corr.corr(), cmap=\"Blues\", annot=True)","8433c5b7":"df_totals = df[['Status','Total_Relationship_Count','Total_Revolving_Bal','Total_Amt_Chng_Q4_Q1', 'Total_Trans_Amt', 'Total_Trans_Ct','Total_Ct_Chng_Q4_Q1', 'Avg_Utilization_Ratio']]\nsns.pairplot(df_totals, hue=\"Status\")","a73bf16e":"\n**The scope:**\n\n**The scope is to do an data exploratory analysis to understand what circumstances effecting the churn rate. If possible we will explore proposals for improving the churnrate or what data and questions would be relevant to explore further to lower the churnrate.**\n\n\n_We are going to cover the following steps:_\n- Download the dataset\n- Import\/install libraries\n- Import the data into a pandas dataframe\n- Get to know more about the dataset\n- Clean the dataset \n- Do an exploratory data analysis\n- What insigts can we gain from the analysis? \n- What is the impact of the insights? Action items to explore. \n- Further exploration and questions\n\nReferences\n\n\nLet's get started.","c5dd3c4c":"**Remove uncessary columns**","2fbb2aff":"By the display we see the columns and the count of values for each column. We also see there is no `null` and `N\/A`values in any of the collumns. It may still be some values that are unknown or wrong but those we will need to find in some other way. The Object type features tend to be \u00b4str\u00b4cathegorical and the int64 and float64 are numerica columns representing values. ","f70a56ab":"**Now lets look at some of features regarding the customers behavior with the service:**","54acc08c":"## What is churn and why does it matter? \nCustomer churn means that the customer is leaving or stoping using the product or service of the company. Customers leaving the product or service provided by companies is commun do to a multitude of factors. For the bank, understanding why the custermers are churning is very important as the competition of new fintechs is growing. A growing churn rate can mean a couple of things:\n\n- The economic implication of a growing churn rate will result in lowering the customer lifetime value, witch may lead to lower revenue and profit margins. It may also lead to a lower market share due to loss of customers to compatitors. One other economic aspect related to churn is the term customer accuazision cost, with is the avrege cost for accuaring a new customer. The norm is that its more expensive to accuire a new customer then trying to keed an existing customer. \n- If customers are leaving it may also indicate that some things are not working with the product or service. Those type of signals in the organisation are important to understand and aress as soon as possible to keep the current customers and gain new ones. \n\nThis is why it's one of the most important metrics to understand and monitor for companies.\n\n\n","8309dbb4":"At a quick glase we can allready see that the second columns, `Attrition_Flag` is the one feature that shows us the customers that left, and as such is proving a way to fint the churned customer. A second quick observation is that the colums `Marital_Status` has some `Unknows`values. Will will explore if that feature may have some relevans during the exploratory data analysis. ","6e44b6b2":"## Problem Statement\n To understand churn it would be benefitial to set some relevant metrics when mesuring it. One central metic to mesure is time, ie. how long has the client used the products\/services? The relevant metrics for mesuring churn may vary depending on the industry and type of customer interaction that is important for the company. For most companies it may be revenue, conversion rates or some other similar metric, but for some, like facebook \/ instagram, it may be engagement and time spend on the platform. For getting a clear picture of the right nr of the customers leaving the company it requires a set of considerations and assumtions that may be specific to the sector or company. This includes a time perspective, ie. how long time should pass before we consider the customer as no longer a customer, or those it require other mesasures as termination of contract, not renewing a service contract or something similar. It's important the understand the metrics with witch we mesure customer churn. On other aspect worth considering is that new costomers are usally accurired during the same period, so the standard formula for customer churn (attrited customers \/ all existing customer) may not take that fast in consideration. ","c537cd69":"**Categorical features** \n\nThe target feature is `Attrition_Flag`. The `Gender`, `Marital_Status`, `Card_Category` are nominal categorial values while the ordinal categorial values are `Education_Level` and `Income_Category.","978bb5b6":"### Data cleaning\n","90717d9c":"While looking at the numerical columns we can get the most common statistical data just by using the `df.describe()` command. ","50eb4e1a":"\n## The objectives \n\nA business manager of a consumer credit card portfolio is facing the problem of customer attrition. They want to analyze the data to find out the reason behind this and leverage the same to predict customers who are likely to drop off.\n\n> **The objective of this analysis is to understand what customers are at risk for churning and visualize that in a clear and consise way.**","2bc98953":"Today we will use the [pandas](https:\/\/pandas.pydata.org\/) and [numpy](https:\/\/numpy.org\/) libraries for loading and cleaning the dataset. \n","c518be02":"## Visualizing the data\n\nVisualizing data is an essential part of data analysis and machine learning. We'll use Python libraries Matplotlib and Seaborn to learn and apply some popular data visualization techniques. \n\nTo begin, let's install and import the libraries. We'll use the matplotlib.pyplot module for basic plots like line & bar charts. It is often imported with the alias plt. We'll use the seaborn module for more advanced plots. It is commonly imported with the alias sns. We will also use plotly for some charts.","dee991f8":"We got the information from the dataset source that the last two columns where to be deleted. ","56c308ed":"Looking at the description of the cathegorical features we see the top count for each column and the count of unique values in each column. What stands out is that to me is the income cathegory, beeing less then $40K and that the majority of the cards issued are `Blue`. This might be useful to think about moving forward. ","15d344aa":"Now lets take a look at what columns are of most intresting and what columns we can remove.\n","b3d81750":"Now lets see if we can rename some colums to make it short and easier to understand.","0518d87f":"The majority of the customers that churned are using a `Blue` card.","d1de5d98":"# Conslusions ","dacb9778":"## The dataset\nLooking at the data we see that the dataset contains both numerc and cathegorical datatypes. The data is for each customer with a client nr (CLIENTNUM), attrition identifier, demographic data and product data. Let's see what are the types of variables in our dataset:\n\n- Attrition_Flag - Internal event (customer activity) variable - if the account is closed then 1 else 0\n\n**Demographic variable**: \n- age             : - Customer's Age in Years\n- gender          : - M=Male, F=Female\n- dependent count : - Number of dependents\n- education level : - Educational Qualification of the account holder (example: high school, college graduate, etc.)\n- marital status  : - Married, Single, Divorced, Unknown\n- income category : - Annual Income Category of the account holder (< $40K, $40K - 60K, $60K - $80K, $80K-$120K, > $120K, Unknown)\n\n**Product and client engagement variables** \n- Card_Category  : - Type of Card (Blue, Silver, Gold, Platinum) \n- Months_on_book - Period of relationship with bank\n\nThe following variables are not explaind further in the dataset, so this are my assumtions (to be verified):  \n- Total_Relationship_Count - \n- Months_Inactive_12_mon - Inactive months for the past year\n- Contacts_Count_12_mon - Contact coufor the past year\n- Credit_Limit - Credit limit \n- Total_Revolving_Bal - The total revolving balance \n- Avg_Open_To_Buy - The avrage amount availabe for buying\n- Total_Amt_Chng_Q4_Q1 - Total amount chage for the Q4 - Q1 period\n- Total_Trans_Amt - Total Transaction amount \n- Total_Trans_Ct - Total transaction ct(?)\n -Total_Ct_Chng_Q4_Q1 - Total for the Q4 - Q1 period\n- Avg_Utilization_Ratio - The average ration the card is used (not knowd how that is calculated) \n- Naive_Bayes_Classifier_Attrition_Flag_Card_Category_Contacts_Count_12_mon_Dependent_count_Education_Level_Months_Inactive_12_mon_1 - unknown, to be deleted\n- Naive_Bayes_Classifier_Attrition_Flag_Card_Category_Contacts_Count_12_mon_Dependent_count_Education_Level_Months_Inactive_12_mon_2 - unknown, to be deleted\n   \n   \n_resources:_\n- [Variable types and examples](https:\/\/www.statsandr.com\/blog\/variable-types-and-examples\/)\n- [What is the difference between ordinal, interval and ratio variables? Why should I care?](https:\/\/www.graphpad.com\/support\/faq\/what-is-the-difference-between-ordinal-interval-and-ratio-variables-why-should-i-care\/)\n\n","009ea0ee":"**Importing libraries**\n- [Matplotlib](https:\/\/matplotlib.org\/): Plotting and visualization library for Python. We'll use the pyplot module from matplotlib. As convention, it is often imported as plt.\n- [Seaborn](https:\/\/seaborn.pydata.org\/): An easy-to-use visualizetion library that builds on top of Matplotlib and lets you create beautiful charts with just a few lines of code.\n","5fa50415":"## Intoduction\n\nIn this notebook contains a data analysis on the credit card customers data to draw infrences on the churning customers behaviors before they cancel thier credit cards.","6d735db3":"Now lets explore the data about customers. First we will explore the features for the customers in general, mainly cathegorical data, for both the existing and attrited customers. \nAftar that we will explore the bank data about the two custemer segments of interest. \n\nWe can start with finding out how many have left and how many are still existing customers:\n\n- **How many existing custermers and attrited customers do we have? How many % of the total customers attrited?**","c79159b5":"With regards to the fact that the conclusions would need to be enriched with some domein specific knowledge, we can preliminery conslude that among the most impactful variables for detecting customers at risk for churning is how often they use their card, the amount of \n\nIn that regard we would need to look depper at the varialbes: \n- `Total_Trans_Amt` - The more the customers use the card, the less chans it is they will churn.\n- `Total_Trans_Ct` - \n- `Total_Amt_Chng_Q4_Q1` -\n- `Months_on_book` is also important at is might indicate that the longer at custermer has been with the band, the lower the risk of churning. ","14e6ba44":"**Now lets look at the Contract count for the past 12 months**","ca49a99d":"### Importing the libraries","ceeb1e6b":"Looking at the months of inactivity durring the last 12 month.","a770a3d7":"# Explaratory data analysis","b82e6053":"# Distributions\n\nNow lets look at the distribution of the numerical features:","d193fc1a":"The display shows the `count` `min`, `max`, `std` and `mean` and the `median`along with the lower and upper quartiles. With this we can get an excellent view into the range of the dataset. By knowing the percentile points (25th, 50th, and 75th) aswell as the `min`and `max`we can find outliers and [skewness](https:\/\/en.wikipedia.org\/wiki\/Skewness) of the distribution of the data for each column. \n\nBy looking at the columns we can see that ","c12c37c9":"First lets import the libraries we will be using. Today we will use pandas for the exploratory data analysis. For visualizing the data we will be using matplotlib, seaborn and plotly.","a925ecc1":"**Rename columns**","4cbd4c42":"### Importing the data into a pandas dataframe","007795c3":"# Exploratory data anaysis of credit card customer churn\n\nThe dataset can be found on [here](https:\/\/www.kaggle.com\/sakshigoyal7\/credit-card-customers) on kaggle.com.","9361ee7b":"Now lets see what columns contain numerical values. We can display them by this command:","3ff384fb":"Lets get a bit more aquinted with the dataset the exploring more info about it with the following commands: `df.info()` and `df.describe()`","3df74d8c":"### Downloading the data","5c2bef4a":"\n**By looking at the data we can start to form some questions to inform as on a hypothesis about the most impactful features affecting churnrate.\nLets explore the data and provid insightful analysis by trying to answering some relevant questions:**\n\n- [ ] Does a lower credit card utilization ratio indicate an incresed churning rate?\n- [ ] Does the credit card utilization ratio lower in churning customers? \n- [ ] How does the total transaction amount and frequency impact the churnrate?\n- [ ] How does the amount of months on book (the time the customer has had a relationsship with the bank) affect the churn risk? \n- [ ] Does the credit limit impact churn rate?\n\n- [ ] What is the influence of the income category on people with a cetrain martial status for leaving the service?\n- [ ] What card category customers needs most attention from the service providers?\n- [ ] What demographic variables are most impactful predicters of a customer churning?\n- [ ] What are the significant diffrenceses between the `Attrited Customer` vs `Existing Customer` in terms of the demographic features in the dataset?\n\nOne hypothesis is that the customers behavior prior to them leving the service should be a good indicater of them leaving. The variables that may show that could be those that show how often and how much they are using the service. If the customers a decresing their use of the credit card, this could indicate they got another card that they are using, from a competitor. ","2b6fd369":"**Now lets see the first 10 rows of the dataset:**"}}