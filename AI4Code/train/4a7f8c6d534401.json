{"cell_type":{"49c5db68":"code","3f7008ea":"code","4075df98":"code","0a019d00":"code","05db2a35":"code","d8f7aabf":"code","e671efce":"code","4442df09":"code","d88b7ca2":"code","1eeebf5f":"code","409abf86":"code","6296a408":"code","148734c4":"code","500546af":"code","967aab51":"code","559e7d55":"code","1e2a1e31":"code","d63d7598":"code","6449f30c":"code","2a4b75ee":"code","ed707b0b":"code","65b12511":"code","f3535c69":"code","10b0c574":"code","1c4937fe":"markdown","ae339e6d":"markdown","ad579ae9":"markdown","73a8855f":"markdown","3529f6d6":"markdown","947aa39a":"markdown","ec3e0fec":"markdown","f7425ac2":"markdown","bb2ba57c":"markdown","01f80080":"markdown","c34f7ad5":"markdown","29a3b0b3":"markdown","52c85984":"markdown","a84288c3":"markdown","7d942dfe":"markdown","06cd7037":"markdown","2a4b1442":"markdown","84164f2d":"markdown","2eb11cd8":"markdown","edd9741f":"markdown","d89ad748":"markdown","fbf59566":"markdown","1e8966cb":"markdown","4fa24ab1":"markdown","4d45e0c8":"markdown","ed86b945":"markdown","f9618160":"markdown","e303ebbf":"markdown"},"source":{"49c5db68":"import sqlite3\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns","3f7008ea":"#Creating a Connection object to the database\nconn = sqlite3.connect(\"..\/input\/sf-salaries\/database.sqlite\")","4075df98":"#Function to display the query result as a dataframe\ndef query_result(query):\n    cursor = conn.cursor()#creating a cursor object to run the query\n    cursor.execute(query) #execute the query pass as an argument to this function\n    df = pd.DataFrame(cursor.fetchall())#fetching the results (raw result is a list) and converting it to dataframe\n    #SQLite query result doesn't return column names of table. So we get the column names from the description of cursor \n    df.columns = [col_name[0] for col_name in cursor.description]\n    cursor.close()\n    return df","0a019d00":"src = query_result(\"SELECT * FROM Salaries;\")\nsrc","05db2a35":"query_result(\"SELECT COUNT(JobTitle) AS '#Job Titles', COUNT(DISTINCT JobTitle) AS '#Unique Job Titles' FROM Salaries;\")","d8f7aabf":"\" | \".join(list(query_result(\"SELECT DISTINCT JobTitle FROM Salaries ORDER BY JobTitle asc\")['JobTitle'])[:10])","e671efce":"query_result(\"SELECT DISTINCT Year FROM Salaries;\")","4442df09":"trend = query_result(\"SELECT Year,COUNT(*) AS 'Job Count' FROM Salaries GROUP BY Year ORDER BY Year\")\nprint(trend)\ntrend.plot(x=\"Year\",y=\"Job Count\",legend=False,marker=\"o\")\nplt.title(\"Count of reported jobs every year\")\nplt.xticks(trend.Year)\nplt.ylabel(\"No of jobs reported\");","d88b7ca2":"# Finding job titles containing the words 'data' or 'machine'\nquery_result(\"SELECT * FROM Salaries WHERE LOWER(JobTitle) LIKE '%machine%' OR JobTitle LIKE '%data%' ORDER BY JobTitle;\")","1eeebf5f":"sal_trend = query_result(\"SELECT Year,ROUND(AVG(TotalPay),2) AS 'Avg_Tot_Pay' FROM Salaries GROUP BY Year;\")\nprint(sal_trend)\nsal_trend.plot(x='Year',y='Avg_Tot_Pay',legend=False,marker=\"o\")\nplt.title(\"Trend in mean TotalPay\")\nplt.xticks(sal_trend.Year)\nplt.ylabel(\"Mean TotalPay\");","409abf86":"query_result(\"SELECT JobTitle,ROUND(AVG(TotalPay),2) AS Avg_TotalPay FROM Salaries WHERE Year=2014 AND TotalPay>0 GROUP BY JobTitle ORDER BY AVG(TotalPay) desc LIMIT 5\")","6296a408":"trend = query_result(\"\"\"SELECT Year,JobTitle,ROUND(AVG(TotalPay),2) AS Avg_TotalPay FROM Salaries WHERE JobTitle IN \n(SELECT JobTitle FROM Salaries WHERE Year=2014 AND TotalPay>0 GROUP BY JobTitle ORDER BY AVG(TotalPay) desc LIMIT 5) GROUP BY JobTitle,Year\nORDER BY Year,AVG(TotalPay) desc\"\"\")\nprint(trend)\nfig = plt.figure(figsize=(10,5))\nsns.lineplot(x=\"Year\",y=\"Avg_TotalPay\",marker=\"o\",data=trend,hue=\"JobTitle\")\nplt.xticks(trend.Year);","148734c4":"query_result(\"SELECT JobTitle,ROUND(AVG(TotalPay),2) AS Avg_TotalPay FROM Salaries WHERE Year=2014 AND TotalPay>0 GROUP BY JobTitle ORDER BY AVG(TotalPay) asc LIMIT 5\")","500546af":"trend = query_result(\"\"\"SELECT Year,JobTitle,ROUND(AVG(TotalPay),2) AS Avg_TotalPay FROM Salaries WHERE TotalPay>0 AND JobTitle IN \n(SELECT JobTitle FROM Salaries WHERE Year=2014 AND TotalPay>0 GROUP BY JobTitle ORDER BY AVG(TotalPay) asc LIMIT 5) GROUP BY JobTitle,Year\nORDER BY Year,AVG(TotalPay)\"\"\")\nprint(trend)\nfig = plt.figure(figsize=(14,5))\nsns.lineplot(x=\"Year\",y=\"Avg_TotalPay\",marker=\"o\",data=trend,hue=\"JobTitle\")\nplt.xticks(trend.Year);","967aab51":"query_result(\"SELECT Year,EmployeeName,JobTitle,MAX(TotalPay) FROM Salaries GROUP BY Year\")","559e7d55":"query_result(\"SELECT Year,EmployeeName,JobTitle,MIN(TotalPay) FROM Salaries WHERE TotalPay>0 GROUP BY Year\")","1e2a1e31":"title = [\"junior\",\"senior\",\"chief\"]\nfor i,ti in enumerate(title):\n    if i==0:\n        title_sal = query_result(f\"SELECT ROUND(AVG(TotalPay),2) as {ti} FROM Salaries WHERE TotalPay>0 AND LOWER(JobTitle) LIKE '%{ti}%'\")\n    else:\n        title_sal[ti] = query_result(f\"SELECT ROUND(AVG(TotalPay),2) as {ti} FROM Salaries WHERE TotalPay>0 AND LOWER(JobTitle) LIKE '%{ti}%'\")\nprint(title_sal)\ntitle_sal.T.plot(kind=\"bar\",legend=False)\nplt.ylabel(\"Avg TotalPay\");","d63d7598":"title = query_result(\"\"\"SELECT CASE WHEN LOWER(JobTitle) LIKE '%junior%' THEN 'junior' \n             WHEN LOWER(JobTitle) LIKE '%senior%' THEN 'senior' \n             WHEN LOWER(JobTitle) LIKE '%chief%' THEN 'chief' \n             ELSE 'others' END \n             AS Title,ROUND(AVG(TotalPay),2) AS Avg_TotalPay FROM Salaries WHERE TotalPay>0 GROUP BY Title ORDER BY AVG(TotalPay)\"\"\")\ntitle = title.loc[title[\"Title\"]!=\"others\",:].copy()\nprint(title)\ntitle.plot(kind=\"barh\",x=\"Title\",y=\"Avg_TotalPay\",legend=False,figsize=(10,5))\nplt.xlabel(\"Avg TotalPay\");","6449f30c":"pay_df = query_result(\"\"\"SELECT OvertimePay,OtherPay,Benefits,TotalPay,TotalPayBenefits FROM Salaries WHERE \nOvertimePay>0 AND OtherPay>0 AND Benefits>0 AND TotalPay>0 AND TotalPayBenefits>0 AND \nOvertimePay!='Not Provided' AND OtherPay!='Not Provided' AND Benefits!='Not Provided' AND TotalPay!='Not Provided' AND TotalPayBenefits!='Not Provided'\"\"\")\nsns.heatmap(pay_df.corr(),annot=True,mask=np.triu(pay_df.corr()),cbar=False)\nplt.title(\"Correlation b\/w various pay components\");","2a4b75ee":"query_result(\"SELECT * FROM Salaries WHERE TotalPay BETWEEN 500000 AND 1000000\")","ed707b0b":"pd.set_option(\"display.min_rows\",200)\ndf = query_result(\"SELECT * FROM Salaries\")\ndf.drop_duplicates(inplace=True)\n\ndf[\"EmployeeName\"] = df[\"EmployeeName\"].str.lower()\ndf[\"JobTitle\"] = df[\"JobTitle\"].str.lower()\n\n\ndf[\"EmployeeName\"]=df[\"EmployeeName\"].str.replace(\"  \",\" \",regex=False)\ndf[\"JobTitle\"]=df[\"JobTitle\"].str.replace(\"  \",\" \",regex=False)\n\n\ntot_yrs = df[[\"EmployeeName\",\"Year\"]].drop_duplicates().groupby(\"EmployeeName\").count().reset_index().copy()\ntot_yrs.columns = [\"EmployeeName\",\"year_count\"]\ntot_yrs.sort_values(by=\"year_count\",ascending=False,inplace=True)\ntot_yrs.drop_duplicates(\"EmployeeName\",inplace=True)\n\ndf=df.merge(tot_yrs,on=\"EmployeeName\",how=\"left\").copy()\n\ndf[\"EmployeeName\"] = df[\"EmployeeName\"].replace(\"not provided\",np.nan)\ndf[\"JobTitle\"] = df[\"JobTitle\"].replace(\"not provided\",np.nan)\n\ndf.dropna(inplace=True)\n\ntot_jobs = df[[\"EmployeeName\",\"JobTitle\",\"Year\"]].groupby([\"EmployeeName\",\"JobTitle\"]).count().reset_index().copy()\ntot_jobs.drop(columns=\"JobTitle\",inplace=True)\ntot_jobs.columns = [\"EmployeeName\",\"job_count\"]\ntot_jobs.sort_values(by=\"job_count\",ascending=False,inplace=True)\ntot_jobs.drop_duplicates(\"EmployeeName\",inplace=True)\n\n\ndf = df.merge(tot_jobs,on=[\"EmployeeName\"],how=\"left\").copy()\n\nsol = df.loc[(df[\"year_count\"]==df[\"job_count\"]) & (df[\"year_count\"]==4),:].copy()\nsol.sort_values([\"EmployeeName\",\"Year\"]).reset_index(drop=True)","65b12511":"sol = df.loc[(df[\"year_count\"]==4) & (df[\"job_count\"]==1),:].copy()\nsol.sort_values([\"EmployeeName\",\"Year\"]).reset_index(drop=True)","f3535c69":"sol = df.loc[(df[\"year_count\"]==4) & (df[\"job_count\"]<4),:].copy()\nsol.sort_values([\"EmployeeName\",\"Year\"]).reset_index(drop=True)","10b0c574":"stt = query_result(\"SELECT Status,AVG(TotalPay) FROM Salaries WHERE Status IN ('FT','PT') GROUP BY Status\")\nprint(stt)\nstt.plot(kind=\"bar\",x='Status',y='AVG(TotalPay)',legend=False);","1c4937fe":"'Cashier 3' has no previous salary history except for the year 2014","ae339e6d":"The only data related job found is 'Senior Data Entry Operator'","ad579ae9":"<h2>We'll answer the following questions<\/h2>\n<h3><ol>\n    <li><a href=\"#1\">How many unique job titles are there?<\/a><\/li>\n    <li><a href=\"#2\">What are the unique job titles?<\/a><\/li>\n    <li><a href=\"#3\">For which years is the data reported?<\/a><\/li>\n    <li><a href=\"#4\">What's the yearly trend in the count of reported jobs?<\/a><\/li>\n    <li><a href=\"#5\">Are there any jobs related to data or machine learning?<\/a><\/li>\n    <li><a href=\"#6\">What's the trend in average Total Pay over years?<\/a><\/li>\n    <li><a href=\"#7\">What are the top 5 jobs in terms of mean TotalPay in the recent year (2014)?<\/a><\/li>\n    <li><a href=\"#8\">What's the trend in Average TotalPay of the above 5 jobs?<\/a><\/li>\n    <li><a href=\"#9\">What are the bottom 5 jobs in terms of mean TotalPay in the recent year (2014)?<\/a><\/li>\n    <li><a href=\"#10\">What's the trend in Average TotalPay of the above 5 jobs?<\/a><\/li>\n    <li><a href=\"#11\">Which employee earned the most in terms of TotalPay by Year?<\/a><\/li>\n    <li><a href=\"#12\">Which employee earned the least in terms of TotalPay by Year?<\/a><\/li>\n    <li><a href=\"#13\">Is there any pattern in salaries of Junior, Senior, and Chief employee titles?<\/a><\/li>\n    <li><a href=\"#14\">Is there any correlation between various pay components?<\/a><\/li>\n    <li><a href=\"#15\">Who are the employees with TotalPay between 500,000 and 1,000,000?<\/a><\/li>\n    <li><a href=\"#16\">Who were on a single job all the 4 years?<\/a><\/li>\n    <li><a href=\"#17\">Who changed the job every year across all the 4 years?<\/a><\/li>\n    <li><a href=\"#18\">Who changed job atleast once in 4 years?<\/a><\/li>\n    <li><a href=\"#19\">How does the mean TotalPay vary between Full time and Part time job?<\/a><\/li>\n<\/ol><\/h3>","73a8855f":"<a id=\"14\"><\/a><h2>Is there any correlation between various pay components?","3529f6d6":"<a id=\"2\"><\/a><h2>What are the unique job titles?<\/h2>\n\nPrinting only first 10.","947aa39a":"<a id=\"11\"><\/a><h2>Which employee earned the most in terms of TotalPay by Year?","ec3e0fec":"<h1>Exploratory Data Analysis with SQL and Python","f7425ac2":"<a id=\"9\"><\/a><h2>What are the bottom 5 jobs in terms of mean TotalPay in the recent year (2014)?","bb2ba57c":"We can see a moderate to strong positive correlation amongst various pay components","01f80080":"<a id=\"10\"><\/a><h2>What's the trend in Average TotalPay of the above 5 jobs?","c34f7ad5":"<a id=\"6\"><\/a><h2>What's the trend in average Total Pay over years?","29a3b0b3":"<a id=\"8\"><\/a><h2>What's the trend in Average TotalPay of the above 5 jobs?","52c85984":"<a id=\"15\"><\/a><h2>Who are the employees with TotalPay between 500,000 and 1,000,000?","a84288c3":"<a id=\"3\"><\/a><h2>For which years is the data reported?","7d942dfe":"<a id=\"12\"><\/a><h2>Which employee earned the least in terms of TotalPay by Year?","06cd7037":"<a id=\"1\"><\/a><h2>How many unique job titles are there?","2a4b1442":"'Chief Investment Officer' has no previous salary history except for the year 2014. All the 5 jobs don't have data for 2011.","84164f2d":"<a id=\"17\"><\/a><h2>Who changed the job every year across all the 4 years?<\/h2>","2eb11cd8":"<a id=\"4\"><\/a><h2>What's the yearly trend in the count of reported jobs?","edd9741f":"<a id=\"18\"><\/a><h2>Who changed job atleast once in 4 years?","d89ad748":"Missing values are marked as 'Not Provided'. Almost every column has missing values","fbf59566":"Employees with 'Junior' in their titles have the least average TotalPay followed by 'Senior' with 'Chief' being the highest.\n\n<h3>The above query can be performed directly using SQL as shown below.","1e8966cb":"<h2>Select all the records from the table Salaries","4fa24ab1":"<a id=\"19\"><\/a><h2>How does the mean TotalPay vary between Full time and Part time job?<\/h2>\nFull time: Status = FT<br>\nPart time: Status = PT","4d45e0c8":"<a id=\"5\"><\/a><h2>Are there any jobs related to data or machine learning?","ed86b945":"<a id=\"16\"><\/a><h2>Who were on a single job all the 4 years?<\/h2>\n\n<h3>This query gets complicated in SQL. Hence, we'll implement it in Python","f9618160":"<a id=\"13\"><\/a><h2>Is there any pattern in salaries of Junior, Senior, and Chief employee titles?","e303ebbf":"<a id=\"7\"><\/a><h2>What are the top 5 jobs in terms of mean TotalPay in the recent year (2014)?"}}