{"cell_type":{"20866ff4":"code","792491ab":"code","6337591b":"code","402a587f":"code","b55f1fc0":"code","7bcdeca3":"code","209593d0":"code","0ddb30be":"code","003a2d13":"code","40be5283":"code","1d4448ba":"code","06ff9c9a":"code","9d28b3dd":"code","263fec40":"code","617d0f45":"code","9d3fc126":"code","64af2679":"code","1e6aaf38":"code","086ebf4f":"code","0ead8e3d":"code","b3327fdb":"code","2822e7ff":"code","857a27fa":"code","7979d235":"code","15741915":"code","3c38be02":"code","d19403f7":"code","8455e090":"code","a80f6b84":"code","17e25bec":"code","0f768445":"code","f28e22de":"code","51ac180e":"code","c666f64f":"code","ed5fee21":"code","9a2621b4":"code","322be634":"code","5a1bed77":"code","5979137c":"code","774abfa7":"code","06feecfe":"code","3d4cc070":"code","3cb5bed3":"code","b94f6c55":"code","e1223af0":"code","2a576fcc":"code","4370185f":"code","009e1ab2":"code","615ca0ff":"code","51570ddd":"code","2988c501":"markdown","fd62e3d0":"markdown","a78a0c00":"markdown","902df64d":"markdown","cdd9096f":"markdown","1b8dcfc7":"markdown","a97e3a7d":"markdown","991693a3":"markdown","ae25cb95":"markdown","0592b3cd":"markdown","41e7296f":"markdown","486ab8bf":"markdown","62c1abcc":"markdown","33325616":"markdown","0ea69c57":"markdown","e8fa208b":"markdown","938646a4":"markdown","19bd4e02":"markdown","105d0eec":"markdown","61279439":"markdown","3e23f6ec":"markdown","ea29205d":"markdown","718b51dc":"markdown","8d6837db":"markdown","52802754":"markdown","db909ff0":"markdown","fcf3da45":"markdown"},"source":{"20866ff4":"import pandas as pd\nimport numpy as np\nimport math\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn import metrics\nfrom sklearn.metrics import confusion_matrix\nfrom sklearn.metrics import classification_report\nfrom imblearn.under_sampling import RandomUnderSampler\nfrom sklearn.metrics import roc_auc_score, roc_curve, accuracy_score","792491ab":"risk_avc_df = pd.read_csv('..\/input\/stroke-prediction-dataset\/healthcare-dataset-stroke-data.csv')","6337591b":"risk_avc_df.head()","402a587f":"risk_avc_df.head()","b55f1fc0":"print('number of rows: {}'. format(risk_avc_df.shape[0])) #Shape print linhas e colunas de um dataframe\nprint('number of cols: {}'. format(risk_avc_df.shape[1]))","7bcdeca3":"risk_avc_df.dtypes","209593d0":"#Id column is not relevant\nrisk_avc_df.drop(['id'], axis=1, inplace=True)","0ddb30be":"risk_avc_df['age'] = risk_avc_df['age'].astype(int) # Converting age to int\nrisk_avc_df.head()","003a2d13":"risk_avc_df.isna().sum()","40be5283":"risk_avc_df.bmi.fillna(risk_avc_df['bmi'].mean(), inplace=True)\nrisk_avc_df.head()","1d4448ba":"print('Total = ', len(risk_avc_df))\nprint('Total people with stroke: = ', len( risk_avc_df[risk_avc_df['stroke'] == 1] ))\nprint('percentage with Stroke: =', round((len(risk_avc_df[risk_avc_df['stroke'] == 1]) \/ len(risk_avc_df)) * 100))\nprint('Total people without Stroke =', len( risk_avc_df[risk_avc_df['stroke'] == 0] ))\nprint('percentage without Stroke = ', round((len(risk_avc_df[risk_avc_df['stroke'] == 0]) \/ len(risk_avc_df)) * 100))","06ff9c9a":"risk_avc_df.dtypes","9d28b3dd":"#SEPARATING NUMERICAL AND CATEGORICAL VARIABLES FOR FURTHER ANALYSIS\n\nnum_attributes = risk_avc_df[['age', 'avg_glucose_level', 'bmi']]\ncat_attributes = risk_avc_df[['gender', 'hypertension', 'heart_disease', 'ever_married',\n                             'work_type', 'Residence_type', 'smoking_status']]","263fec40":"cat_attributes.sample()","617d0f45":"num_attributes.sample()","9d3fc126":"df1_avc = risk_avc_df.copy()","64af2679":"df1_avc.head()","1e6aaf38":"df2_avc = df1_avc.copy()","086ebf4f":"df2_avc.head()","0ead8e3d":"num_attributes.hist(bins=25, figsize=(20,10));","b3327fdb":"plt.figure(figsize=(15,5))\nsns.countplot( x='stroke', palette='Set2', data=risk_avc_df);","2822e7ff":"plt.figure(figsize=[15,5])\nsns.boxplot(x=num_attributes['age'], y=cat_attributes['gender']);","857a27fa":"plt.figure(figsize=(15,5))\n\nsns.countplot( x='gender', hue=risk_avc_df['stroke'], palette='Set2', data=cat_attributes);","7979d235":"plt.figure(figsize=(15,5))\n\nsns.countplot( x='work_type', hue=risk_avc_df['stroke'], palette='Set2', data=cat_attributes);","15741915":"plt.figure(figsize=(15,5))\nsns.countplot( x='Residence_type', palette='Set2', data=cat_attributes);","3c38be02":"plt.figure(figsize=(15,5))\nsns.countplot( x='ever_married', hue=risk_avc_df['stroke'], palette='Set2', data=cat_attributes);","d19403f7":"plt.figure(figsize=(15,5))\nsns.countplot( x='smoking_status', hue=risk_avc_df['stroke'], palette='Set2', data=cat_attributes);","8455e090":"plt.figure(figsize=(10,5))\ncorrelation = num_attributes.corr( method='pearson' )\nsns.heatmap( correlation, annot=True );","a80f6b84":"plt.figure(figsize=(10,5))\ncorrelation = cat_attributes.corr( method='pearson' )\nsns.heatmap( correlation, annot=True );","17e25bec":"risk_avc_df.head(3)","0f768445":"cat_attributes.head(2)","f28e22de":"from sklearn.preprocessing import OneHotEncoder\nonehotencoder = OneHotEncoder()\ncat_attributes = onehotencoder.fit_transform(cat_attributes).toarray()","51ac180e":"cat_attributes = pd.DataFrame(cat_attributes)","c666f64f":"cat_attributes.head(3)","ed5fee21":"x = pd.concat([cat_attributes, num_attributes], axis=1)","9a2621b4":"x.head()","322be634":"from sklearn.preprocessing import MinMaxScaler\nscaler = MinMaxScaler()\nx = scaler.fit_transform(x)","5a1bed77":"x","5979137c":"y = risk_avc_df['stroke']\ny","774abfa7":"from sklearn.model_selection import train_test_split\nx_train, x_test, y_train, y_test = train_test_split(x, y, stratify=y, test_size = 0.25)","06feecfe":"plt.figure(figsize=(15,5))\nsns.countplot( x='stroke', palette='Set2', data=risk_avc_df);","3d4cc070":"# use under-sampling technique\nrus = RandomUnderSampler()\nx_res, y_res = rus.fit_resample(x_train, y_train)\n \n# see the balance of classes\nprint(pd.Series(y_res).value_counts())\n \n# plot the new class distribution\nsns.countplot(y_res);","3cb5bed3":"model_res = LogisticRegression()","b94f6c55":"model_res.fit(x_res, y_res)","e1223af0":"# make predictions on top of test data\ny_pred_res = model_res.predict(x_test)\ny_proba_res = model_res.predict_proba(x_test)\n\n# print model accuracy\nprint(\"Acur\u00e1cia: {:.4f}\\n\".format(accuracy_score(y_test, y_pred_res)))\n \n# plot the confusion matrix\ncm = confusion_matrix(y_test, y_pred_res)\nsns.heatmap(cm, annot=True);\n \n# print classification report\nprint(\"Relat\u00f3rio de Classifica\u00e7\u00e3o:\\n\", classification_report(y_test, y_pred_res, digits=4))","2a576fcc":"lr = LogisticRegression()","4370185f":"lr.fit(x_train, y_train)","009e1ab2":"y_lr_predictic = lr.predict(x_test)","615ca0ff":"# Generating confusion matrix\ncm = confusion_matrix(y_test, y_lr_predictic)\nsns.heatmap(cm, annot=True);","51570ddd":"print(classification_report(y_test, y_lr_predictic)); # View all the metrics together","2988c501":"# PRE-PRECEDING THE BASE","fd62e3d0":"## Numerical Attributes\n","a78a0c00":"## PUTTING VALUES ON THE SAME SCALE","902df64d":"## As we can see in the graph, the base is unbalanced","cdd9096f":"##  Check NA","1b8dcfc7":"# LINEAR REGRESSION AFTER UNDER-SAMPLING","a97e3a7d":"# LINEAR REGRESSION BEFORE UNDER-SAMPLING","991693a3":"# FEATURE ENGINEERING","ae25cb95":"## SORTING OUT BASE TRAIN\/TEST**","0592b3cd":"## Numerical Variable","41e7296f":"# EXPLORATORY DATA ANALYSIS","486ab8bf":"# DATA DESCRIPTION","62c1abcc":"## Descriptive Statistical","33325616":"## DataTypes","0ea69c57":"The use of the dummy variable will allow the capture of the difference of the expected value between categories, that is, the coefficient (Beta) of the model will be the average value that a given category represents.","e8fa208b":"People who did not smoke had a higher incidence of stroke than others who smoke or have already smoked. However, there is a large part that is unknown and that may - or not - change this scenario.","938646a4":"**1)** Most people who have had a stroke work in the private sector, because it is where they most employ them.\n\n**2)** Next comes self-employed workers","19bd4e02":"# IMPORTS","105d0eec":"# LOAD DATA","61279439":"## BIVARIATED ANALYSIS","3e23f6ec":"Most people who have had a stroke are married.A maioria da pesssoas que tiveram AVC s\u00e3o casadas.","ea29205d":"## CREATING DUMMYS VARIABLES","718b51dc":"## Categorical Attributes","8d6837db":"# TESTING UNDERSIMPLING","52802754":"The transformation of your data is a practice to prevent your algorithm from being biased towards variables with a higher order of magnitude.","db909ff0":"## Data Dimesion","fcf3da45":"Workers residing in urban and rural areas are distributed even though they are equally"}}