{"cell_type":{"574b7484":"code","02b070e6":"code","5a64afad":"code","27c9fdc8":"code","6e1cc296":"code","eb1529fd":"code","ccd8f30b":"code","c4b46f6d":"code","acc58be8":"code","63307548":"code","9df84182":"code","de732dc7":"code","a6a3047b":"code","26e4152e":"code","1f517d19":"code","ef06514e":"code","c4e1f628":"code","53f5cd32":"code","261fee79":"code","7516c01c":"code","4af05d51":"code","fdd99535":"code","2c3fee37":"markdown","b4118a5b":"markdown","5fe92189":"markdown","3570ac76":"markdown","3c07c4a7":"markdown","a0489375":"markdown","e020a993":"markdown","7b8c2677":"markdown","213502f7":"markdown","6ecd1bee":"markdown","6fcd5a90":"markdown","b61afad1":"markdown","713dbe52":"markdown","12f21d91":"markdown","1f6cc2b1":"markdown","0748813d":"markdown","41061c2e":"markdown","33d25f7e":"markdown","7f29eba5":"markdown"},"source":{"574b7484":"import numpy as np\nimport pandas as pd","02b070e6":"df_train = pd.read_csv(\"..\/input\/u.data.csv\", names=['user_id', 'item_id', 'ranking', 'time'], sep='\\t')\ndf_train['time'] = pd.to_datetime(df_train['time'],unit='s')\ndf_train = df_train.sort_values(by='time')","5a64afad":"df_train = df_train[df_train['ranking'] > 3]","27c9fdc8":"df_train.head()","6e1cc296":"names=['item_id', 'movie title', 'release date', 'video release date',\n              'IMDb URL', 'unknown', 'Action', 'Adventure', 'Animation',\n              'Children', 'Comedy', 'Crime', 'Documentary', 'Drama', 'Fantasy',\n              'Film-Noir', 'Horror', 'Musical', 'Mystery', 'Romance', 'Sci-Fi',\n              'Thriller', 'War', 'Western' ]\ndf_items = pd.read_csv(\"..\/input\/u.item\", names= names, sep='|', encoding = 'ISO-8859-1')","eb1529fd":"df_items = df_items.filter(['item_id', 'movie title', 'Action', 'Adventure', 'Animation',\n              'Children', 'Comedy', 'Crime', 'Documentary', 'Drama', 'Fantasy',\n              'Film-Noir', 'Horror', 'Musical', 'Mystery', 'Romance', 'Sci-Fi',\n              'Thriller', 'War', 'Western'])","ccd8f30b":"df_items.head()","c4b46f6d":"df_train_2 = pd.merge(df_train, df_items, on='item_id')","acc58be8":"df_train_2[df_train_2['user_id'] == 914]","63307548":"l = ['Action', 'Adventure', 'Animation', \n    'Children', 'Comedy', 'Crime', 'Documentary', 'Drama', 'Fantasy',\n    'Film-Noir', 'Horror', 'Musical', 'Mystery', 'Romance', 'Sci-Fi',\n    'Thriller', 'War', 'Western']\n    \ndef f(row):\n    sum = 0\n    for i in l:\n        sum = sum+row[i] \n    return sum\n    \ndf_train_2['Total'] = df_train_2.apply(f, axis=1)\ndf_train_2.head()","9df84182":"df_items['Total'] = df_items.apply(f, axis=1)\ndf_items['Total'].describe()","de732dc7":"def get_features_movie(item_id):\n    l = ['Action', 'Adventure', 'Animation', \n    'Children', 'Comedy', 'Crime', 'Documentary', 'Drama', 'Fantasy',\n    'Film-Noir', 'Horror', 'Musical', 'Mystery', 'Romance', 'Sci-Fi',\n    'Thriller', 'War', 'Western']\n    \n    features = []\n    temp = df_items[df_items['item_id'] == item_id]\n    for i in l:\n        if temp.iloc[0][i]:\n            features = features + [i]\n    \n    return features\n\ndef convert_to_list(item_id):\n    return \" \".join([str(x) for x in get_features_movie(item_id)[:1]])\n\ntrain_watched = pd.DataFrame(columns=['user_id', 'watched'])\n\nfor index, user_id in enumerate(range(min(df_train_2['user_id']), max(df_train_2['user_id']))):\n    d = df_train_2[df_train_2['user_id'] == user_id].filter(['item_id'])\n    l = d['item_id'].tolist()\n    l_to_string = \" \".join([convert_to_list(x)+\" \"+str(x) for x in l])\n    train_watched.loc[index] = [user_id, l_to_string]","a6a3047b":"train_watched.head()","26e4152e":"from gensim.test.utils import common_texts\nfrom gensim.models.word2vec import Word2Vec","1f517d19":"list_doc = []\n\nfor row in train_watched.to_dict(orient='record'):\n    list_doc.append(str(row['watched']).strip().split(' '))","ef06514e":"model = Word2Vec(list_doc, window=5, min_count=1, workers=4)","c4e1f628":"def most_similar(item_id_or_genre):\n    try:\n        print(\"Similar of \"+df_items[df_items['item_id'] == int(item_id_or_genre)].iloc[0]['movie title'])\n    except:\n        print(\"Similar of \"+item_id_or_genre)\n    return [(x, df_items[df_items['item_id'] == int(x[0])].iloc[0]['movie title']) for x in model.wv.most_similar(item_id_or_genre)]","53f5cd32":"most_similar('Action')","261fee79":"most_similar('Horror')","7516c01c":"most_similar('226')","4af05d51":"df_train_2[df_train_2['user_id'] == 914].filter(['item_id', 'movie title']+l)","fdd99535":"def create_avg_user_vector(user_id):\n    item_id_list = df_train_2[df_train_2['user_id'] == user_id]['item_id'].tolist()\n    vector_item_id_list = [model.wv[str(x)] for x in item_id_list]\n    return np.average(vector_item_id_list, axis=0)\n\ndef most_similar_by_vector(vector):\n    return [(x, df_items[df_items['item_id'] == int(x[0])].iloc[0]['movie title']) for x in model.wv.similar_by_vector(vector)]\n\nmost_similar_by_vector(create_avg_user_vector(914))","2c3fee37":"Now we will create a dataset with all the users and all their watched films sorted by timestamp. Also we'll add the first genre that is related to each movie. I know that a movie has several genres but this is to keep the example simple. Undoubtedly this could be coded better.","b4118a5b":"And filter with ranking above of 3 points","5fe92189":"Merge train with items to get their genre","3570ac76":"First we'll get the data and sort by time. The reason of sorting by time is due to the fact that we need the movies that each user saw in chronological order.","3c07c4a7":"Therefore in the new dataset we can see the trace of watched films and its genre for each user. It's time to use word2vec.","a0489375":"In the following cell, we can see that the majority of the films have 2 features. In the next steps we will see why this is important","e020a993":"Getting item features","7b8c2677":"One film can be in several genres at once. We can see this adding a column 'Total' that is the sum of all the genres. ","213502f7":"## Some considerations\n* The idea of use the first genre of the table is completely arbitrary. I tried doing the same adding two genres to see if it could be better. It seems that it's not working notoriusly better. Also using all the genres in the documents imples that the window size in the model must be tunned. It could be nice for a future work of this notebook.\n* It is possible that genre that are in the last columns could not be in the vocabulary. That is because we get only the first genre.\n* This ideas became after watching the following video https:\/\/www.youtube.com\/watch?v=TINZK94reEE. In that video, Flavian said that he could perform recommendation without adding a new implementation of word2vec. I suspect that he did something similar of this. Also there is a paper about it: https:\/\/arxiv.org\/pdf\/1607.07326.pdf\n* The idea of represent an user with an average is from https:\/\/towardsdatascience.com\/using-word2vec-for-music-recommendations-bb9649ac2484 \n* If someone read this article and have advice of improve the code, it is completely welcomed!\n\nThanks for reading! :)","6ecd1bee":"The idea of this notebook is to introduce an idea to use Word2Vec in a well-known dataset such as MovieLens. The approach is to define documents guided by what each user saw. After train we can relate films and its features. Also users can be related to them.","6fcd5a90":"It seems that it works! The query of the word 'Action' is near to action movies such as 'GoldenEye (1995)'. What about 'Horror'?","b61afad1":"Analysing the results we can see that almost the movies are comedies or family films. For instance 'First Kid (1996)' and 'Father of the Bride Part II (1995)' are definetly comedie films. Also the last one it's romantic too. So, we can describe an user using their movies preferencies. ","713dbe52":"All of the movies listed are about Horror. Thumbs up! :)","12f21d91":"Let's see if how the train dataframe was built. We want to see all the items watched by user_id 914","1f6cc2b1":"Let's define a user as a vector of the average of movies that he\/she saw.","0748813d":"All the results are almost action, and also Die Hard 3 is recommended. Quite good! This could be used when you want a recommendation from a genre or an item. But what about a recommendation for a user?. For example what films the user_id 914 saw?","41061c2e":"Let's see movies related with Die Hard 2...","33d25f7e":"After train we have to see the results.","7f29eba5":"# Using Metadata with Word2Vec to get recommendations in MovieLens"}}