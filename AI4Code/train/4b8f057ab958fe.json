{"cell_type":{"9aca4ce9":"code","ca25b36b":"code","43ca7042":"code","5c93e9a8":"code","8112fe34":"code","cc49a1b4":"code","9e618b15":"code","a64363d4":"code","2e7e76a2":"code","2089a07c":"markdown","5d569676":"markdown","7031c8d9":"markdown"},"source":{"9aca4ce9":"import os\nimport re\nimport numpy as np\nimport pandas as pd\nimport pickle\nimport matplotlib.pyplot as plt\n\nfrom tqdm.notebook import tqdm\n\nimport lightgbm","ca25b36b":"data = pd.read_csv('..\/input\/jane-street-market-prediction\/train.csv')","43ca7042":"FEATURES = [f for f in data.columns if re.match('^feature_', f)]\nAUC_TARGET = [f for f in data.columns if re.match('^rep_', f)]\nDATE = 'date'\nWEIGHT = 'weight'\nTARGET = 'resp'","5c93e9a8":"NAN = -9999\n\nX = data.loc[data[WEIGHT] > 0.0][FEATURES].fillna(NAN).values\ny = data.loc[data[WEIGHT] > 0.0][TARGET].values > 0.0","8112fe34":"model = lightgbm.LGBMClassifier(learning_rate=0.05, n_estimators=150, reg_alpha=0.5, reg_lambda=2.0, subsample=0.8, colsample_bytree=0.6, num_leaves=35)\nmodel.fit(X, y, eval_set=(X, y), eval_metric='auc')","cc49a1b4":"pred = model.predict_proba(X)[:, 1]\nplt.hist(pred, 100, density=True, color='tab:red', alpha=0.5)\nplt.vlines(0.5, *plt.ylim(), color='k', alpha=0.5, linestyle='--');","9e618b15":"pickle.dump(model, open(os.path.join('..\/working', 'model.pkl'), 'wb'), protocol=pickle.HIGHEST_PROTOCOL)","a64363d4":"THR = 0.5","2e7e76a2":"import janestreet\nenv = janestreet.make_env()\niter_test = env.iter_test()\n\nfor (test_df, sample_prediction_df) in tqdm(iter_test):\n    sample_prediction_df.action = (model.predict_proba(test_df[FEATURES].fillna(NAN).values)[:, 1] > THR).astype(int)\n    env.predict(sample_prediction_df)","2089a07c":"# Plot","5d569676":"# Save","7031c8d9":"# Submission"}}