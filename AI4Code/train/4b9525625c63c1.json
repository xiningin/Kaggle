{"cell_type":{"486e075f":"code","265677eb":"code","501d106e":"code","87f9c066":"code","34902620":"code","ac69b14c":"code","aa41be1a":"code","252feb48":"code","6b770587":"code","3193130e":"code","7eb70167":"code","fc7ffe8c":"code","d57b3b42":"code","d584a826":"code","ab4d8519":"code","ab3bec67":"code","e28b5f60":"code","8cba8fd6":"code","601cc6e9":"code","50cf1e23":"code","1b8b0a14":"code","6be4c657":"code","44f0e81c":"code","32b35021":"markdown","57863d57":"markdown","f2b2f458":"markdown","3f296211":"markdown","953eef0c":"markdown","b6e811d8":"markdown","21755102":"markdown","f4707f5d":"markdown","acdbdc6a":"markdown","21b2a4df":"markdown","0e589feb":"markdown","55d320b0":"markdown","2cfea561":"markdown","c8747499":"markdown","e05877e2":"markdown","97f0dbbb":"markdown","65580c7a":"markdown","1a4f7af1":"markdown","21775a78":"markdown","666e1a9b":"markdown","a9d6d496":"markdown","9d4053b7":"markdown","5bc4fa66":"markdown","91a2d454":"markdown","e310cfb2":"markdown","384c7de2":"markdown"},"source":{"486e075f":"!pip install lets_plot==2.0.2","265677eb":"import numpy as np\nimport pandas as pd\nimport colorcet as cc\n\nfrom lets_plot import *\nfrom lets_plot.geo_data import *\nLetsPlot.setup_html()","501d106e":"def get_counts_df(local_df, *, column, column_name=None):\n    vc_df = local_df[column].value_counts().to_frame('count')\n    vc_df.index.name = column_name if column_name else column\n    vc_df = vc_df.reset_index()\n    return vc_df","87f9c066":"df = pd.read_csv('..\/input\/nobel-prize-from-1901-till-2020\/nobel_final.csv')\n\nall_countries = pd.Series(list(set(list(df.born_country_code) + \\\n                                   list(df.died_country_code) + \\\n                                   list(df.country_of_university))))\nall_countries = all_countries[~all_countries.isna()]\ngeocoded_countries_df = geocode(names=all_countries, level='country').ignore_all_errors().get_geocodes()\ngeocoded_countries_dict = geocoded_countries_df.set_index('country').to_dict()['found name']\ndf = df.replace({\n    'born_country_code':\n        dict(geocoded_countries_dict, \\\n             **{str(c): np.nan for c in set(df.born_country_code) - set(geocoded_countries_dict.keys())}),\n    'died_country_code':\n        dict(geocoded_countries_dict, \\\n             **{str(c): np.nan for c in set(df.died_country_code) - set(geocoded_countries_dict.keys())}),\n    'country_of_university':\n        dict(geocoded_countries_dict, \\\n             **{str(c): np.nan for c in set(df.country_of_university) - set(geocoded_countries_dict.keys())})\n})\ndf = df.rename(columns={'born_country_code': 'born_country', \\\n                        'died_country_code': 'died_country', \\\n                        'share': 'prize_share'})\n\ndf['decade'] = (df.year \/ 10).astype(int) * 10\ndf['fullname'] = df.firstname + ' ' + df.surname\n\ndf.head()","34902620":"country_prizes_df = df[~df.country_of_university.isna()]\\\n                      .drop_duplicates(subset=['country_of_university', 'year', 'category'])\ncountry_prizes_df = country_prizes_df.rename(columns={'country_of_university': 'country'})\nlaureates_df = df.drop_duplicates(subset=['fullname'])\nnot_migrated_laureates_df = df[(~df.died_country.isna())&(df.born_country == df.died_country)]\\\n                              .drop_duplicates(subset=['born_country', 'died_country', 'fullname'])\nmigrated_laureates_df = df[(~df.died_country.isna())&(df.born_country != df.died_country)]\\\n                          .drop_duplicates(subset=['born_country', 'died_country', 'fullname'])","ac69b14c":"decades = sorted(df.decade.unique())","aa41be1a":"N = 10\ncountries_colors = {country: cc.palette['glasbey_dark'][i] \\\n                    for i, country in enumerate(geocoded_countries_dict.values())}\nplots = []\nfor d, column, counted_name in [(country_prizes_df, 'country', 'Nobel prizes'), \\\n                                (not_migrated_laureates_df, 'born_country', 'non migrated laureates'), \\\n                                (migrated_laureates_df, 'died_country', 'immigrated laureates'), \\\n                                (migrated_laureates_df, 'born_country', 'emigrated laureates')]:\n    local_df = get_counts_df(d, column=column, column_name='country')\n    local_df['color'] = np.vectorize(countries_colors.get)(local_df.country)\n    plots.append(ggplot(local_df) + \\\n        geom_bar(aes(x='country', y='count', color='color', fill='color'), \\\n                 stat='identity', sampling=sampling_pick(N), alpha=.75, show_legend=False, \\\n                 tooltips=layer_tooltips().line('@country').line('{0} number|@count'.format(counted_name))) + \\\n        scale_color_identity() + scale_fill_identity() + \\\n        ggtitle('Top {0} Countries by {1}'.format(N, counted_name.title())) + \\\n        theme(axis_text_x='blank', axis_ticks_x='blank'))\n\nw, h = 400, 300\nbunch = GGBunch()\nbunch.add_plot(plots[0], 0, 0, w, h)\nbunch.add_plot(plots[1], w, 0, w, h)\nbunch.add_plot(plots[2], 0, h, w, h)\nbunch.add_plot(plots[3], w, h, w, h)\nbunch.show()","252feb48":"migrated_laureates_df['migration'] = migrated_laureates_df.born_country + ' \u2192 ' + migrated_laureates_df.died_country\nmigration_df = get_counts_df(migrated_laureates_df, column='migration')\n\nggplot(migration_df[migration_df['count'] > 1]) + \\\n    geom_bar(aes(x='migration', y='count', fill='count'), stat='identity', show_legend=False, \\\n             tooltips=layer_tooltips().line('@migration').line('migrated laureates number|@count')) + \\\n    ggtitle('Popular Migration Directions for Nobel Laureates') + \\\n    theme(axis_text_x='blank', axis_ticks_x='blank')","6b770587":"countries_df = get_counts_df(country_prizes_df, column='country')\ntop_countries = countries_df[countries_df['count'].cumsum() < 3 * country_prizes_df.shape[0] \/ 4].country.values\ncountry_prizes_df['half'] = np.where(country_prizes_df.country.isin(top_countries), country_prizes_df.country, 'Other')\ncountry_prizes_df.half = pd.Categorical(country_prizes_df.half, list(top_countries) + ['Other'])\nggplot(country_prizes_df.groupby(['decade', 'half']).count().iloc[:, 0].to_frame('count').groupby(level=0)\\\n               .apply(lambda x: x \/ float(x.sum())).sort_values(by='half')\\\n               .sort_values(by='half').reset_index()) + \\\n    geom_bar(aes(x='decade', y='count', group='half', fill='half'), stat='identity') + \\\n    scale_x_continuous(breaks=decades, labels=[str(d) for d in decades]) + ylab('proportion of prizes') + \\\n    scale_fill_discrete(name='country') + \\\n    ggtitle('Prize Proportion between Top Countries and Others') + \\\n    theme(axis_tooltip='blank')","3193130e":"country_boundaries_gdf = geocode_countries().get_boundaries()\n\nggplot() + \\\n    geom_map(aes(fill='count'), \\\n             data=laureates_df.groupby('born_country').count().iloc[:, 0].to_frame('count').reset_index(), \\\n             map=country_boundaries_gdf, \\\n             map_join=('born_country', 'country'),\n             tooltips=layer_tooltips().line('@born_country').line('laureates number|@count')) + \\\n    scale_fill_gradient(low='#4575b4', high='#d73027') + \\\n    ggtitle('Distribution of Nobel Laureates in the World') + \\\n    theme(axis_title='blank', axis_text='blank', axis_ticks='blank', axis_line='blank')","7eb70167":"N = 10\n\ntop_universities = country_prizes_df.name_of_university.value_counts().to_frame('count')[:N].index\nggplot(country_prizes_df[country_prizes_df.name_of_university.isin(top_universities)]) + \\\n    geom_bar(aes(x='name_of_university', group='category', fill='category'), \\\n             tooltips=layer_tooltips().line('^x').line('@|@category').line('prizes number|^y')) + \\\n    xlab('university') + \\\n    ggtitle('Top {0} Universities by Prize Number'.format(N)) + \\\n    theme(axis_text_x='blank', axis_ticks_x='blank')","fc7ffe8c":"p1 = ggplot(laureates_df) + \\\n    geom_bar(aes(x='gender', fill='gender')) + \\\n    ggtitle('Gender Ratio')\np2 = ggplot(laureates_df) + \\\n    geom_bar(aes(x='category', group='gender', fill='gender')) + \\\n    ggtitle('Gender Ratio by Category')\np3 = ggplot(laureates_df) + \\\n    geom_bar(aes(x='decade', group='gender', fill='gender')) + \\\n    scale_x_discrete(labels=df.decade.unique().astype(str)) + \\\n    ggtitle('Gender Ratio by Decade')\n\nw, h = 600, 300\n\nbunch = GGBunch()\nbunch.add_plot(p1, 0, 0, w, h)\nbunch.add_plot(p2, 0, h, w, h)\nbunch.add_plot(p3, 0, 2 * h, w, h)\nbunch.show()","d57b3b42":"ggplot(df) + geom_bar(aes(x='category', fill='category')) + ggtitle('Nobel Prizes by Categories')","d584a826":"breaks = sorted(df.prize_share.unique())\nlabels = ['1' if b == 1 else '1\/{0}'.format(b) for b in breaks]\nggplot(df) + \\\n    geom_bar(aes(x='prize_share', group='category', fill='category')) + \\\n    scale_x_continuous(name='prize share', breaks=breaks, labels=labels) + scale_fill_discrete() + \\\n    ggtitle('Sharing Prizes') + \\\n    theme(axis_tooltip='blank')","ab4d8519":"ggplot(df.groupby(['year', 'category']).agg({'decade': 'count', 'age_get_prize': 'mean'}).reset_index()) + \\\n    geom_point(aes(x='year', y='category', size='decade', color='age_get_prize'), shape=15, \\\n               tooltips=layer_tooltips().line('laureates number|^size').line('laureates mean age|^color')\\\n                       .line('@|@year').line('@|@category')) + \\\n    scale_x_continuous(breaks=decades, labels=[str(d) for d in decades]) + \\\n    scale_size(name='', range=[1, 2]) + \\\n    scale_color_gradient(name='age get prize', low='#1a9850', high='#d73027') + \\\n    ggtitle('Nobel Prizes by Year and Category') + \\\n    ggsize(900, 200) + \\\n    theme(axis_tooltip='blank')","ab3bec67":"ggplot(laureates_df) + \\\n    geom_density(aes(x='age'), color='#3182bd', fill='#9ecae1') + \\\n    ggtitle('Death Age Distribution of Nobel Laureates')","e28b5f60":"ggplot(df) + \\\n    geom_histogram(aes(x='age_get_prize'), binwidth=5, boundary=22) + \\\n    ggtitle('Distribution of Nobel Prize Winners Age')","8cba8fd6":"ggplot(df, aes(x='age', y='age_get_prize')) + \\\n    geom_bin2d(binwidth=[5, 5]) + \\\n    scale_fill_gradient(low='#edf8fb', high='#006d2c') + \\\n    facet_grid(x='gender') + \\\n    ggtitle('Common Distribution of Death Age and Getting the Prize Age')","601cc6e9":"ggplot(df) + \\\n    geom_boxplot(aes(x='category', y='age_get_prize', fill='category')) + \\\n    facet_grid(x='gender') + \\\n    ggtitle('Aggregated Information About Age by Category and Gender')","50cf1e23":"ggplot(df, aes(x='year', y='age_get_prize')) + \\\n    geom_point(aes(color='gender')) + geom_smooth(method='loess', color='black') + \\\n    scale_x_continuous(breaks=decades, labels=[str(d) for d in decades]) + \\\n    ggtitle('Distribution of Ages by Years')","1b8b0a14":"ggplot(df, aes(x='year', y='age_get_prize')) + \\\n    geom_point(aes(color='gender')) + geom_smooth(method='loess', color='black') + \\\n    scale_x_continuous(breaks=decades, labels=[str(d) for d in decades]) + \\\n    facet_grid(y='category') + \\\n    ggtitle('Category Wise Distribution of Ages by Years')","6be4c657":"N = 20\n\np1 = ggplot(df.sort_values(by='age_get_prize', ascending=False)[:N]) + \\\n    geom_bar(aes(x='fullname', y='age_get_prize', fill='gender'), stat='identity') + \\\n    ggtitle('Top {0} Oldest Nobel Prize Laureates'.format(N))\np2 = ggplot(df.sort_values(by='age_get_prize', ascending=False)[-N:]) + \\\n    geom_bar(aes(x='fullname', y='age_get_prize', fill='gender'), stat='identity') + \\\n    ggtitle('Top {0} Youngest Nobel Prize Laureates'.format(N))\n\nbunch = GGBunch()\nbunch.add_plot(p1, 0, 0, 400, 300)\nbunch.add_plot(p2, 400, 0, 400, 300)\nbunch.show()","44f0e81c":"multiple_laureates = list({k: v for k, v in (df.fullname.value_counts() > 1).items() if v}.keys())\nggplot(df[df.fullname.isin(multiple_laureates)]) + \\\n    geom_point(aes(x='year', y='fullname', color='category', fill='category', \\\n                   shape='gender', size='age_get_prize'), \\\n               alpha=.5, tooltips=layer_tooltips().line('@fullname').line('year get prize|@year')\\\n                                                  .line('prize category|@category')\\\n                                                  .line('prize share|1\/@prize_share')\\\n                                                  .line('university|@name_of_university')\n                                                  .line('@|@gender').line('prize winning age|@age_get_prize')\\\n                                                  .line('age at death|@age')\\\n                                                  .line('born country|@born_country')\\\n                                                  .line('died country|@died_country')) + \\\n    scale_x_continuous(breaks=decades, labels=[str(d) for d in decades]) + \\\n    scale_shape_manual(values=[24, 25]) + scale_size(name='prize winning age', range=[4, 8]) + \\\n    ggsize(600, 400) + ggtitle('Laureates Who Won Nobel Prize More Than Once') + \\\n    theme(legend_position='bottom', axis_title_y='blank', axis_tooltip='blank')","32b35021":"Taking categories into account, we realize that the mean age doesn't always increase. It could even decrease in the case of the peace prize. For literature or economics, things don't change.","57863d57":"### Explore Gender","f2b2f458":"### Explore Universities","3f296211":"# Nobel Prize Exploratory Data Analysis with Lets-Plot","953eef0c":"The mean age of death for Nobel laureates is 85 years.\n\nWouldn't be too bad to achieve the same life span!","b6e811d8":"Here we also see that the mean age when Nobel laureates receive their prize is rising over time.","21755102":"Most top universities pay attention to a wide range of scientific disciplines, but some specialize in particular areas.","f4707f5d":"3\/4 of all the Nobel prizes ever awarded belong to the US, the UK and Germany. But the situation changes over time, mostly in favor of the US and not in favor of Germany.","acdbdc6a":"### Explore Ages","21b2a4df":"Obviously, the US is the absolute champion in the Nobel race. A great deal of its success is due to immigrant scientists.\n\nAlso here we see that many Nobel laureates have left Poland, Germany and the UK. However, the US, the UK and Germany take top positions regardless of brain drain.","0e589feb":"### Multiple Laureates","55d320b0":"### Explore Countries","2cfea561":"Throughout the years we see gaps in Nobel prizes awarded for some categories, especially peace. Also there is one big common gap during World War II.\n\nFinally we see that the Nobel prize for economics was first awarded in the 1970s.","c8747499":"## Preparation","e05877e2":"Finally we take a look at the oldest and youngest people who got the prize.","97f0dbbb":"## Visualization","65580c7a":"The mean age of winning the Nobel prize is 60 years.","1a4f7af1":"The most popular direction of migration is from the UK to the US.\n\nExcept those moving to the US, another popular migration route for scientists is from Poland to Germany.","21775a78":"This graph confirms our previous conclusions.","666e1a9b":"By now, there are four people who have received the prize more than once. One of them is a woman. Also she is the only one who moved to a different country. Two of them changed categories in which they achieved the results.\n\nThe first case was in 1903 and the last one in 1980.\n\nLook at the graph and you will find out even more fascinating details about these people.","a9d6d496":"Not all categories feature the same number of laureates, mostly due to prize sharing in collective research.","9d4053b7":"We see not only inequality in gender but also a slow change of this trend through the years, except the 1910s and 1950s.\n\nThe best possible female\/male ratio is seen in peace and literature.","5bc4fa66":"If we consider the categories, the mean age would be different. In many cases, physicists were relatively young when they achieved success, but economists tended to win the prize in slightly older age. For women, higher scatter in graph data could be explained by smaller sampling.","91a2d454":"Here we see that the Nobel committee prefers to acknowledge the achievements of Western science and ignore almost the whole of Africa.","e310cfb2":"### Explore Categories","384c7de2":"In most cases the winner gets the full prize or half of it. For peace and especially for literature, it is unusual to share your prize with someone."}}