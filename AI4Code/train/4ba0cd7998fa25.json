{"cell_type":{"2de21eb3":"code","a8e2793a":"code","fff4b400":"code","e2273bd3":"code","f08b1f50":"code","da65e181":"code","43d4dd58":"code","574e67cf":"markdown","9fcc2d92":"markdown","170ab17a":"markdown","d98af000":"markdown"},"source":{"2de21eb3":"import glob\nimport pandas as pd\nimport numpy as np\nimport seaborn as sns\n\ncm = sns.light_palette(\"grey\", as_cmap=True)","a8e2793a":"path =r'..\/input\/global-top-250-retailers\/' \nallFiles = glob.glob(path + \"\/cos*.csv\") \nallFiles = np.sort(allFiles)\n\nframe = pd.DataFrame()\nlist_ = []\ncols = [ 'name', \n        'country_of_origin', \n        'retail_revenue', \n        'dominant_operational_format', \n        'countries_of_operation', \n        'retail_revenue_cagr'\n       ]\ni = 1\n\nfor file_ in allFiles:\n    df = pd.read_csv(file_,index_col=None, sep=\";\", usecols=cols, verbose=False) \n    df[\"year\"] = 2016+i\n    list_.append(df)\n    del df\n    i = i + 1\n\ndf = pd.concat(list_)\ndel list_\n\n#df = df[df[\"year\"].isin([2018, 2019])]\ndf.sample(10)","fff4b400":"table_country = pd.pivot_table(df, \n                               values='retail_revenue', \n                               index=['country_of_origin'], \n                               columns=['year'], \n                               aggfunc=np.sum\n                              )\ntable_country = table_country.reset_index()\ntable_country.columns = [\"country_of_origin\", \"revenue_2017\", \"revenue_2018\", \"revenue_2019\"]\nsum_2019 = table_country['revenue_2019'].sum()\ntable_country = table_country.sort_values(by=\"revenue_2019\", ascending=False).head(10)\n\ntable_country","e2273bd3":"print(f\"In 2019 ${np.round(sum_2019.astype(int)\/1e6, 1)} Trillion revenue was generated by top 250 retailers; {np.round(100*table_country['revenue_2019'].sum()\/sum_2019)}% of these originate from {len(table_country)} countries\")","f08b1f50":"df_us = df[df[\"country_of_origin\"].isin([\"US\"]) & (df[\"year\"]==2019)]\ncols = ['name', \n        'retail_revenue',\n        'dominant_operational_format', \n        'countries_of_operation',\n        'retail_revenue_cagr']\ndf_us = df_us[cols].sort_values(by=\"retail_revenue\", ascending=False).reset_index(drop=True)\n\ndf_us.head(10)","da65e181":"agg_dict = {'retail_revenue':['sum', 'median'], \n            'retail_revenue_cagr':['median'],\n            'name': lambda x: len(x.unique()),\n           }\n\nus_agg = df_us.groupby([\"dominant_operational_format\"]).agg(agg_dict).reset_index()\nus_agg.columns = [' '.join(col).strip() for col in us_agg.columns.values]\nus_agg.columns = us_agg.columns.str.replace(' ','_')\nus_agg.rename({us_agg.columns[-1]: \"n_firms\"}, axis=1, inplace=True)\n\nus_agg = us_agg.sort_values(by=\"retail_revenue_sum\", ascending=False).reset_index(drop=True)\n\nus_agg[\"retail_revenue_sum\"] \/= 1e3\nus_agg[\"retail_revenue_median\"] \/= 1e3\n\nrename_dict = {\n    \"dominant_operational_format\": \"Retail format\",\n    \"retail_revenue_sum\": \"Total revenue\",\n    \"retail_revenue_median\": \"Median revenue\",\n    \"retail_revenue_cagr_median\": \"Median CAGR\",\n    \"n_firms\": \"# Firms\"\n}\nformat_dict = {\n    'Total revenue':'${0:,.0f}', \n    'Median revenue':'${0:,.0f}',\n    'Median CAGR': '{:.1%}'          \n}\n\n#us_agg\n(\n    us_agg.rename(rename_dict, axis=1)\n    .style\n    .bar(subset=['Median CAGR'], align='mid', color=['#d65f5f', '#5fba7d'])\n    .background_gradient(subset=['Total revenue', '# Firms'], cmap=cm)\n    .format(format_dict).hide_index()\n    .bar(color='#5fba7d', vmin=0, subset=['Median revenue'], align='zero')\n    .set_caption('2019 United States top retailers ($Billion)')\n)","43d4dd58":"agg_dict = {'retail_revenue':['sum', 'median'], \n            'retail_revenue_cagr':['median'],\n            'name': lambda x: len(x.unique()),\n           }\n\nus_agg = df[df[\"year\"]==2019].groupby([\"dominant_operational_format\"]).agg(agg_dict).reset_index()\nus_agg.columns = [' '.join(col).strip() for col in us_agg.columns.values]\nus_agg.columns = us_agg.columns.str.replace(' ','_')\nus_agg.rename({us_agg.columns[-1]: \"n_firms\"}, axis=1, inplace=True)\n\nus_agg = us_agg.sort_values(by=\"retail_revenue_sum\", ascending=False).reset_index(drop=True)\n\nus_agg[\"retail_revenue_sum\"] \/= 1e3\nus_agg[\"retail_revenue_median\"] \/= 1e3\n\nrename_dict = {\n    \"dominant_operational_format\": \"Retail format\",\n    \"retail_revenue_sum\": \"Total revenue\",\n    \"retail_revenue_median\": \"Median revenue\",\n    \"retail_revenue_cagr_median\": \"Median CAGR\",\n    \"n_firms\": \"# Firms\"\n}\nformat_dict = {\n    'Total revenue':'${0:,.0f}', \n    'Median revenue':'${0:,.0f}',\n    'Median CAGR': '{:.1%}'          \n}\n\n#us_agg\n(\n    us_agg.rename(rename_dict, axis=1)\n    .style\n    .bar(subset=['Median CAGR'], align='mid', color=['#d65f5f', '#5fba7d'])\n    .background_gradient(subset=['Total revenue', '# Firms'], cmap=cm)\n    .format(format_dict).hide_index()\n    .bar(color='#5fba7d', vmin=0, subset=['Median revenue'], align='zero')\n    .set_caption('2019 Global top retailers ($Billion)')\n)","574e67cf":"## \ud83d\uded2 2019 Global top retailers","9fcc2d92":"## \ud83d\uddfa\ufe0f From which countries do the top players originate?","170ab17a":"## \ud83e\uddf1 Sample dataset\nHere is what a sample of data looks like ","d98af000":"## \ud83c\uddfa\ud83c\uddf8 Deep dive into firms originating from US "}}