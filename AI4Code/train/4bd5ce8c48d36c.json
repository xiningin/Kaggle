{"cell_type":{"74bb0ecf":"code","728caba2":"code","610a2556":"code","0930535b":"code","4a044851":"code","6045211d":"code","5ccf9169":"code","2fa1eb6a":"code","55284f39":"code","0e012410":"code","a8bc098a":"code","0ad9c9d9":"code","1b536c59":"code","d6a56457":"code","d9ee6fa9":"code","9bfc7d23":"code","13139f9f":"code","996e9ffc":"code","a51297c8":"code","c34db511":"code","9bf07071":"code","8996814c":"code","7f15f08a":"code","dfd788ea":"markdown","53747071":"markdown","a43dc30b":"markdown","6c250f31":"markdown"},"source":{"74bb0ecf":"%reload_ext autoreload\n%autoreload 2\n%matplotlib inline\n\nfrom fastai import *\nfrom fastai.vision import *\n\nbs = 64","728caba2":"cars = ['Accord','Altima','Charger', 'Corolla','Tesla_s','Civic']","610a2556":"path = Path('..\/data\/car')\n\nfor car in cars:\n    (path\/car).mkdir(parents=True, exist_ok=True)\n\npath.ls()","0930535b":"for car in cars:\n    download_images(Path('..\/input')\/f'{car.lower()}', path\/car, max_pics=500)","4a044851":"for car in cars:\n    print(car)\n    verify_images(path\/car,delete =True,max_size=500)","6045211d":"np.random.seed(123)\ndata = ImageDataBunch.from_folder(path,train=\".\",valid_pct=0.2,ds_tfms=get_transforms(),\n                                  size=224,bs=bs,num_workers=0).normalize(imagenet_stats)","5ccf9169":"print((len(data.classes),data.c))\ndata.show_batch(rows=3, figsize=(7,6))","2fa1eb6a":"learn = create_cnn(data, models.resnet50, metrics=error_rate)","55284f39":"learn.fit_one_cycle(8)\nlearn.save('stage-1')","0e012410":"interp = ClassificationInterpretation.from_learner(learn)\n\nlosses,idxs = interp.top_losses()\n\nlen(data.valid_ds)==len(losses)==len(idxs)","a8bc098a":"interp.plot_top_losses(9, figsize=(15,11))","0ad9c9d9":"interp.plot_confusion_matrix()","1b536c59":"interp.most_confused(min_val=2)","d6a56457":"learn.unfreeze()\nfor i in range(8):\n    learn.fit_one_cycle(2)\n    learn.save('stage-'+str(i+2))\n","d9ee6fa9":"#learn.load('stage-1')","9bfc7d23":"learn.lr_find()\nlearn.recorder.plot()","13139f9f":"learn.fit_one_cycle(4, max_lr=slice(6e-5,4e-4))","996e9ffc":"learn.save('lr-optimized')","a51297c8":"interp=ClassificationInterpretation.from_learner(learn)\ninterp.most_confused(min_val=2)\ninterp.plot_confusion_matrix()","c34db511":"from fastai.widgets import *","9bf07071":"ds, idxs = DatasetFormatter().from_toplosses(learn, ds_type=DatasetType.Valid)\nImageCleaner(ds, idxs, path)","8996814c":"#After cleaning data, run this cell\nnp.random.seed(42)\ncsvpath=Path(path\/'cleaned.csv')\ndata = ImageDataBunch.from_csv(\".\", folder=\".\", valid_pct=0.2, csv_labels=csvpath,\n    ds_tfms=get_transforms(), size=224, num_workers=4).normalize(imagenet_stats)","7f15f08a":"#After cleaning data, run this cell\nnp.random.seed(42)\ncsvpath=Path(path\/'cleaned.csv')\ndata = ImageDataBunch.from_csv(\".\", folder=\".\", valid_pct=0.2, csv_labels=csvpath,\n    ds_tfms=get_transforms(), size=224, num_workers=4).normalize(imagenet_stats)","dfd788ea":"# Car Classification\n\nWe'll first set some default settings and import our required tools.\n","53747071":"First we need to get the file paths from our top_losses. We can do this with .from_toplosses. We then feed the top losses indexes and corresponding dataset to ImageCleaner.\n\nNotice that the widget will not delete images directly from disk but it will create a new csv file cleaned.csv from where you can create a new ImageDataBunch with the corrected labels to continue training your model.","a43dc30b":"# Data Cleaning","6c250f31":"# Data\n\nIn order to train our Car Classifier DL model, we'll need some relevant data. Since we are using a CNN, we need a bunch of labeled car images. I followed the steps [here](https:\/\/github.com\/fastai\/course-v3\/blob\/master\/nbs\/dl1\/lesson2-download.ipynb\/) to get some car images from Google Images. I then loaded the URLs of the images into Kaggle as a custom dataset, and from there into my file system. "}}