{"cell_type":{"45304476":"code","52b83a50":"code","0e28c2f2":"code","decdd58e":"code","b3e5fca1":"code","395f7f21":"code","39564187":"markdown","ef47a87e":"markdown","068340d9":"markdown","f062d53e":"markdown","37a2f407":"markdown"},"source":{"45304476":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns","52b83a50":"sensibility = 0.9851\nspecificity = 0.9991\nprevalence_example = 0.012878  # 23181 \/ 1.8e6","0e28c2f2":"# Vectorized\ndef ppv(prevalence: np.array, sens: float = sensibility, spec: float = specificity) -> np.array:\n    return prevalence*sens \/ (prevalence*sens + (1-prevalence)*(1-spec))\n\ndef npv(prevalence: np.array, sens: float = sensibility, spec: float = specificity) -> np.array:\n    return (spec * (1-prevalence)) \/ ((spec * (1-prevalence)) + (1-sens) * prevalence)","decdd58e":"print(f\"PPV computed in the example scenario: {ppv(prevalence_example)*100:.1f}%\")\nprint(f\"PPV computed if prevalence is 30%: {ppv(0.3)*100:.1f}%\")\n\nprint(f\"NPV computed in the example scenario: {npv(prevalence_example)*100:.1f}%\")\nprint(f\"NPV computed if prevalence is 30%: {npv(0.3)*100:.1f}%\")","b3e5fca1":"prevalences = np.arange(0, 0.05, 0.0001)\nppvs = ppv(prevalences)\ndata = pd.DataFrame(data={'Prevalence': prevalences, 'PPV': ppvs})\nsns.relplot(data=data, x='Prevalence', y='PPV', kind='line')\nplt.axvline(0.005, color='r')","395f7f21":"prevalences = np.arange(0, 1, 0.01)\nnpvs = npv(prevalences)\ndata = pd.DataFrame(data={'Prevalence': prevalences, 'NPV': npvs})\nsns.relplot(data=data, x='Prevalence', y='NPV', kind='line')","39564187":"# Antigen-based Covid19 tests and the probability of having the disease\n\nDisclaimer: None of the points made in this notebook should be interpreted as healthcare advice.\n\nThe rapid, antigen-based tests for Covid19 have been reported to have sensibility and specificity >90%. However, when testing, the probability of actually being infected with Covid19, given a positive result on a rapid, antigen-based test is of interest - it is called positive predictive value (PPV) and it has to be computed based on the sensibility and specificity by applying the Bayes' rule. The result of this computation is heavily dependent on the prevalence of the disease within the appropriate population of reference.\n\nIn this notebook we compute the PPV in an example context and we explore how sensible is the PPV to the prevalence given a particular rapid test.\n\nPlease check below for expressing the PPV given the prevalence of disease in the population of reference and the sensibility and specificity of the test.\n \n$$\n% \\begin{align*}\n\\text{PPV}=P(\\text{Covid19 infected | Positive on an antigen-based test}) = \\frac{P(\\text{Covid19 infected})*P(\\text{Positive on an antigen-based test | Covid19 infected})}{P(\\text{Positive on an antigen-based test})}\\\\\nP(\\text{Covid19 infected}) = \\text{prevalence} \\\\\nP(\\text{Positive on an antigen-based test | Covid19 infected}) = \\text{sensibility}\\\\\n\\text{specificity} = P(\\text{Negative on an antigen-based test | Not Covid19 infected})\\\\\nP(\\text{Positive on an antigen-based test}) = \\text{prevalence}\\cdot\\text{sensibility} + (1-\\text{prevalence})\\cdot(1-\\text{specificity})\\\\\n% \\end{align*}\n$$","ef47a87e":"A PPV of 93.5% in the example scenario entails that the probability of being infected given a positive rapid test is 93.5, which is significantly below the sensibility (98.51%). Let's see how the PPV changes depending on the prevalence of the disease. ","068340d9":"The plot shows how the PPV decreases abruptly once the prevalence goes below 0.5%. It is therefore important to take into account the prevalence of the disease according to the context in which the PPV needs to be estimated. Let's check a similar plot for NPV.","f062d53e":"For prevalence, we'll calculate it for Bucharest on the 23th of January, 2022: 23181 active cases, Bucharest population 1.8 million.\n\nFor the test, we'll be using the data from a commercially available one: sensibility 98.51% and specificity 99.91%.\n\n*Note: The sensibility and specificity values have been estimated in studies based on symptomatic patients. Both the sensibility and specificity are lower for asymptomatic patients.*","37a2f407":"As long as the prevalence is below 80%, the NPV is above 90%."}}