{"cell_type":{"9ce8c855":"code","dda8ff7f":"code","f9a400fe":"code","52ea5a31":"code","59fa1ca8":"code","f4025fe9":"code","6636ed26":"code","dbd849e7":"code","a3aaccb2":"code","3f285f01":"code","cd525f81":"code","edd10a99":"code","3d4a856a":"code","af4b84a5":"code","e576f9e7":"code","4b0e929e":"code","75a71fd1":"code","3d33570a":"code","db05fbcf":"code","f3f64e97":"code","d2c506b3":"code","c5c60dc9":"code","5bf38a4f":"code","fcdf8d17":"code","3e241c1e":"code","ad0d0a12":"code","56199b3a":"code","93a69699":"code","b2d2b2a9":"code","2e01fd69":"code","045e8f95":"code","0587c52d":"code","f7a86ef8":"code","d3a29e22":"code","e4712a15":"code","16062520":"code","7a96ad81":"code","07b9799e":"code","f4e4b220":"code","1e56fc1b":"code","72b3c967":"code","d9f4492b":"code","f80c1c1c":"code","54d95d89":"code","18f4af14":"code","94eb4d9c":"code","21d20d46":"code","69c8994a":"code","2fe09a86":"code","69449e56":"code","4ffe0b1d":"markdown","c3fd141f":"markdown","87b9a681":"markdown","0508d270":"markdown","fd3c466a":"markdown","53e07045":"markdown","685c6560":"markdown","38b231c3":"markdown"},"source":{"9ce8c855":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom scipy import stats","dda8ff7f":"train = pd.read_csv(\"..\/input\/daily-phone-usage\/train.csv\")\ntest = pd.read_csv(\"..\/input\/daily-phone-usage\/test.csv\")\n# Analyzing User activity using playstore dataset\nplaystore = pd.read_csv(\"..\/input\/google-play-store-apps\/googleplaystore.csv\")","f9a400fe":"# removing non_ascii values\nnon_ascii_values = ['WhatsApp\\xa0Business','\u0bb5\u0bb0\u0bc8\u0baa\u0b9f\u0bae\u0bcd']\ntrain = train[~train['App'].isin(non_ascii_values)]","52ea5a31":"app_list = [x.lower() for x in train['App'].value_counts().index.tolist()]","59fa1ca8":"ava_in_dataset = playstore[(playstore['App'].str.lower().isin(app_list) ) ]\nava_in_dataset.drop_duplicates(subset =\"App\",keep = 'first', inplace = True) ","f4025fe9":"train.dropna(inplace=True)","6636ed26":"train['DateTime']= pd.to_datetime(train['Date'] +\" \" +train['Time'],format='%m\/%d\/%Y %H:%M:%S')\ntrain['Date']= pd.to_datetime(train['Date'],format='%m\/%d\/%Y')","dbd849e7":"test['Date']= pd.to_datetime(test['Date'],format='%m\/%d\/%Y')","a3aaccb2":"train = train.sort_values(['DateTime'])","3f285f01":"train.head()","cd525f81":"train['DateTime'].max() - train['DateTime'].min()","edd10a99":"system_tracker = ['Screen on (unlocked)','Screen off (locked)','Screen on (locked)', 'Screen off','Permission controller','System UI','Package installer',\n'Device shutdown','Call Management']\nservice_app = train[train['App'].isin(system_tracker)]\ntrain = train[~train['App'].isin(system_tracker)]\ntest = test[~test['App'].isin(system_tracker)]","3d4a856a":"service_app['App'].value_counts()","af4b84a5":"train['TotalSeconds']=train['Duration'].str.split(':').apply(lambda x: int(x[0]) * 3600 + int(x[1])*60 + int(x[2]))","e576f9e7":"train.groupby('App').sum().nlargest(20,'TotalSeconds').reset_index()","4b0e929e":"plt.figure(figsize=(15,6))\ndata = train.groupby('App').sum().nlargest(20,'TotalSeconds').reset_index()\nsns.barplot(x='App',y='TotalSeconds',data=data)\nplt.title('Top 20 apps used')\nplt.xticks(rotation=90)\nplt.show()","75a71fd1":"train['appl'] = train['App'].str.lower()\nava_in_dataset['appl'] = ava_in_dataset['App'].str.lower()","3d33570a":"new = train.merge(ava_in_dataset, left_on='appl', right_on='appl')\nnew2 = new.drop_duplicates(subset='appl',keep='first')","db05fbcf":"new2 = new2.merge(new.groupby(['appl']).sum().reset_index(),left_on='appl', right_on='appl')","f3f64e97":"print(\"No. of apps that are available in playstore dataset {}\".format(new2.shape[0]))","d2c506b3":"new2['TotalHours'] = new2['TotalSeconds_y'] \/\/ 3600","c5c60dc9":"plt.figure(figsize=(15,6))\nsns.barplot(x='App_x',y='TotalHours',data=new2)\nplt.title('Total no. of hours each app was used')\nplt.xticks(rotation=90)\nplt.show()","5bf38a4f":"plt.figure(figsize=(15,6))\ncategory = new2['Genres'].value_counts()\nsns.barplot(x=category.index,y=category.values)\nplt.title('Genres of the app')\nplt.xticks(rotation=90)\nplt.show()","fcdf8d17":"plt.figure(figsize=(15,6))\nsns.barplot(x='App_x',y='TotalHours',data=new2)\nplt.title('Countries which has Confirmed cases')\nplt.xticks(rotation=90)\nplt.show()","3e241c1e":"app_type = new2['Type'].value_counts()\nsns.barplot(x=app_type.index,y=app_type.values)\nplt.title('Type of apps')\nplt.xticks(rotation=90)\nplt.show()","ad0d0a12":"print(\"mean of ratings {}\".format(round(np.mean(new2['Rating_x']),2)))\nprint(\"mode of ratings {}\".format(stats.mode(new2['Rating_x'][0])))\nprint(\"It seems User is interested in installing the apps which has rating greater than 4.2\")","56199b3a":"train = train.groupby(['Date','App']).sum().reset_index()\ntrain['TotalMinutes'] = train['TotalSeconds'] \/\/ 60","93a69699":"def dateFeatures(df):\n    features = ['day','week','dayofweek','month','quarter','year','dayofyear','weekofyear']\n    for col in features:\n        df[col] = getattr(df['Date'].dt,col) * 1","b2d2b2a9":"dateFeatures(train)\ndateFeatures(test)","2e01fd69":"train.head()","045e8f95":"plt.figure(figsize=(15,6))\ntrain.groupby(['month','App']).sum().nlargest(6,'TotalMinutes')['TotalMinutes'].plot(kind='bar')\nplt.title('User spends more minutes on the app for each month')\nplt.xticks(rotation=90)\nplt.show()","0587c52d":"train.groupby(['month'])['TotalMinutes'].sum().plot()","f7a86ef8":"train.groupby(['Date'])['TotalMinutes'].sum().plot()","d3a29e22":"print(\"The day when User spends least amount of time {}\".format(train.groupby(['Date'])['TotalMinutes'].sum().nsmallest(1)))","e4712a15":"print(\"The day when User spends highest amount of time {}\".format(train.groupby(['Date'])['TotalMinutes'].sum().nlargest(1)))\n","16062520":"train.head()","7a96ad81":"train.groupby(['week'])['TotalMinutes'].sum().plot()","07b9799e":"train.groupby(['dayofweek'])['TotalMinutes'].sum().plot()","f4e4b220":"train.drop(['Date','TotalSeconds'],axis=1,inplace=True)\n# test.drop(['Date','TotalSeconds'],axis=1,inplace=True)\n","1e56fc1b":"test_len = test.shape[0]","72b3c967":"x_train = pd.get_dummies(pd.concat([train,test]),drop_first=True)","d9f4492b":"train = x_train[:test_len]\ntest = x_train[train.shape[0]:train.shape[0]+test_len]","f80c1c1c":"train.drop(['Date'],axis=1,inplace=True)\ntest.drop(['Date','TotalMinutes'],axis=1,inplace=True)","54d95d89":"y = train['TotalMinutes']\ntrain.drop(['TotalMinutes'],axis=1,inplace=True)","18f4af14":"train_new_df = train.copy()","94eb4d9c":"\nimport lightgbm as lgb","21d20d46":"train_new_df.shape","69c8994a":"from sklearn.model_selection import KFold, StratifiedKFold\n\nparams = {\n            'boosting_type': 'gbdt',\n            'objective': 'regression',\n            'metric': {'rmse'},\n            'subsample': 0.25,\n            'subsample_freq': 1,\n            'learning_rate': 0.3,\n            'num_leaves': 20,\n            'feature_fraction': 0.9,\n            'lambda_l1': 1,  \n            'lambda_l2': 1\n            }\n\nfolds = 4\nseed = 555\n\nkf = StratifiedKFold(n_splits=folds, shuffle=True, random_state=seed)\n\nmodels = []\n\nfor train_index, val_index in kf.split(train_new_df,y):\n    train_X = train_new_df.iloc[train_index]\n    val_X = train_new_df.iloc[val_index]\n    train_y = y.iloc[train_index]\n    val_y = y.iloc[val_index]\n    lgb_train = lgb.Dataset(train_X, train_y)\n    lgb_eval = lgb.Dataset(val_X, val_y)\n    gbm = lgb.train(params,\n                lgb_train,\n                num_boost_round=1000,\n                valid_sets=(lgb_train, lgb_eval),\n                early_stopping_rounds=200,\n                verbose_eval = 100)\n    models.append(gbm)","2fe09a86":"predictions = []\ntest['TotalMinutes'] = (sum([model.predict(test) for model in models])\/folds)","69449e56":"test.to_csv(\"test.csv\")","4ffe0b1d":"No. of days data was given","c3fd141f":"Analyzing the apps only available in playstore dataset","87b9a681":"5th month has lesser data","0508d270":"Converting Duration into Seconds","fd3c466a":"User spends most of the times on Instagram","53e07045":"Removing unwanted activities","685c6560":"User likes free apps","38b231c3":"Let's analyse the app that are available in the playstore dataset"}}