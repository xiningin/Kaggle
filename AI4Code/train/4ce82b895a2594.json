{"cell_type":{"e3f7f657":"code","c477e122":"code","b55992fd":"code","a391a7f5":"code","77698bde":"code","a85d75ec":"code","c090cc6e":"code","f29f150d":"code","74c1cccc":"code","61249218":"code","7af23b04":"code","434c9ca4":"code","a740df81":"code","ae7dea9e":"code","30dd2572":"code","4ae9bfd6":"code","4c427e88":"code","8eac2e9a":"code","51b577e1":"code","c6b387bc":"code","db81b3d7":"markdown","fbb6105e":"markdown","aa58c25d":"markdown","ca4a562a":"markdown","dacc4c0b":"markdown","359d0e9d":"markdown","ef3b87a0":"markdown","4c5fbeab":"markdown","906a4bca":"markdown","44224286":"markdown","667a440d":"markdown","c2724f4d":"markdown","0eaa1e1f":"markdown","53a17000":"markdown"},"source":{"e3f7f657":"import datetime as dt\nimport pandas as pd\n!pip install openpyxl\npd.set_option('display.max_columns', None)\npd.set_option('display.max_rows', None)\npd.set_option('display.float_format', lambda x: '%.5f' % x)","c477e122":"df = pd.read_excel(\"..\/input\/uci-online-retail-ii-data-set\/online_retail_II.xlsx\",sheet_name=\"Year 2010-2011\")\ndf.head()","b55992fd":"df.shape","a391a7f5":"df.describe().T","77698bde":"df.isnull().sum()","a85d75ec":"df.dropna(inplace=True)\ndf = df[~df[\"Invoice\"].str.contains(\"C\", na=False)]","c090cc6e":"df = df[(df['Quantity'] > 0)]\ndf = df[(df['Price'] > 0)]\ndf.shape","f29f150d":"df[\"TotalPrice\"] = df[\"Quantity\"] * df[\"Price\"]","74c1cccc":"df.head()","61249218":"today_date=dt.datetime(2011,12,11)\ndf[\"InvoiceDate\"].max()","7af23b04":"rfm=df.groupby(\"Customer ID\").agg({\"InvoiceDate\": lambda x :(today_date-x.max()).days,\n                               \"Invoice\": lambda x : x.nunique(),\n                               \"TotalPrice\":lambda x : x.sum()})\nrfm.head()","434c9ca4":"rfm.columns","a740df81":"rfm.columns=[\"recency\",\"frequency\",\"monetary\"]\nrfm.head()","ae7dea9e":"rfm=rfm[rfm[\"monetary\"]>0]","30dd2572":"rfm.head()","4ae9bfd6":"rfm[\"receny_score\"] = pd.qcut(rfm[\"recency\"],5,labels=[5,4,3,2,1])\n\nrfm[\"frequency_score\"] = pd.qcut(rfm[\"frequency\"].rank(method=\"first\"),5,labels=[1,2,3,4,5])","4c427e88":"rfm[\"rfm_score\"]=rfm[\"receny_score\"].astype(\"str\")+rfm[\"frequency_score\"].astype(\"str\")","8eac2e9a":"rfm.head()","51b577e1":"seg_map = {\n    r'[1-2][1-2]': 'hibernating',\n    r'[1-2][3-4]': 'at_Risk',\n    r'[1-2]5': 'cant_loose',\n    r'3[1-2]': 'about_to_sleep',\n    r'33': 'need_attention',\n    r'[3-4][4-5]': 'loyal_customers',\n    r'41': 'promising',\n    r'51': 'new_customers',\n    r'[4-5][2-3]': 'potential_loyalists',\n    r'5[4-5]': 'champions'\n}\n\n\nrfm['segment'] = rfm['rfm_score'].replace(seg_map, regex=True)\n\nrfm.head()","c6b387bc":"pareto_data = pd.DataFrame({\"size\" : rfm.groupby(\"segment\")[\"monetary\"].count() \/ rfm[\"monetary\"].count(),\n              \"revenue\"  : rfm.groupby(\"segment\")[\"monetary\"].sum() \/ rfm[\"monetary\"].sum()})\n\npareto_data.sort_values(by= \"revenue\" ,ascending=False)","db81b3d7":"![image.png](attachment:8abca43c-032e-4596-a334-1ef852df6f22.png)","fbb6105e":"### ANALYSING RFM SEGMENTS","aa58c25d":"### 1. DATA PREPROCESSING","ca4a562a":"### IMPORTING LIBRARIES AND DATA","dacc4c0b":"## INTRODUCTION\n\n![image.png](attachment:45dac849-ec41-4e05-8250-81921ad88e1d.png)\n\nCustomer segmentation is the division of customers into groups based on common characteristics in order to increase sales through personalized content tailored to the respective segment.\n\nThere are various methods of customer segmentation, including clustering, RFM segmentation and predictive models.In this notebook we will focus on customer segmentation with RFM.\nThe \u201cRFM\u201d in RFM analysis stands for recency, frequency and monetary value. These are the metrics that will be considered.\n\n* Recency \u2013 How recently did the customer purchase? Highest score refers to the customer with the nearest last shopping date\n\n* Frequency \u2013 How often do they purchase?Total number of purchases. this value can be the number of Invoices or the number of products in an invoice or the number of website visits. In other words, it can be not only purchasing the product, but also using the service.\n\n* Monetary Value \u2013 How much do they spend?\n\n## Context\n\nThe dataset named Online Retail II was obtained from a UK-based online store and includes sales from 01\/12\/2009 to 09\/12\/2011.\n\nThis company sells souvenirs and most of their customers are also wholesalers. Within the scope of this study, only 2010-2011 sales will be consedered.\n\n## Business Problem\n\nOur aim is to apply RFM analysis to the online retail II dataset and to include customers with common behaviors in the same groups and segment them to develop special sales and marketing techniques for these groups.\n\nThe company believes that marketing activities specific to customer segments with common behaviors will increase revenue. For example, it is desired to organize different campaigns for new customers and different campaigns to retain customers, which are very profitable for the company.\n\n## Task Details\n\n* Data Preprocessing\n* Calculating RFM Metrics\n* Calculating RFM Scores\n* Creating RFM Segments\n\n## Attribute Information:\n\n**InvoiceNo:** Invoice number. The unique number of each transaction, that is, the invoice. Aborted operation if it starts with C.\n\n**StockCode:** Product code. Unique number for each product.\n\n**Description:** Product name\n\n**Quantity:** Number of products. It expresses how many of the products on the invoices have been sold.\n\n**InvoiceDate:** Invoice date and time.\n\n**UnitPrice:** Product price (in GBP)\n\n**CustomerID:** Unique customer number\n\n**Country:** Country name. Country where the customer lives.","359d0e9d":"There are missing values in Description and Customer ID columns, we will remove them from the DataFrame.\nIn the DataFrame there are some invoices that include \"C\" which means that they are cancelled transactions so we will remove them from our DataFrame","ef3b87a0":"We create a variable named 'TotalPrice' that represents the total earnings per invoice","4c5fbeab":"As the metrics are not comparable with each other, they must be converted into scores. It is also difficult to evaluate metrics in themselves. It cannot be easily understood whether the metric we observed is the largest value in that column or not.\n\nF and R values are prioritized compared to customers with very high turnover, who trade very infrequently or who have not traded for a very long time.\nIn case of need, micro segments can be created according to M breakdowns for customers with high turnover\/high profitability.\nBecause of that reason we will include F and R metrics in the rfm_score","906a4bca":"**Champions** are the best customers, who bought most recently, most often, and are heavy spenders. Reward these customers. They can be the first to buy new products\n\n**Potential Loyalists** are the recent customers with average frequency and who spent a good amount. You can make them your Loyalists or Champions by offering membership or loyalty programs or recommending related products to them.\n\n**New Customers** are the customers who have a high overall RFM score but are not frequent shoppers. Special offers can be provided to increase their visits\n\n**At Risk Customers** are the customers who purchased often and spent big amounts, but haven\u2019t purchased recently. Personalized deals and product\/service recommendations can help reactivate them\n\n**Can\u2019t Lose Them** are the customers who used to visit and purchase quite often, but haven\u2019t been visiting recently. Get them to revisit with relevant promotions and conduct surveys to find out what went wrong and not lose them to a competitor.","44224286":"### 3. CALCULATING RFM SCORES","667a440d":"### 2. CALCULATING RFM METRICS","c2724f4d":"### 4. CREATING RFM SEGMENTS","0eaa1e1f":"In Recency, 5 represents the freshest customer and 1 represents the customer whose most recent purchase is outdated.\n5 corresponds to best in Frequency and Monatery.\nThe best segment here is 55, the worst segment is 11.","53a17000":"We will focus on some of these groups and develop some strategies in order not to loose them and increase the revenue."}}