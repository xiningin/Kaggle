{"cell_type":{"10e1d08b":"code","840525bf":"code","f3851a8b":"code","4b5fd730":"code","df384e29":"code","4d15f32c":"code","d5855062":"code","3abeda56":"code","d492c9e2":"code","f8dfb3d0":"code","63586d8e":"code","6cb4b8a5":"code","d9d83b35":"code","7eb92d57":"code","87d441d3":"code","f4fa49aa":"code","68377a5e":"code","f64dab0d":"code","075e30ad":"code","aff09238":"code","0835f32d":"code","4886a0b0":"code","c03478d6":"code","385d951d":"code","26a6676d":"code","17cfde14":"code","bd622ba4":"code","2aea98c8":"code","f91d5695":"code","2a45d408":"code","64194f08":"code","01074c1d":"code","70aadbd3":"code","929cd004":"code","cff48609":"code","644b18d2":"code","aa02f292":"code","d73bc070":"code","ed782b55":"code","6566e914":"code","bc528bb0":"code","36faca88":"code","1b5b76e5":"code","dea935a1":"code","562557f7":"code","54dadbe7":"code","25c1436d":"code","33e09eb8":"code","9bdd1755":"code","33343b71":"code","24b5ebaf":"code","c8102436":"markdown","75e99a85":"markdown","983dfefb":"markdown","5c9bfe9c":"markdown","bc079eae":"markdown"},"source":{"10e1d08b":"pip install openpyxl","840525bf":"pip install lifetimes","f3851a8b":"pip install xlrd","4b5fd730":"import pandas as pd\nimport numpy as np\nimport datetime as dt\nfrom lifetimes import BetaGeoFitter\nfrom lifetimes import GammaGammaFitter\nfrom sklearn.preprocessing import MinMaxScaler\nfrom lifetimes.plotting import plot_probability_alive_matrix, plot_frequency_recency_matrix\nfrom lifetimes.plotting import plot_calibration_purchases_vs_holdout_purchases, plot_period_transactions,plot_history_alive\npd.set_option('display.max_columns', None)\npd.set_option('display.max_rows', None)\npd.set_option('display.float_format', lambda x: '%.5f' % x)","df384e29":"df = pd.read_excel('\/kaggle\/input\/uci-online-retail-ii-data-set\/online_retail_II.xlsx', sheet_name='Year 2010-2011')\ndf_ = df.copy()","4d15f32c":"def check_df(dataframe):\n    print(\"################ Shape ####################\")\n    print(dataframe.shape)\n    print(\"############### Columns ###################\")\n    print(dataframe.columns)\n    print(\"############### Types #####################\")\n    print(dataframe.dtypes)\n    print(\"############### Head ######################\")\n    print(dataframe.head())\n    print(\"############### Tail ######################\")\n    print(dataframe.tail())\n    print(\"############### Describe ###################\")\n    print(dataframe.describe().T)\n\ncheck_df(df)","d5855062":"df.isnull().sum()","3abeda56":"df.dropna(inplace=True)\ndf.isnull().sum()","d492c9e2":"def outlier_thresholds(dataframe, variable):\n    quartile1 = dataframe[variable].quantile(0.01)\n    quartile3 = dataframe[variable].quantile(0.99)\n    interquantile_range = quartile3 - quartile1\n    up_limit = quartile3 + 1.5 * interquantile_range\n    low_limit = quartile1 - 1.5 * interquantile_range\n    return low_limit, up_limit\n\n\ndef replace_with_thresholds(dataframe, variable):\n    low_limit, up_limit = outlier_thresholds(dataframe, variable)\n    dataframe.loc[(dataframe[variable] < low_limit), variable] = low_limit\n    dataframe.loc[(dataframe[variable] > up_limit), variable] = up_limit","f8dfb3d0":"df_uk = df[df['Country'] == 'United Kingdom']","63586d8e":"df_uk = df_uk[~df_uk['Invoice'].str.contains('C', na=False)]","6cb4b8a5":"df_uk = df_uk[df_uk['Price'] > 0]","d9d83b35":"replace_with_thresholds(df_uk, 'Price')\nreplace_with_thresholds(df_uk, 'Quantity')","7eb92d57":"df_uk.head()","87d441d3":"df_uk['TotalPrice'] = df_uk['Quantity'] * df_uk['Price']","f4fa49aa":"df_uk[df_uk['Invoice'] == 536365]","68377a5e":"df_uk['InvoiceDate'].max()","f64dab0d":"today_date = dt.datetime(2011, 12, 11)","075e30ad":"df.head()","aff09238":"df.dtypes","0835f32d":"df_uk = df_uk.groupby('Customer ID').agg({'TotalPrice':'sum',\n                              'InvoiceDate': [lambda date: (date.max()-date.min()).days,\n                                              lambda date: (today_date - date.min()).days],\n                              'Invoice': lambda Invoice: Invoice.nunique()})","4886a0b0":"df_uk.head()","c03478d6":"df_uk.columns.droplevel(0)","385d951d":"df_uk.columns = ['monetary', 'recency', 'T', 'frequency']","26a6676d":"df_uk.head()","17cfde14":"df_uk['monetary'] = df_uk['monetary'] \/ df_uk['frequency']","bd622ba4":"df_uk = df_uk[df_uk['frequency'] > 1]","2aea98c8":"df_uk['recency'] = df_uk['recency'] \/ 7","f91d5695":"df_uk['T'] = df_uk['T'] \/ 7","2a45d408":"bgf = BetaGeoFitter()","64194f08":"bgf.fit(df_uk['frequency'], df_uk['recency'], df_uk['T'])","01074c1d":"bgf.summary","70aadbd3":"plot_period_transactions(bgf)","929cd004":"bgf.conditional_expected_number_of_purchases_up_to_time(1, df_uk['frequency'], df_uk['recency'], df_uk['T']).sort_values(ascending=False).head(10)","cff48609":"df_uk['expected_purch_6month'] = bgf.predict(4*6, df_uk['frequency'], df_uk['recency'], df_uk['T'])","644b18d2":"df_uk.sort_values(by='expected_purch_6month', ascending= False).head()","aa02f292":"ggf = GammaGammaFitter(penalizer_coef=0.01)","d73bc070":"ggf.fit(df_uk['frequency'], df_uk['monetary'])","ed782b55":"ggf.summary","6566e914":"ggf.conditional_expected_average_profit(df_uk['frequency'], df_uk['monetary']).sort_values(ascending=False).head(10)","bc528bb0":"#########\ndf_uk['expected_average_profit'] = ggf.conditional_expected_average_profit(df_uk['frequency'], df_uk['monetary'])\n#########","36faca88":"cltv = ggf.customer_lifetime_value(bgf, df_uk['frequency'], df_uk['recency'], df_uk['T'], df_uk['monetary'], time=6, freq='W')","1b5b76e5":"cltv = cltv.reset_index()","dea935a1":"cltv_final = df_uk.merge(cltv, on='Customer ID', how='left')","562557f7":"cltv_final.sort_values(by='clv', ascending=False).head()","54dadbe7":"scaler = MinMaxScaler(feature_range=(0, 1))","25c1436d":"cltv_final.head()","33e09eb8":"scaler.fit(cltv_final[['clv']])","9bdd1755":"cltv_final['scaled_cltv'] = scaler.transform(cltv_final[['clv']])","33343b71":"cltv_final.sort_values(by='scaled_cltv', ascending=False).head()","24b5ebaf":"cltv_final.sort_values(by='scaled_cltv', ascending=False).tail()","c8102436":"# Definition of CLTV\nThe present value of the future cash flows attributed to the customer during his\/her entire relationship with the company.!\n\nThis account represents a single time period. It represents the time when the analysis was done. Let me give such a projection that we can evaluate the issue with 3-month and 6-month projections.\n\nHow can I make my inference? We will realize lifetime value with medium and long-term projections for individuals by including the specific pattern of the whole population, by extracting the conditional probability distribution, and generalizing them in terms of the characteristics of a particular individual.\n\n# Formula\nProbabilistic lifetime value estimation with time projection\n\nCLTV =( Customer Value \/ Churn Rate) * Profit Margin\n\nCustomer Value = Purchase Frequency * Average Order Value\n\nCLTV = Expected Number of Transaction * Expected Average Profit\n\nAbove, purchase frequency and number of transaction mean the same thing. Likewise, Average Order Value and Average Profit mean the same thing. It differs with the Expected part that happens to them.\n\n# CAUTION: \nIt will add a probabilistic distribution. Expected statement refers to this part. Expected number of purchases, expected profitability.\n\nBG \/ NBD = Expected Transaction\nGamma Gamma = Expected Profit\n\n# So How Do We Do That?\nWe will add statistics and probability pattern to the above formula. There will be BG \/ NBD and Gamma Gamma models that will make this happen to us. These models will do such a thing that they will model the purchasing behavior of all customers of this company, after modeling the purchasing behavior of all customers, they will replace the individual's personal characteristics in this model and reduce the expected number of sales to the person from the general audience pattern.\n\nBG NBD and Gamma Gamma models are statistical models, not machine learning models. In fact, these models have the expression \"Conditional\" at the beginning.","75e99a85":"**Veri Seti Hikayesi** \ud83d\udc49 https:\/\/archive.ics.uci.edu\/ml\/datasets\/Online+Retail+II\n\n* The dataset includes sales between 01\/12\/2009 - 09\/12\/2011.\n\n* In this project, the years 2010-2011 will be examined.\n\n* The product catalog of this company includes souvenirs.\n\n* The vast majority of the company's customers are corporate customers.\n\n\n\n# Variables\n\n**Invoice**: Invoice number. The unique number of each transaction, namely the invoice. Aborted operation if it starts with C.\n\n**StockCode**: Product code. Unique number for each product.\n\n**Description**: Product name\n\n**Quantity**: Number of products. It expresses how many of the products on the invoices have been sold.\n\n**InvoiceDate**: Invoice date and time.\n\n**UnitPrice**: Product price (in GBP)\n\n**CustomerID**: Unique customer number\n\n**Country**: The country where the customer lives.","983dfefb":"# Business Problem\n\nAn e-commerce company wants to segment its customers and determine marketing strategies according to these segments. For example, it is desired to organize different campaigns for new customers and different campaigns in order to retain customers that are very profitable for the company.","5c9bfe9c":"**What is The Lifetime Value of Your Customers?**\n\n# Introduction\nCustomer lifetime value (CLV), a term sometimes used interchangeably with customer lifetime value, is the prediction of a company's net profit contributed to its overall future relationship with a customer. The model can be simple or sophisticated, depending on how complex the predictive analytics techniques are.\n\nLifetime value is a critical metric because it represents the maximum amount that customers may be expected to spend in order to acquire new ones. As a result, it's crucial in determining the payback of marketing expenses used in marketing mix modeling.","bc079eae":"![pexels-andrea-piacquadio-919436.jpg](attachment:33f14fc8-d03c-42fc-a51a-4bebba4e4bc5.jpg)"}}