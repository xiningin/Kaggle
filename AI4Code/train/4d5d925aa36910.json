{"cell_type":{"cd7fe1bd":"code","f1db3382":"code","dca2eaaa":"code","9068f021":"code","578da3f4":"code","58ad7a49":"code","061ee067":"code","b9d46a7d":"code","aa9ef69e":"code","2ed19701":"code","a5bf431f":"code","e327cbe9":"code","06a9cc93":"code","6d96d8d1":"code","c4c229ba":"code","841e6a43":"markdown","58a47720":"markdown"},"source":{"cd7fe1bd":"import numpy as np\nimport pandas as pd\nimport os\nimport cv2\nimport time\nimport matplotlib.pyplot as plt\n\nimport tensorflow as tf\nfrom tensorflow.keras.utils import to_categorical\nfrom tensorflow.keras.preprocessing.image import load_img, img_to_array","f1db3382":"labels = open('..\/input\/yolo-weights-for-licence-plate-detector\/classes.names').read()\nprint(labels)","dca2eaaa":"weights_path = '..\/input\/yolo-weights-for-licence-plate-detector\/lapi.weights'\nconfiguration_path = '..\/input\/yolo-weights-for-licence-plate-detector\/darknet-yolov3.cfg'\n\nprobability_minimum = 0.5\nthreshold = 0.3","9068f021":"network = cv2.dnn.readNetFromDarknet(configuration_path, weights_path)\nlayers_names_all = network.getLayerNames()\nlayers_names_output = [layers_names_all[i[0]-1] for i in network.getUnconnectedOutLayers()]","578da3f4":"image_input = cv2.imread('..\/input\/iranvehicleplatedataset\/Vehicle Plates 1280x1280\/Vehicle Plates 1280x1280\/193.png')\n\n%matplotlib inline\nplt.rcParams['figure.figsize'] = (10.0,10.0)\nplt.imshow(cv2.cvtColor(image_input, cv2.COLOR_BGR2RGB))\nplt.show()","58ad7a49":"blob = cv2.dnn.blobFromImage(image_input, 1\/255.0, (416,416), swapRB=True, crop=False)\nblob_to_show = blob[0,:,:,:].transpose(1,2,0)\nnetwork.setInput(blob)\noutput_from_network = network.forward(layers_names_output)\nnp.random.seed(42)\ncolours = np.random.randint(0, 255, size=(len(labels), 3), dtype='uint8')","061ee067":"bounding_boxes = []\nconfidences = []\nclass_numbers = []\nh,w = image_input.shape[:2]\n\nfor result in output_from_network:\n    for detection in result:\n        scores = detection[5:]\n        class_current = np.argmax(scores)\n        confidence_current = scores[class_current]\n        if confidence_current > probability_minimum:\n            box_current = detection[0:4] * np.array([w, h, w, h])\n            x_center, y_center, box_width, box_height = box_current.astype('int')\n            x_min = int(x_center-(box_width\/2))\n            y_min = int(y_center-(box_height\/2))\n            bounding_boxes.append([x_min, y_min, int(box_width), int(box_height)])\n            confidences.append(float(confidence_current))\n            class_numbers.append(class_current)\n         ","b9d46a7d":"results = cv2.dnn.NMSBoxes(bounding_boxes, confidences, probability_minimum, threshold)\n\nif len(results) > 0:\n    for i in results.flatten():\n        x_min, y_min = bounding_boxes[i][0], bounding_boxes[i][1]\n        box_width, box_height = bounding_boxes[i][2], bounding_boxes[i][3]\n        colour_box_current = [int(j) for j in colours[class_numbers[i]]]\n        cv2.rectangle(image_input, (x_min, y_min), (x_min + box_width, y_min + box_height),\n                      colour_box_current, 5)\n        text_box_current = '{}: {:.4f}'.format(labels[int(class_numbers[i])], confidences[i])\n        cv2.putText(image_input, text_box_current, (x_min, y_min - 7), cv2.FONT_HERSHEY_SIMPLEX,\n                    1.5, colour_box_current, 5)","aa9ef69e":"%matplotlib inline\nplt.rcParams['figure.figsize'] = (10.0,10.0)\nplt.imshow(cv2.cvtColor(image_input, cv2.COLOR_BGR2RGB))\nplt.show()","2ed19701":"image_input2 = cv2.imread('..\/input\/iranvehicleplatedataset\/Vehicle Plates 1280x1280\/Vehicle Plates 1280x1280\/191.png')\n\n%matplotlib inline\nplt.rcParams['figure.figsize'] = (10.0,10.0)\nplt.imshow(cv2.cvtColor(image_input2, cv2.COLOR_BGR2RGB))\nplt.show()","a5bf431f":"def mosaic(src, ratio=0.05):\n    small = cv2.resize(src, None, fx=ratio, fy=ratio, interpolation=cv2.INTER_NEAREST)\n    return cv2.resize(small, src.shape[:2][::-1], interpolation=cv2.INTER_NEAREST)","e327cbe9":"blob = cv2.dnn.blobFromImage(image_input2, 1\/255.0, (416,416), swapRB=True, crop=False)\nblob_to_show = blob[0,:,:,:].transpose(1,2,0)\nnetwork.setInput(blob)\noutput_from_network = network.forward(layers_names_output)\nnp.random.seed(42)\ncolours = np.random.randint(0, 255, size=(len(labels), 3), dtype='uint8')","06a9cc93":"bounding_boxes = []\nconfidences = []\nclass_numbers = []\nh,w = image_input2.shape[:2]\n\nfor result in output_from_network:\n    for detection in result:\n        scores = detection[5:]\n        class_current = np.argmax(scores)\n        confidence_current = scores[class_current]\n        if confidence_current > probability_minimum:\n            box_current = detection[0:4] * np.array([w, h, w, h])\n            x_center, y_center, box_width, box_height = box_current.astype('int')\n            x_min = int(x_center-(box_width\/2))\n            y_min = int(y_center-(box_height\/2))\n            bounding_boxes.append([x_min, y_min, int(box_width), int(box_height)])\n            confidences.append(float(confidence_current))\n            class_numbers.append(class_current)\n         ","6d96d8d1":"results = cv2.dnn.NMSBoxes(bounding_boxes, confidences, probability_minimum, threshold)\n\nif len(results) > 0:\n    for i in results.flatten():\n        x_min, y_min = bounding_boxes[i][0], bounding_boxes[i][1]\n        box_width, box_height = bounding_boxes[i][2], bounding_boxes[i][3]\n        colour_box_current = [int(j) for j in colours[class_numbers[i]]]\n        mosaic_image=mosaic(image_input2[(y_min):(y_min+box_height),(x_min):(x_min+box_width)])\n        image_input2[(y_min):(y_min+box_height),(x_min):(x_min+box_width)]=mosaic_image","c4c229ba":"%matplotlib inline\nplt.rcParams['figure.figsize'] = (10.0,10.0)\nplt.imshow(cv2.cvtColor(image_input2, cv2.COLOR_BGR2RGB))\nplt.show()","841e6a43":"# Put Mosaic on Plate","58a47720":"# Put Rectngle on Plate"}}