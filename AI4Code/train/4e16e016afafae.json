{"cell_type":{"08f12170":"code","dfdc1eeb":"code","12b9312c":"code","cf91e646":"code","fa07c559":"code","150b18ca":"code","f4edf630":"code","c41bf41d":"code","70e35e14":"code","563664c5":"code","b3477265":"code","cc191f7a":"code","adde4b97":"code","e41c0075":"code","e0f177bf":"code","8d1a17db":"code","d569ddc2":"code","50402e0b":"code","0fa78b4a":"code","5c886c7d":"code","9a9d80f8":"code","1ab498d6":"code","8e36864b":"code","5846da3a":"code","13c3d943":"code","59ddf850":"markdown","959dc8eb":"markdown","40ed7568":"markdown","aaa44bdc":"markdown","f9ed41fe":"markdown","14641c62":"markdown","60c0120b":"markdown","a8273788":"markdown","93225363":"markdown","1b41f78d":"markdown","10ebbe9b":"markdown","ef8a46b3":"markdown","a35c115a":"markdown","1ab56bbb":"markdown","772f675a":"markdown","52ca0884":"markdown","0d3e1ce8":"markdown","f7f8a8ff":"markdown","594aa098":"markdown","5fa81e26":"markdown"},"source":{"08f12170":"import os\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\n\nfrom sklearn import preprocessing\nfrom xgboost import XGBRegressor\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.metrics import mean_squared_log_error\nfrom sklearn.model_selection import train_test_split\n\nimport warnings\nwarnings.filterwarnings(\"ignore\")","dfdc1eeb":"path = '\/kaggle\/input\/store-sales-time-series-forecasting\/'\nos.listdir(path)","12b9312c":"data_oil = pd.read_csv(path+'oil.csv')\ntrain_data = pd.read_csv(path+'train.csv', index_col=0)\ntest_data = pd.read_csv(path+'test.csv', index_col=0)\nsamp_subm = pd.read_csv(path+'sample_submission.csv')\ndata_holi = pd.read_csv(path+'holidays_events.csv')\ndata_store =  pd.read_csv(path+'stores.csv')\ndata_trans = pd.read_csv(path+'transactions.csv')","cf91e646":"print('Number of train samples: ', len(train_data.index))\nprint('Number of test samples: ', len(test_data.index))\nprint('Number of features: ', len(train_data.columns))","fa07c559":"train_data.head()","150b18ca":"test_data.head()","f4edf630":"train_data['family'].value_counts()[0:3]","c41bf41d":"data_oil.head()","70e35e14":"data_store.head()","563664c5":"data_store['city'].value_counts()[0:3]","b3477265":"data_trans.head()","cc191f7a":"data_holi.head()","adde4b97":"features = ['store_nbr', 'family', 'onpromotion']\ntarget = 'sales'","e41c0075":"def extract_weekday(s):\n    return s.dayofweek\n\ndef extract_month(s):\n    return s.month\n\ndef extract_year(s):\n    return s.year","e0f177bf":"train_data['date'] = pd.to_datetime(train_data['date'])\ntrain_data['weekday'] = train_data['date'].apply(extract_weekday)\ntrain_data['year'] = train_data['date'].apply(extract_year)\ntrain_data['month'] = train_data['date'].apply(extract_month)\n\ntest_data['date'] = pd.to_datetime(test_data['date'])\ntest_data['weekday'] = test_data['date'].apply(extract_weekday)\ntest_data['year'] = test_data['date'].apply(extract_year)\ntest_data['month'] = test_data['date'].apply(extract_month)","8d1a17db":"features.append('weekday')\nfeatures.append('year')\nfeatures.append('month')","d569ddc2":"enc = preprocessing.LabelEncoder()\nenc.fit(train_data['family'])","50402e0b":"train_data['family'] = enc.transform(train_data['family'])\ntest_data['family'] = enc.transform(test_data['family'])","0fa78b4a":"X_train = train_data[features]\ny_train = train_data[target]\nX_test = test_data[features]","5c886c7d":"X_train, X_val, y_train, y_val = train_test_split(X_train, y_train, test_size = 0.33, random_state=2021)","9a9d80f8":"model = XGBRegressor(objective='reg:squaredlogerror', n_estimators=200)\nmodel.fit(X_train, y_train)\ny_val_pred = model.predict(X_val)\ny_val_pred = np.where(y_val_pred<0, 0, y_val_pred)\nprint('Root Mean Squared Logaritmic Error:', np.sqrt(mean_squared_log_error(y_val, y_val_pred)))","1ab498d6":"reg = LinearRegression(normalize=True).fit(X_train, y_train)\ny_val_pred = reg.predict(X_val)\ny_val_pred = np.where(y_val_pred<0, 0, y_val_pred)\nprint('Root Mean Squared Logaritmic Error:', np.sqrt(mean_squared_log_error(y_val, y_val_pred)))","8e36864b":"y_test_XGB = model.predict(X_test)\ny_test_REG = model.predict(X_test)\nsamp_subm[target] = (0.8*y_test_XGB+0.2*y_test_REG)","5846da3a":"samp_subm[target] = np.where(samp_subm[target]<0, 0, samp_subm[target])","13c3d943":"samp_subm.to_csv('submission.csv', index=False)","59ddf850":"XGB Regression:","959dc8eb":"# Libraries","40ed7568":"Linear Regression:","aaa44bdc":"## Transaction Data","f9ed41fe":"## Store Data\n* Store metadata, including city, state, type, and cluster.\n* cluster is a grouping of similar stores.","14641c62":"# Path","60c0120b":"# Feature Engineering","a8273788":"# Define Train, Val And Test Data","93225363":"# Export","1b41f78d":"## Create Feature Weekday\nBased on the feature date we can create the features weekday, month or year.","10ebbe9b":"## Oil Data\nDaily oil price. Includes values during both the train and test data timeframes. (Ecuador is an oil-dependent country and it's economical health is highly vulnerable to shocks in oil prices.)","ef8a46b3":"# Predict Test Data","a35c115a":"## Encode Categorical Labels","1ab56bbb":"## Feature family\nThe feature family has 33 categorical values which we have to encode later. The values are evenly distributed.","772f675a":"# Exploratory Data Analysis","52ca0884":"## Holiday Data\n* Holidays and Events, with metadata\n* NOTE: Pay special attention to the transferred column. A holiday that is transferred officially falls on that calendar day, but was moved to another date by the government. A transferred day is more like a normal day than a holiday. To find the day that it was actually celebrated, look for the corresponding row where type is Transfer. For example, the holiday Independencia de Guayaquil was transferred from 2012-10-09 to 2012-10-12, which means it was celebrated on 2012-10-12. Days that are type Bridge are extra days that are added to a holiday (e.g., to extend the break across a long weekend). These are frequently made up by the type Work Day which is a day not normally scheduled for work (e.g., Saturday) that is meant to payback the Bridge.\n* Additional holidays are days added a regular calendar holiday, for example, as typically happens around Christmas (making Christmas Eve a holiday).","0d3e1ce8":"# Intro\nWelcome to the [Store Sales - Time Series Forecasting](https:\/\/www.kaggle.com\/c\/store-sales-time-series-forecasting\/data) competition.\n![](https:\/\/storage.googleapis.com\/kaggle-competitions\/kaggle\/29781\/logos\/header.png)\n\nIn this competition, we have to predict sales for the thousands of product families sold at Favorita stores located in [Ecuador](https:\/\/en.wikipedia.org\/wiki\/Ecuador).\n\n<span style=\"color: royalblue;\">Please vote the notebook up if it helps you. Feel free to leave a comment above the notebook. Thank you. <\/span>","f7f8a8ff":"# Overview","594aa098":"# Load Data","5fa81e26":"# Simple Model\nFirst we start with a simple model based on the feature in the train and test data."}}