{"cell_type":{"67f42bb9":"code","0a04bcbd":"code","40e0464e":"code","863b810c":"code","2c29a97c":"code","e4fad01b":"code","cd0c0624":"code","1c95de99":"code","04a17c69":"code","27d4e801":"code","231525f0":"code","0edd7cc2":"code","7fc538f1":"code","bfd6ded7":"code","cdfabbcc":"code","be012b35":"code","b9550e2f":"code","a2995520":"code","27af25b9":"code","389e7db4":"code","553a98a0":"code","312ef909":"code","516f61fb":"code","41a175f1":"code","2cfa4200":"code","523f144c":"code","5db5a0a6":"code","f2cf2f34":"code","56dd74a6":"code","15eb3dc1":"code","ba757e3f":"code","68286496":"code","30314031":"code","385d2bc7":"code","fe56d238":"code","faefe6a4":"code","38a1aa13":"code","b7951a49":"code","8cc525e4":"code","078fd246":"code","d3f93d8c":"code","f2a8d164":"code","507bbf95":"code","a4628cfa":"code","2e799cd9":"code","83d9897b":"code","15cdbf95":"code","28ec97ef":"code","399c0058":"code","dc70e6d9":"code","4821fe07":"code","35f8201a":"code","1e9c5be7":"code","c7bacb9d":"code","66248bfd":"code","f5f128f8":"code","c79baab6":"code","daf02d09":"code","5769e6a9":"code","4021385b":"code","73aebc2a":"code","6620f831":"code","33465ac0":"code","ce50c4e1":"code","16740006":"code","947933ac":"code","3a42ee6f":"code","2f69cd0c":"code","ef718b88":"code","c0df98ac":"code","13288f91":"code","15016371":"code","f6c668e3":"code","282b4ddd":"code","f7a2a3cc":"code","a0d09755":"code","3b5c6c7f":"code","9c684018":"code","84c4a1f8":"code","2e52f299":"code","9520be28":"code","7c05c11f":"code","201048c1":"code","1ba4abfc":"code","f798e6cc":"code","95cd94fb":"code","0e206f8d":"code","3bfb293b":"code","abc20935":"code","11b98d64":"code","cc371284":"code","8cdbb9aa":"code","e2f759dc":"code","f3f55c29":"code","26db2d96":"code","07bd6556":"code","710e5fca":"code","73968cf2":"code","af04c699":"markdown","4b8a2a05":"markdown","8ae109bd":"markdown","ae819f06":"markdown","03b37c70":"markdown","bb8a9716":"markdown","33df8018":"markdown","d3c68ab5":"markdown","3473ae8c":"markdown","abfc8a1e":"markdown","24a9452f":"markdown","85ffb77c":"markdown","9ce51c0e":"markdown","7373b4a3":"markdown","e0bef84e":"markdown","f8fd65c7":"markdown","8e3c34ea":"markdown","a7aa1a01":"markdown","75dbb037":"markdown","30ba7f7d":"markdown","452f9343":"markdown","14210d50":"markdown","17050cec":"markdown","93ef4b29":"markdown","472af070":"markdown","7ec44092":"markdown","cd7fc591":"markdown","721bc6fa":"markdown","aa664671":"markdown","b0d3e5ec":"markdown","b3476281":"markdown","ec2b2bbf":"markdown","0432f201":"markdown","13e1ab84":"markdown","5f3d9323":"markdown","51ac4a3d":"markdown","40db7fc8":"markdown","b49b3ba5":"markdown","239f8535":"markdown","ceead5bf":"markdown","e2454ddf":"markdown","28f469ea":"markdown","dd3f484a":"markdown","a28a287f":"markdown","ade24984":"markdown","05660550":"markdown","6ea02e61":"markdown","2715fc85":"markdown","38976b13":"markdown","41bb9a96":"markdown","0dcc3e83":"markdown","1201f738":"markdown","733d8149":"markdown","0588d6ee":"markdown"},"source":{"67f42bb9":"pip install addfips","0a04bcbd":"pip install --upgrade pip","40e0464e":"!pip install -U plotly","863b810c":"!pip install seaborn --upgrade","2c29a97c":"import pandas as pd\nimport seaborn as sns\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport plotly.express as px\nimport addfips as fips\nfrom urllib.request import urlopen\nimport json\nwith urlopen('https:\/\/raw.githubusercontent.com\/plotly\/datasets\/master\/geojson-counties-fips.json') as response:\n    counties = json.load(response)\naf = fips.AddFIPS()","e4fad01b":"df_trips_people_20=pd.read_csv(\"https:\/\/storage.googleapis.com\/sreejit-1\/Trips_by_Distance_Fy2020only.csv\")\ndf_trips_people_20.head(5)\n","cd0c0624":"#check the type of df_trips_people_20\ntype(df_trips_people_20)\n#convert index object to data frame\n#df_trips_people_20=df_trips_people_20.to_frame()\ntype(df_trips_people_20)","1c95de99":"df_covid_deaths_20=pd.read_csv(\"https:\/\/storage.googleapis.com\/files.mobibootcamp.com\/2020-datafiles\/time_series_covid19_deaths_US.csv\")\ndf_covid_deaths_20.head(5)","04a17c69":"#check the type of df_covid_deaths_20\ntype(df_covid_deaths_20)\n","27d4e801":"df_trips_people_20.info()","231525f0":"#filter the data to county level\ndf_trips_people_20=df_trips_people_20[df_trips_people_20['Level']=='County']\ndf_trips_people_20.info()","0edd7cc2":"# convert dataframe1 columns names to lower case\ndf_trips_people_20.rename(columns={\"Unnamed: 0\":\"unnamed\",\"Level\":\"level\",\"Date\":\"travle_date\",\"State.FIPS\":\"state_fips\",\"State.Postal.Code\":\"state_nm\",\"County.FIPS\":\"county_fips\",\"County.Name\":\"county_nm\",\"Population.Staying.at.Home\":\"pop_at_home\",\"Population.Not.Staying.at.Home\":\"pop_not_home\",\"Number.of.Trips\":\"total_trips\",\"Number.of.Trips..1\":\"trips_dis_1\",\"Number.of.Trips.1.3\":\"trips_dis_1_3\",\n                                 \"Number.of.Trips.3.5\":\"trips_dis_3_5\",\"Number.of.Trips.5.10\":\"trips_dis_5_10\",\n                                 \"Number.of.Trips.10.25\":\"trips_dis_10_25\",\"Number.of.Trips.25.50\":\"trips_dis_25_50\",\"Number.of.Trips.50.100\":\"trips_dis_50_100\"\n                                 ,\"Number.of.Trips.100.250\":\"trips_dis_100_250\",\"Number.of.Trips.250.500\":\"trips_dis_250_500\",\"Number.of.Trips...500\":\"trips_dis_500\"},inplace=True)\ndf_trips_people_20.head(5)","7fc538f1":"#look at the missing values in df_trips_people_20\ndf_trips_people_20_nullcols=df_trips_people_20.columns[df_trips_people_20.isnull().any()].tolist()\ndf_trips_people_20_nullcols\n##there are many fields are having missing values","bfd6ded7":"#export the data\n#from google.colab import drive\n#drive.mount('drive')\n#df_trips_people_20.to_csv('trips_null.csv')\n#df_trips_people_20.to_csv(r'C:\\Users\\Triveni\\OneDrive\\Documents\\trips_null.csv', index = False)","cdfabbcc":"#from google.colab import drive\n#drive.mount('\/content\/drive')","be012b35":"## find out how many records missing the values and % of count\n\nsize = df_trips_people_20.shape[0]\n\nprint (\"Total Size of the dataset : \", size)\n\ntotal_na = df_trips_people_20.isnull().sum(axis = 0)\nprint (\"Null values : \", total_na)\n\nprint (\"PERCENTAGE : \", ((total_na\/size)*100))","b9550e2f":"#drop null values for all the identified columns which are having nulls\ndf_trips_people_20 = df_trips_people_20.dropna(axis=0, subset=df_trips_people_20_nullcols)\n#check the data after removing nulls\ndf_trips_people_20.columns[df_trips_people_20.isnull().any()].tolist()","a2995520":"# check the datatypes and dataframe info\ndf_trips_people_20.info()","27af25b9":"#convert the date datatype from object to date\ndf_trips_people_20['travle_date']=df_trips_people_20['travle_date'].astype('datetime64[ns]')\ndf_trips_people_20.info()\ndf_trips_people_20.head(4)","389e7db4":"#drop the columns which are not needed for the analysis\ndf_trips_people_20.drop([\"unnamed\",\"level\",\"state_fips\"],inplace=True,axis=1)\ndf_trips_people_20.head(5)","553a98a0":"#County column - county names are concatinated with \"county\" so remove the \"county\" from the values\ndf_trips_people_20['county_nm'] = df_trips_people_20['county_nm'].str.replace('County','')\ndf_trips_people_20.head(5)","312ef909":"##check the duplicates in the data\ndf_trips_people_20.duplicated(keep='first')\n##looks like no duplicates in the data","516f61fb":"# convert dataframe2 columns names to lower case\ndf_covid_deaths_20.columns=df_covid_deaths_20.columns.str.lower()\ndf_covid_deaths_20.rename(columns={\"admin2\":\"county\",\"province_state\":\"state\",\"country_region\":\"country\",\"long_\":\"long\"},inplace=True)\ndf_covid_deaths_20.head(2)","41a175f1":"# unpivot the dataframe for better analysis\ndf_covid_deaths_20=pd.melt(df_covid_deaths_20,id_vars=[\"iso2\",\"iso3\",\"uid\",'code3', 'fips', 'county', 'state','country', 'lat', 'long', 'combined_key','population'],var_name=\"date\",value_name=\"count\")\ndf_covid_deaths_20.head(5)","2cfa4200":"#display dataframe datatypes and information\ndf_covid_deaths_20.info()","523f144c":"#convert date format from object to date\ndf_covid_deaths_20['date']=df_covid_deaths_20['date'].astype('datetime64[ns]')\ndf_covid_deaths_20.info()\ndf_covid_deaths_20.head(4)","5db5a0a6":"#check for null values\ndf_covid_deaths_20_nullcols=df_covid_deaths_20.columns[df_covid_deaths_20.isnull().any()].tolist()\ndf_covid_deaths_20_nullcols","f2cf2f34":"#check no null value records counts and % of null values\n\nsize = df_covid_deaths_20.shape[0]\n\nprint (\"Total Size of the dataset : \", size)\n\ntotal_na = df_covid_deaths_20.isnull().sum(axis = 0)\nprint (\"Null values : \", total_na)\n\nprint (\"PERCENTAGE : \", ((total_na*100)\/size)*100)\n","56dd74a6":"#drop null values for all the identified columns which are having nulls\ndf_covid_deaths_20 = df_covid_deaths_20.dropna(axis=0, subset=df_covid_deaths_20_nullcols)\n#check the data after removing nulls\ndf_covid_deaths_20.columns[df_covid_deaths_20.isnull().any()].tolist()\n","15eb3dc1":"#drop the columns which are not needed for the analysis\ndf_covid_deaths_20.drop([\"iso2\",\"iso3\",\"uid\",\"code3\"],inplace=True,axis=1)\ndf_covid_deaths_20.head(5)","ba757e3f":"#export the data\n#from google.colab import drive\n#drive.mount('drive')\n#df_covid_deaths_20.to_csv('covid.csv')\n#df_covid_deaths_20.to_csv(r'C:\\Users\\Triveni\\OneDrive\\Documents\\covid.csv', index = False)","68286496":"##check the duplicates in the data\ndf_covid_deaths_20.duplicated(keep='first')\n##looks like no duplicates in the data","30314031":"## Tranfer pandas dataframes to sprak\n#df_covid_sp = spark.createDataFrame(df_covid_deaths_20)\n#df_trips_sp = spark.createDataFrame(df_trips_people_20)","385d2bc7":"## join the two dataframes using spark SQL\n#df_covid_trips_sp = df_covid_sp.join(df_trips_sp, (df_covid_sp.date == df_trips_sp.travle_date) & (df_covid_sp.fips == df_trips_sp.county_fips))\n#df_covid_trips_sp.show()\n","fe56d238":"## select the columns from combined dataframe for further to our analysis\n\n#df_covid_trips_sp_st=df_covid_trips_sp.select([c for c in df_covid_trips_sp.columns if c not in {'combined_key','travle_date','state_nm','county_fips','county_nm'}])\n#df_covid_trips_sp_st.show()","faefe6a4":"#find out which state has more number of trips\n#from pyspark.sql.functions import sum as mean\n#df_trips_state=df_covid_trips_sp_st.groupBy('state','county').sum('total_trips').alias('total_trips')\n#df_trips_state.show()","38a1aa13":"## check the record count for both the dataframes\ntrips_size = df_trips_people_20.shape[0]\n\nprint (\"Total Size of the dataset : \", trips_size)\n\ncovid_size = df_covid_deaths_20.shape[0]\n\nprint (\"Total Size of the dataset : \", covid_size)\n","b7951a49":"df_covid_merge=pd.merge(df_covid_deaths_20,df_trips_people_20,how='left', left_on=['fips','date'], right_on = ['county_fips','travle_date'])\ndf_covid_merge.head(5)","8cc525e4":"## check the record count after joining both the datasets\njoin_size = df_covid_merge.shape[0]\nprint (\"Total Size of the dataset : \", join_size)\n\n#looks like some records getting dropped with inner join so we have used left join to merge the data ","078fd246":"#convert dataframe to spark dataframe\n#df_covid_merge.head(5)\n#pd.df_covid_merge.drop([['combined_key','travle_date','state_nm','county_fips','county_nm']], axis=1,, inplace=True)\ndf_covid_merge=df_covid_merge.drop(columns=['combined_key','travle_date','state_nm','county_fips','county_nm'])\ndf_covid_merge.head(5)","d3f93d8c":"## look at the mean value of the drips for each state\ndf_covid_total_deaths=df_covid_merge.groupby(['state','county'],as_index=False)['count'].mean()\n#df_covid_total_deaths['day_count']=df_covid_total_deaths['count'].diff()\ndf_covid_total_deaths=df_covid_total_deaths.groupby(['state'],as_index=False)['count'].sum()\ndf_covid_deaths_top=df_covid_total_deaths.nlargest(5,'count')\ndf_covid_deaths_bottom=df_covid_total_deaths.nsmallest(5,'count')","f2a8d164":"#Look at the top three states which are having highest covid deaths\ndf_covid_deaths_top\n\n","507bbf95":"#look at the bottom 5 states which are having low covid deaths\ndf_covid_deaths_bottom","a4628cfa":"#Find the mean value for avg trips for top 5 states..\ndf_covid_date_avg=df_covid_merge.groupby(['state'],as_index=False)['total_trips'].sum()\n\ndf_covid_date_avg.nlargest(5,'total_trips')\n","2e799cd9":"#Find the mean value for avg trips for bottom 5 states..\ndf_covid_date_avg.nsmallest(5,'total_trips')","83d9897b":"## find the mean value of the covid deaths\ndf_covid_deaths_avg=df_covid_merge.groupby(['state'],as_index=False)['count'].sum()\n\n","15cdbf95":"# Look at the trips by months and findout which month is having higher number of trips?\ndf_trp_by_month=df_covid_merge.groupby(df_covid_merge['date'],as_index=False)['total_trips'].sum()\ndf_trp_by_month['month']=df_trp_by_month['date'].dt.month\ndf_trp_by_month=df_trp_by_month.groupby(df_trp_by_month['month'],as_index=False)['total_trips'].sum()\ndf_trp_by_month=df_trp_by_month.sort_values(by=['total_trips'], ascending=False)\ndf_trp_by_month.head(15)","28ec97ef":"# Look at the trips by months and findout which month is having higher number of trips?\ndf_pop_home_month=df_covid_merge.groupby(df_covid_merge['date'],as_index=False)['pop_at_home'].sum()\ndf_pop_home_month['month']=df_pop_home_month['date'].dt.month\ndf_pop_home_month=df_pop_home_month.groupby(df_pop_home_month['month'],as_index=False)['pop_at_home'].sum()\ndf_pop_home_month=df_pop_home_month.sort_values(by=['pop_at_home'], ascending=False)\ndf_pop_home_month.head(15)","399c0058":"df_covid_merge.shape","dc70e6d9":"df_covid_merge","4821fe07":"##look at the summary stastics of the data\ndf_covid_merge.describe()","35f8201a":"#create a data frame\ndf_covid_clean=df_covid_merge\ndf_covid_date=df_covid_clean.groupby(['date'],as_index=False)['count'].sum()\n#df_covid_date=df_covid_date.groupby(['date'],as_index=False)['count'].sum()\ndf_covid_date.set_index(['date'],inplace=True)\ndf_covid_date =df_covid_date.resample('M', closed='right', label='right').mean()\n","1e9c5be7":"#plot the to see the trend of covid deaths.\nax = df_covid_date.plot(figsize=(12,6), color='r', marker='o')\nax.set_yticklabels(pd.Series(ax.get_yticks()).map(lambda x: '{:.0f}'.format(x)))\nax.set_title(\"Covid deaths cases by month\",size=20)\nax.set_xlabel(\"Months\",size=15)\nax.set_ylabel(\"death cases\",size=15)\nax.grid(color='grey', linestyle='-', linewidth=0.2)\n#print(df_covid_date)","c7bacb9d":"df_covid_month=df_covid_merge.groupby(df_covid_merge['date'],as_index=False)['count'].sum()\ndf_covid_month['month']=df_covid_month['date'].dt.month\ndf_covid_month['week']=df_covid_month['date'].dt.isocalendar().week\ndf_covid_week=df_covid_month.groupby(['month','week'],as_index=False)['count'].mean()\ndf_covid_week=df_covid_month.groupby(['week'],as_index=False)['count'].mean()\ndf_covid_week['diff']=df_covid_week['count'].diff()\ndf_covid_week.sum()","66248bfd":"#look at the splot of week over week changes in the covid deaths\nplt.figure(figsize=(15,8))\nplt.xticks(rotation=70)\nplt_week=sns.barplot(x='week',y='diff',data=df_covid_week,color='grey')\nfor bar in plt_week.patches:\n    if bar.get_height() < 0:\n        bar.set_color('red')    \n    else:\n        bar.set_color('salmon')\nplt.xlabel(\"Weeks\", size=15)\nplt.ylabel(\"death cases diff by week\", size=15)\nplt.title(\"Covid-19 death cases week over week change\",size=20)","f5f128f8":"# look at dataframe for date wise covid deaths\ndf_covid_date_tr=df_covid_merge.groupby(df_covid_merge['date'],as_index=False)['count'].sum()\ndf_covid_date_tr['diff']=df_covid_date_tr['count'].diff()\ndf_covid_date_tr.nlargest(5,'diff')#90151\n#if we want to validate the data export to csv\n#df_covid_date_tr.to_csv('covid.csv')\n","c79baab6":"#plot the to see the trend of covid deaths by date.\nplt.figure(figsize=(15,8))\nplt.xticks(rotation=70)\nplt_box=sns.lineplot(data=df_covid_date_tr, x=\"date\", y=\"diff\",color='red', linewidth=2.5)\nplt.xlabel(\"date\", size=15)\nplt.ylabel(\"deaths\", size=15)\nplt.title(\"Trend of covid deaths by date\",size=20)\nplt_box.legend(loc='upper right', bbox_to_anchor=(1.4, 1))","daf02d09":"#add month to date trend dataframe\ndf_covid_date_tr['month']=df_covid_date_tr['date'].dt.month\ndf_covid_date_tr.head(2)","5769e6a9":"plt.figure(figsize=(15,8))\nplt.xticks(rotation=70)\nplt_box=sns.boxplot(y='diff', x='month', \n                   data=df_covid_date_tr, \n                   width=0.5,\n                   palette=\"colorblind\")\nplt_box=sns.stripplot(y='diff', x='month', \n                   data=df_covid_date_tr, \n                   jitter=True, \n                   marker='o', \n                   alpha=0.5,\n                   color='black')\nplt.xlabel(\"Months\", size=15)\nplt.ylabel(\"covid cases\", size=15)\nplt.title(\"Box plot - Covid-19 confirmed cases by month\/dates\",size=20)","4021385b":"current_feature = \"count\"\ncurr_min = min( df_covid_deaths_20[\"count\"])\ncurr_max = max( df_covid_deaths_20[\"count\"])","73aebc2a":"df_test = df_covid_deaths_20[df_covid_deaths_20['date']=='2020-09-20']","6620f831":"df_test.head(5)","33465ac0":"df_test['fips'] = df_test['fips'].astype('int64', copy=True)\ndf_test = df_test[df_test['fips'] < 80000].copy(deep=True)\ndf_test['fips'] = df_test['fips'].astype('str', copy=True)\ndf_test['fips'] = df_test['fips'].str.rjust(5, '0')","ce50c4e1":"#Plot map\nfig = px.choropleth(df_test, geojson=counties, locations='fips', color=current_feature,\n                           color_continuous_scale=\"Viridis\",\n                           range_color=(curr_min, 100),\n                           scope=\"usa\",\n                           labels={current_feature: current_feature}\n                          )\n\nfig.update_layout( title_text = 'Covid deaths by county',margin={\"r\":0,\"l\":0,\"b\":0})\nfig.show()","16740006":"df_covid_deaths_state=df_covid_merge.groupby(['state','county'],as_index=False).agg({'count': ['mean'],'population':['sum']})\n#rename columns\ndf_covid_deaths_state.columns = ['state','county','deaths_mean', 'population']\ndf_covid_deaths_state.head(5)\ndf_covid_deaths_state=df_covid_deaths_state.groupby(['state'],as_index=False).agg({'deaths_mean': ['sum'],'population':['sum']})\ndf_covid_deaths_state.columns = ['state','deaths', 'population']\n","947933ac":"##look at the top 5 states where covid deaths are high and thier popilation\ndf_high_deats_top=df_covid_deaths_state.nlargest(5,'deaths')\ndf_high_population_top=df_covid_deaths_state.nlargest(5,'population')\ndf_high_deats_bottom=df_covid_deaths_state.nsmallest(5,'deaths')","3a42ee6f":"plt.figure(figsize=(10,8))\nplt.xticks(rotation=70)\n#sns.set_theme(style=\"white\")\nplt_sactter=sns.scatterplot(data=df_covid_deaths_state, x=\"deaths\", y=\"population\",hue=\"state\",size=\"deaths\", sizes=(40, 400), alpha=.9, palette=\"rocket_r\")\n#plt_sactter=sns.regplot(data=df_covid_deaths_state, x=\"deaths\", y=\"population\")\nplt.xlabel(\"deaths\", size=15)\nplt.ylabel(\"population\", size=15)\nplt.title(\"State - Covid deaths vs population\",size=20)\nplt.legend(loc='center left', bbox_to_anchor=(1.25, 0.5), ncol=4)","2f69cd0c":"df_covid_deaths_state['Per.pop'] = 100 * df_covid_deaths_state['population']  \/ df_covid_deaths_state['population'].sum()\ndf_covid_deaths_state['death rate'] = (df_covid_deaths_state['deaths']\/df_covid_deaths_state['population'])*100\n","ef718b88":"#look at the highest death rate and population of sates\ndf_covid_deaths_state.nlargest(5,'death rate')","c0df98ac":"##look at the death rates for the highest population rate states\ndf_covid_deaths_state.nlargest(5,'Per.pop')","13288f91":"#plot population rate and death rate\nplt.figure(figsize=(10,8))\nplt.xticks(rotation=70)\n#sns.set_theme(style=\"white\")\nplt_sactter=sns.scatterplot(data=df_covid_deaths_state, x=\"death rate\", y=\"Per.pop\",hue=\"state\",size=\"deaths\", sizes=(40, 400), alpha=.9, palette=\"rocket_r\")\n#sns.relplot(data=df_covid_deaths_state, x=\"death rate\", y=\"Per.pop\",col=\"state\", hue=\"state\", style=\"state\",kind=\"scatter\")\nplt.xlabel(\"deaths rate\", size=15)\nplt.ylabel(\"population rate\", size=15)\nplt.title(\"State - Covid death rate vs population rate\",size=20)\nplt.legend(loc='center left', bbox_to_anchor=(1.25, 0.5), ncol=4)\n#plt.legend(title='state', loc='upper riht', labels=['New York', 'New Jersey'])","15016371":"a = df_covid_merge.groupby(['state','county'],as_index=False).agg({'count': 'mean'})\na.columns = ['state','county','death_count']\na.rename(columns={'count': 'death_count'}, inplace=True)\naa = a.groupby(['state'],as_index=False).agg({'death_count': 'sum'}).sort_values('death_count', ascending=False)\naa_10 = aa.nlargest(5,'death_count')\n","f6c668e3":"dff = aa_10[::-1]\nfig, ax = plt.subplots(figsize = (15,8))\nax.barh(aa_10['state'],aa_10['death_count'],color = 'brown')\nplt.xlabel(\"Number of Deaths\")\nplt.ylabel(\"States\")\nplt.title(\"Top 10 states with highest deaths\")","282b4ddd":"df_covid_dist_top=pd.merge(dff,df_covid_merge,how='inner', left_on=['state'], right_on = ['state'])\ndf_covid_dist_top.head(5)\ndf_covid_dist=df_covid_dist_top.groupby(['state','county','date'],as_index=False).agg({'count': ['mean']})\ndf_covid_dist.columns = ['state','county','date','deaths_mean']\n#df_covid_dist['diff']=df_covid_dist['deaths_mean'].diff()\ndf_covid_dist=df_covid_dist.groupby(['state','date'],as_index=False).agg({'deaths_mean': ['mean']})\ndf_covid_dist.columns = ['state','date','deaths_mean']\ndf_covid_dist['month']=df_covid_dist['date'].dt.month\n#plot\ng = sns.FacetGrid(df_covid_dist, col=\"state\",hue='month',height=4, col_wrap=6)\ng.map(sns.histplot, \"deaths_mean\")\ng.add_legend()\ng.set_axis_labels(\"deaths\", \"days\")\n","f7a2a3cc":"df_covid_county=df_covid_merge.groupby(['state','county'],as_index=False).agg({'count': ['mean'],'population':['sum']})\ndf_covid_county.columns = ['state','county','deaths_mean', 'population']\ndf_covid_state_top10=df_covid_deaths_state.nlargest(10,'deaths')\ndf_covid_county=df_covid_county.sort_values('deaths_mean', ascending=False).groupby('state').head(3).sort_values(['state', 'deaths_mean'], ascending=False)\ndf_covid_county=pd.merge(df_covid_county,df_covid_state_top10,how='inner', left_on=['state'], right_on = ['state'])\ndf_covid_county=df_covid_county[['state','county','deaths_mean']]\npivot_df_covid_county = df_covid_county.pivot(index='state', columns='county')\npd.set_option('max_columns', None)\n#print(pivot_df_covid_county)\nax = pivot_df_covid_county.plot.bar(stacked=True,figsize=(10,7))\nax.legend(bbox_to_anchor=(1.1, 1.05))\nax.set_title(\"Covid deaths - Top 3 counties in Top 10 States\",size=20)\nax.set_xlabel(\"States\",size=15)\nax.set_ylabel(\"death cases\",size=15)","a0d09755":"#plot distributon of total number of trips across USA\ndf_trips_date=df_covid_merge.groupby(df_covid_merge['date'],as_index=False)['total_trips'].sum()\ndf_trips_date=pd.merge(df_trips_date,df_covid_date_tr,how='inner', left_on=['date'], right_on = ['date'])\n#plt.figure(figsize=(15,8))\n#plt.xticks(rotation=70)\na4_dims = (15, 8)\nfig, ax = plt.subplots(figsize=a4_dims)\nax2 = ax.twinx()\nsns.lineplot(data=df_trips_date, x=\"date\", y=\"total_trips\",color='blue', linewidth=2.5,ax=ax)\nsns.lineplot(data=df_trips_date, x=\"date\", y=\"diff\",color='red', linewidth=2.5,ax=ax2)\nplt.xlabel(\"date\", size=15)\nplt.ylabel(\"deaths\", size=15)\nplt.title(\"Trend of trips vs deaths by date\",size=20)\n#figsize=(15,8)\n#plt_box.legend(loc='upper right', bbox_to_anchor=(1.4, 1))\nax2.legend(handles=[a.lines[0] for a in [ax,ax2]], \n           labels=[\"trips\", \"deaths\"])","3b5c6c7f":"#identify top 10 states\ndf_date_state=df_covid_date_state=pd.merge(dff,df_covid_merge,how='inner', left_on=['state'], right_on = ['state'])\ndf_covid_date_state=df_covid_date_state.groupby(df_date_state['date'],as_index=False)['count'].sum()\ndf_covid_date_state['diff']=df_covid_date_state['count'].diff()\ndf_trips_date_state=df_date_state.groupby(['date'],as_index=False)['total_trips'].sum()\ndf_trips_date_state=pd.merge(df_trips_date_state,df_covid_date_state,how='inner', left_on=['date'], right_on = ['date'])\n#dff.head(20)","9c684018":"##plot trend of trips and death counts for top 10 states\na4_dims = (15, 8)\nfig, ax = plt.subplots(figsize=a4_dims)\nax2 = ax.twinx()\nsns.lineplot(data=df_trips_date_state, x=\"date\", y=\"total_trips\",color='blue', linewidth=2.5,ax=ax)\nsns.lineplot(data=df_trips_date_state, x=\"date\", y=\"diff\",color='red', linewidth=2.5,ax=ax2)\nplt.xlabel(\"date\", size=15)\nplt.ylabel(\"deaths\", size=15)\nplt.title(\"Bottom 10 covid states - Trend of trips vs deaths by date\",size=20)\n#figsize=(15,8)\n#plt_box.legend(loc='upper right', bbox_to_anchor=(1.4, 1))\nax2.legend(handles=[a.lines[0] for a in [ax,ax2]], \n           labels=[\"trips\", \"deaths\"])","84c4a1f8":"\ndf_date_state_flop=df_covid_date_state=pd.merge(df_high_deats_bottom,df_covid_merge,how='inner', left_on=['state'], right_on = ['state'])\ndf_date_state_covid=df_covid_date_state.groupby(df_date_state_flop['date'],as_index=False)['count'].sum()\ndf_date_state_covid['deaths']=df_date_state_covid['count'].diff()\ndf_trips_date_state_flop=df_date_state_flop.groupby(['date'],as_index=False)['total_trips'].sum()\ndf_trips_date_state_flop=pd.merge(df_trips_date_state_flop,df_date_state_covid,how='inner', left_on=['date'], right_on = ['date'])\ndf_trips_date_state_flop.head(5)","2e52f299":"##plot trend of trips and death counts for bottom 10 states\na4_dims = (15, 8)\nfig, ax = plt.subplots(figsize=a4_dims)\nax2 = ax.twinx()\nsns.lineplot(data=df_trips_date_state_flop, x=\"date\", y=\"total_trips\",color='blue', linewidth=2.5,ax=ax)\nsns.lineplot(data=df_trips_date_state_flop, x=\"date\", y=\"deaths\",color='red', linewidth=2.5,ax=ax2)\nplt.xlabel(\"date\", size=15)\nplt.ylabel(\"deaths\", size=15)\nplt.title(\"Bottom 10 covid states - Trend of trips vs deaths by date\",size=20)\n#figsize=(15,8)\n#plt_box.legend(loc='upper right', bbox_to_anchor=(1.4, 1))\nax2.legend(handles=[a.lines[0] for a in [ax,ax2]], \n           labels=[\"trips\", \"deaths\"])","9520be28":"df_group = df_covid_merge[['state','count','pop_at_home','pop_not_home']]\ndf_group = df_group.groupby(['state'],as_index=False).agg({'count': 'sum','pop_at_home':'sum','pop_not_home':'sum'}).sort_values('count', ascending=False)\ndf_group['pop_at_home'] = df_group['pop_at_home'].astype(int)\ndf_group['pop_not_home'] = df_group['pop_not_home'].astype(int)","7c05c11f":"df_group_1 = df_group[['state','pop_at_home','pop_not_home']]\ndf_group_1 = df_group_1.head()","201048c1":"df_group_1 = df_group_1.set_index('state')\n\ndf_group_1.plot(kind='bar',figsize = (15,8))\nplt.xlabel(\"States\")\nplt.ylabel(\"Counts of People at Home vs People not home\")\nplt.title(\"Comparison of Top 5 states with people at home vs people who dint\")","1ba4abfc":"df_mich = df_covid_merge[df_covid_merge['state'] == 'New York']\ncol_list = list(df_mich.columns.values.tolist())\nedit_list = col_list[12:16]\n","f798e6cc":"df_melt = df_mich.melt(id_vars = ['state','date','count','trips_dis_10_25','trips_dis_25_50','trips_dis_500'],value_vars =  edit_list,value_name= 'trips_dis_1_10')\n","95cd94fb":"df_melt['month']=df_melt['date'].dt.month\n#df_melt['month'].sort_values('month', ascending=True)","0e206f8d":"df_melt = df_melt.groupby(['month'])['trips_dis_1_10','trips_dis_10_25','trips_dis_25_50','trips_dis_500'].sum().reset_index()","3bfb293b":"plt.figure(figsize=(15, 5))\nl1, = plt.plot(df_melt['month'], df_melt['trips_dis_1_10'],color='red')\nl2, = plt.plot(df_melt['month'], df_melt['trips_dis_10_25'],color='green')\nl3, = plt.plot(df_melt['month'], df_melt['trips_dis_25_50'], color='blue')\n#plt.legend([l1, l2, l3])\nplt.legend([l1, l2, l3], ['1-10 miles', '10-25 miles', '25-50 miles'])\nplt.xlabel(\"Months\")\nplt.ylabel(\"Number of Trips\")\n \nplt.title('Number of trips vs Months')\nplt.show()","abc20935":"df_mich_county = df_mich.groupby(['county'],as_index=False).agg({'count': 'sum'}).sort_values('count', ascending=False)\ndf_mich_county = df_mich_county.head()","11b98d64":"\na4_dims = (15, 8)\nfig1, ax1 = plt.subplots(figsize=a4_dims)\nlabels = df_mich_county['county']\nsizes = df_mich_county['count']\n\nax1.pie(sizes, labels=labels, autopct='%1.1f%%',shadow=True, startangle=90)\nax1.axis('equal')  # Equal aspect ratio ensures that pie is drawn as a circle.\nplt.title('Covid deaths - Top 5 counties in New York')\nplt.show()\n","cc371284":"df_mich_county_1 = df_mich.groupby(['county'],as_index=False).agg({'count': 'sum','pop_at_home':'sum','pop_not_home':'sum','population': 'sum'}).sort_values('count', ascending=False)\n#df_mich_county_1 = df_mich_county_1[['county','pop_at_home','pop_not_home']]\ndf_mich_county_1.head()\ndf_mich_county_1 = df_mich_county_1.head()","8cdbb9aa":"df_mich_county_1","e2f759dc":"del df_mich_county_1['count']","f3f55c29":"df_mich_county_1 = df_mich_county_1.set_index('county')\n\ndf_mich_county_1.plot(kind='bar',figsize = (15,8))\nplt.xlabel(\"County\")\nplt.ylabel(\"Counts of People \")\nplt.title(\"Comparison of Top 5 countys in New York with people at home vs people who dint\")","26db2d96":"#df_covid_merge.info()\ndf_covid_trips_hist=df_covid_merge.groupby(['state','county'],as_index=False).agg({'count': ['mean'],'population':['sum'],'pop_at_home':['sum'],'pop_not_home':['sum'],'total_trips':['sum']})\ndf_covid_trips_hist.columns=['state','county','count','population','pop_at_home','pop_not_home','total_trips']\ndf_covid_trips_hist=df_covid_trips_hist.groupby(['state'],as_index=False).agg({'count': ['sum'],'population':['sum'],'pop_at_home':['sum'],'pop_not_home':['sum'],'total_trips':['sum']})\ndf_covid_trips_hist.columns=['state','count','population','pop_at_home','pop_not_home','total_trips']\ng=sns.pairplot(df_covid_trips_hist, hue=\"state\",diag_kind=\"hist\")\ng.fig.suptitle(\"Overall Correlation of all variables\", y=1.08)","07bd6556":"top5_death = df_covid_merge.groupby(['state'],as_index=False).agg({'count': 'sum','pop_not_home': 'sum','pop_at_home': 'sum'}).sort_values('count', ascending=False)\ntop5_death['pop_not_home'] = top5_death['pop_not_home'].astype(int)\ntop5_death['pop_at_home'] = top5_death['pop_at_home'].astype(int)\ntop5_death = top5_death.head()\ntop5_death.head()","710e5fca":"tripsmerge = df_trips_people_20.groupby(['state_nm'],as_index=True).agg({'total_trips': 'sum', 'trips_dis_1': 'sum','trips_dis_1_3': 'sum','trips_dis_3_5': 'sum',\n                                                                          'trips_dis_5_10': 'sum', 'trips_dis_10_25': 'sum', 'trips_dis_25_50': 'sum', \n                                                                          'trips_dis_50_100': 'sum', 'trips_dis_100_250': 'sum',\n                                                                          'trips_dis_250_500': 'sum', 'trips_dis_500': 'sum'}\n                                                                         ).sort_values('total_trips', ascending=False)\n\n\ntripsmerge.head(5)","73968cf2":"tripsmerge1=tripsmerge.nlargest(10,'total_trips')\nax1 = tripsmerge1.plot.bar(stacked=True,figsize=(15,10))\nax1.legend(bbox_to_anchor=(0.98, .97))\nax1.set_title(\"Distribution of trips - Top 10 States with most Total Trips\",size=20)\nax1.set_xlabel(\"States\",size=15)\nax1.set_ylabel(\"# of Trips\",size=15)","af04c699":"**Insight 19: Correlation plots shows number of deaths increased slightly as number of trips increases.This is kind of aligned with analysis in above plots.**","4b8a2a05":"Analysis 9: What are the top 10 states with highest deaths?\n\nAssumption: Based on above analysis New York,New Jersey,Illinios and Massachusetts states may fall in the top 10 states which are having highest deaths","8ae109bd":"Analysis 11: What are the top 3 counties which are having highest deaths in Top 10 states of USA?\n\nAssumption: Urban counties may have higher death rates..","ae819f06":"### Data Cleaning - df_covid_deaths_20 dataframe","03b37c70":"Analysis 19: Look at the correlations of **all** variables of both the datasets?\n\nAssumption: We assume that above insights align with the correlation matrix of the datasets.","bb8a9716":"# EDA","33df8018":"**Final data frame for EDA**","d3c68ab5":"**Insight 12: Above trend indicates there is sudden drop in the trips in months of March and April 2020 as the death count increased.This is inline with our assumption**","3473ae8c":"**Query 2:Find out which month had more number of trips?**","abfc8a1e":"**Insight 13: Top-10 states with highest death shows simillar trend of analysis as in Insight 12.**","24a9452f":"Analysis 18: Did more number of people in New York county stayed at home resulting in lower number of deaths?\n\nAssumption: We assume that more number of people stayed at home in New York county","85ffb77c":"**Insights 6: The map above shows the list of states with highest number of deaths up until the month of Sep-2020.We notice that high populous states like CA,NY and MA have higher deaths**","9ce51c0e":"Analysis 2: What is the week over week change in covid deaths?\n\nAssumption: Based on above analysis,covid deaths may be higher during the weeks of may 2020 and june 2020","7373b4a3":"**Insight 5: Above plot indicates,more number of dates appeared as outliers in the month of march and april  that means those dates are having higher number covid deaths.But it is not the case with other months like june.\n2.there is huge variability in covid deaths in August month.Because we see some dates are having covid deaths below 500 and other dates are having covid deaths are above 1000 but not between**","e0bef84e":"**Insight 14: Above analysis shows that the impact of high death rates in other states led to lower trips across states that saw lower overall death rates during the month of March and April.**","f8fd65c7":"**Insight 2 : 1.Above plot indicates,Covid deaths started in week 12 of 2020,peaked to ~15000 in the week of 13.**\n\n**2.Also graph indicates drop in number of deaths from week 22-27 before fluctuates again..**\n\n**3.Week 39 has lowest number of deaths(~2000) at the end of the period..**","8e3c34ea":"**Insight 16: Above chart shows that there is a sudden drop in the shorter length of trips in the month of april compared to longer trips**","a7aa1a01":"**Query 2 Insight: Above query results indicates Feb 2020 had more number of trips**","75dbb037":"Analysis 12: Look at the trips dataset and findout the trips distribution?\n\nAssumption: As the deaths keep increasing we may notice a reduction in the number of trips","30ba7f7d":"### Combine the dataframes and run some queries","452f9343":"**Insight 8: We see highest death rate in new york which is having 6% popuation of USA.But calfornia is highest populated state has comparitively lower death rate**","14210d50":"Analysis 8: Find out population rate, covid death rates and look for the relationship?\n\nAssumption: Above analysis shows that there is no relation between covid deaths and population count.In this analysis,we assume there may be relation between the covid death rates and population rates of the USA states","17050cec":"**Insight 3 : As previous analysis indicated,april & may months indicated highest number of covid deaths. 07-April-2020,15-April-2020 are the two dates where we ahve more than 2500 covid deaths.Above plot also indicated covid deaths decreased drastically in jun,jul and august months**","93ef4b29":"**Data Set 2**: Covid death cases from Jan-2020 to Sep-2020 at different geo levels across the USA","472af070":"**Query 1 Insight : New york,Illinios and calfornia are the states having highest number of trips and covid death counts and are part of Top 5 states.Wyoming,Alaska and vermont had less number of trips and covid death counts and are part of bottom 5 states.**\n","7ec44092":"Analysis 3: Analyse the covid deaths by date and observe the trend..\n\nAssumption: Based on above anaysis,covid deaths may increase drastically day by day in april and may months. covid deaths may decrease drastically in july and august months","cd7fc591":"**Insight 9: The above graph shows that New York is having the highest number of deaths followed by New Jersey, Massachusetts and others.**","721bc6fa":"**Insight 10 : 1.More number of days in New York,New Jersey states are having high in the months of March,April and May.**\n","aa664671":"**Insight 1: Above plot indicates,there are no deaths in Feb and March but started increasing rapidly from month of april 2020 across USA**","b0d3e5ec":"Analysis 7: How covid deaths are related to population of states?\n\nAssumption: There may be a relation between covid deaths and population i.e states with high population may have higher deaths.","b3476281":"**Insight 17: Contrary to our assumption,Even though New York county is most densely populated and it only has 12% of deaths.Kings and Queens recorded highest deaths**","ec2b2bbf":"Analysis 10: What is the distribution of deaths in Top 5 states by month?\n\nAssumption:Most of the days in the of april have higher deaths.Also,most days in Jun,Jul and Aug have lower deaths.We assume that it is the case with Top states which are having highest deaths ","0432f201":"Insight 16: Comparison of trip length over period of 9 months\n\nAssumption: Irrespective of length of the trips,we assume that there will be a reduction in all types of trips.","13e1ab84":"**Data Set 1: ** The Trips by Distance data and number of people staying home and not staying home are estimated for the Bureau of Transportation Statistics by the Maryland Transportation Institute and Center for Advanced Transportation Technology Laboratory at the University of Maryland. The travel statistics are produced from an anonymized national panel of mobile device data from multiple sources. All data sources used in the creation of the metrics contain no personal information. Data analysis is conducted at the aggregate national, state, and county levels","5f3d9323":"**Query 1 : Find out top states which are having higher\/lower trips and covid deaths?**","51ac4a3d":"Analysis 20: Of the States with most number of trips (by total distance), how is the distribution across distance buckets.\n\nAssumption:We assume that longer trips count will reduce during covid","40db7fc8":"### Data Cleaning - df_trips_people_20 dataframe","b49b3ba5":"**Query 3 insight : Results shows that most number of people stayed home in the month of April 2020.**","239f8535":"**Query 3: Find out which month shows most number of people stayed at home?**","ceead5bf":"**Insight #20: From the above plot, its evident that during Covid time, across States, there were almost no long distance trips made by people. Most of the trips were within the 100 mile range.**","e2454ddf":"Analysis 15: Comparison across top 5 states on people who stayed at home vs who did not\n\nAssumption: We may assume that more number of people may stay at home because of government guidelines.","28f469ea":"**Insight 7: Contrary to the assumption, the above plot shows no relation between covid deaths and population of states.california is highly populated state but less number of deaths recorded in that state**","dd3f484a":"**Insight 15: Contrary to the assumption,We can see that in all the top 5 states the population count of  people who took trips are more than the people who actually stayed at home**","a28a287f":"Analysis 17: What is the distribution of deaths in the state of New York's Top 5 counties?\n\nAssumption: In the state of New York most densley populated county is New York.We assume that New York county will have highest number of deaths.","ade24984":"**Insight 18: The plot above shows that counties of Kings and Queens have the highest proportion of population not at home and hence the highest death rates (as seen from plot above).**\n**Another point to note is that the proportion of people who stayed at home vs who did not, is better in New York county resulting in lesser number of deaths.**","05660550":"# Conclusion & Insights\nIn conclusion, we performed detailed analysis of two key datasets: one with information on number of people staying at home vs on the move, while the other providing number of Covid related deaths by date. Both datasets centered around different counties across states in USA. \nThe reason for our selection of these two datasets was mainly to assess the impact of spread of Covid on people's mobility and monitor any trends as duration of the pandemic increases and extends to last quarter of 2020.\nFollowing key insights were inferred by our team:\n1. The states of New York, California and Illinois were among the highest for Covid related deaths, during the months of Jan thru Sep of 2020. They were also among the to 5 which had higher population of people on the move. \n2. The overall movement of people were drastically reduced as the number of Covid deaths spiked during the month of Mar and April of 2020. However, it can also be seen that for the second (less severe) spike, during months of July and August, people did not stay put and were relatively mobile.\n3.Further analysis showed that staying at home resulted in lesser covid deaths as seen in New York county\n4.Another interesting insight is that the number of shorter trips reduced drastically however this trend is not observed with trips ranging over 50 miles.\n5.The analysis also showed that there is no correlation between the population  and deaths across USA.","6ea02e61":"# Project Name : Impact of trips on Covid\n","2715fc85":"**Insight 11 : New York state had highest covid deaths till sep 2020.Bronx,Kings and Qeens counties of New York state are having higer covid death cases.**","38976b13":"Analysis 5: what is the covid deaths variability between the dates over the months?\n\nAssumption: The variability in the number of covid deaths may be lesss between the dates.","41bb9a96":"Analysis 6: How does the number of cases look like in US as of sept 2020\n\nAssumption : Covid deaths may be high where population is very high","0dcc3e83":"Analysis 14 : What is the trend of states which are having less covid deaths?\n\nAssumption: Simillar trend as seen in the above insights is expected in the states(bottom 10) which are having less number of covid deaths","1201f738":"Analysis 13: Look at the trend of trips for top 10 states?\n\nAssumption: Based on above insight,we may see reduction in the number of trips as the number of deaths increased even in the top 10 states","733d8149":"Analysis 1: create data frame to analyze trend of covid death cases by month?\n\nAssumption: Number of covid deaths may be increased drastically over the months.","0588d6ee":"Analysis 4: What is the distribution of covid deaths over the months?\n\nAssumption: Most of the days in the of april and may might have higher deaths.Also,most days in Jun,Jul and Aug might have lower deaths"}}