{"cell_type":{"bbac8eb1":"code","2fe99594":"code","187cfa36":"code","6a4ead68":"code","9a28408c":"code","90372559":"code","6d0e08b0":"code","d41b380a":"code","a9c052ae":"code","c4e57cbe":"code","cb954f38":"code","75a72e00":"code","954df18a":"code","76bdd8da":"code","35aa83f2":"code","37e05f02":"code","2c15ee06":"code","3f8d3ab7":"code","14b1afd1":"code","cbcdf055":"code","4e4b6330":"code","eeb1227e":"code","953402c5":"code","80303b75":"code","e0e88f9a":"code","7d857e93":"code","900f72b9":"code","70161554":"code","46e0abed":"code","aaf83f7a":"code","563a1913":"code","72971195":"code","3fe599d6":"code","02abf19f":"code","d6bddbdd":"code","c4e287cc":"code","37cd71ed":"code","a1dee241":"code","c972e8d7":"code","245dd2c1":"code","ee840a36":"code","8e7201af":"code","54508c46":"markdown","455f80c3":"markdown","08ba28d1":"markdown"},"source":{"bbac8eb1":"import pandas as pd\nimport numpy as np","2fe99594":"train = pd.read_csv('..\/input\/mobilityanalytics\/train_Wc8LBpr.csv')\ntest = pd.read_csv('..\/input\/mobilityanalytics\/test_VsU9xXK.csv')","187cfa36":"train.shape, test.shape","6a4ead68":"train.head()","9a28408c":"combine = train.append(test)\ncombine.shape","90372559":"combine.isnull().sum()","6d0e08b0":"combine.dtypes","d41b380a":"combine.columns","a9c052ae":"combine['Cancellation_Last_1Month'].value_counts()","c4e57cbe":"bins= [0, 1, 2, 3, 8]\nlabels = ['None','Once', 'Twice','More_Than_Thrice']\ncombine['Cancellation_Last_1Month'] = pd.cut(combine['Cancellation_Last_1Month'], bins=bins, labels=labels, right=False)\ncombine['Cancellation_Last_1Month'].value_counts()","cb954f38":"combine['Confidence_Life_Style_Index'].value_counts()","75a72e00":"combine['Confidence_Life_Style_Index'].fillna('Unknown', inplace=True)\ncombine['Confidence_Life_Style_Index'].value_counts()","954df18a":"combine['Customer_Rating'].describe()","76bdd8da":"combine['Customer_Since_Months'].value_counts()","35aa83f2":"from sklearn.preprocessing import scale\ncombine['Customer_Since_Months'].fillna(-1, inplace=True)\ncombine['Customer_Since_Months'] = scale(combine['Customer_Since_Months'])\ncombine['Customer_Since_Months'].describe()","37e05f02":"combine['Destination_Type'].value_counts()","2c15ee06":"combine['Gender'].value_counts()","3f8d3ab7":"combine['Life_Style_Index'].describe()","14b1afd1":"combine['Life_Style_Index'].fillna(combine['Life_Style_Index'].mean(), inplace=True)\ncombine['Life_Style_Index'].describe()","cbcdf055":"combine['Trip_Distance'].describe()","4e4b6330":"combine['Trip_Distance'] = np.log(combine['Trip_Distance'])\ncombine['Trip_Distance'].describe()","eeb1227e":"combine['Type_of_Cab'].value_counts()","953402c5":"combine['Type_of_Cab'].fillna('Unknown', inplace=True)\ncombine['Type_of_Cab'].value_counts()","80303b75":"combine['Var1'].describe()","e0e88f9a":"combine['Var1'].fillna(combine['Var1'].mean(), inplace=True)\ncombine['Var1'] = np.log(combine['Var1'])\ncombine['Var1'].describe()","7d857e93":"combine['Var2'].describe()","900f72b9":"combine['Var2'] = np.log(combine['Var2'])\ncombine['Var2'].describe()","70161554":"combine['Var3'].describe()","46e0abed":"combine['Var3'] = np.log(combine['Var3'])\ncombine['Var3'].describe()","aaf83f7a":"combine.isnull().sum()","563a1913":"combine = pd.get_dummies(combine.drop('Trip_ID', axis=1))\ncombine.shape","72971195":"combine.head()","3fe599d6":"X = combine[combine['Surge_Pricing_Type'].isnull()!=True].drop(['Surge_Pricing_Type'], axis=1)\ny = combine[combine['Surge_Pricing_Type'].isnull()!=True]['Surge_Pricing_Type']\n\nX_test = combine[combine['Surge_Pricing_Type'].isnull()==True].drop(['Surge_Pricing_Type'], axis=1)\n\nX.shape, y.shape, X_test.shape","02abf19f":"from sklearn.model_selection import train_test_split\nx_train, x_val, y_train, y_val = train_test_split(X, y, test_size=0.2)","d6bddbdd":"from lightgbm import LGBMClassifier\nmodel = LGBMClassifier(boosting_type='gbdt',\n                       max_depth=5,\n                       learning_rate=0.05,\n                       n_estimators=5000,\n                       min_child_weight=0.01,\n                       colsample_bytree=0.5,\n                       random_state=1994,\n                       objective='multiclass')\n\nmodel.fit(x_train,y_train,\n          eval_set=[(x_train,y_train),(x_val, y_val.values)],\n          early_stopping_rounds=100,\n          verbose=200)\n\npred_y = model.predict(x_val)","c4e287cc":"from sklearn.metrics import accuracy_score, confusion_matrix\nprint(accuracy_score(y_val, pred_y))\nconfusion_matrix(y_val,pred_y)","37cd71ed":"err = []\ny_pred_tot_lgm = []\n\nfrom sklearn.model_selection import StratifiedKFold\n\nfold = StratifiedKFold(n_splits=15, shuffle=True, random_state=2020)\ni = 1\nfor train_index, test_index in fold.split(X, y):\n    x_train, x_val = X.iloc[train_index], X.iloc[test_index]\n    y_train, y_val = y[train_index], y[test_index]\n    m = LGBMClassifier(boosting_type='gbdt',\n                       max_depth=5,\n                       learning_rate=0.05,\n                       n_estimators=5000,\n                       min_child_weight=0.01,\n                       colsample_bytree=0.5,\n                       random_state=1994,\n                       objective='multiclass')\n    m.fit(x_train, y_train,\n          eval_set=[(x_train,y_train),(x_val, y_val)],\n          early_stopping_rounds=200,\n          verbose=200)\n    pred_y = m.predict(x_val)\n    print(i, \" err_lgm: \", accuracy_score(y_val, pred_y))\n    err.append(accuracy_score(y_val, pred_y))\n    pred_test = m.predict(X_test)\n    i = i + 1\n    y_pred_tot_lgm.append(pred_test)","a1dee241":"np.mean(err, 0)","c972e8d7":"err[3]","245dd2c1":"submission = pd.DataFrame()\nsubmission['Trip_ID'] = test['Trip_ID']\nsubmission['Surge_Pricing_Type'] = y_pred_tot_lgm[3]\nsubmission.to_csv('LGBM.csv', index=False, header=True)\nsubmission.shape","ee840a36":"submission.head()","8e7201af":"submission['Surge_Pricing_Type'].value_counts()","54508c46":"# Problem Statement - Mobility Analytics","455f80c3":"Github Link: https:\/\/github.com\/bilalProgTech\/online-data-science-ml-challenges\/tree\/master\/AV-Janata-Hack-Mobility-Analytics","08ba28d1":"Welcome to Sigma Cab Private Limited - a cab aggregator service. Their customers can download their app on smartphones and book a cab from any where in the cities they operate in. They, in turn search for cabs from various service providers and provide the best option to their client across available options. They have been in operation for little less than a year now. During this period, they have captured surge_pricing_type from the service providers.\n\nYou have been hired by Sigma Cabs as a Data Scientist and have been asked to build a predictive model, which could help them in predicting the surge_pricing_type pro-actively. This would in turn help them in matching the right cabs with the right customers quickly and efficiently."}}