{"cell_type":{"25e6da77":"code","9dee75c4":"code","50d4b252":"code","649d535c":"code","78f410f3":"code","17c9a194":"code","24f5b527":"code","74a79599":"code","90cf0bd3":"code","88b6e76e":"code","fd3caf10":"code","a54bfd55":"code","21d9a949":"code","ad07348c":"code","c9828e31":"code","b4d66beb":"code","9cb98cfa":"code","4d3a3b70":"code","76e544f6":"code","70dadac2":"code","9b4ae65e":"code","5ecdefcd":"code","76a01804":"code","516bfc23":"code","7b3cf983":"code","f547bdab":"code","67385e23":"code","d172d9fd":"code","e901db82":"code","33d498cb":"code","37ad7c4e":"code","ce57aaa7":"code","749b6e5d":"code","116f3586":"code","2bca8464":"code","62e4b561":"code","79763052":"code","eab4d7df":"code","d2f52c98":"code","7b201477":"code","31e88434":"code","c6e2e2e4":"code","babeb8fc":"code","eeb01c0f":"code","e18fe140":"code","71918273":"code","8cdf26a7":"code","26f49df4":"code","190696a3":"code","e5ffed26":"code","b832373d":"code","9eb85dd2":"code","d60c4ce5":"code","4561cc38":"code","c9137b14":"code","fcad5177":"code","fbd67762":"code","6155f3c7":"code","382eebbe":"code","e37cd29c":"code","c77e68f8":"code","7818c01a":"code","b37aff13":"code","81ff3d29":"code","dc395a3e":"code","104a94a4":"code","b875d51f":"code","63b5337e":"code","44780348":"code","18a6cdf7":"code","a16e307b":"code","7f7e873b":"code","edcef947":"code","27f4f61e":"code","52d1bea2":"code","2bc39fc0":"code","b8fc65f5":"code","b9c81a64":"code","654dbffe":"code","ed0fdac2":"code","5361323c":"code","320ad341":"code","0582c128":"code","ed4a0c0a":"code","ec012c02":"code","7464fac2":"code","b189c3e7":"code","109745a4":"code","a6bae0b2":"code","366f62e5":"code","eb696b16":"code","648a4412":"code","42c7421c":"code","08dc5d3e":"code","d45f9ff5":"code","35fa7cca":"code","094e6917":"code","5367d0f0":"code","3ca9de4e":"code","ede3f0db":"code","6e5cf65d":"code","cc1d49e5":"code","915116c2":"code","eb9ba04f":"markdown","bfe824f4":"markdown","6fccad10":"markdown","26d56d4d":"markdown","5fb108ab":"markdown","08e3978a":"markdown","233b3b8d":"markdown","b841121a":"markdown","752d0435":"markdown","5bac8365":"markdown","c319389a":"markdown","61a583ad":"markdown","8aba2d67":"markdown","6dbb2810":"markdown","813b267c":"markdown","add09f96":"markdown","a47a8672":"markdown","374bc159":"markdown","1e92a86c":"markdown"},"source":{"25e6da77":"import numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nimport warnings\nwarnings.filterwarnings(\"ignore\")","9dee75c4":"df_car = pd.read_csv('Car_Price_Assignment\/CarPrice_Assignment.csv')","50d4b252":"df_car.head()","649d535c":"#Importing all other required libraries\n#  test train split\nfrom sklearn.model_selection import train_test_split\n#  feature scaling\nfrom sklearn.preprocessing import MinMaxScaler\n# statmodel linear regression\nimport statsmodels.api as sm\n# RFE and LinearRegression\nfrom sklearn.feature_selection import RFE\nfrom sklearn.linear_model import LinearRegression\n# Check for the VIF values  \nfrom statsmodels.stats.outliers_influence import variance_inflation_factor\n\nfrom sklearn.metrics import mean_squared_error\nfrom math import sqrt\n","78f410f3":"df_car.shape","17c9a194":"df_car.describe()","24f5b527":"df_car.info()","74a79599":"#Checking for Null vals\ndf_car.isnull().sum()","90cf0bd3":"#Seperating numeric vars\ndf_car_num = list(df_car.columns[df_car.dtypes != 'object'])","88b6e76e":"df_car_num","fd3caf10":"#Non-numeric vars\ndf_car_char = list(df_car.columns[df_car.dtypes == 'object'])","a54bfd55":"df_car_char","21d9a949":"len(df_car_num) + len(df_car_char)","ad07348c":"df_car.mean()","c9828e31":"#Dropping useless columns like car_ID\ndf_car.drop(columns='car_ID', inplace = True)","b4d66beb":"df_car.info()","9cb98cfa":"# Function for pair plots. Plot each numeric var with the target var price\ndef doPairPlots(df_car_numeric):\n\n    #plt.figure(figsize=(22, 22))\n    fig, axs = plt.subplots(1,len(df_car_numeric), figsize=(3*len(df_car_numeric),2.5), sharey=True)\n\n    for i, col_name in enumerate(df_car_numeric):\n        sns.scatterplot(data=df_car, x=col_name, y=\"price\", ax=axs[i])\n    fig.set_figheight(5)\n    fig.set_figwidth(20)\n    plt.tight_layout()\n    plt.show()\ndf_car_num1= ['wheelbase','carlength','carwidth','carheight']\ndf_car_num2= ['enginesize','curbweight','boreratio','stroke'] \ndf_car_num3= ['compressionratio','horsepower','peakrpm','citympg','highwaympg']","4d3a3b70":"doPairPlots(df_car_num1)","76e544f6":"doPairPlots(df_car_num2)","70dadac2":"doPairPlots(df_car_num3)","9b4ae65e":"plt.figure(figsize = (13, 10))\nsns.heatmap(df_car.corr(), annot = True)","5ecdefcd":"#Extracting company name from CarName\ndf_car['company'] = df_car['CarName'].apply(lambda x: x.split( )[0].lower())\ndf_car['company'].replace('maxda','mazda',inplace=True)\ndf_car['company'].replace('porcshce','porsche',inplace=True)\ndf_car['company'].replace('toyouta','toyota',inplace=True)\ndf_car['company'].replace(['vokswagen','vw'],'volkswagen',inplace=True)\ndf_car['company'].unique()","76a01804":"df_car['company'].nunique()","516bfc23":"#Given so many unique values, we should cut this number down by bucketing company names wrt price ranges. Let us divide them into economy, mid, and luxury\ndf_car.groupby('company')['price'].mean().sort_values(ascending = False)","7b3cf983":"company_buckets = {\n    'cheverolet' : 'economy',\n    'dodge' : 'economy',\n    'plymouth' : 'economy',\n    'honda' : 'economy',\n    'subaru' : 'economy',\n    'isuzu' : 'economy',\n    'mitsubishi' : 'economy',\n    'renault' : 'economy',\n    'toyota' : 'economy',\n    'volkswagen' : 'midSeg',\n    'nissan' : 'midSeg',\n    'mazda' : 'midSeg',\n    'saab' : 'midSeg',\n    'peugeot' : 'midSeg',\n    'alfa-romero' : 'midSeg',\n    'mercury' : 'luxury',\n    'audi' : 'luxury',\n    'volvo' : 'luxury',\n    'bmw' : 'luxury',\n    'buick' : 'luxury',\n    'porsche' : 'luxury',\n    'jaguar' : 'luxury',\n    }\ndf_car['company_segment'] = df_car['company'].map(company_buckets)","f547bdab":"df_car.shape","67385e23":"df_car_char = df_car_char[1:]\n# df_car_char.append('company_segment')","d172d9fd":"df","e901db82":"def plotCatVsPrice(catVars):\n\n    plt.figure(figsize=(25, 25))\n    for var in catVars:\n        plt.subplot(4,3,catVars.index(var)+1)\n        sns.boxplot(x = var, y = 'price', data = df_car_2)\n    plt.show()","33d498cb":"plotCatVsPrice(df_car_char)","37ad7c4e":"df_car_2 = df_car.drop(columns = ['company', 'CarName'])","ce57aaa7":"df_car_2.shape","749b6e5d":"df_car_char = list(df_car_2.columns[df_car_2.dtypes == 'object'])","116f3586":"df_car_char #This is the categorical variables list","2bca8464":"plotCatVsPrice(df_car_char)","62e4b561":"df_car_2['enginetype'].replace(['ohcf', 'ohc'], 'ohcv', inplace=True)\ndf_car_2['enginetype'].replace('dohcv', 'dohc', inplace=True)\ndf_car_2['fuelsystem'].replace('spfi','spdi', inplace = True)\ndf_car_2['fuelsystem'].replace('mfi','mpfi', inplace = True)\ndf_car_2['drivewheel'].replace(['4wd','fwd'], '4wd&fwd', inplace=True)\ndf_car_2['carbody'].replace(['sedan', 'wagon'], 'sedan&wagon', inplace=True)","79763052":"plotCatVsPrice(df_car_char)","eab4d7df":"df_car_2['enginetype'].replace(['l', 'dohc'], 'dohc&l', inplace = True)\ndf_car_2['fuelsystem'].replace(['1bbl', '2bbl'], '1&2bbl', inplace=True)","d2f52c98":"plotCatVsPrice(df_car_char)","7b201477":"df_car_2.drop(['fueltype','doornumber', 'aspiration'], axis=1, inplace=True)","31e88434":"df_car_char = list(df_car_2.columns[df_car_2.dtypes == 'object'])","c6e2e2e4":"plotCatVsPrice(df_car_char)","babeb8fc":"df_car_2.columns","eeb01c0f":"#Now mapping some categorical variables to numeric values\ndf_car_2['enginelocation'] = df_car_2['enginelocation'].map({'front': 1, 'rear': 0})","e18fe140":"df_car_2.shape","71918273":"#Dummy variable assignment\ndf_car_dummies = pd.get_dummies(df_car_2) ","8cdf26a7":"df_car_dummies.head()","26f49df4":"# features to scale - Only numeric, non binary vars\nfeatures_to_normalize = ['symboling',  'enginesize', 'boreratio', 'stroke', 'compressionratio','horsepower'\n                         , 'peakrpm',  'price','curbweight','wheelbase','highwaympg'\n                         , 'carlength','carwidth','carheight','citympg' ]","190696a3":"np.random.seed(42)\ndf_train, df_test = train_test_split(df_car_dummies, train_size=0.7 ,test_size = 0.3, random_state=42)","e5ffed26":"df_train.shape","b832373d":"df_test.shape","9eb85dd2":"#Instantiating scaling object for values\nscaler = MinMaxScaler()","d60c4ce5":"df_train[features_to_normalize] = scaler.fit_transform(df_train[features_to_normalize])","4561cc38":"df_train.info()","c9137b14":"df_train.describe()","fcad5177":"# divide training data into X and y\ny_train = df_train.pop('price')\nX_train = df_train","fbd67762":"X_train.shape","6155f3c7":"y_train.shape","382eebbe":"y_train","e37cd29c":"#Creating VIF function\ndef calculateVIFFactors(df):\n    \n    df_VIF = pd.DataFrame()\n    df_VIF['variables'] = df.columns\n    df_VIF['calculated_VIF'] = [variance_inflation_factor(df.values, i) for i in range(df.shape[1])]\n    df_VIF['calculated_VIF'] = round(df_VIF['calculated_VIF'],2)\n    df_VIF = df_VIF.sort_values(by = \"calculated_VIF\", ascending = False)\n    return(df_VIF)","c77e68f8":"# function to simplify fitting the model and print summary\n\ndef fit_LRM(X_train):\n    \n    import statsmodels.api as sm\n\n    X_train = sm.add_constant(X_train)\n    model = sm.OLS(y_train,X_train).fit() \n    print(model.summary())\n    return model","7818c01a":"X_train = X_train.astype(float)\nX_train_1 = sm.add_constant(X_train)\nmodel = sm.OLS(y_train,X_train, missing='drop').fit()","b37aff13":"print(model.summary())","81ff3d29":"# drop carlength as it has highest p-value               \nX_train_2 = X_train_1.drop(['carlength'], axis=1)\nmodel2 =fit_LRM(X_train_2) # second model","dc395a3e":"X_train_3 = X_train_2.drop(['boreratio','stroke', 'compressionratio', 'peakrpm', 'carheight',\n            'cylindernumber_three', 'cylindernumber_twelve', 'highwaympg'], axis = 1)","104a94a4":"model3 = fit_LRM(X_train_3)","b875d51f":"X_train_4 = X_train_3.drop('cylindernumber_six', axis=1)","63b5337e":"model4 = fit_LRM(X_train_4)","44780348":"#Removing fuelsystem_4bbl for high p-value\nX_train_5 = X_train_4.drop('fuelsystem_4bbl', axis=1)","18a6cdf7":"model5 = fit_LRM(X_train_5)","a16e307b":"X_train_6 = X_train_5.drop(['company_segment_economy', 'symboling'], axis=1)","7f7e873b":"model6 = fit_LRM(X_train_6)","edcef947":"X_train_7 = X_train_6.drop(['wheelbase','citympg', 'fuelsystem_1&2bbl'], axis=1)","27f4f61e":"model7 = fit_LRM(X_train_7)","52d1bea2":"X_train_8 = X_train_7.drop(['fuelsystem_mpfi', 'cylindernumber_five', 'carbody_sedan&wagon'], axis=1)","2bc39fc0":"model8 = fit_LRM(X_train_8)","b8fc65f5":"X_train_9 = X_train_8.drop(['carwidth', 'carbody_hatchback', 'enginetype_ohcv'], axis=1)","b9c81a64":"model9 = fit_LRM(X_train_9)","654dbffe":"X_train_10 = X_train_9.drop(['fuelsystem_spdi', 'drivewheel_rwd', 'enginetype_dohc&l'], axis=1)","ed0fdac2":"model10 = fit_LRM(X_train_10)","5361323c":"X_train_11 = X_train_10.drop(['drivewheel_4wd&fwd', 'fuelsystem_idi', 'cylindernumber_four'], axis=1)","320ad341":"model11 = fit_LRM(X_train_11)","0582c128":"X_train_12 = X_train_11.drop('carbody_hardtop', axis = 1)","ed4a0c0a":"model12 = fit_LRM(X_train_12)","ec012c02":"calculateVIFFactors(X_train_12)","7464fac2":"#We cannot drop enginesize, so we drop enginelocation instead\nX_train_13 = X_train_12.drop(['enginelocation', 'cylindernumber_two'], axis=1)","b189c3e7":"model13 = fit_LRM(X_train_13)","109745a4":"calculateVIFFactors(X_train_13)","a6bae0b2":"X_train_final = sm.add_constant(X_train_13)","366f62e5":"model_final = sm.OLS(y_train,X_train_final).fit() # final model  ","eb696b16":"X_train_final.shape","648a4412":"y_train.shape","42c7421c":"y_pred = model_final.predict(X_train_final)","08dc5d3e":"y_pred.shape","d45f9ff5":"# Plot error terms for train data\nfig = plt.figure(figsize = (10,8))\nsns.distplot((y_train - y_pred), bins = 20)\nfig.suptitle('Error Terms', fontsize = 20)                   \nplt.xlabel('Errors', fontsize = 18)    ","35fa7cca":"# predictions with test data\ndf_test[features_to_normalize] = scaler.transform(df_test[features_to_normalize])","094e6917":"df_test.describe()","5367d0f0":"# seperating X_test and y_test\ny_test = df_test.pop('price')\nX_test = df_test ","3ca9de4e":"X_train_13 = X_train_13.drop('const',axis=1)\nX_test_final = X_test[X_train_13.columns]","ede3f0db":"X_test_final = sm.add_constant(X_test_final)","6e5cf65d":"y_pred_I = model_final.predict(X_test_final)","cc1d49e5":"# Plot error terms for test data\nfig = plt.figure(figsize = (10,8))\nsns.distplot((y_test - y_pred_I), bins = 20)\nfig.suptitle('Error Terms in Test Data', fontsize = 20)                   \nplt.xlabel('Errors', fontsize = 18)  ","915116c2":"rmse = sqrt(mean_squared_error(y_test, y_pred_I))\nprint('Model RMSE:',rmse)\n\nfrom sklearn.metrics import r2_score\nr2=r2_score(y_test, y_pred_I)\nprint('Model test r2_score:',r2)","eb9ba04f":"As is visible now, l and dohc engine types are nearly the same. 1bbl and 2bbl fuelsystems are also nearly the same.","bfe824f4":"Let us drop cylindernumber_six as it has pvalue of 1","6fccad10":"horsepower is linear with price, and citympg\/highwaympg are negatively linear with price","26d56d4d":"Features selected in final model:\n\n1) curbweight\n2) enginesize\n3) horsepower\n4) company_segment_luxury\n5) cylindernumber_eight\n6) company_segment_midSeg\n7) enginetype_rotor\n8) carbody_convertible\t\n\nR sq. Train: 0.918\nAdj R sq. in Train: 0.913\nR sq. in Test: 0.86","5fb108ab":"enginesize, curbweight are almost linear with price","08e3978a":"# checking the relationship of all predictor vars with target var, price:","233b3b8d":"Let us drop fueltype, doornumber, and aspiration ","b841121a":"Removing company segment economy and symboling for p-value:","752d0435":"# As the R2 test value lies within 5% of the R2 value for train, it is acceptable","5bac8365":"As you can see, fueltype, aspiration, and doornumber don't make a significant difference to price. 4wd and fwd performw nearly the same wrt price, while sedan and wagon are also fairly similar. You will notice there are some mispellings present, let us clean this data further.","c319389a":"We cannot drop horsepower as it is very important, seeing as other values are lesser than .05 we move on to VIF","61a583ad":"Given that we have too many variables, let us drop a few and try again","8aba2d67":"# Examining the heatmap","6dbb2810":"Features have been scaled","813b267c":"As we can see, the most significant categorical variables to price are cylindernumber, company_segment, enginelocation, drivewheel, and carbody.","add09f96":"carlen and carwid are nearly linear with price","a47a8672":"Now let us plot all categorical variables against price","374bc159":"Just checking shape to see if correct","1e92a86c":"We see that there are many pairs that have high correlation. Also, some variables like symboling and peakrpm show very little linear correlation with price."}}