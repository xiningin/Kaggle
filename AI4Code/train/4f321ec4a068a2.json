{"cell_type":{"c568d441":"code","6dc4b115":"code","816229ce":"code","1066bcdf":"code","b9aa95e0":"code","7211a56f":"code","c9e2658d":"code","891e60a4":"code","404d940b":"code","bfd2f36f":"code","0ecfee80":"code","4551b2f0":"code","467450b5":"code","8978606a":"markdown","9add64d0":"markdown","d201997b":"markdown","a05bc7d8":"markdown","d4e6fa03":"markdown","16ce1aa1":"markdown","f06360fd":"markdown","a608991b":"markdown"},"source":{"c568d441":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly.express as px\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots","6dc4b115":"%%time\ndf = pd.read_csv(\"..\/input\/jane-street-market-prediction\/train.csv\")","816229ce":"test_df= pd.read_csv(\"..\/input\/jane-street-market-prediction\/example_test.csv\")","1066bcdf":"sample_prediction_df= pd.read_csv(\"..\/input\/jane-street-market-prediction\/example_sample_submission.csv\")","b9aa95e0":"df2 = pd.read_csv(\"..\/input\/jane-street-market-prediction\/features.csv\")","7211a56f":"%%time\nCOLS = df.iloc[:,7:10].columns\nfor f in COLS:\n    fig, axs = plt.subplots(1, 4, figsize=(15, 4))\n    sns.distplot(df[f], ax=axs[0])\n    sns.distplot(df.query('weight > 0')[f], ax=axs[1])\n    try:\n        sns.distplot(df.query('weight > 0 and resp > 0')[f].dropna().apply(np.log1p), ax=axs[2])\n        sns.distplot(df.query('weight > 0 and resp < 0')[f].dropna().apply(np.log1p), ax=axs[2])\n    except:\n        pass\n    df.sample(5000).plot(kind='scatter', x=f, y='resp', ax=axs[3])\n    fig.suptitle(f, fontsize=15, y=1.1)\n    \n    axs[0].set_title('feature distribution')\n    axs[1].set_title('only weight > 0')\n    axs[2].set_title('log transform')\n    axs[3].set_title('feature vs. response')\n    \n    plt.tight_layout()\n    plt.show()","c9e2658d":"# #UPVOTE\n# #HOW TO RUN THIS BLOCK \n# #PRESS CTRL + A\n# #PRESS CTRL + ? \n# # SHIFT + ENTER.\n# ####################################\n# # IMPORTING LIBRARIES\n# from sklearn import preprocessing\n# import xgboost as xgb\n# ####################################\n# # HANDLING DATA\n# ############################################################################\n# df = df[df['weight'] != 0]\n# df['action'] = ((df['weight'].values * df['resp'].values) > 0).astype('int')\n# X_train = df.loc[:, df.columns.str.contains('feature')]\n# y_train = df.loc[:, 'action']\n# X_train = X_train.fillna(-999)\n# ############################################################################\n# #PARAMETERS\n# #########################\n# clf = xgb.XGBClassifier(\n#     n_estimators=480,\n#     max_depth=10,\n#     learning_rate=0.05,\n#     subsample=0.9,\n#     colsample_bytree=0.7,\n#     missing=-999,\n#     random_state=2020,\n#     tree_method='gpu_hist'\n# )\n# #########################\n# # FIT UNDER 1 MIN\n# #########################\n# clf.fit(X_train, y_train)\n# #########################\n# # SUBMISSION\n# ####################################################################\n# for (test_df, sample_prediction_df) in iter_test:\n#     X_test = test_df.loc[:, test_df.columns.str.contains('feature')]\n#     X_test.fillna(-999)\n#     y_preds = clf.predict(X_test)\n#     sample_prediction_df.action = y_preds\n#     env.predict(sample_prediction_df)\n# ####################################################################","891e60a4":"# #UPVOTE\n# #HOW TO RUN THIS BLOCK \n# #PRESS CTRL + A\n# #PRESS CTRL + ? \n# # SHIFT + ENTER.\n# ##############################\n# # IMPORTING LIBRARY\n# import numpy as np\n# import pandas as pd\n# from sklearn import preprocessing\n# import xgboost as xgb\n# import lightgbm as lgb\n# from sklearn import *\n# #################################\n# # MAKING ENVIRONMENT\n# ###########################\n# import janestreet\n# env = janestreet.make_env()\n# iter_test = env.iter_test()\n# ############################\n# # READING DATA\n# #######################################################################################\n# train = pd.read_csv('..\/input\/jane-street-market-prediction\/train.csv')\n# features = pd.read_csv('..\/input\/jane-street-market-prediction\/features.csv')\n# test= pd.read_csv(\"..\/input\/jane-street-market-prediction\/example_test.csv\")\n# sub= pd.read_csv(\"..\/input\/jane-street-market-prediction\/example_sample_submission.csv\")\n# #######################################################################################\n# # HANDLING DATA\n# ###################################################################################################################################\n# col = [c for c in train.columns if c not in ['resp_1', 'resp_2', 'resp_3', 'weight', 'resp_4', 'resp', 'ts_id', 'date', 'action']]\n# train['action'] = (train['resp'].values > 0).astype('int')\n# train = train.fillna(-999)\n# ####################################################################################################################################\n# #PARAMETERS\n# ############################################\n# params = { \n#             'nthread':4,\n#             'n_estimators':1,\n#             'device' : 'gpu',\n#             'learning_rate': 0.05,\n#             'num_leaves': 34,\n#             'colsample_bytree':0.9497036,\n#             'subsample': 0.8715623,\n#             'max_depth':8,\n#             'min_child_weight':39.3259775\n#  }\n# ############################################\n# # FIT UNDER 1 MIN\n# ################################################################################################################\n# x1, x2, y1, y2 = model_selection.train_test_split(train[col], train['action'], test_size=0.2, random_state=20)\n# model = lgb.train(params, lgb.Dataset(x1, y1), 250,  lgb.Dataset(x2, y2), verbose_eval=100)\n# ################################################################################################################\n# #SUBMITTING FILE\n# #######################################################################\n# for (test, sub) in iter_test:\n#     X_test = test.loc[:, test.columns.str.contains('feature')]\n#     X_test.fillna(X_test.mean())\n#     y_preds = model.predict(X_test, num_iteration=model.best_iteration)\n#     sub.action = y_preds\n#     sub.action = (sub.action.values > 0.5).astype('int')\n#     env.predict(sub)\n# #######################################################################","404d940b":"import pandas as pd\nimport numpy as np\nimport dask.dataframe as dd\nimport pyarrow","bfd2f36f":"from dask.distributed import Client, progress\nclient = Client(n_workers=4, memory_limit='4GB')\nclient","0ecfee80":"df.to_parquet('output.parquet')","4551b2f0":"%%time\ndata = dd.read_parquet('.\/output.parquet', engine='pyarrow')","467450b5":"data","8978606a":"# DASK DATAFRAME","9add64d0":"# EDA","d201997b":"# CONCLUSION","a05bc7d8":"# HAPPY CODING","d4e6fa03":"# LIGHTGBM","16ce1aa1":"# DO UPVOTE THE KERNEL IF YOU LIKE IT.\n# CHECK OUT MY OTHER WORK TOO.","f06360fd":"**This concludes your starter analysis! To go forward from here, click the blue \"Fork Notebook\" button at the top of this kernel. This will create a copy of the code and environment for you to edit. Delete, modify, and add code as you please. Happy Kaggling!**","a608991b":"# XGBCLASSIFIER"}}