{"cell_type":{"31ffe4d5":"code","083ab5fc":"code","2ea1c49a":"code","a7484e20":"code","0638a8d8":"code","69ddfea3":"code","b87202fd":"code","0babf6ff":"code","8600c0ba":"code","457a132c":"code","de9d8754":"code","5338c278":"code","0c3399bd":"code","d2a45f0d":"code","c4b3435e":"code","94a92162":"code","08ad756b":"code","6a7bcfce":"code","126e8c48":"code","e6237879":"markdown","d656fbca":"markdown","80b742a9":"markdown","603699e1":"markdown","9916b478":"markdown"},"source":{"31ffe4d5":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\nfrom pulp import * # Python package for Linear Programming\nimport re\nimport ast\n\nimport warnings\nwarnings.filterwarnings('ignore')\n# Any results you write to the current directory are saved as output.","083ab5fc":"df = pd.read_csv('..\/input\/FPL_2018_19_Wk0.csv')\ndf = df[df['Points']>50] # For a first pass, only pick the players who scored >50 points last season\ndf.reset_index(inplace=True,drop=True)\ndf.head()","2ea1c49a":"df.shape","a7484e20":"# Create the decision variables.. all the players (so 371 for this initial try)\ndef create_dec_var(df):\n    decision_variables = []\n    \n    for rownum, row in df.iterrows():\n        variable = str('x' + str(rownum))\n        variable = pulp.LpVariable(str(variable), lowBound = 0, upBound = 1, cat= 'Integer')\n        decision_variables.append(variable)\n                                  \n    return decision_variables\n\n# This is what we want to maximize (objective function)\ndef total_points(df,lst,prob):\n    total_points = \"\"\n    for rownum, row in df.iterrows():\n        for i, player in enumerate(lst):\n            if rownum == i:\n                formula = row['Points']*player\n                total_points += formula\n\n    prob += total_points\n    \n    return prob\n\n# Add constraint for cash\ndef cash(df,lst,prob,avail_cash):\n    total_paid = \"\"\n    for rownum, row in df.iterrows():\n        for i, player in enumerate(lst):\n            if rownum == i:\n                formula = row['Cost']*player\n                total_paid += formula\n    prob += (total_paid <= avail_cash), \"Cash\"\n    \n    return prob\n\n# Add constraint for number of goalkeepers\ndef team_gkp(df,lst,prob,avail_gk):\n    total_gk = \"\"\n    for rownum, row in df.iterrows():\n        for i, player in enumerate(lst):\n            if rownum == i:\n                if row['Position'] == 'GKP':\n                    formula = 1*player\n                    total_gk += formula\n\n    prob += (total_gk == avail_gk), \"GK\"\n    \n    return prob\n\n# Add constraint for number of defenders\ndef team_def(df,lst,prob,avail_def):\n    total_def = \"\"\n    for rownum, row in df.iterrows():\n        for i, player in enumerate(lst):\n            if rownum == i:\n                if row['Position'] == 'DEF':\n                    formula = 1*player\n                    total_def += formula\n\n    prob += (total_def == avail_def), \"DEF\"\n    \n    return prob\n\n# Add constraint for number of midfielders\ndef team_mid(df,lst,prob,avail_mid):\n    total_mid = \"\"\n    for rownum, row in df.iterrows():\n        for i, player in enumerate(lst):\n            if rownum == i:\n                if row['Position'] == 'MID':\n                    formula = 1*player\n                    total_mid += formula\n\n    prob += (total_mid == avail_mid), \"MID\"\n    \n    return prob\n\n# Add constraint for number of forwards\ndef team_fwd(df,lst,prob,avail_fwd):\n    total_fwd = \"\"\n    for rownum, row in df.iterrows():\n        for i, player in enumerate(lst):\n            if rownum == i:\n                if row['Position'] == 'FWD':\n                    formula = 1*player\n                    total_fwd += formula\n\n    prob += (total_fwd == avail_fwd), \"FWD\"\n    \n    return prob","0638a8d8":"# Assemble the whole problem data\ndef find_prob(df,ca,gk,de,mi,fw):\n    \n    prob = pulp.LpProblem('FantasyTeam', pulp.LpMaximize)\n    lst = create_dec_var(df)\n    \n    prob = total_points(df,lst,prob)\n    prob = cash(df,lst,prob,ca)\n    prob = team_gkp(df,lst,prob,gk)\n    prob = team_def(df,lst,prob,de)\n    prob = team_mid(df,lst,prob,mi)\n    prob = team_fwd(df,lst,prob,fw)\n    \n    return prob","69ddfea3":"# Solve the problem\ndef LP_optimize(df, prob):\n    prob.writeLP('FantasyTeam.lp')\n    \n    optimization_result = prob.solve()\n    assert optimization_result == pulp.LpStatusOptimal\n\n#     print(\"Status:\", LpStatus[prob.status])\n#     print(\"Optimal value:\", pulp.value(prob.objective))","b87202fd":"# Find the optimal team\ndef df_decision(df,prob):\n    variable_name = []\n    variable_value = []\n\n    for v in prob.variables():\n        variable_name.append(v.name)\n        variable_value.append(v.varValue)\n\n    df_vals = pd.DataFrame({'variable': variable_name, 'value': variable_value})\n    for rownum, row in df_vals.iterrows():\n        value = re.findall(r'(\\d+)', row['variable'])\n        df_vals.loc[rownum, 'variable'] = int(value[0])\n\n    df_vals = df_vals.sort_index(by='variable')\n\n    #append results\n    for rownum, row in df.iterrows():\n        for results_rownum, results_row in df_vals.iterrows():\n            if rownum == results_row['variable']:\n                df.loc[rownum, 'Decision'] = results_row['value']\n\n    return df","0babf6ff":"prob = find_prob(df,1000,2,5,5,3)\nLP_optimize(df,prob)","8600c0ba":"df_final = df_decision(df,prob)\nprint(df_final[df_final['Decision']==1.0].Cost.sum(), df_final[df_final['Decision']==1.0].Points.sum())","457a132c":"# The final 15\ndf_final[df_final['Decision']==1.0]","de9d8754":"prob343 = find_prob(df,830,1,3,4,3)\nprob352 = find_prob(df,830,1,3,5,2)\nprob433 = find_prob(df,830,1,4,3,3)\nprob442 = find_prob(df,830,1,4,4,2)\nprob451 = find_prob(df,830,1,4,5,1)\nprob532 = find_prob(df,830,1,5,3,2)\nprob541 = find_prob(df,830,1,5,4,1)","5338c278":"def prob_formations(df,prob):\n    LP_optimize(df,prob)\n    df_final = df_decision(df,prob)\n    \n    print(df_final[df_final['Decision']==1.0]['Points'].sum())\n    \n    return(df_final[df_final['Decision']==1.0])","0c3399bd":"# 1. 3-4-3\nprob_formations(df,prob343)","d2a45f0d":"# 2. 3-5-2\nprob_formations(df,prob352)","c4b3435e":"# 3. 4-3-3\nprob_formations(df,prob433)","94a92162":"# 4. 4-4-2\nprob_formations(df,prob442)","08ad756b":"# 5. 4-5-1\nprob_formations(df,prob451)","6a7bcfce":"# 6. 5-3-2\nprob_formations(df,prob532)","126e8c48":"# 7. 5-4-1\nprob_formations(df,prob541)","e6237879":"### Now to see which formation maximizes the points earned by the starting XI.. Looking at the roster for the current season, the minimum price for a GK and a DEF are 40 each, and 45 for MID and FWD respectively. That means the maximum Cash we can use to pick a starting XI is 830. ","d656fbca":"## So we see that, given Mo Salah's classification as a Midfielder, it makes the most sense to stack your defence or midfield (4-5-1 or 5-4-1) to get the maximum points tally in a given Gameweek. I'll add more analysis (and definitely visualizations) over time. ","80b742a9":"## First we want to see how it does for picking all 15 players on the team, with a maximum possible budget of 1000 (2 GK, 5 DEF, 5 FWD, 3 FWD)","603699e1":"## 7 possible formations::\n1. 3-4-3\n2. 3-5-2\n3. 4-3-3\n4. 4-4-2\n5. 4-5-1\n6. 5-3-2\n7. 5-4-1","9916b478":"## Linear Programming optimization for the best team to pick from the dataset, given a budget and other player position based constraints. We want to maximize the points earned by this configuration. Note that we don't really use the features yet, but once more data becomes available when the Premier League starts, and the API data gets updated for each gameweek, then we can start predictive modeling.\n\n## The idea for this comes from this wonderful blog post http:\/\/www.philipkalinda.com\/ds9.html. I'll keep adding to it, but this is the core idea and application."}}