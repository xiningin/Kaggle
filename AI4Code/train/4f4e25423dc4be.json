{"cell_type":{"9c13975f":"code","a396b285":"code","87cde404":"code","7df29cae":"code","1fdbcf50":"code","9ba76025":"code","82f2e25d":"code","0a418b9b":"code","fb413ba7":"code","ee37b568":"code","25a885d5":"code","71aca5dd":"code","09075e83":"code","00917335":"markdown","9dd653f7":"markdown","14fafa91":"markdown","95e44f45":"markdown","073aebab":"markdown","f6d1abad":"markdown","f5a73bfd":"markdown","7e2a730b":"markdown","b890f947":"markdown","730412f1":"markdown","4e272ef8":"markdown","2703ab82":"markdown","f86a13bf":"markdown","c7615631":"markdown","fea316dd":"markdown","e45e4821":"markdown"},"source":{"9c13975f":"import pandas as pd\nimport numpy as np\n\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport matplotlib.gridspec as gridspec\n\nimport matplotlib.font_manager as fm\nfont = fm.FontProperties(fname='..\/input\/staatfont\/Staatliches-Regular.ttf')\n\ntrain = pd.read_csv('..\/input\/tabular-playground-series-jul-2021\/train.csv')","a396b285":"train.head(5)","87cde404":"train = train.drop('date_time',axis=1)\ntrain.head()","7df29cae":"X_train = train[['deg_C','relative_humidity','absolute_humidity',\n          'sensor_1','sensor_2','sensor_3','sensor_4','sensor_5']]\ny_train = train[['target_carbon_monoxide','target_benzene','target_nitrogen_oxides']]\n\nfrom sklearn.preprocessing import MinMaxScaler\nscaler = MinMaxScaler()\nX_train = scaler.fit_transform(X_train)\n\nprint('After Data Processing Data Shape : ',X_train.shape, y_train.shape)","1fdbcf50":"from keras import layers, models\nimport tensorflow as tf\n\nmodel = models.Sequential()\nmodel.add(layers.Dense(6, input_shape=X_train.shape, activation='relu'))\nmodel.add(layers.Dense(3))\nmodel.compile(loss = tf.keras.losses.MeanSquaredLogarithmicError(), optimizer='adam')\nmodel.summary()","9ba76025":"history = model.fit(X_train,y_train,epochs=500, batch_size=256, validation_split=0.3,verbose=0)","82f2e25d":"fig = plt.figure(figsize=(13,8))\nplt.plot(history.history['loss'],label='loss')\nplt.plot(history.history['val_loss'],marker='o',label='val_loss' )\nplt.legend(fontsize =15)\nplt.title('Model fit result',font=font, fontsize=20)\nplt.show()","0a418b9b":"weight = model.get_weights()\nlayer1 = pd.DataFrame([list(range(1,9,1)),np.ones((8))]).T\nlayer2 = pd.DataFrame([list(range(2,8,1)),np.ones((6))]).T\nlayer3 = pd.DataFrame([list(range(4,7,1)),np.ones((3))]).T\nlayer2[1] = layer2[1]*2\nlayer3[1] = 3\npoint = pd.concat([layer1,layer2,layer3]).reset_index(drop=True)\npoint.columns = ['y', 'x']\n\nprint(\"weight value shape : \",model.get_weights()[0].shape, model.get_weights()[2].shape)\nprint(\"bias value shape : \", model.get_weights()[1].shape, model.get_weights()[3].shape)","fb413ba7":"col = train.columns\n\nfig = plt.figure(figsize=(20,13))\nax = fig.add_subplot(111)\nplt.scatter( x= point['x'],y=point['y'], s=400,color='black')\n\nweight_i = 0\nweight_j =0\nfor i in range(1,9):\n    weight_j =0\n    for j in range(2,8):\n        tmp = pd.DataFrame({'x':[1,2], 'y': [i,j]})\n        we = weight[0][weight_i][weight_j]\n        bias = weight[1][weight_j]\/8\n        value = we + bias\n        if value >= 0:\n            color = 'green'\n        else:\n            color = 'red'\n        sns.lineplot(x=tmp['x'],y=tmp['y'],ci=None,lw=np.abs(we),color=color)\n        weight_j = weight_j+1\n    weight_i = weight_i+1\n    \nweight_i = 0\nweight_j =0\nfor i in range(2,8):\n    weight_j =0\n    for j in range(4,7):\n        tmp = pd.DataFrame({'x':[2,3], 'y': [i,j]})\n        we = weight[2][weight_i][weight_j]\n        bias = weight[3][weight_j]\/6\n        value = we + bias\n        if value >= 0:\n            color = 'green'\n        else:\n            color = 'red'\n        sns.lineplot(x=tmp['x'],y=tmp['y'],lw=np.abs(we),ci=None,color=color)\n        weight_j = weight_j+1\n    weight_i = weight_i+1\n        \nplt.axis('off')\nplt.text(s='Input_layer', x=1,y=9,font = font, fontsize=25,va='center',ha='center')\nplt.text(s='hidden_layer', x=2,y=9,font = font,fontsize=25,va='center',ha='center')\nplt.text(s='out_layer', x=3,y=9,font = font,fontsize=25,va='center',ha='center')\nplt.text(s='DNN - Not consider Activation function', x=0.9,y=10,va='center',ha='left',font = font,fontsize=50)\n\nfor i in range(len(X_train[0])):\n    s = col[i]\n    plt.text(s = s, x =0.9, y = i+1,font=font, fontsize=18,va='center',ha='right')\nfor i in range(len(col[8:])):\n    s=col[i+8]\n    plt.text(s = s, x =3.1, y = i+4,font=font, fontsize=18,va='center',ha='left')\n    \nplt.text(s='Consider Relu', x=2,y=8,font = font,fontsize=18,va='center',ha='center')\n\nax.axvspan(1.8, 2.2, fc=\"gray\", alpha=0.2)\n\nplt.show()","ee37b568":"col = train.columns\nindex = 0\n\nfig = plt.figure(figsize=(20,13))\nax = fig.add_subplot(111)\nplt.scatter( x= point['x'],y=point['y'], s=400,color='black')\n\nweight_i = 0\nweight_j =0\nfor i in range(1,9):\n    weight_j =0\n    for j in range(2,8):\n        tmp = pd.DataFrame({'x':[1,2], 'y': [i,j]})\n        we = weight[0][weight_i][weight_j]\n        bias = weight[1][weight_j]\/8\n        value = we + bias\n        if value >= 0:\n            color = 'green'\n        else:\n            color = 'red'\n        sns.lineplot(x=tmp['x'],y=tmp['y'],ci=None,lw=np.abs(we),color=color)\n        weight_j = weight_j+1\n    weight_i = weight_i+1\n    \nweight_i = 0\nweight_j =0\nfor i in range(2,8):\n    weight_j =0\n    for j in range(4,7):\n        tmp = pd.DataFrame({'x':[2,3], 'y': [i,j]})\n        we = weight[2][weight_i][weight_j]\n        bias = weight[3][weight_j]\/6\n        value = we + bias\n        if value >= 0:\n            color = 'green'\n        else:\n            color = 'red'\n        sns.lineplot(x=tmp['x'],y=tmp['y'],lw=np.abs(we),ci=None,color=color)\n        weight_j = weight_j+1\n    weight_i = weight_i+1\n        \nplt.axis('off')\nplt.text(s='Input_layer', x=1,y=9,font = font, fontsize=25,va='center',ha='center')\nplt.text(s='hidden_layer', x=2,y=9,font = font,fontsize=25,va='center',ha='center')\nplt.text(s='out_layer', x=3,y=9,font = font,fontsize=25,va='center',ha='center')\nplt.text(s='Example : X_train[0]', x=0.9,y=10,va='center',ha='left',font = font,fontsize=50)\n\nfor i in range(len(col[:8])):\n    s = col[i]\n    plt.text(s = s, x =0.9, y = i+1,font=font, fontsize=18,va='center',ha='right')\n    value = round(X_train[index][i],4)\n    plt.text(s =value, x=0.9, y=i+0.7,font=font, fontsize=18,va='center',ha='right')\n    \nfor i in range(len(col[8:])):\n    s=col[i+8]\n    plt.text(s = s, x =3.1, y = i+4,font=font, fontsize=18,va='center',ha='left')\n    \ntmp_arr = []\nfor i in range(0,6):\n    value = 0\n    for j in range(0,8):\n        value = value + X_train[index][j] * weight[0][j][i] + weight[1][i]\/8\n    tmp_arr.append(value)\n    value =round(value,4)\n    if value>0:\n        plt.text(s = value, x=1.9,y=i+2, font=font, fontsize=18,va='center',ha='center')\n        plt.text(s = value, x=2.1,y=i+2, font=font, fontsize=18,va='center',ha='center')\n    else:\n        tmp_arr[i] = 0\n        plt.text(s = value, x=1.9,y=i+2, font=font, fontsize=18,va='center',ha='center')\n        plt.text(s = 0, x=2.1,y=i+2, font=font, fontsize=18,va='center',ha='center')    \n\n\ntmp_arr2 = []\nfor i in range(0,3):\n    value = 0\n    for j in range(0,6):\n        value = value + tmp_arr[j] * weight[2][j][i] + weight[3][i]\/6\n    value =round(value,3)\n    tmp_arr2.append(value)\n    plt.text(s = value, x =3.2, y = i+3.8, font=font, fontsize=18,va='center',ha='center')\nplt.text(s='Consider Relu', x=2,y=8,font = font,fontsize=18,va='center',ha='center')\nax.axvspan(1.8, 2.2, fc=\"gray\", alpha=0.2)\n\nplt.show()","25a885d5":"print('keras model predict : ', model.predict(X_train[0:1]))","71aca5dd":"zero_value = []\nfor i in range(len(tmp_arr)):\n    if tmp_arr[i] == 0:\n        zero_value.append(i)\n\nimpact = []\ntmp_ar = []\nfor i in range(0,8):\n    columns_value = []\n    for j in range(0,6):\n        value = X_train[index][i] * weight[0][i][j] + (weight[1][j]\/8)\n        columns_value.append(value)\n        \n    for i in zero_value:\n        columns_value[i]=0 \n    tmp_ar.append(columns_value)\n    result = []\n    for j in range(0,3):\n        value = 0\n        for k in range(0,6):\n            value = value + columns_value[k] * weight[2][k][j] + weight[3][j]\/48\n        result.append(value)\n    impact.append(result)\n\n# print(np.sum(impact,axis=0))\n\nimpact = pd.DataFrame(impact)\nimpact.index = col[:8]\nimpact.columns = col[8:]\n\nimpact['target_carbon_monoxide'] = impact['target_carbon_monoxide'] \/ impact['target_carbon_monoxide'].max()\nimpact['target_benzene'] = impact['target_benzene'] \/ impact['target_benzene'].max()\nimpact['target_nitrogen_oxides'] = impact['target_nitrogen_oxides'] \/ impact['target_nitrogen_oxides'].max()","09075e83":"col = train.columns\nindex = 0\n\nfig = plt.figure(figsize=(30,13))\nspec = gridspec.GridSpec(ncols=7, nrows=3, figure=fig)\nax = fig.add_subplot(spec[:,:4])\nplt.scatter( x= point['x'],y=point['y'], s=400,color='black')\n\nweight_i = 0\nweight_j =0\nfor i in range(1,9):\n    weight_j =0\n    for j in range(2,8):\n        tmp = pd.DataFrame({'x':[1,2], 'y': [i,j]})\n        we = weight[0][weight_i][weight_j]\n        bias = weight[1][weight_j]\/8\n        value = we + bias\n        if value >= 0:\n            color = 'green'\n        else:\n            color = 'red'\n        sns.lineplot(x=tmp['x'],y=tmp['y'],ci=None,lw=np.abs(we),color=color)\n        weight_j = weight_j+1\n    weight_i = weight_i+1\n    \nweight_i = 0\nweight_j =0\nfor i in range(2,8):\n    weight_j =0\n    for j in range(4,7):\n        tmp = pd.DataFrame({'x':[2,3], 'y': [i,j]})\n        we = weight[2][weight_i][weight_j]\n        bias = weight[3][weight_j]\/6\n        value = we + bias\n        if value >= 0:\n            color = 'green'\n        else:\n            color = 'red'\n        sns.lineplot(x=tmp['x'],y=tmp['y'],lw=np.abs(we),ci=None,color=color)\n        weight_j = weight_j+1\n    weight_i = weight_i+1\n        \nplt.axis('off')\nplt.text(s='Input_layer', x=1,y=9,font = font, fontsize=25,va='center',ha='center')\nplt.text(s='hidden_layer', x=2,y=9,font = font,fontsize=25,va='center',ha='center')\nplt.text(s='out_layer', x=3,y=9,font = font,fontsize=25,va='center',ha='center')\nplt.text(s='Example : X_train[0]', x=0.9,y=10,va='center',ha='left',font = font,fontsize=50)\n\nfor i in range(len(col[:8])):\n    s = col[i]\n    plt.text(s = s, x =0.9, y = i+1,font=font, fontsize=18,va='center',ha='right')\n    value = round(X_train[index][i],4)\n    plt.text(s =value, x=0.9, y=i+0.7,font=font, fontsize=18,va='center',ha='right')\n    \nfor i in range(len(col[8:])):\n    s=col[i+8]\n    if i == 0:\n        plt.text(s = s, x =3.1, y = i+4,font=font, fontsize=18,va='center',ha='left',color='b')\n    elif i == 1:\n        plt.text(s = s, x =3.1, y = i+4,font=font, fontsize=18,va='center',ha='left',color='y')\n    else:\n        plt.text(s = s, x =3.1, y = i+4,font=font, fontsize=18,va='center',ha='left',color='r')\n\n    \ntmp_arr = []\nfor i in range(0,6):\n    value = 0\n    for j in range(0,8):\n        value = value + X_train[index][j] * weight[0][j][i] + weight[1][i]\/8\n    tmp_arr.append(value)\n    value =round(value,4)\n    if value>0:\n        plt.text(s = value, x=1.9,y=i+2, font=font, fontsize=18,va='center',ha='center')\n        plt.text(s = value, x=2.1,y=i+2, font=font, fontsize=18,va='center',ha='center')\n    else:\n        tmp_arr[i] = 0\n        plt.text(s = value, x=1.9,y=i+2, font=font, fontsize=18,va='center',ha='center')\n        plt.text(s = 0, x=2.1,y=i+2, font=font, fontsize=18,va='center',ha='center')    \n\n\ntmp_arr2 = []\nfor i in range(0,3):\n    value = 0\n    for j in range(0,6):\n        value = value + tmp_arr[j] * weight[2][j][i] + weight[3][i]\/6\n    value =round(value,3)\n    tmp_arr2.append(value)\n    plt.text(s = value, x =3.2, y = i+3.8, font=font, fontsize=18,va='center',ha='center')\nplt.text(s='Consider Relu', x=2,y=8,font = font,fontsize=18,va='center',ha='center')\nax.axvspan(1.8, 2.2, fc=\"gray\", alpha=0.2)\n\nax2 = fig.add_subplot(spec[2,5:])\nplt.barh(width=impact['target_carbon_monoxide'],y=list(range(0,8)))\nplt.axis('off')\nplt.text(s= 'target_carbon_monoxide',x=0, y=9,va='center',ha='center',font=font,fontsize=15)\nfor i in range(len(col[:8])):\n    s = col[i]\n    value = impact.iloc[i][0]\n    if value < 0:\n        plt.text(s=s,x=value-0.1, y= i,font=font,fontsize=13,va='center',ha='right')\n    else:\n        plt.text(s=s,x=value+0.1, y= i,font=font,fontsize=13,va='center',ha='left')\nplt.xlim(-1,3)\n\nax3 = fig.add_subplot(spec[1,5:])\nplt.barh(width=impact['target_benzene'],y=list(range(0,8)),color ='y')\nplt.axis('off')\nplt.text(s= 'target_benzene',x=0, y=9,va='center',ha='center',font=font,fontsize=15)\nfor i in range(len(col[:8])):\n    s = col[i]\n    value = impact.iloc[i][1]\n    if value < 0:\n        plt.text(s=s,x=value-0.1, y= i,font=font,fontsize=13,va='center',ha='right')\n    else:\n        plt.text(s=s,x=value+0.1, y= i,font=font,fontsize=13,va='center',ha='left')\nplt.xlim(-1,3)\n\n\nax4 = fig.add_subplot(spec[0,5:])\nplt.barh(width=impact['target_nitrogen_oxides'],y=list(range(0,8)),color ='r')\nplt.axis('off')\nplt.text(s= 'target_nitrogen_oxides',x=0, y=9,va='center',ha='center',font=font,fontsize=15)\nfor i in range(len(col[:8])):\n    s = col[i]\n    value = impact.iloc[i][2]\n    if value < 0:\n        plt.text(s=s,x=value-0.1, y= i,font=font,fontsize=13,va='center',ha='right')\n    else:\n        plt.text(s=s,x=value+0.1, y= i,font=font,fontsize=13,va='center',ha='left')\nplt.xlim(-1,3)\n\n\nplt.show()","00917335":"### It's result same with model's result","9dd653f7":"### I don't focus making model.\n### So, I just build simple DNN model","14fafa91":"### We have 4 weights totally\n### 2 weights + 2 bias","95e44f45":"### This is totally, DNN model's visualization using weights, and bias\n### Not consider activation function like relu","073aebab":"### Look example,\n### The sensor data's impact is bigger than others humidity, deg_c","f6d1abad":"### I don't consisder date_time \ud83d\ude00","f5a73bfd":"## Then, What columns impact to the result ?","7e2a730b":"#### After Drop data_time column","b890f947":"<div style=\"color:white;\n           display:fill;\n           border-radius:5px;\n           background-color:skyblue;\n           font-size:110%;\n           font-family:Verdana;\n           letter-spacing:0.5px\">\n<h1 style=\"text-align: center;\n           padding: 10px;\n              color:white\">\nTabular Playground Series - Jul 2021\n<\/h1>\n<\/div>\n\n![](https:\/\/storage.googleapis.com\/kaggle-competitions\/kaggle\/25226\/logos\/header.png?t=2021-01-27-17-34-31)\n\nIn this competition you are predicting the values of air pollution measurements over time, based on basic weather information (temperature and humidity) and the input values of 5 sensors.\n\nThe three target values to you to predict are: target_carbon_monoxide, target_benzene, and target_nitrogen_oxides\n\n## Data\n* train.csv - the training data, including the weather data, sensor data, and values for the 3 targets\n* test.csv - the same format as train.csv, but without the target value; your task is to predict the value for each of these targets.\n* sample_submission.csv - a sample submission file in the correct format.","730412f1":"### Modeling - DNN","4e272ef8":"### Look example : X_train[0] ","2703ab82":"### And if you want to view my other work - [LSTM_XAI](https:\/\/www.kaggle.com\/jeongbinpark\/looking-lstm-detailly-trying-xai)\n### previous work - [TPS-Jun](https:\/\/www.kaggle.com\/jeongbinpark\/tps-jun-try-visualization-dnn-model2)","f86a13bf":"### I recently interested in XAI using model's weights, bias, and Activation function.\n### So, I try it this TPS - Jul !","c7615631":"### If you have any good idea to visualization Deep learning model,\n### Feel free to give me comments! \n### I always welcome your comments ~","fea316dd":"### Do XAI","e45e4821":"### Data Processing - Scaler"}}