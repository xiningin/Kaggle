{"cell_type":{"16280aa6":"code","8b7b733b":"code","60d96c98":"code","c909359b":"code","6ba30f8c":"code","61f50aee":"code","159f39be":"code","4c048775":"markdown","64098125":"markdown","2667daf5":"markdown","f7fdb99b":"markdown"},"source":{"16280aa6":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nfrom datetime import datetime as dt\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom matplotlib import dates\n\nimport os\ndata = pd.read_csv('..\/input\/COTAHIST_A2009_to_A2018P.csv',parse_dates=['DATPRE'])","8b7b733b":"data = data[['TIPREG', \n             'DATPRE', \n             'CODBDI', \n             'CODNEG', \n             'TPMERC',\n             'NOMRES', \n             'ESPECI',\n             'TOTNEG', \n             'QUATOT', \n             'VOLTOT'\n            ]]\ndata['year'] = pd.to_datetime(data.DATPRE).dt.year","60d96c98":"years = np.sort(data['year'].unique())\ngraph = pd.DataFrame([])\nfor y in years:\n    tot_vol = (data[(data.year==y)].groupby(by='DATPRE')['VOLTOT'].sum()\/(10**11)).mean()\n    graph = graph.append({'Total_Volume': tot_vol,'Year': y},ignore_index=True)\ngraph['Year'] = graph['Year'].astype('uint16')\npos = np.arange(len(graph))\nfig, ax = plt.subplots(figsize=(12, 6))\nax.barh(pos, graph['Total_Volume'].values,color='black')\nax.set_yticks(pos)\nax.set_yticklabels(graph['Year'].values,fontsize=15)\nax.invert_yaxis()  # labels read top-to-bottom\nax.set_xlabel('BRL Billion',fontsize=16)\nax.set_title('Valor m\u00e9dio de negocia\u00e7\u00e3o na Bovespa por ano',fontsize=20)\nsns.despine(bottom=True, left=True)\n\nplt.show()\ndel graph","c909359b":"data_datafram = ['CODNEG','NOMRES','TOTNEG','VOLTOT','DATPRE','QUATOT']\n\ndef make_dataframe(df,company_name):\n    df['TOTAL_VOL'] = (data[data_datafram][(data.NOMRES==company_name)].groupby(by='DATPRE')['VOLTOT'].sum())\/(100)\n    df['NUM_NEG'] = (data[data_datafram][(data.NOMRES==company_name)].groupby(by='DATPRE')['TOTNEG'].sum())\n    df['NUM_TIT'] = (data[data_datafram][(data.NOMRES==company_name)].groupby(by='DATPRE')['QUATOT'].sum())\n    df['ticket'] = df['TOTAL_VOL']\/df['NUM_NEG']\n    df['price'] = df['TOTAL_VOL']\/df['NUM_TIT']\n    return df","6ba30f8c":"top10 = pd.DataFrame([]) ; company_list = [] \ntop10['TOTAL_VOL'] = (data[['CODNEG','NOMRES','TOTNEG','VOLTOT','DATPRE']].groupby(by='NOMRES')['VOLTOT'].sum())\ncompany_list = top10.nlargest(12, 'TOTAL_VOL').index.values\ncompany_list= np.delete(company_list, [8,9])\n\ngraph = pd.DataFrame([])\ngraph['DATPRE'] = data['DATPRE'].unique()\ngraph.set_index('DATPRE',inplace=True)\nfor company in company_list:\n   df = pd.DataFrame([])\n   grp = make_dataframe(df,company)[['TOTAL_VOL']].rename(index=str, columns={'TOTAL_VOL': company})\n   graph = pd.merge(graph,grp,right_index=True,left_index=True,how='left')\n   del df ; del grp\n\ngraph.fillna(0, inplace=True)\ngraph.sort_index(inplace=True)\nfig, ax = plt.subplots(5,1,figsize=(40,48))\nax[0].set_title(\"Top 5 companies by trade value in Bovespa\", fontsize=30)\ncolors = [(0, 158\/255, 111\/255),'blue',(246\/255,94\/255,1\/255),'red',(249\/255,221\/255,22\/255)]\nplt.title('Top 5 companies with largest average daily trade')\nfor i in range(5):\n    ax[i].bar(graph.index, graph[company_list[i]], width=1.2, color=colors[i])\n    ax[i].set_ylabel(r\"Billion BRL\")\n    months = dates.MonthLocator(range(1, 13), bymonthday=1, interval=6)\n    monthsFmt = dates.DateFormatter(\"%b '%y\")\n    ax[i].xaxis.set_major_locator(months)\n    ax[i].xaxis.set_major_formatter(monthsFmt)\n    ax[i].tick_params(axis='both', which='major', labelsize=16)\n    ax[i].tick_params(axis='x' ,rotation=10)\n    ax[i].legend([company_list[i]],loc=2, fontsize=25)\n    ax[i].set_ylim((0,4*10**9))\n    ax[i].set_xlim(pd.Timestamp('2009-02-15'), pd.Timestamp('2018-02-15'))\n    ax[i].axhline(graph[company_list[i]].mean(), color='k', linestyle='dashed', linewidth=1)\nplt.subplots_adjust(bottom=0.5)\ndel graph\nplt.show()","61f50aee":"def make_dataframe1(df,stock_code):\n    df['TOTAL_VOL'] = (data[data_datafram][(data.CODNEG.isin(stock_code))].groupby(by='DATPRE')['VOLTOT'].sum())\/(100)\n    df['NUM_NEG'] = (data[data_datafram][(data.CODNEG.isin(stock_code))].groupby(by='DATPRE')['TOTNEG'].sum())\n    df['NUM_TIT'] = (data[data_datafram][(data.CODNEG.isin(stock_code))].groupby(by='DATPRE')['QUATOT'].sum())\n    df['ticket'] = df['TOTAL_VOL']\/df['NUM_NEG']\n    df['price'] = df['TOTAL_VOL']\/df['NUM_TIT']\n    return df","159f39be":"graph = pd.DataFrame([])\ngraph['DATPRE'] = data['DATPRE'].unique()\ngraph.set_index('DATPRE',inplace=True)\nstock_list=[\n    ['VALE3','VALE3F'],\n    ['PETR4','PETR4F'],\n    ['ITUB4','ITUB4F'],\n    ['BBDC4','BBDC4F'],\n    ['BBAS3','BBAS3F']\n]\nfor stock in stock_list:\n   df = pd.DataFrame([])\n   grp = make_dataframe1(df,stock)[['TOTAL_VOL']].rename(index=str, columns={'TOTAL_VOL': stock[0]})\n   graph = pd.merge(graph,grp,right_index=True,left_index=True,how='left')\n   del df ; del grp\n\nprice = pd.DataFrame([])\nprice['DATPRE'] = data['DATPRE'].unique()\nprice.set_index('DATPRE',inplace=True)\nfor stock in stock_list:\n   df = pd.DataFrame([])\n   grp = make_dataframe1(df,stock)[['price']].rename(index=str, columns={'price': stock[0]})\n   price = pd.merge(price,grp,right_index=True,left_index=True,how='left')\n   del df ; del grp\n\ngraph.fillna(0, inplace=True)\ngraph.sort_index(inplace=True)\nfig, ax = plt.subplots(5,1,figsize=(40,48))\n\ncolors = [(0, 158\/255, 111\/255),'blue',(246\/255,94\/255,1\/255),'red',(249\/255,221\/255,22\/255)]\nplt.title('Top 5 companies with largest average daily trade')\nfor i in range(5):\n    ax[i].bar(graph.index, graph[stock_list[i][0]], width=1.2, color=colors[i])\n    ax[i].set_ylabel(r\"Billion BRL\", fontsize=16)\n    ax2 = ax[i].twinx()\n    ax2.scatter(price.index, price[stock_list[i][0]],color='black', s=1.2)\n    ax2.set_ylabel(r\"Stock Price (BRL)\", fontsize=16)\n    months = dates.MonthLocator(range(1, 13), bymonthday=1, interval=6)\n    monthsFmt = dates.DateFormatter(\"%b '%y\")\n    ax[i].xaxis.set_major_locator(months)\n    ax[i].xaxis.set_major_formatter(monthsFmt)\n    ax[i].tick_params(axis='both', which='major', labelsize=16)\n    ax[i].tick_params(axis='x' ,rotation=10)\n    ax[i].legend([stock_list[i][0]],loc=2, fontsize=25)\n    #ax[i].set_ylim((0,4*10**9))\n    ax[i].set_xlim(pd.Timestamp('2009-02-15'), pd.Timestamp('2018-02-15'))\n    ax[i].axhline(graph[stock_list[i][0]].mean(), color='k', linestyle='dashed', linewidth=1)\nplt.subplots_adjust(bottom=0.5)\ndel graph\nplt.show()","4c048775":"----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------","64098125":"O volume m\u00e9dio di\u00e1rio negociado em reais aumentou para os 3 bancos (Ita\u00fa, Bradesco e B.Brasil), eles est\u00e3o acima da m\u00e9dia de 5 anos na maior parte do tempo nos anos mais recentes. A VALE est\u00e1 se recuperando ap\u00f3s um volume muito baixo entre 2014 e 2016.\n\nEm seguida, quero tentar verificar o estoque e o pre\u00e7o mais negociados ao longo do tempo.","2667daf5":"VALE3 aumenta o valor do volume de negocia\u00e7\u00e3o porque o VALE5 n\u00e3o est\u00e1 mais dispon\u00edvel.\nPor esses gr\u00e1ficos, noto que os pre\u00e7os das a\u00e7\u00f5es dos bancos se seguem no curto prazo (o que provavelmente faz sentido).","f7fdb99b":"Antes de come\u00e7\u00e3rmos j\u00e1 deixo claro que eu n\u00e3o sei muito sobre os mercados financeiros.\n\nEu estou apenas juntando o util ao agradavel brincando com a visualiza\u00e7\u00e3o de dados do mercado financeiro..."}}