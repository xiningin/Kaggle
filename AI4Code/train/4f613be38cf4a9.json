{"cell_type":{"6afd2ecf":"code","313b504d":"code","78b798c1":"code","9d8efc63":"code","7acc3710":"code","7aa92567":"code","4166b19a":"code","f2cae041":"code","d6335677":"code","ad52234a":"code","a7460ea3":"code","19318324":"code","71b40b9d":"code","98af3edb":"code","f4e7f6fe":"code","d6dc9319":"code","84042611":"code","e3002a2e":"code","c701df0b":"code","40853f49":"code","5501af3d":"code","dea720b4":"code","e4edf5b1":"code","e50baaad":"code","3d088b75":"code","874aac7a":"code","3d3a8221":"code","4526a78e":"code","3fd8c95d":"code","05a0df3b":"code","d6dec7b6":"code","b63ba4fe":"code","f14f89ef":"code","54d2df1f":"code","4f1ed1fa":"code","9b111e83":"markdown","b868f03f":"markdown","418cc4a7":"markdown","861c9522":"markdown","a47f6696":"markdown","1152cb02":"markdown","182fa919":"markdown","8e4c7056":"markdown","aea0fbfb":"markdown","bd47dbc1":"markdown","bc1ae07f":"markdown","f85d938d":"markdown","83585edd":"markdown","31ce89af":"markdown","4db7cc1d":"markdown","41538363":"markdown","17d64bc8":"markdown","6a53871a":"markdown","74e7a091":"markdown","55745795":"markdown","99e5ba29":"markdown"},"source":{"6afd2ecf":"import numpy as np\nimport pandas as pd \nimport seaborn as sns\npd.set_option('max_colwidth', None)","313b504d":"path = '\/kaggle\/input\/hackathon'\nfiles = [f'{path}\/task_1-google_search_english_original_metadata.csv',\n         f'{path}\/task_1-google_search_translated_to_english_metadata.csv']\n\ndfs = []\nfor file in files:\n    df = pd.read_csv(file, encoding = \"ISO-8859-1\")\n    dfs.append(df)\n    \ndf = pd.concat(dfs, ignore_index=True)","78b798c1":"f\"Considering only {df.shape[0]} sources\"","9d8efc63":"df.head(1)","7acc3710":"df.drop(['Is Processed', 'Comments', 'language', 'query'], axis=1, inplace=True)","7aa92567":"df[df['alpha_2_code'].isna()].head()","4166b19a":"assert all(df[df['alpha_2_code'].isna()]['country']=='Namibia')\ndf['alpha_2_code'].fillna('NA', inplace=True)","f2cae041":"df.drop(df[df['is_downloaded']==False].index, inplace=True)\ndf['char_number'] = pd.to_numeric(df['char_number'], errors='coerce')\ndf.drop(df[df['char_number']==0].index, inplace=True)","d6335677":"f\"Considering only {df.shape[0]} sources\"","ad52234a":"df.drop_duplicates('url', keep=False, inplace=True)","a7460ea3":"f\"Considering only {df.shape[0]} sources\"","19318324":"df['char_number'].value_counts().head()","71b40b9d":"df[df['char_number']==895].head()","98af3edb":"df[df['char_number']==895]['url'].str.contains('researchgate.net').mean()","f4e7f6fe":"row = df[df['char_number']==895].iloc[0]\ncode = row['alpha_2_code']\nfilename=row['filename']\nfilename = f'\/kaggle\/input\/hackathon\/task_1-google_search_txt_files_v2\/{code}\/{filename}.txt'\n\nwith open(filename, 'r') as file:\n    data = file.read()\n\ndata","d6dc9319":"df.drop(df[(df['url'].str.contains('researchgate.net')) & (df['char_number']==895)].index, inplace=True)","84042611":"f\"Considering only {df.shape[0]} sources\"","e3002a2e":"from urllib.parse import urlparse\ndf['url_domain'] = df['url'].apply(lambda x: urlparse(x).netloc)","c701df0b":"df['url_domain'].value_counts().head()","40853f49":"df = df[df['url_domain']=='www.ncbi.nlm.nih.gov']","5501af3d":"f\"Considering only {df.shape[0]} sources\"","dea720b4":"! pip install pandarallel","e4edf5b1":"import bs4 as bs\nimport urllib.request\nfrom pandarallel import pandarallel\npandarallel.initialize(progress_bar=True)\n\ndef get_url_title(url):\n    try:\n        req = urllib.request.Request(url, headers={'User-Agent': 'Mozilla\/5.0'})\n        source = urllib.request.urlopen(req).read()\n        soup = bs.BeautifulSoup(source,'lxml')\n        if not soup.title:\n            print('No title')\n            print(url)\n            return \"\"\n        return soup.title.text\n    except urllib.error.HTTPError as e:\n        print(e)\n        print(url)\n        return \"\"","e50baaad":"df['url_title'] = df['url'].parallel_apply(get_url_title)","3d088b75":"df[['country', 'url_title']].head()","874aac7a":"df['title_has_country'] = df.apply(lambda row: row['country'] in row['url_title'], axis=1)","3d3a8221":"df['title_has_country'].value_counts()","4526a78e":"df.drop(df[df['title_has_country'] == False].index, inplace=True)","3fd8c95d":"f\"Considering only {df.shape[0]} sources\"","05a0df3b":"df['url_title'].value_counts().head()","d6dec7b6":"df[df['url_title']=='The Current Status of BCG Vaccination in Young Children in South Korea']['url']","b63ba4fe":"df.drop_duplicates('url_title', inplace=True)","f14f89ef":"f\"Considering only {df.shape[0]} sources\"","54d2df1f":"df['country'].value_counts()","4f1ed1fa":"df['char_number'].plot.box()","9b111e83":"Drop some redundant columns:","b868f03f":"### Remove duplicated urls","418cc4a7":"### Metadata-only","861c9522":"# Filtering","a47f6696":"### Remove articles with the same title","1152cb02":"###\u00a0NCBI sources only","182fa919":"It's good news that most of the articles are about a single country.","8e4c7056":"The first big filter is to consider only texts for which there is metadata information.","aea0fbfb":"# Motivation\nThis notebook gives ideas about different types of filtering that can be applied to the vast amount of sources that the dataset provides.","bd47dbc1":"Fix alpha_2_code NaN values for Namibia:","bc1ae07f":"By looking at the titles, we can see that some of the articles are about more than one country, i.e for 'European countries'. This might cause problems, because when extracting the answer for a question we would not know for which country it applies. Let's filter such articles by checking whether the title contains the name of the country.","f85d938d":"Let's enrich the metadata information for these sources by extracting the title for each article.","83585edd":"### Analyse url domains","31ce89af":"It turns out most of those are from the website *researchgate.net*. Let's see what is the content of one of the files.","4db7cc1d":"### Remove empty documents","41538363":"The domain with most entries in the filtered dataset is *www.ncbi.nlm.nih.gov*. This is the website of National Center for Biotechnology Information which provides access to biomedical and genomic information. It's a government site, which suggests that the information on it is reliable. Let's apply another filter and look only at the data from this website.","17d64bc8":"This looks like a predefined message that is not useful for us, thus we can ignore all sources coming from *researchgate.net*","6a53871a":"### Analyse char number","74e7a091":"Some articles have duplicated titles, because the source url is almost exactly the same, except for a different section tag at the end. This means we can remove those duplicates.","55745795":"Finally, we end up with just 85 sources for 73 countries with an average of about 20K characters per article.","99e5ba29":"80 articles having exactly 895 number of characters is suspicious. Let's see which are the corresponding urls."}}