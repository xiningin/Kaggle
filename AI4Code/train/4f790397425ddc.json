{"cell_type":{"10ab7c0e":"code","b611aced":"code","a63a64f0":"code","1c1cfbc8":"code","bf124702":"code","6d5ec176":"code","f37494fb":"code","f1be4745":"code","04394cd0":"code","368b6682":"code","ee880a3d":"code","a14e033c":"code","cef4ec5c":"code","dcce3054":"code","2e11c441":"code","73fe16d3":"code","bf8b1ba0":"code","bb225b81":"code","740904fa":"code","f660a8a4":"code","072e6b86":"code","e6ffc3cd":"code","0e53a786":"markdown","cbdb7ec5":"markdown","5d81ca8e":"markdown","1bfd9cab":"markdown","2071c5c7":"markdown"},"source":{"10ab7c0e":"import pandas as pd\nimport numpy as np\nfrom sklearn.model_selection import train_test_split\nfrom lightgbm import LGBMRegressor\nfrom sklearn.preprocessing import OneHotEncoder\nfrom sklearn.compose import ColumnTransformer, make_column_transformer\nfrom sklearn.pipeline import Pipeline","b611aced":"town_data = pd.read_csv('\/kaggle\/input\/town-data\/town_data.csv', header=[1])\ntown_data = town_data.replace('*', np.nan)\ntown_data = town_data.replace('X', np.nan)","a63a64f0":"train_data = pd.read_csv('\/kaggle\/input\/machine-learning-lab-cas-data-science-fs-20\/houses_train.csv', index_col=0)","1c1cfbc8":"train_data = train_data.join(town_data.set_index('Gemeindename'), on='municipality_name')","bf124702":"train_data = train_data.fillna(-1)","6d5ec176":"X_data = train_data.drop(columns='price')\ny_data = train_data['price']","f37494fb":"X_train, X_dev, y_train, y_dev = train_test_split(X_data, y_data, stratify=X_data['object_type_name'], test_size=0.1)","f1be4745":"pipeline = Pipeline([\n    ('pre', make_column_transformer((OneHotEncoder(handle_unknown='ignore'), ['zipcode', 'municipality_name', 'object_type_name']), remainder='passthrough')),\n    ('clf', LGBMRegressor(\n        num_leaves=50,\n        #max_depth=5,\n        learning_rate=0.05,\n        n_estimators=200\n    ))\n])","04394cd0":"from sklearn.model_selection import GridSearchCV, RandomizedSearchCV","368b6682":"parameters = {\n    'clf__num_leaves': [10,20,30,40,50,60,70,80,90,100], \n    'clf__max_depth': [3,4,5,6,7,8,9,10],\n    'clf__n_estimators': [100,150,200,500] \n}\nclf = RandomizedSearchCV(pipeline, parameters, cv=5, n_iter=40, verbose=1, n_jobs=-1)","ee880a3d":"clf.fit(X_train, y_train)","a14e033c":"est = clf.best_estimator_","cef4ec5c":"y_dev_pred = est.predict(X_dev)","dcce3054":"def mean_absolute_percentage_error(y_true, y_pred): \n    return np.mean(np.abs((y_true - y_pred) \/ y_true)) * 100","2e11c441":"mean_absolute_percentage_error(y_dev, y_dev_pred)","73fe16d3":"est.fit(X_data, y_data)","bf8b1ba0":"X_test = pd.read_csv('\/kaggle\/input\/machine-learning-lab-cas-data-science-fs-20\/houses_test.csv', index_col=0)","bb225b81":"X_test = X_test.join(town_data.set_index('Gemeindename'), on='municipality_name')\nX_test = X_test.fillna(-1)","740904fa":"y_test_pred = est.predict(X_test)","f660a8a4":"X_test_submission = pd.DataFrame(index=X_test.index)","072e6b86":"X_test_submission['price'] = y_test_pred","e6ffc3cd":"X_test_submission.to_csv('lightgbm_submission_all.csv', header=True, index_label='id')","0e53a786":"# define and train model","cbdb7ec5":"# Predict and evaluate prices for dev set","5d81ca8e":"# Train with all data","1bfd9cab":"# prepare data","2071c5c7":"# Predict prices for test set"}}