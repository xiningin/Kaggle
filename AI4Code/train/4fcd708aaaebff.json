{"cell_type":{"c002529c":"code","e9aa1c2e":"code","fbe2b06c":"code","087838ee":"code","a25a4a29":"code","242d902c":"code","cefc0eed":"code","a15e4d10":"code","5bcf22c7":"code","3619cf55":"code","41572df9":"code","5bf2289f":"code","6cd8cabf":"code","37ed83d3":"code","fb5b9f08":"code","220bce97":"code","f5462f53":"markdown","6ab9168c":"markdown","540f0f15":"markdown","9da7003e":"markdown","de791368":"markdown","0cbbf044":"markdown","dcb0dd1a":"markdown","1c190300":"markdown","71bb66e6":"markdown","751b16a4":"markdown","f5742cac":"markdown","99b091ea":"markdown","c51d6f1d":"markdown","59e6f268":"markdown"},"source":{"c002529c":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nsns.set(style=\"darkgrid\")\nplt.style.use(\"seaborn-pastel\")\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","e9aa1c2e":"df = pd.read_excel(\"\/kaggle\/input\/yearly-highest-paid-100-athletes-forbes-20122019\/Forbes Athlete List 2012-2019.xlsx\")\ndf.head(10)","fbe2b06c":"df.info()","087838ee":"df.Rank = df.Rank.apply(lambda x: int(x.split(\"#\")[1]) if type(x) == np.str else x)\ndf.Pay = df.Pay.apply(lambda x: float(x.split(\" \")[0].split(\"$\")[1]))\ndf.Endorsements = df.Endorsements.apply(lambda x: float(x.split(\" \")[0].split(\"$\")[1]))\ndf[\"Salary\/Winnings\"].replace(\"-\",'$nan M',inplace=True)\ndf[\"Salary\/Winnings\"] = df[\"Salary\/Winnings\"].apply(lambda x: float(x.split(\" \")[0].split(\"$\")[1]))\ndf.Sport.replace({\"Soccer\":\"Football\",\n                  \"Football\":\"American Football\",\n                 \"Mixed Martial Arts\":\"MMA\",\n                 \"Auto racing\":\"Racing\",\n                  \"Auto Racing\":\"Racing\",\n                  \"Basketbal\":\"Basketball\",\n                 },inplace=True)\n\ndf.columns = ['Rank', 'Name', 'Pay', 'Salary_Winnings', 'Endorsements', 'Sport', 'Year']\ndf.head(10)","a25a4a29":"messi = df[df.Name == \"Lionel Messi\"].sort_values(\"Year\")\nmessi","242d902c":"sns.barplot(data=messi,x=\"Pay\",y=\"Year\",orient=\"h\")\nplt.title(\"Messi's Pay Progress\")\nplt.show()","cefc0eed":"df.groupby(\"Name\").first()[\"Sport\"].value_counts().plot(kind=\"pie\",autopct=\"%.0f%%\",figsize=(8,8),wedgeprops=dict(width=0.4),pctdistance=0.8)\nplt.ylabel(None)\nplt.title(\"Breakdown of Athletes by Sport\",fontweight=\"bold\")\nplt.show()","a15e4d10":"sports = df.groupby(\"Sport\").agg(\n    total_pay = (\"Pay\",\"sum\"),\n    no_of_players = (\"Name\",\"count\")\n)\n\nsports[\"pay_per_player\"] = sports.total_pay\/sports.no_of_players\nsports.sort_values(\"pay_per_player\",ascending=False)","5bcf22c7":"df.Year = pd.to_datetime(df.Year,format=\"%Y\")\ndf.dtypes","3619cf55":"racing_bar_data = df.pivot_table(values=\"Pay\",index=\"Year\",columns=\"Name\")\nracing_bar_data.cumsum()","41572df9":"racing_bar_data.columns[racing_bar_data.isnull().sum() == 0]","5bf2289f":"racing_bar_filled = racing_bar_data.interpolate(method=\"linear\").fillna(method=\"bfill\")\nracing_bar_filled","6cd8cabf":"racing_bar_filled = racing_bar_filled.cumsum()\nracing_bar_filled","37ed83d3":"racing_bar_filled = racing_bar_filled.resample(\"1D\").interpolate(method=\"linear\")[::7]","fb5b9f08":"racing_bar_filled[\"Lionel Messi\"].plot(marker=\".\",figsize=(12,4))\nplt.ylabel(\"Cumulative Pay (Million USD)\")\nplt.show()","220bce97":"from matplotlib.animation import FuncAnimation, FFMpegWriter\n\nselected  = racing_bar_filled.iloc[-1,:].sort_values(ascending=False)[:20].index\ndata = racing_bar_filled[selected].round()\n\nfig,ax = plt.subplots(figsize=(9.3,7))\nfig.subplots_adjust(left=0.18)\nno_of_frames = data.shape[0] #Number of frames\n\n#initiate the barplot with the first rows of the dataframe\nbars = sns.barplot(y=data.columns,x=data.iloc[0,:],orient=\"h\",ax=ax)\nax.set_xlim(0,1500)\ntxts = [ax.text(0,i,0,va=\"center\") for i in range(data.shape[1])]\ntitle_txt = ax.text(650,-1,\"Date: \",fontsize=12)\nax.set_xlabel(\"Pay (Millions USD)\")\nax.set_ylabel(None)\n\ndef animate(i):\n#     print(f\"i={i}\/{no_of_frames}\")\n    #get i'th row of data \n    y = data.iloc[i,:]\n    \n    #update title of the barplot axis\n    title_txt.set_text(f\"Date: {str(data.index[i].date())}\")\n    \n    #update elements in both plots\n    for j, b, in enumerate(bars.patches):\n        #update each bar's height\n        b.set_width(y[j])\n        \n        #update text for each bar (optional)\n        txts[j].set_text(f\"${y[j].astype(int)}M\")\n        txts[j].set_x(y[j])\n\nanim=FuncAnimation(fig,animate,repeat=False,frames=no_of_frames,interval=1,blit=False)\nanim.save('athletes.gif', writer='imagemagick', fps=120)\nplt.close(fig)","f5462f53":"## Data preprocessing\n\nSome of the columns are inconsistent in the dataset as Forbes changed their mind wheter to put **\"#\"** before the rank value over time. Lets fix this one as well as taking out **\"dollar signs\"** and **\"M\"**. Let's also change \"Soccer\" to \"Football\" and \"Football\" to \"American Football\"","6ab9168c":"Following athletes are the only ones which are consistently involved in the Top100 list for each year since 2012. The rest of the athletes have NaN values. We will first interpolate NaNs linearly and use fill remaining NaNs with backward filling:","540f0f15":"Import necessary packages for creating animation and saving them, and initiate the plots and their elements (lines, bars, texts etc.). Following codes will generate an animation for the Top 10 highest paid athletes between 2012 and 2019:","9da7003e":"Then prepare a pivot table where columns are athletes and index is years:\n* The table have 8 rows (year) against 300 athletes","de791368":"# Exploratory Data Analysis\n\nLet's see the progress of Lionel Messi's pay over the years","0cbbf044":"This is how Messi's cumulative pay looks over time after resampling and interpolations","dcb0dd1a":"Load the excel file","1c190300":"## Racing bar for the cumulative earnings of players\nLet's visualise cummulative pays of the athletes in a racing bar animation. First we convert the year column into datetime object:\n","71bb66e6":"It contains 7 columns, 795 rows:\n* **Rank**: Yearly rank based on pay\n* **Name**: Name of the athlete\n* **Pay**: Salary and endorsement pays altogether\n* **Salary\/Winnings**: Salary of the athlete\n* **Endorsements**: Earnings from commercials, social media, sponsors etc.\n* **Sport**: Type of the sport of the athlete\n* **Year**: Year of the pay","751b16a4":"Now let's oversample the dataset with interpolation (linear) for a smooth transitions in frames in the animation. Rows will represent days now.","f5742cac":"Total earnings by sport type:\n* Even though basketball has the highest total pay it is due to frequency of players\n* Yearly average pays (in million USD) of fighters are much higher as compared to basketball player averages","99b091ea":"Let's see the distribution of athletes in the dataset based on their sport type","c51d6f1d":"Now convert the data into cumulative sum of pays over years:","59e6f268":"![](.\/athletes.gif)"}}