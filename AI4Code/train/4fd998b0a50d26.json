{"cell_type":{"2f5336c9":"code","d28fee42":"code","1d17e455":"code","e89ef755":"code","2ee94630":"code","1f35cc83":"code","52d425e8":"code","052d879e":"code","cadbabc0":"code","e9fb7053":"code","797041f8":"markdown","471a8fa2":"markdown","e9fbc1f3":"markdown","724d9533":"markdown","d1edf35c":"markdown"},"source":{"2f5336c9":"import numpy as np\nimport matplotlib.pyplot as plt\nimport pandas as pd\nimport os\nplt.rcParams.update({'font.size': 18})","d28fee42":"# Load calculated data\npatient_mask = np.load(\"..\/input\/bigimaging-complete\/patient_mask.npz\")['arr_0']\npatient_indices = patient_mask.nonzero()[0]\npred_min = np.load(\"..\/input\/bigimaging-complete\/min_vols.npz\")['arr_0'][patient_indices]\npred_max = np.load(\"..\/input\/bigimaging-complete\/max_vols.npz\")['arr_0'][patient_indices]\n\n# Load ground truth data\npath = os.path.join(\"..\", \"input\", \"second-annual-data-science-bowl\", \"train.csv\")\nground_truth = pd.read_csv(path)\ntrue_min = np.array(ground_truth.Systole)[patient_indices]\ntrue_max = np.array(ground_truth.Diastole)[patient_indices]\n\nmin_limit, max_limit = 0, 600\n","1d17e455":"# Clip at [0, 600] ml\npred_min = pred_min.clip(min_limit, max_limit)\npred_max = pred_max.clip(min_limit, max_limit)","e89ef755":"fig, (ax1, ax2) = plt.subplots(1, 2, figsize=[16,8])\n\nax1.plot(true_min, pred_min, \"*\")\nax1.set_xlim([min_limit, max_limit])\nax1.set_ylim([min_limit, max_limit])\nax1.set_xlabel(\"True systole (min) volumes\")\nax1.set_ylabel(\"Predicted systole (min) volumes\")\n\nax2.plot(true_max, pred_max, \"*\")\nax2.set_xlim([min_limit, max_limit])\nax2.set_ylim([min_limit, max_limit])\nax2.set_xlabel(\"True diastole (max) volumes\")\nax2.set_ylabel(\"Predicted diastole (max) volumes\")\n\nplt.show()","2ee94630":"fig, ((ax1, ax2), (ax3, ax4)) = plt.subplots(2, 2, figsize=[15,10])\n\nax1.hist(pred_min, bins=100, edgecolor=\"black\")\nax1.set_xlabel(\"Predicted systole (min) volume\")\nax1.set_ylabel(\"Frequency\")\nax1.set_ylim([0,60])\nax1.set_xlim([min_limit, max_limit])\n\nax2.hist(pred_max, bins=100, edgecolor=\"black\")\nax2.set_xlabel(\"Predicted diastole (max) volume\")\nax2.set_ylabel(\"Frequency\")\nax2.set_ylim([0,60])\nax2.set_xlim([min_limit, max_limit])\n\nax3.hist(true_min, bins=100, edgecolor=\"black\")\nax3.set_xlabel(\"True systole (min) volume\")\nax3.set_ylabel(\"Frequency\")\nax3.set_ylim([0,60])\nax3.set_xlim([min_limit, max_limit])\n\nax4.hist(true_min, bins=100, edgecolor=\"black\")\nax4.set_xlabel(\"True diastole (max) volume\")\nax4.set_ylabel(\"Frequency\")\nax4.set_ylim([0,60])\nax4.set_xlim([min_limit, max_limit])\n\nplt.show()","1f35cc83":"fig, (ax1, ax2) = plt.subplots(2, 1, figsize=[20,15])\n\nax1.plot(patient_indices+1, true_min, '*', label=\"true\")\nax1.plot(patient_indices+1, pred_min, '+', color='r', label=\"pred\")\nax1.set_ylabel('Volume (ml)')\nax1.set_xlabel('Patient id')\nax1.set_title('True vs Predicted Systole')\nax1.legend()\n\nax2.plot(patient_indices+1, true_max, '*', label=\"true\")\nax2.plot(patient_indices+1, pred_max, '+', color='r', label=\"pred\")\nax2.set_ylabel('Volume (ml)')\nax2.set_xlabel('Patient id')\nax2.set_title('True vs Prediced Diastole')\nax2.legend()\n\nfig.show()","52d425e8":"rmse_min = np.sqrt(((true_min - pred_min)**2).mean())\nrmse_max = np.sqrt(((true_max - pred_max)**2).mean())\nprint(\"MSE Systole:\", rmse_min)\nprint(\"MSE Diastole:\", rmse_max)","052d879e":"corr_max = np.corrcoef(pred_min, true_min)\ncorr_min = np.corrcoef(pred_max, true_max)\n\nprint(corr_max[0,1], \"Correlation predicted and true max values\")\nprint(corr_min[0,1], \"Correlation predicted and true min values\")","cadbabc0":"def ejection_rate(v_max, v_min): return (v_max - v_min) \/ v_max\n\npred_ejections = np.array([ejection_rate(vd, vs) for vd,vs in zip(pred_max, pred_min)])\ntrue_ejections = np.array([ejection_rate(vd, vs) for vd,vs in zip(true_max, true_min)])\n\nrmse_ejection = np.sqrt(((true_ejections- pred_ejections)**2).mean())\nprint(\"RMSE Ejection Rate:\", rmse_ejection)","e9fb7053":"fig, ax = plt.subplots(1, 1, figsize=[20,5])\n\nax.plot(patient_indices, true_ejections, '*', label=\"true\")\nax.plot(patient_indices, pred_ejections, '+', color='r', label=\"pred\")\nax.set_title('Ejection rate, true vs pred', fontsize=16)\nax.set_ylabel('Ejection rate')\nax.set_xlabel('Patient')\nax.legend()\n\nfig.show()","797041f8":"## Load in predictions","471a8fa2":"## Systole (min) and diastole (max) volume comparison","e9fbc1f3":"### RMSE","724d9533":"## Ejection rate comparison","d1edf35c":"### Correlation"}}