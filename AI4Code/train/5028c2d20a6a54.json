{"cell_type":{"e978ac88":"code","a6ef4775":"code","8970850f":"code","2c76e14b":"code","becd2a45":"code","e23a27be":"code","c6273224":"code","41357255":"code","3bcc42a9":"code","18a6d142":"code","53171e0e":"code","350341f3":"code","fa6ff670":"code","5bf9e473":"code","97d9bb4e":"code","7229a6d6":"code","c924f74a":"code","28dbfadb":"code","7daee885":"code","efc4ee9a":"code","fe732538":"code","9d1c2b68":"code","707ae877":"code","cc8eb4f4":"code","98f0014c":"code","ba291ee3":"code","474103e3":"code","a73f1b0f":"code","fa7d3ce8":"code","8c4edf66":"code","0e2b7d9f":"code","c8563c77":"code","f34a35db":"code","58e14ca2":"code","5ecc3d69":"code","ad5afbd0":"code","eeba2d69":"code","1e9d8936":"code","87be3275":"code","80124f27":"code","90624d0f":"code","50ab7767":"code","6b255370":"code","b6364557":"markdown","97d046af":"markdown","ef33493b":"markdown","8dd98e34":"markdown","3f524d23":"markdown","f60bb347":"markdown","07f03e34":"markdown","ff9763c3":"markdown","08bfdef7":"markdown","e7aa48d8":"markdown","4cce5951":"markdown","bb031db7":"markdown","b3700aa5":"markdown","bcc36dc2":"markdown","c9b9cb50":"markdown","51ba0c68":"markdown","ccec1516":"markdown","cf1a0d10":"markdown","a8a7db96":"markdown","1bc136dc":"markdown","656c1c3f":"markdown"},"source":{"e978ac88":"#para mostrar os gr\u00e1ficos dentro do notebook\n%matplotlib inline \nimport pandas as pd \nimport matplotlib.pyplot as plt\nimport seaborn as sns\nplt.style.use('ggplot')\nplt.rcParams['figure.figsize'] = (15,5)","a6ef4775":"#carregando arquivo\nbase = pd.read_csv(\"..\/input\/gas-prices-in-brazil\/2004-2019.tsv\", sep='\\t')","8970850f":"#mostra tamanho de linhas e colunas\nprint(base.shape)\n#mostrando os 10 primeiros registros\nprint(base.head(10))\n#mostra a lista de colunas e quantos registros unicos tem em cada uma, para ter ideia do dominio dessas informa\u00e7\u00f5es\nprint(base.nunique())","2c76e14b":"#identificando os tipos de cada campo e sem tem algum registro nulo.\nprint(base.info())","becd2a45":"#algumas an\u00e1lises sobre a base\nprint(base.describe())","e23a27be":"#alterando o nome dos campos para ficar mais f\u00e1cil de usar \nbase.columns=['INDICE', 'DATA_INICIAL', 'DATA_FINAL', 'REGIAO', 'ESTADO', 'PRODUTO', 'NUM_POSTOS_PESQUISADOS',\n            'UNIDADE_MEDIDA', 'MED_REVENDA', 'DP_REVENDA', 'MIN_REVENDA', 'MAX_REVENDA', 'MGM_REVENDA', 'COEFV_REVENDA',\n            'MED_DISTRIBUICAO', 'DP_DISTRIBUICAO', 'MIN_DISTRIBUICAO', 'MAX_DISTRIBUICAO', 'COEFV_DISTRIBUICAO', 'MES', 'ANO']\nprint(base.info())","c6273224":"#altera campo objet para float\nbase['MGM_REVENDA'] = base['MGM_REVENDA'].apply(pd.to_numeric, errors='coerce')\nbase['MED_DISTRIBUICAO'] = base['MED_DISTRIBUICAO'].apply(pd.to_numeric, errors='coerce')\nbase['DP_DISTRIBUICAO'] = base['DP_DISTRIBUICAO'].apply(pd.to_numeric, errors='coerce')\nbase['MIN_DISTRIBUICAO'] = base['MIN_DISTRIBUICAO'].apply(pd.to_numeric, errors='coerce')\nbase['MAX_DISTRIBUICAO'] = base['MAX_DISTRIBUICAO'].apply(pd.to_numeric, errors='coerce')\nbase['COEFV_DISTRIBUICAO'] = base['COEFV_DISTRIBUICAO'].apply(pd.to_numeric, errors='coerce')\nprint(base.info())","41357255":"base.groupby(['ANO', 'PRODUTO']).MED_REVENDA.mean().unstack().plot()\n#utilizado o unstack() para que o agrupamento fosse mostrado em forma de tabela, sen\u00e3o ele combinaria os campos e n\u00e3o faria o plot corretamente\n#aqui tamb\u00e9m n\u00e3o foi poss\u00edvel incluir o campo ESTADO para analisar junto","3bcc42a9":"base.groupby(['PRODUTO', 'ESTADO']).MED_REVENDA.mean().unstack().plot(kind='bar')","18a6d142":"base[(base.PRODUTO != 'GLP')].groupby(['ANO', 'PRODUTO']).MED_REVENDA.mean().unstack().plot()","53171e0e":"base[(base.PRODUTO != 'GLP')].groupby(['PRODUTO', 'ESTADO']).MED_REVENDA.mean().unstack().plot(kind='bar', legend=None)","350341f3":"base[(base.PRODUTO != 'GLP')].groupby(['PRODUTO', 'REGIAO']).MED_REVENDA.mean().unstack().plot(kind='bar')","fa6ff670":"#contando registros NULOS por ano, mes, estado e produto\ncont_nulos_MED_DISTRIBUICAO = pd.DataFrame(base[(base.MED_DISTRIBUICAO.isnull())]\n                                           .groupby(['ANO', 'MES', 'ESTADO', 'PRODUTO']).\n                                           PRODUTO.count().reset_index(name=\"QTD_NULOS\"))","5bf9e473":"cont_nulos_MED_DISTRIBUICAO.groupby(['PRODUTO']).QTD_NULOS.sum().plot(kind='bar')","97d9bb4e":"# Contando o total de registros n\u00e3o-nulos\ncont_MED_DISTRIBUICAO = pd.DataFrame(base.groupby(['ANO', 'MES', 'ESTADO', 'PRODUTO'])\n                                     .MED_DISTRIBUICAO.count().dropna().reset_index(name=\"QTD\"))","7229a6d6":"cont_MED_DISTRIBUICAO.groupby(['PRODUTO']).QTD.sum().plot(kind='bar')","c924f74a":"merge_med_distr = pd.merge(cont_MED_DISTRIBUICAO, cont_nulos_MED_DISTRIBUICAO, \n                           on=['ANO', 'MES', 'ESTADO', 'PRODUTO'] , how='left')","28dbfadb":"dfsum = merge_med_distr[(merge_med_distr.PRODUTO == 'GNV')].groupby(['ANO'])['QTD', 'QTD_NULOS'].sum().plot(kind='bar', stacked=True)","7daee885":"dfsum = merge_med_distr[(merge_med_distr.PRODUTO == 'GNV')].groupby(['ESTADO'])['QTD', 'QTD_NULOS'].sum().plot(kind='bar', stacked=True)","efc4ee9a":"merge_med_distr.groupby(['ANO'])['QTD', 'QTD_NULOS'].sum().plot(kind='bar', stacked=True)","fe732538":"dfsum=merge_med_distr.groupby(['ANO'])['QTD', 'QTD_NULOS'].sum()\ndfsum['PERC_NULOS']=dfsum['QTD_NULOS']\/(dfsum['QTD']+dfsum['QTD_NULOS'])\nprint(dfsum)","9d1c2b68":"dfsum=merge_med_distr.groupby(['ESTADO'])['QTD', 'QTD_NULOS'].sum()\ndfsum['PERC_NULOS']=dfsum['QTD_NULOS']\/(dfsum['QTD']+dfsum['QTD_NULOS'])\nprint(dfsum)","707ae877":"base_agrup = pd.DataFrame(base.groupby(['ANO', 'MES', 'ESTADO','PRODUTO'])['MED_DISTRIBUICAO'].mean().unstack().unstack().unstack())","cc8eb4f4":"base_agrup.info()","98f0014c":"base_agrup.mean()","ba291ee3":"base_agrup.count()","474103e3":"base_transform = base_agrup.transform(lambda x: x.fillna(x.mean()))","a73f1b0f":"base_transform.mean()","fa7d3ce8":"base_transform.count()","8c4edf66":"base_transform.groupby(['ANO']).mean()","0e2b7d9f":"base_agrup.groupby(['ANO']).mean()","c8563c77":"base_semna = base.dropna(subset=['MED_DISTRIBUICAO'])","f34a35db":"base_semna.info()","58e14ca2":"base_f = base_semna.drop(['INDICE', 'DATA_INICIAL', 'DATA_FINAL', 'NUM_POSTOS_PESQUISADOS', 'UNIDADE_MEDIDA', \n                         'DP_REVENDA', 'MIN_REVENDA', 'MAX_REVENDA', 'COEFV_REVENDA',\n                        'DP_DISTRIBUICAO', 'MIN_DISTRIBUICAO', 'MAX_DISTRIBUICAO', 'COEFV_DISTRIBUICAO'], axis=1)","5ecc3d69":"base_f['REVsobDIS'] = ((base_f.MED_REVENDA\/base_f.MED_DISTRIBUICAO)-1)*100\nplt.plot(base_f[(base_f.PRODUTO == 'GLP')].groupby(['ANO']).MED_REVENDA.mean())\nplt.plot(base_f[(base_f.PRODUTO == 'GLP')].groupby(['ANO']).MED_DISTRIBUICAO.mean())\nplt.plot(base_f[(base_f.PRODUTO == 'GLP')].groupby(['ANO']).REVsobDIS.mean())\nplt.legend()\nplt.title('M\u00e9dia de pre\u00e7o de revenda e distribui\u00e7\u00e3o do GLP, e a margem percentual da revenda \"RevSobDis\"')\nplt.xlabel('ANO')\nplt.ylabel('M\u00e9dia em R$, REVsobDIS em %')\nplt.show()","ad5afbd0":"# plt.plot(base_f[(base_f.PRODUTO == 'GLP')].groupby(['ANO', 'REGIAO']).MED_REVENDA.mean().unstack())\n# plt.plot(base_f[(base_f.PRODUTO == 'GLP')].groupby(['ANO', 'REGIAO']).MED_DISTRIBUICAO.mean().unstack())\nplt.plot(base_f[(base_f.PRODUTO == 'GLP')].groupby(['ANO', 'REGIAO']).REVsobDIS.mean().unstack())\nplt.legend(base_f.REGIAO.unique())\nplt.title('M\u00e9dia da margem percentual do valor de revenda sobre o valor de distribui\u00e7\u00e3o do GLP por Regi\u00e3o')\nplt.xlabel('ANO')\nplt.ylabel('M\u00e9dia em %')\nplt.show()","eeba2d69":"plt.plot(base_f[(base_f.PRODUTO == 'GLP')].groupby(['ANO', 'REGIAO']).MED_REVENDA.mean().unstack())\nplt.plot(base_f[(base_f.PRODUTO == 'GLP')].groupby(['ANO', 'REGIAO']).MED_DISTRIBUICAO.mean().unstack())\nplt.legend(base_f.REGIAO.unique())\nplt.title('M\u00e9dia do pre\u00e7o de revenda e de distribui\u00e7\u00e3o do GLP por Regi\u00e3o')\nplt.xlabel('ANO')\nplt.ylabel('M\u00e9dia em R$')\nplt.show()","1e9d8936":"plt.plot(base_f.query('PRODUTO == \"GLP\" & REGIAO == \"NORTE\"').groupby(['ANO', 'ESTADO']).MED_REVENDA.mean().unstack())\nplt.legend(base_f[(base_f.REGIAO == \"NORTE\")].ESTADO.unique())\nplt.title('M\u00e9dia de pre\u00e7o de revenda do GLP por Estado, dos Estados da regi\u00e3o Norte')\nplt.xlabel('ANO')\nplt.ylabel('M\u00e9dia em R$')\nplt.ylim(20, 90)\nplt.show()","87be3275":"# plt.plot(base_f.query('PRODUTO == \"GLP\" & REGIAO == \"NORTE\"').groupby(['ANO', 'ESTADO']).MED_REVENDA.mean().unstack())\nplt.plot(base_f.query('PRODUTO == \"GLP\" & REGIAO == \"NORTE\"').groupby(['ANO', 'ESTADO']).MED_DISTRIBUICAO.mean().unstack())\nplt.legend(base_f[(base_f.REGIAO == \"NORTE\")].ESTADO.unique())\n\nplt.title('M\u00e9dia de pre\u00e7o de distribui\u00e7\u00e3o do GLP por Estado, dos Estados da regi\u00e3o Norte')\nplt.xlabel('ANO')\nplt.ylabel('M\u00e9dia em R$')\nplt.ylim(20, 90)\nplt.show()","80124f27":"plt.plot(base_f.query('PRODUTO == \"GLP\" & REGIAO == \"NORTE\"').groupby(['ANO', 'ESTADO']).REVsobDIS.mean().unstack())\nplt.legend(base_f[(base_f.REGIAO == \"NORTE\")].ESTADO.unique())\nplt.title('M\u00e9dia da margem percentual do valor de revenda sobre o valor de distribui\u00e7\u00e3o do GLP por Estado da Regi\u00e3o Norte')\nplt.xlabel('ANO')\nplt.ylabel('M\u00e9dia em %')\nplt.show()","90624d0f":"plt.plot(base_f.query('PRODUTO == \"GLP\" & REGIAO == \"SUDESTE\"').groupby(['ANO', 'ESTADO']).MED_REVENDA.mean().unstack())\nplt.legend(base_f[(base_f.REGIAO == \"SUDESTE\")].ESTADO.unique())\nplt.title('M\u00e9dia de pre\u00e7o de revenda do GLP por Estado, dos Estados da regi\u00e3o Sudeste')\nplt.xlabel('ANO')\nplt.ylabel('M\u00e9dia em R$')\nplt.ylim(20, 90)\nplt.show()","50ab7767":"plt.plot(base_f.query('PRODUTO == \"GLP\" & REGIAO == \"SUDESTE\"').groupby(['ANO', 'ESTADO']).MED_DISTRIBUICAO.mean().unstack())\nplt.legend(base_f[(base_f.REGIAO == \"SUDESTE\")].ESTADO.unique())\nplt.title('M\u00e9dia de pre\u00e7o de distribui\u00e7\u00e3o do GLP por Estado, dos Estados da regi\u00e3o Sudeste')\nplt.xlabel('ANO')\nplt.ylabel('M\u00e9dia em R$')\nplt.ylim(20, 90)\nplt.show()","6b255370":"plt.plot(base_f.query('PRODUTO == \"GLP\" & REGIAO == \"SUDESTE\"').groupby(['ANO', 'ESTADO']).REVsobDIS.mean().unstack())\nplt.legend(base_f[(base_f.REGIAO == \"SUDESTE\")].ESTADO.unique())\nplt.title('M\u00e9dia da margem percentual do valor de revenda sobre o valor de distribui\u00e7\u00e3o do GLP por Estado da Regi\u00e3o Sudeste')\nplt.xlabel('ANO')\nplt.ylabel('M\u00e9dia em %')\nplt.show()","b6364557":"Agora, comparando os valores por Regi\u00e3o d\u00e1 pra ver que a margem da Regi\u00e3o Norte \u00e9 baixa pois o valor de revenda dela \u00e9 muito alto. <br>\nEnquanto a m\u00e9dia do valor de revenda da Regi\u00e3o Sudeste est\u00e1 entre as menores e a sua margem \u00e9 a maior.\n<br>\nVou me aprofundar nos estados destes dois extremos.","97d046af":"<h1>Projeto de An\u00e1lise Explorat\u00f3ria de Dados - Pre\u00e7o dos Combust\u00edveis no Brasil<\/h1>\n<br>\nEste \u00e9 meu primeiro projeto de EDA em python. Sempre fiz EDA, mas no Excel, rs. Explorarei o <a href='https:\/\/www.kaggle.com\/matheusfreitag\/gas-prices-in-brazil\/downloads\/gas-prices-in-brazil.zip\/3'>dataset<\/a> para entender os dados e ter ideias sobre a melhor forma de utiliz\u00e1-los.\n\n<i>Este projeto faz parte de um exerc\u00edcio da aula de An\u00e1lise Explorat\u00f3ria dos Dados do curso MBA Analytics em Big Data da FIA, ago\/19.<\/i>\n<br>\n<i>Sorry, it's not in english. I'll translate it soon.<\/i>","ef33493b":"O valor muito alto do GLP est\u00e1 dificultando a visualiza\u00e7\u00e3o dos demais produtos, vou ent\u00e3o refazer os gr\u00e1ficos sem esse produto.","8dd98e34":"Neste gr\u00e1fico fica muito claro que a Regi\u00e3o Sudeste \u00e9 a que tem a maior margem dentre todas Regi\u00f5es, enquanto a regi\u00e3o Norte tem a menor margem.","3f524d23":"Agora ficou mais f\u00e1cil de ver as diferen\u00e7as. :)\n<br>\nQuando agrupamos os valores por ESTADO e PRODUTO tamb\u00e9m foi poss\u00edvel observar que cada ESTADO tem uma m\u00e9dia de pre\u00e7o um pouco diferente do outro. Portanto, al\u00e9m de agrupar por <b>PRODUTO, ANO, MES<\/b> tamb\u00e9m precisamos incluir as informa\u00e7\u00f5es de <b>ESTADO<\/b>.\n<br>\nMas ainda h\u00e1 uma quest\u00e3o em aberto. Ser\u00e1 que n\u00e3o daria para simplesmente excluir as linhas nulas?\nVou avaliar a quantidade de registros nulos e n\u00e3o-nulos para o mesmo agrupamento para ver se existe uma concentra\u00e7\u00e3o.\n<br>\nAs op\u00e7\u00f5es s\u00e3o: excluir as linhas que cont\u00e9m nulos; substituir por 0; substituir pela m\u00e9dia do grupo.","f60bb347":"A falta de informa\u00e7\u00e3o de GNV em alguns anos parece ser at\u00e9 mais que 20% do total daquele ano.","07f03e34":"Vemos que o Amazonas, historicamente, tem o menor valor de revenda de GLP entre os Estados da regi\u00e3o Norte, por\u00e9m n\u00e3o \u00e9 o menor pre\u00e7o de revenda. E tem a maior margem. O comportamento \u00e9 o mesmo que olhando as regi\u00f5es.","ff9763c3":"O Estado do Rio de Janeiro chegou a vender o GLP a quase 60% acima do pre\u00e7o de distribui\u00e7\u00e3o no ano de 2015!","08bfdef7":"Essa an\u00e1lise pode se expandir pelos demais combust\u00edveis. Continuarei a constru\u00ed-las. At\u00e9 mais!","e7aa48d8":"Podemos ver ent\u00e3o que a base possui registros das 5 regi\u00f5es brasileiras e seus 27 estados. S\u00e3o dados de 16 anos.\nExistem <b>6<\/b> tipos de combust\u00edveis (PRODUTO). Al\u00e9m disso, temos <b>m\u00e9dia, desvio padr\u00e3o, m\u00ednimo, m\u00e1ximo e coeficiente de varia\u00e7\u00e3o<\/b> para os valores de <b>revenda<\/b> e de <b>distribui\u00e7\u00e3o<\/b>. E tamb\u00e9m existe a informa\u00e7\u00e3o da <b>margem m\u00e9dia de revenda.<\/b>\n<br>\nJ\u00e1 \u00e9 uma boa indica\u00e7\u00e3o de por onde come\u00e7ar a an\u00e1lise: pre\u00e7os m\u00e9dios de revenda e distribui\u00e7\u00e3o, por data, tipo de produto e regi\u00e3o\/estado.\n<br>\nQuero entender:\n- Qual a rela\u00e7\u00e3o entre o pre\u00e7o m\u00e9dio de revenda e o pre\u00e7o m\u00e9dio de distribui\u00e7\u00e3o?\n- Isso muda de acordo com o tempo?\n- \u00c9 diferente entre as regi\u00f5es?\n- Muda de Estado para Estado?\n- Qual o comportamento dos valores para cada tipo de combust\u00edvel?","4cce5951":"Ops, aqui temos que tratar os dados de <i>distribui\u00e7\u00e3o<\/i> pois est\u00e3o como \"object\" (que \u00e9 como o pandas trata uma string) e por isso n\u00e3o apareceram nas an\u00e1lises quando usamos o .describe(). Precisamos converter para float.\nFarei isso e vou ajustar o nome das colunas tamb\u00e9m.","bb031db7":"Precisei utilizar v\u00e1rios unstack para que o fillna preenchesse os valores de acordo com o agrupamento de mes, estado e produto. Ele aplicou a mesma m\u00e9dia deste grupo de vari\u00e1veis m\u00e9dia para todos que estavam vazios. N\u00e3o consegui inserir o ano como vari\u00e1vel. E tamb\u00e9m ficou bem dific\u00edl de usar a base resultante.","b3700aa5":"Nos Estados de Goias, Piaui, e outros, a maioria dos registros est\u00e3o nulos!\n<br>\nVou dar uma olhada na base toda.","bcc36dc2":"Agora com a base sem nulos, vamos dar uma olhada nos valores de revenda e distribui\u00e7\u00e3o.","c9b9cb50":"Olhando apenas os valores m\u00e9dios de revenda e distribui\u00e7\u00e3o do GLP, vemos que o pre\u00e7o tem crescido muito nos \u00faltimos anos. Por\u00e9m, analisando o pre\u00e7o de revenda versus o pre\u00e7o de distribui\u00e7\u00e3o, vemos que a margem da revenda vem crescendo tamb\u00e9m, e n\u00e3o apenas o valor em si. Esse crescimento cessou a partir de 2018.","51ba0c68":"Uma vez com os dados importados, vou avaliar o que existe dentro da base.","ccec1516":"Aqui fica claro que o pre\u00e7o m\u00e9dio de revenda muda de acordo com o per\u00edodo observado, e que o GLP tem valor muito diferente dos demais. Portanto n\u00e3o \u00e9 correto simplesmente alterar os valores nulos pela m\u00e9dia geral, teria que ser no m\u00ednimo por <b>PRODUTO e ANO, MES<\/b>.\nVamos verificar por <b>ESTADO<\/b> agora.","cf1a0d10":"Outra op\u00e7\u00e3o seria dropar as linhas que cont\u00e9m informa\u00e7\u00f5es NaN na coluna MED_DISTRIBUICAO usando a fun\u00e7\u00e3o: dropna(subset=['MED_DISTRIBUICAO'])\n<br>\nTestarei essa op\u00e7\u00e3o agora.","a8a7db96":"Podemos ver que os registros nulos est\u00e3o concentrados em GNV e GLP. GNV \u00e9 o combust\u00edvel que tem menos registros no total.","1bc136dc":"Ap\u00f3s a convers\u00e3o, a quantidade de registros n\u00e3o-nulos caiu, ou seja, temos alguns nulos agora.\nVamos dar uma olhada nos dados para ver qual melhor maneira de tratar esses n\u00fameros nulos, e onde eles se concentram. ","656c1c3f":"Com tantos dados nulos, escolhi por aplicar a m\u00e9dia nos valores nulos ao inv\u00e9s de simplesmente exclu\u00ed-los e ficar sem informa\u00e7\u00e3o em alguns estados."}}