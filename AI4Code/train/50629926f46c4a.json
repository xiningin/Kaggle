{"cell_type":{"77f5a46f":"code","13202f10":"code","92ef534a":"code","4a680924":"code","8e248210":"code","579daf92":"code","58d7f619":"code","cef64863":"code","70c9ac8c":"code","a6bce86b":"code","4bfc424f":"code","ab09d768":"code","85f81a51":"code","b8da90bf":"code","f3322dca":"code","ee5df7db":"code","2a9b7ca4":"code","bc0e890e":"code","519227b4":"code","9ef5ab29":"code","8c245d0f":"code","a23a50b7":"code","34c8c29d":"code","23117718":"code","3c567569":"code","f8c54a5c":"code","5c3f3409":"code","29821845":"code","d61f60da":"code","d32fee48":"code","399c3ae4":"code","dfb1877e":"code","b569dd56":"code","fedec378":"code","d9164e73":"markdown","ead460c8":"markdown","58e496ce":"markdown","c1343972":"markdown","1b62e48e":"markdown","126211b2":"markdown","89cebf35":"markdown","2c9d2f28":"markdown","24a384e5":"markdown","939aca37":"markdown","c0e99ec6":"markdown","a59b8eeb":"markdown","6607f415":"markdown","8470b0cb":"markdown","192a4f18":"markdown","fb5ac9be":"markdown","2c43fd2b":"markdown","394ec794":"markdown"},"source":{"77f5a46f":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport matplotlib.dates as mdates\nimport seaborn as sns\nfrom matplotlib import style\nstyle.use('ggplot')","13202f10":"index_data=pd.read_csv('..\/input\/index-data\/Sensex.csv',)\nindex_data.head()","92ef534a":"index_data.tail()","4a680924":"index_data['Close'].tail()","8e248210":"fig,ax=plt.subplots(figsize=(12,4))\n\nax.plot(index_data['Date'],index_data['Close'])\nax.set(xlabel='Date',ylabel='Sensex Closing',title='Daily Index Movement')\nax.xaxis.set_major_locator(mdates.YearLocator())","579daf92":"index_returns=index_data['Close'].pct_change()\nindex_returns.head()","58d7f619":"type(index_returns)","cef64863":"nornal_returns=(np.random.normal(0,index_returns.dropna().std(),1294))","70c9ac8c":"fig,ax=plt.subplots()\nsns.kdeplot(index_returns.dropna(),ax=ax);\nsns.kdeplot(nornal_returns,color='b',ax=ax);","a6bce86b":"sns.displot(index_returns.dropna(),kind='kde');","4bfc424f":"index_returns.plot(kind='box');","ab09d768":"outlier_data=index_data[(index_returns<-0.05) | (index_returns>0.05)]\noutlier_data","85f81a51":"outlier_data=outlier_data.reset_index()","b8da90bf":"outlier_data","f3322dca":"outlier_data['Previous Close']=0\noutlier_data","ee5df7db":"for i in range(len(outlier_data)):\n    outlier_data.iloc[i,6]=index_data.iloc[outlier_data['index'][i]-1]['Close']","2a9b7ca4":"outlier_data","bc0e890e":"last_price=index_data['Close'].iloc[-1]","519227b4":"last_price","9ef5ab29":"num_simulations=1000\nnum_days=252","8c245d0f":"simulated_data=pd.DataFrame()","a23a50b7":"for x in range(num_simulations):\n    count=0\n    daily_volatility=index_returns.std()\n    \n    price_series=[]\n    \n    price=last_price*(1+np.random.normal(0,daily_volatility))\n    price_series.append(price)\n    \n    for y in range(num_days):\n        if count==251:\n            break\n        price=price_series[count]*(1+np.random.normal(0,daily_volatility))\n        price_series.append(price)\n        count+=1\n    \n    simulated_data[x]=price_series","34c8c29d":"fig=plt.figure()\nfig.suptitle('Monte Carlo Simulation Sensex')\nplt.plot(simulated_data)\nplt.axhline(y=last_price,color='r',linestyle='-')\nplt.xlabel('Day')\nplt.ylabel('Index level')","23117718":"fig, ax = plt.subplots()\nfor i in range(50):\n    sns.kdeplot(simulated_data[i].pct_change().dropna(),ax=ax)","3c567569":"import scipy\nalpha=scipy.stats.norm.ppf(0.95)\nalpha","f8c54a5c":"position=100000\nvar=position*index_returns.dropna().std()*alpha\nvar","5c3f3409":"daily_volatility=index_returns.std()\nprint(f'Daily Volatality of the markt index returns is {daily_volatility} %')\nprint(f'Daily Volatality of the markt index returns is {(((1+daily_volatility)**12)-1)*100} %')","29821845":"# If the market index return volatality increased to 20%\ndaily_vol_20=((0.20+1)**(1\/12))-1\nprint(f'For yearly volatility of the market index returns of 20%,\\nthe daily volatility of the index returns is {daily_vol_20}')\nvar_20=position*daily_vol_20*alpha\nprint(f'Daily VaR at yearly volatality of 20% is {var_20}')","d61f60da":"# If the market index return volatality increased to 20%\ndaily_vol_25=((0.25+1)**(1\/12))-1\nprint(f'For yearly volatility of the market index returns of 25%,\\nthe daily volatility of the index returns is {daily_vol_25}')\nvar_25=position*daily_vol_25*alpha\nprint(f'Daily VaR at yearly volatality of 20% is {var_25}')","d32fee48":"simulated_volatality=pd.DataFrame(columns=['simulated_volatality','simulated_var'])","399c3ae4":"for x in range(num_simulations):\n    simulated_volatality.loc[x,'simulated_volatality']=simulated_data.iloc[:,x].pct_change().std()\n    simulated_volatality.loc[x,'simulated_var']=position*simulated_volatality.loc[x,'simulated_volatality']*alpha","dfb1877e":"simulated_volatality.head()","b569dd56":"plt.plot(simulated_volatality['simulated_var']);","fedec378":"mean_simulated_var=np.mean(simulated_volatality['simulated_var'])\nstand_dev_simulated_var=np.std(simulated_volatality['simulated_var'])\nprint(f'Simulated average daily VaR is {mean_simulated_var} with standard deviation of {stand_dev_simulated_var}')","d9164e73":"#### In simulation section we took stand. dev. of daily closing prices are measure of volatality to simulate the future prices. However what if the daily volatality increases ? How much the additinal capital the bank need to support its positions ?","ead460c8":"#### VaR is the additional capital we would need to support the position. In our example, to keep the long position of 100,000 we need capital of 1912","58e496ce":"### VaR Simulation","c1343972":"##### VaR = position X stand dev of stock or index returns X z score for 0.95","1b62e48e":"#### The first look at the index return shows that the daily Sensex returns are approximately normally distributed however there are outliers\n#### For VaR calculation, the assumption is that the returns are normally distributed. Is it safe to use normal distribution to approximate stock or market index returns ?\n#### Distribution of daily index returns are rather symmetric about it's mean, but the tails are fatter, that is more outliers, than what would be expected with the normal distribution.","126211b2":"##### Outlier data can be further investigated for the reason for the daily returns more than +\/- 5%","89cebf35":"##### We wanted to know how much the market could possibly move against our position. VaR can be interpreated as - we are 95% confident that the daily loss would not exceed the VaR amount, calculated as below ","2c9d2f28":"### Simulation","24a384e5":"### VaR - Value At Risk","939aca37":"### Motivation - \n##### Why risk management is to crucial in banking business and how banking risk management is different from other businesses ?\n##### Leverage = Capital\/Total Assets. As per the Bassel 2 norms leverage should be at least 4%.\n##### If bank's losses excceds 4% of the total assets, that is, if the bank in not able to recover at least 96% of the loans or asset value losses more than 4%, then the bank will be burst. Looking that the bank's role in the economy, banks should be protected. Hence robust risk management is required.  ","c0e99ec6":"### Stress Testing","a59b8eeb":"### Data Setup and EDA","6607f415":"##### If daily volatality increase by 5%, 10%; what would be the VaR ? That is how much additinal capital the bank would need to support its position ?","8470b0cb":"### Conclusion : The techniques of simulations and synthesizing data are invaluable in generating and testing hypothesis about the data. In this case we simulated the market index data and tried to find how much capital a bank should keep aside to fund its position. This can be utilized for optimum capital allocation.  ","192a4f18":"#### The box plot highlights the fact that there are significant outliers","fb5ac9be":"### Risk management workflow\n#### Identify > Quantify > Mitigate","2c43fd2b":"#### distribution of returns of the first 50 simulated samples","394ec794":"##### Types of risks associated with the banking business - Market risk, Credit risk, Liquidity risk, Solvency risk etc.\n##### We use different analytical tools to quantify the different risks\n##### We will discuss market risk in this notebook "}}