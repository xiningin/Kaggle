{"cell_type":{"4a6b5b09":"code","8ab967e0":"code","2ca63ac7":"code","ca8c5be6":"code","0cf38583":"code","2bb491d7":"code","dedf591b":"code","454644a6":"code","805897d5":"code","1063d7ed":"code","b3fda4ef":"code","b762f8f5":"code","5d413321":"code","4bd30df2":"code","54c41db9":"code","49e5717b":"code","9a66ee2b":"code","634e7efa":"code","d7655212":"code","aa70e65f":"code","1f62f672":"code","fc7977c7":"code","29f9a2b2":"code","eaabc1d0":"code","0ea9f806":"code","23f4d15c":"code","05487e29":"code","6de83636":"code","08f35f1f":"code","b7c8307d":"markdown","6d6c9ad2":"markdown","f20189fb":"markdown","a7081606":"markdown","1c0622b5":"markdown","bc66a07f":"markdown","f1e8e04a":"markdown","d3feaaf1":"markdown","8524182d":"markdown","a2645d7c":"markdown","b79e958a":"markdown","7af62f3a":"markdown","9229649b":"markdown","ab09fce3":"markdown","302dcaf0":"markdown","c580b138":"markdown","7589cc56":"markdown","bebf5da1":"markdown","bb03430f":"markdown","c7d7415a":"markdown","8fbf4787":"markdown","d0e5acf3":"markdown","1a5d2499":"markdown","97cfa21f":"markdown","6e702157":"markdown","9003fa1d":"markdown","40db54ab":"markdown","661f771b":"markdown","5a3cc40a":"markdown","71b5acb4":"markdown","cb67a6d3":"markdown","efdc7524":"markdown","48f69fa8":"markdown","4506500c":"markdown","a7f0ce00":"markdown","74661e9b":"markdown","3f7e0fa9":"markdown","62718482":"markdown"},"source":{"4a6b5b09":"import numpy as np \nimport pandas as pd \n\nimport os\n\nfiles_wanted = ['movies_metadata.csv']\nfile_paths = list()\n\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n     for filename in filenames:\n            if filename in files_wanted:\n                file_paths.append(str(dirname + \"\/\" + filename))\nmeta_df = pd.read_csv(file_paths[0], low_memory=False)","8ab967e0":"meta_df.head()","2ca63ac7":"meta_df.shape","ca8c5be6":"meta_df.drop(['belongs_to_collection', 'homepage', 'tagline', 'poster_path', 'overview', 'imdb_id', 'spoken_languages'], inplace=True, axis=1)\n\ncolumn_changes = ['production_companies', 'production_countries', 'genres']\n\njson_shrinker_dict = dict({'production_companies': list(), 'production_countries': list(), 'genres': list()})\n\nmeta_df.dropna(inplace=True)","0cf38583":"import ast","2bb491d7":"for col in column_changes:\n    if col == 'production_companies':\n        for i in meta_df[col]:\n            i = ast.literal_eval(i)\n            if len(i) < 1:\n                json_shrinker_dict['production_companies'].append(None)\n\n            for element in i:\n                json_shrinker_dict['production_companies'].append(element['name'])\n                break\n    elif col == 'production_countries':\n        for i in meta_df[col]:\n            i = ast.literal_eval(i)\n            if len(i) < 1:\n                json_shrinker_dict['production_countries'].append(None)\n            for element in i:\n                json_shrinker_dict['production_countries'].append(element['iso_3166_1'])\n                break\n    else:\n        for i in meta_df[col]:\n            i = ast.literal_eval(i)\n            if len(i) < 1:\n                json_shrinker_dict['genres'].append(None)\n\n            for element in i:\n                json_shrinker_dict['genres'].append(element['name'])\n                break\n\nfor i in column_changes:\n    meta_df[i] = json_shrinker_dict[i]\n\nmeta_df.dropna(inplace=True)\n\nmeta_df['budget'] = meta_df['budget'].astype(int)","dedf591b":"meta_df.head()","454644a6":"meta_df.shape","805897d5":"import plotly.express as px\nimport plotly.graph_objs as go\nfrom plotly.offline import init_notebook_mode, iplot, plot\ninit_notebook_mode(connected=True)","1063d7ed":"fig = px.scatter(meta_df, x='budget', y='revenue', hover_data=['title'], color='genres', width=800, height=800)\nfig.update_layout(\n    title='The Relationship between Budget and Revenue',\n    xaxis_title='Budget',\n    yaxis_title='Revenue',\n    font=dict(\n        size=16\n    )\n)\niplot(fig)","b3fda4ef":"genre_budget_df = meta_df.groupby(['genres'])['budget'].sum()\n\nfig = go.Figure([\n    go.Bar(\n        x=genre_budget_df.index,\n        y=genre_budget_df.values,\n        text=genre_budget_df.values,\n        textposition='auto',\n        marker_color=['#94447f',\n                      '#5796ef',\n                      '#8a59c0',\n                      '#288abf',\n                      '#0ab78d',\n                      '#4ed993',\n                      '#7d3970',\n                      '#b3dc67',\n                      '#dc560a',\n                      '#0079fe',\n                      '#98d3a8',\n                      '#d5105a',\n                      '#d04dcf',\n                      '#58c7a2',\n                      '#7bf1f8',\n                      '#244155',\n                      '#587b77',\n                      '#c64ac2',\n                      '#5e805d',\n                      '#ebab95']\n    )])\n\nfig.update_layout(\n    title='Sum of all Movie Budgets in each Genre',\n    xaxis_title='Genre',\n    yaxis_title='Total Budget',\n    width=800,\n    height=1000,\n    font=dict(\n        size=16\n    )\n)\n\nfig.layout.template = 'seaborn'\n\niplot(fig)","b762f8f5":"fig = px.scatter(meta_df, x='budget', y='runtime', hover_data=['title'], color='genres', width=800, height=800)\nfig.update_layout(\n    title='The Relationship between Budget and Movie Runtime',\n    xaxis_title='Budget',\n    yaxis_title='Runtime',\n    font=dict(\n        size=16\n    )\n)\n\niplot(fig)","5d413321":"fig = px.scatter(meta_df, y='runtime', x='revenue', hover_data=['title'], color='genres', width=800, height=800)\nfig.update_layout(\n    title='The Relationship between Runtime and Movie Revenue',\n    yaxis_title='Runtime',\n    xaxis_title='Revenue',\n    font=dict(\n        size=16\n    )\n)\n\niplot(fig)","4bd30df2":"fig = go.Figure(go.Box(\n    y=meta_df['vote_count']\n    \n))\n\nfig.update_layout(\n    title='Vote Count Distribution',\n    yaxis_title='Vote Count',\n    width=800,\n    height=800\n)\n\niplot(fig)","54c41db9":"meta_df = meta_df[meta_df['vote_count'] >= meta_df['vote_count'].quantile(.75)]\nfig = go.Figure(go.Box(\n    y=meta_df['vote_count']\n))\n\nfig.update_layout(\n    title='Vote Count Distribution',\n    yaxis_title='Vote Count',\n    width=800,\n    height=800\n)\n\niplot(fig)","49e5717b":"from sklearn.cluster import KMeans\nfrom sklearn.preprocessing import MinMaxScaler","9a66ee2b":"scalar = MinMaxScaler()\n\nscaled_df = meta_df[['budget', 'popularity', 'revenue', 'runtime', 'vote_average', 'vote_count']]\n\nsmaller_df = scaled_df.copy()\n\nscaled = scalar.fit_transform(meta_df[['budget', 'popularity', 'revenue', 'runtime', 'vote_average', 'vote_count']])\n\nscaled_df = pd.DataFrame(scaled, index=scaled_df.index, columns=scaled_df.columns)\n\nscaled_df.head()","634e7efa":"def apply_kmeans(df, clusters):\n    kmeans = KMeans(n_clusters=clusters, random_state=0)\n    cluster_labels = kmeans.fit(df).labels_\n    string_labels = [\"c{}\".format(i) for i in cluster_labels]\n    df['cluster_label'] = cluster_labels\n    df['cluster_string'] = string_labels\n\n    return df","d7655212":"def param_tune(df):\n    scores = {'clusters': list(), 'score': list()}\n    for cluster_num in range(1,31):\n        scores['clusters'].append(cluster_num)\n        scores['score'].append(KMeans(n_clusters=cluster_num, random_state=0).fit(df).score(df))\n\n    scores_df = pd.DataFrame(scores)\n\n    fig = go.Figure(go.Scatter(\n        x=scores_df['clusters'],\n        y=scores_df['score']\n    ))\n\n    fig.update_layout(\n        xaxis_title='Cluster',\n        yaxis_title='Score',\n        title='Elbow Method Results',\n        height=800,\n        width=800\n    )\n\n    fig.show()\n\n    return 9","aa70e65f":"clusters = param_tune(scaled_df)\n\nscaled_df = apply_kmeans(scaled_df, clusters)","1f62f672":"smaller_df = smaller_df.join(scaled_df[['cluster_label', 'cluster_string']])\nsmaller_df = smaller_df.join(meta_df[['title', 'genres']])\n\nsmaller_df.head()","fc7977c7":"import seaborn as sns\nimport matplotlib.pyplot as plt\nimport matplotlib.style as style","29f9a2b2":"style.use('seaborn-poster')\nfig, ax = plt.subplots(1,1)\ncluster_comb = smaller_df.groupby(['cluster_label'])['title'].count()\nsns.barplot(y=cluster_comb.index, x=cluster_comb.values, orient='h', palette=\"Spectral\",\n            edgecolor='black', linewidth=1)\nplt.ylabel(\"Cluster\", fontsize=18)\nplt.xlabel(\"Records\", fontsize=18)\nplt.title(\"Records in Each Cluster\", fontsize=20)\nax.spines['top'].set_visible(False)\nax.spines['right'].set_visible(False)\nplt.show()","eaabc1d0":"fig = px.scatter_matrix(smaller_df, dimensions=['budget', 'popularity', 'revenue', 'runtime', 'vote_average', 'vote_count'],\n                        color='cluster_string', hover_data=['title', 'genres'])\nfig.update_layout(\n    title='Cluster Scatter Matrix',\n    height=1000,\n    width=800\n)\n\niplot(fig)","0ea9f806":"clusters = list(smaller_df['cluster_label'].unique())\ncluster_dict = dict()\n\ncluster_count = 0\nfor col in range(3):\n    for row in range(3):\n        cluster_df = smaller_df[smaller_df.cluster_label == clusters[cluster_count]]\n        cluster_dict[\"{},{}\".format(str(col), str(row))] = cluster_df['genres'].value_counts()\n        cluster_count += 1\n\ncluster_count = 0\n\nfig, axs = plt.subplots(3, 3, figsize=(15,15))\n\nfor col in range(3):\n    for row in range(3):\n        coord = \"{},{}\".format(str(col), str(row))\n\n        sns.barplot(y=cluster_dict[coord].index, x=cluster_dict[coord].values, orient='h',\n                    palette={'Drama': '#94447f',\n                             'Action': '#5796ef',\n                             'Adventure': '#8a59c0',\n                             'Comedy': '#288abf',\n                             'Crime': '#0ab78d',\n                             'Thriller': '#4ed993',\n                             'Fantasy': '#7d3970',\n                             'Horror': '#b3dc67',\n                             'Science Fiction': '#dc560a',\n                             'Animation': '#0079fe',\n                             'Romance': '#98d3a8',\n                             'Mystery': '#d5105a',\n                             'Family': '#d04dcf',\n                             'War': '#58c7a2',\n                             'History': '#7bf1f8',\n                             'Western': '#244155',\n                             'TV Movie': '#587b77',\n                             'Music': '#c64ac2',\n                             'Documentary': '#5e805d'}, edgecolor='black', linewidth=0.9, ax=axs[col][row])\n\n        title = \"Cluster {}'s Genre Distribution\".format(cluster_count)\n        axs[col][row].set_title(title, fontsize=15, fontweight='bold')\n        cluster_count += 1\nplt.tight_layout()\nplt.show()","23f4d15c":"drama_df = smaller_df[(smaller_df.genres == 'Drama') & (smaller_df.cluster_label.isin([0, 1, 2, 5]))]\ndrama_df = drama_df.sort_values('cluster_label')\n\nfig = px.violin(drama_df, y='revenue', x='cluster_string', color='cluster_string', points='all', hover_data=drama_df)\n\nfig.update_layout(\n    title='Revenue Distribution in Drama Movies',\n    yaxis_title='Revenue',\n    xaxis_title='Cluster',\n    height=1000,\n    width=800\n)\n\niplot(fig)\n","05487e29":"fig = px.violin(drama_df, y='vote_average', x='cluster_string',\n                    color='cluster_string', points='all', hover_data=drama_df)\n\nfig.update_layout(\n    title='Vote Average Distribution in Drama Movies',\n    yaxis_title='Vote Average',\n    xaxis_title='Cluster',\n    height=1000,\n    width=800\n)\n\niplot(fig)","6de83636":"drama_df = smaller_df[(smaller_df.genres == 'Drama')]\ndrama_df = drama_df.sort_values('cluster_label')\nfig = px.violin(drama_df, y='vote_average', x='cluster_string',\n                color='cluster_string', points='all', hover_data=drama_df)\n\nfig.update_layout(\n    title='Vote Average Distribution in Drama Movies',\n    yaxis_title='Vote Average',\n    xaxis_title='Cluster',\n    height=1000,\n    width=800\n)\n\niplot(fig)","08f35f1f":"drama_df = smaller_df\ndrama_df = drama_df.sort_values('cluster_label')\nfig = px.violin(drama_df, y='vote_average', x='cluster_string',\n                color='cluster_string', points='all', hover_data=drama_df)\n\nfig.update_layout(\n    title='Vote Average Distribution in all Movies',\n    yaxis_title='Vote Average',\n    xaxis_title='Cluster',\n    height=1000,\n    width=800\n)\n\niplot(fig)","b7c8307d":"Really interesting. It seems that my hypothesis was correct. Although this is for Drama movies within these select clusters. Let's add in all clusters and see if this trend says prevalent","6d6c9ad2":"## Parsing JSONs\n* It got complicated because some jsons had multiple name \/ genre values.\n    * While looking at some, I noticed that it wasn't alphabetical. So I assumed if a movie had genres, Action, Drama, Thriller, Action was the \"main\" genre. I could be wrong, but no explanations were given\n    * To solve this issue, I just took the first one\nLet's import what we need","f20189fb":"## Looking at Drama in it's significant clusters","a7081606":"## Budget and Runtime","1c0622b5":"I was surprised see that Drama was second. I not much of a drama movie kind of guy I guess.","bc66a07f":"I find it interesting that Drama and Action movies seem to be the top in several clusters. This could be that there is just a larger quantity of these movies in the data set, but then why is Drama's count so low in Cluster 7 and 8?\nFrom these results, I'd like to next compare specific movies within the Drama and Action genres within several clusters and find the similarities \/ differences.","f1e8e04a":"I have two methods which I'll hide above this cell, but essentially this is what they do:\n* param_tune: Works as a grid search to find optimal K betw (uses elbow)\n* apply_kmeans: Takes optimal k found from param_tune, generates cluster labels, and appends it to the dataframe","d3feaaf1":"So the distribution of records in the cluster does not seem to be even. There are a lot of records in clusters 0 and 2 for some reason.","8524182d":"# Conclusion\nThank you for taking the time to check out my notebook. If you have any criticisms of any kind, feel free to mention them. ","a2645d7c":"# Data Cleaning\n* I will remove the one's I absolutely will never need\n* There are some jsons that I want to parse (production_companies, production_countries, & genres)\n* Drop null values","b79e958a":"Notice I dropped null values again. This is because some JSONs were empty, but the were not NaNs. Instead, they looked like this in a row  \"[]\".  \nOverall we lost about ~12,000 rows.","7af62f3a":"Let's import what is needed","9229649b":"Let's look at our data","ab09fce3":"# EDA","302dcaf0":"# Clustering","c580b138":"It doesn't seem like there's any special indications of why clusters are the way they are on this graph alone...but  \nsince plotly gives me the entire row data when I hover over a point, I was able to find out that every cluster's vote average range is usually within 1 point.  \n  \nLet's explore that idea next.","7589cc56":"Now we have our data clustered and can explore it some more.","bebf5da1":"## Budget and Revenue","bb03430f":"Pretty interesting to see that theres almost somewhat of a linear trend with Budget and Revenue.\nThis trend runs to a certain extend, though. I does make sense that budget and revenue would have a trend though. Better directors, better actors, better effects team, etc.","c7d7415a":"While looking around at all my data that I didn't think was significant enough to graph, I ran into this:","8fbf4787":"## Vote Average Distribution for Drama Movies in all Clusters ","d0e5acf3":"## Cluster Cardinality","1a5d2499":"## KMeans Clustering","97cfa21f":"I was surprised by the result. I expected the runtimes of movies to increase with budget significantly (it does a little). The way I saw it was that a larger budget would be needed to pay for all the services that take time. So when we look at an editing process of a movie: The more time needed to spend editing something, the more money. It does increase a little, but not by a lot. It seems that all movies like that sweetspot of ~100-200 minutes for a movie.","6e702157":"Within the drama category, vote average definitely seems to have an influence on which cluster the movie will go to. Although some clusters like 3 & 4 are hard to differentiate why one movie would be in one cluster over the other.  \n  \nLet's see how all genres fall under this hypothesis","9003fa1d":"Considering what we just saw with vote count, it is safe to say our data is not evenly distributed.  \nFor that reason, I think it is best to use the MinMaxScaler from sklearn to normalize our data\nLet's import what we need","40db54ab":"So while the clusters still have some distinction regardless of genre, the mins and maxes of the vote average increased for every cluster. This means there must be some more variables determining our clusters.","661f771b":"In my mind, for a rating to be credible, it needs a significant amount of votes. It is like saying that ONE 5 star rating means that a product is good. It's possible, but you can't take just one persons word for granted like that. On the other hand, a product with FIFTY 5 star reviews would make me trust the product a bit more (not including bots that favorite things).\nI basically got rid of everything before the 3rd quartile (~58 votes per movie). ","5a3cc40a":"I kind of expected this result because who wants to watch a 900 minute movie? My favorite movie of all time right now is Intersellar, and I felt like that movie was really long already!","71b5acb4":"That's better. In all, this will help our clustering algorithm in the long run.","cb67a6d3":"# Abstract\n* Small EDA\n* KMeans Clustering\n* Analysis of the clusters (Work in Progress)","efdc7524":"## Vote Average Distribution in all Movie Genres","48f69fa8":"I noticed that this JSON payload was pretty nasty. The quotes were single quotes instead of double quotes. I used the AST library to be able to interpet the json properly.\nThe naive approach was to replace all single quotes with double quotes, but some of the strings have a single quote that stands for an accent. So \"L'Hotel\" for example would cause an error.","4506500c":"## Genres and Budgets","a7f0ce00":"My plan is to:\n  \nCluster -> Get cluster labels -> Join cluster labels with old df","74661e9b":"## Scatter Matrix","3f7e0fa9":"What I find notable is notice cluster 3. It is usually on the high end of values for all the features. Cluster 3 is also the cluster with the least records in it. This definitely means there is some sort of trend going on in cluster 3 (really cool to me)","62718482":"## Trying to Find Some Meaning of the Clusters"}}