{"cell_type":{"55723eab":"code","aba11b0b":"code","cc946896":"code","f60132e0":"code","beda46bf":"code","1fbce556":"code","c6641116":"code","37925ae2":"code","8af095e2":"code","c14b7b71":"markdown","5fdc0a8c":"markdown","89f36ad0":"markdown","d48625ce":"markdown","2aa70855":"markdown","8f95b804":"markdown"},"source":{"55723eab":"%matplotlib inline","aba11b0b":"import math\n\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set(font_scale=0.9)","cc946896":"data = pd.read_csv('\/kaggle\/input\/cat-in-the-dat\/train.csv', index_col='id')\nhmap_options = dict(annot=True, linewidths=1, square=True)\nprior = data.target.mean()","f60132e0":"plt.figure(figsize=(12, 4))\n\nplt.subplot(121)\n(data.groupby('day').target.mean() - prior).plot.bar()\nplt.ylabel('cat prob. relative to prior')\n\nplt.subplot(122)\n(data.groupby('month').target.mean() - prior).plot.bar()\nplt.ylabel('cat prob. relative to prior')\n\nplt.tight_layout()","beda46bf":"def fix_ylim():\n    # seaborn+matplotlib bug workaround\n    ymin, ymax = plt.ylim()\n    plt.ylim(math.ceil(ymin), math.floor(ymax))\n    \ndef cyclic(series, start, size):\n    angle = 2 * np.pi * (series - start) \/ size\n    sin = pd.Series(np.sin(angle), index=angle.index, name=f'sin {series.name}')\n    cos = pd.Series(np.cos(angle), index=angle.index, name=f'cos {series.name}')\n    return pd.concat([sin, cos], axis=1)","1fbce556":"h = data.groupby(['month', 'day']).target.count().unstack('month')\nplt.figure(figsize=(8, 5.5))\nsns.heatmap(h, cmap='Blues', fmt='d', cbar=False, **hmap_options)\nplt.suptitle('Sample size')\nfix_ylim()\nplt.tight_layout()","c6641116":"m = data.groupby(['month', 'day']).target.mean() - prior\nm = m.unstack('month')\nm[6] = (m[5] + m[7]) \/ 2\nm = m.stack().unstack('day')\nm[6] = (m[5] + m[7]) \/ 2\nm = m.stack().unstack('month')","37925ae2":"plt.figure(figsize=(12, 6))\nsns.heatmap(m, cmap='Spectral_r', fmt='.1%', **hmap_options)\nfix_ylim()","8af095e2":"df = m.stack().reset_index().rename({0: 'target'}, axis=1)\n\ndf2 = cyclic(df.month, 1, 12)\ndf3 = cyclic(df.day, 1, 7)\n\ndf2['sin month'] += 0.14 * df3['sin day']\ndf2['cos month'] += 0.14 * df3['cos day']\n\nplt.figure(figsize=(7, 7))\nsp_options = dict(palette='Spectral_r', vmin=-0.1, vmax=0.1, legend=False, s=400)\nsns.scatterplot(x='sin month', y='cos month', hue=df['target'], data=df2, **sp_options)\nplt.axis('off')\nplt.tight_layout()\n\nmonths = pd.Series(np.arange(1, 13), name='month')\nmonth_xy = cyclic(months, 1, 12).set_index(months)\n\nfor month in months:\n    xy = tuple( month_xy.loc[month] - [0.04, 0.03] )\n    plt.annotate(f'{month:2d}', xy=xy)\n","c14b7b71":"Column(Row) 6 will be replaced by average values of column(row) 5 and 7.","5fdc0a8c":"`month` and `day` data are suposed to follow a cyclic pattern.","89f36ad0":"`day`'s cyclic pattern is still present. It changes with each month as expected from the independence of variables.","d48625ce":"Let's analyze `target` distribution looking at `day` and `month`. First, checking the sample size grouped by `month` and `day` we observe a low amount of observations for both day and month 6.","2aa70855":"By replacing the month data with twelve well-defined cycles we can compensate for the lack of information about month and day 6.","8f95b804":"`day` has a clear cyclic pattern but that can't be said about `month` data."}}