{"cell_type":{"84e92ecd":"code","577a29b0":"code","1a8e8c19":"code","b5b0127b":"code","2af9d232":"code","bf0323ab":"code","9bd14a8c":"code","1ed5d69e":"code","92c20893":"code","cc88f823":"code","20adc0d1":"code","9a4b391f":"code","181d270d":"code","86711b40":"code","87195e6b":"code","15a1bb32":"code","b77dd3aa":"code","42fbd657":"code","0c91e977":"code","5654c7d6":"code","2c3e4caf":"code","916fa63e":"code","6d8fbe05":"code","2b038ae8":"code","3727aadc":"code","30af7b87":"code","65e79948":"code","e370497c":"code","d0314e12":"code","b3b664bf":"code","75f63b37":"code","b9ada314":"code","7b0c39fd":"code","10250304":"code","b350d228":"code","7a2f1605":"code","809bb2a0":"code","11ed86e9":"code","c05bbf67":"code","baa15143":"code","c01d0e9a":"code","3f5d3db6":"code","dd6e340d":"code","c8b2e0b0":"code","fb41566b":"code","39d44ab2":"code","29e66b6a":"code","4fb68682":"code","b8c8493a":"code","84a67b78":"code","b8c23353":"code","60a1760f":"code","c311e49d":"code","5f027520":"code","a3b00802":"code","d90b5c4d":"code","3cf08626":"code","92bf8388":"code","74c135ec":"code","66f9e3c2":"code","a4c78445":"code","e46cbf03":"code","b2b6b65a":"code","ea722fc1":"code","32d376bc":"code","0bb2d28c":"code","d4d3e128":"code","4bea98c5":"code","1a6f8bfd":"code","fe241ba5":"code","2371b4c6":"markdown","364bce69":"markdown","de3dca2c":"markdown","1785a14b":"markdown","0aec442d":"markdown","b3e7f2ac":"markdown","9db63da4":"markdown","22319b4d":"markdown","dd277e6a":"markdown","447fc5bd":"markdown","4ee7a0d1":"markdown","4fde7be3":"markdown","3192d037":"markdown","fda566d4":"markdown","f21d9955":"markdown","44eca435":"markdown","cc9e8406":"markdown","9dde0ffc":"markdown","b8fb5e9f":"markdown","aabc961e":"markdown","24eacee6":"markdown","acb19823":"markdown","9fd58d29":"markdown"},"source":{"84e92ecd":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)","577a29b0":"data = np.array([['a','b','c'], [4,5,6], [True,False,None]])","1a8e8c19":"data","b5b0127b":"df_data = pd.DataFrame(data)","2af9d232":"df_data","bf0323ab":"import matplotlib.pyplot as plt","9bd14a8c":"df_emissions = pd.DataFrame(data = [[25, 30], [45, 25], [30, 45]],\n                            index = [2011, 2012, 2013],\n                            columns = ['Canada', 'USA'])","1ed5d69e":"df_emissions","92c20893":"plt.figure(figsize=(10,5))\nplt.plot(df_emissions)\nplt.xticks(df_emissions.index)\nplt.legend(df_emissions.columns)\nplt.xlabel('Time')\nplt.ylabel('Emissions')\nplt.title('Emissions From Cars')\n\nplt.show()","cc88f823":"import folium","20adc0d1":"data = (\n    # Matrix of size 70 by 3, filled with numbers \n    # between -1 and 1 following a normal distribution\n    np.random.normal(size=(70, 3)) *\n    # Matrix of size 3 by 1, to scale values in the previous matrix\n    np.array([[0.01, 0.01, 1]]) +\n    # Matrix of size 3 by 1, with coordiates of University of Waterloo\n    np.array([[43.471257, -80.543021, 1]])\n).tolist()","9a4b391f":"# format of data: [latitude, longitude, weight]\ndata[0:3]","181d270d":"from folium.plugins import HeatMap\n\nmap_demo = folium.Map([43.471257, -80.543021],\n                      #tiles='Stamen Toner',\n                      zoom_start=14)\nHeatMap(data).add_to(map_demo)\n\nmap_demo","86711b40":"# Importing OS is typically used for reading and writing from files\nimport os\n# Print contents in the input folder\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","87195e6b":"# Pandas for data importing\ndf_ksi = pd.read_csv('..\/input\/KSI_CLEAN.csv')","15a1bb32":"# the info() function writes down descriptive information about the dataset such as:\n#  - Number of rows\n#  - Attribute names, here each attribute is represented as a column of data\n#  - Data types of attributes\n#  - Order of attributes\n\ndf_ksi.info()","b77dd3aa":"# write down just the column names of dataset\nprint(df_ksi.columns)","42fbd657":"# Shortlist of the numerical attributes\nksi_numerical = ['YEAR', 'MONTH', 'DAY', 'HOUR', 'MINUTES', 'WEEKDAY', \n                 'LATITUDE', 'LONGITUDE', 'PEDESTRIAN', 'CYCLIST', 'AUTOMOBILE', \n                 'MOTORCYCLE', 'TRUCK', 'TRSN_CITY_VEH', 'EMERG_VEH', 'PASSENGER', \n                 'SPEEDING', 'AG_DRIV', 'REDLIGHT', 'ALCOHOL', 'DISABILITY', 'FATAL']","0c91e977":"# Shortlist of the categorical attributes\nksi_categorical = ['Ward_Name', 'Ward_ID', 'Hood_Name', 'Hood_ID', 'Division', \n                   'District', 'STREET1', 'STREET2', 'OFFSET', 'ROAD_CLASS', \n                   'LOCCOORD', 'ACCLOC', 'TRAFFCTL', 'VISIBILITY', 'LIGHT', \n                   'RDSFCOND', 'ACCLASS', 'IMPACTYPE', 'INVTYPE', 'INVAGE', \n                   'INJURY', 'INITDIR', 'VEHTYPE', 'MANOEUVER', 'DRIVACT', \n                   'DRIVCOND', 'PEDTYPE', 'PEDACT', 'PEDCOND', 'CYCLISTYPE', \n                   'CYCACT', 'CYCCOND']","5654c7d6":"# Shortlist of the geographic attributes\nksi_geographical = ['LATITUDE', 'LONGITUDE', 'Ward_Name', 'Hood_Name', 'District',\n                   'Division', 'STREET1', 'STREET2']","2c3e4caf":"# Shortlist of the Boolean attributes\nksi_boolean = ['PEDESTRIAN', 'CYCLIST', 'AUTOMOBILE', 'MOTORCYCLE', 'TRUCK', \n               'TRSN_CITY_VEH','EMERG_VEH', 'PASSENGER', 'SPEEDING', 'AG_DRIV', \n               'REDLIGHT', 'ALCOHOL', 'DISABILITY', 'FATAL']","916fa63e":"df_ksi.head(3)","6d8fbe05":"df_ksi.tail(3)","2b038ae8":"# Remove incidents which are listed as property damage\n# in order to keep only Fatal and Non-Fatal injuries\n\nprint(\"KSI number of rows: \", len(df_ksi))\n\ndf_ksi = df_ksi[df_ksi['ACCLASS'] != 'Property Damage Only']\n\nprint(\"KSI number of rows: \", len(df_ksi))","3727aadc":"df_ksi.sample(3)","30af7b87":"print(\"Numerical Attributes: \\n\", str(ksi_numerical))","65e79948":"# Learning Exercise\n# Try changing the attribute with another numerical attribute listed above:\nattribute = 'YEAR'\n\nplt.figure(figsize=(12,6))\ndata = df_ksi[attribute].value_counts().sort_index()\ndata.plot(kind='bar')\nplt.show()","e370497c":"print(\"Categorical Attributes: \\n\", str(ksi_categorical))","d0314e12":"# Learning Exercise\n# Try changing the attribute with another categorical attribute listed above:\n# INVAGE is \"Age of Involved Party\"\nattribute = 'INVAGE'\n\nplt.figure(figsize=(12,6))\ndata = df_ksi[attribute].value_counts()\ndata.plot(kind='bar')\nplt.show()","b3b664bf":"print(ksi_boolean)","75f63b37":"# Learning Exercise\n# Change the attribute below to calculate what percentage of incidents\n# reported th involvemnt of possible items listed above\nattribute = 'AUTOMOBILE'\n\nprint(\"Percentage of incidents that involve\", attribute, \"=\", df_ksi[attribute].sum() \/ df_ksi[attribute].count())","b9ada314":"# Summary statistics, for simplicity\n# we run it over all attributes,\n# but they only make sense for numeric\ndf_ksi.describe()","7b0c39fd":"# Summary statistics aggregated by month\ndf_ksi_monthly = df_ksi.groupby(by=['YEAR', 'MONTH'],as_index=False).sum()\n\n# Show only the last 10 rows\ndf_ksi_monthly.tail(10)","10250304":"import seaborn as sns","b350d228":"# Learning Exercise\n\n# Try changing the independent (x) and dependent (y) \n# variables to visualize the trends in the data\n# (optional: uncomment the Hue and see how that changes the plot)\n\nplt.figure(figsize=(18,6))\n\nsns.barplot(data = df_ksi_monthly,\n            hue = 'MONTH',\n            x = 'YEAR',\n            # Number of events involving automobiles\n            y = 'AUTOMOBILE',\n            capsize = 0.2)\n\n# Legend Placement\nplt.legend(loc='best')\n#plt.legend(loc='upper right')\n#plt.legend(loc='upper left')\n\nplt.show()","7a2f1605":"# Learning Exercise\n# Try changing the independent (x) and dependent (y) \n# variables to visualize the trends in the data\n\nsns.jointplot(data = df_ksi_monthly,\n              kind = 'reg',\n              x = 'AG_DRIV', # Aggressive and Distracted Driving Collision\n              y = 'SPEEDING') # Speeding Related Collision\nplt.show()","809bb2a0":"# More correlations between attributes accumulated by month\n\n# PASSENGER Passenger Involved in Collision\n# SPEEDING Speeding Related Collision\n# AG_DRIV Aggressive and Distracted Driving Collision\n# ALCOHOL Alcohol Related Collision\n# FATAL Fatal event\n\nsns.pairplot(df_ksi_monthly[['PASSENGER','SPEEDING','AG_DRIV','ALCOHOL','FATAL']])\nplt.show()","11ed86e9":"data = df_ksi_monthly.pivot('MONTH','YEAR','FATAL')\ndata","c05bbf67":"plt.figure(figsize=(12,6))\nsns.heatmap(data)\nplt.show()","baa15143":"print(\"Geographic Attributes: \\n\", str(ksi_geographical))","c01d0e9a":"# Learning Exercise\n# Try changing the geographic attribute with another attribute listed above:\nattribute = 'District'\n\nplt.figure(figsize=(12,6))\ndata = df_ksi[attribute].value_counts().head(12)\ndata.plot(kind='bar')\nplt.show()","3f5d3db6":"df_ksi_geo = df_ksi[df_ksi['FATAL'] == 1]\ndf_ksi_geo = df_ksi_geo[['LATITUDE', 'LONGITUDE', 'FATAL']].sample(1000)\ndf_ksi_geo.sample(3)","dd6e340d":"lat_Toronto = df_ksi.describe().at['mean','LATITUDE']\nlng_Toronto = df_ksi.describe().at['mean','LONGITUDE']","c8b2e0b0":"# Heatmap of fatal events\nmap_ksi_fatal = folium.Map(location = [lat_Toronto, lng_Toronto],\n                           #tiles = 'Stamen Toner', # uncomment this code to change basemap\n                           zoom_start = 11)\n\nHeatMap(df_ksi_geo.values, min_opacity =0.4).add_to(map_ksi_fatal)\nmap_ksi_fatal","fb41566b":"# Below we are visualizing the correlation of the attributes.\n#  - If the correlation for two attributes is closer to positive one, \n#    they are positively correlated, meaning that if the value for one increases, \n#    the other is expected to increase as well.\n#  - If the correlation for two attributes is close to negative one, \n#    they are negatively correlated, meaning that if the value for one increases, \n#    the other is expected to decrease as well.\n#  - If the correlation is close to zero, there is likely no correlation.\n\nplt.figure(figsize=(14,10))\nsns.heatmap(df_ksi_monthly[ksi_boolean].corr())\nplt.show()","39d44ab2":"from sklearn.model_selection import train_test_split","29e66b6a":"# the function below takes in the dataset, and a list of input columns names \n# as model input and a column name to predict for.\ndef split_train_test(data, X, y):\n    X_all = data[X]\n    y_all = data[y]\n    \n    X_train, X_test, y_train, y_test = train_test_split(X_all,\n                                                        y_all,\n                                                        test_size=0.4,\n                                                        random_state=42)\n    \n    return X_train, X_test, y_train, y_test","4fb68682":"from sklearn.metrics import classification_report, confusion_matrix, accuracy_score","b8c8493a":"from sklearn.tree import DecisionTreeClassifier","84a67b78":"# Learning Exercise:\n# Try changing the variables of the model and see how the model accuracy changes!\nmodel_input = ['YEAR','MONTH','WEEKDAY','Hood_ID']\nmodel_output = 'FATAL'\n\nX_train, X_test, y_train, y_test = split_train_test(data = df_ksi,\n                                                    X = model_input,\n                                                    y = model_output)","b8c23353":"dtree = DecisionTreeClassifier()","60a1760f":"dtree.fit(X_train, y_train)","c311e49d":"predictions = dtree.predict(X_test)","5f027520":"# The confusion matrix shows the proportion of incidents predicted correctly, and incorrectly\n\nprint(confusion_matrix(y_test, predictions))","a3b00802":"print(classification_report(y_test, predictions))","d90b5c4d":"accuracy_score(y_test, predictions)","3cf08626":"from IPython.display import Image\nfrom sklearn.externals.six import StringIO\nfrom sklearn.tree import export_graphviz\nimport pydot\n\ndot_data = StringIO()","92bf8388":"def draw_decision_tree(tree):\n    export_graphviz(tree,\n                    out_file=dot_data,\n                    feature_names = X_train.columns,\n                    filled = True,\n                    rounded = True)\n    \n    graph = pydot.graph_from_dot_data(dot_data.getvalue())\n    \n    return Image(graph[0].create_png())","74c135ec":"# NOTE: Depending on your device performance, you may want to\n#       run the command below because it is resource intensive\n\n# Running the command below will draw the entire descision tree!\n# You can copy the image and page it in Microsoft Paint or another image viewer and see the decision paths.\ndraw_decision_tree(dtree)","66f9e3c2":"from sklearn.ensemble import RandomForestClassifier","a4c78445":"# Learning Exercise:\n# Try changing the variables of the model and see how the model accuracy changes!\nmodel_input = ['YEAR','MONTH','WEEKDAY','Hood_ID']\nmodel_output = 'FATAL'\n\nX_train, X_test, y_train, y_test = split_train_test(data = df_ksi,\n                                                    X = model_input,\n                                                    y = model_output)","e46cbf03":"model_input = ['YEAR','MONTH','WEEKDAY','LATITUDE','LONGITUDE']\nmodel_output = 'FATAL'\n\nX_train, X_test, y_train, y_test = split_train_test(data = df_ksi,\n                                                    X = model_input,\n                                                    y = model_output)","b2b6b65a":"rfc = RandomForestClassifier(n_estimators = 200)","ea722fc1":"rfc.fit(X_train, y_train)","32d376bc":"predictions = rfc.predict(X_test)","0bb2d28c":"print(confusion_matrix(y_test, predictions))","d4d3e128":"print(classification_report(y_test, predictions))","4bea98c5":"accuracy_score(y_test, predictions)","1a6f8bfd":"print(\"Number of Descision Trees  our Random Forest Model contains: \", len(rfc.estimators_))","fe241ba5":"# NOTE: Depending on your device performance, you may want to\n#       run the command below because it is resource intensive\n\n# Running the command below will draw the entire descision tree!\n\ndraw_decision_tree(rfc.estimators_[5])","2371b4c6":"## Random Forest Classifier","364bce69":"# Machine Learning for Geospatial Data Workshop #1\n*Geospatial Club -\nWinter 2019*\n\n\nWorkshop presented by:\n* Jaydeep Mistry: jaydeep.mistry@uwaterloo.ca\n* Juan Carrillo: jmcarril@uwaterloo.ca\n\n\nThe purpose of the workshop is to give the UWaterloo students and the members of the [Geospatial Club](http:\/\/bit.ly\/uwgeospatial) an introduction to the most recent Machine Learning tools for analysis of Geospatial data. The workshop is held in collaboration with the [Geospatial Centre at the University of Waterloo](https:\/\/uwaterloo.ca\/library\/geospatial\/).\n\nAll of the software tools and libraries are open source. The dataset we use is a table titled \"Killed or Seriously Injured\" (KSI) from the [City of Toronto's Police Open Data portal](http:\/\/bit.ly\/open-data-ksi-toronto). It contains registries of all traffic collisions between 2007 and 2017 where a person was injured or property damage was reported.\n\nWe hope that you will learn something new from the content of this workshop. If you have questions after the workshop, then please feel free to message the Geospatial Club or the workshop presenters.\n\n* Jaydeep Mistry at jaydeep.mistry@uwaterloo.ca\n\n* Juan Carrillo at jmcarril@uwaterloo.ca\n","de3dca2c":"## Train\/Test Splitting","1785a14b":"## Plotting Geographic Data","0aec442d":"# Machine Learning for predicting fatal events\nScikit-learn is one of the most popular Machine Learning libraries written in Python.\n\nhttps:\/\/scikit-learn.org\/","b3e7f2ac":"## Working with Aggregrate Statistics","9db63da4":"# Working with Python Libraries\n\nhttps:\/\/www.python.org\/","22319b4d":"# Numpy Overview\n\nNumpy is a Python library for linear algebra (matrices) calculations.\n\nhttp:\/\/www.numpy.org\/","dd277e6a":"# Data Exploration","447fc5bd":"# Matplotlib Overview\n\nMatplotlib is a Python library for data visualization.\n\nhttps:\/\/matplotlib.org\/","4ee7a0d1":"### **Press CTRL+Enter to run each cell**\n### Press SHIFT+Enter to run a cell and move onto the next cell","4fde7be3":"## Data Cleaning","3192d037":"## Plotting Numerical Data","fda566d4":"## Seaborn\nSeaborn is another visualization library similar to matplotlib. https:\/\/seaborn.pydata.org\/","f21d9955":"## Descision Tree Classifier","44eca435":"## Plotting Categorical data","cc9e8406":"## Plotting Time-Series Numerical Data","9dde0ffc":"# Loading Data\n [Killed or Seriously Injured (KSI) from 2007 \u2013 2017](http:\/\/bit.ly\/open-data-ksi-toronto)","b8fb5e9f":"# Folium Overview\n\nFolium is a Python library for visualizing geospatial data, in fact it, uses Leaflet under the hood.\n\n* http:\/\/python-visualization.github.io\/folium\/\n\n* https:\/\/leafletjs.com\/","aabc961e":"## Visualizing the Decision Tree","24eacee6":"## Attribute names ","acb19823":"## Correlation Analysis","9fd58d29":"# Pandas Overview\n\nPandas is a Python library for data preparation and analysis.\n\nhttps:\/\/pandas.pydata.org\/"}}