{"cell_type":{"1ed78fbf":"code","e1cee612":"code","c3670711":"code","30694aa0":"code","3c2399d5":"code","546a844c":"code","8b4bc8de":"code","e00992a6":"code","640c41a9":"markdown","926898b6":"markdown","5e177bd9":"markdown","ad130b9e":"markdown","f2b394d9":"markdown","1dfe150d":"markdown","a0560f01":"markdown","ba08f471":"markdown","459c3bff":"markdown","ff231220":"markdown","2dd402b6":"markdown"},"source":{"1ed78fbf":"import pandas as pd\n\nimport numpy as np\n# 1.2 OS related package\nimport os\n# 1.3 Modeling librray\n# 1.3.1 Scale data\nfrom sklearn.preprocessing import StandardScaler\n# 1.3.2 Split dataset\nfrom sklearn.model_selection import train_test_split\n# 1.3.3 Class to develop kmeans model\nfrom sklearn.cluster import KMeans\n# 1.4 Plotting library\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n# 1.5 How good is clustering?\nfrom sklearn.metrics import silhouette_score\nfrom yellowbrick.cluster import SilhouetteVisualizer\n\nimport warnings\nwarnings.filterwarnings('ignore')\n\n\n# 2.0 Set your working folder to where data is\nos.chdir(\"..\/input\")\nos.listdir()\n\n# 2.1 Read csv file\nfundamentals = pd.read_csv(\"fundamentals.csv\")\nprices = pd.read_csv(\"prices.csv\")\nsplit = pd.read_csv(\"prices-split-adjusted.csv\")\nsecurities= pd.read_csv(\"securities.csv\")\n\nfundamentals.info()\n\n#2.2 Change the column names and remove special characters\nfundamentals_col = {\n'Ticker Symbol'\t\t\t\t\t\t:\t'Ticker_Symbol',\n'Period Ending'\t\t\t\t\t\t:\t'Period_Ending',\n'Accounts Payable'\t               \t\t\t:\t'Accounts_Payable',\n'Accounts Receivable'\t                \t\t:\t'Accounts_Receivable',\n'After Tax ROE'\t                        \t\t:\t'After_Tax_ROE',\n'Capital Expenditures'          \t\t\t:\t'Capital_Expenditures',\n'Capital Surplus'\t\t\t\t\t:\t'Capital_Surplus',\n'Cash Ratio'\t\t\t\t\t\t:\t'Cash_Ratio',\n'Cash and Cash Equivalents'\t\t\t\t:\t'Cash_and_Cash_Equivalents',\n'Changes in Inventories'\t\t\t\t:\t'Changes_in_Inventories',\n'Common Stocks'\t\t\t\t\t\t:\t'Common_Stocks',\n'Cost of Revenue'\t\t\t\t\t:\t'Cost_of_Revenue',\n'Current Ratio'\t\t\t\t\t\t:\t'Current_Ratio',\n'Deferred Asset Charges'\t\t\t\t:\t'Deferred_Asset_Charges',\n'Deferred Liability Charges'\t\t\t\t:\t'Deferred_Liability_Charges',\n'Depreciation'\t\t\t\t\t\t:\t'Depreciation',\n'Earnings Before Interest and Earnings Before Tax'\t:\t'Earnings_Before_Interest_and_Earnings_Before_Tax',\n'Effect of Exchange Rate'\t\t\t\t:\t'Effect_of_Exchange_Rate',\n'Equity Earnings\/Loss Unconsolidated Subsidiary'\t\t\t\t:\t'Equity_Earnings_Loss_Unconsol_Subsidiary',\n'Fixed Assets'\t\t\t\t\t\t:\t'Fixed_Assets',\n'Goodwill'\t\t\t\t\t\t:\t'Goodwill',\n'Gross Margin'\t\t\t\t\t\t:\t'Gross_Margin',\n'Gross Profit'\t\t\t\t\t\t:\t'Gross_Profit',\n'Income Tax'\t\t\t\t\t\t:\t'Income_Tax',\n'Intangible Assets'\t\t\t\t\t:\t'Intangible_Assets',\n'Interest Expense'\t\t\t\t\t:\t'Interest_Expense',\n'Inventory'\t\t\t\t\t\t:\t'Inventory',\n'Investments'\t\t\t\t\t\t:\t'Investments',\n'Liabilities'\t\t\t\t\t\t:\t'Liabilities',\n'Long-Term Debt'\t\t\t\t\t:\t'Long-Term_Debt',\n'Long-Term Investments'\t\t\t\t\t:\t'Long-Term_Investments',\n'Minority Interest'\t\t\t\t\t:\t'Minority_Interest',\n'Misc. Stocks'\t\t\t\t\t\t:\t'Misc._Stocks',\n'Net Borrowings'\t\t\t\t\t:\t'Net_Borrowings',\n'Net Cash Flow'\t\t\t\t\t\t:\t'Net_Cash_Flow',\n'Net Cash Flow-Operating'\t\t\t\t:\t'Net_Cash_Flow-Operating',\n'Net Cash Flows-Financing'\t\t\t\t:\t'Net_Cash_Flows-Financing',\n'Net Cash Flows-Investing'\t\t\t\t:\t'Net_Cash_Flows-Investing',\n'Net Income'\t\t\t\t\t\t:\t'Net_Income',\n'Net Income Adjustments'\t\t\t\t:\t'Net_Income_Adjustments',\n'Net Income Applicable to Common Shareholders'\t\t\t\t:\t'Net_Income_Applicable_to_Common_Shareholders',\n'Net Income-Cont. Operations'\t\t\t\t:\t'Net_Income-Cont_Operations',\n'Net Receivables'\t\t\t\t\t:\t'Net_Receivables',\n'Non-Recurring Items'\t\t\t\t\t:\t'Non-Recurring_Items',\n'Operating Income'\t\t\t\t\t:\t'Operating_Income',\n'Operating Margin'\t\t\t\t\t:\t'Operating_Margin',\n'Other Assets'\t\t\t\t\t\t:\t'Other_Assets',\n'Other Current Assets'\t\t\t\t\t:\t'Other_Current_Assets',\n'Other Current Liabilities'\t\t\t\t:\t'Other_Current_Liabilities',\n'Other Equity'\t\t\t\t\t\t:\t'Other_Equity',\n'Other Financing Activities'\t\t\t\t:\t'Other_Financing_Activities',\n'Other Investing Activities'\t\t\t\t:\t'Other_Investing_Activities',\n'Other Liabilities'\t\t\t\t\t:\t'Other_Liabilities',\n'Other Operating Activities'\t\t\t\t:\t'Other_Operating_Activities',\n'Other Operating Items'\t\t\t\t\t:\t'Other_Operating_Items',\n'Pre-Tax Margin'\t\t\t\t\t:\t'Pre-Tax_Margin',\n'Pre-Tax ROE'\t\t\t\t\t\t:\t'Pre-Tax_ROE',\n'Profit Margin'\t\t\t\t\t\t:\t'Profit_Margin',\n'Quick Ratio'\t\t\t\t\t\t:\t'Quick_Ratio',\n'Research and Development'\t\t\t\t:\t'Research_and_Development',\n'Retained Earnings'\t\t\t\t\t:\t'Retained_Earnings',\n'Sale and Purchase of Stock'\t\t\t\t:\t'Sale_and_Purchase_of_Stock',\n'Sales, General and Admin.'\t\t\t\t:\t'Sales_General_and_Admin',\n'Short-Term Debt \/ Current Portion of Long-Term Debt'\t\t\t\t:\t'Short-Term_Debt_Current_Portion_of_Long-Term_Debt',\n'Short-Term Investments'\t\t\t\t:\t'Short-Term_Investments',\n'Total Assets'\t\t\t\t\t\t:\t'Total_Assets',\n'Total Current Assets'\t\t\t\t\t:\t'Total_Current_Assets',\n'Total Current Liabilities'\t\t\t\t:\t'Total_Current_Liabilities',\n'Total Equity'\t\t\t\t\t\t:\t'Total_Equity',\n'Total Liabilities'\t\t\t\t\t:\t'Total_Liabilities',\n'Total Liabilities & Equity'\t\t\t\t:\t'Total_Liabilities_Equity',\n'Total Revenue'\t\t\t\t\t\t:\t'Total_Revenue',\n'Treasury Stock'\t\t\t\t\t:\t'Treasury_Stock',\n'For Year'\t\t\t\t\t\t:\t'For_Year',\n'Earnings Per Share'\t\t\t\t\t:\t'Earnings_Per_Share',\n'Estimated Shares Outstanding'\t\t\t\t:\t'Estimated_Shares_Outstanding'\n}\n\nfundamentals.rename(columns = fundamentals_col,inplace = True)\n\n","e1cee612":"#2.3 Group data by Ticker Symbols and take a mean of all numeric variables.\n\ngrpfundamentals = fundamentals.groupby(['Ticker_Symbol'],as_index = False)\ngrpfundamentals.groups\ngpfundamentals = grpfundamentals.agg({\n'Accounts_Payable'\t:np.mean,\n'Accounts_Receivable'\t:np.mean,\n'After_Tax_ROE'\t:np.mean,\n'Capital_Expenditures'\t:np.mean,\n'Capital_Surplus'\t:np.mean,\n'Cash_Ratio'\t:np.mean,\n'Cash_and_Cash_Equivalents'\t:np.mean,\n'Changes_in_Inventories'\t:np.mean,\n'Common_Stocks'\t:np.mean,\n'Cost_of_Revenue'\t:np.mean,\n'Current_Ratio'\t:np.mean,\n'Deferred_Asset_Charges'\t:np.mean,\n'Deferred_Liability_Charges'\t:np.mean,\n'Depreciation'\t:np.mean,\n'Effect_of_Exchange_Rate'\t:np.mean,\n'Equity_Earnings_Loss_Unconsol_Subsidiary'\t:np.mean,\n'Fixed_Assets'\t:np.mean,\n'Goodwill'\t:np.mean,\n'Gross_Margin'\t:np.mean,\n'Gross_Profit'\t:np.mean,\n'Income_Tax'\t:np.mean,\n'Intangible_Assets'\t:np.mean,\n'Interest_Expense'\t:np.mean,\n'Inventory'\t:np.mean,\n'Investments'\t:np.mean,\n'Liabilities'\t:np.mean,\n'Long-Term_Debt'\t:np.mean,\n'Long-Term_Investments'\t:np.mean,\n'Minority_Interest'\t:np.mean,\n'Misc._Stocks'\t:np.mean,\n'Net_Borrowings'\t:np.mean,\n'Net_Cash_Flow'\t:np.mean,\n'Net_Cash_Flow-Operating'\t:np.mean,\n'Net_Cash_Flows-Financing'\t:np.mean,\n'Net_Cash_Flows-Investing'\t:np.mean,\n'Net_Income'\t:np.mean,\n'Net_Income_Adjustments'\t:np.mean,\n'Net_Income_Applicable_to_Common_Shareholders'\t:np.mean,\n'Net_Income-Cont_Operations' :np.mean,\n'Net_Receivables'\t:np.mean,\n'Non-Recurring_Items':np.mean,\n'Operating_Income':np.mean,\n'Operating_Margin':np.mean,\n'Other_Assets':np.mean,\n'Other_Current_Assets':np.mean,\n'Other_Current_Liabilities':np.mean,\n'Other_Equity':np.mean,\n'Other_Financing_Activities':np.mean,\n'Other_Investing_Activities':np.mean,\n'Other_Liabilities':np.mean,\n'Other_Operating_Activities':np.mean,\n'Other_Operating_Items':np.mean,\n'Pre-Tax_Margin':np.mean,\n'Pre-Tax_ROE':np.mean,\n'Profit_Margin':np.mean,\n'Quick_Ratio':np.mean,\n'Research_and_Development':np.mean,\n'Retained_Earnings':np.mean,\n'Sale_and_Purchase_of_Stock':np.mean,\n'Sales_General_and_Admin':np.mean,\n'Short-Term_Debt_Current_Portion_of_Long-Term_Debt':np.mean,\n'Short-Term_Investments':np.mean,\n'Total_Assets':np.mean,\n'Total_Current_Assets':np.mean,\n'Total_Current_Liabilities':np.mean,\n'Total_Equity':np.mean,\n'Total_Liabilities':np.mean,\n'Total_Liabilities_Equity':np.mean,\n'Total_Revenue':np.mean,\n'Treasury_Stock':np.mean,\n'Earnings_Per_Share':np.mean,\n'Estimated_Shares_Outstanding':np.mean,\n})\n","c3670711":"#Drop all rows having null values\n\ngpfundamentals.dropna(inplace=True)\n\ny = gpfundamentals['Ticker_Symbol'].values\ngpfundamentals.drop(columns = ['Ticker_Symbol'], inplace = True)","30694aa0":"# Scale Data using Standard Scalar\nss = StandardScaler()     # Create an instance of class\nss.fit(gpfundamentals)                # Train object on the data\nX = ss.transform(gpfundamentals)      # Transform data\nX[:5, :]                  # See first 5 rows\n\n#Split Dataset into Train and Test\n\nX_train,X_test,_,y_test =train_test_split(X,y,test_size = .25)\n\n#Examine the results getting shape of X_Train and X_test\n\nX_train.shape\nX_test.shape\n\n# Examine the Clusters using K Means Clustering\nclf = KMeans(n_clusters = 2)\n\n#Train the Object Over Data\nclf.fit(X_train)\n\n# 5.3 So what are our clusters?\nclf.cluster_centers_\nclf.cluster_centers_.shape         \nclf.labels_                        \nclf.labels_.size                   \nclf.inertia_ \n\n# Now Interpret using silhoutte score\nsilhouette_score(X_train, clf.labels_) \n\n# Now make predictions over Test Data and Check Accuracy\ny_pred = clf.predict(X_test)\ny_pred\n\n# How Good is Your Prediction\n\nnp.sum(y_pred == y_test)\/y_test.size\n\n\n#  Scree plot:\nsse = []\nfor i,j in enumerate(range(10)):\n    # 7.1.1 How many clusters?\n    n_clusters = i+1\n    # 7.1.2 Create an instance of class\n    clf1 = KMeans(n_clusters = n_clusters)\n    # 7.1.3 Train the kmeans object over data\n    clf1.fit(X_train)\n    # 7.1.4 Store the value of inertia in sse\n    sse.append(clf1.inertia_ )","3c2399d5":"# Are Clusters Distinguishable\n\ndx = pd.Series(X_test[:, 0])\ndy = pd.Series(X_test[:,1])\nsns.scatterplot(dx,dy, hue = y_pred)","546a844c":"#  Scree plot:\nsse = []\nfor i,j in enumerate(range(10)):\n    # 7.1.1 How many clusters?\n    n_clusters = i+1\n    # 7.1.2 Create an instance of class\n    clf1 = KMeans(n_clusters = n_clusters)\n    # 7.1.3 Train the kmeans object over data\n    clf1.fit(X_train)\n    # 7.1.4 Store the value of inertia in sse\n    sse.append(clf1.inertia_ )\n#  Plot the line now\nsns.lineplot(range(1, 11), sse)","8b4bc8de":"# Silhoutte plot of this Data\n\nvisualizer = SilhouetteVisualizer(clf, colors='yellowbrick')\nvisualizer.fit(X_train)        # Fit the data to the visualizer\nvisualizer.show()   ","e00992a6":"# Merging of Tables Fundamentals,Security and in order to do fundamental analysis.\n\n#Rename Columns of Security Table to merge with fundamentals\nsecurities_col = {\n'Ticker symbol':'Ticker_Symbol',\n'SEC filings':'SEC_filings',\n'GICS Sector' : 'GICS_Sector',\n'GICS Sub Industry' : 'GICS_Sub_Industry'\n}\n\nsecurities.rename(columns = securities_col,inplace = True)\n\nfunda_analysis  = securities.merge(fundamentals,on=['Ticker_Symbol'],how = 'left')\n\n#Dropping of some unuseful columns from funda_analysis table\nfunda_analysis.dtypes\n\nfunda_analysis.drop(['SEC_filings','Address of Headquarters','Date first added','CIK'], axis = 1)\n\n#Grouping Data Sector Wise for analysis\ngrpfunda_analysis = funda_analysis.groupby(['GICS_Sector'],as_index = False)\ngrpfunda_analysis.groups\ngpfunda_analysis = grpfunda_analysis.agg({\n'Accounts_Payable'\t:np.mean,\n'Accounts_Receivable'\t:np.mean,\n'After_Tax_ROE'\t:np.mean,\n'Capital_Expenditures'\t:np.mean,\n'Capital_Surplus'\t:np.mean,\n'Cash_Ratio'\t:np.mean,\n'Cash_and_Cash_Equivalents'\t:np.mean,\n'Changes_in_Inventories'\t:np.mean,\n'Common_Stocks'\t:np.mean,\n'Cost_of_Revenue'\t:np.mean,\n'Current_Ratio'\t:np.mean,\n'Deferred_Asset_Charges'\t:np.mean,\n'Deferred_Liability_Charges'\t:np.mean,\n'Depreciation'\t:np.mean,\n'Effect_of_Exchange_Rate'\t:np.mean,\n'Equity_Earnings_Loss_Unconsol_Subsidiary'\t:np.mean,\n'Fixed_Assets'\t:np.mean,\n'Goodwill'\t:np.mean,\n'Gross_Margin'\t:np.mean,\n'Gross_Profit'\t:np.mean,\n'Income_Tax'\t:np.mean,\n'Intangible_Assets'\t:np.mean,\n'Interest_Expense'\t:np.mean,\n'Inventory'\t:np.mean,\n'Investments'\t:np.mean,\n'Liabilities'\t:np.mean,\n'Long-Term_Debt'\t:np.mean,\n'Long-Term_Investments'\t:np.mean,\n'Minority_Interest'\t:np.mean,\n'Misc._Stocks'\t:np.mean,\n'Net_Borrowings'\t:np.mean,\n'Net_Cash_Flow'\t:np.mean,\n'Net_Cash_Flow-Operating'\t:np.mean,\n'Net_Cash_Flows-Financing'\t:np.mean,\n'Net_Cash_Flows-Investing'\t:np.mean,\n'Net_Income'\t:np.mean,\n'Net_Income_Adjustments'\t:np.mean,\n'Net_Income_Applicable_to_Common_Shareholders'\t:np.mean,\n'Net_Income-Cont_Operations' :np.mean,\n'Net_Receivables'\t:np.mean,\n'Non-Recurring_Items':np.mean,\n'Operating_Income':np.mean,\n'Operating_Margin':np.mean,\n'Other_Assets':np.mean,\n'Other_Current_Assets':np.mean,\n'Other_Current_Liabilities':np.mean,\n'Other_Equity':np.mean,\n'Other_Financing_Activities':np.mean,\n'Other_Investing_Activities':np.mean,\n'Other_Liabilities':np.mean,\n'Other_Operating_Activities':np.mean,\n'Other_Operating_Items':np.mean,\n'Pre-Tax_Margin':np.mean,\n'Pre-Tax_ROE':np.mean,\n'Profit_Margin':np.mean,\n'Quick_Ratio':np.mean,\n'Research_and_Development':np.mean,\n'Retained_Earnings':np.mean,\n'Sale_and_Purchase_of_Stock':np.mean,\n'Sales_General_and_Admin':np.mean,\n'Short-Term_Debt_Current_Portion_of_Long-Term_Debt':np.mean,\n'Short-Term_Investments':np.mean,\n'Total_Assets':np.mean,\n'Total_Current_Assets':np.mean,\n'Total_Current_Liabilities':np.mean,\n'Total_Equity':np.mean,\n'Total_Liabilities':np.mean,\n'Total_Liabilities_Equity':np.mean,\n'Total_Revenue':np.mean,\n'Treasury_Stock':np.mean,\n'Earnings_Per_Share':np.mean,\n'Estimated_Shares_Outstanding':np.mean,\n})\n\n# We are doing fundamental Analysis of Various Sectors of US Companies\n\ncolumns = [\"Current_Ratio\",\"Goodwill\",\"Operating_Income\",\"Net_Income\",\"Net_Cash_Flow\",\"Profit_Margin\",\"Pre-Tax_ROE\",\"Earnings_Per_Share\",\"Research_and_Development\",]\n\n\nfig =plt.figure(figsize= (20,20))\nfor i in range(len(columns)):\n    plt.subplot(3,3,i+1)\n    chart =sns.barplot(x=\"GICS_Sector\",y=gpfunda_analysis[columns[i]],data = gpfunda_analysis)\n    chart.set_xticklabels(chart.get_xticklabels(), rotation=90)\n  \n    \n    ","640c41a9":"**current ratio** is a liquidity ratio that measures a company's ability to pay short-term obligations \nor those due within one year. \nBest Performer - Information Technology and Health care sector is very sound to meet current obligations.\nWorst Performer - Utilities Sector is worst performer.\n\n**Goodwill** - Goodwill is an intangible asset it indicates intrinsic value of company. Best performer in this\nparameter is Telecommunication services.\n\n**Operating income**- is an accounting figure that measures the amount of profit realized from a business's \noperations, after deducting operating expenses such as wages, depreciation, and cost of goods sold (COGS).\nLeader again is Telecommunication Services.\n\n**Net income** is the amount of accounting profit a company has left over after paying off all its expenses. \nLeader again in this Telecommunication Services.\n\n**Net cash flow** is nothing but the difference between cash inflows and outflows of a business. Companies with \npositive cash inflows are cash rich companies. Leader in this analysis is Information Technology but surprisingly\nTelecommunication sector is laggard in this having negaive cash flows.\n\n\n**Profit Margin** - Indicates how sustainable a business is means how much profit generated it is calculated\n ratio of a company's profit (sales minus all expenses) divided by its revenue. Energy and Real State sector\nhaving a very good profit margin sector whereas telecom is laggard in this.\n\n**Pre Tax ROE** - As per warran Buffet Return on Equity is a best indicator to analyse company fundamentals \ncalculated by dividing net income by shareholders' equity. In this leader is Consumer Staples is a leader\nand Real estate Telecommunication and Utilities are laggards.\n\n**Earning Per Share** - Earnings per share (EPS) is a company's net profit divided by the number of \ncommon shares it has outstanding. EPS indicates how much money a company makes for each share. Leaders in\nthis sector is Materials and Consumer Discritionary.\n\n**Research and Development** - R&D is a process by which companies acquire new knowledge means sectors having \ninvestment in more R&D are futuristic sectors. Leaders in this Information Technology and Health Care.\n\n\n","926898b6":"**SSE Plot Analysis -** As we seen that SSE Clustering plot elbow located at 2 means 2 clusters are optimum choice for this dataset.","5e177bd9":"**Fundamental Analysis of US Stock Exchange**","ad130b9e":"**Scatter Plot to check the behaviour of Cluster whether clusters are distinguishable.**","f2b394d9":"**Silhauette Plot analysis** displays cluster 1 is having a negative Silhoutte score indicates these points assigned to wrong cluster\nwhereas cluster zero having a excellent Silhoutte score.","1dfe150d":"**Final Conclusion** - In this notesheet we analysed cluster analysis of US stock market data using Silhoutte plot \nanalysis our observation in this SSE arm elbow at 2 means optimum cluster to analyse this data is 2. \nCluster 1 having negative Silhoutte score indicates these points assigned to wrong cluster whereas cluster\nzero having excellent data.\n\nDuring Fundamental analysis we observe sectors on various parameters our findings are Telecommunication, Information Technology, Health Care, Consumer Staples\nare the best sectors during year 2012 to 2016 for US stock market as per fundamental analysis.\n\nShortly we also analyse the Technical Analysis i.e. price behaviour of this analysis of US stock market and\nanalyse the price behaviour with reference to fundamental analysis. So be connected with this sheet and find\nwhat's next ......\n\n**If you like my effort please UPVOTE me that encourages me to do better.**\n\n\n","a0560f01":"**Objective of this sheet is to analyse data of US Stock Exchange **\n1. Fundamental as well as Stock Market Behaviour of Companies of US from year 2012 to 2015. \n2. We also do KDE clustering by deviding the data to test and train data.\n3. Plot graph of sum of the squared distance between centroid and each member of the cluster.\n4. Done silhouette analysis on KMeans clustering.\n5. Doing Fundamental Analysis of US stock Exchange.","ba08f471":"**Scatter Plot Analysis **- Scatter Plot analysis indicates one cluster is totally dense and other one is totally distributed.**","459c3bff":"**Silhoutte plot of US Companies Fundamentals**","ff231220":"![image.png](attachment:image.png)","2dd402b6":"**SSE Line Plot of US Fundamental Data**"}}