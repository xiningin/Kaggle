{"cell_type":{"05831a5d":"code","053b38ed":"code","d9ac186c":"code","07ba4d03":"code","b639c6f4":"code","8ad23f0d":"code","057e97cb":"code","9a9c7313":"code","99a4b59b":"code","dce06230":"code","7248a2c0":"code","1bf4169f":"code","a8a40d5c":"code","e91a9dee":"code","89fa905b":"code","710675cf":"code","47c9a825":"code","63a587b1":"code","1c0a33c7":"markdown","358bdd00":"markdown","9291c591":"markdown","5d484796":"markdown","342f7c81":"markdown","b0ef461c":"markdown","9008aae5":"markdown","deff2283":"markdown","b195cf15":"markdown","43852c34":"markdown","421a08db":"markdown","2dded414":"markdown","6814071d":"markdown","3322047e":"markdown"},"source":{"05831a5d":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nfrom wordcloud import WordCloud, STOPWORDS \n\nimport tensorflow as tf\nimport tensorflow_hub as hub\nfrom sklearn.metrics import accuracy_score\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.linear_model import RidgeClassifier\nfrom sklearn.linear_model import SGDClassifier\nfrom sklearn.ensemble import RandomForestClassifier\nimport lightgbm as lgb\nimport time","053b38ed":"run_wordcloud = True\nmax_data_size = None #for modeling\nFILE_PATH = '\/kaggle\/input\/trip-advisor-hotel-reviews\/tripadvisor_hotel_reviews.csv'\ndf = pd.read_csv(FILE_PATH)","d9ac186c":"df.head()","07ba4d03":"df.shape","b639c6f4":"df.isna().sum()","8ad23f0d":"# functions come from \n# https:\/\/towardsdatascience.com\/plotting-probabilities-for-discrete-and-continuous-random-variables-353c5bb62336\ndef frequencies(values):\n    frequencies = {}\n    for v in values:\n        if v in frequencies:\n            frequencies[v] += 1\n        else:\n            frequencies[v] = 1\n    return frequencies\n\ndef probabilities(sample, freqs):\n    probs = []\n    for k,v in freqs.items():\n        probs.append(round(v\/len(sample),1))\n    return probs\n\nratings = df.Rating.tolist()\nfreqs = frequencies(ratings)\nprobs = probabilities(ratings, freqs)\nx_axis = list(set(ratings))\nplt.bar(x_axis, freqs.values())","057e97cb":"plt.bar(x_axis, probs)","9a9c7313":"# Python program to generate WordCloud \n# code comes from https:\/\/www.geeksforgeeks.org\/generating-word-cloud-python\/","99a4b59b":"def plot_wordcloud(wordcloud):\n    # plot the WordCloud image                        \n    plt.figure(figsize = (8, 8), facecolor = None) \n    plt.imshow(wordcloud) \n    plt.axis(\"off\") \n    plt.tight_layout(pad = 0) \n\n    plt.show()\n\ndef wordcloud_from_sentences(sentences):\n    comment_words = '' \n    stopwords = set(STOPWORDS)\n\n    # iterate through the csv file \n    for val in sentences: \n\n        # typecaste each val to string \n        val = str(val) \n\n        # split the value \n        tokens = val.split() \n\n        # Converts each token into lowercase \n        for i in range(len(tokens)): \n            tokens[i] = tokens[i].lower() \n\n        comment_words += \" \".join(tokens)+\" \"\n\n    wordcloud = WordCloud(\n        width = 800, \n        height = 800, \n        background_color ='white',             \n        stopwords = stopwords, \n        min_font_size = 10\n    ).generate(comment_words)\n    \n    plot_wordcloud(wordcloud=wordcloud)","dce06230":"# wordcloud with all reviews\nif run_wordcloud:\n    wordcloud_from_sentences(sentences=df.Review)","7248a2c0":"if run_wordcloud:\n    df_good_review = df[df['Rating'] >= 4]\n    wordcloud_from_sentences(sentences=df_good_review.Review)","1bf4169f":"# wordcloud with all reviews\nif run_wordcloud:\n    df_bad_review = df[df['Rating'] < 4]\n    wordcloud_from_sentences(sentences=df_bad_review.Review)","a8a40d5c":"df.Rating = df.Rating.astype('int')\ntrain, test = train_test_split(df.head(max_data_size), test_size=0.1)","e91a9dee":"embed = hub.load(\"https:\/\/tfhub.dev\/google\/universal-sentence-encoder\/4\")","89fa905b":"%%time\nX_train = embed(train.Review.to_numpy())\nX_test = embed(test.Review.to_numpy())\ny_train = train.Rating.to_numpy()\ny_test = test.Rating.to_numpy()","710675cf":"def fit_lgb(X_train, y_train, model):\n        #d_train = lgb.Dataset(X_train, label=y_train)\n        param = {'num_leaves': 31, 'objective': 'binary'}\n        param['metric'] = 'auc'\n        model = lgb.LGBMClassifier()\n        model = model.fit(X_train, y_train)\n        return model\n\n\ndef fit(X_train, y_train, model_str, model):\n    if model_str == 'lgb':\n        model = fit_lgb(X_train, y_train, model)\n    elif model_str == 'Keras':\n        model.fit(X_train, y_train, epochs=1)\n    else:\n        model.fit(X_train, y_train)\n    return model\n\n\ndef evaluate(model_str, model, X_train, y_train, X_test, y_test):\n    model = fit(X_train, y_train, model_str, model)\n    y_pred = model.predict(X_test)\n    print(f'Y_pred={y_pred}\\nY_test={y_test}')\n    acc = accuracy_score(y_pred, y_test)\n    print(f'acc: {acc}')\n    return acc\n\n\ndef keras_model(X_train):\n    inputs = tf.keras.Input(shape=(X_train.shape[1],))\n    x = tf.keras.layers.Dense(10, activation='relu')(inputs)\n    outputs = tf.keras.layers.Dense(1, activation=tf.nn.softmax)(x)\n    model = tf.keras.Model(inputs=inputs, outputs=outputs)\n    model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])\n    return model","47c9a825":"result_dict = {}\ndict_model = {'SGDClassifier': SGDClassifier(),\n              'Keras': keras_model(X_train),\n              'RandomForestClassifier': RandomForestClassifier(n_estimators=1),\n              'lgb': lgb,\n              'RidgeClassifier': RidgeClassifier()}\n\nfor model_str, model in dict_model.items():\n    start = time.time()\n    acc = evaluate(\n        model_str, model, X_train, y_train, X_test, y_test\n    )\n    result_dict[model_str] = acc\n    print(f'{model_str} runs in {round(time.time()-start, 2)}s.')","63a587b1":"result_dict = {\n    k: v\n    for k, v in sorted(result_dict.items(),\n                       key=lambda item: item[1],\n                       reverse=True)\n}\nresult_dict","1c0a33c7":"# Compare the ML results","358bdd00":"# Run and evaluate different ML models on the data","9291c591":"## Frequencies by rating","5d484796":"# Sentences encoding with tf universal sentence encoder\ntransform sentences to vectors","342f7c81":"# Read the data","b0ef461c":"# Check if there is NA values","9008aae5":"## Probabilities by rating","deff2283":"# Import the required libraries","b195cf15":"## Wordcloud with bad reviews 1, 2 and 3","43852c34":"## Wordcloud of reviews with ratings 4 and 5 (good reviews)","421a08db":"# Some vizualisation","2dded414":"# Worclouds","6814071d":"# Train and test splitting","3322047e":"Please upvote for motivating :D\nThanks for reading"}}