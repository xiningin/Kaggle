{"cell_type":{"c30284a8":"code","073e155e":"code","90936701":"code","415cd789":"code","3588aa6d":"code","b0a97517":"code","d380f7c2":"code","7e2164fb":"code","d0e2763e":"code","a21dbd80":"code","3ef71e4f":"code","e758c68d":"code","03a4c1eb":"code","cc140bd4":"code","ba3d86ac":"code","023b9ac0":"code","be589ab3":"code","fd8dc571":"code","3bae8ec9":"code","97e1e90b":"markdown","f8534b91":"markdown","3993c07c":"markdown","8d6984b0":"markdown","6465505b":"markdown","64974efc":"markdown","d23f0eb0":"markdown","47000160":"markdown","4c449817":"markdown"},"source":{"c30284a8":"!pip install imutils","073e155e":"import os\nimport glob\nimport numpy as np \nimport pandas as pd \nimport os\nfrom os import listdir\nimport tensorflow as tf\nfrom keras.preprocessing.image import ImageDataGenerator\nimport cv2\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport imutils    \n\nfrom tensorflow.keras.models import Model,load_model\nfrom tensorflow.keras.layers import Conv2D,Input,ZeroPadding2D,BatchNormalization,Flatten,Activation,Dense,MaxPooling2D\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.utils import shuffle #shuffling the data improves the model\nfrom keras.preprocessing import image\nfrom keras.models import Model\nfrom keras.optimizers import Adam\nfrom keras.callbacks import EarlyStopping\nfrom keras.layers import Input, Dense, Activation, BatchNormalization, Flatten, Conv2D\nfrom keras.layers import MaxPooling2D, Dropout, UpSampling2D","90936701":"image_dir=\"..\/input\/brain-mri-images-for-brain-tumor-detection\/\"","415cd789":"image_dir","3588aa6d":"plt.figure(figsize=(20,8))\nimg = cv2.imread('..\/input\/brain-mri-images-for-brain-tumor-detection\/yes\/Y1.jpg', 0)\nplt.imshow(img, cmap='gray')\nprint(img.shape)","b0a97517":"Yes_IMAGES = glob.glob('..\/input\/brain-mri-images-for-brain-tumor-detection\/yes\/*.jpg')\nNo_IMAGES = glob.glob('..\/input\/brain-mri-images-for-brain-tumor-detection\/no\/*.jpg')","d380f7c2":"def load_image(path):\n    image_list = np.zeros((len(path), 258, 540, 1))\n    for i, fig in enumerate(path):\n        img = image.load_img(fig, color_mode='grayscale', target_size=(258, 540))\n        x = image.img_to_array(img).astype('float32')\n        x = x \/ 255.0\n        image_list[i] = x\n    \n    return image_list","7e2164fb":"x_train = load_image(Yes_IMAGES)\ny_train = load_image(Yes_IMAGES)\nx_test = load_image(No_IMAGES)\n\nprint(x_train.shape, x_test.shape)","d0e2763e":"def train_val_split(x_train, y_train):\n    rnd = np.random.RandomState(seed=42)\n    perm = rnd.permutation(len(x_train))\n    train_idx = perm[:int(0.8 * len(x_train))]\n    val_idx = perm[int(0.8 * len(x_train)):]\n    return x_train[train_idx], y_train[train_idx], x_train[val_idx], y_train[val_idx]\n\nx_train, y_train, x_val, y_val = train_val_split(x_train, y_train)\nprint(x_train.shape, x_val.shape)","a21dbd80":"class Autoencoder():\n    def __init__(self):\n        self.img_rows = 258\n        self.img_cols = 540\n        self.channels = 1\n        self.img_shape = (self.img_rows, self.img_cols, self.channels)\n        \n        optimizer = Adam(lr=0.001)\n        \n        self.autoencoder_model = self.build_model()\n        self.autoencoder_model.compile(loss='mse', optimizer=optimizer)\n        self.autoencoder_model.summary()\n    \n    def build_model(self):\n        input_layer = Input(shape=self.img_shape)\n        \n        # encoder\n        h = Conv2D(64, (3, 3), activation='relu', padding='same')(input_layer)\n        h = MaxPooling2D((2, 2), padding='same')(h)\n        \n        # decoder\n        h = Conv2D(64, (3, 3), activation='relu', padding='same')(h)\n        h = UpSampling2D((2, 2))(h)\n        output_layer = Conv2D(1, (3, 3), activation='sigmoid', padding='same')(h)\n        \n        return Model(input_layer, output_layer)\n    \n    def train_model(self, x_train, y_train, x_val, y_val, epochs, batch_size=20):\n        early_stopping = EarlyStopping(monitor='val_loss',\n                                       min_delta=0,\n                                       patience=5,\n                                       verbose=1, \n                                       mode='auto')\n        history = self.autoencoder_model.fit(x_train, y_train,\n                                             batch_size=batch_size,\n                                             epochs=epochs,\n                                             validation_data=(x_val, y_val),\n                                             callbacks=[early_stopping])\n        plt.plot(history.history['loss'])\n        plt.plot(history.history['val_loss'])\n        plt.title('Model loss')\n        plt.ylabel('Loss')\n        plt.xlabel('Epoch')\n        plt.legend(['Train', 'Test'], loc='upper left')\n        plt.show()\n    \n    def eval_model(self, x_test):\n        preds = self.autoencoder_model.predict(x_test)\n        return preds","3ef71e4f":"ae = Autoencoder()\nae.train_model(x_train, y_train, x_val, y_val, epochs=200, batch_size=20)","e758c68d":"preds = ae.eval_model(x_test)","03a4c1eb":"preds_0 = preds[10] * 255.0\npreds_0 = preds_0.reshape(258, 540)\nx_test_0 = x_test[10] * 255.0\nx_test_0 = x_test_0.reshape(258, 540)\nplt.imshow(x_test_0, cmap='gray')","cc140bd4":"plt.imshow(preds_0, cmap='gray')","ba3d86ac":"plt.imshow(preds_0, cmap='bone')","023b9ac0":"preds = preds.reshape(-1, 258, 540)","be589ab3":"preds","fd8dc571":"preds_1 = preds[20] * 255.0\npreds_1 = preds_1.reshape(258, 540)\n\nplt.imshow(preds_1, cmap='PiYG')","3bae8ec9":"preds_2 = preds[50] * 255.0\npreds_2 = preds_2.reshape(258, 540)\n\nplt.imshow(preds_1, cmap='twilight')","97e1e90b":"<div style=\"color:white;\n           display:fill;\n           border-radius:5px;\n           background-color:#9FA7BD;\n           font-size:110%;\n           font-family:Verdana;\n           letter-spacing:0.5px\">\n\n<h1 style=\"text-align: center;\n           padding: 10px;\n              color:white\">\n\nModel Training\n<\/h1>\n<\/div>","f8534b91":"<div style=\"color:white;\n           display:fill;\n           border-radius:5px;\n           background-color:#9FA7BD;\n           font-size:110%;\n           font-family:Verdana;\n           letter-spacing:0.5px\">\n\n<h1 style=\"text-align: center;\n           padding: 10px;\n              color:white\">\n\nCreating Autoencoder Class\n<\/h1>\n<\/div>","3993c07c":"<div style=\"color:white;\n           display:fill;\n           border-radius:5px;\n           background-color:#9FA7BD;\n           font-size:110%;\n           font-family:Verdana;\n           letter-spacing:0.5px\">\n\n<h1 style=\"text-align: center;\n           padding: 10px;\n              color:white\">\n\nLibraries\n<\/h1>\n<\/div>","8d6984b0":"<div style=\"color:white;\n           display:fill;\n           border-radius:5px;\n           background-color:#9FA7BD;\n           font-size:110%;\n           font-family:Verdana;\n           letter-spacing:0.5px\">\n\n<h1 style=\"text-align: center;\n           padding: 10px;\n              color:white\">\n\nPredictions\n<\/h1>\n<\/div>","6465505b":"<div style=\"color:white;\n           display:fill;\n           border-radius:5px;\n           background-color:#9FA7BD;\n           font-size:110%;\n           font-family:Verdana;\n           letter-spacing:0.5px\">\n\n<h1 style=\"text-align: center;\n           padding: 10px;\n              color:white\">\n\nImage Dir settings\n<\/h1>\n<\/div>","64974efc":"<div style=\"color:white;\n           display:fill;\n           border-radius:5px;\n           background-color:#9FA7BD;\n           font-size:110%;\n           font-family:Verdana;\n           letter-spacing:0.5px\">\n\n<h1 style=\"text-align: center;\n           padding: 10px;\n              color:white\">\n\nDataset Spliting\n<\/h1>\n<\/div>","d23f0eb0":"Autoencoders is type of neual network used to learn efficient data codings in an unsupervised manner. The aim of an autoencoder is to learn a representation (encoding) for a set of data.","47000160":"<div style=\"color:white;\n           display:fill;\n           border-radius:5px;\n           background-color:#9FA7BD;\n           font-size:110%;\n           font-family:Verdana;\n           letter-spacing:0.5px\">\n\n<h1 style=\"text-align: center;\n           padding: 10px;\n              color:white\">\n\nWhat is Autoencoders\n<\/h1>\n<\/div>","4c449817":"![](https:\/\/www.pyimagesearch.com\/wp-content\/uploads\/2020\/02\/keras_denoising_autoencoder_header.png)"}}