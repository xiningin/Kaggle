{"cell_type":{"e48fc95d":"code","6b04d1b9":"code","bbad80f8":"code","b8695054":"code","9105af97":"code","f6224120":"code","a12c056d":"code","8d32ad73":"code","dac7bf22":"code","b3a0099b":"code","6f356841":"code","51e14647":"code","392744c2":"code","90588589":"markdown"},"source":{"e48fc95d":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport matplotlib.pyplot as plt\n\n#image processing tools\nimport cv2\nimport imutils\nimport mahotas\n\n#Machine Learning tools\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.model_selection import KFold\nfrom sklearn.model_selection import cross_val_score\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.naive_bayes import GaussianNB\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.svm import SVC\nfrom sklearn.metrics import accuracy_score, confusion_matrix,classification_report\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nimport warnings\nprint(os.listdir(\"..\/input\"))\nwarnings.filterwarnings('ignore')\n\n# Any results you write to the current directory are saved as output.","6b04d1b9":"#data=np.genfromtxt(\"..\/input\/train.csv\",delimiter=\",\", dtype=\"uint8\")\n#target=data[:,0]\n#data=data[:,1:].reshape(data.shape[0], 28,28)\n#############################\ntest_dataset=pd.read_csv(\"..\/input\/test.csv\",dtype=\"uint8\")\ntrain=pd.read_csv(\"..\/input\/train.csv\",dtype=\"uint8\")\n#train=np.genfromtxt(\"..\/input\/train.csv\", delimiter=\",\", dtype=\"uint8\")\n\ntarget=train['label']\ndata=train.drop('label',axis=1).values\ntest_dataset=test_dataset.values\n#data=train[:,1:].reshape(train.shape[0], 28,28)\n\nX_train=data[:,0:].reshape(data.shape[0], 28,28)\ntest_dataset=test_dataset[:,0:].reshape(test_dataset.shape[0],28,28)\n#y_train=train[:,0]\n","bbad80f8":"print(\"train target shape:\",target.shape)\nprint(\"train shape       :\",X_train.shape)\nprint(\"test shape        :\",test_dataset.shape)","b8695054":"def show_digit_matrix(digit, n=10):\n    v_images=[]\n    n=n\n    count=0\n    for i in range(0,n):\n        h_images=list()\n        for j in range(0,n):\n            h_images.append(digit[count])\n            count+=1\n        h=np.hstack((h_images))\n        v_images.append(h)\n    image_matrix=np.vstack((v_images))\n    \n    fig, axarr = plt.subplots(1, 1, figsize=(12, 12))\n    plt.imshow(image_matrix,cmap='gray')\n","9105af97":"show_digit_matrix(digit=X_train, n=20)","f6224120":"def deskew(image, width):\n    (h,w)=image.shape[:2]\n    \n    #skew=mahotas.moments(img, p0, p1, cm=(0, 0), convert_to_float=True)\n    \n    moments=cv2.moments(image)\n    skew=moments['mu11']\/moments[\"mu02\"]\n\n\n    M=np.float32([\n        [1, skew, -0.5*w*skew],\n        [0,1,0]\n    ])\n\n    image_wrap=cv2.warpAffine(image, M, (w,h),\n                         flags=cv2.WARP_INVERSE_MAP|cv2.INTER_LINEAR)\n\n    image_wrap=imutils.resize(image=image_wrap,width=width)\n\n    return image_wrap\n\ndef center_extent(image, size):\n    (eW, eH)=size\n\n    if image.shape[1]>image.shape[0]:\n        image=imutils.resize(image,width=eW)\n    else:\n        image=imutils.resize(image,height=eH)\n\n    extent=np.zeros((eH,eW),dtype='uint8')\n\n    offsetX=(eW-image.shape[1])\/\/2\n    offestY=(eH-image.shape[0])\/\/2\n\n    extent[offestY:offestY+image.shape[0],offsetX:offsetX+image.shape[1]]=image\n\n    CM=mahotas.center_of_mass(extent)\n    (cY, cX)=np.round(CM).astype(\"int32\")\n    (dX, dY)=((size[0]\/\/2)-cX, (size[1]\/\/2)-cY)\n    M=np.float32([[1, 0, dX],\n                  [0, 1, dY]])\n\n    extent=cv2.warpAffine(extent, M, size)\n\n    return extent","a12c056d":"deskew_size=28\nimage=X_train[0]\n\nimage_deskewed=deskew(image, deskew_size)\nimage_extented=center_extent(image_deskewed,(deskew_size,deskew_size))\nimage_merged=np.hstack(([image,image_extented]))\nplt.imshow(image_merged ,cmap='gray')","8d32ad73":"def process_data(mydata, use_hog=False):\n    processed_data=[]\n\n\n    deskew_size=20\n    counter=0\n    counter2=0\n    print(\"\u00f6n i\u015flem ba\u015flad\u0131:\")\n    for image in mydata:\n        image_deskewed=deskew(image, deskew_size)\n        image_extented=center_extent(image_deskewed,(deskew_size,deskew_size))\n\n        processed_data.append(image_extented.flatten())\n        \n        if counter>10000:\n            counter2+=1\n            print(counter2*10000, end=\", \")\n            counter=0\n            continue\n        counter+=1\n    print(\"\u00f6n i\u015flem tamamland\u0131\")\n    return processed_data\n    ","dac7bf22":"processed_data=process_data(X_train)","b3a0099b":"X_train_processed, X_test_processed, y_train, y_test=train_test_split(processed_data, target, test_size=0.3, random_state=42)\n\n#A\u015fa\u011f\u0131da i\u015flemler uzun s\u00fcrmektedir. elde edilen en iyi sonu\u00e7\n#n=5 i\u00e7in\n# test accuracy : 0.9788888888888889\n\"\"\"\nneigbors=range(1,15)\ntest_accuracy=list()\ntrain_accuracy=[]\ncounter=0\nfor n in neigbors:\n    clf=KNeighborsClassifier(n_neighbors=n)\n    clf.fit(X_train_processed, y_train)\n    #train_accuracy.append(clf.score(X_train_processed, y_train))\n    test_accuracy.append(clf.score(X_test_processed, y_test))\n    print(\"for n :\",n)\n    #print(\"train accuracy:\",train_accuracy[counter])\n    print(\"test accuracy :\",test_accuracy[counter])\n    print()\n    counter+=1\n\"\"\"\n#sonu\u00e7lar\n\"\"\"\nsonu\u00e7lar\nfor n : 1\ntest accuracy : 0.9773809523809524\n\nfor n : 2\ntest accuracy : 0.976031746031746\n\nfor n : 3\ntest accuracy : 0.9788888888888889\n\nfor n : 4\ntest accuracy : 0.9783333333333334\n\nfor n : 5\ntest accuracy : 0.9788888888888889\n\nfor n : 6\ntest accuracy : 0.9784920634920635\n\nfor n : 7\ntest accuracy : 0.9766666666666667\n\nfor n : 8\ntest accuracy : 0.9768253968253968\n\nfor n : 9\ntest accuracy : 0.9753968253968254\n\nfor n : 10\ntest accuracy : 0.976031746031746\n\nfor n : 11\ntest accuracy : 0.9739682539682539\n\nfor n : 12\ntest accuracy : 0.9744444444444444\n\nfor n : 13\ntest accuracy : 0.972936507936508\n\nfor n : 14\ntest accuracy : 0.973015873015873\n\"\"\"\nn=5\nclf=KNeighborsClassifier(n_neighbors=n)\nclf.fit(X_train_processed, y_train)\ny_pred1=clf.predict(X_test_processed)\nprint(\"for {} accuracy:{}\".format(n, accuracy_score(y_pred1, y_test)))\nprint(\"for {} confusion matrix:\\n{}\".format(n, confusion_matrix(y_pred1, y_test)))\nprint(\"for {} classification reports:\\n{}\".format(n, classification_report(y_pred1, y_test)))","6f356841":"processed_test_data=process_data(test_dataset)","51e14647":"print(\"g\u00f6nderi haz\u0131rlan\u0131yor...\")\nclf=KNeighborsClassifier(n_neighbors=5)\nclf.fit(processed_data, target)\ny_pred2=clf.predict(processed_test_data)\nprint(\"g\u00f6nderi haz\u0131r.\")","392744c2":"results = pd.Series(y_pred2,name=\"Label\")\nsubmission = pd.concat([pd.Series(range(1,28001),name = \"ImageId\"),results],axis = 1)\n\nsubmission.to_csv(\"preprocess_and_knn(n=5)_mnist2.csv\",index=False)\nprint(\"g\u00f6nderi kaydedildi2.\")","90588589":"\u00c7al\u0131\u015fma hakk\u0131ndaki yorumlar\u0131n\u0131z\u0131 bekliyorum.  Be\u011fendiyseniz oy vermeyi unutmay\u0131n ::))"}}