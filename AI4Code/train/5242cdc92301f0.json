{"cell_type":{"3ce78fe5":"code","6bfe7d50":"code","79f69dcb":"code","3e7884f9":"code","955b20db":"code","b4162e2d":"code","26031cd9":"code","2dbeb663":"code","3fa82d1a":"code","bf08aac6":"code","5f0f1169":"code","3cf7bc64":"code","5087f6aa":"code","944494a5":"code","e01df3d4":"code","bc9f67b4":"code","5a24276c":"code","2d17ce9d":"code","bdd7d8c4":"code","c76cbcb9":"code","5559ccc3":"code","20e33089":"code","ddda97e2":"code","5fb94d5f":"code","2262289b":"code","e8d819fb":"markdown","82d46665":"markdown","f55b8837":"markdown","2146758c":"markdown","dff6e01b":"markdown","1091f34f":"markdown","c9799632":"markdown","34d578e4":"markdown","f7459720":"markdown","a8535c90":"markdown","872e1696":"markdown","398b6b06":"markdown","bd629f71":"markdown","156af5be":"markdown","d769247a":"markdown","fae1fdd7":"markdown","03a2b7dc":"markdown","02c46508":"markdown","b0ec9fa8":"markdown","de3b0ed6":"markdown","cdfeee54":"markdown"},"source":{"3ce78fe5":"import pandas as pd #import pandas\nimport numpy as np #import numpy\nimport matplotlib.pyplot as plt #import matplotlib.pyplot with plt as alias\n%matplotlib inline","6bfe7d50":"df = pd.read_csv(\"..\/input\/ecommerce-data\/data.csv\", encoding = 'ISO-8859-1') # import csv file","79f69dcb":"df.head(1)","3e7884f9":"df.info()","955b20db":"df['InvoiceDate'] = pd.to_datetime(df['InvoiceDate']) #InvoiceDate to datetime\ndf = df.dropna() #drop NA","b4162e2d":"df[df.duplicated(keep=False)].sort_values(by=['InvoiceNo', 'StockCode']).head(2) # select duplicates and show header 2","26031cd9":"print(str('We have {} duplicates.').format(len(df[df.duplicated(keep=False)].sort_values(by=['InvoiceNo', 'StockCode']))))","2dbeb663":"df = df.drop_duplicates()\ndf.shape","3fa82d1a":"df['Total'] = df['Quantity'] * df['UnitPrice']","bf08aac6":"df.describe()","5f0f1169":"#first option\ndfp = df[df['Quantity']>0]\ndfn = df[df['Quantity']<=0]\n\n#second option\ndfd = df\ndfd['Purchase'] = df['Quantity'].apply(lambda x: 1 if x > 0 else 0)","3cf7bc64":"df.nunique()","5087f6aa":"print(str('As we can see we have {} unique customers for {} description products over {} countries.').format(df.nunique()['CustomerID'], df.nunique()['Description'], df.nunique()['Country']))","944494a5":"recod_df = pd.get_dummies(df[['Description', 'Country']], drop_first = True)\ndfc = pd.concat([df, recod_df], axis=1)\ndfc = dfc.drop(['InvoiceNo', 'StockCode', 'Description', 'Country', 'Purchase', 'InvoiceDate','CustomerID'], axis=1)","e01df3d4":"dfc.head(1)","bc9f67b4":"from sklearn.preprocessing import normalize\n\na = dfc[['Quantity', 'UnitPrice', 'Total']]\ndfc_scaled = normalize(a)\ndfc_scaled = pd.DataFrame(dfc_scaled, columns=a.columns)\ndfc_scaled.head(1)","5a24276c":"y = dfc_scaled['Total']\ny1 = dfc_scaled[['Total']]\nX = dfc_scaled.drop('Total', axis=1)","2d17ce9d":"#Using Kmeans we will try to find first the optimal number of clusters with elbow method\nfrom sklearn.cluster import KMeans #import kmeans\n\nlistkm = [] # define an empty list to add inertia at each number of clusters\n\nfor i in range(1,8):\n    km=KMeans(n_clusters=i,init='k-means++', max_iter=300, n_init=10, random_state=0)\n    km.fit(y1)\n    listkm.append(km.inertia_)\n    \n# Plot it\nplt.plot(range(1,8),listkm, marker ='s')\nplt.title('Plot showing inertia versus number of clusters')\nplt.xlabel('Number of clusters')\nplt.ylabel('Inertia')\nplt.show()","bdd7d8c4":"kms = KMeans(n_clusters=3, random_state=1).fit(X) #kmeans fitting to have our model\npredict = kms.predict(X) #predicting\nctds = kms.cluster_centers_\nprint(ctds)","c76cbcb9":"print(\"Original array:\")\nprint(predict)\nunique_elements, counts_elements = np.unique(predict, return_counts=True)\nprint(\"Frequency of unique values of the said array:\")\nprint(np.asarray((unique_elements, counts_elements)))","5559ccc3":"plt.scatter(X.iloc[predict == 0, 0], X.iloc[predict == 0, 1], s = 50, c = 'green', label = 'Group 1')\nplt.scatter(X.iloc[predict == 1, 0], X.iloc[predict == 1, 1], s = 50, c = 'yellow', label = 'Group 2')\nplt.scatter(X.iloc[predict == 2, 0], X.iloc[predict == 2, 1], s = 50, c = 'red', label = 'Group 3')\nplt.scatter(kms.cluster_centers_[:, 0], kms.cluster_centers_[:, 1], s = 100, c = 'purple', label = 'Centroids')\nplt.title('Customer clusters on price and quantity')\nplt.xlabel('Quantity')\nplt.ylabel('Unit Price')\nplt.legend()\nplt.show()","20e33089":"#from sklearn.decomposition import PCA\n#pca = PCA().fit(dfc)\n#pca_ax2 = pca.transform(dfc)","ddda97e2":"#import scipy.cluster.hierarchy as sch\n\n#dist = sch.distance.pdist(dfc, lambda u, v: u != v)\n#merging = sch.linkage(df_scaled, method='ward')\n\n#plt.figure(figsize=(10,10))\n#sch.dendrogram(merging,leaf_font_size=6, leaf_rotation=90)","5fb94d5f":"from wordcloud import WordCloud, STOPWORDS\n\ndf_word1 = df[predict == 0]['Description']\ndf_word2 = df[predict == 1]['Description']\ndf_word3 = df[predict == 2]['Description']\n\npatchwork1 = \" \".join(word for word in df_word1)\npatchwork2 = \" \".join(word for word in df_word2)\npatchwork3 = \" \".join(word for word in df_word3)\n\n# Generate a word cloud image\nwordcloud1 = WordCloud(background_color=\"white\").generate(patchwork1)\nwordcloud2 = WordCloud(background_color=\"white\").generate(patchwork2)\nwordcloud3 = WordCloud(background_color=\"white\").generate(patchwork3)","2262289b":"#plot each cluster\nplt.figure(figsize=(36, 12))\nplt.subplots_adjust(top=1.2)\n\nplt.subplot(131)\nplt.imshow(wordcloud1, interpolation='bilinear')\nplt.axis(\"off\")\nplt.title('Cluster 1 : Home furnitures', fontsize=30)\nplt.subplot(132)\nplt.imshow(wordcloud2, interpolation='bilinear')\nplt.axis(\"off\")\nplt.title('Cluster 2 : Travel Bags and others', fontsize=30)\nplt.subplot(133)\nplt.imshow(wordcloud3, interpolation='bilinear')\nplt.axis(\"off\")\nplt.title('Cluster 3 : Birthday events ', fontsize=30)\n\nplt.suptitle('Wordcloud by Cluster', fontsize=70)\nplt.show()","e8d819fb":"Optimal number of clusters is 3. let's now fit a 3 clusters kmean:","82d46665":"> To study customer,s behaviour, we will focus on Customer ID, Price, Quantity and Total","f55b8837":"For each Customer, Year, Month, Product, Quantity Purchased, Total value purchased could help us get more insights on how customers acts.","2146758c":"## First Step","dff6e01b":"3- How you can use the clusters from the given dataset to make actionable business insights and what will these insights be?","1091f34f":"As presented in its description:\n\n    \"This is a transnational data set which contains all the transactions occurring between 01\/12\/2010 and 09\/12\/2011 for a UK-based and registered non-store online retail.The company mainly sells unique all-occasion gifts. Many customers of the company are wholesalers.\"","c9799632":"Test 2 : PCA","34d578e4":"As asked, we are going to focus on total purchases as main feature for classification.\nFor this we will try kmean.","f7459720":"### EDA and Data Cleaning","a8535c90":"The above mentioned Clusters are a good hint on what kind of products custommers are fond of. It might be used to recommend other product of the same genre to people of the same cluster.","872e1696":"Purchase behaviour needs to know exactly, a part of invoice detailed level how many products and the amount of purchase.","398b6b06":"As we are facing an invoice table we are going to have a row for each action made. But are we sure that we don't have any duplicates ?\n\nLet's check if by any means we have duplicates:","bd629f71":"# Identifying the Groups of Customers ","156af5be":"## Goals\n**First step:**\n\n* EDA and Data Cleaning\n* Preprocessing\n\n**Second step, we'll try to answer to these questions:**\n\n* Find the \"behaviour\" groups \/ clusters (Hint: you can use the purchase behaviour for that)\n* Explain, if possible, what clusters you have found (for example, customers purchasing furniture, purchasing jewellery, etc.)\n* How you can use the clusters from the given dataset to make actionable business insights and what will these insights be?","d769247a":"1 - Find the &quot;behaviour&quot; groups \/ clusters (Hint: you can use the purchase behaviour for that)","fae1fdd7":"What are the main goals of our notebook ?:","03a2b7dc":"Different kind of columns with 541.909 rows and 8 columns. First look reveals that:\n* *We can see that there are some column types that are not suitable, as InvoiceDate which is 'object' instead of datetime.*\n* *CustomerID has less filled rows 406.829, which means that there are some Invoices without customer ID.* \n\nAs response to these cases:\n* *Change it's type.*\n* *We will admit that these cases can't be processed and should be dropped, as we want to study customers behaviour.*","02c46508":"We have negative values for quantity (min). How can it be interpreted ?\n\nLet's suppose that these are returns or cancelled purchases.\n\nWe can decide to split our dataset in two (one for valid purchases, another one for negative quantities) or add a new feature giving categories of purchases.","b0ec9fa8":"2 \u2013 Explain, if possible, what clusters you have found (for example, customers purchasing furniture, purchasing jewellery, etc.)","de3b0ed6":"We can add total value of purchase as 'Total:","cdfeee54":"Let's drop them:"}}