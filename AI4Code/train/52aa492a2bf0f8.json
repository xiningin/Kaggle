{"cell_type":{"317302bc":"code","305d4550":"code","90cc689e":"code","c63118f2":"code","56fd76f7":"code","0eaed3de":"code","384c8116":"code","14026555":"code","587b2bc7":"code","af506200":"code","f63e6a5c":"code","0c998fca":"code","532505e0":"code","513629a2":"code","b10689ae":"code","a90e5155":"code","6e7e4560":"code","d5e8bbee":"code","0a897cbb":"code","369077b7":"code","51e29e08":"code","56b8d84b":"code","9648ce52":"code","ce17020b":"code","4e4f027b":"code","45cdffdb":"code","b943b103":"code","752668d2":"code","986b1717":"code","e4223a79":"code","2c3c58cc":"code","18a72447":"code","be3a3281":"code","5ad63d1f":"code","1b5a0dd8":"code","a66edc5b":"code","df7948db":"code","1b61b213":"code","7d57ade8":"code","1eaa55b4":"code","bd1c8a95":"code","ab9a5992":"code","038b9cd7":"code","0bcbb8e3":"code","f33463fc":"code","223661b3":"code","7ca98fb6":"code","eab99579":"code","18a3caa8":"code","320eecee":"code","c9b21b89":"code","4442016e":"code","6ab087b3":"code","62e22c35":"code","6fb413f9":"code","57bff7e9":"code","07cc27af":"code","a40b84d9":"code","ead6a033":"code","6848abe4":"code","880286d9":"code","ef00c39a":"code","46c9331f":"code","260748d4":"code","c059d2c8":"code","702ccd81":"code","5adc09fb":"code","efc2ece8":"code","4febc2d1":"code","bbe087bd":"code","c7581d1b":"code","5f69010b":"code","823fdd61":"code","bf86d535":"code","f811e7eb":"code","ae5adf54":"code","6efc33bd":"code","86ac26e3":"code","fc84c566":"code","4f81f14e":"code","ac406934":"code","6222528f":"code","07296e66":"code","c5db32a3":"code","0bc0ab80":"code","3174e55e":"code","af073044":"code","4b82864e":"code","e3e75b42":"code","58564de4":"code","db16b1be":"code","e67f79ef":"code","39b15757":"code","6646f7b9":"code","745876c2":"code","0e98229c":"code","6abfe37b":"code","76955ecd":"code","5f5e958b":"code","79644262":"code","51fefafc":"code","a3f90157":"markdown"},"source":{"317302bc":"import pandas as pd\npd.set_option('display.max_columns', None)\npromo=pd.read_csv('..\/input\/promo-abuse-detection-for-payment-apps\/Promo_Abuse_Detection_Dataset.csv')\npromo.head()","305d4550":"promo.nunique().sort_values(ascending=False)","90cc689e":"promo['UserId'].value_counts().sort_values(ascending=False)[:1] #abuse detected","c63118f2":"promo[promo['UserId']==13341428].head()","56fd76f7":"promo.loc[promo['Unnamed: 0'] == 16, \"Target\"] = 0\npromo.loc[promo['Unnamed: 0'] == 17, \"Target\"] = 1\npromo[promo['UserId']==13341428].head()","0eaed3de":"promo['Device Id'].value_counts().sort_values(ascending=False)[:1]#abuse detected","384c8116":"fix=promo[promo['Device Id']=='iosvd:++djsadjscior34728128MSASCDMVERww38rmbe8=:2537']\nfix.head()","14026555":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","587b2bc7":"promo.loc[promo['Unnamed: 0'] == 950, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Device Id']=='iosvd:++djsadjscior34728128MSASCDMVERww38rmbe8=:2537']","af506200":"promo['Ref PC AC Number'].value_counts().sort_values(ascending=False)[:6]#abuse detected","f63e6a5c":"fix=promo[promo['Ref PC AC Number']=='IN312XXXXX1298']\nfix.head()","0c998fca":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","532505e0":"promo.loc[promo['Unnamed: 0'] == 656, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN312XXXXX1298']","513629a2":"fix=promo[promo['Ref PC AC Number']=='IN312XXXXX1299']\nfix.head()","b10689ae":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","a90e5155":"promo.loc[promo['Unnamed: 0'] == 666, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN312XXXXX1299']","6e7e4560":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1188']\nfix.head()","d5e8bbee":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","0a897cbb":"promo.loc[promo['Unnamed: 0'] == 19, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1188']","369077b7":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1190']\nfix.head()","51e29e08":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","56b8d84b":"promo.loc[promo['Unnamed: 0'] == 678, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1190']","9648ce52":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1186']\nfix.head()","ce17020b":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","4e4f027b":"promo.loc[promo['Unnamed: 0'] == 18, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1186']","45cdffdb":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1185']\nfix.head()","b943b103":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","752668d2":"promo.loc[promo['Unnamed: 0'] == 658, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1185']","986b1717":"promo['Name']=promo['FirstName']+' '+promo['LastName']\npromo.nunique().sort_values(ascending=False)","e4223a79":"promo=promo.drop(['FirstName','LastName'],axis=1)\npromo.head()","2c3c58cc":"promo['Name'].value_counts().sort_values(ascending=False)[:6]#abuse detected","18a72447":"fix=promo[promo['Name']=='amit kumar']\nfix.head()","be3a3281":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","5ad63d1f":"promo.loc[promo['Unnamed: 0'] == 595, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='amit kumar']","1b5a0dd8":"fix=promo[promo['Name']=='akash gupta']\nfix.head()","a66edc5b":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","df7948db":"promo.loc[promo['Unnamed: 0'] == 822, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='akash gupta']","1b61b213":"fix=promo[promo['Name']=='rohit kumar']\nfix.head()","7d57ade8":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","1eaa55b4":"promo.loc[promo['Unnamed: 0'] == 886, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='rohit kumar']","bd1c8a95":"fix=promo[promo['Name']=='raman ralhan']\nfix.head()","ab9a5992":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","038b9cd7":"promo.loc[promo['Unnamed: 0'] == 456, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='raman ralhan']","0bcbb8e3":"fix=promo[promo['Name']=='sunil kumar']\nfix.head()","f33463fc":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","223661b3":"promo.loc[promo['Unnamed: 0'] == 490, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='sunil kumar']","7ca98fb6":"round(promo.Name.isnull().sum()*100\/len(promo),2)","eab99579":"promo[['Name']]=promo[['Name']].fillna('Unknown')\nfix=promo[promo['Name']=='Unknown']#abuse detected as posssibility of hacker expected.\nfix.head()","18a3caa8":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)\nlen(i)","320eecee":"for j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo.head()","c9b21b89":"round(promo.Target.isnull().sum()*100\/len(promo),2)","4442016e":"promo.Target=promo.Target.fillna(0)\nround(promo.Target.value_counts()*100\/len(promo),2)","6ab087b3":"promo[['Sim_OS','Sim_Info','Sim_User']] = promo['Sim Id'].str.split(':',expand=True)\npromo.head()","62e22c35":"promo[['Device_OS','Device_Info','Device_User']] = promo['Device Id'].str.split(':',expand=True)\npromo.head()","6fb413f9":"promo=promo.drop(['Device Id','Sim Id'],axis=1)\npromo.head()","57bff7e9":"promo[['LastLoginTime','PresentLoginTime']].info()","07cc27af":"promo['LastLoginTime']=promo['LastLoginTime'].replace('01-01-1900 00:00','00:00:00')\npromo['LastLoginTime'].unique()","a40b84d9":"promo[['LastLoginTime_HH','LastLoginTime_MM','LastLoginTime_SS']] = promo['LastLoginTime'].str.split(':',expand=True)\npromo.head()","ead6a033":"promo[['PresentLoginTime_HH','PresentLoginTime_MM','PresentLoginTime_SS']] = promo['PresentLoginTime'].str.split(':',expand=True)\npromo.head()","6848abe4":"promo=promo.drop(['LastLoginTime','PresentLoginTime'],axis=1)\npromo.head()","880286d9":"promo[['Meta Data_1','Meta Data_2','Meta Data_3','Meta Data_4']] =promo['Meta Data'].str.split('-',expand=True)\npromo.head()","ef00c39a":"promo[['Email_user','Email_Domain']] =promo['Email'].str.split('@',expand=True)\npromo.head()","46c9331f":"promo=promo.drop(['Email','Meta Data'],axis=1)\npromo.head()","260748d4":"promo[['Reg Client IP_1','Reg Client IP_2','Reg Client IP_3','Reg Client IP_4']] =promo['Reg Client IP'].str.split('.',expand=True)\npromo.head()","c059d2c8":"promo=promo.drop(['Unnamed: 0','Reg Client IP'],axis=1)\npromo.head()","702ccd81":"promo.nunique().sort_values(ascending=False)","5adc09fb":"promo=promo.drop(['ProgramId','ProgramName','Meta Data_1','Meta Data_3','Status','Email_Domain','BadTryCount'],axis=1)\npromo.head()","efc2ece8":"promo['Reg Referral Code']=promo['Reg Referral Code'].str.strip().str[-3:]\npromo['Reg Referral Code'].head()","4febc2d1":"promo['RegisteredOn']=pd.to_datetime(promo['RegisteredOn'])\npromo['Dob']=pd.to_datetime(promo['Dob'])\npromo.head()","bbe087bd":"promo.info()","c7581d1b":"promo[['UserId','Mobile','PostalCode']]=promo[['UserId','Mobile','PostalCode']].astype(object)\npromo.info()","5f69010b":"promo.nunique().sort_values(ascending=False)","823fdd61":"promo.columns","bf86d535":"promo.info()","f811e7eb":"(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","ae5adf54":"promo[['Reg Referral Code','Reg Referral Prefix']]=promo[['Reg Referral Code',\n                                                                 'Reg Referral Prefix']].fillna('Unknown')\n(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","6efc33bd":"promo.Gender.value_counts()","86ac26e3":"promo['Gender']=promo['Gender'].fillna('U')\n(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","fc84c566":"promo.nunique().sort_values(ascending=False)","4f81f14e":"promo.Name.value_counts()[:5]","ac406934":"!pip install pycaret","6222528f":"promo.nunique().sort_values(ascending=False)*100\/len(promo)","07296e66":"promo.columns\n","c5db32a3":"promo.info()","0bc0ab80":"promo.nunique().sort_values(ascending=False)","3174e55e":"!pip install pandas-profiling","af073044":"from pandas_profiling import ProfileReport\nProfileReport(promo, title=\"EDA Report\")","4b82864e":"data = promo.sample(frac=0.8, random_state=42)\ndata_unseen = promo.drop(data.index)\ndata.reset_index(inplace=True, drop=True)\ndata_unseen.reset_index(inplace=True, drop=True)\nprint('Data for Modeling: ' + str(data.shape))","e3e75b42":"print('Unseen Data For Predictions: ' + str(data_unseen.shape))","58564de4":"from pycaret.classification import *\npromo= setup(data =data, session_id=42,\n             target = 'Target',\n                  normalize = True, \n                  transformation = True, \n                  log_experiment = True,\n                  remove_multicollinearity = True, #rop one of the two features that are highly correlated with each other\n                  date_features=['RegisteredOn','Dob'],\n            categorical_features=[ 'Gender', 'UserId', 'Mobile', 'PostalCode',\n       'OS Type', 'Reg Referral Code', 'Reg Referral Prefix',\n       'Ref PC AC Number', 'Name', 'Sim_OS', 'Sim_Info', 'Sim_User',\n       'Device_OS', 'Device_Info', 'Device_User', 'LastLoginTime_HH',\n       'LastLoginTime_MM', 'LastLoginTime_SS', 'PresentLoginTime_HH',\n       'PresentLoginTime_MM', 'PresentLoginTime_SS', 'Meta Data_2',\n       'Meta Data_4', 'Email_user', 'Reg Client IP_1', 'Reg Client IP_2',\n       'Reg Client IP_3', 'Reg Client IP_4'],\n            high_cardinality_features =[ 'UserId', 'Mobile', 'PostalCode',\n       'OS Type', 'Reg Referral Code',\n       'Ref PC AC Number', 'Name', 'Sim_User',\n        'Device_User', 'LastLoginTime_HH',\n       'LastLoginTime_MM', 'LastLoginTime_SS', 'PresentLoginTime_HH',\n       'PresentLoginTime_MM', 'PresentLoginTime_SS',\n       'Meta Data_4', 'Email_user', 'Reg Client IP_1', 'Reg Client IP_2',\n       'Reg Client IP_3', 'Reg Client IP_4']  ,         \n            train_size = 0.8)","db16b1be":"lr = create_model('lr')","e67f79ef":"print(lr)","39b15757":"tuned_lr = tune_model(lr,optimize = 'Accuracy')","6646f7b9":"plot_model(tuned_lr, plot = 'auc')","745876c2":"plot_model(tuned_lr, plot = 'pr')","0e98229c":"plot_model(tuned_lr, plot='feature')","6abfe37b":"plot_model(tuned_lr, plot = 'confusion_matrix')","76955ecd":"evaluate_model(tuned_lr)","5f5e958b":"predict_model(tuned_lr)","79644262":"unseen_predictions = predict_model(tuned_lr, data=data_unseen)\nunseen_predictions.head()","51fefafc":"print(\"Confidence Score :   {}\".format(round(unseen_predictions.Score.mean(),2)))#Confidence Score","a3f90157":"There are few considerations , we are working with.\n- A device can be use once\n- Cashback to same account more than once is an abuse\n- Name with same email ID is an abuse"}}