{"cell_type":{"3944a0dc":"code","923ac0d2":"code","75f4fc51":"code","ee48d2dc":"code","5249e3d9":"code","e863ef77":"code","4c67d904":"code","c731d74a":"code","e1b1a093":"code","16edfc32":"code","6e7c04b2":"code","762917a3":"code","0fd4f1ea":"code","553a05c1":"code","239d41a3":"code","3b471a0a":"code","05380343":"code","e58f830a":"code","9d5b5e9d":"code","d2286f8d":"code","2c43fc6f":"code","5fc38e63":"code","3d5f5e70":"code","bbcccc04":"code","fe81e6d4":"code","4935201a":"code","d495cbaf":"code","93cbe9ba":"code","95c61199":"code","7fd36e4b":"code","159b17c5":"code","13137c19":"code","c2c70f09":"code","6e3b624e":"code","aa91fa9f":"code","30ecd9a0":"code","d8bb4735":"code","9a3b9e15":"code","5ed1edc4":"code","335afcb1":"code","cade6b30":"code","eedbdf27":"code","ae43915a":"code","9b260390":"code","8ee7a6bc":"code","4ab65960":"code","3d52bdae":"code","c2ba6997":"code","9cb26781":"code","265f657e":"code","cf7a2a1e":"code","1986e3c2":"code","e5441d88":"code","423663f9":"code","c031f7cd":"code","ca7f429e":"code","c77a0682":"code","e73ba0bf":"code","550e85e5":"code","1b24e7a1":"code","feb4ca52":"code","047eaef0":"code","b40a9ecc":"code","2da9e394":"code","d1435684":"code","d570c981":"code","885b7dcf":"code","1a8d60b9":"code","1c0db9ba":"code","ecbc8ce5":"code","ebc87f62":"code","36fa57de":"code","aaad854f":"code","471eec16":"code","b03023b3":"code","a006ed95":"code","d5cf9fe6":"code","dabca9eb":"code","0f3935f4":"code","6d4cfdda":"markdown","fda4d4e0":"markdown","9213cdc8":"markdown","9937d683":"markdown","a41859bc":"markdown","8016639c":"markdown","50904b20":"markdown","61b607bd":"markdown","a8b92523":"markdown","c775bd65":"markdown","7db80a26":"markdown","c7717699":"markdown"},"source":{"3944a0dc":"import numpy as np\nfrom numpy import log, log1p\n\nimport pandas as pd\n\nimport scipy.stats as stats\nfrom scipy.stats import shapiro,boxcox,yeojohnson\nfrom scipy.stats import boxcox\n\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\nimport warnings\nwarnings.filterwarnings(\"ignore\")","923ac0d2":"from sklearn.neighbors import LocalOutlierFactor\nfrom sklearn.preprocessing import StandardScaler,MinMaxScaler\nfrom sklearn.model_selection import train_test_split,cross_val_score,cross_val_predict\nfrom sklearn.linear_model import LinearRegression\nimport statsmodels.api as sm\nfrom sklearn.metrics import mean_squared_error,r2_score\nfrom sklearn.model_selection import train_test_split,ShuffleSplit,GridSearchCV,cross_val_score,cross_val_predict","75f4fc51":"!pip install yellowbrick\n!pip install dython","ee48d2dc":"from yellowbrick.regressor import residuals_plot\nfrom yellowbrick.regressor import prediction_error\nfrom dython import nominal\nfrom mlxtend.plotting import plot_linear_regression,plot_learning_curves\nimport missingno as msno\nimport pylab","5249e3d9":"#Let's import the dataset into the kernel by executing the code below:\ndata=pd.read_csv(\"..\/input\/health-insurance-dataset\/Health_insurance.csv\")\ndf=data.copy()\n\ndf.head()","e863ef77":"#Let's understand the data shape of our dataset:\nprint(\"row :\",df.shape[0],\" \",\"column :\",df.shape[1])","4c67d904":"#Let\u2019s understand the statistical information about Numerical Columns in our dataset:\ndf.describe().T","c731d74a":"#Let\u2019s understand the statistical information about Object Columns in our dataset:\ndf.describe(include=[\"object\"]).T","e1b1a093":"#Missing Data\ntotal = df.isnull().sum().sort_values(ascending=False)\npercent = (df.isnull().sum()\/df.isnull().count()).sort_values(ascending=False)\nmissing_data = pd.concat([total, percent], axis=1, keys=['Total', 'Percent'])\nmissing_data.head(25)","16edfc32":"df.eq(0).sum()","6e7c04b2":"nominal.associations(df,figsize=(20,10),mark_columns=True,cmap=\"rainbow\");","762917a3":"plt.rcParams.update({'font.size': 12})\nplt.figure(figsize=(10,5))\ncorr=df.corr()\n\nmask=np.zeros_like(corr,dtype=np.bool)\nmask[np.triu_indices_from(mask)]=True\nsns.heatmap(corr.abs(),annot=True,cmap=\"coolwarm\",mask=mask);","0fd4f1ea":"plt.figure(figsize=(12,5))\nplt.subplot(121)\nsns.distplot(df.charges,color=\"b\");\n\nplt.subplot(122)\nsns.distplot(log(df.charges),color=\"b\");","553a05c1":"#Lets\u2019 visualize the numerical column in proportion of the Smoker Column\nsns.pairplot(df,kind=\"reg\",hue=\"smoker\",aspect=2);","239d41a3":"#Lets\u2019 visualize the numerical column in proportion of the Sex Column\nsns.pairplot(df,kind=\"reg\",hue=\"sex\",aspect=2);","3b471a0a":"#Let\u2019s draw the scatter plot of the \u201cbmi\u201d and \u201ccharges\u201d column in proportion to the \u201csmoker\u201d column\nsns.relplot(x=\"bmi\",y=\"charges\",hue=\"smoker\",data=df,kind=\"scatter\",aspect=2);","05380343":"#Let\u2019s draw the scatter plot of the \u201cbmi\u201d and \u201ccharges\u201d column in proportion to the \u201cchildren\u201d column\nsns.relplot(x=\"bmi\",y=\"charges\",hue=\"children\",data=df,kind=\"scatter\",aspect=2,palette='coolwarm');","e58f830a":"sns.catplot(x=\"age\", y=\"charges\", hue=\"smoker\", data=df,aspect=3,kind=\"point\");","9d5b5e9d":"sns.lmplot(x=\"bmi\", y=\"charges\", hue=\"smoker\", data=df,aspect=2);","d2286f8d":"#Let's draw the joinplot by executing the code below\nplt.figure(figsize=(12,5));\nsns.jointplot(x=\"bmi\", y=\"charges\" ,data=df, kind=\"reg\");","2c43fc6f":"plt.figure(figsize=(12,5));\nsns.jointplot(x=\"age\", y=\"bmi\" ,data=df);","5fc38e63":"#Let's see the distribution of the age column by executing the code below:\nplt.figure(figsize=(12,5));\nsns.distplot(df.age);","3d5f5e70":"#Let's visualize the Probability Plot for the charges column\nplt.figure(figsize=(12,5));\nstats.probplot(df.charges, dist=\"norm\", plot=pylab) ;","bbcccc04":"#Creating the groupby smoker with the values of charges\n#Plotting of groupby (smoker) with the values of \"charges\"\nplt.figure(figsize=(12,5));\ndf.groupby(\"smoker\")[\"charges\"].mean().plot.bar(color=\"r\");","fe81e6d4":"plt.figure(figsize=(12,5));\ndf.groupby(\"children\")[\"charges\"].mean().plot.bar(color=\"g\");","4935201a":"print(sns.FacetGrid(df,hue=\"sex\",height=5,aspect=2).map(sns.kdeplot,\"charges\",shade=True).add_legend());","d495cbaf":"print(sns.FacetGrid(df,hue=\"region\",height=5,aspect=2).map(sns.kdeplot,\"charges\",shade=False).add_legend());","93cbe9ba":"print(sns.catplot(x=\"sex\",y=\"charges\",hue=\"smoker\",data=df,kind=\"bar\",aspect=2));","95c61199":"print(sns.catplot(x=\"sex\",y=\"charges\",hue=\"region\",data=df,kind=\"bar\",aspect=2));","7fd36e4b":"sns.catplot(x=\"smoker\",y=\"charges\",data=df,kind=\"box\",aspect=2);","159b17c5":"sns.catplot(x=\"sex\",y=\"charges\",data=df,kind=\"box\",aspect=2);","13137c19":"sns.catplot(x=\"sex\",y=\"charges\",hue=\"smoker\",data=df,kind=\"box\",aspect=2);","c2c70f09":"sns.catplot(x=\"region\",y=\"charges\",data=df,kind=\"box\",aspect=2);","6e3b624e":"sns.catplot(x=\"children\",y=\"charges\",data=df,kind=\"box\",aspect=2);","aa91fa9f":"labels=[\"too_weak\",\"normal\",\"heavy\",\"too_heavy\"]\nranges=[0,18.5,24.9,29.9,np.inf]\ndf[\"bmi\"]=pd.cut(df[\"bmi\"],bins=ranges,labels=labels)","30ecd9a0":"print(sns.FacetGrid(df,hue=\"bmi\",height=5,aspect=2).map(sns.kdeplot,\"charges\",shade=False).add_legend());","d8bb4735":"print(sns.catplot(x=\"bmi\",y=\"charges\",kind=\"bar\",data=df,aspect=2));","9a3b9e15":"print(sns.catplot(x=\"bmi\",y=\"charges\",hue=\"children\",kind=\"bar\",data=df,aspect=3));","5ed1edc4":"print(sns.catplot(x=\"bmi\",y=\"charges\",hue=\"smoker\",data=df,kind=\"bar\",aspect=2));","335afcb1":"plt.rcParams.update({'font.size': 12})\nplt.figure(figsize=(10,5))\ncorr=df.corr()\nmask=np.zeros_like(corr,dtype=np.bool)\nmask[np.triu_indices_from(mask)]=True\nsns.heatmap(corr.abs(),annot=True,cmap=\"coolwarm\",mask=mask);","cade6b30":"plt.figure(figsize=(15,5))\nplt.subplot(121)\nsns.boxplot(df[\"charges\"],color=\"y\");\nplt.subplot(122)\nsns.boxplot(df[\"age\"],color=\"y\");","eedbdf27":"pd.crosstab(df.age,df.children)[:10]","ae43915a":"df[(df[\"age\"]==18)&(df[\"sex\"]==\"female\")&(df[\"children\"]>0)]","9b260390":"df[(df[\"age\"]==18) & (df[\"sex\"]==\"male\") & df[\"children\"]>0]","8ee7a6bc":"clf=LocalOutlierFactor(n_neighbors=50)\nclf.fit_predict(df[[\"age\",\"children\"]])","4ab65960":"clf_scores=clf.negative_outlier_factor_","3d52bdae":"np.sort(clf_scores)[0:20]","c2ba6997":"treshold=np.sort(clf_scores)[20]\ntreshold","9cb26781":"df[clf_scores<treshold]","265f657e":"df[(df[\"age\"]==18)&(df[\"children\"]>1)]","cf7a2a1e":"df.drop(df[(df[\"age\"]==18)&(df[\"children\"]>0)].index,inplace=True)","1986e3c2":"df.corr()","e5441d88":"print(sns.catplot(x=\"children\",y=\"charges\",hue=\"smoker\",data=df,kind=\"bar\",aspect=3));","423663f9":"df.shape","c031f7cd":"df.head()","ca7f429e":"df_new=df.copy()\ndf_new=pd.get_dummies(data=df,columns=[\"sex\",\"smoker\"],drop_first=True)","c77a0682":"df_new.head()","e73ba0bf":"df_new=pd.get_dummies(data=df_new,columns=[\"region\",\"bmi\"])","550e85e5":"df_new.head()","1b24e7a1":"df_new.charges=log(df_new.charges)\n\nsc=StandardScaler()\ndf_scaled=pd.DataFrame(sc.fit_transform(df_new),columns=df_new.columns,index=df_new.index)\n\ndf_scaled.head()","feb4ca52":"X=df_scaled.drop(\"charges\",axis=1)\ny=df_scaled[\"charges\"] ","047eaef0":"X_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=42)","b40a9ecc":"print(X_train.shape)\nprint(X_test.shape)\nprint(y_train.shape)\nprint(y_test.shape)","2da9e394":"lm=sm.OLS(y_train,X_train)\nmodel=lm.fit()\nmodel.summary()","d1435684":"X=df_scaled.drop([\"charges\",\"region_northwest\"],axis=1)\ny=df_scaled[\"charges\"] \nX_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=42)\nlm=sm.OLS(y_train,X_train)\nmodel=lm.fit()\nmodel.summary()","d570c981":"X=df_scaled.drop([\"charges\",\"region_northwest\",\"bmi_heavy\"],axis=1)\ny=df_scaled[\"charges\"] \n\nX_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=42)\nlm=sm.OLS(y_train,X_train)\nmodel=lm.fit()\nmodel.summary()","885b7dcf":"X=df_scaled.drop([\"charges\",\"region_northwest\",\"bmi_heavy\",\"bmi_too_weak\"],axis=1)\ny=df_scaled[\"charges\"] \nX_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=42)\nlm=sm.OLS(y_train,X_train)\nmodel=lm.fit()\nmodel.summary()","1a8d60b9":"X=df_scaled.drop([\"charges\",\"region_northwest\",\"bmi_heavy\",\"bmi_too_weak\",\"bmi_normal\"],axis=1)\ny=df_scaled[\"charges\"] \nX_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=42)\nlm=sm.OLS(y_train,X_train)\nmodel=lm.fit()\nmodel.summary()","1c0db9ba":"X=df_scaled.drop([\"charges\",\"region_northwest\",\"bmi_heavy\",\"bmi_too_weak\",\"bmi_normal\",\"region_northeast\"],axis=1)\ny=df_scaled[\"charges\"] \nX_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=42)\nlm=sm.OLS(y_train,X_train)\nmodel=lm.fit()\nmodel.summary()","ecbc8ce5":"model.params","ebc87f62":"model=LinearRegression()\nlin_mo=model.fit(X_train,y_train)\ny_pred=lin_mo.predict(X_test)","36fa57de":"lin_mo.score(X_train,y_train)","aaad854f":"lin_mo.score(X_test,y_test)","471eec16":"r2_score(y_test,y_pred)","b03023b3":"plt.figure(figsize=(12,5));\nax1=sns.distplot(y_test,hist=False, color='r')\nsns.distplot(y_pred,ax=ax1,hist=False, color='b');","a006ed95":"plt.figure(figsize=(12,8));\nresiduals_plot(model, X_train, y_train, X_test, y_test,line_color=\"red\");","d5cf9fe6":"plt.figure(figsize=(12,8));\nprediction_error(model, X_train, y_train, X_test, y_test);","dabca9eb":"model.coef_","0f3935f4":"model.intercept_","6d4cfdda":"**age:** age of primary beneficiary\n\n**sex:** insurance contractor gender, female, male\n\n**bmi:** Body mass index, providing an understanding of body, weights that are relatively high or low relative to height,\n    objective index of body weight (kg \/ m ^ 2) using the ratio of height to weight, ideally 18.5 to 24.9\n\n**children:** Number of children covered by health insurance \/ Number of dependents\n\n**smoker:** Smoking\n\n**region:** the beneficiary's residential area in the US, northeast, southeast, southwest, northwest.\n\n**charges:** Individual medical costs billed by health insurance\n","fda4d4e0":"### Data Discretization","9213cdc8":"# <font color='blue'>Exploratory Data Analysis <\/font>  ","9937d683":"# Business Understanding","a41859bc":"# <font color='blue'>Train Test Split <\/font>  ","8016639c":"how many children covered not by health insurance?","50904b20":"# <font color='blue'>OLS Regression<\/font>  ","61b607bd":"# <font color='Black'>Welcome to this Notebook <\/font> \n# <font color='Green'>MEDICAL COST EDA AND OLS REGRESSION<\/font>  \n\n# This notebook contains:\n* Data Preprocessing\n* Advanced Data Visualization\n* Exploratory Data Analysis EDA\n* Checking Missing Values\n* Data Engineering\/Data Extraction\/Data Standardization\n* Outlier Detection with LOF Technique\n* Model Building\/OLS Regression Model \n* Advanced Statistical Analysis such as Backward Selection Technique\n* Model Evaluation \n* Visualization of Residual Plot and Prediction Error of the Regression Model \n","a8b92523":"**Notice:** There are two main reasons to use logarithmic scales in charts and graphs. The first is to respond to skewness towards large values; i.e., cases in which one or a few points are much larger than the bulk of the data. The second is to show percent change or multiplicative factors. ","c775bd65":"# Conclusion:\n* We did perform the Data Preprocessing \n* We did visualize some advanced plots and conduct the Exploratory Data Analysis EDA\n* We did perform some Data Engineering\/Data Extraction\n* We did perform Outlier Detection with LOF Technique\n* We did perform the Standardization Technique\n* We did build the OLS Regression Model\n* We did conduct some advanced statistical analytics such as Backward Selection Technique to improve the model performance\n* We did visualize the Residual Plot and Prediction Error of the Regression Model\n### I have tried to perform some advanced statistical analysis in this notebook, and I hope you enjoy reading my notebook\n","7db80a26":"### Unsupervised Outlier Detection using Local Outlier Factor (LOF)","c7717699":"Great! we do not have any missing values in our dataset."}}