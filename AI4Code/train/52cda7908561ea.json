{"cell_type":{"3742b5dd":"code","77bd61f2":"markdown"},"source":{"3742b5dd":"import os\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom matplotlib.widgets import Button\nimport cv2 as cv\nimport pandas as pd\nfrom matplotlib.widgets import CheckButtons\nimport ast\n\n# Load annotation.\nannot_dir = \"..\/input\/ranzcr-clip-catheter-line-classification\/train_annotations.csv\"\ndf_annot = pd.read_csv(annot_dir)\n\n# Load every image paths.\nfolder = \"..\/input\/ranzcr-clip-catheter-line-classification\/train\"\nimg_path_l = [os.path.join(folder, name) for name in os.listdir(folder)]\n\n# View image has annotation.\nannot_uid_l = list(df_annot[\"StudyInstanceUID\"].unique())\nimg_path_l = [\n    path\n    for path in img_path_l\n    if os.path.splitext(\n        os.path.basename(path))[0] in annot_uid_l \n]\n\nfig, ax = plt.subplots()\nplt.subplots_adjust(bottom=0.2)\nplt.subplots_adjust(left=0.2)\n\nclass Line(object):\n    lines = []\n    def set_lines(self, lines):\n        self.lines = lines\n    \n    def toggle_visibility(self, event):\n        for l in self.lines:\n            l.set_visible(not l.get_visible())\n\nline_ins = Line()\n\nclass Index(object):\n    ind = 0\n\n    def next(self, event):\n        self.ind += 1\n        self.show_image(self.ind)\n\n    def prev(self, event):\n        self.ind -= 1\n        self.show_image(self.ind)\n    \n    def show_image(self, ind):\n        ax.clear()\n        img_path = img_path_l[ind]\n        bname = os.path.basename(img_path)\n        uid, _ = os.path.splitext(bname)\n        df_img_annot = df_annot[\n            df_annot[\"StudyInstanceUID\"] == uid]\n        print(df_img_annot[\"label\"])\n        img = cv.imread(cv.samples.findFile(img_path))\n        ax.imshow(img)\n        layer_l = []\n        for i,r in df_img_annot.iterrows():\n            data = np.array(ast.literal_eval(r[\"data\"]))\n            l = ax.scatter(data[:, 0], data[:, 1], label=r[\"label\"])\n            layer_l.append(l)\n        line_ins.set_lines(layer_l)\n        ax.legend()\n\ncallback = Index()\naxprev = plt.axes([0.7, 0.05, 0.1, 0.075])\naxnext = plt.axes([0.81, 0.05, 0.1, 0.075])\nbnext = Button(axnext, 'Next')\nbnext.on_clicked(callback.next)\nbprev = Button(axprev, 'Previous')\nbprev.on_clicked(callback.prev)\n\nax_line = plt.axes([0.5, 0.05, 0.1, 0.075])\nb_line = Button(ax_line, 'Show line')\nb_line.on_clicked(line_ins.toggle_visibility)\n\ncallback.show_image(0)\nplt.show()\n","77bd61f2":"Usage:\n    1. Download ranzcr-clip-catheter-line-classification.zip to your PC.\n    2. Copy and paste below code to your local python code and run it.\n\nEnvironment:\n    * Python 3.8\n    * matplotlib 3.3.4\n    * Pandas 1.1.3\n![Peek%202021-01-30%2021-36.gif](attachment:Peek%202021-01-30%2021-36.gif)"}}