{"cell_type":{"4bed4976":"code","b3a3e830":"code","ed46f6d9":"code","83aac38f":"code","346066e3":"code","713c90ff":"code","5e0922f9":"code","e6422e61":"code","317bad9b":"code","bbadd6fc":"code","4ddd6456":"code","af3354e8":"code","f2c7c77e":"code","f7e8bbba":"code","d02a59a2":"code","fa3dcec7":"code","dbf566bc":"code","7722849c":"code","e1c3377a":"code","15b9d199":"markdown","2722133e":"markdown","6c0ff2db":"markdown","c314cfbb":"markdown","265ccaa0":"markdown","d395592f":"markdown","451d7c5f":"markdown","c7181900":"markdown","e3539be7":"markdown","98c1ff25":"markdown","b2e23c6a":"markdown","d6858fba":"markdown"},"source":{"4bed4976":"# \u7279\u5fb4\u91cf\u306e\u6e96\u5099\n\nimport numpy as np\nimport pandas as pd\n\ntrain = pd.read_csv(\"..\/input\/titanic\/train.csv\")\ntest = pd.read_csv(\"..\/input\/titanic\/test.csv\")\ngender_submission = pd.read_csv(\"..\/input\/titanic\/gender_submission.csv\")\n\ndata = pd.concat([train, test], sort=False)\n\ndata['Sex'].replace(['male','female'], [0, 1], inplace=True)\ndata['Embarked'].fillna(('S'), inplace=True)\ndata['Embarked'] = data['Embarked'].map( {'S': 0, 'C': 1, 'Q': 2} ).astype(int)\ndata['Fare'].fillna(np.mean(data['Fare']), inplace=True)\ndata['Age'].fillna(data['Age'].median(), inplace=True)\ndata['FamilySize'] = data['Parch'] + data['SibSp'] + 1\ndata['IsAlone'] = 0\ndata.loc[data['FamilySize'] == 1, 'IsAlone'] = 1","b3a3e830":"data.head()","ed46f6d9":"delete_columns = ['Name', 'PassengerId', 'Ticket', 'Cabin']\ndata.drop(delete_columns, axis=1, inplace=True)\n\ntrain = data[:len(train)]\ntest = data[len(train):]\n\ny_train = train['Survived']\nX_train = train.drop('Survived', axis=1)\nX_test = test.drop('Survived', axis=1)","83aac38f":"X_train.head()","346066e3":"from sklearn.model_selection import train_test_split\nX_train, X_valid, y_train, y_valid = train_test_split(X_train, y_train, test_size=0.3, random_state=0, stratify=y_train)","713c90ff":"# \u30ab\u30c6\u30b4\u30ea\u5909\u6570\u306e\u6307\u5b9a\ncategorical_features = ['Embarked', 'Pclass', 'Sex']","5e0922f9":"params = {\n    'objective': 'binary'\n}","e6422e61":"import lightgbm as lgb\n\n\nlgb_train = lgb.Dataset(X_train, y_train, categorical_feature=categorical_features)\nlgb_eval = lgb.Dataset(X_valid, y_valid, reference=lgb_train, categorical_feature=categorical_features)\n\nmodel = lgb.train(\n    params, lgb_train,\n    valid_sets=[lgb_train, lgb_eval],\n    verbose_eval=10,\n    num_boost_round=1000,\n    early_stopping_rounds=10\n)\n\ny_pred = model.predict(X_test, num_iteration=model.best_iteration)","317bad9b":"y_pred[:10]","bbadd6fc":"params = {\n    'objective': 'binary',\n    'max_bin': 300,\n    'learning_rate': 0.05,\n    'num_leaves': 40\n}","4ddd6456":"lgb_train = lgb.Dataset(X_train, y_train, categorical_feature=categorical_features)\nlgb_eval = lgb.Dataset(X_valid, y_valid, reference=lgb_train, categorical_feature=categorical_features)\n\nmodel = lgb.train(\n    params, lgb_train,\n    valid_sets=[lgb_train, lgb_eval],\n    verbose_eval=10,\n    num_boost_round=1000,\n    early_stopping_rounds=10\n)\n\ny_pred = model.predict(X_test, num_iteration=model.best_iteration)","af3354e8":"y_pred[:10]","f2c7c77e":"y_pred = (y_pred > 0.5).astype(int)\ny_pred[:10]","f7e8bbba":"sub = gender_submission\n\nsub['Survived'] = y_pred\nsub.to_csv(\"submission_lightgbm_handtuning.csv\", index=False)\n\nsub.head()","d02a59a2":"# Kaggle\u306eKernel\u306b\u642d\u8f09\u6e08\nimport optuna\nfrom sklearn.metrics import log_loss\n\n\ndef objective(trial):\n    params = {\n        'objective': 'binary',\n        'max_bin': trial.suggest_int('max_bin', 255, 500),\n        'learning_rate': 0.05,\n        'num_leaves': trial.suggest_int('num_leaves', 32, 128),\n    }\n    \n    lgb_train = lgb.Dataset(X_train, y_train, categorical_feature=categorical_features)\n    lgb_eval = lgb.Dataset(X_valid, y_valid, reference=lgb_train, categorical_feature=categorical_features)\n\n    model = lgb.train(\n        params, lgb_train,\n        valid_sets=[lgb_train, lgb_eval],\n        verbose_eval=10,\n        num_boost_round=1000,\n        early_stopping_rounds=10\n    )\n\n    y_pred_valid = model.predict(X_valid, num_iteration=model.best_iteration)\n    score = log_loss(y_valid, y_pred_valid)\n    return score","fa3dcec7":"study = optuna.create_study(sampler=optuna.samplers.RandomSampler(seed=0))\nstudy.optimize(objective, n_trials=40)","dbf566bc":"study.best_params","7722849c":"params = {\n    'objective': 'binary',\n    'max_bin': study.best_params['max_bin'],\n    'learning_rate': 0.05,\n    'num_leaves': study.best_params['num_leaves']\n}\n\nlgb_train = lgb.Dataset(X_train, y_train, categorical_feature=categorical_features)\nlgb_eval = lgb.Dataset(X_valid, y_valid, reference=lgb_train, categorical_feature=categorical_features)\n\nmodel = lgb.train(\n    params, lgb_train,\n    valid_sets=[lgb_train, lgb_eval],\n    verbose_eval=10,\n    num_boost_round=1000,\n    early_stopping_rounds=10\n)\n\ny_pred = model.predict(X_test, num_iteration=model.best_iteration)","e1c3377a":"y_pred = (y_pred > 0.5).astype(int)\n\nsub['Survived'] = y_pred\nsub.to_csv(\"submission_lightgbm_optuna.csv\", index=False)\n\nsub.head()","15b9d199":"LightGBM\u3067\u306e\u4e88\u6e2c\u7d50\u679c\u3092\u63d0\u51fa\u3057\u3066\u307f\u308b\u3068\u3001\u79c1\u306e\u74b0\u5883\u3067\u306f0.77033\u3068\u3044\u3046\u30b9\u30b3\u30a2\u304c\u51fa\u307e\u3057\u305f\u3002\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u5909\u66f4\u524d\u306e0.75598\u306b\u6bd4\u3079\u3066\u3001\u30b9\u30b3\u30a2\u304c\u5411\u4e0a\u3057\u3066\u3044\u307e\u3059\u3002\n\n# Optuna\u3092\u4f7f\u3046","2722133e":"\u3053\u3053\u3067\u306f\u516c\u5f0fdocumentation\u306e\u300c[Parameters Tuning](https:\/\/lightgbm.readthedocs.io\/en\/latest\/Parameters-Tuning.html)\u300d\u306b\u5f93\u3063\u3066\u3001\u624b\u52d5\u3067\u8abf\u6574\u3092\u884c\u3063\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\u3044\u304f\u3064\u304b\u306e\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u5225\u306b\u3001\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u8abf\u6574\u306eTips\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u4eca\u56de\u306f\u3001\u7cbe\u5ea6\u3092\u9ad8\u3081\u308b\u306e\u304c\u76ee\u7684\u306a\u306e\u3067\u300c[For Better Accuracy](https:\/\/lightgbm.readthedocs.io\/en\/latest\/Parameters-Tuning.html#for-better-accuracy)\u300d\u3092\u53c2\u7167\u3057\u307e\u3059\u3002\n\n> - Use large max_bin (may be slower)\n> - Use small learning_rate with large num_iterations\n> - Use large num_leaves (may cause over-fitting)\n> - Use bigger training data\n> - Try dart\n\n- 1\u3064\u76ee\u306f\u300c\u5927\u304d\u3081\u306e`max_bin`\u3092\u4f7f\u3048\u300d\u3067\u3059\u3002`default`\u306e\u5024\u306f255\u306a\u306e\u3067\u3001\u3053\u3053\u3067\u306f300\u306b\u3057\u3066\u307f\u307e\u3059\u3002\n- 2\u3064\u76ee\u306f\u300c\u5c0f\u3055\u3081\u306e`learning_rate`\u3092\u4f7f\u3048\u300d\u3067\u3059\u3002`default`\u306e\u5024\u306f0.1\u306a\u306e\u3067\u3001\u3053\u3053\u3067\u306f0.05\u306b\u3057\u3066\u307f\u307e\u3059\u3002\n- 3\u3064\u76ee\u306f\u300c\u5927\u304d\u3081\u306e`num_leaves`\u3092\u4f7f\u3048\u300d\u3067\u3059\u3002`default`\u306e\u5024\u306f31\u306a\u306e\u3067\u3001\u3053\u3053\u3067\u306f40\u306b\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u624b\u52d5\u3067\u8abf\u6574\u3059\u308b\u306b\u305b\u3088\u3001\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u30c4\u30fc\u30eb\u3092\u4f7f\u3046\u306b\u305b\u3088\u3001\u6a5f\u68b0\u5b66\u7fd2\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30d6\u30e9\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u7684\u306b\u5229\u7528\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6b63\u3057\u304f\u7406\u89e3\u3059\u308b\u3053\u3068\u304c\u975e\u5e38\u306b\u5927\u5207\u3067\u3059\u3002\n\n\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u8aac\u660e\u306b\u3064\u3044\u3066\u306f\u3001\u82f1\u8a9e\u3067\u3059\u304c[\u516c\u5f0f\u306edocumentation](https:\/\/lightgbm.readthedocs.io\/en\/latest\/Parameters.html)\u3067\u78ba\u8a8d\u3059\u308b\u306e\u304c\u78ba\u5b9f\u3067\u3059\u3002\u306a\u304a\u65e5\u672c\u8a9e\u306e\u8a18\u4e8b\u3060\u3068\u3001\u4f8b\u3048\u3070[\u3053\u3061\u3089](https:\/\/nykergoto.hatenablog.jp\/entry\/2019\/03\/29\/%E5%8B%BE%E9%85%8D%E3%83%96%E3%83%BC%E3%82%B9%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%A7%E5%A4%A7%E4%BA%8B%E3%81%AA%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%AE%E6%B0%97%E6%8C%81%E3%81%A1)\u306bLightGBM\u306a\u3069\u306e\u52fe\u914d\u30d6\u30fc\u30b9\u30c6\u30a3\u30f3\u30b0\u306e\u4e3b\u8981\u306a\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u89e3\u8aac\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002","6c0ff2db":"This Notebook is a kaggle tutorial for Japanese kaggle beginners writen in Japanese.\n\n# 5. \u6a5f\u68b0\u5b66\u7fd2\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u304a\u6c17\u6301\u3061\uff1f\uff01 \u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8abf\u6574\u3057\u3066\u307f\u3088\u3046","c314cfbb":"\u5f8c\u306e\u6bd4\u8f03\u306e\u305f\u3081\u306b\u3001\u3053\u306e\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u5b66\u7fd2\u30fb\u4e88\u6e2c\u3092\u5b9f\u65bd\u3057\u3066\u304a\u304d\u307e\u3059\u3002","265ccaa0":"\u6307\u5b9a\u3057\u305f\u7bc4\u56f2\u5185\u3067\u8a66\u884c\u56de\u6570\u3060\u3051\u63a2\u7d22\u3057\u305f\u7d50\u679c\u5f97\u3089\u308c\u305f\u6700\u826f\u306e\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u3061\u3089\u3067\u6539\u3081\u3066\u4e88\u6e2c\u3057\u76f4\u3057\u3066\u3001\u63d0\u51fa\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002","d395592f":"\u3053\u3053\u307e\u3067\u624b\u52d5\u3067\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8abf\u6574\u3057\u3066\u304d\u307e\u3057\u305f\u304c\u3001\u6b21\u306e\u3088\u3046\u306a\u611f\u60c5\u304c\u82bd\u751f\u3048\u3066\u3044\u308b\u65b9\u3082\u3044\u308b\u306e\u3067\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u304b\u3002\n\n- \u300c\u5927\u304d\u3081\u300d\u300c\u5c0f\u3055\u3081\u300d\u3068\u3044\u3063\u3066\u3082\u3001\u5177\u4f53\u7684\u306b\u3069\u306e\u5024\u306b\u3059\u308c\u3070\u3088\u3044\u306e\u304b\u5206\u304b\u3089\u306a\u3044\n- \u5404\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u7d44\u307f\u5408\u308f\u305b\u65b9\u3082\u3044\u304f\u3064\u304b\u3042\u308a\u3001\u9010\u4e00\u8a2d\u5b9a\u30fb\u5b9f\u884c\u3057\u3066\u6027\u80fd\u3092\u691c\u8a3c\u3059\u308b\u306e\u306f\u7169\u308f\u3057\u3044\n\n\u305d\u306e\u3088\u3046\u306a\u8ab2\u984c\u3092\u89e3\u6c7a\u3057\u3066\u304f\u308c\u308b\u306e\u304c\u3001\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u30c4\u30fc\u30eb\u3067\u3059\u3002\u4eca\u56de\u306fOptuna\u3092\u4f7f\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\nOptuna\u3092\u4f7f\u3046\u306b\u5f53\u305f\u3063\u3066\u306f\u3001\u3042\u3089\u304b\u3058\u3081\u6b21\u306e\u95a2\u6570\u306e`trial.suggest_int()`\u306e\u3088\u3046\u306b\u3001\u63a2\u7d22\u7bc4\u56f2\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002 \n\n\u3053\u3053\u3067\u306f\u3001\u610f\u56f3\u7684\u306b`learning_rate`\u306e\u8abf\u6574\u3092\u5b9f\u65bd\u3057\u3066\u3044\u307e\u305b\u3093\u3002\u30c6\u30fc\u30d6\u30eb\u30c7\u30fc\u30bf\u3092LightGBM\u3067\u6271\u3046\u5834\u5408\u3001\u4e00\u822c\u306b`learning_rate`\u304c\u4f4e\u3044\u307b\u3069\u9ad8\u3044\u6027\u80fd\u304c\u5f97\u3089\u308c\u308b\u305f\u3081\u3067\u3059\u3002\u305d\u306e\u305f\u3081\u63a2\u7d22\u7bc4\u56f2\u306b\u306f\u542b\u3081\u305a\u3001\u5fc5\u8981\u3067\u3042\u308c\u3070\u5f8c\u306b\u624b\u52d5\u3067\u4f4e\u3044\u5024\u306b\u5909\u66f4\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002","451d7c5f":"# \u624b\u52d5\u3067\u8abf\u6574\n\n\u6b21\u306e\u90e8\u5206\u3067\u3001LightGBM\u306e\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\u524d\u56de\u306f `objective` \u306e\u307f\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u660e\u793a\u7684\u306b\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u3001 `default` \u306e[\u5024](https:\/\/lightgbm.readthedocs.io\/en\/latest\/Parameters.html)\u304c\u81ea\u52d5\u7684\u306b\u5b9a\u7fa9\u3055\u308c\u307e\u3059\u3002","c7181900":"\u4e88\u6e2c\u7d50\u679c\u3092\u63d0\u51fa\u3057\u3066\u307f\u308b\u3068\u3001\u79c1\u306e\u74b0\u5883\u3067\u306f0.77033\u3068\u3044\u3046\u30b9\u30b3\u30a2\u304c\u51fa\u307e\u3057\u305f\u3002\u5076\u7136\u624b\u52d5\u3067\u306e\u8abf\u6574\u3068\u540c\u3058\u30b9\u30b3\u30a2\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u63a2\u7d22\u7bc4\u56f2\u3084\u8a66\u884c\u56de\u6570\u3092\u5909\u3048\u308c\u3070\u3001\u3088\u308a\u826f\u3044\u30b9\u30b3\u30a2\u304c\u51fa\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002","e3539be7":"\u5148\u306b\u3082\u8aac\u660e\u3057\u305f\u3088\u3046\u306b\u3001\u6a5f\u68b0\u5b66\u7fd2\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u632f\u308b\u821e\u3044\u306f\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3044\u3046\u5024\u3067\u5236\u5fa1\u3055\u308c\u307e\u3059\u3002\u3082\u3061\u308d\u3093\u3001\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u5024\u6b21\u7b2c\u3067\u4e88\u6e2c\u7d50\u679c\u306f\u5909\u308f\u308a\u5f97\u307e\u3059\u3002\n\n\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u8abf\u6574\u306f\u3001\u4e3b\u306b2\u7a2e\u985e\u306e\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\n\n- \u624b\u52d5\u3067\u8abf\u6574\n- \u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u30c4\u30fc\u30eb\u3092\u4f7f\u3046\n\n\u5f8c\u8005\u3068\u3057\u3066\u306f\u3001[Grid search](https:\/\/qiita.com\/yhyhyhjp\/items\/c81f7cea72a44a7bfd3a), [Bayesian Optimization](https:\/\/blog.amedama.jp\/entry\/2018\/08\/18\/233841), [Hyperopt](https:\/\/blog.amedama.jp\/entry\/hyperopt), [Optuna](https:\/\/research.preferred.jp\/2018\/12\/optuna-release\/)\u306a\u3069\u3001\u3044\u304f\u3064\u304b\u306e\u30c4\u30fc\u30eb\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u3053\u306e[Notebook](https:\/\/www.kaggle.com\/sishihara\/upura-kaggle-tutorial-05-tuning)\u3067\u306f\u3001\u6700\u521d\u306b\u624b\u52d5\u3067\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8abf\u6574\u3057\u3001\u6a5f\u68b0\u5b66\u7fd2\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u632f\u308b\u821e\u3044\u304c\u7570\u306a\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u305d\u306e\u5f8c\u3001Optuna\u3092\u7528\u3044\u305f\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u3092\u5b9f\u65bd\u3057\u307e\u3059\u3002","98c1ff25":"y_pred\u304c\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u5909\u66f4\u524d\u3068\u7570\u306a\u308b\u5024\u3092\u53d6\u3063\u3066\u3044\u308b\u3068\u5206\u304b\u308a\u307e\u3059\u3002\u51fa\u529b\u30ed\u30b0\u306b\u3082\u5909\u5316\u304c\u3042\u308a\u3001\u6700\u7d42\u7684\u306a`valid_1's binary_logloss`\u304c 0.433251 \u3068\u3001\u5909\u66f4\u524d\u3088\u308a\u3082\u5c0f\u3055\u3044\u5024\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002`binary_logloss` \u306f\u640d\u5931\u306a\u306e\u3067\u3001\u5c0f\u3055\u3044\u65b9\u304c\u671b\u307e\u3057\u3044\u3067\u3059\u3002","b2e23c6a":"\u7279\u5fb4\u91cf\u306e\u6e96\u5099\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\n\n## LightGBM\n\nX_train\u3092X_train\uff08\u5b66\u7fd2\u7528\uff09\u3068X_valid\uff08\u691c\u8a3c\u7528\uff09\u306b\u5206\u5272\u3057\u307e\u3059\u3002","d6858fba":"`n_trials`\u306f\u8a66\u884c\u56de\u6570\u3067\u3059\u3002\u3053\u3053\u3067\u306f\u8a08\u7b97\u3092\u77ed\u304f\u3059\u308b\u305f\u3081\u300140\u56de\u7a0b\u5ea6\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\u4e71\u6570\u3082\u56fa\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002"}}