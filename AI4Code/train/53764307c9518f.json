{"cell_type":{"eca44e14":"code","6a7c2000":"code","9298631a":"code","7bdaeab8":"code","24015281":"code","a73f1844":"code","3b74edcc":"code","21ed3bcd":"code","0b063368":"code","6a116f2c":"code","2c29f83f":"code","2970f0f2":"code","e398895e":"code","62ae0baf":"code","ba82c4e3":"code","78cb0111":"code","009c1f2c":"code","bd2b2441":"code","fad3a6a3":"code","56248e01":"code","e2707117":"code","8e0835fa":"code","b60f9d07":"code","75b07c1e":"code","0e431803":"code","febb33e8":"code","c932a2c4":"code","edb06164":"code","ec2a8130":"code","21d8d1a9":"code","214b1342":"code","973de8c7":"code","7741ec86":"code","7a8afa28":"code","538af8d9":"code","29a2f335":"code","6c7a3e71":"code","a85653ab":"code","612573ac":"code","c2cf2095":"code","345f41e6":"code","99255ff2":"code","69731533":"code","740f2848":"code","85a1f985":"code","78765b53":"markdown","8409a9d5":"markdown"},"source":{"eca44e14":"\n# Load various imports \nimport pandas as pd\nimport numpy as np\nimport os\nimport librosa\nimport glob \nimport numpy as np\nimport skimage\nimport librosa.display\nimport IPython.display as ipd\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\n\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import classification_report\nfrom sklearn.model_selection import GridSearchCV\n\nfrom sklearn.preprocessing import MinMaxScaler","6a7c2000":"from tensorflow.keras.models import Sequential\nfrom tensorflow.keras.layers import Conv2D, Flatten, Dense, MaxPool2D, Dropout\nfrom tensorflow.keras.utils import to_categorical \n\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.svm import SVC","9298631a":"import pandas as pd\nmetadata = pd.read_csv('UrbanSound8K.csv')\nmetadata.head()","7bdaeab8":"metadata[metadata['class']=='street_music'][['slice_file_name','fold']].iloc[0,:]","24015281":"print(metadata['class'].value_counts())","a73f1844":"def plot_spectrogram(signal, name):\n    \"\"\"Compute power spectrogram with Short-Time Fourier Transform and plot result.\"\"\"\n    spectrogram = librosa.amplitude_to_db(librosa.stft(signal))\n    plt.figure(figsize=(25, 8))\n    librosa.display.specshow(spectrogram, y_axis=\"log\")\n    plt.colorbar(format=\"%+2.0f dB\")\n    plt.title(f\"Log-frequency power spectrogram for {name}\")\n    plt.xlabel(\"Time\")\n    plt.show()","3b74edcc":"street_music_file = metadata[metadata['class']=='street_music'][['slice_file_name','fold']].iloc[0,:]\ndrilling_file = metadata[metadata['class']=='drilling'][['slice_file_name','fold']].iloc[0,:]\nengine_idling_file = metadata[metadata['class']=='engine_idling'][['slice_file_name','fold']].iloc[0,:]\nchildren_playing_file = metadata[metadata['class']=='children_playing'][['slice_file_name','fold']].iloc[0,:]\ndog_bark_file = metadata[metadata['class']=='dog_bark'][['slice_file_name','fold']].iloc[0,:]\njackhammer_file = metadata[metadata['class']=='jackhammer'][['slice_file_name','fold']].iloc[0,:]\nair_conditioner_file = metadata[metadata['class']=='air_conditioner'][['slice_file_name','fold']].iloc[0,:]\nsiren_file = metadata[metadata['class']=='siren'][['slice_file_name','fold']].iloc[0,:]\ncar_horn_file = metadata[metadata['class']=='car_horn'][['slice_file_name','fold']].iloc[0,:]\ngun_shot_file = metadata[metadata['class']=='gun_shot'][['slice_file_name','fold']].iloc[0,:]","21ed3bcd":"# load sounds\nmusic, _ = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(street_music_file[1])+'\/',str(street_music_file[0])))\ndrilling, _ = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(drilling_file[1])+'\/',str(drilling_file[0])))\nengine_idling, _ = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(engine_idling_file[1])+'\/',str(engine_idling_file[0])))\nchildren_playing, _ = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(children_playing_file[1])+'\/',str(children_playing_file[0])))\ndog_bark, _ = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(dog_bark_file[1])+'\/',str(dog_bark_file[0])))\njackhammer, _ = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(jackhammer_file[1])+'\/',str(jackhammer_file[0])))\nair_conditioner, _ = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(air_conditioner_file[1])+'\/',str(air_conditioner_file[0])))\nsiren, _ = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(siren_file[1])+'\/',str(siren_file[0])))\ncar_horn, _ = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(car_horn_file[1])+'\/',str(car_horn_file[0])))\ngun_shot, _ = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(gun_shot_file[1])+'\/',str(gun_shot_file[0])))","0b063368":"# Street Music\n\ndata,sample_rate = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(street_music_file[1])+'\/',str(street_music_file[0])))\n_ = librosa.display.waveplot(data,sr=sample_rate)\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(street_music_file[1])+'\/',str(street_music_file[0])))","6a116f2c":"plot_spectrogram(music, \"music\")\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(street_music_file[1])+'\/',str(street_music_file[0])))","2c29f83f":"# Drilling\n\ndata,sample_rate = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(drilling_file[1])+'\/',str(drilling_file[0])))\n_ = librosa.display.waveplot(data,sr=sample_rate)\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(drilling_file[1])+'\/',str(drilling_file[0])))","2970f0f2":"plot_spectrogram(drilling, \"drilling\")\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(drilling_file[1])+'\/',str(drilling_file[0])))","e398895e":"# Enngine Idling\n\ndata,sample_rate = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(engine_idling_file[1])+'\/',str(engine_idling_file[0])))\n_ = librosa.display.waveplot(data,sr=sample_rate)\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(engine_idling_file[1])+'\/',str(engine_idling_file[0])))","62ae0baf":"plot_spectrogram(engine_idling, \"engine_idling\")\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(engine_idling_file[1])+'\/',str(engine_idling_file[0])))","ba82c4e3":"# Children Playing\n\ndata,sample_rate = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(children_playing_file[1])+'\/',str(children_playing_file[0])))\n_ = librosa.display.waveplot(data,sr=sample_rate)\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(children_playing_file[1])+'\/',str(children_playing_file[0])))","78cb0111":"plot_spectrogram(children_playing, \"children_playing\")\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(children_playing_file[1])+'\/',str(children_playing_file[0])))","009c1f2c":"# Dog Barking\n\ndata,sample_rate = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(dog_bark_file[1])+'\/',str(dog_bark_file[0])))\n_ = librosa.display.waveplot(data,sr=sample_rate)\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(dog_bark_file[1])+'\/',str(dog_bark_file[0])))","bd2b2441":"plot_spectrogram(dog_bark, \"dog_barking\")\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(dog_bark_file[1])+'\/',str(dog_bark_file[0])))","fad3a6a3":"# Jackhammer\n\ndata,sample_rate = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(jackhammer_file[1])+'\/',str(jackhammer_file[0])))\n_ = librosa.display.waveplot(data,sr=sample_rate)\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(jackhammer_file[1])+'\/',str(jackhammer_file[0])))","56248e01":"plot_spectrogram(jackhammer, \"jackhammer\")\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(jackhammer_file[1])+'\/',str(jackhammer_file[0])))","e2707117":"# Air Conditioner\n\ndata,sample_rate = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(air_conditioner_file[1])+'\/',str(air_conditioner_file[0])))\n_ = librosa.display.waveplot(data,sr=sample_rate)\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(air_conditioner_file[1])+'\/',str(air_conditioner_file[0])))","8e0835fa":"plot_spectrogram(air_conditioner, \"airconditioner\")\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(air_conditioner_file[1])+'\/',str(air_conditioner_file[0])))","b60f9d07":"# Siren\n\ndata,sample_rate = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(siren_file[1])+'\/',str(siren_file[0])))\n_ = librosa.display.waveplot(data,sr=sample_rate)\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(siren_file[1])+'\/',str(siren_file[0])))","75b07c1e":"plot_spectrogram(siren, \"siren\")\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(siren_file[1])+'\/',str(siren_file[0])))","0e431803":"# Car_Horn\n\ndata,sample_rate = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(car_horn_file[1])+'\/',str(car_horn_file[0])))\n_ = librosa.display.waveplot(data,sr=sample_rate)\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(car_horn_file[1])+'\/',str(car_horn_file[0])))","febb33e8":"plot_spectrogram(car_horn, \"car_horn\")\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(car_horn_file[1])+'\/',str(car_horn_file[0])))","c932a2c4":"# Gun_Shot\n\ndata,sample_rate = librosa.load(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(gun_shot_file[1])+'\/',str(gun_shot_file[0])))\n_ = librosa.display.waveplot(data,sr=sample_rate)\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(gun_shot_file[1])+'\/',str(gun_shot_file[0])))","edb06164":"plot_spectrogram(gun_shot, \"gun_shot\")\nipd.Audio(os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(gun_shot_file[1])+'\/',str(gun_shot_file[0])))","ec2a8130":"def extract_features(file_name):\n   \n    try:\n        audio, sample_rate = librosa.load(file_name, res_type='kaiser_fast') \n        mfccs = librosa.feature.mfcc(y=audio, sr=sample_rate, n_mfcc=40)\n        mfccsscaled = np.mean(mfccs.T,axis=0)\n        \n    except Exception as e:\n        print(\"Error encountered while parsing file: \", file_name)\n        return None \n     \n    return mfccsscaled","21d8d1a9":"# Set the path to the full UrbanSound dataset \nfulldatasetpath = '\/home\/ubuntu\/deep_learning\/folder'\n\nmetadata = pd.read_csv(fulldatasetpath + '\/UrbanSound8K.csv')\n\nfeatures = []\n\n# Iterate through each sound file and extract the features \nfor index, row in metadata.iterrows():\n    \n    file_name = os.path.abspath('folder\/')+'\/'+os.path.join('fold'+str(row[\"fold\"])+'\/',str(row[\"slice_file_name\"]))\n    \n    class_label = row[\"class\"]\n    data = extract_features(file_name)\n    \n    features.append([data, class_label])\n\n# Convert into a Panda dataframe \nfeaturesdf = pd.DataFrame(features, columns=['feature','class_label'])\n\nprint('Finished feature extraction from ', len(featuresdf), ' files')","214b1342":"from sklearn.preprocessing import LabelEncoder\nfrom keras.utils import to_categorical\n\n# Convert features and corresponding classification labels into numpy arrays\nX = np.array(featuresdf.feature.tolist())\ny = np.array(featuresdf.class_label.tolist())\n\n# Encode the classification labels\nle = LabelEncoder()\nyy = to_categorical(le.fit_transform(y)) \n\n# split the dataset \nfrom sklearn.model_selection import train_test_split \n\nx_train, x_test, y_train, y_test = train_test_split(X, yy, test_size=0.2, random_state = 42)","973de8c7":"x_test.shape","7741ec86":"import numpy as np\nfrom keras.models import Sequential\nfrom keras.layers import Dense, Dropout, Activation, Flatten\nfrom keras.layers import Convolution2D, Conv2D, MaxPooling2D, GlobalAveragePooling2D\nfrom keras.optimizers import Adam\nfrom keras.utils import np_utils\nfrom sklearn import metrics \n\nnum_rows = 40\nnum_columns = 174\nnum_channels = 1\n\n#x_train = x_train.reshape(x_train.shape[0], num_rows, num_columns, num_channels)\n#x_test = x_test.reshape(x_test.shape[0], num_rows, num_columns, num_channels)\n\nnum_labels = yy.shape[1]\nfilter_size = 2\n\n\n# Construct model \nmodel = Sequential()\n\nmodel.add(Dense(256, input_shape=(40,)))\nmodel.add(Activation('relu'))\nmodel.add(Dropout(0.5))\n\nmodel.add(Dense(256))\nmodel.add(Activation('relu'))\nmodel.add(Dropout(0.5))\n\nmodel.add(Dense(num_labels))\nmodel.add(Activation('softmax'))","7a8afa28":"# Compile the model\nmodel.compile(loss='categorical_crossentropy', metrics=['accuracy'], optimizer='adam')\n\n# Display model architecture summary \nmodel.summary()\n\n","538af8d9":"from keras.callbacks import ModelCheckpoint \nfrom datetime import datetime \n\nnum_epochs = 145\nnum_batch_size = 32\n\ncheckpointer = ModelCheckpoint(filepath='models\/weights.best.basic_cnn.hdf5', \n                               verbose=1, save_best_only=True)\nstart = datetime.now()\n\nhistory =  model.fit(x_train, y_train, batch_size=num_batch_size,epochs=145, validation_data=(x_test, y_test), callbacks=[checkpointer], verbose=1)\n\n\nduration = datetime.now() - start\nprint(\"Training completed in time: \", duration)","29a2f335":"# Evaluating the model on the training and testing set\nscore = model.evaluate(x_train, y_train, verbose=0)\nprint(\"Training Accuracy: \", score[1])\n\nscore = model.evaluate(x_test, y_test, verbose=0)\nprint(\"Testing Accuracy: \", score[1])","6c7a3e71":"import librosa \nimport numpy as np \n\ndef extract_feature(file_name):\n   \n    try:\n        audio_data, sample_rate = librosa.load(file_name, res_type='kaiser_fast') \n        mfccs = librosa.feature.mfcc(y=audio_data, sr=sample_rate, n_mfcc=40)\n        mfccsscaled = np.mean(mfccs.T,axis=0)\n        \n    except Exception as e:\n        print(\"Error encountered while parsing file: \", file)\n        return None, None\n\n    return np.array([mfccsscaled])","a85653ab":"def print_prediction(file_name):\n    prediction_feature = extract_feature(file_name) \n\n    predicted_vector = model.predict_classes(prediction_feature)\n    predicted_class = le.inverse_transform(predicted_vector) \n    print(\"The predicted class is:\", predicted_class[0], '\\n') \n\n    predicted_proba_vector = model.predict_proba(prediction_feature) \n    predicted_proba = predicted_proba_vector[0]\n    for i in range(len(predicted_proba)): \n        category = le.inverse_transform(np.array([i]))\n        print(category[0], \"\\t\\t : \", format(predicted_proba[i], '.32f') )","612573ac":"# Class: Air Conditioner\n\nfilename = 'folder'+'\/'+os.path.join('fold'+str(street_music_file[1])+'\/'+str(street_music_file[0]))\n\nprint_prediction(filename)","c2cf2095":"plt.plot(history.history['acc'])\nplt.plot(history.history['val_acc'])\nplt.title('model accuracy')\nplt.ylabel('accuracy')\nplt.xlabel('epoch')\nplt.legend(['train', 'val'], loc='upper left')\nplt.show()\n","345f41e6":"plt.plot(history.history['loss'])\nplt.plot(history.history['val_loss'])\nplt.title('model loss')\nplt.ylabel('loss')\nplt.xlabel('epoch')\nplt.legend(['train', 'val'], loc='upper left')\nplt.show()","99255ff2":"from sklearn.metrics import confusion_matrix, plot_confusion_matrix, classification_report\nimport seaborn as sns\ny_pred = model.predict(x_test)\n\nmatrix = confusion_matrix(y_test.argmax(axis=1), y_pred.argmax(axis=1))","69731533":"plt.figure(figsize=(10,8))\nsns.heatmap(matrix, annot=True, cmap='Blues')","740f2848":"plt.figure(figsize=(10,8))\nsns.heatmap(matrix\/np.sum(matrix), annot=True, \n            fmt='.2%', cmap='Blues')","85a1f985":"print('Classification Report')\ntarget_names = list(le.classes_)\nprint(classification_report(y_test.argmax(axis=1), y_pred.argmax(axis=1), target_names=target_names))","78765b53":"# Performance","8409a9d5":"# validation"}}