{"cell_type":{"40e35bf8":"code","021d8f38":"code","07d24c62":"code","f728c222":"code","41e8ffda":"code","b137d816":"code","530b76d1":"code","f7e1afcb":"code","69d59ed5":"code","b197fa38":"code","de052a9f":"code","14571db7":"code","b0427227":"code","dabf9afd":"code","1c40e524":"code","81ae6425":"code","bf2890e8":"code","6d9f59c8":"code","9aac9f64":"code","37365a33":"code","21bcf372":"code","87edfa05":"code","35b5b7e8":"code","129e6c52":"code","b522217d":"code","c82d9512":"code","7bd01113":"code","295324dd":"code","c6bfb8e4":"code","219160e2":"code","30bdb65e":"code","4d02a746":"code","bc5c777a":"code","acdd109a":"code","ba346a8e":"code","075c6d85":"code","faa2798c":"code","1873824d":"code","5f3dd632":"code","9c2f0fe1":"code","62868825":"markdown","1fb51e65":"markdown","d688cf6d":"markdown","5a949ce0":"markdown","441afdce":"markdown","116a3dc9":"markdown","76aff7e8":"markdown","b259a623":"markdown","cb9543b2":"markdown","39fb37de":"markdown"},"source":{"40e35bf8":"!pip install pmdarima","021d8f38":"import numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom sklearn.preprocessing import MinMaxScaler\nfrom sklearn.neighbors import KNeighborsRegressor\nfrom sklearn.metrics.pairwise import euclidean_distances\nfrom sklearn.model_selection import TimeSeriesSplit\nfrom sklearn.decomposition import PCA\nfrom sklearn.linear_model import LinearRegression\nfrom fbprophet import Prophet\nimport pmdarima as pmd","07d24c62":"df = pd.read_csv('..\/input\/nifty50-stock-market-data\/SBIN.csv')\ndf","f728c222":"df.describe()","41e8ffda":"df.info()","b137d816":"df['Date'] = pd.to_datetime(df.Date,format='%Y-%m-%d')\ndf.set_index(\"Date\", drop=False, inplace=True)\ndf.drop([\"Series\",\"Symbol\",\"Trades\",\"Deliverable Volume\",\"%Deliverble\"], axis=1, inplace=True)\ndf","530b76d1":"100 * df.isnull().sum() \/ len(df)","f7e1afcb":"df.VWAP.plot(figsize=(25, 5))\nplt.show()","69d59ed5":"sns.kdeplot(df.VWAP, shade=True)\nplt.show()","b197fa38":"df[\"month\"] = df.Date.dt.month\ndf[\"week\"] = df.Date.dt.isocalendar().week\ndf[\"day\"] = df.Date.dt.isocalendar().day\ndf[\"day_of_week\"] = df.Date.dt.dayofweek\ndf.drop(['Date'], axis=1, inplace=True)\ndf","de052a9f":"y = df['Close']\ndf.drop(['VWAP', 'Close'], axis=1, inplace=True)\ndf","14571db7":"indx = df.index\ncols = df.columns\n(indx, cols)","b0427227":"scaler = MinMaxScaler(feature_range=(0, 1))\ndata = scaler.fit_transform(df)\nX = pd.DataFrame(data, index=indx, columns=cols)\nX","dabf9afd":"def get_rmse(y_test, y_pred): return np.sqrt(np.mean(np.power((np.array(y_test)-np.array(y_pred)),2)))","1c40e524":"def get_val(x_train, test_r, y_test, n_neighbors):\n    distances = []\n    for i in range(len(x_train)):\n        dist = euclidean_distances([test_r], [x_train[i]])[0][0]\n        distances.append((i, dist))\n    distances.sort(key=lambda tup: tup[1])\n    v = 0\n    for i in range(n_neighbors):\n        v += y_test[distances[i][0]]\n    return v\/n_neighbors","81ae6425":"cut = int(len(X)*0.8)\n\nX_train = X[:cut]\nX_test = X[cut:]\ny_train = y[:cut]\ny_test = y[cut:]","bf2890e8":"y_pred = []\nfor i in X_test.values:\n    y_pred.append(get_val(X_train.values, i, y_train, 2))\ny_pred","6d9f59c8":"plt.figure(figsize=(20, 5))\nplt.plot(y)\nplt.plot(y_test.index, y_pred)\nplt.show()\nrmse_knn_fl = np.sqrt(np.mean(np.power((np.array(y_test)-np.array(y_pred)),2)))\nprint(\"RMS value -\", rmse_knn_fl)","9aac9f64":"ts = TimeSeriesSplit(n_splits=10)","37365a33":"y_preds = []\nrmses = []\nfor train_index,test_index in ts.split(X):\n    X_train,X_test = X.values[train_index],X.values[test_index]\n    y_train,y_test = y.values[train_index],y.values[test_index]\n    y_pred = []\n    for row in X_test:\n        y_pred.append(get_val(X_train, row, y_train, 2))\n    plt.figure(figsize=(20, 5))\n    plt.plot(indx, y.values)\n    plt.plot(indx[test_index], y_pred)\n    plt.show()\n    rmse = np.sqrt(np.mean(np.power((np.array(y_test)-np.array(y_pred)),2)))\n    rmses.append(rmse)\n    print(\"RMSE value -\", rmse)","21bcf372":"plt.bar(range(10), rmses)\nplt.show()\nrmse_knn_avg = np.mean(rmses)\nprint(rmse_knn_avg)","87edfa05":"fn_ts = TimeSeriesSplit(n_splits=10)","35b5b7e8":"fn_y_preds = []\nfn_rmses = []\nknn = KNeighborsRegressor(n_neighbors=2)\nfor train_index,test_index in fn_ts.split(X):\n    X_train,X_test = X.values[train_index],X.values[test_index]\n    y_train,y_test = y.values[train_index],y.values[test_index]\n    knn.fit(X_train,y_train)\n    y_pred = knn.predict(X_test)\n    fn_y_preds.append(y_pred)\n    plt.figure(figsize=(20, 5))\n    plt.plot(indx, y.values)\n    plt.plot(indx[test_index], y_pred)\n    plt.show()\n    rmse = np.sqrt(np.mean(np.power((np.array(y_test)-np.array(y_pred)),2)))\n    fn_rmses.append(rmse)\n    print(\"RMSE - \", rmse)","129e6c52":"plt.bar(range(10), fn_rmses)\nplt.show()\nprint(np.mean(fn_rmses))","b522217d":"pca = PCA(n_components=2)\nX_p = pca.fit_transform(df)\nX_p","c82d9512":"X_p = MinMaxScaler(feature_range=(0, 1)).fit_transform(X_p)\nX_p","7bd01113":"model = LinearRegression()\nmodel.fit(X_train,y_train)\ny_pred_lr = model.predict(X_test)\ny_pred_lr","295324dd":"plt.figure(figsize=(20, 5))\nplt.plot(y)\nplt.plot(y_test.index, y_pred_lr)\nplt.show()\nrmse_lr_fl = np.sqrt(np.mean(np.power((np.array(y_test)-np.array(y_pred_lr)),2)))\nprint(\"RMSE value - \", rmse_lr_fl)","c6bfb8e4":"rmses_lr =[]\nfor train_index,test_index in ts.split(X):\n    X_train,X_test = X.values[train_index],X.values[test_index]\n    y_train,y_test = y.values[train_index],y.values[test_index]\n    model = LinearRegression()\n    model.fit(X_train, y_train)\n    y_pred = model.predict(X_test)\n    rmse = get_rmse(y_pred, y_test)\n    rmses_lr.append(rmse)\n    plt.figure(figsize=(20, 5))\n    plt.plot(y)\n    plt.plot(indx[test_index], y_pred)\n    plt.show()\n    print(\"RMSE value -\", rmse)","219160e2":"rmse_lr_avg = np.mean(rmses_lr)\nplt.bar(range(10), rmses_lr)\nplt.show()\nprint(\"RMSE value - \", rmse_lr_avg)","30bdb65e":"X_pr = pd.DataFrame(y.values, columns=['Close'])\nX_pr['Date'] = y.index\nX_train = X_pr[:cut]\nX_test = X_pr[cut:]","4d02a746":"model = Prophet()\nmodel.fit(X_train[[\"Date\", \"Close\"]].rename(columns={\"Date\": \"ds\", \"Close\": \"y\"}))","bc5c777a":"forecast = model.predict(X_test[[\"Date\", \"Close\"]].rename(columns={\"Date\": \"ds\"}))\nforecast","acdd109a":"forecast.yhat","ba346a8e":"plt.figure(figsize=(20, 5))\nplt.plot(X_pr['Close'])\nplt.plot(X_test.index, forecast.yhat)\nplt.show()\nrmse_pr_fl = get_rmse(X_test[\"Close\"], forecast.yhat)\nprint(\"RMSE value - \", rmse_pr_fl)","075c6d85":"X_train_ar = y[:cut]\nX_test_ar = y[cut:]","faa2798c":"arima_model = pmd.auto_arima(X_train_ar)\narima_model.summary()","1873824d":"y_pred_ar = arima_model.predict(X_test_ar.shape[0])\ny_pred_ar","5f3dd632":"plt.figure(figsize=(20, 5))\nplt.plot(y)\nplt.plot(X_test_ar.index, y_pred_ar)\nplt.show()\nrmse_arima_fl = get_rmse(X_test_ar, y_pred_ar)\nprint(\"RMSE value - \", rmse_arima_fl)","9c2f0fe1":"plt.figure(figsize=(15, 10))\nplt.bar([\"kNN\", \"Linear Regression\", \"Prophet\", \"ARIMA\"], [rmse_knn_fl, rmse_lr_fl, rmse_pr_fl, rmse_arima_fl])\nplt.title(\"RMSE comparison among different algorithms\")\nplt.show()","62868825":"# Stock Prediction using Machine Learning techniques\n## Dataset - Nifty50 SBIN","1fb51e65":"A kernel density estimate plot is a method for visualizing the distribution of observations in a dataset, analagous to a histogram. Represents the data using a continuous probability density curve in one or more dimensions.","d688cf6d":"# k-Nearest Neighbours algorithm","5a949ce0":"# FbProphet for timeseries prediction","441afdce":"Date is used as the index for the dataframe. As part of cleaning, incomplete and unnecessary columns - series, symbol, trades, deliverable volume and deliverable - are dropped. ","116a3dc9":"# Linear Regression with Principal Component Analysis","76aff7e8":"RMSE is considered as the evaluation metric","b259a623":"### Train and test with 10 folds (Folds created using TimeSeriesSplit)","cb9543b2":"### Train and test without k-Fold","39fb37de":"# ARIMA"}}