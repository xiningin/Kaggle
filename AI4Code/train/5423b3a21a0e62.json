{"cell_type":{"045a423f":"code","302abda8":"code","29dbdbd2":"code","b11b899b":"code","cf7d0368":"code","a1d32000":"code","5015bd02":"code","01aaad32":"code","65c725eb":"code","9aa5d90a":"code","1c001675":"code","d9a15b21":"code","b12c554b":"code","ba03ccad":"code","4238cf69":"code","24ff84a5":"code","b5ed12e0":"code","c2aaed9e":"code","9a1908d7":"code","d0230699":"markdown","b09fbb44":"markdown","f634c2f9":"markdown","4a84dfc6":"markdown","5e302f62":"markdown","9275869f":"markdown"},"source":{"045a423f":"%reload_ext autoreload\n%autoreload 2\n%matplotlib inline","302abda8":"from fastai import *\nfrom fastai.vision import *","29dbdbd2":"print(torch.cuda.is_available(), torch.backends.cudnn.enabled)","b11b899b":"path_model='\/kaggle\/working\/'\npath_input=\"\/kaggle\/input\/\"\nlabel_df = pd.read_csv(f\"{path_input}labels.csv\")\nlabel_df.head()","cf7d0368":"label_df.shape","a1d32000":"label_df.pivot_table(index='breed',aggfunc=len).sort_values('id',ascending=False)","5015bd02":"data = ImageDataBunch.from_csv(\n                      path_input,\n                      folder='train',\n                      valid_pct=0.2,\n                      ds_tfms=get_transforms(flip_vert=True,max_rotate=20., max_zoom=1.1),\n                      size=224,\n                      test='\/kaggle\/input\/test\/test',\n                      suffix='.jpg',\n                      bs=64,\n                      num_workers=0).normalize(imagenet_stats)","01aaad32":"data.show_batch(rows=3, figsize=(8,8))","65c725eb":"[print(len(e)) for e in [data.train_ds, data.valid_ds, data.test_ds]]","9aa5d90a":"files = os.listdir(f'{path_input}train\/')[:5]\nimg = plt.imread(f'{path_input}train\/{files[0]}')\nplt.imshow(img)","1c001675":"#learner = Learner(data, models.resnet50, metrics=[accuracy], )\nlearner = create_cnn(data,models.resnet50,metrics=[accuracy],model_dir=f'{path_model}')","d9a15b21":"learner.fit_one_cycle(3)","b12c554b":"np.set_printoptions(precision=6, suppress=True)\ntest_result = learner.get_preds(ds_type=DatasetType.Test)","ba03ccad":"for i in range(0, 12):\n    print(np.array(test_result[0][1][i*10:i*10+10]))","4238cf69":"pd.options.display.float_format = '{:.6f}'.format\ndf = pd.DataFrame(np.array(test_result[0]))\ndf.columns = data.classes\ndf.head()","24ff84a5":"df.shape","b5ed12e0":"# insert clean ids - without folder prefix and .jpg suffix - of images as first column\ndf.insert(0, \"id\", [e.name[:-4] for e in data.test_ds.x.items])","c2aaed9e":"df.head()","9a1908d7":"df.to_csv(f\"dog-breed-identification-submission.csv\", index=False)","d0230699":"# **3.Create & Train Network**","b09fbb44":"---","f634c2f9":"# **5.Submission**\nfollowing the [format of result](https:\/\/www.kaggle.com\/c\/dog-breed-identification#evaluation):\n\n> &nbsp;&nbsp;id,affenpinscher,afghan_hound,..,yorkshire_terrier<br\/>\n&nbsp;&nbsp;000621fb3cbb32d8935728e48679680e,0.0083,0.0,...,0.0083<br\/>\n&nbsp;&nbsp;etc.\n","4a84dfc6":"# **1.Peapare Enviroment**","5e302f62":"# **2.Peapare Data**","9275869f":"# **4.Predict**\n"}}