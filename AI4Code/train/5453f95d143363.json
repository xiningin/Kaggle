{"cell_type":{"2af02b8f":"code","ce30f95f":"code","98f41659":"code","629a273e":"code","6322bf34":"markdown"},"source":{"2af02b8f":"from mpl_toolkits.basemap import Basemap\nimport folium\nimport numpy as np\nimport pandas as pd\nimport os\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly.plotly as py\nimport plotly.graph_objs as go\nfrom plotly import tools\nfrom plotly.offline import init_notebook_mode, iplot\ninit_notebook_mode(connected=True)\nimport pycountry\nimport datetime\nimport warnings\nwarnings.filterwarnings('ignore')\nfrom pylab import rcParams\nrcParams['figure.figsize'] = 10, 10\nimport bq_helper\nfrom bq_helper import BigQueryHelper\nnoaa_gsod = BigQueryHelper('bigquery-public-data', 'noaa_gsod')","ce30f95f":"## look for stations present in the whole range of dates\nstations = '''\nSELECT stn, name\n    FROM `bigquery-public-data.noaa_gsod.gsod2019` a\n    INNER JOIN `bigquery-public-data.noaa_gsod.stations` b ON a.stn = b.usaf\n    WHERE stn in (SELECT stn FROM `bigquery-public-data.noaa_gsod.gsod1980` GROUP BY stn HAVING AVG(temp) > -20)\n      AND stn in (SELECT stn FROM `bigquery-public-data.noaa_gsod.gsod1995` GROUP BY stn HAVING AVG(temp) > -20)\n      AND stn in (SELECT stn FROM `bigquery-public-data.noaa_gsod.gsod2009` GROUP BY stn HAVING AVG(temp) > -20)\n'''\n\nstations = noaa_gsod.query_to_pandas(stations)\nunique_stations = stations.stn.unique().tolist()\n\nprint(f'Found {len(unique_stations)} stations across the globe:')\nstations.name.unique().tolist()","98f41659":"avgTemps = '''\nSELECT {} AS Year, (AVG(temp)-32)*5\/9 AS Celsius\n    FROM `bigquery-public-data.noaa_gsod.gsod{}`\n    WHERE stn in ('{}')\n'''\n\nyears = range(1980, 2020)\navgTemps = [noaa_gsod.query_to_pandas(avgTemps.format(i,i, \"', '\".join(unique_stations))) for i in years]\navgTemps = pd.concat(avgTemps)","629a273e":"ax = sns.regplot(x='Year', y='Celsius', data=avgTemps)\n_  = ax.set_ylabel('Average Annual Temperature (\u00b0C)')","6322bf34":"# Average Daily Temperatures Worldwide (1980-2019)\n**[NOAA](https:\/\/data.noaa.gov\/dataset\/dataset\/global-surface-summary-of-the-day-gsod) Global Surface Summary of the Day**"}}