{"cell_type":{"b920bafa":"code","c3e7134f":"code","e624bd0c":"code","a00b8170":"code","ee143298":"code","f2136854":"code","ec92b97d":"code","189e150b":"code","01b887af":"code","d479f5a1":"code","2ba1a9c2":"code","ff523bd7":"code","12c9bf42":"code","07266d97":"code","bf23a53a":"code","19aeffd4":"code","24ea4f4f":"code","6fde8f92":"code","67765e8c":"code","c361feaf":"code","88f7e1a5":"code","bdb12cc1":"code","4adccf8a":"code","5e367dfa":"code","293c0dff":"code","96925ed8":"code","697bc7f2":"code","1556cf03":"code","2c0743ee":"code","414d0b62":"code","a9d2577d":"code","e4816acb":"markdown"},"source":{"b920bafa":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","c3e7134f":"!unzip -q ..\/input\/dogs-vs-cats\/test1.zip\n!unzip -q ..\/input\/dogs-vs-cats\/train.zip","e624bd0c":"!mkdir Train\n!mkdir Validation\n!mkdir Train\/cat\n!mkdir Train\/dog\n!mkdir Validation\/cat\n!mkdir Validation\/dog","a00b8170":"import numpy as np\nimport tensorflow\nimport tensorflow.keras\nfrom tensorflow.keras.models import Model, Sequential\nfrom tensorflow.keras.layers import Input, Dense, Dropout, GlobalMaxPooling2D\nfrom tensorflow.keras.preprocessing.image import ImageDataGenerator\nfrom tensorflow.keras.applications.vgg16 import VGG16, preprocess_input\nfrom tqdm import tqdm\nimport os\nimport cv2\nimport shutil\nfrom random import shuffle\nimport matplotlib.pyplot as plt\n# from google.colab.patches import cv2_imshow\n%matplotlib inline","ee143298":"files = os.listdir('train')\nshuffle(files)","f2136854":"os.path.isdir('train\/')","ec92b97d":"# cv2.imshow(cv2.imread('train\/' + files[4]))","189e150b":"base_path = 'train'\ndest_path1 = 'Train'\ndest_path2 = 'Validation'","01b887af":"cat_split = int(len(files) * 0.1)\ndog_split = int(len(files) * 0.1)\ncat_counter = 0\ndog_counter = 0\n\nfor i in tqdm(range(len(files))):\n    img = files[i]\n    pet = img.split('.')[0]\n    \n    if pet == 'dog':\n        if dog_counter < dog_split:\n            shutil.copyfile(\n                os.path.join(base_path, img),\n                os.path.join(dest_path2, pet, img))\n            dog_counter += 1\n        else:\n            shutil.copyfile(\n                os.path.join(base_path, img),\n                os.path.join(dest_path1, pet, img))\n    \n    elif pet == 'cat':\n        if cat_counter < cat_split:\n            shutil.copyfile(\n                os.path.join(base_path, img),\n                os.path.join(dest_path2, pet, img))\n            cat_counter += 1\n        else:\n            shutil.copyfile(\n                os.path.join(base_path, img),\n                os.path.join(dest_path1, pet, img))","d479f5a1":"datagen = ImageDataGenerator(rescale=1.\/255 ,preprocessing_function=preprocess_input)\n\ntrain_datagen = datagen.flow_from_directory('Train',\n                                            batch_size=32,\n                                            shuffle=True,\n                                            target_size=(224, 224),\n                                            class_mode='binary')\n\nval_datagen = datagen.flow_from_directory('Validation',\n                                            batch_size=32,\n                                            shuffle=True,\n                                            target_size=(224, 224),\n                                            class_mode='binary')","2ba1a9c2":"print(int(20000 \/ 32) * 32)\nprint(int(5000 \/ 32) * 32)","ff523bd7":"data, label = next(train_datagen)\ni = 0\nplt.imshow(data[i])\nprint(label[i])","12c9bf42":"model = VGG16(weights='imagenet', include_top=False)\n\ninp = Input(shape=(224, 224, 3), batch_size=32)\n\nx = model(inp)\nx = GlobalMaxPooling2D()(x)\n\nmodel_feature_extractor = Model(inputs=[inp], outputs=[x])","07266d97":"X_train = np.zeros((20000, 512), dtype=np.float32)\ny_train = np.zeros((20000))\n\nX_val = np.zeros((4992, 512), dtype=np.float32)\ny_val = np.zeros((4992))","bf23a53a":"for i in tqdm(range(0, 20000, 32)):\n    batch = train_datagen.next()\n    X_train[i:i + 32] = model_feature_extractor.predict(batch[0])\n    y_train[i:i + 32] = batch[1]\n\nfor i in tqdm(range(0, 4992, 32)):\n    batch = val_datagen.next()\n    X_val[i:i + 32] = model_feature_extractor.predict(batch[0])\n    y_val[i:i + 32] = batch[1]","19aeffd4":"print(X_train.shape, y_train.shape)\nprint(X_val.shape, y_val.shape)","24ea4f4f":"def plot_history(history):\n    fig, axs = plt.subplots(2)\n    # Plot both Loss & Accuracy in Subplot\n  # creat accuracy plot\n    axs[0].plot(history.history['acc'], label='train accuracy')\n    axs[0].plot(history.history['val_acc'], label='test accuracy')\n    axs[0].set_ylabel('Accuracy')\n    axs[0].legend(loc='best')\n    axs[0].set_title('Accuracy eval')\n\n  # creat loss plot\n    axs[1].plot(history.history['loss'], label='train loss')\n    axs[1].plot(history.history['val_loss'], label='test loss')\n    axs[1].set_ylabel('Loss')\n    axs[1].set_xlabel('Epoch')\n    axs[1].legend(loc='best')\n    axs[1].set_title('Loss eval')\n\n    plt.show()","6fde8f92":"import tensorflow as tf\nfrom tensorflow.keras.regularizers import l2\nfrom tensorflow.keras.optimizers import Adam\nimport datetime","67765e8c":"clf_model =  Sequential()\n\nclf_model.add(Dense(128, activation='relu', input_dim=512,\n                    kernel_regularizer=l2(0.001)))\nclf_model.add(Dropout(0.3))\n\n# clf_model.add(Dense(64, activation='relu', kernel_regularizer=l2(0.001)))\n# clf_model.add(Dropout(0.3))\n\nclf_model.add(Dense(1, activation='sigmoid'))\n\nclf_model.summary()\n\nclf_model.compile(optimizer=Adam(learning_rate=0.0001), \n                  loss='binary_crossentropy', metrics=['acc'])","c361feaf":"res = clf_model.fit(X_train, y_train.reshape(-1, 1), epochs=50, batch_size=32,\n              validation_data=(X_val, y_val.reshape(-1, 1)), verbose=2)\n\nplot_history(res)","88f7e1a5":"test_filenames = os.listdir(\"\/kaggle\/working\/test1\")\ntest_df = pd.DataFrame({\n    'filename': test_filenames\n})\nnb_samples = test_df.shape[0]","bdb12cc1":"test_df.head()","4adccf8a":"test_datagen = datagen.flow_from_dataframe(\n    test_df, \n    \"\/kaggle\/working\/test1\/\",\n    x_col='filename',\n    y_col=None,\n    class_mode=None,\n    target_size=(224, 224),\n    batch_size=32,\n    shuffle=False\n)","5e367dfa":"print(int(12500 \/ 32) * 32)","293c0dff":"X_test = np.zeros((12480, 512), dtype=np.float32)","96925ed8":"for i in tqdm(range(0, 12480, 32)):\n    batch = test_datagen.next()\n    X_test[i:i + 32] = model_feature_extractor.predict(batch)\n#     y_train[i:i + 32] = batch[1]","697bc7f2":"X_test.shape","1556cf03":"preds = clf_model.predict(X_test)","2c0743ee":"for i in range(len(preds)):\n    if preds[i] >= 0.5:\n        preds[i] = 1\n    else:\n        preds[i] = 0","414d0b62":"predictions = pd.DataFrame()\npredictions[\"id\"] = np.arange(1, 12481)\npredictions[\"target\"] = preds\n\npredictions.to_csv('Pejman_submission.csv', index=False, header=predictions.columns)\npredictions.head(10)","a9d2577d":"predictions['target'].value_counts()","e4816acb":"Cat label = 0.0\n\nDog label = 1.0"}}