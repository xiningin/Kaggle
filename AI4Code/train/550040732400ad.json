{"cell_type":{"90dee837":"code","5cd6ecca":"code","b702f3e4":"code","c896af1c":"code","12dd3ce7":"code","b7c280ba":"code","d3051114":"code","112c8008":"code","f7c0cfbc":"code","77eb2475":"code","dfbd3081":"markdown","a265f670":"markdown","cfdeed7e":"markdown","2535d0b2":"markdown","76935e16":"markdown","723c8687":"markdown","3898bdc8":"markdown","cbfd92e3":"markdown","328c3d9e":"markdown","5edb2a71":"markdown","322c5e04":"markdown","e52451a9":"markdown","880aefff":"markdown"},"source":{"90dee837":"import pandas as pd\nimport matplotlib.pyplot as plt","5cd6ecca":"df = pd.read_csv( '..\/input\/cpu-power-consumption-data\/cpu_data.dat' )\ndf.info()\ndf.head()","b702f3e4":"all_cpus = df['CPUTYPE'].unique()\nall_cpus","c896af1c":"x5355 = df[ df['CPUTYPE']=='intel-xeon-x5355' ]\nx5355.head()","12dd3ce7":"plt.figure()\nx5355.plot( x='CPUPCT', y='AVGPOWER', label='x5355' )\nplt.xlabel( 'CPU-Usage (%)' )\nplt.ylabel( 'Power Consumption (W)' )\nplt.legend( loc='best' )\nplt.grid( True )\nplt.show()","b7c280ba":"plt.figure( figsize=(10,5) )\nfor cpu in ['intel-xeon-e5420','intel-xeon-e5520']:\n    cdata = df[ df['CPUTYPE']==cpu ]\n    plt.plot( cdata['CPUPCT'], cdata['AVGPOWER'], label=cpu )\nplt.xlabel( 'CPU-Usage (%)' )\nplt.ylabel( 'Power Consumption (W)' )\nplt.legend( loc='best' )\nplt.grid( True )\nplt.show()","d3051114":"plt.figure( figsize=(10,5) )\nfor cpu in ['intel-xeon-x5550','intel-xeon-x5650']:\n    cdata = df[ df['CPUTYPE']==cpu ]\n    plt.plot( cdata['CPUPCT'], cdata['AVGPOWER'], label=cpu )\nplt.xlabel( 'CPU-Usage (%)' )\nplt.ylabel( 'Power Consumption (W)' )\nplt.legend( loc='best' )\nplt.grid( True )\nplt.show()","112c8008":"plt.figure( figsize=(10,5) )\nfor cpu in ['intel-xeon-e5420','intel-xeon-e5420-disk-raid0','intel-xeon-e5420-ssd-raid0','intel-xeon-e5420-ssd-noraid']:\n    cdata = df[ df['CPUTYPE']==cpu ]\n    plt.plot( cdata['CPUPCT'], cdata['AVGPOWER'], label=cpu )\nplt.xlabel( 'CPU-Usage (%)' )\nplt.ylabel( 'Power Consumption (W)' )\nplt.legend( loc='best' )\nplt.grid( True )\nplt.show()","f7c0cfbc":"plt.figure( figsize=(10,5) )\nfor cpu in ['intel-xeon-e5420-disk-raid0','intel-xeon-e5420-ssd-raid0']:\n    cdata = df[ df['CPUTYPE']==cpu ]\n    plt.plot( cdata['CPUPCT'], cdata['AVGPOWER'], label=cpu )\nplt.xlabel( 'CPU-Usage (%)' )\nplt.ylabel( 'Power Consumption (W)' )\nplt.legend( loc='best' )\nplt.grid( True )\nplt.show()","77eb2475":"plt.figure( figsize=(10,5) )\nfor cpu in ['intel-xeon-e5420','intel-xeon-e5420-ssd-noraid']:\n    cdata = df[ df['CPUTYPE']==cpu ]\n    plt.plot( cdata['CPUPCT'], cdata['AVGPOWER'], label=cpu )\nplt.xlabel( 'CPU-Usage (%)' )\nplt.ylabel( 'Power Consumption (W)' )\nplt.legend( loc='best' )\nplt.grid( True )\nplt.show()","dfbd3081":"### Look at the e-Series CPU-Types\n\nRepeat the above, but for the the 2 different e-Series CPU-Types in the dataset ... e5420, e5520.\n\nFrom Intel ARK, the e5420 launched in Q4 2007; the e5520 launched in Q1 2009.  With 2 years improvement in technology, we expected to see reduced power consumption from the e5520.","a265f670":"### Focusing in on one CPU-Type\n\nWe'll start by looking at one specific CPU-type.  Any of them will work, but we'll use one of the older ones, the 'intel-x5355' ...","cfdeed7e":"## The data\n\nThe raw data was parsed into \"bins\" of 1 CPU-percentage-point and the recorded power-usage values were averaged for each bin.  So each line of data has:\n* CPU-type - string\n* CPU-Percent bin - integer, 0 to 100\n* number of points that were seen in that bin\n* the sum of the power measurements for that bin\n* the sum-squared of the power measurements for that bin\n* the average power for that bin  (sum divided by num-points)","2535d0b2":"#### The usual ... we'll use Pandas and Matplotlib for this overview analysis","76935e16":"### How many CPU-Types are there?\n\nThe cluster \"evolved\" over several years with multiple purchases of whatever server\/CPU made sense at the time of purchase.  So it includes a number of different CPU types -- mostly Intel, but some AMD.  \n\nThe \"intel-xeon' and 'unknown' categories _appear to be_ in the same vintage (2005-2010) but the specifics are lost at this point.\n\nThe 'ssd'\/'disk' and 'raid0'\/'noraid' were part of another study looking to see if we can detect the lower power consumption of an SSD (compared to a standard hard disk).","723c8687":"Hmmm ... not too much we can decipher from this.  The 'ssd-noraid' line seems to have the lowest power-draw for most of the bins, but there is obviously something else going on ... most notably, we haven't factored in the amount of _usage_ that the HDD or SSD might be getting (IO operations per second, etc.).  \n\nOne more thing we can check is to focus-in on just the 2-disk servers -- disk-raid0 and ssd-raid0 -- to see if the extra power-draw from the 2nd disk is causing some of that noise ...","3898bdc8":"That certainly looks better!","cbfd92e3":"In this case, it does look like the SSD-line is below the HDD-line \"most\" of the time.\n\nRepeating that with just the single-disk systems -- e5420 and e5420-ssd-noraid ...","328c3d9e":"## Power- and CPU-Usage Comparison\n\nThis is a repeat of an older analysis where we looked at the power consumption of different CPU types (different generations of CPUs) compared to how heavily loaded the system was (CPU-percentage). \n\nThis comes from instrumentation on a real cluster computer with 600-800 servers:  every server was polled for data every 10 minutes.  Data was collected for several months on the cluster, with no interruption to the normal operation of the cluster (no synthetic data or \"test runs\" were used).  CPU readings are from the Linux \/proc file system; power readings are from IPMI.\n\nNote that these are now much older CPUs -- 2005-ish to 2010-ish -- Intel's ARK system is your friend! It can give all sorts of info on each CPU type -- launch\/retirement dates, thermal design power, etc.\n* https:\/\/ark.intel.com\/content\/www\/us\/en\/ark.html","5edb2a71":"And we do see reduced power consumption.  The newer e5520 CPU cuts power by over 20 W at idle, and still saves ~10W at full-load.\n\n### x-Series CPUs\n\nWe can do the same for the two x-Series CPUs -- x5550 and x5650 -- but since the x-Series is intended to be higher power-consumption and the e-Series is intended to be more general purpose, there's no real sense comparing them (we expect the x5550 to be higher power than the e5520).","322c5e04":"Plot the power-consumption versus the CPU-load (percentage) ... \n\nWe should see that increasing CPU-load leads to increased power-draw for the server.","e52451a9":"In this case, we don't see much difference except maybe at higher CPU-load.  In this case the newer (Q1 2010) x5650 CPU seems to draw _more power_ than the older (Q1 2009) x5550.  Given that these were supposed to be the \"high-performance\" version of the Xeon, it's not too surprising that we don't see any power reduction.","880aefff":"### SSD vs. HDD Power Consumption\n\nWe did a follow-on study looking to see if we can detect any power reduction due to the use of SSDs.  Theoretically, SSDs should draw 5-10W less power than a traditional hard drive, but it wasn't clear we could see that through the \"noise\" in our instrumentation.  To help cut through that noise, we installed 2 HDDs or 2 SSDs in some of the systems (doubling the power difference we hoped to see).\n\nThe relevant \"CPU-Types\":\n* intel-xeon-e5420 -- this is the standard server with one tradition hard drive\n* intel-xeon-e5420-disk-raid0 -- the same server but with 2 HDDs in a RAID-0 configuration\n* intel-xeon-e5420-ssd-raid0 -- the same server but with 2 SSDs in a RAID-0 configuration\n* intel-xeon-e5420-ssd-noraid -- the same server but with 1 SSD"}}