{"cell_type":{"4ec0daa4":"code","ca39455a":"code","baeae883":"code","b58af26c":"code","7865bdda":"code","ed5f43db":"code","bd409bc7":"code","65529e83":"code","0871eb38":"code","9a04113f":"code","eaba7e8b":"code","4c46cb8a":"code","53c63c44":"code","48c9066b":"code","7b6fd06c":"code","f8f0dd4d":"code","55665817":"code","0f54df25":"code","ff53ebff":"code","a8152bee":"code","8ec25498":"code","ecdd15b0":"code","8cc861fe":"code","46dec6fc":"code","66f040eb":"code","33569e7b":"code","c90c6e1d":"code","1ef2f14a":"code","1f1f5e70":"code","66c9ccac":"code","5281eae1":"code","93c69c6a":"code","0b833663":"code","150106eb":"code","c6a25739":"code","9fc0f399":"code","fd0bdc80":"code","e3d0e2da":"code","6ae7aa6e":"code","e930d084":"code","69e496e2":"code","b3ef6400":"code","4afe1e26":"code","1666e5b3":"code","d66c4b20":"code","ac1efb09":"code","e46103ca":"code","b060f9e4":"markdown","a9e8876b":"markdown","e58a01d5":"markdown","a87454ad":"markdown","622f44b2":"markdown","56d362c4":"markdown","d2873559":"markdown","64c53ff7":"markdown","c2a0c66a":"markdown","27b83f28":"markdown","5234be0f":"markdown","c99f7489":"markdown","9e83709a":"markdown","8d539fd9":"markdown","739eeef5":"markdown","b3be836a":"markdown","798e61e1":"markdown","82362cd7":"markdown","c771bf3e":"markdown","52a40576":"markdown","8dc9fd6e":"markdown","384ce14a":"markdown","25986105":"markdown","75feb0f7":"markdown","62a0328d":"markdown","683dfe66":"markdown","6dc4fe9c":"markdown","ef6e5a6f":"markdown","feb2d892":"markdown","01fb8b30":"markdown","182d0b42":"markdown","d8f7d209":"markdown","b26edc9f":"markdown","46648ae8":"markdown","cdb26eb9":"markdown","664aeafb":"markdown","0cbee268":"markdown","7f2b20b4":"markdown","0bad62a6":"markdown","12f8da7f":"markdown","762d4db8":"markdown","5611ec8e":"markdown","6226339c":"markdown","a51b3d3c":"markdown","0ad29aa9":"markdown","67b738c7":"markdown","4f184240":"markdown","ce225d70":"markdown","a0faa2c1":"markdown","f812dae1":"markdown","5eddf4a7":"markdown","6de8418f":"markdown","449c2a5a":"markdown","466c00b3":"markdown","7852ded0":"markdown"},"source":{"4ec0daa4":"#importing the required libraries\nimport pandas as pd\nimport numpy as np\n\n#viz Libraries\nimport matplotlib.pyplot as plt\n\nplt.style.use('ggplot')\nimport seaborn as sns\n\n#warnings\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n\n#datetime\nimport datetime as dt\n\n#StandardSccaler\nfrom sklearn.preprocessing import StandardScaler\n\n#KMeans\nfrom sklearn.cluster import KMeans\n\n#file directoryy\nimport os","ca39455a":"\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n","baeae883":"#reading the data\ndf = pd.read_csv('..\/input\/sample-sales-data\/sales_data_sample.csv', encoding = 'unicode_escape')","b58af26c":"df.shape #Dimensions of the data","7865bdda":"df.head() #Glimpse of the data","ed5f43db":"#Removing the variables which dont add significant value fot the analysis.\nto_drop = ['PHONE','ADDRESSLINE1','ADDRESSLINE2','STATE','POSTALCODE']\ndf = df.drop(to_drop, axis=1)","bd409bc7":"df.isnull().sum()","65529e83":"df.dtypes","0871eb38":"df['ORDERDATE'] = pd.to_datetime(df['ORDERDATE'])","9a04113f":"quant_vars = ['QUANTITYORDERED','PRICEEACH','SALES','MSRP']\ndf[quant_vars].describe()","eaba7e8b":"plt.figure(figsize=(9,6))\nsns.distplot(df['QUANTITYORDERED'])\nplt.title('Order Quantity Distribution')\nplt.xlabel('Quantity Ordered')\nplt.ylabel('Frequency')\nplt.show()","4c46cb8a":"plt.figure(figsize=(9,6))\nsns.distplot(df['PRICEEACH'])\nplt.title('Price Distribution')\nplt.xlabel('Price Ordered')\nplt.ylabel('Frequency')\nplt.show()","53c63c44":"plt.figure(figsize=(9,6))\nsns.distplot(df['SALES'])\nplt.title('Sales Distribution')\nplt.xlabel('Sales')\nplt.ylabel('Frequency')\nplt.show()","48c9066b":"df['STATUS'].value_counts(normalize = True)","7b6fd06c":"df.groupby(['YEAR_ID'])['MONTH_ID'].nunique()","f8f0dd4d":"plt.figure(figsize=(9,6))\ndf['DEALSIZE'].value_counts(normalize = True).plot(kind = 'bar')\nplt.title('DealSize distribution')\nplt.xlabel('Deal Size')\nplt.ylabel('% Proportion')\nplt.show()","55665817":"#Annual Revenue\nplt.figure(figsize=(9,6))\ndf.groupby(['YEAR_ID'])['SALES'].sum().plot()\nplt.xlabel('Year')\nplt.ylabel('Revenue')\nplt.title('Annual Revenue')\nplt.xticks(np.arange(2003,2006,1))\nplt.show()","0f54df25":"#Monthly Revenue\nplt.figure(figsize=(9,6))\n\nmonthly_revenue = df.groupby(['YEAR_ID','MONTH_ID'])['SALES'].sum().reset_index()\nmonthly_revenue\nsns.lineplot(x=\"MONTH_ID\", y=\"SALES\",hue=\"YEAR_ID\", data=monthly_revenue)\nplt.xlabel('Month')\nplt.ylabel('Sales')\nplt.title('Monthly Revenue')\nplt.show()","ff53ebff":"monthly_revenue['MONTHLY GROWTH'] = monthly_revenue['SALES'].pct_change()","a8152bee":"monthly_revenue.head()","8ec25498":"#Monthly Sales Growth Rate\nplt.figure(figsize=(9,6))\nsns.lineplot(x=\"MONTH_ID\", y=\"MONTHLY GROWTH\",hue=\"YEAR_ID\", data=monthly_revenue)\nplt.xlabel('Month')\nplt.ylabel('Sales')\nplt.title('Monthly Sales Growth Rate')\nplt.show()","ecdd15b0":"plt.figure(figsize=(9,6))\ntop_cities = df.groupby(['COUNTRY'])['SALES'].sum().sort_values(ascending=False)\ntop_cities.plot(kind = 'bar')\nplt.title('Top 10 countries by Sales')\nplt.xlabel('Country')\nplt.ylabel('Total Sales')\nplt.show()","8cc861fe":"#plt.figure(figsize=(10,8))\ndf['YEAR_MONTH'] = df['YEAR_ID'].map(str)+df['MONTH_ID'].map(str).map(lambda x: x.rjust(2,'0'))\nmonthly_active = df.groupby(['YEAR_MONTH'])['CUSTOMERNAME'].nunique().reset_index()\nmonthly_active.plot(kind='bar',x='YEAR_MONTH',y='CUSTOMERNAME')\n#plt.figure(figsize=(10,8))\nplt.title('Monthly Active Customers')\nplt.xlabel('Month\/Year')\nplt.ylabel('Number of Unique Customers')\nplt.xticks(rotation=90)\n#plt.figure(figsize=(10,8))\nplt.show()","46dec6fc":"#Average Sales per Order\naverage_revenue = df.groupby(['YEAR_ID','MONTH_ID'])['SALES'].mean().reset_index()\nplt.figure(figsize=(10,6))\nsns.lineplot(x=\"MONTH_ID\", y=\"SALES\",hue=\"YEAR_ID\", data=average_revenue)\nplt.xlabel('Month')\nplt.ylabel('Average Sales')\nplt.title('Average Sales per Order')\nplt.show()","66f040eb":"#New Customers Growth Rate\ndf_first_purchase = df.groupby('CUSTOMERNAME').YEAR_MONTH.min().reset_index()\ndf_first_purchase.columns = ['CUSTOMERNAME','FirstPurchaseDate']\n\nplt.figure(figsize=(10,6))\ndf_first_purchase.groupby(['FirstPurchaseDate'])['CUSTOMERNAME'].nunique().pct_change().plot(kind='bar')\nplt.title('New Customers Growth Rate')\nplt.xlabel('YearMonth')\nplt.ylabel('Percentage Growth Rate')\nplt.show()","33569e7b":"df['ORDERDATE'] = [d.date() for d in df['ORDERDATE']]\ndf.head()","c90c6e1d":"# Calculate Recency, Frequency and Monetary value for each customer\nsnapshot_date = df['ORDERDATE'].max() + dt.timedelta(days=1) #latest date in the data set\ndf_RFM = df.groupby(['CUSTOMERNAME']).agg({\n    'ORDERDATE': lambda x: (snapshot_date - x.max()).days,\n    'ORDERNUMBER': 'count',\n    'SALES':'sum'})\n\n#Renaming the columns\ndf_RFM.rename(columns={'ORDERDATE': 'Recency',\n                   'ORDERNUMBER': 'Frequency',\n                   'SALES': 'MonetaryValue'}, inplace=True)\n","1ef2f14a":"df_RFM.head()","1f1f5e70":"#Dividing into segments\n\n# Create a spend quartile with 4 groups - a range between 1 and 5\nMonetaryValue_quartile = pd.qcut(df_RFM['MonetaryValue'], q=4, labels=range(1,5))\nRecency_quartile = pd.qcut(df_RFM['Recency'], q=4, labels=list(range(4, 0, -1)))\nFrequency_quartile = pd.qcut(df_RFM['Frequency'], q=4, labels=range(1,5))\n\n\n# Assign the quartile values to the Spend_Quartile column in data\ndf_RFM['R'] = Recency_quartile\ndf_RFM['F'] = Frequency_quartile\ndf_RFM['M'] = MonetaryValue_quartile\n\n#df_RFM[['MonetaryValue_Quartile','Recency_quartile','Frequency_quartile']] = [MonetaryValue_quartile,Recency_quartile,Frequency_quartile]\n\n# Print data with sorted Spend values\n#print(df_RFM.sort_values('MonetaryValue'))\n\ndf_RFM.head()","66c9ccac":"# Calculate RFM_Score\ndf_RFM['RFM_Score'] = df_RFM[['R','F','M']].sum(axis=1)\ndf_RFM.head()","5281eae1":"#Naming Levels\n# Define rfm_level function\ndef rfm_level(df):\n    if np.bool(df['RFM_Score'] >= 10):\n        return 'High Value Customer'\n    elif np.bool((df['RFM_Score'] < 10) & (df['RFM_Score'] >= 6)):\n        return 'Mid Value Customer'\n    else:\n        return 'Low Value Customer'\n\n# Create a new variable RFM_Level\ndf_RFM['RFM_Level'] = df_RFM.apply(rfm_level, axis=1)\n\n# Print the header with top 5 rows to the console\ndf_RFM.head()","93c69c6a":"plt.figure(figsize=(10,6))\ndf_RFM['RFM_Level'].value_counts(normalize = True).plot(kind='bar')\nplt.title('RFM_level Distribution')\nplt.xlabel('RFM_Level')\nplt.ylabel('% Proportion')\nplt.show()","0b833663":"#Analyzing customer segments\n# Calculate average values for each RFM_Level, and return a size of each segment \nrfm_level_agg = df_RFM.groupby(['RFM_Level']).agg({\n    'Recency': 'mean',\n    'Frequency': 'mean',\n    'MonetaryValue':['mean','count']}).round(1)\n\n# Print the aggregated dataset\nprint(rfm_level_agg)","150106eb":"data = df_RFM[['Recency','Frequency','MonetaryValue']]\ndata.head()","c6a25739":"plt.figure(figsize=(10,6))\n\nplt.subplot(1,3,1)\ndata['Recency'].plot(kind='hist')\nplt.title('Recency')\n\nplt.subplot(1,3,2)\ndata['Frequency'].plot(kind='hist')\nplt.title('Frequency')\n\nplt.subplot(1,3,3)\ndata['MonetaryValue'].plot(kind='hist')\nplt.xticks(rotation = 90)\nplt.title('MonetaryValue')\n\nplt.tight_layout()\nplt.show()","9fc0f399":"data_log = np.log(data)","fd0bdc80":"data_log.head()","e3d0e2da":"plt.figure(figsize=(10,6))\n\n#plt.subplot(1,3,1)\nsns.distplot(data_log['Recency'],label='Recency')\n\n#plt.subplot(1,3,1)\nsns.distplot(data_log['Frequency'],label='Frequency')\n\n#plt.subplot(1,3,1)\nsns.distplot(data_log['MonetaryValue'],label='MonetaryValue')\n\nplt.title('Distribution of Recency, Frequency and MonetaryValue after Log Transformation')\nplt.legend()\nplt.show()","6ae7aa6e":"# Initialize a scaler\nscaler = StandardScaler()\n\n# Fit the scaler\nscaler.fit(data_log)\n\n# Scale and center the data\ndata_normalized = scaler.transform(data_log)\n\n# Create a pandas DataFrame\ndata_normalized = pd.DataFrame(data_normalized, index=data_log.index, columns=data_log.columns)\n\n# Print summary statistics\ndata_normalized.describe().round(2)","e930d084":"# Fit KMeans and calculate SSE for each k\nsse={}\nfor k in range(1, 21):\n    kmeans = KMeans(n_clusters=k, random_state=1)\n    kmeans.fit(data_normalized)\n    sse[k] = kmeans.inertia_ \n\n    \nplt.figure(figsize=(10,6))\n# Add the plot title \"The Elbow Method\"\nplt.title('The Elbow Method')\n\n# Add X-axis label \"k\"\nplt.xlabel('k')\n\n# Add Y-axis label \"SSE\"\nplt.ylabel('SSE')\n\n# Plot SSE values for each key in the dictionary\nsns.pointplot(x=list(sse.keys()), y=list(sse.values()))\nplt.text(4.5,60,\"Largest Angle\",bbox=dict(facecolor='lightgreen', alpha=0.5))\nplt.show()","69e496e2":"# Initialize KMeans\nkmeans = KMeans(n_clusters=5, random_state=1) \n\n# Fit k-means clustering on the normalized data set\nkmeans.fit(data_normalized)\n\n# Extract cluster labels\ncluster_labels = kmeans.labels_\n\n# Assigning Cluster Labels to Raw Data\n# Create a DataFrame by adding a new cluster label column\ndata_rfm = data.assign(Cluster=cluster_labels)\ndata_rfm.head()","b3ef6400":"# Group the data by cluster\ngrouped = data_rfm.groupby(['Cluster'])\n\n# Calculate average RFM values and segment sizes per cluster value\ngrouped.agg({\n    'Recency': 'mean',\n    'Frequency': 'mean',\n    'MonetaryValue': ['mean', 'count']\n  }).round(1)\n","4afe1e26":"data_rfm_melt = pd.melt(data_rfm.reset_index(), id_vars=['CUSTOMERNAME', 'Cluster'],\n                        value_vars=['Recency', 'Frequency', 'MonetaryValue'], \n                        var_name='Metric', value_name='Value')\n\nplt.figure(figsize=(10,6))\n# Add the plot title\nplt.title('Snake plot of normalized variables')\n\n# Add the x axis label\nplt.xlabel('Metric')\n\n# Add the y axis label\nplt.ylabel('Value')\n\n# Plot a line for each value of the cluster variable\nsns.lineplot(data=data_rfm_melt, x='Metric', y='Value', hue='Cluster')\nplt.show()\n","1666e5b3":"# Calculate average RFM values for each cluster\ncluster_avg = data_rfm.groupby(['Cluster']).mean() \nprint(cluster_avg)","d66c4b20":"# Calculate average RFM values for the total customer population\npopulation_avg = data.mean()\nprint(population_avg)","ac1efb09":"# Calculate relative importance of cluster's attribute value compared to population\nrelative_imp = cluster_avg \/ population_avg - 1\n\n# Print relative importance score rounded to 2 decimals\nprint(relative_imp.round(2))","e46103ca":"#Plot Relative Importance\n\n# Initialize a plot with a figure size of 8 by 2 inches \nplt.figure(figsize=(8, 2))\n\n# Add the plot title\nplt.title('Relative importance of attributes')\n\n# Plot the heatmap\nsns.heatmap(data=relative_imp, annot=True, fmt='.2f', cmap='RdYlGn')\nplt.show()","b060f9e4":"# Data Preprocessing for KMeans\n\n**K Means Assumptions**\n\n* All variables have symmetrical (Normal) Distribution <br>\n* All Variables have same average value(approx)<br>\n* All Variables have same variance(approx)","a9e8876b":"# Exploring the variables","e58a01d5":"**Analyzing the STATUS variable**","a87454ad":"**What is in this Kernel?**\n\n* Cleaning\/Transforming the Data\n* Univariate Analysis\n* Analyzing the KPIs\n  1. Annual Revenue\n  2. Monthly Revenue\n  3. Monthly Revenue growth rate\n  4. Monthly Active Customers\n  5. Average Sales per Order\n  6. New Customers Growth Rate\n* Clustering with arbitrary number of clusters\n  1. Calculating Recency, Frequency and Monetary value for each customer\n  2. Calculating RFM Score\n  3. Dividing the customers into segments\n* KMeans Clustering\n  1. Data Preprocessing for KMeans\n      1. Removing the Skewness for achieving Normal distribution using Log Transformation\n      2. Standardizing the variables using Standard Scaler for eual variance and equal mean\n      3. Choosing the number of clusters using Elbow Method\n      4. Implementing KMeans\n      5. Building Customer Personas\n         1. Snake Plot\n         2. Calculation relative importance of each cluster compared to the population\n\n  ","622f44b2":"# Building Customer Personas","56d362c4":"# Snake Plot","d2873559":"Assuming that we are analyzing the next day of latest order date in the data set. Creating a variable '*snapshot date*****' which is the latest date in data set.\n\n**Recency** : Recency is the number of days between the customer's latest order date and the snapshot date<br>\n**Frequency**: Number of purchases made by the customer<br>\n**MonetaryValue**: Revenue generated by the customer","64c53ff7":"**Recency\/Frequency\/MonetaryValue** : Level 4 > Level 3> Level 2 > Level 1\n\n* Lower the recency, higher the Recency level<br>\n* Higher the number of orders, higher the Frequency level<br>\n* Higher the monetary value, higher the MonetaryValue level\n","c2a0c66a":"# Monthly Revenue","27b83f28":"Changing the data type of variable 'ORDERDATE' from object to datetime","5234be0f":"# Analyzing KPIs","c99f7489":"**Calculating RFM Score**","9e83709a":"* RFM Score > 10 - **High Value Customer**<br>\n* RFM SCore < 10 and RFM Score >= 6 - **Mid Value Customer**<br>\n* RFM Score < 6 - **Low Value Customer**\n","8d539fd9":"**Dividing the customer into 4 segments(Randomly Chosen)**","739eeef5":"**Higher the monetary value, higher the MonetaryValue level**","b3be836a":"# New Customers Growth Rate","798e61e1":"# Monthly Revenue Growth Rate:","82362cd7":"**Customer Segmentation**\n\nCustomer segmentation is the activity of dividing a broad consumer or business market, normally consisting of existing and potential customers, into sub-groups of consumers (known as segments) based on some type of shared characteristics. The overall aim of segmentation is to identify high yield segments \u2013 that is, those segments that are likely to be the most profitable or that have growth potential \u2013 so that these can be selected for special attention  ([Reference](https:\/\/en.wikipedia.org\/wiki\/Market_segmentation))","c771bf3e":"As expected, customers are highly active during the months of November and October. The number of active customers increased from 2003 to 2004 which indicates that the company is successful in retention\/acquisition of ol\/new customers.","52a40576":"We dont have the complete data for 2005.","8dc9fd6e":"**Price Distribution**","384ce14a":"The distribution of Price is Left Skewed with max price of 100$. Interestingly, many of the orders recieved are of this price. Not investigating further about this particular product line which has the highest price beacuse the target is to segment the customers.","25986105":"**Standardizing the variables using StandardScaler() for equal variance and mean**","75feb0f7":"It is observed that there are no negative values for the quantitative variables, which is a good sign because we cannot have negative prices or quantities.","62a0328d":"# Top 10 countries by Sales","683dfe66":"The highest growth rate is observed in February 2002. This can be investigated further to betetr understand what factors contributed the growth.","6dc4fe9c":"**Distribution of Recency, Frequency and MonetaryValue after Log Transformation**","ef6e5a6f":"# Choosing number of Clusters using Elbow Method","feb2d892":"As we dont have the complete data for 2005, analyzing the Annual Revenue can be misleading. Instead, we can analyze Monthy Revenue.","01fb8b30":"New customer is whoever did his\/her first purchase in the time window we defined, i.e., Mothly in this analysis.","182d0b42":"Apart from expected high\/low growth rates during the seasonal months, there is hig growth rate from Apr 2005 to May 2005.","d8f7d209":"**Sales Distribution**","b26edc9f":"# Annual Revenue","46648ae8":"**Dropping columns **","cdb26eb9":"**Check the distribution of the variables **","664aeafb":"This clearly shows that the revenue is growing especially in October and November. It can be the result of the seasonality(Thnaks Giving and other festivitues). We can also observe that 2005 is performing better than the other years in terms of revenue having the maximum sales in all the months(Jan - May). The reason behind this spike of sales in 2005 can be further investigated to maintain high sales in future.","0cbee268":"**Reading the data**","7f2b20b4":"Not dealing with the mising values of 'Territory' Variable as it may not have a significant effect on the analysis.","0bad62a6":"**Removing the skewness by performing log transformation on the variables**","12f8da7f":"Customer Pesonas can build by determining the summary stats of RFM values or Snake Plot. Snake Plots is a Market Research technique used to compare segments.\nVisual representation of each segment's attributes helps us to determine the relative Importance of segment attributes","762d4db8":"# Calculating relative importance of each attribute","5611ec8e":"**Summary stats of Quantitative variables**","6226339c":"**Labelling the levels**","a51b3d3c":"**Order Quantity Distribution**","0ad29aa9":"# Running KMeans with 5 clusters","67b738c7":"# Segmentation using KMeans Clustering","4f184240":"From the distribution plot of quantity, we can infer that the orders are bulk orders. Majority of the order's quantity are between 20 -40 units.","ce225d70":"**Dealsize Distribution**","a0faa2c1":"**Checking for null values**","f812dae1":"**Checking the time range of the data**","5eddf4a7":"# Segmentation with number of clusters chosen randomly","6de8418f":"**Calculate Recency, Frequency and Monetary value for each customer**","449c2a5a":"# Monthly Active Customers","466c00b3":"# Average Sales per Order","7852ded0":"**Checking for inconsistent data types**"}}