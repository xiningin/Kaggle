{"cell_type":{"151be900":"code","52bb888b":"code","03c30367":"code","e8f1a448":"code","78e9993d":"code","ccf2387f":"code","1a059849":"code","fd436e09":"code","ed424f35":"markdown"},"source":{"151be900":"import os\nimport gc\nimport sys\nimport numpy as np\nimport pandas as pd\nfrom tqdm import tqdm\nfrom joblib import Parallel, delayed\nimport matplotlib.pyplot as plt\n\n%matplotlib inline","52bb888b":"# paths\ninp_folder = \"..\/input\/mlb-player-digital-engagement-forecasting\"\n\ntrain_ = os.path.join(inp_folder, \"train.csv\")\ntest_ = os.path.join(inp_folder, \"example_test.csv\")","03c30367":"sample_test = pd.read_csv(test_)\nsample_test","e8f1a448":"sample_test.info()","78e9993d":"test_cols_ = sample_test.set_index('date').columns.to_list()\ntrain_cols_ = ['nextDayPlayerEngagement'] + test_cols_","ccf2387f":"def unpack_json(json_str, date):\n    res_df = pd.DataFrame()\n    \n    if pd.isna(json_str):\n        return res_df\n    else:\n        res_df = pd.read_json(json_str)\n        \n    res_df['pk_date'] = date\n    \n    return res_df\n\n\ndef unpack_data(data, dfs=None, n_jobs=-1):\n    if dfs is not None:\n        data = data.loc[:, dfs]\n    unnested_dfs = {}\n    for name, column in tqdm(data.iteritems(),total=len(data.columns)):\n        daily_dfs = Parallel(n_jobs=n_jobs)(\n            delayed(unpack_json)(item, date) for date, item in column.iteritems())\n        df = pd.concat(daily_dfs)\n        unnested_dfs[name] = df.set_index(\"pk_date\")\n        del data[name], df\n        _ = gc.collect()\n        \n    return unnested_dfs","1a059849":"train = pd.read_csv(train_)\nstorage_dict = unpack_data(train.set_index('date'), train_cols_)\n\nif not os.path.exists(\".\/unpacked_train\"):\n    os.makedirs(\".\/unpacked_train\")\n    \n\nfor col in train_cols_:\n    storage_dict[col].to_csv(f\".\/unpacked_train\/train_{col}.csv\")","fd436e09":"!cp -r -v ..\/input\/mlb-player-digital-engagement-forecasting\/* .\/","ed424f35":"Dataset Link: https:\/\/www.kaggle.com\/mrutyunjaybiswal\/mlbunpackedtrainjson"}}