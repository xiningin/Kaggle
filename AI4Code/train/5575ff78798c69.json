{"cell_type":{"99962efd":"code","17a15b3f":"code","10f6acd9":"code","53e32bee":"code","fd3104dd":"code","711d6026":"code","5f3cb1e2":"code","b7a81db8":"code","dbebcf02":"code","ac8d66c0":"code","4a9da041":"code","a104f4df":"code","031f9426":"code","003a5a81":"code","5f4d40ab":"code","12c44253":"code","f65c0597":"code","4c8cf4e1":"code","b4564244":"code","06f7eb27":"code","9bbcf7b6":"code","14791895":"code","7040b02c":"markdown","13ab70d9":"markdown","fd4f6a07":"markdown","3947d757":"markdown","b62f37e6":"markdown","7aeeb21c":"markdown","c94e6f6e":"markdown","4f761407":"markdown","4ab4469b":"markdown"},"source":{"99962efd":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","17a15b3f":"import pandas as pd\nfrom pandas import DataFrame\nfrom matplotlib import pyplot as plt\nfrom matplotlib import style\nimport seaborn as sns\nimport numpy as np\nimport plotly_express as px\nimport plotly.graph_objects as go\nfrom datetime import datetime, timedelta\nimport pandas_profiling\nimport altair as alt\n\nimport warnings\nwarnings.filterwarnings('ignore')","10f6acd9":"data = pd.read_csv(\"\/kaggle\/input\/us-border-crossing-data\/Border_Crossing_Entry_Data.csv\")\ndata.head()","53e32bee":"print(data.info())","fd3104dd":"data['Date'] = pd.to_datetime(data['Date'])   # convert objecg to datetime","711d6026":"data.columns = data.columns.str.lower()  # change columns name to lower case to make it easy:","5f3cb1e2":"# reset dataframe: add year & day of the week for further analysis\ndata['year'] = data['date'].dt.strftime('%Y')\ndata['day_of_week'] = data['date'].dt.day_name()\n\ndata.head(3)","b7a81db8":"# The busiest border\nbusy_border = data.groupby(\"border\").value.sum().reset_index()\nbusy_border.sort_values([\"value\"], axis=0, \n                 ascending=[False], inplace=True)  \nbusy_border","dbebcf02":"# Global treemap breakdown\nfig = px.treemap(data, path=['border','state','measure'], values='value',\n                  color='value', hover_data=['state'],\n                  color_continuous_scale='RdBu')\n\nfig.update_layout(title=\"US inbound crossing with Canada and Mexico: State level\",\n                  width=780, height=600, uniformtext=dict(minsize=10, mode='hide'))  \n\nfig.show()","ac8d66c0":"# The transportation way of inbound crossing for each US border\n# visualization with Seaborn\n\nborder_tick=range(2)\n\nfig2, ax2 = plt.subplots(figsize=(18,8))\n\nax2 = sns.barplot(x=data['border'], y=data['value'], hue=data['measure'], data=data, log=True)\nax2.set_xlabel('US borders', size=14, fontweight='bold')\nax2.set_ylabel('Inbound crossing value', size=14, fontweight='bold')\nplt.legend(loc=\"upper left\", frameon=False, ncol=3, fontsize=12)\nplt.title(\"US inbound crossing analysis: Measure VS Border\", size=17, color=\"indianred\", fontweight='bold')\n\n# bar chart styling\nsns.despine(left=True)  # remove upper and left line\n\nax2.set_axisbelow(True)  \nax2.yaxis.grid(True, color='#EEEEEE')\nax2.xaxis.grid(False)\n\nplt.show()","4a9da041":"# Now, let's look at state level yearly transportation evolution\n\ntran = data.groupby(['measure', 'state','year']).value.sum().reset_index()\n\nfig = px.scatter(tran, x=\"year\", y=\"value\", color=\"measure\", facet_col=\"state\",\n       facet_col_wrap=5)\n\nfig.update_layout(title=\"US inbound crossing measure from Canada and Mexico border 1996-2020\", \n                  width=780, height=600)\n\nfig.update_xaxes(showgrid=False)\n\nfig.show()","a104f4df":"# Use pivot table for day of week analysis \n\n# regroup related data\nweek_table = data.groupby(['border', 'day_of_week']).value.count().reset_index()\n\n# Create pivot table\npivot_week = pd.pivot_table(data, 'value', ['border','state','year'], 'day_of_week')\n\n# Reorder column\npivot_week = pivot_week[['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday','Saturday', 'Sunday']]\npivot_week.head()","031f9426":"sns.set()\npd.pivot_table(data, 'value', ['state'], 'day_of_week').plot(kind= 'bar', width=0.9, alpha=0.9, figsize=(22, 10), title=\"US inbound crossing weekday level\", fontsize=15)\nplt.ylabel(\"crossing number\", fontsize=18, color='indianred', fontweight='bold')\nplt.xlabel(\"US states\", fontsize=18, color='indianred', fontweight='bold')\nplt.title('US inbound crossing weekday level', fontsize=25, color='indianred', fontweight='bold')\nplt.legend(fancybox=True, shadow=True, fontsize=16)","003a5a81":"# create new column which will return \"illegal\" if matches certain condition for measure.\ndata['law'] = data.measure.apply(lambda x: 'illegal' if x == 'Truck Containers Empty' or x == 'Truck Containers Full' or x =='Rail Containers Empty' or x == 'Rail Containers Full' else 'legal')\n\n# Then, extract all categorical data: illegal crossing\nillegal_data = data[data.law == 'illegal']\nillegal_data2 = illegal_data.groupby(['year', 'border']).value.sum().reset_index()\nillegal_data2.head()","5f4d40ab":"fig = px.area(illegal_data2, x=\"year\", y=\"value\", color=\"border\")\n\nfig.update_layout(title=\"US illegal inbound crossing from Canada and Mexico border 1996-2020\", \n                  width=780, height=500)\n\nfig.update_xaxes(showgrid=False)\n\nfig.show()","12c44253":"# legal VS illegal crossing analysis: state level\n\nmeasure_ill = data[data.law == 'illegal']\nmeasure_ill = measure_ill.groupby(['border', 'measure', 'state', 'year']).value.sum().reset_index()\nmeasure_ill.head()\n\n# set pivot table: columns should be illega crossing measure\npivot_illegal = pd.pivot_table(measure_ill, 'value', ['state'], 'measure')\npivot_illegal.head(5)","f65c0597":"# plot pivot table outcome with Seaborn\n\nsns.set()\npd.pivot_table(measure_ill, 'value', ['state'], 'measure').plot(kind= 'bar', width=0.88, figsize=(22, 10), title=\"US inbound crossing weekday level\", fontsize=15)\nplt.ylabel(\"crossing number\", fontsize=18, color='indianred', fontweight='bold')\nplt.xlabel(\"US states\", fontsize=18, color='indianred', fontweight='bold')\nplt.title('US inbound crossing illegal transportation', fontsize=25, color='indianred', fontweight='bold')\nplt.legend(fancybox=True, shadow=True, fontsize=16)","4c8cf4e1":"# Extract legal dataset\nall_legal = data[data.law == 'legal']\n\n# Regroup and rename measure elements in dataset\nall_legal.loc[(all_legal['measure'] == 'Bus Passengers') | (all_legal['measure'] == 'Train Passengers') | (all_legal['measure'] == 'Buses') | (all_legal['measure'] == 'Trains'), 'measure'] = 'public'\nall_legal.loc[(all_legal['measure'] == 'Personal Vehicle Passengers') | (all_legal['measure'] == 'Personal Vehicles') | (all_legal['measure'] == 'Pedestrians') | (all_legal['measure'] == 'Trucks'), 'measure'] = 'private'\nall_legal.head()","b4564244":"# create final sorted table: pu_pri\npu_pri = all_legal[['year', 'state', 'measure', 'value']]\n\n# create pivot table show private & public\npivot_pupri = pd.pivot_table(pu_pri, 'value', ['state','year'], 'measure')\n\npivot_pupri = pivot_pupri.reset_index()   # reconvert pivot table back to dataframe\n\n# Calculate percentage of public \npivot_pupri['per_public'] = pivot_pupri.apply(lambda row: row['public']\/(row['private']+row['public']), axis=1)\npivot_pupri.head()","06f7eb27":"# Now, visualize public measure percentage\n\nfig = px.scatter(pivot_pupri, x=\"year\", y=\"per_public\", facet_col=\"state\",\n       facet_col_wrap=5)\n\nfig.update_layout(title=\"public transportation percentage from 1966 to 2020\", \n                  width=780, height=600)\n\nfig.layout.yaxis2.update(matches=None)  # matches=none, reset y value\nfig.update_xaxes(showgrid=False)\nfig.show()","9bbcf7b6":"# Explore Alaska data\nalaska = data.groupby(['year', 'measure', 'state']).value.sum().reset_index()\nalaska.head()\n\nalaska = alaska[alaska.state == 'AK'].reset_index()\nalaska.head()\n\nooo = alaska[(alaska.year == '2017') | (alaska.year == '2018') | (alaska.year == '2019')]\nnnn = ooo[(ooo.measure == 'Bus Passengers') | (ooo.measure == 'Train Passengers') | (ooo.measure == 'Buses') | (ooo.measure == 'Trains')]  \nnnn.head(12)","14791895":"# Create pivot table\n\nAK = pd.pivot_table(nnn, 'value', ['year', 'state'], 'measure').reset_index()\nAK.head()","7040b02c":"- Many people enter Alaska by bus, and it's increasing fast during the past three years...\n- Why Alaska has a high public transportation rate? While because it's hard to drive on ice... ","13ab70d9":"- Obviously, Mexico border has more illegal crossings than Canada border\n- Year 2017 is special, illegal crossing from mexico is very high.\n- Sharp dip of crossing of 2008 and 2009 due to deep recession and high unemployeement. ","fd4f6a07":"- Truck is the most popular transportation for illegal trespassing\n- Most illegal crossing states: Michegan, Texas, New York \n- Minnesota state has a high level of Train containers crossing","3947d757":"I'm curious about legal and illegal crossing. Let's regroup data according to crossing measure","b62f37e6":"Monday has a noticeable high rate of border crossing while Friday is realtively flat. \n- Hypothesis: People enters US for work, then go back for weekend.","7aeeb21c":"Now, I want to know that among all legal crossings:\n- what's the percentage of public trasportation? And how it evolves along time?","c94e6f6e":"Wow! \nAlaska has an outstanding high level of public transportation, It's the only state that public trasportation surpasses private!\nNow, let's take a closer look at it...","4f761407":"** Interesting phenomenon revealed by the chart above:\n\n- While the overall measure of US-Canada Border seems like lower than US-Mexico Border, there is an exception: US-Canada border does have a higher level of: Rail containers transportation, train passengers and trains. \nConclusion: Canada border's railway system is popular. \n\n- Mexico border pedestrians are very high, while Canada border is low. This may due to the density of population: Canadian population spreads more widely than Mexicain. It's not a \"walking\" mindet infrastructure. \n","4ab4469b":"The busiest border is obviously US-Mexico border.\nLet's get a deeper view of transportation measure for each state"}}