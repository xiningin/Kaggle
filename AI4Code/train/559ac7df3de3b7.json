{"cell_type":{"3ea5caf1":"code","57c343ae":"code","0dc57445":"code","f67b8d13":"code","8f3cbdf8":"code","dd68aeae":"code","440e73c2":"code","da460aa8":"code","905baec0":"code","d06098b6":"code","942d4af5":"markdown","34f95dd1":"markdown"},"source":{"3ea5caf1":"!mkdir -p ..\/temp\/\n!mkdir -p ..\/temp\/html\n\n!wget -nc https:\/\/raw.githubusercontent.com\/Hernan4444\/MyScripts\/master\/google_drive\/google_api.py -q --show-progress\n!mv google_api.py ..\/temp\/google_api.py","57c343ae":"import sys\nsys.path.append('\/kaggle\/temp\/')\n\nimport os\nfrom google_api import download_file_without_authenticate\n\nif not os.path.exists('\/kaggle\/temp\/html.zip'): \n    download_file_without_authenticate('1laYyz5WVuaxDhhpLmIvCCFsYRAXvaEoF', '\/kaggle\/temp\/html.zip')\n    !unzip -q -o \/kaggle\/temp\/html.zip  -d \/kaggle\/temp\/html \n\nprint(os.listdir(\"\/kaggle\/temp\/html\")[:10])\n\n!ls \/kaggle\/temp","0dc57445":"import pandas as pd\n\ndf = pd.read_csv(\"..\/input\/anime-recommendation-database-2020\/anime.csv\")\nprint(df.shape)","f67b8d13":"df_minor = df[df.Genders.apply(lambda x: \"Hentai\" not in x.split(\", \"))]\ndf_minor = df_minor[[\"MAL_ID\", \"Name\", \"Score\", \"Genders\"]]\n\nprint(df_minor.shape)\ndf_minor.head(2)","8f3cbdf8":"all_genders = set()\nfor i, x in df_minor.iterrows():\n    all_genders = all_genders.union(set(x.Genders.split(\", \")))\n\nprint(all_genders)","dd68aeae":"!pip3 install bs4 -q","440e73c2":"from zipfile import ZipFile\nfrom bs4 import BeautifulSoup\nimport re\n\n\ndef extract_zip(input_zip):\n    input_zip = ZipFile(input_zip)\n    return {name: input_zip.read(name) for name in input_zip.namelist()}\n\nno_synopsis = \"No synopsis has been added for this series yet. Click here to update this information.\"\ndef get_synopsis_anime(anime_id):\n    data = extract_zip(f\"\/kaggle\/temp\/html\/{anime_id}.zip\")\n    anime_info = data[\"details.html\"].decode()\n    soup = BeautifulSoup(anime_info, \"html.parser\")\n    div = soup.find(\"div\", {\"id\": \"contentWrapper\"})\n    p = div.find(\"p\", {\"itemprop\": \"description\"})\n    \n    text = re.sub(r\"\\(Source:\\s?..*\\)\", \" \", p.text)\n    text = re.sub(r\"\\[Written by MAL..*]\", \" \", text)\n    text = \" \".join(text.split()).strip()\n    if text == no_synopsis:\n        return \"Unknown\"\n    return text\n","da460aa8":"for ID in [1115, 1109, 1020, 1023, 2636]:\n    print(get_synopsis_anime(ID))\n    print()","905baec0":"%%time\n\nsypnopsis = []\nfor i, x in enumerate(df_minor.MAL_ID):\n    sypnopsis.append(get_synopsis_anime(x))\n    if i%500 == 0:\n        print(f\"\\r {i + 1}\/{df_minor.shape[0]}\", end=\"\")\n\ndf_minor[\"synopsis\"] = sypnopsis\ndf_minor.head()","d06098b6":"df_minor.to_csv(\"anime_with_synopsis.csv\", index=False)","942d4af5":"## Get synopsis for all anime","34f95dd1":"## Download Zip with HTML files.\n\nThe zip contain 1 zip each anime with HTML files. With this HTML files we can extract information about the anime like genre, stats, etc. In this case, we will extract the sypnosis of each anime which not include hentai in genres."}}