{"cell_type":{"10e1ce24":"code","9a736439":"code","00c3dc21":"code","0fe1a21d":"code","3dc7e8bb":"code","8e1bccde":"code","8322b0cf":"code","6adad2f4":"code","bbb5728b":"code","d679c651":"code","84459a4c":"code","8db1269e":"code","d5433d7b":"code","c2267e53":"code","85725a15":"code","415ab270":"code","e9ad9578":"code","f175d9c0":"code","5a118f95":"code","cbb82c11":"code","f085c2d8":"markdown","39da2113":"markdown","50b86382":"markdown","7b35d7e8":"markdown","d1bc2e3b":"markdown","aa4969cd":"markdown","a0621935":"markdown","573c439f":"markdown","dabaa760":"markdown","9eac6edf":"markdown","6043b4ca":"markdown","0aa13045":"markdown","8078c760":"markdown","2179d82c":"markdown","80509af0":"markdown","7292ca78":"markdown","c7a0512d":"markdown","83035a2b":"markdown","7f681f32":"markdown"},"source":{"10e1ce24":"import pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport numpy as np","9a736439":"data = pd.read_csv(\"..\/input\/hotel-booking-demand\/hotel_bookings.csv\", header=0, index_col=0, encoding='utf-8')\n\ndata.info()","00c3dc21":"data.isnull().sum()","0fe1a21d":"hotel = data.reset_index().groupby(\"hotel\").aggregate({\"hotel\": \"count\"}).rename(columns={'hotel': 'count', 'index': 'hotel'})\nhotel = hotel.sort_values('count', ascending=False).reset_index()\n\nplt.figure(figsize=(8, 8))\nexplode = [0.07,0]\nlabels = hotel[\"hotel\"]\ncolors = ['lightsalmon', 'skyblue']\nplt.pie(hotel[\"count\"], autopct='%.1f%%', explode=explode, labels=labels, colors=colors)\nplt.title(label=\" Type of Hotel\", loc=\"center\", fontsize=16)\n\nplt.show()","3dc7e8bb":"where = data[\"country\"].fillna({\"country\": \"unknown\"}).reset_index()\nwhere = where.groupby(\"country\").aggregate({\"country\": \"count\"})\nwhere = where.rename(columns={'country': 'count', 'index': 'country'}).reset_index().sort_values('count', ascending=False)\n\nsns.set(style='darkgrid')\nsns.catplot(x=\"country\", y=\"count\", kind=\"bar\", data=where.head(10))\nplt.title(label=\"Country Top 10\", loc=\"center\", fontsize=15)\nplt.tight_layout()\n\nplt.show()","8e1bccde":"price = data[~data['adr'].isin([5400])] \nprice = price.sort_values('assigned_room_type', ascending=True)\n\nplt.figure(figsize=(10, 7))\ncurrent_palette =sns.hls_palette(2, h=0.5)\nsns.boxplot(x=\"assigned_room_type\", y=\"adr\",\n            hue=\"hotel\", palette=current_palette,\n            data=price.reset_index())\nplt.title(label=\"Price of room type\", loc=\"center\", fontsize=15)\nplt.show()","8322b0cf":"month = data[[\"arrival_date_month\", \"adr\"]].reset_index().sort_values(\"arrival_date_month\")\n\nordered_months = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\n          \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"]\nmonth[\"arrival_date_month\"] = pd.Categorical(month[\"arrival_date_month\"], categories=ordered_months, ordered=True)\n\nplt.figure(figsize=(10, 7))\nsns.lineplot(x = \"arrival_date_month\", y=\"adr\", hue=\"hotel\", data=month,\n            ci='sd', sizes=(2.5, 2.5))\nplt.title(label=\"Price changes over year\", loc=\"center\", fontsize=15)\n\nplt.show()","6adad2f4":"data = data.fillna({\"children\": 0})\ndata[\"guest\"] = data[\"adults\"] + data [\"children\"] + data[\"babies\"]\nguest = data[[\"guest\", \"arrival_date_month\"]].reset_index()\nordered_months = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\n    \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"]\nguest[\"arrival_date_month\"] = pd.Categorical(guest[\"arrival_date_month\"], categories=ordered_months, ordered=True)\n\nplt.figure(figsize=(12, 7))\nsns.lineplot(x = \"arrival_date_month\", y=\"guest\", hue=\"hotel\", data=guest, ci=1, sizes=(2.5, 2.5))\nplt.title(label=\"Guest changes over year\", loc=\"center\", fontsize=15)\n\nplt.tight_layout()\nplt.show()","bbb5728b":"data[\"guest\"] = data[\"adults\"] + data [\"children\"] + data[\"babies\"]\ndata = data[data[\"is_canceled\"]==0].reset_index()\n\nlong = data[[\"stays_in_weekend_nights\", \"stays_in_week_nights\", \"guest\", \"hotel\"]].reset_index()\nlong[\"nights\"] = long[\"stays_in_weekend_nights\"] + long[\"stays_in_week_nights\"]\n\nplt.figure(figsize=(20, 7))\nplt.subplot2grid((1,2), (0,0))\nsns.barplot(x=\"nights\", y=\"guest\", data=long)\nplt.title(label=\"Length of Nights\", loc=\"center\", fontsize=15)\nplt.xlim(-1, 29)\n\nplt.subplot2grid((1,2), (0,1))\nlong = long.groupby(\"nights\").aggregate({\"guest\": \"sum\"}).reset_index()\nsum = long[\"guest\"].sum()\nlong[\"guest%\"] = long[\"guest\"]\/sum\nplt.bar(long[\"nights\"], long[\"guest%\"], width=0.5)\nplt.title(label=\"Length of Nights in %\", loc=\"center\", fontsize=15)\nplt.xlim(-1, 30)\nplt.xticks(range(0,30,2))\n\nplt.show()","d679c651":"data = data[data[\"is_canceled\"]==0].reset_index()\nsegment = data[[\"hotel\", \"market_segment\"]]\n\nplt.figure(figsize=(12, 6))\nsegment = segment.groupby(\"market_segment\").aggregate({\"hotel\": \"count\"}).reset_index()\nsegment = segment.sort_values(by=['hotel'], ascending=False)\nplt.title(label=\"Market Segment\", loc=\"center\", fontsize=15)\n\nsns.barplot(x=\"market_segment\", y=\"hotel\", data=segment)\nplt.show()","84459a4c":"data = pd.read_csv(\"..\/input\/hotel-booking-demand\/hotel_bookings.csv\", header=0, index_col=0, encoding='utf-8')\ndata2 = data[data[\"is_canceled\"]==0].reset_index()\nsegmentype = data2[[\"hotel\", \"market_segment\", \"reserved_room_type\", \"adr\"]]\nsegmentype = segmentype.rename(columns={'reserved_room_type': 'room type'})\n\nplt.figure(figsize=(15, 7))\nplt.rc('axes', axisbelow=True)\nplt.grid(axis=\"y\", linestyle='-.')\nsns.barplot(x=\"market_segment\", y=\"adr\",\n            hue=\"room type\",\n            data=segmentype,\n            ci=\"sd\",\n            capsize=0.1,\n            errwidth=0.7)\nplt.title(label=\"Adr in each segment & room_type\", fontsize=15)\nplt.legend(loc=\"upper right\")\n\nplt.show()","8db1269e":"\ndata3 = data.reset_index()\ncancellations = data3[[\"hotel\", \"is_canceled\", \"arrival_date_year\", \"arrival_date_month\"]]\nsns.catplot(x=\"arrival_date_year\", col=\"is_canceled\",\n            data=cancellations, hue=\"hotel\", kind=\"count\", height=4, aspect=.7, legend=False)\nplt.legend(loc=\"upper right\")\n\nplt.show()","d5433d7b":"plt.figure(figsize=(13, 6))\ndata4 = data[data[\"is_canceled\"]==1].reset_index()\ncancellations = data4[[\"hotel\", \"is_canceled\", \"arrival_date_year\", \"arrival_date_month\"]]\nordered_months = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\n          \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"]\ncancellations[\"arrival_date_month\"] = pd.Categorical(cancellations[\"arrival_date_month\"], categories=ordered_months, ordered=True)\n\nsns.countplot(x=\"arrival_date_month\",  hue=\"hotel\", data=cancellations)\nplt.title(label=\"Cancellation each Month\", fontsize=15)\nplt.legend(loc=\"upper right\")\nplt.tight_layout()\n\nplt.show()","c2267e53":"corr = data.corr()[\"is_canceled\"]\n\ncorr.sort_values()","85725a15":"sns.heatmap(data.corr())\nplt.title(label=\"Correlation\", fontsize=15)\nplt.show()","415ab270":"from sklearn.model_selection import train_test_split\n\nfrom sklearn.linear_model import LogisticRegression","e9ad9578":"data = data.fillna(({\"agent\": \"0\"}))\nx=data[[\"lead_time\", \"previous_cancellations\", \"booking_changes\", \"required_car_parking_spaces\",\n        \"total_of_special_requests\", \"is_repeated_guest\", \"agent\", \"adults\",\n        \"previous_bookings_not_canceled\", \"babies\"]]\ny=data['is_canceled']\n\nX_train, X_test, y_train, y_test = train_test_split(x, y, test_size=.2, random_state=1)\n\nL = LogisticRegression()\n\nL.fit(X_train, y_train)\n\ny_pred = L.predict(X_test)\n","f175d9c0":"L.score(X_train, y_train)","5a118f95":"from sklearn.metrics import confusion_matrix\n\nmatrix = confusion_matrix(y_test, y_pred)\nsns.heatmap(matrix, annot=True)\n\nplt.show()\nprint(matrix)","cbb82c11":"from sklearn.metrics import accuracy_score\n\naccuracy = accuracy_score(y_test, y_pred)\n\nprint(accuracy)","f085c2d8":"## The country guest come from","39da2113":"## Guest change in month","50b86382":"## Price variation in month","7b35d7e8":"Choose the relatively high correlated parameter as input. Then split the training set and testing set (20% is good by trial and error) and run the model.","d1bc2e3b":"# 2. Prediction of Cancellation","aa4969cd":"## Cancellations per year","a0621935":"## Cancellations per month","573c439f":"# EDA & Prediction of Cancellation\n\nThe content consist of two sections.The Exploratory Data Analysis\uff08EDA\uff09 and the Prediction of Cancellation\/Actual Coming Guests.\n\n### 1.EDA \n* Hotel proportion\n* The country guest come from\n* Price variation in year\n* Price variation in month\n* Guest change in month\n* Length of nights\n* Market segment\n* Adr in each segment & room_type\n* Cancellations per year\n* Cancellations per month\n\n### 2. Prediction of Cancellation\n* Linear Regression\n* Neural Network(to be updated)\n* Other method(to be updated)","dabaa760":"Some of the country data is NULL, so we need to fill the NULL with a name \"unknown\" first.","9eac6edf":"## Adr in each segment & room_type","6043b4ca":"## Length of nights","0aa13045":"## Price variation in year","8078c760":"This time we utilized Linear Regression to set up the model. Firstly, find out the correlated value in according to \"is_canceled\".","2179d82c":"##  Hotel proportion","80509af0":"Actually there is a point that adr is abnormally high, it can be regarded as abnormal value and not included in the analysis. Otherwise the figure will be weired. ","7292ca78":"Evaluate the model by confusion matruix and accuracy score.","c7a0512d":"As shown in the figure that the guests mostly come from PRT, Portugal.","83035a2b":"## Market segment","7f681f32":"# 1. EDA"}}