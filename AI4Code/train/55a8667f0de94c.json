{"cell_type":{"19ef29dc":"code","e4a9f89c":"code","c587a31b":"code","030d584d":"code","60a5e229":"code","d4d8bc75":"code","8e4af5bb":"code","96c8fd89":"code","b9446a0e":"code","4f2134ea":"code","9658eb87":"code","718c0e51":"code","de4d097c":"code","cc091f1e":"code","d3118ef5":"code","d2e6eb34":"code","ad15ec97":"code","2f3c3bd8":"code","ece99512":"code","ccae3137":"code","a29b4346":"code","91e5b4a1":"code","a3afc88b":"code","7bb8eaef":"code","78646fba":"code","4503f4d1":"code","afa09ecf":"code","5e6141b2":"code","d308b48c":"code","3138dbb4":"code","733bd2e4":"code","8a3abb19":"code","d567db29":"code","692582e7":"code","c6ccd1dc":"code","42075fe0":"code","edaf3c53":"code","24e696b6":"code","47517836":"code","6896706b":"code","bbc80a59":"code","eaee84df":"code","9534ed0e":"code","02e3887d":"code","91c0b7aa":"code","7ea3e52d":"code","983930c7":"code","bc9e8d5a":"code","cb84ec60":"code","3fcb66e6":"code","5a7a8344":"code","2cb558da":"code","4642a579":"code","1b9e61e6":"code","f1a0a9a6":"code","1d49811d":"code","ef8fd65a":"code","430d6f2d":"code","ddcee37f":"code","76ce267b":"code","5559ba3c":"code","3832a571":"markdown","8e2436c3":"markdown","ba71490b":"markdown","bb0ca3e9":"markdown","cec826c8":"markdown","c084f61e":"markdown","cadb93c6":"markdown","23e559f8":"markdown","6a26c727":"markdown","0c869639":"markdown","ce43096a":"markdown","31f144d8":"markdown","7a0680a5":"markdown","0d499687":"markdown","148e3049":"markdown","93afcc7d":"markdown","ed4ad293":"markdown","b5dc62a3":"markdown","6cccb250":"markdown","67193718":"markdown","1dfd6aec":"markdown","e9fd162c":"markdown","0d8ee625":"markdown","4da2b44c":"markdown","202877df":"markdown","afe1e7aa":"markdown","945e7942":"markdown","5925b0e1":"markdown","d9f63705":"markdown","d77551b0":"markdown","998a4d7a":"markdown","c4e4e1b4":"markdown","9a4eea5b":"markdown","d3f71a66":"markdown","e23580d8":"markdown","dddff29f":"markdown","a855d883":"markdown","a32121a3":"markdown","d729600c":"markdown","e0e07b5c":"markdown","d5662eb4":"markdown","f5f439be":"markdown","bc75291c":"markdown","1f52a329":"markdown","b142e810":"markdown","e05dc548":"markdown","5a44c216":"markdown","91b6a855":"markdown","91da7da5":"markdown","73a06381":"markdown","18a431da":"markdown","d5f3d34a":"markdown","6edce953":"markdown","bcb42aac":"markdown","06fd392f":"markdown","8142152e":"markdown","c955e932":"markdown","cc545e40":"markdown","23659a10":"markdown","a690114e":"markdown","1413b027":"markdown","a0e4ed1e":"markdown","881a06fe":"markdown","e6da3b1f":"markdown"},"source":{"19ef29dc":"from sklearn.metrics import confusion_matrix, accuracy_score, mean_squared_error, r2_score, roc_auc_score, roc_curve, classification_report\nfrom sklearn.ensemble import RandomForestClassifier\nfrom lightgbm import LGBMClassifier\nfrom warnings import filterwarnings\nfilterwarnings('ignore')\nimport numpy as np\nimport pandas as pd\nimport seaborn as sns\nfrom sklearn.linear_model import LinearRegression, Ridge, Lasso, ElasticNet\nfrom sklearn.model_selection import train_test_split, GridSearchCV, cross_val_score\nimport matplotlib.pyplot as plt\nfrom sklearn.tree import DecisionTreeRegressor\nimport warnings\nfrom sklearn.exceptions import ConvergenceWarning\n\nwarnings.simplefilter(action='ignore', category=FutureWarning)\nwarnings.simplefilter(\"ignore\", category=ConvergenceWarning)\n\npd.pandas.set_option('display.max_columns', None)\npd.set_option('display.float_format', lambda x: '%.3f' % x)\nfrom imblearn.over_sampling import SMOTE\nfrom sklearn.metrics import confusion_matrix\npd.set_option('display.max_columns', None)\npd.set_option('display.max_rows', None)\n","e4a9f89c":"df1 = pd.read_csv(\"..\/input\/churn-predictions-personal\/Churn_Predictions.csv\")\ndf = df1.copy()","c587a31b":"df.head()","030d584d":"df.head().T","60a5e229":"df.shape","d4d8bc75":"df.info()","8e4af5bb":"df.isnull().values.any()","96c8fd89":"df.isnull().sum()","b9446a0e":"df.describe(include=[np.number])","4f2134ea":"def load_house_price():\n    dataframe = pd.read_csv(\"..\/input\/churn-predictions-personal\/Churn_Predictions.csv\")\n    return dataframe","9658eb87":"sns.pairplot(df[['Age','Balance','CreditScore']])\nplt.show()","718c0e51":"df.columns","de4d097c":"cat_cols = [col for col in df.columns if df[col].dtypes == 'O']\nprint('Number of Categorical Variables : ', len(cat_cols))","cc091f1e":"cat_cols","d3118ef5":"more_cat_cols = [col for col in df.columns if len(df[col].unique()) < 10]\nprint('New Number of Categorical Variables: ', len(more_cat_cols))\nprint(more_cat_cols)","d2e6eb34":"df[\"Geography\"].value_counts()","ad15ec97":"df[\"Gender\"].value_counts()","2f3c3bd8":"df[\"NumOfProducts\"].value_counts()","ece99512":"df[\"HasCrCard\"].value_counts()","ccae3137":"df[\"IsActiveMember\"].value_counts()","a29b4346":"num_cols = [col for col in df.columns if df[col].dtypes != 'O' and col not in \"Id\"]\nprint('Number of Numerical Variables: ', len(num_cols))","91e5b4a1":"num_cols","a3afc88b":"def hist_for_nums(data, numeric_cols):\n    col_counter = 0\n    data = data.copy()\n    for col in numeric_cols:\n        data[col].hist(bins=20)\n        plt.xlabel(col)\n        plt.title(col)\n        plt.show()\n        col_counter += 1\n    print(col_counter, \"variables have been plotted\")","7bb8eaef":"hist_for_nums(df, num_cols)","78646fba":"df[\"Exited\"].value_counts()","4503f4d1":"fig1, ax1 = plt.subplots()\nax1.pie(df[\"Exited\"].value_counts(),  labels=['No','Yes'], autopct='%1.1f%%',\n        shadow=True, startangle=90)\nax1.axis('equal')\nplt.show()","afa09ecf":"df.corr()\na = df.corr()['Exited'].sort_values(ascending=False)\nprint(a)\n","5e6141b2":"corrmat = df.corr()\nf, ax = plt.subplots(figsize=(12, 9))\nsns.heatmap(corrmat,vmin = 0,vmax=1,square=True,cmap=\"YlGnBu\",ax=ax)\nplt.show()","d308b48c":"df.isnull().values.any()","3138dbb4":"df.isnull().sum()","733bd2e4":"df.drop([\"RowNumber\",\"CustomerId\",\"Surname\"],axis=1,inplace=True)","8a3abb19":"df = df.reset_index(drop=True)","d567db29":"df.columns","692582e7":"df[\"AgeCat\"] = pd.qcut(df[\"Age\"], 5, labels=[1, 2, 3, 4, 5])\ndf[\"AgeCat\"].value_counts()","c6ccd1dc":"df.groupby(\"NumOfProducts\")[\"Exited\"].value_counts()","42075fe0":"df.groupby(\"Geography\")[\"Exited\"].value_counts()","edaf3c53":"df.groupby(\"Gender\")[\"Exited\"].value_counts()","24e696b6":"df[\"GelirKrediOrani\"] = df[\"EstimatedSalary\"] \/ df[\"CreditScore\"]","47517836":"df['GelirKrediOrani'].corr(df['Exited'])","6896706b":"df[\"experience\"] = df[\"Tenure\"] \/ df[\"Age\"]","bbc80a59":"df[\"LegalAge\"] = df[\"Age\"] - df[\"Tenure\"]","eaee84df":"df.head()","9534ed0e":"from sklearn.preprocessing import LabelEncoder\nle=LabelEncoder()\ndf[\"Gender\"]= le.fit_transform(df[\"Gender\"])","02e3887d":"def one_hot_encoder(dataframe):\n    dataframe = pd.get_dummies(dataframe, columns=[\"Geography\"], drop_first=True)\n    new_columns = [c for c in dataframe.columns if c not in original_columns]\n    return dataframe, new_columns\n\ndf.drop(['Gender','Geography'],axis=1,inplace=True)","91c0b7aa":"df.head()","7ea3e52d":"df_new = df[[\"Age\",\"NumOfProducts\",\"EstimatedSalary\", \"GelirKrediOrani\",\"LegalAge\",\"experience\"]]","983930c7":"def robust_scaler(variable):\n    var_median = variable.median()\n    quartile1 = variable.quantile(0.25)\n    quartile3 = variable.quantile(0.75)\n    interquantile_range = quartile3 - quartile1\n\n    if int(interquantile_range) == 0:\n        quartile1 = variable.quantile(0.05)\n        quartile3 = variable.quantile(0.95)\n        interquantile_range = quartile3 - quartile1\n        z = (variable - var_median) \/ interquantile_range\n        return round(z, 3)\n    else:\n        z = (variable - var_median) \/ interquantile_range\n    return round(z, 3)","bc9e8d5a":"for col in df_new:\n    df[col] = robust_scaler(df[col])\n","cb84ec60":"hist_for_nums(df, df_new)","3fcb66e6":"X = df.drop('Exited', axis=1)\ny = df[[\"Exited\"]]\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.20,random_state=12345)","5a7a8344":"lgbm_model=LGBMClassifier().fit(X_train,y_train)\ny_pred = lgbm_model.predict(X_test)","2cb558da":"cv_results = cross_val_score(lgbm_model, X_train, y_train, cv = 10, scoring= \"accuracy\")\nprint(cv_results.mean())\nprint(accuracy_score(y_test, y_pred))\nprint(classification_report(y_test, y_pred))","4642a579":"rf_model = RandomForestClassifier().fit(X_train,y_train)\ny_pred = rf_model.predict(X_test)","1b9e61e6":"cv_results = cross_val_score(rf_model, X_train, y_train, cv = 10, scoring= \"accuracy\")\nprint(cv_results.mean())\nprint(accuracy_score(y_test, y_pred))\nprint(classification_report(y_test, y_pred))","f1a0a9a6":"cart_model = DecisionTreeRegressor(random_state=52).fit(X_train,y_train)\ny_pred = cart_model.predict(X_test)","1d49811d":"cv_results = cross_val_score(cart_model, X_train, y_train, cv = 10, scoring= \"accuracy\")\nprint(cv_results.mean())\nprint(accuracy_score(y_test, y_pred))\nprint(classification_report(y_test, y_pred))","ef8fd65a":"smt = SMOTE(random_state=12345)\nX_res, y_res = smt.fit_sample(X, y)","430d6f2d":"X = df.drop('Exited', axis=1)\ny = df[[\"Exited\"]]","ddcee37f":"X_train, X_test, y_train, y_test = train_test_split(X_res, y_res,test_size=0.20,random_state=12345)","76ce267b":"lgbm_model=LGBMClassifier(random_state=12345).fit(X_train,y_train)\ny_pred = lgbm_model.predict(X_test)","5559ba3c":"cv_results = cross_val_score(lgbm_model, X_train,y_train, cv = 10, scoring= \"accuracy\")\nprint(\"cross_val_score(train):\", cv_results.mean())\ncv_results = cross_val_score(lgbm_model, X_test,y_test, cv = 10, scoring= \"accuracy\")\nprint(\"cross_val_score(test):\", cv_results.mean())\ny_train_pred = lgbm_model.predict(X_train)\nprint(\"accuracy_score(train):\",accuracy_score(y_train, y_train_pred))\nprint(\"accuracy_score(test):\",accuracy_score(y_test, y_pred))\nprint(classification_report(y_test, y_pred))","3832a571":"Dependent Variable\n\nExited: It indicates whether a person left the bank or not (0=No,1=Yes). That is, 1 indicating the person did \nleave the bank, 0 indicating that they didn't.\n\nIndependent Variable\n\nSurname: the surname of a customer\n\nGender : Female\/Male\n\nCreditScore : A credit score (credit rating) indicates the likelihood of customer paying credit back.\n\nGeography : Customer\u2019s location (Germany\/France\/Spain)\n\nAge \n\nTenure : The number of years that the customer has been a client of the bank.\n\nBalance : The amount of money customer has in a bank account.\n\nNumOfProducts : It indicates the number of products that a customer has purchased through the bank \n(for instance, credit card, loan, etc.).\n\nIsActiveMember : Status  of active membership (0=No,1=Yes).\n\nHasCrCard : it indicates whether or not a customer has a credit card (0=No,1=Yes).\n\nEstimatedSalary : Estimated salary","8e2436c3":"# **Unbalanced Data Set**","ba71490b":"**6.1. Missing Values**","bb0ca3e9":"The index has been reorganized.","cec826c8":"**Geography**","c084f61e":"# 2. UNDERSTANDING THE DATA-SET","cadb93c6":"There is no missing value in data set.","23e559f8":"How many numeric variables are in the data set?","6a26c727":"These features are dropped  since they don't effect the dependent variable.","0c869639":"**Gender**","ce43096a":"# **Data Summary**","31f144d8":"**Model**","7a0680a5":"**List of Categorical Variable******\n\"\"\" 'CreditScore', 'Age', 'Tenure', 'Balance', 'NumOfProducts', 'EstimatedSalary'\"\"\"","0d499687":"The sample size has been increased since it is an unbalanced data set.","148e3049":"# 3. EXPLORATORY DATA ANALYSIS ON CATEGORICAL DATA","93afcc7d":"**Validation error, accuracy score, confusion matrix**","ed4ad293":"# 8. LABEL ENCODING & ONE-HOT ENCODING","b5dc62a3":"One hot encoding was applied to geography categorical variables.","6cccb250":"# **Load Data**","67193718":"Age variable was assigned as 18-30 = 1, 30-40 = 2, 40-50 = 3, 50-60 = 4, 60-92 = 5.","1dfd6aec":"What are the names of the numeric variables?","e9fd162c":"# **LightGBM**","0d8ee625":"**HasCrCard**","4da2b44c":"**Model**","202877df":"Label encoding was applied to geography categorical variables.","afe1e7aa":"**Validation error, accuracy score, confusion matrix**","945e7942":"**Drop Feature**","5925b0e1":"# **Objective**","d9f63705":"It is assumed that the ratio of customers' salaries to credit scores is related to whether they leave the bank or not.\n","d77551b0":"This dataset  is obtained from www.kaglle.com. The sample size is 10.000.  In this dataset,\nthere is one dependent variable (Exited) and eleven independent or predicror variables (Surname, Gender, \nCreditScore , Geography, Age, Tenure , Balance , NumOfProducts , IsActiveMember , HasCrCard, and EstimatedSalary).","998a4d7a":"# 5. ANALYSIS of DEPENDENT VARIABLE (TARGET ANALYSIS)","c4e4e1b4":"Customers in the 18-30 age group leave the bank more than other age groups.","9a4eea5b":"![image.png](attachment:image.png)\nSource: https:\/\/www.analyticsvidhya.com\/","d3f71a66":"Correlation Matrix","e23580d8":"Checking  missing value","dddff29f":"**IsActiveMember**","a855d883":"# 4. ANALYSIS of NUMERICAL VARIABLE","a32121a3":"# 9. MODELING","d729600c":"**Validation error, accuracy score, confusion matrix**","e0e07b5c":"# 6. ANALYSIS of NUMERICAL VARIABLE","d5662eb4":"**List of Variable**\n\"\"\"'RowNumber', 'CustomerId', 'Surname', 'CreditScore', 'Geography',\n       'Gender', 'Age', 'Tenure', 'Balance', 'NumOfProducts', 'HasCrCard',\n       'IsActiveMember', 'EstimatedSalary', 'Exited' \"\"\"","f5f439be":"**Visualization of numeric variables**","bc75291c":"# 1. IMPORT SOME NECESSARY LIBRARIES","1f52a329":"**Model**","b142e810":"Correlation of variables with Heatmap","e05dc548":"It is assumed that age-related duration with bank is related to whether they leave the bank or not.\n","5a44c216":"**Number of Products**","91b6a855":"# **Random Forest**","91da7da5":"As seen from the values above, there is an imbalance between the classes of the dependent variable.\"","73a06381":"There is no multicollinearity among the independent variables.","18a431da":"Finding the number of values in the target column","d5f3d34a":"Germans are more likely to leave from the bank than other nations.","6edce953":"**Validation error, accuracy score, confusion matrix**","bcb42aac":"The pairplot is visualized by using the seaborn library. Each variable has been compared with another variable.","06fd392f":"# 7. DATA PREPROCESSING & FEATURE ENGINEERING","8142152e":"**List of Categorical Variable**\n\"\"\"'Surname', 'Gender', 'Geography', 'Gender', 'NumOfProducts', 'HasCrCard', 'IsActiveMember', 'Exited'\"\"\"","c955e932":"The primary aim of this study is to predict accurately whether or not the customer left the bank  based on\nthe dataset.  In this context, I will try to develop a machine learning model that can predict customers \nwho will leave the company.","cc545e40":"In this section, first of all, categorical variables should be determined.\nWhich variables in the data set are categorical?\"","23659a10":"The description of  variables in this data as follows:","a690114e":"# **CART**","1413b027":"**Model**","a0e4ed1e":"Female customers are more likely to leave the bank than male.","881a06fe":"Robust Scaler uygulayaca\u011f\u0131m de\u011fi\u015fkenleri se\u00e7tim.","e6da3b1f":"# **LGBM**"}}