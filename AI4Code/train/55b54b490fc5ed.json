{"cell_type":{"fa572b43":"code","06b39487":"code","981842ee":"code","5c523ece":"code","dee0d606":"code","29140638":"code","796c6c63":"code","00529f2f":"code","a498ba7d":"code","adad43c5":"code","0972c565":"code","e4384a1a":"code","30dacfc4":"code","5ce87e8a":"code","eabdca88":"code","0e77e911":"code","d2fcaf8c":"code","822df8f1":"code","9ae13052":"code","d8b336b0":"code","7e0e68c9":"code","f0575437":"markdown","96e0c067":"markdown","d7c61665":"markdown","e1109471":"markdown","c3f23d40":"markdown","eca3593a":"markdown","74bccdf3":"markdown"},"source":{"fa572b43":"import pandas as pd\nfrom bs4 import BeautifulSoup\nimport numpy as np\nimport requests\n!pip install geocoder\nimport geocoder # import geocoder","06b39487":"linkpost= \"https:\/\/en.wikipedia.org\/w\/index.php?title=List_of_postal_codes_of_Canada:_M&direction=prev&oldid=926287641%20%20%20Me%20gusta%203%20%20Responder%203%20%20M%C3%A1s\"","981842ee":"page = requests.get(linkpost)\nsoup = BeautifulSoup(page.content, 'html.parser')\n\ntable_contents=[]\ntable=soup.find('table')\nfor row in table.findAll('td'):\n    cell = {}\n    if row.span.text=='Not assigned':\n        pass\n    else:\n        cell['PostalCode'] = row.p.text[:3]\n        cell['Borough'] = (row.span.text).split('(')[0]\n        cell['Neighborhood'] = (((((row.span.text).split('(')[1]).strip(')')).replace(' \/',',')).replace(')',' ')).strip(' ')\n        table_contents.append(cell)\n\n# print(table_contents)\ndf=pd.DataFrame(table_contents)\ndf['Borough']=df['Borough'].replace({'Downtown TorontoStn A PO Boxes25 The Esplanade':'Downtown Toronto Stn A',\n                                             'East TorontoBusiness reply mail Processing Centre969 Eastern':'East Toronto Business',\n                                             'EtobicokeNorthwest':'Etobicoke Northwest','East YorkEast Toronto':'East York\/East Toronto',\n                                             'MississaugaCanada Post Gateway Processing Centre':'Mississauga'})","5c523ece":"df","dee0d606":"df.shape","29140638":"geo_url = \"https:\/\/cocl.us\/Geospatial_data\"\n\ngeo_df = pd.read_csv(geo_url)\ngeo_df.rename(columns={'Postal Code': 'PostalCode'}, inplace=True)\ngeo_df.head()","796c6c63":"# Merging the Data\ndf = pd.merge(df, geo_df, on='PostalCode')\ndf.head()","00529f2f":"# lets find out how many neighborhoods present in each borough\ndf.groupby('Borough').count()['Neighborhood']","a498ba7d":"df_toronto = df\ndf_toronto.head()","adad43c5":"# Create a list and store all unique borough names\nboroughs = df_toronto['Borough'].unique().tolist()","0972c565":"# Obtain the Latitude and Longitude of Toronto by taking mean of Latitude\/Longitude of all postal code\nlat_toronto = df_toronto['Latitude'].mean()\nlon_toronto = df_toronto['Longitude'].mean()\nprint('The geographical coordinates of Toronto are {}, {}'.format(lat_toronto, lon_toronto))","e4384a1a":"# This will color categorize each borough\nborough_color = {}\nfor borough in boroughs:\n    borough_color[borough]= '#%02X%02X%02X' % tuple(np.random.choice(range(256), size=3)) #Random color","30dacfc4":"import folium","5ce87e8a":"map_toronto = folium.Map(location=[lat_toronto, lon_toronto], zoom_start=10.5)\n\n# add markers to map\nfor lat, lng, borough, neighborhood in zip(df_toronto['Latitude'], \n                                           df_toronto['Longitude'],\n                                           df_toronto['Borough'], \n                                           df_toronto['Neighborhood']):\n    label_text = borough + ' - ' + neighborhood\n    label = folium.Popup(label_text)\n    folium.CircleMarker(\n        [lat, lng],\n        radius=5,\n        popup=label,\n        color=borough_color[borough],\n        fill_color=borough_color[borough],\n        fill_opacity=0.8).add_to(map_toronto)  \n    \nmap_toronto","eabdca88":"df_toronto","0e77e911":"# drop \"Neighborhood\" column from the dataframe\n\nX = df_toronto.drop(['PostalCode','Borough','Neighborhood'], axis=1)","d2fcaf8c":"# Matplotlib and associated plotting modules\nimport matplotlib.cm as cm\nimport matplotlib.colors as colors\nimport matplotlib.pyplot as plt \n\n# import k-means from clustering stage\nfrom sklearn.cluster import KMeans","822df8f1":"# find 'k' value by Elbow Method\nplt.figure(figsize=[10, 8])\ninertia=[]\nrange_val=range(2,20)\nfor i in range_val:\n  kmean=KMeans(n_clusters=i)\n  kmean.fit_predict(X)\n  inertia.append(kmean.inertia_)\nplt.plot(range_val,inertia,'bx-')\nplt.xlabel('Values of K') \nplt.ylabel('Inertia') \nplt.title('The Elbow Method using Inertia') \nplt.show()","9ae13052":"k=4\nkmeans = KMeans(n_clusters = k,random_state=0).fit(X)\nkmeans.labels_\ndf_toronto.insert(0, 'Cluster Labels', kmeans.labels_)","d8b336b0":"df_toronto","7e0e68c9":"# create map\nmap_clusters = folium.Map(location=[43.651070,-79.347015],zoom_start=10)\n\n# set color scheme for the clusters\nx = np.arange(k)\nys = [i + x + (i*x)**2 for i in range(k)]\ncolors_array = cm.rainbow(np.linspace(0, 1, len(ys)))\nrainbow = [colors.rgb2hex(i) for i in colors_array]\n\n# add markers to the map\nmarkers_colors = []\nfor lat, lon, neighbourhood, cluster in zip(df_toronto['Latitude'], df_toronto['Longitude'], df_toronto['Neighborhood'], df_toronto['Cluster Labels']):\n    label = folium.Popup(' Cluster ' + str(cluster), parse_html=True)\n    folium.CircleMarker(\n        [lat, lon],\n        radius=5,\n        popup=label,\n        color=rainbow[cluster-1],\n        fill=True,\n        fill_color=rainbow[cluster-1],\n        fill_opacity=0.7).add_to(map_clusters)\n       \nmap_clusters","f0575437":"**Thank you! ******","96e0c067":"Now we will use KMeans Clustering algorithm:","d7c61665":"**For this assignment, we will explore and cluster the neighborhoods in Toronto.**\n\n[Hints for scraping Notebook](https:\/\/cf-courses-data.s3.us.cloud-object-storage.appdomain.cloud\/IBMDeveloperSkillsNetwork-DS0701EN-SkillsNetwork\/labs_v1\/NewLinkWebscrapingHints.md)","e1109471":"**Lets import all the libraries we'll need**","c3f23d40":"It seems the best value for k is 4! ","eca3593a":"***Using requests and Beautiful Soup Libraries let\u00b4s obtain the table with all the postal codes that we requiere. ***","74bccdf3":"Let's import folium library for mapping! "}}