{"cell_type":{"d6fac3cd":"code","5a249363":"code","b2d818e7":"code","c24b53be":"code","3b441f39":"code","73abae82":"code","adc74365":"code","597dcaf3":"code","97093e17":"code","b0352646":"code","e5d68d98":"code","745e6516":"code","cd750044":"code","cbe1e2d8":"markdown","c11dc716":"markdown","4a68acab":"markdown","e2ca8c30":"markdown","c04ad6ac":"markdown","27af575e":"markdown","827ee948":"markdown"},"source":{"d6fac3cd":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","5a249363":"#read in the data dictionary  \ndata_dictionary = pd.ExcelFile('\/kaggle\/input\/us-supply-chain-information-for-covid19\/cfs-2012-pum-file-users-guide-app-a-jun2015.xlsx')\n\n# Print sheet names\n#print(data_dictionary.sheet_names)\n#['Data Dictionary', 'App A1', 'App A2', 'App A3', 'App A4']\n\n#parse app1 and app2 \napp1 = data_dictionary.parse('App A1', skiprows=[0,1], names=['MA', 'State','CFS_AREA','MA_TYPE','MA_Description'])\napp2 = data_dictionary.parse('App A2', skiprows=[0], names=['NAICS', 'NAICS_Description'])\n\n#read in app 3 and fill down file \napp3 = data_dictionary.parse('App A3', skiprows=[0], names=['Commodity_Code', 'Commodity_Description','Commodity_Group'])\napp3['Commodity_Group'] = app3['Commodity_Group'].ffill() #need to fill down the page \napp3['Commodity_Code'] = app3['Commodity_Code'].apply(lambda x: str(x))\n\n#app3 needs to be constructed from scratch \n# initialize list of lists \ndata = [['02', 'Single Mode'], \n        ['03', 'Truck'],\n        ['04', 'For-hire Truck'],\n        ['05', 'Private Truck'],\n        ['06', 'Rail'],\n        ['07', 'Water'],\n        ['08', 'Inland Water'],\n        ['09', 'Great Lakes'],\n        ['10', 'Deep Sea'],\n        ['101', 'Multiple Waterways'],\n        ['11', 'Air'],\n        ['12', 'Pipeline'],\n        ['13', 'Multiple Mode'],\n        ['14', 'Parcel-USPS-Courier'],\n        ['20', 'Non-parcel multimode'],\n        ['15', 'Truck and Rail'],\n        ['16', 'Truck and Water'],\n        ['17', 'Rail and Water'],\n        ['18', 'Other Multiple Mode'],\n        ['09', 'Other Mode'],\n        ['00', 'Mode Suppressed']] \n  \n# Create the pandas DataFrame \napp4 = pd.DataFrame(data, columns = ['Mode_Code', 'Mode_Description'])\napp3.head(20)\n\n\n\n","b2d818e7":"#read in the state names data for short hand reference if needed\nstates = pd.read_csv('\/kaggle\/input\/us-supply-chain-information-for-covid19\/state_code_to_name.csv')\nstates.head()","c24b53be":"#read in the flat file for commodity flow survey \ncfs = pd.read_csv('\/kaggle\/input\/us-supply-chain-information-for-covid19\/cfs-2012-pumf-csv\/cfs_2012_pumf_csv.txt')\ncfs.head()","3b441f39":"#reduce size of data base \ncfs=cfs[['ORIG_STATE','DEST_STATE','SCTG','SHIPMT_VALUE']]\n\ncfs.head()","73abae82":"#cfs=cfs[(cfs['SCTG']=='21') | (cfs['SCTG']=='38')]\n#cfs.shape","adc74365":"#get shape of cfs\n#cfs_recode = pd.concat([cfs, states], axis=1, join='left')\n\n#recode orig state \ncfs = pd.merge(cfs, states, how='left',left_on='ORIG_STATE', right_on='StateCode')\ncfs = cfs.rename(columns = {\"StateName\":\"ORIG_STATE_NAME\"}) \ndel cfs['StateCode']\ndel cfs['ORIG_STATE']\n\ncfs.head()","597dcaf3":"#recode dest_state\ncfs = pd.merge(cfs, states, how='left',left_on='DEST_STATE', right_on='StateCode')\ncfs = cfs.rename(columns = {\"StateName\":\"DEST_STATE_NAME\"}) \ndel cfs['StateCode']\ndel cfs['DEST_STATE']\n\ncfs.head()","97093e17":"#recode sctg code \ncfs = pd.merge(cfs, app3, how='left',left_on='SCTG', right_on='Commodity_Code')\n#cfs = cfs.rename(columns = {\"MA_Description\":\"ORIG_MA_Description\"}) \ndel cfs['SCTG']\ndel cfs['Commodity_Code']\ndel cfs['Commodity_Group']\n\ncfs.head()","b0352646":"import matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set()\nf, ax = plt.subplots(figsize=(15, 10))\nlocs, labels = plt.xticks()\nplt.setp(labels, rotation=90)\nsns.boxplot('Commodity_Description', 'SHIPMT_VALUE', data=cfs)\n","e5d68d98":"cfs=cfs[(cfs['Commodity_Description']=='Pharmaceutical Products') | (cfs['Commodity_Description']=='Precision Instruments and Apparatus')]\ncfs.head()","745e6516":"sns.set()\nf, ax = plt.subplots(figsize=(15, 10))\nlocs, labels = plt.xticks()\nplt.setp(labels, rotation=90)\nsns.boxplot('ORIG_STATE_NAME', 'SHIPMT_VALUE', data=cfs)","cd750044":"#cfs.pivot(\"ORIG_STATE_NAME\",\"DEST_STATE_NAME\",\"SHIPMT_VALUE\")\ncfs_nonzero = cfs[cfs.SHIPMT_VALUE>0]\ncfs_state=cfs_nonzero.pivot_table(index='ORIG_STATE_NAME', \n                        columns='DEST_STATE_NAME', \n                        values='SHIPMT_VALUE')\n\nf, ax = plt.subplots(figsize=(20, 15))\nsns.heatmap(cfs_state, linewidths=1, ax=ax)","cbe1e2d8":"For this exercise well focus on Pharmaceuticals and Precision Instruments","c11dc716":"#cfs.shape #(4547661, 20) \n\nThis file is 4,547,661 rows by 20 columns. In the example of COVID19 perhaps we are most interested in states with shutdown orders and total values\/types of flow. We can also try to subset on specific cities as a destination or we could try and focus on specific commdoity codes. Codes 21 + 38 are related to medical products that might be of interest","4a68acab":"# Recode CFS Data","e2ca8c30":"# Read in Data\nRead in data dictionary for recoding data, read in main commodity flow file and also read in a state name variable ","c04ad6ac":"# Visualize ","27af575e":"# Libraries and Packages","827ee948":"The data dictionary files are used to recode the commodity flow survey data "}}