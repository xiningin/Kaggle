{"cell_type":{"5ae6393b":"code","ca410495":"code","d6a236ce":"code","451a410c":"code","45968a0e":"code","53881ba2":"code","35a1f91b":"code","91e6c58c":"code","cacf3663":"code","6f11d793":"code","87cfcedc":"code","e91b3048":"code","a863aefc":"code","c100b55a":"code","b82dd302":"code","2ba4ad6b":"code","262196de":"code","c7d633c5":"code","3eec7ac5":"code","d6df3114":"code","610653ab":"code","5c8d05cf":"code","dc3fb549":"code","9e78e588":"code","4aa2d27b":"code","f9a43fbf":"code","b1e22d3f":"code","8497c51b":"code","8865908f":"markdown","f15a3fe5":"markdown","becbcb56":"markdown","d3df0521":"markdown","e74f86d5":"markdown","9927baed":"markdown","9e804272":"markdown","2f8412b7":"markdown","4fca433c":"markdown","b5349db3":"markdown","17fc7d3c":"markdown","6d18da30":"markdown","09efffb8":"markdown","7234747e":"markdown","cb3b86d2":"markdown","9e2736b8":"markdown","8b4951ea":"markdown","0b9f63ee":"markdown","e9f8c532":"markdown","2093cc1e":"markdown"},"source":{"5ae6393b":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn import tree\n%matplotlib inline\nfrom sklearn.ensemble import RandomForestClassifier\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","ca410495":"df = pd.read_csv(\"\/kaggle\/input\/heart-disease-uci\/heart.csv\")","d6a236ce":"df","451a410c":"fig, ax =plt.subplots(1, 2, figsize=(18, 7))\nsns.countplot(data=df, x=df.sex.replace([0, 1], ['Female', 'Male']), ax=ax[0])\nage_df = df.groupby('sex', as_index=False).agg({'age': 'count'}).rename(columns={'age': 'number'})\nplt.pie(age_df.number, labels=['Female', 'Male'], colors=['C1', 'C0'], wedgeprops={'edgecolor': 'black'})","45968a0e":"ax = sns.catplot(data=df, x=df.target.replace([1, 0], ['Has Disease', 'Healthy']), kind='count')\nax.set(xlabel='Has Desiase', ylabel='Number of people')","53881ba2":"fig, ax =plt.subplots(2, 2, figsize=(18, 10))\nsns.histplot(data=df, x='age', kde=True, ax=ax[0, 0])\nsns.countplot(data=df, x='cp', ax=ax[0, 1])\nax[0, 1].set_xlabel('Chest pain')\nsns.histplot(data=df, x='trestbps', kde=True, ax=ax[1, 0])\nax[1, 0].set_xlabel('Resting Blood Pressure')\nsns.histplot(data=df, x='thalach', kde=True,ax=ax[1, 1])\nax[1, 1].set(xlabel='Max Heart Rate')","35a1f91b":"fig, ax =plt.subplots(1, 2, figsize=(16, 7))\nsns.countplot(data=df, x='slope', ax=ax[0])\nsns.countplot(data=df, x='exang', ax=ax[1])\nax[1].set_xlabel('Exercise Induced Angina')","91e6c58c":"pd.crosstab(df.age,df.target).plot(kind=\"bar\",figsize=(18, 7))\nplt.title('Heart Disease Frequency grouped by age')\nplt.xlabel('Age')\nplt.ylabel('Desiase Frequency')\nplt.legend([\"Have Disease\", \"Healthy|\"])","cacf3663":"pd.crosstab(df.sex.replace([0, 1], ['Female', 'Male']),df.target).plot(kind=\"bar\",figsize=(10, 5))\nplt.xticks(rotation=0)\nplt.title('Heart Disease Frequency grouped by sex')\nplt.xlabel('Sex')\nplt.ylabel('Desiase Frequency')\nplt.legend([\"Have Disease\", \"Healthy\"])","6f11d793":"X = df.drop(['target'], axis=1)\ny = df['target']","87cfcedc":"from sklearn.model_selection import GridSearchCV","e91b3048":"rf = RandomForestClassifier(criterion='entropy', max_depth=2, min_samples_leaf=5, min_samples_split=17, n_estimators=19, n_jobs=-1)","a863aefc":"params = {'n_estimators': range(2, 20), 'max_depth': range(1, 15), 'min_samples_split': range(2, 20, 3), 'min_samples_leaf': range(2, 20, 3)}","c100b55a":"#gs = GridSearchCV(rf, params, cv=3)\n#gs.fit(X, y)\n#best_clf = gs.best_estimator_\nbest_clf = rf\nbest_clf.fit(X, y)","b82dd302":"from sklearn.metrics import accuracy_score, precision_score, recall_score","2ba4ad6b":"accuracy_score(y, best_clf.predict(X))","262196de":"precision_score(y, best_clf.predict(X))","c7d633c5":"recall_score(y, best_clf.predict(X))","3eec7ac5":"from sklearn.metrics import roc_curve, auc\ny_predict_prob = best_clf.predict_proba(X)\nfpr, tpr, thresholds = roc_curve(y, y_predict_prob[:,1])\nroc_auc= auc(fpr, tpr)\nplt.figure()\nplt.plot(fpr, tpr, color='darkorange', label='ROC curve (area = %0.2f)' % roc_auc)\nplt.plot([0, 1], [0, 1], color='navy', linestyle='--')\nplt.xlim([0.0, 1.0])\nplt.ylim([0.0, 1.05])\nplt.xlabel('False Positive Rate')\nplt.ylabel('True Positive Rate')\nplt.title('Receiver operating characteristic')\nplt.legend(loc=\"lower right\")\nplt.show()","d6df3114":"X['disease_chance'] = best_clf.predict_proba(X)[:, 1]","610653ab":"X['disease_chance'] = round(X['disease_chance'] * 100, 2)","5c8d05cf":"X['disease_chance'] = X.disease_chance.astype(str) + '%'","dc3fb549":"X['sex'] = X.sex.replace([0, 1], ['Female', 'Male'])","9e78e588":"X = X.rename(columns={'cp': 'Chest Pain Type', \\\n                  'trestbps': 'Resting blood pressure', \\\n                  'chol': 'Serum cholestoral', \\\n                  'fbs': 'Fasting blood sugar', \\\n                  'restecg': 'Resting electrocardiographic results', \\\n                  'thalach': 'Max heart rate', \\\n                  'exang': 'Exercise induced angina', \\\n                  'oldpeak': 'Oldpeak', \\\n                  'slope': 'Slope', \\\n                  'ca': 'Number of major vessels', \\\n                  'thal': 'Thal', 'disease_chance': 'Disease chance'})","4aa2d27b":"X['Serum cholestoral'] = X['Serum cholestoral'].astype(str) + '(mg\/dl)'","f9a43fbf":"X['Exercise induced angina'] = X['Exercise induced angina'].replace([0, 1], ['No', 'Yes'])","b1e22d3f":"X","8497c51b":"#X.to_csv('Predictions.csv')","8865908f":"<font size=10>Making Model<\/font>","f15a3fe5":"<font size=5>Let's extract features to vars X and y<\/font>","becbcb56":"<font size=8>Note, GridSearchCV is quite long, so I will create model using params that GridSearch Gave me in my local notebook<\/font>","d3df0521":"<font size=10>Thanks for the attention, if you have suggestions provide them in comments :)<\/font>","e74f86d5":"<font size=6>Also lets look at ROC curve<\/font>","9927baed":"<font size = 10>Here will be visualization of most interesting features (as for me)<\/font>","9e804272":"<font size=10>Let's look for best params at Grid Search<\/font>","2f8412b7":"<font size=6>Final look at data set<\/font>","4fca433c":"<font size=5>Lets see distribution of desiase by age<\/font>","b5349db3":"<font size=5>In some discussions of this data set people say that 0 is disease, but someone says the opposite, in my code and visualization I'll assume 1 as desiase and 0 as healthy<\/font>","17fc7d3c":"<font size=6>0.93 AUC means model is very good, but if we increased values at parameters of GridSearch we could achieve better results, but also it will cost more time to wait for grid search to complete<\/font>","6d18da30":"<font size=6>Metrics Time<\/font>","09efffb8":"<font size=10>Creating Final Data Set of our predictions<\/font>","7234747e":"<font size=6>As predict_proba is 2D array, we will put values from secind column, which stands for predictions of target = 1(Which in my case id disease)<\/font>","cb3b86d2":"<font size=5>And by sex too<\/font>","9e2736b8":"<font size=6>Some process of beautyfying our Data Set<\/font>","8b4951ea":"<font size=10>Lets read and look at data set first<\/font>","0b9f63ee":"<font size=6>Having High recall is very important for diagnosing desiases, because we don't care about False Positives, but we care about False Negatives, cuz of them patient might die :(<\/font>","e9f8c532":"<font size= 7>Commented code is the code that I've run in my local notebook to get the best classifier<\/font>","2093cc1e":"<font size=6>Finally save data set, and now we can send it somewhere<\/font>"}}