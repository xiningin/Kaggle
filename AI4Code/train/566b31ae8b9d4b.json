{"cell_type":{"e6a09182":"code","06b0177c":"code","e2db5630":"code","e6e7bd50":"code","671d8aaf":"code","ae053d77":"code","2ecb887e":"code","4369e939":"code","61195398":"code","6ed9e63f":"code","bc6b0e07":"code","1d50d0b0":"code","3de37178":"code","87257331":"code","df2d7155":"code","76e1c1fe":"code","1ddb230b":"code","ec1a658f":"code","50479b04":"code","92af7a88":"code","a308ec1e":"code","a93645e8":"code","26334029":"code","9ce109ea":"code","e4c3824f":"code","8fcfeeac":"code","ba2374b3":"code","cd3f14e6":"code","f2c75ecf":"code","8b53aeca":"markdown","3ca0758b":"markdown","8f7fd715":"markdown","909448f9":"markdown","905a7376":"markdown","ce0e6ae2":"markdown","42322cac":"markdown","03fcd21b":"markdown","1b9c4994":"markdown","80eea41c":"markdown","e7c183e0":"markdown"},"source":{"e6a09182":"import numpy as np \nimport pandas as pd \nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly\nimport re\nimport plotly.express as px\nimport plotly.graph_objects as go\nplt.style.use('ggplot')","06b0177c":"reviews = pd.read_csv('..\/input\/company-reviews\/company_reviews.csv')\nreviews.head()","e2db5630":"# data type\nreviews.dtypes.value_counts().plot(kind='pie');","e6e7bd50":"# percentage of missing values\nreviews.isna().mean().sort_values().plot(kind='barh', color='tab:blue');","671d8aaf":"# Distribution of Companies based on Reveneu\nreviews['revenue'].value_counts().plot(kind='barh');","ae053d77":"reviews['industry'].value_counts().tail(10)","2ecb887e":"reviews['industry'] = reviews['industry'].str.replace('\\n.*', '', flags=re.DOTALL)\nreviews['industry'] = reviews['industry'].replace({'Health Care': 'Healthcare', 'Construction': 'Construction & Facilities Services',\n                                                  'Retail': 'Retail & Wholesale', 'Education and Schools': 'Education',\n                                                  'Industrial Manufacturing': 'Manufacturing', 'Auto': 'Automotive', \n                                                   'Transport and Freight': 'Transportation & Logistics', 'Organization': 'Nonprofit & NGO',\n                                                  'Pharmaceuticals': 'Pharmaceutical & Biotechnology', 'Human Resources and Staffing': 'Human Resources & Staffing',\n                                                  'Internet and Software': 'Information Technology', 'Agriculture': 'Agriculture and Extraction'})","4369e939":"# Distribution of Companies based on Industry - Top 20\nreviews['industry'].value_counts().plot(kind='bar', figsize=(14,5));","61195398":"# Clean-up CEO related columns\nreviews['ceo_approval'] = reviews['ceo_approval'].str.replace('%', '').astype(float)\nreviews['ceo_count'] = reviews['ceo_count'].str.replace(',', '').str.extract('(\\d+)').astype(float)","6ed9e63f":"# Distribution of ceo_count and ceo_approval\nplt.figure(figsize=(12,4))\nplt.subplot(1,2,1)\n# since ceo_count has large variation, we plot it in log-scale\nsns.kdeplot(np.log10(reviews['ceo_count']), shade=True)\nplt.subplot(1,2,2)\nsns.kdeplot(reviews['ceo_approval'], shade=True, color='tab:blue');","bc6b0e07":"# Boxplot of CEO approval vs. Industry\nplt.figure(figsize=(16,5))\norder = reviews.groupby('industry')['ceo_approval'].median().sort_values()\nsns.boxenplot(x='industry', y='ceo_approval', data=reviews, order=order.index)\nplt.xticks(rotation=90);","1d50d0b0":"reviews['reviews'] = reviews['reviews'].str.replace(',', '').str.extract('(\\d+)').astype(float)","3de37178":"plt.figure(figsize=(12,4))\nplt.subplot(1,2,1)\n# since reviews has large variation, we plot it in log-scale\nsns.kdeplot(np.log10(reviews['reviews']), shade=True)\nplt.subplot(1,2,2)\nsns.kdeplot(reviews['rating'], shade=True, color='tab:blue');","87257331":"sns.scatterplot(x='rating', y='ceo_approval', data=reviews, alpha=0.2)\nplt.xlabel('Rating'); plt.ylabel('CEO Approval');","df2d7155":"salaries = pd.DataFrame([(i, key, val) for i, x in enumerate(reviews['salary']) for key, val in eval(x).items()], columns=['index', 'title', 'salary']) \nsalaries.head()","76e1c1fe":"# separate unit and salary \nsalaries[['salary', 'unit']] = salaries['salary'].str.replace(',|\\$', '').str.split(' per ', expand=True)\nsalaries['unit'].value_counts()","1ddb230b":"# Create a new column and onvert all of them to yearly salary\nsalaries['yearly_salary'] = salaries['salary'].astype(float) * salaries['unit'].replace({'hour': 52*40, 'year': 1, 'week': 52, 'month': 12, 'day': 262})\nsalaries.head()","ec1a658f":"# highest and lowest paid jobs\nsalary_title = salaries.groupby('title')['yearly_salary'].mean().sort_values()\npd.concat((salary_title.head(10), salary_title.tail(10))).plot(kind='barh', color='tab:orange', figsize=(6, 6));","50479b04":"# average salary per industry\nindustry_salary = reviews[['rating', 'industry']].join(salaries.set_index('index')).dropna().sort_values('yearly_salary')\nindustry_salary.groupby('industry')['yearly_salary'].mean().sort_values().plot(kind='pie', figsize=(8,8));","92af7a88":"# relationship between salary and company rating\nplt.scatter(industry_salary['rating'], industry_salary['yearly_salary'], alpha=0.2);","a308ec1e":"reviews['website'].str.split('\\n').explode().value_counts().head(10).plot(kind='bar',  color='tab:blue');","a93645e8":"sns.heatmap(pd.crosstab(reviews['interview_experience'],reviews['interview_difficulty'], normalize='columns')*100, annot=True, fmt='.1f', vmin=0, vmax=100);","26334029":"# clean up location column\nlocations = pd.DataFrame([(i, key, val) for i, x in enumerate(reviews['locations']) for key, val in eval(x).items()], columns=['index', 'location', 'rating']) \nlocations[['city', 'state']] = locations['location'].str.split(', ', expand=True)\nlocations['rating'] = locations['rating'].astype(float)\nlocations.head()","9ce109ea":"# average company rating per state (looks like US Election Electoral Map :) )\nstate_rating = locations.groupby('state')['rating'].mean().reset_index()\nstate_rating['rating'] = np.where(state_rating['rating'] > 4.4, 4.4, state_rating['rating'])\nfig = go.Figure(data=go.Choropleth(locations=state_rating['state'], z = state_rating['rating'], locationmode = 'USA-states', \n                                    colorscale = 'RdBu', colorbar_title = \"Job Rating\"))\nfig.update_layout(geo_scope='usa')\n\nfig.show()","e4c3824f":"# number of job ratings per state\nlocations.groupby('state').size().sort_values(ascending=False).plot(kind='bar', figsize=(16,4), color='tab:green');","8fcfeeac":"# clean up happiness column\nhappiness = pd.DataFrame([(i, key, val) for i, x in enumerate(reviews['happiness']) for key, val in eval(x).items()], columns=['index', 'item', 'rating']) \nhappiness['rating'] = happiness['rating'].astype(float)\nhappiness.head()","ba2374b3":"# happiness score based on industry\nindustry_happiness = reviews[['industry']].join(happiness.set_index('index')).dropna()\nsort_index = industry_happiness.groupby('industry')['rating'].mean().sort_values().index\nindustry_happiness.groupby(['industry', 'item'])['rating'].mean().sort_values().unstack().loc[sort_index,:].plot(kind='barh', stacked=True, figsize=(12,8));","cd3f14e6":"# company overall rating vs employee happiness\nrating_happiness = reviews[['rating']].join(happiness.query('item == \"Work Happiness Score\"').set_index('index')[['rating']].rename(columns={'rating': 'happiness'})).dropna()\nplt.figure(figsize=(8,6))\nsns.regplot(x='rating', y='happiness', data=rating_happiness, scatter_kws={'alpha':0.3}, color='tab:green' );","f2c75ecf":"# least and most happiest titles\ntitle_happiness = salaries.set_index('index')[['title']].join(happiness.query('item == \"Work Happiness Score\"').set_index('index')[['rating']].rename(columns={'rating': 'happiness'})).dropna()\ntitle_happiness.groupby('title').filter(lambda x: x.shape[0] > 20).groupby('title')['happiness'].mean().sort_values().plot(kind='bar', figsize=(26, 8), color='tab:blue');","8b53aeca":"## Salaries","3ca0758b":"## CEO Approval","8f7fd715":"## Data Summary","909448f9":"## Happiness","905a7376":"## Revenue","ce0e6ae2":"## Industry\nThere are many industry categories which has few observations so we need to combine them with their other categories. For example, we need to combine 'Energy, Mining & Utilities\\nFinancial Services' which has 1 observation as shown belo**w with 'Energy, Mining & Utilities' which has 319 observations :","42322cac":"## Locations","03fcd21b":"## Load Data","1b9c4994":"## Interview","80eea41c":"## Social Media Page","e7c183e0":"## Reviews"}}