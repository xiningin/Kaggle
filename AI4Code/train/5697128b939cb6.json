{"cell_type":{"7761aa4e":"code","b3dc3c26":"code","7d455e22":"code","f76ca675":"code","f1d02ec5":"code","cdf4fe3e":"code","57f34b6a":"code","61eb8381":"code","2c0c9843":"code","367128d2":"code","8490968a":"code","5da8376b":"code","048d4934":"code","6673d932":"code","01312f87":"code","272b3ba8":"code","20108f9a":"code","f3991a7a":"code","e10448d2":"code","0d09b69a":"code","207924f9":"code","74d83934":"code","8e734a35":"code","e492aef4":"code","645da550":"code","03df95bd":"markdown","49cffde6":"markdown","e2348508":"markdown","80863ba1":"markdown","9be6bd33":"markdown","44a13859":"markdown","022a6dcf":"markdown","5f349e50":"markdown","9e7905ef":"markdown","c8e3b0a7":"markdown"},"source":{"7761aa4e":"import pandas as pd\nimport pandas_profiling\nimport numpy as np\nimport missingno as msno\nimport matplotlib.pyplot as plt\nimport matplotlib.dates as mdates\nimport matplotlib.ticker as mticker\nfrom math import pi\nimport seaborn as sns\nfrom scipy.ndimage.filters import gaussian_filter1d\nfrom datetime import datetime\nfrom plotly.offline import init_notebook_mode,iplot\ninit_notebook_mode(connected=True)\npd.set_option('display.max_columns', None)\npd.options.mode.chained_assignment = None\n# plt.rcParams['axes.facecolor'] = 'white'\n# plt.rcParams['figure.facecolor'] = 'white'\n\n\ndef merge_fut_datasets(dataset_type, first_version, last_version):\n    merged_df = pd.DataFrame()\n    for fifa_version in range(first_version, last_version + 1): # upper bound excluded from range\n        if dataset_type == 'players':\n            df = pd.read_csv('\/kaggle\/input\/fut-22-fifa-ultimate-team-players-and-prices\/players_' + str(fifa_version) + '.csv',\n                             encoding='UTF-8', low_memory = False)\n            df['fifa_version'] = int(fifa_version)\n            new_cols_order = ['fifa_version'] + df.columns.to_list()[:-5] # removing picture URLs\n            df = df[new_cols_order]\n        elif dataset_type == 'prices':\n            df = pd.read_csv('\/kaggle\/input\/fut-22-fifa-ultimate-team-players-and-prices\/prices_' + str(fifa_version) + '.csv',\n                             encoding='UTF-8', low_memory = False)\n            df['date'] = pd.to_datetime(df['date'])\n        merged_df = merged_df.append(df)\n    return merged_df\n\n\nplayers_df = merge_fut_datasets('players', 15, 22)\nprint(len(players_df))\nplayers_df.sort_values(by=['fifa_version', 'resource_id'], ascending=[True, True], inplace=True)\nplayers_df.head(5)","b3dc3c26":"prices_df = merge_fut_datasets('prices', 16, 22)\nprint(len(prices_df))\nprices_df.head(5)","7d455e22":"null_values_series = players_df.isnull().sum().where(lambda x : x > 0).dropna().astype('Int32')\nprint(null_values_series.to_string()) # to_string() removes the name and dtype from the output\nmsno.matrix(players_df[null_values_series.index.tolist()], figsize=(15, 8));","f76ca675":"# setting the columns that will be used in the radar charts\nfiltered_cols_dict = {'pace': 'Pace', 'dribbling': 'Dribble', 'shooting': 'Shoot', 'passing': 'Pass', 'defending': 'Defend',\n                      'physicality': 'Physic', 'pace_acceleration': 'Accel', 'pace_sprint_speed': 'Sprint',\n                      'physicality_jumping': 'Jump', 'physicality_stamina': 'Stamina', 'physicality_strength': 'Strength',\n                      'physicality_aggression': 'Aggress', 'dribbling_agility': 'Agility', 'dribbling_balance': 'Balance',\n                      'dribbling_reactions': 'React', 'dribbling_ball_control': 'BallCtr', 'dribbling_dribbling': 'Dribbl',\n                      'dribbling_composure': 'Compos', 'shooting_positioning': 'Posit', 'shooting_finishing': 'Finish',\n                      'shooting_shot_power': 'ShotPwr', 'shooting_long_shots': 'LngShot', 'shooting_volleys': 'Volleys',\n                      'shooting_penalties': 'Penalty'}\nattribute_cols = ['Pace', 'Dribbl', 'Shoot', 'Pass', 'Defend', 'Physic']\nphysical_cols = ['Accel', 'Sprint', 'Jump', 'Stamina', 'Strength', 'Aggress']\ndribbling_cols = ['Agility', 'Balance', 'React', 'BallCtr', 'Dribbl', 'Compos']\nshooting_cols = ['Posit', 'Finish', 'ShotPwr', 'LngShot', 'Volleys', 'Penalty']\n\n\n# NEED TO FIND HOW THE ORDER (AND THE RELATED COLORS) ARE SET IN THE RADAR CHART\n# THE MIDFIELDERS COMPARISON SHOWS SOMETHING WRONG - CASEMIRO IS NOT BETTER THAN DE BRUYNE AT SHOOTING\n\n\ndef plot_players_radar_charts(resource_ids_list, first_version, last_version):\n    filtered_players = players_df.copy(deep=True)\n    filtered_players = filtered_players[filtered_players['resource_id'].isin(resource_ids_list)].sort_values(by='resource_id')\n    filtered_players['player_name'] = [x if x is not np.nan else y\n                                       for x, y in zip(filtered_players['short_name'], filtered_players['long_name'])]\n    # ensuring each resource_id has only one player name for all FIFA versions\n    player_names_dict = filtered_players[filtered_players['fifa_version'] == filtered_players['fifa_version'].max()][\n        ['resource_id', 'player_name']].set_index('resource_id').T.to_dict('records')[0]\n    filtered_players['player_name'] = [player_names_dict[x] for x in filtered_players['resource_id']]\n    filtered_players = filtered_players[['fifa_version', 'player_name'] + list(filtered_cols_dict.keys())]\n    filtered_players.rename(columns=filtered_cols_dict, inplace=True)\n    # starting to iterate for each fifa_version and radar chart\n    plt.figure(figsize=(20, 12))\n    if len(resource_ids_list) >= 2:\n        plt.figtext(0.1, 0.96, player_names_dict[resource_ids_list[0]], color='C0', size=15)\n        plt.figtext(0.1, 0.93, player_names_dict[resource_ids_list[1]], color='C1', size=15)\n    elif len(resource_ids_list) < 2 or len(resource_ids_list) > 5:\n        raise ValueError('Invalid length of the \"resource_ids_list\" list')\n    if len(resource_ids_list) >= 3:\n        plt.figtext(0.1, 0.9, player_names_dict[resource_ids_list[2]], color='C2', size=15)\n    if len(resource_ids_list) >= 4:\n        plt.figtext(0.1, 0.87, player_names_dict[resource_ids_list[3]], color='C3', size=15)\n    if len(resource_ids_list) == 5:\n        plt.figtext(0.1, 0.84, player_names_dict[resource_ids_list[4]], color='C4', size=15)\n    subplot_index = 1 # starting from 1 and adding 1 at each iteration\n    for i in range(4): # four radar charts for each FIFA version (attributes, physical, dribbling, shooting)\n        # find the appropriate columns to show in radar chart\n        if i == 0:\n            radar_cols = attribute_cols\n        if i == 1:\n            radar_cols = physical_cols\n        if i == 2:\n            radar_cols = dribbling_cols\n        if i == 3:\n            radar_cols = shooting_cols\n        total_fifa_versions = last_version - first_version + 1\n        for version_enum, fifa_version in enumerate(range(first_version, last_version + 1)):\n            # removing the field 'fifa_version' for each iteration\n            reporting_df = filtered_players[filtered_players['fifa_version'] == fifa_version].set_index(\n                'player_name').drop(columns=['fifa_version'])\n            # getting the plot drawn\n            attributes = list(reporting_df[radar_cols])\n            att_no = len(radar_cols)\n            # adding again for values and angles the first value to close the circle in the radar chart\n            angles = [n \/ float(att_no) * 2 * pi for n in range(att_no)] + [[n \/ float(att_no) * 2 * pi for n in range(att_no)][0]]\n            values1 = reporting_df[radar_cols].iloc[0].tolist() + [reporting_df[radar_cols].iloc[0].tolist()[0]]\n            values2 = reporting_df[radar_cols].iloc[1].tolist() + [reporting_df[radar_cols].iloc[1].tolist()[0]]\n            if len(resource_ids_list) >= 3:\n                values3 = reporting_df[radar_cols].iloc[2].tolist() + [reporting_df[radar_cols].iloc[2].tolist()[0]]\n            if len(resource_ids_list) >= 4:\n                values4 = reporting_df[radar_cols].iloc[3].tolist() + [reporting_df[radar_cols].iloc[3].tolist()[0]]\n            if len(resource_ids_list) == 5:\n                values5 = reporting_df[radar_cols].iloc[4].tolist() + [reporting_df[radar_cols].iloc[4].tolist()[0]]\n            ax = plt.subplot(4, total_fifa_versions, subplot_index, polar=True)\n            ax.tick_params(axis='both', which='both', pad=0)\n            subplot_index += 1\n            plt.xticks(angles[:-1], attributes, color='grey', size=10)\n            plt.yticks([25,50,75], ['25','50','75'], color='grey', size=8)\n            plt.ylim(0,100)\n            plt.subplots_adjust(hspace=0.2)\n            ax.plot(angles, values1, linewidth=1, linestyle='solid')\n            ax.fill(angles, values1, 'C0', alpha=0.1)\n            ax.plot(angles, values2, linewidth=1, linestyle='solid')\n            ax.fill(angles, values2, 'C1', alpha=0.1)\n            if len(resource_ids_list) >= 3:\n                ax.plot(angles, values3, linewidth=1, linestyle='solid')\n                ax.fill(angles, values3, 'C2', alpha=0.1)\n            if len(resource_ids_list) >= 4:\n                ax.plot(angles, values4, linewidth=1, linestyle='solid')\n                ax.fill(angles, values4, 'C3', alpha=0.1)\n            if len(resource_ids_list) == 5:\n                ax.plot(angles, values5, linewidth=1, linestyle='solid')\n                ax.fill(angles, values5, 'C4', alpha=0.1)\n            if i == 0:\n                plt.title('FIFA ' + str(fifa_version), size=12, y=1.1)\n    plt.show()","f1d02ec5":"last_price_date = '2021-11-30'\n\n\ndef filter_prices_by_platform(resource_ids_list, price_value_field):\n    filtered_prices_df = prices_df[(prices_df['resource_id'].isin(resource_ids_list)) &\n                                   (prices_df['date'] <= last_price_date) &\n                                   (prices_df['date'].dt.month != 9) &\n                                   ((prices_df['date'].dt.month != 10) | (prices_df['date'].dt.day >= 15))][\n        ['resource_id' , 'date', price_value_field]]\n    # getting the player short_name from the players_df, so that we can replace the resource_id and display it instead\n    player_names_dict = players_df[(players_df['resource_id'].isin(resource_ids_list)) &\n                               (players_df['fifa_version'] == players_df['fifa_version'].max())][\n        ['resource_id', 'short_name']].set_index('resource_id').T.to_dict('records')[0]\n    filtered_prices_df['player_name'] = [player_names_dict[x] for x in filtered_prices_df['resource_id']]\n    filtered_prices_df = filtered_prices_df.pivot(index='date', columns='player_name', values=price_value_field).reset_index()\n    filtered_prices_df.columns = filtered_prices_df.columns.tolist() # remove 'player_name' from the index name\n    return filtered_prices_df\n\n\ndef get_prices_difference(ps4_df, xbox_df):\n    player_names = ps4_df.columns[1:].to_list()\n    ps4_prices_df = ps4_df.copy(deep=True)\n    ps4_prices_df.columns = ['date'] + [x + ' - PS4' for x in player_names]\n    xbox_prices_df = xbox_df.copy(deep=True)\n    xbox_prices_df.columns = ['date'] + [x + ' - Xbox' for x in player_names]\n    prices_diff_df = ps4_prices_df.merge(xbox_prices_df, on='date')\n    for player_name in player_names:\n        prices_diff_df[player_name] = ((prices_diff_df[player_name + ' - PS4'] \/\n                                        prices_diff_df[player_name + ' - Xbox']) - 1) * 100\n    prices_diff_df = prices_diff_df[['date'] + player_names]\n    return prices_diff_df\n\n\ndef plot_players_price_trends(df, smoothing_factor, plot_title, initial_color_index=0):\n    sns.set()\n    sns.set_context('talk')\n    plt.figure(figsize=(20, 12))\n    ax = plt.gca()\n    player_names = df.columns[1:]\n    for i in range(len(player_names)):\n        ax.plot(df['date'], gaussian_filter1d(df[player_names[i]], sigma=smoothing_factor),\n                label=player_names[i], color='C' + str(initial_color_index + i))\n    ax.set_ylabel('Price')\n    ax.set_xlim([df['date'].min(), datetime.strptime(last_price_date, '%Y-%m-%d')])\n    ax.xaxis.set_major_locator(mdates.MonthLocator(interval=3))\n    ax.xaxis.set_major_formatter(mdates.DateFormatter('%Y-%m'))\n    ax.legend()\n    ax.set_title(plot_title)\n    plt.gcf().autofmt_xdate()\n    plt.show()","cdf4fe3e":"# resource_ids = {'Messi': 158023,\n#                 'Ronaldo': 20801}\n\nplot_players_radar_charts(resource_ids_list=[20801, 158023], first_version=18, last_version=22)","57f34b6a":"messi_ronaldo_ps4_prices_df = filter_prices_by_platform(resource_ids_list=[20801, 158023], price_value_field='ps4_price')\nplot_players_price_trends(df=messi_ronaldo_ps4_prices_df, smoothing_factor=2,\n                          plot_title='FIFA 16-22 - Messi vs Ronaldo prices on PS4')","61eb8381":"messi_ronaldo_xbox_prices_df = filter_prices_by_platform(resource_ids_list=[20801, 158023], price_value_field='xbox_price')\nplot_players_price_trends(df=messi_ronaldo_xbox_prices_df, smoothing_factor=2, initial_color_index=6,\n                          plot_title='FIFA 16-22 - Messi vs Ronaldo prices on Xbox')","2c0c9843":"messi_ronaldo_diff_prices_df = get_prices_difference(ps4_df=messi_ronaldo_ps4_prices_df,\n                                                     xbox_df=messi_ronaldo_xbox_prices_df)\nplot_players_price_trends(df=messi_ronaldo_diff_prices_df, smoothing_factor=5, initial_color_index=3,\n                          plot_title='FIFA 16-22 - Messi vs Ronaldo ratio between PS4 and Xbox prices')","367128d2":"# resource_ids = {'Haaland': 239085,\n#                 'Mbappe': 231747}\n\nplot_players_radar_charts(resource_ids_list=[231747, 239085], first_version=18, last_version=22)","8490968a":"haaland_mbappe_ps4_prices_df = filter_prices_by_platform(resource_ids_list=[231747, 239085], price_value_field='ps4_price')\nplot_players_price_trends(df=haaland_mbappe_ps4_prices_df, smoothing_factor=2,\n                          plot_title='FIFA 16-22 - Haaland vs Mbappe prices on PS4')","5da8376b":"haaland_mbappe_xbox_prices_df = filter_prices_by_platform(resource_ids_list=[231747, 239085], price_value_field='xbox_price')\nplot_players_price_trends(df=haaland_mbappe_xbox_prices_df, smoothing_factor=2, initial_color_index=6,\n                          plot_title='FIFA 16-22 - Haaland vs Mbappe prices on Xbox')","048d4934":"haaland_mbappe_diff_prices_df = get_prices_difference(ps4_df=haaland_mbappe_ps4_prices_df,\n                                                      xbox_df=haaland_mbappe_xbox_prices_df)\nplot_players_price_trends(df=haaland_mbappe_diff_prices_df, smoothing_factor=5, initial_color_index=3,\n                          plot_title='FIFA 16-22 - Haaland vs Mbappe ratio between PS4 and Xbox prices')","6673d932":"# resource_ids = {'Firmino': 201942,\n#                 'Mane': 208722,\n#                 'Salah': 209331}\n\nplot_players_radar_charts(resource_ids_list=[201942, 208722, 209331], first_version=18, last_version=22)","01312f87":"liverpool_ps4_prices_df = filter_prices_by_platform(resource_ids_list=[201942, 208722, 209331], price_value_field='ps4_price')\nplot_players_price_trends(df=liverpool_ps4_prices_df, smoothing_factor=2,\n                          plot_title='FIFA 16-22 - Firmino vs Mane vs Salah prices on PS4')","272b3ba8":"liverpool_xbox_prices_df = filter_prices_by_platform(resource_ids_list=[201942, 208722, 209331], price_value_field='xbox_price')\nplot_players_price_trends(df=liverpool_xbox_prices_df, smoothing_factor=2, initial_color_index=6,\n                          plot_title='FIFA 16-22 - Firmino vs Mane vs Salah prices on Xbox')","20108f9a":"liverpool_diff_prices_df = get_prices_difference(ps4_df=liverpool_ps4_prices_df,\n                                                 xbox_df=liverpool_xbox_prices_df)\nplot_players_price_trends(df=liverpool_diff_prices_df, smoothing_factor=5, initial_color_index=3,\n                          plot_title='FIFA 16-22 - Firmino vs Mane vs Salah ratio between PS4 and Xbox prices')","f3991a7a":"# resource_ids = {'Casemiro': 200145,\n#                 'De Bruyne': 192985,\n#                 'Kante': 215914,\n#                 'Kimmich': 212622}\n\n# De Bruyne has a resource_id of 50524633 in FIFA 16, this had to be replaced\nplayers_df.loc[(players_df['resource_id']==50524633) & (players_df['fifa_version']==16), 'resource_id'] = 192985\n\n# plot_players_radar_charts(resource_ids_list=[200145, 192985, 215914, 212622], first_version=18, last_version=22)\nplot_players_radar_charts(resource_ids_list=[192985, 200145, 212622, 215914], first_version=18, last_version=22)","e10448d2":"midfielders_ps4_prices_df = filter_prices_by_platform(resource_ids_list=[192985, 200145, 212622, 215914],\n                                                      price_value_field='ps4_price')\nplot_players_price_trends(df=midfielders_ps4_prices_df, smoothing_factor=2,\n                          plot_title='FIFA 16-22 - Casemiro vs De Bruyne vs Kante vs Kimmich prices on PS4')","0d09b69a":"midfielders_xbox_prices_df = filter_prices_by_platform(resource_ids_list=[192985, 200145, 212622, 215914],\n                                                       price_value_field='xbox_price')\nplot_players_price_trends(df=midfielders_xbox_prices_df, smoothing_factor=2, initial_color_index=6,\n                          plot_title='FIFA 16-22 - Casemiro vs De Bruyne vs Kante vs Kimmich prices on Xbox')","207924f9":"midfielders_diff_prices_df = get_prices_difference(ps4_df=midfielders_ps4_prices_df,\n                                                   xbox_df=midfielders_xbox_prices_df)\nplot_players_price_trends(df=midfielders_diff_prices_df, smoothing_factor=5, initial_color_index=3,\n                          plot_title='FIFA 16-22 - Casemiro vs De Bruyne vs Kante vs Kimmich ratio between PS4 and Xbox prices')","74d83934":"# resource_ids = {'Marquinos': 207865,\n#                 'Ruben Dias': 239818,\n#                 'Sergio Ramos': 155862,\n#                 'Van Dijk': 203376}\n\n# Van Dijk has a resource_id of 50535024 in FIFA 16, this had to be replaced\nplayers_df.loc[(players_df['resource_id']==50535024) & (players_df['fifa_version']==16), 'resource_id'] = 203376\nplot_players_radar_charts(resource_ids_list=[155862, 203376, 207865, 239818], first_version=18, last_version=22)","8e734a35":"defenders_ps4_prices_df = filter_prices_by_platform(resource_ids_list=[155862, 203376, 207865, 239818],\n                                                      price_value_field='ps4_price')\nplot_players_price_trends(df=defenders_ps4_prices_df, smoothing_factor=2,\n                          plot_title='FIFA 16-22 - Marquinos vs Ruben Dias vs Sergio Ramos vs Van Dijk prices on PS4')","e492aef4":"defenders_xbox_prices_df = filter_prices_by_platform(resource_ids_list=[155862, 203376, 207865, 239818],\n                                                       price_value_field='xbox_price')\nplot_players_price_trends(df=defenders_xbox_prices_df, smoothing_factor=2, initial_color_index=6,\n                          plot_title='FIFA 16-22 - Marquinos vs Ruben Dias vs Sergio Ramos vs Van Dijk prices on Xbox')","645da550":"defenders_diff_prices_df = get_prices_difference(ps4_df=defenders_ps4_prices_df,\n                                                 xbox_df=defenders_xbox_prices_df)\nplot_players_price_trends(df=defenders_diff_prices_df, smoothing_factor=5, initial_color_index=3,\n                          plot_title='FIFA 16-22 - Marquinos vs Ruben Dias vs Sergio Ramos vs Van Dijk ratio between PS4 and Xbox prices')","03df95bd":"# <a id='2'>2. Dataset<\/a>","49cffde6":"The purpose of this notebook is to analyse the FUT 22 dataset available at this [Kaggle link](https:\/\/www.kaggle.com\/stefanoleone992\/fut-22-fifa-ultimate-team-players-and-prices), which provide information regarding FIFA Ultimate Team aspects from version 15 to 22 such as players' attributes, club and national information, position ratings, and all their historical daily prices available at https:\/\/www.futbin.com\/.\n\nFor each player comparison, the notebook will show:\n* The radar charts that compare the various player attributes in the latest 5 versions of FIFA (i.e from FUT 18 to FUT 22)\n* The historical prices for all FUT versions (from FUT 16) for PS4 and Xbox\n* The historical ratio between PS4 and Xbox prices","e2348508":"## <a id='32'>3.2. Haaland vs Mbappe<\/a>","80863ba1":"## <a id='35'>3.5. Best defenders in FUT 22<\/a>","9be6bd33":"## <a id='33'>3.3. Liverpool front 3<\/a>","44a13859":"# <a id='3'>3. Player Comparisons<\/a>","022a6dcf":"# <a id='1'>1. Introduction<\/a>","5f349e50":"<center><img src=\"https:\/\/i.imgur.com\/ny381NY.jpg\"><\/center>\n\n<br>\n\n<center><h1>\ud83c\udff7 FIFA 22 Ultimate Team - Player price comparison<\/h1><\/center>\n\n# <a id='0'>Notebook Content<\/a>\n\n### - <a href='#1'>1. Introduction<\/a>\n### - <a href='#2'>2. Dataset<\/a>\n### - <a href='#3'>3. Player Comparisons<\/a>\n#### &ensp; - <a href='#31'>3.1. Messi vs Ronaldo<\/a>\n#### &ensp; - <a href='#32'>3.2. Haaland vs Mbappe<\/a>\n#### &ensp; - <a href='#33'>3.3. Liverpool front 3<\/a>\n#### &ensp; - <a href='#34'>3.4. Best midfielders in FUT 22<\/a>\n#### &ensp; - <a href='#35'>3.5. Best defenders in FUT 22<\/a>","9e7905ef":"## <a id='34'>3.4. Best midfielders in FUT 22<\/a>","c8e3b0a7":"## <a id='31'>3.1. Messi vs Ronaldo<\/a>"}}