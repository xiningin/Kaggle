{"cell_type":{"32180bc8":"code","1f873ed7":"code","108d7c18":"code","e704339b":"code","5b7ec335":"code","63fbfe04":"code","b664cce3":"code","0929c0e9":"code","e1101979":"code","9b749e3a":"code","a6f10bf6":"code","b309f6d3":"code","26f7337a":"code","f0626a68":"code","56eac6bc":"code","50bf5a61":"code","a6686f0c":"code","b3e915ba":"code","9891500a":"code","61f1cf32":"code","e1229c64":"code","fc02199e":"code","f8d930c5":"code","55e94c87":"code","16625e3b":"code","ff884ae4":"code","3cb8b339":"markdown","803cfaf0":"markdown","1626868c":"markdown","823aed21":"markdown","a41fa945":"markdown","dc32bcf3":"markdown","5a283359":"markdown","ce1ac4c0":"markdown","e98aac76":"markdown","d9a56f07":"markdown","6d6c9215":"markdown"},"source":{"32180bc8":"# \u30e9\u30a4\u30d6\u30e9\u30ea\u3092import\u3057\u307e\u3059\nimport numpy as np\nimport pandas as pd\nfrom pandas import DataFrame\n\nfrom sklearn.metrics import roc_auc_score\nfrom sklearn.neighbors import LocalOutlierFactor\nfrom sklearn.ensemble import IsolationForest\nfrom sklearn.preprocessing import MinMaxScaler\nfrom tqdm.notebook import tqdm\nimport librosa\nimport librosa.display\n\nimport IPython\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n# Figure\u306e\u521d\u671f\u5316\nplt.figure(figsize=(12, 8))\n\npd.set_option('display.max_rows', 200)\npd.set_option('display.max_columns', 200)","1f873ed7":"# \u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\ndf_train = pd.read_csv('\/kaggle\/input\/hah-data-science-challenge\/train.csv', index_col=False)\ndf_test = pd.read_csv('\/kaggle\/input\/hah-data-science-challenge\/test.csv', index_col=False)","108d7c18":"# \u884c\u6570\u5217\u6570\u306e\u78ba\u8a8d\nprint('train shape', df_train.shape, 'test shape', df_test.shape)\ndisplay('train', df_train.head())\ndisplay('test', df_test.head())","e704339b":"# Target\u306e\u5206\u5e03\u3092\u78ba\u8a8d\u3059\u308b\n# \u4f55\u3068\u3044\u3046\u3053\u3068\u3067\u3057\u3087\u3046\uff01\u30e9\u30d9\u30eb\u306f\u3054\u304f\u4e00\u90e8\u306b\u3057\u304b\u306a\u304f\u3001\u7279\u306b\u6b63\u4f8b\u306f\u305f\u3063\u305f\u306e\uff12\u884c\u3057\u304b\u3042\u308a\u307e\u305b\u3093\n# 0\u6b63\u5e38\u30e9\u30d9\u30eb\u30001\u7570\u5e38\u30e9\u30d9\u30eb\ndf_train.Target.value_counts(dropna=False)","5b7ec335":"df_labeled = df_train[df_train.Target.isnull()==False]\ndf_labeled_0 = df_train[df_train['Target']==0]\ndf_labeled_1 = df_train[df_train['Target']==1]\ndf_labeled_1.head()","63fbfe04":"filelist1 = ['\/kaggle\/input\/hah-data-science-challenge\/train\/train\/'+f for f in df_labeled.\u30d5\u30a1\u30a4\u30eb.values]\nfilelist2 = filelist2 = ['\/kaggle\/input\/hah-data-science-challenge\/train\/train\/'+f for f in df_labeled.\u30d5\u30a1\u30a4\u30eb.values]\nprint('filelist1', len(filelist1))\nprint('filelist2', len(filelist2))","b664cce3":"# filelist\u3092\u91cd\u306d\u3066\u3044\u308b\u306e\u306f\u7279\u306b\u610f\u5473\u306f\u306a\u3055\u305d\u3046\nfilelist_df = pd.DataFrame(filelist1, columns=['filelist1'])\nfilelist_df['filelist2'] = filelist2\nfilelist_df['TF'] = (filelist_df['filelist1'] == filelist_df['filelist2'])\nfilelist_df[filelist_df['TF']==False]","0929c0e9":"display('\u6b63\u5e38', df_labeled_0.head(2))\ndisplay('\u7570\u5e38', df_labeled_1.head())","e1101979":"# \u6b63\u5e381\nIPython.display.Audio('\/kaggle\/input\/hah-data-science-challenge\/train\/train\/train2.wav')","9b749e3a":"# \u6b63\u5e382\nIPython.display.Audio('\/kaggle\/input\/hah-data-science-challenge\/train\/train\/train31.wav')","a6f10bf6":"# \u7570\u5e381\nIPython.display.Audio('\/kaggle\/input\/hah-data-science-challenge\/train\/train\/train482.wav')","b309f6d3":"# \u7570\u5e382\nIPython.display.Audio('\/kaggle\/input\/hah-data-science-challenge\/train\/train\/train785.wav')","26f7337a":"# filelist_tmp = ['train2.wav', 'train31.wav', 'train482.wav', 'train785.wav',]\n\ny, sr = librosa.core.load('\/kaggle\/input\/hah-data-science-challenge\/train\/train\/train2.wav',sr=None)\ny = (y-y.min())\/(y.max()-y.min()) # \u30b5\u30f3\u30d7\u30eb\u3054\u3068\u306e\u6b63\u898f\u5316\nmfcc = librosa.feature.mfcc(y=y, sr=sr, n_mfcc=20)","f0626a68":"mfcc_df = pd.DataFrame(mfcc)\nprint('mfcc_df', mfcc_df.shape)\nmfcc_df.head()","56eac6bc":"# [python\u306e\u30e9\u30a4\u30d6\u30e9\u30ealibrosa\u306e\u30af\u30ed\u30de\u30b0\u30e9\u30e0\\(chromagram\\)\u3092\u7528\u3044\u305f\u548c\u97f3\u8a8d\u8b58 \\- Qiita](https:\/\/qiita.com\/namaozi\/items\/31ea255ecc6a04320dfc)\ndef librosa_chroma(file, sr=None):\n    file_path = '\/kaggle\/input\/hah-data-science-challenge\/train\/train\/' + file + '.wav'\n\n    # \u8aad\u307f\u8fbc\u307f(sr:\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u30ec\u30fc\u30c8)\n    y, sr = librosa.core.load(file_path, sr=sr)\n    y = (y-y.min())\/(y.max()-y.min()) # \u30b5\u30f3\u30d7\u30eb\u3054\u3068\u306e\u6b63\u898f\u5316\n    # \u8abf\u6ce2\u97f3\u6210\u5206\u3068\u6253\u697d\u5668\u97f3\u6210\u5206\u306b\u5206\u3051\u308b\n    y_harmonic, y_percussive = librosa.effects.hpss(y, margin=3.0)\n\n    # \u30af\u30ed\u30de\u30b0\u30e9\u30e0\u3092\u8a08\u7b97\u3057\u307e\u3059\n    C = librosa.feature.chroma_cens(y=y_harmonic, sr=sr)\n\n    # \u30d7\u30ed\u30c3\u30c8\u3057\u307e\u3059\n    plt.figure(figsize=(12,4))\n    librosa.display.specshow(C, sr=sr, x_axis='time', y_axis='chroma', vmin=0, vmax=1)\n    plt.title('Chromagram ' + file)\n    plt.colorbar()\n    plt.tight_layout()\n    plt.show()\n\n    #return C","50bf5a61":"# \u6b63\u5e381\nlibrosa_chroma('train2')","a6686f0c":"# \u6b63\u5e382\nlibrosa_chroma('train31')","b3e915ba":"# \u7570\u5e381\nlibrosa_chroma('train482')","9891500a":"# \u7570\u5e382\nlibrosa_chroma('train785')","61f1cf32":"# [librosa\u3092\u4f7f\u3063\u3066\u97f3\u697d\u3067\u904a\u3093\u3067\u307f\u308b \\- Qiita](https:\/\/qiita.com\/__Attsun__\/items\/e033d689c336315435b3)\nfile_path = '\/kaggle\/input\/hah-data-science-challenge\/train\/train\/train2.wav'\n# \u8aad\u307f\u8fbc\u307f(sr:\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u30ec\u30fc\u30c8)\ny, sr = librosa.load(file_path, sr=44100)\n\ny_harmonic, y_percussive = librosa.effects.hpss(y, margin=3.0)\nIPython.display.Audio(data=y_harmonic, rate=sr)","e1229c64":"IPython.display.Audio(data=y_percussive, rate=sr)","fc02199e":"# [\u3010Python\u3011\u30aa\u30fc\u30c7\u30a3\u30aa\u89e3\u6790\u30e9\u30a4\u30d6\u30e9\u30ea LibROSA\u3067\u6ce2\u5f62\u8868\u793a\u3084\u5206\u96e2\u3059\u308b \\| \u30c7\u30fc\u30bf\u5206\u6790\u3068\u30de\u30fc\u30b1\u30c6\u30a3\u30f3\u30b0](https:\/\/sja-analysis.org\/python-librosa-tips\/)\ndef librosa_hp(file, sr=None):\n    file_path = '\/kaggle\/input\/hah-data-science-challenge\/train\/train\/' + file + '.wav'\n\n    # \u8aad\u307f\u8fbc\u307f(sr:\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u30ec\u30fc\u30c8)\n    y, sr = librosa.core.load(file_path, sr=sr)\n    y = (y-y.min())\/(y.max()-y.min()) # \u30b5\u30f3\u30d7\u30eb\u3054\u3068\u306e\u6b63\u898f\u5316\n\n    # \u8abf\u6ce2\u97f3\u6210\u5206\u3068\u6253\u697d\u5668\u97f3\u6210\u5206\u306b\u5206\u3051\u308b\n    y_harmonic, y_percussive = librosa.effects.hpss(y, margin=3.0)\n\n    # \u548c\u97f3\u3001\u30ea\u30ba\u30e0\u306e\u6ce2\u5f62\u3092\u53d6\u5f97\u3059\u308b\n    S_y          = librosa.feature.melspectrogram(y, sr=sr)\n    S_harmonic   = librosa.feature.melspectrogram(y_harmonic, sr=sr)\n    S_percussive = librosa.feature.melspectrogram(y_percussive, sr=sr)\n\n    # \u30d1\u30ef\u30fc\u30b9\u30da\u30af\u30c8\u30ed\u30b0\u30e9\u30e0\u3092dB\u306b\u5909\u63db\u3059\u308b\n    log_Sy = librosa.power_to_db(S_y, ref=np.max)\n    log_Sh = librosa.power_to_db(S_harmonic, ref=np.max)\n    log_Sp = librosa.power_to_db(S_percussive, ref=np.max)\n\n    plt.figure(figsize=(10, 6))\n\n    # \u30e1\u30eb\u30b9\u30b1\u30fc\u30eb\u306e\u30b9\u30da\u30af\u30c8\u30ed\u30b0\u30e9\u30e0\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n    # \u5168\u4f53\n    plt.subplot(3,1,1)\n    librosa.display.specshow(log_Sy, sr=sr, y_axis='mel')\n    plt.title('mel power spectrogram (ALL)')\n    plt.colorbar(format='%+02.0f dB')\n    \n    # \u8abf\u6ce2\u97f3\n    plt.subplot(3,1,2)\n    librosa.display.specshow(log_Sh, sr=sr, y_axis='mel')\n    plt.title('mel power spectrogram (Harmonic)')\n    plt.colorbar(format='%+02.0f dB')\n\n    # \u6253\u697d\u5668\u97f3\n    plt.subplot(3,1,3)\n    librosa.display.specshow(log_Sp, sr=sr, x_axis='time', y_axis='mel')\n    plt.title('mel power spectrogram (Percussive)')\n    plt.colorbar(format='%+02.0f dB')","f8d930c5":"# \u6b63\u5e381\nlibrosa_hp('train2')","55e94c87":"# \u6b63\u5e382\nlibrosa_hp('train31')","16625e3b":"# \u7570\u5e381\nlibrosa_hp('train482')","ff884ae4":"# \u7570\u5e382\nlibrosa_hp('train785')","3cb8b339":"# \u53ef\u8996\u5316","803cfaf0":"## \u8abf\u6ce2\u97f3\u3092\u30af\u30ed\u30de\u30b0\u30e9\u30e0\u3067\u53ef\u8996\u5316\u3057\u3066\u307f\u308b\n\u30af\u30ed\u30de\u30b0\u30e9\u30e0\uff1a\u5468\u6ce2\u6570\u5e2f\u57df\u3092\u97f3\u57df\u306b\u843d\u3068\u3057\u8fbc\u3093\u3067\uff08C,D,E...\uff09\u53ef\u8996\u5316\u3057\u305f\u3082\u306e  \n\u30d4\u30c3\u30c1\u7c92\u5ea6\u3067\u6b63\u5e38\/\u7570\u5e38\u3092\u5206\u985e\u3067\u304d\u308b\u304b\u3092\u78ba\u8a8d","1626868c":"\u30d4\u30c3\u30c1\u7c92\u5ea6\u3067\u306f\u9055\u3044\u304c\u308f\u304b\u3089\u306a\u3044\u3088\u3046\u306b\u898b\u3048\u308b","823aed21":"# \u76ee\u7684\uff1a\u97f3\u58f0\u57cb\u3081\u8fbc\u307f\u3068\u97f3\u306e\u53ef\u8996\u5316\n\u203b\u9014\u4e2d\u3067\u76ee\u7684\u306b\u95a2\u4fc2\u306a\u304f\u78ba\u8a8d\u3057\u305f\u3044\u3053\u3068\u304c\u5165\u3063\u3066\u307e\u3059\u304c\u3054\u4e86\u627f\u304f\u3060\u3055\u3044\u3002","a41fa945":"## \u8abf\u6ce2\u97f3\u3068\u6253\u697d\u5668\u97f3\u306b\u5206\u89e3\u3057\u3066\u8074\u304d\u5206\u3051\u3066\u307f\u308b\n\u8abf\u6ce2\u97f3\uff1a\u65cb\u5f8b\u3084\u548c\u58f0\u3092\u8868\u73fe  \n\u6253\u697d\u5668\u97f3\uff1a\u30ea\u30ba\u30e0\u3092\u8868\u73fe","dc32bcf3":"## \u5168\u4f53\u3068\u8abf\u6ce2\u97f3\u3068\u6253\u697d\u5668\u97f3\u3092\u30b9\u30da\u30af\u30c8\u30ed\u30b0\u30e9\u30e0\u53ef\u8996\u5316\u3057\u3066\u307f\u308b\n\u30b9\u30da\u30af\u30c8\u30ed\u30b0\u30e9\u30e0\uff1a\u6642\u9593\u3001\u5468\u6ce2\u6570\u3001\u4fe1\u53f7\u306e\u5f37\u3055\u3067\u8868\u3055\u308c\u308b\uff13\u6b21\u5143\u306e\u30b0\u30e9\u30d5  \n\u4eca\u56de\u306f\u6642\u9593(s), \u5468\u6ce2\u6570(Hz), \u4fe1\u53f7\u306e\u5f37\u3055(dB)","5a283359":"# \u4e8b\u524d\u78ba\u8a8d","ce1ac4c0":"## wav\u57cb\u3081\u8fbc\u307f\u30c1\u30e3\u30ec\u30f3\u30b8\n\u6b63\u5e38, \u7570\u5e38\u30922\u3064\u305a\u3064\u57cb\u3081\u8fbc\u307f","e98aac76":"## MFCC\u306e\u6570\u5024\u30c7\u30fc\u30bf\u78ba\u8a8d\n\u3069\u306e\u3088\u3046\u306a\u6570\u5024\u304c\u5165\u3063\u3066\u3044\u308b\u306e\u304b","d9a56f07":"\u57cb\u3081\u8fbc\u307f\u3067\u304d\u307e\u3057\u305f\u3002","6d6c9215":"\u5c11\u3057\u7279\u5fb4\u898b\u3048\u308b\u6c17\u304c\u3057\u307e\u3059\u304c\u3082\u3046\u5c11\u3057\u8abf\u67fb\u5fc5\u8981\u305d\u3046\u3067\u3059"}}