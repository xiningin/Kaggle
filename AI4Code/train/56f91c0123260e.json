{"cell_type":{"4c5484a8":"code","09c91fd2":"code","fd64f736":"code","272edda0":"code","1193d1df":"code","f45f2678":"code","945b5262":"code","19c0bbaf":"code","08b2c6a5":"code","4b5b9763":"code","2822298f":"code","120031d7":"code","b16b2e70":"code","e138df01":"code","6f994301":"code","cb3b557d":"code","142d249c":"code","91e6209e":"code","80d3ca2e":"code","91e02d1d":"code","ab4786a9":"code","038a8ff5":"markdown","c459dd53":"markdown"},"source":{"4c5484a8":"!pip3 install --upgrade fastai","09c91fd2":"from fastai.vision.all import *\nfrom fastai.callback.mixup import MixUp\nimport torch\nimport numpy as np\nimport random, os","fd64f736":"files = glob.glob('\/kaggle\/input\/cassava-leaf-disease-classification\/train_images\/*.jpg')\nf, plots = plt.subplots(2, 5, sharex='col', sharey='row', figsize=(19, 7),  constrained_layout=True)\nim_plot = []\n\nfor j in files[:10]:\n    im = Image.open(j)\n    im_plot.append(im)\n        \nfor i in range(10):\n    plots[i \/\/ 5, i % 5].axis('off')\n    plots[i \/\/ 5, i % 5].imshow(im_plot[i])","272edda0":"def seed_everything(seed=0):\n    random.seed(seed)\n    os.environ['PYTHONHASHSEED'] = str(seed)\n    np.random.seed(seed)\n    torch.manual_seed(seed)\n    torch.cuda.manual_seed(seed)\n    torch.backends.cudnn.deterministic = True\n\nseed_everything()","1193d1df":"path = Path('\/kaggle\/input\/cassava-leaf-disease-classification');","f45f2678":"with open('..\/input\/cassava-leaf-disease-classification\/label_num_to_disease_map.json', 'r') as handle:\n    parsed = json.load(handle)\nparsed","945b5262":"train = path \/ \"train.csv\"\ntrain_df = pd.read_csv(train)","19c0bbaf":"train_df.head()","08b2c6a5":"train_df.label.value_counts()","4b5b9763":"dls = ImageDataLoaders.from_df(train_df, path\/\"train_images\", item_tfms=Resize(256),\n                              bs=64, num_workers=4, \n                              label_col=\"label\")","2822298f":"dls.show_batch()","120031d7":"print(dls.vocab); print(dls.c)","b16b2e70":"learn = cnn_learner(dls, resnet34, metrics=[error_rate, accuracy], cbs=MixUp, model_dir=\"\/tmp\/model\/\").to_fp16()","e138df01":"learn.lr_find()","6f994301":"learn.fit_one_cycle(15, lr_max=1e-2, cbs=EarlyStoppingCallback(patience=3))","cb3b557d":"learn.unfreeze()","142d249c":"learn.fit_one_cycle(15, lr_max=slice(1e-7, 1e-3), cbs=EarlyStoppingCallback(patience=3)","91e6209e":"sample_df = pd.read_csv(path\/'sample_submission.csv')","80d3ca2e":"test_items = get_image_files(path\/\"test_images\")\ndl = learn.dls.test_dl(test_items, rm_type_tfms=1, bs=64)\ny_pred, _ = learn.get_preds(dl=dl)","91e02d1d":"sample_df['label'] = y_pred.argmax(dim=-1).numpy()\nsample_df.head()","ab4786a9":"sample_df.to_csv('submission.csv',index=False)","038a8ff5":"Looks like we have a class imbalance probelm","c459dd53":"The aim of this notebook is to get started as quickly as possible and make a submission to Kaggle.\n\n* Loading Data\n* Data Augmentation (Mixup)\n* Fix Precision training\n* Model Training\n* Model Confusion Matrix\n* Predictions"}}