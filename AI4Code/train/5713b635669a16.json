{"cell_type":{"98dc825e":"code","0bb23297":"code","e9ad75d8":"code","9ba46950":"code","78233443":"code","3e6cd8b2":"code","d395dbeb":"code","e797578b":"code","6bafad7e":"code","ed08dee8":"code","ad31f766":"code","4bde9a41":"code","807cd085":"code","d39355f6":"code","34e380f4":"code","571df652":"code","042eb200":"code","a08c0b90":"code","929c9770":"code","9427ca83":"code","e0e4c489":"code","417a8e15":"code","16f31b28":"code","34886df9":"code","aab7239f":"code","43384c95":"code","15b016d7":"code","98782894":"code","b08026d7":"code","303ff72f":"code","0bac966f":"code","6f1f3b0a":"code","fe358419":"code","5292ccc3":"code","6714df72":"code","2850f889":"code","231f51b4":"code","a5e3ef16":"code","44203742":"code","bcabb913":"code","80f05eea":"code","7cd22fa0":"code","82831a2e":"code","ee1cb662":"code","a7ca186a":"code","f43163c9":"code","7b402dbc":"code","5b6f2865":"code","4f47f64d":"code","11eb1504":"code","9caf0f32":"code","1f3a0897":"code","b38541ca":"code","d8382c83":"code","743ea00f":"code","8f28d078":"code","467339e1":"code","ae02dc2d":"code","4b334dd7":"code","2a0332f0":"code","9401e1aa":"code","85afbd97":"code","a54e96a8":"markdown","65a10397":"markdown","d4b9c4f4":"markdown","9fd4b2cc":"markdown","f03dc0a6":"markdown","f5b97a6c":"markdown","87340d39":"markdown","1dd98565":"markdown","2bb604de":"markdown","8a6f46fc":"markdown","7d1375a7":"markdown","c5eff480":"markdown","aec8c043":"markdown","b3b2a7e3":"markdown","7b482be5":"markdown","aba216b4":"markdown","2eee0323":"markdown","87ba8df1":"markdown","c7b3f803":"markdown","f26f47de":"markdown","5896fbfe":"markdown","d9cd086b":"markdown","6bfa7549":"markdown","ead007be":"markdown","ac355a64":"markdown","888c13a5":"markdown","40aabc3e":"markdown","e327bca5":"markdown","01b4f834":"markdown","1d2f6570":"markdown","c614640a":"markdown","1c19892a":"markdown","122ef844":"markdown","29766134":"markdown","4418c7d0":"markdown","f3999b86":"markdown","e367ca65":"markdown","be85bcac":"markdown","588bdab8":"markdown","3af3ab49":"markdown","394847bb":"markdown","0259d24c":"markdown"},"source":{"98dc825e":"#Importing basic libraries\n\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n#Silencing warnings \n\nimport warnings\nwarnings.filterwarnings('ignore')\npd.set_option('mode.chained_assignment',None) #Silencing the Setting with Copying Warning","0bb23297":"%matplotlib inline","e9ad75d8":"filepath = '..\/input\/adult-census-income\/adult.csv'\ndf = pd.read_csv(filepath)","9ba46950":"df.head()","78233443":"df.info()","3e6cd8b2":"df.describe()","d395dbeb":"# df.rename(columns={'income':'salary'},inplace=True)","e797578b":"df['income'].value_counts()","6bafad7e":"df['income'].value_counts(normalize=True)","ed08dee8":"cols_df = pd.DataFrame(df.dtypes)\nnum_cols = list(cols_df[cols_df[0]=='int64'].index)\ncat_cols = list(cols_df[cols_df[0]=='object'].index)[:-1] #excluding target column of income \nprint('Numeric variables includes:','\\n',num_cols)\nprint('\\n')\nprint('Categorical variables includes','\\n',cat_cols)","ad31f766":"# Data description mentions that unknown values are repalced with '?'. Let us check counts for it\n\nfor i in list(df.columns):\n    print(i,df[df[i]=='?'][i].count())","4bde9a41":"#Replacing '?' string with NaN values\ndf.replace(to_replace='?',value=np.nan,inplace=True)","807cd085":"df.isna().sum()","d39355f6":"df.dropna(axis=0,inplace=True)","34e380f4":"plt.figure(figsize=(5,5))\ncorrelation = df.corr()\nmatrix = np.triu(correlation)\nsns.heatmap(correlation,cmap='coolwarm',square=True,linecolor='black',linewidths=1,\n            mask=matrix,annot=True)\nplt.show()","571df652":"for i in num_cols:\n    plt.figure(figsize=(6,3))\n    df[df['income']=='<=50K'][i].hist(color='mediumblue')\n    df[df['income']=='>50K'][i].hist(color='firebrick')\n    plt.title(i)\n    plt.show()","042eb200":"# Instead of using sns.catplot() we use the below loop to create a cross tab \n# which will also include the total column for better comparison\n\nfor i in cat_cols:\n    ct = pd.crosstab(df[i],df['income'],margins=True, margins_name=\"Total\")\n    ct.drop(labels='Total',axis=0,inplace=True) #Removing subtotal row \n    ct.sort_values(by='Total',ascending=False,inplace=True) #Sorting based on total column\n    #Selecting only top 6 categories for plotting\n    ct.iloc[:6,:].plot(kind='bar',colormap='viridis',edgecolor='black')  \n    plt.xlabel(' ')\n    plt.title(str(i).capitalize())\n    plt.legend(loc=1)\n    plt.show()","a08c0b90":"df['income'].replace(to_replace='<=50K',value=0,inplace=True)\ndf['income'].replace(to_replace='>50K',value=1,inplace=True)","929c9770":"#Identifying categorical columns where more than 90% of observations belong only to one categroy\n\ncat_drop = []\nfor i in cat_cols:\n    if (df[i].value_counts(normalize=True)[0]) > 0.9:\n        cat_drop.append(i)\n        \nprint(cat_drop)","9427ca83":"#Similarly for numerical columns\n\nnum_drop = []\nfor i in num_cols:\n    if df[i].value_counts(normalize=True).iloc[0] > 0.9:\n        num_drop.append(i)\n        \nprint(num_drop)","e0e4c489":"X = df.drop(labels = cat_drop + num_drop + ['income'],axis=1)\ny = df['income']","417a8e15":"X.head(2)","16f31b28":"y.value_counts()","34886df9":"sns.boxplot('education.num','education',data=df)\nplt.show()","aab7239f":"ed_cross = pd.crosstab(df['education.num'],df['education'])","43384c95":"ed_cross","15b016d7":"X.drop('education',axis=1,inplace=True)","98782894":"X.drop('fnlwgt',axis=1,inplace=True)","b08026d7":"X['workclass'].value_counts(normalize=True)*100","303ff72f":"#Listing all options other than private\nto_replace = list(X['workclass'].unique())\nto_replace.remove('Private')\n\n#Placing all other categories under one bracket\nX.replace(to_replace,'Non-Private',inplace=True)\nX['workclass'].value_counts(normalize=True)*100","0bac966f":"X['race'].value_counts(normalize=True)*100","6f1f3b0a":"#Listing all options other than white\nto_replace = list(X['race'].unique())\nto_replace.remove('White')\n\n#Placing all other categories under one bracket\nX.replace(to_replace,'Other',inplace=True)\nX['race'].value_counts(normalize=True)*100","fe358419":"X['marital.status'].value_counts(normalize=True)*100","5292ccc3":"#Let us consolidate all options where individuals were married at least once (i.e. all options other than never-married)\nto_replace = list(X['marital.status'].unique())\nto_replace.remove('Never-married')\n\n#Placing all other categories under one bracket\nX.replace(to_replace,'Married',inplace=True)\n\n#Renaming the 'Never-married' category to 'Single'\nX.replace('Never-married','Single',inplace=True)\n\n#Checking the final output\nX['marital.status'].value_counts(normalize=True)*100","6714df72":"X.head(2)","2850f889":"X.shape","231f51b4":"#Separating the categorical variables in feature matrix that need to be encoded \n\ncols_X = pd.DataFrame(X.dtypes)\nX_cat_cols = list(cols_X[cols_X[0]=='object'].index)\nX_num_cols = list(cols_X[cols_X[0]=='int64'].index)","a5e3ef16":"X_num_cols","44203742":"X = pd.get_dummies(data=X,prefix=X_cat_cols,drop_first=True)","bcabb913":"X.head(2)","80f05eea":"from sklearn.model_selection import train_test_split\nX_train, X_val, y_train, y_val = train_test_split(X,y,test_size=0.25,random_state=101)","7cd22fa0":"from sklearn.preprocessing import StandardScaler\nsc = StandardScaler()","82831a2e":"X_train.head(2)","ee1cb662":"X_train[X_num_cols] = sc.fit_transform(X_train[X_num_cols])\nX_val[X_num_cols] = sc.transform(X_val[X_num_cols])","a7ca186a":"X_train.head()","f43163c9":"from sklearn import __version__ \nprint(__version__)\nfrom sklearn.metrics import roc_auc_score, accuracy_score, classification_report, confusion_matrix, roc_curve, log_loss, brier_score_loss","7b402dbc":"from sklearn.linear_model import LogisticRegression\nlog = LogisticRegression(random_state=101)\nlog.fit(X_train,y_train)\nlog_y_pred = log.predict_proba(X_val)\nlog_roc = roc_auc_score(y_val,log_y_pred[:,-1])\nprint('ROC AUC score : ',log_roc)\nprint(log.get_params())","5b6f2865":"d = {'Baseline Logistic Regression' : [log_roc]}\n\nresults = pd.DataFrame(d,index=['ROC AUC Score'])\nresults = results.transpose()\nresults.sort_values(by='ROC AUC Score',ascending=False,inplace=True)\nresults","4f47f64d":"from sklearn.tree import DecisionTreeClassifier\ndt = DecisionTreeClassifier(random_state=101)\ndt.fit(X_train, y_train)\ndt_y_pred = dt.predict_proba(X_val)\ndt_roc = roc_auc_score(y_val,dt_y_pred[:,-1])\nprint('ROC AUC score : ',dt_roc)\nprint(dt.get_params())","11eb1504":"results.loc['Baseline Decision Tree'] = dt_roc\nresults.sort_values(by='ROC AUC Score',ascending=False,inplace=True)\nresults","9caf0f32":"from sklearn.ensemble import RandomForestClassifier\nrf = RandomForestClassifier(random_state=101)\nrf.fit(X_train,y_train)\nrf_y_pred = rf.predict_proba(X_val)\nrf_roc = roc_auc_score(y_val,rf_y_pred[:,-1])\nprint(rf_roc)\nprint(rf.get_params())","1f3a0897":"results.loc['Baseline Random Forest'] = rf_roc\nresults.sort_values(by='ROC AUC Score',ascending=False,inplace=True)\nresults","b38541ca":"#Linear kernel\n\nfrom sklearn.svm import SVC\n\nsvc_l = SVC(kernel='linear',random_state=101,probability=True)\nsvc_l.fit(X_train,y_train)\nsvcl_y_pred = svc_l.predict_proba(X_val)\nsvcl_roc = roc_auc_score(y_val,svcl_y_pred[:,-1])\nprint('ROC AUC score : ',svcl_roc)\nprint(svc_l.get_params)","d8382c83":"results.loc['Baseline SVC Linear'] = svcl_roc\nresults.sort_values(by='ROC AUC Score',ascending=False,inplace=True)\nresults","743ea00f":"from sklearn.neighbors import KNeighborsClassifier\nknn = KNeighborsClassifier(n_neighbors=35)\nknn.fit(X_train,y_train)\nknn_y_pred = knn.predict_proba(X_val)\nknn_roc = roc_auc_score(y_val,knn_y_pred[:,-1])\nprint('ROC AUC score : ',knn_roc)\nprint(knn.get_params())","8f28d078":"results.loc['Baseline KNN'] = knn_roc\nresults.sort_values(by='ROC AUC Score',ascending=False,inplace=True)\nresults","467339e1":"from sklearn.naive_bayes import GaussianNB\nnb = GaussianNB()\nnb.fit(X_train,y_train)\nnb_y_pred = nb.predict_proba(X_val)\nnb_roc = roc_auc_score(y_val,nb_y_pred[:,-1])\nprint('ROC AUC score : ',nb_roc)\nprint(nb.get_params())","ae02dc2d":"results.loc['Baseline Naive Bayes'] = nb_roc\nresults.sort_values(by='ROC AUC Score',ascending=False,inplace=True)\nresults","4b334dd7":"from xgboost import XGBClassifier\nxg = XGBClassifier(random_state=101)\nxg.fit(X_train,y_train)\nxg_y_pred = xg.predict_proba(X_val)\nxg_roc = roc_auc_score(y_val,xg_y_pred[:,-1])\nprint('ROC AUC score : ',xg_roc)\nprint(xg.get_params())","2a0332f0":"results.loc['Baseline XGBoost'] = xg_roc\nresults.sort_values(by='ROC AUC Score',ascending=False,inplace=True)\nresults","9401e1aa":"from catboost import CatBoostClassifier\ncat = CatBoostClassifier(silent=True)\ncat.fit(X_train,y_train)\ncat_y_pred = cat.predict_proba(X_val)\ncat_roc = roc_auc_score(y_val,cat_y_pred[:,-1])\nprint('ROC AUC score : ',cat_roc)\nprint()\nprint(cat.get_all_params())","85afbd97":"results.loc['Baseline Cat Boost'] = cat_roc\nresults.sort_values(by='ROC AUC Score',ascending=False,inplace=True)\nresults","a54e96a8":"**8. Cat Boost**","65a10397":"# Part 2: Data Pre-Processing","d4b9c4f4":"**2. Race**\n\n86% of individuals are whites hence let us club all other races under a common 'Other' bracket to reduce the number of categories","9fd4b2cc":"**1. Workclass**\n\n74% of individuals work in the private sector. Let us consolidate all other categories under a common head of 'Non-Private'","f03dc0a6":"**1. Encoding categorical data**","f5b97a6c":"**Identifying categorical and numerical variables separately**\n\nThis will help us in using the suitable type of plots to visualise each variable later during EDA","87340d39":"In this section, we will attempt to simplify our input parameters (features) as we have many categorical variables with higher number of unique values ","1dd98565":"**Distribution of Target Variable:**\n\n76% of the population earns below 50K USD which indicates an unequal distribution of the target variable. We will have to consider this while training our ML model","2bb604de":"This dataset was obtained from UCI Machine Learning Repository. The aim of this problem is to classify adults in two different groups based on their income where group 1 has an income less than USD 50k and group 2 has an income of more than or equal to USD 50k. The data available at hand comes from Census 1994","8a6f46fc":"# Part 5: Feature Engineering","7d1375a7":"**6. Naive Bayes Classifier**","c5eff480":"# Part 6: Encoding, Splitting and Scaling","aec8c043":"**2. Splitting data into training and validation sets**","b3b2a7e3":"After categorical encoding, our final feature matrix has 25 columns. We will use this for our model training in the next section ","7b482be5":"**3. Marital Status**","aba216b4":"The variables present in the dataset are as follows - \n\n- age: continuous.\n- workclass: Private, Self-emp-not-inc, Self-emp-inc, Federal-gov, Local-gov, State-gov, Without-pay, Never-worked.\n- fnlwgt: continuous.\n- education: Bachelors, Some-college, 11th, HS-grad, Prof-school, Assoc-acdm, Assoc-voc, 9th, 7th-8th, 12th, Masters, 1st-4th, 10th, Doctorate, 5th-6th, Preschool.\n- education.num: continuous.\n- marital.status: Married-civ-spouse, Divorced, Never-married, Separated, Widowed, Married-spouse-absent, Married-AF-spouse.\n- occupation: Tech-support, Craft-repair, Other-service, Sales, Exec-managerial, Prof-specialty, Handlers-cleaners, Machine-op-inspct, Adm-clerical, Farming-fishing, Transport-moving, Priv-house-serv, Protective-serv, Armed-Forces.\n- relationship: Wife, Own-child, Husband, Not-in-family, Other-relative, Unmarried.\n- race: White, Asian-Pac-Islander, Amer-Indian-Eskimo, Other, Black.\n- sex: Female, Male.\n- capital-gain: continuous.\n- capital-loss: continuous.\n- hours-per-week: continuous.\n- native-country: United-States, Cambodia, England, Puerto-Rico, Canada, Germany, Outlying-US(Guam-USVI-etc), India, Japan, Greece, South, China, Cuba, Iran, Honduras, Philippines, Italy, Poland, Jamaica, Vietnam, Mexico, Portugal, Ireland, France, Dominican-Republic, Laos, Ecuador, Taiwan, Haiti, Columbia, Hungary, Guatemala, Nicaragua, Scotland, Thailand, Yugoslavia, El-Salvador, Trinadad&Tobago, Peru, Hong, Holand-Netherlands.\n","2eee0323":"**1. Correlation between numberic variables:** There is no strong positive or negative correlation between these variables. Thus we are unlikely to run into any multi-collinearity issues in the model","87ba8df1":"All 3 variables with missing values are categorical in nature. As we have a larger number of available observations, let us drop these observations and use rest of the data for analysis","c7b3f803":"# Part 4: Feature Selection","f26f47de":"# Background","5896fbfe":"# Part 8: Conclusion","d9cd086b":"**3. Random Forest Classifier** ","6bfa7549":"**1. Logistic Regression**","ead007be":"\n- In native country close to 91% of observations belong to one category (i.e. United States)\n- Whereas in capital-gain and capital-loss, ~92% and ~95% of values are zeroes respectively which will not contribute in modelling\n\nHence, we **drop these 3 variables (native-country, capital-gain, capital-loss)** from the feature matrix","ac355a64":"**5. K-Nearest Neighbours**","888c13a5":"# Part 1: Data and Libraries Setup","40aabc3e":"**2. Decision Tree Classifier**","e327bca5":"## Numeric Variables","01b4f834":"**Count plot observations**: We are only looking at top 6 categories for each variable on different salary levels and total level (for benchmarking our observations) \n\n- Leading attributes of <=50K income group:\n    - No clear distinction on the workclass since both groups are majorly employed in the private sector\n    - High school or some college graduates\n    - Unmarried (could be partly due to younger age)\n    - Common occupation includes craft\/repair, admin-clerical and other services (may be unorganised in nature)\n    - Equal proportion of individuals who are not in a family setting and are husbands\n    - Race distribution is similar to overall population distribution for this group \n    - Gender and native country follow a pattern similar to the entire population for both the groups (i.e. largely males from USA itself) \n\n\n- Leading attributes of >50K income group:\n    - Largely employed in the private sector\n    - More frequenct bachlor degree holders (in line with our observation on higher education level)\n    - Significant proportion is married and living with a spouse\n    - These individuals hold highly specialised positions in the workforce like executive management and prof-specialty (which partly explain the higher income)\n    - Most play an active family role as a husband or wife\n    - Whites dominate this income group, however it should be noted this is also the general population distribution","1d2f6570":"**7. XGBoost Classifer**","c614640a":"**2. Histograms for each variable:** \n\n- Younger population falls under the lower income category whereas the age distribution for above 50K income is normally distributed\n- The mean observation of education level is higher for the above 50k income group with most observations falling above education level of 9 \n- Capital gain and capital loss have largely zero values hence we will exclude it from our feature matrix\n- Also, fnlwgt by definition is a control parameter kept in the census data. We may need to exclude it later from our model depending on it's impact on performance\n- Majority of lower income group individuals work for less than 40 hours whereas the higher income group individuals have a more right skewed distribution of working hours  ","1c19892a":"**Treating Missing Values**","122ef844":"**3. Scaling numeric variables in the feature matrix**","29766134":"Above cross tab shows that each education number corresponds to an education level and represents the same data. Hence, we **drop the education column** from our feature matrix to avoid redundant data ","4418c7d0":"Note:\n- I have worked on this project as my first machine learning classification project hence there may certainly be room for improvement further. Please feel free to leave your comments and suggestions which may help me to improve further\n- This project can also be found on my GitHub profile (along with test data predictions) - https:\/\/github.com\/ishitashah23\/learningprojects\/tree\/master\/Income-category%20Classification%20Project\n- Big shoutout to Shrey Bohara for taking up this project along with me. You can check his notebook solution here - https:\/\/www.kaggle.com\/shreybohara\/beginner-s-income-prediction-89-score ","f3999b86":"**Top model:**\n\n- From the above list we can see that CatBoost model performs the best\n- All other models also have a very close performance metric indicating that due to clean data, we are able to achieve decent model performance across models\n- **Hence, our final model obtained using CatBoost is able to predict the income group of the test data with an ROC AUC score of 88.4%**","e367ca65":"**4. Support Vector Classifier - Linear Kernel** ","be85bcac":"Let us take a look at education-num and education as these variables are largely similar in nature","588bdab8":"# Part 3: Exploratory Data Analysis:\n\nThis section is split into 2 parts where visualisations are bifurcated depending on the variable type - numeric and categorical","3af3ab49":"# Part 7: Classification Model Training ","394847bb":"We also **drop fnlwgt column** as it is only a standardisation parameter and fails to give us any direction during model interpretation","0259d24c":"## Categorical Variables"}}