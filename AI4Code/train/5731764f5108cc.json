{"cell_type":{"00cac0c3":"code","0398b91c":"code","ff3fa181":"code","37a949ec":"code","abcdf5e0":"code","d9834c7a":"code","6e639d08":"code","66848a7e":"code","9234ad48":"code","404a0254":"code","00153fbf":"code","1e713847":"code","354ce40a":"code","4c0dec2e":"code","44ec7889":"code","e5eaabda":"markdown","c6c0421b":"markdown","36ad5314":"markdown","d71e7cc0":"markdown","c766f904":"markdown","f8f24677":"markdown","6021d78b":"markdown","bed46d5b":"markdown","c6b46bbb":"markdown","08b475a0":"markdown","956243fc":"markdown","98a0a3ab":"markdown","9553249b":"markdown","bac71219":"markdown","716ebca9":"markdown"},"source":{"00cac0c3":"#import modules\nimport matplotlib.pyplot as plt\nfrom sklearn.manifold import TSNE\nfrom sklearn.cluster import KMeans\nfrom sklearn import metrics\nfrom ast import literal_eval\nimport pandas as pd\nimport numpy as np\nfrom collections import defaultdict","0398b91c":"#read members, rollcall_votes and rollcall_info files to dataframe\nrollcall_votes = pd.read_csv('\/kaggle\/input\/house-of-representatives-congress-116\/house_rollcall_votes_116.csv', index_col = 0)\nmembers = pd.read_csv('\/kaggle\/input\/house-of-representatives-congress-116\/house_members_116.csv', index_col = 0)\nrollcall_info = pd.read_csv('\/kaggle\/input\/house-of-representatives-congress-116\/house_rollcall_info_116.csv', index_col = 0)\nbills = pd.read_csv('\/kaggle\/input\/house-of-representatives-congress-116\/house_legislation_116.csv', index_col = 0, parse_dates=[\"date_introduced\"])\n\n#deletes votes related to initial quorum and the election of speaker of the house from dataframes\ndel rollcall_votes['2019:002']\ndel rollcall_votes['2019:001']\nrollcall_info.drop(labels =['2019:001', '2019:002'], inplace = True)\n\n#drop members who have died, left congress or are non-voting members. Also remove speaker of the house who traditionally does not vote \nto_drop =['G000582', 'R000600', 'N000147', 'P000610', 'S001177', 'S001204', 'P000197', 'J000255', 'H001087','C001092', 'C000984', 'D000614','M001179']\nrollcall_votes.drop(labels = to_drop, inplace = True)\nmembers.drop(to_drop, inplace = True)\n#fill nan values with 0\nrollcall_votes.fillna(0, inplace= True)\n\n#replace vote strings with integers representing votes: yes votes to 1, no vote to -1, and abstentions to 0\n\nreplace = {'No': -1, 'Aye': 1, 'Yea': 1, 'Nay': -1, 'Not Voting': 0, 'Present': 0}\nrollcall_votes.replace(replace, inplace= True)\n\n\n#converts values of relevant columns to lists of strings rather than strings\nbills.cosponsors=bills.cosponsors.apply(literal_eval)\nbills.subjects = bills.subjects.apply(literal_eval)\nbills.committees = bills.committees.apply(literal_eval)\nbills.related_bills = bills.related_bills.apply(literal_eval)\n\n\n#list of motions related to passage of bills and agreement to resolutions\nmotions_to_agree_or_pass =['On Agreeing to the Resolution', \n'On Passage', \n'On Motion to Suspend the Rules and Pass', \n'On Motion to Suspend the Rules and Agree',\n'On Motion to Suspend the Rules and Agree, as Amended',\n'On Motion to Suspend the Rules and Pass, as Amended',\n'On Passage, Objections of the President to the Contrary Notwithstanding']\n\n#list of motions related to recommitting bills or resolutions to committee\nmotion_to_recommit = ['On Motion to Recommit with Instructions','On Motion to Recommit', 'On Motion to Commit with Instructions' ]\n\n#list of motions related to amending bill or resolution\namendment = ['On Agreeing to the Amendment', 'On Motion to Suspend the Rules and Concur in the Senate Amendment',\n            'On Motion to Concur in the Senate Amendment', 'On Motion to Concur in the Senate Amendment with an Amendment']\n\n#check unique values in rollcall_votes \nunique = []\nfor i, row in rollcall_votes.iterrows():\n    for x in pd.unique(rollcall_votes.loc[i]):\n        if x not in unique:\n            unique.append(x)\nprint(unique)\n","ff3fa181":"rollcall_votes.head()","37a949ec":"rollcall_info.head()","abcdf5e0":"bills.head()","d9834c7a":"members.head()","6e639d08":"#filter rollcall votes to only look at votes which pertain to the passage of bills or agreement to resolutions\nrollcalls_of_interest = [index for index, row in rollcall_info.iterrows() if  (row['question'] in motions_to_agree_or_pass) ]\nrollcalls_of_interest =  rollcall_votes[rollcalls_of_interest]\n\n#Use K-Means to find clusters for n=2\nn = 2\nx = rollcalls_of_interest.loc[members.index].values\nmodel = KMeans(n_clusters = n, random_state = 42, algorithm = 'auto')\nmodel.fit(x)\nlabels = model.predict(x)\nmembers['cluster'] =labels\n\n#create model\nmodel = TSNE(learning_rate = 10)\n\n#fit model\ntransformed = model.fit_transform(x)\nxs = transformed[:,0]\nys = transformed[:,1]\n\ndf_trans = pd.DataFrame({'xs':xs, 'ys':ys})\n\n#determine centroid locations of t-sne clusters\ncpx =[]\ncpy=[]\n\nfor i in range(n):\n    xi = df_trans.loc[(labels ==i)]['xs'].mean()\n    yi = df_trans.loc[(labels ==i)]['ys'].mean()\n    cpx.append(xi)\n    cpy.append(yi)\n\n#create plots\nplt.scatter(df_trans.loc[members.current_party.values =='Democratic']['xs'], df_trans.loc[members.current_party.values =='Democratic']['ys'], c= 'tab:green')\nplt.scatter(df_trans.loc[members.current_party.values =='Republican']['xs'], df_trans.loc[members.current_party.values =='Republican']['ys'], c= 'tab:blue')\nplt.legend(loc ='best', labels = ['Democratic', 'Republican'])\n\n#annotate clusters centroids for each species\nfor i in range(n):\n    plt.annotate(s = str(i), xy = (cpx[i], cpy[i]), xytext = (-4,-4), textcoords = 'offset points')\n\nplt.title('T-SNE: Rollcall Votes in House')\nplt.show()","66848a7e":"#rollcalls_of_interest: list of votes which pertain to passage of bills or agreement to resolutions pertaining to Immigration\nbills_by_policy_area = [bill for bill, row in bills.iterrows() if row.policy_area == 'Immigration']\nrollcalls_of_interest = [index for index, row in rollcall_info.iterrows() if  ((row['question'] in motions_to_agree_or_pass) and \n                                                                               (row['bill_id'] in bills_by_policy_area)) ]\n\n#rollcalls_by_subject: df repesenting subset of rollcall_votes with index in rollcalls_of_interest\nrollcalls_by_subject = rollcall_votes[rollcalls_of_interest]","9234ad48":"rollcall_info.loc[rollcalls_of_interest].bill_id.unique()","404a0254":"#import modules\nfrom sklearn.cluster import KMeans\nfrom sklearn import metrics\n\n#instantaiate lists\nxp=[]\nyp=[]\nx = rollcalls_by_subject.loc[members.index].values\n\n# fit KMeans model for n_clusters 2:30\nfor i in range(2,30):\n    model = KMeans(n_clusters = i, random_state = 42)\n    model.fit(x)\n    labels = model.predict(x)\n    score =metrics.silhouette_score(x, labels, metric='euclidean')\n    xp.append(i)\n    yp.append(score)\nplt.plot(xp,yp)\nplt.title('Kmeans Clustering')\nplt.xlabel('Number of Clusters')\nplt.ylabel('Silhouette Score')\nplt.show()","00153fbf":"n = 28\nmodel = KMeans(n_clusters = n, random_state = 42, algorithm = 'auto')\nmodel.fit(x)\nlabels = model.predict(x)\nmembers['cluster'] =labels\n\n#create model\nmodel = TSNE(learning_rate = 10)\n\n#fit model\ntransformed = model.fit_transform(rollcalls_by_subject.loc[members.index].values)\nxs = transformed[:,0]\nys = transformed[:,1]\n\ndf_trans = pd.DataFrame({'xs':xs, 'ys':ys})\n\n#determine centroid locations of t-sne clusters\ncpx =[]\ncpy=[]\n\nfor i in range(n):\n    xi = df_trans.loc[(labels ==i)]['xs'].mean()\n    yi = df_trans.loc[(labels ==i)]['ys'].mean()\n    cpx.append(xi)\n    cpy.append(yi)\n\n#create plots\nplt.scatter(df_trans.loc[members.current_party.values =='Democratic']['xs'], df_trans.loc[members.current_party.values =='Democratic']['ys'], c= 'tab:green')\nplt.scatter(df_trans.loc[members.current_party.values =='Republican']['xs'], df_trans.loc[members.current_party.values =='Republican']['ys'], c= 'tab:blue')\nplt.legend(loc ='best', labels = ['Democratic', 'Republican'])\n\n#annotate clusters centroids for each species\nfor i in range(n):\n    plt.annotate(s = str(i), xy = (cpx[i], cpy[i]), xytext = (-4,-4), textcoords = 'offset points')\n\nplt.title('T-SNE: Rollcall On Immigration')\nplt.show()","1e713847":"dic = defaultdict()\nfor i in range(n):\n    dic[i] = len(members.loc[labels == i])\n\n#count within each cluster in descending order\npd.DataFrame.from_dict(dic, orient = 'index', columns = ['count']).sort_values('count', ascending = False).head()","354ce40a":"#members of cluster 2\nmembers.loc[labels == 2].head(10)","4c0dec2e":"\nfor i in members.cluster.sort_values().unique():\n    if 'df' in locals():\n        df1  =pd.DataFrame(rollcall_votes.loc[members.loc[labels == i].index].mean().loc[rollcalls_of_interest], columns =[i])\n\n        df = df.merge(df1, how = 'outer', left_index =True, right_index =True)\n    else:\n        \n        df =pd.DataFrame(rollcall_votes.loc[members.loc[labels == i].index].mean().loc[rollcalls_of_interest], columns =[i])\n        \n\n#rollcall_votes.loc[members.loc[labels == 0].index].mean().loc[rollcalls_of_interest]\ndf.merge(rollcall_info.bill_id, how ='left',left_index =True, right_index =True).reset_index().set_index('bill_id')[['index',1,0, 2]].head(20)\n","44ec7889":"bills.loc['H.R.1044'].title\n","e5eaabda":"# Cluster Analysis of Roll Call Votes in U.S. House of Representatives\n\n## Imports:","c6c0421b":"The plot above, shows two major clusters related to rollcall votes in the House. Cluster 0 highly associated with memebrs of the Democratic Party and cluster 1 hihgly associated with membes of the Republican Party.","36ad5314":"Inspection of the congressional record however, indicates that the disagreement might have been more concerning the way the bill was passed through 'suspension of the rules' rather than a core disagreement with the intention of the bill. For instance, in the congressional record Doug Collins of Georgia states that he agrees with the bill in priciple but does not believe it is ready for passage without the vetting required under normal House procedure. ","d71e7cc0":"## Visual EDA of rollcall_votes using T-SNE","c766f904":"### Filter and Subet Data","f8f24677":"## T-SNE of House Votes Filtered by Policy Area","6021d78b":"Shows some of the members of cluster 2. We might hypothesize that cluster 2 represents the more conservative tea-party faction of the Republican Party. ","bed46d5b":"<code>rollcall_votes<\/code> : includes the voting record of each Representative indexed by name_id. Columns represent individual rollcall votes and are named in the form year:rollcall#. Values are 1 for yes vote, -1 for no vote, and 0 for abstention. \n\n<code>rollcall_info<\/code> : dataframe representing information related to each rollcall vote. Index values are the same as column names of rollcall_votes.\n\n<code>members<\/code> : dataframe indexed by name_id includes information related to each Representative.\n\n<code>bills<\/code> : bills indexed by bill_id includes information related to all bills and resolutions introduced in the House.","c6b46bbb":"Cluster counts sorted in descending order shows that cluster 2 has 41 members indicating a fairly large split in the Republican party in votes pertaining to immigration. ","08b475a0":"The unique bills voted by rollcall pertaining to immigration","956243fc":"### Plot T-SNE with Annotated Cluster Centroids","98a0a3ab":"We can visually assess three major clusters: 0, 1 and 2. The plot indicates a division in the Republican Party related to Immigration.","9553249b":"## Read Data and Preprocessing","bac71219":"### Determine Optimal Number of Clusters using Silhoutte Score","716ebca9":"Shows the mean vote within each cluster indexed by bill_id. The major disagreement between clusters 0 and 2 was related to the passage H.R. 1044. Clusters 1 and 0 both overwhelmingly voted for the bill, whereas cluster 2 overwhelmingly voted against the bill. "}}