{"cell_type":{"a3e36eea":"code","f9cba1b3":"code","81d271fb":"code","9e21e152":"code","987b407a":"code","f7dd180a":"code","6050b3ef":"code","51200ad7":"code","29fbfcdf":"code","ca6f5065":"code","d68cbdf6":"code","edcc92e3":"code","b38d36c2":"code","ef205a47":"code","5d637463":"code","e52323c2":"code","8b7b6eb9":"code","35e8c1b6":"code","d800bcfc":"code","6ece634d":"code","88e0012d":"markdown","2250e05f":"markdown","3fcf4b78":"markdown","0aa39b10":"markdown","873f63ad":"markdown","f9d859cc":"markdown","5aed0107":"markdown","090fd770":"markdown","24c79d1a":"markdown","806d1842":"markdown","2e4a4866":"markdown"},"source":{"a3e36eea":"# import all packages and set plots to be embedded inline\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sb\nfrom datetime import datetime, timedelta\nimport requests\nimport os\nfrom pandas.plotting import register_matplotlib_converters\n\n%matplotlib inline","f9cba1b3":"# Download with each run of the notebook the latest file containing Covid data\n\nurl = 'https:\/\/raw.githubusercontent.com\/owid\/covid-19-data\/master\/public\/data\/owid-covid-data.csv'\nfile_name = 'owid-covid-data.csv'\nfolder_name = '\/kaggle\/working'\nfile_path = os.path.join(folder_name, file_name)\n\n# If the file exists in the current directory, delete it\nif os.path.exists(file_path): \n    os.remove(file_path)\n    \n# Dowload the latest dataset\nresponse = requests.get(url)\n\nwith open(file_path, mode = 'wb') as file:\n    file.write(response.content)","81d271fb":"covid_df = pd.read_csv(file_path)","9e21e152":"covid_df['date'] = pd.to_datetime(covid_df.date)","987b407a":"covid_swiss_df = covid_df[covid_df.location == 'Switzerland'].copy()","f7dd180a":"reference_col = ['location', 'population', 'population_density', 'median_age', 'aged_65_older', \\\n                 'aged_70_older', 'gdp_per_capita', 'extreme_poverty', 'cvd_death_rate', 'diabetes_prevalence', \\\n                'female_smokers', 'male_smokers', 'handwashing_facilities', 'hospital_beds_per_thousand', \\\n                'life_expectancy']\n\nreference_df = covid_df.groupby('location', as_index=False).mean()[reference_col]","6050b3ef":"# If I use 'today' instead of 'yesterday' I need to run the notebook after around 2 p.m. CET\n# when many countries have updated the numbers. \n# To make sure it works at any time, I include here the date of one day ago\n\ntoday = datetime.now().date()\ntoday = pd.Timestamp(today)\n\nyesterday = datetime.now().date() - timedelta(days = 1) # This returns a Date time\nyesterday = pd.Timestamp(yesterday)\n\ncovid_now = covid_df[covid_df.date == yesterday].copy()","51200ad7":"register_matplotlib_converters()\n\nplt.figure(figsize = (8,6))\nax1 = sb.lineplot(data = covid_df[covid_df.location == 'World'], x = 'date', y = 'total_cases');\nsb.lineplot(data = covid_df[covid_df.location == 'World'], x = 'date', y = 'total_deaths');\n\nplt.title('Total number of Covid Cases and Deaths in the World')\nplt.xlabel('Date')\nplt.ylabel('Number')\n\nylocs, labels = plt.yticks()\nplt.yticks(ylocs, [f\"{num:,}\" for num in ylocs[:-1]]);\nplt.ylim(-300000, ylocs[-1])\n\nax1.legend(['Covid Cases', 'Covid Deaths']);","29fbfcdf":"covid_wrl_time = covid_df.groupby(['date', 'continent'], as_index = False)['total_cases'].sum()\ncovid_wrl_time.tail(12)","ca6f5065":"covid_wrl_time = covid_df.groupby(['date', 'continent'], as_index = False)['total_cases'].sum()\n\n# Get the index of the most current entry for Europe (to drop)\nindex_to_drop = covid_wrl_time[(covid_wrl_time.date == today) & (covid_wrl_time.continent == 'Europe')].index\n\n# Drop the incorrent entry\ncovid_wrl_time.drop(index = index_to_drop, inplace=True)\n\n\nplt.figure(figsize = (14,8))\nsb.lineplot(x=\"date\", y=\"total_cases\", hue = 'continent', err_style = None, data=covid_wrl_time);\nplt.title('Evolution of Total Covid Cases per Continent')\nplt.xlabel('Date')\nplt.ylabel('Total Cases');","d68cbdf6":"plt.figure(figsize = (16,10))\nplt.subplots_adjust(top = 0.90, bottom=0.10, hspace=0.4, wspace=0.2)\n\nplt.subplot(2,2,1)\nbin_size = 0.3\nbin_edges = 10 ** np.arange(0, np.log10(covid_now.total_cases.max()) + bin_size, bin_size)\nplt.hist(data = covid_now, x = 'total_cases', bins = bin_edges);\nplt.xscale('log')\nticks_locs = [1, 10, 30, 100, 300, 1000, 3000, 10000, 30000, 100000, 300000, 1000000]\nplt.xticks(ticks_locs, ticks_locs, rotation = 90);\nplt.title('Distibution of the total number of Covid cases in the world')\nplt.xlabel('Number of Covid Cases')\n\nbin_size = 0.2\n\nplt.subplot(2,2,2)\nbin_edges = 10 ** np.arange(0, np.log10(covid_now.new_cases.max()) + bin_size, bin_size)\nplt.hist(data = covid_now, x = 'new_cases', bins = bin_edges);\nplt.xscale('log')\nticks_locs = [1, 3, 10, 30, 100, 300, 1000, 3000, 10000, 30000]\nplt.xticks(ticks_locs, ticks_locs, rotation = 90);\nplt.title('Distibution of the number of new Covid cases in the world today')\nplt.xlabel('Number of New Cases Today')\n\nplt.subplot(2,2,3)\nbin_edges = 10** np.arange(0, np.log10(covid_now.total_deaths.max()) + bin_size, bin_size)\nplt.hist(data = covid_now, x = 'total_deaths', bins = bin_edges);\nplt.xscale('log')\nticks_locs = [1, 3, 10, 30, 100, 300, 1000, 3000, 10000, 30000, 100000]\nplt.xticks(ticks_locs, ticks_locs, rotation = 90);\nplt.title('Distibution of the number of total deaths in the world due to Covid')\nplt.xlabel('Number of Deaths due to Covid')\n\nplt.subplot(2,2,4)\nbin_edges = 10 ** np.arange(0, np.log10(covid_now.new_deaths.max()) + bin_size, bin_size)\nplt.hist(data = covid_now, x = 'new_deaths', bins = bin_edges);\nplt.xscale('log')\nticks_locs = [1, 3, 10, 30, 100, 300, 1000, 3000]\nplt.xticks(ticks_locs, ticks_locs, rotation = 90);\nplt.title('Distibution of the number of new deaths in the world due to Covid today')\nplt.xlabel('Number of New Deaths due to Covid Today');","edcc92e3":"# Get the maximum applied stringency index per country\nmax_stringency_idx = covid_df.groupby('location', as_index = False)['stringency_index'].max()\nmax_stringency_idx.sort_values(by = 'stringency_index', ascending = False, inplace = True)\n\nplt.figure(figsize = (10,6))\nbin_edges = np.arange(0, 100 + 5, 5)\nplt.hist(data = max_stringency_idx, x = 'stringency_index', bins = bin_edges);\nplt.xticks(bin_edges);\nplt.title('Distribution of the maximum stringency index')\nplt.xlabel('Maximum Stringency Index')\nplt.ylabel('Number of countries');","b38d36c2":"# Countries that implemented the strictest and the most lenient measures\n\nplt.figure(figsize = (14,8))\nplt.subplots_adjust(top = 0.90, bottom=0.10, hspace=0.9, wspace=0.4)\n\nbase_color = sb.color_palette()[0]\n\nplt.subplot(2,1,1)\nsb.barplot(data = max_stringency_idx.iloc[:20], x = 'location', y = 'stringency_index', color = base_color);\nplt.xticks(rotation = 60);\nplt.title('Countries that implemented the strictest measures against Covid')\nplt.xlabel('Country')\nplt.ylabel('Stringency Index')\n\nplt.subplot(2,1,2)\nsb.barplot(data = max_stringency_idx.dropna().iloc[-20:], x = 'location', y = 'stringency_index', color = base_color);\nplt.xticks(rotation = 60);\nplt.title('Countries that implemented the most lenient measures against Covid')\nplt.xlabel('Country')\nplt.ylabel('Stringency Index');","ef205a47":"# Date two weeks ago\ntwo_weeks_ago = pd.Timestamp((datetime.now() - timedelta(days=14)).date())\n\n# Extract from 'covid_df' the data of the last two weeks\ncovid_df_last_two_weeks = covid_df[covid_df.date >= two_weeks_ago]\n\n# Group by country and calculate the average\ncovid_df_last_two_weeks = covid_df_last_two_weeks.groupby('location', as_index = False)['new_cases_per_million'].mean()\n\n# Sort the DataFrame descending based on the average of new cases per million\ncovid_df_last_two_weeks.sort_values(by = 'new_cases_per_million', ascending = False, inplace = True)\n\n# Plot the most affected countries nowadays based on the average of new cases per million in the last 14 days\nbase_color = sb.color_palette()[0]\n\nplt.figure(figsize = (10, 6))\nsb.barplot(data = covid_df_last_two_weeks.iloc[:20], x = 'location', y = 'new_cases_per_million', color = base_color);\nplt.xticks(rotation = 90);\nplt.title('The Most Affected Countrie in the World at the Moment');\nplt.xlabel('Country');\nplt.ylabel('New Cases per Million');","5d637463":"covid_now.loc[:,'log_total_cases_per_million'] = np.log10(covid_now['total_cases_per_million'])","e52323c2":"g = sb.FacetGrid(data = covid_now, hue = 'continent', height = 6)\ng.map(plt.scatter, 'gdp_per_capita', 'log_total_cases_per_million')\ng.add_legend()\n\nplt.xscale('log')\nxticks_locs = [500, 1000, 3000, 10000, 30000, 100000]\nyticks_labels = [10, 100, 1000, 10000]\nplt.xticks(xticks_locs, xticks_locs);\nplt.yticks([1,2,3,4], yticks_labels);\n\nplt.xlabel('GDP per Capita on log scale')\nplt.ylabel('Total Cases per Million on log scale')\nplt.title('Correlation between Total Covid Cases and the GDP per Capita');","8b7b6eb9":"plt.figure(figsize = (10,6))\n\nax1 = sb.lineplot(data = covid_df[covid_df.location == 'Switzerland'], x=\"date\", y=\"total_cases\")\nsb.lineplot(data = covid_df[covid_df.location == 'Switzerland'], x=\"date\", y=\"total_deaths\")\n\nylocs, labels = plt.yticks()\nplt.yticks(ylocs, [f\"{num:,}\" for num in ylocs[:-1]]);\nplt.ylim(-1000, ylocs[-1])\n\nplt.title('Total number of Covid Cases and Deaths in Switzerland')\nplt.xlabel('Date')\nplt.ylabel('Number')\nax1.legend(['Covid Cases', 'Covid Deaths']);","35e8c1b6":"covid_swiss_df.loc[:,'date'] = covid_swiss_df['date'].apply(lambda x: x.strftime('%Y-%m-%d'))\ncovid_swiss_df.loc[:,'new_cases_MA'] = covid_swiss_df['new_cases_per_million'].rolling(window=14, center=False).mean()","d800bcfc":"plt.figure(figsize = (10, 6))\n\nbase_color = sb.color_palette()[0]\n\nsb.barplot(data = covid_swiss_df[-30:], x = 'date', y = 'new_cases_MA', color = base_color);\n\nplt.title('Rolling 14-Days Average on the New Cases per Million in Switzerland')\nplt.xlabel('Date')\nplt.ylabel('Rolling Average - New Cases per Million')\nplt.xticks(rotation = 90);","6ece634d":"swiss_tests_df = pd.read_csv('..\/input\/swiss-test-data\/swiss-test-data.csv', encoding='utf-16', sep ='\\t')\n\n# There are two entries for each day in the dataset - I will visualize for the previous 60 days\nswiss_tests_df = swiss_tests_df[-120:]\n\n# Display the number of tests performed vs the number of positive cases in the last month\n\nplt.figure(figsize = (18,9))\n\nbaselines = np.zeros(60)\n\n# First category - Datum (60 values - the last 60 days)\n# Second category - Outcome_tests (2 values - Positive or Negative)\ncat2_order = ['Positive', 'Negative']\n\nfor i in range(len(cat2_order)):\n    # isolate the counts of the first category\n    cat2 = cat2_order[i]\n    inner_counts = swiss_tests_df[swiss_tests_df['Outcome_tests'] == cat2][['Datum', 'Number_of_tests']]\n    # then plot those counts on top of the accumulated baseline\n    if i == 0:\n        color = 'red'\n    else:\n        color = (0.2, 0.2, 0.2, 0.4)\n    plt.bar(x = np.arange(60), height = inner_counts['Number_of_tests'].values, bottom = baselines, color = color)\n    baselines += inner_counts['Number_of_tests'].values\n    \nplt.xticks(np.arange(60), swiss_tests_df['Datum'].drop_duplicates().values, rotation = 90)\nplt.legend(cat2_order)\n\nplt.title('Positive vs Negative Test Outcomes')\nplt.xlabel('Date')\nplt.ylabel('Number of Tests');","88e0012d":"### Distribution of total cases, new cases, total deaths, new deaths\n\nIn the next plot, we look at the distribution of total cases and total deaths, new cases and new deaths in the current day. I used a log transformation to look at the data because the data was highly right skewed.\n\nTotal Covid cases data looks aproximately normally distributed on log scale. On log scale, the distribution of new Covid cases in the current day looks bimodal, and the distributions of total Covid deaths and new Covid deaths are right skewed. Population density is normally distributed on log scale.","2250e05f":"### Switzerland - Number of tests done per day vs number of new cases found\n\nThe last plot answers a question that many of my friends had: how many tests does Switzerland do every day? This and the split between positive and negative test results can be seen in the next graph.","3fcf4b78":"### How did the number of total Covid cases and total Covid deaths change over time? Is the trend now still rising or has the spread slowed down?\n\nA new Corona virus was discovered in December 2019 and since then it has infected millions of people. Unfortunately, it doesn't look like the trend has slowed down even after more than half a year; on the contrary, the number of Covid cases and Covid deaths in the world continue to increase.","0aa39b10":"### What is the distribution of the maximum stringency index per country?\n\nAs a response to the current pandemic, many countries implemented restriction measures to limit the spread of Covid. The stringency index is a way to describe the \"strictness\" of the rules applied, on a scale from 0 to 100.","873f63ad":"###  How did the number of Covid cases changed over time in Switzerland?\n\nLet's have a look at the situation in Switzerland (where I live). I start with a visualization on the total number of cases and total deaths.\n\nWe can see that between March and May, the number of Covid cases increased very rapidly in Switzerland, but the measures enforced led to results, such that after May the increase in new Covid cases has slowed down.","f9d859cc":"### What are the Covid 'most affected' countries in the world nowadays, based on the average of new cases per million in the last 14 days?\n\nSince the holiday season starts now and the restrictions are lifted in many countries (the flights are once again running as well), people are looking forward to traveling in the next period. It is still advisable to use precaution and avoid the most affected countries of Covid nowadays.","5aed0107":"### How fast did Covid spread in each continent?\n\nWe can see in the following plot that even if China was the first country to be affected by Covid, Asia had a slow increase until April 2020. This is due to the rapid and strict measures that asian countries implemented initially. Once these measures were relaxed, the spread increased. This is probably also due to the current situation in India, where the numbers have recently started to increase.\n\nEurope had a fast increase since March, when the number of cases in Italy and Spain increased drastically, but the curve seems to have slightly slowed down. North America has currently the highest number of Covid cases, mostly due to the fact that U.S. has more than 2.4 million Covid cases. The Covid spread seems to have reached South America as well, where Brazil is highly affected. Let's just hope that the numbers in Africa will remain low and we won't see a similar pattern there.","090fd770":"After working on this case for several days, I observed the following: for Europe always in the current day, there are less total cases than in the previous day. (This cannot happen.) For example, on June 22nd, there were less cases than on June 21st. However, after a day passes, the total cases number for Europe is updated. For example, on June 23rd, Europe has less cases than on June 22nd, but now June 22nd has more cases than June 21st. I think that, for Europe, the dataset is being updated for the previous day as well. Probably some countries provide the data with delay.\n\nTo avoid displaying this problem in the following plot, just for Europe, I will remove from the dataset the last entry for the current day.","24c79d1a":"### Is there any correlation between the total cases per million inhabitants and the GDP per capita?\n\nThere is a positive correlation between the GDP per capita and the total Covid cases until this date (June 23rd 2020). This is probably because a more developed economy also implies more travel across borders, more meetings, conferences, leading to a higher spread, at least in the first phase. The continent of each country is also depicted in the plot and allows to see easily that most countries in Africa have a lower GDP per capita, but also less infections. In comparison, Europe has higher GDP per capita but also higher Covid cases.","806d1842":"### Let's have a look at which countries implemented the strictest and the most lenient measures based on the stringency index based on the available data","2e4a4866":"### Switzerland - Number of new cases per million calculated based on a 14 days rolling average\n\nThe current restriction in Romania (my home country) is the following: people can enter Romania only if they come from a country that had less then 5 new Covid cases per million on 14 days rolling average basis\n\nI live in Switzerland and I want to find out if I can fly to Romania. Since the rolling average on a 14 days window of new Covid cases per million is less than 5, it looks that I can travel home."}}