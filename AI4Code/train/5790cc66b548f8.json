{"cell_type":{"1733d4be":"code","188b5881":"code","9ca6c7ea":"code","e1d5b619":"code","1ed231cb":"code","84c13a4e":"code","7a9a8911":"code","aca8b073":"code","7d60dbec":"code","a4704f4a":"code","6a2d9c87":"code","405e7e1c":"code","46db6d31":"code","36cf4c7f":"code","f2c9fb16":"code","c9a5c15a":"code","fed0ea62":"code","305be4d5":"code","7956b227":"code","4afddea7":"code","e415f7d1":"code","d4b2c385":"code","84dba4aa":"code","7962946f":"code","cf447d77":"code","05399a23":"code","35483606":"code","58a51b6b":"code","d2d04de5":"code","65e34544":"code","08663336":"code","5138c7a1":"code","457b9203":"code","f446b8a7":"code","cfcfe397":"code","aba4677b":"code","1129282a":"code","551a8d8c":"code","58a8782b":"code","05f80d07":"code","a71edb7a":"code","b7e1fa99":"code","e1b7dfc6":"code","2b77e92a":"code","f93414a3":"code","f8dc4bfe":"code","b62c798e":"code","c9c91e57":"code","c075c13c":"code","14aff6d2":"code","aa82ab4b":"code","ba813c4d":"code","1dbdc93c":"code","21efc8e4":"code","f5f38fe8":"code","5942b251":"code","1d411060":"code","464c78d6":"code","7bd12581":"code","2523eb30":"code","913296b9":"code","d80231b8":"code","42aef37b":"code","c6bc94d4":"code","94010759":"code","23e8a789":"code","a59e15ac":"code","24523d92":"code","c7c9b2d7":"code","2db9653e":"code","8442da32":"code","6030a44f":"code","1dffcf94":"code","1962f034":"code","246cf8bf":"code","e87eb244":"code","9a9dfa64":"code","d4c6dbbd":"code","7884fcf6":"code","30fa3896":"code","55680bcf":"markdown","69bf08e8":"markdown","ce543dc2":"markdown","1d1105fa":"markdown","ad2688dd":"markdown","75490a69":"markdown","ece7771f":"markdown","654dff9f":"markdown","94bd260d":"markdown","64ce66f7":"markdown","d805f410":"markdown","869dbcb9":"markdown","58637df8":"markdown","90a29f72":"markdown","6bba1312":"markdown","8714451e":"markdown","2d577892":"markdown","a42ea279":"markdown","4bd1ba23":"markdown","9005fa0d":"markdown","0b0e65b5":"markdown","8afe8350":"markdown","dd73acff":"markdown","e7f433e0":"markdown","beb83a62":"markdown","b5632a21":"markdown","301d4121":"markdown","341149df":"markdown","5b70a48c":"markdown","dbb4a207":"markdown","c2d23a03":"markdown","b7bbb8fd":"markdown","8e6109e5":"markdown","5a9f7511":"markdown","ffbbe981":"markdown","14fd5ce7":"markdown","7d2ece22":"markdown","dc67018d":"markdown","5feb0b76":"markdown","40d5fb12":"markdown","9bed885b":"markdown","db1979e2":"markdown","24897cf4":"markdown","f0a8129c":"markdown","8b61c6de":"markdown","ee922edc":"markdown","35f5b12b":"markdown"},"source":{"1733d4be":"import numpy as np \nimport pandas as pd \nimport os\nfrom glob import glob\nfrom tqdm import tqdm\nimport seaborn as sns\nsns.set(style = 'dark')\nimport matplotlib.pyplot as plt","188b5881":"train_files_dir = glob('\/kaggle\/input\/siim-isic-melanoma-classification\/jpeg\/train\/*')\ntest_files_dir = glob('\/kaggle\/input\/siim-isic-melanoma-classification\/jpeg\/test\/*')","9ca6c7ea":"train_df = pd.read_csv('\/kaggle\/input\/siim-isic-melanoma-classification\/train.csv')\ntest_df = pd.read_csv('\/kaggle\/input\/siim-isic-melanoma-classification\/test.csv')","e1d5b619":"train_df.head()","1ed231cb":"test_df.head()","84c13a4e":"train_df['sex'].fillna('unkown',inplace = True) # missing value","7a9a8911":"from sklearn.preprocessing import LabelEncoder\nenc = LabelEncoder()","aca8b073":"train_df['sex_enc'] = enc.fit_transform(train_df.sex.astype('str'))\ntest_df['sex_enc'] = enc.transform(test_df.sex.astype('str'))","7d60dbec":"plt.figure(figsize = (12,6))\nsns.countplot(x = 'sex', hue = 'target', data = train_df)","a4704f4a":"train_df.head()","6a2d9c87":"test_df.head()","405e7e1c":"test_df.anatom_site_general_challenge = test_df.anatom_site_general_challenge.fillna('unknown')\ntrain_df.anatom_site_general_challenge = train_df.anatom_site_general_challenge.fillna('unknown')","46db6d31":"train_df['anatom_enc']= enc.fit_transform(train_df.anatom_site_general_challenge.astype('str'))\ntest_df['anatom_enc']= enc.transform(test_df.anatom_site_general_challenge.astype('str'))","36cf4c7f":"train_df.head()","f2c9fb16":"test_df.head()","c9a5c15a":"train_df['age_approx'] = train_df['age_approx'].fillna(train_df['age_approx'].mode().values[0])\ntest_df['age_approx']  = test_df['age_approx'].fillna(test_df['age_approx'].mode().values[0]) # Test data doesn't have any NaN in age_approx","fed0ea62":"train_df['age_enc']= enc.fit_transform(train_df['age_approx'].astype('str'))\ntest_df['age_enc']= enc.transform(test_df['age_approx'].astype('str'))","305be4d5":"plt.figure(figsize = (20,6))\nsns.countplot(x = 'age_approx', hue = 'target', data = train_df)","7956b227":"train_df.head()","4afddea7":"test_df.head()","e415f7d1":"train_df['n_images'] = train_df.patient_id.map(train_df.groupby(['patient_id']).image_name.count())\ntest_df['n_images'] = test_df.patient_id.map(test_df.groupby(['patient_id']).image_name.count())","d4b2c385":"from sklearn.preprocessing import KBinsDiscretizer\ncategorize = KBinsDiscretizer(n_bins = 10, encode = 'ordinal', strategy = 'uniform')\ntrain_df['n_images_enc'] = categorize.fit_transform(train_df['n_images'].values.reshape(-1, 1)).astype(int).squeeze()\ntest_df['n_images_enc'] = categorize.transform(test_df['n_images'].values.reshape(-1, 1)).astype(int).squeeze()","84dba4aa":"plt.figure(figsize = (12,6))\nsns.countplot(x = 'n_images_enc', hue = 'target', data = train_df)","7962946f":"train_df.head()","cf447d77":"test_df.head()","05399a23":"train_images = train_df['image_name'].values\ntrain_sizes = np.zeros(train_images.shape[0])\nfor i, img_path in enumerate(tqdm(train_images)):\n    train_sizes[i] = os.path.getsize(os.path.join('\/kaggle\/input\/siim-isic-melanoma-classification\/jpeg\/train\/', f'{img_path}.jpg'))\n    \ntrain_df['image_size'] = train_sizes\n\n\ntest_images = test_df['image_name'].values\ntest_sizes = np.zeros(test_images.shape[0])\nfor i, img_path in enumerate(tqdm(test_images)):\n    test_sizes[i] = os.path.getsize(os.path.join('\/kaggle\/input\/siim-isic-melanoma-classification\/jpeg\/test\/', f'{img_path}.jpg'))\n    \ntest_df['image_size'] = test_sizes","35483606":"from sklearn.preprocessing import StandardScaler, MinMaxScaler\nscale = MinMaxScaler()\ntrain_df['image_size_scaled'] = scale.fit_transform(train_df['image_size'].values.reshape(-1, 1))\ntest_df['image_size_scaled'] = scale.transform(test_df['image_size'].values.reshape(-1, 1))","58a51b6b":"from sklearn.preprocessing import KBinsDiscretizer\ncategorize = KBinsDiscretizer(n_bins = 10, encode = 'ordinal', strategy = 'uniform')\ntrain_df['image_size_enc'] = categorize.fit_transform(train_df.image_size_scaled.values.reshape(-1, 1)).astype(int).squeeze()\ntest_df['image_size_enc'] = categorize.transform(test_df.image_size_scaled.values.reshape(-1, 1)).astype(int).squeeze()","d2d04de5":"plt.figure(figsize = (12,6))\nsns.countplot(x = 'image_size_enc', hue = 'target', data = train_df)","65e34544":"train_df.head()","08663336":"test_df.head()","5138c7a1":"train_mean_color = pd.read_csv('\/kaggle\/input\/mean-color-isic2020\/train_color.csv')\ntest_mean_color = pd.read_csv('\/kaggle\/input\/mean-color-isic2020\/test_color.csv')","457b9203":"train_df['mean_color'] = train_mean_color.values\ntest_df['mean_color'] = test_mean_color.values","f446b8a7":"from sklearn.preprocessing import KBinsDiscretizer\ncategorize = KBinsDiscretizer(n_bins = 10, encode = 'ordinal', strategy = 'uniform')\ntrain_df['mean_color_enc'] = categorize.fit_transform(train_df['mean_color'].values.reshape(-1, 1)).astype(int).squeeze()\ntest_df['mean_color_enc'] = categorize.transform(test_df['mean_color'].values.reshape(-1, 1)).astype(int).squeeze()","cfcfe397":"plt.figure(figsize = (12,6))\nsns.countplot(x = 'mean_color_enc', hue = 'target', data = train_df)","aba4677b":"train_df['age_id_min']  = train_df['patient_id'].map(train_df.groupby(['patient_id']).age_approx.min())\ntrain_df['age_id_max']  = train_df['patient_id'].map(train_df.groupby(['patient_id']).age_approx.max())\n\ntest_df['age_id_min']  = test_df['patient_id'].map(test_df.groupby(['patient_id']).age_approx.min())\ntest_df['age_id_max']  = test_df['patient_id'].map(test_df.groupby(['patient_id']).age_approx.max())","1129282a":"def show_bar_plot(df, figsize = (12,6)):\n \n    import seaborn as sns\n    import matplotlib.pyplot as plt\n    import numpy as np\n    \n    def show_values_on_bars(axs, h_v=\"v\", space=0.4, v_space = 0.02, figsize = (12,6)):\n        def _show_on_single_plot(ax):\n            if h_v == \"v\":\n                for p in ax.patches:\n                    _x = p.get_x() + p.get_width() \/ 2\n                    _y = p.get_y() + p.get_height()+ v_space\n                    value = float(p.get_height())\n                    ax.text(_x, _y, f'{value:.1f}', ha=\"center\") \n            elif h_v == \"h\":\n                for p in ax.patches:\n                    _x = p.get_x() + p.get_width() + float(space)\n                    _y = p.get_y() + p.get_height()+ v_space\n                    value = int(p.get_width())\n                    ax.text(_x, _y, value, ha=\"left\")\n\n        if isinstance(axs, np.ndarray):\n            for idx, ax in np.ndenumerate(axs):\n                _show_on_single_plot(ax)\n        else:\n            _show_on_single_plot(axs)\n            \n\n#     fig = plt.gcf()\n#     fig.set_size_inches(12, 8)\n    plt.figure(figsize = figsize)\n    sns.set()\n    plt.title('Probability')\n\n    prob = df*100\n    pal = sns.color_palette(palette='Blues_r', n_colors=len(prob))\n    rank = prob.values.argsort().argsort() \n    #g=sns.barplot(x='day',y='tip',data=groupedvalues, palette=np.array(pal[::-1])[rank])\n    br = sns.barplot(prob.index, prob.values, palette=np.array(pal[::-1])[rank])\n    show_values_on_bars(br, \"v\", .50)\n    plt.show()          ","551a8d8c":"def kdeplot( df,col_name, figsize = (12,6)):\n\n    plt.figure(figsize = figsize)\n    sns.kdeplot(df[col_name][df.target==0], shade = True, color = 'b', label = '0')\n    sns.kdeplot(df[col_name][df.target==1], shade = True, color = 'r', label = '1')\n    plt.show()","58a8782b":"train_df['age_approx_mean_enc'] = train_df['age_approx'].map(train_df.groupby(['age_approx'])['target'].mean())\ntest_df['age_approx_mean_enc'] = test_df['age_approx'].map(train_df.groupby(['age_approx'])['target'].mean())","05f80d07":"show_bar_plot(train_df.groupby(['age_approx'])['target'].mean(), (20,10))","a71edb7a":"col_name = 'age_approx'\nkdeplot(train_df,col_name, figsize = (16,8))","b7e1fa99":"col_name = 'age_approx_mean_enc'\nkdeplot(train_df,col_name, figsize = (16,8))","e1b7dfc6":"train_df.head()","2b77e92a":"test_df.head()","f93414a3":"train_df['sex_mean_enc'] = train_df.sex_enc.map(train_df.groupby(['sex_enc'])['target'].mean())\ntest_df['sex_mean_enc'] = test_df.sex_enc.map(train_df.groupby(['sex_enc'])['target'].mean())","f8dc4bfe":"show_bar_plot(train_df.groupby(['sex'])['target'].mean())","b62c798e":"col_name = 'sex_enc'\nkdeplot(train_df,col_name, figsize = (16,8))","c9c91e57":"col_name = 'sex_mean_enc'\nkdeplot(train_df,col_name, figsize = (16,8))","c075c13c":"train_df['n_images_mean_enc'] = train_df['n_images_enc'].map(train_df.groupby(['n_images_enc'])['target'].mean())\ntest_df['n_images_mean_enc'] = test_df['n_images_enc'].map(train_df.groupby(['n_images_enc'])['target'].mean())","14aff6d2":"show_bar_plot(train_df.groupby(['n_images_enc'])['target'].mean())","aa82ab4b":"col_name = 'n_images'\nkdeplot(train_df,col_name, figsize = (16,8))","ba813c4d":"col_name = 'n_images_enc'\nkdeplot(train_df,col_name, figsize = (16,8))","1dbdc93c":"col_name = 'n_images_mean_enc'\nkdeplot(train_df,col_name, figsize = (16,8))","21efc8e4":"train_df['image_size_mean_enc'] = train_df['image_size_enc'].map(train_df.groupby(['image_size_enc'])['target'].mean())\ntest_df['image_size_mean_enc'] = test_df['image_size_enc'].map(train_df.groupby(['image_size_enc'])['target'].mean())","f5f38fe8":"show_bar_plot(train_df.groupby(['image_size_enc'])['target'].mean())","5942b251":"col_name = 'image_size'\nkdeplot(train_df,col_name, figsize = (16,8))","1d411060":"col_name = 'image_size_enc'\nkdeplot(train_df,col_name, figsize = (16,8))","464c78d6":"col_name = 'image_size_mean_enc'\nkdeplot(train_df,col_name, figsize = (16,8))","7bd12581":"train_df['anatom_mean_enc'] = train_df['anatom_enc'].map(train_df.groupby(['anatom_enc'])['target'].mean())\ntest_df['anatom_mean_enc'] = test_df['anatom_enc'].map(train_df.groupby(['anatom_enc'])['target'].mean())","2523eb30":"show_bar_plot(train_df.groupby(['anatom_enc'])['target'].mean())","913296b9":"col_name = 'anatom_enc'\nkdeplot(train_df,col_name, figsize = (16,8))","d80231b8":"col_name = 'anatom_mean_enc'\nkdeplot(train_df,col_name, figsize = (16,8))","42aef37b":"train_df['mean_color_mean_enc'] = train_df['mean_color_enc'].map(train_df.groupby(['mean_color_enc'])['target'].mean())\ntest_df['mean_color_mean_enc'] = test_df['mean_color_enc'].map(train_df.groupby(['mean_color_enc'])['target'].mean())","c6bc94d4":"show_bar_plot(train_df.groupby(['mean_color_enc'])['target'].mean())","94010759":"col_name = 'mean_color'\nkdeplot(train_df,col_name, figsize = (16,8))","23e8a789":"col_name = 'mean_color_enc'\nkdeplot(train_df,col_name, figsize = (16,8))","a59e15ac":"col_name = 'mean_color_mean_enc'\nkdeplot(train_df,col_name, figsize = (16,8))","24523d92":"corr = train_df.corr(method = 'pearson')\ncorr = corr.abs()\ncorr.style.background_gradient(cmap='inferno')","c7c9b2d7":"# plt.figure(figsize = (20,20))\n# sns.heatmap(corr, annot = True)","2db9653e":"corr = test_df.corr(method = 'pearson')\ncorr = corr.abs()\ncorr.style.background_gradient(cmap='inferno')","8442da32":"test_df.columns","6030a44f":"features = [\n            'age_approx',\n#             'age_enc',\n#             'age_approx_mean_enc',\n            'age_id_min',\n            'age_id_max',\n            'sex_enc',\n#             'sex_mean_enc',\n            'anatom_enc',\n#             'anatom_mean_enc',\n            'n_images',\n#             'n_images_mean_enc',\n#             'n_images_enc',\n            'image_size_scaled',\n#             'image_size_enc',\n#             'image_size_mean_enc',\n            'mean_color',\n#             'mean_color_enc', \n#             'mean_color_mean_enc'\n           ]","1dffcf94":"X = train_df[features]\ny = train_df['target']\n\nX_test = test_df[features]","1962f034":"# Load libraries\nfrom pandas import read_csv\nfrom pandas.plotting import scatter_matrix\nfrom matplotlib import pyplot\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.model_selection import cross_val_score\nfrom sklearn.model_selection import StratifiedKFold\nfrom sklearn.metrics import classification_report\nfrom sklearn.metrics import confusion_matrix\nfrom sklearn.metrics import accuracy_score\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.model_selection import RandomizedSearchCV, GridSearchCV\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.discriminant_analysis import LinearDiscriminantAnalysis\nfrom sklearn.naive_bayes import GaussianNB\nfrom sklearn.svm import SVR, SVC\nfrom sklearn.ensemble import RandomForestClassifier, RandomForestRegressor\nfrom xgboost import XGBClassifier, XGBRegressor\nfrom sklearn.linear_model import SGDRegressor, BayesianRidge\nfrom sklearn.metrics import roc_auc_score\nfrom sklearn.model_selection import StratifiedKFold","246cf8bf":"model = XGBRegressor(base_score=0.5, booster=None, colsample_bylevel=1,\n             colsample_bynode=1, colsample_bytree=0.8, gamma=1, gpu_id=-1,\n             importance_type='gain', interaction_constraints=None,\n             learning_rate=0.002, max_delta_step=0, max_depth=10,\n             min_child_weight=1, missing=None, monotone_constraints=None,\n             n_estimators=700, n_jobs=-1, nthread=-1, num_parallel_tree=1,\n             objective='binary:logistic', random_state=0, reg_alpha=0,\n             reg_lambda=1, scale_pos_weight=1, silent=True, subsample=0.8,\n             tree_method=None, validate_parameters=False, verbosity=None)\n\nkfold = StratifiedKFold(n_splits=5, random_state=1001, shuffle=True)\ncv_results = cross_val_score(model, X, y, cv=kfold, scoring='roc_auc', verbose = 3)\ncv_results.mean()","e87eb244":"xgb = XGBRegressor(base_score=0.5, booster=None, colsample_bylevel=1,\n             colsample_bynode=1, colsample_bytree=0.8, gamma=1, gpu_id=-1,\n             importance_type='gain', interaction_constraints=None,\n             learning_rate=0.002, max_delta_step=0, max_depth=10,\n             min_child_weight=1, missing=None, monotone_constraints=None,\n             n_estimators=700, n_jobs=-1, nthread=-1, num_parallel_tree=1,\n             objective='binary:logistic', random_state=0, reg_alpha=0,\n             reg_lambda=1, scale_pos_weight=1, silent=True, subsample=0.8,\n             tree_method=None, validate_parameters=False, verbosity=None)\n\nxgb.fit(X,y)\npred_xgb = xgb.predict(X_test)","9a9dfa64":"feature_important = xgb.get_booster().get_score(importance_type='weight')\nkeys = list(feature_important.keys())\nvalues = list(feature_important.values())\n\ndata = pd.DataFrame(data=values, index=keys, columns=[\"score\"]).sort_values(by = \"score\", ascending=False)\nplt.figure(figsize= (12,10))\nsns.barplot(x = data.score , y = data.index, orient = 'h', palette = 'Blues_r')","d4c6dbbd":"from sklearn.decomposition import PCA\n\nn_components = 2\npca = PCA(n_components=n_components)\nX_pca = pca.fit_transform(X)\n\npca_df = pd.DataFrame({'x_pca_0':X_pca[:,0],\n             'x_pca_1':X_pca[:,1],\n             'y':y})","7884fcf6":"plt.figure(figsize = (10,10))\nsns.scatterplot(\n    x=\"x_pca_0\", y=\"x_pca_1\",\n    hue=\"y\",\n    data=pca_df,\n    legend=\"full\",\n    alpha=0.9\n)","30fa3896":"sub = pd.DataFrame({'image_name':test_df.image_name.values,\n                    'target':pred_xgb})\nsub.to_csv('submission.csv',index = False)","55680bcf":"## Probability of melanoma with respect to Number of Image per Patient","69bf08e8":"# Mean Encoding","ce543dc2":"# Dimension Reduction (PCA)","1d1105fa":"## Probability of melanoma with respect to Anatom General Challege","ad2688dd":"## Sex","75490a69":"## Age","ece7771f":"## After Mean Encoding","654dff9f":"# Image Size ","94bd260d":"## n_images","64ce66f7":"# Scaling Image Size","d805f410":"## Probability of melanoma with respect to Age","869dbcb9":"## After Encoding","58637df8":"Though it is difficult to predict location of melanoma class from  plot but we look carefully we'll be able to notice that there are some regions where there is no melanoma class at all.","90a29f72":"# Prediction","6bba1312":"## Image Size","8714451e":"# Label Encoding","2d577892":"## Plotting Barplot with number","a42ea279":"## Anatom_site_general_challenge","4bd1ba23":"# Plot: Feature Importance","9005fa0d":"# Mean Color","0b0e65b5":"# Images Per Patient","8afe8350":"## Probability of melanoma with respect to Sex","dd73acff":"## Before Mean Encoding","e7f433e0":"# I get rid of some features for best LB score","beb83a62":"## After encoding","b5632a21":"# Categorize Image Size","301d4121":"## Before Mean Encoding","341149df":"## After Mean Encoding","5b70a48c":"# Melanoma Prediction Using Tabular Data\nIn this solely based on feature engineering and using Machine learning Model to detect Skin Cancer. No Deep Learning Model has been used here.\n\n**Special Thank to [oliver](https:\/\/www.kaggle.com\/ogrellier) for sharing some key features in the data**","dbb4a207":"## Sex","c2d23a03":"# Age","b7bbb8fd":"# Selecting Features","8e6109e5":"# Categorize Number of Images Per Patient","5a9f7511":"## After Encoding","ffbbe981":"## Before encoding","14fd5ce7":"# Categorize Mean Color","7d2ece22":"# Min-Max age of Patient","dc67018d":"## Anatom General Challenge","5feb0b76":"## After Mean Encoding","40d5fb12":"## Probability of melanoma with respect to Mean Color","9bed885b":"# Mean Color(Used previously saved data)","db1979e2":"# Mean Encoding is Angel or Devil?\n\nAs you can see mean encoding has some interesting effect on data. But there is a good chnace we will end up overfitting because we're depending on target of train data. What if train and test data have different distribution??? ","24897cf4":"## Probability of melanoma with respect to Image Size","f0a8129c":"## After Mean Encoding","8b61c6de":"# Correlation Matrix\nWe can extract some interesting features from Corr Matrix. I leave that to the reader to find out some tricky features from Corr Matrix. Let me know you find one. \n\n**Spoiler Alert:** You can easily get **.80** just playing with these features","ee922edc":"There might be two possible reasons behind LB score differing from the CV score .\n1. Only 30% test data is used in Public LB\n2. Our Model has been ovefitted\n\nPlease let me know if I can improve my results. \n## Thank You Very Much","35f5b12b":"# Training Xgboost\n## Parameters were tunned using Gridsearch"}}