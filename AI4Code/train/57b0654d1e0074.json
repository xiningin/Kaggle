{"cell_type":{"813a6211":"code","1f0a7324":"code","56604da4":"code","8836a4dc":"code","67a2e76f":"code","607743b9":"code","02e290ed":"code","3cdb6e4d":"code","c1ac9b13":"code","0c995f6f":"code","e71dc578":"code","f325f92c":"code","cccc3fae":"code","e3c9d3eb":"code","e871ef3b":"markdown","b956e19e":"markdown","cf9d9805":"markdown","486a37a5":"markdown","de653698":"markdown","fb64db07":"markdown","2ec3a907":"markdown","9d36e7a8":"markdown","8eb1ccbe":"markdown","92170e91":"markdown","1e7ac0c3":"markdown","ba20eecb":"markdown","c93ddda5":"markdown","14d792b7":"markdown","17c44637":"markdown","a31d68d0":"markdown","13f6ac14":"markdown","9a6c160c":"markdown","34ced055":"markdown","f04b7098":"markdown","c1f18541":"markdown","e1a4ee96":"markdown"},"source":{"813a6211":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","1f0a7324":"# Importing libraries\n\nimport pymongo\nimport hashlib\nimport csv\nimport prettytable","56604da4":"# Function to configure reader\ndef reset_reader():\n\n    f = open('..\/input\/cereal.csv')\n    reader = csv.reader(f)\n\n    # Runs for first time\n    header = next(reader)\n\n    # Changing name of 'name' column to '_id' which will be used as unique ID for MongoDB\n    header[0] = '_id'\n    \n    return reader, header","8836a4dc":"# Function to convert datatypes of certain items specific to 'cereal.csv' data.\ndef changedtype(d):\n    ftype = range(3,len(header))\n    for i in ftype:\n        d[i] = float(d[i])\n    return d","67a2e76f":"# Function to convert string to md5 hash\ndef change_to_hash(mystring):\n    hash_object = hashlib.md5(mystring.encode())\n    return hash_object.hexdigest()","607743b9":"# Making client for pymongo (connection to server)\nclient = pymongo.MongoClient(\"mongodb:\/\/guest_user_1:wpHI8MjmkWbL9aKr@mongocluster1-shard-00-00-kvch7.mongodb.net:27017,mongocluster1-shard-00-01-kvch7.mongodb.net:27017,mongocluster1-shard-00-02-kvch7.mongodb.net:27017\/test?ssl=true&replicaSet=MongoCluster1-shard-0&authSource=admin&retryWrites=true\")\n\n# Defining new database, if database already exist (like in this case), that database will be selected.\n# 'cereals_and_the_collection' is the name of database. Cereal_db is object.\ncereal_db = client['cereals_and_the_collection']\n\n# Defining new collection for cereal_db. Just like database, if collection already exist,will be selected.\n# 'Cereal_Data_1' is the name of collection and cereal_collection is object to call.\ncereal_collection = cereal_db['Cereal_Data_1']","02e290ed":"# reader, header = reset_reader()\n# nam = [] # To store original name of product\n# hashid = [] # To store hash ids\n# flag = 1\n# while flag == 1:\n#     try:\n#         data = next(reader)\n#         nam.append(data[0])\n#         # Converting first column to corresponding hash value\n#         data[0] = change_to_hash(data[0])\n        \n#         hashid.append(data[0])\n        \n#         # Changing datatypes of columns\n#         data = changedtype(data)\n        \n#         # Making dictionary to insert into database\n#         myData = dict(zip(header,data))\n        \n#         # Pusing single row in database\n#         x = cereal_collection.insert_one(myData)\n#     except:\n#         break","3cdb6e4d":"# # Resetting reader to work again from start\n# reader, header = reset_reader()\n\n# # Defining a new collection in DB\n# cereal_collection1 = cereal_db['Cereal_Data_1']\n\n# # Now pushing data at once into DB Collection\n# myData_list = [] # A list containing collection of dictionaries to be pushed into DB\n\n# flag = 1\n# while flag == 1:\n#     try:\n#         data = next(reader)\n        \n#         # Converting first column to corresponding hash value\n#         data[0] = change_to_hash(data[0])\n        \n#         # Changing datatypes of columns\n#         data = changedtype(data)\n        \n#         # Making dictionary to insert into database\n#         myData = dict(zip(header,data))\n        \n#         # Appending dictionary into list\n#         myData_list.append(myData)\n        \n#     except:\n#         break\n        \n# # Pushing data into DB\n# x = cereal_collection1.insert_many(myData_list)\n# print('{} records were inserted into DB.'.format(len(x.inserted_ids)))","c1ac9b13":"# # dictionary to retrieve name of product from hash id\n# id_to_nam_dict = dict(zip(hashid,nam))\n\n# # Pushing 'id_to_nam_dict' dictionary into a new collection\n# ID_2_NAME = cereal_db['Cereal_ID2NAME']\n\n# # inserting records\n# x = ID_2_NAME.insert_one(id_to_nam_dict)","0c995f6f":"query = {'cups':{'$eq' : 0.33}}\nq_data = cereal_collection.find(query)\n\nr,header = reset_reader()\nPT = prettytable.PrettyTable()\nPT.field_names = header\nfor i in q_data:\n    ilist = []\n    for key in header:\n        ilist.append(i.get(key))\n    PT.add_row(ilist)\n\nprint(PT)","e71dc578":"query = {'cups':{'$eq' : 0.67}}\nnewvalues = { \"$set\": { 'cups': 0.75 } }\ncereal_collection.update_many(query,newvalues)","f325f92c":"query = {'cups':{'$eq' : 0.75}}\nq_data = cereal_collection.find(query)\n\nPT = prettytable.PrettyTable()\nPT.field_names = header\n\nfor i in q_data:\n    ilist = []\n    for key in header:\n        ilist.append(i.get(key))\n    PT.add_row(ilist)\n\nprint(PT)","cccc3fae":"query = { 'sodium' : { '$gt' : 150 } }\ncereal_collection.count_documents(query)","e3c9d3eb":"query = { '$and' : [{ 'fat' : { '$eq' : 1 } },{ 'shelf' : { '$eq' : 3 } }]}\n\ncereal_collection.count_documents(query)","e871ef3b":"### Here in queries, these '$eq' and other same notations are Comparison Expression Operators.\n### [Here](https:\/\/docs.mongodb.com\/manual\/meta\/aggregation-quick-reference\/#comparison-expression-operators) is the reference.\n","b956e19e":"## Print count of entries where sodium >150 using db query.","cf9d9805":"\n## STEP 3: Create Database User\n\n### User created in this step with password will be used for authentication of your client to read and write data from\/in database. For this step, click on security tab as shown below:\n![](https:\/\/i.imgur.com\/lzu1rsT.png)\n\n### Click on Add New User Tab\n![](https:\/\/i.imgur.com\/KSIDJ8F.png)\n\n### Fill Details in the form\n![](https:\/\/i.imgur.com\/axYirJz.png)\n\n### You can choose user previlages also. You can make more than one user if you need, with different privilages.","486a37a5":"### Pushing each row at a time into DB","de653698":"## STEP 4: WhiteList your IP\n### Click on IP Whitelist tab\n![](https:\/\/i.imgur.com\/Bzk2olW.png)\n\n### Click on Add IP Address button\n![](https:\/\/i.imgur.com\/2z1knBv.png)\n\n### You will be allowed to access database only by whitelisted IP's. If you have static IP, you need to specify that IP as shown below. If you have dynamic IP (for most cases), just click on 'Allow Access from Anywhere' button and click on 'Confirm' Button\n![](https:\/\/i.imgur.com\/jHI28Bl.png)\n\n### Once it is done, Now you are ready to connect to your cluster from notebook.","fb64db07":"## From the DB update the cups value to 0.75 where the cup value is 0.67","2ec3a907":"### Pushing all data at once into DB in a new collection","9d36e7a8":"## Query to retrieve all the entries from DB where the cups value == 0.33","8eb1ccbe":"## STEP 2: Create new cluster\n### Second step is to create a cluster. You will see a page like this where you need to choose few things.\n![](https:\/\/i.imgur.com\/0FSHL97.png)\n\n### Good thing is that first cluster is free forever.\n![](https:\/\/i.imgur.com\/cbliRzq.png)\n\n### Default setting are good enough to work with however you have choices like Cloud Service provider and it's region, however, you can choose only those regions where free tier is available. Try to choose regions where latency is low. You may also rename your cluster.\n\n![](https:\/\/i.imgur.com\/yyyUMdj.png)\n\n### Click on create cluster below\n![](https:\/\/i.imgur.com\/T4uRjik.png)","92170e91":"# Step by Step tutorial to configure & use MongoDB Atlas with Jupyter Notebook","1e7ac0c3":"### In current tutorial, 'pymongo' library is used to work with MongoDB. This notebok will show you two data insertion methods into DB, making query, updating the database based on query etc. \n\n### Apart from MongoDB, few other things are also illustrated like reading data, making dictionary etc.","ba20eecb":"## Pushing data into DB\n### Data is actually pushed into a collection, not exactly into DB. Each database may contain more than one collection.\n\n### Data is pushed in DB by two methods, each row at once or all data at once. Both methods are demonstrated below.\n\n#### Note: For current user of DB, data writing is prohibited so if you want to run commands below, you need to make your seperate account on MongoDB Atlas Cloud. However, query can be made and executed on already existing database.","c93ddda5":"> #  Reading data from the csv file","14d792b7":"## STEP 5: Connecting to Cluster via Jupyter Notebook\n### Click on Connect button as shown below\n![](https:\/\/i.imgur.com\/Cs4RlYr.png)\n\n### After clicking on the Connect button, following window will open\n![](https:\/\/i.imgur.com\/Fp33jwH.png)\n\n### In this window you need to select highlighted option i.e. 'Connect Your Application'.\n### After Clicking on this option following window will open.\n![](https:\/\/i.imgur.com\/QXwPhSd.png)\n\n### Now, first you should check your driver details to avoid any compatibility issues. Link is given below.\n### [Check Compatibility](https:\/\/docs.mongodb.com\/ecosystem\/drivers\/driver-compatibility-reference\/#python-driver-compatibility)\n\n### For most of the time 'standard connection string' works. A standard connection string looks like below:\n### -----------------------------------------------------------------------------------------------------------------------------------------------------\n#### mongodb:\/\/my_user_1:[PASSWORD]>\/@mycluster-shard-00-00-+++++.mongodb.net:27017,mycluster-shard-00-01-+++++.mongodb.net:27017,mycluster-shard-00-02-+++++.mongodb.net:27017\/test?ssl=true&replicaSet=MyCluster-shard-0&authSource=admin&retryWrites=true\n### -----------------------------------------------------------------------------------------------------------------------------------------------------","17c44637":"## Function to create md5 hash on one of the most intuitive column in the data","a31d68d0":"## Given reference contain various examples of MongoDB operations.\n--------------------------\n### [MongoDB Tutorials](http:\/\/www.w3schools.com\/python\/python_mongodb_getstarted.asp)\n--------------------------","13f6ac14":"### After creating cluster you will see this page for a while\n![](https:\/\/i.imgur.com\/ejQoiNI.png)\n\n### Once clusters are deployed, you will see a page like this\n![](https:\/\/i.imgur.com\/KASYKLL.png)","9a6c160c":"### Username is already present in string. You just have to change [PASSWORD] with the password made for user in step 3. Now, we are good to go for programming. ","34ced055":"## STEP 1: Register to MongoDB cloud services\n### [Link to MongoDB Atlas registration page](https:\/\/cloud.mongodb.com\/user#\/atlas\/register\/accountProfile)\n\n![](https:\/\/i.imgur.com\/GvLXQnh.png)","f04b7098":"## Defining Mongo Client, Creating Database and Creating Collection","c1f18541":"## After successful registration, you will get a nice welcome message\n![](https:\/\/i.imgur.com\/PkfXbrO.png)\n\n## Just Close it!","e1a4ee96":"## Print count of entries where fat == 1 and shelf == 3"}}