{"cell_type":{"dc18bcc1":"code","b1f8f020":"code","72592fea":"code","724e526b":"code","2e99b9f5":"code","361a3c74":"code","8cb62165":"code","8713954b":"code","9560990f":"code","f84e1204":"code","928e984a":"code","ca949529":"code","fd8391e3":"code","a7fd8740":"code","459ee3a0":"code","5eea9932":"code","0d1bbd16":"code","f9a574cd":"code","54e64d81":"code","cac3457c":"code","5459025e":"markdown","603999e5":"markdown","f757141d":"markdown","bd8acacf":"markdown","0020846c":"markdown","f439b486":"markdown","72cf9c82":"markdown","6fcf8368":"markdown","a7fb14b6":"markdown","9e13c893":"markdown","2ab081f7":"markdown","e5ad22ea":"markdown","b94852ae":"markdown","146c9843":"markdown","a82656c0":"markdown","50efb13b":"markdown","bfa11838":"markdown","99016e60":"markdown","46f6f4ec":"markdown","499195d1":"markdown","bbdc10fb":"markdown","9f499daf":"markdown","fc4803fb":"markdown","2033288c":"markdown"},"source":{"dc18bcc1":"import matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\nimport re\nimport seaborn as sns\n\nsns.set_theme(style=\"darkgrid\")","b1f8f020":"df = pd.read_csv('..\/input\/brasil-cmara-de-so-paulo-votao-20122020\/camara_municipal_sp_sessoes_12_20.csv')\nname = pd.read_csv('..\/input\/brasil-cmara-de-so-paulo-votao-20122020\/nomes.csv')","72592fea":"print(df.shape)\nprint(df.isnull().sum())\nprint(df.info())","724e526b":"df['tipo_votacao'].unique()","2e99b9f5":"df[df['tipo_votacao'] == 'Simb\u00f3lica'].shape","361a3c74":"df['mes'] = pd.to_datetime(df['data']).dt.month\ndf['ano'] = pd.to_datetime(df['data']).dt.year\ndf['materia'] = df['materia'].fillna('') \ndf['key'] = df['id_votacao'].astype(str) + df['ano'].astype(str)\ndf['resultado'] = df['resultado'].str.lower()\ndf['resultado'] = df['resultado'].str.normalize('NFKD').str.encode('ascii', errors='ignore').str.decode('utf-8') # removes accents\n\ndf_simbolica = df[df['tipo_votacao'] == 'Simb\u00f3lica']\ndf_nominal = df[df['tipo_votacao'] == 'Nominal']\ndf_nominal = df_nominal[~df_nominal['vereador'].isna()] # removes 4 lines in which votes were cancelled\ndf_nominal = df_nominal[~df_nominal['resultado'].isna()] # removes 324 lines in which there were no results for different reasons\n\ndf_nominal.loc[df_nominal['resultado'].str.contains('quoru'), 'resultado'] = 'falta de quorum'","8cb62165":"print(df_nominal.shape)\nprint(df_nominal.isnull().sum())\nprint(df_nominal.info())","8713954b":"df_nominal['primeiro_nome'] = df_nominal['vereador'].str.split(expand=True)[0] # create first name column\ndf_nominal['primeiro_nome'] = df_nominal['primeiro_nome'] \\\n                            .str.normalize('NFKD').str.encode('ascii', errors='ignore').str.decode('utf-8') # removes accents\n\ndf_nominal = pd.merge(df_nominal, name[['first_name', 'classification']] \\\n                     .drop_duplicates(), how='left', left_on='primeiro_nome', right_on='first_name') # add gender column based on name\n\ndf_nominal.loc[df_nominal['primeiro_nome'] == 'SONINHA', 'classification'] = 'F'\nlist_names_nan = df_nominal[df_nominal['classification'].isna()]['primeiro_nome'].unique()\nprint(f'{len(list_names_nan)} unlabeled names: {\", \".join(list_names_nan)}, SONINHA')\ndf_nominal.loc[df_nominal['primeiro_nome'].isin(list_names_nan), 'classification'] = 'M'# manually add gender tags","9560990f":"print('Voters per year:\\n________________')\nyears = df_nominal['ano'].unique()\n\nfor y in years:\n    print(y, ':',  df_nominal[df_nominal['ano'] == y].groupby('vereador').agg({'voto' : 'count'}).shape[0])","f84e1204":"df_nominal.groupby(['vereador']).agg({'voto' : 'count'}).sort_values(by='voto', ascending=False).head(10)","928e984a":"df_nominal.groupby(['partido']).agg({'voto' : 'count'}).sort_values(by='voto', ascending=False).head(10)","ca949529":"classification_dist = df_nominal['classification'].value_counts()\nsns.barplot(x=classification_dist.index, y=classification_dist, palette=['#660066', '#cc5200'])","fd8391e3":"df_gender_per_year = df_nominal.groupby(['ano', 'classification']).agg({'id_parlamentar' : pd.Series.nunique}).reset_index()\n\nsns.lineplot(x='ano', y='id_parlamentar', hue='classification', data=df_gender_per_year, palette=['#cc5200', '#660066'])","a7fd8740":"fig, ax = plt.subplots(figsize=[16,8])\ndf_voting = df_nominal.groupby('key').agg({'presentes' : 'first', 'votacao_sim' : 'first',\n                                           'votacao_nao' : 'first', 'votacao_abstencao' : 'first',\n                                           'resultado' : 'first'}).reset_index()\nvoting = df_voting['resultado'].value_counts()\nsns.barplot(ax=ax, x=voting.index, y=voting)\nprint('{0}: {1}%\\n{2}: {3}%'.format(voting.index[0],\n                                   round(voting[0]*100\/sum(voting), 2),\n                                   voting.index[1],\n                                   round(voting[1]*100\/sum(voting), 2)))","459ee3a0":"full_house_occurance = df_voting[df_voting['presentes'] == 55].shape[0]\nprint('Full house occurance:', full_house_occurance)\nprint('Total sessions:', df_voting.shape[0])","5eea9932":"sns.histplot(df_voting['presentes'])\nprint('Max Voters: ', df_voting['presentes'].max(),\n      '\\nMin Voters: ', df_voting['presentes'].min(),\n      '\\nAvg Voters: ', round(df_voting['presentes'].mean(), 0))","0d1bbd16":"df_voting.sort_values(by='votacao_abstencao', ascending=False)[['key', 'votacao_abstencao']].head(5)","f9a574cd":"print('Law Project:',\n      df_nominal[df_nominal['key'] == '28412020']['materia'].unique()[0],\n      '\\n\\nMatter:',\n      df_nominal[df_nominal['key'] == '28412020']['ementa'].unique()[0])","54e64d81":"df_nominal[df_nominal['key'] == '28412020'][['vereador', 'partido', 'voto']].sort_values(by=['voto', 'partido'])","cac3457c":"fig, ax = plt.subplots(figsize=[12,6])\n\ndf_PL_274_2018 = df_nominal[df_nominal['key'] == '28412020']['voto'].value_counts()\n\nsns.barplot(ax=ax, x=df_PL_274_2018.index, y=df_PL_274_2018)\nprint('Result:',df_nominal[df_nominal['key'] == '28412020']['resultado'].unique()[0])\nprint('\\n{0}: {1}%\\n{2}: {3}%\\n{4}: {5}%'.format(df_PL_274_2018.index[0],\n                                   round(df_PL_274_2018[0]*100\/sum(df_PL_274_2018), 2),\n                                   df_PL_274_2018.index[1],\n                                   round(df_PL_274_2018[1]*100\/sum(df_PL_274_2018), 2),\n                                   df_PL_274_2018.index[2],\n                                   round(df_PL_274_2018[2]*100\/sum(df_PL_274_2018), 2)))","5459025e":"# 1. Introduction <a id=\"Introduction\"><\/a> <br> \nThe City Chamber of S\u00e3o Paulo is the legislative body of the city of S\u00e3o Paulo. Every four years the City Councilors are elected by the population and responsible for voting for different matters, including law projects that will influence the life of S\u00e3o Paulo's citizens. Considering S\u00e3o Paulo is the biggest city in Latin America it is of great interest to keep track of how the legislative work has been done.\n\n## Basic Info\nThe City Chamber of S\u00e3o Paulo is composed of 55 City Councilors with a mandate of four years. But the same **City Councilor** can be elected **limitlessly**.\n\n### <center>Mandate Structure<\/center>\n\n| Mandate| Years |  \n| ----------- | ----------- |  \n| Current| *2021* - *2024* |  \n| Previous | **2017** - **2020** |\n| Previous | **2013** - **2016** |\n| Previous |   2009 - **2012** * |\n\n*Our dataset contains data from 2012 until 2020.\n\n## <font color=\"purple\">Happy to share this! Please give me your feedback! If you like it <b>UPVOTE<\/b> the code =)<\/font>","603999e5":"Party that voted the most in the past years.","f757141d":"#### City Chamber Spots: 55\nThere should only be 55 different voters each year but there are always more because there are substitute voters eventually representing a missing City Councilor. So we should be careful heading on with the analysis since there isn't an easy way to distinguish City Councilors and substitute voters.","bd8acacf":"This voting is determinig the forbiddance of the sales of plastic bags used by consumers to carry their groceries bought in the city of S\u00e3o Paulo.","0020846c":"How each councilor\/party behaved in this matter","f439b486":"#### Voting\nVoting results.\n\n*PS: Whenever there is a name in the voting column it means that the matter voted was the presidency of the City Chamber.*","72cf9c82":"#### Checking highest abstetion rates\nWhich voting had the highest amount of City Councilors missing?","6fcf8368":" <a id=\"Exploration\"><\/a> <br>\n# 5. Data Exploration","a7fb14b6":"#### Gender proportion year by year.\nWomen are far less present in the City Chamber of S\u00e3o Paulo but it is interesting to notice that in the last 9 years it was in fact a woman who has more votes computed, **Noemi Nonato**.","9e13c893":"In the past 9 years we've had a full house **76 times** which represents only **5.0**% of the voting sessions","2ab081f7":"Most of the voting matters were not approved. But the frequency between approved and not approved matters are similar.","e5ad22ea":"Gender info was added based on name but 11 cases were not in the name dataframe so I looked them up manually there was only one female City Councilor, 'Soninha' so the other names were assigned to classification 'M' (male)","b94852ae":"#### Removing null\nIt seems we have done a good job in removing most of irrelevant null values and the remainder are related to details on the voting subject","146c9843":" <a id=\"DataPrep\"><\/a> <br>\n# 4. Data Prep","a82656c0":" <a id=\"Libraries\"><\/a> <br>\n# 2.Libraries","50efb13b":"#### Presence of voters\nHow often do we have a 'full house'? :)","bfa11838":" <a id=\"Started\"><\/a> <br>\n# 3. Getting to know the dataset...","99016e60":"# 6. Abstetion Cases <a id=\"Abstetion\"><\/a> <br>","46f6f4ec":"#### Voters and parties participation\nMost present City councilor in the past years considering how many votes were computed.","499195d1":"#### Add gender information","bbdc10fb":"#### Types of voting\nThere are some null values and it seems most of them are related to the different types of voting (Simbolic and nominal):\n* Simbolic\n* Nominal","9f499daf":"#### Gender distribution\nOverall distribution.","fc4803fb":"#### Majority missing?\n\nIt is funny to think that a voting that had majority of voters missing got approved.","2033288c":"# Table of Contents:\n\n**1. [Objective and Introduction](#Introduction)** <br>\n**2. [Librarys](#Libraries)** <br>\n**3. [Getting Started](#Started)** <br>\n**4. [Data Prep](#DataPrep)** <br>\n**5. [Explorations](#Exploration)** <br>\n**6. [Case Study](#Abstetion)** <br>"}}