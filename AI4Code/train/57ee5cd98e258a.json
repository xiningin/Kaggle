{"cell_type":{"333c821d":"code","905c52a7":"code","c2b4234c":"code","ffd2034d":"code","b30f1e2f":"code","4108fa53":"code","ffac3a4b":"code","7fa392a4":"code","04f2a445":"code","acb90845":"code","ed91359b":"code","3a31e213":"code","21b3bb07":"code","cc4e6f3a":"code","534b497f":"code","e356543e":"code","bfd61dd5":"code","4a32e3b6":"code","d27d31a5":"code","2d503811":"code","c82bda9c":"code","ebbb08cf":"code","7f25a6e6":"code","60e6a7a9":"code","3b50d07c":"code","6ce9b208":"markdown","3ce91864":"markdown","87226600":"markdown","a30db6ef":"markdown","f735406c":"markdown","cdafd79f":"markdown","ab1cc2f4":"markdown","d8014b29":"markdown","931169b6":"markdown","7d3e724b":"markdown","68c9acfa":"markdown","04d30440":"markdown","b2ce1082":"markdown","38a01ae7":"markdown"},"source":{"333c821d":"# ----------------------------\n#\u00a0BASE\nimport numpy as np \nimport pandas as pd \nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport datetime as dt\n\n# ----------------------------\n#\u00a0TREEMAP\n# pip install squarify\nimport squarify  \n\n# ----------------------------\n#\u00a0CONFIGURATION\nimport warnings\nwarnings.filterwarnings(\"ignore\")\nwarnings.simplefilter(action='ignore', category=FutureWarning)\n\npd.set_option('display.max_columns', None)\npd.options.display.float_format = '{:.2f}'.format","905c52a7":"raw9 = pd.read_excel(\"..\/input\/online-retail-ii-dataset\/online_retail_II.xlsx\", sheet_name = \"Year 2009-2010\")\nraw10 = pd.read_excel(\"..\/input\/online-retail-ii-dataset\/online_retail_II.xlsx\", sheet_name = \"Year 2010-2011\")\ndf1 = raw9.copy()\ndf2 = raw10.copy()","c2b4234c":"(df1.shape, df2.shape)","ffd2034d":"df2","b30f1e2f":"print(\"2009-2010\")\nprint(\"Missing Frequency: \\n\")\nprint(df1.isnull().sum().sort_values(ascending = False), \"\\n\")\nprint(\"Missing Proportion: \\n\")\nprint((df1.isnull().sum() \/ df1.shape[0]).sort_values(ascending = False))\nprint(\"\")\nprint(\"2010-2011\")\nprint(\"Missing Frequency: \\n\")\nprint(df2.isnull().sum().sort_values(ascending = False), \"\\n\")\nprint(\"Missing Proportion: \\n\")\nprint((df2.isnull().sum() \/ df2.shape[0]).sort_values(ascending = False))","4108fa53":"# Remove Missing Values\ndf1.dropna(inplace = True)\ndf2.dropna(inplace = True)","ffac3a4b":"# 2009-2010\ndf1.describe([0.01, 0.05, 0.10, 0.20, 0.90, 0.95, 0.99]).T","7fa392a4":"# 2010-2011\ndf2.describe([0.01, 0.05, 0.10, 0.20, 0.90, 0.95, 0.99]).T","04f2a445":"df1 = df1[~df1[\"Invoice\"].str.contains(\"C\", na = False)]\ndf2 = df2[~df2[\"Invoice\"].str.contains(\"C\", na = False)]","acb90845":"df1.describe([0.01, 0.05, 0.10, 0.20, 0.90, 0.95, 0.99]).T","ed91359b":"df2.describe([0.01, 0.05, 0.10, 0.20, 0.90, 0.95, 0.99]).T","3a31e213":"df1[[\"Quantity\", \"Price\"]].boxplot();","21b3bb07":"df2[[\"Quantity\", \"Price\"]].boxplot()","cc4e6f3a":"print(\"2009-2010: Min Date\", df1[\"InvoiceDate\"].min(), \"Max Date\", df1[\"InvoiceDate\"].max())\nprint(\"2010-2011: Min Date\", df2[\"InvoiceDate\"].min(), \"Max Date\", df2[\"InvoiceDate\"].max())","534b497f":"recency1 = (dt.datetime(2010, 12, 9) - df1.groupby(\"Customer ID\").agg({\"InvoiceDate\":\"max\"})).rename(columns = {\"InvoiceDate\":\"Recency\"})\nrecency2 = (dt.datetime(2011, 12, 9) - df2.groupby(\"Customer ID\").agg({\"InvoiceDate\":\"max\"})).rename(columns = {\"InvoiceDate\":\"Recency\"})\n\nrecency1[\"Recency\"] = recency1[\"Recency\"].apply(lambda x: x.days)\nrecency2[\"Recency\"] = recency2[\"Recency\"].apply(lambda x: x.days)\n\nrecency2.head()","e356543e":"freq1 = df1.groupby(\"Customer ID\").agg({\"InvoiceDate\":\"nunique\"}).rename(columns={\"InvoiceDate\": \"Frequency\"})\nfreq2 = df2.groupby(\"Customer ID\").agg({\"InvoiceDate\":\"nunique\"}).rename(columns={\"InvoiceDate\": \"Frequency\"})\n\nfreq2","bfd61dd5":"df1[\"TotalPrice\"] = df1[\"Quantity\"] * df1[\"Price\"]\ndf2[\"TotalPrice\"] = df2[\"Quantity\"] * df2[\"Price\"]\n\nmonetary1 = df1.groupby(\"Customer ID\").agg({\"TotalPrice\":\"sum\"}).rename(columns={\"TotalPrice\":\"Monetary\"})\nmonetary2 = df2.groupby(\"Customer ID\").agg({\"TotalPrice\":\"sum\"}).rename(columns={\"TotalPrice\":\"Monetary\"})\n\nmonetary2.head()","4a32e3b6":"rfm1 = pd.concat([recency1, freq1, monetary1],  axis=1)\nrfm2 = pd.concat([recency2, freq2, monetary2],  axis=1)\n\nrfm2.head()","d27d31a5":"rfm1[\"RecencyScore\"] = pd.qcut(rfm1[\"Recency\"], 5, labels = [5, 4 , 3, 2, 1])\nrfm2[\"RecencyScore\"] = pd.qcut(rfm2[\"Recency\"], 5, labels = [5, 4 , 3, 2, 1])\n\nrfm1[\"FrequencyScore\"]= pd.qcut(rfm1[\"Frequency\"].rank(method=\"first\"),5, labels=[1,2,3,4,5])\nrfm2[\"FrequencyScore\"]= pd.qcut(rfm2[\"Frequency\"].rank(method=\"first\"),5, labels=[1,2,3,4,5])\n\nrfm1[\"MonetaryScore\"] = pd.qcut(rfm1['Monetary'], 5, labels = [1, 2, 3, 4, 5])\nrfm2[\"MonetaryScore\"] = pd.qcut(rfm2['Monetary'], 5, labels = [1, 2, 3, 4, 5])\n\nrfm2.head()","2d503811":"# RFM Scores: Category\nrfm1[\"RFM_SCORE\"] = (rfm1['RecencyScore'].astype(str) + \n                     rfm1['FrequencyScore'].astype(str) + \n                     rfm1['MonetaryScore'].astype(str))\n\nrfm2[\"RFM_SCORE\"] = (rfm2['RecencyScore'].astype(str) + \n                     rfm2['FrequencyScore'].astype(str) + \n                     rfm2['MonetaryScore'].astype(str))\n\nrfm2.head()","c82bda9c":"seg_map = {\n    r'[1-2][1-2]': 'Hibernating',\n    r'[1-2][3-4]': 'At Risk',\n    r'[1-2]5': 'Can\\'t Loose',\n    r'3[1-2]': 'About to Sleep',\n    r'33': 'Need Attention',\n    r'[3-4][4-5]': 'Loyal Customers',\n    r'41': 'Promising',\n    r'51': 'New Customers',\n    r'[4-5][2-3]': 'Potential Loyalists',\n    r'5[4-5]': 'Champions'\n}\n\nrfm1['Segment'] = rfm1['RecencyScore'].astype(str) + rfm1['FrequencyScore'].astype(str)\nrfm1['Segment'] = rfm1['Segment'].replace(seg_map, regex=True)\n\nrfm2['Segment'] = rfm2['RecencyScore'].astype(str) + rfm2['FrequencyScore'].astype(str)\nrfm2['Segment'] = rfm2['Segment'].replace(seg_map, regex=True)\n\nrfm2.head()","ebbb08cf":"rfmStats1 = rfm1[[\"Segment\",\"Recency\",\"Frequency\", \"Monetary\"]].groupby(\"Segment\").agg([\"mean\",\"median\",\"count\", \"std\"])\nrfmStats1.columns = rfmStats1.columns.map('_'.join).str.strip('|')\nrfmStats1","7f25a6e6":"rfmStats2 = rfm2[[\"Segment\",\"Recency\",\"Frequency\", \"Monetary\"]].groupby(\"Segment\").agg([\"mean\",\"median\",\"count\", \"std\"])\nrfmStats2.columns = rfmStats2.columns.map('_'.join).str.strip('|')\nrfmStats2","60e6a7a9":"plt.figure(figsize = (25,8))\nsquarify.plot(sizes=rfmStats1.Recency_count, label=rfmStats1.index, \n              color=[\"red\",\"orange\",\"blue\", \"forestgreen\", \"yellow\", \"purple\", \"cornsilk\",\"royalblue\", \"pink\", \"brown\"], alpha=.4 )\nplt.suptitle(\"Treemap: Number of Customers \\n 2009-2010\", fontsize=25);\n","3b50d07c":"plt.figure(figsize = (25,8))\nsquarify.plot(sizes=rfmStats2.Recency_count, label=rfmStats2.index, \n              color=[\"red\",\"orange\",\"blue\", \"forestgreen\", \"yellow\", \"purple\", \"cornsilk\",\"royalblue\", \"pink\", \"brown\"], alpha=.4 )\nplt.suptitle(\"Treemap: Number of Customers \\n 2010-2011\", fontsize=25);","6ce9b208":"<a id='notebooks'><\/a>\n<h1 style=\"color:purple\" >7. My Notebooks<\/h1> \n\n\n<div class=\"row\">\n  <div class=\"col-sm-3\">\n    <div class=\"card\">\n      <div class=\"card-body\" style=\"width: 18rem;\">\n        <h5 class=\"card-title\">Marvel Universe: Civil War<\/h5>\n          <img src=\"https:\/\/i.pinimg.com\/originals\/5d\/02\/9a\/5d029aa478d79c8e7bcc99d020bad47b.jpg\" class=\"card-img-top\" alt=\"...\">\n        <hr>\n        <a href=\"https:\/\/www.kaggle.com\/ekrembayar\/marvel-universe-civil-war\" class=\"btn btn-primary\" style=\"color:white;\">Go to Notebook<\/a>\n      <\/div>\n    <\/div>\n  <\/div>\n  <div class=\"col-sm-3\">\n    <div class=\"card\">\n      <div class=\"card-body\" style=\"width: 18rem;\">\n        <h5 class=\"card-title\">THE LAST DANCE<\/h5>\n          <img src=\"https:\/\/www.kolpaper.com\/wp-content\/uploads\/2020\/05\/The-Last-Dance-Wallpaper-2.jpg\" class=\"card-img-top\" alt=\"...\">\n        <hr>\n        <a href=\"https:\/\/www.kaggle.com\/ekrembayar\/the-last-dance-data-visualization\" class=\"btn btn-primary\" style=\"color:white;\">Go to Notebook<\/a>\n      <\/div>\n    <\/div>\n  <\/div>\n  <div class=\"col-sm-3\">\n    <div class=\"card\">\n      <div class=\"card-body\" style=\"width: 18rem;\">\n        <h5 class=\"card-title\">FBI Data Cleaning<\/h5>\n          <img src=\"http:\/\/idora.gazetevatan.com\/vatanmediafile\/Haber598x362\/2020\/07\/10\/fbi-sosyal-medya-fenomenini-kacirdi--4618794.Jpeg\" class=\"card-img-top\" alt=\"...\">\n        <hr>\n        <a href=\"https:\/\/www.kaggle.com\/ekrembayar\/hadley-wickham-s-tidy-principles-fbi-data-cleaning\" class=\"btn btn-primary\" style=\"color:white;\">Go to Notebook<\/a>\n      <\/div>\n    <\/div>\n  <\/div>\n  <div class=\"col-sm-3\">\n    <div class=\"card\">\n      <div class=\"card-body\" style=\"width: 18rem;\">\n        <h5 class=\"card-title\">Chess EDA with R<\/h5>\n          <img src=\"https:\/\/thebridge.in\/wp-content\/uploads\/2020\/03\/Chess-Image-Hans-India-1280x720.jpg\" class=\"card-img-top\" alt=\"...\">\n        <hr>\n        <a href=\"https:\/\/www.kaggle.com\/ekrembayar\/chess-eda-with-r\" class=\"btn btn-primary\" style=\"color:white;\">Go to Notebook<\/a>\n      <\/div>\n    <\/div>\n  <\/div>\n    ","3ce91864":"<h2 style=\"color:purple\" >Frequency<\/h2> \n","87226600":"<h3 style=\"color:purple\" >If you like the notebook, don\u2019t forget upvote! :)<\/h3> \n","a30db6ef":"<h2 style=\"color:purple\" >Summary Statistics<\/h2> ","f735406c":"**Remove negative values!**\n\nNegative values are returned items.","cdafd79f":"<a id='load'><\/a>\n<h1 style=\"color:purple\" >2. Data<\/h1> ","ab1cc2f4":"<a id='summary'><\/a>\n<h1 style=\"color:purple\" >4. Summary Stats & Outlier Values<\/h1> ","d8014b29":"<h2 style=\"color:purple\" >Monetary<\/h2> \n","931169b6":"\n<h1 style=\"color:purple\" >RFM - Recency Frequency Monetary<\/h1> \n\nRFM is a method used for analyzing customer value. It is commonly used in database marketing and direct marketing and has received particular attention in retail and professional services industries.\n\nRFM stands for the three dimensions:\n\n- **R**ecency \u2013 How recently did the customer purchase?\n- **F**requency \u2013 How often do they purchase?\n- **M**onetary Value \u2013 How much do they spend?\n\nCustomer purchases may be represented by a table with columns for the customer name, date of purchase and purchase value. One approach to RFM is to assign a score for each dimension on a scale from 1 to 10. The maximum score represents the preferred behavior and a formula could be used to calculate the three scores for each customer. For example, a service-based business could use these calculations:\n\n- **Recency** = the maximum of \"10 \u2013 the number of months that have passed since the customer last purchased\" and 1\n- **Frequency** = the maximum of \"the number of purchases by the customer in the last 12 months (with a limit of 10)\" and 1\n- **Monetary** = the highest value of all purchases by the customer expressed as a multiple of some benchmark value\n\nAlternatively, categories can be defined for each attribute. For instance, Recency might be broken into three categories: customers with purchases within the last 90 days; between 91 and 365 days; and longer than 365 days. Such categories may be derived from business rules or using data mining techniques to find meaningful breaks.\n\nOnce each of the attributes has appropriate categories defined, segments are created from the intersection of the values. If there were three categories for each attribute, then the resulting matrix would have twenty-seven possible combinations (one well-known commercial approach uses five bins per attributes, which yields 125 segments). Companies may also decide to collapse certain subsegments, if the gradations appear too small to be useful. The resulting segments can be ordered from most valuable (highest recency, frequency, and value) to least valuable (lowest recency, frequency, and value). Identifying the most valuable RFM segments can capitalize on chance relationships in the data used for this analysis. For this reason, it is highly recommended that another set of data be used to validate the results of the RFM segmentation process. Advocates of this technique point out that it has the virtue of simplicity: no specialized statistical software is required, and the results are readily understood by business people. In the absence of other targeting techniques, it can provide a lift in response rates for promotions.\n\n![image.png](attachment:image.png)\n\n<a id='libraries'><\/a>\n<h1 style=\"color:purple\" >1. Packages<\/h1> ","7d3e724b":"<h2 style=\"color:purple\" >Create RFM Score<\/h2> ","68c9acfa":"<a id='rfm'><\/a>\n<h1 style=\"color:purple\" >5. RFM Analysis<\/h1> \n\n<h2 style=\"color:purple\" >Recency<\/h2> ","04d30440":"\n\n<center> <h1 style=\"background-color:purple; color:white\" >RFM Analysis<\/h1> \n\n<center><img\nsrc=\"https:\/\/s3-eu-west-1.amazonaws.com\/blog.omniconvert.com-media\/blog\/wp-content\/uploads\/2016\/03\/06173334\/feature-img-marketizator-rfm.png\" style=\"width:100%;height:40%;\">\n<\/center>\n    \n<br>    \n    \n<div class=\"list-group\" id=\"list-tab\" role=\"tablist\">\n  <h3 class=\"list-group-item list-group-item-action active\" style=\"background-color:purple; color:white\" data-toggle=\"list\"  role=\"tab\" aria-controls=\"home\">Notebook Content!<\/h3>  \n  <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#libraries\" role=\"tab\" aria-controls=\"profile\" style=\"color:purple\">Import Libraries<span class=\"badge badge-primary badge-pill\" style=\"background-color:steelblue; color:white\">1<\/span><\/a>\n  <a id=\"section2\" class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#load\" role=\"tab\" aria-controls=\"messages\" style=\"color:purple\">Load Data<span class=\"badge badge-primary badge-pill\" style=\"background-color:steelblue; color:white\">2<\/span><\/a>\n  <a class=\"list-group-item list-group-item-action\"  data-toggle=\"list\" href=\"#missing\" role=\"tab\" aria-controls=\"settings\" style=\"color:purple\">Missing Values<span class=\"badge badge-primary badge-pill\" style=\"background-color:steelblue; color:white\">3<\/span><\/a>\n  <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#summary\" role=\"tab\" aria-controls=\"settings\" style=\"color:purple\">Summary Stats & Outlier Values<span class=\"badge badge-primary badge-pill\" style=\"background-color:steelblue; color:white\">4<\/span><\/a> \n  <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#rfm\" role=\"tab\" aria-controls=\"settings\" style=\"color:purple\">RFM<span class=\"badge badge-primary badge-pill\" style=\"background-color:steelblue; color:white\">5<\/span><\/a>\n    <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#visualize\" role=\"tab\" aria-controls=\"settings\" style=\"color:purple\"> Visualize<span class=\"badge badge-primary badge-pill\" style=\"background-color:steelblue; color:white\">6<\/span><\/a>\n    <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#notebooks\" role=\"tab\" aria-controls=\"settings\" style=\"color:purple\"> My Notebooks<span class=\"badge badge-primary badge-pill\" style=\"background-color:steelblue; color:white\">7<\/span><\/a>","b2ce1082":"<a id='visualize'><\/a>\n<h1 style=\"color:purple\" >6. Visualize<\/h1> ","38a01ae7":"<a id='missing'><\/a>\n<h1 style=\"color:purple\" >3. Missing Values<\/h1> "}}