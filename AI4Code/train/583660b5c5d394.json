{"cell_type":{"134c7231":"code","77cf5059":"code","565f5312":"code","133162a6":"code","047da45b":"code","ca949f36":"code","2fc8b8f6":"code","43064eac":"code","18c7b24d":"code","12ef58c3":"code","3273da86":"markdown","c85153a8":"markdown","8e3a1d7c":"markdown","39888593":"markdown","b59335c6":"markdown","488ccd74":"markdown","0f011dbf":"markdown","9e36e15c":"markdown","34032d25":"markdown","e60d7145":"markdown","9e745d91":"markdown","73a4cf42":"markdown","f4b0ea75":"markdown"},"source":{"134c7231":"import numpy as np\nimport pandas as pd\nfrom pandas.io import gbq\nfrom sklearn import datasets, linear_model\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport bq_helper\nCrimes = bq_helper.BigQueryHelper(active_project=\"bigquery-public-data\", dataset_name=\"london_crime\")","77cf5059":"QUERY =\"\"\"\nSELECT major_category, year, sum(value) as number \nFROM  `bigquery-public-data.london_crime.crime_by_lsoa`\ngroup by  major_category,year\norder by  number DESC; \n\"\"\"\ndf = Crimes.query_to_pandas_safe(QUERY)\ndf.head()","565f5312":"criminal_summary = df.groupby('major_category').sum()['number']\ncriminal_summary","133162a6":"explode_sequence = ('0.1,' * len(criminal_summary)).split(',')\nexplode_sequence=[float(item) for item in explode_sequence if item !=\"\"]\n\nplt.pie(criminal_summary,explode=explode_sequence, labels=criminal_summary.index, autopct='%1.2f%%',\n        shadow=False, startangle=90, );\nplt.title(\"London Criminal Events 2008 -2016\");","047da45b":"crimis = (set(df['major_category']))\ncat_crime = dict()\nmin_reg=999\nmin_item=\"\"\nmax_reg=0\nmax_item=\"\"\n\nfor crim in crimis:\n    temp=df[df['major_category'] == crim];\n    X=temp[['year']];\n    val_max = temp.number.max()\n    val_min = temp.number.min()\n    temp['number']=(temp.number-val_min)\/(val_max-val_min);\n    \n    regr = linear_model.LinearRegression()\n    regr.fit(X, temp.number.values)\n    cat_crime[crim] = regr.coef_\n    if regr.coef_ > max_reg:\n        max_reg = regr.coef_\n        max_item = crim\n    if regr.coef_ < min_reg:\n        min_reg = regr.coef_\n        min_item = crim\n        \n   \n\nprint('coef max {}, for the crime \"{}\"'.format(max_reg, max_item))\nprint('coef min {}, for the crime \"{}\"'.format(min_reg, min_item))","ca949f36":"mio_dataset=pd.DataFrame.from_dict(cat_crime, orient='index',columns=['coef_regr'])\nmio_dataset.sort_values('coef_regr')","2fc8b8f6":"mio_dataset.hist();","43064eac":"tempmax=df[df['major_category'] == max_item];\nval_max = tempmax.number.max()\nval_min = tempmax.number.min()\ntempmax['number']=(tempmax.number-val_min)\/(val_max-val_min)\nregrmax = linear_model.LinearRegression()\nregrmax.fit(tempmax[['year']], tempmax.number.values)\ny_maxPredict=regrmax.predict(tempmax[['year']])\n\ntempmin=df[df['major_category'] == min_item];\nval_max = tempmin.number.max()\nval_min = tempmin.number.min()\ntempmin['number']=(tempmin.number-val_min)\/(val_max-val_min)\nregrmin = linear_model.LinearRegression()\nregrmax.fit(tempmin[['year']], tempmin.number.values)\ny_minPredict=regrmax.predict(tempmin[['year']])\n\nX=tempmax[['year']];\n\nplt.figure(figsize=(15, 6))\nplt.scatter(tempmax[['year']],tempmax.number.values,color='red')    \nplt.plot(tempmax[['year']],y_maxPredict,color='red')\n\nplt.scatter(tempmin[['year']],tempmin.number.values, color='green')    \nplt.plot(tempmin[['year']],y_minPredict,color='green')\nplt.xlabel('... Time ...')\nplt.ylabel(\"Crime per Day in standizide format\")\nplt.title('The Crime Category Trend for the increasing \"{}\" and decresing \"{}\" Category'.format(max_item,min_item));","18c7b24d":"tempmax=df[df['major_category'] == max_item];\n\nregrmax = linear_model.LinearRegression()\nregrmax.fit(tempmax[['year']], tempmax.number.values)\ny_maxPredict=regrmax.predict(tempmax[['year']])\n\ntempmin=df[df['major_category'] == min_item];\n\nregrmin = linear_model.LinearRegression()\nregrmax.fit(tempmin[['year']], tempmin.number.values)\ny_minPredict=regrmax.predict(tempmin[['year']])\n\nX=tempmax[['year']];\n\nplt.figure(figsize=(15, 6))\nplt.scatter(tempmax[['year']],tempmax.number.values,color='red')    \nplt.plot(tempmax[['year']],y_maxPredict,color='red')\n\nplt.xlabel('... Time ...')\nplt.ylabel(\"Crime per Year  \")\nplt.title('Trend for the most increasing Category Crime \"{}\"'.format(max_item,min_item));","12ef58c3":"tempmax=df[df['major_category'] == max_item];\n\nregrmax = linear_model.LinearRegression()\nregrmax.fit(tempmax[['year']], tempmax.number.values)\ny_maxPredict=regrmax.predict(tempmax[['year']])\n\ntempmin=df[df['major_category'] == min_item];\nregrmin = linear_model.LinearRegression()\nregrmax.fit(tempmin[['year']], tempmin.number.values)\ny_minPredict=regrmax.predict(tempmin[['year']])\n\nX=tempmax[['year']];\n\nplt.figure(figsize=(15, 6))\n\nplt.scatter(tempmin[['year']],tempmin.number.values, color='green')    \nplt.plot(tempmin[['year']],y_minPredict,color='green')\nplt.xlabel('... Time ...')\nplt.ylabel(\"Crime per Year \")\nplt.title('Trend for the Decreasing Category Crimes \"{}\"'.format(min_item));","3273da86":"Tha aim of this notebook is to analyze the London Crimes events  and identify any seasonal patterns.\n","c85153a8":"### The metric used to define whether the category crime is increasing or decreasing is the linear regression coefficient of number of crimes over the years.\nIf positive, is increasing.\nIf negative  is decreasing.\n\nThe absolute value of the coefficient defines the magnitude of the increase\/decrease. ","8e3a1d7c":"Most of the coefficients are negative or close to zero.\nWhich is a good sign.\nLet's have a look at the worst and the best.","39888593":"## First, let's see the percentage of events for each category","b59335c6":"### Let's see all the results.","488ccd74":"#### The charts of the category crimes with most crimes decrease (with the real value).","0f011dbf":"### Just out of curiosity... let's find the crime category with most crimes decrease and the one with most crimes increase. ","9e36e15c":"#### The charts of the Crime category with most  decrease crimes (with the real value).","34032d25":"#### Let's visualize.","e60d7145":"From the year 2008 to the year 2016 the number of crimes in Drugs category decreased of more of 25 thousands per year.","9e745d91":"### Summary:\n\nOverall, the number of crimes in London is decreasing, there are only two categories of crimes where the number is increasing, which are \"Violence Against the Person\" and \"Other Notifiable Offences\".","73a4cf42":"To compare the linear coefficients for the different sets we need to standardize the data.\nOtherwise, a category with major number of events would have different weight than a category with less events.","f4b0ea75":"## What crimes category is increasing and what is decreasing in London?\n"}}