{"cell_type":{"7dbed98c":"code","54c1d7ee":"code","94b00331":"code","b31bfbd0":"code","0fe29d0d":"code","cbb9cb78":"markdown","9b7a7369":"markdown","b02251e1":"markdown","3bd69bd8":"markdown"},"source":{"7dbed98c":"import pandas as pd\nimport plotly.express as px\n\ncovid_data = pd.read_csv(\"..\/input\/omicron-covid19-variant-daily-cases\/covid-variants.csv\")\ncovid_data.head()","54c1d7ee":"variant_global_totals = covid_data.groupby([\"variant\", \"date\"], as_index=False).sum()\nvariant_global_totals[\"perc_sequences\"] = (\n    100\n    * variant_global_totals[\"num_sequences\"]\n    \/ variant_global_totals[\"num_sequences_total\"]\n)\n\nfig = px.line(\n    variant_global_totals,\n    x=\"date\",\n    y=\"num_sequences\",\n    color=\"variant\",\n    color_discrete_sequence=px.colors.qualitative.Light24,\n    custom_data=[\"perc_sequences\"],\n    markers=True,\n    height=600,\n    width=880,\n    title=\"Progression of COVID-19 Variants<br><sup>(Global Totals)<sup>\",\n)\nfig.update_layout(\n    font_family=\"serif\", plot_bgcolor=\"#fff\", title_font_size=20, title_x=0.5\n)\nfig.update_traces(\n    hovertemplate=\"<i>%{x}:<\/i> <b>%{y}<\/b> (%{customdata[0]:.2f}%)\",\n    marker=dict(symbol=\"square\", size=5),\n)\nfig.update_yaxes(\n    fixedrange=True, gridcolor=\"#ddd\", tickformat=\",\", title=\"Number of Sequences\"\n)\nfig.update_xaxes(fixedrange=True, title=\"Date\")","94b00331":"selected_variants = [\"Omicron\", \"Delta\", \"Alpha\", \"non_who\", \"B.1.177\"]\n\nprint(\n    f\"There are a total of {covid_data['variant'].dropna().nunique()} variants\",\n    \"in the dataset, but we'll now focus on these 5 to keep things manageable:\\n\\n\",\n    selected_variants,\n)\n\ncountry_data = covid_data.groupby([\"location\", \"variant\"], as_index=False).sum()\nmost_affected_countries = (\n    country_data.groupby(\"location\").sum().nlargest(15, columns=\"num_sequences\").index\n)\n\nfig = px.bar(\n    country_data.query(\n        \"location in @most_affected_countries & variant in @selected_variants\"\n    ),\n    y=\"location\",\n    x=\"num_sequences\",\n    color=\"variant\",\n    color_discrete_sequence=[\"#f44\", \"cyan\", \"hotpink\", \"lawngreen\", \"orange\"],\n    height=600,\n    width=860,\n    text=\"num_sequences\",\n    title=f\"Most Affected Countries (Sequence Totals) <br><sup>{selected_variants}<\/sup>\",\n)\nfig.update_layout(\n    font_family=\"serif\",\n    hovermode=\"y unified\",\n    plot_bgcolor=\"#fff\",\n    title_x=0.5,\n    title_font_size=20,\n)\nfig.update_traces(hovertemplate=\"%{x:,}\", texttemplate=\"%{text:,}\", textfont_size=9)\nfig.update_xaxes(gridcolor=\"#ccc\", title=\"Total Number of Sequences\")\nfig.update_yaxes(categoryorder=\"total ascending\", title=\"Country\")","b31bfbd0":"top5_countries_per_variant = pd.concat(\n    [\n        country_data.query(\"variant == @variant\").nlargest(5, \"num_sequences\")\n        for variant in covid_data[\"variant\"].unique()\n    ]\n)\n\nfig = px.bar(\n    top5_countries_per_variant,\n    x=\"num_sequences\",\n    y=\"variant\",\n    color=\"location\",\n    title=\"5 Most Affected Countries per Variant\",\n    text=\"location\",\n    height=1000,\n    width=870,\n)\nfig.update_layout(\n    font_family=\"serif\",\n    hovermode=\"y unified\",\n    plot_bgcolor=\"#fff\",\n    title_x=0.5,\n    title_font_size=20,\n)\nfig.update_traces(cliponaxis=False, hovertemplate=\"%{x:,}\", textfont_size=9, showlegend=False)\nfig.update_xaxes(fixedrange=True, gridcolor=\"#ddd\", title=\"Total Number of Sequences\")\nfig.update_yaxes(categoryorder=\"total ascending\", fixedrange=True, title=\"Variant\")","0fe29d0d":"for variant in selected_variants:\n    data = covid_data.query(\"variant == @variant & perc_sequences > 0\")\n    fig = px.choropleth(\n        data,\n        color=\"num_sequences\",\n        color_continuous_scale=[\"silver\", \"gold\", \"red\"],\n        locations=\"location\",\n        locationmode=\"country names\",\n        animation_frame=\"date\",\n        animation_group=\"location\",\n        title=f\"Progression of the {variant} Variant\",\n        height=540,\n        width=860,\n    )\n    fig.update_geos(showcountries=True, showframe=False)\n    fig.update_layout(\n        dragmode=False,\n        font_family=\"serif\",\n        title_font_size=19,\n        title_x=0.4,\n    )\n    fig.update_coloraxes(cmin=0, cmax=data[\"num_sequences\"].max())\n    fig.show()","cbb9cb78":"# Animations of Variant Progression","9b7a7369":"# Timeline","b02251e1":"The `Delta` variant was by far the most widespread, devastating the second half of 2021; with an average of over 350,000 cases reported daily between August and September 2021.","3bd69bd8":"# Most Affected Countries"}}