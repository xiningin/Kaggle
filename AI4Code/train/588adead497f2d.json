{"cell_type":{"ebef1abb":"code","f92a3e84":"code","126d356e":"code","83bb3884":"code","9cec0132":"code","7e31bbb7":"code","a231da9b":"code","a7fc46d8":"code","7dbbe58e":"code","9b7592ab":"code","b10e70a9":"code","7fe17e09":"code","24461c8b":"code","e729cd32":"code","b14c2da7":"code","8b02b97d":"code","7704ff4c":"code","4a6fbf5d":"code","d0f19fec":"code","7d40739a":"code","c4c401ae":"code","0371fe14":"code","83715be2":"code","fd88e172":"code","cf81c14a":"code","ad05a198":"code","00cb996e":"code","bcc82252":"code","13f459da":"code","f09b293c":"code","8b118440":"code","cd875232":"code","45c88b1a":"code","3823542c":"code","be333492":"code","c0c6c383":"code","dd7f5660":"code","72a84410":"code","7fa9712d":"code","956d4eae":"code","0aad16e5":"code","b7ad6d9e":"code","dfca91b2":"code","93c84910":"code","aff76f74":"code","762bfc60":"code","b7d1a016":"code","1fb4e24b":"code","832efda7":"code","499996b8":"code","0b0cee79":"code","bb5c0d43":"code","a80db9d3":"code","88f30746":"code","e6773a4c":"code","54a37ca2":"code","8365f043":"markdown","5354bb43":"markdown","9e7900ff":"markdown","c3d1b2df":"markdown","80f7feed":"markdown","73b5a46c":"markdown","6a584079":"markdown","7d9d3c62":"markdown","12e5d7ee":"markdown","85154c30":"markdown","d3efcf10":"markdown","0349aef0":"markdown","9db64c81":"markdown","396a8b7a":"markdown","52dcb098":"markdown","dd716a10":"markdown"},"source":{"ebef1abb":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns","f92a3e84":"# Load dataset\ndf_train = pd.read_csv('..\/input\/black-friday\/blackFriday_train.csv')\ndf_train.head()","126d356e":"df_train.shape","83bb3884":"df_test = pd.read_csv('..\/input\/black-friday\/blackFriday_test.csv')\ndf_test.head()","9cec0132":"df_test.shape","7e31bbb7":"# Concat two datasets\ndf = df_train.append(df_test, sort=False)\ndf.shape","a231da9b":"df.head()","a7fc46d8":"df.describe()","7dbbe58e":"df.isnull().sum()\/df.shape[0]*100","9b7592ab":"df.drop([\"User_ID\"], axis=1, inplace=True)\ndf.head()","b10e70a9":"# Convert categorical data into numerical\ndf[\"Gender\"] = df[\"Gender\"].map({'M': 1, 'F':0})\ndf.head()","7fe17e09":"df.Gender.unique()","24461c8b":"# Mapping age variable\nsorted(df.Age.unique())","e729cd32":"age_map = {'0-17':1, '18-25':2, '26-35':3, '36-45':4, '46-50':5, '51-55':6, '55+':7}","b14c2da7":"df[\"Age\"] = df[\"Age\"].map(age_map)\ndf.head()","8b02b97d":"# Map city variable\ndf.City_Category.unique()","7704ff4c":"city = pd.get_dummies(df.City_Category, drop_first=True)\ncity.head()","4a6fbf5d":"# Concat dummy variables to df\ndf = pd.concat([df, city], axis=1)\ndf.head()","d0f19fec":"# Feature Analysis\ndf.groupby([\"Product_ID\"])[\"Product_ID\"].count().sort_values(ascending=False)","7d40739a":"df.isnull().sum()","c4c401ae":"np.where(df.Product_Category_2.isnull())","0371fe14":"df.Product_Category_2","83715be2":"def impute_nan(df,variable):\n    \n    df[variable+\"_random\"]=df[variable]\n    ##It will have the random sample to fill the na\n    random_sample=df[variable].dropna().sample(df[variable].isnull().sum(),random_state=0, replace=True)\n    ##pandas need to have same index in order to merge the dataset\n    random_sample.index=df[df[variable].isnull()].index\n    df.loc[df[variable].isnull(),variable+'_random']=random_sample","fd88e172":"## Impute nan values with random samples\n\nimpute_nan(df, 'Product_Category_2')","cf81c14a":"impute_nan(df, 'Product_Category_3')","ad05a198":"df.head()","00cb996e":"# Impute NaN values in purchase by the average purchase","bcc82252":"avg_purchase = df[\"Purchase\"].mean()\ndf[\"Purchase\"].fillna(avg_purchase, inplace=True)","13f459da":"df.isnull().sum()","f09b293c":"df.drop([\"Product_Category_2\", \"Product_Category_3\"], axis=1, inplace=True)","8b118440":"df.rename(columns={'Product_Category_1':'cat1', 'Product_Category_2_random': 'cat2', 'Product_Category_3_random': 'cat3'}, inplace=True)\ndf.columns","cd875232":"df = df[['Product_ID', 'Gender', 'Age', 'Occupation', 'City_Category',\n       'Stay_In_Current_City_Years', 'Marital_Status',  'B',\n       'C', 'cat1','cat2', 'cat3', 'Purchase']]\ndf.head()","45c88b1a":"# Confirm no nan values \ndf.isnull().sum()","3823542c":"df.drop([\"City_Category\"], axis=1, inplace=True)","be333492":"df.head(2)","c0c6c383":"#Replace symbols\n\ndf[\"Stay_In_Current_City_Years\"].unique()","dd7f5660":"df[\"Stay_In_Current_City_Years\"] = df[\"Stay_In_Current_City_Years\"].str.replace('+', ' ')\ndf[df[\"Stay_In_Current_City_Years\"]=='4 '].head(2)","72a84410":"df.info()","7fa9712d":"df[\"Stay_In_Current_City_Years\"] = df[\"Stay_In_Current_City_Years\"].astype(int)\ndf[\"B\"] = df[\"B\"].astype(int)\ndf[\"C\"] = df[\"C\"].astype(int)","956d4eae":"df.dtypes","0aad16e5":"df_new = df.copy()\ndf_new.head(3)","b7ad6d9e":"df_new.groupby([\"Age\"])[\"Purchase\"].mean().plot(kind = 'line');","dfca91b2":"sns.scatterplot(x=\"Age\", y=\"Purchase\", data=df_new);","93c84910":"sns.lineplot(x=\"Age\", y=\"Purchase\", data=df_new);","aff76f74":"sns.barplot(x=\"Gender\", y=\"Purchase\", data=df_new);","762bfc60":"sns.barplot(x =\"cat1\", y = \"Purchase\",  data=df_new);","b7d1a016":"sns.barplot(x =\"cat2\", y = \"Purchase\",  data=df_new);","1fb4e24b":"sns.barplot(x =\"cat3\", y = \"Purchase\",  data=df_new);","832efda7":"df_new.head(2)","499996b8":"sns.barplot(x=\"Marital_Status\", y=\"Purchase\", data=df_new);","0b0cee79":"sns.relplot(x=\"Marital_Status\", y=\"Purchase\", data=df_new, hue=\"Gender\")","bb5c0d43":"df_new.Occupation.unique()","a80db9d3":"occ_purchase = df_new.groupby([\"Occupation\"])['Purchase'].mean().sort_values()\nplt.figure(figsize=(10,8))\nocc_purchase.plot(kind=\"barh\", color=\"green\");","88f30746":"sns.set()\nplt.figure(figsize=(15,10))\nax = sns.heatmap(df_new.corr(),annot=True,linewidths=.5)","e6773a4c":"df_new.corr()","54a37ca2":"df_new.drop([\"Product_ID\"], axis=1, inplace=True)\ndf_new.head(2)","8365f043":"#### Product ID P00265242, P00025442 and P00110742 are the top 3 bought products.","5354bb43":"##### People with occupation 17, 12 and 15 have the highest purchasing power.","9e7900ff":"##### We found that married male people tend to purchase more.","c3d1b2df":"As user id would not be very helpful for this analysis we will drop it.","80f7feed":"##### Product category 1 and 2 has more deviation in the purchase as compared to the category 3","73b5a46c":"#### Converting data types of the features","6a584079":"### Dealing with NAN Values","7d9d3c62":"##### We can observe that as the age increases, people tend to buy more meaning their purchasing power increases. However, After reaching a certain age(55+ in our case) their purcasing power drops sharply.","12e5d7ee":"* Data\n* Variable\tDefinition\n* User_ID\tUser ID\n* Product_ID\tProduct ID\n* Gender\tSex of User\n* Age\tAge in bins\n* Occupation\tOccupation (Masked)\n* City_Category\tCategory of the City (A,B,C)\n* Stay_In_Current_City_Years\tNumber of years stay in current city\n* Marital_Status\tMarital Status\n* Product_Category_1\tProduct Category (Masked)\n* Product_Category_2\tProduct may belongs to other category also (Masked)\n* Product_Category_3\tProduct may belongs to other category also (Masked)\n* Purchase\tPurchase Amount (Target Variable)","85154c30":"##### We cannot differentiate a person's marital status on the basis of their behavior from the above graph.","d3efcf10":"### Import Libraries","0349aef0":"#### As we have done visual analysis, we can move further to process the data for modelling.","9db64c81":"##### We can see from the above graph that male customer tend to buy more in comparison to the female customers.","396a8b7a":"# Problem Statement\n\nA retail company \u201cABC Private Limited\u201d wants to understand the customer purchase behaviour (specifically, purchase amount) against various products of different categories. They have shared purchase summary of various customers for selected high volume products from last month.\nThe data set also contains customer demographics (age, gender, marital status, city_type, stay_in_current_city), product details (product_id and product category) and Total purchase_amount from last month.\n\nNow, they want to build a model to predict the purchase amount of customer against various products which will help them to create personalized offer for customers against different products.\n\n","52dcb098":"#### As we have null values in Product category 2 and 3 and purchase columns, we will try to impute it with random samples and mean.","dd716a10":"#### Creating checkpoint and continue with the visual analysis"}}