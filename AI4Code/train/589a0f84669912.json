{"cell_type":{"0cdf3bba":"code","1de0d5b0":"code","71727b1b":"code","bb841274":"code","ba8c8e54":"code","8c29d801":"code","808a4568":"code","5b85a397":"code","e902f26a":"code","74e89ff1":"code","bf817ca3":"code","588d8c09":"code","4bea8192":"code","acf6dab8":"code","96ebbb98":"code","48b4f29f":"code","55899feb":"code","c582a8e4":"code","9a9ec14d":"code","1287f7b1":"code","8343930c":"code","21656a4d":"code","a7f04091":"code","fbd7e7f9":"code","83fdd8de":"code","6af9d9ab":"code","a43b6d92":"code","a40aa0e8":"code","6ce80470":"code","bfb60fd1":"code","dcaf745b":"code","11a12d1d":"code","7467f743":"code","dfc9421e":"code","ae690461":"code","f809db97":"code","b1791629":"code","809b228f":"code","611abf03":"code","5e4e8f31":"code","d7bb782c":"code","fee74aae":"code","9b95e44f":"code","5aea7ea5":"code","cde467f4":"code","5af9fdac":"code","4bac282b":"code","c4f9c282":"code","27967b4a":"code","5bc9fa42":"code","c5657f15":"code","bfe5c21b":"code","a55143b5":"code","2d168ec0":"code","0a2c4a12":"markdown","a076442a":"markdown","ec8f2275":"markdown","e46dfd0b":"markdown","0157c298":"markdown","b4075d70":"markdown","f34e5ac1":"markdown","b42bbeca":"markdown","1e9067b3":"markdown","f14009b2":"markdown","18b7ba9a":"markdown","4a46d7c9":"markdown","393229cf":"markdown","42aa3ce2":"markdown","7d8c1f17":"markdown","94e8b6ff":"markdown","7a61569b":"markdown","46e8f892":"markdown","955aa0ef":"markdown","531a78d9":"markdown","ed362d89":"markdown","5eb3eacd":"markdown","a2a205cb":"markdown","f370858e":"markdown","85f99d19":"markdown","93836a85":"markdown","b17cdd91":"markdown","3d31a655":"markdown","e54a638a":"markdown","88ca8bae":"markdown","f62edfa8":"markdown","3c1d5686":"markdown","24809cd0":"markdown","d689f570":"markdown","112c4361":"markdown","6fd9a992":"markdown","db3c7cbb":"markdown","4bc7adf6":"markdown","81169154":"markdown","9300e8fc":"markdown","52c7ec8e":"markdown","cfcff6ff":"markdown","e14bea1e":"markdown"},"source":{"0cdf3bba":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","1de0d5b0":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport warnings\nwarnings.filterwarnings(\"ignore\")","71727b1b":"train_users = pd.read_csv('\/kaggle\/input\/2021ai511ml-classification-group-5\/train_data.csv')\ntest_users = pd.read_csv('\/kaggle\/input\/2021ai511ml-classification-group-5\/test_data.csv')\ndf = pd.concat((train_users, test_users), axis=0, ignore_index=True)","bb841274":"display(df.isnull().sum())","ba8c8e54":"df.drop(\"first_booking_date\", axis = 1, inplace=True)","8c29d801":"df.gender.unique()","808a4568":"df.web_browser.unique()","5b85a397":"df.gender.replace(\"-unknown-\", np.nan, inplace=True)\ndf.web_browser.replace(\"-unknown-\", np.nan, inplace=True)\n\ndf","e902f26a":"plt.figure(figsize=(12,6))\nsns.countplot(x='gender', data=df)\nplt.ylabel('Number of users')\nplt.title('Users gender distribution')\nplt.show()","74e89ff1":"df.age.describe()","bf817ca3":"df.loc[df['age']>1000]['age'].describe()","588d8c09":"df.loc[df['age']<18]['age'].describe()","4bea8192":"df_with_year = df['age'] > 1000\ndf.loc[df_with_year, 'age'] = 2021 - df.loc[df_with_year, 'age']\ndf.loc[df_with_year, 'age'].describe()","acf6dab8":"df.loc[df.age > 95, 'age'] = np.nan\ndf.loc[df.age < 18, 'age'] = np.nan\ndf","96ebbb98":"plt.figure(figsize=(12,6))\nsns.displot(df.age.dropna(), rug=True)\nplt.show()","48b4f29f":"plt.figure(figsize=(12,6))\nsns.countplot(x='target_country', data=df)\nplt.xlabel('Target Country')\nplt.ylabel('Number of Travellers')\nplt.title('Popular Target Countries in the given dataset')\nplt.show()","55899feb":"plt.figure(figsize=(18,6))\ndf_without_NB = df[df['target_country']!='NB']\nsns.countplot(x='target_country', data=df_without_NB, hue='device_used')\nplt.ylabel('Number of Travellers')\nplt.title('Device used v\/s Target country')\nplt.legend(loc = 'upper right')\nplt.show()","c582a8e4":"df_without_NB_US = df_without_NB[df_without_NB['target_country']!='US']\nplt.figure(figsize=(18,6))\nsns.countplot(x='target_country', data=df_without_NB_US, hue='device_used')\nplt.ylabel('Number of Travellers')\nplt.title('Device used vs. Target Country without the US')\nplt.legend(loc = 'upper right')\nplt.show()","9a9ec14d":"plt.figure(figsize=(12,6))\nsns.countplot(x='app_used', data=df_without_NB)\nplt.xlabel('App Used')\nplt.ylabel('Number of travellers')\nplt.title('App used distribution')\nplt.show()","1287f7b1":"plt.figure(figsize=(12,6))\nsns.countplot(x='target_country', data=df_without_NB, hue='app_used')\nplt.xlabel('Target Country')\nplt.ylabel('Number of Travellers')\nplt.title('Destination country based on signup app')\nplt.legend(loc = 'upper right')\nplt.show()","8343930c":"plt.figure(figsize=(20,6))\nsns.countplot(x='web_browser', data=df_without_NB)\nplt.xlabel('Web browser')\nplt.ylabel('Number of Travellers')\nplt.title('Web browser distribution')\nplt.xticks(rotation=90)\nplt.show()","21656a4d":"plt.figure(figsize=(12,6))\nsns.boxplot(y='age' , x='target_country',data=df_without_NB)\nplt.xlabel('Target Country')\nplt.ylabel('Age of Travellers')\nplt.title('Target Country v\/s Age')\nplt.show()","a7f04091":"plt.figure(figsize=(12,6))\nsns.countplot(x='language', data=df_without_NB)\nplt.xlabel('language')\nplt.ylabel('Number of Travellers')\nplt.title('Users language distribution')\nplt.show()","fbd7e7f9":"df_without_NB['account_creation_date'] = pd.to_datetime(df_without_NB['account_creation_date'])\ndf_without_NB['first_activity_time'] = pd.to_datetime((df_without_NB['first_activity_time'])\/\/1000000, format='%Y%m%d')\nplt.figure(figsize=(12,6))\ndf_without_NB.account_creation_date.value_counts().plot(kind='line', linewidth=1.2)\nplt.xlabel('Date')\nplt.title('New account created over time')\nplt.show()","83fdd8de":"df_2013 = df_without_NB[df_without_NB['first_activity_time'] > pd.to_datetime(20130101, format='%Y%m%d')]\ndf_2013 = df_2013[df_2013['first_activity_time'] < pd.to_datetime(20140101, format='%Y%m%d')]\nplt.figure(figsize=(12,6))\ndf_2013.first_activity_time.value_counts().plot(kind='line', linewidth=2)\nplt.xlabel('Date')\nplt.title('First active date in 2013')\nplt.show()","6af9d9ab":"plt.figure(figsize=(20,6))\nsns.countplot(x='marketing_site', data = df_without_NB)\nplt.xlabel('Marketing site')\nplt.ylabel('Number of Travellers')\nplt.title('Marketing site distribution')\nplt.show()","a43b6d92":"plt.figure(figsize=(20,6))\nsns.countplot(x='target_country', data = df_without_NB, hue = 'marketing_site')\nplt.xlabel('Target Country')\nplt.ylabel('Number of travellers')\nplt.title('Marketing Site v\/s destinations')\nplt.legend(loc='upper right')\nplt.show()","a40aa0e8":"plt.figure(figsize=(12,6))\nsns.countplot(x='marketing_type', data=df_without_NB)\nplt.xlabel('Marketing Type')\nplt.ylabel('Number of Travellers')\nplt.title('Marketing Type distribution')\nplt.show()","6ce80470":"user_activity = pd.read_csv(\"\/kaggle\/input\/2021ai511ml-classification-group-5\/user_activity.csv\")\nlen(user_activity.user_id.unique())","bfb60fd1":"display(user_activity.isnull().sum())","dcaf745b":"user_activity.activity_type.unique()","11a12d1d":"user_activity.activity_type.replace('-unknown-', np.nan, inplace=True)\nuser_activity.activity.value_counts().head(10)","7467f743":"user_activity.activity_type.value_counts().head(10)","dfc9421e":"user_activity.activity_detail.value_counts().head(10)","ae690461":"plt.figure(figsize=(18,6))\nsns.countplot(x='device_used', data=user_activity)\nplt.xlabel('Device used')\nplt.ylabel('Number of User Activities')\nplt.title('Device use distribution')\nplt.xticks(rotation=90)\nplt.show()","f809db97":"user_activity_booked = pd.merge(df_without_NB, user_activity, how = 'left', left_on = 'user_id', right_on = 'user_id')\nuser_activity_booked.columns","b1791629":"user_activity_booked.activity.value_counts().head(5)","809b228f":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt","611abf03":"train_users = pd.read_csv('\/kaggle\/input\/2021ai511ml-classification-group-5\/train_data.csv')\ntest_users = pd.read_csv('\/kaggle\/input\/2021ai511ml-classification-group-5\/test_data.csv')\ncountry=pd.read_csv('\/kaggle\/input\/2021ai511ml-classification-group-5\/countries.csv')\ndf = pd.concat((train_users, test_users, country), axis=0, ignore_index=True)\ndf.drop(['first_booking_date','latitude','longitude','country_area','country_specific_lang','levenshtein_distance_lang'], axis=1, inplace=True)","5e4e8f31":"df['account_creation_date'] = pd.to_datetime(df['account_creation_date'])\ndf['first_activity_time'] = pd.to_datetime((df.first_activity_time)\/\/1000000, format='%Y%m%d')\n\ndf['day_account_created'] = df.account_creation_date.dt.day\ndf['month_account_created'] = df.account_creation_date.dt.month\ndf['year_account_created'] = df.account_creation_date.dt.year\ndf['day_first_active'] = df.first_activity_time.dt.day\ndf['month_first_active'] = df.first_activity_time.dt.month\ndf['year_first_active'] = df.first_activity_time.dt.year","d7bb782c":"df.drop( ['account_creation_date', 'first_activity_time'], axis=1, inplace=True)","fee74aae":"df['age'].fillna(-1, inplace=True)","9b95e44f":"categorical_features = ['gender','language','marketing_type','marketing_site','travel_distance','app_used', 'device_used', 'web_browser']\ndf = pd.get_dummies(df, columns=categorical_features)\ndf.set_index('user_id', inplace=True)\ndf","5aea7ea5":"train_data = df.loc[train_users['user_id']]\ntrain_data.reset_index(inplace=True)\ntrain_data.fillna(-1, inplace=True)\n\ny_train = train_data['target_country']\ntrain_data.drop(['target_country', 'user_id'], axis=1, inplace=True)","cde467f4":"from sklearn.preprocessing import LabelEncoder\nenc = LabelEncoder()\nenc_y_train = enc.fit_transform(y_train) \nenc_y_train","5af9fdac":"test_data = df.loc[test_users['user_id']].drop('target_country', axis=1)\ntest_data.reset_index(inplace=True)\nuser_id_test = test_data['user_id']\ntest_data.drop('user_id', axis=1, inplace=True)","4bac282b":"dup_cols = train_data.columns[train_data.columns.duplicated()]\ndup_cols","c4f9c282":"test_data.columns[test_data.columns.duplicated()]","27967b4a":"import xgboost as xgb\nxg_train = xgb.DMatrix(train_data, label=enc_y_train)\n#Specifying the hyperparameters\nparams = {'max_depth': 10,\n    'learning_rate': 1,\n    'n_estimators': 1,\n    'objective': 'multi:softprob',\n    'num_class': 12,\n    'gamma': 0,\n    'min_child_weight': 1,\n    'max_delta_step': 0,\n    'subsample': 1,\n    'colsample_bytree': 1,\n    'colsample_bylevel': 1,\n    'reg_alpha': 0,\n    'reg_lambda': 1,\n    'scale_pos_weight': 1,\n    'base_score': 0.5,\n    'missing': None,\n    'nthread': 4,\n    'seed': 42\n          }\nnum_boost_round = 1\nprint(\"Train a XGBoost model\")\ngbm = xgb.train(params, xg_train, num_boost_round)","5bc9fa42":"y_pred = gbm.predict(xgb.DMatrix(test_data))","c5657f15":"user_ids = []  #list of user_ids\ncountries = []  #list of countries\nfor i in range(len(user_id_test)):\n    temp_user_id = user_id_test[i]\n    user_ids += [temp_user_id] * 1\n    countries += enc.inverse_transform(np.argsort(y_pred[i])[::-1])[:1].tolist()","bfe5c21b":"main_df = pd.DataFrame(np.column_stack((user_ids, countries)), columns=['user_id', 'target_country'])","a55143b5":"main_df","2d168ec0":"main_df.to_csv('submission.csv',index=False)","0a2c4a12":"# Checking for Null Values","a076442a":"So here we concatenate the train, test and country datasets and drop the non-required features.","ec8f2275":"Now, we merge the user statistics from user_activity alongwith those from train dataset in order to start with Predictive Modelling.","e46dfd0b":"No duplicate columns found in train and test datasets.","0157c298":"Now, we find that the travellers travelling to various countries prefer speaking which language.","b4075d70":"Now, we want to explore those users who have made atleast 1 booking.","f34e5ac1":"# **Analysing the user_activity dataset**","b42bbeca":"# Label Encoding :","1e9067b3":"From the above graph, it is clear that irrespective of the target country booked, Mac desktop is the highest used device for booking indicated by the Green colour.\n\nBut, we are not able to visualize the device used by the other countries properly as US has very high number of devices used. \n\nSo. now we try to visualize the devices used by countries except US.","f14009b2":"Setting the Upper bound as 95 and lower bound as 18 and setting the values outside our range as NaN :","18b7ba9a":"As we have seen earlier, here also the Mac Desktop is the most used device among all.","4a46d7c9":"# Training and Testing :","393229cf":"Now, getting info about the most used apps based on the target countries :","42aa3ce2":"Here also, the Mac Desktop remains the most used device in the countries except US, followed by the Windows desktop.","7d8c1f17":"Replacing the unknown values found in the gender and web_browser coluns with NaN :","94e8b6ff":"Checking for Duplicate columns :","7a61569b":"Now, let's see which app is the most used in the Mac desktop.","46e8f892":"As speculated, most activity time with the accounts is in October 2013 and most of the accounts created was also during the same time period(refer previous graph).\n\nHence, the speculations are in sync with the actual data.","955aa0ef":"Here, we have directly converted the account_creation_date to datetime while we convert the first_activity_time to the format YYYY-MM-DD first and then convert it to datetime.","531a78d9":"So, we see that most of the travellers booked their tickets through direct site, followed by bookings via google.","ed362d89":"As we can see that majority of the accounts were created before 2014-01 i.e. in 2013, we now visualize the first activity time of 2013.","5eb3eacd":"# **Data Preprocessing**","a2a205cb":"***As we can see that there are large number of Null values in the column first_booking_date, assuming that it won't create a major impact in data prediction, we are dropping the column.***","f370858e":"Hence, majority of the users speak English.","85f99d19":"As we can see above, maximum number of users travelling are of the age 30.","93836a85":"***Now working on the User Age :***","b17cdd91":"# **Predictive Modelling**","3d31a655":"Now, correcting the mistakenly filled ages by subtracting them from 2021 to get the actual current age :","e54a638a":"As we can see there are \"unknown\" values in the column of gender.","88ca8bae":"Now, we visualize the number of accounts created over time.","f62edfa8":"As we can see above, columns first_booking_date, age and target_country contain the Null values so we are trying to check the unique values in each of them for the missing data.","3c1d5686":"Now, we analyse which marketing site led the travellers to this website.","24809cd0":"Generally, iOS is the most used app in the Mac Desktops but here we can see that Web is the most popular one.","d689f570":"As we can see, the max age that we get in our dataset is 2014 which is not possible; but it might be the case that the user has entered year instead of age. \n\nAlso, the minimum age is 1 which may be the outliers.","112c4361":"As we can see above. majority of the users who have booked their flights are travelling to US. So, maybe those travellers are from US itself.","6fd9a992":"# Observing the properties of different features for Feature Extraction ","db3c7cbb":"We concat the train and test datasets because we want to explore all the users altogether.","4bc7adf6":"Now, we are going to check that inside the most popular app used Web, which is the most popular browser.","81169154":"Now checking for the statistics where age > 1000 i.e. user has entered year instead of age and the year should be greater than 1000.","9300e8fc":"As we can see, in the user_activity dataset, there are 15,501 unique user ids.","52c7ec8e":"Irrespective of target country booked, direct website is the most popular marketing site.","cfcff6ff":"Now, we visualize the age group of the travellers travelling to their respective target countries so that we get a hang of which age group of the travellers prefer travelling to which target country.","e14bea1e":"Hence, we see that Travellers with relatively older age travel to Great Britain(GB) as compared to those travelling to Spain(ES) and Netherlands(NL)."}}