{"cell_type":{"5018e82f":"code","b04fc506":"code","7a44e200":"code","66bde8c7":"code","e27e6068":"code","12c5595e":"code","f14ed80a":"code","0e012f8e":"code","decd2b44":"code","42426137":"code","ab8a40d5":"code","063bc3d3":"code","cb85dbe5":"code","244a91c4":"code","85a14fb2":"code","9d6cef2b":"code","254939c5":"code","1abfbb4e":"code","0c76d9a3":"code","05ad673f":"code","2c7a5eda":"code","4fd82e70":"code","249d5aa8":"code","f013a509":"code","5f035e90":"code","f9637e02":"markdown","e1ef28ee":"markdown","0e8214b5":"markdown","416bea6a":"markdown","9e739278":"markdown","82f5447c":"markdown","e265396b":"markdown"},"source":{"5018e82f":"import numpy as np\nimport pandas as pd\nimport os\nfrom google.cloud import bigquery\n!pip install plotly\nfrom plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot\ninit_notebook_mode(connected=True)","b04fc506":"client = bigquery.Client()\n# ethereum_classic_dataset_ref = client.dataset('listenbrainz:listenbrainz.listen')","7a44e200":"from time import time\ndef show_amount_of_data_scanned(query):\n    # dry_run lets us see how much data the query uses without running it\n    dry_run_config = bigquery.QueryJobConfig(dry_run=True)\n    query_job = client.query(query, job_config=dry_run_config)\n    print('Data processed: {} GB'.format(round(query_job.total_bytes_processed \/ 10**9, 3)))\n    \ndef show_time_to_run(query):\n    time_config = bigquery.QueryJobConfig(use_query_cache=False)\n    start = time()\n    query_result = client.query(query, job_config=time_config).result()\n    end = time()\n    print('Time to run: {} seconds'.format(round(end-start, 3)))","66bde8c7":"query = \"\"\"\nSELECT EXTRACT(MONTH from listened_at) AS month, EXTRACT(YEAR from listened_at) AS year, COUNT(DISTINCT user_name) AS num_of_users\nFROM listenbrainz.listenbrainz.listen\nGROUP BY month,year\nORDER BY month,year\nLIMIT 1000\n\"\"\"","e27e6068":"def run_query(query):\n    query_job = client.query(query)\n    iterator = query_job.result()\n    rows = list(iterator)\n    result = pd.DataFrame(data=[list(x.values()) for x in rows], columns=list(rows[0].keys()))\n    return result","12c5595e":"result = run_query(query)","f14ed80a":"from plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot\nimport plotly.graph_objs as go\ninit_notebook_mode(connected=True)","0e012f8e":"labels = result['year']\nvalues = result['num_of_users']\n\ntrace = go.Pie(labels=labels, values=values)\n\niplot([trace])","decd2b44":"query = \"\"\"\nSELECT MIN(listened_at) as first_date, MAX(listened_at) as last_date\nFROM listenbrainz.listenbrainz.listen\n\"\"\"","42426137":"run_query(query)","ab8a40d5":"query = \"\"\"\nSELECT track_name as song, artist_name as artist, COUNT(track_name) as plays\nFROM listenbrainz.listenbrainz.listen\nGROUP BY song, artist\nORDER BY plays DESC\nLIMIT 1\n\"\"\"","063bc3d3":"result = run_query(query)\nresult\n","cb85dbe5":"query = \"\"\"\nSELECT artist_name, COUNT(artist_name) as artist_occurrences\nFROM listenbrainz.listenbrainz.listen\nGROUP BY artist_name\nORDER BY artist_occurrences DESC\nLIMIT 1\n\"\"\"","244a91c4":"result = run_query(query)\nresult","85a14fb2":"query = \"\"\"\nSELECT user_name, COUNT(1) as num_of_plays\nFROM listenbrainz.listenbrainz.listen\nWHERE artist_name = \"Taylor Swift\"\nGROUP BY user_name\nORDER BY num_of_plays DESC\nLIMIT 100\n\"\"\"","9d6cef2b":"result = run_query(query)\nresult","254939c5":"name = result['user_name']\nnum = result['num_of_plays']\n\ntrace = go.Bar(x=name, y= num)\niplot([trace])","1abfbb4e":"query = \"\"\"\nSELECT track_name, COUNT(1) as num_of_plays\nFROM listenbrainz.listenbrainz.listen\nWHERE artist_name = \"Taylor Swift\"\nGROUP BY track_name\nORDER BY num_of_plays DESC\nLIMIT 100\n\"\"\"","0c76d9a3":"result = run_query(query)\nresult","05ad673f":"name = result['track_name']\nnum = result['num_of_plays']\n\ntrace = go.Bar(x=name, y= num)\niplot([trace])","2c7a5eda":"query = \"\"\"\nWITH temp AS (\nSELECT EXTRACT(YEAR from listened_at) as year, artist_name, track_name, Count(track_name) as num_plays\nFROM listenbrainz.listenbrainz.listen\nGROUP BY track_name,artist_name, year\nORDER BY year, num_plays DESC\n\n),\ntemp2 AS(\nSELECT year, MAX(num_plays) as max_track\nFROM temp\nGROUP BY year\n)\nSELECT DISTINCT temp.year, temp.track_name,temp.num_plays\nFROM temp INNER JOIN temp2\nON temp.year = temp2.year AND temp.num_plays = temp2.max_track\nORDER BY temp.year DESC\nLIMIT 100\n\"\"\"","4fd82e70":"result = run_query(query)\nresult","249d5aa8":"query = \"\"\"\nSELECT EXTRACT(YEAR from listened_at) AS year, COUNT(DISTINCT track_name) AS num_of_songs\nFROM listenbrainz.listenbrainz.listen\nGROUP BY year\n\"\"\"","f013a509":"result = run_query(query)\nresult","5f035e90":"name = result['year']\nnum = result['num_of_songs']\n\ntrace = go.Bar(x=name, y= num)\niplot([trace])","f9637e02":"# Find most played artist","e1ef28ee":"# Find most popular Taylor Swift song","0e8214b5":"# Find most popular song by year","416bea6a":"# Find top 100 Taylor Swift fans","9e739278":"# Find most played song","82f5447c":"# Find min and max dates of entire dataset","e265396b":"# Find number of unique users for each month of each year (limit = 1000)"}}