{"cell_type":{"8cabd772":"code","7d70c9dc":"code","6576a695":"code","ad6d5778":"code","4cccfb7b":"code","3d56f7a0":"code","0d6ebe15":"markdown","863acfef":"markdown","976fdbfc":"markdown","b1ed16dd":"markdown","b248577b":"markdown","e28e9c8f":"markdown","507f11f9":"markdown"},"source":{"8cabd772":"import numpy as np\nimport pandas as pd\nimport os\nfrom tqdm import tqdm\nimport tensorflow.compat.v1 as tf\nimport skimage\nimport skimage.io","7d70c9dc":"# Source: https:\/\/stackoverflow.com\/questions\/33849617\/how-do-i-convert-a-directory-of-jpeg-images-to-tfrecords-file-in-tensorflow\n# Note: modified from source\ndef _int64_feature(value):\n    return tf.train.Feature(int64_list=tf.train.Int64List(value=[value]))\n\n\ndef _bytes_feature(value):\n    return tf.train.Feature(bytes_list=tf.train.BytesList(value=[value]))\n\n# images and labels array as input\ndef convert_to(images, labels, output_directory, name):\n    num_examples = labels.shape[0]\n    if images.shape[0] != num_examples:\n        raise ValueError(\"Images size %d does not match label size %d.\" %\n                         (images.shape[0], num_examples))\n    rows = images.shape[1]\n    cols = images.shape[2]\n    depth = 1\n\n    filename = os.path.join(output_directory, name + '.tfrecords')\n    print('Writing', filename)\n    writer = tf.python_io.TFRecordWriter(filename)\n    for index in range(num_examples):\n        image_raw = images[index].tobytes()\n        example = tf.train.Example(features=tf.train.Features(feature={\n            'height': _int64_feature(rows),\n            'width': _int64_feature(cols),\n            'depth': _int64_feature(depth),\n            'label': _int64_feature(int(labels[index])),\n            'image_raw': _bytes_feature(image_raw)}))\n        writer.write(example.SerializeToString())","6576a695":"def read_image(file_name, images_path):\n    image = skimage.io.imread(images_path + file_name)\n    return image","ad6d5778":"def extract_image_index_make_label(img_name):\n    remove_ext = img_name.split(\".\")[0]\n    name, serie, repetition, char = remove_ext.split(\"_\")\n    label = int(char) + 1000 * int(repetition) + 1000_000 * int(serie)\n    return label","4cccfb7b":"images_path = \"\/kaggle\/input\/chinese-mnist\/data\/data\/\"\nimage_list = os.listdir(images_path)\nimages = []\nlabels = []\nfor img_name in tqdm(image_list):\n    images.append(read_image(img_name, images_path))\n    labels.append(extract_image_index_make_label(img_name))\nimages_array = np.array(images)\nlabels = np.array(labels)\nprint(images_array.shape, labels.shape)","3d56f7a0":"convert_to(images_array, labels, \".\", \"chinese_mnist\")","0d6ebe15":"## Read images","863acfef":"# Introduction\n\nUtility to generate TFRecords from jpg images","976fdbfc":"## Convert all images to TFRecords","b1ed16dd":"# Images to TFRecords\n\n## Conversion functions","b248577b":"# Load packages","e28e9c8f":"## Read and annotate all images","507f11f9":"## Generate labels"}}