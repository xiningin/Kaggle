{"cell_type":{"47ba8a94":"code","247f6933":"code","47fd7868":"code","2e1b37d2":"code","37a61c20":"code","ade95354":"code","683d51e8":"code","47ecda34":"code","b32982ec":"code","22180b0e":"code","19d9b502":"code","d044bee0":"code","a7fa8314":"code","f9e4b5ff":"code","1d3b1ad1":"code","98e96e16":"code","59a4493e":"code","b9d4bf32":"code","9d2155a0":"code","887301bd":"code","11f5a594":"code","f2edddba":"code","c944cab2":"code","c4c65d0c":"code","e56a2a8f":"code","b0779400":"code","e7accf22":"code","390a77e6":"code","82ef91f0":"code","daa5c2ef":"code","e120c139":"code","caddb81e":"code","a3c9e7f3":"code","f71865be":"code","4ba78ca1":"code","07edc3b1":"code","ebcccd82":"code","c5b68584":"code","df1616b6":"code","677e7e95":"code","d1a3b788":"code","197aa301":"code","32ef0f81":"code","482c7d6f":"code","084c7119":"code","168720de":"code","7a164736":"code","6cfd2f3e":"code","25c7464b":"code","ae2ff85c":"code","dd043df7":"code","6dddb400":"code","a34e961e":"code","0e996efb":"code","92c79459":"code","5c89671f":"code","54381723":"code","d963ba0b":"code","4065369b":"code","bebf33e7":"code","92b20f1c":"code","a5d09e98":"code","b5e2c6cc":"code","713a5d1e":"code","7f49d643":"code","7b19506c":"code","98ed76ce":"code","b1a38c2d":"code","7ba82c9d":"code","688b12a4":"code","d2a8335c":"code","327b17c7":"markdown","0d746bf1":"markdown","cd081130":"markdown","ccba6926":"markdown","bb4ac34b":"markdown","3e6d9e2e":"markdown","dbbddff7":"markdown","2a68687f":"markdown","2de2fcec":"markdown","34a98196":"markdown","7e378ec3":"markdown","f0e49335":"markdown","bc7dfda9":"markdown","5e92b69b":"markdown","b517fbde":"markdown","fdabac1f":"markdown","304882f9":"markdown","19c4354b":"markdown","ac00076a":"markdown","08cb041e":"markdown","b5c9f7a3":"markdown","694a788a":"markdown","d61f4bcb":"markdown","b9fa7e75":"markdown","791233a8":"markdown","91f15456":"markdown","17814eb6":"markdown","e5fbeafb":"markdown","6ee3eb65":"markdown","a3700102":"markdown","da33295d":"markdown","1b2d10eb":"markdown","9fbf6b4c":"markdown","66bc19a6":"markdown","ebb2abda":"markdown","1d3fa5ce":"markdown","f3645010":"markdown","78ec9676":"markdown","c5a10caa":"markdown","1581bfe8":"markdown"},"source":{"47ba8a94":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\npd.set_option('display.max_columns', None);\npd.set_option('display.max_rows', None);\npd.set_option('display.float_format', lambda x: '%.2f' % x)\nimport matplotlib.pyplot as plt","247f6933":"df1 = pd.read_excel(\"..\/input\/uci-online-retail-ii-data-set\/online_retail_II.xlsx\", sheet_name=\"Year 2010-2011\")\n","47fd7868":"df = df1.copy()","2e1b37d2":"df.head()","37a61c20":"df.tail()","ade95354":"df.info()","683d51e8":"df.columns","47ecda34":"df.index","b32982ec":"df.describe().T","22180b0e":"df.nunique()","19d9b502":"df[\"Description\"].nunique()","d044bee0":"df[\"Description\"].value_counts().head()","a7fa8314":"df.groupby(\"Description\").agg({\"Quantity\":\"sum\"}).sort_values(\"Quantity\", ascending = False).head()","f9e4b5ff":"df[\"TotalPrice\"] = df[\"Quantity\"] * df[\"Price\"]","1d3b1ad1":"df.groupby(\"Country\").agg({\"TotalPrice\":\"sum\"}).sort_values(\"TotalPrice\", ascending = False).head()","98e96e16":"df[\"Country\"].value_counts()","59a4493e":"df[df[\"Invoice\"].str.contains(\"C\", na = False)].head()","b9d4bf32":"df = df[~df[\"Invoice\"].str.contains(\"C\", na = False)]","9d2155a0":"df.groupby(\"Country\").agg({\"TotalPrice\":\"sum\"}).head()","887301bd":"df.head()","11f5a594":"df.isnull().values.any()","f2edddba":"df.isnull().sum()","c944cab2":"df[\"Country\"].value_counts()","c4c65d0c":"for feature in [\"Quantity\",\"Price\",\"TotalPrice\"]:\n    Q1 = df[feature].quantile(0.01)\n    Q3 = df[feature].quantile(0.99)\n    IQR = Q3-Q1\n    upper = Q3 + 1.5*IQR\n    lower = Q1 - 1.5*IQR\n\n    if df[(df[feature] > upper) | (df[feature] < lower)].any(axis=None):\n        print(feature,\"yes\")\n        print(df[(df[feature] > upper) | (df[feature] < lower)].shape[0])\n    else:\n        print(feature, \"no\")","e56a2a8f":"df.head()","b0779400":"df[\"InvoiceDate\"].min()","e7accf22":"df[\"InvoiceDate\"].max()","390a77e6":"import datetime as dt","82ef91f0":"today_date = dt.datetime(2011, 12, 9)","daa5c2ef":"today_date","e120c139":"df.groupby(\"Customer ID\").agg({\"InvoiceDate\":\"max\"}).head()","caddb81e":"temp_df = (today_date - df.groupby(\"Customer ID\").agg({\"InvoiceDate\":\"max\"}))","a3c9e7f3":"temp_df.head()","f71865be":"temp_df.rename(columns = {\"InvoiceDate\":\"Recency\"}, inplace = True)","4ba78ca1":"temp_df.head()","07edc3b1":"recency_df = temp_df[\"Recency\"].apply(lambda x: x.days)","ebcccd82":"recency_df.head()","c5b68584":"freq_df = df.groupby(\"Customer ID\").agg({\"Invoice\":\"count\"})","df1616b6":"freq_df.head()","677e7e95":"freq_df.rename(columns={\"Invoice\": \"Frequency\"}, inplace=True)","d1a3b788":"freq_df.head()","197aa301":"monetary_df = df.groupby(\"Customer ID\").agg({\"TotalPrice\":\"sum\"})","32ef0f81":"monetary_df.head()","482c7d6f":"monetary_df.rename(columns={\"TotalPrice\":\"Monetary\"}, inplace=True)","084c7119":"monetary_df.head()","168720de":"print(recency_df.shape,freq_df.shape,monetary_df.shape)","7a164736":"rfm = pd.concat([recency_df, freq_df, monetary_df],  axis=1)","6cfd2f3e":"rfm.head()","25c7464b":"rfm[\"RecencyScore\"] = pd.qcut(rfm[\"Recency\"], 5, labels = [5, 4 , 3, 2, 1])","ae2ff85c":"rfm.head()","dd043df7":"rfm[\"FrequencyScore\"]= pd.qcut(rfm[\"Frequency\"].rank(method=\"first\"),5, labels=[1,2,3,4,5])","6dddb400":"rfm.head()","a34e961e":"rfm[\"MonetaryScore\"] = pd.qcut(rfm['Monetary'], 5, labels = [1, 2, 3, 4, 5])","0e996efb":"rfm.head()","92c79459":"rfm[\"RFM_SCORE\"] = (rfm['RecencyScore'].astype(str) +\n                    rfm['FrequencyScore'].astype(str) +\n                    rfm['MonetaryScore'].astype(str))","5c89671f":"rfm.head()","54381723":"rfm[rfm[\"RFM_SCORE\"]==\"555\"].head()","d963ba0b":"rfm.describe().T","4065369b":"rfm[rfm[\"RFM_SCORE\"] == \"111\"].head() # hibernating","bebf33e7":"seg_map = {\n    r'[1-2][1-2]': 'Hibernating',\n    r'[1-2][3-4]': 'At Risk',\n    r'[1-2]5': 'Can\\'t Loose',\n    r'3[1-2]': 'About to Sleep',\n    r'33': 'Need Attention',\n    r'[3-4][4-5]': 'Loyal Customers',\n    r'41': 'Promising',\n    r'51': 'New Customers',\n    r'[4-5][2-3]': 'Potential Loyalists',\n    r'5[4-5]': 'Champions'}","92b20f1c":"rfm['Segment'] = rfm['RecencyScore'].astype(str) + rfm['FrequencyScore'].astype(str)","a5d09e98":"rfm.head()","b5e2c6cc":"rfm['Segment'] = rfm['Segment'].replace(seg_map, regex=True)","713a5d1e":"rfm.head()","7f49d643":"rfm[[\"Segment\",\"Recency\",\"Frequency\", \"Monetary\"]].groupby(\"Segment\").agg([\"mean\",\"median\",\"count\"])","7b19506c":"rfm.shape[0]","98ed76ce":"rfm[rfm[\"Segment\"] == \"Need Attention\"].head()","b1a38c2d":"rfm[rfm[\"Segment\"] == \"New Customers\"].index","7ba82c9d":"rfm[rfm[\"Segment\"] == \"Need Attention\"]","688b12a4":"rfm[rfm[\"Segment\"] == \"New Customers\"].describe().T","d2a8335c":"rfm[\"Segment\"].value_counts()","327b17c7":"**Detecting outliers**","0d746bf1":"# **RFM**","cd081130":"# **Frequency**","ccba6926":"* A single RFM table has been created.","bb4ac34b":"* Now, the \"invoice\" marked \"C\" has been removed.","3e6d9e2e":"![](http:\/\/)![image.png](attachment:image.png)\nSource: https:\/\/www.retailreco.com\/","dbbddff7":"* Number of unique products","2a68687f":"* The most ordered product","2de2fcec":"# **Goal**\n\nAn e-commerce company wants to segment its customers into a number of well-defined categories and \ndetermine marketing strategies according to these segments. Accordingly, the behavior of the customers will be defined. Groups will be formed according to clustering in these behaviors. In other words, those who display common behaviors will be taken into the same groups. Special sales strategies and marketing techniques will be developed for these groups.\"","34a98196":"**The description of  variables in this data as follows:**\n\n* InvoiceNo: Invoice number. Nominal, a 6-digit integral number uniquely assigned to each transaction. \nIf this code starts with letter 'c', it indicates a cancellation.\n* StockCode: Product (item) code. Nominal, a 5-digit integral number uniquely assigned to each distinct product.\n* Description: Product (item) name. Nominal.\n* Quantity: The quantities of each product (item) per transaction. Numeric.\n* InvoiceDate: Invice Date and time. Numeric, the day and time when each transaction was generated.\n* UnitPrice: Unit price. Numeric, Product price per unit in sterling.\n* CustomerID: Customer number. Nominal, a 5-digit integral number uniquely assigned to each customer.\n* Country: Country name. Nominal, the name of the country where each customer resides.","7e378ec3":"**Check & Clean Missing Data**","f0e49335":"**Data Summary**\n\n* The data set called Online Retail II includes the sales of a UK-based online store between 01\/12\/2010 and 09\/12\/2011. This company mainly sells souvenirs and unique all-occasion gifts sucg as  promotional products. Most of their customers are wholesalers.","bc7dfda9":"* Converts the 'recency' value to day. For instance, it shows \"74\" instead of \"74 days\".","5e92b69b":"* The oldest dated invoice in this data set.","b517fbde":"* Number of unique values in each column.","fdabac1f":"* A list of new customers' numbers","304882f9":"* These code blocks generate RF scores and segment according to regex commands.","19c4354b":"# **Recency**","ac00076a":"# 1. IMPORT SOME NECESSARY LIBRARIES","08cb041e":"* Collects TotalPrice values of customer numbers.","b5c9f7a3":"# 2. UNDERSTANDING THE DATA-SET","694a788a":"* List customer numbers and invoices for customers.","d61f4bcb":"* Recency, Frequency, and Monetary scores were collected individually turn on the string. This gives each customer RFM scores.","b9fa7e75":"* Time passed since the last purchase","791233a8":"* The \"Customer ID\" value (float) has been converted to an integer value.","91f15456":"* A new variable named \"TotalPrice\" is created by multiplying \"Quantity\" with  \"Price values\".","17814eb6":"* This assignment was made because the date of the most recent invoice is on this date.","e5fbeafb":"* The \"Invoice\" was named as \"Frequency\".","6ee3eb65":"* In order to calculate the TotalPrice paid by the customers, it is necessary to get rid of the \"Invoice\", \nwhich means \"Cancel\", with the \"C\" mark.","a3700102":"* The most recent invoice in this data set.","da33295d":"* RFM map was created using Regular Expressions.","1b2d10eb":"* Top-down total of orders made by countries","9fbf6b4c":"# **Load Data**","66bc19a6":"* The \"InvoiceDate\" was named as \"Recency\".","ebb2abda":"* Sorting of \"TotalPrice\" for each country.","1d3fa5ce":"* it presents the number of blank (na) data contained in all columns separately.","f3645010":"* The \"TotalPrice\" was named as \"Monetary\".","78ec9676":"* Three new columns have been added to the RFM table below. In addition, the values under the Recency, \nFrequency and Monetary table were divided into 5 separate groups.","c5a10caa":"# **Monetary**","1581bfe8":"The relevant library is imported in order to perform the operations related to the date."}}