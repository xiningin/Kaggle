{"cell_type":{"5e67c98d":"code","69beee95":"code","e93fbd30":"code","644acb8f":"code","6224e561":"code","50f541bf":"code","2bb30696":"code","89843466":"code","735d1cc0":"code","d1245153":"code","6b1d97db":"code","8477b16c":"code","d5b7e56f":"code","4713a4f6":"code","d053ff5b":"code","eaa68b80":"code","ba1f5e0f":"code","04ed72d3":"code","7d0d4bc9":"code","fe4c3ffd":"code","62643025":"code","d41632ff":"code","7c2f67f0":"code","abbb44da":"code","403f4855":"markdown","d975708d":"markdown","b7409446":"markdown","a959b824":"markdown","d1ff4547":"markdown","a66bde3a":"markdown","5908a713":"markdown"},"source":{"5e67c98d":"import numpy as np\nimport pandas as pd \nfrom tensorflow import keras\nfrom sklearn.model_selection import train_test_split\nimport keras_tuner as kt\nimport tensorflow as tf\nimport gc","69beee95":"batch_size = 128","e93fbd30":"train = pd.read_csv(\"\/kaggle\/input\/tabular-playground-series-oct-2021\/train.csv\")","644acb8f":"train.head()","6224e561":"train.pop(\"id\")\ntarget = train.pop(\"target\")","50f541bf":"train_mean = train.mean()\ntrain_std = train.std()","2bb30696":"train = (train - train_mean) \/ train_std","89843466":"X_train, X_val, y_train, y_val = train_test_split(train, target, test_size=0.15, random_state=42)","735d1cc0":"X_train.shape, X_val.shape, y_train.shape, y_val.shape","d1245153":"del train\ndel target\ngc.collect()","6b1d97db":"portion = 0.01\ntrain_indices = np.random.choice(X_train.shape[0], int(X_train.shape[0] * portion))\nX_train_subset = X_train.iloc[train_indices]\ny_train_subset = y_train.iloc[train_indices]\nval_indices = np.random.choice(X_val.shape[0], int(X_val.shape[0] * portion))\nX_val_subset = X_val.iloc[val_indices]\ny_val_subset = y_val.iloc[val_indices]","8477b16c":"def build_model(hp):\n    inputs = tf.keras.layers.Input((X_train.shape[1]))\n    width = hp.Choice('width', [16, 32, 64, 128])\n    depth = hp.Choice('depth', [3, 4, 5, 6, 7, 8, 9, 10])\n    x = keras.layers.Dense(\n            width, \n            activation='relu'\n        )(inputs)\n    for i in range(depth - 1):\n        x = keras.layers.Dense(\n            width, \n            activation=hp.Choice('activation', [\"relu\", \"elu\", \"linear\"])\n        )(x)\n        x = keras.layers.Dropout(\n            hp.Choice('dropout', [0.1, 0.2, 0.3, 0.4, 0.5])\n        )(x)\n    output = keras.layers.Dense(1, activation=\"sigmoid\")(x)\n    model = keras.Model(inputs=inputs, outputs=output)\n    adam = keras.optimizers.Adam(learning_rate=hp.Float(\"learing_rate\", 1e-5, 5e-3))\n    model.compile(loss='binary_crossentropy', optimizer=adam, metrics=[\"accuracy\", keras.metrics.AUC()])\n    return model","d5b7e56f":"tuner = kt.RandomSearch(\n    build_model,\n    objective=kt.Objective(\"val_auc\", direction=\"max\"),\n    max_trials=100)\ntuner.search(x=X_train_subset, y=y_train_subset, epochs=5, validation_data=(X_val_subset, y_val_subset))\nbest_model = tuner.get_best_models()[0]\nkeras.utils.plot_model(best_model, show_shapes=True)","4713a4f6":"best_hp = tuner.get_best_hyperparameters()[0]","d053ff5b":"for param in [\"width\", \"depth\", \"learing_rate\"]:\n    print(\"%s:\"%(param), best_hp.get(param))","eaa68b80":"keras.backend.clear_session()","ba1f5e0f":"model = tuner.hypermodel.build(best_hp)","04ed72d3":"model_checkpoint_path = \"model.h5\"\nearly_stopping = keras.callbacks.EarlyStopping(patience=10)\nmodel_checkpoint = keras.callbacks.ModelCheckpoint(model_checkpoint_path, save_best_only=True)\nreduce_lr =  keras.callbacks.ReduceLROnPlateau(monitor='val_loss', factor=0.2,\n                              patience=5, min_lr=1e-7)","7d0d4bc9":"history = model.fit(x=X_train, y=y_train, epochs=50, validation_data=(X_val, y_val), callbacks=[early_stopping, model_checkpoint, reduce_lr])","fe4c3ffd":"model.load_weights(model_checkpoint_path)","62643025":"del X_train\ndel y_train\ndel X_val\ndel y_val\ngc.collect()","d41632ff":"pd.DataFrame(history.history).plot()","7c2f67f0":"test = pd.read_csv(\"\/kaggle\/input\/tabular-playground-series-oct-2021\/test.csv\")\n_ = test.pop(\"id\")\ntest = (test - train_mean) \/ train_std","abbb44da":"sample_submission = pd.read_csv(\"\/kaggle\/input\/tabular-playground-series-oct-2021\/sample_submission.csv\")\ny_pred = model.predict(test).reshape(-1)\nprint(y_pred.shape)\nsample_submission[\"target\"] = y_pred\nsample_submission.to_csv(\"submission.csv\", index=False)","403f4855":"## TPS-10-21: DNN","d975708d":"## Import and preprocess datasets","b7409446":"## Setup","a959b824":"## Model Development","d1ff4547":"## Configuration","a66bde3a":"## Submission","5908a713":"Here is best parameters:"}}