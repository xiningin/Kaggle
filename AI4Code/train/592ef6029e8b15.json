{"cell_type":{"8a827864":"code","fbad772a":"code","3b5eac95":"code","20b6c222":"code","e9f804de":"code","65b9262a":"code","bf997279":"code","76487ca6":"code","63d9acf6":"code","fb53f912":"code","fde68b8c":"code","30e890df":"code","ee38384f":"code","390546ea":"code","2e561f31":"code","99777e02":"code","603a37c9":"code","58d6e24d":"markdown","420e4ade":"markdown","bbcb7bb8":"markdown","b180c98f":"markdown","5375b774":"markdown","b8160023":"markdown","6d45bb9e":"markdown","8c60dce5":"markdown","ebb84004":"markdown"},"source":{"8a827864":"# pandas and numpy for data manipulation\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nfrom sklearn.model_selection import train_test_split\n\n# Import the tpot Classifier\nfrom tpot import TPOTClassifier\nprint(\"TPOT has been installed\")","fbad772a":"# Read data\ntrain_df = pd.read_csv('..\/input\/train.csv')\ntest_df = pd.read_csv('..\/input\/test.csv')\n#Show 10 fist datapoints\ntrain_df.head(n=10)","3b5eac95":"#Dataset information\ntrain_df.info()\nprint('_'*40)\ntest_df.info()","20b6c222":"#numerical features stats\ntrain_df.describe()","e9f804de":"#Categorical features stats \ntrain_df.describe(include=['O'])","65b9262a":"#Labels: C\u00e1i c\u1ea7n d\u1ef1 \u0111o\u00e1n\ny_train = train_df[\"Survived\"]\n#Drop feature: ID, name, ticket number l\u00e0 kh\u00f4ng c\u1ea7n thi\u1ebft. Cabin miss value qu\u00e1 nhi\u1ec1u\nX_train = train_df.drop([\"Survived\",\"PassengerId\", \"Name\", \"Ticket\", \"Cabin\"], axis=1)\n\n# Fill missed categorical value\nfreq_port = train_df.Embarked.dropna().mode()[0]\nX_train['Embarked'] = X_train['Embarked'].fillna(freq_port)\n\n# Convert categorical feature to numerical feature\nX_train['Sex'] = X_train['Sex'].map( {'female': 1, 'male': 0} ).astype(int)\nX_train['Embarked'] = X_train['Embarked'].map( {'S': 0, 'C': 1, 'Q': 2} ).astype(int)\n\n# Show traning data feature \nX_train.head(n=10)","bf997279":"# Convert to numpy arrays\nX_train = np.array(X_train)\n\n# Sklearn wants the labels as one-dimensional vectors\ny_train = np.array(y_train).reshape((-1,))\nprint(X_train.shape)\nprint(y_train.shape)","76487ca6":"#Split data: traing and testing\n#X_train , X_test , y_train , y_test = train_test_split( X_train , y_train , train_size = .8 )\nprint(X_train.shape)\nprint(y_train.shape)\n#print(X_test.shape)\n#print(y_test.shape)","63d9acf6":"# Create a tpot object with a few parameters\npipeline_optimizer = TPOTClassifier(max_time_mins=500, generations=333, population_size=99, cv=10,\n                                    random_state=42, verbosity=2)\nprint(\"Done\")","fb53f912":"# Fit the tpot model on the training data\npipeline_optimizer.fit(X_train, y_train)\nprint(\"Training finish\")","fde68b8c":"# Show the final model\nprint(pipeline_optimizer.fitted_pipeline_)","30e890df":"# Export the pipeline as a python script file\npipeline_optimizer.export('tpot_exported_pipeline.py')","ee38384f":"# To examine all fitted models\n#pipeline_optimizer.evaluated_individuals_","390546ea":"# Evaluate the final model\n#print(pipeline_optimizer.score(X_test, y_test))","2e561f31":"test_df = pd.read_csv('..\/input\/test.csv')\nX_test_df = test_df.drop([\"PassengerId\", \"Name\", \"Ticket\", \"Cabin\"], axis=1)\n\n#freq_port = test_df.Embarked.dropna().mode()[0]\nX_test_df['Embarked'] = X_test_df['Embarked'].fillna(freq_port)\n\n# Convert categorical feature to numerical feature\nX_test_df['Sex'] = X_test_df['Sex'].map( {'female': 1, 'male': 0} ).astype(int)\nX_test_df['Embarked'] = X_test_df['Embarked'].map( {'S': 0, 'C': 1, 'Q': 2} ).astype(int)\n\n# Show traning data feature \nX_test_df.head(n=10)","99777e02":"X_test_df = np.array(X_test_df)\nprint(X_test_df.shape)","603a37c9":"surv_pred = pipeline_optimizer.predict(X_test_df)\n\nsubmit = pd.DataFrame({'PassengerId' : test_df.loc[:,'PassengerId'],\n                       'Survived': surv_pred.T})\nsubmit.to_csv(\"..\/working\/submit.csv\", index=False)\n#submit.to_csv(\"submit.csv\", index=False)\nsubmit.head(n=20)","58d6e24d":"## Building model: So easy","420e4ade":"The TPOT optimization process is stochastic, meaning that [each run will produce different results](https:\/\/epistasislab.github.io\/tpot\/using\/). If you run this notebook again, don't worry if you see a different final pipeline!  ","bbcb7bb8":"## Submit prediction","b180c98f":"#generations: int, optional (default=100)\uff0c\u8fd0\u884c\u7ba1\u9053\u4f18\u5316\u8fc7\u7a0b\u7684\u8fed\u4ee3\u6b21\u6570\u3002\u4e00\u5b9a\u662f\u6b63\u6570\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u503c\u8d8a\u5927\uff0c\u6027\u80fd\u8d8a\u597d\u3002\n#TPOT\u5c06\u8bc4\u4f30population_size+generations\u00d7offspring_size\u7684\u89c4\u6a21\u3002\n#population_size: int, optional (default=100)\uff0c\u5728\u6bcf\u4e00\u4ee3\u9057\u4f20\u4e2d\u4fdd\u7559\u7684\u4e2a\u4f53\u6570\u3002\u4e00\u5b9a\u662f\u6b63\u6570\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u503c\u8d8a\u5927\uff0c\u6027\u80fd\u8d8a\u597d\u3002\n#offspring_size: int, optional (default=100)\uff0c\u5728\u6bcf\u4e00\u6b21\u9057\u4f20\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u540e\u4ee3\u6570\u91cf\u3002\u4e00\u5b9a\u662f\u6b63\u6570\u3002\n#mutation_rate: float, optional (default=0.9)\uff0c\u53d8\u5f02\u7387\uff0c\u91c7\u7528\u9ed8\u8ba4\u503c\u5373\u53ef\u3002\n#crossover_rate: float, optional (default=0.1)\uff0c\u4ea4\u53c9\u7387\uff0c\u91c7\u7528\u9ed8\u8ba4\u503c\u5373\u53ef\u3002\n#scoring: string or callable, optional (default='neg_mean_squared_error')\uff0c\u56de\u5f52\u95ee\u9898\u4e2d\u7528\u4e8e\u8bc4\u4f30\u7ed9\u5b9a\u7ba1\u9053\u7684\u8d28\u91cf\u7684\u51fd\u6570\u3002\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u5185\u7f6e\u8bc4\u5206\u51fd\u6570\uff1a\n#'neg_median_absolute_error', 'neg_mean_absolute_error', 'neg_mean_squared_error', 'r2'\n#cv: int, cross-validation generator, or an iterable, optional (default=5)\n#subsample: float, optional (default=1.0)\uff0c\u5728TPOT\u4f18\u5316\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u7684\u8bad\u7ec3\u6837\u672c\u7684\u6bd4\u4f8b\u3002\u5fc5\u987b\u57280\u52301\u4e4b\u95f4\u3002\n#n_jobs: integer, optional (default=1)\n#max_time_mins: integer or None, optional (default=None)\uff0cTPOT\u9700\u8981\u591a\u5c11\u5206\u949f\u6765\u4f18\u5316\u7ba1\u9053\u3002\n#max_eval_time_mins: integer, optional (default=5)\uff0cTPOT\u9700\u8981\u591a\u5c11\u5206\u949f\u6765\u8bc4\u4f30\u4e00\u4e2a\u7ba1\u9053\u3002\n#random_state: integer or None, optional (default=None)\uff0c\u4f7f\u7528\u8fd9\u4e2a\u53c2\u6570\u6765\u786e\u4fddTPOT\u6bcf\u6b21\u8fd0\u884c\u65f6\u90fd\u4f1a\u6709\u76f8\u540c\u7684\u7ed3\u679c\u3002\n#config_dict: Python dictionary, string, or None, optional (default=None)\uff0c\u7528\u4e8e\u5b9a\u5236TPOT\u5728\u4f18\u5316\u8fc7\u7a0b\u4e2d\u641c\u7d22\u7684\u64cd\u4f5c\u7b26\u548c\u53c2\u6570\u7684\u914d\u7f6e\u5b57\u5178\u3002\n#warm_start: boolean, optional (default=False)\uff0c\u8868\u660eTPOT\u5b9e\u4f8b\u662f\u5426\u4f1a\u91cd\u7528\u4ee5\u524d\u8c03\u7528fit\uff08\uff09\u7684\u5165\u53e3\u3002\n#early_stop: integer, optional (default: None)\uff1f\n#verbosity: integer, optional (default=0)\uff1f\uff1atpot\u80fd\u4f20\u9012\u591a\u5c11\u4fe1\u606f","5375b774":"# Automated Machine Learning\n## Preprocessing","b8160023":"To save the pipeline for future use, we can export it to a Python script. ","6d45bb9e":"If we want to look at all of the evaluated pipelines, we can see the `.evaluated_individuals_` attribute of the fitted optimizer. Be careful about running this as it will print out all 1500 pipelines that were tested!","8c60dce5":"## Evaluating model","ebb84004":"Finally, let's test the entire fitted pipeline on the test dataset. After evaluating all the pipelines, TPOT saves the best one and trains it on all the training data, so we can evaluate the best one using the optimizer `.score` method."}}