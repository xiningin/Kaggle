{"cell_type":{"38293d7e":"code","31c5c95c":"code","1db06f06":"code","7916090f":"code","c2b224cd":"code","9eb49ed8":"code","a94c79a5":"code","38a301c1":"code","40754625":"code","c94ec813":"code","419a7c59":"code","733b03fd":"code","32ec8095":"code","b2f2335c":"code","7d8cbd8a":"code","3e2a0426":"code","6f745f08":"code","cfba9647":"code","4b3b2d19":"code","7118fa80":"code","f9e09775":"code","d84642b5":"code","9932176c":"code","f4ea0def":"code","846d027a":"markdown","e6bcfbbb":"markdown","d0068966":"markdown","c604fff2":"markdown","e72c3013":"markdown","04456e68":"markdown","b9ceb6ba":"markdown","984584f9":"markdown","6a2ecff9":"markdown","6cc561d2":"markdown","5254ace3":"markdown","74a4abda":"markdown","245756f0":"markdown","16f667c6":"markdown","e7af58ad":"markdown","ebd4a7a7":"markdown","b0539dff":"markdown","475ccb1e":"markdown"},"source":{"38293d7e":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nfrom sklearn.metrics import accuracy_score\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","31c5c95c":"#Train and test data\ntrain = pd.read_csv(\"..\/input\/titanic\/train.csv\")\ntest = pd.read_csv(\"..\/input\/titanic\/test.csv\")\n\n# To make the final submission\nholdout_ids = test[\"PassengerId\"] ","1db06f06":"train.head()","7916090f":"# Get all the young (under 16) male and store in \"male\"   \nmale = train.loc[(train.Sex=='male') & (train.Age < 16)]\n\n# Get all the Pclass 3 female and store in \"female\"\nfemale = train.loc[(train.Sex=='female') & (train.Pclass==3)]\n\nprint(male['Survived'].value_counts())\nprint(female['Survived'].value_counts())","c2b224cd":"# First, let's extract the Title of each passenger\ntrain['Title'] = 0\ntrain['Title'] = train.Name.str.extract('([A-Za-z]+)\\.') #lets extract the title\n\ntitles = {\n    \"Mr\":       \"man\",\n    \"Mme\":      \"woman\",\n    \"Ms\":       \"woman\",\n    \"Mrs\":      \"woman\",\n    \"Master\":   \"boy\",\n    \"Mlle\":     \"woman\",\n    \"Miss\":     \"woman\",\n    \"Capt\":     \"man\",\n    \"Col\":      \"man\",\n    \"Major\":    \"man\",\n    \"Dr\":       \"man\",\n    \"Rev\":      \"man\",\n    \"Jonkheer\": \"man\",\n    \"Don\":      \"man\",\n    \"Sir\":      \"man\",\n    \"Countess\": \"woman\",\n    \"Dona\":     \"woman\",\n    \"Lady\":     \"woman\"\n}\n\ntrain[\"Title\"] = train[\"Title\"].map(titles)","9eb49ed8":"train.head()","a94c79a5":"# Let's extract the Surname of each passenger\ntrain['Surname'] = 0\ntrain['Surname'] = train.Name.str.extract('([A-Za-z]+)\\,')\n\n\n# All the men will be labelled as DeadMan (we only want to test the boys and the woman)\ntrain.loc[(train.Title=='man'), 'Surname'] = 'DeadMan'\n\n\n# Get women\/boys that are alone (no repeated Surname and without considering Man)\nunique_surname = (train['Surname'].value_counts().index)[ (train['Surname'].value_counts() == 1) ]\n\n# List that will have all the SINGLE passengers that survived and died\npassenger_lived = []\npassenger_died = []\n\nfor surname in unique_surname:\n  single_df = train.loc[(train.Surname == surname)]\n  lived = single_df['Survived'].loc[(single_df.Survived == 1)].sum()\n  if(lived == 1):\n    passenger_lived.append(surname)\n  else:\n    passenger_died.append(surname)\n\n\n# Get women\/boys that are NOT alone.\nnon_unique_surname = (train['Surname'].value_counts().index)[ train['Surname'].value_counts() != 1 ].drop('DeadMan')\n\n# List that will have all the FAMILIES that survived and died.\nfamilies_lived = []\nfamilies_dead = []\n\n# Test if the majority of the family members (> 0.5) lived or died\nfor surname in non_unique_surname:\n  surname_df = train.loc[(train.Surname == surname)]\n  number_family = len(surname_df)\n  number_lived = surname_df['Survived'].loc[(surname_df.Survived == 1)].sum()\n  #print(\"Family: %s, Size: %d, Lived: %d \" % (surname,number_family,number_lived))\n  if(number_lived\/number_family >= 0.5):\n    families_lived.append(surname)\n  else:\n    families_dead.append(surname)\n\n\n## Replace the 'Surname' feature according to the classification just made\ntrain['Surname'] = train['Surname'].replace(passenger_lived, 'LivedPassenger')\ntrain['Surname'] = train['Surname'].replace(passenger_died, 'DeadPassenger')\ntrain['Surname'] = train['Surname'].replace(families_lived, 'LivedFamily')\ntrain['Surname'] = train['Surname'].replace(families_dead, 'DeadFamily')\n","38a301c1":"train['Surname'].value_counts()","40754625":"# Define new feature\ntrain['SurnameSurvival'] = 0\n\ntrain.loc[(train.Surname == 'LivedPassenger'), 'SurnameSurvival'] = 1\ntrain.loc[(train.Surname == 'LivedFamily'), 'SurnameSurvival'] = 1","c94ec813":"family_lived = train.loc[(train.Surname == 'LivedFamily')] \nprint(family_lived['Survived'].value_counts())                  ","419a7c59":"prediction_train = train.SurnameSurvival\ntrue_train = train.Survived\n\nprint(accuracy_score(true_train, prediction_train))","733b03fd":"# Combine train\/test data to apply transformations simultaneously\nX = pd.read_csv(\"..\/input\/titanic\/train.csv\").drop('Survived', axis=1)\ndf = pd.concat([test,X],ignore_index=True,sort=False)\n\n# Get the index to later separate train and test data.\ntest_index = test.index","32ec8095":"# Let's extract the Title of each passenger\ndf['Title'] = 0\ndf['Title'] = df.Name.str.extract('([A-Za-z]+)\\.') #lets extract the title\n\ntitles = {\n    \"Mr\":       \"man\",\n    \"Mme\":      \"woman\",\n    \"Ms\":       \"woman\",\n    \"Mrs\":      \"woman\",\n    \"Master\":   \"boy\",\n    \"Mlle\":     \"woman\",\n    \"Miss\":     \"woman\",\n    \"Capt\":     \"man\",\n    \"Col\":      \"man\",\n    \"Major\":    \"man\",\n    \"Dr\":       \"man\",\n    \"Rev\":      \"man\",\n    \"Jonkheer\": \"man\",\n    \"Don\":      \"man\",\n    \"Sir\":      \"man\",\n    \"Countess\": \"woman\",\n    \"Dona\":     \"woman\",\n    \"Lady\":     \"woman\"\n}\n\ndf[\"Title\"] = df[\"Title\"].map(titles)","b2f2335c":"df.head()","7d8cbd8a":"# Extract the Surname of each passenger\ndf['Surname'] = 0\ndf['Surname'] = df.Name.str.extract('([A-Za-z]+)\\,')\n\n# All the men will be labelled as DeadMan (we only want to test the boys and the woman)\ndf.loc[(df.Title=='man'), 'Surname'] = 'DeadMan'\n\n\n# All previously single passengers that were labeled as lived will be considered lived.\nfor surname in passenger_lived:\n  df['Surname'] = df['Surname'].replace(surname, 'LivedPassenger')\n\n\n# All previously single passengers that were labeled as dead will be considered dead.\nfor surname in passenger_died:\n  df['Surname'] = df['Surname'].replace(surname, 'DeadPassenger')\n\n\n# All previously families that were labeled as lived will be considered lived.\nfor surname in families_lived:\n  df['Surname'] = df['Surname'].replace(surname, 'LivedFamily')\n\n\n# All previosly families that were labeled as dead will be considered dead.\nfor surname in families_dead:\n  df['Surname'] = df['Surname'].replace(surname, 'DeadFamily')\n","3e2a0426":"df['Surname'].value_counts()","6f745f08":"unique_surname = (df['Surname'].value_counts().index)[ df['Surname'].value_counts() == 1 ] \nunique_surname","cfba9647":"# Get the single passenger information\nsingle_passenger = df[df['Surname'].isin(unique_surname.to_list())]\n\n# Separate into single_woman and single_boy DataFrames\nsingle_woman = single_passenger['Surname'].loc[(single_passenger.Title=='woman')]\nsingle_boy = single_passenger['Surname'].loc[(single_passenger.Title=='boy')]\n\n# All the women alone will be labelled as LivedPassenger\ndf['Surname'] = df['Surname'].replace(single_woman, 'LivedPassenger')\n\n# All the boys alone will be labelled as DeadPassenger\ndf['Surname'] = df['Surname'].replace(single_boy, 'DeadPassenger')\n","4b3b2d19":"df['Surname'].value_counts()","7118fa80":"new_families = df.loc[(df.Surname != 'DeadMan') & (df.Surname != 'LivedPassenger') & (df.Surname != 'DeadPassenger') & (df.Surname != 'LivedFamily') & (df.Surname != 'DeadFamily')]\nnew_families_list = (df['Surname'].value_counts().index)[ df['Surname'].value_counts() < 5 ]\nnew_families","f9e09775":"df['Surname'] = df['Surname'].replace('Billiard', 'DeadFamily')\ndf['Surname'] = df['Surname'].replace(new_families_list, 'LivedFamily') #the highest value is this one where everyone here is dead!\n\ndf['Surname'].value_counts()","d84642b5":"# Define new feature\ndf['SurnameSurvival'] = 0\n\ndf.loc[(df.Surname == 'LivedPassenger'), 'SurnameSurvival'] = 1\ndf.loc[(df.Surname == 'LivedFamily'), 'SurnameSurvival'] = 1","9932176c":"prediction = df['SurnameSurvival'].loc[test_index]\nprediction","f4ea0def":"submission_df = {\"PassengerId\": holdout_ids,\n                 \"Survived\": prediction}\n\nsubmission = pd.DataFrame(submission_df)\nsubmission.to_csv(\"submission.csv\",index=False)","846d027a":"As it can be seen, all the **Surname** features were mapped into one of the five categories previously defined.\n\nFinally, let's create a new feature called **SurnameSurvival** which will set if a passenger lived depending upon the **Surname** class:\n* 1) **DeadMan**, **DeadFamily** and **DeadPassenger** means that  **SurnameSurvival** = 0.\n* 2) **LivedPassenger** and **LivedFamily** means that **SurnameSurvival** = 1   ","e6bcfbbb":"Finally, we will consider this **SurnameSurvival** as our prediction variable.","d0068966":"# 2.0 Variable Engineering","c604fff2":"# 3.0 Test data","e72c3013":"Now, let's apply what we defined in section 2.0 to the test dataset","04456e68":"# 1.0 Pre-processing","b9ceb6ba":"Now, there still **7 families** that did not appear previously in the training dataset. \n\nBefore performing any assumption, let's see the information about these passengers.","984584f9":"Hello, there!\n\nThis notebook presents a solution to the Titanic competition using nothing but **Name** feature to predict whether a passenger survived or died! I tried to comment as much as possible to ease your understanding about each step of the proposed solution.\n\nThe ideas to perform this notebook were developed by Chris Deotte and you can check his notebook in https:\/\/www.kaggle.com\/cdeotte\/titanic-using-name-only-0-81818, which is written in R language. \n\nHope you enjoy it reading it as much as I enjoyed making this solution! ","6a2ecff9":"In this section we will process some of the features in this dataset as well as adding new variables.\n\nUsing **only passenger names**, gender is deduced from title (Mr. Mrs. etc), children are determined from title (Master.), and family groups are identified by duplicate surnames (last names).\n\nIf we just predict females survive and males perish, we cross validate at 78.6% and receive a public leaderboard score of 76.6%.\nTo improve upon the gender model, we need to determine which **males survive** and which **females perish**.","6cc561d2":"# 4.0 Creating a submission file","5254ace3":"Now, we will make the predictions based on these **Surname** feature. We will consider the same strategy developed in the training section.","74a4abda":"Now, we will use the **Surname** information processed in the previous section (through the vectors passenger_lived, passenger_died, families_lived and families_died) to define if the passenger **survived** or **died** for both train and test dataset.","245756f0":"Now, let's extract the **Surname** of each passenger and use this information along the **Title** feature to set five different options:\n\n* 1) the passenger is a man - **DeadMan**\n* 2) the passenger is a woman\/boy, has no other family member (without considering men) and survived - **LivedPassenger**\n* 3) the passenger is a woman\/boy, has no other family member (without considering man) and died - **DeadPassenger**\n* 4) the passenger is a woman\/boy and its family has mainly lived ( >= 50% lived) - **LivedFamily**\n* 5) the passenger is a woman\/boy and its family has mainly died ( 50% < died) - **DeadFamily** ","16f667c6":"It is important to notice that there are **95 surnames** in the **test** dataset that **DID NOT** appear in the **train** dataset. \n\nIn this case, we do not have information if any family member or the person survived or not. Therefore, we have to make some assumptions about who survived.\n\nWe'll split the analysis in two cases: whether there is a single surname occurrence or more than one occurrence.","e7af58ad":"1. The majority of passengers are **women** and there are only **3 boys**.\n\nAs seen in section 2, the great majority of families considering only **women** and **boys** survived. Therefore, we will also apply this consideration in these samples, so the families above will be labeled as **LivedFamily**.\n\nHowever, it is interesting to notice that both members of the **Billiard** family are boys and there is no **woman** with them. Therefore we will set both of them as **DeadPassenger**.\n","ebd4a7a7":"By applying the definitions proposed in this notebook, we get an *Accuracy* of **89.7%** considering only the train data!","b0539dff":"By analyzing the Titanic data, we find that many male survivors are among the youth, namely 52.5% = 21\/40 of males under 16 years old survive. And most females who perish are among Pclass==3 passengers, namely 50% = 72\/144 of Pclass==3 females perish.\n\nSo let's focus on identifying surviving males and perishing females among these 184 passengers. The data indicates that woman and children were prioritized in rescue. Furthermore it appears that woman and children from the same family survived or perished together. \n\n**Let's engineer a new feature to identify surviving males and perishing females!**","475ccb1e":"There still **88 passengers** that has no other female\/boy relative in the test dataset.\n\nFor this group of people, we will consider two cases:\n* If it is a boy, he will be labeled as **DeadPassenger**.\n* If it is a female, she will be labeled as **LivedPassenger**."}}