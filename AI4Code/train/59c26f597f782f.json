{"cell_type":{"0bec1098":"code","e28c8b3a":"code","12db1635":"code","42832a86":"code","7aef0438":"code","7b83f518":"code","38e5bebf":"code","ea9324c4":"code","869e9c48":"code","f19bdea6":"code","ad69275b":"code","94727884":"code","cac0237a":"code","8514b0ae":"code","cf47ec52":"code","bd48e6d5":"code","60f6e3ab":"code","68da06d8":"code","a5ce6e07":"code","b82459e9":"code","10173eef":"code","17f0031b":"code","f0992a1e":"code","487f888d":"code","de1ce759":"code","9ee3f0f3":"code","870cdbfc":"code","35a8be5d":"code","de77480e":"code","372f5a78":"markdown","1370193e":"markdown","4b806e0b":"markdown","ef2c2991":"markdown","3bcde7f3":"markdown"},"source":{"0bec1098":"!pip install multi-prophet","e28c8b3a":"import gc\nfrom tqdm import tqdm\nimport numpy as np\nimport pandas as pd\nfrom pylab import rcParams\nimport matplotlib.pyplot as plt\nfrom sklearn.metrics import mean_squared_error\nfrom scipy.stats import probplot\n\nimport datetime as dt\nfrom datetime import date\nfrom datetime import timedelta\nfrom fbprophet import Prophet\nfrom multi_prophet import MultiProphet\nimport folium\nfrom folium import plugins\n\n%matplotlib inline\nimport os\nimport warnings\nwarnings.filterwarnings(\"ignore\")","12db1635":"data0=pd.read_csv('..\/input\/earthquakes-in-greece-19012018\/Major EarthQuakes in Greece.csv')\ndata0[-10:]","42832a86":"print(data0.columns.tolist())","7aef0438":"data0['Year']=data0['Year'].astype(str)\ndata0['Month']=data0['Month'].astype(str)\ndata0['Date']=data0['Date'].astype(str)\ndata0['date']=data0['Year']+'-'+data0['Month']+'-'+data0['Date']\ndata0","7b83f518":"data0=data0.fillna('N')\ndata1=data0[['date','MAGNITUDE (Richter)','LATATITUDE (N)','LONGITUDE  (E)']]\ndata1.columns=['date','mag','lat','long']\ndata1[0:5]","38e5bebf":"data2=pd.DataFrame(columns=data1.columns.tolist())\nfor i,item in enumerate(data1['date']):\n    data2=pd.concat([data2,data1.loc[i:i]])\ndata2=data2.sort_values(['date']).reset_index(drop=True)    ","ea9324c4":"from datetime import datetime as dt\ndata3=data2.copy()\ndate=[]\nfor item in data2['date']:\n    date+=[dt.strptime(item,'%Y-%m-%d')]\ndata3['date1']=date\ndata3","869e9c48":"import plotly.express as px\nfig=px.scatter(x=data3['date1'],y=data3['mag'])\nfig=px.scatter(data3, x=\"date\", y=\"mag\")\nfig.update_layout(title='Magnituide of earthquake in Greece')\nfig.show()","f19bdea6":"data3['date2']=data3['date1'].apply(lambda x: dt.strptime(str(x)[0:10],'%Y-%m-%d') )\ndata3","ad69275b":"data3.columns","94727884":"data4=data3[['date2','mag','lat','long',]][data3['mag']>5.9]\ndata4","cac0237a":"item1=data4\nitem1.columns = ['ds','y1','y2','y3']\nitem1.y1 = item1.y1.astype('float')\nitem1.y2 = item1.y2.astype('float')\nitem1.y3 = item1.y3.astype('float')\nitem1.ds = item1.ds.astype('datetime64')","8514b0ae":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y1)","cf47ec52":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y2)","bd48e6d5":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y3)","60f6e3ab":"mph = MultiProphet(columns=['y1','y2','y3'])\nmph.fit(item1)\nforecast = mph.predict(item1)\nmph.plot(forecast)","68da06d8":"from datetime import timedelta\nstart0 = dt.strptime('2017-01-01','%Y-%m-%d').date()\nend0   = dt.strptime('2023-01-01','%Y-%m-%d').date()\nprint((end0-start0).days)","a5ce6e07":"def daterange(start,end):\n    for i in range((end-start).days):\n        return start+timedelta(i)  ","b82459e9":"dates0=[]\nfor i in range((end0-start0).days):\n    dates0+=[(start0+timedelta(i)).strftime('%Y-%m-%d') ]\nprint(dates0[0:30])","10173eef":"dates0_df=pd.DataFrame(dates0)\ndates0_df.columns=['ds']\ndates0_df","17f0031b":"mph","f0992a1e":"#mph = MultiProphet(columns=[\"y1\",\"y2\"])\n#mph.fit(item1)\nforecast3 = mph.predict(dates0_df)\nfigure=mph.plot(forecast3)\nprint(figure)","487f888d":"forecast3['y1'][['ds','yhat','yhat_lower','yhat_upper']][365*5+1:]\n#forecast3['y2'][['ds','yhat','yhat_lower','yhat_upper']][365:385]\n#forecast3['y3'][['ds','yhat','yhat_lower','yhat_upper']][365:385]","de1ce759":"forecast4a=forecast3['y1'][['ds','yhat','yhat_lower','yhat_upper']][365*5+1:]\nforecast4b=forecast3['y2'][['ds','yhat','yhat_lower','yhat_upper']][365*5+1:]\nforecast4c=forecast3['y3'][['ds','yhat','yhat_lower','yhat_upper']][365*5+1:]","9ee3f0f3":"mag0=forecast4a['yhat'].max()\ndate0=forecast4a[forecast4a['yhat']==mag0]['ds'].tolist()[0]\nlat0=forecast4b[forecast4b['ds']==date0]['yhat'].tolist()[0]\nlong0=forecast4c[forecast4c['ds']==date0]['yhat'].tolist()[0]\nprint(date0.date(),round(mag0,1),round(lat0,3),round(long0,3))","870cdbfc":"forecastall=forecast4a[['ds','yhat']]\nforecastall2=pd.concat([forecastall,forecast4b['yhat'],forecast4c['yhat']],axis=1)\nforecastall2.columns=['date','mag','lat','long']\nforecastall2","35a8be5d":"data5=forecastall2[['lat','long']]\ndata5","de77480e":"eq_map = folium.Map(location=[38.0,23.7],tiles='Stamen Terrain',zoom_start=7.0,min_zoom=2.0)\neq_map.add_child(plugins.HeatMap(data5))\neq_map","372f5a78":"# fit past and predict past+future","1370193e":"# **Earthquake Prediction Greece Multi Prophet**","4b806e0b":"# Predict MAX Magnitude of Earthquakes in 2022","ef2c2991":"https:\/\/github.com\/vonum\/multi-prophet","3bcde7f3":"# fit past and predict past"}}