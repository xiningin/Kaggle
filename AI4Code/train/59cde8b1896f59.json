{"cell_type":{"5c3df7fa":"code","4dc5bd3e":"code","1970f337":"code","1793e8a4":"code","9f72af4e":"code","cbc6603d":"code","d8411d93":"code","acebf9bd":"code","a0a80606":"code","dc3cb4dc":"code","f07e0c26":"code","e660e0cb":"code","08a0f001":"code","1a92ba40":"code","0a8d11c0":"code","b8185430":"code","5cf8f33c":"code","b6cdc2dd":"code","2789ea86":"code","e224283e":"code","147641e5":"code","9a237e23":"code","f5ca7d3c":"code","e988bede":"markdown","1578e5ae":"markdown","5a7d5323":"markdown","41dc9865":"markdown","910e0cd9":"markdown","30d15f21":"markdown","7ab776e5":"markdown","80ccd98b":"markdown","21dfa2d8":"markdown","1b37e957":"markdown","5feaf312":"markdown","25845fa4":"markdown","2d987d4c":"markdown","14d6bef2":"markdown","d89310b3":"markdown","a8710d6d":"markdown"},"source":{"5c3df7fa":"! pip install -q dabl","4dc5bd3e":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport pydicom as dcm\nimport glob\nimport random\nimport warnings\nfrom tqdm.notebook import tqdm\nfrom colorama import Fore, Style\nimport os\n\nimport dabl\n\nimport plotly.express as px\nimport plotly.figure_factory as ff\nimport plotly.graph_objs as go\nfrom plotly.offline import iplot\n\nimport matplotlib.animation as animation\nfrom matplotlib.widgets import Slider\nfrom IPython.display import HTML, Image\n\nwarnings.simplefilter(\"ignore\")","1970f337":"def cout(string: str, color: str) -> str:\n    \"\"\"\n    Prints a string in the required color\n    \"\"\"\n    print(color+string+Style.RESET_ALL)\n    \ndef read_image(filename: str) -> np.ndarray:\n    \"\"\"\n    Read a DICOM Image File and return it (as a numpy array)\n    \"\"\"\n    img = dcm.dcmread(filename).pixel_array\n    img[img == -2000] = 0\n    return img\n\ndef plot_dicom(image_list, rows=5, cols=4, cmap='jet', is_train=True):\n    fig = plt.figure(figsize=(12, 12))\n    if is_train:\n        plt.title(f\"DICOM Images from Training Set\")\n    else:\n        plt.title(f\"DICOM Images from Testing Set\")\n    img_count = 0\n    for i in range(1, rows*cols+1):\n        filename = image_list[img_count]\n        image = read_image(filename)\n        fig.add_subplot(rows, cols, i)\n        plt.grid(False)\n        plt.imshow(image, cmap=cmap)\n        img_count += 1","1793e8a4":"train = pd.read_csv(\"..\/input\/rsna-str-pulmonary-embolism-detection\/train.csv\")\ntest = pd.read_csv(\"..\/input\/rsna-str-pulmonary-embolism-detection\/test.csv\")\nsub = pd.read_csv(\"..\/input\/rsna-str-pulmonary-embolism-detection\/sample_submission.csv\")","9f72af4e":"%%time\ntrain_files = glob.glob(\"..\/input\/rsna-str-pulmonary-embolism-detection\/train\/*\/*\/*.dcm\")\ntest_files = glob.glob(\"..\/input\/rsna-str-pulmonary-embolism-detection\/test\/*\/*\/*.dcm\")","cbc6603d":"cout(f\"Total Number of DICOM Images in Training Set: {len(train_files)}\", Fore.GREEN)\ncout(f\"Total Number of DICOM Images in Testing Set:  {len(test_files)}\", Fore.YELLOW)","d8411d93":"train.head()   ","acebf9bd":"test.head()","a0a80606":"sub.head()","dc3cb4dc":"train.describe()","f07e0c26":"features = train[['qa_motion', 'qa_contrast', 'true_filling_defect_not_pe', 'flow_artifact']]\nfeatures.head()","e660e0cb":"vals = features['qa_motion'].value_counts().tolist()\nidx = ['No Issue', 'Issue']\nfig = px.pie(\n    values=vals,\n    names=idx,\n    title='Issue with Motion in Studies',\n    color_discrete_sequence=['blue', 'cyan']\n)\niplot(fig)","08a0f001":"vals = features['qa_contrast'].value_counts().tolist()\nidx = ['No Issue', 'Issue']\nfig = px.pie(\n    values=vals,\n    names=idx,\n    title='Issue with Contrast in Studies',\n    color_discrete_sequence=['gold', 'yellow']\n)\niplot(fig)","1a92ba40":"vals = features['true_filling_defect_not_pe'].value_counts().tolist()\nidx = ['Defect not PE', 'Defect is PE']\nfig = px.pie(\n    values=vals,\n    names=idx,\n    title='Is defect PE or Not',\n    color_discrete_sequence=['black', 'gray']\n)\niplot(fig)","0a8d11c0":"vals = features['flow_artifact'].value_counts().tolist()\nidx = ['Is an Artifact', 'Is not an Artifact']\nfig = px.pie(\n    values=vals,\n    names=idx,\n    title='Flow Artifact',\n)\niplot(fig)","b8185430":"targets = train[['negative_exam_for_pe', 'rv_lv_ratio_gte_1', 'rv_lv_ratio_lt_1', 'leftsided_pe', 'chronic_pe', 'rightsided_pe', 'acute_and_chronic_pe', 'central_pe', 'indeterminate']]\ntargets.head()","5cf8f33c":"dabl.plot(targets, target_col='negative_exam_for_pe')","b6cdc2dd":"dabl.plot(targets, target_col='rv_lv_ratio_gte_1')","2789ea86":"dabl.plot(targets, 'rightsided_pe')","e224283e":"# Plot any-20 training images\ntrain_imgs = train_files[:20]\nplot_dicom(image_list=train_imgs, is_train=True, cmap='gray')","147641e5":"# Plot any-20 testing images\ntest_imgs = test_files[:20]\nplot_dicom(image_list=test_imgs, is_train=False, cmap='gray')","9a237e23":"%%capture\n\nids = \"..\/input\/rsna-str-pulmonary-embolism-detection\/train\/6897fa9de148\/2bfbb7fd2e8b\/\"\n\nimg_datas = []\nfor im in os.listdir(ids):\n    meta = dcm.dcmread(os.path.join(ids, im))\n    srl = meta.InstanceNumber\n    data = meta.pixel_array\n    data[data == -2000] = 0\n    img_datas.append((srl, data))\n    \nimg_datas.sort()\nims = []\nfig = plt.figure()\nfor gg in img_datas:\n    img_ = plt.imshow(gg[1], cmap='jet', animated=True)\n    plt.axis(\"off\")\n    ims.append([img_])\n\nani = animation.ArtistAnimation(fig, ims, interval=1000\/\/24, blit=False, repeat_delay=1000)","f5ca7d3c":"HTML(ani.to_jshtml())","e988bede":"<h1 style=\"color:blue\">Exploratory Data Analysis<\/h1>\n\nLet's start with EDA. We'll cover both training and testing sets.","1578e5ae":"<h3 style=\"color:yellow\">Lung CT Animation<\/h3>\n\nFinally, let's make Animation of different lung scan slices of a particular Study.\n\n[This Notebook](https:\/\/www.kaggle.com\/avloss\/eda-with-animation) helped me in making the animation.","5a7d5323":"<h2 style=\"color:aqua\">Feature Columns<\/h2>\nAt the hindsight it may appear that there are no features other than the images themselves, but we are provided with 4 Features that aren't used for prediction but only for helping our predictions.","41dc9865":"<h3 style=\"color:yellow\">Issue with Motion? (qa_motion)<\/h3>\nThis feature indicates if there was an issue with the motion noted by radiologists in the study.","910e0cd9":"<h3 style=\"color:yellow\">Inspect the Images<\/h3>\n\nLet's start by just taking a look at a few images from training and testing sets","30d15f21":"These features are:\n\n* **qa_motion** - Indicates whether radiologists noted an issue with motion in the study.\n* **qa_contrast** - Indicates whether radiologists noted an issue with contrast in the study.\n* **true_filling_defect_not_pe** - Indicates a defect that is NOT PE.\n* **flow_artifact**","7ab776e5":"<h2 style=\"color:aqua\">Target Columns<\/h2>\n\nThe columns that remain after we disclude the feature columns are target columns. Here are the details of what different target columns mean:\n\n* **negative_exam_for_pe** - exam-level, whether there are any images in the study that have PE present.\n* **rv_lv_ratio_gte_1** - exam-level, indicates whether the RV\/LV ratio present in the study is >= 1\n* **rv_lv_ratio_lt_1** - exam-level, indicates whether the RV\/LV ratio present in the study is < 1\n* **leftsided_pe** - exam-level, indicates that there is PE present on the left side of the images in the study\n* **chronic_pe** - exam-level, indicates that the PE in the study is chronic\n* **rightsided_pe** - exam-level, indicates that there is PE present on the right side of the images in the study\n* **acute_and_chronic_pe** - exam-level, indicates that the PE present in the study is both acute AND chronic\n* **central_pe** - exam-level, indicates that there is PE present in the center of the images in the study\n* **indeterminate** -exam-level, indicates that while the study is not negative for PE, an ultimate set of exam-level labels could not be created, due to QA issues","80ccd98b":"<h3 style=\"color:yellow\">Issue with Contrast? (qa_contrast)<\/h3>\nThis feature indicates if there was an issue with the contrast noted by radiologists in the study.","21dfa2d8":"<h2 style=\"color:aqua\">DICOM Image Data Analysis<\/h2>\n\nLet's now start doing the DICOM Image Data Analysis.","1b37e957":"<h2 style=\"color:aqua\">Peaking at the DataFrames<\/h2>\n\nLet's start by taking a look at the dataframes of train, test and submission sets.","5feaf312":"<h3 style=\"color:yellow\">flow_artifact<\/h3>","25845fa4":"<h3 style=\"color:yellow\">DABL Plot<\/h3>\n\nLet's plot some of the target columns using DABL","2d987d4c":"Note: I couldn't find what `flow_artifact` feature is about, please correct me if I am wrong about it.","14d6bef2":"<strong style=\"color:red\">If you liked this notebook, don't forget to leave an upvote or a comment!<\/strong>","d89310b3":"<h3 style=\"color:yellow\">Indicates if a Defect isn't PE? (true_filling_defect_not_pe)<\/h3>\nThis feature indicates if the defect is a PE or not.","a8710d6d":"<h1 style=\"color:green\">What, Why and How?<\/h1>\n\n<h3 style=\"color:gray\">Pulomonary Embolism<\/h3>\n\n![](https:\/\/upload.wikimedia.org\/wikipedia\/commons\/7\/77\/SaddlePE.PNG)\n\nPulmonary embolism (PE) is a blockage of an artery in the lungs by a substance that has moved from elsewhere in the body through the bloodstream (embolism). Symptoms of a PE may include shortness of breath, chest pain particularly upon breathing in, and coughing up blood. Symptoms of a blood clot in the leg may also be present, such as a red, warm, swollen, and painful leg. Signs of a PE include low blood oxygen levels, rapid breathing, rapid heart rate, and sometimes a mild fever. Severe cases can lead to passing out, abnormally low blood pressure, and sudden death.\n\n<h3 style=\"color:gray\">How it happens?<\/h3>\n\nPE usually results from a blood clot in the leg that travels to the lung. The risk of blood clots is increased by cancer, prolonged bed rest, smoking, stroke, certain genetic conditions, estrogen-based medication, pregnancy, obesity, and after some types of surgery. A small proportion of cases are due to the embolization of air, fat, or amniotic fluid.\n\n<strong>In this competition, we are predicting the existence and characteristics of pulmonary embolisms.<\/strong>"}}