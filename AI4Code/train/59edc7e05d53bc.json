{"cell_type":{"808af240":"code","fa9d3080":"code","233c5591":"code","77288d0f":"code","02d6ae21":"code","640c4b78":"code","5f77e40a":"code","cff371ff":"code","fdc7abc5":"code","fdbeb443":"code","f51c3607":"code","0d8d0a7c":"code","555bd07c":"code","73514631":"code","eb67e828":"code","7afbbf8f":"code","772e219c":"code","48d8b68f":"code","77736540":"code","bdadd014":"code","4ab7c2b2":"code","7365d9c7":"code","5fe46b77":"code","869611bb":"code","f6329d8f":"code","e2c15582":"code","3db4df4f":"code","af010450":"code","12699e3d":"code","1e6088dd":"code","a94551b0":"code","ad0d6827":"markdown","ac08c300":"markdown","82b07c1d":"markdown","e427edfb":"markdown"},"source":{"808af240":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nfrom mlxtend.frequent_patterns import apriori, association_rules\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session\n\n!pip install xlrd\n!pip install openpyxl","fa9d3080":"df = pd.read_excel('\/kaggle\/input\/online-retail-dataset\/online_retail_II.xlsx')","233c5591":"# \u0130lk 5 sat\u0131r\u0131 g\u00f6sterir. df.head(20) \u0130lk 20 sat\u0131r\u0131 g\u00f6sterir.\ndf.head() ","77288d0f":"# Son 5 sat\u0131r\u0131 g\u00f6sterir. df.tail(20) son 20 sat\u0131r\u0131 g\u00f6sterir.\ndf.tail()","02d6ae21":"# Dataframe'in boyutunu g\u00f6sterir\ndf.shape ","640c4b78":"# Dataframe s\u00fctunlar\u0131n\u0131n veri tiplerini g\u00f6sterir\ndf.dtypes ","5f77e40a":"# Eksik De\u011fer Kontrol\u00fc\ndf.isnull().sum()","cff371ff":"# Eksik de\u011ferlerin veri setinden d\u00fc\u015f\u00fcr\u00fclmesi\ndf.dropna(inplace=True)","fdc7abc5":"# Hangi \u00fcr\u00fcnden ka\u00e7 adet var \ndf[\"StockCode\"].value_counts()","fdbeb443":"#Toplam ka\u00e7 farkl\u0131 \u00fcr\u00fcn var?\ndf[\"StockCode\"].nunique() ","f51c3607":"#Hangi \u00fclke i\u00e7in ka\u00e7 veri var?\ndf[\"Country\"].value_counts()","0d8d0a7c":"# En \u00e7ok sipari\u015f edilen \u00fcr\u00fcnler\ndf.groupby(\"StockCode\").agg({\"Quantity\":\"sum\"}).sort_values(by=\"Quantity\",ascending=False).head(5)","555bd07c":"# Faturalardaki \u2018C\u2019 iptal edilen i\u015flemleri g\u00f6stermektedir. \u0130ptal edilen i\u015flemleri veri setinden \u00e7\u0131kart\u0131yoruz.\ndf = df[~df[\"Invoice\"].str.contains(\"C\", na=False)]","73514631":"# Quantity ve Price de\u011fi\u015fkenleri i\u00e7in 0'dan b\u00fcy\u00fck de\u011ferleri al\u0131yoruz.\ndf = df[df[\"Quantity\"] > 0]\ndf = df[df[\"Price\"] > 0]","eb67e828":"#Say\u0131sal ve Ayn\u0131 Zamanda Kategorik olmayan De\u011fi\u015fkenleri Yakal\u0131yoruz\nnum_cols = [col for col in df.columns if df[col].dtypes != \"O\"]\nnum_but_cat = [col for col in df.columns if df[col].nunique() < 10 and df[col].dtypes != \"O\"]\nnum_cols = [col for col in num_cols if col not in num_but_cat]\nnum_cols","7afbbf8f":"# E\u015fiklerle De\u011fi\u015ftir\nfor col in num_cols:\n    q1 = df[col].quantile(0.25)\n    q3 = df[col].quantile(0.75)\n    iqr = q3 - q1\n    up_limit = q3 + 1.5 * iqr\n    low_limit = q1 - 1.5 * iqr\n    df.loc[(df[col] < low_limit), col] = low_limit\n    df.loc[(df[col] > up_limit), col] = up_limit\n    if df[df[col] > up_limit].any(axis=None):\n        print(col,\"YES\",(low_limit,up_limit))\n    elif df[df[col] < low_limit].any(axis=None):\n        print(col,\"YES\",(low_limit,up_limit))\n    else: \n        print(col,\"NO\",(low_limit,up_limit))","772e219c":"# Germany m\u00fc\u015fterileri \u00fczerinden birliktelik kurallar\u0131 \u00fcretece\u011fiz.\ndf_gr = df[df['Country'] == \"Germany\"]","48d8b68f":"# HANG\u0130 \u00dcR\u00dcNDEN KA\u00c7 TANE ALINMI\u015e?\ndf_gr.groupby(['Invoice', 'Description']).agg({\"Quantity\": \"sum\"}).head(20)","77736540":"# Veri setini istedi\u011fimiz forma d\u00f6v\u00fc\u015ft\u00fcr\u00fcyoruz. Unstack fonksiyonu parametrelerini kullanarak NA de\u011ferleri \ndf_gr.groupby(['Invoice', 'Description']).agg({\"Quantity\": \"sum\"}).unstack(fill_value= \"0\").iloc[0:5, 0:5]","bdadd014":"# Post bar\u0131nd\u0131ran ifadeler posta \u00fccretleridir. Bunlarla ilgili i\u015flem yapmayaca\u011f\u0131m\u0131z i\u00e7in veri setinden \u00e7\u0131karaca\u011f\u0131z.\ndf_gr[df_gr[\"StockCode\"] == \"POST\"]","4ab7c2b2":"# Post bar\u0131nd\u0131ran ifadeleri \u00e7\u0131kart\u0131yoruz.\ndf_gr = df_gr[~df_gr[\"StockCode\"].str.contains(\"POST\", na=False)]","7365d9c7":"# Post ifadeleri kontrol edelim.\ndf_gr[df_gr[\"StockCode\"] == \"POST\"]","5fe46b77":"# Invoice de\u011ferlerimizi sepet StockCode de\u011ferlerimizi sepetimizde ki \u00fcr\u00fcnler olarak de\u011ferlerdirebilece\u011fimiz formata \u00e7eviriyoruz.\ngr_inv_pro_df = df_gr.groupby(['Invoice', \"StockCode\"])['Quantity'].sum().unstack().fillna(0). \\\n            applymap(lambda x: 1 if x > 0 else 0)","869611bb":"gr_inv_pro_df.head()","f6329d8f":"# SUPPORT DE\u011eERLER\u0130N\u0130 ELDE ETME\n\n# T\u00fcm olas\u0131 \u00fcr\u00fcn birlikteliklerinin olas\u0131l\u0131klar\u0131 i\u00e7in aprioriyi kullan\u0131yoruz\n# Min support bizim belirledi\u011fimiz threshold de\u011feri\n# use_colnames: S\u00fctun isimlerini kullan diyoruz ama bize \u00fcr\u00fcnlerin idleri gelcek\nfrequent_itemsets = apriori(gr_inv_pro_df, min_support=0.01, use_colnames=True)","e2c15582":"# D\u0130\u011eER B\u00dcT\u00dcN METR\u0130KLER\u0130 HESAPLIYORUZ\nrules = association_rules(frequent_itemsets, metric=\"support\", min_threshold=0.01)\nrules.sort_values(\"support\", ascending=False).head()","3db4df4f":"sorted_rules = rules.sort_values(\"lift\", ascending=False)\nrules.sort_values(\"lift\", ascending=False).head(5)","af010450":"# \u00dcR\u00dcN \u00d6NERME\n\nproduct_id = 21576\n\nrecommendation_list = []\n\nfor i, product in enumerate(sorted_rules[\"antecedents\"]):\n    for j in list(product):\n        if j == product_id:\n            recommendation_list.append(list(sorted_rules.iloc[i][\"consequents\"])[0])\n            \n# \u00d6nerilen ilk 2 \u00fcr\u00fcn \nrecommendation_list[0:4]","12699e3d":"# \u00d6nerilen \u00fcr\u00fcnlerin isimleri nelerdir ? \nfor name in recommendation_list[0:4]:\n    product_name = df[df[\"StockCode\"] == name][[\"Description\"]].values[0].tolist()\n    print(product_name)","1e6088dd":"# \u00dcR\u00dcN \u00d6NERME\n\nproduct_id = 21432\n\nrecommendation_list = []\n\nfor i, product in enumerate(sorted_rules[\"antecedents\"]):\n    for j in list(product):\n        if j == product_id:\n            recommendation_list.append(list(sorted_rules.iloc[i][\"consequents\"])[0])\n            \n# \u00d6nerilen ilk 2 \u00fcr\u00fcn \nrecommendation_list[0:2]","a94551b0":"# \u00d6nerilen \u00fcr\u00fcnlerin isimleri nelerdir ? \nfor name in recommendation_list[0:2]:\n    product_name = df[df[\"StockCode\"] == name][[\"Description\"]].values[0].tolist()\n    print(product_name)","ad0d6827":"Elimizdeki \u00f6l\u00e7\u00fcm ihtiyac\u0131 olan \u015feyleri \u00f6l\u00e7mek i\u00e7in \u00f6ncelikle bunlar\u0131 matematiksel forma d\u00f6n\u00fc\u015ft\u00fcrmek gerekir. Verinin gelmesini istedi\u011fimiz durum: Bizim istedi\u011fimiz formda faturalara sepet muamelesi yap\u0131yoruz. Elde etmek istedi\u011fimiz sonu\u00e7: S\u00fctunlara b\u00fct\u00fcn olas\u0131 \u00fcr\u00fcnleri koyup, bir sepette bu \u00fcr\u00fcnlerden varsa 1 yoksa 0 yazd\u0131r\u0131ca\u011f\u0131z.","ac08c300":"# **4) ARL Veri Yap\u0131s\u0131n\u0131 Haz\u0131rlama (Invoice-Product Matrix)**","82b07c1d":"- antecedent : X\n\n- consequent : Y\n\n- antecedent support: Tek ba\u015f\u0131na X olas\u0131l\u0131\u011f\u0131\n\n- consequent support: Tek ba\u015f\u0131na Y olas\u0131l\u0131\u011f\u0131\n\n- support: \u0130kisinin birlikte g\u00f6r\u00fclme olas\u0131l\u0131\u011f\u0131\n\n- confidence: X al\u0131nd\u0131\u011f\u0131nda Y al\u0131nma olas\u0131l\u0131\u011f\u0131.\n\n- lift: X al\u0131nd\u0131\u011f\u0131nda Y al\u0131nma olas\u0131l\u0131\u011f\u0131 .. kat artar.\n\n- conviction: Y olmadan X'in beklenen frekans\u0131\n\n- leverage : Kald\u0131ra\u00e7 demek lift'e benzer. Lift kullan\u0131l\u0131r. \u00c7\u00fcnk\u00fc leverage supportu y\u00fcksek de\u011ferlere \u00f6ncelik verme e\u011filimi vard\u0131r.\n\nEticarette \u00fcr\u00fcn \u00e7iftlerinde \u00e7ok s\u0131k iki \u00fcr\u00fcn birlikte al\u0131nd\u0131\u011f\u0131nda di\u011ferini \u00f6nermek mant\u0131kl\u0131 olacakt\u0131r.\n\nBurada daha g\u00fcvenli diye d\u00fc\u015f\u00fcn\u00fclebilecek confidence' a odaklan\u0131labilir. Ama asl\u0131nda bu metriklerin kesi\u015fimi kullan\u0131l\u0131r.\n\n\u00d6rne\u011fin support'u A dan b\u00fcy\u00fck lift'i B'den b\u00fcy\u00fck olanlar\u0131 filtrele gibi her birinden bir \u00e7iftte yakalanabilir. Kullan\u0131c\u0131 online olup sepetine bir \u00fcr\u00fcn ekledi\u011finde bizim o \u00fcr\u00fcn\u00fcn id sini al\u0131p support, confidence ve lift de\u011ferlerine g\u00f6re ona tavsiye edilecek \u00fcr\u00fcn\/\u00fcr\u00fcnleri bulup kar\u015f\u0131s\u0131na getirmemiz laz\u0131m.","e427edfb":"## Association Rule Learning( Birliktelik Kural\u0131 \u00d6\u011frenimi)\n\nKullan\u0131c\u0131lara baz\u0131 teknikleri kullanarak \u00f6nerme i\u015flemleri yap\u0131labilen y\u00f6ntemlerden birisidir. Veri i\u00e7erisindeki \u00f6r\u00fcnt\u00fcleri(ili\u015fki, yap\u0131) bulmak i\u00e7in kullan\u0131lan kural tabanl\u0131 bir makine \u00f6\u011frenmesi tekni\u011fidir.\n\n###Apriori Algoritmas\u0131:\nBir sepet analizi y\u00f6ntemidir. \u00dcr\u00fcn birlikteliklerini ortaya \u00e7\u0131karmak i\u00e7in kullan\u0131l\u0131r.\n\n** N: B\u00fct\u00fcn g\u00f6zlemler**\n\n**Support(X,Y)** = Freq(X,Y)\/N\n\nX ve Y nin birlikte g\u00f6r\u00fclme olas\u0131l\u0131\u011f\u0131\n\n**Confidence(X,Y)** = Freq(X,Y) \/ Freq(X)\n\nX sat\u0131n al\u0131nd\u0131\u011f\u0131nda Y\u2019nin sat\u0131lmas\u0131 olas\u0131l\u0131\u011f\u0131\n\n**Lift**= Support(X,Y) \/ (Support(X) * Support(Y))\n\nX sat\u0131n al\u0131nd\u0131\u011f\u0131nda Y\u2019nin sat\u0131n al\u0131nma olas\u0131l\u0131\u011f\u0131 lift kat kadar artar.\n\n\nBurada iteratif olarak \u015funlar yap\u0131lacak:\n\n- \u00d6nce ikili \u00fcr\u00fcn \u00e7iftlerine bak\u0131lacak. Belirli bir support e\u015fik de\u011feri belirlenecek. Support e\u015fik de\u011ferinden k\u00fc\u00e7\u00fck olan \u00fcr\u00fcn \u00e7iftleri elenecek.\n\n- \u0130kinci turda \u00fc\u00e7l\u00fc \u00fcr\u00fcn kombinasyonlar\u0131na bak\u0131lacak. Belirlenen e\u015fik support de\u011ferinin alt\u0131nda olanlar tekrar elenecek.\n\n- D\u00f6rtl\u00fc kombinasyonlar\u0131na bak\u0131l\u0131p Support de\u011ferinin alt\u0131nda kalan k\u00fcme yine elenecek.\n\nBu \u015fekilde olas\u0131 b\u00fct\u00fcn kombinasyonlar \u00e7\u0131kar\u0131ld\u0131ktan sonra elimizde bir liste kalacak. Bu liste \u00fczerinden \u00fcr\u00fcnlerin support, confidence ve lift de\u011ferleri basit bir liste halinde elimizde olacak. \u015eu tip yorumlar getirilebilecek:\n\n\"X \u00fcr\u00fcn\u00fc al\u0131nd\u0131\u011f\u0131nda Y nin al\u0131nma olas\u0131l\u0131\u011f\u0131 \u015fuymu\u015f.\"\n\n\"E\u011fer benim web sitemde kullan\u0131c\u0131 X \u00fcr\u00fcn\u00fc sepetine eklerse ona hemen Y \u00fcr\u00fcn\u00fcn\u00fc \u00f6neriyim.\" \u015feklinde yorumlar getirebiliriz.\n\nBunu filtreleme i\u00e7in yap\u0131yoruz. \u00c7\u00fcnk\u00fc ger\u00e7ek hayatta \u00e7ok fazla \u00fcr\u00fcn bulunmakta ve bizim eleme yapmam\u0131z gerekir."}}