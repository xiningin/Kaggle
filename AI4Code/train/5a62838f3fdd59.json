{"cell_type":{"eab25d82":"code","5f3ffa2d":"code","8c666100":"code","82eb576a":"code","8937f585":"code","cde42587":"code","936738a5":"code","c06e7ab4":"code","511d6872":"code","3728485a":"code","986bc28d":"code","a7cbc203":"code","da628b92":"code","c6104766":"code","3377d9f6":"code","940cb979":"code","da84c74b":"code","432413c1":"code","036a0c93":"code","fad9aef8":"code","22515e52":"code","71c75328":"code","5c0583fb":"code","b6384cba":"code","1f0b1011":"markdown","e09f7cb3":"markdown","628cc3e5":"markdown"},"source":{"eab25d82":"!pip install torch==1.6.0+cu101 torchvision==0.7.0+cu101 -f https:\/\/download.pytorch.org\/whl\/torch_stable.html\n","5f3ffa2d":"import torch\nprint(torch.__version__)","8c666100":"import fastai\nprint(fastai.__version__)","82eb576a":"from fastai.vision.all import *","8937f585":"path = Path('..\/input\/input\/siim-isic-melanoma-classification\/')\n","cde42587":"import pandas as pd","936738a5":"train_df = pd.read_csv('..\/input\/siim-isic-melanoma-classification\/train.csv')\nprint(\"Training samples\", train_df.shape)\nprint(\"First few samples of data are\",train_df.head())","c06e7ab4":"train_df.target.value_counts()\n","511d6872":"train_df_output_1 = train_df[train_df['target']==1]\ntrain_df.shape\n","3728485a":"train_df_output_0 = train_df[train_df['target']==0].sample(frac=0.03)\ntrain_df_output_0.shape\n","986bc28d":"new_df = pd.concat([train_df_output_0,train_df_output_1]).reset_index(drop=True)\nnew_df.shape\n","a7cbc203":"new_df.head()\nnew_df.shape, \nnew_df.target.value_counts()\n","da628b92":"from sklearn.model_selection import StratifiedKFold\nskf = StratifiedKFold(n_splits=5, shuffle=True, random_state=12)\n","c6104766":"fold = 0\nfor train_index, test_index in skf.split(X=new_df.values, y=new_df.target.values):\n    fold+= 1\n    print(\"Fold\",fold)\n    print(\"TRAIN LENGTH:\", len(train_index), \"VALIDATION LENGTH:\", len(test_index))\n    new_df[f'fold_{fold}_valid']= 0\n    new_df.loc[test_index,f'fold_{fold}_valid']= 1\n","3377d9f6":"imgpath = Path('..\/input\/siim-isic-melanoma-classification\/jpeg\/train')\n","940cb979":"dls = ImageDataLoaders.from_df(new_df, path=imgpath,\n                               seed=42, fn_col=0, \n                               suff='.jpg', label_col=7, \n                               valid_col=f'fold_1_valid', item_tfms=Resize(128), \n                               batch_tfms=aug_transforms(flip_vert=True, max_warp=0.), \n                               bs=128, val_bs=None, shuffle_train=True)\n","da84c74b":"print(torch.cuda.is_available())","432413c1":"dls.device","036a0c93":"dls.show_batch()\n","fad9aef8":"#learn = cnn_learner(dls,resnet34,metrics = [accuracy,roc_auc])\nlearn = cnn_learner(dls, resnet34, metrics=error_rate)\nlearn.fine_tune(1)\n","22515e52":"samplesubmit = \"..\/input\/siim-isic-melanoma-classification\/sample_submission.csv\"\nsub = pd.read_csv(samplesubmit)\nsub.head()\n","71c75328":"for i in range(10982):\n    x = sub.at[i,'image_name']\n    imggpath = Path(\"..\/input\/siim-isic-melanoma-classification\/jpeg\/test\/\" + x + \".jpg\")\n    pr1,_,pr2 = learn.predict(imggpath)\n    sub.at[i,'target'] = float(pr2[int(pr1)])","5c0583fb":"sub.head()","b6384cba":"sub.to_csv('sub1.csv', index=False)","1f0b1011":"This is my first notebook on Kaggle. Please leave your sugestions below.\nPlease upvote it if you find it useful and to show your support too. \nThanks. \ud83d\udc4d","e09f7cb3":"I plan to write a code explanation for this and train the model further to improve the accuracy of the model. ","628cc3e5":"I have used the latest Fastai(Fastai version 2 library) to train the model and make predictions on test set."}}