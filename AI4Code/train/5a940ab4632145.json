{"cell_type":{"13ba2d97":"code","2faaf706":"code","1c0bab45":"code","9f037539":"code","60066ec7":"code","558574cf":"code","4f61d2c0":"code","f97d5039":"code","c3fe6a0b":"code","04e7a610":"code","e41c432f":"code","daaf1a56":"code","89a9f522":"code","23e98b06":"code","f5ace79a":"code","72f0efa0":"code","3e15cd5f":"code","0399fd02":"code","471cc375":"code","59f92231":"code","7f732c9f":"code","8b33a13d":"code","c2d5050d":"markdown","7cd757d3":"markdown","ef6b812a":"markdown","67cb1a07":"markdown","55eebeb8":"markdown"},"source":{"13ba2d97":"# \u30e9\u30a4\u30d6\u30e9\u30ea\u306eimport\nfrom dataclasses import dataclass\nfrom pathlib import Path\n\nimport numpy as np\nimport pandas as pd\nfrom tqdm import tqdm\nimport matplotlib.pyplot as plt\nimport plotly.express as px\n\nimport librosa\nimport librosa.display\nimport IPython\n\nfrom sklearn.preprocessing import minmax_scale, MinMaxScaler\nfrom sklearn.decomposition import PCA\nfrom sklearn.manifold import TSNE\n\nfrom sklearn.metrics import roc_auc_score\nfrom sklearn.neighbors import LocalOutlierFactor\nfrom sklearn.ensemble import IsolationForest\n\nimport umap\nfrom sklearn.cluster import KMeans","2faaf706":"@dataclass(frozen=True)\nclass DataPath:\n    input_dir: str = '..\/input\/hah-data-science-challenge'\n    train_wav_dir: str = f'{input_dir}\/train\/train'\n    test_wav_dir: str = f'{input_dir}\/test\/test'\n    train_csv: str = f'{input_dir}\/train.csv'\n    test_csv: str = f'{input_dir}\/test.csv'\n\ndata_path = DataPath()","1c0bab45":"df_train = pd.read_csv(data_path.train_csv)\ndf_test = pd.read_csv(data_path.test_csv)\n\ndf_train['file_path'] = data_path.train_wav_dir +'\/' +df_train['\u30d5\u30a1\u30a4\u30eb']\ndf_test['file_path'] = data_path.test_wav_dir +'\/'+ df_test['\u30d5\u30a1\u30a4\u30eb']\n# df_train[\"train_test\"] = \"train\"\n# df_test[\"train_test\"] = \"test\"","9f037539":"df_all = pd.concat([df_train,df_test])","60066ec7":"file_names = df_all['file_path'].tolist()","558574cf":"from typing import List\n\n# \u30d5\u30fc\u30ea\u30a8\u5909\u63db\u7528\u306ehepler\u30af\u30e9\u30b9\u3092\u4f5c\u308b\u3002\nclass FourieTransformHelper:\n    def __init__(self,  \n                 file_names: List[str],\n                 input_dir: str=None):\n        if isinstance(file_names, list):\n            self.file_names = file_names\n        else:\n            raise TypeError(f'file_names type is {type(file_names)} not list!')\n        self.input_dir = input_dir\n        self.spectra, self.frequencies = [], []\n        \n    def _get_spectrum(self, signal, sample_rate):\n        # \u53c2\u8003 https:\/\/medium.com\/analytics-vidhya\/simplifying-audio-data-fft-stft-mfcc-for-machine-learning-and-deep-learning-443a2f962e0e\n        fft = np.fft.fft(signal)\n        spectrum = np.abs(fft)\n        frequency = np.linspace(0, sample_rate, int(len(spectrum)\/2))\n        spectrum = spectrum[:int(len(spectrum)\/2)]\n        return spectrum, frequency\n    \n    def _get_filename(self, file_name):\n            if self.input_dir:\n                return f'{self.input_dir}\/{file_name}'\n            else:\n                return file_name\n    \n    def get_spectra(self):\n        for file_name in tqdm(self.file_names):\n            file_path = self._get_filename(file_name)\n            audio, sample_rate = librosa.load(file_path)\n            # \u9069\u5f53\u306a\u9577\u3055\u306b\u5207\u308a\u53d6\u308b\u3002\u30ad\u30ea\u306e\u3044\u3044\u6570\u5b57\u306b\u3057\u305f\u3002\n            audio = audio[:40000]\n            spectrum, frequency = self._get_spectrum(audio, sample_rate)\n            self.spectra.append(spectrum)\n            self.frequencies.append(frequency)   ","4f61d2c0":"helper = FourieTransformHelper(file_names)\nhelper.get_spectra()","f97d5039":"spectra = minmax_scale(helper.spectra, axis=1)","c3fe6a0b":"df_frq = pd.DataFrame(spectra)","04e7a610":"df = pd.concat([df_all.reset_index(drop=True), df_frq], axis=1)","e41c432f":"tsne_embed = TSNE().fit_transform(df.iloc[:, 8:])\numap_embed = umap.UMAP().fit_transform(df.iloc[:, 8:])\n\nfig = px.scatter(x=tsne_embed[:,0],y=tsne_embed[:,1], \n                 color=df['Target'].astype(str).tolist(),\n                hover_name=df['\u30d5\u30a1\u30a4\u30eb'].tolist())\nfig.show()\nfig = px.scatter(x=umap_embed[:,0],y=umap_embed[:,1], \n                 color=df['Target'].astype(str).tolist(),               \n                 hover_name=df['\u30d5\u30a1\u30a4\u30eb'].tolist())\nfig.show()","daaf1a56":"df_screw_big_plate_big = df[(df['\u306d\u3058']=='\u5927') & (df['\u30d7\u30ec\u30fc\u30c8']=='\u5927')]\n\ntsne_embed = TSNE().fit_transform(df_screw_big_plate_big.iloc[:, 8:])\numap_embed = umap.UMAP().fit_transform(df_screw_big_plate_big.iloc[:, 8:])\n\nfig = px.scatter(x=tsne_embed[:,0],y=tsne_embed[:,1], \n                 color=df_screw_big_plate_big['Target'].astype(str).tolist(),\n                 hover_name=df_screw_big_plate_big['\u30d5\u30a1\u30a4\u30eb'].tolist())\nfig.show()\nfig = px.scatter(x=umap_embed[:,0],y=umap_embed[:,1], \n                 color=df_screw_big_plate_big['Target'].astype(str).tolist(),\n                 hover_name=df_screw_big_plate_big['\u30d5\u30a1\u30a4\u30eb'].tolist())\nfig.show()\n\n","89a9f522":"df_screw_small_plate_big = df[(df['\u306d\u3058']=='\u5c0f') & (df['\u30d7\u30ec\u30fc\u30c8']=='\u5927')]\n\ntsne_embed = TSNE().fit_transform(df_screw_small_plate_big.iloc[:, 8:])\numap_embed = umap.UMAP().fit_transform(df_screw_small_plate_big.iloc[:, 8:])\n\nfig = px.scatter(x=tsne_embed[:,0],y=tsne_embed[:,1], \n                 color=df_screw_small_plate_big['Target'].astype(str).tolist(),\n                 hover_name=df_screw_small_plate_big['\u30d5\u30a1\u30a4\u30eb'].tolist())\nfig.show()\nfig = px.scatter(x=umap_embed[:,0],y=umap_embed[:,1], \n                 color=df_screw_small_plate_big['Target'].astype(str).tolist(),\n                 hover_name=df_screw_small_plate_big['\u30d5\u30a1\u30a4\u30eb'].tolist())\nfig.show()","23e98b06":"cls = KMeans(n_clusters=len(df_screw_small_plate_big[\"\u9332\u97f3\u65b9\u6cd5\"].unique())*len(df_screw_small_plate_big[\"\u9332\u97f3\u65b9\u6cd5\"].unique()))\nresult_umap = cls.fit(umap_embed)\nresult_tsne = cls.fit(tsne_embed)","f5ace79a":"fig = px.scatter(x = umap_embed[:,0],y = umap_embed[:,1],color=result_umap.labels_,size = df_screw_small_plate_big.Target.fillna(0.1))\nfig.show()","72f0efa0":"df_screw_small_plate_big[\"class_tsne\"] = result_tsne.labels_\ndf_screw_small_plate_big[\"class_umap\"] = result_umap.labels_\ndf_screw_small_plate_big.to_csv(\"\u306d\u3058_\u5c0f_\u30d7\u30ec\u30fc\u30c8_\u5927.csv\",index = False)","3e15cd5f":"df_screw_big_plate_small = df[(df['\u306d\u3058']=='\u5927') & (df['\u30d7\u30ec\u30fc\u30c8']=='\u5c0f')]\n\ntsne_embed = TSNE().fit_transform(df_screw_big_plate_small.iloc[:, 8:])\numap_embed = umap.UMAP().fit_transform(df_screw_big_plate_small.iloc[:, 8:])\n\nfig = px.scatter(x=tsne_embed[:,0],y=tsne_embed[:,1], \n                 color=df_screw_big_plate_small['Target'].astype(str).tolist(),\n                 hover_name=df_screw_big_plate_small['\u30d5\u30a1\u30a4\u30eb'].tolist())\nfig.show()\nfig = px.scatter(x=umap_embed[:,0],y=umap_embed[:,1], \n                 color=df_screw_big_plate_small['Target'].astype(str).tolist(),\n                 hover_name=df_screw_big_plate_small['\u30d5\u30a1\u30a4\u30eb'].tolist())\nfig.show()","0399fd02":"len(df_screw_big_plate_small[\"\u9332\u97f3\u65b9\u6cd5\"].unique())*len(df_screw_big_plate_small[\"\u9332\u97f3\u65b9\u6cd5\"].unique())","471cc375":"cls = KMeans(n_clusters=10)\nresult_umap = cls.fit(umap_embed)\nresult_tsne = cls.fit(tsne_embed)","59f92231":"fig = px.scatter(x = umap_embed[:,0],y = umap_embed[:,1],color=result_umap.labels_,size = df_screw_big_plate_small.Target.fillna(0.1))\nfig.show()","7f732c9f":"df_screw_big_plate_small[\"class_tsne\"] = result_tsne.labels_\ndf_screw_big_plate_small[\"class_umap\"] = result_umap.labels_","8b33a13d":"df_screw_big_plate_small.to_csv(\"\u306d\u3058_\u5927_\u30d7\u30ec\u30fc\u30c8_\u5c0f.csv\",index = False)","c2d5050d":"# \u5168\u3066\u306e\u30c7\u30fc\u30bf\u3092\u53ef\u8996\u5316\u3057\u3066\u307f\u308b","7cd757d3":"## \u30cd\u30b8\uff1a\u5c0f\u3000\u30d7\u30ec\u30fc\u30c8\uff1a\u5927","ef6b812a":"# \u8208\u5473\n- \u3069\u3093\u306a\u30c7\u30fc\u30bf\u306e\u5f62\u3067\u5165\u308c\u308b\u306e\u304c\u826f\u3044\u306e\u304b\u691c\u8a0e\u3059\u308b\n - \u5168train\u30c7\u30fc\u30bf\n - \u5168train\u30c7\u30fc\u30bf\u3001\u30d7\u30ec\u30fc\u30c8\u30fb\u306d\u3058\u5225","67cb1a07":"# \u30cd\u30b8\u3068\u30d7\u30ec\u30fc\u30c8\u3092\u5206\u3051\u3066\u53ef\u8996\u5316\u3057\u3066\u307f\u308b\n\n## \u30cd\u30b8\uff1a\u5927\u3000\u30d7\u30ec\u30fc\u30c8\uff1a\u5927","55eebeb8":"## \u30cd\u30b8\uff1a\u5927 \u30d7\u30ec\u30fc\u30c8\uff1a\u5c0f"}}