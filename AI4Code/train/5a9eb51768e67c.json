{"cell_type":{"4a64efc6":"code","d697299f":"code","194ea8b1":"code","4d9dc9ab":"code","f3f45178":"code","04cb32fa":"code","d8358af4":"code","285cdab5":"code","2b63d20c":"code","8419b67a":"code","58856020":"code","f24a3b38":"code","af6f5711":"code","fbad2571":"code","a8e21024":"code","f0ce0ab2":"code","fa2607db":"code","37f8701d":"markdown","8d7a7653":"markdown","d0a9e2d5":"markdown","618120dd":"markdown","121479dc":"markdown","2c3af301":"markdown","a53093bd":"markdown","4e6b5ba1":"markdown","1cd6f779":"markdown"},"source":{"4a64efc6":"import graphviz\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\n\nfrom pathlib import Path","d697299f":"DATA_DIR = Path(\"..\/input\/stanford-covid-vaccine\/\")\nBPPS_DIR = DATA_DIR \/ \"bpps\"\n\ntrain = pd.read_json(DATA_DIR \/ \"train.json\", lines=True)\ntest = pd.read_json(DATA_DIR \/ \"test.json\", lines=True)\n\nbppm_paths = list(BPPS_DIR.glob(\"*.npy\"))","194ea8b1":"len(train) + len(test) == len(bppm_paths)","4d9dc9ab":"def get_bppm(id_):\n    return np.load(BPPS_DIR \/ f\"{id_}.npy\")\n\n\ndef draw_structure(structure: str):\n    pm = np.zeros((len(structure), len(structure)))\n    start_token_indices = []\n    for i, token in enumerate(structure):\n        if token == \"(\":\n            start_token_indices.append(i)\n        elif token == \")\":\n            j = start_token_indices.pop()\n            pm[i, j] = 1.0\n            pm[j, i] = 1.0\n    return pm\n\n\ndef plot_structures(bppm: np.ndarray, pm: np.ndarray):\n    fig, axes = plt.subplots(1, 2, figsize=(10, 10))\n    axes[0].imshow(bppm)\n    axes[0].set_title(\"BPPM\")\n    axes[1].imshow(pm)\n    axes[1].set_title(\"structure\")\n    plt.show()","f3f45178":"idx = 0\nsample = train.loc[idx]\n\nbppm = get_bppm(sample.id)\npm = draw_structure(sample.structure)\nplot_structures(bppm, pm)","04cb32fa":"idx = 1\nsample = train.loc[idx]\n\nbppm = get_bppm(sample.id)\npm = draw_structure(sample.structure)\nplot_structures(bppm, pm)","d8358af4":"idx = 2\nsample = train.loc[idx]\n\nbppm = get_bppm(sample.id)\npm = draw_structure(sample.structure)\nplot_structures(bppm, pm)","285cdab5":"idx = 3\nsample = train.loc[idx]\n\nbppm = get_bppm(sample.id)\npm = draw_structure(sample.structure)\nplot_structures(bppm, pm)","2b63d20c":"idx = 4\nsample = train.loc[idx]\n\nbppm = get_bppm(sample.id)\npm = draw_structure(sample.structure)\nplot_structures(bppm, pm)","8419b67a":"idx = 5\nsample = train.loc[idx]\n\nbppm = get_bppm(sample.id)\npm = draw_structure(sample.structure)\nplot_structures(bppm, pm)","58856020":"def visualize_graph(bppm: np.ndarray, sequence: str, threshold=0.1):\n    indices = np.where(bppm > threshold)\n    edges = list(zip(indices[0], indices[1], bppm[indices]))\n    \n    g = graphviz.Graph(format=\"png\")\n    for from_, to, coef in edges:\n        if from_ > to:\n            g.edge(sequence[from_] + f\"({from_})\",\n                   sequence[to] + f\"({to})\",\n                   label=f\"{coef:.2f}\",\n                   penwidth=f\"{int(max(1, abs(coef * 20)))}\")\n    g.render(\".\/graph\")\n    return g","f24a3b38":"idx = 0\nsample = train.loc[idx]\n\nbppm = get_bppm(sample.id)\nvisualize_graph(bppm, sample.sequence, threshold=0.05)","af6f5711":"idx = 1\nsample = train.loc[idx]\n\nbppm = get_bppm(sample.id)\nvisualize_graph(bppm, sample.sequence)","fbad2571":"idx = 2\nsample = train.loc[idx]\n\nbppm = get_bppm(sample.id)\nvisualize_graph(bppm, sample.sequence)","a8e21024":"idx = 3\nsample = train.loc[idx]\n\nbppm = get_bppm(sample.id)\nvisualize_graph(bppm, sample.sequence)","f0ce0ab2":"idx = 4\nsample = train.loc[idx]\n\nbppm = get_bppm(sample.id)\nvisualize_graph(bppm, sample.sequence)","fa2607db":"idx = 5\nsample = train.loc[idx]\n\nbppm = get_bppm(sample.id)\nvisualize_graph(bppm, sample.sequence)","37f8701d":"Each `id` corresponds to the `.npy` file in `bpps` folder.","8d7a7653":"## Libraries","d0a9e2d5":"## Update\n\nNow `bpps` is explained by the host here:\n\nhttps:\/\/www.kaggle.com\/c\/stanford-covid-vaccine\/discussion\/182021#1006800","618120dd":"It's similar, and some are almost the same. However, in some case, BPPM is a bit blurred - maybe related to `signal_to_noise` or `SN_filter` values.","121479dc":"## Visualize graph structure\n\nAs I note above, this matrix can be treated as graph structure. Let's visualize it as a graph.","2c3af301":"## Data Loading","a53093bd":"## EOF","4e6b5ba1":"## About\n\nIn the provided dataset, there's a folder named `bpps`. There aren't enough explanation about this folder and the contents inside. I conducted [a simple search](https:\/\/bmcbioinformatics.biomedcentral.com\/articles\/10.1186\/s12859-018-2018-4) and found that `bpps` stands for `Base Pairing Probabilities`. \nThe matrix inside `bpps` folder is Base Pairing Probability Matrix (`BPPM`) and it's basically treated as adjascency matrix of the RNA sequence. I'm not 100% sure, but it's basically describing the structure of the RNA (in my understanding).\nOn the other hand, we have `structure` column in the `train.json` and `test.json`. The structure in json file and `BPPM` has strong connection. Let's have a look at it.\n\nIf you'd like to know more about BPPs, check out [this](https:\/\/onlinelibrary.wiley.com\/doi\/pdf\/10.1002\/bip.360290621?casa_token=5__Sglto484AAAAA%3AXSJ0MfHd0atxB5PYqMyDsJvqIE79vTeneakVoku__oJZFP-wTki5QvoRWp1tjOpYgtkccjtfE1MKzQ).","1cd6f779":"## Compare BPPM and structure"}}