{"cell_type":{"f20ce16d":"code","678c5081":"code","356cb858":"code","9280463e":"code","10210e3c":"code","adf3f71b":"code","22965f08":"code","c77db99c":"code","7ac97f2f":"code","e7f64b99":"code","bdc5b5b9":"code","2ac6b581":"code","6dde7802":"code","8c28f514":"code","8d4567b9":"code","5429e84b":"code","deea8f46":"code","2e15160d":"code","b1952a34":"code","44fd08f7":"code","2f047f7f":"code","e3353157":"code","5ec1207b":"code","bf568125":"code","941b9aa4":"code","23b0f6e0":"code","f26f5336":"code","4136ca36":"code","92075a59":"code","3506fa97":"code","84017176":"code","ede4959d":"code","b8bfffc6":"code","1ee984c2":"code","856cbbc4":"code","36f39839":"code","0ac1648a":"code","b77a3491":"code","2393ec13":"code","b8a8bb00":"code","ad97f43c":"code","6139d0a4":"markdown","1d660d9e":"markdown","d98c2e95":"markdown","98fc5aea":"markdown","d4990c2b":"markdown","5c779ee8":"markdown","ce8b1a94":"markdown"},"source":{"f20ce16d":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set()\nimport random","678c5081":"random.seed(5566)\nnum_lines = 40428968\nsample_size = 2000000\nskip = sorted(random.sample(range(1, num_lines), num_lines-sample_size))\nskip[0]","356cb858":"df= pd.read_csv(\"..\/input\/avazu-ctr-prediction\/train.gz\", header=0, skiprows=skip)","9280463e":"df.shape","10210e3c":"df.columns","adf3f71b":"df[\"hour\"] = pd.to_datetime(df[\"hour\"], format=\"%y%m%d%H\")","22965f08":"df.columns","c77db99c":"df.head()","7ac97f2f":"sns.countplot(x='click',data=df)\n","e7f64b99":"df.dtypes","bdc5b5b9":"df[\"click\"].value_counts() \/ len(df)","2ac6b581":"df[\"hour\"].dt.hour","6dde7802":"df[\"actual_hour_day\"]= df[\"hour\"].dt.hour","8c28f514":"df.head(2)","8d4567b9":"imp= df.groupby(['actual_hour_day', 'click']).size().unstack()","5429e84b":"imp.head()","deea8f46":"plt.figure()\nimp.plot(kind='bar', title=\"Day hours\", figsize=(16,8))\nplt.ylabel(\"count of clicks\")\nplt.plot()","2e15160d":"df.groupby('banner_pos')['click'].sum()","b1952a34":"df.groupby('device_type')['click'].sum()","44fd08f7":"df.banner_pos.unique()","2f047f7f":"df.columns","e3353157":"df.C1.value_counts()\/len(df)","5ec1207b":"c1= df.C1.unique()\nprint(c1)","bf568125":"ctr_list=[]\nfor i in c1:\n    ctr=df.loc[np.where((df.C1 == i))].click.value_counts() \/ len(df)\n    ctr_list.append(ctr)\n    print(\"C1 values {}:, CTR is {}:\".format(i,ctr))","941b9aa4":"df.banner_pos.value_counts() \/ len(df)","23b0f6e0":"banner= df.banner_pos.unique()\nprint(banner)","f26f5336":"ban_list=[]\nfor i in banner:\n    baa=df.loc[np.where((df.banner_pos == i))].click.value_counts() \/ len(df)\n    ban_list.append(baa)\n    print(\"banner values {}:, banner is {}:\".format(i,baa))","4136ca36":"df.dtypes","92075a59":"df.device_type.value_counts() \/ len(df)","3506fa97":"dev= df.device_type.unique()\nprint(dev)","84017176":"X= df.drop(\"click\", axis=1)\n\ny= df.click","ede4959d":"from sklearn.model_selection import train_test_split","b8bfffc6":"X_train, X_test, y_train, y_test= train_test_split(X,y,test_size=0.3, random_state=12)","1ee984c2":"from catboost import CatBoostClassifier","856cbbc4":"cat_features= [\"site_id\", \"site_domain\", \"site_category\",\n              \"app_id\", \"app_domain\", \"app_category\", \"device_id\", \n              \"device_ip\", \"device_model\"]","36f39839":"cat_boost= CatBoostClassifier(learning_rate=0.05, loss_function='Logloss', \n                             random_state=123, iterations=100, eval_metric=\"Logloss\")","0ac1648a":"cat_boost.fit(X_train, y_train, eval_set=(X_test, y_test), cat_features= cat_features, plot=True)","b77a3491":"c= cat_boost.get_feature_importance(prettified=True).sort_index(ascending=True)\n","2393ec13":"c.to_csv(\"feature_imp.csv\")","b8a8bb00":"predictions= cat_boost.predict(X_test, prediction_type=\"Class\", ntree_start=0, ntree_end= cat_boost.get_best_iteration(),thread_count=-1, \n                               verbose=None)","ad97f43c":"predictions\n","6139d0a4":"for C1","1d660d9e":"# CTR with respect to different columns","d98c2e95":"Here we can see the hourly impressions\/day and we can clearly see that the rate of clicks is very low as compared to non  clicks","98fc5aea":"# CTR current","d4990c2b":"for device_type","5c779ee8":"FOR banner_pos","ce8b1a94":"Here we can see that the number of clicks is very less as compared to the number of non clicks"}}