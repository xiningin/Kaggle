{"cell_type":{"5c79aa5b":"code","a31f46f0":"code","aaef5ce9":"code","8256f90c":"code","c03961ca":"code","3c05fbe4":"code","3abafda7":"code","c82ad973":"code","288a6352":"code","71a827bc":"code","5caa6882":"code","4f8b0f40":"markdown","45b0dbf3":"markdown","a3eb4355":"markdown","c9fe18f3":"markdown","bb2a152e":"markdown","84026ad0":"markdown","13969b96":"markdown"},"source":{"5c79aa5b":"import gc\nimport warnings\nwarnings.filterwarnings('ignore')\n\nimport numpy as np\nimport scipy as sp\nimport pandas as pd\nfrom pandas import DataFrame, Series\n\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.metrics import roc_auc_score\nfrom sklearn.preprocessing import LabelEncoder, StandardScaler, OneHotEncoder\nfrom sklearn.feature_extraction.text import TfidfVectorizer\nfrom category_encoders import OrdinalEncoder\n\nfrom tqdm import tqdm_notebook as tqdm","a31f46f0":"df_train = pd.read_csv('..\/input\/homework-for-students4plus\/train.csv', index_col=0, parse_dates=['issue_d'], skiprows=lambda x: x%20!=0)\n#df_train = pd.read_csv('..\/input\/homework-for-students4plus\/train.csv', index_col=0, parse_dates=['issue_d'])\ny_train = df_train.loan_condition\nX_train = df_train.drop(['loan_condition'], axis=1)\n\nX_test = pd.read_csv('..\/input\/homework-for-students4plus\/test.csv', index_col=0, parse_dates=['issue_d'])\n\ndel df_train\ngc.collect()","aaef5ce9":"cat = []\nnum = []\n\nfor col in X_train.columns:\n    if X_train[col].dtype == 'object':\n        if col != 'emp_title':\n            cat.append(col)\n    else:\n        if col != 'issue_d':\n            num.append(col)\n            \ncat_train = X_train[cat]\ntxt_train = X_train.emp_title\nX_train = X_train[num]\n\ncat_test = X_test[cat]\ntxt_test = X_test.emp_title\nX_test = X_test[num]","8256f90c":"scaler = StandardScaler()\nX_train = scaler.fit_transform(X_train.fillna(X_train.median()))\nX_test = scaler.transform(X_test.fillna(X_test.median()))","c03961ca":"for col in tqdm(cat):\n    ohe = OneHotEncoder(handle_unknown='ignore', sparse=True)\n    oe = OrdinalEncoder(return_df=False)\n    \n    cat_train[col] = oe.fit_transform(cat_train[[col]])\n    cat_test[col] = oe.transform(cat_test[[col]])    \n    \n    train = ohe.fit_transform(cat_train[[col]])\n    test = ohe.transform(cat_test[[col]])\n    \n    X_train = sp.sparse.hstack([X_train, train]) # numeric\u306bconcat\u3057\u3066\u3044\u304f\n    X_test = sp.sparse.hstack([X_test, test])","3c05fbe4":"tfidf = TfidfVectorizer(max_features=100000, analyzer='word', ngram_range=(1, 2))\n\ntrain = tfidf.fit_transform(txt_train.fillna('#'))\ntest = tfidf.transform(txt_test.fillna('#'))\n\nX_train = sp.sparse.hstack([X_train, train]) # numeric, categorical\u306bconcat\u3059\u308b\nX_test = sp.sparse.hstack([X_test, test])\n\nX_train = X_train.tocsr()# \u884c\u65b9\u5411\u306e\u30b9\u30e9\u30a4\u30b9\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u5909\u63db\u3059\u308b\nX_test = X_test.tocsr()\n\ndel cat_train, cat_test, txt_train, txt_test\ngc.collect()","3abafda7":"X_train.shape, X_test.shape","c82ad973":"num_train = int(X_train.shape[0]*0.7)\n\nX_train_ = X_train[:num_train, :]\ny_train_ = y_train[:num_train]\n\nX_val = X_train[num_train:, :]\ny_val = y_train[num_train:]","288a6352":"clf = LogisticRegression(C=0.01)\nclf.fit(X_train_, y_train_)\ny_pred = clf.predict_proba(X_val)[:,1]\n\nprint(roc_auc_score(y_val, y_pred)) # \u691c\u5b9a\u30b9\u30b3\u30a2","71a827bc":"clf = LogisticRegression(C=0.01)\nclf.fit(X_train, y_train)\ny_pred = clf.predict_proba(X_test)[:,1]","5caa6882":"df_submit = pd.read_csv('..\/input\/homework-for-students4plus\/sample_submission.csv', index_col=0)\ndf_submit['loan_condition'] = y_pred\ndf_submit.to_csv('submission.csv')","4f8b0f40":"### \u7279\u5fb4\u91cf\u30bf\u30a4\u30d7\u3054\u3068\u306b\u5206\u5272\u3059\u308b","45b0dbf3":"### \u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u3080","a3eb4355":"### \u6700\u5f8c\u306b\u30c6\u30ad\u30b9\u30c8\u306e\u51e6\u7406","c9fe18f3":"### \u307e\u305a\u306f\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a4\u30f3\u30dd\u30fc\u30c8","bb2a152e":"### \u884c\u65b9\u5411\u306b\u5b66\u7fd2\u3068\u691c\u5b9a\u306b\u5206\u5272\u3059\u308b","84026ad0":"### \u6b21\u306bcategorical\u3092One-hot","13969b96":"### \u307e\u305aNumeric\u3092StandardScaler"}}