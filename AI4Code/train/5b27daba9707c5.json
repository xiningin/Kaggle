{"cell_type":{"c6bca52d":"code","2799f1c2":"code","e566dce4":"code","c37f3f12":"code","2a6737eb":"code","5d58e16f":"code","2a7d5b31":"code","32a4ccc3":"code","d367d8c2":"code","1bc521f0":"code","8b18e7b2":"code","b8e7af69":"code","a1e8d466":"code","3e12a920":"code","1fd72ee3":"markdown","34a77d9a":"markdown","2fcadb95":"markdown","086cd05d":"markdown","9692e2ee":"markdown","61f13e9a":"markdown","49c906ea":"markdown","2336e898":"markdown","8652711d":"markdown","c6288e82":"markdown"},"source":{"c6bca52d":"import numpy as np \nimport pandas as pd \n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","2799f1c2":"peyton_att = 9380 \npeyton_td = 539 \neli_td = 366 \neli_att = 8119 ","e566dce4":"import pymc3 as pm","c37f3f12":"def run_model(a,b,c,d):\n    with pm.Model() as model:\n        \n        p=pm.Beta('p', a, b)  \n        obs=pm.Binomial(\"obs\", n=c, \n                        p=p, observed=d)\n\n        step=pm.Metropolis()  \n\n        trace=pm.sample(30000, step=step)\n    \n    return trace","2a6737eb":"import warnings\n\nwarnings.filterwarnings('ignore')\nwarnings.simplefilter('ignore')","5d58e16f":"trace_peyton = run_model(35,565,peyton_att,peyton_td)","2a7d5b31":"trace_eli = run_model(22,578,eli_att,eli_td)","32a4ccc3":"import matplotlib.pyplot as plt","d367d8c2":"plt.title('Distribution of TD% for Peyton')\nplt.hist(trace_peyton[\"p\"], bins=50,color='blue');","1bc521f0":"plt.title('Distribution of TD% for Eli')\nplt.hist(trace_eli[\"p\"], bins=50, color='red');","8b18e7b2":"plt.title('Difference in TD% between Peyton & Eli')\nplt.hist(trace_peyton[\"p\"]-trace_eli[\"p\"], bins=50, color='green');","b8e7af69":"diff = trace_peyton[\"p\"]-trace_eli[\"p\"]\n\nprint(\"Probability Peyton is 1% better than Eli: \" + \n      str(round(len(diff[diff > 0.01])\/len(diff)*100)) + \"%\")","a1e8d466":"print('Average TD% Peyton: ' + str(trace_peyton['p'].mean()))\nprint('Average TD% Eli: ' + str(trace_eli['p'].mean()))","3e12a920":"print('Average TD\/season Peyton: ' + str(trace_peyton['p'].mean()*600))\nprint('Average TD\/season Eli: ' + str(trace_eli['p'].mean()*600))","1fd72ee3":"Let's do some back of the napkin math. First we'll find the average TD% based on our distributions for Peyton and Eli.","34a77d9a":"Well ladies and gentlemen, 35 TDs for Peyton minus 27 for Eli gives 8, on average Peyton throws 8 more TDs per year. Very close to out back of the envelope calculation. Math works!","2fcadb95":"I'm using a Beta prior with parameters Beta(s,f) where s is the number of sucesses and f is the number of failures. This distribution represents my beliefs about the players, and will play a small role in the posterior distribution (I tried this test starting with a uniform prior and got the same answer).\n\nFor example, for Manning I assumed on the average season he'd throw 35 TDs in 600 pass attempts, representing a prior of Beta(35,565). For the likelihood distribution I used a Binomial distribution, where n is the number of trials and p is the probability of a success. ","086cd05d":"Let's look at the probabiliy that Peyton is 1% better in terms of TD rate than Eli in any given year:","9692e2ee":"We'll make use of the PYMC3 library once more:","61f13e9a":"Peyton played 18 seasons and threw 539 TDs. So roughly, 539\/18 = 30 TDs a season. The difference between Peyton and Eli's career TD totals is: 539 - 366 = 173. I'll subtract 60 TDs for the 2 more seasons Peyton played and divide by 16 seasons for the number of seasons they were both in the league:\n\n(173 - 60)\/16 = 7\n\nSo very roughly we can say Peyton throws about 7 more TDs on the average season. Does our distribution agree?\n\nWell, we have the average TD% from the posterior distribution. If we multiply by 600 pass attempts (the rough number of pass attempts a QB throws in a year) we'll get the number of TDs Eli and Peyton throw in the average year.","49c906ea":"The posterior distributions are plotted below. The values on the x axis represent the QB TD% (#of TD\/# of pass attempts). Based on the histograms below, Peyton has a TD% between 5% and 6.3% most years; whereas Eli's TD% is between 3.8% to 5%.","2336e898":"This cell gets rid of the 'pink text' warnings which are annoying.","8652711d":"Let's subtact the distributions to see how big the difference is. From the plot below, the whole histogram is away from zero, meaning the difference is big - i.e Peyton is a much better QB; between 0.5% to 2% better in terms of QB% on any given year. ","c6288e82":"Most people would say Peyton Manning is a better QB than his brother Eli Manning. But how much better? On the average season how many more TDs would peyton throw compared to his younger brother? To answer- we'll make use of the popular technique of A\/B testing. First, let's look at their career TD statistics:"}}