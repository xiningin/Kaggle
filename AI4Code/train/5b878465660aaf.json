{"cell_type":{"bb6a94c0":"code","953ddf5e":"code","21b7bfe6":"code","799c384e":"code","d4c1fd3b":"code","2e68331d":"code","1e43ffa1":"code","eff1ce4d":"code","4bd2f15c":"code","aeb4757e":"code","7163a847":"code","480fea43":"code","bd788dd3":"code","7bd4ce5d":"code","c0b2fd69":"code","4d8305eb":"code","e8e8a2a6":"code","44a83cf4":"code","c74200bc":"code","bc4f07da":"code","ea0b9c11":"code","3d62cc73":"code","e628d7e8":"code","9be2fcc2":"code","ead276c8":"code","ad462e0c":"code","85e991d6":"code","4b9d51d0":"code","1f7bec31":"code","57fbe6dc":"code","1f25536d":"code","03e2555d":"code","72dc68cf":"code","7e049886":"code","3be980c0":"code","c31b3b85":"code","b86b4160":"code","db6ed9ac":"code","c161b159":"code","1207eae6":"code","d878375e":"code","704c2e10":"code","9c9514f4":"code","23106cd4":"code","221771e0":"code","ea667675":"code","f5dec77e":"code","972bf6a6":"code","fcf60261":"code","e0ea1f02":"code","67642cb9":"code","49fc8cf0":"code","d9a2e321":"code","f8ca7245":"code","79e6392d":"code","8402f4be":"markdown","82ef7e07":"markdown","ec987be9":"markdown","74af2497":"markdown","2805d402":"markdown","064b4844":"markdown"},"source":{"bb6a94c0":"#import libraries\nimport numpy as np\nimport pandas as pd \nimport statsmodels.api as sm\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom sklearn.preprocessing import scale, StandardScaler\nfrom sklearn.model_selection import train_test_split, GridSearchCV, StratifiedKFold, cross_val_score\nfrom sklearn.metrics import confusion_matrix, accuracy_score, mean_squared_error, r2_score, roc_auc_score, roc_curve, classification_report\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.svm import SVC\nfrom sklearn.neural_network import MLPClassifier\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.ensemble import GradientBoostingClassifier\nfrom lightgbm import LGBMClassifier\nfrom sklearn.model_selection import KFold\nfrom sklearn.preprocessing import RobustScaler\nfrom sklearn.preprocessing import MinMaxScaler\nfrom pandas_profiling import ProfileReport\nfrom sklearn.feature_selection import RFECV\nimport operator\nimport warnings\nwarnings.simplefilter(action = \"ignore\") ","953ddf5e":"df = pd.read_csv(\"\/kaggle\/input\/pima-indians-diabetes-database\/diabetes.csv\")\ndf.head()","21b7bfe6":"df.shape","799c384e":"df.info()","d4c1fd3b":"df.describe([0.10,0.25,0.50,0.75,0.90,0.95,0.99]).T","2e68331d":"profile = ProfileReport(df, title=\"Pandas Profiling Report\", progress_bar=False)\nprofile.to_widgets()","1e43ffa1":"df.corr()","eff1ce4d":"# Correlation matrix graph of the data set\nf, ax = plt.subplots(figsize= [15,10])\nsns.heatmap(df.corr(), annot=True, fmt=\".2f\", ax=ax, cmap = \"magma\" )\nax.set_title(\"Correlation Matrix\", fontsize=20)\nplt.show()","4bd2f15c":" g = sns.pairplot(df, hue=\"Outcome\", palette=\"husl\")","aeb4757e":"f, ax = plt.subplots(1, 2, figsize = (15, 7))\nf.suptitle(\"Diabetes?\", fontsize = 18.)\n_ = df.Outcome.value_counts().plot.bar(ax = ax[0], rot = 0, color = (sns.color_palette()[0], sns.color_palette()[2])).set(xticklabels = [\"No\", \"Yes\"])\n_ = df.Outcome.value_counts().plot.pie(labels = (\"No\", \"Yes\"), autopct = \"%.2f%%\", label = \"\", fontsize = 13., ax = ax[1],\\\ncolors = (sns.color_palette()[0], sns.color_palette()[2]), wedgeprops = {\"linewidth\": 1.5, \"edgecolor\": \"#F7F7F7\"}), ax[1].texts[1].set_color(\"#F7F7F7\"), ax[1].texts[3].set_color(\"#F7F7F7\")","7163a847":"fig, ax = plt.subplots(4,2, figsize=(16,16))\nsns.distplot(df.Age, bins = 20, ax=ax[0,0]) \nsns.distplot(df.Pregnancies, bins = 20, ax=ax[0,1]) \nsns.distplot(df.Glucose, bins = 20, ax=ax[1,0]) \nsns.distplot(df.BloodPressure, bins = 20, ax=ax[1,1]) \nsns.distplot(df.SkinThickness, bins = 20, ax=ax[2,0])\nsns.distplot(df.Insulin, bins = 20, ax=ax[2,1])\nsns.distplot(df.DiabetesPedigreeFunction, bins = 20, ax=ax[3,0]) \nsns.distplot(df.BMI, bins = 20, ax=ax[3,1]) ","480fea43":"df.isnull().sum()","bd788dd3":"df[['Glucose','BloodPressure','SkinThickness','Insulin','BMI']] = df[['Glucose','BloodPressure','SkinThickness','Insulin','BMI']].replace(0,np.NaN)","7bd4ce5d":"df.isnull().sum()","c0b2fd69":"def median_target(var):   \n    temp = df[df[var].notnull()]\n    temp = temp[[var, 'Outcome']].groupby(['Outcome'])[[var]].median()\n    return temp","4d8305eb":"features = [\"Insulin\",\"Glucose\",\"SkinThickness\",'BloodPressure','BMI']\nfor feature in features:\n    print(median_target(feature))","e8e8a2a6":"features = [\"Insulin\",\"Glucose\",\"SkinThickness\",'BloodPressure','BMI']\nfor feature in features:\n    negative = median_target(feature)[feature][0]\n    positive = median_target(feature)[feature][1]\n    df.loc[(df['Outcome'] == 0 ) & (df[feature].isnull()), feature] = negative\n    df.loc[(df['Outcome'] == 1 ) & (df[feature].isnull()), feature] = positive","44a83cf4":"df.isnull().sum()","c74200bc":"for feature in df.select_dtypes(include=['float',\"int\"]):\n    \n    Q1 = df[feature].quantile(0.05)\n    Q3 = df[feature].quantile(0.95)\n    IQR = Q3-Q1\n    lower = Q1- 1.5*IQR\n    upper = Q3 + 1.5*IQR\n    \n    if df[(df[feature] > upper)].any(axis=None):\n        print(feature,\"yes\")\n    else:\n        print(feature, \"no\")","bc4f07da":"Q1 = df[\"Insulin\"].quantile(0.05)\nQ3 = df[\"Insulin\"].quantile(0.95)\nIQR = Q3-Q1\nupper = Q3 + 1.5*IQR\ndf.loc[df[\"Insulin\"] > upper, \"Insulin\"] = upper","ea0b9c11":"Q1 = df[\"SkinThickness\"].quantile(0.05)\nQ3 = df[\"SkinThickness\"].quantile(0.95)\nIQR = Q3-Q1\nupper = Q3 + 1.5*IQR\ndf.loc[df[\"SkinThickness\"] > upper, \"SkinThickness\"] = upper","3d62cc73":"df[\"InsSki\"]=df[\"Insulin\"]*df[\"SkinThickness\"]\ndf[\"GluIns\"]=df[\"Glucose\"]*df[\"Insulin\"]","e628d7e8":"Q1 = df[\"InsSki\"].quantile(0.05)\nQ3 = df[\"InsSki\"].quantile(0.95)\nIQR = Q3-Q1\nupper = Q3 + 1.5*IQR\ndf.loc[df[\"InsSki\"] > upper, \"InsSki\"] = upper\n\nQ1 = df[\"GluIns\"].quantile(0.05)\nQ3 = df[\"GluIns\"].quantile(0.95)\nIQR = Q3-Q1\nupper = Q3 + 1.5*IQR\ndf.loc[df[\"GluIns\"] > upper, \"GluIns\"] = upper\n","9be2fcc2":"df.drop([\"SkinThickness\",'BloodPressure'],axis=1,inplace=True)","ead276c8":"#We determine outliers between all variables with the Lof method\nfrom sklearn.neighbors import LocalOutlierFactor\nlof =LocalOutlierFactor(n_neighbors= 20)\nlof.fit_predict(df)","ad462e0c":"df_scores = lof.negative_outlier_factor_\nnp.sort(df_scores)[0:30]","85e991d6":"th = np.sort(df_scores)[8]\nth","4b9d51d0":"#We delete those that are higher than the threshold\ndf = df[df_scores > th]\ndf.shape","1f7bec31":"y = df[\"Outcome\"]\nX = df.drop([\"Outcome\"], axis = 1)\ncols = X.columns\nindex = X.index","57fbe6dc":"scaler = MinMaxScaler()\nX = scaler.fit_transform(X)\nX = pd.DataFrame(X,columns=cols,index=index)","1f25536d":"# Tum modellerin train validasyon skorlar\u0131\n\nmodels = []\nmodels.append(('LR', LogisticRegression()))\nmodels.append(('KNN', KNeighborsClassifier()))\nmodels.append(('CART', DecisionTreeClassifier()))\nmodels.append(('RF', RandomForestClassifier()))\nmodels.append(('SVM', SVC(gamma='auto')))\nmodels.append(('XGB', GradientBoostingClassifier()))\nmodels.append((\"LightGBM\", LGBMClassifier()))\n\n# evaluate each model in turn\nresults = []\nnames = []","03e2555d":"for name, model in models:\n    \n        kfold = KFold(n_splits = 10, random_state = 12345)\n        cv_results = cross_val_score(model, X, y, cv = 10, scoring= \"accuracy\")\n        results.append(cv_results)\n        names.append(name)\n        msg = \"%s: %f (%f)\" % (name, cv_results.mean(), cv_results.std())\n        print(msg)\n        \n# boxplot algorithm comparison\nfig = plt.figure(figsize=(15,10))\nfig.suptitle('Algorithm Comparison')\nax = fig.add_subplot(111)\nplt.boxplot(results)\nax.set_xticklabels(names)\nplt.show()","72dc68cf":"rf_params = {\"n_estimators\" :[100,200,500], \n             \"max_features\": [3,5,8,], \n             \"min_samples_split\": [2,5,8],\n            \"max_depth\": [3,5,8]}","7e049886":"rf_model = RandomForestClassifier(random_state = 12345)","3be980c0":"gs_cv = GridSearchCV(rf_model, \n                    rf_params,\n                    cv = 10,\n                    n_jobs = -1,\n                    verbose = 2).fit(X, y)","c31b3b85":"gs_cv.best_params_","b86b4160":"rf_tuned = RandomForestClassifier(**gs_cv.best_params_,random_state=12345)","db6ed9ac":"rf_tuned = rf_tuned.fit(X,y)","c161b159":"cross_val_score(rf_tuned, X, y, cv = 10).mean()","1207eae6":"feature_imp = pd.Series(rf_tuned.feature_importances_,\n                        index=X.columns).sort_values(ascending=False)\n\nsns.barplot(x=feature_imp, y=feature_imp.index)\nplt.xlabel('De\u011fi\u015fken \u00d6nem Skorlar\u0131')\nplt.ylabel('De\u011fi\u015fkenler')\nplt.title(\"De\u011fi\u015fken \u00d6nem D\u00fczeyleri\")\nplt.show()","d878375e":"xgb = GradientBoostingClassifier(random_state=12345)","704c2e10":"xgb_params = {\"n_estimators\": [100, 500, 1000],\n              \"subsample\" : [0.6, 0.8, 1.0],\n              \"max_depth\" : [3, 4, 5],\n              \"learning_rate\" : [0.1, 0.01, 0.05,],\n              \"min_samples_split\" : [2, 5, 10]}","9c9514f4":"xgb_cv_model = GridSearchCV(xgb, \n                     xgb_params, \n                     cv = 10, \n                     n_jobs = -1, \n                     verbose = 2).fit(X, y)","23106cd4":"xgb_cv_model.best_params_","221771e0":"xgb_tuned = GradientBoostingClassifier(**xgb_cv_model.best_params_,random_state=12345)","ea667675":"xgb_tuned = xgb_tuned.fit(X,y)","f5dec77e":"cross_val_score(xgb_tuned, X, y, cv = 10).mean()","972bf6a6":"feature_imp = pd.Series(xgb_tuned.feature_importances_,\n                        index=X.columns).sort_values(ascending=False)\n\nsns.barplot(x=feature_imp, y=feature_imp.index)\nplt.xlabel('De\u011fi\u015fken \u00d6nem Skorlar\u0131')\nplt.ylabel('De\u011fi\u015fkenler')\nplt.title(\"De\u011fi\u015fken \u00d6nem D\u00fczeyleri\")\nplt.show()","fcf60261":"lgbm = LGBMClassifier(random_state = 12345)","e0ea1f02":"lgbm_params = {\"learning_rate\": [0.01, 0.05, 0.1],\n              \"n_estimators\": [100,500, 1000],\n              \"max_depth\":[3,5,8]}","67642cb9":"gs_cv = GridSearchCV(lgbm, \n                     lgbm_params, \n                     cv = 10, \n                     n_jobs = -1, \n                     verbose = 2).fit(X, y)","49fc8cf0":"gs_cv.best_params_","d9a2e321":"lgbm_tuned = LGBMClassifier(**gs_cv.best_params_).fit(X,y)","f8ca7245":"cross_val_score(lgbm_tuned, X, y, cv = 10).mean()","79e6392d":"feature_imp = pd.Series(lgbm_tuned.feature_importances_,\n                        index=X.columns).sort_values(ascending=False)\n\nsns.barplot(x=feature_imp, y=feature_imp.index)\nplt.xlabel('De\u011fi\u015fken \u00d6nem Skorlar\u0131')\nplt.ylabel('De\u011fi\u015fkenler')\nplt.title(\"De\u011fi\u015fken \u00d6nem D\u00fczeyleri\")\nplt.show()","8402f4be":"# Data Preprocessing","82ef7e07":"## RF","ec987be9":"## LGBM tuning","74af2497":"## XGBoost","2805d402":"# Tuning i\u015flemleri","064b4844":"# First results"}}