{"cell_type":{"dc7eef79":"code","e901cb65":"code","46f94b43":"code","a9c96e92":"code","01a4e72f":"code","a5c70e84":"code","9efe5d92":"code","b4c68f99":"code","b31d5f4e":"code","758d09f9":"code","8559aa92":"code","54ec2566":"markdown","2540b377":"markdown","46e817da":"markdown","71936ccd":"markdown","d838b4a5":"markdown","392bcfe9":"markdown","cbc9af50":"markdown","627ed693":"markdown","296f8c2e":"markdown","8d535da8":"markdown","a67e250c":"markdown","b3aa0fb6":"markdown","be7e5d21":"markdown"},"source":{"dc7eef79":"import pandas as pd\nimport numpy as np\nimport datetime as dt","e901cb65":"input_file_path = '..\/input\/life_data.csv'\noutput_interval_file_path = '..\/input\/life_interval_data2.csv'\noutput_total_file_path = '..\/input\/life_total_data.csv'","46f94b43":"df = pd.read_csv(input_file_path,header=None,parse_dates=[[0,1]],infer_datetime_format=True)\ndf.columns = ['time','activity']\ndf.head()","a9c96e92":"df['assigned_to'] = df.time.copy().map(lambda x: x.replace(hour=0,minute=0))\ndf.head()","01a4e72f":"for i in range(len(df)):\n    if i != 0 and df.iloc[i].time < df.iloc[i-1].time:\n        print('Changed:', i)\n        df.loc[i,'time'] += dt.timedelta(days=1)\ndf.head()","a5c70e84":"df.drop('assigned_to',axis=1).head(2)","9efe5d92":"df_i = pd.DataFrame(columns=['date','time','activity'])\n\nfor (i,row) in df.iterrows():\n    if i != 0:\n        add_row = pd.Series({\n            'date':df.iloc[i-1].assigned_to,\n            'time':row.time-df.iloc[i-1].time,\n            'activity':df.iloc[i-1].activity,\n            'start_time':df.iloc[i-1].time\n        })\n        df_i = df_i.append(add_row,ignore_index=True)\n\n# Sanity check\nprint(len(df)==len(df_i)-1)\n\nprint(df_i.dtypes)\ndf_i.head()","b4c68f99":"unique_activities = df_i.activity.unique()\n\ndef by_activity(df):\n    res = df.groupby('activity').sum()\n    return pd.DataFrame([res.time.values],columns=res.index.values)\n\ndf_t = df_i.groupby('date').apply(by_activity)\ndf_t = df_t.fillna(dt.timedelta(0))\ndf_t = df_t.droplevel(1)\ndf_t.head()","b31d5f4e":"def format_timedelta(td):\n    # Hack for easy formatting\n    return (td + pd.to_datetime('2000-01-01')).strftime('%H:%M')\n    \nprint(format_timedelta(pd.to_timedelta('2h 30min')))","758d09f9":"df_i_tmp = df_i.copy()\ndf_i_tmp.time = df_i_tmp.time.map(format_timedelta)\ndf_i_tmp.date = df_i_tmp.date.map(lambda x: x.strftime('%Y-%m-%d'))\n\n#df_i_tmp.to_csv(output_interval_file_path,index=None)","8559aa92":"#df_t.applymap(format_timedelta).to_csv(output_total_file_path)","54ec2566":"... should be converted to: `2019-05-01|15|prep`","2540b377":"# Preparation","46e817da":"There is a problem with the data: A time such as `2019-04-11 00:35` often refers to the day after (since it is after midnight)! This can be corrected by finding all dates that violate the chronological order and adding one day (see algorithm below).","71936ccd":"## df_i: Convert to intervals","d838b4a5":"## Write to files","392bcfe9":"Another useful view on the data is to store the total hours that were spent doing an activity, for every day and every activity.","cbc9af50":"This is part of a [larger project](https:\/\/github.com\/maxims94\/life-tracking-project).","627ed693":"## Fix dates","296f8c2e":"## Read data","8d535da8":"### Algorithm\n\nThe algorithm below uses an inplace approach. It works with more than one faulty datetime -- such as having both `01:00,work` and `03:00,sleep` in one file. The reason is that adding one day to a faulty date creates another violation of chronological order that is caught in the next run of the loop. The only constraint is that the latest time of a day has to appear before the earliest of the next.","a67e250c":"Before changing the data, a new column is introduced that keeps the original date. This way, no information is lost. It will later be useful to assign sleep duration to dates.","b3aa0fb6":"## df_t: Sum up intervals","be7e5d21":"Convert the absolute times to intervals by calculating the differences. For instance, the two first rows..."}}