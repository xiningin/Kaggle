{"cell_type":{"efb20674":"code","8160a42e":"code","d61ea7df":"code","4f7557ed":"code","831d336e":"code","ac5d65a4":"code","f2cddf05":"code","bd16f254":"code","199ba3a1":"code","75805331":"code","b8712d8e":"code","5f43fb7e":"code","12c3053e":"code","6f1b5cc1":"code","18cf854a":"code","2ec2b974":"code","94e93c03":"code","7f3da514":"code","1ea450cb":"code","058ff6fd":"code","460ec7a2":"code","01ce6152":"code","d4abddef":"code","5d7efa43":"code","387fe9f4":"code","6d25cc73":"code","b32a7749":"code","479c16da":"code","769315a5":"code","1e45b721":"code","a3209d79":"code","096c9f83":"code","eab7fda0":"code","2e1dc1d1":"code","d5cbc918":"code","b2054ee2":"code","e0761e31":"code","f3e75d77":"code","ac15e520":"code","be1c7280":"code","22967080":"code","34b6661c":"code","f405b248":"code","26af6b82":"code","7cdd8fbe":"code","7dc9bc45":"code","c05a7f8d":"code","b6bbbd15":"code","4f0931c7":"code","46205c98":"code","d58144f1":"code","e97360bf":"code","3924d0d1":"code","00c568a5":"code","c60ae0e4":"code","f5b6c91d":"code","d095a1d8":"code","e5154264":"code","1cef2d2e":"code","41a614ea":"code","98384ea2":"code","21af963f":"code","2f6fd757":"code","027d2234":"code","3a60ccd9":"code","21284b14":"code","72ef0228":"code","ec35cc84":"code","18d46d50":"code","57bfee8b":"code","e4184fc5":"code","afe997cc":"code","2a0fdb2a":"code","e7c632ff":"code","e6ad1b79":"code","82e0c18c":"code","1769fd2c":"code","3d584d17":"code","d67c8dde":"markdown","c24ec961":"markdown","aa66f4da":"markdown","99341350":"markdown","fa3ce765":"markdown","b47d8912":"markdown","7abbfcca":"markdown","51ff75ba":"markdown","ac68edfd":"markdown","714e9f8a":"markdown","e7b079e2":"markdown","2ffa702a":"markdown","a0063311":"markdown","ee4cb459":"markdown","8b1d6ea3":"markdown","a98e6ba7":"markdown","35af5c71":"markdown","72a56266":"markdown","580e3ac8":"markdown","9d2b27b0":"markdown","cfbe05c8":"markdown","ed50ddec":"markdown","7d56980e":"markdown","d168ca26":"markdown","36189db9":"markdown","2e8150a2":"markdown","9ccfbe6a":"markdown","156fffe1":"markdown","ddd3109b":"markdown","571876f7":"markdown","c617a909":"markdown","180bb625":"markdown","8eb46645":"markdown","d4edcb65":"markdown","bf79e411":"markdown","b2e03628":"markdown","e6fb4e24":"markdown","cf190031":"markdown","9e993765":"markdown","81426ff1":"markdown","c38d6030":"markdown","21e82b08":"markdown","c57ca66b":"markdown","9d5702c3":"markdown","bed0be25":"markdown","160cd0b8":"markdown","8b37e18b":"markdown","526a6050":"markdown","8902d117":"markdown","0bdeb6a1":"markdown","f18e8587":"markdown","74c8df8c":"markdown","85bb2f4e":"markdown","bbe76807":"markdown","76f66bda":"markdown","b90ed2ae":"markdown","fba631ad":"markdown"},"source":{"efb20674":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline","8160a42e":"df=pd.read_csv('..\/input\/bank-pred\/bank.csv')\ndf","d61ea7df":"df.info()","4f7557ed":"df.pdays.describe()","831d336e":"df.pdays.median()","ac5d65a4":"df1 = df[df['pdays']>0]\ndf1","f2cddf05":"df1.pdays.describe()","bd16f254":"df1.pdays.median()","199ba3a1":"df.groupby('education').median()['balance']","75805331":"sns.barplot(x=df['balance'],y=df['education'],estimator=np.median)","b8712d8e":"df1.pdays.value_counts()","5f43fb7e":"print(sns.boxplot(y=df1['pdays']))","12c3053e":"print(sns.boxplot(y=df['pdays']))","6f1b5cc1":"df.pdays.value_counts()","18cf854a":"df=pd.get_dummies(df,columns=['response'],drop_first=True)\ndf","2ec2b974":"sns.scatterplot(x='poutcome',y='pdays',data=df)","94e93c03":"df.head(2)","7f3da514":"sns.pairplot(df[['age','salary','balance','previous','duration','campaign','response_yes']])","1ea450cb":"sns.distplot(df['age'],bins=50)","058ff6fd":"lst = [df]\nfor column in lst:\n    column.loc[column[\"age\"] < 30,  'age group'] = 30\n    column.loc[(column[\"age\"] >= 30) & (column[\"age\"] <= 44), 'age group'] = 40\n    column.loc[(column[\"age\"] >= 45) & (column[\"age\"] <= 59), 'age group'] = 50\n    column.loc[column[\"age\"] >= 60, 'age group'] = 60","460ec7a2":"agewise_response = pd.crosstab(df['response_yes'],df['age group']).apply(lambda x: x\/x.sum() * 100)\nagewise_response = agewise_response.transpose()","01ce6152":"sns.countplot(x='age group', data=df, hue='response_yes')","d4abddef":"print('Success rate and total people with different age groups contacted:')\nprint('People with age < 30 contacted: {}, Success rate: {}'.format(len(df[df['age group'] == 30]), df[df['age group'] == 30].response_yes.value_counts()[1]\/len(df[df['age group'] == 30])))\nprint('People between 30 & 45 contacted: {}, Success rate: {}'.format(len(df[df['age group'] == 40]), df[df['age group'] == 40].response_yes.value_counts()[1]\/len(df[df['age group'] == 40])))\nprint('People between 40 & 60 contacted: {}, Success rate: {}'.format(len(df[df['age group'] == 50]), df[df['age group'] == 50].response_yes.value_counts()[1]\/len(df[df['age group'] == 50])))\nprint('People with 60+ age contacted: {}, Success rate: {}'.format(len(df[df['age group'] == 60]), df[df['age group'] == 60].response_yes.value_counts()[1]\/len(df[df['age group'] == 60])))","5d7efa43":"sns.set(rc={'figure.figsize':(20,5)})\nsns.countplot(x=df['job'], data=df, hue=df['response_yes'])\nplt.title('Response recieved with respect to JOB')\n","387fe9f4":"from prettytable import PrettyTable","6d25cc73":"counts = PrettyTable(['Job', 'Total Clients', 'Success rate'])\ncounts.add_row(['Blue-collar', len(df[df['job'] == 'blue-collar']), df[df['job'] == 'blue-collar'].response_yes.value_counts()[1]\/len(df[df['job'] == 'blue-collar'])])\ncounts.add_row(['Management', len(df[df['job'] == 'management']), df[df['job'] == 'management'].response_yes.value_counts()[1]\/len(df[df['job'] == 'management'])])\ncounts.add_row(['Technician', len(df[df['job'] == 'technician']), df[df['job'] == 'technician'].response_yes.value_counts()[1]\/len(df[df['job'] == 'technician'])])\ncounts.add_row(['Admin', len(df[df['job'] == 'admin.']), df[df['job'] == 'admin.'].response_yes.value_counts()[1]\/len(df[df['job'] == 'admin.'])])\ncounts.add_row(['Services', len(df[df['job'] == 'services']), df[df['job'] == 'services'].response_yes.value_counts()[1]\/len(df[df['job'] == 'services'])])\ncounts.add_row(['Retired', len(df[df['job'] == 'retired']), df[df['job'] == 'retired'].response_yes.value_counts()[1]\/len(df[df['job'] == 'retired'])])\ncounts.add_row(['Self-employed', len(df[df['job'] == 'self-employed']), df[df['job'] == 'self-employed'].response_yes.value_counts()[1]\/len(df[df['job'] == 'self-employed'])])\ncounts.add_row(['Entrepreneur', len(df[df['job'] == 'entrepreneur']), df[df['job'] == 'entrepreneur'].response_yes.value_counts()[1]\/len(df[df['job'] == 'entrepreneur'])])\ncounts.add_row(['Unemployed', len(df[df['job'] == 'unemployed']), df[df['job'] == 'unemployed'].response_yes.value_counts()[1]\/len(df[df['job'] == 'unemployed'])])\ncounts.add_row(['Housemaid', len(df[df['job'] == 'housemaid']), df[df['job'] == 'housemaid'].response_yes.value_counts()[1]\/len(df[df['job'] == 'housemaid'])])\ncounts.add_row(['Student', len(df[df['job'] == 'student']), df[df['job'] == 'student'].response_yes.value_counts()[1]\/len(df[df['job'] == 'student'])])\ncounts.add_row(['Unknown', len(df[df['job'] == 'unknown']), df[df['job'] == 'unknown'].response_yes.value_counts()[1]\/len(df[df['job'] == 'unknown'])])\nprint(counts)","b32a7749":"sns.countplot(x=df['poutcome'], data=df, hue=df['response_yes'])\nplt.title('Count Plot of poutcome for target variable')","479c16da":"sns.countplot(x=df['salary'], data=df, hue=df['response_yes'])\nplt.title('Salary wise and response')","769315a5":"sns.countplot(x=df['education'], data=df, hue=df['response_yes'])\nplt.title('Respinse received based on education')","1e45b721":"df.education.value_counts()","a3209d79":"sns.countplot(x=df['default'], data=df, hue=df['response_yes'])\nplt.title('Response received against defaulters')","096c9f83":"df.default.value_counts()","eab7fda0":"df[df['default']=='yes'].response_yes.count()","2e1dc1d1":"sns.countplot(x=df['loan'], data=df, hue=df['response_yes'])\nplt.title('Count plot of loan for target variable y')","d5cbc918":"sns.countplot(x=df['contact'], data=df, hue=df['response_yes'])\nplt.title('Modes of Communication:')","b2054ee2":"df.contact.value_counts()","e0761e31":"sns.countplot(x=df['month'], data=df, hue=df['response_yes'])\nplt.title('MOnth wise communication and response')","f3e75d77":"df.head(1)","ac15e520":"categorical = ['job', 'marital', 'education', 'default', 'housing', 'loan', 'contact', 'month', 'poutcome']\nnumerical = [x for x in df.columns.to_list() if x not in categorical]\nnumerical.remove('response_yes')\nnumerical.remove('age group')","be1c7280":"corr_data = df[numerical + ['response_yes']]\ncorr = corr_data.corr()\nplt.close()\ncor_plot = sns.heatmap(corr,annot=True,cmap='RdYlGn',linewidths=0.2,annot_kws={'size':10})\nfig=plt.gcf()\nfig.set_size_inches(12,10)\nplt.xticks(fontsize=10,rotation=-30)\nplt.yticks(fontsize=10)\nplt.title('Correlation Matrix')\nplt.show()","22967080":"pd.crosstab(df['pdays'],df['poutcome'])","34b6661c":"pd.crosstab(df['pdays'],df['poutcome'],values=df['response_yes'],aggfunc='count',margins=True,normalize=True)","f405b248":"pd.crosstab(df['pdays'],df['previous'],values=df['response_yes'],aggfunc='count',margins=True,normalize=True)","26af6b82":"df=pd.get_dummies(df,drop_first=True)\ndf","7cdd8fbe":"df.columns","7dc9bc45":"X=df.drop('response_yes', axis=1)\nY=df['response_yes']\n","c05a7f8d":"from sklearn.model_selection import train_test_split\nfrom sklearn.model_selection import cross_val_score\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.model_selection import KFold\nfrom sklearn.metrics import accuracy_score","b6bbbd15":"logm=LogisticRegression()","4f0931c7":"from sklearn.feature_selection import RFE\nimport statsmodels.api as sm ","46205c98":"from statsmodels.stats.outliers_influence import variance_inflation_factor","d58144f1":"# 30% of the data will be used for testing\nX_train, X_test, Y_train, Y_test= train_test_split(X, Y, test_size=0.3, random_state=0)","e97360bf":"import warnings\nwarnings.filterwarnings('ignore')","3924d0d1":"logm.fit(X_train,Y_train)","00c568a5":"rfe = RFE(logm, 10)\nrfe = rfe.fit(X_train, Y_train)\nrfe_ = X_train.columns[rfe.support_]\nrfe_","c60ae0e4":"def checkVIF(X):\n    vif = pd.DataFrame()\n    vif['Features'] = X.columns\n    vif['VIF'] = [variance_inflation_factor(X.values, i) for i in range(X.shape[1])]\n    vif['VIF'] = round(vif['VIF'], 2)\n    vif = vif.sort_values(by = \"VIF\", ascending = False)\n    return(vif)","f5b6c91d":"X_new_train=X_train[rfe_]","d095a1d8":"checkVIF(X_new_train)","e5154264":"X_new=df[['housing_yes', 'contact_unknown','month_aug','month_jan',\n       'month_jul', 'month_mar', 'month_oct', 'month_sep', 'poutcome_success']]\nY=df['response_yes']","1cef2d2e":"X_new_train, X_new_test, Y_train, Y_test= train_test_split(X_new, Y, test_size=0.3, random_state=0)","41a614ea":"z=logm.fit(X_new_train,Y_train)\nz","98384ea2":"auc=[X_train,X_new_train]\nmodels = []\nmodels.append(('LogisticRegression', LogisticRegression()))\nfor i in auc:\n        kfold = KFold(n_splits=10, random_state=0)    \n        # train the model\n        cv_results = cross_val_score(LogisticRegression(), i, Y_train, cv=kfold, scoring='accuracy')    \n        msg = \"%s: %f (%f)\" % (LogisticRegression, cv_results.mean(), cv_results.std())\n        print(msg)","21af963f":"Y_pred=z.predict(X_new_test)\nY_pred","2f6fd757":"Y_pred.shape","027d2234":"# Classification Report\nfrom sklearn.metrics import classification_report\nfrom sklearn.metrics import confusion_matrix","3a60ccd9":"print(confusion_matrix(Y_test,Y_pred))","21284b14":"print(classification_report(Y_test,Y_pred))","72ef0228":"from sklearn.ensemble import RandomForestClassifier\nfrom sklearn.ensemble import RandomForestRegressor\n","ec35cc84":"rfc = RandomForestClassifier(n_estimators=30,max_depth=30)\nrfc.fit(X_train, Y_train)\n","18d46d50":"y_pred=rfc.predict(X_test)\ny_pred","57bfee8b":"print(confusion_matrix(Y_test,y_pred))\n","e4184fc5":"print(classification_report(Y_test, y_pred))","afe997cc":"p=[X_train,X_new_train]","2a0fdb2a":"for i in p:\n    kf = KFold(n_splits=10)    \n    cross_v = cross_val_score(RandomForestClassifier(), i, Y_train, cv=kfold, scoring='accuracy')  \n    print('Cross validation score:',cross_v.mean())","e7c632ff":"model_new = RandomForestClassifier(n_estimators=45,max_depth=10)\nmodel_new.fit(X_new_train, Y_train)","e6ad1b79":"y1_pred=model_new.predict(X_new_test)\ny1_pred","82e0c18c":"print('For all features')\nprint(accuracy_score(Y_test, y1_pred))\nprint('For selected features')\nprint(accuracy_score(Y_test, y1_pred))","1769fd2c":"print(classification_report(Y_test, y1_pred))","3d584d17":"print(confusion_matrix(Y_test,y1_pred))","d67c8dde":"- Above plot is by using pday with know values and ignoring missing values(-1)","c24ec961":"### Month ","aa66f4da":"### Are the features about the previous campaign data useful? ","99341350":"__Other important Observations:__  \n* pdays and previous have higher correlation\n* duration have a higher correlation with our target variable\n* Numerical features have very less correlation between them.","fa3ce765":"- __(We will be converting previous marketing campaigns variables into dummy variables)__","b47d8912":"__Observation:__  \n* As we observe aboe, less people are contacted who have loan.","7abbfcca":"### Estimating the model performance using k fold cross validation","51ff75ba":"<h3> Dataset Description <\/h3>\nThe data is related with direct marketing campaigns of a banking institution. The marketing campaigns were based on phone calls. Often, more than one contact to the same client was required, in order to access if the product (bank term deposit) would be (or not) subscribed. \n \n* __bank client attributes__:\n    * age: age of client (numeric)   \n    * job : type of job (categorical: \"admin.\", \"unknown\", \"unemployed\", \"management\", \"housemaid\", \"entrepreneur\", \"student\", \"blue-collar\", \"self-employed\", \"retired\", \"technician\", \"services\")   \n    * marital : marital status (categorical: \"married\", \"divorced\", \"single\")  \n    * education: client highest education (categorical: \"unknown\", \"secondary\", \"primary\", \"tertiary\")\n    * default: has credit in default? (binary\/2-categories: \"yes\", \"no\")\n    * balance: average yearly balance, in euros (numeric)  \n    * housing: has housing loan? (binary\/2-categories: \"yes\", \"no\")  \n    * loan: has personal loan? (binary\/2-categories: \"yes\", \"no\")  \n* __related with the last contact of the current campaign__:\n    * contact: contact communication type (categorical: \"unknown\", \"telephone\", \"cellular\") \n    * day: last contact day of the month (numeric)\n    * month: last contact month of year (categorical: \"jan\", \"feb\", \"mar\", ..., \"nov\", \"dec\")\n    * duration: last contact duration, in seconds (numeric)\n* __other attributes__:\n    * campaign: number of contacts performed during this campaign and for this client (numeric, includes last contact)\n    * pdays: number of days that passed by after the client was last contacted from a previous campaign (numeric, -1 means client was not previously contacted)\n    * previous: number of contacts performed before this campaign and for this client (numeric)\n    * poutcome: outcome of the previous marketing campaign ( categorical: 'unknown\",\"other\", \"failure\", \"success\")\n* __Output variable (desired target)__:\n    * y: has the client subscribed a term deposit? (binary: \"yes\", \"no\")","ac68edfd":"-- So we will consdier the rest of the features for building our model","714e9f8a":"- __ FInding RFE to select top n features in an automated fashion (choose n as you see fit__","e7b079e2":"__The most important features are as follows__\n * Month,housing,poutcome,contact","2ffa702a":"### Plot a horizontal bar graph with the median values of balance for each education level value. Which group has the highest median? ","a0063311":"### With respect to JOB field","ee4cb459":"### Which features are the most important from your model? ","8b1d6ea3":"## Train test split","a98e6ba7":"__Observation:__  \n* People with age < 30 or 60+ have higher success rate.  \n* Only 3% of people with age of 60+ ","35af5c71":"### Loan","72a56266":"### Which metric did you choose and why? ","580e3ac8":" # MACHINE_LEARNING_PROJECT_2_BANK_MARKETING_DATA","9d2b27b0":"### Make a box plot for pdays. Do you see any outliers?","cfbe05c8":"### Estimate the model performance using k fold cross validation","ed50ddec":"### Salary","7d56980e":"### FINAL OBJECTIVE= To make a predictive model to predict if the customer will respond positively to the campaign or not. The target variable is \u201cresponse\u201d. ","d168ca26":"### Which model has better performance on the test set? ","36189db9":"## Predictive model 1: Logistic regression ","2e8150a2":"__We will check VIF(Variance Inflation factor to delete the redundant factor___","9ccfbe6a":"__Observation:__  \n* As we observe above, most of the communication was made through 'cellular' network","156fffe1":"#### As we can observe above,Very few people are contacted who are defaulter,","ddd3109b":"## Predictive model 2: Random Forest","571876f7":"### Contacts-Mode of communications","c617a909":"__Observation:__  \n* Top contacted people are from job type: 'blue-collar', 'management' & 'technician'\n* Success rate is highest for student","180bb625":"We used classification performance metrics such as, Precision score,accuracy score , recall score and Cross val score etc.\nIn order to estimate the error, the model is required to test a dataset which it hasn\u2019t seen yet.\n\nTherefore for the purpose of testing the model, we would require a labelled dataset. This can be achieved by splitting the training dataset into training dataset and testing dataset. This can be achieved by various techniques such as, k-fold cross validation,","8eb46645":"** As we can observe above,Month of dec has highest VIF value, we will rmeove that feature","d4edcb65":"### Are pdays and poutcome associated with the target? ","bf79e411":"- As we can observe.Tertiary education has higher median value under balances and next we have few values which are \n- unknown,which second highest median under balance","b2e03628":"__Observation:__\n* Most of the people who are contacted have tertiary or secondary education.","e6fb4e24":"### - Necessary transformations of categorical variables and the numeric variables\n### -Handling variables corresponding to the previous campaign","cf190031":"### Plotting numerical features against categorical features\u2019 ","9e993765":"Logistic has got better accuracy score compared to random forset, hence we can say that it has better performance,is an important model as it results in high AUC score.","81426ff1":"__Observation:__\n* Most of the people are contacted in the month of May\n* Decemeber is the month less people are contacted","c38d6030":"- After selecting relevant values we can observe ,mean=224,minimum value =1 and median= 194","21e82b08":"### By using the features we got from VIF and Kfold ,we have got an accuracy of 89%.","c57ca66b":"###  Education Analysis","9d5702c3":"__1.Before we build a model,lets select top features using RFE(recursive feature elimination),so that model predicts better__","bed0be25":"- As we can observe above,there are values as -1 which doesnot conclude anything,because pdays basically means \"is the number of days that passed by after the client was last contacted from a previous campaign\",so in this -1 is bit out of fit.\n- here mean = -1,minimum value=-1 and median =-1,which does not infer anything","160cd0b8":"__As we can observe above__\n- CV score(for all features): 0.9043196330140578\n- CV score(for selected features):  0.8933231392793823","8b37e18b":"- As we can observe in above correlatiion matrix,previous cmapaign data is not much correlated,and have only 0.093 almost close 0 .so previous data cannot be used to prediict much","526a6050":"__Observations:__  \n* pdays and poutcome are associated with each other\n* From previous marketing campaign ,we can see that there was a outcome ,when there are more contacts made to a particular client\n* pdays=-1 has overall count of 36954 same as previous=0 ,,which implies that many of people were not contacted.\n\n\n### Inference:-- So to proceed further, we can just retain pdays value,as we can say,in previous campaign the clients were not contact for so many people ,so the previous value is 0 for all those 36954 contacts","8902d117":"__Observation:__\n* Most of the clients contacted have previous outcome as 'unknown'.","0bdeb6a1":"### Describe the pdays column, make note of the mean, median and minimum values. Anything fishy in the values? ","f18e8587":"### Poutcome against Response","74c8df8c":"__Observation:__  \n* Pair plots of age-campaign and day-campaign are much efficient in distinguishing between different classes with very few overlapes.","85bb2f4e":"__Observation:__\n* Contacted people were with salary rane betwen 20000 to 100000\n* Successn was the people having salary of 100000","bbe76807":"- Now lets create a table to count number of people in different job role and response of succes rate","76f66bda":"- this plot is including missing values(-1),and we have see outliers in both kind of data,as we see above there are 36954 values missing (-1) for pdays in the data","b90ed2ae":"### Precision, recall, accuracy of your model","fba631ad":" - Performing bi-variate analysis to identify the features that are directly associated with the target variable before predicting \n \n- Converting the response variable to a dummy variable"}}