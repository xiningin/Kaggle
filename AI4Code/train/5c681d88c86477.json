{"cell_type":{"db607747":"code","11e4830b":"code","a0e5e7c9":"code","d573a188":"code","38a64328":"code","8f3ecfbc":"code","5e5dcb6b":"code","c6dc12a2":"code","89abdc5c":"code","e4a6fffa":"code","a2a50484":"code","462945bc":"code","6575c00f":"code","4b6ece2d":"code","67640152":"code","19a13f49":"code","ff1969f9":"code","31a7e451":"code","b2afdeeb":"code","ff703484":"code","269fce83":"code","0a8155e6":"code","da201284":"code","ce955f30":"code","dc5c2513":"code","2514406b":"code","3e7da4f2":"code","38f9f9ec":"code","1c1c802f":"code","ddd082e9":"code","f87600f3":"code","c45470eb":"code","71f76609":"code","bcea3718":"code","1a5e8ad3":"code","daabd526":"code","69f873ec":"markdown","3a20e052":"markdown","6aa2e088":"markdown","fa547e8e":"markdown","12bc3190":"markdown","c6afbb9b":"markdown","2eb68bae":"markdown","47fd1acd":"markdown","606d61c0":"markdown","eeb2edd2":"markdown","07b82891":"markdown"},"source":{"db607747":"import warnings\nwarnings.filterwarnings('ignore')\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nimport datetime as dt\nimport sklearn\nfrom sklearn.preprocessing import MinMaxScaler\nfrom scipy.cluster.hierarchy import linkage\nfrom scipy.cluster.hierarchy import dendrogram\nfrom scipy.cluster.hierarchy import cut_tree","11e4830b":"# read the dataset\nmall_df = pd.read_csv(\"..\/input\/customer-segmentation-tutorial-in-python\/Mall_Customers.csv\", sep=\",\", encoding=\"ISO-8859-1\", header=0)\nmall_df.head(100)","a0e5e7c9":"#Check Null Values\nmall_df.isnull().sum()","d573a188":"#Inspect the DataFrame\nmall_df.info()","38a64328":"sns.violinplot(mall_df['Age']);","8f3ecfbc":"sns.violinplot(mall_df['Annual Income (k$)']);\n","5e5dcb6b":"sns.violinplot(mall_df['Spending Score (1-100)'])\nplt.show()","c6dc12a2":"#BIvariate Analysis\nplt.figure(figsize=(12,6))\nplt.subplot(1,2,1)\ncluster_type = mall_df.groupby(['Gender'])['Annual Income (k$)'].mean().reset_index()\nax=sns.barplot(x = 'Gender', y='Annual Income (k$)', data=cluster_type)\nfor p in ax.patches:\n    ax.annotate(str(round(p.get_height(),2)), (p.get_x() * 1.01 , p.get_height() * 1.01))\n\nplt.subplot(1,2,2)\ncluster_type = mall_df.groupby(['Gender'])['Spending Score (1-100)'].mean().reset_index()\nax=sns.barplot(x = 'Gender', y='Spending Score (1-100)', data=cluster_type)\nfor p in ax.patches:\n    ax.annotate(str(round(p.get_height(),2)), (p.get_x() * 1.01 , p.get_height() * 1.01))\n\nplt.show()","89abdc5c":"#Binning the Age of the Customers\nbins = [0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75]\nslot = ['0-5','5-10','10-15','15-20','20-25','25-30','30-35','35-40','40-45','45-50','50-55','55-60','60-65','65-70','70+']\n\nmall_df['Age_Range']=pd.cut(mall_df['Age'],bins,labels=slot)","e4a6fffa":"#Which age People mostly visit the Mall?\nplt.figure(figsize=(12,6))\nedu=sns.countplot(x=\"Age_Range\", data=mall_df)\nedu.set_xticklabels(edu.get_xticklabels(),rotation=90)\nplt.show()","a2a50484":"#BIvariate Analysis\nplt.figure(figsize=(20,10))\nplt.subplot(1,2,1)\ncluster_type = mall_df.groupby(['Age_Range'])['Annual Income (k$)'].mean().reset_index()\nsns.barplot(x = 'Age_Range', y='Annual Income (k$)', data=cluster_type)\nplt.subplot(1,2,2)\ncluster_type = mall_df.groupby(['Age_Range'])['Spending Score (1-100)'].mean().reset_index()\nsns.barplot(x = 'Age_Range', y='Spending Score (1-100)', data=cluster_type)\nplt.show()","462945bc":"mall_df.drop('Age_Range',axis=1,inplace=True)\nmall_df.head()","6575c00f":"from sklearn.neighbors import NearestNeighbors\nfrom random import sample\nfrom numpy.random import uniform\nimport numpy as np\nfrom math import isnan\ndef hopkins(X):\n    d = X.shape[1]\n    #d = len(vars) # columns\n    n = len(X) # rows\n    m = int(0.1 * n) # heuristic from article [1]\n    nbrs = NearestNeighbors(n_neighbors=1).fit(X.values)\n \n    rand_X = sample(range(0, n, 1), m)\n \n    ujd = []\n    wjd = []\n    for j in range(0, m):\n        u_dist, _ = nbrs.kneighbors(uniform(np.amin(X,axis=0),np.amax(X,axis=0),d).reshape(1, -1), 2, return_distance=True)\n        ujd.append(u_dist[0][1])\n        w_dist, _ = nbrs.kneighbors(X.iloc[rand_X[j]].values.reshape(1, -1), 2, return_distance=True)\n        wjd.append(w_dist[0][1])\n \n    H = sum(ujd) \/ (sum(ujd) + sum(wjd))\n    if isnan(H):\n        print(ujd, wjd)\n        H = 0\n \n    return H\n","4b6ece2d":"hopkins(mall_df.drop(['CustomerID','Gender'],axis=1))","67640152":"mall_df.head()","19a13f49":"mall_df_data=mall_df.drop(['CustomerID','Gender','Age'],axis=1)\n# instantiate\nscaler = MinMaxScaler()\n\n# fit_transform\nmall_df_scaled = scaler.fit_transform(mall_df_data)\nmall_df_scaled.shape","ff1969f9":"#Converting the scaled data to data frame\nmall_df_scaled = pd.DataFrame(mall_df_scaled)\nmall_df_scaled.columns = mall_df_data.columns\nmall_df_scaled.head()","31a7e451":"# single linkage\nplt.figure(figsize=(30,15))\nmergings = linkage(mall_df_scaled, method=\"single\", metric='euclidean')\ndendrogram(mergings)\nplt.show()","b2afdeeb":"# complete linkage\nplt.figure(figsize=(30,15))\nmergings = linkage(mall_df_scaled, method='complete', metric='euclidean')\ndendrogram(mergings)\nplt.show()","ff703484":"# 4 clusters\ncluster_l = cut_tree(mergings, n_clusters=4).reshape(-1, )\ncluster_l","269fce83":"# assign cluster labels\nmall_df['cluster_id'] = cluster_l\nmall_df.head()","0a8155e6":"plt.figure(figsize=(20,10))\n\nsns.scatterplot(x = 'Annual Income (k$)', y = 'Spending Score (1-100)', hue = 'cluster_id', data = mall_df, palette = 'Set1');","da201284":"mall_df['cluster_id'].value_counts()","ce955f30":"#Profiling the clusters\nmall_df.drop(['CustomerID','Age','Gender'],axis=1).groupby('cluster_id').mean().plot(kind='bar')\nplt.show()","dc5c2513":"from sklearn.cluster import DBSCAN\nfrom collections import Counter","2514406b":"model=DBSCAN(eps=0.1,min_samples=10).fit(mall_df_scaled)\nprint(model.labels_)\n","3e7da4f2":"# assign cluster labels\nmall_df['cluster_lab'] = model.labels_\nmall_df.head()","38f9f9ec":"colors = ['royalblue', 'maroon', 'forestgreen', 'mediumorchid', 'tan', 'deeppink', 'olive', 'goldenrod', 'lightcyan', 'navy']\nvectorizer = np.vectorize(lambda : colors[x % len(colors)])","1c1c802f":"plt.scatter(mall_df['Annual Income (k$)'], mall_df['Spending Score (1-100)'], c=mall_df['cluster_lab']);","ddd082e9":"plt.figure(figsize=(20,10))\n\nsns.scatterplot(x = 'Annual Income (k$)', y = 'Spending Score (1-100)', hue = 'cluster_lab', data = mall_df, palette = 'Set1');","f87600f3":"mall_df_scaled.describe()","c45470eb":"#Profiling the clusters\nmall_df.drop(['CustomerID','Age','Gender','cluster_id'],axis=1).groupby('cluster_lab').mean().plot(kind='bar')\nplt.show()","71f76609":"#Valuable Customers\nmall_df[mall_df['cluster_lab']==2]","bcea3718":"#need to market on this cluster to improve the spending score\nmall_df[mall_df['cluster_lab']==3]","1a5e8ad3":"#outliers\nmall_df[mall_df['cluster_lab']==1]","daabd526":"#moderate performers\nmall_df[mall_df['cluster_lab']==-1]","69f873ec":"## Scaling the Data","3a20e052":"## Hierarchial Clustering","6aa2e088":"- We can identify the clusters surreounded by another cluster in the DBSCAN clustering\n- NO prefedined clusters defined","fa547e8e":"## DB SCAN Clustering","12bc3190":"## EDA","c6afbb9b":"## Hopkin Score","2eb68bae":"- 30-35 Age range people  visit the mall more than any other range people","47fd1acd":"- Cluster_id 2 are the best customers to the Mall they have high Annual income and they will have spending score, so we shouldn't loose these customers as they contribute a lot to mall income\n- Cluster _id 3 have more income but they spend less so we can target these customers with some offers, so they might tend to buy and increase their spending score,when we want  market for some new products or with some special offers this cluster customers will be best\n- Cluser_id 0 are the intermediate level customers they have considerable spending score but their spending score can also be increased ,so we can go to them with some better offers and good products for marketing\n\n- cluster_id 1 are the customers where the income is low but they spend very good so these customers are sop good to our Mall","606d61c0":"- As we can observe,Age between 25-45 has more anuual income\n- 25-30 Age People has more spending score","eeb2edd2":"**Problem Statement**\n\nWe are going to cluster mall customers using DB SCAN clustering.","07b82891":"- To avoid noise in the clusters we use DB SCAN clustering "}}