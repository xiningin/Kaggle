{"cell_type":{"5e3b3d95":"code","eb286d40":"code","06af6118":"code","17c597f9":"code","8fc87e21":"code","5c9f21c6":"code","72885a47":"code","e8da118b":"code","29489974":"code","37cf9f88":"code","323233f1":"code","6664cc81":"code","63863e6a":"code","6552b5e9":"code","a7caf2f6":"code","90f6df87":"code","f0cc936a":"code","84d066f8":"code","b98e7160":"code","f28fca03":"code","bf0ef2ff":"code","922064cf":"code","2e6d6e3b":"code","03e97686":"code","d0ba07b7":"code","c71e40b2":"code","45f28443":"code","cda69adc":"code","464ccb69":"code","82472ed4":"code","37f5f6b1":"code","2308b1c3":"code","097f7539":"code","33fa811a":"code","bb04fe01":"code","c1a7fca7":"code","163f24f2":"code","e6e37953":"code","4d17e4ac":"code","18211aa5":"code","71e3009a":"code","7cdf74c6":"code","641581ae":"code","d20c9b4c":"code","be532729":"code","37dc25e7":"code","cd8ce16e":"code","638b985b":"code","6ba8a3c2":"code","91967364":"code","762c919c":"code","906e5e0c":"code","44037d21":"code","87321bdb":"markdown","cb684882":"markdown","69b80c25":"markdown","87c31f0d":"markdown","84adf055":"markdown","714aa777":"markdown","8592a513":"markdown","b0c5da7d":"markdown","1b36a4b1":"markdown","54c76c2d":"markdown","a9c19335":"markdown","6f1a56fe":"markdown","1e263452":"markdown","38810369":"markdown","5205c93f":"markdown","26cd00f7":"markdown","b740d996":"markdown","a2594321":"markdown","f152c874":"markdown","8a75b25e":"markdown","c74597e1":"markdown","e915e5a8":"markdown","c13354c2":"markdown","f0c55d9e":"markdown","742f70af":"markdown","093a25c8":"markdown","47188332":"markdown","087a8a56":"markdown","ec12eecb":"markdown","d9a722e2":"markdown","2a9f0031":"markdown","67dacf3d":"markdown","ef1b6261":"markdown","ec58e0d6":"markdown","3c86edea":"markdown","d95b03d5":"markdown","d61cb55c":"markdown","8ef229ae":"markdown","5ab8a610":"markdown","a9473b30":"markdown","967af1d7":"markdown","95a7ba5e":"markdown","906e4567":"markdown"},"source":{"5e3b3d95":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\ncolor = sns.color_palette()\n%matplotlib inline\npd.options.mode.chained_assignment = None  # default='warn'\nfrom mlxtend.frequent_patterns import apriori\nfrom mlxtend.frequent_patterns import association_rules","eb286d40":"aisles = pd.read_csv(\"..\/input\/instacart-market-basket-analysis\/aisles.csv\")\ndepartments = pd.read_csv(\"..\/input\/instacart-market-basket-analysis\/departments.csv\")\norder_products_train = pd.read_csv(\"..\/input\/instacart-market-basket-analysis\/order_products__prior.csv\")\norder_products_test = pd.read_csv(\"..\/input\/instacart-market-basket-analysis\/order_products__train.csv\")\norders = pd.read_csv(\"..\/input\/instacart-market-basket-analysis\/orders.csv\")\nproducts = pd.read_csv(\"..\/input\/instacart-market-basket-analysis\/products.csv\")\norder_products_prior= pd.read_csv(\"..\/input\/instacart-market-basket-analysis\/order_products__prior.csv\")","06af6118":"aisles.head()","17c597f9":"aisles.info()","8fc87e21":"aisles.describe()","5c9f21c6":"aisles[\"aisle\"]","72885a47":"departments.head()","e8da118b":"departments.info()","29489974":"departments.describe()","37cf9f88":"order_products_train.head()","323233f1":"order_products_train.info()","6664cc81":"order_products_train.describe()","63863e6a":"order_products_train.isnull().sum()","6552b5e9":"orders.head()","a7caf2f6":"orders.info()","90f6df87":"orders['days_since_prior_order'].unique()","f0cc936a":"orders.describe()","84d066f8":"orders.isnull().sum()","b98e7160":"orders.fillna(0,inplace=True)","f28fca03":"orders[orders[\"days_since_prior_order\"]==\"NA\"]","bf0ef2ff":"products.head()","922064cf":"products.info()","2e6d6e3b":"products.describe()","03e97686":"plt.figure(figsize=(15,5))\nsns.countplot(x=\"order_dow\", data=orders, color=color[0])\nplt.ylabel('Count', fontsize=12)\nplt.xlabel('Day of week', fontsize=12)\nplt.xticks(rotation='vertical')\nplt.title(\"Frequency of order by week day\", fontsize=15)\nplt.show()","d0ba07b7":"plt.figure(figsize=(15,5))\nsns.countplot(x=\"order_hour_of_day\", data=orders, color=color[0])\nplt.ylabel('Count', fontsize=12)\nplt.xlabel('Hour of day', fontsize=12)\nplt.xticks(rotation='vertical')\nplt.title(\"Frequency of order by hour of day\", fontsize=15)\nplt.show()","c71e40b2":"grouped_df = orders.groupby([\"order_dow\", \"order_hour_of_day\"])[\"order_number\"].aggregate(\"count\").reset_index()\ngrouped_df = grouped_df.pivot('order_dow', 'order_hour_of_day', 'order_number')\n\nplt.figure(figsize=(15,5))\nsns.heatmap(grouped_df)\nplt.title(\"Frequency of Day of week Vs Hour of day\")\nplt.show()","45f28443":"plt.figure(figsize=(15,5))\nsns.countplot(x=\"days_since_prior_order\", data=orders, color=color[0])\nplt.ylabel('Count', fontsize=12)\nplt.xlabel('Days since prior order', fontsize=12)\nplt.xticks(rotation='vertical')\nplt.title(\"Frequency distribution by days since prior order\", fontsize=15)\nplt.show()","cda69adc":"# percentage of re-orders in prior set #\norder_products_prior.reordered.sum() \/ order_products_prior.shape[0]","464ccb69":"# percentage of re-orders in train set #\norder_products_train.reordered.sum() \/ order_products_train.shape[0]","82472ed4":"grouped_df = order_products_prior.groupby(\"order_id\")[\"reordered\"].aggregate(\"sum\").reset_index()\ngrouped_df[\"reordered\"][grouped_df[\"reordered\"]>1] = 1\ngrouped_df.reordered.value_counts() \/ grouped_df.shape[0]","37f5f6b1":"grouped_df = order_products_train.groupby(\"order_id\")[\"reordered\"].aggregate(\"sum\").reset_index()\ngrouped_df[\"reordered\"][grouped_df[\"reordered\"]>1] = 1\ngrouped_df.reordered.value_counts() \/ grouped_df.shape[0]","2308b1c3":"grouped_df = order_products_train.groupby(\"order_id\")[\"add_to_cart_order\"].aggregate(\"max\").reset_index()\ncnt_srs = grouped_df.add_to_cart_order.value_counts()\n\nplt.figure(figsize=(20,10))\nsns.barplot(cnt_srs.index, cnt_srs.values, alpha=0.8, color=color[0])\nplt.ylabel('Number of Occurrences', fontsize=12)\nplt.xlabel('Number of products in the given order', fontsize=12)\nplt.xticks(rotation='vertical')\nplt.show()","097f7539":"order_products_prior = pd.merge(order_products_prior, products, on='product_id', how='left')\norder_products_prior = pd.merge(order_products_prior, aisles, on='aisle_id', how='left')\norder_products_prior = pd.merge(order_products_prior, departments, on='department_id', how='left')\norder_products_prior.head()","33fa811a":"cnt_srs = order_products_prior['product_name'].value_counts().reset_index().head(20)\ncnt_srs.columns = ['product_name', 'frequency_count']\ncnt_srs","bb04fe01":"cnt_srs = order_products_prior['aisle'].value_counts().head(20)\nplt.figure(figsize=(15,5))\nsns.barplot(cnt_srs.index, cnt_srs.values, alpha=1.0, color=color[0])\nplt.ylabel('Number of Occurrences', fontsize=12)\nplt.xlabel('Aisle', fontsize=12)\nplt.xticks(rotation='vertical')\nplt.show()","c1a7fca7":"plt.figure(figsize=(15,10))\ntemp_series = order_products_prior['department'].value_counts()\nlabels = (np.array(temp_series.index))\nsizes = (np.array((temp_series \/ temp_series.sum())*100))\nplt.pie(sizes, labels=labels, \n        autopct='%1.1f%%', startangle=200)\nplt.title(\"Departments distribution\", fontsize=15)\nplt.show()","163f24f2":"grouped_df = order_products_prior.groupby([\"department\"])[\"reordered\"].aggregate(\"mean\").reset_index()\n\nplt.figure(figsize=(15,5))\nsns.pointplot(grouped_df['department'].values, grouped_df['reordered'].values, alpha=1.0, color=color[0])\nplt.ylabel('Reorder ratio', fontsize=12)\nplt.xlabel('Department', fontsize=12)\nplt.title(\"Department wise reorder ratio\", fontsize=15)\nplt.xticks(rotation='vertical')\nplt.show()","e6e37953":"grouped_df = order_products_prior.groupby([\"department_id\", \"aisle\"])[\"reordered\"].aggregate(\"mean\").reset_index()\n\nfig, ax = plt.subplots(figsize=(15,15))\nax.scatter(grouped_df.reordered.values, grouped_df.department_id.values)\nfor i, txt in enumerate(grouped_df.aisle.values):\n    ax.annotate(txt, (grouped_df.reordered.values[i], grouped_df.department_id.values[i]), rotation=45, ha='center', va='center', color='blue')\nplt.xlabel('Reorder Ratio')\nplt.ylabel('department_id')\nplt.title(\"Reorder ratio of different aisles\", fontsize=15)\nplt.show()","4d17e4ac":"order_products_prior[\"add_to_cart_order_mod\"] = order_products_prior[\"add_to_cart_order\"].copy()\norder_products_prior[\"add_to_cart_order_mod\"][order_products_prior[\"add_to_cart_order_mod\"]>70] = 70\ngrouped_df = order_products_prior.groupby([\"add_to_cart_order_mod\"])[\"reordered\"].aggregate(\"mean\").reset_index()\n\nplt.figure(figsize=(15,10))\nsns.pointplot(grouped_df['add_to_cart_order_mod'].values, grouped_df['reordered'].values, alpha=1.0, color=color[0])\nplt.ylabel('Reorder ratio', fontsize=12)\nplt.xlabel('Add to cart order', fontsize=12)\nplt.title(\"Add to cart order - Reorder ratio\", fontsize=15)\nplt.xticks(rotation='vertical')\nplt.show()","18211aa5":"order_products_train = pd.merge(order_products_train, orders, on='order_id', how='left')\ngrouped_df = order_products_train.groupby([\"order_dow\"])[\"reordered\"].aggregate(\"mean\").reset_index()\n\nplt.figure(figsize=(15,5))\nsns.barplot(grouped_df['order_dow'].values, grouped_df['reordered'].values, alpha=0.8, color=color[0])\nplt.ylabel('Reorder ratio', fontsize=12)\nplt.xlabel('Day of week', fontsize=12)\nplt.title(\"Reorder ratio across day of week\", fontsize=15)\nplt.xticks(rotation='vertical')\nplt.ylim(0.5, 0.7)\nplt.show()","71e3009a":"grouped_df = order_products_train.groupby([\"order_hour_of_day\"])[\"reordered\"].aggregate(\"mean\").reset_index()\n\nplt.figure(figsize=(15,5))\nsns.barplot(grouped_df['order_hour_of_day'].values, grouped_df['reordered'].values, alpha=1.0, color=color[0])\nplt.ylabel('Reorder ratio', fontsize=12)\nplt.xlabel('Hour of day', fontsize=12)\nplt.title(\"Reorder ratio across hour of day\", fontsize=15)\nplt.xticks(rotation='vertical')\nplt.ylim(0.5, 0.7)\nplt.show()","7cdf74c6":"grouped_df = order_products_train.groupby([\"order_dow\", \"order_hour_of_day\"])[\"reordered\"].aggregate(\"mean\").reset_index()\ngrouped_df = grouped_df.pivot('order_dow', 'order_hour_of_day', 'reordered')\n\nplt.figure(figsize=(15,5))\nsns.heatmap(grouped_df)\nplt.title(\"Reorder ratio of Day of week Vs Hour of day\")\nplt.show()","641581ae":"#Reading the csv file and storing the elements in an array\nimport nltk\nimport re\nimport numpy as np\nimport pandas as pd\n\n\naisles = np.array(aisles)[ : ,-1]\naisles","d20c9b4c":"#Creating the Bag of Words model\nword2count = {}\nfor aisle in aisles:\n    words = nltk.word_tokenize(aisle)\n    for word in words:\n        if word not in word2count.keys():\n            word2count[word] = 1\n        else:\n            word2count[word] += 1\nword2count","be532729":"#Heap of 50 frequently used words\nimport heapq\nfreq_words = heapq.nlargest(50, word2count, key=word2count.get)\nfreq_words","37dc25e7":"#Building the Bag of Words model\nx=[]\nfor aisle in aisles:\n    vector = []\n    for word in freq_words:\n        if word in nltk.word_tokenize(aisle):\n            vector.append(1)\n        else:\n            vector.append(0)\n    x.append(vector)\nx = np.asarray(x)\nx","cd8ce16e":"#Tokenizing all the words present \nall_words = [nltk.word_tokenize(aisle) for aisle in aisles]\n\nall_words    ","638b985b":"#Eliminating the stop words\nfrom nltk.corpus import stopwords\nfor i in range(len(all_words)):\n    all_words[i] = [w for w in all_words[i] if w not in stopwords.words('english')]","6ba8a3c2":"#Word Embedding using Word2Vec\nfrom gensim.models import Word2Vec\nword2vec = Word2Vec(all_words, min_count = 1)\n","91967364":"vocabulary = word2vec.wv.index_to_key\nprint(vocabulary)","762c919c":"#Representation of the vector 'fruits'\nv1 = word2vec.wv['fruits']\nv1","906e5e0c":"#Obtaining the word vectors with the meaning similar to the word vector'food'\nsim_words= word2vec.wv.most_similar('food')\nsim_words","44037d21":"#Obtaining TF-IDF vector \nfrom sklearn.feature_extraction.text import TfidfVectorizer\nvectorizer = TfidfVectorizer()\nvectors = vectorizer.fit_transform(aisles)\nfeature_names = vectorizer.get_feature_names()\ndense = vectors.todense()\ndenselist = dense.tolist()\ndf = pd.DataFrame(denselist, columns=feature_names)\ndf","87321bdb":"Now let us check the time interval between orders.","cb684882":"There is a 59% of reorders in both train and prior sets.","69b80c25":"About 12% of the orders in prior set has no re-ordered items while in the train set it is 6.5%.","87c31f0d":"**Products**","84adf055":"Produce, dairy eggs and snacks constitute  majority of department.","714aa777":"Personal care has lowest reorder ratio and dairy eggs have highest reorder ratio.","8592a513":"Now let us see the number of products bought in each order.","b0c5da7d":"From the heatmap we can conclude that most of the reorders are done during early mornings.","1b36a4b1":"Now let us see how the ordering habit changes with each day of the week.","54c76c2d":"**order_products_train**","a9c19335":"# Data Exploration","6f1a56fe":"The most frequently bought items are organic fruits and vegetables. ","1e263452":"# NATURAL LANGUAGE PROCESSING\n","38810369":"**Departments**","5205c93f":"Now let us check the reordered percentage of each aisle.","26cd00f7":"This data is in tandem with the frequently bought items table.","b740d996":"Now let us check the relation between reorder ratio and hours of the day.","a2594321":"**Orders**","f152c874":"For a more meaningful understanding the data at hand, we will merge the aisles, product and department dataframes and explore the merged dataframe further.","8a75b25e":"Importing necessary libraries and modules","c74597e1":"Now let us check the relation between reorder ratio and days of the week.","e915e5a8":"From the graph we see a spike every 7 days and 30 days.Thus we can conclude most customers order on a weekly or monthly basis. We can also see smaller peaks at 14, 21 and 28 days (weekly intervals). Another explaination for the spike after 30 days is because any order that is made more than 30 days since the previous order is declared as 30 days.\n\n","c13354c2":"Now let us check the reordered percentage of each department with the help of pointplot.","f0c55d9e":"From the heatmap its evident that most orders are done on Saturday and Sunday mornings (9am to 5pm)","742f70af":"**The above textual data can be understood better with the help of graphs.**","093a25c8":"Now let us check the Department distribution with the help of a piechart.","47188332":" There will also be situations when none of the products are re-ordered. Let us check that now in prior and test sets.","087a8a56":"Now lets explore the most frequently bought aisles section.","ec12eecb":"We can see that reordersare high on Sundays and Thursdays.","d9a722e2":"Let us now explore the relationship between how aadding to cart affects the reorder ratio.","2a9f0031":"Now we shall see how the distribution is with respect to time of the day.","67dacf3d":"# Exploratory Data Analysis and Natural Language Processing on Instacart Dataset\n\n","ef1b6261":"The highest number of products ordered peaks at 5 and gradually reduces to the right.","ec58e0d6":"**Aisles**","3c86edea":"Now we will combine the day of week and hour of day to see the distribution with the help of a heatmap","d95b03d5":"Now we will explore each dataframe further for better understanding.","d61cb55c":"Since our objective is to figure out the re-orders, let us check out the re-order percentage in prior set and train set","8ef229ae":"Finally lets will combine the day of week and hour of day to see the reorder distribution with the help of a heatmap","5ab8a610":"# Data Visualisation","a9473b30":"From the graph we see that the items added to cart initially has high reorder ratio compared to the items added later on.","967af1d7":"Importing all files as Dataframe objects","95a7ba5e":"Now lets see the most bought items.","906e4567":"From the above graph we can see that there is a hike in the number of orders on the weekend i.e Saturday and Sunday, the least number of orders were done on Wednesday."}}