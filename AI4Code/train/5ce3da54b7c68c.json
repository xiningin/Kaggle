{"cell_type":{"b3d12457":"code","120114bc":"code","4d06c41b":"code","e8b59953":"code","53ff7f24":"code","7d7ca886":"code","eb0fed9b":"code","3e667875":"code","56780327":"code","495f7523":"code","c48361ce":"code","4eebe293":"code","7fd03cae":"code","a8fc3c6f":"code","4589da1e":"code","f36aa2d6":"code","1c4a3b6d":"code","0ee81b96":"code","785205a3":"code","d892e82d":"code","d1bfee6a":"code","01167a08":"code","f50868e7":"code","dcd0cd3b":"code","d10b8032":"code","ebc52964":"code","7f1341b6":"code","537065c7":"code","af722ecb":"code","e1a35593":"code","60d21d4a":"code","a83fcce4":"code","af364493":"code","b2a8d382":"code","c18de9ff":"code","54b35bdf":"markdown","940283f7":"markdown","025a48a5":"markdown","3dab01a3":"markdown","478d8851":"markdown","04b20a95":"markdown","d8a38ef3":"markdown","86c02ee2":"markdown","b537c08e":"markdown","f3b5c170":"markdown","048ecb7f":"markdown","12ee1806":"markdown","5556b7fd":"markdown","a3c5a733":"markdown","86a3e2b0":"markdown","cba0a868":"markdown","3b34ac8a":"markdown","9d474c0e":"markdown","3adc9bc9":"markdown","9323465f":"markdown","a583f306":"markdown","c4848927":"markdown","96f55e28":"markdown","e6aaa892":"markdown","4a7d1f4f":"markdown","7e9b5c8f":"markdown","1957f1f7":"markdown","1273bae9":"markdown","4793c2bc":"markdown","b182c97a":"markdown","04d1ad42":"markdown","f1966a6b":"markdown"},"source":{"b3d12457":"!pip install -q -U pip\n!pip install -q -U seaborn","120114bc":"import os\nimport ast\nimport random\n\nimport numpy as np\nimport pandas as pd\nimport cv2\nimport matplotlib.pyplot as plt\nfrom matplotlib_venn import venn2, venn3\nimport seaborn as sns","4d06c41b":"BASE_DIR = \"..\/input\/ranzcr-clip-catheter-line-classification\/\"\nprint(os.listdir(BASE_DIR))","e8b59953":"df_train = pd.read_csv(os.path.join(BASE_DIR, \"train.csv\"), index_col=0)\ndf_train.head()","53ff7f24":"plt.figure(figsize=(8, 8))\ndf_tmp = df_train.iloc[:, :-1].sum()\nsns.barplot(x=df_tmp.values, y=df_tmp.index)\nplt.xticks(fontsize=14)\nplt.yticks(fontsize=14)\nplt.xlabel(\"Number of images\", fontsize=15)\nplt.title(\"Distribution of labels\", fontsize=16);","7d7ca886":"print(\"Number of unique patients: \", df_train[\"PatientID\"].unique().shape[0])","eb0fed9b":"plt.figure(figsize=(16, 6))\ndf_tmp = df_train[\"PatientID\"].value_counts()\nsns.countplot(x=df_tmp.values)\nplt.xticks(fontsize=12, rotation=90)\nplt.yticks(fontsize=14)\nplt.xlabel(\"Number of observations\", fontsize=15)\nplt.ylabel(\"Number of patients\", fontsize=15)\nplt.title(\"Distribution of observations by PatientID\", fontsize=16);","3e667875":"df_annot = pd.read_csv(os.path.join(BASE_DIR, \"train_annotations.csv\"))\ndf_annot.head()","56780327":"def plot_image_with_annotations(row_ind):\n    row = df_annot.iloc[row_ind]\n    image_path = os.path.join(BASE_DIR, \"train\", row[\"StudyInstanceUID\"] + \".jpg\")\n    label = row[\"label\"]\n    data = np.array(ast.literal_eval(row[\"data\"]))\n    \n    plt.figure(figsize=(10, 5))\n    image = cv2.imread(image_path)\n    image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n    plt.subplot(1, 2, 1)\n    plt.imshow(image)\n    plt.subplot(1, 2, 2)\n    plt.imshow(image)\n    plt.scatter(data[:, 0], data[:, 1])\n    \n    plt.suptitle(label, fontsize=15)","495f7523":"plot_image_with_annotations(8)","c48361ce":"# from https:\/\/www.kaggle.com\/c\/ranzcr-clip-catheter-line-classification\/discussion\/203353#1117642\n\ndef visualize_annotations(file_id):\n    plt.figure(figsize=(8, 8))\n    \n    image = cv2.imread(os.path.join(BASE_DIR, \"train\", file_id + \".jpg\"))\n    image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n    plt.imshow(image)\n    \n    df_patient = df_annot.loc[df_annot[\"StudyInstanceUID\"] == file_id]\n    \n    if df_patient.shape[0]:        \n        labels = df_patient[\"label\"].values.tolist()\n        lines = df_patient[\"data\"].apply(ast.literal_eval).values.tolist()\n\n        for line, label in zip(lines, labels):         \n            line = np.asarray(line)\n            plt.scatter(line[:, 0], line[:, 1], s=40, label=label)\n        \n        plt.legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0, prop={'size': 20})\n        \n    plt.tick_params(axis=\"x\", labelsize=15)\n    plt.tick_params(axis=\"y\", labelsize=15)\n    \n    plt.show()","4eebe293":"image_ids = [\n    \"1.2.826.0.1.3680043.8.498.83331936392921199432218327504041001669\",\n    \"1.2.826.0.1.3680043.8.498.11693509889426445054876979814173446281\",\n    \"1.2.826.0.1.3680043.8.498.15159015355212130418020059688126994534\",\n    \"1.2.826.0.1.3680043.8.498.92067938763801985117661596637576203997\",\n]\n\nfor image_id in image_ids:\n    visualize_annotations(image_id)","7fd03cae":"def visualize_batch(image_ids):\n    plt.figure(figsize=(16, 10))\n    \n    for ind, image_id in enumerate(image_ids):\n        plt.subplot(2, 3, ind + 1)\n        image = cv2.imread(os.path.join(BASE_DIR, \"train\", f\"{image_id}.jpg\"))\n        image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n\n        plt.imshow(image)\n        plt.axis(\"off\")\n    \n    plt.show()\n\n    \ndef plot_statistics(df, col):\n    plt.figure(figsize=(16, 2))\n    sns.countplot(y=df[col])\n    \n    plt.xticks(fontsize=12)\n    plt.yticks(fontsize=12)\n    plt.xlabel(\"Number of observations\", fontsize=15)\n    plt.ylabel(col, fontsize=15)\n    plt.title(f\"Distribution of {col}\", fontsize=16);\n    \n    plt.show()\n#     \n#     \n#     \n    \n\ndef process_class(col_name):\n    plot_statistics(df_train, col_name)\n    tmp_df = df_train[df_train[col_name] == 1]\n    visualize_batch(random.sample(tmp_df.index.tolist(), 6))","a8fc3c6f":"process_class(\"ETT - Abnormal\")","4589da1e":"visualize_annotations(\"1.2.826.0.1.3680043.8.498.93345761486297843389996628528592497280\")","f36aa2d6":"process_class(\"ETT - Borderline\")","1c4a3b6d":"process_class(\"ETT - Normal\")","0ee81b96":"process_class(\"NGT - Abnormal\")","785205a3":"process_class(\"NGT - Borderline\")","d892e82d":"process_class(\"NGT - Incompletely Imaged\")","d1bfee6a":"process_class(\"NGT - Normal\")","01167a08":"process_class(\"CVC - Abnormal\")","f50868e7":"process_class(\"CVC - Borderline\")","dcd0cd3b":"process_class(\"CVC - Normal\")","d10b8032":"process_class(\"Swan Ganz Catheter Present\")","ebc52964":"def plot_venn2(col_1, col_2):\n    plt.figure(figsize=(6, 6))\n    \n    area_10 = df_train[col_1].sum()\n    area_01 = df_train[col_2].sum()\n    area_11 = df_train[(df_train[col_1] == 1) & (df_train[col_2] == 1)].shape[0]\n\n    venn2(\n        subsets=(area_10, area_01, area_11), \n        set_labels=(col_1, col_2),\n        alpha=0.5,\n    )","7f1341b6":"plot_venn2(\"ETT - Abnormal\", \"NGT - Abnormal\")","537065c7":"plot_venn2(\"ETT - Abnormal\", \"CVC - Abnormal\")","af722ecb":"plot_venn2(\"NGT - Abnormal\", \"CVC - Abnormal\")","e1a35593":"def plot_venn3(col_1, col_2, col_3):\n    plt.figure(figsize=(6, 6))\n    \n    area_100 = df_train[col_1].sum()\n    area_010 = df_train[col_2].sum()\n    area_110 = df_train[(df_train[col_1] == 1) & (df_train[col_2] == 1)].shape[0]\n    area_001 = df_train[col_3].sum()\n    area_101 = df_train[(df_train[col_1] == 1) & (df_train[col_3] == 1)].shape[0]\n    area_011 = df_train[(df_train[col_2] == 1) & (df_train[col_3] == 1)].shape[0]\n    area_111 = df_train[(df_train[col_1] == 1) & (df_train[col_2] == 1) & (df_train[col_3] == 1)].shape[0]\n\n#     print(area_100, area_010, area_110, area_001, area_101, area_011, area_111)\n\n    venn3(\n        subsets=(area_100, area_010, area_110, area_001, area_101, area_011, area_111), \n        set_labels=(col_1, col_2, col_3), \n        alpha=0.5\n    );","60d21d4a":"plot_venn3(\n    \"ETT - Abnormal\",\n    \"NGT - Abnormal\",\n    \"CVC - Abnormal\",\n)","a83fcce4":"plot_venn3(\n    \"ETT - Normal\",\n    \"NGT - Normal\",\n    \"CVC - Normal\",\n)","af364493":"plot_venn3(\n    \"ETT - Borderline\",\n    \"NGT - Borderline\",\n    \"CVC - Borderline\",\n)","b2a8d382":"df_submission = pd.read_csv(os.path.join(BASE_DIR, \"sample_submission.csv\"), index_col=0)\ndf_submission","c18de9ff":"df_submission.to_csv(\"submission.csv\")","54b35bdf":"**sample_submission.csv** - a sample submission file in the correct format","940283f7":"<a id=\"14\"><\/a>\n<h2 style='background:#6E848D; border:0; color:white'><center>Swan Ganz Catheter Present<center><h2>","025a48a5":"# RANZCR CLiP - Catheter and Line Position Challenge - Exploratory Data Analysis\n\nQuick Exploratory Data Analysis for [RANZCR CLiP - Catheter and Line Position Challenge](https:\/\/www.kaggle.com\/c\/ranzcr-clip-catheter-line-classification) challenge    \n\nIn this competition, you\u2019ll detect the presence and position of catheters and lines on chest x-rays. Use machine learning to train and test your model on 40,000 images to categorize a tube that is poorly placed.","3dab01a3":"<a id=\"9\"><\/a>\n<h2 style='background:#6E848D; border:0; color:white'><center>NGT - Incompletely Imaged<center><h2>","478d8851":"<a id=\"1\"><\/a>\n<h2 style='background:#6E848D; border:0; color:white'><center>Overview<center><h2>","04b20a95":"<a id=\"13\"><\/a>\n<h2 style='background:#6E848D; border:0; color:white'><center>CVC - Normal<center><h2>","d8a38ef3":"<a id=\"50\"><\/a>\n<h2 style='background:#6E848D; border:0; color:white'><center>Venn Diagrams<center><h2>","86c02ee2":"endotracheal tube placement normal","b537c08e":"<a id=\"10\"><\/a>\n<h2 style='background:#6E848D; border:0; color:white'><center>NGT - Normal<center><h2>","f3b5c170":"**StudyInstanceUID** - unique ID for each image   \n**ETT - Abnormal** - endotracheal tube placement abnormal   \n**ETT - Borderline** - endotracheal tube placement borderline abnormal   \n**ETT - Normal** - endotracheal tube placement normal   \n**NGT - Abnormal** - nasogastric tube placement abnormal   \n**NGT - Borderline** - nasogastric tube placement borderline abnormal   \n**NGT - Incompletely Imaged** - nasogastric tube placement inconclusive due to imaging   \n**NGT - Normal** - nasogastric tube placement borderline normal   \n**CVC - Abnormal** - central venous catheter placement abnormal   \n**CVC - Borderline** - central venous catheter placement borderline abnormal   \n**CVC - Normal** - central venous catheter placement normal   \n**Swan Ganz Catheter Present**   \n**PatientID** - unique ID for each patient in the dataset   ","048ecb7f":"nasogastric tube placement borderline abnormal","12ee1806":"central venous catheter placement borderline abnormal","5556b7fd":"<a id=\"100\"><\/a>\n<h2 style='background:#6E848D; border:0; color:white'><center>Submission<center><h2>","a3c5a733":"<a id=\"8\"><\/a>\n<h2 style='background:#6E848D; border:0; color:white'><center>NGT - Borderline<center><h2>","86a3e2b0":"nasogastric tube placement inconclusive due to imaging","cba0a868":"<a id=\"6\"><\/a>\n<h2 style='background:#6E848D; border:0; color:white'><center>ETT - Normal<center><h2>","3b34ac8a":"**train_annotations.csv** these are segmentation annotations for training samples that have them. They are included solely as additional information for competitors.","9d474c0e":"<a id=\"7\"><\/a>\n<h2 style='background:#6E848D; border:0; color:white'><center>NGT - Abnormal<center><h2>","3adc9bc9":"![](https:\/\/storage.googleapis.com\/kaggle-competitions\/kaggle\/23870\/logos\/header.png?t=2020-12-01-04-28-05)","9323465f":"central venous catheter placement abnormal","a583f306":"<a id=\"11\"><\/a>\n<h2 style='background:#6E848D; border:0; color:white'><center>CVC - Abnormal<center><h2>","c4848927":"<a id=\"12\"><\/a>\n<h2 style='background:#6E848D; border:0; color:white'><center>CVC - Borderline<center><h2>","96f55e28":"endotracheal tube placement borderline abnormal","e6aaa892":"nasogastric tube placement abnormal","4a7d1f4f":"<a id=\"4\"><\/a>\n<h2 style='background:#6E848D; border:0; color:white'><center>ETT - Abnormal<center><h2>","7e9b5c8f":"<a id=\"5\"><\/a>\n<h2 style='background:#6E848D; border:0; color:white'><center>ETT - Borderline<center><h2>","1957f1f7":"**train.csv** contains image IDs, binary labels, and patient IDs.","1273bae9":"nasogastric tube placement borderline normal","4793c2bc":"endotracheal tube placement abnormal","b182c97a":"central venous catheter placement normal","04d1ad42":"<a id=\"2\"><\/a>\n<h2 style='background:#6E848D; border:0; color:white'><center>Annotations<center><h2>","f1966a6b":"<a id=\"top\"><\/a>\n\n<div class=\"list-group\" id=\"list-tab\" role=\"tablist\">\n<h3 class=\"list-group-item list-group-item-action active\" data-toggle=\"list\" style='color:white; background:#6E848D; border:0' role=\"tab\" aria-controls=\"home\"><center>Quick Navigation<\/center><\/h3>\n\n* [Overview](#1)\n* [Annotations](#2)\n    \n    \n    \n* [ETT - Abnormal](#4)\n* [ETT - Borderline](#5)\n* [ETT - Normal](#6)\n* [NGT - Abnormal](#7)\n* [NGT - Borderline](#8)\n* [NGT - Incompletely Imaged](#9)\n* [NGT - Normal](#10)\n* [CVC - Abnormal](#11)\n* [CVC - Borderline](#12)\n* [CVC - Normal](#13)\n* [Swan Ganz Catheter Present](#14)\n    \n\n* [Venn Diagrams](#50)\n    \n    \n* [Submission](#100)"}}