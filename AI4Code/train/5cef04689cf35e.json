{"cell_type":{"0060cc4a":"code","5c92572a":"code","0fb2705b":"code","fd8f6316":"code","b7fbd78d":"code","6fd5bbf0":"code","9c9e75ac":"code","c94d3125":"code","228eb2c7":"code","63d52d43":"code","2dec1c9a":"code","21e38014":"code","6487140d":"code","5f2fe55f":"code","3bff4a52":"code","c7ebad4b":"code","84873fd4":"code","10b13642":"code","02bb6f77":"code","83bd7767":"markdown","e0eed825":"markdown","b4a7842a":"markdown","d76796df":"markdown","6333840d":"markdown","c716beaa":"markdown","9c6d56a3":"markdown","db9c7087":"markdown","47e2c677":"markdown","6e055c1f":"markdown"},"source":{"0060cc4a":"# import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport numpy as np\nfrom numpy import mean\n\ncolor = sns.color_palette()\nsns.set_style('darkgrid')\n\n\nfrom scipy import stats\nfrom scipy.stats import norm, skew\n\ndata = pd.read_csv('..\/input\/brasilian-houses-to-rent\/houses_to_rent_v2.csv')\ndata.head()\n","5c92572a":"data = data.rename(columns={\"hoa (R$)\":\"hoa\", \"rent amount (R$)\":\"rent amount\",\n                            \"property tax (R$)\": \"property tax\", \"fire insurance (R$)\":\"fire insurance\",\n                            \"total (R$)\":\"total price\"})\n\n\ndata['floor'].mask(data['floor'] == '-', '0', inplace=True)\ndata['floor'] = data['floor'].astype('int')\ndata.head()","0fb2705b":"print(data.isnull().sum())","fd8f6316":"fig, axs = plt.subplots(ncols=3, figsize=(15,5))\nsns.boxplot(x=data['area'], ax = axs[0])\nsns.boxplot(x=data['rent amount'], ax = axs[1])\nsns.boxplot(x=data['floor'], ax = axs[2])\nplt.show()","b7fbd78d":"Q1 = data.quantile(0.25)\nQ3 = data.quantile(0.75)\nIQR = Q3- Q1\nprint(IQR, data.shape)","6fd5bbf0":"data = data[~((data < (Q1 - 5*IQR)) | (data > (Q3 + 5*IQR))).any(axis=1)]\ndata.shape","9c9e75ac":"fig, axs = plt.subplots(ncols=3, figsize=(10,5))\nsns.boxplot(x=data['area'], ax = axs[0])\nsns.boxplot(x=data['rent amount'], ax = axs[1])\nsns.boxplot(x=data['floor'], ax = axs[2])\nplt.show()","c94d3125":"plt.figure(figsize=(20,10))\nc = data.corr()\nsns.heatmap(c,cmap='Blues', annot=True)","228eb2c7":"from numpy import mean\nplt.figure(figsize = (8,4))\nsns.barplot(data = data, x='city', y='rent amount', estimator=mean, palette = \"Blues\")\nplt.ylabel('Avg Rent Amount')\nplt.xlabel('')\nplt.title('Average Rent Amount by City')\nplt.legend('')\n\nplt.figure(figsize = (8,4))\nsns.barplot(x='city', y='rent amount', data = data, hue = 'animal', palette='Blues', estimator = mean)\nplt.ylabel('Avg Rent Amount')\nplt.title('Average Rent Amount by City and by Animal Acceptance')\n\nplt.figure(figsize = (8,4)) \nsns.barplot(x='parking spaces', y='rent amount', data = data, palette='Blues', estimator=mean)\nplt.ylabel('Avg Rent Amount')\nplt.title('Averace Rent Amount by n. of Parking Spaces')\nplt.show()\n\n","63d52d43":"data[\"city\"] = data[\"city\"].astype('category')\ndata[\"animal\"] = data[\"animal\"].astype('category')\ncleanup = {\"city\": {\"S\u00e3o Paulo\" : 1, \"Porto Alegre\" : 2, \"Rio de Janeiro\": 3, \"Campinas\":4, \"Belo Horizonte\":5},\n          \"animal\": {\"not acept\":0, \"acept\":1},\n          \"furniture\": {\"not furnished\":0, \"furnished\":1}}\ndata.replace(cleanup, inplace=True)\ndata.head()","2dec1c9a":"data = pd.get_dummies(data, columns=['city'])\ndata = data.drop(columns=['city_1'])","21e38014":"data = data[['city_2', 'city_3', 'city_4', 'city_5', 'area', 'rooms','bathroom', 'parking spaces', 'floor', 'furniture', 'hoa', 'property tax', 'fire insurance', 'total price', 'animal', 'rent amount']]\ndata.head()","6487140d":"col = ['city_2', 'city_3', 'city_4', 'city_5', 'area', 'rooms','bathroom', 'parking spaces', 'floor', 'furniture', 'hoa', 'property tax', 'total price', 'animal']\nsns.pairplot(data[col], size=2)\nplt.show","5f2fe55f":"data['RentAmountLog'] = np.log(data['rent amount'])\ndata = data.drop(columns=['total price', 'fire insurance'])\n\nfrom sklearn.model_selection import train_test_split\n\ntrain, test = train_test_split(data, test_size=0.2)","3bff4a52":"corr = train.corr().abs()\ncorr.RentAmountLog[corr.RentAmountLog >= 0.5].sort_values(ascending=False)","c7ebad4b":"plt.subplot2grid((2,1), (0,0))\ntrain['rent amount'].plot(kind='kde')\nplt.title('Rent Amount')\n\nplt.subplot2grid((2,1),(1,0))\ntrain['RentAmountLog'].plot(kind='kde')\nplt.title('Rent Amount Log')\n\nplt.subplots_adjust(hspace=0.5, wspace = 0.3)\nplt.show()\n\n\n","84873fd4":"y_train = train['RentAmountLog']\ny_test = test['RentAmountLog']\nx_train = train.drop(columns=['RentAmountLog', 'rent amount'])\nx_test = test.drop(columns=['RentAmountLog', 'rent amount'])","10b13642":"import xgboost\nfrom sklearn.metrics import mean_squared_error\n\nxgb = xgboost.XGBRegressor(min_child_weight=1.8, silent=1, colsample_bytree=0.8, subsample=1,\n                           learning_rate=0.01, max_depth=4, n_estimators=3000,\n                           reg_lambda=0.1, gamma = 0, silence=False, reg_alpha=0.1, nthr = -1 )\n\nxgb.fit(x_train, y_train)\ny_test_pred = xgb.predict(x_test)\n","02bb6f77":"RMSE = np.sqrt(mean_squared_error(y_test_pred, y_test))\nprint(RMSE.round(6))","83bd7767":"Let's check every column's type. \n- We changed floor type to integer(the ground floor is referred to as '-' so we change it to 0).\n- We change city and animal type to category so that we can convert them into dummy variables.\n- We convert city's names into numeric categories","e0eed825":"There is a strong correlation between: \n- fire insurance and rent amount\n- total price and rent amount\n- total price and fire insurance","b4a7842a":"Let's rename some columns to remove the currency info.","d76796df":"Zero missing values! Now let's search for outliers","6333840d":"# Correlation matrix\n","c716beaa":"# Brazilian Houses To Rent: XGBoost\n\nHi everyone! This is my first kernel, hope I didn't make mistakes. Be kind :)","9c6d56a3":"We convert 'city' into dummy variables.","db9c7087":"# A bunch of descriptive analysis\n1. Average rent amount by city\n2. Average rent amount by city and by animal acceptance\n3. Average rent amount by n. of parking spaces\n\n\n","47e2c677":"There are a lot of outliers, but some of them are really far from the third quartile! They could surely be a problem for a model. Let's remove them","6e055c1f":"\nLet's check if there are missing values.\n"}}