{"cell_type":{"446476de":"code","0c12f691":"code","fa1c709a":"code","f3d33462":"code","0bb59d24":"code","f45a9f40":"code","acd6cf29":"code","bfc2ab86":"code","2b09b633":"code","b16eb6d6":"code","139a1320":"code","b4b5f248":"code","19780562":"code","6422af44":"code","3286fab5":"code","00a165d2":"code","763f4274":"code","ea1cc603":"code","64518150":"code","84e67c08":"code","4abd6738":"code","6b7bb1cf":"code","f703948a":"code","672af549":"code","213dc14a":"code","64982fd2":"code","b309a5c1":"code","e67b94ac":"code","fec3123a":"code","b2d789f5":"code","aeb727d8":"code","f7cf0605":"code","17d7a135":"code","b0d865c2":"markdown"},"source":{"446476de":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","0c12f691":"!pip install torch torchvision feather-format kornia pyarrow --upgrade   > \/dev\/null\n!pip install git+https:\/\/github.com\/fastai\/fastai_dev                    > \/dev\/null","fa1c709a":"from fastai2.basics           import *\nfrom fastai2.vision.all       import *\nfrom fastai2.medical.imaging  import *\nfrom fastai2.callback.tracker import *\nfrom fastai2.callback.all     import *\n\nnp.set_printoptions(linewidth=120)\nmatplotlib.rcParams['image.cmap'] = 'bone'","f3d33462":"bs = 64","0bb59d24":"path = untar_data(URLs.PETS); path","f45a9f40":"path.ls()","acd6cf29":"path_anno = path\/'annotations'\npath_img = path\/'images'","bfc2ab86":"fnames = get_image_files(path_img)\nfnames[:5]\n","2b09b633":"np.random.seed(2)\npat = r'\/([^\/]+)_\\d+.jpg$'","b16eb6d6":"dbunch = ImageDataBunch.from_name_re(path, fnames, pat, item_tfms=RandomResizedCrop(460, min_scale=0.75), bs=bs,\n                                     batch_tfms=[*aug_transforms(size=224, max_warp=0), Normalize(*imagenet_stats)])","139a1320":"dbunch.show_batch(max_n=9, figsize=(10,10))","b4b5f248":"print(dbunch.vocab)\nlen(dbunch.vocab),dbunch.c","19780562":"learn = cnn_learner(dbunch, resnet34, metrics=error_rate).to_fp16()","6422af44":"learn.model","3286fab5":"learn.fit_one_cycle(4)","00a165d2":"learn.recorder.plot_loss()","763f4274":"learn.save('stage-1')","ea1cc603":"interp = ClassificationInterpretation.from_learner(learn)\n\nlosses,idxs = interp.top_losses()\n\nlen(dbunch.valid_ds)==len(losses)==len(idxs)","64518150":"interp.plot_top_losses(9, figsize=(15,11))","84e67c08":"interp.plot_confusion_matrix(figsize=(12,12), dpi=60)","4abd6738":"interp.most_confused(min_val=2)","6b7bb1cf":"learn.unfreeze()","f703948a":"learn.fit_one_cycle(1)","672af549":"learn.lr_find()","213dc14a":"learn.fit_one_cycle(2, lr_max = slice(1e-6, 1e-4))","64982fd2":"dbunch = ImageDataBunch.from_name_re(path_img, fnames, pat, item_tfms=RandomResizedCrop(460, min_scale=0.75), bs=bs\/\/2,\n                                     batch_tfms=[*aug_transforms(size=299, max_warp=0), Normalize(*imagenet_stats)])","b309a5c1":"learn = cnn_learner(dbunch, resnet50, metrics=error_rate).to_fp16()","e67b94ac":"learn.lr_find()","fec3123a":"learn.fit_one_cycle(8)","b2d789f5":"learn.save('stage-1-50')","aeb727d8":"learn.unfreeze()\nlearn.fit_one_cycle(3, lr_max=slice(1e-6,1e-4))","f7cf0605":"learn.load('stage-1-50');","17d7a135":"interp = ClassificationInterpretation.from_learner(learn)\ninterp.plot_confusion_matrix(figsize=(12,12), dpi=60)","b0d865c2":"# ResNet 50"}}