{"cell_type":{"2cd67322":"code","c69b4863":"code","ffa17b61":"code","1ea0adc3":"code","9f7e534b":"code","c4da0f0b":"code","95263599":"markdown"},"source":{"2cd67322":"import pandas as pd\nimport numpy as np\nfrom tqdm import tqdm \nfrom glob import glob\nfrom imp import reload\nimport copy as cp\nimport sys\nsys.path.append('..\/input\/features-util')\n# from utils import util\nimport util\nreload(util)\nimport joblib\n","c69b4863":"#%%\n\nimport os\nimport pandas as pd\nimport numpy as np\nimport lightgbm as lgb\nfrom tqdm import tqdm \nfrom glob import glob\nimport joblib\nfrom multiprocessing import Pool, cpu_count\nimport warnings\nwarnings.filterwarnings('ignore')\n\n#%%\n\ninput_dir = '..\/input\/optiver-realized-volatility-prediction'\nfeatures_name_dir='..\/input\/pdata1-features1'\noutput_dir = '.\/'\nmodel_dir = '..\/input\/pdata1-lgb-train'\n\n\n\n\npath_lst = glob(os.path.join(input_dir,'book_test.parquet\/*'))\nstock_lst = [os.path.basename(path).split('=')[-1] for path in path_lst]\n\n#%%\n\ndf_all_test =  util.gen_data_multi(stock_lst, data_type='test')\n\n\ntrain_df = pd.read_pickle(os.path.join(features_name_dir,'train_stock_df.pkl'))\nfeature_name=[col for col in train_df.columns.values.tolist() if col not in ['time_id', 'target']]\n# df_all_test=df_all_test.reset_index(drop=True)\ndf_all_test=df_all_test.replace([np.inf, -np.inf], np.nan).fillna(method='ffill')","ffa17b61":"features = train_df.columns.difference(['time_id', 'target']).tolist()\n# features","1ea0adc3":"df_all_test[feature_name]","9f7e534b":"y_preds = np.zeros(len(df_all_test))\nmodel_lst = glob(os.path.join(model_dir,'*model*.pkl'))\nfor i, model_path in tqdm(enumerate(model_lst)):\n    model = joblib.load(model_path)\n    y_preds += model.predict(df_all_test[features])\ny_preds \/= (len(model_lst))\n\n#%%\n\ndf_all_test['row_id'] = df_all_test['stock_id'].astype(str)+'-'+df_all_test['time_id'].astype(str)\ndf_all_test['target'] = y_preds\n\n#%%\n\nsubmit = df_all_test[['row_id','target']]\n\n#%%\n\nsubmit.to_csv('submission.csv',index = False)\n\n#%%\n\nsubmit.head(5)","c4da0f0b":"model_lst","95263599":"1. pdata1-features1:feature engineering https:\/\/www.kaggle.com\/quincyqiang\/pdata1-features1\n2. pdata1-lgb-train\uff1ahttps:\/\/www.kaggle.com\/quincyqiang\/pdata1-lgb-train\n2. pdata1-lgb-inference\uff1acurrent notebook"}}