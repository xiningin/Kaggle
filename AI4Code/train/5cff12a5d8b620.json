{"cell_type":{"bb8e3c50":"code","69a04870":"code","6982a4be":"code","efe86df7":"code","c1512fe2":"code","ab6b86db":"code","bceb50ca":"code","f718f351":"code","9dfb2dfd":"code","4a051c11":"code","efff2af8":"code","1c5cecb7":"code","03b602b8":"code","e22a57c5":"code","b7cca2f2":"code","e5e3a661":"code","c92f6676":"code","0e6aba2c":"code","b64442ca":"code","90cb01a7":"code","5e979d08":"code","81ebb4a6":"code","742aaca3":"code","906648cb":"code","3461f3cf":"code","344d1471":"code","b18bd4f3":"markdown","51b4ee4d":"markdown","d1e76498":"markdown","2dc6e492":"markdown","3de5d9c2":"markdown","891c4805":"markdown","04125aa0":"markdown","1bbd5020":"markdown","67b2e485":"markdown","ceba5835":"markdown","b2c1fa0b":"markdown","1c166f9e":"markdown","81e52297":"markdown","f8790f7c":"markdown","401641eb":"markdown","02c9e140":"markdown","bd3b3f67":"markdown","9bab06cc":"markdown","8927c948":"markdown","c4530cc1":"markdown","f97e011d":"markdown","69981ac1":"markdown"},"source":{"bb8e3c50":"import numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.ensemble import RandomForestClassifier, GradientBoostingClassifier\nfrom sklearn.svm import LinearSVC\nfrom sklearn.model_selection import KFold,StratifiedKFold, cross_val_score,GridSearchCV\nimport warnings\nwarnings.filterwarnings('ignore')\nsns.set_style('white')","69a04870":"train = pd.read_csv('..\/input\/titanic\/train.csv')\ntest = pd.read_csv('..\/input\/titanic\/test.csv')\ntrain.head()","6982a4be":"train.info()","efe86df7":"test.info()","c1512fe2":"colors = ['#D92938','#A60522','#273859','#071526']","ab6b86db":"print(\"Train: \")\nfor col in train.columns:\n    if train[col].isnull().values.any():\n        print(col, train[col].isnull().sum())\n      \nprint(\"\\nTest:\")\nfor col in test.columns:\n    if test[col].isnull().values.any():\n        print(col, test[col].isnull().sum())","bceb50ca":"#filling na values\ntrain['Cabin'] = train['Cabin'].fillna('U')\ntest['Cabin'] = test['Cabin'].fillna('U')\n\ntrain['Age'] = train['Age'].fillna( np.mean(train['Age']) )\ntest['Age'] = test['Age'].fillna( np.mean(test['Age']) )\n\ntrain['Fare'] = train['Fare'].fillna( np.mean(train['Fare']) )\ntest['Fare'] = test['Fare'].fillna( np.mean(test['Fare']) )","f718f351":"plt.figure(figsize=(10,5))\n\np = [train['Sex'].value_counts()[0]\/sum(train['Sex'].value_counts())*100,\n     train['Sex'].value_counts()[1]\/sum(train['Sex'].value_counts())*100]\n\ng=sns.barplot(x=p,y=['Male','Female'], palette=colors,orient = 'h')\n\ng.text(0, -0.7, 'Percentage of males and females on Titanic', \n       fontsize=14, fontweight='bold', fontfamily='Serif',color='black')\n\nfor i in ['top', 'left', 'right', 'bottom']:\n    g.spines[i].set_visible(False)\n    \nfor i in range(2):\n    g.annotate(f'{round(p[i])}%', \n                xy=(p[i]\/2, i),\n                ha = 'center', va='center',fontsize=50, fontweight='bold', \n                fontfamily='Serif', color='white')\n    g.annotate('Male' if i==0 else 'Female', \n                xy=(p[i]\/2, i+0.25),\n                ha = 'center', va='center',fontsize=16, fontweight='bold', \n                fontfamily='Serif', color='white')\n    \ng.set(xticklabels=[],yticklabels=[])\nplt.ylabel('')\nplt.xlabel('')","9dfb2dfd":"#boolean column for sex\ntrain[\"bool_sex\"] = (train[\"Sex\"] == \"male\").astype(int)\ntest[\"bool_sex\"] = (test[\"Sex\"] == \"male\").astype(int)","4a051c11":"plt.figure(figsize=(10,5))\n\np = [train['Survived'].value_counts()[0]\/sum(train['Survived'].value_counts())*100,\n     train['Survived'].value_counts()[1]\/sum(train['Survived'].value_counts())*100]\n\ng = sns.barplot(x=p, y=['Survived','Not Survived'],palette=colors)\n\ng.text(0, -0.7, 'Percentage of survivors and victims on Titanic', \n       fontsize=14, fontweight='bold', fontfamily='Serif',color='black')\n\nfor i in ['top', 'left', 'right', 'bottom']:\n    g.spines[i].set_visible(False)\n    \nfor i in range(2):\n    g.annotate(f'{round(p[i])}%', \n                xy=(p[i]\/2, i),\n                ha = 'center', va='center',fontsize=50, fontweight='bold', \n                fontfamily='Serif', color='white')\n    g.annotate('Survived' if i==0 else 'Not survived', \n                xy=(p[i]\/2, i+0.25),\n                ha = 'center', va='center',fontsize=16, fontweight='bold', \n                fontfamily='Serif', color='white')\n    \ng.set(xticklabels=[],yticklabels=[])\nplt.ylabel('')\nplt.xlabel('')","efff2af8":"fig, ax = plt.subplots(1,1, figsize=(10,5))\n\nd = train['Sex'].value_counts()\nd1 = train[ train['Sex'] == 'male' ]['Survived'].value_counts()\nd2 = train[ train['Sex'] == 'female' ]['Survived'].value_counts()\n\ng = plt.bar(d.index,d,label='Survived',color=colors[3])\ng1 = plt.bar(d.index, [d1[0],d2[0]],label='Not Survived',color=colors[1])\n\nax.text(0, 700, 'Amount of survivors and victims by Sex ', \n       fontsize=14, fontweight='bold', fontfamily='Serif',color='black')\n\nfor i in ['top', 'left', 'right']:\n    ax.spines[i].set_visible(False)\n    \nfor i in g1.patches:\n    ax.text(i.get_x()+i.get_width()\/2,\n           i.get_height()\/2.5,\n           round(i.get_height()),\n           fontsize='18',\n           fontfamily='Serif',\n           color='white',va='center',ha='center')\nc=0\nfor i in g.patches:\n    ax.text(i.get_x()+i.get_width()\/2,\n           g1.patches[c].get_height()+(i.get_height()-g1.patches[c].get_height())\/2.5,\n           round(i.get_height()-g1.patches[c].get_height()),\n           fontsize='18',\n           fontfamily='Serif',\n           color='white',va='center',ha='center')\n    c+=1\n    \nplt.legend(loc='upper right',prop={'size': 12, 'family': 'Serif'})\nax.set(xticklabels=['Male','Female'],yticklabels=[])\nplt.xlabel('')\nplt.ylabel('')","1c5cecb7":"fig, ax = plt.subplots(1, figsize=(10,5))\n\ng=plt.hist(train['Age'],color=colors[3])\n\nax.text(0, 430, 'Histogram of passengers age on Titanic', \n       fontsize=14, fontweight='bold', fontfamily='Serif',color='black')\n\nfor i in ax.patches:\n    ax.text(i.get_x()+i.get_width()\/2,\n           i.get_height()+6,\n           round(i.get_height()),\n           fontsize='13',\n           fontfamily='Serif',va='center',ha='center')\n    \nfor i in ['top', 'right','left']:\n    ax.spines[i].set_visible(False)\n\nax.set(yticklabels=[])\nplt.xlabel('')\nplt.ylabel('')","03b602b8":"train['Child'] = (train['Age'] <= 12).astype(int)\ntest['Child'] = (test['Age'] <= 12).astype(int)\n\ntrain['Young'] = train['Age'].apply(lambda x: x> 12 and x<=18).astype(int)\ntest['Young'] = test['Age'].apply(lambda x: x> 12 and x<=18).astype(int)\n\ntrain['Adult'] = train['Age'].apply(lambda x: x> 18 and x<=55).astype(int)\ntest['Adult'] = test['Age'].apply(lambda x: x> 18 and x<=55).astype(int)\n\ntrain['Old'] = train['Age'].apply(lambda x: x>55).astype(int)\ntest['Old'] = test['Age'].apply(lambda x: x>55).astype(int)","e22a57c5":"plt.figure(figsize=(10,5))\n\ng= sns.barplot(x=['Child','Young','Adult','Old'],\n               y=[sum(train['Child']),sum(train['Young']),\n               sum(train['Adult']),sum(train['Old'])],\n               palette=colors)\n\ng.text(0, 900,'Amount of passengers in each age group', \n       fontsize=14, fontweight='bold', fontfamily='Serif',color='black')\n\nfor i in ['top', 'left', 'right']:\n    g.spines[i].set_visible(False)\n    \nfor i in g.patches:\n    g.text(i.get_x()+i.get_width()\/2,\n           i.get_height()+25,\n           round(i.get_height()),\n           fontsize='18',\n           fontfamily='Serif',va='center',ha='center')\n    \ng.set(yticklabels=[])\nplt.ylabel('')\nplt.xlabel('')","b7cca2f2":"fig, ax = plt.subplots(1, figsize=(10,5))\n\ng=plt.hist(train['Fare'], color=colors[3])\n\nax.text(0, 850, 'Histogram of passengers fare on Titanic', \n       fontsize=14, fontweight='bold', fontfamily='Serif',color='black')\n\nfor i in ax.patches:\n    ax.text(i.get_x()+i.get_width()\/2,\n           i.get_height()+16,\n           round(i.get_height()),\n           fontsize='13',\n           fontfamily='Serif',va='center',ha='center')\n    \nfor i in ['top', 'right','left']:\n    ax.spines[i].set_visible(False)\n\nax.set(yticklabels=[])\nplt.xlabel('')\nplt.ylabel('')","e5e3a661":"train['cat_fare'] = train['Fare'].apply(lambda x: x>100)\ntest['cat_fare'] = test['Fare'].apply(lambda x: x>100)","c92f6676":"plt.figure(figsize=(10,5))\n\ng=sns.countplot(train['Embarked'],hue=train['Survived'],palette=colors[1:])\n\ng.text(0, 550,'Amount of survivors and victims in each port', \n       fontsize=14, fontweight='bold', fontfamily='Serif',color='black')\n\nfor i in ['top', 'left', 'right']:\n    g.spines[i].set_visible(False)\n    \nfor i in g.patches:\n    g.text(i.get_x()+i.get_width()\/2,\n           i.get_height()+16,\n           round(i.get_height()),\n           fontsize='18',\n           fontfamily='Serif',va='center',ha='center')\n    \ng.set(yticklabels=[])\nplt.legend(['Not Survived','Survived'],loc='upper right',prop={'size': 15, 'family': 'Serif'})\nplt.ylabel('')\nplt.xlabel('')","0e6aba2c":"def emb_feature(x):\n    if x=='S':\n        return 0\n    elif x=='C':\n        return 1\n    else:\n        return 2\ntrain['emb'] = train['Embarked'].apply(emb_feature)\ntest['emb'] = test['Embarked'].apply(emb_feature)\n","b64442ca":"plt.figure(figsize=(10,5))\n\ng=sns.countplot(train['Pclass'],hue=train['Survived'],palette=colors[1:])\n\n\ng.text(0, 500,'Amount of survivors and victims in each class', \n       fontsize=14, fontweight='bold', fontfamily='Serif',color='black')\n\nfor i in ['top', 'left', 'right']:\n    g.spines[i].set_visible(False)\n    \nfor i in g.patches:\n    g.text(i.get_x()+i.get_width()\/2,\n           i.get_height()+16,\n           round(i.get_height()),\n           fontsize='18',\n           fontfamily='Serif',va='center',ha='center')\n    \nplt.legend(['Not Survived','Survived'],loc='upper left',prop={'size': 15, 'family': 'Serif'})\ng.set(yticklabels=[])\nplt.ylabel('')\nplt.xlabel('')","90cb01a7":"train['is_alone'] = (train['SibSp']>0) | (train['Parch']>0)\ntest['is_alone'] = (test['SibSp']>0) | (test['Parch']>0)\n\ntrain['fml_size'] = train['SibSp'] + train['Parch'] \ntest['fml_size'] = test['SibSp'] + test['Parch'] ","5e979d08":"fig, ax = plt.subplots(1,1, figsize=(10,5))\n\nd = train['is_alone'].value_counts()\nd1 = train[ train['is_alone'] == 0 ]['Survived'].value_counts()\nd2 = train[ train['is_alone'] == 1 ]['Survived'].value_counts()\n\nd.index = ['Not alone', 'Alone']\ng = plt.bar(d.index,d,label='Survived',color=colors[3])\ng1 = plt.bar(d.index, [d1[0],d2[0]],label='Not Survived',color=colors[1])\n\nax.text(-0.35, 700, 'Amount of survivors and victims for passengers alone and not alone', \n       fontsize=14, fontweight='bold', fontfamily='Serif',color='black')\n\nfor i in ['top', 'left', 'right']:\n    ax.spines[i].set_visible(False)\n    \nfor i in g1.patches:\n    ax.text(i.get_x()+i.get_width()\/2,\n           i.get_height()\/2.5,\n           round(i.get_height()),\n           fontsize='18',\n           fontfamily='Serif',\n           color='white',va='center',ha='center')\nc=0\nfor i in g.patches:\n    ax.text(i.get_x()+i.get_width()\/2,\n           g1.patches[c].get_height()+(i.get_height()-g1.patches[c].get_height())\/2.5,\n           round(i.get_height()-g1.patches[c].get_height()),\n           fontsize='18',\n           fontfamily='Serif',\n           color='white',va='center',ha='center')\n    c+=1\n    \nplt.legend(loc='upper right',prop={'size': 12, 'family': 'Serif'})\nax.set(yticklabels=[])\nplt.xlabel('')\nplt.ylabel('')","81ebb4a6":"cols = ['Pclass','bool_sex','Child','Young','Adult','Old',\n        'fml_size','is_alone','cat_fare','emb','SibSp','Parch']\nSEED = 30\nX = train[cols]\ny = train['Survived']\n\ncv = StratifiedKFold(n_splits=5, shuffle=True)\n\nmodels = [ LogisticRegression(), LinearSVC(), RandomForestClassifier()]\nm_name = ['Logistic Regression', 'Linear SVC', 'Random Forest']\n\ni=0\nfor item in models:\n    np.random.seed(SEED)\n    results = cross_val_score(item, X, y, cv = cv,scoring = 'accuracy')\n    mean = results.mean()\n    dv = results.std()\n    print('Accuracy - {}: {:.2f}%'.format(m_name[i], mean*100))\n    print('Expected accuracy - Model {}: [{:.2f}% ~ {:.2f}%]\\n'.format(m_name[i],(mean - 2*dv)*100, (mean + 2*dv)*100))\n    i += 1","742aaca3":"# param_grid = { \n#     \"criterion\" : [\"gini\", \"entropy\"], \n#     \"min_samples_leaf\" : [1, 5, 10, 25, 50, 70], \n#     \"min_samples_split\" : [2, 4, 10, 12, 16, 18, 25, 35], \n#     \"n_estimators\": [100, 400, 700, 1000, 1500]\n# }\n# CV_rfc = GridSearchCV(estimator=RandomForestClassifier(), \n#                       param_grid=param_grid, \n#                       cv= 5)\n# CV_rfc.fit(X, y)\n\n# CV_rfc.best_params_","906648cb":"cols = ['Pclass','bool_sex','Child','Young','Adult','Old',\n        'fml_size','is_alone','cat_fare','emb','SibSp','Parch']\nX = train[cols]\ny = train['Survived']","3461f3cf":"model = RandomForestClassifier(\n     min_samples_leaf= 1,\n     min_samples_split= 4,\n     criterion= 'gini',\n     n_estimators= 100\n)\nmodel.fit(X,y)\np = model.predict(test[cols])","344d1471":"sub = pd.Series(p,index=test['PassengerId'],name='Survived')\nsub.to_csv('submission.csv',header=True)","b18bd4f3":"Clearly the sex of the passengers was crucial. The percentage of women surviving is much higher than that of men surviving, as we can see!","51b4ee4d":"New feature to use the embarked column information.","d1e76498":"Looking at the next chart it's possible to notice that most passengers are adults up to 50 years. It sounds like a good idea stratify the ages in groups to get better visualizations and maybe help in our model.","2dc6e492":"Random Forest is the best model in our validation. Now, we will do a hyperparameter tuning for the final model. \n\nThis block of code is commented because this cell may take a little while to run (~30 minutes).\n\n\n \n\n","3de5d9c2":"## EDA and some Feature Engineering","891c4805":"In the fare histogram we see that the absolute majority of tickets cost less than $ 100. However, we have some tickets that have exceeded that amount.\n\n","04125aa0":"Unfortunately we got a higher percentage of people who not Survived!","1bbd5020":"The data also tell us which port a particular passenger embarked on. In a chart that relates this information to the survived information, we realized that the only port in which the majority survived was port \"C\".","67b2e485":"Generating submission.","ceba5835":"Final model with tuned Random Forest Classifier.","b2c1fa0b":"## Missing values","1c166f9e":"## Model","81e52297":"## Imports","f8790f7c":"Now, we can see that our graph shows the information that passengers who were not alone died more than those who were.","401641eb":"## Titanic - Data Visualization and Predictions (Top 10% solution)\n\nThe purpose of this notebook was to create a simple solution to the Titanic problem and visualize its data and also a way to show how to structure the machine learning solution development process.\n\nIf you find it helpful, please upvote! :)","02c9e140":"Looking at the chart below, we can notice that we got a higher percentage of males on Titanic!","bd3b3f67":"## Validation\n","9bab06cc":"Looking at the Pclass column, most of the passengers in the first class survived, as we could imagine. The vast majority of passengers in the third class did not survive.\n\n","8927c948":"Looking again at the ages of our passengers, we can clearly see that we have a larger number of adults.\n\n","c4530cc1":"Knowing \"sibsp\" column counts the number of siblings\/spouses aboard the Titanic and \"parch\" counts the number of parents\/children aboard the Titanic I will create a new column to define whether the passenger is boarding alone or not.","f97e011d":"Categorizing Fare column in >100 or not.","69981ac1":"## Read data"}}