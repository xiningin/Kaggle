{"cell_type":{"1162e711":"code","ee4ed016":"code","be95aaf9":"code","ab0c7339":"code","0f0c48a9":"code","7459f7ac":"code","28c8b77a":"code","639ca1db":"code","98cddacf":"code","f8b8d1b1":"code","cb213f60":"code","11fca0d8":"code","68f2f2fe":"code","93452c9d":"code","894543a9":"code","223aa434":"code","336a7163":"markdown","1a9c00b7":"markdown","aab5954a":"markdown","f1588283":"markdown","f1e9c6de":"markdown","96e98863":"markdown","410ee8eb":"markdown","2a4b239c":"markdown"},"source":{"1162e711":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\nfrom tqdm import tqdm\nimport gc","ee4ed016":"train = pd.read_csv(\"\/kaggle\/input\/digit-recognizer\/train.csv\")\ntrain.head()","be95aaf9":"labeldict = dict(zip(train.index,train[\"label\"]))","ab0c7339":"train = train.iloc[:,1:]\ntrain.head()","0f0c48a9":"test = pd.read_csv(\"..\/input\/digit-recognizer\/test.csv\")\ntest","7459f7ac":"train = [s\/np.linalg.norm(s) for s in tqdm(train.values)]","28c8b77a":"test = [s\/np.linalg.norm(s) for s in tqdm(test.values)]","639ca1db":"%%time\n\nalldf = pd.DataFrame()\nallres = []\n\n# by reducing memory, divide 4 chunks\n\nfor a in tqdm(range(4)):\n    train2 = train[10500*a:10500*(a+1)]\n    cossim = np.matmul(train2,np.transpose(test))\n    cossim = [s.astype(\"float16\") for s in cossim]\n    allres.append(cossim)\n    \n    del train2,cossim\n    gc.collect()","98cddacf":"allres = np.concatenate(allres)","f8b8d1b1":"alldf = pd.DataFrame(allres)","cb213f60":"alldf = alldf.T","11fca0d8":"alldf","68f2f2fe":"simid = [s.argmax() for s in alldf.values]","93452c9d":"sample = pd.read_csv(\"..\/input\/digit-recognizer\/sample_submission.csv\")\nsample","894543a9":"sample[\"Label\"] = [labeldict[s] for s in simid]\nsample","223aa434":"sample.to_csv(\"submission.csv\",index=False)","336a7163":"## 6.1 convert similar train id to label","1a9c00b7":"### makedict","aab5954a":"# 1. Load data","f1588283":"# 4. Confirm cosine similarity result","f1e9c6de":"# 2. Normarization","96e98863":"# 6. submit","410ee8eb":"# 3. Calculate cosine similarity","2a4b239c":"# 5. calculate the most similar train image in each test image"}}