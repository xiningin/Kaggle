{"cell_type":{"cc3080a2":"code","5d77cd8c":"code","e90c1006":"code","d9534fd4":"code","29e786f8":"code","7ac6ec26":"code","d18c351f":"code","13267b00":"code","6c57aa11":"code","f3864778":"code","3bcc38e4":"code","ab8a421b":"code","15bd1aad":"code","511acf6f":"code","be3f996f":"markdown","33bb5784":"markdown","ed59524b":"markdown","9bb3ec3d":"markdown","753ae1a8":"markdown"},"source":{"cc3080a2":"%reload_ext autoreload\n%autoreload 2\n%matplotlib inline","5d77cd8c":"import os\nimport torch\nimport pandas as pd\n\nimport fastai\nimport dill\nfrom fastai.imports import *\nfrom fastai.vision import *\nfrom fastai.vision.all import *\nfrom fastai.metrics import error_rate, accuracy","e90c1006":"torch.cuda.get_device_name(0)","d9534fd4":"## Defining Directories\npath = Path('..\/input\/hotel-id-2021-fgvc8')\n\n## csv\nsample_sub = path\/'sample_submission.csv'\nlabels = path\/'train.csv'","29e786f8":"train_data = pd.read_csv(labels)\ntrain_data.head(5)","7ac6ec26":"train_dir= '.\/kaggle\/working\/train\/'\ntrain_data['label'] =  train_data['chain'].astype(str) + '\/' + train_data['image'].astype(str)\ntrain_data['image_path'] = train_dir + train_data['chain'].astype(str) + '\/' + train_data['image'].astype(str)\n\ntrain_data[:3]","d18c351f":"!tar xzvf \/kaggle\/input\/hotelid-224\/kaggle_hotelid_train_imgs_224x224.tgz","13267b00":"batch_size = 64\ndef create_dataLoader():\n    dataset = ImageDataLoaders.from_df(df = train_data[['image_path', 'chain']],\n                                   path = '.',\n                                   folder = '.',\n                                   valid_pct=0.2,\n                                   item_tfms=Resize(128),\n                                   batch_tfms=aug_transforms(),\n                                   bs=batch_size)\n    return dataset","6c57aa11":"dataset = create_dataLoader()","f3864778":"dataset.show_batch()","3bcc38e4":"def training_models(dataset, model_name):\n    learn = cnn_learner(dataset,  models.resnet101, \n                        metrics=[accuracy, top_k_accuracy], \n                        opt_func=QHAdam).to_fp16()\n    learn.fine_tune(12, 0.005, freeze_epochs=3)\n    return learn","ab8a421b":"%time\nmodel_name ='model_allData_rn101'\nlearn = training_models(dataset, model_name)","15bd1aad":"learn.export(f'{model_name}.pkl', pickle_module=dill)","511acf6f":"!rm -fr '.\/kaggle\/working\/train'","be3f996f":"## Folder Paths","33bb5784":"## Reading csv submission","ed59524b":"## Unzip resized Images","9bb3ec3d":"## Creating a model with the chain Id","753ae1a8":"Creating Labels and changing images to include the new paths"}}