{"cell_type":{"6d25b931":"code","22d4ce52":"code","fd934cf6":"code","231ab2fa":"code","3174387f":"code","13969a9d":"code","f745ad7b":"code","35acd219":"code","ba0146c6":"code","894340ed":"code","c1eaff4b":"code","4a00744f":"code","4b7c4f1a":"code","86680673":"code","cfaa05e9":"code","acd54d3b":"code","9912497a":"code","3945029b":"code","5f69aed9":"code","1c287690":"code","7f08e6e3":"code","6ee2a4b5":"code","d593ecbb":"code","0a9a6849":"code","2181592a":"code","bc236b71":"code","0d2b9a02":"code","14bdd756":"code","d6e1403f":"code","4a6ed209":"code","1c5b38a7":"code","5c811538":"code","dd58f6bd":"code","23d14968":"code","a492935a":"code","afc9b17f":"code","4464eb1b":"code","37916517":"markdown","a4ecac0f":"markdown","ad71cd8a":"markdown","b49d41cf":"markdown","cf1e06a6":"markdown","f185327e":"markdown","dbf68c01":"markdown","9f2e8f0a":"markdown","07ae3a73":"markdown","016d20ee":"markdown","5830a042":"markdown","f94a7fe0":"markdown","4cdd0505":"markdown","96e09f96":"markdown","394ef170":"markdown","c7445370":"markdown","2539cccb":"markdown","33894cee":"markdown","bcfab1e9":"markdown","350f5769":"markdown","94e060e6":"markdown","a7a59d24":"markdown","c73d7158":"markdown","e068a337":"markdown","9e122f91":"markdown","99c6295c":"markdown","1493735e":"markdown"},"source":{"6d25b931":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport plotly.express as px\nimport seaborn as sns\nsns.set_style(\"dark\")","22d4ce52":"df = pd.read_csv(\"..\/input\/hotel-booking-demand\/hotel_bookings.csv\")","fd934cf6":"df.info()","231ab2fa":"df.head(10)","3174387f":"df.describe()","13969a9d":"df.columns","f745ad7b":"df['hotel'].unique()","35acd219":"sns.countplot(data=df, x = 'hotel')","ba0146c6":"sns.countplot(data=df, x = 'is_canceled', hue='is_repeated_guest')","894340ed":"sns.countplot(data=df, x = 'hotel', hue='is_canceled')","c1eaff4b":"fig = plt.figure(figsize=(10,5), dpi = 100)\nsns.countplot(data=df, x = 'arrival_date_month')\nplt.xlabel('Month', fontsize=15)\nplt.xticks(rotation=45,fontsize=11);","4a00744f":"df['reserved_room_type'].unique()","4b7c4f1a":"data = df[df['is_canceled'] == 0]\nfig = plt.figure(figsize=(9,6), dpi = 100)\nsns.boxplot(data= data, x = 'reserved_room_type', y = 'adr', hue = 'hotel')","86680673":"sns.boxplot(data= df,x = 'is_canceled', y='adr')\nplt.ylim(0,600)\nprint(df['adr'].mean())","cfaa05e9":"df['country'].value_counts()\n","acd54d3b":"fig = plt.figure(figsize=(12,4), dpi=150)\n\n\ncountry_wise_guests = df[(df['is_canceled'] == 0)]['country'].value_counts().reset_index()\ncountry_wise_guests.columns = ['country', 'No of guests']\n\ncountry_wise_guests = country_wise_guests[country_wise_guests['No of guests'] > 60]\n\nsns.barplot(data=country_wise_guests, x = 'country', y = 'No of guests')\nplt.xticks(rotation=90,fontsize=11);","9912497a":"fig = plt.figure(figsize=(10,5),dpi=100)\n\nsns.lineplot(data=df, x= 'arrival_date_month', y = 'adr', hue='hotel',)\nplt.xticks(rotation=45,fontsize=10);","3945029b":"sns.countplot(data=df, x= 'market_segment')\nplt.xticks(rotation=45,fontsize=10);","5f69aed9":"sns.countplot(data=df, x= 'total_of_special_requests')","1c287690":"sns.countplot(data=df, x= 'total_of_special_requests', hue='is_canceled')","7f08e6e3":"df.isnull().sum()","6ee2a4b5":"df['agent'] = df['agent'].fillna(0)\ndf['children'] = df['children'].fillna(0)\ndf['country'] = df['country'].fillna('PRT')\ndf = df.drop('company', axis = 1)","d593ecbb":"df.isnull().sum()","0a9a6849":"useless_col = ['days_in_waiting_list', 'arrival_date_year', 'arrival_date_year', 'assigned_room_type', 'booking_changes',\n               'reservation_status', 'country', 'days_in_waiting_list']\n\ndf.drop(useless_col, axis = 1, inplace = True)","2181592a":"a = df.select_dtypes(object).columns\nfor i in a:\n    print (i, df[i].nunique())","bc236b71":"from sklearn.preprocessing import LabelEncoder\nle=LabelEncoder()\n\ndf['reservation_status_date'] = pd.to_datetime(df['reservation_status_date'])\n\ndf['year'] = df['reservation_status_date'].dt.year\ndf['month'] = df['reservation_status_date'].dt.month\ndf['day'] = df['reservation_status_date'].dt.day\n\ndf.drop(['reservation_status_date','arrival_date_month'] , axis = 1, inplace = True)","0d2b9a02":"a = df.select_dtypes(object).columns\ncat_list = []\nfor i in a:\n    print (i, df[i].nunique())\n    cat_list.append(i)","14bdd756":"for i in cat_list:\n    df[i] = le.fit_transform(df[i])\ndf['year'] = le.fit_transform(df['year'])\ndf['month'] = le.fit_transform(df['month'])\ndf['day'] = le.fit_transform(df['day'])","d6e1403f":"df.head()","4a6ed209":"from sklearn.model_selection import train_test_split\ny = df['is_canceled']\nX = df.drop('is_canceled', axis = 1)\nX_train, X_test, y_train, y_test = train_test_split(X,y,random_state=101,test_size=0.3)","1c5b38a7":"from sklearn.preprocessing import StandardScaler\nscaler = StandardScaler()\nX_train = scaler.fit_transform(X_train)\nX_test = scaler.transform(X_test)","5c811538":"from sklearn.tree import DecisionTreeClassifier\ndtc = DecisionTreeClassifier()\ndtc.fit(X_train, y_train)\n\ny_pred_dtc = dtc.predict(X_test)","dd58f6bd":"from sklearn.metrics import accuracy_score, confusion_matrix, classification_report\nacc_dtc = accuracy_score(y_test, y_pred_dtc)\nconf = confusion_matrix(y_test, y_pred_dtc)\nclf_report = classification_report(y_test, y_pred_dtc)\nacc_dtc","23d14968":"from sklearn.metrics import plot_confusion_matrix\nplot_confusion_matrix(dtc, X_test, y_test)","a492935a":"print(clf_report)","afc9b17f":"pd.DataFrame(index = X.columns, data = dtc.feature_importances_, \n             columns=['Feature Importance']).sort_values('Feature Importance', ascending = False)","4464eb1b":"from sklearn.tree import plot_tree\n\n\n\nplt.figure(figsize=(12,8), dpi=200)\n\npruned_dtc = DecisionTreeClassifier(max_depth=3)\npruned_dtc.fit(X_train, y_train)\ny_pred_dtc = pruned_dtc.predict(X_test)\n\nplot_tree(pruned_dtc, filled = True);","37916517":"**\u2705If my notebook helped you, please make sure to upvote.** \n","a4ecac0f":"#### we have passengers from diffrent countries and two hotels. Resort and City. According to https:\/\/www.sciencedirect.com\/science\/article\/pii\/S2352340918315191 both hotels are in Portugal. Our goal is to predict whether guests are going to cancel their trip or not. This can be really helpfull for hotels to predict the food and rooms.","ad71cd8a":"we can see that guests that aren't repeated guests canceled the trip which make sense.","b49d41cf":"<a id=\"eda\"><\/a>\n# EDA","cf1e06a6":"<a id=\"missing\"><\/a>\n**Missing Data**","f185327e":"Typically we would run a grid-search to test diffrent hyperparameters such min_samples_split, min_samples_leaf and etc, but since we are getting good results there no need for that.","dbf68c01":"#### This is the numbers of special requests. Now let's see its relationship with canselation.","9f2e8f0a":"Most of the guest are from Portugal wich is reasonable because both hotels are in PRT and that could give us a hint to fill out Country missing data with PRT later. Since there was 156 countries, I pickup ones with more than 60 guests so we can have a clear plot.","07ae3a73":"# Model Evaluation","016d20ee":"<a id=\"categorical\"><\/a>\n**Categorical Data**","5830a042":"# Train The Model","f94a7fe0":"According to our result, It's obvious that we can't use one hot encoding for most of our categorical features! because that would create a lot of columns and adds a lot of complexity to our model. Therefore we're going to use label encoding which you can use either Lable Encoder in sklearn or install label converter with pip. I prefer the first way.","4cdd0505":"Nearly half bookings without any special requests have been canceled and another half of them have not been canceledfig = px.pie(country_data,\n             values=\"Number of Guests\",\n             names=\"country\",\n             title=\"Home country of guests\",\n             template=\"seaborn\")","96e09f96":"![](https:\/\/www.rathbonehotel.co.uk\/app\/uploads\/fly-images\/945\/Rathbone-Hotel-Studio-Suite1-1730x730-c.jpg)","394ef170":"#### We all know in currect people use of technology are masively increased and we can see in the above plot that almost 50 percent of reservations are apply via Online Travel Agents.","c7445370":"<a id=\"model\"><\/a>\n# Train|Test Split","2539cccb":"#### The above plot shows that August was the busiest month and January was the least.","33894cee":"### [1. EDA](#eda) ###\n### [2. Data Preparation](#data) ###\n*           [Missing Data](#missing)\n*           [Categorical Data](#categorical)\n        \n### [3. Model training](#model)\n### [4. Evaluating our model](#evaluation)","bcfab1e9":"<a id=\"evaluation\"><\/a>\n# Evaluation","350f5769":"<a id=\"data\"><\/a>\n# Data Prepration","94e060e6":"Since the the relationship between our label and features was incomprehensive, in below data frame we will see which feature was more effective in our model","a7a59d24":"#### In general City Hotel has higher prices.\n#### This plot shows that in August which was the crowdest month, City hotel charge guests the most.","c73d7158":"let's just find the categorical features first:","e068a337":"Just to have a visualization of our tree I plot the tree below but since our features are too many, I set max_depth to 3 to get a smaller tree that we can see properly.","9e122f91":"# Feature Scaling","99c6295c":"Since missing data in Company feature is too much I prefered to drop the whole feature.","1493735e":"Decision Trees themeselves are prun to overfitting and we already know that there are many developments that expand of a Decision Tree model such as Random Forest or a Gradient Boosted tree to help expand the decision tree model as well as fix some its potential flaws. Those are more advanced tree base methods that are build of the Decision tree. Thus you don't a single Decision tree in more realistics problems."}}