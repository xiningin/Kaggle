{"cell_type":{"9f7e2e8c":"code","494a23f3":"code","5084aaba":"code","92587f80":"code","ba80b8bd":"code","8890cc33":"code","61748f21":"code","8a3beab8":"code","dd138c29":"code","a5934e9d":"code","e1750f8a":"code","5b36b40e":"code","a14a989d":"code","56682b92":"code","8d7c4028":"code","9e1ed047":"code","59d0b47e":"code","ae4959ec":"code","bebb91d6":"code","0712482a":"code","1af923a1":"code","0fea1b98":"code","d52de3f4":"code","ad44787d":"code","273663eb":"code","e5f42027":"code","32edf68b":"code","55c1ec87":"code","824078ab":"code","e32da48a":"code","d6438de6":"code","f2af7770":"code","abb1f8f7":"code","9ec6eb68":"code","97b9a1d2":"code","51cad1bf":"code","b474507a":"code","21640607":"code","b1748d5f":"code","2eb96b6a":"code","3ebf1eef":"code","9487c0a1":"code","a1a8d644":"code","d9a83f3f":"code","3c7c4f40":"code","a7ab4e62":"markdown","f25e31dd":"markdown","965b9850":"markdown","cf50481d":"markdown","e94f435e":"markdown","970bf21f":"markdown","74fb196a":"markdown","cc3e3d5d":"markdown","172ee850":"markdown","3d0499e5":"markdown","6d202356":"markdown","e8ce12c1":"markdown","7cb959dd":"markdown","d1cf3b33":"markdown","bf6b595f":"markdown","8a5cbc5f":"markdown","94b643b3":"markdown","5c06a21e":"markdown","ff0757e5":"markdown","b52fff42":"markdown","d26491a7":"markdown","ca2eb93a":"markdown","38c22dd9":"markdown","e76cafeb":"markdown","ecab8657":"markdown","b6398462":"markdown","f7b6b71a":"markdown","f1a5b51e":"markdown","4fca2c71":"markdown","259980a9":"markdown","68cf57e6":"markdown","1f6ad345":"markdown","6920d39f":"markdown","46bebfe2":"markdown","36c75f09":"markdown","bcb35636":"markdown","19e41f51":"markdown","4c8498ea":"markdown","368e72b4":"markdown"},"source":{"9f7e2e8c":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n        full_df = pd.read_csv(os.path.join(dirname, filename))\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","494a23f3":"full_df.head()","5084aaba":"print(full_df.info())","92587f80":"truncated_df = full_df.dropna()\ntruncated_df.head()","ba80b8bd":"%matplotlib inline  \n\n# some imports to set up plotting\nimport matplotlib.pyplot as plt\n# pip install seaborn\nimport seaborn as sns\n\n# Set Matplotlib defaults\nplt.style.use(\"seaborn-whitegrid\")\nplt.rc(\"figure\", autolayout=True, figsize=(11, 5))\nplt.rc(\n    \"axes\",\n    labelweight=\"bold\",\n    labelsize=\"large\",\n    titleweight=\"bold\",\n    titlesize=16,\n    titlepad=10,\n)\nplot_params = dict(\n    color=\"0.75\",\n    style=\".-\",\n    markeredgecolor=\"0.25\",\n    markerfacecolor=\"0.25\",\n    legend=False,\n)\n\n# Graphics in retina format are more sharp and legible\n%config InlineBackend.figure_format = 'retina'","8890cc33":"color_dict = {'LHS': 'peru', 'HSG': 'darkorange', 'CAD': 'olivedrab', 'BHD': 'teal', 'overall': 'grey'}\n### plotting Median Weekly Earnings ###\n# plt.plot(full_df['YEAR'], full_df['OVERALL WEEKLY MEDIAN EARNINGS (AGES 15 AND ABOVE)'],\n#          marker='o',linestyle='None', color=color_dict['overall'], label='overall')\nplt.plot(full_df['YEAR'], full_df['LHS MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'],\n         marker='o',linestyle='-.', color=color_dict['LHS'], label='LHS')\nplt.hlines(full_df['LHS MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].to_numpy()[19],\n           full_df['YEAR'].to_numpy()[19], full_df['YEAR'].to_numpy()[-1], \n           linestyle='-.', \n           color=color_dict['LHS'])\nplt.plot(full_df['YEAR'], full_df['HSG MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'],\n         marker='o',linestyle='-.', color=color_dict['HSG'], label='HSG')\nplt.hlines(full_df['HSG MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].to_numpy()[19],\n           full_df['YEAR'].to_numpy()[19], full_df['YEAR'].to_numpy()[-1], \n           linestyle='-.', \n           color=color_dict['HSG'])\nplt.plot(full_df['YEAR'], full_df['CAD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'],\n         marker='o',linestyle='-.', color=color_dict['CAD'], label='CAD')\nplt.hlines(full_df['CAD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].to_numpy()[19],\n           full_df['YEAR'].to_numpy()[19], full_df['YEAR'].to_numpy()[-1], \n           linestyle='-.', \n           color=color_dict['CAD'])\nplt.plot(full_df['YEAR'], full_df['BHD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'],\n         marker='o',linestyle='-.', color=color_dict['BHD'], label='BHD')\nplt.hlines(full_df['BHD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].to_numpy()[19],\n           full_df['YEAR'].to_numpy()[19], full_df['YEAR'].to_numpy()[-1], \n           linestyle='-.', \n           color=color_dict['BHD'])\n\n# plt.plot(full_df['YEAR'], full_df['OVERALL WEEKLY MEDIAN EARNINGS (AGES 15 AND ABOVE)'],\n#          marker='o',linestyle='None', color=color_dict['overall'], label='overall')\n\nplt.legend()\nplt.ylabel('Median Weekly Earnings (in 2020 dollars)')\nplt.xlabel('Year')\n# plt.show()\nplt.savefig('mwe_data.png', bbox_inches='tight')","61748f21":"### plotting the periodogram for Median Weekly Earnings ###\nfrom pathlib import Path\nfrom warnings import simplefilter\n\nimport seaborn as sns\nfrom sklearn.linear_model import LinearRegression\nfrom statsmodels.tsa.deterministic import CalendarFourier, DeterministicProcess\n\nsimplefilter(\"ignore\")\n\ndef plot_periodogram(ts, title_str=''):\n    from scipy.signal import periodogram\n    freqencies, spectrum = periodogram(\n        ts,\n        detrend='linear',\n        scaling='spectrum',\n    )\n    _, ax = plt.subplots()\n    ax.stem(freqencies, spectrum, linefmt='m-', markerfmt='mo' ) # color=\"purple\", ls='None', marker='o' \n#     ax.set_xscale(\"log\")\n    ax.set_xticks(np.arange(0.025, 0.5, 0.025))\n    ax.set_xticklabels([f'{xt:.3f}' for xt in np.arange(0.025, .5, 0.025)])\n    ax.set_xlabel('Frequency (Inverse Yrs)')\n    ax.set_ylabel('Power Spectral Density')\n    ax.set_title(f'Periodogram for {title_str}')\n#     return ax\n    plt.show()\n    \nplot_periodogram(full_df['LHS MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'][19:-10],\n                title_str='LHS MWE')\nplot_periodogram(full_df['HSG MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'][19:-10],\n                title_str='HSG MWE')\nplot_periodogram(full_df['CAD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'][19:-10],\n                title_str='CAD MWE')\nplot_periodogram(full_df['BHD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'][19:-10],\n                title_str='BHD MWE')\n","8a3beab8":"import collections\n\nimport tensorflow.compat.v2 as tf\nimport tensorflow_probability as tfp\n\nfrom tensorflow_probability import distributions as tfd\nfrom tensorflow_probability import sts\n\ntf.enable_v2_behavior()\n\ndef plot_forecast(x, y,\n                  forecast_mean, forecast_scale, forecast_samples,\n                  title):\n    colors = sns.color_palette()\n    c1, c2 = colors[0], colors[1]\n    fig = plt.figure(figsize=(12, 6))\n    ax = fig.add_subplot(1, 1, 1)\n\n    num_steps = len(y)\n    num_steps_forecast = forecast_mean.shape[-1]\n    num_steps_train = num_steps - num_steps_forecast\n        \n    ax.plot(x, y, lw=2, color=c1, label='ground truth')\n\n    forecast_steps = np.arange(\n      x[num_steps_train],\n      x[num_steps_train]+num_steps_forecast,\n      dtype=x.dtype)\n    \n    mape = 100.*np.mean(np.abs(forecast_mean - \n                         y[-num_steps_forecast:])\/y[-num_steps_forecast:])\n    print(f\"MAPE is {mape:.2f}%\")\n    ax.plot(forecast_steps, (forecast_samples.T), lw=1, color=c2, alpha=0.4)\n    \n    ax.plot(forecast_steps, forecast_mean, lw=2, ls='--', color=c2,\n           label='forecast')\n    ax.fill_between(forecast_steps,\n                   forecast_mean-2*forecast_scale,\n                   forecast_mean+2*forecast_scale, color=c2, alpha=0.2)\n\n    ymin, ymax = min(np.min(forecast_samples), np.min(y)), max(np.max(forecast_samples), np.max(y))\n    yrange = ymax-ymin\n    ax.set_ylim([ymin - yrange*0.1, ymax + yrange*0.1])\n    ax.set_title(\"{}\".format(title))\n    ax.legend()\n\n    return fig, ax\n\ndef plot_components(dates,\n                    component_means_dict,\n                    component_stddevs_dict):\n    colors = sns.color_palette()\n    c1, c2 = colors[0], colors[1]\n\n    axes_dict = collections.OrderedDict()\n    num_components = len(component_means_dict)\n    fig = plt.figure(figsize=(12, 2.5 * num_components))\n    for i, component_name in enumerate(component_means_dict.keys()):\n        component_mean = component_means_dict[component_name]\n        component_stddev = component_stddevs_dict[component_name]\n\n    ax = fig.add_subplot(num_components,1,1+i)\n    ax.plot(dates, component_mean, lw=2)\n    ax.fill_between(dates,\n                     component_mean-2*component_stddev,\n                     component_mean+2*component_stddev,\n                     color=c2, alpha=0.5)\n    ax.set_title(component_name)\n    axes_dict[component_name] = ax\n    fig.tight_layout()\n    return fig, axes_dict","dd138c29":"def build_linear_trend_model(observed_time_series):\n    semilocal_linear_trend = sts.SemiLocalLinearTrend(\n                                observed_time_series=observed_time_series,\n                                name='semilocal_linear_trend')    \n\n    model = sts.Sum([semilocal_linear_trend],\n                   observed_time_series=observed_time_series)\n\n    return model\n\ndef build_linear_trend_seasonal_model(observed_time_series, steps_per_season=1, \n                                     num_seasons=2):\n    semilocal_linear_trend = sts.SemiLocalLinearTrend(\n                                observed_time_series=observed_time_series,\n                                name='semilocal_linear_trend')    \n\n    seasonal_trend = sts.Seasonal(\n            num_seasons=num_seasons, num_steps_per_season=steps_per_season, \n            observed_time_series=observed_time_series)\n\n    model = sts.Sum([semilocal_linear_trend, seasonal_trend],\n                   observed_time_series=observed_time_series)\n\n    return model\n\ndef build_linear_trend_multiseason_model(observed_time_series, \n                                     steps_per_season_list=[1,1], \n                                     num_seasonal_trends=2,\n                                     num_seasons=2):\n    semilocal_linear_trend = sts.SemiLocalLinearTrend(\n                                observed_time_series=observed_time_series,\n                                name='semilocal_linear_trend')    \n\n    trend_list = [semilocal_linear_trend]\n    for i in range(num_seasonal_trends):\n        trend_list.append(sts.Seasonal(\n                num_seasons=num_seasons, \n                num_steps_per_season=steps_per_season_list[i], \n                observed_time_series=observed_time_series,\n                name=f'seasonal_trend_{i}'))\n                \n    model = sts.Sum(trend_list,\n                   observed_time_series=observed_time_series)\n\n    return model\n\ndef fit_model_generate_forecast(model, train_time_series, num_forecast_steps, \n                                num_variational_steps=200):\n# Build the variational surrogate posteriors `qs`.\n    np.random.seed(101)\n    high = np.iinfo(np.int32).max\n    seed = np.random.randint(high)\n    variational_posteriors = tfp.sts.build_factored_surrogate_posterior(model=model, \n                                                                        seed=seed)\n\n# Build and optimize the variational loss function.\n    elbo_loss_curve = tfp.vi.fit_surrogate_posterior(\n        target_log_prob_fn=model.joint_log_prob(\n            observed_time_series=train_time_series),\n        surrogate_posterior=variational_posteriors,\n        optimizer=tf.optimizers.Adam(learning_rate=0.1),\n        num_steps=num_variational_steps,\n        jit_compile=True, seed=seed)\n    plt.plot(elbo_loss_curve)\n    plt.show()\n\n    q_samples_ = variational_posteriors.sample(100)\n    forecast_dist = tfp.sts.forecast(\n        model=model,\n        observed_time_series=train_time_series,\n        parameter_samples=q_samples_,\n        num_steps_forecast=num_forecast_steps)\n    \n    return (variational_posteriors, forecast_dist)\n\ndef print_fit_params(variational_posteriors, model):\n        # # Draw samples from the variational posterior.\n    q_samples_ = variational_posteriors.sample(100)\n\n    print(\"Inferred parameters:\")\n    for param in model.parameters:\n      print(\"{}: {} +- {}\".format(param.name,\n                                  np.mean(q_samples_[param.name], axis=0),\n                                  np.std(q_samples_[param.name], axis=0)))\n\ndef plot_forecast_results(forecast_dist, x_axis_data, train_data, title_str, \n                          num_samples=10):\n    (\n        forecast_mean,\n        forecast_scale,\n        forecast_samples\n    ) = (\n        forecast_dist.mean().numpy()[..., 0],\n        forecast_dist.stddev().numpy()[..., 0],\n        forecast_dist.sample(num_samples).numpy()[..., 0]\n        )\n\n    fig, ax = plot_forecast(x_axis_data, train_data,\n                        forecast_mean,\n                        forecast_scale,\n                        forecast_samples,\n                        title=title_str)\n    \n    \n    fig.tight_layout()\n    plt.show()\n    \n#### Functions for generating forecasts from predefined models \n#### and variational posteriors\n\ndef generate_forecast(model, var_post, observed_time_series, num_forecast_steps):\n    q_samples_ = var_post.sample(100)\n    forecast_dist = tfp.sts.forecast(\n        model=model,\n        observed_time_series=observed_time_series,\n        parameter_samples=q_samples_,\n        num_steps_forecast=num_forecast_steps)\n    forecast_mean = forecast_dist.mean().numpy()[..., 0]\n    \n    return (forecast_mean, forecast_dist)\n\ndef plot_forecast_future(forecast_dist, x, y, title_str, \n                          num_samples=10):\n    (\n        forecast_mean,\n        forecast_scale,\n        forecast_samples\n    ) = (\n        forecast_dist.mean().numpy()[..., 0],\n        forecast_dist.stddev().numpy()[..., 0],\n        forecast_dist.sample(num_samples).numpy()[..., 0]\n        )\n\n    colors = sns.color_palette()\n    c1, c2 = colors[0], colors[1]\n    fig = plt.figure(figsize=(12, 6))\n    ax = fig.add_subplot(1, 1, 1)\n\n    num_steps_train = len(y)\n    num_steps_forecast = forecast_mean.shape[-1]\n\n    ax.plot(x[:num_steps_train], y, lw=2, color=c1, label='observed')\n\n    forecast_steps = np.arange(\n      x[num_steps_train],\n      x[num_steps_train]+num_steps_forecast,\n      dtype=x.dtype)\n    \n    ax.plot(forecast_steps, (forecast_samples.T), lw=1, color=c2, alpha=0.4)\n    \n    ax.plot(forecast_steps, forecast_mean, lw=2, ls='--', color=c2,\n           label='forecast')\n    ax.plot(x[num_steps_train-1:num_steps_train+1], np.array([y[-1],forecast_mean[0]]), \n            lw=2, ls='--', color=c1)\n    \n    ax.fill_between(forecast_steps,\n                   forecast_mean-2*forecast_scale,\n                   forecast_mean+2*forecast_scale, color=c2, alpha=0.2)\n\n    ymin, ymax = min(np.min(forecast_samples), np.min(y)), max(np.max(forecast_samples), np.max(y))\n    yrange = ymax-ymin\n    ax.set_ylim([ymin - yrange*0.1, ymax + yrange*0.1])\n    ax.set_title(\"{}\".format(title_str))\n    ax.legend()\n    \n    fig.tight_layout()\n    plt.show()","a5934e9d":"### defining the series variables ###\nlhs_mwe_full = (full_df['LHS MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].dropna()\n               ).to_numpy()\nhsg_mwe_full = (full_df['HSG MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].dropna()\n               ).to_numpy()\ncad_mwe_full = (full_df['CAD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].dropna()\n               ).to_numpy()\nbhd_mwe_full = (full_df['BHD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].dropna()\n               ).to_numpy()\nfull_mwe_years = (full_df['YEAR'].to_numpy())[-lhs_mwe_full.size:]\n\n\nlhs_mwe_trunc = truncated_df['LHS MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].to_numpy()\nhsg_mwe_trunc = truncated_df['HSG MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].to_numpy()\ncad_mwe_trunc = truncated_df['CAD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].to_numpy()\nbhd_mwe_trunc = truncated_df['BHD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].to_numpy()","e1750f8a":"num_forecast_steps = 10\n### LHS MWE ###\nlhs_mwe_model = build_linear_trend_seasonal_model(lhs_mwe_full[:-num_forecast_steps],\n                                                steps_per_season=5, num_seasons=2)\n(lhs_mwe_var_post, \n lhs_mwe_forecast_dist) = fit_model_generate_forecast(lhs_mwe_model, \n                        lhs_mwe_full[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(lhs_mwe_forecast_dist, full_mwe_years, lhs_mwe_full, \n                      'LHS MWE', num_samples=10)\n\n### HSG MWE ###\nhsg_mwe_model = build_linear_trend_seasonal_model(hsg_mwe_full[:-num_forecast_steps],\n                                                steps_per_season=8, num_seasons=2)\n(hsg_mwe_var_post, \n hsg_mwe_forecast_dist) = fit_model_generate_forecast(hsg_mwe_model, \n                        hsg_mwe_full[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(hsg_mwe_forecast_dist, full_mwe_years, hsg_mwe_full, \n                      'HSG MWE', num_samples=10)\n\n### CAD MWE ###\ncad_mwe_model = build_linear_trend_seasonal_model(cad_mwe_full[:-num_forecast_steps],\n                                                steps_per_season=8, num_seasons=2)\n(cad_mwe_var_post, \n cad_mwe_forecast_dist) = fit_model_generate_forecast(cad_mwe_model, \n                        cad_mwe_full[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(cad_mwe_forecast_dist, full_mwe_years, cad_mwe_full, \n                      'CAD MWE', num_samples=10)\n\n### BHD MWE ###\nbhd_mwe_model = build_linear_trend_seasonal_model(bhd_mwe_full[:-num_forecast_steps],\n                                                steps_per_season=5, num_seasons=2)\n(bhd_mwe_var_post, \n bhd_mwe_forecast_dist) = fit_model_generate_forecast(bhd_mwe_model, \n                        bhd_mwe_full[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(bhd_mwe_forecast_dist, full_mwe_years, bhd_mwe_full, \n                      'BHD MWE', num_samples=10)","5b36b40e":"#### METHOD (I) ####\nforecast_years = np.array(range(2021,2031))\nmwe_forecast_yrs = np.hstack((full_mwe_years, forecast_years))\nnum_forecast_steps = 10\nnum_samples = 10\n\nlhs_mwe_mean, lhs_mwe_dist = generate_forecast(lhs_mwe_model, \n                                                       lhs_mwe_var_post,\n                                                       lhs_mwe_full,\n                                                       num_forecast_steps)\nplot_forecast_future(lhs_mwe_dist, mwe_forecast_yrs, lhs_mwe_full, \n                     'LHS Median Weekly Earnings')\n(\n    lhs_mwe_forecast_mean,\n    lhs_mwe_forecast_scale,\n    lhs_mwe_forecast_samples\n) = (\n    lhs_mwe_dist.mean().numpy()[..., 0],\n    lhs_mwe_dist.stddev().numpy()[..., 0],\n    lhs_mwe_dist.sample(num_samples).numpy()[..., 0]\n    )\n\nhsg_mwe_mean, hsg_mwe_dist = generate_forecast(hsg_mwe_model, \n                                                       hsg_mwe_var_post,\n                                                       hsg_mwe_full,\n                                                       num_forecast_steps)\nplot_forecast_future(hsg_mwe_dist, mwe_forecast_yrs, hsg_mwe_full, \n                     'HSG Median Weekly Earnings')\n(\n    hsg_mwe_forecast_mean,\n    hsg_mwe_forecast_scale,\n    hsg_mwe_forecast_samples\n) = (\n    hsg_mwe_dist.mean().numpy()[..., 0],\n    hsg_mwe_dist.stddev().numpy()[..., 0],\n    hsg_mwe_dist.sample(num_samples).numpy()[..., 0]\n    )\n\ncad_mwe_mean, cad_mwe_dist = generate_forecast(cad_mwe_model, \n                                                       cad_mwe_var_post,\n                                                       cad_mwe_full,\n                                                       num_forecast_steps)\nplot_forecast_future(cad_mwe_dist, mwe_forecast_yrs, cad_mwe_full, \n                     'CAD Median Weekly Earnings')\n(\n    cad_mwe_forecast_mean,\n    cad_mwe_forecast_scale,\n    cad_mwe_forecast_samples\n) = (\n    cad_mwe_dist.mean().numpy()[..., 0],\n    cad_mwe_dist.stddev().numpy()[..., 0],\n    cad_mwe_dist.sample(num_samples).numpy()[..., 0]\n    )\n\nbhd_mwe_mean, bhd_mwe_dist = generate_forecast(bhd_mwe_model, \n                                                       bhd_mwe_var_post,\n                                                       bhd_mwe_full,\n                                                       num_forecast_steps)\nplot_forecast_future(bhd_mwe_dist, mwe_forecast_yrs, bhd_mwe_full, \n                     'BHD Median Weekly Earnings')\n(\n    bhd_mwe_forecast_mean,\n    bhd_mwe_forecast_scale,\n    bhd_mwe_forecast_samples\n) = (\n    bhd_mwe_dist.mean().numpy()[..., 0],\n    bhd_mwe_dist.stddev().numpy()[..., 0],\n    bhd_mwe_dist.sample(num_samples).numpy()[..., 0]\n    )\n\ncolor_dict = {'LHS': 'peru', 'HSG': 'darkorange', 'CAD': 'olivedrab', 'BHD': 'teal', 'overall': 'grey'}\n### plotting Median Weekly Earnings forecasts together ###\nplt.plot(full_df['YEAR'], full_df['LHS MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'],\n         marker='o',linestyle=':', color=color_dict['LHS'], label='LHS')\nplt.hlines(full_df['LHS MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].to_numpy()[19],\n           full_df['YEAR'].to_numpy()[19], mwe_forecast_yrs[-1], linestyle='-.', \n           color=color_dict['LHS'])\nplt.plot(forecast_years, \n         (lhs_mwe_forecast_samples.T), lw=1, color=color_dict['LHS'], alpha=0.4)\nplt.plot(forecast_years, lhs_mwe_forecast_mean, lw=2, ls='--', \n         color=color_dict['LHS'])\nplt.fill_between(forecast_years,\n               lhs_mwe_forecast_mean-2*lhs_mwe_forecast_scale,\n               lhs_mwe_forecast_mean+2*lhs_mwe_forecast_scale, \n                 color=color_dict['LHS'], alpha=0.2)\n\n\nplt.plot(full_df['YEAR'], full_df['HSG MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'],\n         marker='o',linestyle=':', color=color_dict['HSG'], label='HSG')\nplt.hlines(full_df['HSG MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].to_numpy()[19],\n           full_df['YEAR'].to_numpy()[19], mwe_forecast_yrs[-1], linestyle='-.', \n           color=color_dict['HSG'])\nplt.plot(forecast_years, \n         (hsg_mwe_forecast_samples.T), lw=1, color=color_dict['HSG'], alpha=0.4)\nplt.plot(forecast_years, hsg_mwe_forecast_mean, lw=2, ls='--', \n         color=color_dict['HSG'])\nplt.fill_between(forecast_years,\n               hsg_mwe_forecast_mean-2*hsg_mwe_forecast_scale,\n               hsg_mwe_forecast_mean+2*hsg_mwe_forecast_scale, \n                 color=color_dict['HSG'], alpha=0.2)\n\n\nplt.plot(full_df['YEAR'], full_df['CAD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'],\n         marker='o',linestyle=':', color=color_dict['CAD'], label='CAD')\nplt.hlines(full_df['CAD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].to_numpy()[19],\n           full_df['YEAR'].to_numpy()[19], mwe_forecast_yrs[-1], linestyle='-.', \n           color=color_dict['CAD'])\nplt.plot(forecast_years, \n         (cad_mwe_forecast_samples.T), lw=1, color=color_dict['CAD'], alpha=0.4)\nplt.plot(forecast_years, cad_mwe_forecast_mean, lw=2, ls='--', \n         color=color_dict['CAD'])\nplt.fill_between(forecast_years,\n               cad_mwe_forecast_mean-2*cad_mwe_forecast_scale,\n               cad_mwe_forecast_mean+2*cad_mwe_forecast_scale, \n                 color=color_dict['CAD'], alpha=0.2)\n\n\nplt.plot(full_df['YEAR'], full_df['BHD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'],\n         marker='o',linestyle=':', color=color_dict['BHD'], label='BHD')\nplt.hlines(full_df['BHD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].to_numpy()[19],\n           full_df['YEAR'].to_numpy()[19], mwe_forecast_yrs[-1], linestyle='-.', \n           color=color_dict['BHD'])\nplt.plot(forecast_years, \n         (bhd_mwe_forecast_samples.T), lw=1, color=color_dict['BHD'], alpha=0.4)\nplt.plot(forecast_years, bhd_mwe_forecast_mean, lw=2, ls='--', \n         color=color_dict['BHD'])\nplt.fill_between(forecast_years,\n               bhd_mwe_forecast_mean-2*bhd_mwe_forecast_scale,\n               bhd_mwe_forecast_mean+2*bhd_mwe_forecast_scale, \n                 color=color_dict['BHD'], alpha=0.2)\nplt.legend()\nplt.ylabel('Median Weekly Earnings (in 2020 dollars)')\nplt.xlabel('Year')\nplt.savefig('mwe_historical_forecast.png', bbox_inches='tight')\nplt.show()","a14a989d":"plt.plot(full_df['YEAR'], full_df['OVERALL PERCENT HSG'],          \n         marker='o',linestyle=':', color=color_dict['overall'], label='overall HSG')\nplt.plot(full_df['YEAR'], full_df['OVERALL PERCENT BHD'],          \n         marker='o',linestyle=':', color='c', label='overall BHD')\nplt.legend()\nplt.ylabel('Population Level Percentages')\nplt.xlabel('Year')\nplt.savefig('hsg_bhd_percent_data.png', bbox_inches='tight')\nplt.show()\n\n### plotting Labor Force Levels ###\nplt.plot(truncated_df['YEAR'], truncated_df['LHS LABOR FORCE LEVEL (IN THOUSANDS)'],\n         marker='o',linestyle=':', color=color_dict['LHS'], label='LHS')\nplt.plot(truncated_df['YEAR'], truncated_df['HSG LABOR FORCE LEVEL (IN THOUSANDS)'],\n         marker='o',linestyle=':', color=color_dict['HSG'], label='HSG')\nplt.plot(truncated_df['YEAR'], truncated_df['CAD LABOR FORCE LEVEL (IN THOUSANDS)'],\n         marker='o',linestyle=':', color=color_dict['CAD'], label='CAD')\nplt.plot(truncated_df['YEAR'], truncated_df['BHD LABOR FORCE LEVEL (IN THOUSANDS)'],\n         marker='o',linestyle=':', color=color_dict['BHD'], label='BHD')\nplt.plot(full_df['YEAR'], full_df['OVERALL LABOR FORCE LEVEL (IN THOUSANDS)']\/4.,\n         marker='o',linestyle=':', color=color_dict['overall'], label='overall\/4')\nplt.legend()\nplt.ylabel('Labor Force Level (in Thousands)')\nplt.xlabel('Year')\nplt.savefig('lf_level_data.png', bbox_inches='tight')\nplt.show()\n\n### plotting Labor Force Participation Rates ###\nplt.plot(truncated_df['YEAR'], truncated_df['LHS LABOR FORCE PARTICIPATION RATE (IN PERCENT)'],\n         marker='o',linestyle=':', color=color_dict['LHS'], label='LHS')\nplt.plot(truncated_df['YEAR'], truncated_df['HSG LABOR FORCE PARTICIPATION RATE (IN PERCENT)'],\n         marker='o',linestyle=':', color=color_dict['HSG'], label='HSG')\nplt.plot(truncated_df['YEAR'], truncated_df['CAD LABOR FORCE PARTICIPATION RATE (IN PERCENT)'],\n         marker='o',linestyle=':', color=color_dict['CAD'], label='CAD')\nplt.plot(truncated_df['YEAR'], truncated_df['BHD LABOR FORCE PARTICIPATION RATE (IN PERCENT)'],\n         marker='o',linestyle=':', color=color_dict['BHD'], label='BHD')\nplt.plot(full_df['YEAR'], full_df['OVERALL LABOR FORCE PARTICIPATION RATE (IN PERCENT)'],\n         marker='o',linestyle=':', color=color_dict['overall'], label='overall')\nplt.legend()\nplt.xlabel('Year')\nplt.ylabel('Labor Force Participation Rate (in Percent)')\nplt.savefig('lf_pr_data.png', bbox_inches='tight')\nplt.show()\n\n### plotting Employment Levels ###\nplt.plot(truncated_df['YEAR'], truncated_df['LHS EMPLOYMENT LEVEL (IN THOUSANDS)'],\n         marker='o',linestyle=':', color=color_dict['LHS'], label='LHS')\nplt.plot(truncated_df['YEAR'], truncated_df['HSG EMPLOYMENT LEVEL (IN THOUSANDS)'],\n         marker='o',linestyle=':', color=color_dict['HSG'], label='HSG')\nplt.plot(truncated_df['YEAR'], truncated_df['CAD EMPLOYMENT LEVEL (IN THOUSANDS)'],\n         marker='o',linestyle=':', color=color_dict['CAD'], label='CAD')\nplt.plot(truncated_df['YEAR'], truncated_df['BHD EMPLOYMENT LEVEL (IN THOUSANDS)'],\n         marker='o',linestyle=':', color=color_dict['BHD'], label='BHD')\nplt.plot(full_df['YEAR'], full_df['OVERALL EMPLOYMENT LEVEL (IN THOUSANDS)']\/4.,\n         marker='o',linestyle=':', color=color_dict['overall'], label='overall\/4')\nplt.legend()\nplt.ylabel('Employment Level (in Thousands)')\nplt.xlabel('Year')\nplt.savefig('emp_level_data.png', bbox_inches='tight')\nplt.show()","56682b92":"### Since overall_hsg_percent and overall_bhd_percent are missing data \n### for the years 1961 and 1963, we will begin by filling in those values with the\n### average of the preceding and succeeding values.\nfull_df['OVERALL PERCENT HSG'][1] = (full_df['OVERALL PERCENT HSG'][0]+\n                                     full_df['OVERALL PERCENT HSG'][2])\/2.\nfull_df['OVERALL PERCENT HSG'][3] = (full_df['OVERALL PERCENT HSG'][2]+\n                                     full_df['OVERALL PERCENT HSG'][4])\/2.\n\nfull_df['OVERALL PERCENT BHD'][1] = (full_df['OVERALL PERCENT BHD'][0]+\n                                     full_df['OVERALL PERCENT BHD'][2])\/2.\nfull_df['OVERALL PERCENT BHD'][3] = (full_df['OVERALL PERCENT BHD'][2]+\n                                     full_df['OVERALL PERCENT BHD'][4])\/2.\n\noverall_hsg_percent = full_df['OVERALL PERCENT HSG'].to_numpy()\noverall_bhd_percent = full_df['OVERALL PERCENT BHD'].to_numpy()\n\noverall_lf_level = 1.*full_df['OVERALL LABOR FORCE LEVEL (IN THOUSANDS)'].to_numpy()\nlhs_lf_level = 1.*truncated_df['LHS LABOR FORCE LEVEL (IN THOUSANDS)'].to_numpy()\nhsg_lf_level = 1.*truncated_df['HSG LABOR FORCE LEVEL (IN THOUSANDS)'].to_numpy()\ncad_lf_level = 1.*truncated_df['CAD LABOR FORCE LEVEL (IN THOUSANDS)'].to_numpy()\nbhd_lf_level = 1.*truncated_df['BHD LABOR FORCE LEVEL (IN THOUSANDS)'].to_numpy()\n\noverall_emp_level = 1.*full_df['OVERALL EMPLOYMENT LEVEL (IN THOUSANDS)'].to_numpy()\nlhs_emp_level = 1.*truncated_df['LHS EMPLOYMENT LEVEL (IN THOUSANDS)'].to_numpy()\nhsg_emp_level = 1.*truncated_df['HSG EMPLOYMENT LEVEL (IN THOUSANDS)'].to_numpy()\ncad_emp_level = 1.*truncated_df['CAD EMPLOYMENT LEVEL (IN THOUSANDS)'].to_numpy()\nbhd_emp_level = 1.*truncated_df['BHD EMPLOYMENT LEVEL (IN THOUSANDS)'].to_numpy()\n\nlhs_lf_pr = 1.*truncated_df['LHS LABOR FORCE PARTICIPATION RATE (IN PERCENT)'].to_numpy()\nhsg_lf_pr = 1.*truncated_df['HSG LABOR FORCE PARTICIPATION RATE (IN PERCENT)'].to_numpy()\ncad_lf_pr = 1.*truncated_df['CAD LABOR FORCE PARTICIPATION RATE (IN PERCENT)'].to_numpy()\nbhd_lf_pr = 1.*truncated_df['BHD LABOR FORCE PARTICIPATION RATE (IN PERCENT)'].to_numpy()\noverall_lf_pr = 1.*full_df['OVERALL LABOR FORCE PARTICIPATION RATE (IN PERCENT)'].to_numpy()\n\nfull_df_years = full_df.YEAR.to_numpy()","8d7c4028":"### To estimate the seasonal\/oscillating component of the variables ###\n\nplot_periodogram(overall_hsg_percent[:-num_forecast_steps], title_str='Overall HSG %')\n\nplot_periodogram(overall_bhd_percent[:-num_forecast_steps], title_str='Overall BHD %')\n\nplot_periodogram(overall_lf_level[:-num_forecast_steps], title_str='Overall LF Level')\n\nplot_periodogram(overall_emp_level[:-num_forecast_steps], \n                 title_str='Overall Employment Level')\n\nplot_periodogram(overall_lf_pr[:-num_forecast_steps], \n                 title_str='Overall LF Participation Rate')","9e1ed047":"### Overall HSG percent ###\nhsg_percent_model = build_linear_trend_model(overall_hsg_percent[:-num_forecast_steps])\n\n(hsg_percent_var_post, \n hsg_percent_forecast_dist) = fit_model_generate_forecast(hsg_percent_model,\n                                overall_hsg_percent[:-num_forecast_steps], \n                                num_forecast_steps)\n\n# print_fit_params(hsg_percent_var_post, hsg_percent_model)\n\nplot_forecast_results(hsg_percent_forecast_dist, full_df_years, overall_hsg_percent, \n                      'Overall HSG percent', num_samples=10)","59d0b47e":"### Overall BHD percent ###\nbhd_percent_model = build_linear_trend_seasonal_model(overall_bhd_percent[:-num_forecast_steps],\n                                            steps_per_season=12)\n(bhd_percent_var_post, \n bhd_percent_forecast_dist) = fit_model_generate_forecast( bhd_percent_model,\n                overall_bhd_percent[:-num_forecast_steps], num_forecast_steps)\n\n# print_fit_params(bhd_percent_var_post, bhd_percent_model)\n\nplot_forecast_results(bhd_percent_forecast_dist, full_df_years, overall_bhd_percent, \n                      'Overall BHD percent', num_samples=10)","ae4959ec":"### Overall Labor Force Level ###\n### We use a linear trend combined with a seasonal trend here ###\nlf_level_model = build_linear_trend_seasonal_model(overall_lf_level[:-num_forecast_steps],\n                                                  steps_per_season=12)\n(lf_level_var_post, \n lf_level_forecast_dist) = fit_model_generate_forecast( lf_level_model,\n                        overall_lf_level[:-num_forecast_steps], num_forecast_steps)\n\n# print_fit_params(lf_level_var_post, lf_level_model)\n\nplot_forecast_results(lf_level_forecast_dist, full_df_years, overall_lf_level, \n                      'Overall Labor Force Level', num_samples=10)","bebb91d6":"### Overall Employment Level ###\n### We use a linear trend \nemp_level_model = build_linear_trend_seasonal_model(overall_emp_level[:-num_forecast_steps],\n                                                   steps_per_season=12)\n(emp_level_var_post, \n emp_level_forecast_dist) = fit_model_generate_forecast(emp_level_model,\n                        overall_emp_level[:-num_forecast_steps], num_forecast_steps)\n\n# print_fit_params(emp_level_var_post, emp_level_model)\n\nplot_forecast_results(emp_level_forecast_dist, full_df_years, overall_emp_level, \n                      'Overall Employment Level', num_samples=10)","0712482a":"### Overall Labor Force Participation Rate ###\nlf_pr_model = build_linear_trend_seasonal_model(overall_lf_pr[:-num_forecast_steps],\n                                               steps_per_season=12)  \n(lf_pr_var_post, \n lf_pr_forecast_dist) = fit_model_generate_forecast( lf_pr_model,\n                            overall_lf_pr[:-num_forecast_steps], num_forecast_steps)\n\n# print_fit_params(lf_pr_var_post, lf_pr_model)\n\nplot_forecast_results(lf_pr_forecast_dist, full_df_years, overall_lf_pr, \n                      'Overall Labor Force Participation Rate', num_samples=10)","1af923a1":"forecast_years = np.array(range(2021,2031))\nnum_forecast_steps = 10\nhsg_percent_mean, hsg_percent_dist = generate_forecast(hsg_percent_model, \n                                                       hsg_percent_var_post,\n                                                       overall_hsg_percent,\n                                                       num_forecast_steps)\n\nfull_df_forecast_yrs = np.hstack((full_df_years, forecast_years))\nplot_forecast_future(hsg_percent_dist, full_df_forecast_yrs, overall_hsg_percent, \n                     'HSG percent')\nhsg_percent_forecast = np.hstack((overall_hsg_percent, hsg_percent_mean))","0fea1b98":"bhd_percent_mean, bhd_percent_dist = generate_forecast(bhd_percent_model, \n                                                       bhd_percent_var_post,\n                                                       overall_bhd_percent,\n                                                       num_forecast_steps)\nplot_forecast_future(bhd_percent_dist, full_df_forecast_yrs, overall_bhd_percent, \n                     'BHD percent')\nbhd_percent_forecast = np.hstack((overall_bhd_percent, bhd_percent_mean))","d52de3f4":"lf_level_mean, lf_level_dist = generate_forecast(lf_level_model, \n                                               lf_level_var_post,\n                                               overall_lf_level,\n                                               num_forecast_steps)\nplot_forecast_future(lf_level_dist, full_df_forecast_yrs, overall_lf_level, \n                     'Overall LF Level')\nlf_level_forecast = np.hstack((overall_lf_level, lf_level_mean))","ad44787d":"emp_level_mean, emp_level_dist = generate_forecast(emp_level_model, \n                                               emp_level_var_post,\n                                               overall_emp_level,\n                                               num_forecast_steps)\nplot_forecast_future(emp_level_dist, full_df_forecast_yrs, overall_emp_level, \n                     'Overall Employment Level')\nemp_level_forecast = np.hstack((overall_emp_level, emp_level_mean))","273663eb":"lf_pr_mean, lf_pr_dist = generate_forecast(lf_pr_model, \n                                               lf_pr_var_post,\n                                               overall_lf_pr,\n                                               num_forecast_steps)\nplot_forecast_future(lf_pr_dist, full_df_forecast_yrs, overall_lf_pr, \n                     'Overall LF Participation Rate')\nlf_pr_forecast = np.hstack((overall_lf_pr, lf_pr_mean))","e5f42027":"### To estimate the seasonal\/oscillating component of the variables ###\nnum_forecast_steps = 6 ### since we have lesser data available \n\ntrunc_df_years = truncated_df['YEAR'].to_numpy()\n\n### plotting Labor Force Levels ###\nplt.plot(truncated_df['YEAR'], truncated_df['LHS LABOR FORCE LEVEL (IN THOUSANDS)'],\n         marker='o',linestyle=':', color=color_dict['LHS'], label='LHS')\nplt.plot(truncated_df['YEAR'], truncated_df['HSG LABOR FORCE LEVEL (IN THOUSANDS)'],\n         marker='o',linestyle=':', color=color_dict['HSG'], label='HSG')\nplt.plot(truncated_df['YEAR'], truncated_df['CAD LABOR FORCE LEVEL (IN THOUSANDS)'],\n         marker='o',linestyle=':', color=color_dict['CAD'], label='CAD')\nplt.plot(truncated_df['YEAR'], truncated_df['BHD LABOR FORCE LEVEL (IN THOUSANDS)'],\n         marker='o',linestyle=':', color=color_dict['BHD'], label='BHD')\nplt.legend()\nplt.ylabel('Labor Force Level (in Thousands)')\nplt.xlabel('Year')\nplt.show()\n\nplot_periodogram(lhs_lf_level[:-num_forecast_steps], \n                 title_str='LHS LF Level')\nplot_periodogram(hsg_lf_level[:-num_forecast_steps], \n                 title_str='HSG LF Level')\nplot_periodogram(cad_lf_level[:-num_forecast_steps], \n                 title_str='CAD LF Level')\nplot_periodogram(bhd_lf_level[:-num_forecast_steps], \n                 title_str='BHD LF Level')","32edf68b":"### LHS Labor Force Level ###\nlhs_lf_model = build_linear_trend_seasonal_model(lhs_lf_level[:-num_forecast_steps],\n                                                steps_per_season=2)\n\n(lhs_lf_var_post, \n lhs_lf_forecast_dist) = fit_model_generate_forecast(lhs_lf_model, \n                        lhs_lf_level[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(lhs_lf_forecast_dist, trunc_df_years, lhs_lf_level, \n                      'LHS LF Level', num_samples=10)\n\n### HSG Labor Force Level ###\nhsg_lf_model = build_linear_trend_seasonal_model(hsg_lf_level[:-num_forecast_steps],\n                                                steps_per_season=6)\n\n(hsg_lf_var_post, \n hsg_lf_forecast_dist) = fit_model_generate_forecast(hsg_lf_model, \n                        hsg_lf_level[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(hsg_lf_forecast_dist, trunc_df_years, hsg_lf_level, \n                      'HSG LF Level', num_samples=10)\n\n### CAD Labor Force Level ###\ncad_lf_model = build_linear_trend_seasonal_model(cad_lf_level[:-num_forecast_steps],\n                                                steps_per_season=6)\n(cad_lf_var_post, \n cad_lf_forecast_dist) = fit_model_generate_forecast(cad_lf_model, \n                        cad_lf_level[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(cad_lf_forecast_dist, trunc_df_years, cad_lf_level, \n                      'CAD LF Level', num_samples=10)\n\n### BHD Labor Force Level ###\nbhd_lf_model = build_linear_trend_seasonal_model(bhd_lf_level[:-num_forecast_steps],\n                                                steps_per_season=4)\n(bhd_lf_var_post, \n bhd_lf_forecast_dist) = fit_model_generate_forecast(bhd_lf_model, \n                        bhd_lf_level[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(bhd_lf_forecast_dist, trunc_df_years, bhd_lf_level, \n                      'BHD LF Level', num_samples=10)","55c1ec87":"lhs_lf_level_est = (1-hsg_percent_forecast\/100.)*lf_level_forecast\nlhs_lf_level_est = np.round(\n    lhs_lf_level_est[overall_lf_level.size-lhs_lf_level.size:])\n\nhsg_lf_level_est = ((hsg_percent_forecast - bhd_percent_forecast)\/100.\n                   )*lf_level_forecast\nhsg_lf_level_est = np.round(\n    hsg_lf_level_est[overall_lf_level.size-lhs_lf_level.size:])\n\nbhd_lf_level_est = (bhd_percent_forecast\/100.)*lf_level_forecast\nbhd_lf_level_est = np.round(\n    bhd_lf_level_est[overall_lf_level.size-lhs_lf_level.size:])\n\n### for the cad level est, we will use a linear combination of \n### hsg_lf_level_est and bhd_lf_level_est. we will use the same for hsg.\ncad_lf_level_est = np.transpose(np.vstack((lhs_lf_level_est, \n                                            hsg_lf_level_est, \n                                            bhd_lf_level_est)))\n\nlhs_lf_level_est = tf.reshape(lhs_lf_level_est, (-1,1))\nhsg_lf_level_est = tf.reshape(cad_lf_level_est, (-1, 3))\ncad_lf_level_est = tf.reshape(cad_lf_level_est, (-1, 3))\nbhd_lf_level_est = tf.reshape(bhd_lf_level_est, (-1,1))\n\ndef build_linear_seasonal_regression_model(observed_time_series, \n                                           auxilliary_time_series,\n                                           steps_per_season=1):\n\n    local_linear_trend = sts.SemiLocalLinearTrend(\n                                observed_time_series=observed_time_series)    \n\n    seasonal_trend = sts.Seasonal(\n            num_seasons=2, num_steps_per_season=steps_per_season, \n            observed_time_series=observed_time_series)    \n    \n    regression_effect = sts.LinearRegression(\n      design_matrix=auxilliary_time_series, name='regression_effect')\n\n    model = sts.Sum([local_linear_trend, seasonal_trend, regression_effect],\n                   observed_time_series=observed_time_series)\n    return model","824078ab":" ### since we have a smaller dataset for the category-wise variables ###\n### LHS Labor Force Level ###\nlhs_lf_model_reg = build_linear_seasonal_regression_model(\n                    lhs_lf_level[:-num_forecast_steps], lhs_lf_level_est, \n                    steps_per_season=2)\n(lhs_lf_var_post_reg, \n lhs_lf_forecast_dist_reg) = fit_model_generate_forecast(lhs_lf_model_reg, \n                        lhs_lf_level[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(lhs_lf_forecast_dist_reg, trunc_df_years, lhs_lf_level, \n                      'LHS LF Level', num_samples=10)\n\n### HSG Labor Force Level ###\nhsg_lf_model_reg = build_linear_seasonal_regression_model(\n                    hsg_lf_level[:-num_forecast_steps], hsg_lf_level_est, \n                    steps_per_season=6)\n(hsg_lf_var_post_reg, \n hsg_lf_forecast_dist_reg) = fit_model_generate_forecast(hsg_lf_model_reg, \n                        hsg_lf_level[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(hsg_lf_forecast_dist_reg, trunc_df_years, hsg_lf_level, \n                      'HSG LF Level', num_samples=10)\n\n### CAD Labor Force Level ###\ncad_lf_model_reg = build_linear_seasonal_regression_model(\n                    cad_lf_level[:-num_forecast_steps], cad_lf_level_est, \n                    steps_per_season=6)\n(cad_lf_var_post_reg, \n cad_lf_forecast_dist_reg) = fit_model_generate_forecast(cad_lf_model_reg, \n                        cad_lf_level[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(cad_lf_forecast_dist_reg, trunc_df_years, cad_lf_level, \n                      'CAD LF Level', num_samples=10)\n\n### BHD Labor Force Level ###\nbhd_lf_model_reg = build_linear_seasonal_regression_model(\n                    bhd_lf_level[:-num_forecast_steps], bhd_lf_level_est, \n                    steps_per_season=4)\n(bhd_lf_var_post_reg, \n bhd_lf_forecast_dist_reg) = fit_model_generate_forecast(bhd_lf_model_reg, \n                        bhd_lf_level[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(bhd_lf_forecast_dist_reg, trunc_df_years, bhd_lf_level, \n                      'BHD LF Level', num_samples=10)","e32da48a":"### To estimate the seasonal\/oscillating component of the variable ###\nnum_forecast_steps = 6\n\n### plotting Labor Force Levels ###\nplt.plot(truncated_df['YEAR'], truncated_df['LHS EMPLOYMENT LEVEL (IN THOUSANDS)'],\n         marker='o',linestyle=':', color=color_dict['LHS'], label='LHS')\nplt.plot(truncated_df['YEAR'], truncated_df['HSG EMPLOYMENT LEVEL (IN THOUSANDS)'],\n         marker='o',linestyle=':', color=color_dict['HSG'], label='HSG')\nplt.plot(truncated_df['YEAR'], truncated_df['CAD EMPLOYMENT LEVEL (IN THOUSANDS)'],\n         marker='o',linestyle=':', color=color_dict['CAD'], label='CAD')\nplt.plot(truncated_df['YEAR'], truncated_df['BHD EMPLOYMENT LEVEL (IN THOUSANDS)'],\n         marker='o',linestyle=':', color=color_dict['BHD'], label='BHD')\nplt.legend()\nplt.ylabel('Employment Level (in Thousands)')\nplt.xlabel('Year')\nplt.show()\n\nplot_periodogram(lhs_emp_level[:-num_forecast_steps], \n                 title_str='LHS Employment Level')\nplot_periodogram(hsg_emp_level[:-num_forecast_steps], \n                 title_str='HSG Employment Level')\nplot_periodogram(cad_emp_level[:-num_forecast_steps], \n                 title_str='CAD Employment Level')\nplot_periodogram(bhd_emp_level[:-num_forecast_steps], \n                 title_str='BHD Employment Level')","d6438de6":"### since we have a smaller dataset for the category-wise variables ###\n### LHS Employment Level ###\nlhs_emp_model = build_linear_trend_seasonal_model(lhs_emp_level[:-num_forecast_steps],\n                                                steps_per_season=4)\n(lhs_emp_var_post, \n lhs_emp_forecast_dist) = fit_model_generate_forecast(lhs_emp_model, \n                        lhs_emp_level[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(lhs_emp_forecast_dist, trunc_df_years, lhs_emp_level, \n                      'LHS Employment Level', num_samples=10)\n\n### HSG Employment Level ###\nhsg_emp_model = build_linear_trend_seasonal_model(hsg_emp_level[:-num_forecast_steps],\n                                                steps_per_season=4)\n(hsg_emp_var_post, \n hsg_emp_forecast_dist) = fit_model_generate_forecast(hsg_emp_model, \n                        hsg_emp_level[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(hsg_emp_forecast_dist, trunc_df_years, hsg_emp_level, \n                      'HSG Employment Level', num_samples=10)\n\n### CAD Employment Level ###\ncad_emp_model = build_linear_trend_seasonal_model(cad_emp_level[:-num_forecast_steps],\n                                                steps_per_season=3)\n(cad_emp_var_post, \n cad_emp_forecast_dist) = fit_model_generate_forecast(cad_emp_model, \n                        cad_emp_level[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(cad_emp_forecast_dist, trunc_df_years, cad_emp_level, \n                      'CAD Employment Level', num_samples=10)\n\n### BHD Employment Level ###\nbhd_emp_model = build_linear_trend_seasonal_model(bhd_emp_level[:-num_forecast_steps],\n                                                steps_per_season=4)\n(bhd_emp_var_post, \n bhd_emp_forecast_dist) = fit_model_generate_forecast(bhd_emp_model, \n                        bhd_emp_level[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(bhd_emp_forecast_dist, trunc_df_years, bhd_emp_level, \n                      'BHD Employment Level', num_samples=10)","f2af7770":"lhs_emp_level_est = (1-hsg_percent_forecast\/100.)*emp_level_forecast\nlhs_emp_level_est = np.round(\n    lhs_emp_level_est[overall_emp_level.size-lhs_emp_level.size:])\n\nhsg_emp_level_est = ((hsg_percent_forecast - bhd_percent_forecast)\/100.\n                   )*emp_level_forecast\nhsg_emp_level_est = np.round(\n    hsg_emp_level_est[overall_emp_level.size-lhs_emp_level.size:])\n\nbhd_emp_level_est = (bhd_percent_forecast\/100.)*emp_level_forecast\nbhd_emp_level_est = np.round(\n    bhd_emp_level_est[overall_emp_level.size-lhs_emp_level.size:])\n\n### for the cad level est, we will use a linear combination of \n### hsg_lf_level_est and bhd_lf_level_est. we will use the same for hsg.\ncad_emp_level_est = np.transpose(np.vstack((lhs_emp_level_est, \n                                            hsg_emp_level_est, \n                                            bhd_emp_level_est)))\n\nlhs_emp_level_est = tf.reshape(lhs_emp_level_est, (-1,1))\nhsg_emp_level_est = tf.reshape(cad_emp_level_est, (-1, 3))\ncad_emp_level_est = tf.reshape(cad_emp_level_est, (-1, 3))\nbhd_emp_level_est = tf.reshape(bhd_emp_level_est, (-1,1))","abb1f8f7":" ### since we have a smaller dataset for the category-wise variables ###\n### LHS Employment Level ###\nlhs_emp_model_reg = build_linear_seasonal_regression_model(\n                    lhs_emp_level[:-num_forecast_steps], lhs_emp_level_est, \n                    steps_per_season=4)\n(lhs_emp_var_post_reg, \n lhs_emp_forecast_dist_reg) = fit_model_generate_forecast(lhs_emp_model_reg, \n                        lhs_emp_level[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(lhs_emp_forecast_dist_reg, trunc_df_years, lhs_emp_level, \n                      'LHS Employment Level', num_samples=10)\n\n### HSG Employment Level ###\nhsg_emp_model_reg = build_linear_seasonal_regression_model(\n                    hsg_emp_level[:-num_forecast_steps], hsg_emp_level_est, \n                    steps_per_season=4)\n(hsg_emp_var_post_reg, \n hsg_emp_forecast_dist_reg) = fit_model_generate_forecast(hsg_emp_model_reg, \n                        hsg_emp_level[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(hsg_emp_forecast_dist_reg, trunc_df_years, hsg_emp_level, \n                      'HSG Employment Level', num_samples=10)\n\n### CAD Employment Level ###\ncad_emp_model_reg = build_linear_seasonal_regression_model(\n                    cad_emp_level[:-num_forecast_steps], cad_emp_level_est, \n                    steps_per_season=3)\n(cad_emp_var_post_reg, \n cad_emp_forecast_dist_reg) = fit_model_generate_forecast(cad_emp_model_reg, \n                        cad_emp_level[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(cad_emp_forecast_dist_reg, trunc_df_years, cad_emp_level, \n                      'CAD Employment Level', num_samples=10)\n\n### BHD Employment Level ###\nbhd_emp_model_reg = build_linear_seasonal_regression_model(\n                    bhd_emp_level[:-num_forecast_steps], bhd_emp_level_est, \n                    steps_per_season=4)\n(bhd_emp_var_post_reg, \n bhd_emp_forecast_dist_reg) = fit_model_generate_forecast(bhd_emp_model_reg, \n                        bhd_emp_level[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(bhd_emp_forecast_dist_reg, trunc_df_years, bhd_emp_level, \n                      'BHD Employment Level', num_samples=10)","9ec6eb68":"### To estimate the seasonal\/oscillating component of the variable ###\nnum_forecast_steps = 6\n\n### plotting Labor Force Levels ###\nplt.plot(truncated_df['YEAR'], truncated_df['LHS LABOR FORCE PARTICIPATION RATE (IN PERCENT)'],\n         marker='o',linestyle=':', color=color_dict['LHS'], label='LHS')\nplt.plot(truncated_df['YEAR'], truncated_df['HSG LABOR FORCE PARTICIPATION RATE (IN PERCENT)'],\n         marker='o',linestyle=':', color=color_dict['HSG'], label='HSG')\nplt.plot(truncated_df['YEAR'], truncated_df['CAD LABOR FORCE PARTICIPATION RATE (IN PERCENT)'],\n         marker='o',linestyle=':', color=color_dict['CAD'], label='CAD')\nplt.plot(truncated_df['YEAR'], truncated_df['BHD LABOR FORCE PARTICIPATION RATE (IN PERCENT)'],\n         marker='o',linestyle=':', color=color_dict['BHD'], label='BHD')\nplt.legend()\nplt.ylabel('Employment Level (in Thousands)')\nplt.xlabel('Year')\nplt.show()\n\nplot_periodogram(lhs_lf_pr[:-num_forecast_steps], \n                 title_str='LHS LF PR')\nplot_periodogram(hsg_lf_pr[:-num_forecast_steps], \n                 title_str='HSG LF PR')\nplot_periodogram(cad_lf_pr[:-num_forecast_steps], \n                 title_str='CAD LF PR')\nplot_periodogram(bhd_lf_pr[:-num_forecast_steps], \n                 title_str='BHD LF PR')","97b9a1d2":"### since we have a smaller dataset for the category-wise variables ###\n### LHS Labor Force Participation Rate ###\nlhs_lf_pr_model = build_linear_trend_seasonal_model(lhs_lf_pr[:-num_forecast_steps],\n                                                steps_per_season=2)\n(lhs_lf_pr_var_post, \n lhs_lf_pr_forecast_dist) = fit_model_generate_forecast(lhs_lf_pr_model, \n                        lhs_lf_pr[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(lhs_lf_pr_forecast_dist, trunc_df_years, lhs_lf_pr, \n                      'LHS LF Participation Rate', num_samples=10)\n\n### HSG Labor Force Participation Rate ###\nhsg_lf_pr_model = build_linear_trend_seasonal_model(hsg_lf_pr[:-num_forecast_steps],\n                                                steps_per_season=6)\n(hsg_lf_pr_var_post, \n hsg_lf_pr_forecast_dist) = fit_model_generate_forecast(hsg_lf_pr_model, \n                        hsg_lf_pr[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(hsg_lf_pr_forecast_dist, trunc_df_years, hsg_lf_pr, \n                      'HSG LF Participation Rate', num_samples=10)\n\n### CAD Labor Force Participation Rate ###\ncad_lf_pr_model = build_linear_trend_seasonal_model(cad_lf_pr[:-num_forecast_steps],\n                                                steps_per_season=6)\n(cad_lf_pr_var_post, \n cad_lf_pr_forecast_dist) = fit_model_generate_forecast(cad_lf_pr_model, \n                        cad_lf_pr[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(cad_lf_pr_forecast_dist, trunc_df_years, cad_lf_pr, \n                      'CAD LF Participation Rate', num_samples=10)\n\n### BHD Labor Force Participation Rate ###\nbhd_lf_pr_model = build_linear_trend_seasonal_model(bhd_lf_pr[:-num_forecast_steps],\n                                                steps_per_season=6)\n(bhd_lf_pr_var_post, \n bhd_lf_pr_forecast_dist) = fit_model_generate_forecast(bhd_lf_pr_model, \n                        bhd_lf_pr[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(bhd_lf_pr_forecast_dist, trunc_df_years, bhd_lf_pr, \n                      'BHD LF Participation Rate', num_samples=10)","51cad1bf":"lhs_lf_pr_est = (1-hsg_percent_forecast\/100.)*lf_pr_forecast\nlhs_lf_pr_est = np.round(\n    lhs_lf_pr_est[overall_lf_pr.size-lhs_lf_pr.size:])\n\nhsg_lf_pr_est = ((hsg_percent_forecast - bhd_percent_forecast)\/100.\n                   )*lf_pr_forecast\nhsg_lf_pr_est = np.round(\n    hsg_lf_pr_est[overall_lf_pr.size-lhs_lf_pr.size:])\n\nbhd_lf_pr_est = (bhd_percent_forecast\/100.)*lf_pr_forecast\nbhd_lf_pr_est = np.round(\n    bhd_lf_pr_est[overall_lf_pr.size-lhs_lf_pr.size:])\n\n### for the cad level est, we will use a linear combination of \n### hsg_lf_level_est and bhd_lf_level_est. we will use the same for hsg.\ncad_lf_pr_est = np.transpose(np.vstack((lhs_lf_pr_est, \n                                            hsg_lf_pr_est, \n                                            bhd_lf_pr_est)))\n\nlhs_lf_pr_est = tf.reshape(lhs_lf_pr_est, (-1,1))\nhsg_lf_pr_est = tf.reshape(cad_lf_pr_est, (-1, 3))\ncad_lf_pr_est = tf.reshape(cad_lf_pr_est, (-1, 3))\nbhd_lf_pr_est = tf.reshape(bhd_lf_pr_est, (-1,1))","b474507a":" ### since we have a smaller dataset for the category-wise variables ###\n### LHS Labor Force Participation Rate ###\nlhs_lf_pr_model_reg = build_linear_seasonal_regression_model(\n                    lhs_lf_pr[:-num_forecast_steps], lhs_lf_pr_est, \n                    steps_per_season=2)\n(lhs_lf_pr_var_post_reg, \n lhs_lf_pr_forecast_dist_reg) = fit_model_generate_forecast(lhs_lf_pr_model_reg, \n                        lhs_lf_pr[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(lhs_lf_pr_forecast_dist_reg, trunc_df_years, lhs_lf_pr, \n                      'LHS LF Participation Rate', num_samples=10)\n\n### HSG Labor Force Participation Rate ###\nhsg_lf_pr_model_reg = build_linear_seasonal_regression_model(\n                    hsg_lf_pr[:-num_forecast_steps], hsg_lf_pr_est, \n                    steps_per_season=6)\n(hsg_lf_pr_var_post_reg, \n hsg_lf_pr_forecast_dist_reg) = fit_model_generate_forecast(hsg_lf_pr_model_reg, \n                        hsg_lf_pr[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(hsg_lf_pr_forecast_dist_reg, trunc_df_years, hsg_lf_pr, \n                      'HSG LF Participation Rate', num_samples=10)\n\n### CAD Labor Force Participation Rate ###\ncad_lf_pr_model_reg = build_linear_seasonal_regression_model(\n                    cad_lf_pr[:-num_forecast_steps], cad_lf_pr_est, \n                    steps_per_season=6)\n(cad_lf_pr_var_post_reg, \n cad_lf_pr_forecast_dist_reg) = fit_model_generate_forecast(cad_lf_pr_model_reg, \n                        cad_lf_pr[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(cad_lf_pr_forecast_dist_reg, trunc_df_years, cad_lf_pr, \n                      'CAD LF Participation Rate', num_samples=10)\n\n### BHD Labor Force Participation Rate ###\nbhd_lf_pr_model_reg = build_linear_seasonal_regression_model(\n                    bhd_lf_pr[:-num_forecast_steps], bhd_lf_pr_est, \n                    steps_per_season=6)\n(bhd_lf_pr_var_post_reg, \n bhd_lf_pr_forecast_dist_reg) = fit_model_generate_forecast(bhd_lf_pr_model_reg, \n                        bhd_lf_pr[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\n\nplot_forecast_results(bhd_lf_pr_forecast_dist_reg, trunc_df_years, bhd_lf_pr, \n                      'BHD LF Participation Rate', num_samples=10)","21640607":"forecast_years = np.array(range(2021,2031))\ntrunc_df_forecast_yrs = np.hstack((trunc_df_years, forecast_years))\nnum_forecast_steps = 10\n\nlhs_lf_level_mean, lhs_lf_level_dist = generate_forecast(lhs_lf_model, \n                                                       lhs_lf_var_post,\n                                                       lhs_lf_level,\n                                                       num_forecast_steps)\nplot_forecast_future(lhs_lf_level_dist, trunc_df_forecast_yrs, lhs_lf_level, \n                     'LHS LF Level')\nlhs_lf_level_forecast = np.hstack((lhs_lf_level, lhs_lf_level_mean))\n\n\nhsg_lf_level_mean, hsg_lf_level_dist = generate_forecast(hsg_lf_model, \n                                                       hsg_lf_var_post,\n                                                       hsg_lf_level,\n                                                       num_forecast_steps)\nplot_forecast_future(hsg_lf_level_dist, trunc_df_forecast_yrs, hsg_lf_level, \n                     'HSG LF Level')\nhsg_lf_level_forecast = np.hstack((hsg_lf_level, hsg_lf_level_mean))\n\n\ncad_lf_level_mean, cad_lf_level_dist = generate_forecast(cad_lf_model_reg, \n                                                       cad_lf_var_post_reg,\n                                                       cad_lf_level,\n                                                       num_forecast_steps)\n\nplot_forecast_future(cad_lf_level_dist, trunc_df_forecast_yrs, cad_lf_level, \n                     'CAD LF Level')\ncad_lf_level_forecast = np.hstack((cad_lf_level, cad_lf_level_mean))\n\n\nbhd_lf_level_mean, bhd_lf_level_dist = generate_forecast(bhd_lf_model_reg, \n                                                       bhd_lf_var_post_reg,\n                                                       bhd_lf_level,\n                                                       num_forecast_steps)\n\nplot_forecast_future(bhd_lf_level_dist, trunc_df_forecast_yrs, bhd_lf_level, \n                     'BHD LF Level')\nbhd_lf_level_forecast = np.hstack((bhd_lf_level, bhd_lf_level_mean))","b1748d5f":"lhs_emp_level_mean, lhs_emp_level_dist = generate_forecast(lhs_emp_model, \n                                                       lhs_emp_var_post,\n                                                       lhs_emp_level,\n                                                       num_forecast_steps)\nplot_forecast_future(lhs_emp_level_dist, trunc_df_forecast_yrs, lhs_emp_level, \n                     'LHS Employment Level')\nlhs_emp_level_forecast = np.hstack((lhs_emp_level, lhs_emp_level_mean))\n\n\nhsg_emp_level_mean, hsg_emp_level_dist = generate_forecast(hsg_emp_model, \n                                                       hsg_emp_var_post,\n                                                       hsg_emp_level,\n                                                       num_forecast_steps)\nplot_forecast_future(hsg_emp_level_dist, trunc_df_forecast_yrs, hsg_emp_level, \n                     'HSG Employment Level')\nhsg_emp_level_forecast = np.hstack((hsg_emp_level, hsg_emp_level_mean))\n\n\ncad_emp_level_mean, cad_emp_level_dist = generate_forecast(cad_emp_model, \n                                                       cad_emp_var_post,\n                                                       cad_emp_level,\n                                                       num_forecast_steps)\nplot_forecast_future(cad_emp_level_dist, trunc_df_forecast_yrs, cad_emp_level, \n                     'CAD Employment Level')\ncad_emp_level_forecast = np.hstack((cad_emp_level, cad_emp_level_mean))\n\n\nbhd_emp_level_mean, bhd_emp_level_dist = generate_forecast(bhd_emp_model_reg, \n                                                       bhd_emp_var_post_reg,\n                                                       bhd_emp_level,\n                                                       num_forecast_steps)\nplot_forecast_future(bhd_emp_level_dist, trunc_df_forecast_yrs, bhd_emp_level, \n                     'BHD Employment Level')\nbhd_emp_level_forecast = np.hstack((bhd_emp_level, bhd_emp_level_mean))","2eb96b6a":"lhs_lf_pr_mean, lhs_lf_pr_dist = generate_forecast(lhs_lf_pr_model, \n                                                       lhs_lf_pr_var_post,\n                                                       lhs_lf_pr,\n                                                       num_forecast_steps)\nplot_forecast_future(lhs_lf_pr_dist, trunc_df_forecast_yrs, lhs_lf_pr, \n                     'LHS LF Participation Rate')\nlhs_lf_pr_forecast = np.hstack((lhs_lf_pr, lhs_lf_pr_mean))\n\n\nhsg_lf_pr_mean, hsg_lf_pr_dist = generate_forecast(hsg_lf_pr_model, \n                                                       hsg_lf_pr_var_post,\n                                                       hsg_lf_pr,\n                                                       num_forecast_steps)\nplot_forecast_future(hsg_lf_pr_dist, trunc_df_forecast_yrs, hsg_lf_pr, \n                     'HSG LF Participation Rate')\nhsg_lf_pr_forecast = np.hstack((hsg_lf_pr, hsg_lf_pr_mean))\n\n\ncad_lf_pr_mean, cad_lf_pr_dist = generate_forecast(cad_lf_pr_model, \n                                                       cad_lf_pr_var_post,\n                                                       cad_lf_pr,\n                                                       num_forecast_steps)\nplot_forecast_future(cad_lf_pr_dist, trunc_df_forecast_yrs, cad_lf_pr, \n                     'CAD LF Participation Rate')\ncad_lf_pr_forecast = np.hstack((cad_lf_pr, cad_lf_pr_mean))\n\n\nbhd_lf_pr_mean, bhd_lf_pr_dist = generate_forecast(bhd_lf_pr_model, \n                                                       bhd_lf_pr_var_post,\n                                                       bhd_lf_pr,\n                                                       num_forecast_steps)\nplot_forecast_future(bhd_lf_pr_dist, trunc_df_forecast_yrs, bhd_lf_pr, \n                     'BHD LF Participation Rate')\nbhd_lf_pr_forecast = np.hstack((bhd_lf_pr, bhd_lf_pr_mean))","3ebf1eef":"#### METHOD (I) ####\n\nplot_forecast_future(lhs_mwe_dist, mwe_forecast_yrs, lhs_mwe_full, \n                     'LHS Median Weekly Earnings')\n\nplot_forecast_future(hsg_mwe_dist, mwe_forecast_yrs, hsg_mwe_full, \n                     'HSG Median Weekly Earnings')\n\nplot_forecast_future(cad_mwe_dist, mwe_forecast_yrs, cad_mwe_full, \n                     'CAD Median Weekly Earnings')\n\nplot_forecast_future(bhd_mwe_dist, mwe_forecast_yrs, bhd_mwe_full, \n                     'BHD Median Weekly Earnings')","9487c0a1":"#### normalize the labor force variables #### to make them within 0-10\nlf_level_normalization = 1.\/10000.\nemp_level_normalization = 1.\/10000.\nlf_pr_normalization = 1.\/10.\n\nlhs_lf_level_reg = lhs_lf_level_forecast*lf_level_normalization\nhsg_lf_level_reg = hsg_lf_level_forecast*lf_level_normalization\ncad_lf_level_reg = cad_lf_level_forecast*lf_level_normalization\nbhd_lf_level_reg = bhd_lf_level_forecast*lf_level_normalization\n\nlhs_emp_level_reg = lhs_emp_level_forecast*emp_level_normalization\nhsg_emp_level_reg = hsg_emp_level_forecast*emp_level_normalization\ncad_emp_level_reg = cad_emp_level_forecast*emp_level_normalization\nbhd_emp_level_reg = bhd_emp_level_forecast*emp_level_normalization\n\nlhs_lf_pr_reg = lhs_lf_pr_forecast*lf_pr_normalization\nhsg_lf_pr_reg = hsg_lf_pr_forecast*lf_pr_normalization\ncad_lf_pr_reg = cad_lf_pr_forecast*lf_pr_normalization\nbhd_lf_pr_reg = bhd_lf_pr_forecast*lf_pr_normalization\n\nlhs_mwe_est = np.transpose(np.vstack((lhs_lf_level_reg, \n                                    lhs_emp_level_reg, \n                                    lhs_lf_pr_reg)))\nhsg_mwe_est = np.transpose(np.vstack((hsg_lf_level_reg, \n                                    hsg_emp_level_reg, \n                                    hsg_lf_pr_reg)))\ncad_mwe_est = np.transpose(np.vstack((cad_lf_level_reg, \n                                    cad_emp_level_reg, \n                                    cad_lf_pr_reg)))\nbhd_mwe_est = np.transpose(np.vstack((bhd_lf_level_reg, \n                                    bhd_emp_level_reg, \n                                    bhd_lf_pr_reg)))\n\nlhs_mwe_est = tf.reshape(lhs_mwe_est, (-1,3))\nhsg_mwe_est = tf.reshape(cad_mwe_est, (-1,3))\ncad_mwe_est = tf.reshape(cad_mwe_est, (-1,3))\nbhd_mwe_est = tf.reshape(bhd_mwe_est, (-1,3))","a1a8d644":"plot_periodogram(full_df['LHS MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'][19:-10],\n                title_str='LHS MWE')\nplot_periodogram(full_df['HSG MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'][19:-10],\n                title_str='HSG MWE')\nplot_periodogram(full_df['CAD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'][19:-10],\n                title_str='CAD MWE')\nplot_periodogram(full_df['BHD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'][19:-10],\n                title_str='BHD MWE')","d9a83f3f":"### Since we use a shorter dataset, we pick the season duration \n### informed by the periodogram plotted earlier, neglecting the peaks at\n### frequencies close to 1\/20.\nnum_forecast_steps = 6 ### since we have less data ###\nlhs_mwe_model_reg = build_linear_seasonal_regression_model(\n                            lhs_mwe_trunc[:-num_forecast_steps],\n                            lhs_mwe_est, steps_per_season=5)\n(lhs_mwe_var_post_reg, \n lhs_mwe_forecast_dist_reg) = fit_model_generate_forecast(lhs_mwe_model_reg, \n                        lhs_mwe_trunc[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\nplot_forecast_results(lhs_mwe_forecast_dist_reg, trunc_df_years, lhs_mwe_trunc, \n                      'LHS MWE', num_samples=10)\n\n\nhsg_mwe_model_reg = build_linear_seasonal_regression_model(\n                            hsg_mwe_trunc[:-num_forecast_steps],\n                            hsg_mwe_est, steps_per_season=4)\n(hsg_mwe_var_post_reg, \n hsg_mwe_forecast_dist_reg) = fit_model_generate_forecast(hsg_mwe_model_reg, \n                        hsg_mwe_trunc[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\nplot_forecast_results(hsg_mwe_forecast_dist_reg, trunc_df_years, hsg_mwe_trunc, \n                      'HSG MWE', num_samples=10)\n\n\ncad_mwe_model_reg = build_linear_seasonal_regression_model(\n                            cad_mwe_trunc[:-num_forecast_steps],\n                            cad_mwe_est, steps_per_season=5)\n(cad_mwe_var_post_reg, \n cad_mwe_forecast_dist_reg) = fit_model_generate_forecast(cad_mwe_model_reg, \n                        cad_mwe_trunc[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\nplot_forecast_results(cad_mwe_forecast_dist_reg, trunc_df_years, cad_mwe_trunc, \n                      'CAD MWE', num_samples=10)\n\n\nbhd_mwe_model_reg = build_linear_seasonal_regression_model(\n                            bhd_mwe_trunc[:-num_forecast_steps],\n                            bhd_mwe_est, steps_per_season=5)\n(bhd_mwe_var_post_reg, \n bhd_mwe_forecast_dist_reg) = fit_model_generate_forecast(bhd_mwe_model_reg, \n                        bhd_mwe_trunc[:-num_forecast_steps], num_forecast_steps, \n                        num_variational_steps=200)\nplot_forecast_results(bhd_mwe_forecast_dist_reg, trunc_df_years, bhd_mwe_trunc, \n                      'BHD MWE', num_samples=10)","3c7c4f40":"#### METHOD (II) ####\nforecast_years = np.array(range(2021,2031))\nmwe_forecast_yrs = np.hstack((full_mwe_years, forecast_years))\nnum_forecast_steps = 10\nnum_samples = 10\n\nlhs_mwe_mean, lhs_mwe_dist = generate_forecast(lhs_mwe_model_reg, \n                                                       lhs_mwe_var_post_reg,\n                                                       lhs_mwe_trunc,\n                                                       num_forecast_steps)\nplot_forecast_future(lhs_mwe_dist, mwe_forecast_yrs, lhs_mwe_full, \n                     'LHS Median Weekly Earnings')\n(\n    lhs_mwe_forecast_mean,\n    lhs_mwe_forecast_scale,\n    lhs_mwe_forecast_samples\n) = (\n    lhs_mwe_dist.mean().numpy()[..., 0],\n    lhs_mwe_dist.stddev().numpy()[..., 0],\n    lhs_mwe_dist.sample(num_samples).numpy()[..., 0]\n    )\n\n\n\nhsg_mwe_mean, hsg_mwe_dist = generate_forecast(hsg_mwe_model_reg, \n                                                       hsg_mwe_var_post_reg,\n                                                       hsg_mwe_trunc,\n                                                       num_forecast_steps)\nplot_forecast_future(hsg_mwe_dist, mwe_forecast_yrs, hsg_mwe_full, \n                     'HSG Median Weekly Earnings')\n(\n    hsg_mwe_forecast_mean,\n    hsg_mwe_forecast_scale,\n    hsg_mwe_forecast_samples\n) = (\n    hsg_mwe_dist.mean().numpy()[..., 0],\n    hsg_mwe_dist.stddev().numpy()[..., 0],\n    hsg_mwe_dist.sample(num_samples).numpy()[..., 0]\n    )\n\n\ncad_mwe_mean, cad_mwe_dist = generate_forecast(cad_mwe_model_reg, \n                                                       cad_mwe_var_post_reg,\n                                                       cad_mwe_trunc,\n                                                       num_forecast_steps)\nplot_forecast_future(cad_mwe_dist, mwe_forecast_yrs, cad_mwe_full, \n                     'CAD Median Weekly Earnings')\n(\n    cad_mwe_forecast_mean,\n    cad_mwe_forecast_scale,\n    cad_mwe_forecast_samples\n) = (\n    cad_mwe_dist.mean().numpy()[..., 0],\n    cad_mwe_dist.stddev().numpy()[..., 0],\n    cad_mwe_dist.sample(num_samples).numpy()[..., 0]\n    )\n\n\nbhd_mwe_mean, bhd_mwe_dist = generate_forecast(bhd_mwe_model_reg, \n                                                       bhd_mwe_var_post_reg,\n                                                       bhd_mwe_trunc,\n                                                       num_forecast_steps)\nplot_forecast_future(bhd_mwe_dist, mwe_forecast_yrs, bhd_mwe_full, \n                     'BHD Median Weekly Earnings')\n(\n    bhd_mwe_forecast_mean,\n    bhd_mwe_forecast_scale,\n    bhd_mwe_forecast_samples\n) = (\n    bhd_mwe_dist.mean().numpy()[..., 0],\n    bhd_mwe_dist.stddev().numpy()[..., 0],\n    bhd_mwe_dist.sample(num_samples).numpy()[..., 0]\n    )\n\ncolor_dict = {'LHS': 'peru', 'HSG': 'darkorange', 'CAD': 'olivedrab', 'BHD': 'teal', 'overall': 'grey'}\n### plotting Median Weekly Earnings forecasts together ###\nplt.plot(full_df['YEAR'], full_df['LHS MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'],\n         marker='o',linestyle=':', color=color_dict['LHS'], label='LHS')\nplt.hlines(full_df['LHS MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].to_numpy()[19],\n           full_df['YEAR'].to_numpy()[19], mwe_forecast_yrs[-1], linestyle='-.', \n           color=color_dict['LHS'])\nplt.plot(forecast_years, \n         (lhs_mwe_forecast_samples.T), lw=1, color=color_dict['LHS'], alpha=0.4)\nplt.plot(forecast_years, lhs_mwe_forecast_mean, lw=2, ls='--', \n         color=color_dict['LHS'])\nplt.fill_between(forecast_years,\n               lhs_mwe_forecast_mean-2*lhs_mwe_forecast_scale,\n               lhs_mwe_forecast_mean+2*lhs_mwe_forecast_scale, \n                 color=color_dict['LHS'], alpha=0.2)\n\n\nplt.plot(full_df['YEAR'], full_df['HSG MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'],\n         marker='o',linestyle=':', color=color_dict['HSG'], label='HSG')\nplt.hlines(full_df['HSG MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].to_numpy()[19],\n           full_df['YEAR'].to_numpy()[19], mwe_forecast_yrs[-1], linestyle='-.', \n           color=color_dict['HSG'])\nplt.plot(forecast_years, \n         (hsg_mwe_forecast_samples.T), lw=1, color=color_dict['HSG'], alpha=0.4)\nplt.plot(forecast_years, hsg_mwe_forecast_mean, lw=2, ls='--', \n         color=color_dict['HSG'])\nplt.fill_between(forecast_years,\n               hsg_mwe_forecast_mean-2*hsg_mwe_forecast_scale,\n               hsg_mwe_forecast_mean+2*hsg_mwe_forecast_scale, \n                 color=color_dict['HSG'], alpha=0.2)\n\n\nplt.plot(full_df['YEAR'], full_df['CAD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'],\n         marker='o',linestyle=':', color=color_dict['CAD'], label='CAD')\nplt.hlines(full_df['CAD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].to_numpy()[19],\n           full_df['YEAR'].to_numpy()[19], mwe_forecast_yrs[-1], linestyle='-.', \n           color=color_dict['CAD'])\nplt.plot(forecast_years, \n         (cad_mwe_forecast_samples.T), lw=1, color=color_dict['CAD'], alpha=0.4)\nplt.plot(forecast_years, cad_mwe_forecast_mean, lw=2, ls='--', \n         color=color_dict['CAD'])\nplt.fill_between(forecast_years,\n               cad_mwe_forecast_mean-2*cad_mwe_forecast_scale,\n               cad_mwe_forecast_mean+2*cad_mwe_forecast_scale, \n                 color=color_dict['CAD'], alpha=0.2)\n\n\nplt.plot(full_df['YEAR'], full_df['BHD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'],\n         marker='o',linestyle=':', color=color_dict['BHD'], label='BHD')\nplt.hlines(full_df['BHD MEDIAN WEEKLY EARNING (IN 2020 DOLLARS)'].to_numpy()[19],\n           full_df['YEAR'].to_numpy()[19], mwe_forecast_yrs[-1], linestyle='-.', \n           color=color_dict['BHD'])\nplt.plot(forecast_years, \n         (bhd_mwe_forecast_samples.T), lw=1, color=color_dict['BHD'], alpha=0.4)\nplt.plot(forecast_years, bhd_mwe_forecast_mean, lw=2, ls='--', \n         color=color_dict['BHD'])\nplt.fill_between(forecast_years,\n               bhd_mwe_forecast_mean-2*bhd_mwe_forecast_scale,\n               bhd_mwe_forecast_mean+2*bhd_mwe_forecast_scale, \n                 color=color_dict['BHD'], alpha=0.2)\nplt.legend()\nplt.ylabel('Median Weekly Earnings (in 2020 dollars)')\nplt.xlabel('Year')\nplt.savefig('mwe_lf_historical_data_forecast.png', bbox_inches='tight')\nplt.show()","a7ab4e62":"The above plots provide the motivation for the dataset and this notebook.\nWe notice that for almost all educational attainment categories except BHD (Bachelors or Higher Degree), the median weekly income has stayed stagnant or decreased since 1979.\n\nThe second plot shows the percentage of population that are High School Graduates (HSG), and the percentage of population with a Bachelors or Higher Degree (BHD). Notice the large gap between the HSG percentage and BHD percentage which has widened over the years.\n\nGiven the low rates of college graduation in the country, the stagnation\/decrease of median weekly incomes for people without a Bachelors or Higher Degree is an alarming trend, suggesting that majority of the country's labor force has seen a stagnation or decrease in their weekly incomes since the 1980s.\n\nWe want to predict the future trend for the labor force statistics and median weekly incomes by educational attainment categories.\n\nOur goals are: \n(i) to estimate the labor force data for the future years 2020 to 2030 from past labor force data\n(ii) to estimate the median weekly earnings by highest educational attainment for the future years 2020 to 2030 from past earnings data and past and predicted labor force data.\n\nWe note from the median weekly earnings plot above, that there is a \"seasonal\"\/ periodic behavior in which we expect appears because of the financial crises that occur every 5-7 years in addition to a local linear trend for each of the categories.\n\nWe will begin our exploratory data analysis of this dataset by examining the seasonal trends in the median weekly earnings data for each category using a periodogram.","f25e31dd":"Since the data length is approximately 50 years, we will neglect the peaks close to 1\/50 years, and look at the next prominent peak in the periodogram to model with a seasonal trend. \n\nThe periodogram for the overall BHD %, the Overall LF Level, the Overall LF participation rate, and the Overall Employment Level, all show a peak at approximately 1\/24 years, suggesting using a seasonal trend with two seasons with a length of 12 years each. The periodogram for the overall HSG % shows no prominent peaks except for the peak at close to 1\/50 years, which we neglect. We will model the overall HSG % by a local linear trend without any seasonal component.","965b9850":"It appears that the labor force levels have also shown an uptick which the model is unable to predict. The dip at the end is probably because of Covid, and is again absent in the forecast. Yet, the forecast is only a few percent off from the actual statistics.","cf50481d":"### *Earnings by Educational Attainment*\n\n### Context\n\nHere's a graph from the Social Security Administration which shows that median annual earnings for all men above the age of 20 have decreased since 1988:\n![](https:\/\/www.ssa.gov\/policy\/docs\/factsheets\/at-a-glance\/earnings-men-1988-2018.svg)\n\nI wanted to better understand how educational attainment has affected the above trend, and determined wages over the years, and to come up with a model to predict future trends for wages for each educational attainment level. \n\nAs I began looking at the data from the Bureau of Labor Statistics website, there was a striking trend: the median weekly earnings for all persons who did not have a bachelors or higher degree had decreased from 1979 levels, in constant 2020 dollars: \n![](https:\/\/github.com\/hrideshkedia\/Earnings-by-Educational-Attainment\/raw\/main\/mwe_data.png)\nwhere the educational attainment levels are denoted by:\nLHS -- Less than High School diploma\nHSG -- High School Graduation\nCAD -- some College or Associates Degree\nBHD -- Bachelors or Higher Degree\n\nMy goal is use historical median weekly earnings data, and labor force data, obtained from the US Bureau of Labor Statistics and the US Census Bureau, to generate forecasts for median weekly earnings by educational attainment level for the years 2021-2030, and forecast how the above mentioned trend is likely to change or to continue.\n\n### Data\n\nThe data is collated from the US Bureau of Labor Statistics (https:\/\/www.bls.gov\/webapps\/legacy\/cpsatab4.htm) and (https:\/\/www.bls.gov\/cps\/cpswktabs.htm) and the US Census Bureau (https:\/\/www.census.gov\/data\/tables\/time-series\/demo\/income-poverty\/historical-income-people.html) to create the csv file uploaded here. The same dataset with more detailed documentation can be accessed here: https:\/\/www.kaggle.com\/hrideshkedia\/labor-force-and-earnings-by-educational-attainment\n\nI have omitted data on gender and race, to look solely at the correlation between educational attainment and median weekly earnings over the years. All of the data is for ages 25 and higher unless otherwise stated in the column header. \n\nAn important note is that all the earnings data are in constant base 2020 dollars. This removes the effects of inflation and makes it possible to compare the numbers over the years.\n\nThe data starts at the year 1960, but unfortunately only overall labor force data, and population percentages of persons with a high school graduation (HSG) and persons with a Bachelors or Higher Degree are available. Median weekly earnings data categorized by educational attainment is available from 1979 onwards, while labor force data i.e., labor force level, labor force participation rate and the employment level by educational attainment is available only from 1992 onwards. \n\nThe only columns that have data from 1960 onwards are: (i) overall labor force level, (ii) civilian non-institutional population level, (iii) overall labor force participation rate, (iv) overall employment level, (v) overall percentage of high school graduates, and (vi) overall percentage of persons with a bachelors degree or higher.\n\n### Question:\n\nThe main question is: what is the best way to generate forecasts for median weekly earnings for each educational attainment level?\n\n### Approach:\n\nWe have at our disposal historical median weekly earnings data for each educational attainment level, and the labor force data for each educational attainment level, along with overall labor force data and the population percentage of persons with High School Graduation (HSG) and the population percentage of persons with a Bachelors or Higher Degree (BHD). \n\nWe will use two approaches to forecast the median weekly earnings data for each educational attainment level: (i) a model that uses only the historical median weekly earnings data for each educational attainment level (ii) a model that uses the historical and forecasted labor force data along with the median weekly earnings data for each educational attainment level. \n\nThe idea behind the 1st approach is simple: to identify the linear and seasonal trends in the historical data, and use that to generate a forecast for the future. \n\nThe idea behind the 2nd approach is that in addition to historical trends, earnings must be determined by market factors and the supply of labor, which are to captured to some extent by the available labor force  data: the labor force level, the employment level and the labor force participation rate. The 2nd approach forecasts the trends in the market forces and labor supply and attempts to capture the dependence of earnings on these factors in addition to the historical trends. The drawback of the 2nd approach is that the labor force data for each educational attainment level is available only from 1992 onwards, while the historical median weekly earnings for each educational level is available for 1979 onwards. We use the historical median weekly earnings data only from 1992 onwards in this approach, losing out on a decade of data. \n\nWe will present forecasts using both approaches.\n\n### Method:\n\nSince we want to forecast values of the median earnings and the labor force variables a decade into the future and not just one year into the future, we  will use Structural Time Series (STS) models from the Tensor Flow Probability package instead of other machine learning methods which require much more data to fit, and often involve errors that accumulate rapidly over time for future predictions. We will use [this fantastic example notebook from TensorFlow Probability](https:\/\/colab.research.google.com\/github\/tensorflow\/probability\/blob\/main\/tensorflow_probability\/examples\/jupyter_notebooks\/Structural_Time_Series_Modeling_Case_Studies_Atmospheric_CO2_and_Electricity_Demand.ipynb#scrollTo=ULm_Z8Oe0Lhd) as our guide.\n\n(i) In the first approach, we will build an STS model with a semi-local linear trend (to keep the variance bounded), and a seasonal component to forecast the values for the years 2021-2030, where we use a periodogram (a Fourier Transform really) to determine the durations and number of seasons. \n\n(ii) In the second approach, we will incorporate in addition to the above, a linear regression with the labor force data and its forecasted values as regressors. \nFor this, we need to forecast the labor force data for each educational attainment level. To do this we use both the past historical data for that educational level and labor force variable and regressors calculated from the overall data for that labor force variable by multiplying with the population percentages for high school (HSG) and bachelors (BHD) degrees. \n\n\n### Results:\n\n(i) Forecasts using only the historical median weekly earnings data for that educational attainment level:\n![](https:\/\/github.com\/hrideshkedia\/Earnings-by-Educational-Attainment\/raw\/main\/mwe_historical_forecast.png)\nwhere the mean of forecast distribution for each educational attainment level is shown in  dashed lines, and the shaded region around it denotes two standard deviations above and below the mean. \n\n(ii) Forecasts using the historical median weekly earnings data and labor force data and forecasts for that educational attainment level:\n![](https:\/\/github.com\/hrideshkedia\/Earnings-by-Educational-Attainment\/raw\/main\/mwe_lf_historical_data_forecast.png)\n\nWe notice that the simpler model which takes into account only the historical median earnings data for each educational attainment level has a lower variance, while the more complex model which takes into account both the historical median earnings data and the labor force data has a higher variance. This is a classic demonstration of the bias-variance tradeoff. The simpler model has a higher bias and a lower variance, while the more complex model likely has a lower bias but a higher variance because of limited data availability.\n\nWhile the variance of our forecasts differ between the two methods, both methods predict that median weekly earnings for persons with a Bachelors or Higher Degree will continue to rise, while the median weekly earnings for all other persons will stagnate over the next decade, at levels comparable to or lower than that in 1979, after adjusting for inflation. \n\nThis suggests that urgent steps are needed to make college education accessible to all.","e94f435e":"As described in the dataset,\n\n> This is data collated from the Bureau of Labor Statistics and Census websites, about the labor force levels and median weekly earnings in constant 2020 dollars, for persons aged 25 and higher, from 1960 onwards.\n> \n> Educational attainment levels are categorized as follows: \n>\n> LHS: Less than a High School Diploma, \n> \n> HSG: High School Graduation or passing GED or equivalent, \n> \n> CAD: Some College or Associates Degree, \n> \n> BHD: Bachelors or Higher Degree.\n> \n> The median weekly earnings data by educational attainment is available from 1979 onwards, while the labor force data by educational attainment is available from 1992 onwards. However, the overall labor force and median weekly earnings data, and the percentage of population with high school graduation and with a bachelors degree or higher is available from 1960 onwards.\n\nThe rows for labor force data are unavailable for years 1960-1991, while the median weekly earnings data are unavailable for years 1960-1978, as stated above. However, overall labor force data and overall median weekly earnings (for ages 15 and above) are available.","970bf21f":"We see that the periodograms for all the category-wise LF Levels have multiple peaks. Since the duration of the data is close to 20 years, we will neglect the peaks close to 1\/20 years (~0.05), and only attempt to capture the next highest peak.  \nFor the LHS, HSG, CAD and BHD LF Levels we see peaks at 1\/4, 1\/12, 1\/12, and 1\/8 years.","74fb196a":"Replotting the periodogram for the category-wise median weekly earnings data:","cc3e3d5d":"The model is unable to forecast the increase in the BHD Labor Force level over the past six years. ","172ee850":"A look at the columns of the data set:","3d0499e5":"The model is unable to predict the recent upward trend in the median weekly earnings for persons with less than a high school diploma.\n\nWe will now use the above trained models which use only the past MWE data for that category to generate forecasts for the years 2021-2030.","6d202356":"We will now try the other more involved method, using past category-wise data, along with overall data. For this we will construct an estimate of the category-wise data using the overall data for the concerned variable and multiplying it with the population fractions for HSG and BHD, which are known.","e8ce12c1":"The HSG percent and the BHD percent forecasts show a clear upward trend, while the labor force forecasts have high variance with either saturation or a downward trend.","7cb959dd":"The past data appears to provide a good forecast for the future participation rates. We will now use an estimate of the labor force participation rates from the overall data as a regressor in our models.","d1cf3b33":"We will now estimate the median weekly earnings (MWE) for each educational attainment category by using the historical MWE data for that category (1992 onwards) and the labor force data for that category as regression variables, since the category-wise labor force data is available only for years 1992 onwards.","bf6b595f":"The LHS and HSG employment levels are predicted to either stagnate or decrease, while the CAD and BHD employment levels are predicted to steadily increase.","8a5cbc5f":"The percentage of persons with a Bachelors or Higher Degree is expected to come close to 50 % over the next decade.","94b643b3":"Since the length of the time series is approximately 30 years, we will neglect the peaks in the periodogram that are close to 1\/30, and only attempt to capture the next prominent peak through a seasonal trend component in our models. \n\nThe LHS MWE (Median Weekly Earnings), HSG MWE, CAD MWE and BHD MWE periodograms show prominent peaks at approximately 1\/10 years, 1\/16 years, 1\/16 years and 1\/10 years respectively. We will use a seasonal trend model to capture these trends with the number of seasons set to two, and number of years per season set to half the period corresponding to the peak of the periodogram.\n\nFor the LHS, CAD and BHD Median Weekly Earnings, we will use a seasonal trend with 2 seasons of 5 years each, while for the HSG Median Weekly Earnings we will use a seasonal trend with 2 seasons of 8 years each. \n\n***We will forecast the median weekly earnings for each educational attainment category by two methods: (i) based only on historical MWE data for that category, and (ii) based on historical MWE data for that category, and the labor force data forecasts for that category.***\n\n***Since we want to forecast values of the median earnings and the labor force variables a decade into the future and not just one year into the future, we  will use Structural Time Series models from the Tensor Flow Probability package instead of other machine learning methods which require much more data to fit, and often involve errors that accumulate quickly for future predictions. We will use [this fantastic example notebook from TensorFlow Probability](https:\/\/colab.research.google.com\/github\/tensorflow\/probability\/blob\/main\/tensorflow_probability\/examples\/jupyter_notebooks\/Structural_Time_Series_Modeling_Case_Studies_Atmospheric_CO2_and_Electricity_Demand.ipynb#scrollTo=ULm_Z8Oe0Lhd) as our guide.\nWe will build an STS model with a semi-local linear trend (to keep the variance bounded), and a seasonal component to forecast the values for the years 2021-2030.***","5c06a21e":"Neglecting the peak at ~1\/20 years, we see peaks at 1\/5, 1\/12, 1\/12, and 1\/12 years for the LHS, HSG, CAD and BHD Labor Force Participation rates. This suggests using a seasonal trend with two seasons and season duration set to 2, 6, 6, and 6 years for the LHS, HSG, CAD and BHD Labor Force Participation rates.","ff0757e5":"It looks like the Semi-local linear trend model does a good job of forecasting the percent of persons with high school graduation over the last decade. ","b52fff42":"Here the rise before the pandemic and the dip due to the pandemic is not captured by the model.\n\nWe will now use the above models to forecast the Overall Labor Force Variables: HSG Percent, BHD Percent, Labor Force Level, Employment Level, Labor Force Participation Rate, for the years 2021-2030.","d26491a7":"Using the Labor force data forecasts, we see a stagnation for the median weekly earnings for all categories except BHD (persons with Bachelors or Higher Degree), similar to the forecasts based only on past median weekly earnings data. \n\nOur conclusion is that for persons without a bachelors degree, earnings are going to stagnate or decrease in the coming years. This suggests that we must strive to make college education accessible to all.","ca2eb93a":"***We are interested in forecasting the educational category-wise labor force variables and the educational category-wise median weekly earnings. For this, we will forecast the category-wise data for the labor force variables in two ways: (i) using only the past category-wise data for that variable, and (ii) using the past category-wise data and the overall data along with the population fractions of HSG and BHD multipied with the overall data for that variable as a regression variable. We will use a semilocal linear trend and a seasonal trend with a seasonal duration determined from a periodogram of the data.***\n\n***Finally we will use these forecasts of the category-wise labor force variables and the past data for the category-wise median weekly earnings to forecast the category-wise median weekly earnings.***","38c22dd9":"We now try using the overall data as regressors in addition to the past data trends for the employment level. ","e76cafeb":"It looks like the percentage of persons with a Bachelors Degree or Higher has increased considerably in the last decade compared to past decades, and the model is unable to forecast that.","ecab8657":"We see a significantly improved forecast for the BHD employment level, but do not see a  significant improvement for the other category-wise employment level forecasts.\n\nThis suggests using the regressor models only for the BHD employment levels. \n\nWe will now perform the same analysis for the category-wise Labor Force Participation Rates.","b6398462":"Neglecting the peak at ~1\/ 20 years, the LHS, HSG, CAD and BHD employment levels show peaks at 1\/8, 1\/8, 1\/6, and 1\/8 years respectively. We will set the number of steps per season accordingly at 4, 4, 3, and 4 years with 2 seasons for the seasonal trend components of the LHS, HSG, CAD and BHD employment level models. ","f7b6b71a":"We see that none of the forecasts have improved significantly by using the regression variables. This suggests using the models based on only the past data for all the category-wise Labor force participation rate forecasts. \n\n***We will now use the above defined models to generate forecasts for the years 2021-2030 for the category-wise labor force variables. Finally we will use the category-wise labor force data forecasts and the past data to generate forecasts for the category-wise median weekly incomes.***","f1a5b51e":"Here, the model is unable to account for the upward trend in employment levels at the beginning of the last decade, and the late dip likely due to the pandemic.","4fca2c71":"Defining the model building, model fitting and forecasting functions.","259980a9":"We see that while the forecasts for the BHD and CAD Labor Force Levels has improved,  the forecasts for the LHS Labor Force Level has deteriorated and that for the HSG Labor Force Levels has remained the same. This suggests using the regressor variables for the  CAD and BHD LF Level forecast, and using only the past data for the LHS, and HSG LF Level forecasts.\n\nWe will now compare these two methods for the Employment Levels.","68cf57e6":"***We will now build a forecasting model for the category-wise Median Weekly Earnings using the available labor force data in addition to the median weekly earnings data.***\n\n***Since the overall labor force data is available for a longer period of time (1960 onwards), we will begin by building models to generate forecasts for the overall labor force data. We will then build models for the category-wise labor force data, using the overall labor force data forecasts multiplied by the HSG and BHD population percentages as a regressor. Finally we will build models for the category-wise median weekly earnings data using the category-wise labor force data forecasts as regressors, and compare our forecasts to the forecast based purely on the historical trend shown above.***\n\nPlotting the overall labor force data, and building models to generate forecasts for it:","1f6ad345":"For each category and the labor force variables, we will now build a BSTS model that has a seasonal component and a semi-local linear trend component, to estimate the values for the years 2021-2030.\n\nWe begin by collating the overall and category-wise data.","6920d39f":"Except for the LHS category, the Labor Force participation rates for all other categories have been decreasing steadily, without a significant change due to the pandemic, and the trend is predicted to continue.\n\nWe are now ready to forecast the category-wise median weekly earnings using the past median weekly earnings data and the labor force data forecasts. We begin by replotting the forecasts of the median weekly earnings based only on the past median weekly earnings data:","46bebfe2":"It looks like for each of plots above, the overall quantity behaves like a weighted average of the corresponding quantity for LHS, HSG, CAD and BHD categories, as we might expect. Since the overall quantities have more historical data available, their forecasts may be more reliable, and could be used in generating forecasts for the category-wise labor force variables.\n\nWe would like to predict for the future years, for each of categories (LHS, HSG, CAD, BHD), the independent Labor force variables: Labor Force Level, Labor Force Participation Rate, and the Labor Force Employment Level. ","36c75f09":"***We see that based only on the past data, the Median Weekly Earnings for the BHD category are predicted to rise steadily, while the Median Weekly Earnings forecasts for the other categories have high variance and are expected to saturate.***","bcb35636":"Applying the above machinery to forecast values of Overall HSG percent, Overall BHD percent, Overall Labor Force Level, Overall Labor Force Participation Rate, and the Overall Employment Level. ","19e41f51":"We see that using the regressor variables leads to roughly the same performance for all categories.\n\nWe will now generate forecasts for the category-wise median weekly earnings using the labor force data forecasts for each category in addition to the historical median weekly earnings data.","4c8498ea":"While the LHS and HSG Labor Force Levels are predicted to go down, the CAD and BHD Labor Force Levels are predicted to increase. This is in keeping with the rising percentages of high school graduation, and college attendance. ","368e72b4":"While the LHS and BHD population fractions are accurately determined by 1 - HSG and BHD population fractions, the HSG and CAD (as highest educational attainment) population fractions are not so clear. So we use both multiplied by the Overall Labor Force Level along with the BHD - HSG population fraction multiplied by the Overall Labor Force Level as regression variables for the HSG and CAD data."}}