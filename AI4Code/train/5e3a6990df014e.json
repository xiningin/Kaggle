{"cell_type":{"3f1c1cad":"code","3ba8b5e9":"code","e8d10bc8":"code","67cfba90":"code","42f1542e":"code","dc06d62a":"code","4c9843e6":"code","a1415f62":"code","46dbb6dd":"code","9623b3c5":"code","4813508f":"code","3187c8bd":"code","dda5e2be":"code","70f5ae52":"code","6a9d8473":"code","d095b7d1":"code","023b477c":"code","e32c22c5":"code","27909e05":"markdown","1268a811":"markdown","ebabb842":"markdown","9126046e":"markdown","93abd6f4":"markdown"},"source":{"3f1c1cad":"import cv2\nimport numpy as np\nimport pandas as pd\nimport tensorflow as tf\nimport matplotlib.pyplot as plt\n\nfrom sklearn.model_selection import train_test_split","3ba8b5e9":"csv = pd.read_csv(\"..\/input\/chinese-mnist\/chinese_mnist.csv\")\nprint(csv)","e8d10bc8":"X = []\ny = []\nfor row in csv.itertuples():\n    suite_id = row[1]\n    sample_id = row[2]\n    code = row[3]\n    file_name = f\"input_{suite_id}_{sample_id}_{code}.jpg\"\n    x = cv2.imread(f\"..\/input\/chinese-mnist\/data\/data\/{file_name}\")\n    X.append(x)\n    one_hot = [0] * 15\n    one_hot[code - 1] = 1\n    y.append(one_hot)\nX = np.array(X)\ny = np.array(y)\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)","67cfba90":"print(X_train.shape)\nprint(y_train.shape)","42f1542e":"model_base = tf.keras.Sequential([\n    tf.keras.layers.Conv2D(filters=32,\n                           kernel_size=(3,3),\n                           padding=\"same\",\n                           activation=\"relu\",\n                           input_shape=[64, 64, 3]),\n    tf.keras.layers.MaxPooling2D((2,2)),\n    tf.keras.layers.Conv2D(filters=64,\n                           kernel_size=(3,3),\n                           padding=\"same\",\n                           activation=\"relu\"),\n    tf.keras.layers.MaxPooling2D((2,2)),\n    tf.keras.layers.Conv2D(filters=64,\n                           kernel_size=(3,3),\n                           padding=\"same\",\n                           activation=\"relu\"),\n    tf.keras.layers.MaxPooling2D((2,2)),\n    tf.keras.layers.Flatten(),\n    tf.keras.layers.Dense(64, activation=\"relu\"),\n    tf.keras.layers.Dense(15, activation=\"softmax\")\n])\nmodel_base.compile(optimizer='adam',\n                   loss='categorical_crossentropy',\n                   metrics=['accuracy'])\nmodel_base.summary()","dc06d62a":"history = model_base.fit(X_train, y_train, epochs=20, \n                    validation_data=(X_test, y_test))","4c9843e6":"plt.plot(history.history['accuracy'], label='accuracy')\nplt.plot(history.history['val_accuracy'], label = 'val_accuracy')\nplt.xlabel('Epoch')\nplt.ylabel('Accuracy')\nplt.ylim([0.5, 1])\nplt.legend(loc='lower right')","a1415f62":"sample = cv2.imread(\"..\/input\/chinese-mnist\/data\/data\/input_100_10_4.jpg\")\nplt.imshow(sample)\nsample = np.array([sample])\nsample_prediction = np.argmax(model_base.predict([sample]))\nprint(f\"Prediction: {sample_prediction}\")","46dbb6dd":"prediction_base = model_base.predict(X_test)\nbinary_base = tf.keras.metrics.categorical_accuracy(y_test, prediction_base)\nprint(f\"The accuracy of the model is: {np.sum(binary_base)\/y_test.shape[0]}\")","9623b3c5":"num_models = 10\nmodel_ensemble = [None] * num_models\n\nfor i in range(num_models):\n    model_ensemble[i] = tf.keras.Sequential([\n        tf.keras.layers.Conv2D(filters=32,\n                               kernel_size=(3,3),\n                               padding=\"same\",\n                               activation=\"relu\",\n                               input_shape=[64, 64, 3]),\n        tf.keras.layers.MaxPooling2D((2,2)),\n        tf.keras.layers.Conv2D(filters=64,\n                               kernel_size=(3,3),\n                               padding=\"same\",\n                               activation=\"relu\"),\n        tf.keras.layers.MaxPooling2D((2,2)),\n        tf.keras.layers.Conv2D(filters=64,\n                               kernel_size=(3,3),\n                               padding=\"same\",\n                               activation=\"relu\"),\n        tf.keras.layers.MaxPooling2D((2,2)),\n        tf.keras.layers.Flatten(),\n        tf.keras.layers.Dense(64, activation=\"relu\"),\n        tf.keras.layers.Dense(15, activation=\"softmax\")\n    ])\n    model_ensemble[i].compile(optimizer='adam',\n                   loss='categorical_crossentropy',\n                   metrics=['accuracy'])","4813508f":"history = [None] * num_models\n\nfor j in range(num_models):\n    X_train_ens, X_test_ens, y_train_ens, y_test_ens = train_test_split(X_train, y_train, test_size=0.1, random_state=j)\n    history[j] = model_ensemble[j].fit(X_train_ens, y_train_ens, epochs=20, \n                                       validation_data=(X_test_ens, y_test_ens))\n    print(f\"Model {j+1} of 10:\")\n    print(f\"Best training accuracy: {max(history[j].history['accuracy'])}\")\n    print(f\"Best validation accuracy: {max(history[j].history['val_accuracy'])}\")","3187c8bd":"prediction_ensemble = np.zeros(y_test.shape)\nfor k in range(num_models):\n    prediction_ensemble = prediction_ensemble + model_ensemble[j].predict(X_test)\nprediction_ensemble = prediction_ensemble \/ num_models\nbinary_ensemble = tf.keras.metrics.categorical_accuracy(y_test, prediction_ensemble)\nprint(f\"The accuracy of the model is: {np.sum(binary_ensemble)\/y_test.shape[0]}\")","dda5e2be":"input_img = tf.keras.layers.Input(shape=(64, 64, 3))\nconv_1 = tf.keras.layers.Conv2D(filters=16,\n                                kernel_size=(3,3),\n                                padding=\"same\",\n                                activation=\"relu\")(input_img)\nconv_2 = tf.keras.layers.Conv2D(filters=32,\n                                kernel_size=(3,3),\n                                padding=\"same\",\n                                activation=\"relu\")(conv_1)\nconv_3 = tf.keras.layers.Conv2D(filters=32,\n                                kernel_size=(3,3),\n                                padding=\"same\",\n                                activation=\"relu\")(conv_2)\nbranch_1 = tf.keras.layers.MaxPooling2D((2,2))(conv_3)\nconv_4 = tf.keras.layers.Conv2D(filters=32,\n                                kernel_size=(3,3),\n                                padding=\"same\",\n                                activation=\"relu\")(conv_3)\nconv_5 = tf.keras.layers.Conv2D(filters=64,\n                                kernel_size=(3,3),\n                                padding=\"same\",\n                                activation=\"relu\")(conv_4)\nconv_6 = tf.keras.layers.Conv2D(filters=64,\n                                kernel_size=(3,3),\n                                padding=\"same\",\n                                activation=\"relu\")(conv_5)\nbranch_2 = tf.keras.layers.MaxPooling2D((2,2))(conv_6)\nconv_7 = tf.keras.layers.Conv2D(filters=64,\n                                kernel_size=(3,3),\n                                padding=\"same\",\n                                activation=\"relu\")(conv_6)\nconv_8 = tf.keras.layers.Conv2D(filters=128,\n                                kernel_size=(3,3),\n                                padding=\"same\",\n                                activation=\"relu\")(conv_7)\nconv_9 = tf.keras.layers.Conv2D(filters=128,\n                                kernel_size=(3,3),\n                                padding=\"same\",\n                                activation=\"relu\")(conv_8)\nbranch_3 = tf.keras.layers.MaxPooling2D((2,2))(conv_9)\nconcat = tf.keras.layers.concatenate([branch_1, branch_2, branch_3], axis=-1)\nflatten = tf.keras.layers.Flatten()(concat)\ndense = tf.keras.layers.Dense(64, activation=\"relu\")(flatten)\noutput = tf.keras.layers.Dense(15, activation=\"softmax\")(dense)\nmodel_branching = tf.keras.models.Model(inputs=input_img, outputs=output)\nmodel_branching.compile(optimizer='adam',\n                   loss='categorical_crossentropy',\n                   metrics=['accuracy'])\nmodel_branching.summary()","70f5ae52":"history_branching = model_branching.fit(X_train, y_train, epochs=20, \n                              validation_data=(X_test, y_test))","6a9d8473":"plt.plot(history_branching.history['accuracy'], label='accuracy')\nplt.plot(history_branching.history['val_accuracy'], label = 'val_accuracy')\nplt.xlabel('Epoch')\nplt.ylabel('Accuracy')\nplt.ylim([0.5, 1])\nplt.legend(loc='lower right')","d095b7d1":"input_img = tf.keras.layers.Input(shape=(64, 64, 3))\nconv_1 = tf.keras.layers.Conv2D(filters=64,\n                                kernel_size=(3,3),\n                                padding=\"same\",\n                                activation=\"relu\")(input_img)\nconv_2 = tf.keras.layers.Conv2D(filters=64,\n                                kernel_size=(3,3),\n                                padding=\"same\",\n                                activation=\"relu\")(conv_1)\nconv_3 = tf.keras.layers.Conv2D(filters=64,\n                                kernel_size=(3,3),\n                                padding=\"same\",\n                                activation=\"relu\")(conv_2)\nbranch_1 = tf.keras.layers.MaxPooling2D((2,2))(conv_3)\nconv_4 = tf.keras.layers.Conv2D(filters=64,\n                                kernel_size=(3,3),\n                                padding=\"same\",\n                                activation=\"relu\")(conv_3)\nconv_5 = tf.keras.layers.Conv2D(filters=64,\n                                kernel_size=(3,3),\n                                padding=\"same\",\n                                activation=\"relu\")(conv_4)\nconv_6 = tf.keras.layers.Conv2D(filters=64,\n                                kernel_size=(3,3),\n                                padding=\"same\",\n                                activation=\"relu\")(conv_5)\nbranch_2 = tf.keras.layers.MaxPooling2D((2,2))(conv_6)\nconv_7 = tf.keras.layers.Conv2D(filters=64,\n                                kernel_size=(3,3),\n                                padding=\"same\",\n                                activation=\"relu\")(conv_6)\nconv_8 = tf.keras.layers.Conv2D(filters=64,\n                                kernel_size=(3,3),\n                                padding=\"same\",\n                                activation=\"relu\")(conv_7)\nconv_9 = tf.keras.layers.Conv2D(filters=64,\n                                kernel_size=(3,3),\n                                padding=\"same\",\n                                activation=\"relu\")(conv_8)\nbranch_3 = tf.keras.layers.MaxPooling2D((2,2))(conv_9)\nadded = tf.keras.layers.add([branch_1, branch_2, branch_3])\nflatten = tf.keras.layers.Flatten()(added)\ndense = tf.keras.layers.Dense(64, activation=\"relu\")(flatten)\noutput = tf.keras.layers.Dense(15, activation=\"softmax\")(dense)\nmodel_branching_summed = tf.keras.models.Model(inputs=input_img, outputs=output)\nmodel_branching_summed.compile(optimizer='adam',\n                   loss='categorical_crossentropy',\n                   metrics=['accuracy'])\nmodel_branching_summed.summary()","023b477c":"history_summed = model_branching_summed.fit(X_train, y_train, epochs=20, \n                              validation_data=(X_test, y_test))","e32c22c5":"plt.plot(history_summed.history['accuracy'], label='accuracy')\nplt.plot(history_summed.history['val_accuracy'], label = 'val_accuracy')\nplt.xlabel('Epoch')\nplt.ylabel('Accuracy')\nplt.ylim([0.5, 1])\nplt.legend(loc='lower right')","27909e05":"# Baseline CNN","1268a811":"# Branching ","ebabb842":"# Load data","9126046e":"# Ensemble method","93abd6f4":"## Sanity check"}}