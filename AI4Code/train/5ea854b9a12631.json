{"cell_type":{"fc8599f9":"code","aa01efee":"code","7922547d":"code","1ea25314":"code","340661a7":"code","4684c9b5":"code","16d58316":"code","9feba375":"code","b73bb921":"code","5bc10bcc":"code","5fc2e4f0":"code","8372c8f5":"code","2f3b4bea":"code","e1103c13":"code","c8683fbd":"code","7307e4fc":"code","9b02cf26":"code","7ad738c7":"code","07c68d7c":"code","729ef4b1":"code","44d93f9d":"code","963bc1b5":"code","246d0369":"code","f7e6e672":"code","54a89be4":"code","503f0302":"code","1024b895":"code","9290ef27":"markdown","d2fa0604":"markdown","9b65660c":"markdown","93d3a671":"markdown","957e5da4":"markdown","b340115a":"markdown","3f0fbefd":"markdown","8abef885":"markdown","a14d7754":"markdown","13a12c6d":"markdown","9d6b0bb1":"markdown","ba64904a":"markdown","73efdd15":"markdown","e309cd7b":"markdown","1545dd61":"markdown","dc831140":"markdown","d5c70f16":"markdown","4ab728e4":"markdown","6968e0ce":"markdown","31e91fb1":"markdown","be8d470d":"markdown","b8b2e46a":"markdown","4a06cf66":"markdown","99489be5":"markdown","628e1f85":"markdown","b7ab45af":"markdown","5a4c42e6":"markdown","35eac066":"markdown","52e94cde":"markdown","3fa9d2b1":"markdown","ac24e973":"markdown","ff5a09ae":"markdown","1fa47470":"markdown"},"source":{"fc8599f9":"#Importing libraries and setting plotstyle.\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport sqlite3\nplt.style.use('seaborn-darkgrid')\nsns.set(style='darkgrid', context='notebook', rc={'figure.figsize':(12,6)})","aa01efee":"path = \"..\/input\/\"\ndatabase = path + 'database.sqlite'\n\n# 1. Establish a connection to database.\nconn=sqlite3.connect(database)\n\n# 2. Query needed data.\nmatch_data=pd.read_sql_query('select league_id, season, date, home_team_api_id, away_team_api_id, home_team_goal, away_team_goal from Match;', conn, parse_dates=True)\nleague_data=pd.read_sql_query('select id, name AS league from League;', conn)\nteam_data=pd.read_sql_query('select team_api_id, team_long_name from Team;', conn)","7922547d":"match_data.info()","1ea25314":"league_data.info()","340661a7":"team_data.info()","4684c9b5":"#Tidy date column.\nmatch_data['date']=pd.to_datetime(match_data['date'],format='%Y-%m-%d')\n\nmatch_data.sort_values('date')\n\n#Check results.\nmatch_data.info()","16d58316":"#Merge match_data and league_data in order to replace league_id with league name.\nmatch_data=pd.merge(match_data, league_data, how='inner',left_on='league_id',right_on='id')\nmatch_data.head()","9feba375":"#Merge match_data and team_data in order to replace team_id with team name. \nmatch_data=match_data.merge(team_data, left_on='home_team_api_id',right_on='team_api_id')\nmatch_data=match_data.merge(team_data, left_on='away_team_api_id',right_on='team_api_id',suffixes=('_a'))\nmatch_data.head()","b73bb921":"#Rename columns.\nmatch_data.rename(index=str,columns={'team_long_name_':'home_team','team_long_namea':'away_team'},inplace=True)\nmatch_data.head()","5bc10bcc":"#Drop not relevant columns and ckeck final result.\nmatch_data.drop(['league_id','home_team_api_id','away_team_api_id', 'id', 'team_api_id_','team_api_ida'], axis=1, inplace=True)\nmatch_data.head()","5fc2e4f0":"#Create variable goal_diff\nmatch_data['goal_diff']=abs(match_data['home_team_goal']-match_data['away_team_goal'])\nmatch_data.head()","8372c8f5":"#Create variable goal_sum\nmatch_data['goal_sum']=match_data['home_team_goal']+match_data['away_team_goal']\nmatch_data.head()","2f3b4bea":"#Create variable under_over\ndef under_over(goal_sum):\n    if goal_sum>=3:\n        value='over 2,5'\n    else:\n        value='under 2,5'\n    return value\n\nmatch_data['under_over']=match_data['goal_sum'].apply(under_over)\nmatch_data.head()","e1103c13":"#Create variable 1X2 \ndef is_1X2(home_team_goal,away_team_goal):\n    if home_team_goal>away_team_goal:\n        value='1'\n    elif home_team_goal<away_team_goal:\n        value='2'\n    else:\n        value='X'\n    return value\nmatch_data['1X2']=match_data.apply(lambda x: is_1X2(x['home_team_goal'],x['away_team_goal']), axis=1)\nmatch_data.head()","c8683fbd":"#CREATING VARIABLE home1X\ndef home1X(home_team_goal,away_team_goal):\n    if home_team_goal>=away_team_goal:\n        value='yes'\n    else:\n        value='no'\n    return value\nmatch_data['home1X']=match_data.apply(lambda x: home1X(x['home_team_goal'],x['away_team_goal']), axis=1)","7307e4fc":"match_data['goal_sum'].describe()","9b02cf26":"#Plot the distribution of goal_sum and its evolution over the considered timeframe.\nplt.figure(figsize=(12,6))\nfigure, axes = plt.subplots(2, 1)\nplt.subplots_adjust(left=0.125, bottom=0.1, right=0.9, top=0.9, wspace=0.5, hspace=0.5)\nsns.distplot(match_data['goal_sum'], kde=False, ax=axes[0]).set_title('Distribution of goal scored')\nsns.lineplot(x='season',y='goal_sum',data=match_data, err_style=None, ax=axes[1]).set_title('How does the variable goal_sum evolve over time?')","7ad738c7":"#Plot under_over by league\nsns.countplot(y='league',hue='under_over', data=match_data)","07c68d7c":"#Create table with percentage of matches under_over for each league.\nmatch_data.groupby(by='league')['under_over'].value_counts(normalize=True).sort_values(ascending=False)","729ef4b1":"#WHICH TEAM HAVE SCORED THE MOST GOALS?\n#CREATING matche_home AND match_away and merge them into match_goal\nmatch_home=match_data.loc[:,('date','home_team','home_team_goal')]\nmatch_home.rename(index=str,columns={'home_team':'team','home_team_goal':'goal'},inplace=True)\n\nmatch_away=match_data.loc[:,('date','away_team','away_team_goal')]\nmatch_away.rename(index=str,columns={'away_team':'team','away_team_goal':'goal'},inplace=True)\n\nmatch_goal=pd.concat([match_home, match_away], ignore_index=True)\n\ngoal_scored_by_team=match_goal.groupby(by='team')\ngoal_scored_by_team.mean().sort_values('goal',ascending=False).head(20).plot(kind='bar', title='Goal scored by Team')\ngoal_scored_by_team.mean().sort_values('goal',ascending=False).head(5)","44d93f9d":"#Plot the distribution of goal_diff and its evolution over the considered timeframe.\nsns.lineplot(x='season',y='goal_diff',data=match_data, err_style=None).set_title('How does the variable goal_diff evolve over time?')","963bc1b5":"#Most equilibrated leagues.\ngoal_diff_by_league=match_data.groupby('league')[['league','goal_diff']]\ngoal_diff_by_league.mean().sort_values('goal_diff',ascending=True).plot(kind='bar', title='Most equilibrated leagues')\ngoal_diff_by_league.mean().sort_values('goal_diff',ascending=True).head()","246d0369":"#Create Series functional for plotting\nserres1X2=match_data['1X2'].value_counts(normalize=True)\nserhome1x=match_data['home1X'].value_counts(normalize=True)\n\nserhome1x","f7e6e672":"#Plotting Series\nf, axes = plt.subplots(1, 2)\nplt.subplots_adjust(left=0.125, bottom=0.1, right=0.9, top=0.9, wspace=0.5, hspace=0.5)\nsns.countplot(x='1X2', data=match_data, ax=axes[0])\nsns.countplot(x='home1X', data=match_data, ax=axes[1])","54a89be4":"#Print summary statistics of home_team_goal.\nmatch_data[['home_team_goal','away_team_goal']].describe()","503f0302":"#Plot the distribution of home_team_goal and its evolution over time.\nf, axes = plt.subplots(2, 1)\nplt.subplots_adjust(left=0.125, bottom=0.1, right=0.9, top=0.9, wspace=0.5, hspace=0.5)\nsns.distplot(match_data['home_team_goal'], kde=False, ax=axes[0]).set_title('Distribution of home_team_goal')\nsns.distplot(match_data['away_team_goal'], kde=False, ax=axes[1]).set_title('Distribution of away_team_goal')","1024b895":"f, axes = plt.subplots(2, 1)\nplt.subplots_adjust(left=0.125, bottom=0.1, right=0.9, top=0.9, wspace=0.5, hspace=0.5)\nsns.lineplot(x='season', y='goal_diff', hue='1X2', data=match_data, err_style=None, ax=axes[0]).set_title('Breakdown of goal_diff by final result')\nmatch_data.groupby(by='season')[['home_team_goal','away_team_goal']].mean().plot(ax=axes[1], title='Difference between goals scored at home and goals scored away')","9290ef27":"**Limitations**\n\nRegarding questions **4 - 5**, they are not providing an exhaustive explaination on the equilibrium of european football. The only variable that has been analyzed is the goal difference, which can had been influenced by many different factors not considered in this analysis (e.g. new rules, weather, etc.). For instance the variable goal_diff may not even reflect the equilibrium, but its growth may be explained saying that since during the period under analysis the average amount of goal scored on each match grew, the upward trend in goal_difference may be a simple consequence of that.\n\n\nRegarding question **6**, the fact that the data showed a substantial home advantage doeasn't mean that playing at the home field it is an actual advantage, but it can be caused by a number of external factors that we are not taking into account.","d2fa0604":"The distribution of goal_sum is positively skewed and the mean is 2.7. It means the on average, during the seasons 2008-2016, for each match 2.7 have been scored.\n\nThe variable goal_sum is following an upward trend, which means that the amount of goals scored during the timeframe under analysis has grown.","9b65660c":"The .describe method has been udes to get the summary statistics of the variable goal_sum.","93d3a671":"As you can see in the table and the chart above, the league that had shown the greatest incidence of matches ended up with 3 or more goals are:\n    \n1. Netherlands Eredivisie (58%)\n\n2. Switzerland Super League (56%)\n\n3. Germany 1. Bundesliga (56%)\n\n4. Belgium Jupiler League (53%)\n\n5. Spain LIGA BBVA (52%)","957e5da4":"## **Conclusions**\n\nAfter analysing the dataset it is now time to draw some conclusions. It is possible to state that during the seasons 2008-2016:\n\n\n\n- The amount of goals scored on each match had grown.\n\n\n- The leagues that had shown the greatest incidence of matches ended up with 3 or more goals are:\n\n    - Netherlands Eredivisie (58%)\n\n    - Switzerland Super League (56%)\n\n    - Germany 1. Bundesliga (56%)\n\n    - Belgium Jupiler League (53%)\n\n    - Spain LIGA BBVA (52%)\n    \n    \n- The teams that on average have scored the most on each match are:\n    \n    - FC Barcelona (2.8)\n    \n    - Real Madrid CF\t(2.8)\n    \n    - FC Bayern Munich (2.4)\n    \n    - PSV\t(2.4)\n    \n    - Ajax (2.4)\n    \n    \n-  The variable goal_diff has grown. It is hard to say if european football has become less equilibrated with the data avaliable here since this upward trend in goal_diff may be caused by a number of factors we are not taking into account in this analysis. But if we assume that goal_diff may be a measure of equilibrium, european football ha become less equilibrated.\n\n\n\n\n- The most equilibrated european leagues are:\n\n    - France Ligue 1\t\n    \n    - Poland Ekstraklasa\t\n    \n    - Italy Serie A\t\n    \n    - Portugal Liga ZON Sagres\t\n    \n    - England Premier League\n \n \n \n- The data showed again a substantial home advantage: \n\n    - The goal difference of the matches where the home team won is higher then the one where the away team won. This means the the team that win at home scored more than the onee that won away.\n    \n    - The most goals are scored at home.\n    \n    - 71% of matches had ended up with the home team winning or with a draw.\n    \n    - On average home team score more at home than away.\n","b340115a":"Acoording to the charts and the table shown above, we can state that: \n- The medians are equal: in 50% of instances, either one team score one goal.\n- The means are different: on average the home team scores more than the away team. It may be due to outliers, which are grater for home_team_goal.","3f0fbefd":"The parameter 'suffixies' has been added to the merge function in order to differentiate between team_long_name for home_team and away_team. Such parameter has to be used everytime the columns overlap after merging two dataframes.","8abef885":"<a id='eda'><\/a>\n## **Exploratory Data Analysis**","a14d7754":"### **5. Which are the most equilibrated leagues?**\n\nIn this case we are considering the mean of goal_diff to show which league had shown on average a low value of goal_diff, hence they are assumed to be more equilibrated.","13a12c6d":"### **Data Cleaning**\n\n- Merge match_data and league_data in order to replace league_id with league name.\n\n- Merge match_data and team_data in order to replace team_id with team name.\n\n- Rename columns.\n\n- Drop columns that are not relevant for the analysis.","9d6b0bb1":"In order to append the new columns using the fnctions created in the above cells the .apply function has been used. The . apply function applies a function along an axis of the DataFrame.","ba64904a":"As you can see, the datatype of the column 'date' changed from object to datetime.","73efdd15":"### **4. Has european football become more or less equilibrated?**\n\nThe variable under analysis is now goal_diff which the difference of the goals scored by the two teams. It is assumed to be a measure of competitiveness of a league becouse if the such difference is low, the match is assumed to be more equilibrated. Hence, if a league shows a low goal difference for each match, it is assumed to be more equilibrated and unpredictable.","e309cd7b":"**6.3 Evolution of home advantage over time**","1545dd61":"In the cell below the object oriented method has been used to create subplots using matplotlib and seaborn. The aforementioned method is comprised of two steps: in the first one you need to create a figure and then, in the second one, you can call different methods on it. ","dc831140":"<a id='wrangling'><\/a>\n## **Data Wrangling**","d5c70f16":"### **Create new variables**\n\nIn order to carry out the analysis the creation of the following variables is needed:\n\n- **goal_sum**: sum of goal scored in each match.\n\n- **goal_diff**: difference between goals scored by the two team. It is assumed to be the measure of balancedness of a match or a league.\n\n- **1X2**: final resul of the match. 1 if home_team won, X if draw and 2 if away_team won.\n\n- **under_over**: over if goal_sum>=3, otherwise under.\n\n- **home1X**: yes if home_team won or draw, no if away_team won.","4ab728e4":"Before analyzing the data we need to extract them from the database. In order to do so we need to:\n\n1. Establish a connection to the data base;\n\n2. Write SQL queries to extract them, since the data is stored in a SQL database.","6968e0ce":"### **3. What teams have scored the most?**\n\nIn order to find out which teams have scored the most we need to create a new dataframe, which will not take into account the fact that a team play at home or away. To do so we have to select all the matches played at home, then the matches played away and finally concatenate them into a single dataframe.","31e91fb1":"The 71% of matches had ended up with the home team winning or with a draw.","be8d470d":"During the seasons 2008-2016 most matches ended up win the home team winning or with a draw. The data showed a substatial home advantage.","b8b2e46a":"<a id='intro'><\/a>\n## **Introduction**\n\nThe aim of the project is to analyse the European Soccer Dataset (available on Kaggle https:\/\/www.kaggle.com\/hugomathien\/soccer\/home)\ncontaining results of matches played from 2008 to 2016 across the major european leagues and answering the following questions:\n\n- How is the amount of goal scored distributed? How is it evolving?\n\n- In which leagues are matches most likely to end up with three or more goal?\n\n- Which teams have scored the most?\n\n- Has european football become more or less equilibrated?\n\n- Which are the most equilibrated leagues?\n\n- Is there any evidence of home advantage?\n\nAs a measure of competitiveness it has been chosen the difference of the goals scored by the two teams. If the such difference is low, the match is assumed to be more equilibrated. Hence, if a league shows a low goal difference for each match, it is assumed to be more equilibrated and unpredictable.\n\nThe final question is aimed to show if during the seasons from 2008 and 2016 it has been a substantial home advantage. The home advantage is defined as the benefit that the home team is said to gain over the visiting team (https:\/\/en.wikipedia.org\/wiki\/Home_advantage) and it may be due to many different factors that we are not takining into consideration in this analysis. The main goal here is to find ou whether or not there had been evidence of home advantage during the perion under analysis.","4a06cf66":"### **6. Is there any evidence of home advantage?**\n\nThe home advantage is defined as the benefit that the home team is said to gain over the visiting team (https:\/\/en.wikipedia.org\/wiki\/Home_advantage) and it may be due to many different factors that we are not takining into consideration in this analysis. The main goal here is to find ou whether or not there had been evidence of home advantage during the perion under analysis. ","99489be5":"During the considered timeframe, the variable goal_diff has grown. It is hard to say if european football has become less equilibrated with the data avaliable here since this upward trend in goal_diff may be caused by a number of factors we are not taking into account in this analysis. It possible to state only that during the period under analysis the difference between the goal scored by the two teams has grown.\n\nBut if we assume that goal_diff may be a measure of equilibrium, european football ha become less equilibrated.","628e1f85":"**6.1 Static perspective on home advantage**","b7ab45af":"### **2. In which leagues are matches most likely to end up with three or more goal?**\n\nThe variable under analysis is now under_over. The chart below (created using seaborn) shows how the varible is distributed across the major european leagues.","5a4c42e6":"# **ANALYSIS OF MATCH OUTCOUMES ACROSS THE MAJOR EUROPEAN SOCCER LEAGUES**\n\n### **Table of Contents**\n<ul>\n<li><a href=\"#intro\">Introduction<\/a><\/li>\n<li><a href=\"#wrangling\">Data Wrangling<\/a><\/li>\n<li><a href=\"#eda\">Exploratory Data Analysis<\/a><\/li>\n<li><a href=\"#conclusions\">Conclusions<\/a><\/li>\n<\/ul","35eac066":"There is no missing data, only the column 'date' in match_data needs to be converted from object (string) to date time format.","52e94cde":"- The first chart shows that the goal difference of the matches where the home team won is higher then the one where the away team won. This means the the team that win at home scored more the they won away.\n\n- The second chart shows the most goals are scored at home.\n\nThe data showed again a substantial home advantage.\n\nConsidering **6.1** and **6.2** it is possible to state that over the seasons 2008-2016 there had been a substantial home advantage.","3fa9d2b1":"### ***1. How is the amount of goal scored distributed? How is it evolving?***","ac24e973":"The next step is to check if datatypes are correct and if any data is missing.","ff5a09ae":"In the chart shown above, you can see which are the most equilibrated leagues according to our assumption that the difference of the goals scored by the two teams is a good measure of equilibrium.","1fa47470":"**6.2 Distribution of goal scored at home**"}}