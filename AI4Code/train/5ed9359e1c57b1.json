{"cell_type":{"e176da2e":"code","d471e4ac":"code","9ff9d29d":"code","6a88b8ae":"code","e4d81c0c":"code","117830d5":"code","8d32a731":"code","3444f87d":"code","e0ac7062":"code","9d920e50":"code","5cac4c29":"code","3a96857f":"code","bed8983d":"code","86bd0d4d":"code","e0d38a95":"code","3542b35c":"markdown","23a4bc15":"markdown","b0e81a8f":"markdown","a2482b4b":"markdown"},"source":{"e176da2e":"import pandas as pd\nfrom sklearn.model_selection import train_test_split\nimport catboost\nfrom catboost import CatBoostClassifier\nfrom sklearn.metrics import log_loss\n\ndf = pd.read_csv('..\/input\/tabular-playground-series-may-2021\/train.csv')","d471e4ac":"new_df = df.copy()","9ff9d29d":"clf = CatBoostClassifier(random_state = 0)","6a88b8ae":"def create_model(the_categorical_features_names, the_df, bool_full, drop_columns):\n    X = the_df.drop(drop_columns, axis=1)\n    X = the_df.drop(\"target\", axis=1)\n    y = the_df.target\n    \n    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state = 0) \n    \n    for i in the_categorical_features_names:\n        X[i] = X[i].astype('category')\n    if (bool_full):\n        clf.fit(X,y, cat_features=the_categorical_features_names, eval_set=(X_test, y_test),logging_level = 'Silent')\n    else:\n        clf.fit(X_train,y_train, cat_features=the_categorical_features_names, eval_set=(X_test, y_test), logging_level = 'Silent')\n        \n        predictions = clf.predict_proba(X_test)\n        predictions\n        log_loss_result = log_loss(y_test, predictions)\n        round(log_loss_result, 5)","e4d81c0c":"categorical_features_names = list(new_df.columns)\ncategorical_features_names.remove(\"target\")\n# categorical_features_names.remove(\"id\")","117830d5":"features_max_df = pd.DataFrame(columns=[\"Name\", \"MaxValue\"])\nf_features_names = list(df.columns)\nf_features_names.remove('id')\nf_features_names.remove('target')","8d32a731":"for i, d in enumerate(f_features_names):\n    feature_max_value = df[d].max()\n    features_max_df.loc[i] = [d, feature_max_value]\n\nfeatures_max_df.head(2)        ","3444f87d":"def create_features_below_list(below_number):\n    return list(features_max_df[features_max_df.MaxValue < below_number][\"Name\"])","e0ac7062":"features_below_10 = create_features_below_list(10)\nfeatures_below_20 = create_features_below_list(20)\nfeatures_below_30 = create_features_below_list(30)\nfeatures_below_40 = create_features_below_list(40)\nprint(\"features_below_10 = \", features_below_10)","9d920e50":"# Convert all features into 'category'\n# create_model(categorical_features_names, new_df, True, [\"id\"]) # Public Score: 1.09196\n# create_model(categorical_features_names, new_df, True, []) # Public Score:1.08975\n\n# Convert only features with max value below ten\n# create_model(features_below_10, new_df, True, []) # Public Score: 1.09522\n# create_model(features_below_20, new_df, True, []) # Public Score: 1.09321\n# create_model(features_below_30, new_df, True, []) # Public Score: 1.09379\ncreate_model(features_below_40, new_df, True, [])","5cac4c29":"test_df = pd.read_csv('..\/input\/tabular-playground-series-may-2021\/test.csv')\nsubmission_df = pd.read_csv('..\/input\/tabular-playground-series-may-2021\/sample_submission.csv')","3a96857f":"X = test_df.copy()\ntest_predictions = clf.predict_proba(X)\ntest_predictions\n","bed8983d":"df_test_predictions = pd.DataFrame(test_predictions, columns=[\"Class_1\", \"Class_2\", \"Class_3\", \"Class_4\"])\ndf_test_predictions.head(2)","86bd0d4d":"submission_df[\"Class_1\"] = df_test_predictions[\"Class_1\"]\nsubmission_df[\"Class_2\"] = df_test_predictions[\"Class_2\"]\nsubmission_df[\"Class_3\"] = df_test_predictions[\"Class_3\"]\nsubmission_df[\"Class_4\"] = df_test_predictions[\"Class_4\"]\nsubmission_df.head(2)","e0d38a95":"submission_df.to_csv('submission4.csv', index=False)","3542b35c":"## CatBoost","23a4bc15":"# TPSmay21 Categorical Features \nWhile exploring the data. I noticed that the max value of the features have small numbers. So maybe it can improve the prediction if converts features from numerical to categorical. I did it with CatBoost and indeed it improved the score.","b0e81a8f":"## Submission","a2482b4b":"Calculate max values of the features"}}