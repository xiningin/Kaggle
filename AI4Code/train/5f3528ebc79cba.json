{"cell_type":{"6e018524":"code","6ffd711d":"code","8fe7be90":"code","e3ec585f":"code","93a5892f":"code","d24ca058":"code","16d35481":"code","977eee35":"code","6cab0f8b":"code","f8d5b37a":"code","275db073":"code","d8f82520":"code","1f26582f":"code","f5d030f4":"code","2a46f63f":"code","4f1ebd30":"code","f6438f96":"code","1ea33811":"code","86a07579":"code","5dacf4cb":"code","10e13a2d":"code","fdd13c2c":"code","7e04cfd3":"markdown","573c03ee":"markdown","d3f1528f":"markdown","a1a135ea":"markdown","36eb6f59":"markdown","09187b0d":"markdown","3391da9a":"markdown","50309ced":"markdown","7c8217d5":"markdown","3f1117f3":"markdown","dc9b76c0":"markdown","e7f3908e":"markdown","e30ebd20":"markdown","ec1bcce3":"markdown","0e3d2c45":"markdown","2b7977ca":"markdown","5cd26129":"markdown","910f5910":"markdown"},"source":{"6e018524":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","6ffd711d":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.model_selection import train_test_split\nfrom sklearn import metrics\nfrom IPython.display import SVG\nfrom graphviz import Source\nfrom sklearn import tree\n%matplotlib inline\nfrom sklearn.metrics import classification_report, confusion_matrix\n","8fe7be90":"df = pd.read_csv(\"\/kaggle\/input\/stroke-prediction-dataset\/healthcare-dataset-stroke-data.csv\")\ndf.head()","e3ec585f":"df.info()","93a5892f":"df.nunique()","d24ca058":"\ndef age_values(age_values):\n  # refer https:\/\/www.beresfordresearch.com\/age-range-by-generation\/\n  if age_values < 9 :\n    return 'youth (< 9Y)'\n  elif 9 <= age_values < 25:\n    return 'gen_z (9-25Y)'\n  elif 25 <= age_values < 41:\n    return 'Millennials (25-41Y)'\n  elif 41 <= age_values < 57:\n    return 'gen_x (41-57Y)'\n  elif 57 <= age_values <67:\n    return 'boomers_ii (57-67Y)'\n  elif 67 <= age_values <76:\n    return 'boomer_i (67-76Y)'\n  elif 76 <= age_values < 94:\n    return 'post_war (76-94Y)'\n  elif age_value >= 94:\n    return 'ww_ii (94Y <)'\n  else:\n    return 'none'\n\ndef glucose_values(glucose_values):\n  #refer https:\/\/www.emedihealth.com\/manage-diabetes.html\n    if glucose_values < 53 :\n      return 'server_hypoglycemia (< 53)'\n    elif 53 <= glucose_values < 70:\n      return 'hypoglycemia (53-70)'\n    elif 70 <= glucose_values < 125:\n      return 'normal (70-125)'\n    elif 125 <= glucose_values < 200:\n      return 'high (125-200)'\n    elif  glucose_values > 200:\n      return 'metabolic_consequences (200 <)'\n    else:\n      return 'none'\n\ndef bmi_values(bmi_values):\n  #refer https:\/\/www.cdc.gov\/healthyweight\/assessing\/bmi\/adult_bmi\/index.html\n\n    if bmi_values < 18.5 :\n      return 'underweight (< 18.5)'\n    elif 18.5 <= bmi_values < 25:\n      return 'normal (18.5-25)'\n    elif 25 <= bmi_values < 30:\n      return 'overweight (25-30)'\n    elif  bmi_values >= 30:\n      return 'obese 30 <'\n    else:\n      return 'none'\n\n\ndf['age_class']=df['age'].apply(age_values)\ndf['glucose_class']=df['avg_glucose_level'].apply(glucose_values)\ndf['bmi_class']=df['bmi'].apply(bmi_values)\n\ndf.columns","16d35481":"ColumnName = ['gender', 'hypertension', 'heart_disease', 'ever_married', 'work_type', 'Residence_type', 'smoking_status', 'age_class', 'glucose_class', 'bmi_class' ]\n\n\nfor i in range(len(ColumnName)):\n    list_df = pd.DataFrame({''f'{ColumnName[i]}':   (df[ColumnName[i]].value_counts()) ,\n                          '% Samples  ': round(100* (df[ColumnName[i]].value_counts())\/(sum(df[ColumnName[i]].value_counts())),2),\n                          'from total': sum(df[ColumnName[i]].value_counts())\n    })\n    print(\"\")\n    print(list_df)\n    \n\n    if (not np.issubdtype(type(ColumnName[i]), np.number)):\n      valueCounts = df[ColumnName[i]].value_counts()\n      valueCounts.plot.bar()\n            \n    else: \n      df[ColumnName].hist()\n    \n    plt.ylabel('Counts')\n    plt.title(f'{ColumnName[i]}')\n    plt.show()","977eee35":"df_stroke = df[df['stroke'] == 1]\n\nfor i in range(len(ColumnName)):\n    list_df2 = pd.DataFrame({''f'{ColumnName[i]}':   (df[ColumnName[i]].value_counts()) ,\n                          '% Samples  ': round(100* (df[ColumnName[i]].value_counts())\/(sum(df[ColumnName[i]].value_counts())),2),\n                          ' total': sum(df[ColumnName[i]].value_counts()),\n                          'stroke':  df_stroke[ColumnName[i]].value_counts(),\n                           '%stroke': round(100*(df_stroke[ColumnName[i]].value_counts())\/ (df[ColumnName[i]].value_counts()),2)\n\n                           })\n    \n    plot_df2 = pd.DataFrame({'%stroke': round(100*(df_stroke[ColumnName[i]].value_counts())\/ (df[ColumnName[i]].value_counts()),2)})\n    \n    print(\"\")\n    print(list_df2)\n    plot_df2.plot(kind='bar', ylabel = '%')\n    plt.ylabel('Counts')\n    plt.title(f'{ColumnName[i]}')\n    plt.show()","6cab0f8b":"df.head()","f8d5b37a":"def age_values(age_values):\n  if age_values == 'none':\n    return 0\n  elif age_values == 'youth (< 9Y)' :\n    return 1\n  elif age_values == 'gen_z (9-25Y)' :\n    return 2\n  elif age_values == 'Millennials (25-41Y)':\n    return 3\n  elif age_values == 'gen_x (41-57Y)':\n    return 4\n  elif age_values == 'boomers_ii (57-67Y)':\n    return 5\n  elif age_values == 'boomer_i (67-76Y)' :\n    return 6\n  elif age_values == 'post_war (76-94Y)':\n    return 7\n  elif age_value == 'ww_ii (94Y <)':\n    return 8\n  else:\n    return 'none'\n\ndef glucose_values(glucose_values):\n    if glucose_values == 'none':\n      return 0\n    elif glucose_values =='server_hypoglycemia (< 53)' :\n      return 1\n    elif glucose_values == 'hypoglycemia (53-70)':\n      return 2\n    elif glucose_values == 'normal (70-125)' :\n      return 3\n    elif glucose_values == 'high (125-200)':\n      return 4\n    elif  glucose_values =='metabolic_consequences (200 <)':\n      return 5\n    else:\n      return 'none'\n\ndef bmi_values(bmi_values):\n    if bmi_values == 'none':\n      return 0\n    elif bmi_values == 'underweight (< 18.5)' :\n      return 1\n    elif bmi_values == 'normal (18.5-25)':\n      return 2\n    elif bmi_values =='overweight (25-30)':\n      return 3\n    elif  bmi_values == 'obese 30 <':\n      return 4\n    else:\n      return 'none'\n\ndef gender_value(gender_value):\n  if gender_value == 'Other':\n    return 0\n  elif gender_value =='Male':\n    return 1\n  elif gender_value =='Female':\n    return 2\n  else:\n    return 'none'\n\ndef ever_married1(ever_married1):\n  if ever_married1 == 'No':\n    return 0\n  elif ever_married1 == 'Yes':\n    return 1\n  else:\n      return 'none'\n  \ndef work_type1(work_type1):\n  if work_type1 == 'Never_worked':\n    return 0\n  elif work_type1 == 'children':\n    return 1\n  elif work_type1 == 'Self-employed':\n    return 2\n  elif work_type1 == 'Govt_job':\n    return 3\n  elif work_type1 == 'Private':\n    return 4\n  else:\n    return 'none'\n \ndef residence_type1(residence_type1):\n  if residence_type1 == 'Urban':\n    return 0\n  elif residence_type1 == 'Rural':\n    return 1\n  else:\n    return 'none'\n  \ndef smoking_value(smoking_value):\n  if smoking_value == 'Unknown':\n    return 0\n  elif smoking_value == 'never smoked':\n    return 1\n  elif smoking_value == 'formerly smoked':\n    return 2\n  elif smoking_value == 'smokes':\n    return 3\n  else:\n    return 'none'\n\ndf['age_class1'] = df['age_class'].apply(age_values)\ndf['glucose_class1'] = df['glucose_class'].apply(glucose_values)\ndf['bmi_class1']=df['bmi_class'].apply(bmi_values)\ndf['gender_value']=df['gender'].apply(gender_value)\ndf['ever_married1'] = df['ever_married'].apply(ever_married1)\ndf['work_type1'] = df['work_type'].apply(work_type1)\ndf['residence_type1'] = df['Residence_type'].apply(residence_type1)\ndf['smoking_value'] = df['smoking_status'].apply(smoking_value)\ndf.head()","275db073":"df.columns","d8f82520":"df.shape","1f26582f":"ColumnName1 = ['hypertension', 'heart_disease',\n       'age_class', 'glucose_class', 'bmi_class',\n       'age_class1', 'glucose_class1', 'bmi_class1', 'gender_value',\n       'ever_married1', 'work_type1', 'residence_type1', 'smoking_value']\nsns.heatmap(df[ColumnName1].corr(),cmap='YlGnBu',annot=True)","f5d030f4":"y = df.stroke\n# Select Features \nfeatures = ['hypertension', 'heart_disease',\n       'age_class1', 'glucose_class1', 'bmi_class1', 'gender_value',\n       'ever_married1', 'work_type1', 'residence_type1', 'smoking_value']\nX = df[features]","2a46f63f":"#splitting data\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size =0.4, random_state = 39)   #40% test and 60% training\n\n# Create the response for test dataset\ndtree = DecisionTreeClassifier(max_depth=4).fit(X_train, y_train)\ny_pred = dtree.predict(X_test)\n\n#Evaluate model: model accuracy, how often is the classifier correct?\nprint('Accuracy:', metrics.accuracy_score(y_test, y_pred))","4f1ebd30":"labels = X.columns\ngraph = Source(tree.export_graphviz(dtree ,feature_names = labels, max_depth = 4, filled = True))\ndisplay(SVG(graph.pipe(format='svg')))","f6438f96":"df_age_gp1 = df[df['age'] < 67]\ndf_age_bmi_gp1 = df_age_gp1[df_age_gp1['bmi_class1'] > 0]","1ea33811":"# Prediction target  ### Classifier\ny_gp1 = df_age_bmi_gp1.stroke\n# Select Features \nfeatures = ['hypertension', 'heart_disease',\n       'age_class1', 'glucose_class1', 'bmi_class1', 'gender_value',\n       'ever_married1', 'work_type1', 'residence_type1', 'smoking_value']\nX_gp1 = df_age_bmi_gp1[features]\nX_train_gp1, X_test_gp1, y_train_gp1, y_test_gp1 = train_test_split(X_gp1, y_gp1, test_size=0.3, random_state=61)\n\ndtree_gp1 = DecisionTreeClassifier(max_depth=4).fit(X_train_gp1, y_train_gp1)\n\ny_pred_gp1 = dtree_gp1.predict(X_test_gp1)\n\n\npredict_gp1 = pd.DataFrame(index=y_test_gp1.index)\npredict_gp1['stroke_actual'] = y_test_gp1\npredict_gp1['Predict'] = y_pred_gp1\n","86a07579":"\nprint('')\nprint(confusion_matrix(y_test_gp1,y_pred_gp1))\nprint(classification_report(y_test_gp1,y_pred_gp1))\n\npredict_gp1.head()","5dacf4cb":"df_age_gp2 = df[df['age'] >= 67]\ndf_age_bmi_gp2 = df_age_gp2[df_age_gp2['bmi_class1'] > 0]","10e13a2d":"# Prediction target  ### Classifier\ny_gp2 = df_age_bmi_gp2.stroke\n# Select Features \nfeatures = ['hypertension', 'heart_disease',\n       'age_class1', 'glucose_class1', 'bmi_class1', 'gender_value',\n       'ever_married1', 'work_type1', 'residence_type1', 'smoking_value']\nX_gp2 = df_age_bmi_gp2[features]\n\nX_train_gp2, X_test_gp2, y_train_gp2, y_test_gp2 = train_test_split(X_gp2, y_gp2, test_size=0.3, random_state=33)\n\ndtree_gp2 = DecisionTreeClassifier(max_depth=4).fit(X_train_gp2, y_train_gp2)\n\n\ny_pred_gp2 = dtree_gp2.predict(X_test_gp2)\n\n\npredict_gp2 = pd.DataFrame(index=y_test_gp2.index)\npredict_gp2['actual'] = y_test_gp2\npredict_gp2['Predict'] = dtree_gp2.predict(X_test_gp2)","fdd13c2c":"\nprint('')\nprint(confusion_matrix(y_test_gp2,y_pred_gp2))\nprint(classification_report(y_test_gp2,y_pred_gp2))\npredict_gp2.head()","7e04cfd3":"I will create Decision tree classifier for overall.","573c03ee":"# From Decision Tree above: I can divide them in 2 groups","d3f1528f":"# Let's prepare data for create Dicision Tree\n\nSetting string value to be numerical values ","a1a135ea":"# Importing the Necessary Libraries","36eb6f59":"from previouse, I know about \n\n* 1544 unknowns of Smoking_status, \n\n* 201 missing value of bmi \n\n* and 1 other of gender\n\n\nThey are set value zero number in each columns: 'unknowns of smoking_value' , 'missing value of bmi and other of gender\n\nI will consider for each leave nodes.","09187b0d":"Now I have aded numeric columns representing string columns as below:\n\n* age_class1\n* glucose_class1\n* bmi_class1\n* gender_value\n* ever_married1\n* work_type1\n* residence_type1\n* smoking_value","3391da9a":"I see columns not only bmi have missing & unknown value\n\n* gender: 1 case => missing\n* smoking status: 1544 cases => unknown\n* bmi: 201 cases => missing","50309ced":"Now there are 3 columns, have been added!\n* age_class\n* gluclose_class\n* bmi_class","7c8217d5":"# Review overall data","3f1117f3":"# Read Data & Review","dc9b76c0":"# Group 1: age class1 in rank less than 5.5\nit means: **Group of younger than 67 years**\n\n* age class1 rank less than 4.5 => younger than 57 years\n* age class1 rank between 4.5 - 5.5, it mean age 57-67 years this group inclues bmi class1 <= 0.5 that is missing value. \n\nso I will remove it and prediction, again.\n\n* 1. sort age in range of less than 67 years\n* 2. remove bmi_class1 =  0, it is missing value ","e7f3908e":"# As below is result  of Group 2 (age 67 years or more)","e30ebd20":"I check numeric column by correlation check.","ec1bcce3":"# Review all stroke patients","0e3d2c45":"# Arrange Group columns more than 10 unique","2b7977ca":"# Set Prediction target and features ","5cd26129":"# As below is result  of Group 1 (age is less than 67 years).","910f5910":"# Group 2: age class1 in rank more than 5.5\n\n it means: **Group of 67 years or more**\n \n Also, this group inclues bmi class1 <= 0.5 that is missing value. \n\nso I will remove it and prediction, again.\n\n* 1. sort age in range of 67 years or more.\n* 2. remove bmi_class1 =  0, it is missing value "}}