{"cell_type":{"0630f50e":"code","e03ec336":"code","92bc9c46":"code","5f6e45e1":"code","db0647e5":"code","72244e48":"code","b1c721b6":"code","d77cbc2d":"code","979cd11e":"code","ebbda92d":"code","261777af":"markdown","33a1c785":"markdown","3d9d2c57":"markdown","5124a3e4":"markdown","25b71f6a":"markdown","b6c07ba3":"markdown","93621f09":"markdown","b1cf307f":"markdown","1586aece":"markdown","83b99745":"markdown","98aa13ee":"markdown","95904f4b":"markdown","b2f0c72a":"markdown","ace5d7a4":"markdown","69cb2ede":"markdown","0477eeb5":"markdown","0156828b":"markdown","8244334c":"markdown","745f5a60":"markdown","fc1840de":"markdown","57772486":"markdown","13c45109":"markdown","bcc8d78a":"markdown","92759508":"markdown","51f84be9":"markdown","9803e919":"markdown","9d1fe96a":"markdown","10504a65":"markdown","b4c795ab":"markdown","98129181":"markdown","8dc4cc7c":"markdown","9f24e06b":"markdown","70fd852c":"markdown","70165e35":"markdown","d2adc90f":"markdown","28f2a2b2":"markdown","4cd7e5a3":"markdown","4994d35c":"markdown"},"source":{"0630f50e":"from scipy import io\nimport h5py\nimport pandas as pd\nfrom tqdm import tqdm\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport random\nimport os\nfrom PIL import Image\n\nfrom sklearn.preprocessing import RobustScaler\nfrom sklearn.metrics import r2_score\n\nimport tensorflow as tf\nfrom tensorflow.keras.layers import *\nfrom tensorflow.keras import *\nfrom tensorflow.keras.callbacks import *\nfrom tensorflow.keras.optimizers import Adam\nfrom tensorflow.keras.metrics import mean_absolute_error\n\ndef seed_everything(seed: int = 42):\n    random.seed(seed)\n    np.random.seed(seed)\n    os.environ[\"PYTHONHASHSEED\"] = str(seed)\n    tf.random.set_seed(seed)\n\nseed_everything(2021)","e03ec336":"Image.open('..\/input\/squid-images\/Squid Catch in 1997  2018.png')","92bc9c46":"Image.open('..\/input\/squid-images\/Real squid Price Growth Rate in 1997  2018.png')","5f6e45e1":"Image.open('..\/input\/squid-catch-increase-rate\/squid catch increase rate.png')","db0647e5":"Image.open('..\/input\/squid-images\/Temperature of the northernmost coast of South Korea using coastal geostationary data in Second half 19972018.png')","72244e48":"# Loading\ncatch = pd.read_csv('..\/input\/east-seasquid-data\/19932018 squid catch.csv')\nelnino = pd.read_csv('..\/input\/east-seasquid-data\/19932018 elnino index.csv')\ntrain = pd.read_csv('..\/input\/east-seasquid-data\/data_for_modeling.csv')\n\n# Merge\nall_dataset = pd.merge(train, elnino, how = 'left', on = 'year')\nall_dataset = pd.merge(all_dataset, catch, how = 'left', on = 'year')\nall_dataset = all_dataset.drop(columns = 'year')\n\nall_dataset.head(5)","b1c721b6":"# Scaling (RobustScaler)\nrb = RobustScaler()\nvector = rb.fit_transform(all_dataset[all_dataset.columns[:-3]])\nall_dataset.iloc[:][all_dataset.columns[:-3]] = vector\nall_dataset.head(5)","d77cbc2d":"# Data Split\ntrain2 = all_dataset.iloc[:-2]\ntest2 = all_dataset.iloc[-2:]\n\n# X, Y Value Split\nx_train, y_train = train2.iloc[:, :-3], train2.iloc[:, -3:]\nx_test, y_test = test2.iloc[:, :-3], test2.iloc[:, -3:]\n\n# Data Reshape for LSTM\nx_train = x_train.values.reshape(-1, 1, 5705)\nx_test = x_test.values.reshape(-1, 1, 5705)","979cd11e":"# Make Model\nmodel = Sequential()\nmodel.add(LSTM(1024, input_shape = (1, 5705)))\nmodel.add(Dropout(0.3))\nmodel.add(Dense(64, activation = 'relu'))\nmodel.add(Dropout(0.2))\nmodel.add(Dense(3))\n\n# Callbacks\nes = EarlyStopping(patience = 20, verbose = 10,restore_best_weights=True)\nlr = ReduceLROnPlateau(patice = 5, verbose = 10, factor = 0.5)\n\n# Compile\nmodel.compile(loss = 'mae', optimizer = Adam(0.001), metrics=['mae'])\n\n# Fit\nhistory = model.fit(x_train, y_train,\n                    validation_data=(x_test, y_test),\n                    epochs = 10000,\n                    batch_size = 32,\n                    shuffle = False,\n                    callbacks=[es, lr],\n                    verbose = 0)","ebbda92d":"# MAE Plot\n\nplt.figure(figsize = (12, 6))\n\nplt.plot(history.history['mae'])\nplt.plot(history.history['val_mae'])\nplt.title('Model History')\nplt.xlabel('epoch')\nplt.ylabel('mae')\nplt.legend(['train', 'test'], loc = 'upper right')\nplt.show()\n\n# Predict\nresult = model.predict(x_test)\n\nfor i in range(len(result)):\n  print('r2_score :', r2_score(y_test.values[i], result[i]))","261777af":"\n\n---\n\n","33a1c785":"<hr width = \"100%\">","3d9d2c57":"##   **2. Visualize pattern-related data**\n#### 2.1 Squid catch at East Sea in normal, Elnino & Lanina phase","5124a3e4":"\n\n---\n\n","25b71f6a":"##   **1. Introduction**\n\n####  1.1 The habitat characteristics of squid\n\nSquid, a warm-water fish species with 10 feet familiar to us as a \"squid game,\" lives the most in lukewarm fishing grounds at 17-18 degrees Celsius. However, despite the increase in water temperature in waters near the Korean Peninsula due to global warming, squid catch continues to decline.\ud83e\udd14\n\n\n####  1.2 Elnino & Lanina\n\n - #####  1.2.1 What is Elnino & Lanina?\nWe questioned the above facts and noted Elnino and Lanina, which are marine events that have a strong global impact after global warming. The dictionary definition of Elnino is as follows. \"Sea surface temperatures in the tropical East Pacific and the Middle Pacific, which were relatively low every two to five years, persist for more than months, which is called Elnino, Lanina is the opposite concept.\n\n- #####  1.2.2 Wind, Elnino & Lanina\nThis phenomenon affects the Korean Peninsula, and the wind strength on the Korean Peninsula is weak during the El Nino period, and it is strong during the Lanina period, and it was confirmed through [this paper](http:\/\/pds21.egloos.com\/pds\/201108\/12\/73\/KESS32-2.pdf)","b6c07ba3":"#### [This data](https:\/\/kosis.kr\/statHtml\/statHtml.do?orgId=101&tblId=DT_1EW0004&conn_path=I2) is visualizing the inflation rate of squid catch from 1997 to 2018 in the area near East Sea(Busan, Gangwon-do, Korea, Gyeongbuk, Korea) When normal, Elnino & Lanina phase. Squid, a warm-water fish species, cannot adapt to low water temperatures during the Elnino period, so the rate of increase in catch has decreased, and in contrast, it tends to increase during the Lanina period.\n\n(**Red** : Elnino \/ **Blue** : Normal \/ **Green** : Lanina \/ **Curve** : Increase rate of squid catch \/ **x** = Time)\n\n---\n\n","93621f09":"### 2.3 Normal Elnino & Lanina phase - Squid catch increase rate (%)","b1cf307f":"#### [This data](https:\/\/kosis.kr\/statHtml\/statHtml.do?orgId=101&tblId=DT_1EW0004&conn_path=I2) is the real price increase rate calculated based on squid prices identified in the wholesale and retail industries from 1997 to 2018. The goal was to focus solely on supply and demand, not on the flow of money, so we used the formula of \"annual price increase rate - average food price increase rate.\" Unlike the catch that goes down to the right, the price increase rate shows an upward curve, so the upward trend can be confirmed.\n\n(**Red** : Elnino \/ **Blue** : Normal \/ **Green** : Lanina \/ **Curve** : Real price Increase rate \/ **x** = Time)\n\n---\n\n\n","1586aece":"## **Contents**\n\n## **1. Introduction**\n- ### 1.1. The habitat characteristics of squid\n- ### 1.2. Elnino & Lanina\n - ### 1.2.1. What is Elnino & Lanina?\n - ### 1.2.2. Wind, ElNio & Lanina\n - ### 1.2.3. East Korea Warm Current, Elnio & Lanina\n - ### 1.2.4. East sea upwelling, Elnino & Lanina\n- ### 1.3. Squid, Elnino & Lanina\n- ### 1.4. Hypothesis\n\n## **2. Visualize pattern-related data**\n- ### 2.1. Squid catch at East Sea in normal, Elnino & Lanina phase\n- ### 2.2. Normal, Elnino & Lanina phase - Actual squid price increase rate (%)\n- ### 2.3. Normal Elnino & Lanina phase - Squid catch increase rate (%)\n- ### 2.4. Current flow in the second half of the year depending on the rate of increase or decrease in squid catch\n- ### 2.5. The average water temperature in Sokcho(East Sea) at the second half of the year in normal Elnino & Lanina phase (\u2103)\n\n## **3. Modeling**\n- ### 3.1. Training dataSet Generation\n- ### 3.2. Modifying and scaling the range of variables\n- ### 3.3. Separate training dataset and validation dataset\n- ### 3.4. LSTM time series data modeling\n- ### 3.5. Result of evaluation using R2 Score\n\n## **4. Conclusion**\n- ### 4.1. Conclusion\n- ### 4.2. Data source","83b99745":"<hr width = \"100%\">","98aa13ee":"![98](https:\/\/github.com\/JunHyeok-Navy\/images\/blob\/main\/98%EB%85%84%EB%B0%98%EB%B3%B5%EC%9E%AC%EC%83%9D.gif?raw=true)\n![18](https:\/\/github.com\/JunHyeok-Navy\/images\/blob\/main\/18%EB%85%84%EB%B0%98%EB%B3%B5%EC%9E%AC%EC%83%9D.gif?raw=true)","95904f4b":"#### 3.4 Time series data modeling using LSTM\n\nThe training data was composed of data for time series modeling, and the RNN series [LSTM](https:\/\/en.wikipedia.org\/wiki\/Recurrent_neural_network) model, which produces high performance in time series modeling, was used.\n\nLinear regression models that explore the linear relationship between individual ocean current data and objective variables can also be adopted, but we chose LSTM because the RNN model performs better for seasonal and trending modeling.","b2f0c72a":"#### 3.5 Result of evaluation using R2 Score\n\n#### By basis of Cohen's,\n\n* [Cohen, J.(1988), Statistical Power Analysis for the Behavioral Sciences(2nd Ed.), Lawrence Erlbaum Associates, Inc.](https:\/\/books.google.co.kr\/books?hl=ko&lr=&id=rEe0BQAAQBAJ&oi=fnd&pg=PP1&dq=Cohen,+J.(1988),+Statistical+Power+Analysis+for+the+Behavioral+Sciences(2nd+Ed.),+Lawrence+Erlbaum+Associates,+Inc.&ots=swWSMwROra&sig=a7GD4L7wT_vOG9wtHPdtesRZZ3s#v=onepage&q&f=false)\n\nThe [R2 Score](https:\/\/en.wikipedia.org\/wiki\/Coefficient_of_determination#Definitions), which evaluates the model based on variance, evaluates the reliability of the model based on 0.7 in the case of natural science.","ace5d7a4":"<hr width = \"100%\">","69cb2ede":"#### 3.2 Modifying and scaling the range of variables.","0477eeb5":"\n---\n\n","0156828b":"*   **A representative year when the squid catch rate increased significantly.**\n - **1999 : 60.9%**\n - **2008 : 13.3%**\n - During the Lanina period, the East Sea Warm Current breaks above 40 degrees latitude or around 39-40 degrees latitude.","8244334c":"\n\n---\n\n","745f5a60":"##   **3. Modeling**\n#### 3.1 Train Dataset Generation","fc1840de":"- ##### 1.2.4 East sea upwelling, Elnino & Lanina\nIn addition, regarding the phenomenon of [upwelling](https:\/\/www.nationalgeographic.org\/encyclopedia\/upwelling\/), where cold water in the deep sea rises to the surface as well as the ocean currents, it has been confirmed that the likelihood of upwelling increases during the Elnino period and lower during the Lanina period. It confirmed by this [paper](https:\/\/scienceon.kisti.re.kr\/srch\/selectPORSrchArticle.do?cn=JAKO202010763204281&dbt=NART).\n\n---\n\n\n\n#### 1.3 Squid, Elnino & Lanina\n\nTherefore, if you put it together, it is as follows.\n\n- Squid is **warm-water fish species**.\n- During the Elnino period, **wind** weakens, and during the Lanina period **wind** becomes stronger.\n- The East Sea Warm Current is **Northward** less during the Elnino period, and **Northward** higher on the contrary.\n- Cold **upwelling** also occurs more during the Elnino period and less during the Lanina period.\n- Therefore, **coastal water temperature** will be low during the Elnino period and high during the Lanina period.\n- For this reason, **squid catch** will be low during the Elnino period and high during the Lanina period.\n\n---\n\n\n\n\n#### 1.4 Hypothesis\n\n####By pattern which shows that velocity of East Sea Warm Current and temperature of East sea have a relationship with Elnino & Lanina, we can see the cycle & correlationship of this phenomenon and can predict the squid catch","57772486":"# **Correlation Analysis : Between the East Sea water temperature, East Korean Warm Current and squid catch with Elnino**","13c45109":"- ##### 1.2.3 East Korea Warm Current, Elnio & Lanina\nThe following are data on the average ocean current speed in August 2015 when Elnino was severe and data on the average ocean current speed in August 2001 when Lanina was severe. In 2001 (Lanina), the red colored East Koea Warm Current soared to 40 degrees above latitude, while in 2015 (El Nino), the East Koea Warm Current was bent near 38 degrees above latitude.\n\n### Elnino Phase (August 2015)\n![2015](https:\/\/github.com\/JunHyeok-Navy\/images\/blob\/main\/2015%20%ED%95%B4%EB%A5%98%ED%9D%90%EB%A6%84.jpg?raw=true)\n### Lanina phase(August 2001)\n![2001](https:\/\/github.com\/JunHyeok-Navy\/images\/blob\/main\/2001%20%ED%95%B4%EB%A5%98%ED%9D%90%EB%A6%84.jpg?raw=true)","bcc8d78a":"#### 3.3 Separate training dataset and validation dataset.\n*   **Train : 1993 ~ 2016**\n*  **Test : 2017 ~ 2018**\n\n#### Reshape the dataset for LSTM Model","92759508":"### 2.4 Current flow in the second half of the year depending on the rate of increase or decrease in squid catch\n\n#### This data visualizes the current flow during the squid season (August-December) after selecting the year when the range of changes was high based on the rate of increase or decrease in catch.\n\n#### According to the graph below, it can be seen that the East Sea Warm Current Limit Line is low during the Elnino period, when the squid catch increase rate decreases, and on the contrary, the East Sea Warm Current Limit Line moves high to north during the Lanina period when the increase rate increases.\n\n*   **A representative year when the squid catch rate declined.**\n - **1998 : -29.1%**\n - **2018 : -46.2%**\n - During the Elnino period, the East Sea Warm Current cannot soar to 40 degrees latitude above and breaks near 38 degrees latitude.","51f84be9":"## **Thanks a lot**","9803e919":"<hr width = \"100%\">","9d1fe96a":"#### 2.2 Normal, Elnino & Lanina phase - Actual squid price increase rate (%)","10504a65":"![99](https:\/\/github.com\/JunHyeok-Navy\/images\/blob\/main\/99%EB%85%84%EB%B0%98%EB%B3%B5%EC%9E%AC%EC%83%9D.gif?raw=true)\n![08](https:\/\/github.com\/JunHyeok-Navy\/images\/blob\/main\/08%EB%85%84%EB%B0%98%EB%B3%B5%EC%9E%AC%EC%83%9D.gif?raw=true)","b4c795ab":"#### [This visualization](https:\/\/joiss.kr\/joiss\/mber.mpe.basketPage.do) is about the average temperature of east sea at Sokcho from 1997 to 2018.\n\n#### We can see that East Sea temperature is decrease in Elnino period and increase in Lanina period.\n\n(**Red** : Elnino \/ **Blue** : Normal \/ **Green** : Lanina \/ **Curve** : Temperature of East Sea \/ **x** = Time)\n\n---\n\n","98129181":"Current flow data, Elnino intensity data, and squid catch data were merged into one dataset.\n\nThe independent variable consists of ocean current data and Elnino intensity data, and the final objective variable data to be derived is squid catch data.","8dc4cc7c":"### The average r2_score is about 0.69, indicating that the model is reliable.","9f24e06b":"\n#### Fishing is a historic labor that has started before mankind started farming. In that history, fishermen identified the patterns of fish species themselves and continued their lives according to the patterns. In it, ocean currents and sea temperatures play the most decisive role.\n\n#### However, due to many weather changes, the patterns are becoming more difficult to predict again. For example, there have been cases where squid catches have exceeded expectations and plunged, causing great damage to numerous fishermen, businesses, and consumers to the extent that the new term banned squid has recently been coined. And on the occasion of this incident, we are still beginners in researching data, but as people who make lines and patterns connecting dots, we thought it was important for intellectuals to find patterns and help fishermen with their lives.\n\n#### However, the amplitude of climate change and weather anomalies is increasing, and there are countless variables and changes to be considered in the marine environment, so it is difficult to conclude that \"what is it?\"\n\n#### For example, the squid we studied is a representative turbulent fish species, and theoretically, if sea temperature increases, its population and catch should increase. But in the longer term East Sea sea water, despite usanghyang, squid catch has plunged and short-term volatility is unpredictable enough to bring the big the difference.\n\n#### Therefore, we collected a lot of data through JOISS and other marine-related sites, and selected and visualized those related to patterns. In addition, we made a model and predicted what the future catch would be.","70fd852c":"##   **4. Conclusion**\n#### 4.1 Conclusion\n\n#### Artificial intelligence analysis was essential because squid catches, which plunged beyond expectations and had very large short-term fluctuations, were simply difficult to predict.\n\n\n#### At first, we focused on Elnino-Lanina phenomenon. And then, by several papers, we set the hypothesis that Elnino phenomenon highly affects to the temperature and velocity of East Sea Current.\n\n#### Using data visualization, we saw the relationship between Elnino-Lanina and temperature-velocity of East Sea. And we also checked the high relationship between Elnino-Lanina and squid catch. So, we used LSTM for squid catch prediction and we got our planned goal!","70165e35":"<hr width = \"100%\">","d2adc90f":"### 2.5 The average water temperature in Sokcho(East Sea) at the second half of the year in normal Elnino & Lanina phase (\u2103)\n","28f2a2b2":"#### 4.2 data source\n- ##### Annual ocean current distribution data - <a href = \"https:\/\/www.aviso.altimetry.fr\/en\/home.html\">Aviso<\/a>\n- ##### Elnino-Lanina data - <a href = \"https:\/\/www.ncdc.noaa.gov\/teleconnections\/enso\/indicators\/soi\/\">Rsoi<\/a> ,El Nino\/Southern Oscillation (ENSO)\n- ##### Squid catch in Busan, Gangwon, GyeongBuk data - <a href = \"https:\/\/kosis.kr\/statHtml\/statHtml.do?orgId=101&tblId=DT_1EW0004&conn_path=I2\">KOSIS National Statistical Portal<\/a>\n- ##### Squid Price data - <a href = \"https:\/\/www.kamis.or.kr\/customer\/price\/product\/period.do?action=monthly\">KAMIS Agricultural product distribution information<\/a>\n- ##### Coastal stationary observation data - <a href = \"https:\/\/joiss.kr\/joiss\/main.do\">JOISS Joint use of marine information in the jurisdiction<\/a>\n","4cd7e5a3":"<hr width = \"100%\">","4994d35c":"#### [This data](https:\/\/www.kamis.or.kr\/customer\/price\/product\/catalogue.do?action=daily&regday=2018-01-13&countycode=3814&itemcategorycode=600&convert_kg_yn=Y) is the number of squid catch from 1997 to 2018 (Busan, Gangwon-do, Gyeongbuk) near East Sea, caught by fishing shallow water. It has the shape of a downward curve, which means a decline. As of 2015, the slope has become more severe, and the decrease in squid catch is clearly confirmed.\n\n(**Red** : Elnino \/ **Blue** : Normal \/ **Green** : Lanina \/ **Curve** : squid catch \/ **x** = time)\n\n---\n\n"}}