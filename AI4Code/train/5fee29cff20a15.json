{"cell_type":{"0d5b3d87":"code","b6986a36":"code","614276f3":"code","99e78f40":"code","caec5390":"code","92635c88":"code","9da90d58":"code","3ca997ac":"code","b784de33":"code","414e452d":"code","1aad7b56":"code","96ed6ded":"code","5819ebe9":"code","31b4d722":"code","c7728898":"code","2218a6cf":"code","f2f06d56":"code","9f7b79cf":"code","d03d5f40":"code","b79738d2":"code","2acbad1f":"code","8003b06f":"code","50f55d42":"code","9066485e":"code","ce5da5ed":"code","676c3b40":"code","85a06c47":"code","4bcdde49":"code","793340af":"code","408f95c3":"code","b21d61af":"code","380cd738":"code","1825406f":"code","064ea9f5":"code","d61f6fe3":"code","cf1cd132":"markdown","064f2982":"markdown","1367fe8c":"markdown","a77fb5c0":"markdown","1fde39bd":"markdown","4385fa8b":"markdown","8cef9df5":"markdown","9af5589e":"markdown","df03e5bc":"markdown","d055b911":"markdown","0361100f":"markdown","ea01fc15":"markdown","f3e15bc0":"markdown","e7ac374a":"markdown","e6ac1280":"markdown","dcd2b68d":"markdown","28e76317":"markdown","c4e2ce3d":"markdown","5cfcd82a":"markdown","7dbc015c":"markdown","23102fa0":"markdown","8ea6d3c6":"markdown","53779050":"markdown","7a1dc0f2":"markdown","019e4dad":"markdown","630e9a85":"markdown","138adce0":"markdown","8bd09f61":"markdown","109a0a59":"markdown","9b3c06c5":"markdown","22c3374b":"markdown","baf65153":"markdown"},"source":{"0d5b3d87":"\n#Data Pre-Processing packages:\nimport numpy as np \nimport pandas as pd \nfrom datetime import datetime\n\n\n#Data Visualization Packages:\n#Seaborn\nimport seaborn as sns\nsns.set(rc={'figure.figsize':(10,6)})\ncustom_colors = [\"#4e89ae\", \"#c56183\",\"#ed6663\",\"#ffa372\"]\n\n#Matplotlib\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport matplotlib.image as mpimg\n\n#Colorama\nfrom colorama import Fore, Back, Style # For text colors\ny_= Fore.CYAN\nm_= Fore.WHITE\n\n#NetworkX\nimport networkx as nx\nimport plotly.graph_objects as go #To construct network graphs\n\n#To avoid printing of un necessary Deprecation warning and future warnings!\nimport warnings\nwarnings.filterwarnings(\"ignore\", category=DeprecationWarning)\nwarnings.filterwarnings(\"ignore\", category=FutureWarning)\n\n#Time series Analysis pacakages:\n\nfrom statsmodels.tsa.seasonal import seasonal_decompose\nfrom statsmodels.tsa.stattools import kpss\nfrom statsmodels.tsa.stattools import adfuller\nfrom statsmodels.graphics.tsaplots import plot_acf, plot_pacf\n\n#Facebook Prophet packages:\nfrom fbprophet import Prophet\nfrom fbprophet.diagnostics import cross_validation, performance_metrics\nfrom fbprophet.plot import add_changepoints_to_plot, plot_cross_validation_metric\n\n\n#Importing of Data \nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n        \ndata=pd.read_csv('..\/input\/ethereum-cryptocurrency-historical-dataset\/Ethereum Historical Data.csv')\n\n","b6986a36":"print(f\"{m_}Total records:{y_}{data.shape}\\n\")\nprint(f\"{m_}Data types of data columns: \\n{y_}{data.dtypes}\")","614276f3":"data.head(5)","99e78f40":"# Coverting the date column to a datetime format and sorting the dataframe by date\ndata['Date'] =  pd.to_datetime(data['Date'],infer_datetime_format=True,format='%y-%m-%d')\ndata.sort_values(by='Date',inplace=True)\ndata.head()","caec5390":"# We should change Million(M) and Thousands(K) \ndata[\"Vol.\"] = data[\"Vol.\"].replace(\"-\",np.nan)\ndata[\"Vol.\"] = (data[\"Vol.\"].replace(r'[KM]+', '', regex=True).astype(float) * \\\n              data[\"Vol.\"].str.extract(r'[\\d\\.]+([KM]+)', expand=False)\n                .fillna(1)\n             .replace(['K','M'], [10**3, 10**6]).astype(int))\n\n# Our columns should not contain , because python doesn't understand it as thousand parser\ndata[\"Price\"]=data[\"Price\"].str.extract(\"([0-9,]+\\.?[0-9]+)\").replace(',','', regex=True).astype(\"float\")\ndata[\"Open\"]=data[\"Open\"].str.extract(\"([0-9,]+\\.?[0-9]+)\").replace(',','', regex=True).astype(\"float\")\ndata[\"High\"]=data[\"High\"].str.extract(\"([0-9,]+\\.?[0-9]+)\").replace(',','', regex=True).astype(\"float\")\ndata[\"Low\"]=data[\"Low\"].str.extract(\"([0-9,]+\\.?[0-9]+)\").replace(',','', regex=True).astype(\"float\")\ndata[\"Change %\"] = data[\"Change %\"].str.extract(\"([-]?[0-9]+\\.?[0-9]+)\").astype(\"float\")","92635c88":"data.head(5)","9da90d58":"missed = pd.DataFrame()\nmissed['column'] = data.columns\n\nmissed['percent'] = [round(100* data[col].isnull().sum() \/ len(data), 2) for col in data.columns]\nmissed = missed.sort_values('percent',ascending=False)\nmissed = missed[missed['percent']>0]\n\nfig = sns.barplot(\n    x=missed['percent'], \n    y=missed[\"column\"], \n    orientation='horizontal',palette=\"winter\"\n).set_title('Missed values percent for every column')","3ca997ac":"prev_len=data.shape[0]\ndata=data.dropna()\nprint(f\"{m_}Total records after the removal of NA values: {y_}{data.shape}\\n\")\nprint(f\"{m_}Removed records:{y_}{prev_len-data.shape[0]}\\n\")\nprint(f\"{m_}Removed records percentage:{y_}{round(((prev_len-data.shape[0])\/prev_len)*100,2)}\")","b784de33":"def triple_plot(x, title,c):\n    fig, ax = plt.subplots(3,1,figsize=(20,10),sharex=True)\n    sns.distplot(x, ax=ax[0],color=c)\n    ax[0].set(xlabel=None)\n    ax[0].set_title('Histogram + KDE')\n    sns.boxplot(x, ax=ax[1],color=c)\n    ax[1].set(xlabel=None)\n    ax[1].set_title('Boxplot')\n    sns.violinplot(x, ax=ax[2],color=c)\n    ax[2].set(xlabel=None)\n    ax[2].set_title('Violin plot')\n    fig.suptitle(title, fontsize=30)\n    plt.tight_layout(pad=3.0)\n    plt.show()","414e452d":"triple_plot(data['Price'],'Distribution of Price(in INR)',custom_colors[0])","1aad7b56":"triple_plot(data['Open'],'Distribution of Opening Price(in INR)',custom_colors[1])","96ed6ded":"triple_plot(data['High'],'Distribution of Highest Price(in INR)',custom_colors[2])","5819ebe9":"triple_plot(data['Low'],'Distribution of Lowest Price(in INR)',custom_colors[3])","31b4d722":"triple_plot(data['Vol.'],'Distribution of Volume',custom_colors[0])","c7728898":"triple_plot(data['Change %'],'Distribution of Change(%)',custom_colors[2])","2218a6cf":"plt.figure(figsize=(10,10))\ncorr=data[data.columns[1:]].corr()\nmask = np.triu(np.ones_like(corr, dtype=bool))\nsns.heatmap(data[data.columns[1:]].corr(), mask=mask, cmap='coolwarm', vmax=.3, center=0,\n            square=True, linewidths=.5,annot=True)\nplt.show()","f2f06d56":"indices = corr.index.values\ncor_matrix = np.asmatrix(corr)\nG = nx.from_numpy_matrix(cor_matrix)\nG = nx.relabel_nodes(G,lambda x: indices[x])\n#G.edges(data=True)","9f7b79cf":"def corr_network(G, corr_direction, min_correlation):\n    H = G.copy()\n\n    for s1, s2, weight in G.edges(data=True):       \n        if corr_direction == \"positive\":\n            if weight[\"weight\"] < 0 or weight[\"weight\"] < min_correlation:\n                H.remove_edge(s1, s2)\n        else:\n            if weight[\"weight\"] >= 0 or weight[\"weight\"] > min_correlation:\n                H.remove_edge(s1, s2)\n                \n    edges,weights = zip(*nx.get_edge_attributes(H,'weight').items())\n    weights = tuple([(1+abs(x))**2 for x in weights])\n   \n    d = dict(nx.degree(H))\n    nodelist=d.keys()\n    node_sizes=d.values()\n    \n    positions=nx.circular_layout(H)\n    \n    plt.figure(figsize=(10,10))\n\n    nx.draw_networkx_nodes(H,positions,node_color='#d100d1',nodelist=nodelist,\n                       node_size=tuple([x**5 for x in node_sizes]),alpha=0.8)\n\n    nx.draw_networkx_labels(H, positions, font_size=13)\n\n    if corr_direction == \"positive\":\n        edge_colour = plt.cm.summer \n    else:\n        edge_colour = plt.cm.autumn\n        \n    nx.draw_networkx_edges(H, positions, edgelist=edges,style='solid',\n                          width=weights, edge_color = weights, edge_cmap = edge_colour,\n                          edge_vmin = min(weights), edge_vmax=max(weights))\n    plt.axis('off')\n    plt.show() ","d03d5f40":"corr_network(G, corr_direction=\"positive\",min_correlation = 0.5)\n","b79738d2":"fig = go.Figure(data=[go.Candlestick(x=data['Date'],\n                open=data['Open'], high=data['High'],\n                low=data['Low'], close=data['Price'])\n                      ])\nfig.show()","2acbad1f":"data['month']=data['Date'].dt.month\nfig = go.Figure(data=[go.Candlestick(x=data['month'],\n                open=data['Open'], high=data['High'],\n                low=data['Low'], close=data['Price'])\n                      ])\nfig.show()","8003b06f":"plt.figure(figsize=(15,12))\nseries = data.Price\nresult = seasonal_decompose(series, model='additive',period=1)\nresult.plot()","50f55d42":"# Renaming the column names accroding to Prophet's requirements\nprophet_df=data[['Date','Price']]\nprophet_df.rename(columns={'Date':'ds','Price':'y'},inplace=True)\n","9066485e":"prophet_basic = Prophet()\nprophet_basic.fit(prophet_df[['ds','y']])","ce5da5ed":"future= prophet_basic.make_future_dataframe(periods=300)\nfuture.tail(2)","676c3b40":"forecast=prophet_basic.predict(future)","85a06c47":"fig1 =prophet_basic.plot(forecast)","4bcdde49":"fig1 = prophet_basic.plot_components(forecast)","793340af":"fig = prophet_basic.plot(forecast)\na = add_changepoints_to_plot(fig.gca(), prophet_basic, forecast)","408f95c3":"print(f'{m_}Change points:\\n {y_}{prophet_basic.changepoints}\\n')","b21d61af":"prophet_df['Open'] = data['Open']\nprophet_df['High'] = data['High']\nprophet_df['Low'] = data['Low']\nprophet_df['Vol'] = data['Vol.']\nprophet_df['Change'] = data['Change %']\nprophet_df=prophet_df.dropna()\ntrain_X= prophet_df[:1500]\ntest_X= prophet_df[1500:]","380cd738":"pro_regressor= Prophet()\npro_regressor.add_regressor('Open')\npro_regressor.add_regressor('High')\npro_regressor.add_regressor('Low')\npro_regressor.add_regressor('Vol')\npro_regressor.add_regressor('Change')\n","1825406f":"#Fitting the data\npro_regressor.fit(train_X)\nfuture_data = pro_regressor.make_future_dataframe(periods=249)","064ea9f5":"#Forecast the data for Test  data\nforecast_data = pro_regressor.predict(test_X)\npro_regressor.plot(forecast_data);","d61f6fe3":"df_cv = cross_validation(pro_regressor, initial='100 days', period='180 days', horizon = '365 days')\npm = performance_metrics(df_cv, rolling_window=0.1)\ndisplay(pm.head(),pm.tail())\nfig = plot_cross_validation_metric(df_cv, metric='mape', rolling_window=0.1)\nplt.show()","cf1cd132":"<div class=\"alert alert-info\">\n    <h3><b><center>Missing values<\/center><b><\/h3>\n<\/div>\n","064f2982":"<a id=\"top\"><\/a>\n\n<div class=\"list-group\" id=\"list-tab\" role=\"tablist\">\n<h3 class=\"list-group-item list-group-item-action active\" data-toggle=\"list\" style='background-color:#98FB98; border:0' role=\"tab\" aria-controls=\"home\" color=black><center>Quick navigation<\/center><\/h3>\n\n* [1. Required Libraries](#1)\n* [2. Dataset Quick Overview](#2)\n* [3. Distribution of Features](#3)\n* [4. Correlation Analysis ](#4)   \n* [5. Candle stick chart on Ethereum historical data](#5)\n* [6. Time series analysis and prediction using prophet](#6)\n* [7. References & Dataset](#7)\n\n    Kindly, Upvote the notebook!","1367fe8c":"<a id=\"5\"><\/a>\n<h2 style='background-color:#98FB98; border:0; color:black'><center>Candle stick chart on the price movements of the Ethereum<\/center><h2>\n","a77fb5c0":"<div class=\"alert alert-info\">\n    <h3 color:black><center><b> The above dataframe show that formatting needs to be done in all the columns  the change column<\/b><\/center><\/h3><br>\n    <p> 1. <b>Date<\/b> - We need to convert the date to datetime format <\/p>\n    <p> 2. <b>Price, Open, High, and Low<\/b> - We need to remove the commas(,) from the values inorder to let python process the whole value<\/p>\n    <p> 3. <b>Vol.<\/b> - M denotes Million, we need to convert 1.70M to 1700000<\/p>\n    <p> 4. <b>Change %<\/b> - Need to remove the percentage symbol (-2.06% to -2.06)\n<\/div>","1fde39bd":"<div class='alert alert-warning'>\n    <h3><center>Plotting the predicted data<\/center><\/h3>\n<\/div>","4385fa8b":"<div class='alert alert-warning'>\n    <h2><center>Adding Multiple Regressors<\/center><\/h2>\n<h3>Additional regressors can be added to the Prophet model. This is done by using add_regressor. Additional regressor column value needs to be present in both the fitting as well as prediction dataframes.<h3>\n    <h3><center>Creating fitting and predicting dataset with additional regressors<\/center><\/h3>\n    <\/div>","8cef9df5":"<div class='alert alert-warning'>\n    <h3><center>What Prophet doesnt do<\/center><\/h3>\n    <h4><b>1.Prophet does not allow non-Gaussian noise distribution:<b><\/h4> \n<p>In Prophet, noise distribution is always Gaussian and pre-transformation of y values is the only way to handle the values following skewed distribution.<\/p>\n        <h4><b>2. Prophet does not take autocorrelation on residual into account<\/b><\/h4>\n<p>Since epsilon noise portion in the formula assume i.i.d. normal distribution, the residual is not assumed to have autocorrelation, unlike ARIMA model.<\/p>\n        <h4><b>3. Prophet does not assume stochastic trend<\/b><\/h4>\n<p>Prophet\u2019s trend component is always deterministic+possible changepoints and it won\u2019t assume stochastic trend unlike ARIMA.<\/p>\n<\/div>","9af5589e":"<div class='alert alert-warning'>\n    <h2><center>Creating and fitting the Prophet model with default values<\/center><\/h2>\n    <h3>We will first explore the default Prophet model. Create the Prophet instance with all default values, fit the dataset.<\/h3>\n<\/div>","df03e5bc":"<div class='alert alert-warning'>\n    <h3><center>Plotting the Forecasted components(Trend and Seasonality)<\/center><\/h3>\n<\/div>","d055b911":"<div class='alert alert-warning'>\n    <h3><center>Input to Prophet is a data frame with minimum two columns : ds and y<\/center><\/h3>\n<\/div>","0361100f":"<div class=\"alert alert-info\">\n<p><center>Ethereum a decentralized, open-source blockchain featuring smart contract functionality was proposed in 2013 by programmer Vitalik Buterin. Development was crowdfunded in 2014, and the network went live on 30 July 2015, with 72 million coins premined.<center><p>\n\n<p>Some interesting facts about Ethereum(ETH):<\/p>\n\n<p>1.Ether (ETH) is the native cryptocurrency of the platform. It is the second-largest cryptocurrency by market capitalization, after Bitcoin. Ethereum is the most actively used blockchain.<\/p>\n<p>2. Some of the world\u2019s leading corporations joined the EEA(Ethereum Alliance, is a collaboration of many block start-ups) and supported \u201cfurther development.\u201d Some of the most famous companies are Samsung SDS, Toyota Research Institute, Banco Santander, Microsoft, J.P.Morgan, Merck GaA, Intel, Deloitte, DTCC, ING, Accenture, Consensys, Bank of Canada, and BNY Mellon.<\/p>\n<\/div>","ea01fc15":"<img src=\"https:\/\/insightimi.files.wordpress.com\/2020\/07\/on-de793_201909_g_20190830121038.gif\" width='500' height='500'>","f3e15bc0":"<div class='alert alert-warning'>\n    <h2><b><center>Advantages of using Prophet<\/center><b><\/h2>\n        <h3> 1. Accommodates seasonality with multiple periods<\/h3>\n        <h3> 2. Prophet is resilient to missing values<\/h3>\n        <h3> 3. Best way to handle outliers in Prophet is to remove them<\/h3>\n        <h3> 4. Fitting of the model is fast<\/h3>\n    <h3> 5. Intuitive hyper parameters which are easy to tune<\/h3>\n<\/div>","e7ac374a":"<a id=\"6\"><\/a>\n<h2 style='background-color:#98FB98; border:0; color:black'><center>Time series Analysis and Prediction using Prophet<\/center><h2>\n\n","e6ac1280":"<a id=\"7\"><\/a>\n## References \n\n1. [Time series prediction using Prophet in Python by Renu Khandelwal](https:\/\/towardsdatascience.com\/time-series-prediction-using-prophet-in-python-35d65f626236)\n2. [Facebook Prophet by Moto DEI](https:\/\/medium.com\/swlh\/facebook-prophet-426421f7e331)\n3. [Housing pices EDA and Prediction by Ruchi Bhatia](https:\/\/www.kaggle.com\/ruchi798\/housing-prices-eda-and-prediction)\n4. [88.9 r2_score with pycaret by Kerem Yucedag](https:\/\/www.kaggle.com\/keremyceda\/88-9-r2-score-with-pycaret)","dcd2b68d":"<div class=\"alert alert-info\">\n    <h3><b><center>Correlation Network<\/center><b><\/h3>\n<\/div>\n","28e76317":"<div class=\"alert alert-info\">\n    <h3><b>Let's Visualize the distribution of the key variables like Opening price, Highest price, Lowest price and Change in Ethereum<b><\/h3>\n<\/div>\n","c4e2ce3d":"![](https:\/\/www.tradingwithrayner.com\/wp-content\/uploads\/2018\/05\/1-OHLC-COMBINE.png)","5cfcd82a":"<div class ='alert alert-info'>\n    <h2><center>Dataset<\/center><h2>\n\n\n    \n<a href=\"https:\/\/www.kaggle.com\/kaushiksuresh147\/ethereum-cryptocurrency-historical-dataset\"><h3><center>Click here to explore the Dataset<\/center><\/h3><\/a>\n\n<h3> The Dataset will be updated on a weekly basis. Stay tuned for more insights and different approaches.<\/h3><\/div>","7dbc015c":"<div class=\"alert alert-warning\">\n    <h1><b><center>What is Prophet?<\/center><b><\/h1>\n    <h3>Prophet is a facebooks\u2019 open source time series prediction. Prophet decomposes time series into trend, seasonality and holiday. It has intuitive hyper parameters which are easy to tune.<\/h3>\n<\/div>\n\n\n","23102fa0":"<a id=\"2\"><\/a>\n<h2 style='background-color:#98FB98; border:0; color:black'><center>Data set Overview<\/center><h2>","8ea6d3c6":"<a id=\"3\"><\/a>\n<h2 style='background-color:#98FB98; border:0; color:black'><center>Distribution of Features<\/center><h2>","53779050":"<div class=\"alert alert-info\">\n    <h3><b>Let's drop the records with NA value, to make sure it doesnt cloud our analysis<b><\/h3>\n<\/div>\n","7a1dc0f2":"<div class='alert alert-warning'>\n    <h2><center>Predicting the values for the future<\/center><\/h2>\n<h4>For predicting the values using Prophet, we need to create a dataframe with ds(datetime stamp) containing the dates for which we want to make the predictions.<br><br>\nWe use make_future_dataframe() to which we specify the number of days to extend into the future. By default it includes dates from the history<\/h4>\n<\/div>","019e4dad":"<a id=\"1\"><\/a>\n<h2 style='background-color:#98FB98; border:0; color:black'><center>Required Libraries<\/center><h2>","630e9a85":"<a id=\"4\"><\/a>\n<h2 style='background-color:#98FB98; border:0; color:black'><center>Correlation Analysis<\/center><h2>","138adce0":"\n<div>\n<img src=\"https:\/\/altramp.com\/wp-content\/uploads\/2020\/06\/Ethereum-3.gif\" width='500'>\n<\/div>","8bd09f61":"<div class='alert alert-warning'>\n        <h3> Following are the Changepoints, where the time series had abrupt changes in the trajectory.<\/h3>\n<\/div>","109a0a59":"<div>\n    <h1><center style=\"background-color:#98FB98; color:white;\"> Ethereum Historical Data Analysis<\/center><\/h1>\n<\/div>","9b3c06c5":"<div class='alert alert-warning'>\n    <h3><center>Adding ChangePoints to Prophet<\/center><\/h3>\n<h4>Changepoints are the datetime points where the time series have abrupt changes in the trajectory.<br>\nBy default, Prophet adds 25 changepoints to the initial 80% of the data-set.<br>\n    <br><center>Let\u2019s plot the vertical lines where the potential changepoints occurred<\/center><h4>\n    <\/div>","22c3374b":"<div class='alert alert-warning'>\n<h3><center>6 different types of metrics are shown by each time horizon, but by taking moving average over 37 days in this case (can be changed by \u2018rolling_window\u2019 option).<\/center><\/h3>\n<\/div>","baf65153":"<div class='alert alert-info'>\n    <h3><center>MAPE<\/center><\/h3>\n    <p>The MAPE (Mean Absolute Percent Error) measures the size of the error in percentage terms. It is calculated as the average of the unsigned percentage error<\/p>\n    <p>Many organizations focus primarily on the MAPE when assessing forecast accuracy. Most people are comfortable thinking in percentage terms, making the MAPE easy to interpret. It can also convey information when you don\u2019t know the item\u2019s demand volume. For example, telling your manager, \"we were off by less than 4%\" is more meaningful than saying \"we were off by 3,000 cases,\" if your manager doesn\u2019t know an item\u2019s typical demand volume.<p>\n    <img src=\"https:\/\/www.forecastpro.com\/Trends\/images\/MAPE1.jpg\" width='500'>\n<\/div>"}}