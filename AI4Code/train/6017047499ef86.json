{"cell_type":{"22c79a68":"code","e3b76072":"code","9c802d6b":"code","005e67ce":"code","dfed9ed1":"code","413653c3":"code","76e90b03":"markdown","21eecce8":"markdown","fdcb60bd":"markdown","f353d32c":"markdown","4c48bcc1":"markdown","6ea2df77":"markdown"},"source":{"22c79a68":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport networkx as nx\nfrom tqdm import tqdm\nimport gc","e3b76072":"title = ['Cart Balancer (Assessment)','Chest Sorter (Assessment)','Cauldron Filler (Assessment)','Bird Measurer (Assessment)','Mushroom Sorter (Assessment)',\\\n         'Chicken Balancer (Activity)','Egg Dropper (Activity)','Sandcastle Builder (Activity)','Bottle Filler (Activity)','Watering Hole (Activity)','Bug Measurer (Activity)',\\\n         'Fireworks (Activity)','Flower Waterer (Activity)','Crystal Caves - Level 3','Honey Cake','Lifting Heavy Things','Crystal Caves - Level 2','Heavy, Heavier, Heaviest',\\\n         'Balancing Act','Crystal Caves - Level 1','Magma Peak - Level 1','Slop Problem','Magma Peak - Level 2','Welcome to Lost Lagoon!','Costume Box','Pirate\\'s Tale',\\\n         'Tree Top City - Level 2','Tree Top City - Level 3','Treasure Map','12 Monkeys','Tree Top City - Level 1','Ordering Spheres','Rulers','Happy Camel','Leaf Leader',\\\n         'Chow Time','Pan Balance','Scrub-A-Dub','Bubble Bath','Dino Dive','Dino Drink','Air Show','All Star Sorting','Crystals Rule']\ntitle_dic = dict(zip(title,np.arange(len(title))))\n\ntrain_all = pd.read_csv('..\/input\/data-science-bowl-2019\/train.csv')\n# I want to see only game trainsition. Therefore, I remove events whose event_count is not 1.\ntrain = train_all[train_all['event_count']==1].reset_index(drop=True)\ntrain = train.drop(['game_session','event_data','event_count','event_code','game_time','type','world'],axis=1)\ndel train_all\ngc.collect()\ntrain.head()\nfor c in ['installation_id','title','timestamp']:\n    train['previous_'+c] = ''\n    train.loc[train.index[1:],'previous_'+c]=np.array(train.loc[train.index[:len(train.index)-1],c])\ntrain['title'] = train['title'].apply(lambda x:title_dic[x] if x in title_dic.keys() else -1)\ntrain['previous_title'] = train['previous_title'].apply(lambda x:title_dic[x] if x in title_dic.keys() else -1)\nprint('datasize: ',len(train))\ntrain = train[train['title']>=0]\ntrain = train[train['previous_title']>=0]\nprint('datasize: ',len(train))\ntrain = train[train['installation_id']==train['previous_installation_id']]\nprint('datasize: ',len(train))\ntrain.head()","9c802d6b":"link_count = np.zeros([len(title_dic),len(title_dic)],dtype=np.int)\nnode_count = np.zeros([len(title_dic)])\nfor i in tqdm(train.index):\n    link_count[train.loc[i,'previous_title']][train.loc[i,'title']]+=1\n    node_count[train.loc[i,'title']] += 1","005e67ce":"plt.figure(figsize=(10,8))\nsns.heatmap(link_count)\nplt.show()","dfed9ed1":"Graph = nx.DiGraph()\nGraph.add_nodes_from(title)\nweight = []\nfor i in range(len(title)):    \n    for j in range(i+1,len(title)):\n        if link_count[title_dic[title[i]]][title_dic[title[j]]]>100:\n            Graph.add_edge(title[i],title[j])\n            weight.append(np.log(link_count[title_dic[title[i]]][title_dic[title[j]]])\/2)\npos = dict(zip(title,[[np.cos(2*np.pi*i\/(len(title))),np.sin(2*np.pi*i\/(len(title)))] for i in range(len(title))]))\nplt.figure(figsize=(15,15))\nnode_color = ['cyan' for i in range(5)]\nnode_color += ['greenyellow' for i in range(8)]\nnode_color += ['orange' for i in range(20)]\nnode_color += ['magenta' for i in range(11)]\n\nnx.draw_networkx(Graph,pos=pos,node_color=node_color,font_size=8,edge_color=weight,edge_cmap=plt.cm.autumn_r,node_size=np.array(node_count)\/5)\nplt.title('Game Trainsition')\nplt.show()","413653c3":"Graph = nx.DiGraph()\nGraph.add_nodes_from(title)\nweight = []\nfor i in range(len(title)):    \n    for j in range(0,5):\n        if link_count[title_dic[title[i]]][title_dic[title[j]]]>10:\n            Graph.add_edge(title[i],title[j])\n            weight.append(np.log(link_count[title_dic[title[i]]][title_dic[title[j]]])\/2)\npos = dict(zip(title,[[np.cos(2*np.pi*i\/(len(title))),np.sin(2*np.pi*i\/(len(title)))] for i in range(len(title))]))\nplt.figure(figsize=(15,15))\nnode_color = ['cyan' for i in range(5)]\nnode_color += ['greenyellow' for i in range(8)]\nnode_color += ['orange' for i in range(20)]\nnode_color += ['magenta' for i in range(11)]\n\nnx.draw_networkx(Graph,pos=pos,node_color=node_color,font_size=8,edge_color=weight,edge_cmap=plt.cm.autumn_r,node_size=np.array(node_count)\/5)\nplt.title('Game Transition to Assessment')\nplt.show()","76e90b03":"# Count game trainsition","21eecce8":"# Visualzing Game Transition by networkx","fdcb60bd":"- node_size: the number of the game paly.\n- node_color: game type\n- link_color: the number of the game trainsit","f353d32c":"# Record previous game title.","4c48bcc1":"# Visualize by networkx","6ea2df77":"# Visualize by heatmap"}}