{"cell_type":{"ba7a2df9":"code","ad8aed0d":"code","ef747d47":"code","c9959abc":"code","62463a3f":"code","7fdf1c7f":"code","5b64491a":"code","1d8a820c":"code","2c08b17f":"code","e311caa0":"code","56e1ab03":"code","6ca3f9d1":"code","8daa986e":"code","af6f2776":"code","2b238606":"code","ce978253":"code","e3d4f9ba":"code","53aeb204":"code","27fbe6fd":"code","ce0084ae":"code","46efc5fa":"code","23e273a3":"code","ed811660":"code","8e4161f9":"code","78dc9b7b":"code","a50a9098":"code","769a9b77":"code","e1ce438e":"code","0cc0566f":"code","8096d917":"code","08ac2c86":"code","4eeb23eb":"code","173eede7":"code","5b496b3b":"code","818784e9":"code","ec4f5a8d":"markdown","cc5c7130":"markdown","ca5833e4":"markdown","b0059a69":"markdown"},"source":{"ba7a2df9":"import warnings\nwarnings.filterwarnings('ignore')\nimport numpy as np\nimport pandas as pd\nimport seaborn as sns; sns.set()\nfrom matplotlib import pyplot as plt\n%config InlineBackend.figure_format = 'retina'","ad8aed0d":"data = pd.read_csv('..\/input\/mlcourse\/telecom_churn.csv')","ef747d47":"data.head()","c9959abc":"data.drop(['State', 'Voice mail plan'], axis=1, inplace=True)\ndata['International plan'] = data['International plan'].map({'Yes': 1,\n                                                             'No': 0})","62463a3f":"data.info()","7fdf1c7f":"y = data['Churn'].astype('int')","5b64491a":"X = data.drop('Churn', axis=1)","1d8a820c":"X.shape, y.shape","2c08b17f":"from sklearn.model_selection import train_test_split, cross_val_score\nimport numpy as np","e311caa0":"X_train, X_valid, y_train, y_valid = train_test_split(X, y, \n                                                      test_size=0.3, \n                                                      random_state=17)","56e1ab03":"X_train.shape, X_valid.shape","6ca3f9d1":"first_tree = DecisionTreeClassifier(random_state=17)","8daa986e":"np.mean(cross_val_score(first_tree, X_train, y_train, cv=5))","af6f2776":"from sklearn.neighbors import KNeighborsClassifier","2b238606":"first_knn = KNeighborsClassifier()","ce978253":"np.mean(cross_val_score(first_knn, X_train, y_train, cv=5))","e3d4f9ba":"from sklearn.model_selection import GridSearchCV","53aeb204":"tree_params = {'max_depth': np.arange(1, 11), 'max_features':[.5, .7, 1]}","27fbe6fd":"tree_grid = GridSearchCV(first_tree, tree_params, cv=5, n_jobs=-1)","ce0084ae":"%%time\ntree_grid.fit(X_train, y_train);","46efc5fa":"tree_grid.best_score_, tree_grid.best_params_","23e273a3":"knn_params = {'n_neighbors': range(5, 30, 5) }#+ list(range(50, 100, 10))}","ed811660":"knn_grid = GridSearchCV(first_knn, knn_params, cv=5)","8e4161f9":"%%time\nknn_grid.fit(X_train, y_train);","78dc9b7b":"knn_grid.best_score_, knn_grid.best_params_","a50a9098":"tree_valid_pred = tree_grid.predict(X_valid)","769a9b77":"from sklearn.metrics import accuracy_score","e1ce438e":"accuracy_score(y_valid, tree_valid_pred)","0cc0566f":"from sklearn.metrics import confusion_matrix","8096d917":"confusion_matrix(y_valid, tree_valid_pred)","08ac2c86":"np.bincount(y_valid)","4eeb23eb":"from sklearn.tree import export_graphviz","173eede7":"second_tree = DecisionTreeClassifier(max_depth=3).fit(X_train, y_train)\nsecond_tree.score(X_valid, y_valid)","5b496b3b":"import graphviz\nfrom sklearn.tree import export_graphviz","818784e9":"dot_data = export_graphviz(second_tree, out_file=None,\n               feature_names=X.columns, filled=True,)  \ngraph = graphviz.Source(dot_data)  \ngraph ","ec4f5a8d":"# Decision trees and nearest neighbors method in a customer churn prediction task\n\nLet's read data into a DataFrame and preprocess it. Store State in a separate Series object for now and remove it from the dataframe. We will train the first model without the State feature, and then we will see if it helps.","cc5c7130":"# Decision Tree\n\nWe begin our overview of classification and regression methods with one of the most popular ones \u2013 a decision tree. Decision trees are used in everyday life decisions, not just in machine learning. Flow diagrams are actually visual representations of decision trees. For example, Higher School of Economics publishes information diagrams to make the lives of its employees easier.\n\n\n\nIn terms of machine learning, one can see it as a simple classifier that determines the appropriate form of publication (book, article, chapter of the book, preprint, publication in the \"Higher School of Economics and the Media\") based on the content (book, pamphlet, paper), type of journal, original publication type (scientific journal, proceedings), etc.\n\nA decision tree is often a generalization of the experts' experience, a means of sharing knowledge of a particular process. For example, before the introduction of scalable machine learning algorithms, the credit scoring task in the banking sector was solved by experts. The decision to grant a loan was made on the basis of some intuitively (or empirically) derived rules that could be represented as a decision tree.\n","ca5833e4":"# max_depth setting","b0059a69":"Let's allocate 70% of the set for training (X_train, y_train) and 30% for the hold-out set (X_holdout, y_holdout). The hold-out set will not be involved in tuning the parameters of the models. We'll use it at the end, after tuning, to assess the quality of the resulting model. Let's train 2 models: decision tree and k-NN. We do not know what parameters are good, so we will assume some random ones: a tree depth of 5 and the number of nearest neighbors equal 10."}}