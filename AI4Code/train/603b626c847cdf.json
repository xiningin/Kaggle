{"cell_type":{"b2d7308b":"code","46cd7bc9":"code","5cadffba":"code","b732da02":"code","45716945":"code","c66e80cf":"code","85ab8a6f":"code","86fc3dd6":"code","368d639f":"code","145bec43":"code","ff7d4397":"markdown","60effbcb":"markdown","30700197":"markdown","6d1d7344":"markdown"},"source":{"b2d7308b":"!pip install imutils","46cd7bc9":"#####Imports\nimport os\nimport imutils #!pip install imutils\nimport numpy as np \nimport pandas as pd\nfrom matplotlib import pyplot as plt\nimport cv2\nfrom keras.models import Model\nfrom keras.applications.vgg16 import VGG16\nfrom keras.applications.vgg16 import preprocess_input\nfrom keras.layers import Flatten, Dense, Conv2D, MaxPooling2D, Dropout\nfrom tensorflow.keras.preprocessing.image import ImageDataGenerator\nfrom keras.callbacks import ModelCheckpoint, History","5cadffba":"#viewing data\ndata = pd.read_csv('..\/input\/pokemon-images-and-types\/pokemon.csv')\nprint('Original data')\nprint(data.head(5))\n#view and parse image folder\nimage_directory = \"..\/input\/pokemon-images-and-types\/images\/images\/\"\npokemon_filenames = os.listdir(image_directory)\npnames, primary_types = [], []\nfor path in os.listdir(image_directory):\n        #isolating pokemon name\n        pokemon_name = path.split('.')[0]\n        #isolating pokemon primary type\n        row = data[data['Name']==pokemon_name]\n        type1 = data['Type1'][int(row.index.values)]\n        #appending to new list\n        pnames.append(pokemon_name.capitalize())\n        primary_types.append(type1)      ","b732da02":"#Create new dataframe\/data\npokemon_d = {'Filename':pokemon_filenames, 'Pokemon':pnames, 'Primary_Type':primary_types}\npokemon_data = pd.DataFrame(pokemon_d)\nprint('Pokemon dataframe shape (row,col):', pokemon_data.shape) #(row, col)\nprint(pokemon_data.head(5))","45716945":"#view and resize images\ndef preprocess(directory, n, plot = False, save = False, outdir = ''):\n    '''\n    Given a list of image paths, output n preprocessed images\n    directory: folder that contain images\n    n: number of images to preprocess\n    plot: boolean to display images\n    save: boolean to save preprocess images\n    outdir: string to save preprocessed images\n    '''\n    for i in range(n):\n        #image = cv2.imread(directory + i)\n        image = cv2.imread(directory + pokemon_filenames[i], cv2.IMREAD_UNCHANGED) #change png transparent to white\n        image = imutils.resize(image, width = 120) #orignal shape is 120\n        (h, w) = image.shape[:2] #omitted channels\n        if plot:\n            plt.imshow(image)\n            plt.title(f\"{pnames[i]}: {primary_types[i]}\")\n            plt.show()\n        try:\n            if save:\n                dest = os.path.join(outdir, pokemon_filenames[i])\n                os.makedirs(os.path.dirname(dest), mode = 0o755, exist_ok = True)\n                plt.imsave(dest, image)\n        except Exception as e:\n            print(e)\n            print(\"Error reading image:\", pokemon_filenames[i])\n    return\n\npreprocess(image_directory, 4, plot=True)","c66e80cf":"#split using np: 60%, 20%, 20% split for training, validation and test sets\ntrain, validation, test = np.split(pokemon_data, [int(.6*len(pokemon_data)), int(.8*len(pokemon_data))])\ntrain, validation, test = train.reset_index(), validation.reset_index(), test.reset_index()\ndisplay(train, validation, test)","85ab8a6f":"#Designing model\nmodel = VGG16(include_top=False, input_shape=(120,120,3))\nflat = Flatten(input_shape=(3,3,512))(model.output)\ndense = Dense(512, activation='relu')(flat)\noutput = Dense(18, activation='softmax')(dense)\n#new model\nmodel = Model(inputs=model.inputs, outputs=output)\nmodel.summary()\n#plot_model(model)","86fc3dd6":"#Compile model & prep\/fit generators\nmodel.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])\ndatagen = ImageDataGenerator(rescale=1\/255)\n\ntrain_generator = datagen.flow_from_dataframe(\ndataframe=train,\ndirectory=\"..\/input\/pokemon-images-and-types\/images\/images\/\",\nx_col=\"Filename\",\ny_col=\"Primary_Type\",\nsubset=\"training\",\nbatch_size=50,\nseed=0,\nshuffle=True,\nclasses=['Water','Normal','Grass', 'Bug', 'Fire', 'Electric', 'Ground', 'Poison', 'Fairy', 'Fighting', 'Psychic', 'Rock', 'Ghost', 'Ice', 'Flying', 'Dragon', 'Dark', 'Steel'],\ntarget_size=(120,120))\n\nvalid_generator = datagen.flow_from_dataframe(\ndataframe=validation,\ndirectory=\"..\/input\/pokemon-images-and-types\/images\/images\/\",\nx_col=\"Filename\",\ny_col=\"Primary_Type\",\nsubset=\"training\",\nbatch_size=50,\nseed=0,\nshuffle=True,\nclasses=['Water','Normal','Grass', 'Bug', 'Fire', 'Electric', 'Ground', 'Poison', 'Fairy', 'Fighting', 'Psychic', 'Rock', 'Ghost', 'Ice', 'Flying', 'Dragon', 'Dark', 'Steel'],\ntarget_size=(120,120))\n\ntest_generator = datagen.flow_from_dataframe(\ndataframe=test,\ndirectory=\"..\/input\/pokemon-images-and-types\/images\/images\/\",\nx_col=\"Filename\",\ny_col=\"Primary_Type\",\nsubset=\"training\",\nbatch_size=50,\nseed=0,\nshuffle=True,\nclasses=['Water','Normal','Grass', 'Bug', 'Fire', 'Electric', 'Ground', 'Poison', 'Fairy', 'Fighting', 'Psychic', 'Rock', 'Ghost', 'Ice', 'Flying', 'Dragon', 'Dark', 'Steel'],\ntarget_size=(120,120))","368d639f":"#Fit model\n#filepath = \"..\/output\/kaggle\/working\/VGG16_model.hdf5\"\n#checkpoint = ModelCheckpoint(filepath, monitor='val_accuracy', verbose=2, save_best_only=True, mode='max')\nhistory = model.fit(train_generator,\n                             steps_per_epoch = 10, #num of training images\/batch_size\n                             epochs = 5,\n                             verbose = 2,\n                             validation_data = valid_generator,\n                             validation_steps= 10) #num of validation images\/batch_size\n                             #callbacks = [checkpoint]","145bec43":"results = model.evaluate_generator(test_generator, steps=20, verbose=1)\nprint(\"loss: \",results[0],\"accuracy: \",results[1])","ff7d4397":"# View and re-organize dataframe","60effbcb":"# Performance","30700197":"# Model","6d1d7344":"# Data prep"}}