{"cell_type":{"33bc8377":"code","5b7884ae":"code","56c4fcba":"code","f33fb992":"code","3745511f":"code","82cc96fc":"code","581ad2c5":"code","e06fc9bb":"code","45585855":"code","a39ed34a":"code","11783a77":"code","1d16613e":"code","ec92410f":"code","d4cfabed":"code","bb4ed05b":"code","137a4501":"code","fe0f2f84":"code","620aa9db":"markdown","f76e297c":"markdown","aa3c2f61":"markdown","f24da2f1":"markdown"},"source":{"33bc8377":"import geopandas as gpd\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n","5b7884ae":"df_mh_all_villages = gpd.read_file('..\/input\/mh-villages-v2w2\/MH_Villages v2W2.shp')[['DTNAME','GPNAME','VILLNAME']]\n# ['DTNAME','GPNAME','VILLNAME']\nprint(df_mh_all_villages.shape)\ndf_mh_all_villages.T","56c4fcba":"df_mh_all_villages[\"DTNAME\"].unique()","f33fb992":"print(len(df_mh_all_villages[\"DTNAME\"].unique()))\ndf_mh_all_villages[df_mh_all_villages[\"DTNAME\"]==\"Sangali\"]","3745511f":"df_mh_all_villages[df_mh_all_villages[\"DTNAME\"]==\"Mumbai\"]","82cc96fc":"df_mh_all_villages[df_mh_all_villages[\"VILLNAME\"].isnull()].shape","581ad2c5":"# We need to get rid of rows with missing village name","e06fc9bb":"# Are the village names unique given a district?\ndf_mh_all_villages.groupby(\"DTNAME\")[\"VILLNAME\"].agg([\"count\",\"nunique\"])","45585855":"df_ListOfTalukas = pd.read_csv(\"..\/input\/paani-foundations-satyamev-jayate-water-cup\/ListOfTalukas.csv\")\nprint(df_ListOfTalukas.shape)\ndf_ListOfTalukas.T","a39ed34a":"df_ListOfTalukas[\"District\"].unique()","11783a77":"print(\"Number of unique districts\",len(df_ListOfTalukas[\"District\"].unique()))\ndf_ListOfTalukas[df_ListOfTalukas[\"District\"]==\"Sangli\"]","1d16613e":"df_StateLevelWinners = pd.read_csv('\/kaggle\/input\/paani-foundations-satyamev-jayate-water-cup\/StateLevelWinners.csv')\nprint(df_StateLevelWinners.shape)\ndf_StateLevelWinners.T","ec92410f":"df_StateLevelWinners[\"District\"].unique()","d4cfabed":"from fuzzywuzzy import fuzz\n\ndistricts = df_mh_all_villages[\"DTNAME\"].unique().tolist()\n\ndef get_best_district_match(mydist, districts = districts ):    \n    fuzz_ratio = [fuzz.ratio(mydist, dist) for dist in districts]\n    max_ratio = max(fuzz_ratio)\n    idx_max = [i for i, j in enumerate(fuzz_ratio) if j == max_ratio]\n    #ToDo: if more than one match throw an error\n    return districts[idx_max[0]]    ","bb4ed05b":"get_best_district_match(\"Sangli\")","137a4501":"df_StateLevelWinners[\"district_m\"] = df_StateLevelWinners[\"District\"].apply(lambda x:get_best_district_match(x))","fe0f2f84":"_idx = df_StateLevelWinners[\"District\"] != df_StateLevelWinners[\"district_m\"]\ndf_StateLevelWinners.loc[_idx,[\"District\",\"district_m\"]]","620aa9db":"### There are a lot of duplicate village names in a district - thus we need information on Taluka for matching as we cannot simply use district and village name for matching","f76e297c":"# Pain of Entity Matching\n\n- 'Entity Matching' is common task in most of the data engineering pipeline which joins multiple datasets.    \n- Complexity of this problem could escalate as dataset coming from different sources.  \n- While working WaterCup dataset, we realise there are quite a lot of time we have names of the places typed differently in different datasets. \n- That leads us to creating a mapping of names manually, something like this:   \n`_df_ListOfTalukas = _df_ListOfTalukas.replace('Ahmednagar','Ahmadnagar') \\ . \n                                        .replace('Buldhana','Buldana') \\ \n                                        .replace('Sangli','Sangali') \\ \n                                        .replace('Nashik','Nasik')`\nOf course this is not way to go with bigger datasets and more granular mapping!\n- In this notebook we will try to address this issue using various traditional and some non-traditional but innovative methods!","aa3c2f61":"**There are different spellings for district names in both files also the number of unique districts is different**\n* GPNAME - most probably refers to gram panchayat name, so cannot be matched with Taluka\n* We will need to create a list of districts with ground truth spelling - let's use MH_Villages v2W2.shp for that ","f24da2f1":"This is a inprogress notebook.\n\nNotebook submitted in response to task#3:\nhttps:\/\/www.kaggle.com\/bombatkarvivek\/paani-foundations-satyamev-jayate-water-cup\/tasks?taskId=348\n\nAim is to find method that will identify the correct pair of District-Taluka-Village among different datasets."}}