{"cell_type":{"27811e9f":"code","5c0940c0":"code","07fc35b6":"code","3a166249":"code","27b8f3c2":"code","07213dea":"code","7b838e3a":"code","c2a4c827":"code","c142584d":"code","4b9d718a":"code","5e3b0559":"code","c0874d35":"markdown","8319e0f6":"markdown","efe9d427":"markdown","6d29072a":"markdown","9a7e7568":"markdown","93e478e6":"markdown","8ef2ee67":"markdown","a525e709":"markdown","8efbef6b":"markdown","9baa9e85":"markdown"},"source":{"27811e9f":"import numpy as np \nimport pandas as pd \nimport plotly.express as px\n\nimport ipywidgets as widgets","5c0940c0":"country_codes = pd.read_csv(\"..\/input\/iso-country-codes-global\/wikipedia-iso-country-codes.csv\")\ncountry_codes = country_codes.set_index(\"Alpha-2 code\")[\"English short name lower case\"]\ncountry_codes.name = \"country\"","07fc35b6":"df = pd.read_csv(\"..\/input\/unemployment-in-european-union\/une_rt_m.tsv\", sep=\"\\t\")\ncols = df.columns[0].split(\",\")  # Processed columns\ndf = df.merge(pd.DataFrame(dict(zip(cols, s.split(\",\"))) for s in df.iloc[:, 0].values), left_index=True, right_index=True)\ndf = df.iloc[:, 1:]\ndf[r\"country\"] = df[r\"geo\\time\"].map(country_codes)\ndf.loc[df[\"country\"].isna(), \"country\"] = df.loc[df[\"country\"].isna(), r\"geo\\time\"]\ndf = df[df[\"s_adj\"] == \"SA\"]\ndf.drop([r\"geo\\time\", \"s_adj\"], axis=1, inplace=True)\n\n# Assert no missing values \nassert not df.isna().any().any(), \"Missing values found\"\n\n# Replace collons with nans\ndf.replace(r\"\\s*:\\s*\", np.nan, inplace=True, regex=True)\n\nprint(df.shape)\ndf.head()","3a166249":"ts_df = df.melt(id_vars=[\"age\", \"unit\", \"sex\", \"country\"]).set_index(\"variable\")\nts_df.index = pd.to_datetime([c.replace(\"M\", \" \") for c in ts_df.index])","27b8f3c2":"ts_df[\"value\"] = ts_df[\"value\"].str.extract(r\"(\\d+\\.*\\d*)\").astype(float)","07213dea":"ts_df_pct = ts_df[ts_df[\"unit\"] == \"PC_ACT\"].drop(\"unit\", axis=1)  # Percentage Active Population\nts_df_th = ts_df[ts_df[\"unit\"] == \"THS_PER\"].drop(\"unit\", axis=1)  # Thousands","7b838e3a":"def f(country):\n    fig=px.line(ts_df_pct[ts_df_pct[\"country\"] == country], y=\"value\", color=\"sex\", facet_col=\"age\", title=f\"Unemployment in {country}\")\n    return fig\n\nw = widgets.interact(f, country=ts_df_pct[\"country\"].unique())","c2a4c827":"px.box(ts_df_pct, x=\"age\", color=\"sex\", y=\"value\", title=\"Unemployment Rate\")","c142584d":"unemployment_covid_rise = [(k, max(v) - min(v)) for k, v in ts_df_pct.loc[\"2020\":, :].set_index(\"value\").groupby(\"age sex country\".split()).groups.items()]\ncovid_df = pd.DataFrame(index=pd.MultiIndex.from_tuples([v[0] for v in unemployment_covid_rise]), data=[v[1] for v in unemployment_covid_rise]).reset_index()\ncovid_df.columns = [\"age\", \"sex\", \"country\", \"value\"]\npx.bar(covid_df.sort_values(\"value\"), x=\"country\", y=\"value\", color=\"sex\", facet_col=\"age\", title=\"Difference between Maximum and Minimum Unemployment Rate per country in 2020\")","4b9d718a":"px.box(covid_df, x=\"age\", color=\"sex\", y=\"value\", title=\"Difference between Maximum and Minimum Unemployment by group in 2020\")","5e3b0559":"min_year = ts_df_pct.index.year.min()\nmax_year = ts_df_pct.index.year.max()\nw = widgets.IntRangeSlider(\n    value=[2000, 2020],\n    min=min_year,\n    max=max_year,\n    step=1,\n    description='Select year:',\n    disabled=False,\n    continuous_update=False,\n    orientation='horizontal',\n    readout=True,\n    readout_format='d',\n)\n\ndef f(x):\n    title = f\"Correlation of unemployment rates between the years {x[0]} and {x[1]}\"\n    fig = px.imshow(ts_df_pct.loc[str(x[1]):str(x[0]), :].reset_index().pivot(index=[\"index\", \"age\", \"sex\"], columns=\"country\", values=\"value\").loc[(slice(None), \"TOTAL\", \"T\"), :].corr(), title=title, width=1000, height=1000)\n    return fig\n\na = widgets.interact(f, x=w)","c0874d35":"# Turning the Data Frame into a time series","8319e0f6":"# Understanding unemployment in Europe\nIn this notebook I will try to make a segmentation of data related to unemployment in various countries, in order to understand what are the factors that influence unemployment rate.\n\nBefore we begin modelling there are a few thing to understand about the Dataset (https:\/\/ec.europa.eu\/eurostat\/cache\/metadata\/en\/une_rt_m_esms.htm#unit_measure1587452538133).\n\nThe *units* are:\n\n- PC_ACT -> Percentage Active Population\n- THS_PER -> Thousands Person.\n\nIn the column *s_asj* I will only select the data after seasonal adjustement (SA) (See link above). ","efe9d427":"# Time series visualization\nUse the menu to select the country.\n\nThe two imediate conclusions of the graphs bellow are that, unemployment is much higher below the age of 25, and the unemployment rate in Woman is slightly higher than Men. ","6d29072a":"# Changing the values to numeric\nFor some reason, the value column is of the object date type, and there are some annoying number like \"24.4 p\". I will assume this is a mistake and remove the letters from this column and turn it into numeric.","9a7e7568":"Process the first column of the unemployment rate and map the country codes. ","93e478e6":"# Conclusion\nThe most interesting aspect of this analysis, to me, is that there are countries that have extreme negative unemployment correlations with other countries. I would really like to cross this information with other macro economic data to fugire out why (Maybe I will in the future). ","8ef2ee67":"Load the Country Codes Notebook.","a525e709":"# Which classes were generally more affected by Covid?\nGenerally, it seems that Men were more affected than Woman by Covid. Also, younger people were muc more affected than older people. ","8efbef6b":"# Correlation between unemployment rates (With Slider)\nNow I want to verify if the unemployment rate between the different countries is somewhat correalated, or not at all.","9baa9e85":"# Which countries were more affected by Covid.\nFor this, we will quantify what was the difference between the lowest and highest unemployment rate in the year 2020, for every country."}}