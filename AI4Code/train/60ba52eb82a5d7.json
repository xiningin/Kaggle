{"cell_type":{"ae9bae73":"code","dcb88a28":"code","b8aafb58":"code","465503de":"code","08e7533a":"code","74e1b36d":"code","8c8a74f2":"code","85807734":"code","49064851":"code","998b269d":"code","0feff2f2":"code","60dbf5ff":"code","7d9c8c86":"code","a56faa06":"code","4a5dc033":"code","ed356b24":"code","ef3d3e3c":"code","4fbce7b3":"markdown","f3bc1fdb":"markdown","53190d2b":"markdown","da890b5c":"markdown","54f88f43":"markdown","c738eea7":"markdown"},"source":{"ae9bae73":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.model_selection import RandomizedSearchCV, GridSearchCV\nfrom sklearn import metrics","dcb88a28":"# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","b8aafb58":"input_dir = '\/kaggle\/input\/santander-customer-transaction-prediction\/'\ndf_train = pd.read_csv(input_dir + \"train.csv\")\ndf_train","465503de":"var_columns =  [c for c in df_train.columns if c not in ['ID_code', 'target'] ]\nX = df_train.loc[:, var_columns]\ny = df_train.loc[:,'target']\nX.shape, y.shape","08e7533a":"RandomForestClassifier().get_params()","74e1b36d":"n_estimators_list = list(range(10,220,50))\ncriterion_list = ['gini', 'entropy']\nmax_depth_list = list(range(5,41,10))\nmax_depth_list.append(None)\nmin_samples_split_list = [x\/1000 for x in list(range(5, 41, 10))]\nmin_samples_leaf_list = [x\/1000 for x in list(range(5, 41, 10))]\nmax_features_list = ['sqrt', 'log2']\n\nparams_grid = {\n    'n_estimators': n_estimators_list,\n    'criterion': criterion_list,\n    'max_depth': max_depth_list,\n    'min_samples_split': min_samples_split_list,\n    'min_samples_leaf': min_samples_leaf_list,\n    'max_features': max_features_list\n}\n\nnum_combinations = 1\nfor k in params_grid.keys(): num_combinations *= len(params_grid[k])\n\nprint('Number of combinations = ', num_combinations)\nparams_grid","8c8a74f2":"def my_roc_auc_score(model, X, y): return metrics.roc_auc_score(y, model.predict(X))\n\nmodel_rf = RandomizedSearchCV(estimator=RandomForestClassifier(class_weight='balanced'),\n                              param_distributions=params_grid,\n                              n_iter=50,\n                              cv=3,\n                              scoring=my_roc_auc_score,\n                              return_train_score=True,\n                              verbose=2)\n\nmodel_rf.fit(X,y)","85807734":"model_rf.best_params_","49064851":"df_cv_results = pd.DataFrame(model_rf.cv_results_)\ndf_cv_results = df_cv_results[['rank_test_score','mean_test_score','mean_train_score',\n                           'param_n_estimators', 'param_min_samples_split','param_min_samples_leaf',\n                           'param_max_features', 'param_max_depth','param_criterion']]\ndf_cv_results.sort_values('rank_test_score', inplace=True)\ndf_cv_results[:20]","998b269d":"output_dir = '\/kaggle\/working\/'\ndf_cv_results.to_csv(output_dir + '\/random_search.csv', index=False)","0feff2f2":"n_estimators_list = [130,160,190]\ncriterion_list = ['gini']\nmax_depth_list = [35,55]\nmin_samples_split_list = [0.001, 0.005]\nmin_samples_leaf_list = [0.001, 0.005]\nmax_features_list = ['log2']\n\nparams_grid = {\n    'n_estimators': n_estimators_list,\n    'criterion': criterion_list,\n    'max_depth': max_depth_list,\n    'min_samples_split': min_samples_split_list,\n    'min_samples_leaf': min_samples_leaf_list,\n    'max_features': max_features_list\n}\n\nnum_combinations = 1\nfor k in params_grid.keys(): num_combinations *= len(params_grid[k])\n\nprint('Number of combinations = ', num_combinations)\nparams_grid","60dbf5ff":"def my_roc_auc_score(model, X, y): return metrics.roc_auc_score(y, model.predict(X))\n\nmodel_rf = GridSearchCV(estimator=RandomForestClassifier(class_weight='balanced'),\n                        param_grid=params_grid,\n                        cv=3,\n                        scoring=my_roc_auc_score,\n                        return_train_score=True,\n                        verbose=4)\n\nmodel_rf.fit(X,y)","7d9c8c86":"df_cv_results = pd.DataFrame(model_rf.cv_results_)\ndf_cv_results = df_cv_results[['rank_test_score','mean_test_score','mean_train_score',\n                           'param_n_estimators', 'param_min_samples_split','param_min_samples_leaf',\n                           'param_max_features', 'param_max_depth','param_criterion']]\ndf_cv_results.sort_values('rank_test_score', inplace=True)\ndf_cv_results","a56faa06":"output_dir = '\/kaggle\/working\/'\ndf_cv_results.to_csv(output_dir + '\/grid_search.csv', index=False)","4a5dc033":"model_rf.best_params_","ed356b24":"model_rf_fin = RandomForestClassifier(class_weight='balanced',\n                                      criterion='gini',\n                                      max_depth=55,\n                                      max_features='log2',\n                                      min_samples_leaf=0.005,\n                                      min_samples_split=0.005,\n                                      n_estimators=190)\nmodel_rf_fin.fit(X,y)","ef3d3e3c":"print('AUC Score = {:.4f}'.format(metrics.roc_auc_score(y, model_rf_fin.predict(X))))","4fbce7b3":"## Step3: GridSearchCV","f3bc1fdb":"## Step2: RandomizedSearchCV\nFirst, let us get the list of hyperparameters that can be tuned for a RandomForest Model","53190d2b":"# Santander Customer Transaction Prediction - Random Forest Hyperparam Tuning\n\nIn the Kaggle competition, the objective is to identify which customer will make a transaction in the future.\n\n**Link to the competition**: https:\/\/www.kaggle.com\/c\/santander-customer-transaction-prediction\/  \n**Type of Problem**: Classification  \n**Metric for evalution**: AOC (Area Under Curve)\n\nThis Python 3 environment comes with many helpful analytics libraries installed\nIt is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python","da890b5c":"## Step 1: Import data from CSV","54f88f43":"## Step4: Create the final model and evaluate the performance","c738eea7":"Specify the range of values for some important hyperparameters"}}