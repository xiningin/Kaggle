{"cell_type":{"4320dbc4":"code","ba5f0a17":"code","2d6ce087":"code","d678cf56":"code","c9df8aa9":"code","06f3ac3f":"code","1a4656fd":"code","92411bb2":"code","6782c051":"code","e7d9c48d":"code","3741a31d":"code","87e7233e":"code","58fe1420":"code","4ece91c7":"code","60d7366b":"code","660cf07f":"code","a7d936d5":"code","81d1d7d4":"code","f45fa269":"code","fd03419d":"code","61c351f3":"code","fb2ba18a":"code","2d4e3456":"code","77e70f19":"code","853a5b1f":"code","2687965d":"code","f3671221":"code","de92244d":"code","74f15271":"markdown","49385bff":"markdown","19eb6d59":"markdown","e60d1acf":"markdown","c28959b3":"markdown","649cc679":"markdown","8cc175ad":"markdown","a29e45af":"markdown"},"source":{"4320dbc4":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nfrom PIL import Image\nimport os\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","ba5f0a17":"# Get csv for type labels\npokemon_stats = pd.read_csv('\/kaggle\/input\/pokemon-images-and-types\/pokemon.csv')\npokemon_stats.set_index(\"Name\")\n\n# Get images for prediction\nimage_dir = \"..\/input\/pokemon-images-and-types\/images\/images\/\"\nimgs = os.listdir(image_dir)\npokemon_filenames = pd.DataFrame([[x.split(\".\")[0] for x in imgs],imgs]).T\npokemon_filenames.columns = ['Name','Filepath']\npokemon_filenames.set_index('Name')","2d6ce087":"pokemon_stats.head(10)","d678cf56":"TYPES = {\n    0:\"Water\",\n    1:\"Normal\",\n    2:\"Grass\", \n    3:\"Bug\" ,\n    4:\"Psychic\",\n    5:\"Fire\" ,\n    6:\"Rock\",\n    7:\"Electric\",\n    8:\"Poison\",\n    9:\"Ground\", \n    10:\"Fighting\",\n    11:\"Dark\",\n    12:\"Dragon\",\n    13:\"Ghost\",\n    14:\"Steel\", \n    15:\"Ice\",\n    16:\"Fairy\",\n    17:\"Flying\"  \n}","c9df8aa9":"key_list = list(TYPES.keys())\nval_list = list(TYPES.values())\n\nposition = val_list.index(\"Fire\")\nprint(key_list[position])","06f3ac3f":"def replace_type(x):\n    position = val_list.index(x)\n    return key_list[position]\n\ndef get_rgb_images(file):\n    if file.split(\".\")[1] == \"jpg\":\n        im = Image.open(image_dir+ file)\n        return np.asarray(im).astype(np.float32)\n    else:\n        im = Image.open(image_dir+ file).convert('RGBA')\n        im.load()\n        new_im = Image.new(\"RGB\", im.size, (255, 255, 255))\n        new_im.paste(im, mask = im.split()[3])\n        return np.asarray(new_im).astype(np.float32)\n\npokemon_joined = pokemon_stats.merge(pokemon_filenames,how='outer',indicator=True)\npokemon_joined[\"Name\"] = pokemon_joined[\"Name\"].apply(lambda x: x.split('-')[0])\npokemon_joined[\"Type1\"] = pokemon_joined.apply(lambda x: replace_type(x['Type1']), axis=1)\npokemon_joined[\"Image\"] = pokemon_joined.apply(lambda x: get_rgb_images(x['Filepath']), axis=1)\npokemon_joined","1a4656fd":"# Check if values\npokemon_joined[\"_merge\"].value_counts()","92411bb2":"pokemon_joined.Type1.value_counts()","6782c051":"import random\nfrom matplotlib import pyplot as plt\nfrom matplotlib import image\n\ndef get_filepaths(ds, type_,num):\n    idxs = list(ds[ds==\"Type1\"].index)\n    if len(idxs) > num:\n        idxs = random.sample(idxs,num)\n    pokemon = list(ds['Filepath'][idxs])\n    names = list(ds['Name'][idxs])\n    images = list(ds[\"Image\"][idxs])\n    return list(zip(pokemon,names, images))","e7d9c48d":"def display_type(type_, nb):\n    position = val_list.index(type_)\n    type_ = key_list[position]\n    \n    pkms = pokemon_joined[pokemon_joined[\"Type1\"] == type_]\n    filepaths = get_filepaths(pkms, type_, nb)\n    \n    fig=plt.figure(figsize=(20,3))\n    plt.box(False)\n    plt.xticks([])\n    plt.yticks([])\n    plt.text(0.04, 0.5, 'ground truth', fontsize=14, transform=plt.gcf().transFigure)\n    \n    for j in range(nb):\n        ax = fig.add_subplot(1,nb,j+1)\n        if j >= len(filepaths):\n            plt.box(False)\n            plt.xticks([])\n            plt.yticks([])\n            continue\n        filepath,name, image = filepaths[j]\n        img = np.asarray(image).astype('uint8')\n        plt.imshow(img)\n        plt.title(name)\n        plt.xticks([])\n        plt.yticks([])\n            \n        spine_color = 'green'\n        for spine in ax.spines.values():\n            spine.set_edgecolor(spine_color)\n            \n    plt.show()","3741a31d":"display_type(\"Ice\", 10)","87e7233e":"# Get sample image\nrgbImage = image.imread(image_dir+\"braixen.png\")\n\n# Divide image in 3 channels\nredChannel = rgbImage[:, :, 0]\ngreenChannel = rgbImage[:, :, 1]\nblueChannel = rgbImage[:, :, 2]\ntranspChannel = rgbImage[:, :, 3]\nnew_transp = (abs(transpChannel - 1) * 255).astype(int)\n\n\nallblack = np.zeros((120,120))\n\nr = np.dstack((redChannel, allblack, allblack))\ng = np.dstack((allblack, greenChannel, allblack))\nb = np.dstack((allblack, allblack, blueChannel))\na = np.dstack((allblack, allblack, allblack, transpChannel))\n\n# Display them all.\nplt.figure(figsize=(20,3))\n\nplt.subplot(1, 6, 1);\nplt.imshow(rgbImage);\nplt.fontSize = 20;\nplt.title('Original')\nplt.subplot(1, 6, 2);\nplt.imshow(r);\nplt.title('R')\nplt.subplot(1, 6, 3);\nplt.imshow(g)\nplt.title('G')\nplt.subplot(1, 6, 4);\nplt.imshow(b);\nplt.title('B')\nplt.subplot(1, 6, 5);\nplt.title('A')\nplt.imshow(a);\n\nplt.subplot(1, 6, 6);\nplt.title('RGB')\nrgb = np.dstack((redChannel + new_transp,greenChannel + new_transp,blueChannel + new_transp))\nplt.imshow(rgb)\nprint(rgbImage.shape)","58fe1420":"import tensorflow as tf\nfrom tensorflow.keras import datasets, layers, models","4ece91c7":"data = np.array(pokemon_joined[\"Image\"])\nxtrain = np.empty((data.shape[0], 120, 120, 3))\nfor i in range(data.shape[0]):\n    xtrain[i] = np.array(data[i])\n    \nytrain = np.array(pokemon_joined[\"Type1\"])\n\nprint(xtrain.shape)\nprint(ytrain.shape)","60d7366b":"from sklearn.model_selection import train_test_split\nX_train,X_test,y_train,y_test = train_test_split(xtrain,ytrain,test_size=0.2,random_state=2)\nX_test, X_val, y_test, y_val = train_test_split(X_test,y_test,test_size=0.3,random_state=2)\n\nprint(X_train.shape)\nprint(X_test.shape)\nprint(X_val.shape)\nprint(y_train.shape)\nprint(y_test.shape)\nprint(y_val.shape)","660cf07f":"plt.figure(figsize=(20,3))\nplt.subplot(1, 6, 1);\nplt.imshow(X_train[0].astype(\"uint8\"))\nplt.title(TYPES[y_train[0]])\nplt.subplot(1, 6, 2);\nplt.imshow(X_train[1].astype(\"uint8\"))\nplt.title(TYPES[y_train[1]])\nplt.subplot(1, 6, 3);\nplt.imshow(X_train[2].astype(\"uint8\"))\nplt.title(TYPES[y_train[2]])\nplt.subplot(1, 6, 4);\nplt.imshow(X_train[3].astype(\"uint8\"))\nplt.title(TYPES[y_train[3]])\nplt.subplot(1, 6, 5);\nplt.imshow(X_train[4].astype(\"uint8\"))\nplt.title(TYPES[y_train[4]])\nplt.subplot(1, 6, 6);\nplt.title(TYPES[y_train[5]])\nplt.imshow(X_train[5].astype(\"uint8\"))\nprint(\"5 first training images\")","a7d936d5":"X_train \/= 255.0\nX_test \/= 255.0","81d1d7d4":"# Model creation\nmodel = models.Sequential()\nmodel.add(layers.Conv2D(32, (3,3), activation='relu',input_shape=(120,120, 3)))\nmodel.add(layers.MaxPooling2D((2,2)))\nmodel.add(layers.Conv2D(64, (3,2),activation='relu'))\nmodel.add(layers.MaxPooling2D((2,2)))\nmodel.add(layers.Conv2D(64, (3, 3), activation='relu'))\nmodel.add(layers.Flatten())\nmodel.add(layers.Dense(64, activation='relu'))\nmodel.add(layers.Dense(18))\nmodel.compile(optimizer='adam',\n              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True),\n              metrics=['accuracy'])\n\nmodel.summary()","f45fa269":"history = model.fit(X_train, y_train, epochs=10, validation_data=(X_test, y_test))\n","fd03419d":"plt.plot(history.history['accuracy'], label='accuracy')\nplt.plot(history.history['val_accuracy'], label = 'val_accuracy')\nplt.xlabel('Epoch')\nplt.ylabel('Accuracy')\nplt.ylim([0, 1])\nplt.legend(loc='lower right')\n\ntest_loss, test_acc = model.evaluate(X_test, y_test, verbose=2)","61c351f3":"data2 = np.array(pokemon_joined.Image[(pokemon_joined[\"Type1\"] == 0) | (pokemon_joined[\"Type1\"] == 2)])\nxtrain = np.empty((data2.shape[0], 120, 120, 3))\nfor i in range(data2.shape[0]):\n    xtrain[i] = np.array(data2[i])\n\nytrain = np.array(pokemon_joined.Type1[(pokemon_joined[\"Type1\"] == 0) | (pokemon_joined[\"Type1\"] == 2)])\n\nprint(xtrain.shape)\nprint(ytrain.shape)","fb2ba18a":"from sklearn.model_selection import train_test_split\nX_train,X_test,y_train,y_test = train_test_split(xtrain,ytrain,test_size=0.2,random_state=2)\nX_test, X_val, y_test, y_val = train_test_split(X_test,y_test,test_size=0.3,random_state=2)","2d4e3456":"print(X_train.shape)\nprint(X_test.shape)\nprint(X_val.shape)\nprint(y_train.shape)\nprint(y_test.shape)\nprint(y_val.shape)","77e70f19":"plt.figure(figsize=(20,3))\nplt.subplot(1, 6, 1);\nplt.imshow(X_train[0].astype(\"uint8\"))\nplt.title(TYPES[y_train[0]])\nplt.subplot(1, 6, 2);\nplt.imshow(X_train[1].astype(\"uint8\"))\nplt.title(TYPES[y_train[1]])\nplt.subplot(1, 6, 3);\nplt.imshow(X_train[2].astype(\"uint8\"))\nplt.title(TYPES[y_train[2]])\nplt.subplot(1, 6, 4);\nplt.imshow(X_train[3].astype(\"uint8\"))\nplt.title(TYPES[y_train[3]])\nplt.subplot(1, 6, 5);\nplt.imshow(X_train[4].astype(\"uint8\"))\nplt.title(TYPES[y_train[4]])\nplt.subplot(1, 6, 6);\nplt.title(TYPES[y_train[5]])\nplt.imshow(X_train[5].astype(\"uint8\"))\nprint(\"5 first training images\")","853a5b1f":"X_train \/= 255.0\nX_test \/= 255.0","2687965d":"# Model creation\nmodel2 = models.Sequential()\nmodel2.add(layers.Conv2D(32, (3,3), activation='relu',input_shape=(120,120, 3)))\nmodel2.add(layers.MaxPooling2D((2,2)))\nmodel2.add(layers.Conv2D(64, (3,2),activation='relu'))\nmodel2.add(layers.MaxPooling2D((2,2)))\nmodel2.add(layers.Conv2D(64, (3, 3), activation='relu'))\nmodel2.add(layers.Flatten())\nmodel2.add(layers.Dense(64, activation='relu'))\nmodel2.add(layers.Dense(18))\nmodel2.compile(optimizer='adam',\n              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True),\n              metrics=['accuracy'])\n\nmodel2.summary()","f3671221":"history = model2.fit(X_train, y_train, epochs=10, validation_data=(X_test, y_test))","de92244d":"plt.plot(history.history['accuracy'], label='accuracy')\nplt.plot(history.history['val_accuracy'], label = 'val_accuracy')\nplt.xlabel('Epoch')\nplt.ylabel('Accuracy')\nplt.ylim([0, 1])\nplt.legend(loc='lower right')\n\ntest_loss, test_acc = model2.evaluate(X_val, y_val, verbose=2)","74f15271":"### Create training data","49385bff":"### Little analyse on image","19eb6d59":"Ouch! What an overfit! We certainly not have enough data for 18types. Plus some are not well represented (flying, fairy).\n\nLet's try with only water and grass\n\n### Guess between water and grass","e60d1acf":"## Plot data","c28959b3":"## Create CNN to predict type","649cc679":"### Model architecture","8cc175ad":"It seems a bit better but I think we need more data to do this kind of task.\nWe could use data augmentation to increase our data volume.","a29e45af":"## Get dataset"}}