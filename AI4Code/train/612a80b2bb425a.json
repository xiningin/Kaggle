{"cell_type":{"61aec4fb":"code","ab537afd":"code","2615f91f":"code","60f75619":"code","a994f9b3":"code","90409e32":"code","dbb9d657":"code","af565a30":"code","213ac0d5":"code","2ccf3961":"code","6434967d":"code","68274913":"code","1dd5946e":"code","faef8950":"code","9bbd63cd":"code","e7538ea6":"code","74c3cb66":"code","7b15b055":"code","3f9d70f1":"code","1c397100":"code","1b45566f":"code","677a415d":"code","69092bbe":"code","c10d5ed5":"code","f6f62d69":"code","23494b4e":"code","c6856318":"markdown","c416d964":"markdown","00ce18ad":"markdown","140f170a":"markdown","aad1f0a9":"markdown","11690422":"markdown","5383cc3d":"markdown","b6cc204a":"markdown","63521b61":"markdown","17284821":"markdown","c62af8ed":"markdown","13a3dd43":"markdown","48786ea0":"markdown","889bd634":"markdown","f62357a5":"markdown","73c8f360":"markdown","79dc61b1":"markdown","6dcf6419":"markdown","614625fb":"markdown","faa328de":"markdown","c46ccf36":"markdown"},"source":{"61aec4fb":"import numpy as np\nimport pandas as pd\n\nimport datetime\nimport math","ab537afd":"!ls ..\/input","2615f91f":"rain = pd.read_csv('..\/input\/weather-dataset-rattle-package\/weatherAUS.csv')\nrain.head()","60f75619":"#drop risk_mm\nrain.drop(['RISK_MM'], axis=1, inplace=True)\nrain.head()","a994f9b3":"for col in rain.columns:\n    print(col + ' has ' + str(round((rain[col].isnull().sum() \/ rain.shape[0]) * 100, 2)) + '% missing values')","90409e32":"rain.info()","dbb9d657":"#set date to datetime object\nrain['Date'] = pd.to_datetime(rain['Date'])\nrain.head()","af565a30":"#get unique locations\nlocations = rain['Location'].unique()\nlocations","213ac0d5":"rain.drop(['Evaporation', 'Sunshine'], axis=1, inplace=True)","2ccf3961":"month = [d.month for d in rain['Date']]\nrain['Month'] = month","6434967d":"rain.head()","68274913":"def compute_missing_seasonal_num_values(dataframe, column_name):\n    #separate to seasons\n    defaults = {'WindGustSpeed': 5.4, 'Pressure9am': 1013.00, 'Pressure3pm': 1013.00}\n    \n    spring = dataframe[(dataframe['Month']) >= 9 & (dataframe['Month'] < 12)]\n    sp_mean = np.mean(spring.loc[:,column_name])\n    if (math.isnan(sp_mean) == True) | (np.isnan(sp_mean) == True):\n        sp_mean = defaults[column_name]\n    \n    summer = dataframe[((dataframe['Month'] >= 1) | (dataframe['Month'] < 3)) & (dataframe['Month'] == 12)]\n    sm_mean = np.mean(summer.loc[:,column_name])\n    if (math.isnan(sm_mean) == True) | (np.isnan(sm_mean) == True):\n        sm_mean = defaults[column_name]\n    \n    fall = dataframe[(dataframe['Month'] >= 3) & (dataframe['Month'] < 6)]\n    fa_mean = np.mean(fall.loc[:,column_name])\n    if (math.isnan(fa_mean) == True) | (np.isnan(fa_mean) == True):\n        fa_mean = defaults[column_name]\n\n    winter = dataframe[(dataframe['Month'] >= 6) & (dataframe['Month'] < 9)]\n    wt_mean = np.mean(winter.loc[:,column_name])\n    if (math.isnan(wt_mean) == True) | (np.isnan(wt_mean) == True):\n        wt_mean = defaults[column_name]\n\n    return sp_mean, sm_mean, fa_mean, wt_mean","1dd5946e":"def fill_missing_seasonal_num_values(dataframe, location, column_name):\n    dfs = []\n        \n    sp, sm, fa, wt = compute_missing_seasonal_num_values(dataframe[dataframe['Location'] == location], column_name)\n    df = dataframe[dataframe['Location'] == location]\n\n    sp_df = df[(df['Month'] >= 9) & (df['Month'] < 12)]\n    sp_df[column_name].fillna(sp, inplace=True)\n    \n    sm_df = df[((df['Month'] >= 1) & (df['Month'] < 3)) | (df['Month'] == 12)]\n    sm_df[column_name].fillna(sm, inplace=True)\n    \n    fa_df = df[(df['Month'] >= 3) & (df['Month'] < 6)]\n    fa_df[column_name].fillna(fa, inplace=True)\n    \n    wt_df = df[(df['Month'] >= 6) & (df['Month'] < 9)]\n    wt_df[column_name].fillna(wt, inplace=True)\n\n    dfs.append(sm_df)\n    dfs.append(fa_df)\n    dfs.append(wt_df)\n\n    df = pd.concat(dfs)\n        \n    return df","faef8950":"cols = ['MinTemp', 'MaxTemp', 'Temp9am', 'Temp3pm', 'Humidity9am', 'Humidity3pm',\n        'Pressure9am', 'Pressure3pm', 'WindGustSpeed', 'WindSpeed9am', 'WindSpeed3pm']\ndf = rain.copy()\nfor col in cols:\n    dfs=[]\n    for location in locations:\n        dfs.append(fill_missing_seasonal_num_values(df.copy(), location, col))\n    df = pd.concat(dfs)\n\ndf.head()","9bbd63cd":"df.isnull().sum()","e7538ea6":"rain = df\nrain.isnull().sum()","74c3cb66":"rain['Rainfall'].fillna(0, inplace=True)\nrain.isnull().sum()","7b15b055":"rt_mode = rain['RainToday'].describe().top\nrain['RainToday'].fillna(rt_mode, inplace=True)\nrain.isnull().sum()","3f9d70f1":"rain['Cloud9am'].fillna(0, inplace=True)\nrain['Cloud3pm'].fillna(0, inplace=True)","1c397100":"def compute_missing_seasonal_cat_values(dataframe, column_name):\n    #separate to seasons\n    \n    spring = dataframe[(dataframe['Month']) >= 9 & (dataframe['Month'] < 12)]\n    sp_mode = spring[column_name].describe().top\n    if (type(sp_mode) == float):\n        sp_mode = dataframe[column_name].describe().top\n    \n    summer = dataframe[((dataframe['Month'] >= 1) | (dataframe['Month'] < 3)) & (dataframe['Month'] == 12)]\n    sm_mode = summer[column_name].describe().top\n    if (type(sm_mode) == float):\n        sm_mode = dataframe[column_name].describe().top\n\n    fall = dataframe[(dataframe['Month'] >= 3) & (dataframe['Month'] < 6)]\n    fa_mode = fall[column_name].describe().top\n    if (type(fa_mode) == float):\n        fa_mode = dataframe[column_name].describe().top\n\n    winter = dataframe[(dataframe['Month'] >= 6) & (dataframe['Month'] < 9)]\n    wt_mode = winter[column_name].describe().top\n    if (type(wt_mode) == float):\n        wt_mode = dataframe[column_name].describe().top\n       \n    return sp_mode, sm_mode, fa_mode, wt_mode","1b45566f":"def fill_missing_seasonal_cat_values(dataframe, location, column_name):\n    dfs = []\n        \n    sp, sm, fa, wt = compute_missing_seasonal_cat_values(dataframe[dataframe['Location'] == location], column_name)\n    df = dataframe[dataframe['Location'] == location]\n\n    sp_df = df[(df['Month'] >= 9) & (df['Month'] < 12)]\n    sp_df[column_name].fillna(sp, inplace=True)\n    \n    sm_df = df[((df['Month'] >= 1) & (df['Month'] < 3)) | (df['Month'] == 12)]\n    sm_df[column_name].fillna(sm, inplace=True)\n    \n    fa_df = df[(df['Month'] >= 3) & (df['Month'] < 6)]\n    fa_df[column_name].fillna(fa, inplace=True)\n    \n    wt_df = df[(df['Month'] >= 6) & (df['Month'] < 9)]\n    wt_df[column_name].fillna(wt, inplace=True)\n\n    dfs.append(sp_df)\n    dfs.append(sm_df)\n    dfs.append(fa_df)\n    dfs.append(wt_df)\n\n    df = pd.concat(dfs)\n        \n    return df","677a415d":"cols = ['WindGustDir', 'WindDir9am', 'WindDir3pm']\ndf = rain.copy()\nfor col in cols:\n    dfs=[]\n    for location in locations:\n        dfs.append(fill_missing_seasonal_cat_values(df.copy(), location, col))\n    df = pd.concat(dfs)\n\ndf.head()","69092bbe":"top = df['WindGustDir'].describe().top\ndf['WindGustDir'].fillna(top, inplace=True)\ndf.isnull().sum()","c10d5ed5":"rain = df","f6f62d69":"rain.isnull().sum()","23494b4e":"rain.to_csv('cleaned_weatherAUS.csv')","c6856318":"'Rainfall' is the measurement of the amount of rainfall that occured on the corresponding 'Date'. We can assume that 0 means it didn't rain at all and has 0 mm precipitation. Let's fill it then with zeroes.","c416d964":"'RainToday' is filled up with the mode of the column.","00ce18ad":"I defined another function for filling the missing values on the dataframe itself. The function above only computes the values for each season.","140f170a":"This Kernel mainly focuses on solving missing data.","aad1f0a9":"And let's double check to see all our changes so far..\n\nRISK_MM, Evaporation, and Sunshine columns should not be there anymore. And Month column should be there.","11690422":"'Cloud9am' and 'Cloud3pm' is measured using oktas. From 0 (clear sky) to 8 (completely overcast). We can fill the missing values with 0 okta which means it's a clear day.","5383cc3d":"Our data is all over Australia, which means there are lots of locations. Let's take all of these unique locations and store it on the variable 'locations'","b6cc204a":"First we double check where are our input data is and what's the exact directory name. Then load the csv file as a dataframe.","63521b61":"Again same with the problem awhile ago, WindGustDir has missing values on location level. I just filled it with the mode value of the overall dataframe. Considering that we've already dealt with the missing values of other locations.","17284821":"So now we can save this cleaned dataframe as a new csv file.","c62af8ed":"Now let's take care of the missing categorical values. Same as above, we define 2 functions -- (1) to compute the missing categorical values; (2) fill the missing values. In computing, I'm using the mode. But again, we compute this based on location and season.","13a3dd43":"Now let's fill up those missing numerical values.","48786ea0":"Then check which of our features are numerical and which are categorical.","889bd634":"And let's check if it worked and set the main dataframe as the computed one.","f62357a5":"And final check...","73c8f360":"Now if we're focusing on solving this problem as a classification problem, we must drop the 'RISK_MM' as it leaks out the information in predicting our target variable 'RainTomorrow'.","79dc61b1":"Let's look at the missing value stats. Computed by number of missing values in the column divided by total number of rows.","6dcf6419":"Since we notice that 'Date' is an object instead of a datetime object, we convert it accordingly.","614625fb":"Now let's define a function to compute the seasonal numerical values. This takes a dataframe (which should already be minimised to its location--more of this later) and the column name of what we will be working with.\n\nSeparate the dataframe into seasons (spring, summer, fall, winter dataframes) and compute the mean value of whatever column we're working on.\n\nNote that since our dataframe has missing WindGustSpeed and Pressure values even on location level, we must decide for default values on these features. If the computed mean value is NaN, then we use these default values.","faa328de":"Notice that 'Evaporation' and 'Sunshine' has ~40% missing values? To be honest we don't even know how this was measured so let's just drop these columns.","c46ccf36":"We know that Australia has 4 seasons. And we can't just fill the missing values with the mean value for each column. For example, 'MinTemp' or the Minimum Temperature of an area is changing depending on the season--what might be a 24 minimum temperature in Summer might be 14 in Winter. In order to be able to compute accurately, we must note what season it is for the missing value. The easiest way to denote the season is to see the month.\n\nSo let's create a new feature called 'Month'."}}