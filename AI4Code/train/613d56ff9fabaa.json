{"cell_type":{"dd70378a":"code","a5b99e1c":"code","4ab3e61f":"code","68cc620f":"code","1d574f73":"code","6117aba2":"code","46cea7ec":"code","299c17d0":"code","54888b4d":"code","ea61e5a5":"code","66e2e471":"code","00866908":"code","8e6b9909":"code","5e00bb2a":"code","3cae4226":"code","73aa8237":"code","1fdc7fc9":"code","39f678ad":"code","c26b41d5":"code","d25acfdd":"code","413c475a":"code","2d0e644c":"code","a4e25ff3":"code","85fd6582":"code","f9771888":"code","8a7c4741":"code","9f878b3a":"code","161d723b":"code","2b898f1b":"code","f9f17034":"code","4769759d":"code","5d5949bd":"code","5dc08817":"code","826048a7":"markdown","7a9cca17":"markdown","3e2b3a36":"markdown","4b72de4c":"markdown","4ff85c3a":"markdown","d938cf35":"markdown","b34c2854":"markdown","a4f4c4c0":"markdown","65f9501e":"markdown","23bcf271":"markdown","6c5d4622":"markdown","ceff71cf":"markdown","44a4bc97":"markdown","9c63d03c":"markdown","0afde657":"markdown","a4d85ef0":"markdown","8f8c5d56":"markdown","933a5f0c":"markdown","c743a6ef":"markdown","4a669af1":"markdown","41162f93":"markdown","82360d88":"markdown","b1ada8f9":"markdown","46901736":"markdown","6328a213":"markdown","f1255901":"markdown","8bb75447":"markdown"},"source":{"dd70378a":"import warnings\n#Remove anaconda warnings\nwarnings.filterwarnings(\"ignore\")\n\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom PIL import Image\nfrom wordcloud import WordCloud, STOPWORDS, ImageColorGenerator\n\nsns.set()\n\n%matplotlib inline\n\n\nplt.rcParams[\"figure.figsize\"] = 12, 9\nplt.style.use('fivethirtyeight')\n","a5b99e1c":"df_e = pd.read_csv('..\/input\/the-simpsons-dataset\/simpsons_episodes.csv').dropna()\nprint(df_e.shape)","4ab3e61f":"#Check the data\ndf_e.info()","68cc620f":"#Drop Useless col\ndf_e.drop(['image_url','production_code', 'video_url'], axis=1, inplace=True)\n#Sort for episodes \ndf_e.sort_values(['number_in_series'], inplace=True)\ndf_e.head()","1d574f73":"sns.lineplot(x='number_in_series', y='us_viewers_in_millions', data=df_e, linewidth=0.8 )\nplt.xlabel('Episode')\nplt.ylabel('US viewers in millions')\nplt.title('US viewers per episode')\nplt.show()","6117aba2":"df_e.groupby('season')['us_viewers_in_millions'].mean().plot(linestyle='--', marker='o', mfc='yellow', mec='black', linewidth=1.2)\nplt.xticks((np.arange(0, 30, step=1)))\nplt.xlabel('Season')\nplt.ylabel('Average US views in millions')\nplt.title('Average US views per season')\nplt.show()","46cea7ec":"df_e.loc[df_e['original_air_year'] == 2007, 'season']","299c17d0":"df_e.loc[df_e['title'] == 'Who Shot Mr. Burns? (Part One)']","54888b4d":"sns.lineplot(x='number_in_series', y='imdb_rating', data=df_e, linewidth= 0.6)\nplt.xlabel('Episodes')\nplt.ylabel('Rating (IMDB)')\nplt.title('IMDB rating per episode')\nplt.show()","ea61e5a5":"df_e.groupby('season')['imdb_rating'].mean().plot(linestyle='--', marker='o', mfc='yellow', mec='black', linewidth=1.2)\nplt.xticks((np.arange(0, 30, step=1)))\nplt.xlabel('Season')\nplt.ylabel('Average rating(IMDB)')\nplt.title('Average rating by season')\nplt.show()","66e2e471":"#Create a pivot table with episodes and ratigns\nep_piv = df_e.pivot_table(index='season', columns='number_in_season', values='imdb_rating')\nep_piv.head()","00866908":"#Heatmap visualization\nsns.heatmap(ep_piv, cmap='RdYlGn', annot=True, linewidths=0.2,cbar_kws={'label': 'rating'})\nplt.xlabel('Episode Number')\nplt.ylabel('Season')\nplt.title('IMDB rating per episode')\nplt.show()","8e6b9909":"#Worst episode ever\ndf_e[df_e.imdb_rating == df_e.imdb_rating.min()]","5e00bb2a":"#Best episode ever\ndf_e[df_e.imdb_rating == df_e.imdb_rating.max()]","3cae4226":"df_e.loc[df_e['title'] == 'The Springfield Files']","73aa8237":"df_c = pd.read_csv('..\/input\/the-simpsons-dataset\/simpsons_characters.csv')\ndf_c.head()","1fdc7fc9":"print(df_c.shape)","39f678ad":"df_c.dropna(inplace=True)\ndf_c.reset_index(drop=True, inplace=True)\ndf_c.head()","c26b41d5":"print(df_c.shape)","d25acfdd":"sns.countplot(x=df_c.gender)\nplt.title('Characters by gender')\nplt.xlabel('Gender')\nplt.ylabel('')\nplt.show()\n","413c475a":"df_d = pd.read_csv('..\/input\/the-simpsons-dataset\/simpsons_script_lines.csv').dropna()\ndf_d.head()","2d0e644c":"print(df_d.shape)","a4e25ff3":"df_d.sort_values(['number'], inplace=True)\ndf_d.head()","85fd6582":"#Drop some columns that we will not use\ndf_d.drop(['id', \n            'episode_id',   \n            'raw_text',     \n            'timestamp_in_ms',    \n            'speaking_line'],    \n            axis=1, \n            inplace=True)\ndf_d.head()","f9771888":"df_d['character_id'] = df_d['character_id'].astype('int64')","8a7c4741":"#Rename the column before merging\ndf_d.rename(columns={'character_id':'id'}, inplace=True)\ndf = df_c.merge(df_d, on='id', how='left').dropna()\ndf.head()","9f878b3a":"#Let's clean again some columns\ndf.drop(['normalized_name', 'number', 'raw_character_text'],axis=1, inplace=True)\n#Sort values by script lines\nengage = df.groupby('name')['name'].count().sort_values(ascending=False)\n#get the first 10 values\ntop_10 = engage[:10]\nprint(top_10)","161d723b":"#Lollipop plot\nfig, ax = plt.subplots()\nax.hlines(top_10.index, xmin=0, xmax=top_10.values, linewidth=2)\nax.plot(top_10.values, top_10.index, 'o', markersize=10, alpha=0.5)\nax.invert_yaxis()\nax.set_title('Top 10 characters for number of lines')\nax.set_xlabel('Number of lines')\n\n\nplt.show()","2b898f1b":"support = engage[10:40]","f9f17034":"fig, ax = plt.subplots()\nax.hlines(support.index, xmin=0, xmax=support.values, linewidth=2, color='orange')\nax.plot(support.values, support.index, 'o', markersize=10, alpha=0.5, color='orange')\nax.invert_yaxis()\nax.set_title('Best supporting cast by number of lines')\nax.set_xlabel('Number of lines')\n\n\nplt.show()","4769759d":"text = \" \".join(line for line in df_d.spoken_words)\nstopwords = set(STOPWORDS)\nstopwords.update([\"hey\", \"gonna\", \"yeah\", \"uh\", \"ya\", \"ho\", \"la\", \"em\",\n                   \"ah\", \"huh\", \"ooh\", \"gotta\", \"eh\", \"aw\", \"heh\", \"wow\",\n                   \"ow\", \"haw\", \"woo\",  \"ha\", \"wanna\", \"whoa\", \"hoo\", \"ye\", \"wait\",\"now\",\"Oh\",\"Well\",\"one\",\n                 \"go\", \"okay\", \"know\",\"right\",'look', 'let','got', 'Thank', 'see', 'will', 'want',\n                 'come', 'think', 'take', 'time', 'good', 'keep', 'say', 'make', 'going', 'Dad'])\nplt.figure(figsize=[15,7])\nwordcloud = WordCloud(max_words=1000, background_color=\"white\", stopwords=stopwords).generate(text)\nplt.imshow(wordcloud, interpolation='bilinear')\nplt.axis(\"off\")\nplt.show()","5d5949bd":"location = df_d.groupby('raw_location_text')['raw_location_text'].count().sort_values(ascending=False)\nbest_location = location[:10]","5dc08817":"fig, ax = plt.subplots(1,1)\nsns.barplot(y=best_location.index, x=best_location.values, palette='viridis')\nax.set_ylabel('Location')\nax.set_title('Top 10 locations')\nplt.show()","826048a7":"![](http:\/\/frinkiac.com\/img\/S03E19\/291597.jpg)","7a9cca17":"As we would expect, the Simpsons' family is the most engaged in the show and the first non-Simpson character is Montgomery Burns who still has a direct relationship with the most engaged character, Homer Simpson, being his boss.\nLet's see who are the supporting characters of the show.\n","3e2b3a36":"![](http:\/\/frinkiac.com\/img\/S08E21\/269101.jpg)","4b72de4c":"We can't do much with this data, let's just check the gender distribution of the characters ","4ff85c3a":"Oh my, looks like we have a lot of Simpson characters here. Luckly we have the gender value only for the main characters, dropping the missing values will leave us with a more manageable data frame.","d938cf35":"After removing some of the most common words in the english language, with no surprises, we have that the most common words are the names of the main characters.\nNow let's try to see where the action is taking places.","b34c2854":"![](http:\/\/frinkiac.com\/img\/S08E10\/1165663.jpg)","a4f4c4c0":"![](http:\/\/frinkiac.com\/img\/S08E14\/961843.jpg)","65f9501e":"9.0, pretty good! And it's from season 8 as well. Now Let's move on with the other data sets.","23bcf271":"Here we have the script lines of every character by episode and we can pull off some cool plots from here. We will start with some cleaning and sorting operations.","6c5d4622":"![](http:\/\/frinkiac.com\/img\/S10E01\/78778.jpg)","ceff71cf":"Looks like we have two best episodes both from season 8. Let's check my favourite episode: _'The Springfield Files'_","44a4bc97":"![](http:\/\/frinkiac.com\/img\/S13E17\/1214296.jpg)","9c63d03c":"Here too we can see that, with time, ratings have decresed. Let's group the ratings by season to have a clearer view of the situation. ","0afde657":"We will read the first dataset which contains information about the episodes till season 27. We will drop the missing values as they belong to season 28 (we only have data for the first episode of this season)","a4d85ef0":"Convert character_id in int so I can merge this dataframe with the one of the characters ","8f8c5d56":"Nope, the movie was released between season 18 and 19. So maybe we have a spike because the season 11 finale is _'Who Shot Mr. Burns?'_ Let's check it out.","933a5f0c":"So the things look quite different here. We can see that after season 8 ther's been a great decline in the average season rating but this doesn't mean there were no good episodes after season 8; the seasons ovearll had less great episodes. By the way, if you are planning to binge watch the Simpsons, according to this plot, seasons 5 and 7 were the best. But if yout want to watch only the best episodes, the next plot is going to be more useful.","c743a6ef":"As we can see here, the vast majority of dialogues takes place at Simpson Home.\nThis concludes this simple EDA of one of my favourite shows. I hope you liked it and found it interesting, also this is my first post on Kaggle and I'm working to improve.\n\nAll images from: [frinkiac](http:\/\/frinkiac.com)","4a669af1":"Just for fun let's create a wordcloud rapresentation of the most common words in the show. This kind of rapresentation has no statistical value but it's not too hard to do and pretty good to see.","41162f93":"Let's see how the viewers have changed with time","82360d88":"That's not the case. That episode was the finale of season 6.\nLet's move on and see how the ratings changed during time.","b1ada8f9":"Looks like that most of the Simpsons cast is made up of male characters.\nLet's move on with the analysis and open up a new dataframe.","46901736":"Sadly we have some missing values here and there and just the first episode of season 28; but the situtation is still clear. Here we can see that even the 'new' seasons have some good episodes, like '_Barthood_'(season 27 episode 9). But now, let's find out the best and the worst episode ever.","6328a213":"We can see that, in general, the views have gone down during time.\n\nAnyway, 600 episodes are a lot to visualize so let's try to group this plot by Season.\n","f1255901":"# **They 'll never stop the Simpsons**\n\nA simple graphic analysis of The Simpsons show (data available till season 27)\n","8bb75447":"The trend is basically the same, but here we can see that after season 11 we have a little peak, till season 15 where the views go down again. Maybe this peak is a consequence of the movie that aired in 2007. Let's check if also season 11 aired in 2007."}}