{"cell_type":{"8448439c":"code","01d6ec88":"code","34964d85":"code","6f7dd635":"code","710889a7":"code","10e76f7d":"code","94bce929":"markdown","75461fa5":"markdown","cb50f634":"markdown","31074fef":"markdown","3dcf570b":"markdown"},"source":{"8448439c":"import pandas as pd\nimport numpy as np\nimport cv2\nimport matplotlib.pyplot as plt\nimport glob\nfrom pathlib import Path\nfrom tqdm import tqdm\nimport random\nimport os\n\nDATA_DIR = Path('..\/input\/seti-breakthrough-listen')","01d6ec88":"train_labels_df = pd.read_csv(DATA_DIR \/ 'train_labels.csv')\n\ntrain_files = glob.glob(str(DATA_DIR \/ 'train\/*\/*'))\ntrain_df = pd.DataFrame(train_files, columns=['file_path'])\ntrain_df['id'] = train_df['file_path'].apply(lambda x : x.split('\/')[-1].split('.')[0])\ntrain_df = train_df.merge(train_labels_df, how='left', on='id')","34964d85":"def show_cadence(filename: str, label: int) -> None:\n    fig = plt.figure(figsize=(16, 10))\n    arr = np.load(filename)\n    for i in range(6):\n        plt.subplot(6, 1, i + 1)\n        if i == 0:\n            plt.title(f\"ID: {os.path.basename(filename)} TARGET: {label}\", fontsize=18)\n        plt.imshow(arr[i].astype(float), interpolation='nearest', aspect='auto')\n        plt.text(5, 100, [\"ON\", \"OFF\"][i % 2], bbox={'facecolor': 'white'})\n        plt.xticks([])\n        plt.colorbar()\n    plt.show()\n    \nfor idx, row in train_df[train_df['id'].isin(['32d36db5de2c', '2c794ffd727d', '28672a977a68'])].iterrows():\n    show_cadence(row['file_path'], row['target'])\n","6f7dd635":"def dummy_signal_augmentation(img, target=0):\n\n    # signal shape\n    x = int(np.random.uniform(50, 250)) #\u30bb\u30f3\u30bf\u30fcx\n    y = int(np.random.uniform(800, 1300)) #\u30bb\u30f3\u30bf\u30fcy\n    ax_x = int(np.random.uniform(15, 30)) #\u6955\u5186\u6a2a\u306e\u5e83\u304c\u308a\n    ax_y = int(np.random.uniform(500, 650)) #\u6955\u5186\u7e26\u306e\u5e83\u304c\u308a\n    angle = np.random.uniform(-5, -1.5) #\u6955\u5186\u50be\u304d\n    start_angle = np.random.uniform(115, 130) \n    end_angle = np.random.uniform(220, 235)\n    color = np.random.uniform(0.8, 2.5)\n    \n    # signal_value\n    signal_value = np.random.uniform(4, 4.5)\n    \n    signal = np.full((1638, 256), 0, dtype=np.uint8)\n    signal = cv2.ellipse(signal, (x, y), (ax_x, ax_y), angle, start_angle, end_angle, color, thickness=1)\n    signal = np.where(signal > 0, signal_value, signal)\n    \n    augmentation_img = np.copy(img)\n    augmentation_img = np.vstack(augmentation_img.astype(np.float))\n    augmentation_img = augmentation_img + signal\n    \n    if target == 0:\n        return np.array(np.vsplit(augmentation_img, 6))\n    \n    split_img = np.vsplit(augmentation_img, 6)\n   \n    return np.array([split_img[0], img[1], split_img[2], img[3], split_img[4], img[4]])","710889a7":"for idx, row in train_df[train_df['target'] == 0].head(3).iterrows():\n    \n    arr = np.load(row['file_path'])\n    \n    plt.figure(figsize=(25,8))\n    for i in range(6):\n        \n        plt.subplot(6, 2, i * 2 + 1)\n        if i == 0:\n            plt.title(f\"ORIGINAL ID: {os.path.basename(row['file_path'])} TARGET: {row['target']}\", fontsize=18)\n        plt.imshow(arr[i].astype(float), interpolation='nearest', aspect='auto')\n        plt.text(5, 100, [\"ON\", \"OFF\"][i % 2], bbox={'facecolor': 'white'})\n        plt.xticks([])\n        plt.colorbar()\n    \n    \n    dummy_signal_arr = dummy_signal_augmentation(arr)\n    for i in range(6):\n        \n        plt.subplot(6, 2, i * 2 + 2)\n        if i == 0:\n            plt.title(f\"AUGMENTATION ID: {os.path.basename(row['file_path'])} TARGET: {row['target']}\", fontsize=18)\n        plt.imshow(dummy_signal_arr[i].astype(float), interpolation='nearest', aspect='auto')\n        plt.text(5, 100, [\"ON\", \"OFF\"][i % 2], bbox={'facecolor': 'white'})\n        plt.xticks([])\n        plt.colorbar()\n        \n    plt.show()","10e76f7d":"for idx, row in train_df[train_df['target'] == 0].head(3).iterrows():\n    \n    arr = np.load(row['file_path'])\n    \n    plt.figure(figsize=(25,8))\n    for i in range(6):\n        \n        plt.subplot(6, 2, i * 2 + 1)\n        if i == 0:\n            plt.title(f\"ORIGINAL ID: {os.path.basename(row['file_path'])}\", fontsize=18)\n        plt.imshow(arr[i].astype(float), interpolation='nearest', aspect='auto')\n        plt.text(5, 100, [\"ON\", \"OFF\"][i % 2], bbox={'facecolor': 'white'})\n        plt.xticks([])\n        plt.colorbar()\n    \n    \n    dummy_signal_arr = dummy_signal_augmentation(arr, target=1)\n    for i in range(6):\n        \n        plt.subplot(6, 2, i * 2 + 2)\n        if i == 0:\n            plt.title(f\"AUGMENTATION ID: {os.path.basename(row['file_path'])}\", fontsize=18)\n        plt.imshow(dummy_signal_arr[i].astype(float), interpolation='nearest', aspect='auto')\n        plt.text(5, 100, [\"ON\", \"OFF\"][i % 2], bbox={'facecolor': 'white'})\n        plt.xticks([])\n        plt.colorbar()\n        \n    plt.show()","94bce929":"Can you see the signal added to the right image?  \nAnd the signal appears across the OFF image as well.  \n(The value is made larger to make the signal easier to understand.)  \n  \nI think that by training with this image, it may be possible to correctly predict images that my model could not classify.  \n   \n  \nAnd furthermore, I think that this method not only adds noise to the label=0 data, but also has the potential to increase the label=1 data.  \nThe specific method is to replace the OFF image with the original data from the data created by the above method.  \nThe following shows the label=1 image data created from the label=0 image data.  ","75461fa5":"The signal appears only in the ON image, and I was able to generate an image that looks like needle!","cb50f634":"All of the images shown above have label=0, but contain a signal.  \nAnd that signal is also shown in the OFF image.  \n","31074fef":"First of all, I'm not very good at English, so I'm using a translator; if there's anything in the notepad that you don't understand, please ask.\u3000\u3000\n  \nMy prediction model may predict that label=1 for an image in which the signal appears across OFF images as shown below.  \nHowever, in reality, label=0, so this prediction is wrong.  \n  \nTherefore, I thought of reducing this error by creating many similar images and training them.  ","3dcf570b":"My idea is to use opencv to display a fake signal on the image.    \nThe image on the left is the original image and the image on the right is the image with the fake signal rendered.    \n"}}