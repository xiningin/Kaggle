{"cell_type":{"0fecddfc":"code","befcab70":"code","7f334d23":"code","60786a06":"code","49f7de31":"code","b9a2f8e8":"code","6e8244fe":"code","396f22f6":"code","3f012982":"code","fdd5d5f8":"code","da1a6a6a":"code","46b41a9d":"code","205de8a9":"code","aeb38ef9":"code","3f32d047":"code","f1d2d80a":"code","565e8966":"code","b3e00e5a":"code","6db400e4":"code","3b252c1a":"code","c29db459":"code","20b7efad":"code","50f9228c":"code","6a022f7a":"code","2e46834e":"code","99c162b3":"code","1a581672":"code","8a25d8a4":"code","b1616983":"code","349e4eb8":"code","2661e2dc":"code","95dad9c3":"code","c288fa8b":"code","9f81483e":"code","6c60143e":"code","d17ea7dd":"code","de80e8ba":"code","85e3151c":"code","dacbce36":"code","947147f4":"code","7b7019ec":"code","880eb088":"code","bb448f9e":"code","f2e2fb9c":"code","c8dd9622":"code","fb2312e4":"code","3e3141f4":"code","5a5eff89":"code","6a36a3ca":"markdown","e644d004":"markdown","f209a54d":"markdown","b88ea814":"markdown","abec46ce":"markdown","8a6f9a5f":"markdown","8effe488":"markdown","59cb6261":"markdown","3b694699":"markdown","7dd58f9d":"markdown","9bbaa208":"markdown","08b12a6f":"markdown"},"source":{"0fecddfc":"import datetime \n\nimport numpy as np\nimport pandas as pd\n\nfrom sklearn.experimental import enable_iterative_imputer\nfrom sklearn.preprocessing import MinMaxScaler\nfrom sklearn.impute import IterativeImputer","befcab70":"features_df = pd.read_csv('..\/input\/retaildataset\/Features data set.csv')\nsales_df = pd.read_csv('..\/input\/retaildataset\/sales data-set.csv')\nstores_df = pd.read_csv('..\/input\/retaildataset\/stores data-set.csv')","7f334d23":"features_df.head()","60786a06":"sales_df.head()","49f7de31":"stores_df.head()","b9a2f8e8":"one_hot_encoding = pd.get_dummies(stores_df['Type'])\nstores_df = stores_df.join(one_hot_encoding)\nstores_df = stores_df.drop(columns=['Type'])\nstores_df.head()","6e8244fe":"week_sales_df = sales_df.groupby(['Date', 'Store', 'Dept']).agg({'Weekly_Sales': 'sum'}).sort_index()\nweek_sales_df.reset_index(inplace=True)\ntraining_df = pd.merge(features_df, week_sales_df, how='left', on=[\"Date\", \"Store\"])\ntraining_df = pd.merge(training_df, stores_df, how='left', on=[\"Store\"])","396f22f6":"training_df.head()","3f012982":"training_df.isna().sum()","fdd5d5f8":"def gen_datetime(date_str):\n    return datetime.datetime.strptime(date_str, '%d\/%m\/%Y')\n\ntraining_df['DateTime'] = training_df['Date'].map(gen_datetime)","da1a6a6a":"training_df = training_df.set_index(['DateTime', 'Store', 'Dept']).sort_index()","46b41a9d":"training_df.head()","205de8a9":"training_df['CPI'] = training_df['CPI'].interpolate(method='linear')\ntraining_df['Unemployment'] = training_df['Unemployment'].interpolate(method='linear')","aeb38ef9":"training_df.isna().sum()","3f32d047":"training_df['MarkDown1'] = IterativeImputer(random_state=0).fit_transform(training_df['MarkDown1'].values.reshape(-1, 1))\ntraining_df['MarkDown2'] = IterativeImputer(random_state=0).fit_transform(training_df['MarkDown2'].values.reshape(-1, 1))\ntraining_df['MarkDown3'] = IterativeImputer(random_state=0).fit_transform(training_df['MarkDown3'].values.reshape(-1, 1))\ntraining_df['MarkDown4'] = IterativeImputer(random_state=0).fit_transform(training_df['MarkDown4'].values.reshape(-1, 1))\ntraining_df['MarkDown5'] = IterativeImputer(random_state=0).fit_transform(training_df['MarkDown5'].values.reshape(-1, 1))","f1d2d80a":"training_df = training_df.reset_index()","565e8966":"training_df = training_df[training_df['Dept'].notna()]","b3e00e5a":"training_df.isna().sum()","6db400e4":"training_df.head()","3b252c1a":"training_df['Year'] = training_df['Date'].map(lambda x: int(x[-4:]))","c29db459":"training_df.head()","20b7efad":"def day_of_year(date_str):\n    date = datetime.datetime.strptime(date_str, '%d\/%m\/%Y')\n    return date.timetuple().tm_yday\n\ntraining_df['DayOfYear'] = training_df['Date'].map(day_of_year)\ntraining_df['DayOfYearCos'] = np.cos(training_df['DayOfYear'])\ntraining_df['DayOfYearSin'] = np.sin(training_df['DayOfYear'])","50f9228c":"training_df.head()","6a022f7a":"training_df = training_df.drop(columns=['Date'])","2e46834e":"training_df.head()","99c162b3":"training_df['Store'] = MinMaxScaler().fit_transform(training_df['Store'].values.reshape((-1, 1)))\ntraining_df['Temperature'] = MinMaxScaler().fit_transform(training_df['Temperature'].values.reshape((-1, 1)))\ntraining_df['Fuel_Price'] = MinMaxScaler().fit_transform(training_df['Fuel_Price'].values.reshape((-1, 1)))\ntraining_df['MarkDown1'] = MinMaxScaler().fit_transform(training_df['MarkDown1'].values.reshape((-1, 1)))\ntraining_df['MarkDown2'] = MinMaxScaler().fit_transform(training_df['MarkDown2'].values.reshape((-1, 1)))\ntraining_df['MarkDown3'] = MinMaxScaler().fit_transform(training_df['MarkDown3'].values.reshape((-1, 1)))\ntraining_df['MarkDown4'] = MinMaxScaler().fit_transform(training_df['MarkDown4'].values.reshape((-1, 1)))\ntraining_df['MarkDown5'] = MinMaxScaler().fit_transform(training_df['MarkDown5'].values.reshape((-1, 1)))\ntraining_df['CPI'] = MinMaxScaler().fit_transform(training_df['CPI'].values.reshape((-1, 1)))\ntraining_df['Unemployment'] = MinMaxScaler().fit_transform(training_df['Unemployment'].values.reshape((-1, 1)))\ntraining_df['IsHoliday'] = training_df['IsHoliday'].astype(int)\ntraining_df['Dept'] = MinMaxScaler().fit_transform(training_df['Dept'].values.reshape((-1, 1)))\ntraining_df['Weekly_Sales'] = MinMaxScaler().fit_transform(training_df['Weekly_Sales'].values.reshape((-1, 1)))\ntraining_df['Size'] = MinMaxScaler().fit_transform(training_df['Size'].values.reshape((-1, 1)))","1a581672":"training_df.head()","8a25d8a4":"training_df.tail()","b1616983":"training_df = training_df.set_index('DateTime')","349e4eb8":"training_set_df = training_df[:'2012-01-01']","2661e2dc":"training_set_df.head()","95dad9c3":"training_set_df.tail()","c288fa8b":"test_set_df = training_df['2012-01-01':]","9f81483e":"test_set_df.head()","6c60143e":"test_set_df.tail()","d17ea7dd":"X_training = training_set_df.drop(columns=['Weekly_Sales', 'Year', 'DayOfYear']).values\ny_training = training_set_df['Weekly_Sales'].values\nX_prediction = test_set_df.drop(columns=['Weekly_Sales', 'Year', 'DayOfYear']).values\ny_prediction = test_set_df['Weekly_Sales'].values","de80e8ba":"X_training.shape, y_training.shape, X_prediction.shape, y_prediction.shape","85e3151c":"from sklearn.model_selection import train_test_split\n\nX_train, X_test, y_train, y_test = train_test_split(X_training, y_training, test_size=0.33, random_state=0)","dacbce36":"X_train.shape, y_train.shape, X_test.shape, y_test.shape","947147f4":"from sklearn.tree import DecisionTreeRegressor\n\ndtr_regressor = DecisionTreeRegressor(max_depth=50, min_samples_leaf=200, random_state=0)","7b7019ec":"dtr_regressor = dtr_regressor.fit(X_train, y_train)\ndtr_regressor.score(X_test, y_test)","880eb088":"future_pred = dtr_regressor.predict(X_prediction)\ndtr_regressor.score(X_prediction, y_prediction)","bb448f9e":"from sklearn.ensemble import RandomForestRegressor\n\nrfr_regressor = RandomForestRegressor(n_estimators=20, max_depth=100, min_samples_leaf=150, random_state=0)","f2e2fb9c":"rfr_regressor = rfr_regressor.fit(X_train, y_train)\nrfr_regressor.score(X_test, y_test)","c8dd9622":"future_pred = rfr_regressor.predict(X_prediction)\nrfr_regressor.score(X_prediction, y_prediction)","fb2312e4":"from sklearn.ensemble import GradientBoostingRegressor\n\ngbr_regressor = GradientBoostingRegressor(n_estimators=20, max_depth=150, min_samples_leaf=150, random_state=0)","3e3141f4":"gbr_regressor = gbr_regressor.fit(X_train, y_train)\ngbr_regressor.score(X_test, y_test)","5a5eff89":"future_pred = gbr_regressor.predict(X_prediction)\ngbr_regressor.score(X_prediction, y_prediction)","6a36a3ca":"Date should be decomposed into Year and a cyclical feature for Day of Year","e644d004":"All three dataframes are grouped into a single one.","f209a54d":"Split training set from 2010 to 2011 and prediction set from 2012 to 2013","b88ea814":"Gradient Boosting Regressor is able to predict the value of unseen years with score of 0.87","abec46ce":"# Dataset Overview\n\nThe dataset is composed of three csv files.\n\nFeatures contains several features valid for each (store, date) tuple from 2010 to 2013\n\nSales contains the weekly sales value (our prediction target) for each (store, department, date) tuple\n\nStores contains information about each store in the dataset.","8a6f9a5f":"Normalizing values between 0 and 1","8effe488":"Split training set into train and test set","59cb6261":"The dataframe contains several NaN values that must be removed\/replaced","3b694699":"Decision Tree is able to predict value of unseen years with score of 0.85","7dd58f9d":"Type is a categorical feature with only three possible options. So it's better to one hot encode this feature for an easier modeling process.","9bbaa208":"Random Forest is able to predict value of unseen years with score of 0.86","08b12a6f":"In order to interpolate NaN values, the dataframe must be indexed by DateTime object"}}