{"cell_type":{"ba54caea":"code","7c648f6e":"code","fe353421":"code","95412e0b":"code","a8f254d7":"code","5bfe84df":"code","a7b0ad3a":"code","3329d9df":"code","220c8a31":"code","9430cc3a":"code","a52767bb":"code","8f4b3194":"code","6aa005c5":"code","5ffa9872":"code","a6029467":"code","c6124be4":"code","853245a3":"code","af383bd6":"code","bf4f5213":"code","c253d518":"code","9f4688cf":"code","1b369e4e":"code","c1388557":"code","c12c090d":"code","f51166cb":"code","a4c2f9dd":"code","cd2d48b1":"code","8f2b963b":"code","38035ad6":"code","cc66359c":"code","5b503abf":"code","3c1ef629":"code","feba58b7":"code","c3987b0c":"code","1c2abeab":"code","0a713a0e":"code","4dbb91b7":"code","cae2bcf2":"code","4e709fcf":"code","5a42aafa":"code","0473e20b":"code","44c95c38":"code","e311892d":"code","e04c67fb":"code","8ff07803":"code","3c622949":"code","6e82c0c9":"code","8555ee9c":"code","ec0acf69":"code","36f4fb29":"code","a2a22165":"code","b25c9d50":"code","12b04f4e":"code","b5171776":"code","7c39ef6a":"code","79b5fe26":"code","46554d9f":"code","5443f499":"code","d0e1a6f4":"code","b6fd9ccc":"code","d13fbff7":"code","ee72525f":"code","445dca2c":"code","7c06c2da":"code","910833b9":"code","65e88023":"code","5bc18bac":"code","af6a7471":"code","9a626ac0":"code","20b12579":"code","2181aa93":"code","690ad33f":"code","4d994486":"code","1fbf8606":"code","39dd1849":"markdown","f1dfec8f":"markdown","1dfe00e8":"markdown","a6764d96":"markdown","c60cfc49":"markdown","7ac53cb7":"markdown","3d232b67":"markdown","22da9535":"markdown","8345707d":"markdown","b254ecc3":"markdown","a5e11249":"markdown","1cb3df09":"markdown","699dbd64":"markdown","3da464a3":"markdown","0638653f":"markdown","db80ceeb":"markdown","132d43c0":"markdown","f9b1b6dd":"markdown","28c392ff":"markdown","e327c514":"markdown","3b6883ab":"markdown","d04bf37f":"markdown","a44d092b":"markdown","f5af8e21":"markdown","2762c400":"markdown","4534bea6":"markdown","92638ad8":"markdown","5602908f":"markdown","789c99bb":"markdown"},"source":{"ba54caea":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport datetime","7c648f6e":"train_data = pd.read_csv('..\/input\/rossmann-store-sales\/train.csv', parse_dates = True, low_memory = False)\ntrain_data.head()","fe353421":"train_data.info()","95412e0b":"train_data.shape","a8f254d7":"train_data['DayOfWeek'].unique()\n","5bfe84df":"train_data['Open'].unique()","a7b0ad3a":"train_data['Promo'].unique()","3329d9df":"train_data['StateHoliday'].unique()","220c8a31":"train_data['SchoolHoliday'].unique()","9430cc3a":"train_data.describe()","a52767bb":"store_data = pd.read_csv('..\/input\/rossmann-store-sales\/store.csv')\nstore_data.head()","8f4b3194":"store_data.shape","6aa005c5":"store_data.info()","5ffa9872":"store_data.describe()","a6029467":"store_data['CompetitionDistance'] = store_data['CompetitionDistance']\/1000\nstore_data.head()","c6124be4":"train_data.isnull().sum()","853245a3":"plt.figure(figsize = (10,5))\nsns.heatmap(train_data.isnull());","af383bd6":"train_data.hist(bins = 25, figsize=(18, 18), color = 'c');","bf4f5213":"max_clients = train_data['Customers'].max()\nctrain_data = train_data[train_data['Open'] == 0]\notrain_data = train_data[train_data['Open'] == 1]\n\nprint(\"The maximum number of clients per day was {}.\".format(max_clients))\n\n#Number of registers classified as 'opened store' or 'closed store'\nctrain_data = train_data[train_data['Open'] == 0]\notrain_data = train_data[train_data['Open'] == 1]\nn_closed = round(len(ctrain_data)\/len(store_data),0)\nn_open = round(len(otrain_data)\/len(store_data),0)\n\nprint(\"The number of days with closed stores was {} and the number of days with open stores was {}\".format(n_closed, n_open))\n\n","c253d518":"train_data.head()","9f4688cf":"train_data.drop(['Open'], axis = 1, inplace=True)\ntrain_data","1b369e4e":"#statistics for the new dataframe\ntrain_data.describe()","c1388557":"store_data.isnull().sum()","c12c090d":"plt.figure(figsize = (10,5))\nsns.heatmap(store_data.isnull());","f51166cb":"store_data[store_data['CompetitionDistance'].isnull()]","a4c2f9dd":"store_data[store_data['CompetitionOpenSinceMonth'].isnull()]","cd2d48b1":"store_data[store_data['CompetitionOpenSinceYear'].isnull()]","8f2b963b":"store_data[store_data['Promo2'] == 0]","38035ad6":"miss_cols = ['Promo2SinceWeek', 'Promo2SinceYear', 'PromoInterval',\n            'CompetitionOpenSinceYear', 'CompetitionOpenSinceMonth']\nfor str in miss_cols:\n  store_data[str].fillna(0, inplace=True)","cc66359c":"plt.figure(figsize = (10,5))\nsns.heatmap(store_data.isnull(), cbar = False);","5b503abf":"store_data['CompetitionDistance'].fillna(store_data['CompetitionDistance'].mean(), inplace = True)","3c1ef629":"plt.figure(figsize = (10,5))\nsns.heatmap(store_data.isnull(), cbar = False);","feba58b7":"#### Now the dataset is free from missing data. \n\nNow we will visualize graphically the variables contained in the stores dataframe","c3987b0c":"store_data.hist(bins = 25, figsize=(18,18), color = 'm');","1c2abeab":"train_data.head()","0a713a0e":"store_data.head()","4dbb91b7":"merged_data = pd.merge(train_data, store_data, how = 'inner', on = 'Store')\nmerged_data.head()","cae2bcf2":"merged_data.info()","4e709fcf":"merged_data.shape","5a42aafa":"correlations = merged_data.corr()\nf, ax = plt.subplots(figsize=(16,10))\nsns.heatmap(correlations, annot = True);","0473e20b":"#Another way to see the correlations, tin this case, related to sales. \ncorrelations = merged_data.corr()['Sales'].sort_values()\ncorrelations","44c95c38":"#Related to number of customers:\ncorrelations2 = merged_data.corr()['Customers'].sort_values()\ncorrelations2","e311892d":"merged_data['Year'] = pd.DatetimeIndex(merged_data['Date']).year\nmerged_data['Month'] = pd.DatetimeIndex(merged_data['Date']).month\nmerged_data['Day'] = pd.DatetimeIndex(merged_data['Date']).day\nmerged_data.head()","e04c67fb":"axis = merged_data.groupby('Month')[['Sales']].mean().plot(figsize = (16,5), marker = 'o', color = 'g')\naxis.set_title('Average sales per month')","8ff07803":"axis = merged_data.groupby('Month')[['Customers']].mean().plot(figsize = (16,5), marker = 'o', color = 'm')\naxis.set_title('Average clients per month')","3c622949":"axis = merged_data.groupby('Day')[['Sales']].mean().plot(figsize = (16,5), marker = 'o', color = 'r')\naxis.set_title('Average Sales per Day')","6e82c0c9":"axis = merged_data.groupby('Day')[['Customers']].mean().plot(figsize = (16,5), marker = 'o', color = 'c')\naxis.set_title('Average clients per day')","8555ee9c":"axis = merged_data.groupby('DayOfWeek')[['Sales']].mean().plot(figsize = (16,5), marker = 'o', color = 'r')\naxis.set_title('Average sales per day of the week')","ec0acf69":"axis = merged_data.groupby('DayOfWeek')[['Customers']].mean().plot(figsize = (16,5), marker = 'o', color = 'k')\naxis.set_title('Average customers per day of the week')","36f4fb29":"fig, ax = plt.subplots(figsize = (20,10))\nmerged_data.groupby(['Date', 'StoreType']).mean()['Sales'].unstack().plot(ax = ax);","a2a22165":"sns.barplot(x = 'Promo', y = 'Sales', data = merged_data);","b25c9d50":"sns.barplot(x = 'Promo', y = 'Customers', data = merged_data);","12b04f4e":"!pip install fbprophet","b5171776":"from fbprophet import Prophet","7c39ef6a":"def sales_prediction(store_id, sales_data, periods):\n  sales_data = sales_data[sales_data['Store'] == store_id]\n  sales_data = sales_data[['Date', 'Sales']].rename(columns = {'Date': 'ds', 'Sales': 'y'})\n  sales_data = sales_data.sort_values(by = 'ds')\n\n  model = Prophet()\n  model.fit(sales_data)\n  future = model.make_future_dataframe(periods = periods)\n  forecast = model.predict(future)\n  fig1 = model.plot(forecast, xlabel = 'Date', ylabel = 'Sales')\n  fig2 = model.plot_components(forecast)\n\n  return sales_data, forecast","79b5fe26":"df_origin, df_prediction = sales_prediction(10, merged_data, 90)","46554d9f":"df_origin.shape, df_prediction.shape","5443f499":"df_prediction.head()","d0e1a6f4":"df_prediction.tail(60)","b6fd9ccc":"df_prediction.tail(60).to_csv('sales_predictions.csv')","d13fbff7":"df_origin.tail()","ee72525f":"def sales_prediction(store_id, sales_data, holidays, periods):\n  sales_data = sales_data[sales_data['Store'] == store_id]\n  sales_data = sales_data[['Date', 'Sales']].rename(columns = {'Date': 'ds', 'Sales': 'y'})\n  sales_data = sales_data.sort_values(by = 'ds')\n\n  model = Prophet(holidays=holidays)\n  model.fit(sales_data)\n  future = model.make_future_dataframe(periods = periods)\n  forecast = model.predict(future)\n  fig1 = model.plot(forecast, xlabel = 'Date', ylabel = 'Sales')\n  fig2 = model.plot_components(forecast)\n\n  return sales_data, forecast","445dca2c":"merged_data.head()","7c06c2da":"school_holidays = merged_data[merged_data['SchoolHoliday'] == 1].loc[:, 'Date'].values\nschool_holidays.shape","910833b9":"school_holidays","65e88023":"len(np.unique(school_holidays))","5bc18bac":"state_holidays = merged_data[(merged_data['StateHoliday'] == 'a') | \n                                    (merged_data['StateHoliday'] == 'b') |\n                                    (merged_data['StateHoliday'] == 'c')].loc[:,'Date'].values","af6a7471":"state_holidays.shape","9a626ac0":"len(np.unique(state_holidays))","20b12579":"state_holidays = pd.DataFrame({'ds': pd.to_datetime(state_holidays),\n                               'holiday': 'state_holiday'})\nstate_holidays","2181aa93":"school_holidays = pd.DataFrame({'ds': pd.to_datetime(school_holidays),\n                               'holiday': 'school_holiday'})\nschool_holidays","690ad33f":"school_state_holidays = pd.concat((state_holidays, school_holidays))\nschool_state_holidays","4d994486":"df_original, df_prediction = sales_prediction(10, merged_data, school_state_holidays, 5)","1fbf8606":"df_prediction.head()","39dd1849":"Now we will visualize graphically the variable contained in the train_data dataset","f1dfec8f":"Now let's visualize the correlations between variables","1dfe00e8":"### EDA for Stores Dataset","a6764d96":"To simplify further analysis, let's convert CompetitionDistance variable:","c60cfc49":"#### Filling the missing numbers:\nWe have missing numbers in variables related to dates (weeks, years), so we have discrete points instead of a continuous variable that could have missing numbers filled by the mean, for example. ","7ac53cb7":"#### Day of the Week analysis","3d232b67":"Now we will focus on the dataframe in which we have only registers from when the stores are open","22da9535":"The most important information from these plots are:\n- Most of the sales are happening around the value of 5 to 6 thousand euros\n- Number of clients per day shows a greater frequency around 600\n- The store was on sale (variable Promo) around 40% of the time it was open","8345707d":"Creating a heatmap for the sales train data ","b254ecc3":"Now we do not have null data, except for the variable CompetitionDistance that must be treated now. In this case we have a continuous variable, as it is represented by the distance between the store and its competitors. We can fill missing numbers using the mean, as seen below: ","a5e11249":"#### Daily Analysis","1cb3df09":"### Merging the dataframes Store and Train","699dbd64":"We will use the store id ('Store' column) as a common variable between both dataframes","3da464a3":"## Predicting sales with Facebook Prophet","0638653f":"#### Some conclusions from the correlation matrix: \n- The obvious correlations are: \n    - Sales are strongly correlated to the 'customers'variable \n    - Sales are moderately correlated to the 'promo' variable, meaning that promotions may have an impact on sales but it is not that much strong. \n- Some interesting correlations are: \n    - Additional promotions (variable 'Promo2') does not have a great impact on the volume of sales as the correlation is of -0,091. Sometimes we may expect that more promotions are what is needed to increase sales but that is not always true. ","db80ceeb":"Checking the missing data:","132d43c0":"## Exploratory data analysis","f9b1b6dd":"Getting to know how the data is classified:","28c392ff":"### Visualising the data with time series","e327c514":"#### Main points from this data:\n- Most of the store's competitors are within 10 km distance\n- Around half of the stores take part in the aditional sales campaign\n","3b6883ab":"# Rossaman Sales prediction with facebook Prophet\n\n## The Problem\nWe have sales data from several stores and we want to predict sales in order to improve our stock logistics. \n\n## The solution \nAnalyse data and perform a sales prediction study using facebook prophet. ","d04bf37f":"Getting some important information quantitatively:","a44d092b":"We can see from this new analysis that, when we deleted the registers for the days the store was closed, the statistics changed. \n\nBefore, with all the data points, the mean for the sales was of around 5773 now it is 6955. The mean of the number of customers is another important variable that changed, going from 622 to 762 now. ","f5af8e21":"#### *In which dates there are school holidays?*","2762c400":"There are no null values that must be treated. ","4534bea6":"a= Public Holiday\nb= Easter\nc= Christmas","92638ad8":"#### Monthly Analysis","5602908f":"### EDA for Train Dataset","789c99bb":"- Clearly we can see an influence from Christmas in the the sales, with peak of number of clients in December. \n- Another small peak appears around the month of July, when it is summer vacations and probably there are more people going to the shops. \n- Around Janurary and February the number of clients is low, and this may be explained by the fact that these are the winter months after christmas. "}}