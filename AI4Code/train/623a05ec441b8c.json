{"cell_type":{"1fa32661":"code","7667e7ab":"code","572da174":"code","0ba1f52a":"code","ff3d249c":"code","c32132d0":"code","4355fa7f":"code","bfc786ec":"code","d04cc943":"code","da6f9067":"code","01bb927b":"code","69b39a19":"code","29e4c00c":"code","0ec8a468":"code","ac694e5f":"code","37780a4c":"code","44d0c0dd":"code","ccda6b49":"code","42025f85":"code","30fcf73c":"code","c75832d6":"code","3fea9b72":"code","4820ec53":"code","94652edc":"code","465fd008":"code","e795a5fa":"code","15f29310":"code","d18f7ffd":"code","c8b83b40":"code","b74ad5d4":"code","6fc01701":"code","33d95608":"code","71811da4":"code","515ff97d":"code","6904d4ca":"code","2f14ecff":"code","da153f26":"code","63b7a90e":"code","76169d2d":"code","6ed4e41f":"code","eadc161d":"code","ecccda40":"code","fef1b97a":"markdown","5e28798d":"markdown","f5c0f8c8":"markdown","7379b789":"markdown","e1b69e51":"markdown","bad700f5":"markdown","83ea81f7":"markdown","c413b3cb":"markdown","9253a289":"markdown","b1e0fe50":"markdown","3cc19767":"markdown","5be0437c":"markdown","5c99f395":"markdown","d46bf026":"markdown","7421620c":"markdown","a3992e17":"markdown","212b95e1":"markdown","45a18be1":"markdown","2d9ed72a":"markdown","d9752978":"markdown","c9710763":"markdown","96add51b":"markdown","22cea5fa":"markdown","fc9c8521":"markdown","d8c40854":"markdown","22a773d3":"markdown","e22ab3a9":"markdown"},"source":{"1fa32661":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set(style = \"darkgrid\", context = 'notebook', palette = 'deep')\nfrom matplotlib.ticker import (MultipleLocator, AutoMinorLocator)","7667e7ab":"%matplotlib inline","572da174":"data_file = '..\/input\/lending-club-loan-data-analysis\/loan_data.csv'","0ba1f52a":"loan_data = pd.read_csv(data_file)","ff3d249c":"loan_data.head()","c32132d0":"# Change the columns to have _ instead of .\nloan_data.columns","4355fa7f":"def rename_columns(a):\n    list_a = list(a)\n    return [str(i).replace(\".\",\"_\") for i in list_a]\n\n    ","bfc786ec":"loan_data.columns = rename_columns(loan_data.columns)\nloan_data.columns","d04cc943":"loan_data.head()","da6f9067":"loan_data.head()","01bb927b":"loan_data.dtypes\n","69b39a19":"loan_data.info()","29e4c00c":"loan_data[\"credit_policy\"].value_counts(normalize = True)*100","0ec8a468":"#Purpose in the Rejeted case\nrisky_loans = loan_data[loan_data[\"credit_policy\"]==0]\nrisky_loans.head()","ac694e5f":"risky_loans[\"purpose\"].value_counts(normalize = True)*100","37780a4c":"# loan_data[loan_data[\"purpose\"]==\"debt_consolidation\"][\"credit_policy\"].value_counts()","44d0c0dd":"loan_data[loan_data[\"purpose\"]==\"debt_consolidation\"][\"credit_policy\"].value_counts(normalize = True)*100","ccda6b49":"fig = plt.figure(figsize = (8,6))\nax1 = plt.subplot(1,1,1)\n\nsns.countplot(x = \"purpose\", hue = \"credit_policy\", data = loan_data)\nplt.xticks(rotation = 90, fontsize = 13)\nplt.title(\"Credit Health by purpose\", fontsize = 16)\nplt.xlabel(\"Purpose\", fontsize = 13)\nplt.ylabel(\"Number of loans\", fontsize = 13)\n\nplt.show()\n","42025f85":"# Calculating Risky\/Total count of loans by purpose\ntot_count_of_loans_by_purpose = loan_data.groupby([\"purpose\"])[\"credit_policy\"].count().reset_index()\ntot_count_of_risky_loans_by_purpose = loan_data[loan_data[\"credit_policy\"]==0].groupby([\"purpose\"])[\"credit_policy\"].count().reset_index()\n\nrisky_to_total_ratio_by_purpose = pd.merge(tot_count_of_risky_loans_by_purpose,tot_count_of_loans_by_purpose, on = 'purpose', suffixes = ('_x', '_y'))\nrisky_to_total_ratio_by_purpose.columns = [\"purpose\", \"Risky\",\"Total\"]\nrisky_to_total_ratio_by_purpose\n","30fcf73c":"risky_to_total_ratio_by_purpose[\"ratio\"] = risky_to_total_ratio_by_purpose[\"Risky\"]\/risky_to_total_ratio_by_purpose[\"Total\"]*100\nrisky_to_total_ratio_by_purpose.sort_values(\"ratio\", ascending = False)","c75832d6":"loan_data.groupby(\"credit_policy\").agg({'int_rate':['min','max','mean']})","3fea9b72":"fig = plt.figure(figsize = (10,8))\n\nax1 = plt.subplot(211)\n\nsns.histplot(loan_data[loan_data[\"credit_policy\"]==0][\"int_rate\"], kde = False)\nplt.axvline(x = loan_data[loan_data[\"credit_policy\"]==0][\"int_rate\"].mean(), color = 'r') # Mean line\n#plt.axvline(x = loan_data[loan_data[\"credit_policy\"]==0][\"int_rate\"].median(), color = 'b') # median line\nplt.ylabel(\"Counts\")\nplt.text(0.16,150,\"For Risky Loans. Mean={}\".format(round(loan_data[loan_data[\"credit_policy\"]==0][\"int_rate\"].mean(),2)), fontsize =13)\n\n\nax2 = plt.subplot(212)\nsns.histplot(loan_data[loan_data[\"credit_policy\"]==1][\"int_rate\"], kde = False)\nplt.axvline(x = loan_data[loan_data[\"credit_policy\"]==1][\"int_rate\"].mean(), color = 'r') # Mean line\n#plt.axvline(x = loan_data[loan_data[\"credit_policy\"]==0][\"int_rate\"].median(), color = 'b') # median line\nplt.ylabel(\"Counts\")\nplt.text(0.16,500,\"For Healthy Loans. Mean={}\".format(round(loan_data[loan_data[\"credit_policy\"]==1][\"int_rate\"].mean(),2)), fontsize =13)\n\nplt.show()","4820ec53":"fig = plt.figure(figsize = (10,8))\n\nax1 = plt.subplot(211)\n\nsns.histplot(loan_data[loan_data[\"credit_policy\"]==0][\"dti\"], kde = False)\nplt.axvline(x = loan_data[loan_data[\"credit_policy\"]==0][\"dti\"].mean(), color = 'r') # Mean line\n#plt.axvline(x = loan_data[loan_data[\"credit_policy\"]==0][\"int_rate\"].median(), color = 'b') # median line\nplt.ylabel(\"Counts\")\nplt.xlabel(\"Debt-to-income Ratio\", fontsize = 14)\nplt.text(20,150,\"For Risky Loans. Mean={}\".format(round(loan_data[loan_data[\"credit_policy\"]==0][\"dti\"].mean(),2)), fontsize =13)\n\n\nax2 = plt.subplot(212)\nsns.histplot(loan_data[loan_data[\"credit_policy\"]==1][\"dti\"], kde = False)\nplt.axvline(x = loan_data[loan_data[\"credit_policy\"]==1][\"dti\"].mean(), color = 'r') # Mean line\n#plt.axvline(x = loan_data[loan_data[\"credit_policy\"]==0][\"int_rate\"].median(), color = 'b') # median line\nplt.ylabel(\"Counts\")\nplt.text(20,400,\"For Healthy Loans. Mean={}\".format(round(loan_data[loan_data[\"credit_policy\"]==1][\"dti\"].mean(),2)), fontsize =13)\n\nplt.show()","94652edc":"fig = plt.figure(figsize = (10,8))\n\nax1 = plt.subplot(211)\n\nsns.histplot(loan_data[(loan_data[\"credit_policy\"]==0) & (loan_data[\"purpose\"]==\"debt_consolidation\")][\"dti\"], kde = False)\nplt.axvline(x = loan_data[(loan_data[\"credit_policy\"]==0) & (loan_data[\"purpose\"]==\"debt_consolidation\")][\"dti\"].mean(), color = 'r') # Mean line\n#plt.axvline(x = loan_data[loan_data[\"credit_policy\"]==0][\"int_rate\"].median(), color = 'b') # median line\nplt.ylabel(\"Counts\")\nplt.xlabel(\"Debt-to-income Ratio\", fontsize = 14)\nplt.text(20,85,\"For Risky Loans - Dbt Consolidation. Mean={}\".format(round(loan_data[(loan_data[\"credit_policy\"]==0) & (loan_data[\"purpose\"]==\"debt_consolidation\")][\"dti\"].mean(),2)), fontsize =13)\nplt.show()","465fd008":"mean_dti_by_purpose_policy= loan_data.groupby([\"purpose\",\"credit_policy\"])[\"dti\"].mean().reset_index()\nmean_dti_by_purpose_policy","e795a5fa":"fig = plt.figure(figsize = (10,8))\nax1 = plt.subplot(1,1,1)\n\nsns.barplot(data = mean_dti_by_purpose_policy,x =\"purpose\" , y=\"dti\", hue = \"credit_policy\")\nplt.xticks(rotation = 90, fontsize = 14)\nplt.ylabel(\"Debt to Income Ratio\", fontsize = 14)\nplt.xlabel(\"Purpose\", fontsize = 13)\nplt.title(\"Purpose vs DTI for Healthy and Risky Loans\", fontsize = 14)\n\nax2 = ax2.twinx().twiny()\nplt.axhline(y = loan_data[loan_data[\"credit_policy\"]==0][\"dti\"].mean(), color = 'blue', linestyle = '--', label = \"Avg DTI for Risky loans\")\nplt.axhline(y = loan_data[loan_data[\"credit_policy\"]==1][\"dti\"].mean(), color = 'orange', linestyle = '--', label = \"Avg DTI for Healthy loans\")\nplt.legend(loc = 1)\nplt.show()","15f29310":"fig = plt.figure(figsize = (15,8))\nax1 = plt.subplot(121)\nsns.heatmap(loan_data.corr('spearman'), annot = True, fmt = \".2f\", cmap = \"RdYlBu\")\nplt.title(\"Correlation Heat Map - Spearman Coeff\", fontsize = 14)\n\nax2 = plt.subplot(122)\nsns.heatmap(loan_data.corr('pearson'), annot = True, fmt = \".2f\", cmap = \"RdYlBu\")\nplt.title(\"Correlation Heat Map - Pearson Coeff\", fontsize = 14)\nplt.tight_layout()\nplt.show()","d18f7ffd":"fig = plt.figure(figsize=(8,6))\nax1 = plt.subplot(211)\n\nplt.title(\"Variation of Debt-to-Income Ratio vs Revolving Balance\", fontsize = 14)\nsns.scatterplot(data = loan_data[[\"dti\", \"revol_bal\", \"revol_util\",\"credit_policy\"]], x = \"dti\", y = \"revol_bal\", hue = \"credit_policy\")\n\nax1 = plt.subplot(212)\nsns.scatterplot(data = loan_data[[\"dti\", \"revol_bal\", \"revol_util\",\"credit_policy\"]], x = \"dti\", y = \"revol_util\", hue = \"credit_policy\")\n\n\nplt.show()","c8b83b40":"from matplotlib import patches\nfig = plt.figure(figsize = (8,6))\nax1 = plt.subplot(111)\n\nsns.scatterplot(data = loan_data[[\"fico\", \"int_rate\",\"credit_policy\"]], x = \"fico\", y = \"int_rate\", color = 'b', hue = \"credit_policy\")\nsns.regplot(data = loan_data[[\"fico\", \"int_rate\"]], x = \"fico\", y = \"int_rate\", color = 'b', scatter = False)\nplt.title(\"FICO vs Int. Rate \", fontsize = 14)\nplt.ylabel(\"Int Rate\", fontsize = 13)\nplt.xlabel(\"FICO - Credit Score\", fontsize = 13)\nrect = patches.Rectangle((660,0.055),100,0.02,edgecolor = \"r\", fill = False, linewidth = 2)\nax1.add_patch(rect)\nplt.text(625,0.08,\"Poor FICO score,\\nLow Interest Rates and healthy\", fontsize = 12, color = \"r\", fontweight = \"semibold\", )\nplt.show()","b74ad5d4":"from matplotlib import patches\nfig = plt.figure(figsize = (8,6))\nax1 = plt.subplot(111)\n\nsns.scatterplot(data = loan_data[loan_data[\"credit_policy\"]==0], x = \"fico\", y = \"int_rate\", color = 'b')\n#sns.regplot(data = loan_data[loan_data[\"credit_policy\"]==0], x = \"fico\", y = \"int_rate\", color = 'b', scatter = False)\nplt.title(\"FICO vs Int. Rate for Risky loans\", fontsize = 14)\nplt.ylabel(\"Int Rate\", fontsize = 13)\nplt.xlabel(\"FICO - Credit Score\", fontsize = 13)\n#rect = patches.Rectangle((660,0.055),100,0.02,edgecolor = \"r\", fill = False, linewidth = 2)\n#ax1.add_patch(rect)\n#plt.text(625,0.08,\"Poor FICO score,\\nLow Interest Rates and healthy\", fontsize = 12, color = \"r\", fontweight = \"semibold\", )\nplt.show()","6fc01701":"low_Fico_Int_Rates = loan_data[(loan_data[\"credit_policy\"]==1) & ((0.05<=loan_data[\"int_rate\"]) & (0.08>=loan_data[\"int_rate\"]))& (loan_data[\"fico\"]<725)]\nlow_Fico_Int_Rates.head()","33d95608":"loan_data[loan_data[\"credit_policy\"]==0].describe()","71811da4":"loan_data[loan_data[\"credit_policy\"]==1].describe()","515ff97d":"loan_data[[\"credit_policy\", \"days_with_cr_line\"]].groupby(\"credit_policy\").mean()","6904d4ca":"df_cr_line_policy = loan_data.loc[:,(\"credit_policy\", \"days_with_cr_line\")]\ndf_cr_line_policy[\"cr line duration in years\"] = np.round(df_cr_line_policy[\"days_with_cr_line\"].apply(lambda x: x\/365.25),2)\ndf_cr_line_policy.head()","2f14ecff":"#PLotting a scatter plot with years and the credit policy\nfig = plt.figure(figsize = (10,8))\nax1 = plt.subplot(111)\nsns.scatterplot(data = df_cr_line_policy, x = \"cr line duration in years\", y = \"credit_policy\")\nplt.title(\"Relationship Between Years of Credit and Health of a loan\", fontsize = 14)\nplt.show()","da153f26":"#Let's group the years in short term, medium term, long term and very long term loans\ndef duration_type(y):\n    if (0<=y) & (y<=3) :\n        return \"Short Term\"\n    elif (4<=y) & (y<=10):\n        return \"Medium Term\"\n    elif (11<=y) & (y<=20):\n        return \"Long Term\"\n    elif y>=21:\n        return \"Very Long Term\"\n\ndf_cr_line_policy[\"Duration_Type\"] = df_cr_line_policy[\"cr line duration in years\"].apply(lambda x : duration_type(x))\ndf_cr_line_policy.sort_values([\"cr line duration in years\"])","63b7a90e":"plt.figure(figsize = (8,6))\nax1 = plt.subplot(111)\n\nsns.countplot(data =df_cr_line_policy, x = \"Duration_Type\", hue = \"credit_policy\" )\n\nplt.title(\"Count of Loans with Year and credit policy\", fontsize = 14)\nplt.xlabel(\"Number of loans\", fontsize = 13)\nplt.ylabel(\"Duration of Loans and Cr.Policy\", fontsize = 13)\nplt.legend(loc  = 1)\nplt.show()","76169d2d":"fig = plt.figure(figsize = (10,8))\nax2 = plt.subplot(111)\nsns.heatmap(loan_data.corr('pearson'), annot = True, fmt = \".2f\", cmap = \"RdYlBu\")\nplt.title(\"Correlation Heat Map - Pearson Coeff\", fontsize = 14)\nplt.tight_layout()\nplt.show()","6ed4e41f":"loan_data[\"credit_policy\"].map({0:\"Risky\", 1:\"Healthy\"}).head()","eadc161d":"plt.figure(figsize=(6,6))\nax = plt.subplot(111)\nplt.scatter( x=loan_data[\"credit_policy\"].map({0:\"Risky\", 1:\"Healthy\"}), y = loan_data[\"inq_last_6mths\"], color = \"b\")\nplt.title(\"Credit Policy vs Inquiries in last 6 months\", fontsize = 14)\nplt.xlabel(\"Credit Policy\", fontsize = 13)\nplt.ylabel(\"# of Inquiries in last 6 months\", fontsize = 13)\nplt.text(0,10,\"Average Inquiries = {} per loan\".format(np.round(loan_data[loan_data[\"credit_policy\"]==1][\"inq_last_6mths\"].mean(),0)), fontsize = 13, color = \"r\")\nplt.text(0.25,30,\"Average Inquiries = {} per loan\".format(np.round(loan_data[loan_data[\"credit_policy\"]==0][\"inq_last_6mths\"].mean(),0)), fontsize = 13, color = \"r\")\nplt.show()","ecccda40":"from statsmodels.stats.outliers_influence import variance_inflation_factor\n\nvif_df = pd.DataFrame()\nlist_col = ['credit_policy', 'int_rate', 'installment', 'log_annual_inc',\n       'dti', 'fico', 'days_with_cr_line', 'revol_bal', 'revol_util',\n       'inq_last_6mths', 'delinq_2yrs', 'pub_rec', 'not_fully_paid'] # Added constant column to caluclate the VIF properly\nX = loan_data[list_col]\nX[\"constant\"] = 1\nvif_df[\"Features\"] = X.columns\n\nvif_df[\"VIF\"] = [variance_inflation_factor(X.values,i) for i in range(len(X.columns))]\nvif_df.sort_values(\"VIF\", ascending = False)","fef1b97a":"Looks like there are no missing values in the dataset. Checking on column wise data","5e28798d":"### Data Wrangling \n\n#### Step1 : Rename columns - from credit.policy to credit_policy etc","f5c0f8c8":"#### 2.1 Checking the datatypes of the columns","7379b789":"### From the correlation matrix in the heat map (from above) ","e1b69e51":"It is very evident that if the number of inquiries are more, than the loan will be classifed as Risky. FOr healthy loans, very few inquiries(<1 per loan) are made. Whereas, for risky loans, the average inquires are around 4 per loan.\n\nThis happens when the customer applies for a loan in multiple banks to get a quote of interst rates for comaprision and usually this approach works against the loan application.","bad700f5":"### Checking for missing values","83ea81f7":"Things to check :\nRelationship of other attributes with Credit Policy","c413b3cb":"#### Interest Rate","9253a289":"Identifying the loans that are termed \"Healthy\" in spite of having a low Credit Score and very low interest rates.\nListing all the loans with FICO < 725 but interest rates between 5% to 8%","b1e0fe50":"The average interest rate for the Risky loans is around 2% higher than the healthy loans.","3cc19767":"Around 26% of the Education purpose loans are termed \"Risky\" followed by small_businesses and all other purposes","5be0437c":"80% of the applicants meet the criteria of credit underwriting by LendingClub.com and 20% of the collected data does not comply with the criteria.\nFor loan underwriting, the False Negatives are more critical than the false positives. Meaning to say, it is ok for the club to evaluate a potential customer as \"Risky\" than evaulating a true risky customer as \"Safe\".\n\nStudying the 20% of the Risky cases may give further insights on the \"Risky\"citeria","5c99f395":"From the above chart, it is very evident that the long duration loans are less riskier than the short termed loans. However, very long terms loans are also little riskier compared to medium and long term loans.\n\n","d46bf026":"About Data\n\n- credit.policy: 1 if the customer meets the credit underwriting criteria of LendingClub.com, and 0 otherwise.\n- purpose: The purpose of the loan (takes values \"creditcard\", \"debtconsolidation\", \"educational\", \"majorpurchase\", \"smallbusiness\", and \"all_other\").\n- int.rate: The interest rate of the loan, as a proportion (a rate of 11% would be stored as 0.11). Borrowers judged by LendingClub.com to be more risky are assigned higher interest rates.\n- installment: The monthly installments owed by the borrower if the loan is funded.\n- log.annual.inc: The natural log of the self-reported annual income of the borrower.\n- dti: The debt-to-income ratio of the borrower (amount of debt divided by annual income).\n- fico: The FICO credit score of the borrower.\n- days.with.cr.line: The number of days the borrower has had a credit line.\n- revol.bal: The borrower's revolving balance (amount unpaid at the end of the credit card billing cycle).\n- revol.util: The borrower's revolving line utilization rate (the amount of the credit line used relative to total credit available).\n- inq.last.6mths: The borrower's number of inquiries by creditors in the last 6 months.\n- delinq.2yrs: The number of times the borrower had been 30+ days past due on a payment in the past 2 years.\n- pub.rec: The borrower's number of derogatory public records (bankruptcy filings, tax liens, or judgments).","7421620c":"The Debt to Income ratio is higher for the Risky loans. We can also check the DTI ratio for the debt_consolidation loans to assess the risk apetite","a3992e17":"The credit policy is a little negatively correlated with the inquiries made in the last 6 months. Let's us verify this with a scatter plot","212b95e1":"There appears to be no corelation between DTI and Revolving Balance\/Utilization. However, from the correlation coeff, it appears that the fico - Credit Scope and the interest rates are negatively correlated.","45a18be1":"Around 40% of risky loans are for Debt Consolidation urposes. Risk for Credit cards are at #3 with 13% of cases.\nIt would be interesting to see whether loan for debt consolidation are mostly risky.","2d9ed72a":"We can extend this analysis to other purposes to analyse the # of risky\/safe loan.","d9752978":"The DTI is correlated with Revolving Balance and Revolving utilization of the credit amount(using Spearman correlation). However, DTI is onlu correlated to Revolving Utiliization with Pearson corelation coefficient. \n\nIt will be better to determine the correct corelation alogithm to apply but looking the variation of DTI and Revol_Bal and Revol_util in a scatter plot","c9710763":"The higher the FICO score, the lower the interest rates. Also, the higher credit score have better risk credibility. However, there are a few cases where lower interest rates were offered even though the FICO score was very poor.\nOne possibility is if there hase been a compromise to adhere to the policy of loan disbursement and favours been granted.\n\nFor the sake of analysis, any FICO lower than 735 can be deened as poor credit score.","96add51b":"## CONCLUSIONS \n\n### The data did not contain any missing values. Therefore, imputation was not required.\n\n1. Around 40% of risky loans are for Debt Consolidation urposes. Risk for Credit cards are at #3 with 13% of cases. It would be interesting to see whether loan for debt consolidation are mostly risky.\n2. Around 1\/4th of the Education purpose loans are termed \"Risky\".\n3. The average interest rate for the Risky loans is around 2% higher than the healthy loans.\n4. Higher the DTI ratio, higher the chances of risk. The average DTI for a healthy loan is ~12.5. However, DTI with values as low as 10.5 can also be risky.\n5. The higher the FICO score, the lower the interest rates. Also, the higher credit score have better risk credibility. However, there are a few cases where lower interest rates were offered even though the FICO score was very poor. One possibility is if there hase been a compromise to adhere to the policy of loan disbursement and favours been granted.\n6. Long duration loans(11 to 20 yrs) are less riskier than the short termed loans(0 to 3 years). However, very long terms loans(>20 years) are also little riskier compared to medium(4 to 10 years) and long term loans.\n7. The number of inquiries are more, than the loan will be classifed as Risky. FOr healthy loans, very few inquiries(<1 per loan) are made. Whereas, for risky loans, the average inquires are around 4 per loan.\n8. The dataset was also tested for multicolinearity and found no features highly corelated with other features","22cea5fa":"### Checking the correlation between Credit Policy and the Days with Credit LIne","fc9c8521":"Just 18.5% of the debt consolidation loan applications are considered risky and still  81.5% cases are healthy loans.\n","d8c40854":"We will convert the days of credit line to years to see if the short term loans are Safer than the Longer term loans","22a773d3":"Higher the DTI ratio, higher the chances of risk. The average DTI for a healthy loan is ~12.5. However, DTI with values as low as 10.5 can also be risky. Though it does not imply that the credit policy is corelated to the DTI.\n\nIt will be interesting to check the variables that are correlated to DTI. ","e22ab3a9":"#### Step2 : Taking a look at the data. "}}