{"cell_type":{"8a403b30":"code","172be6a0":"code","378da8eb":"code","cc77b4cc":"code","641c4607":"code","a3291d8b":"code","132b9321":"code","79e5124d":"code","ca1c3f24":"code","1c3168fa":"code","c025b54d":"code","b4c9d9d1":"code","96a6cff5":"code","09b81f7b":"code","faccb58d":"code","9bbf4ded":"code","fe807e80":"code","9ee9ef93":"code","963d8474":"code","1d297327":"code","68358532":"code","1e06c626":"code","dd322cdb":"code","5e4e1658":"code","6ae7e439":"code","50079edc":"code","05fa718c":"code","f7a25995":"code","b449c425":"code","0b796c4e":"code","18ff8d10":"code","cffb6423":"code","94eb86cf":"code","4006da67":"code","12802286":"code","0d756b49":"code","7ba015a3":"code","3b8c7ec1":"code","cceb0c0e":"code","b828632f":"code","c3a540c8":"code","87b1e515":"code","18891b40":"code","b4dccf53":"code","0d6adbd3":"code","fe338bde":"code","ce1dfc90":"code","6754e2f6":"markdown","009ff21e":"markdown","7f7a8a38":"markdown","278f0c00":"markdown","c80fd265":"markdown","173ccd4a":"markdown","9417fc58":"markdown","9d9403c9":"markdown","6da9fb46":"markdown","c59d06ac":"markdown","935f9676":"markdown","3d7b9ee4":"markdown","a5e3c1a6":"markdown","5ab70e2b":"markdown","7fe4d933":"markdown","5abcbe30":"markdown","abf53b59":"markdown","277ac122":"markdown","a4a9f443":"markdown","cdabdeb6":"markdown","5045780c":"markdown","2d6addfa":"markdown","6491b8e5":"markdown","e5d97062":"markdown","2cd12f05":"markdown","82f9c9a4":"markdown","e98aa527":"markdown","2009e7bc":"markdown","987b6a8d":"markdown","ee05618c":"markdown","d19d4ba7":"markdown","f597e672":"markdown","8440023b":"markdown","363302a5":"markdown","56de65de":"markdown","dc238af7":"markdown","fc1c96cf":"markdown","51fe0aa1":"markdown","dbb608dd":"markdown","98999e87":"markdown","76ca2961":"markdown","b7febad6":"markdown","54503f60":"markdown","a952eae6":"markdown","4e980f48":"markdown"},"source":{"8a403b30":"import re\n\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\nfrom PIL import Image, ImageDraw\nimport seaborn as sns\nfrom IPython.display import YouTubeVideo","172be6a0":"YouTubeVideo('FtJr7i7ENMY')","378da8eb":"YouTubeVideo('Abf3Gd6AaZQ')","cc77b4cc":"YouTubeVideo('mTBrCMn86cU')","641c4607":"YouTubeVideo('YkN30T6ig30')","a3291d8b":"!ls ..\/input\/ranzcr-clip-catheter-line-classification\/","132b9321":"train = pd.read_csv(\"..\/input\/ranzcr-clip-catheter-line-classification\/train.csv\")\ntrain.head()","79e5124d":"train.info()","ca1c3f24":"train_anno = pd.read_csv(\"..\/input\/ranzcr-clip-catheter-line-classification\/train_annotations.csv\")\ntrain_anno.head()","1c3168fa":"train_anno.info()","c025b54d":"set(train_anno.label)","b4c9d9d1":"sub = pd.read_csv(\"..\/input\/ranzcr-clip-catheter-line-classification\/sample_submission.csv\")\nsub.head()","96a6cff5":"! ls ..\/input\/ranzcr-clip-catheter-line-classification\/train_tfrecords\/","09b81f7b":"! ls ..\/input\/ranzcr-clip-catheter-line-classification\/test_tfrecords\/","faccb58d":"train_idx = 5010\nuid = train[[\"StudyInstanceUID\"]].iat[train_idx,0]\ntrain_img = Image.open(f\"..\/input\/ranzcr-clip-catheter-line-classification\/train\/{uid}.jpg\")","9bbf4ded":"plt.figure(figsize=(15, 15))\nplt.imshow(train_img)\nplt.title(f\"train_{uid}\")","fe807e80":"uid = train_anno[\"StudyInstanceUID\"].iloc[5010]\nuid","9ee9ef93":"anno_data = train_anno[train_anno[\"StudyInstanceUID\"] == uid]\nanno_data = anno_data.reset_index(drop=True)\nanno_data","963d8474":"def draw_annotaion(structures, im):\n    \"\"\"\n    anatomical_structure: list of points of annotation.\n    im: Pillow  image instance.\n    \"\"\"\n    points = []\n    draw = ImageDraw.Draw(im)\n    for i in range(0, len(structures), 2):\n        points.append(tuple(structures[i:i+2]))\n        \n        draw.line(points, width=50, fill='red')\n    return im","1d297327":"regex = re.compile('\\d+')\nimages = []\nlabels = anno_data[\"label\"].values\nfor i in range(len(anno_data)):\n    match = regex.findall(anno_data[\"data\"].at[i])\n    match = [int(item) for item in match]\n    images.append(draw_annotaion(match, train_img.copy()))","68358532":"fig, axs = plt.subplots(2, 2,  figsize=(15,15))\ncnt = 0\nfor i in range(2):\n    for j in range(2):\n        axs[i][j].imshow(images[cnt])\n        axs[i][j].set_title(f\"{labels[cnt]}\")\n        cnt += 1","1e06c626":"uid = train_anno[\"StudyInstanceUID\"].iloc[170]\nanno_data = train_anno[train_anno[\"StudyInstanceUID\"] == uid]\nanno_data = anno_data.reset_index(drop=True)\nanno_data","dd322cdb":"img = Image.open(f\"..\/input\/ranzcr-clip-catheter-line-classification\/train\/{uid}.jpg\")\n\nmatch = regex.findall(anno_data[\"data\"].at[0])\nmatch = [int(item) for item in match]\n    \nimg_annotated = draw_annotaion(match, img.copy())\nplt.figure(figsize=(8, 8))\nplt.imshow(img_annotated)\nplt.title(\"Swan Ganz Catheter Present\")","5e4e1658":"uid = train_anno[\"StudyInstanceUID\"].iloc[25]\nanno_data = train_anno[train_anno[\"StudyInstanceUID\"] == uid]\nanno_data = anno_data.reset_index(drop=True)\nanno_data","6ae7e439":"img = Image.open(f\"..\/input\/ranzcr-clip-catheter-line-classification\/train\/{uid}.jpg\")\n\nmatch = regex.findall(anno_data[\"data\"].at[0])\nmatch = [int(item) for item in match]\n    \nimg_annotated = draw_annotaion(match, img.copy())\nplt.figure(figsize=(8, 8))\nplt.imshow(img_annotated)\nplt.title(\"CVC - Abnormal\")","50079edc":"uid = train_anno[\"StudyInstanceUID\"].iloc[1562]\nanno_data = train_anno[train_anno[\"StudyInstanceUID\"] == uid]\nanno_data = anno_data.reset_index(drop=True)\nanno_data","05fa718c":"img = Image.open(f\"..\/input\/ranzcr-clip-catheter-line-classification\/train\/{uid}.jpg\")\n\nmatch = regex.findall(anno_data[\"data\"].at[0])\nmatch = [int(item) for item in match]\n    \nimg_annotated = draw_annotaion(match, img.copy())\nplt.figure(figsize=(8, 8))\nplt.imshow(img_annotated)\nplt.title(\"ETT - Abnormal\")","f7a25995":"uid = train_anno[\"StudyInstanceUID\"].iloc[1287]\nanno_data = train_anno[train_anno[\"StudyInstanceUID\"] == uid]\nanno_data = anno_data.reset_index(drop=True)\nanno_data","b449c425":"img = Image.open(f\"..\/input\/ranzcr-clip-catheter-line-classification\/train\/{uid}.jpg\")\n\nmatch = regex.findall(anno_data[\"data\"].at[0])\nmatch = [int(item) for item in match]\n    \nimg_annotated = draw_annotaion(match, img.copy())\nplt.figure(figsize=(8, 8))\nplt.imshow(img_annotated)\nplt.title(\"NGT - Abnormal\")","0b796c4e":"uid = train_anno[\"StudyInstanceUID\"].iloc[129]\nanno_data = train_anno[train_anno[\"StudyInstanceUID\"] == uid]\nanno_data = anno_data.reset_index(drop=True)\nanno_data","18ff8d10":"img = Image.open(f\"..\/input\/ranzcr-clip-catheter-line-classification\/train\/{uid}.jpg\")\n\nmatch = regex.findall(anno_data[\"data\"].at[0])\nmatch = [int(item) for item in match]\n    \nimg_annotated = draw_annotaion(match, img.copy())\nplt.figure(figsize=(8, 8))\nplt.imshow(img_annotated)\nplt.title(\"ETE - Borderline\")","cffb6423":"uid = train_anno[\"StudyInstanceUID\"].iloc[515]\nanno_data = train_anno[train_anno[\"StudyInstanceUID\"] == uid]\nanno_data = anno_data.reset_index(drop=True)\nanno_data","94eb86cf":"img = Image.open(f\"..\/input\/ranzcr-clip-catheter-line-classification\/train\/{uid}.jpg\")\n\nmatch = regex.findall(anno_data[\"data\"].at[2])\nmatch = [int(item) for item in match]\n    \nimg_annotated = draw_annotaion(match, img.copy())\nplt.figure(figsize=(8, 8))\nplt.imshow(img_annotated)\nplt.title(\"NGT - Borderline\")","4006da67":"uid = train_anno[\"StudyInstanceUID\"].iloc[17940]\nanno_data = train_anno[train_anno[\"StudyInstanceUID\"] == uid]\nanno_data = anno_data.reset_index(drop=True)\nanno_data","12802286":"img = Image.open(f\"..\/input\/ranzcr-clip-catheter-line-classification\/train\/{uid}.jpg\")\n\nmatch = regex.findall(anno_data[\"data\"].at[1])\nmatch = [int(item) for item in match]\n    \nimg_annotated = draw_annotaion(match, img.copy())\nplt.figure(figsize=(8, 8))\nplt.imshow(img_annotated)\nplt.title(\"CVC - Borderline\")","0d756b49":"uid = train_anno[\"StudyInstanceUID\"].iloc[17867]\nanno_data = train_anno[train_anno[\"StudyInstanceUID\"] == uid]\nanno_data = anno_data.reset_index(drop=True)\nanno_data","7ba015a3":"img = Image.open(f\"..\/input\/ranzcr-clip-catheter-line-classification\/train\/{uid}.jpg\")\n\nmatch = regex.findall(anno_data[\"data\"].at[1])\nmatch = [int(item) for item in match]\n    \nimg_annotated = draw_annotaion(match, img.copy())\nplt.figure(figsize=(8, 8))\nplt.imshow(img_annotated)\nplt.title(\"NGT - Incompletely Imaged\")","3b8c7ec1":"uid = train_anno[\"StudyInstanceUID\"].iloc[457]\nanno_data = train_anno[train_anno[\"StudyInstanceUID\"] == uid]\nanno_data = anno_data.reset_index(drop=True)\nanno_data","cceb0c0e":"img = Image.open(f\"..\/input\/ranzcr-clip-catheter-line-classification\/train\/{uid}.jpg\")\n\nmatch = regex.findall(anno_data[\"data\"].at[2])\nmatch = [int(item) for item in match]\n    \nimg_annotated = draw_annotaion(match, img.copy())\nplt.figure(figsize=(8, 8))\nplt.imshow(img_annotated)\nplt.title(\"NGT - Incompletely Imaged\")","b828632f":"train.head()","c3a540c8":"ett_cols = [col for col in train.columns if \"ETT\" in col]\nngt_cols = [col for col in train.columns if \"NGT\" in col]\ncvc_cols = [col for col in train.columns if \"CVC\" in col]","87b1e515":"def df_transform(df):\n    df_res = pd.DataFrame()\n    for col in df.columns:\n        df_tmp = pd.DataFrame(df[col])\n        df_tmp.columns = [\"data\"]\n        df_tmp[\"type\"] = col\n        df_res = pd.concat([df_res, df_tmp])\n        \n    return df_res","18891b40":"fig, axes = plt.subplots(1, 2, figsize=(15,6), gridspec_kw=dict(wspace=0.3, hspace=0.6))\ng1 = sns.countplot(data = df_transform(train[ett_cols]),x=\"data\", ax=axes[0])\ng1.set_title(\"Number of each status of ETT\")\n\ng2 = sns.countplot(data = df_transform(train[ett_cols]),x=\"data\", hue=\"type\", ax=axes[1])\ng2.set_title(\"Number of each status of ETT - detail\")","b4dccf53":"fig, axes = plt.subplots(1, 2, figsize=(15,6), gridspec_kw=dict(wspace=0.3, hspace=0.6))\ng1 = sns.countplot(data = df_transform(train[ngt_cols]),x=\"data\", ax=axes[0])\ng1.set_title(\"Number of each status of NGT\")\n\ng2 = sns.countplot(data = df_transform(train[ngt_cols]),x=\"data\", hue=\"type\", ax=axes[1])\ng2.set_title(\"Number of each status of NGT - detail\")","0d6adbd3":"fig, axes = plt.subplots(1, 2, figsize=(15,6), gridspec_kw=dict(wspace=0.3, hspace=0.6))\ng1 = sns.countplot(data = df_transform(train[cvc_cols]),x=\"data\", ax=axes[0])\ng1.set_title(\"Number of each status of NCVCGT\")\n\ng2 = sns.countplot(data = df_transform(train[cvc_cols]),x=\"data\", hue=\"type\", ax=axes[1])\ng2.set_title(\"Number of each status of CVC - detail\")","fe338bde":"g = sns.countplot(data = train, x=\"Swan Ganz Catheter Present\")\ng.set_title(\"Number of exists of Swan Ganz Catheter Present\")","ce1dfc90":"data_cols = [col for col in train.columns if col not in ['StudyInstanceUID', 'PatientID']]\ng = sns.countplot(np.sum(train[data_cols].values, axis=1))\ng.set_title(\"Number of conditions occurring simultaneously for a PatientID\")","6754e2f6":"## train_tfrecords, test_tfrecords\n\nSerialized train and test data.","009ff21e":"<a id=\"4\"><\/a> <br>\n# <div class=\"alert alert-block alert-success\">Visualize x-rays image<\/div>\n\nWe can visualize data by matplotlib.","7f7a8a38":"## Central venous catheter\n\nA central venous catheter (CVC), also known as a central line is a catheter placed into a large vein. It is a form of venous access. Placement of larger catheters in more centrally located veins is often needed in critically ill patients, or in those requiring prolonged intravenous therapies, for more reliable vascular access. \n\nFor more information, see [Wikipedia - Central venous catheter](https:\/\/en.wikipedia.org\/wiki\/Central_venous_catheter).","278f0c00":"## Abnormal sample\n\nWe will also look at the abnormal data.","c80fd265":"We will extract the annotation data from each dataframe using regular expressions since the list is stored as a string in the dataframe.\n\nThe extracted annotations will be overwritten on the images.","173ccd4a":"## Endotracheal Tube\n\nAn endotracheal tube is a flexible plastic tube that is placed through the mouth into the trachea (windpipe) to help a patient breathe. The endotracheal tube is then connected to a ventilator, which delivers oxygen to the lungs. The process of inserting the tube is called endotracheal intubation.\n\nFor more information, see [How an Endotracheal Tube Is Used](https:\/\/www.verywellhealth.com\/endotracheal-tube-information-2249093).","9417fc58":"## sample_submission.csv\n\nsample_submission.csv is sumple submission file.","9d9403c9":"<a id=\"1\"><\/a> <br>\n# <div class=\"alert alert-block alert-info\">Introduction<\/div>","6da9fb46":"### ETT","c59d06ac":"## Normal sample\n\nFirst, we'll check \"XXX - Normal\" images.\n\nThe data which StudyInstanceUID is '1.2.826.0.1.3680043.8.498.11012190756062412030973253000324820445' is good for example, so I'll extract it.","935f9676":"There are all label column values.","3d7b9ee4":"There seem to be few procedures that use the Swan Ganz Catheter.","a5e3c1a6":"Let's see given data. there are roughly 7 kinds data.","5ab70e2b":"## Borderline sample\n\nWe will also look at the borderline data.","7fe4d933":"## Breakdown of each treatment performed","5abcbe30":"## Goal\n\nTo create model to detect the presence and position of catheters and lines on chest x-rays,  and categorize a tube that is poorly placed.\n\nDeep learning algorithms may be able to automatically detect malpositioned catheters and lines. Once alerted, clinicians can reposition or remove them to avoid life-threatening complications.","abf53b59":"## Nasogastric Tube\n\nNasogastric tube is a plastic tube through the nose, past the throat, and down into the stomach used in nasogastric intubation medical process. \n\nFor more information, see [Wikipedia - Nasogastric intubation](https:\/\/en.wikipedia.org\/wiki\/Nasogastric_intubation).","277ac122":"CVC seems to have been done with about 30% of the training data, too. Borderline and Abnormal are less common than normal, but we can see that a not insignificant number of cases are occurring.","a4a9f443":"### CVC","cdabdeb6":"## train, test\n\nThere are chest x-rays images. I'll explain how to visualize them [here](#4).","5045780c":"### ETE","2d6addfa":"<a id=\"6\"><\/a> <br>\n# <div class=\"alert alert-block alert-success\">Visualize train label<\/div>\n\nIn train.csv, there are binary labels. From this data, we can determine what treatment has been performed on each StudyInstanceUID image and what state it is in, so we will visualize it.","6491b8e5":"Each record seems to have several tubes and catheters. If the value is 1, there are tubes and catheters. So if we sum the values, we can know the number of them.","e5d97062":"<a id=\"5\"><\/a> <br>\n# <div class=\"alert alert-block alert-success\">Visualize x-ray images with annotation<\/div>\n\nWe'll extract the annotation data from train_annotations.csv and overwrite the images.","2cd12f05":"## Swan Ganz Catheter Present\n\nWe'll also check Swan-Ganz Catheter.","82f9c9a4":"We can find that in this image,  \"NGT - Normal\", \"ETT - Normal\" and \"CVC - Normal\" labeled tubes and catheters are.\n\nWe'll create a utility function to add easy-to-read annotations.","e98aa527":"Most of the images are of a single procedure, but there are also less than 10000 images of two or more procedures being performed. There are also less than 3000 images of four or more.","2009e7bc":"## Swan Ganz Catheter Present\n\nSwan-Ganz catheter is used in Pulmonary artery catheterization (PAC), or right heart catheterization.  In the operation, the insertion of a catheter into a pulmonary artery. Its purpose is diagnostic; it is used to detect heart failure or sepsis, monitor therapy, and evaluate the effects of drugs. \n\nFor more information, see [Wikipedia - Pulmonary artery catheter](https:\/\/en.wikipedia.org\/wiki\/Pulmonary_artery_catheter).","987b6a8d":"<a id=\"2\"><\/a> <br>\n# <div class=\"alert alert-block alert-info\">Background knowledge<\/div>\n\nI'll introduce technical words and its' references to need to understand dataset here.","ee05618c":"Let's visualize them.","d19d4ba7":"We can see that this is an X-ray image of the chest. We can also see that the right and left sides are marked. We can also see that there are several tubes in the image, too.\n\nBut we can't recognize where the tubing and catheters to detect are, so we will overwrite the annotation data in the next section to confirm.","f597e672":"### NGT","8440023b":"### CVC","363302a5":"NGT seems to have been done with about 10% of the training data, too. Borderline and Abnormal are rarely.","56de65de":"## train.csv\n\ntrain.csv contains image IDs, binary labels, and patient IDs.","dc238af7":"### NGT","fc1c96cf":"## Incompletely Imaged sample\n\nIncompletely Imaged is probably an image that the NGtube has protruded from the x-ray image.","51fe0aa1":"--------------","dbb608dd":"--------------","98999e87":"# <u>RANZCR CLiP: Visualize and Understand Dataset<\/u>\n\n## Contents\n\n1. [Introduction](#1)\n1. [Background knowledge](#2)\n1. [Data overview](#3)\n1. [Visualize x-rays image](#4)\n1. [Visualize x-ray images with annotation](#5)\n1. [Visualize train label](#6)","76ca2961":"ETT seems to have been done with about 10% of the training data. Of the data conducted, most seems to be normal, with a little borderline. Abnormal is rarely.","b7febad6":"To prepare, define variables and utility functions.","54503f60":"<a id=\"3\"><\/a> <br>\n# <div class=\"alert alert-block alert-success\">Data overview<\/div>","a952eae6":"### Is the treatment being performed at the same time?","4e980f48":"## train_annotations.csv\n\nSegmentation annotations for training samples that have them."}}