{"cell_type":{"ff4de714":"code","4226abd7":"code","f0ee3082":"code","70e0943e":"code","f79e1b65":"code","7614e4ee":"code","7521d5b2":"code","12705ae7":"code","f78c1ea8":"code","bb05ec63":"code","c5459241":"code","07379f43":"code","40aad15c":"code","2ae87a11":"code","b19004d4":"code","77216b33":"code","519c1824":"code","5e033679":"code","fe8d3764":"code","b2e89386":"code","f28b95af":"code","680c4c97":"code","0f1c6889":"code","a309aaed":"code","002379bb":"code","618a597d":"code","6b96751f":"code","a4942bc8":"markdown","f1d8777c":"markdown","9aa61571":"markdown","31b6991c":"markdown","766801a6":"markdown","a709c1dd":"markdown","4b415a58":"markdown","7cb189ae":"markdown","fa47f621":"markdown","4679288f":"markdown","82d227d7":"markdown","ac803452":"markdown","4b01fbe6":"markdown","a229fb32":"markdown","47c7f575":"markdown","abcf57d9":"markdown"},"source":{"ff4de714":"!pip install mljar-supervised","4226abd7":"# Data manipulation\nimport numpy as np\nimport pandas as pd\n\n# Ploting\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n# H2O AutoML\nimport h2o\nfrom h2o.automl import H2OAutoML\n\n# LGBM\nfrom sklearn.model_selection import StratifiedKFold\nimport lightgbm as lgb\n\n# MLJAR\nfrom supervised.automl import AutoML","f0ee3082":"# Set style\nsns.set_style('white')\ntrain_color = 'blueviolet'\ntest_color = 'lightsalmon'","70e0943e":"# Other colors\n# #a6a65d\n# #4f6446\n# f7e572","f79e1b65":"# Read file with pandas\ntrain = pd.read_csv('..\/input\/tabular-playground-series-apr-2021\/train.csv',\n                    index_col='PassengerId')\n\ntest = pd.read_csv('..\/input\/tabular-playground-series-apr-2021\/test.csv',\n                   index_col='PassengerId')","7614e4ee":"# Update data types from competition informations\n\n# Numeric and categorical columns\nnum_cols = ['Age', 'SibSp', 'Parch', 'Fare']\ncat_cols = ['Pclass', 'Sex']\nstr_cols = ['Name', 'Ticket']\ntarget = 'Survived'\n\n# Update numeric cols as float\ntrain[num_cols] = train[num_cols].astype(np.float32)\ntest[num_cols] = test[num_cols].astype(np.float32)\n\n# Update categorical cols as categories\ntrain[cat_cols] = train[cat_cols].astype('category')\ntest[cat_cols] = test[cat_cols].astype('category')\n\n# Update target col\ntrain[target] = train[target].astype(bool)","7521d5b2":"# Check for missing values in both datasets\nprint(f\"Train Dataset | Missing values: {train.isna().sum().sum()}\")\nprint(f\"Test Dataset | Missing values: {test.isna().sum().sum()}\")","12705ae7":"# Plot histogram for train and test sets\n\n# Params\nn_col = 2\nn_row = round(len(num_cols) \/ 2)\nsize = (n_col * 10, n_row * 4.5)\n\n# Create figure\nplt.subplots(n_row, n_col,figsize=size)\n\n# Plot hists\nfor i, col in enumerate(num_cols, 1):\n    plt.subplot(n_row, n_col, i)\n    sns.distplot(train[col], color=train_color, label='train', kde=True, bins=100)\n    sns.distplot(test[col], color=test_color, label='test', kde=True, bins=100)\n    plt.xlabel(col, fontsize=14)\n    plt.legend()\n    \n# Show image\nplt.show()","f78c1ea8":"# Plot histogram for train and test sets\n\n# Params\nn_col = 2\nn_row = round(len(cat_cols) \/ 2)\nsize = (n_col * 10, n_row * 4.5)\n\n# Create figure\nplt.subplots(n_row, n_col,figsize=size)\n\n# Plot hists\nfor i, col in enumerate(cat_cols, 1):\n    plt.subplot(n_row, n_col, i)\n    sns.countplot(train[col], color=train_color, label='train')\n    sns.countplot(test[col], color=test_color, label='test')\n    plt.xlabel(col, fontsize=14)\n    plt.legend()\n    \n# Show image\nplt.show()","bb05ec63":"# Features\npredictors = num_cols + cat_cols\ntarget = target\n\n# Data\nX_TRAIN = train[predictors]\nY_TRAIN = train[target]\nX_TEST = test[predictors]","c5459241":"# Run H2O\nh2o.init(max_mem_size='16g')","07379f43":"# Load data\ntrain_h2o = h2o.import_file('..\/input\/tabular-playground-series-apr-2021\/train.csv')\ntest_h2o = h2o.import_file('..\/input\/tabular-playground-series-apr-2021\/test.csv')\n\n# For binary classification, response should be a factor\ntrain_h2o[target] = train_h2o[target].asfactor()","40aad15c":"# h2o train\naml = H2OAutoML(\n    nfolds=10,\n    sort_metric='auc',\n    stopping_metric='auc',\n    max_runtime_secs=3600,\n    seed=0\n)\n\naml.train(x=predictors, y=target, training_frame=train_h2o)","2ae87a11":"# View the AutoML Leaderboard\nlb = aml.leaderboard\nlb.head(rows=lb.nrows)","b19004d4":"# Predictions\noutput = aml.leader.predict(test_h2o)\nh2o_predictions = h2o.as_list(output['p1'])\nh2o_predictions = np.where(h2o_predictions.values>= 0.5, 1, 0).flatten()","77216b33":"# Save submission\ntest[target] = h2o_predictions\ntest[target].to_csv('h2o_submission.csv')","519c1824":"# Init AutoMl\nautoml = AutoML(results_path='mljar_result',\n                total_time_limit=3600*7,\n                mode='Compete', \n                ml_task='binary_classification',\n                eval_metric='accuracy')","5e033679":"# Train\nautoml.fit(X_TRAIN, Y_TRAIN)","fe8d3764":"# Predict\n\n# MLJAR predict doesn't work with 'category' dtypes\n_X_TEST = X_TEST.copy()\n_X_TEST[['Pclass', 'Sex']] = _X_TEST[['Pclass', 'Sex']].astype(object)\n\nmljar_predictions = automl.predict(_X_TEST)\nmljar_predictions = np.where(mljar_predictions>= 0.5, 1, 0)","b2e89386":"# Save submission\ntest[target] = mljar_predictions\ntest[target].to_csv('mljar_submission.csv')","f28b95af":"# Constant\nK = 10\nKF = StratifiedKFold(K)\nEARLY_STOP = 10\nPARAMS = {\n    'objective': 'binary',\n    'num_iterations': 1000,\n    'learning_rate': 0.05, \n    'metric': 'binary_error'\n}","680c4c97":"# Create LGB Dataset\nlgb_train = lgb.Dataset(X_TRAIN, Y_TRAIN)","0f1c6889":"# Train\nbooster = lgb.cv(PARAMS,\n                 lgb_train,\n                 folds=KF.split(X_TRAIN, Y_TRAIN), \n                 early_stopping_rounds=EARLY_STOP,\n                 verbose_eval=10,\n                 return_cvbooster=True)","a309aaed":"# Predict\nkfold_predictions = booster['cvbooster'].predict(X_TEST)\nlgb_predictions = np.array(kfold_predictions).mean(axis=0)\nlgb_predictions = np.where(lgb_predictions>= 0.5, 1, 0)","002379bb":"# Submission\ntest[target] = lgb_predictions\ntest[target].to_csv('lgb_submission.csv')","618a597d":"# Concat predicted label\npredictions = pd.DataFrame({\n    'h2o': h2o_predictions,\n    'mljar': mljar_predictions,\n    'lgb': lgb_predictions\n})\n\n# Vote\nvote_predictions = predictions.mode(axis=1).values","6b96751f":"# Submission\ntest[target] = vote_predictions\ntest[target].to_csv('vote_submission.csv')","a4942bc8":"<h2 style=\"background-color:#f7e572;font-family:Rockwell;font-size:240%;text-align:center;border-radius: 20px 50px;\">Setup<\/h2>","f1d8777c":"<h3 style=\"background-color:#f7e572;font-family:Rockwell;font-size:200%;text-align:center;border-radius: 20px 50px;\">Univariate Analysis: Continous Features<\/h3>","9aa61571":"<h3 style=\"background-color:#f7e572;font-family:Rockwell;font-size:200%;text-align:center;border-radius: 20px 50px;\">H2O AutoML<\/h3>\n\n#### Auto ML with h2o.","31b6991c":"<h3 style=\"background-color:#f7e572;font-family:Rockwell;font-size:200%;text-align:center;border-radius: 20px 50px;\">Libraries and Utilities<\/h3>","766801a6":"<h3 style=\"background-color:#f7e572;font-family:Rockwell;font-size:200%;text-align:center;border-radius: 20px 50px;\">Data Types<\/h3>","a709c1dd":"<h3 style=\"background-color:#f7e572;font-family:Rockwell;font-size:200%;text-align:center;border-radius: 20px 50px;\">Data Loading<\/h3>","4b415a58":"<h3 style=\"background-color:#f7e572;font-family:Rockwell;font-size:200%;text-align:center;border-radius: 20px 50px;\">Ensemble<\/h3>\n\n#### Vote between all models.","7cb189ae":"<h2 style=\"background-color:#f7e572;font-family:Rockwell;font-size:240%;text-align:center;border-radius: 20px 50px;\">Starter Models<\/h2>","fa47f621":"<h2 style=\"background-color:#f7e572;font-family:Rockwell;font-size:240%;text-align:center;border-radius: 20px 50px;\">Tabular Playground Series: April Edition<\/h2>\n\n### Notes\n- There is missing data.\n- There is various data types:\n    - String.\n    - Ordinal.\n    - Ratio.\n- Distributions between train and test sets seems to be different.","4679288f":"<h2 style=\"background-color:#f7e572;font-family:Rockwell;font-size:240%;text-align:center;border-radius: 20px 50px;\">Exploratory Data Analysis<\/h2>","82d227d7":"<h3 style=\"background-color:#f7e572;font-family:Rockwell;font-size:200%;text-align:center;border-radius: 20px 50px;\">Missing Values<\/h3>","ac803452":"<h2 style=\"background-color:#f7e572;font-family:Rockwell;font-size:240%;text-align:center;border-radius: 20px 50px;\">Feature Engineering<\/h2>","4b01fbe6":"<h3 style=\"background-color:#f7e572;font-family:Rockwell;font-size:200%;text-align:center;border-radius: 20px 50px;\">LightGBM<\/h3>","a229fb32":"### Data Types\n<center><img src=\"https:\/\/lh5.googleusercontent.com\/7jyxzQ2ObysJGLFcGB6Zc25AHAswexk68SbOh_KYa4if2P9yRe7lIC8NDUgZEcSGspqpRIGQcMx_qCmrG6sjHegFHy9Sqhp_1z3PFido6d19TKYFq0pMTHDs4OV9l6pP-MTNmeKu\"><\/center>","47c7f575":"<h3 style=\"background-color:#f7e572;font-family:Rockwell;font-size:200%;text-align:center;border-radius: 20px 50px;\">Univariate Analysis: Categorical Features<\/h3>","abcf57d9":"<h3 style=\"background-color:#f7e572;font-family:Rockwell;font-size:200%;text-align:center;border-radius: 20px 50px;\">MLJAR<\/h3>\n\n#### Auto ML with MLJAR.\n#### Based on [Piotr work](https:\/\/www.kaggle.com\/mt77pp\/mljar-automl-tps-apr-21)."}}