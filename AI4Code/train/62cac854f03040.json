{"cell_type":{"95cd29d2":"code","df3a7d5b":"code","0904f684":"code","252e54c0":"code","b41999b3":"code","b76a0a6b":"code","72f211a1":"code","048d9cab":"code","8b27d1df":"code","239132de":"code","1ad2127e":"code","be52d9b8":"code","2bca9bb6":"code","0c9d7d63":"code","670f4ea0":"code","578471b7":"code","9b8209b8":"code","2471cdad":"code","ba99e80d":"code","bfe7998d":"code","1434b854":"code","b0ab3c12":"code","267cf01c":"code","5eca1ad6":"code","f8a8ae3e":"code","b1535822":"code","430185b3":"code","4346db1d":"code","9b8d06c5":"code","c9698879":"code","93b9470d":"code","f1fa5bf2":"code","f43bee13":"code","7522085f":"code","92ce3226":"code","8c8b850a":"code","72d7f0c6":"code","37aae4d6":"code","44ec1ead":"code","f8ae0e90":"code","63cee704":"code","f1b0aa6b":"code","4fd67df9":"markdown","45ce3f04":"markdown","2cf42f61":"markdown","18017923":"markdown","39b98b2c":"markdown","c4bedf80":"markdown","e2836abe":"markdown","113a4d91":"markdown","c8bf0e58":"markdown","d5443e0f":"markdown","f7d5f85d":"markdown","7b9257e4":"markdown","07a20340":"markdown"},"source":{"95cd29d2":"#k\u00fct\u00fcphanelerin kurulumu\nimport pandas as pd\nimport numpy as np\nimport seaborn as sns\nfrom sklearn.cluster import KMeans\nimport matplotlib.pyplot as plt\n\n#t\u00fcm s\u00fctunlar\u0131 ve sat\u0131rlar\u0131n g\u00f6r\u00fcnt\u00fclenmesi\npd.set_option('display.max_columns', None); pd.set_option('display.max_rows', None);\n\n#virgulden sonra g\u00f6sterilecek olan say\u0131 say\u0131s\u0131\npd.set_option('display.float_format', lambda x: '%.0f' % x)","df3a7d5b":"#veri setini okuma\ndf = pd.read_csv(\"..\/input\/online-retail-ii-uci\/online_retail_II.csv\")","0904f684":"#ilk 5 g\u00f6zlemin se\u00e7imi\ndf.head() ","252e54c0":"#en cok siparis edilen urunlerin s\u0131ralamas\u0131\ndf.groupby(\"Description\").agg({\"Quantity\":\"sum\"}).sort_values(\"Quantity\", ascending = False).head()","b41999b3":"#toplam ka\u00e7 fatura say\u0131s\u0131\ndf[\"Invoice\"].nunique()","b76a0a6b":"#en pahal\u0131 \u00fcr\u00fcnler \ndf.sort_values(\"Price\", ascending = False).head()","72f211a1":"#en fazla sipari\u015f say\u0131s\u0131na sahip ilk 5 \u00fclke\ndf[\"Country\"].value_counts().head()","048d9cab":"#toplam harcamay\u0131 s\u00fctun olarak ekledik\ndf['TotalPrice'] = df['Price']*df['Quantity']","8b27d1df":"#hangi \u00fclkeden ne kadar gelir elde edildi\ndf.groupby(\"Country\").agg({\"TotalPrice\":\"sum\"}).sort_values(\"TotalPrice\", ascending = False).head()","239132de":"#en eski al\u0131\u015fveri\u015f tarihi\ndf[\"InvoiceDate\"].min() ","1ad2127e":"#en yeni al\u0131\u015fveri\u015f tarihi\ndf[\"InvoiceDate\"].max()","be52d9b8":"#de\u011ferlendirmenin daha kolay yap\u0131labilmesi i\u00e7in bug\u00fcn\u00fcn tarihi olarak 1 Ocak 2012 tarihi belirlendi.  \ntoday = pd.datetime(2012,1,1) \ntoday","2bca9bb6":"#sipari\u015f tarihinin veri tipinin de\u011fi\u015ftirilmesi\ndf['InvoiceDate'] = pd.to_datetime(df['InvoiceDate'])","0c9d7d63":"#0'dan b\u00fcy\u00fck de\u011ferleri al\u0131nmas\u0131, bu i\u015flem de\u011ferlendirmeyi daha kolayla\u015ft\u0131racak\ndf = df[df['Quantity'] > 0]\ndf = df[df['TotalPrice'] > 0]","670f4ea0":"#eksik verilere sahip g\u00f6zlem birimlerinin df \u00fczerinden kald\u0131r\u0131lmas\u0131\ndf.dropna(inplace = True) ","578471b7":"#veri setinde eksik veri yok\ndf.isnull().sum(axis=0)","9b8209b8":"#boyut bilgisi\ndf.shape ","2471cdad":"df.describe([0.01,0.05,0.10,0.25,0.50,0.75,0.90,0.95, 0.99]).T\n#belirtilen y\u00fczdelere kar\u015f\u0131l\u0131k gelen g\u00f6zlem birimlerinin a\u00e7\u0131klay\u0131c\u0131 istatistik de\u011ferleri\n#de\u011ferlendirmeyi kolayla\u015ft\u0131rmas\u0131 amac\u0131yla df tablosunun transpozu al\u0131nd\u0131.","ba99e80d":"#\u00fclkeye g\u00f6re m\u00fc\u015fteri da\u011f\u0131l\u0131m\u0131\ncountry_cust_data=df[['Country','Customer ID']].drop_duplicates()\ncountry_cust_data.groupby(['Country'])['Customer ID'].aggregate('count').reset_index().sort_values('Customer ID', ascending=False)","bfe7998d":"#yaln\u0131zca Birle\u015fik Krall\u0131k verilerini tutma\ndf_uk = df.query(\"Country=='United Kingdom'\").reset_index(drop=True)\ndf_uk.head()","1434b854":"df.head()","b0ab3c12":"df.info() \n#dataframe'in indeks tipleri, s\u00fctun t\u00fcrleri, bo\u015f olmayan de\u011ferler ve bellek kullan\u0131m bilgileri","267cf01c":"#Recency ve Monetary de\u011ferlerinin bulunmas\u0131\ndf_x = df.groupby('Customer ID').agg({'TotalPrice': lambda x: x.sum(), #monetary value\n                                        'InvoiceDate': lambda x: (today - x.max()).days}) #recency value\n#x.max()).days; m\u00fc\u015fterilerin son al\u0131\u015fveri\u015f tarihi","5eca1ad6":"df_y = df.groupby(['Customer ID','Invoice']).agg({'TotalPrice': lambda x: x.sum()})\ndf_z = df_y.groupby('Customer ID').agg({'TotalPrice': lambda x: len(x)}) \n#ki\u015fi ba\u015f\u0131na d\u00fc\u015fen frequency de\u011ferini bulunmas\u0131","f8a8ae3e":"#RFM tablosunun olu\u015fturulmas\u0131\nrfm_table= pd.merge(df_x,df_z, on='Customer ID')","b1535822":"#S\u00fctun isimlerini belirlenmesi\nrfm_table.rename(columns= {'InvoiceDate': 'Recency',\n                          'TotalPrice_y': 'Frequency',\n                          'TotalPrice_x': 'Monetary'}, inplace= True)","430185b3":"#RFM Tablosu\nrfm_table.head()","4346db1d":"#Recency i\u00e7in tan\u0131mlay\u0131c\u0131 istatistikler\nrfm_table.Recency.describe()","9b8d06c5":"#Recency da\u011f\u0131l\u0131m grafi\u011fi\nimport seaborn as sns\nx = rfm_table['Recency']\n\nax = sns.distplot(x)","c9698879":"#Frequency i\u00e7in tan\u0131mlay\u0131c\u0131 istatistikler\nrfm_table.Frequency.describe()","93b9470d":"#Frequency da\u011f\u0131l\u0131m grafi\u011fi, 1000'den az Frequency de\u011ferine sahip g\u00f6zlemlerin al\u0131nmas\u0131\nimport seaborn as sns\nx = rfm_table.query('Frequency < 1000')['Frequency']\n\nax = sns.distplot(x)","f1fa5bf2":"#Monetary i\u00e7in tan\u0131mlay\u0131c\u0131 istatistikler\nrfm_table.Monetary.describe()","f43bee13":"#Monatary da\u011f\u0131l\u0131m grafi\u011fi, 10000'den az Monetary de\u011ferine sahip g\u00f6zlemlerin al\u0131nmas\u0131\nimport seaborn as sns\nx = rfm_table.query('Monetary < 10000')['Monetary']\n\nax = sns.distplot(x)","7522085f":"#\u00e7eyreklikler kullan\u0131larak d\u00f6rt par\u00e7aya b\u00f6l\u00fcnme i\u015flemi\nquantiles = rfm_table.quantile(q=[0.25,0.5,0.75])\nquantiles = quantiles.to_dict()","92ce3226":"quantiles","8c8b850a":"#D\u00f6n\u00fc\u015ft\u00fcrme i\u015flemi\nfrom sklearn.preprocessing import MinMaxScaler\nmin_max_scaler = MinMaxScaler((0,1))\nx_scaled = min_max_scaler.fit_transform(rfm_table)\ndata_scaled = pd.DataFrame(x_scaled)\n#burada de\u011ferlerimizi normalle\u015ftirdik","72d7f0c6":"df[0:10]","37aae4d6":"plt.figure(figsize=(8,6))\nwcss = []\nfor i in range(1, 11):\n    kmeans = KMeans(n_clusters = i, init = 'k-means++',n_init=10, max_iter = 300)\n    kmeans.fit(data_scaled)\n    wcss.append(kmeans.inertia_)\nplt.plot(range(1, 11), wcss)\nplt.title('The Elbow Method')\nplt.xlabel('Number of clusters')\nplt.ylabel('WCSS')\nplt.show()","44ec1ead":"kmeans = KMeans(n_clusters = 4, init='k-means++', n_init =10,max_iter = 300)\nkmeans.fit(data_scaled)\ncluster = kmeans.predict(data_scaled)\n#init = 'k-means ++' bu daha h\u0131zl\u0131 \u00e7al\u0131\u015fmas\u0131n\u0131 sa\u011flar","f8ae0e90":"d_frame = pd.DataFrame(rfm_table)\nd_frame['cluster_no'] = cluster\nd_frame['cluster_no'].value_counts() # k\u00fcme ba\u015f\u0131na ki\u015fi say\u0131s\u0131 (Custer ID numaras\u0131)","63cee704":"rfm_table.head()","f1b0aa6b":"#k\u00fcmelerin ortalama de\u011ferleri\nd_frame.groupby('cluster_no').mean()","4fd67df9":"# K-Means Algoritmas\u0131 ile M\u00fc\u015fteri Segmentasyonu","45ce3f04":"## Recency, Frequency and Monetary De\u011ferlerinin G\u00f6rselle\u015ftirilmesi","2cf42f61":"# Kaynaklar\n\nhttps:\/\/www.veribilimiokulu.com\/rfm-analizi-ile-musteri-segmentasyonu\/\n\nhttps:\/\/www.youtube.com\/watch?v=DowbzgtH0-0\n\nhttps:\/\/www.youtube.com\/watch?v=fdUofaT8gUw\n\nhttps:\/\/github.com\/nitinkaushik01\/Deep_and_Machine_Learning_Projects\/tree\/master\/Customer_Segmentation_using_RFM_and_KMeans_Models","18017923":"# K-Means Segmentasyonu\n\nG\u00f6zetimsiz \u00f6\u011frenme algoritmalar\u0131ndan biridir. Yap\u0131lan i\u015flem, verileri kendine \u00f6zg\u00fc \u00f6zelliklerine g\u00f6re ay\u0131rmak ve karakteristik \u00f6zelliklerini ortaya \u00e7\u0131karmakt\u0131r. Ama\u00e7, noktalar aras\u0131ndaki toplam mesafeyi en aza indirmek ve k\u00fcmeler aras\u0131ndaki mesafeyi en \u00fcst d\u00fczeye \u00e7\u0131karmakt\u0131r. Bu s\u00fcre\u00e7 k\u00fcmelemedir.\n\nK\u00fcmeleme nerede kullan\u0131l\u0131r?\n\n     - \u00dcr\u00fcnlerin sat\u0131n alan m\u00fc\u015fteri gruplar\u0131na g\u00f6re k\u00fcmelenmesi\n     - Belgelerin k\u00fcmelenmesi, kullan\u0131lan benzer kelimelere g\u00f6re web aramalar\u0131\n     - M\u00fc\u015fteri segmentasyonu\n     - Biyoinformatik alan\u0131nda benzer genlerin gruplanmas\u0131\n\nK-means algoritmas\u0131 hiyerar\u015fik olmayan, merkez tabanl\u0131 bir algoritmad\u0131r.\n\nK-means algoritmas\u0131n\u0131n \u00e7al\u0131\u015fma prensibi;\n\nS\u00fcre\u00e7, k merkezlerinin rastgele se\u00e7ilmesiyle ba\u015flar. K\u00fcmedeki t\u00fcm noktalar\u0131n merkezine olan ortalama uzakl\u0131k, daha sonra a\u011f\u0131rl\u0131k merkezlerinin (merkezlerin) konumunu g\u00fcncellemek i\u00e7in kullan\u0131l\u0131r. Centroidlerin (merkezlerin) de\u011ferleri sabitlenerek bu ad\u0131mlar tekrarlan\u0131r. Bir k\u00fcme i\u00e7erisindeki uzakl\u0131k ortalamar\u0131n\u0131 minimize edip di\u011fer k\u00fcmelerle aralar\u0131ndaki uzakl\u0131klar\u0131 maksimize edene kadar bu i\u015flem devam eder. \n\nAmac\u0131m\u0131z, k\u00fcme i\u00e7indeki mesafelerin toplam\u0131n\u0131 en aza indirmek ve k\u00fcmeler aras\u0131ndaki mesafelerin toplam\u0131n\u0131 en \u00fcst d\u00fczeye \u00e7\u0131karmakt\u0131r. Di\u011fer bir deyi\u015fle, birbirlerinden daha ayr\u0131k k\u00fcmeler olu\u015fturmak.\n\nBurada iki metrik kullan\u0131labilir.\n\n   - Inertia: bir k\u00fcmedeki noktalar\u0131n ne kadar uzak oldu\u011funu g\u00f6sterir. Bu nedenle, k\u00fc\u00e7\u00fck bir Inertia hedeflenir. Inertia de\u011feri s\u0131f\u0131rdan ba\u015flar ve artar. (min SSE)\n    \n   - Silhoutte Puan\u0131: Bir k\u00fcmedeki veri noktalar\u0131n\u0131n ba\u015fka bir k\u00fcmedeki veri noktalar\u0131ndan ne kadar uzakta oldu\u011funu g\u00f6sterir. Puan aral\u0131\u011f\u0131 -1 ile 1 aras\u0131ndad\u0131r ve 1'e yakla\u015fmas\u0131 beklenmektedir.\n    \nBu \u00e7al\u0131\u015fmada Inertia kullan\u0131lm\u0131\u015ft\u0131r.\n\nBu \u00e7al\u0131\u015fmada, daha \u00f6nce belirledi\u011fimiz rfm metriklerini k-means ile segmentlere ay\u0131raca\u011f\u0131z. Veri setimize bu haliyle cluster i\u015flemini uygulayam\u0131yoruz. Bu i\u015flemi yapabilmemiz i\u00e7in say\u0131sal de\u011fi\u015fkenler laz\u0131m. Bu de\u011fi\u015fkenler \u015fu anda elimizde yok. Biz cluster i\u015flemini rfm metrik de\u011ferleri \u00fczerinden k-means ile uygulayaca\u011f\u0131z.","39b98b2c":"Burada \u00f6nemli olan do\u011fru k\u00fcme say\u0131s\u0131n\u0131 belirlemektir. Bunun i\u00e7in Elbow Method'unu uygular\u0131z.\n\nBurada k\u00fcme say\u0131s\u0131 artt\u0131k\u00e7a, dirsek dedi\u011fimiz k\u0131sm\u0131 kullan\u0131yoruz ve belli bir noktadan sonra de\u011ferin \u00e7ok fazla d\u00fc\u015fmedi\u011fini g\u00f6r\u00fcyoruz. Bu nedenle 3 veya 4 kullanmak bizim i\u00e7in daha de\u011ferli olabilir.","c4bedf80":"# Proje Konusu \n\n\nBir e-ticaret \u015firketi m\u00fc\u015fterilerini segmentlere ay\u0131r\u0131p bu segmentlere g\u00f6re pazarlama stratejileri belirlemek istiyor.\n\nBuna y\u00f6nelik olarak m\u00fc\u015fterilerin davran\u0131\u015flar\u0131n\u0131 tan\u0131mlayaca\u011f\u0131z ve bu davran\u0131\u015flarda \u00f6beklenmelere g\u00f6re gruplar olu\u015fturaca\u011f\u0131z.\n\nYani ortak davran\u0131\u015flar sergileyenleri ayn\u0131 gruplara alaca\u011f\u0131z ve bu gruplara \u00f6zel sat\u0131\u015f ve pazarlama teknikleri geli\u015ftirmeye \u00e7al\u0131\u015faca\u011f\u0131z.\n\n### **Veri Seti Hikayesi**\n\n\"Online Retail II\" isimli veri seti \u0130ngiltere merkezli online bir sat\u0131\u015f ma\u011fazas\u0131n\u0131n 01\/12\/2009 - 09\/12\/2011 tarihleri aras\u0131ndaki sat\u0131\u015flar\u0131n\u0131 i\u00e7eriyor. Bu \u015firket hediyelik e\u015fya sat\u0131yor, bu \u00fcr\u00fcnler promosyon \u00fcr\u00fcnleri gibi d\u00fc\u015f\u00fcnebilir. Firman\u0131n m\u00fc\u015fterilerinin \u00e7o\u011fu toptanc\u0131d\u0131r.\n\n### **De\u011fi\u015fkenler**\n\n- **InvoiceNo**: Fatura numaras\u0131. Her i\u015fleme yani faturaya ait e\u015fsiz numara. E\u011fer bu kod C ile ba\u015fl\u0131yorsa i\u015flemin iptal edildi\u011fini ifade eder.\n- **StockCode**: \u00dcr\u00fcn kodu. Her bir \u00fcr\u00fcn i\u00e7in e\u015fsiz numara.\n- **Description**: \u00dcr\u00fcn ismi\n- **Quantity**: \u00dcr\u00fcn adedi. Faturalardaki \u00fcr\u00fcnlerden ka\u00e7ar tane sat\u0131ld\u0131\u011f\u0131n\u0131 ifade etmektedir.\n- **InvoiceDate**: Fatura tarihi ve zaman\u0131. \n- **UnitPrice**: \u00dcr\u00fcn fiyat\u0131 (Sterlin cinsinden)\n- **CustomerID**: E\u015fsiz m\u00fc\u015fteri numaras\u0131\n- **Country**: \u00dclke ismi. M\u00fc\u015fterinin ya\u015fad\u0131\u011f\u0131 \u00fclke.","e2836abe":"# Veriyi Anlama","113a4d91":"# Veri \u00d6n \u0130\u015fleme","c8bf0e58":"![online-shopping.jpg](attachment:online-shopping.jpg)","d5443e0f":"# RFM De\u011ferlerini Bulma\n\nRFM; Recency, Frequency, Monetary ifadelerinin ilk harflarinden olu\u015fur.\nM\u00fc\u015fterilerin sat\u0131n alma al\u0131\u015fkanl\u0131klar\u0131 \u00fczerinden pazarlama ve sat\u0131\u015f stratejileri belirlemeye yard\u0131mc\u0131 olan bir tekniktir.\n\n- Recency (yenilik): M\u00fc\u015fterinin son sat\u0131n almas\u0131ndan bug\u00fcne kadar ge\u00e7en s\u00fcre\n\n- Frequency (s\u0131kl\u0131k): Toplam sat\u0131n alma say\u0131s\u0131.\n\n- Monetary (parasal de\u011fer): M\u00fc\u015fterinin yapt\u0131\u011f\u0131 toplam harcama.","f7d5f85d":"![2017-PGHD.jpg](attachment:2017-PGHD.jpg)","7b9257e4":"# Sonu\u00e7\n\nBu \u00e7al\u0131\u015fmada RFM metrikleri \u00fczerinden 3 de\u011fi\u015fkene dayal\u0131 olarak Customer ID de\u011ferleri tekille\u015ftirilmi\u015ftir.\n\nBu veri seti, k-means y\u00f6ntemi uygulanarak say\u0131sal de\u011fi\u015fkenler temelinde 4 k\u00fcmeye indirilmi\u015ftir.","07a20340":"![internet-money-secure-payment-transaction-payment-mechanism-fintech-financial-technology-background-colorful-flat-style-illustration_1302-7478.jpg](attachment:internet-money-secure-payment-transaction-payment-mechanism-fintech-financial-technology-background-colorful-flat-style-illustration_1302-7478.jpg)"}}