{"cell_type":{"bcc26acc":"code","23b23bdb":"code","615af96c":"code","ceb507ea":"code","6fa31293":"code","752f6b32":"code","0a884f45":"code","516deb0a":"code","07329c62":"code","fb992efe":"code","ca0b6572":"code","6ad0b2ad":"code","17d655a4":"code","1a64c1a9":"code","5cfc4198":"code","69e9ecbc":"code","1ff1deca":"code","d55952f6":"code","1054e47a":"code","6895fbeb":"code","0b298f9c":"code","1be47712":"code","3f470ca0":"code","3ba7b1e4":"code","e142b2fe":"code","be8bc663":"code","643172bc":"code","154e3537":"code","c3a7b228":"code","fcdfb4c5":"code","eb1afda5":"markdown","1dc70183":"markdown","861f104d":"markdown","f317b612":"markdown","6af82a32":"markdown","5078d5ec":"markdown","7c0a5c1f":"markdown","e57cebfc":"markdown","e0303d9c":"markdown","43ac76ea":"markdown","1ac59853":"markdown","5695897a":"markdown","8baafda6":"markdown","8d518b85":"markdown","be69b16c":"markdown","c869f1d7":"markdown","75c3d990":"markdown"},"source":{"bcc26acc":"import numpy as np \nimport pandas as pd \nimport os\n#print(os.listdir(\"..\/input\"))\n\n%matplotlib inline\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly.graph_objs as go\nfrom plotly.offline import download_plotlyjs,init_notebook_mode, plot, iplot\n#init_notebook_mode(connected=True)\n\nsns.set()","23b23bdb":"df_2017 = pd.read_csv(\"..\/input\/us-census-demographic-data\/acs2015_census_tract_data.csv\")\ndf_2015 = pd.read_csv(\"..\/input\/us-census-demographic-data\/acs2015_census_tract_data.csv\")\nlgbt = pd.read_csv('..\/input\/map-lgbt-policy-tally\/MAP.csv')\nideo = pd.read_csv('..\/input\/state-ideology\/stateideology_v2018.csv',header=None)\narda = pd.read_csv('..\/input\/arda-state\/ARDA_State.csv')","615af96c":"lgbt.info()","ceb507ea":"lgbt.head()","6fa31293":"lgbt.describe()","752f6b32":"id_col = ['State', 'State_id','Year','Citi_ideo','Govt_ideo']\n\nideo.columns = id_col","0a884f45":"ideo.isna().sum()","516deb0a":"print(ideo.loc[ideo.State.isna()])\n\n\nideo.loc[ideo.Citi_ideo.isna()]","07329c62":"ideo = ideo.sort_values(['State_id','Year']).fillna(method='ffill')","fb992efe":"ideo_recent = ideo.loc[ideo['Year']>=2015].groupby('State',as_index=False)['State_id','Citi_ideo','Govt_ideo'].mean()\n\nideo_recent.head()","ca0b6572":"arda_col = ['STNAME']\nfor col in arda.columns:\n    if 'RATE' in col:\n        arda_col.append(col)\narda_col","6ad0b2ad":"arda_rel = arda[arda_col[:9]]\n\narda_rel['STID'] = lgbt.loc[lgbt['State']==arda['STNAME'],['State_id']]\narda_rel.fillna(0,inplace=True)\narda_rel.head()","17d655a4":"for col in arda_rel.columns:\n    if col in ['STNAME','STID','TOTRATE']:\n        continue\n    else:\n        arda_rel[col] = arda_rel[col]\/arda_rel['TOTRATE']\n\narda_rel.head()","1a64c1a9":"full = [df_2017,df_2015]","5cfc4198":"for df in full:\n    df['Other Race'] = 100 - df['White']-df['Black']-df['Hispanic']-df['Asian']-df['Native']-df['Pacific']","69e9ecbc":"df_2017.columns","1ff1deca":"rel_col = ['State','CensusTract','TotalPop','Men','Women','White', 'Black', 'Hispanic', 'Asian', 'Pacific', 'Native', 'Other Race',\n           'Income','IncomePerCap','Poverty','Unemployment']","d55952f6":"df_2017 = df_2017[rel_col]\ndf_2015 = df_2015[rel_col]","1054e47a":"def by_state(df):\n    \n    df1 = lgbt.copy()[['State', 'State_id']]\n        \n    for col in df.columns:\n        if col in ['CensusTract','State']:\n            continue\n        if 'TotalPop' in col:\n            df1[col] = df.groupby(['State'],as_index=False)[col].sum()[col]\n        else:\n            df1[col+'_rate'] = df.groupby(['State'],as_index=False)[col].sum()[col].divide(df1['TotalPop'])\n        \n    return df1\n\n\ndef clean(df):\n    df2 = df.copy()    \n    for col in df.columns:\n        \n        if col in ['CensusTract','State','TotalPop','Men','Women']:\n            continue\n        \n        df2[col]=df2[col].mul(df2['TotalPop'],fill_value=1)\n        \n        dfnew = by_state(df2)\n    return dfnew","6895fbeb":"df17_state=clean(df_2017)\n\ndf17_state.head()","0b298f9c":"init_notebook_mode(connected=True)\n\nso_scale = [\n    [0.0, 'rgb(242,240,247)'],\n    [0.2, 'rgb(218,218,235)'],\n    [0.4, 'rgb(188,189,220)'],\n    [0.6, 'rgb(158,154,200)'],\n    [0.8, 'rgb(117,107,177)'],\n    [1.0, 'rgb(84,39,143)']\n]\n\ngi_scale = [\n    [0.0, 'rgb(247,240,242)'],\n    [0.2, 'rgb(235,218,218)'],\n    [0.4, 'rgb(220,189,188)'],\n    [0.6, 'rgb(200,154,158)'],\n    [0.8, 'rgb(177,107,117)'],\n    [1.0, 'rgb(143,39,84)']]\n    \nso_data = [dict(type='choropleth',\n    colorscale = so_scale,\n    autocolorscale = False,\n    locationmode = 'USA-states',\n    locations = lgbt['State_id'],\n    z = lgbt['SO_Tally'],\n    colorbar = go.choropleth.ColorBar()\n)]\n\nso_layout = dict(\n    title = 'Sexual Orientation Tally',\n    geo = dict(\n        scope = 'usa',\n        projection = {'type':'albers usa'},\n        showlakes = True,\n        lakecolor = 'rgb(255, 255, 255)')\n)\n\nfig1 = go.Figure(data = so_data, layout = so_layout)\niplot(fig1)\n\ngi_data = [dict(type='choropleth',\n    colorscale = gi_scale,\n    autocolorscale = False,\n    locationmode = 'USA-states',\n    locations = lgbt['State_id'],\n    z = lgbt['GI_Tally'],\n    colorbar = go.choropleth.ColorBar()\n)]\n\ngi_layout = dict(\n    title = 'Gender Identity Tally',\n    geo = dict(\n        scope = 'usa',\n        projection = {'type':'albers usa'},\n        showlakes = True,\n        lakecolor = 'rgb(255, 255, 255)')\n)\n\nfig2 = go.Figure(data = gi_data, layout = gi_layout)\niplot(fig2)\n","1be47712":"data = [dict(type='choropleth',\n    colorscale = 'Viridis',\n    autocolorscale = False,\n    reversescale=True,\n    locationmode = 'USA-states',\n    locations = lgbt['State_id'],\n    z = lgbt['Tot_Tally'],\n    text = lgbt['State_id'].astype(str),\n    colorbar = go.choropleth.ColorBar()\n)]\n\nlayout = dict(\n    title = 'Total Policy Tally',\n    geo = dict(\n        scope = 'usa',\n        projection = {'type':'albers usa'},\n        showlakes = True,\n        lakecolor = 'rgb(255, 255, 255)')\n)\n\nfig = go.Figure(data = data, layout = layout)\niplot(fig)\n","3f470ca0":"ideo_recent.head()","3ba7b1e4":"_ = ideo_recent.plot(kind='bar',x='State',y=['Citi_ideo','Govt_ideo'],stacked=True,color=['darkblue','skyblue'],figsize = (20,8),\n                     legend=None)\n_ = plt.xticks(rotation=90)\n_ = plt.xlabel('State')\n_ = plt.ylabel('Ideology')\n_ = plt.legend(('Citizen Idelogy','Govt. Ideology'))","e142b2fe":"ideo_recent['Tot_ideo'] = ideo_recent['Citi_ideo']+ideo_recent['Govt_ideo'] \n\nideo_recent.sort_values(['Tot_ideo'],ascending=False).head(10).plot(kind='bar',x='State',y=['Citi_ideo','Govt_ideo'],\n                                                                    figsize=(12,6),stacked=True,color=['darkblue','lightblue'],legend=None)\nplt.xticks(rotation=60)\nplt.xlabel('State')\nplt.ylabel('Ideology')\nplt.legend(('Citizen Idelogy','Govt. Ideology'))\nplt.title('States With Highest Ideology Score')\nideo_recent.sort_values(['Tot_ideo','Citi_ideo','Govt_ideo'],ascending=False).tail(10).plot(kind='bar',x='State',y=['Citi_ideo','Govt_ideo'],\n                                                                                            figsize=(12,6),stacked=True,color=['darkblue','lightblue'],legend=None)\nplt.xticks(rotation=60)\nplt.xlabel('State')\nplt.ylabel('Ideology')\nplt.legend(('Citizen Idelogy','Govt. Ideology'))\nplt.title('States With Lowest Ideology Score')\n","be8bc663":"_ = lgbt.plot(kind='bar',x='State_id',y=['SO_Tally','GI_Tally'],stacked=True,color=['navy','lightseagreen'],figsize = (20,8),\n                     legend=None)\n_ = plt.xticks(rotation=60)\n_ = plt.xlabel('State')\n_ = plt.ylabel('Policy Tally')\n_ = plt.legend(('Sexual Orientation Policy','Gender Identity Policy'),loc ='upper right')","643172bc":"lgbt.sort_values(['Tot_Tally'],ascending=False).head(10).plot(kind='bar',x='State',y=['SO_Tally','GI_Tally'],\n                                                              figsize=(12,6),stacked=True,color=['navy','lightseagreen'],legend=None)\nplt.xticks(rotation=60)\nplt.xlabel('State')\nplt.ylabel('Policy Tally')\nplt.legend(('Sexual Orientation Tally','Gender Identity Tally'))\nplt.title('States With Highest Policy Tally')\nlgbt.sort_values(['Tot_Tally','GI_Tally','SO_Tally'],ascending=True).head(10).plot(kind='bar',x='State',y=['SO_Tally','GI_Tally'],\n                                                                                            figsize=(12,6),stacked=True,color=['navy','lightseagreen'],legend=None)\nplt.xticks(rotation=60)\nplt.xlabel('State')\nplt.ylabel('Policy Tally')\nplt.legend(('Sexual Orientation Tally','Gender Identity Tally'))\nplt.title('States With Lowest Policy Tally')\n","154e3537":"full = df17_state.merge(lgbt,on=['State','State_id'],how='inner').merge(arda_rel,left_on=['State','State_id'],right_on=['STNAME','STID'],how='inner').drop(\n    ['STNAME','STID','TOTRATE'],axis=1)\nfull.head()","c3a7b228":"full.drop(['Other Race_rate','Income_rate','Men_rate','Women_rate'],axis=1,inplace=True)\ndata = full.merge(ideo_recent.drop('State_id',axis=1),on=['State'])","fcdfb4c5":"corr = data.corr()\ncmap = sns.cubehelix_palette(8,light=1, as_cmap=True)\n_ , ax = plt.subplots(figsize =(14, 10))\nhm = sns.heatmap(corr, ax= ax, annot= True,linewidths=0.2,cmap=cmap)","eb1afda5":"According to the exploration, the missing data for State and Year can easily be filled in witht he forward fill method. I'll use forward fill for the others as well, because it seems reasonable that not too much will change in one year. But we must ensure that the data is sorted by state and year, otherwise forward fill will yield disastrous results.","1dc70183":"### US ACS Census Tract Data","861f104d":"# Initial Exploration and Cleaning\n\n### Movement Advancement Project Data\n\nThis one is pretty clean, since I had to plug and chug data from their website into a csv file myself.","f317b612":"### ARDA (Religious Demographic) Data\n\nLet's first select relevant columns.","6af82a32":"### State Ideology Data\nThe state ideology data does not come with column names. I've looked at the data description on the website to learn what the columns are, and I'll rename the columns accordingly.","5078d5ec":"Here SO_Tally is the pertains to sexual orientation policies, and GI_Tally pertains to gender identity policies. Tot_Tally is the sum of the two.","7c0a5c1f":"Clearly, there is a huge variance in the policy tallies by state. It's clear from looking at the standard deviation, the quantiles, and the range. It can also be seen just by looking at the tallies for Alabama and California in the first few rows of the dataset. On an average, states are more accepting (in terms of their policy) when it comes to sexual orientation than gender identity. ","e57cebfc":"For this analysis, we don't really care about the transportation or employment type. We, however, are interested to see if sex, race or poverty has any correlation at all to political alignment and therefore possibly on LGBT+ inclusivity.","e0303d9c":"# Visual Exploration\n\nNow let's make some plots and observe some trends.","43ac76ea":"I'm going to drop some columns as they will most likely be irrelevant or redundant. For example, income and income per capita are redundant, so I'll only keep income per capita.","1ac59853":"As a part of the LGBT+ community, I am predictably interested in finding out which states are more supportive of the LGBT+ community compared to the others. Here I try to look state based demographic data and the policy tally helpfully collected by the Movement Advancement Project to find the predicting factors that contribute to LGBT+ inclusivity in the United States.\n\n# Data:\n\nI have used four datasets:\n1. ACS Demographic Data from [here](https:\/\/www.kaggle.com\/muonneutrino\/us-census-demographic-data\/kernels?sortBy=hotness&group=everyone&pageSize=20&datasetId=7001&kernelType=all&language=Python)\n2. Movement Advancement Project Policy Tally Data from [their wbsite](http:\/\/www.lgbtmap.org\/)\n3. State Ideology data collected by [Richard C. Fording](https:\/\/rcfording.wordpress.com\/state-ideology-data\/)\n4. U.S. Religious Demographic Data collected by [ARDA](http:\/\/www.thearda.com\/Archive\/Files\/Descriptions\/RCMSCY10.asp)","5695897a":"Now let's define some functions and aggregate the data by state. By simply taking the mean, we would be making a mistake since the total population in each census tract is varied. We must therefore take the weighted mean of the rates.","8baafda6":"Let's look at the highest and lowest scoring states in terms of ideology.","8d518b85":"# Correlation Heatmap\n\nI will start by merging the datasets into one so I can plot correlation matrices and so on.","be69b16c":"## Importing Modules and Data","c869f1d7":"Conclusions:\n\n1. Citizen and government ideology directly affects LGBT+ policy tally, which is not sirprising, given that policies are very closely related to government ideology.\n2. Religious demographics do affect LGBT+ inclusivity. the Evangelist demographic being the most important negative factors.\n3. There seems to be a significant correlation between hispanic and asian populations with the policy tally. However, that does not necessarily mean those communities are more inclusive. It is much more likely that people from certain racial\/ethnic demographics end up living in states which are more inclusive towards the LGBT+ community, as they tend to also be more inclusive towards a diverse racial demographics.\n4. One can use county level demographics data to make predictions on citizen ideology by county for each state.","75c3d990":"Clearly, to predict support for the LGBT community in 2019, ideology data from the 1970s isn't particularly relevant. So I will create a dataframe with ideology data from the recent years."}}