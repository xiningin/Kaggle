{"cell_type":{"6005548c":"code","1bf1935d":"code","78a3d426":"code","5dc2e671":"code","13c537a7":"code","2ccc13cd":"code","3ddd591e":"code","21c11f9a":"code","25ceafea":"code","64635b9e":"code","5d4ce54d":"code","4422f20a":"code","95024290":"code","0d681c2d":"code","69b6a980":"code","6728715b":"code","d959d7e8":"code","0e704be4":"code","77bde351":"code","f386ca96":"code","857403fd":"code","dbeede10":"code","86c6b6ca":"code","2484f1fe":"code","4d9c8733":"code","7f7e9178":"code","88289714":"code","96a7b41f":"code","2c6055c5":"markdown","6b3a876b":"markdown","184f99cd":"markdown","210b06ab":"markdown","92000a41":"markdown","f6afc726":"markdown","a7cf2da0":"markdown","cc48ba85":"markdown","076f7011":"markdown","a2fbf1f2":"markdown","547057b3":"markdown","e81d2b83":"markdown","4b9205de":"markdown","e59cc1ca":"markdown","6889b77c":"markdown","6741c01d":"markdown","2d13641c":"markdown","eec48ce2":"markdown","79e5de9e":"markdown","fa8e22f1":"markdown","a9c29070":"markdown","a2d33e9c":"markdown","efe89ef4":"markdown","a9de955c":"markdown","d369bdd1":"markdown","ab101a89":"markdown","5c520c9e":"markdown","7c52e836":"markdown","5012a842":"markdown","77c0ed82":"markdown","96b8284a":"markdown","572c3716":"markdown","d06168eb":"markdown","861f7d15":"markdown","398c040a":"markdown","06f4f2cc":"markdown","b1d0b598":"markdown","aeaa2e93":"markdown"},"source":{"6005548c":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input\/nifty50-stock-market-data'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n","1bf1935d":"# Importing required modules\nimport pandas as pd          \nimport numpy as np               # For mathematical calculations \nimport matplotlib.pyplot as plt  # For plotting graphs \nimport datetime as dt\nfrom datetime import datetime    # To access datetime \nfrom pandas import Series        # To work on series \n%matplotlib inline \n\nimport warnings                   # To ignore the warnings \nwarnings.filterwarnings(\"ignore\")\n\n\n# Settings for pretty nice plots\nplt.style.use('fivethirtyeight')\nplt.show()\n\n","78a3d426":"df = pd.read_csv(\"\/kaggle\/input\/nifty50-stock-market-data\/MARUTI.csv\")\ndf.head()","5dc2e671":"# For the sake of this notebook, I shall limit the number of columns to keep things simple. \n\ndata = df[['Date','Open','High','Low','Close','Volume','VWAP']]\n","13c537a7":"data.info()","2ccc13cd":"# Convert string to datetime64\ndata['Date'] = data['Date'].apply(pd.to_datetime)\ndata.head()","3ddd591e":"from datetime import datetime\nmy_year = 2019\nmy_month = 4\nmy_day = 21\nmy_hour = 10\nmy_minute = 5\nmy_second = 30","21c11f9a":"test_date = datetime(my_year, my_month, my_day)\ntest_date\n","25ceafea":"test_date = datetime(my_year, my_month, my_day, my_hour, my_minute, my_second)\nprint('The day is : ', test_date.day)\nprint('The hour is : ', test_date.hour)\nprint('The month is : ', test_date.month)","64635b9e":"print(data.index.max())\nprint(data.index.min())","5d4ce54d":"# Earliest date index location\nprint('Earliest date index location is: ',data.index.argmin())\n\n# Latest date location\nprint('Latest date location: ',data.index.argmax())\n","4422f20a":"df_vwap = df[['Date','VWAP']]\ndf_vwap['Date'] = df_vwap['Date'].apply(pd.to_datetime)\ndf_vwap.head()","95024290":"df_vwap['year'] = df_vwap.Date.dt.year\ndf_vwap['month'] = df_vwap.Date.dt.month\ndf_vwap['day'] = df_vwap.Date.dt.day\ndf_vwap['day of week'] = df_vwap.Date.dt.dayofweek\n\n#Set Date column as the index column.\ndf_vwap.set_index('Date', inplace=True)\ndf_vwap.head()","0d681c2d":"# Visualising the VWAP \n\nplt.figure(figsize=(16,8)) \nplt.plot(df_vwap['VWAP'], label='VWAP') \nplt.title('Time Series') \nplt.xlabel(\"Time(year)\") \nplt.ylabel(\"Volume Weighted Average Price\") \nplt.legend(loc='best')","69b6a980":"# Yearly VWAP of Maruti Stocks\n\ndf_vwap.groupby('year')['VWAP'].mean().plot.bar()","6728715b":"# Monthly VWAP of Maruti Stocks\n\ndf_vwap.groupby('month')['VWAP'].mean().plot.bar()","d959d7e8":"# Daily VWAP of Maruti Stocks\n\ndf_vwap.groupby('day')['VWAP'].mean().plot.bar()","0e704be4":"# Analysing w.r.t day of the week\n\ndf_vwap.groupby('day of week')['VWAP'].mean().plot.bar()","77bde351":"df_vwap.resample(rule = 'A').mean()[:5]","f386ca96":"df_vwap['VWAP'].resample('A').mean().plot(kind='bar',figsize = (10,4))\nplt.title('Yearly Mean VWAP for Maruti')\n","857403fd":"df_vwap['VWAP'].resample('AS').mean().plot(kind='bar',figsize = (10,4))\nplt.title('Yearly start Mean VWAP for Maruti')\n","dbeede10":"df_vwap.head()","86c6b6ca":"df_vwap.shift(1).head()","2484f1fe":"df_vwap.shift(-1).head()","4d9c8733":"df_vwap.tshift(periods=3, freq = 'M').head()","7f7e9178":"df_vwap['VWAP'].plot(figsize = (10,6))","88289714":"df_vwap.rolling(7).mean().head(10)","96a7b41f":"df_vwap['VWAP'].plot()\ndf_vwap.rolling(window=30).mean()['VWAP'].plot(figsize=(16, 6))","2c6055c5":"For our stock price dataset, the type of the index column is DatetimeIndex. We can use pandas to obtain the minimum and maximum dates in the data.","6b3a876b":"# Time series data\n\nTime series data is a sequence of data points in chronological order that is used by businesses to analyze past data and make future predictions. These data points are a set of observations at specified times and equal intervals, typically with a datetime index and corresponding value. Common examples of time series data in our day-to-day lives include:      \n\n* Measuring weather temperatures \n* Measuring the number of taxi rides per month\n* Predicting a company\u2019s stock prices for the next day\n\n## Components of Time\u00a0Series\n\nTime series data consist of four components:\n\n* Trend Component: This is a variation that moves up or down in a reasonably predictable pattern over a long period.\n\n* Seasonality Component: is the variation that is regular and periodic and repeats itself over a specific period such as a day, week, month, season, etc.,\n\n* Cyclical Component: is the variation that corresponds with business or economic 'boom-bust' cycles or follows their own peculiar cycles, and\n\n* Random Component: is the variation that is erratic or residual and does not fall under any of the above three classifications.\n\nTo make this concept more clear here is a visual interpretation of the various components of the Time Series. You can view the original diagram with its context, [here](https:\/\/www.atap.gov.au\/tools-techniques\/travel-demand-modelling\/6-forecasting-evaluation).\n\n![](https:\/\/kite.com\/wp-content\/uploads\/2019\/08\/variations-of-time-series.jpg)","184f99cd":"## Rolling windows\n\nTime series data can be noisy due to high fluctuations in the market. As a result, it becomes difficult to gauge a trend or pattern in the data. Here is a visualization of the Amazon\u2019s adjusted close price over the years where we can see such noise:  ","210b06ab":"# Conclusion\nPython\u2019s pandas library is a powerful, comprehensive library with a wide variety of inbuilt functions for analyzing time series data. In this article, we saw how pandas can be used for wrangling and visualizing time series data. \n\nWe also performed tasks like time sampling, time shifting and rolling with stock data. These are usually the first steps in analyzing any time series data. Going forward, we could use this data to perform a basic financial analysis by calculating the daily percentage change in stocks to get an idea about the volatility of stock prices. Another way we could use this data would be to predict Maruti\u2019s stock prices for the next few days by employing machine learning techniques. This would be especially helpful from the shareholder\u2019s point of view. ","92000a41":"Let us now look at the datatypes of the various components.","f6afc726":"## Forward Shifting\nTo shift our data forward, we will pass the desired number of periods (or increments) through the shift() function, which needs to be positive value in this case. Let's move our data forward by one period or index, which means that all values which earlier corresponded to row N will now belong to row N+1. Here is the output: \n","a7cf2da0":"Now that our data has been converted into the desired format, let\u2019s take a look at its various columns for further analysis.      \n\n* **The Open and Close columns** indicate the opening and closing price of the stocks on a particular day.\n* **The High and Low columns** provide the highest and the lowest price for the stock on a particular day, respectively.\n* **The Volume column** tells us the total volume of stocks traded on a particular day.\n\nThe **volume weighted average price (VWAP)** is a trading benchmark used by traders that gives the average price a security has traded at throughout the day, based on both volume and price. It is important because it provides traders with insight into both the trend and value of a security.[source](https:\/\/www.investopedia.com\/terms\/v\/vwap.asp).","cc48ba85":"## Time resampling\nExamining stock price data for every single day isn\u2019t of much use to financial institutions, who are more interested in spotting market trends. To make it easier, we use a process called time resampling to aggregate data into a defined time period, such as by month or by quarter. Institutions can then see an overview of stock prices and make decisions according to these trends.           \n\nThe pandas library has a `resample()` function which resamples such time series data. The resample method in pandas is similar to its `groupby` method as it is essentially grouping according to a certain time span. The `resample()` function looks like this:","076f7011":"The first six values have all become blank as there wasn\u2019t enough data to actually fill them when using a window of seven days.      \n\nSo, what are the key benefits of calculating a moving average or using this rolling mean method? Our data becomes a lot less noisy and more reflective of the trend than the data itself. Let\u2019s actually plot this out. First, we\u2019ll plot the original data followed by the rolling data for 30 days.     ","a2fbf1f2":"As we\u2019re looking at daily data, there\u2019s quite a bit of noise present. It would be nice if we could average this out by a week, which is where a rolling mean comes in. A rolling mean, or moving average, is a transformation method which helps average out noise from data. It works by simply splitting and aggregating the data into windows according to function, such as `mean()`, `median()`, `count()`, etc. For this example, we\u2019ll use a rolling mean for 7 days.","547057b3":"It appears that the Date column is being treated as a string rather than as dates. To fix this, we\u2019ll use the pandas `to_datetime()` feature which converts the arguments to dates.","e81d2b83":"This is somewhat strange. While the activity is almost similar from Monday to Friday, Sunday shows a sudden spike in the VWAP price. This means although stockmarkets are closed on weekends, but when they were open, there were huge transactions on those days.","4b9205de":"The above bar plot corresponds to Maruti\u2019s VWAP at year-end for each year in our data set. \n\nSimilarly, year start mean VWAP can be found below. ","e59cc1ca":"#### P.S : This notebook has also been converted into a blogpost, incase you are interested. You can read it here: [Time Series Analysis with Pandas](https:\/\/kite.com\/blog\/python\/pandas-time-series-analysis\/)","6889b77c":"> **To summarize what happened above:**\n>\n>  * `data.resample()` is used to resample the stock data.\n>  * The \u2018**A**\u2019 stands for year-end frequency, and denotes the offset values by which we want to resample the data.\n>  * `mean()` indicates that we want the average stock price during this period.","6741c01d":"We can now create a datetime object, and use it freely with pandas given the above attributes.","2d13641c":"Sometimes, we may need to shift or move the data forward or backwards in time. This shifting is done along a time index by the desired number of time-frequency increments.Here is the original dataset before any time shifts.","eec48ce2":"no major difference in between different months","79e5de9e":"Let's extract the year, month, day, day of the week from the Date column.\n\n**Note - 0 is the starting of the week, i.e., 0 is Monday and 6 is Sunday.**\n","fa8e22f1":"## Feature Extraction\n\nLet's extract time and date features from the Date column. Since the **volume weighted average price** (VWAP) is a trading benchmark, we shall limit our analysis to only that column.","a9c29070":"# A first look at Maruti\u2019s stock Prices\nLet\u2019s look at the first few columns of the dataset:","a2d33e9c":"# Table of Contents:\n* A first look at Maruti\u2019s stock Prices\n* Pandas for time series analysis\n - Manipulating datetime\n* Feature Extraction\n* Exploratory data Analysis\n* Time Resampling\n* Time Shifting\n - Forward Shifting\n - Bckward Shifting\n - Shifting based of time string code\n* Rolling Window \n \n","efe89ef4":"Again, all days of the month have somewhat similar outcomes","a9de955c":"![](https:\/\/images.unsplash.com\/photo-1535320903710-d993d3d77d29?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1350&q=80)\n\n*Photo by M. B. M. on Unsplash*","d369bdd1":"For the purposes of analyzing our particular data, we have selected only the day, month and year, but we could also include more details like hour, minute and second if necessary. ","ab101a89":"We can also use time sampling to plot charts for specific columns.","5c520c9e":"# Importing necessary libraries\n\nPython\u2019s Pandas' library is frequently used to import, manage, and analyze datasets in a variety of formats. In this article, we\u2019ll use it to analyze stock prices of [Maruti](https:\/\/en.wikipedia.org\/wiki\/Maruti_Suzuki) and perform some basic time series operations.\n\nMaruti Suzuki India Limited, formerly known as **Maruti Udyog Limited**, is an automobile manufacturer in India. It is a 56.21% owned subsidiary of the Japanese car and motorcycle manufacturer [Suzuki Motor Corporation](https:\/\/en.wikipedia.org\/wiki\/Suzuki).[6]As of July 2018, it had a market share of 53% of the Indian passenger car market.[*Wikipedia*]","7c52e836":"## Time Shifting","5012a842":"The opening amount corresponding to **2003-07-09** is now **167**, whereas originally it was **164.90**.","77c0ed82":"Below is a complete list of the offset values. The list can also be found in the [pandas documentation](http:\/\/pandas.pydata.org\/pandas-docs\/stable\/user_guide\/timeseries.html#offset-aliases).\n\n![](https:\/\/cdn-images-1.medium.com\/max\/800\/1*piQRFEDprVNqznejGotpcw.png)","96b8284a":"## Exploratory Data Analysis\n\nLet's explore the data and look at details at year, month and day level","572c3716":"We can also calculate the latest date location and the earliest date index location as follows:","d06168eb":"# Pandas for time series analysis\nAs pandas was developed in the context of financial modeling, it contains a comprehensive set of tools for working with dates, times, and time-indexed data. Let\u2019s look at the main pandas data structures for working with time series data.\n\n## Manipulating datetime\nPython's basic objects for working with dates and times reside in the built-in `datetime` module. In pandas, a single point in time is represented as a `Timestamp` and we can use `datetime()` function to create Timestamps from strings in a wide variety of date\/time formats.","861f7d15":"## Backwards shifting\nTo shift our data backwards, the number of periods (or increments) must be negative.","398c040a":"## Shifting based off time string code\nWe can also use the offset from the offset table for time shifting. For that, we will use the pandas `shift()` function. We only need to pass in the `periods` and `freq` parameters. The `period` attribute defines the number of steps to be shifted, while the `freq` parameters denote the size of those steps.\n\nLet\u2019s say we want to shift the data three months forward:","06f4f2cc":"It appears that Maruti had a more or less steady increase in its stock price over the from 2004 to the mid of 2018 window.There appears to be some drop in 2019 though.  We\u2019ll now use pandas to analyze and manipulate this data to gain insights.","b1d0b598":"There is a continuos increase in the VWAP price till 2018 and a certain dip in 2019. Now, let's analyse the data month wise","aeaa2e93":"The **blue line** is the original open price data. The **red line represents the 30-day rolling window**, and has less noise than the orange line. Something to keep in mind is that once we run this code, the first 29 days aren\u2019t going to have the blue line because there wasn\u2019t enough data to actually calculate that rolling mean."}}