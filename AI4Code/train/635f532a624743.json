{"cell_type":{"e1c2fc4f":"code","d3df4353":"code","cc669e39":"code","6e0e6c62":"code","23aa213c":"code","b231b9d7":"code","66577401":"code","4b445fe7":"code","3c11a040":"code","4bccbcc5":"code","c89e76b6":"code","f4f61709":"code","24e8b9ec":"code","713e8fe3":"code","c3effd90":"code","6d3c8d6b":"code","27b2ad2d":"code","9d148bd6":"code","2600625a":"code","92871a24":"code","a0426ddd":"code","1cedd1d5":"code","8bbb65fa":"code","1853719f":"markdown","2a6d9249":"markdown","89aee0bf":"markdown","87f92045":"markdown","d65d8cbe":"markdown","2502ff9a":"markdown","f2078942":"markdown","35aca4a5":"markdown","32b16aba":"markdown"},"source":{"e1c2fc4f":"import os\nimport pandas\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport cv2\n\nfrom fastai.vision.all import *","d3df4353":"!pip install fastai timm nbdev -q --upgrade","cc669e39":"import timm","6e0e6c62":"path = '\/kaggle\/input\/landmark-recognition-2021\/'","23aa213c":"train_data = pd.read_csv(path+'train.csv')\nsamp_subm = pd.read_csv(path+'sample_submission.csv')","b231b9d7":"train_data.head(5)\n","66577401":"print(len(train_data))","4b445fe7":"samp_subm.head(5)","3c11a040":"train_img_files = get_image_files(f'{path}train') #fastai function that helps us grab all the image files (recursively) in one folder.\nlen(train_img_files)","4bccbcc5":"train_img_files[0] #now we have the path of each image","c89e76b6":"train_img_files[0].name","f4f61709":"for i in range(5):\n    img = PILImage.create(train_img_files[i])\n    img.show()\n    print(img.shape)","24e8b9ec":"bs = 8 #batch size","713e8fe3":"get_x = lambda x: path\/'train'\/f'{x[0][0]}'\/f'{x[0][1]}'\/f'{x[0][2]}'\/f'{x[0]}.jpg'","c3effd90":"get_y = lambda x: x[1]","6d3c8d6b":"item_tfms = Resize(size = 460)\nbatch_tfms = [*aug_transforms(size = 224, min_scale = 0.35), Normalize.from_stats(*imagenet_stats)]","27b2ad2d":"landmark_dataset = DataBlock(blocks = (ImageBlock, CategoryBlock),\n                             get_x = get_x,\n                             splitter = RandomSplitter(),\n                             get_y = get_y,\n                             item_tfms = item_tfms ,\n                             batch_tfms = batch_tfms)","9d148bd6":"dls = landmark_dataset.dataloaders(train_data, bs = bs)","2600625a":"dls.show_batch(max_n = 8)","92871a24":"learn = cnn_learner(dls, resnet34, metrics=accuracy, pretrained=False)","a0426ddd":"learn.fit_one_cycle(5, 5e-3)","1cedd1d5":"learn.lr_find()","8bbb65fa":"learn.export()\npath = Path()\npath.ls(file_exts='.pkl')","1853719f":"#### So we can see that the shape for the images are all diffrent","2a6d9249":"#### Now we will get the path to all our images using a fast.ai function","89aee0bf":"#### We would pass in the train_data later so for that we would collect X and Y so we need to make functions for it","87f92045":"# \ud83d\udcd3 Please Upvote the notebook \ud83d\udcd3","d65d8cbe":"#### Creating a Datablock","2502ff9a":"#### Now let us see the image and the shape for few","f2078942":"#### Now we will select a good learning rate","35aca4a5":"#### Now we will save our model and do prediction in the inference notebook","32b16aba":"#### Now we will train the model"}}