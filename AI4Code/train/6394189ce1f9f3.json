{"cell_type":{"c1efef58":"code","151e6ad6":"code","4243b3db":"code","90772fa1":"code","41086f72":"code","04c8603f":"code","c513b824":"code","9b665dc1":"code","278b3e82":"code","e4780ec6":"code","8f017808":"code","ca95b22c":"code","f7ff0222":"code","2491fc1d":"code","852df13e":"code","abeb057b":"code","92be847a":"code","03a89fd3":"code","a86bfd1d":"code","73015ff9":"code","cab5f2c1":"code","b8e80a17":"code","336f2063":"markdown","ea8cd814":"markdown","e8386076":"markdown","ba4b27c8":"markdown","e88e04c4":"markdown","343f5fcc":"markdown","a74986f4":"markdown","fdf84baa":"markdown","fd4857fc":"markdown"},"source":{"c1efef58":"# Import the neccessary libraries for data manipulation and visual representation\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport matplotlib as matplot\nimport seaborn as sns\n%matplotlib inline","151e6ad6":"#Install lifelines\n!pip install lifelines","4243b3db":"df = pd.read_csv('..\/input\/employee-turnover\/turnover.csv',encoding='cp1252')\ndf.head()","90772fa1":"# Missing values percentages\ndf.isnull().sum() \/ df.shape[0]","41086f72":"# Overall info\ndf.info()","04c8603f":"# Convert to categorical data\ndf.gender = df.gender.astype('category')\ndf.traffic = df.traffic.astype('category')\ndf.coach = df.coach.astype('category')\ndf.head_gender = df.head_gender.astype('category')\ndf.greywage = df.greywage.astype('category')\ndf.way = df.way.astype('category')","c513b824":"# Show coach data\nlist(df.coach.unique())","9b665dc1":"# Create has_coach column for those where the head is also the coach\ndf['has_coach'] = df.coach.apply(lambda c: 1 if c != 'no' else 0)\ndf[['has_coach','coach']]","278b3e82":"# Recheck info after conversions\ndf.info()","e4780ec6":"# Overall description\ndf.describe(include='all')","8f017808":"# Histograms for numeric variables\ndf.hist(figsize=(15, 10))","ca95b22c":"# Unique value for categories\nfor column in df.select_dtypes(include=['category']):\n    print(column + ':' + str(list(df[column].cat.categories)))","f7ff0222":"# Correlation of numeric variables with the turnover\ndf.corrwith(df.event)","2491fc1d":"## Absolute correlation heatmap between all numeric variables\nfig, ax = plt.subplots(figsize=(15, 8))\nsns.heatmap(abs(df.corr()),ax=ax)","852df13e":"# Dummy Variable Encoding\ndf = pd.get_dummies(data=df, drop_first = True, columns=list(df.select_dtypes(include=['category'])))\ndf.info()","abeb057b":"from lifelines import KaplanMeierFitter\n\nkmf = KaplanMeierFitter()\nkmf.fit(df.stag, df.event,label='Kaplan Meier Estimate')\nkmf.plot_survival_function(figsize=(15,10))","92be847a":"kmf = KaplanMeierFitter()\nfig, ax = plt.subplots(figsize=(20, 10))\n\ncohort1 = df[df.has_coach == 1]\nkmf.fit(cohort1.stag, cohort1.event,label='Kaplan Meier Estimate - employees with coaching')\nkmf.plot_survival_function(ax=ax,ci_show=False)\n\ncohort2 = df[df.has_coach != 1]\nkmf.fit(cohort2.stag, cohort2.event,label='Kaplan Meier Estimate - employees without coaching')\nkmf.plot_survival_function(ax=ax,ci_show=False)\n\nplt.text(52,0.7,'Coaching is relevant only',size=15,color='gray')\nplt.text(56,0.67,'until this point in time',size=15,color='gray')\nplt.axvline(x=86.5,color='gray',linestyle='--')","03a89fd3":"from sklearn import model_selection\n\n# Get features for HR profession\nfeatures = df[df.profession == 'HR'][['stag','event','age','extraversion','independ','selfcontrol','anxiety','novator','has_coach','gender_m','head_gender_m']].copy()\nfeatures","a86bfd1d":"from lifelines import CoxPHFitter\n\ncph = CoxPHFitter()\ncph.fit(features, duration_col='stag', event_col='event')\ncph.print_summary()","73015ff9":"cph.plot_partial_effects_on_outcome(covariates='selfcontrol', values=[0,10], cmap='coolwarm')","cab5f2c1":"cph.plot_partial_effects_on_outcome(covariates='age', values=[25,35,45,55], cmap='coolwarm')","b8e80a17":"# filter down to just censored subjects\ncensored_subjects = features.loc[~features['event'].astype(bool)]\ncensored_subjects_last_obs = censored_subjects['stag']\n\n# predict the median lifetimes for the remaining individuals\nprediction = censored_subjects.copy()\nprediction['median_remaining_lifetime'] = cph.predict_median(censored_subjects, conditional_after=censored_subjects_last_obs)\nprediction.sort_values(['median_remaining_lifetime','stag'])","336f2063":"A tabela abaixo mostra o sum\u00e1rio da regress\u00e3o que atingimos. Para mais informa\u00e7\u00f5es veja a parte sobre [Survival Regression](https:\/\/lifelines.readthedocs.io\/en\/latest\/Survival%20Regression.html#survival-regression) da biblioteca lifelines","ea8cd814":"# Modelagem de dados para profissionais de RH do dataset - Regress\u00e3o de Cox\n\nO tempo at\u00e9 o evento para um indiv\u00edduo na popula\u00e7\u00e3o \u00e9 muito importante para as curvas de sobreviv\u00eancia no n\u00edvel agregado; no entanto, em situa\u00e7\u00f5es da vida real, juntamente com os dados do evento, tamb\u00e9m temos as covari\u00e1veis (features) daquele indiv\u00edduo. Nesses casos, se modelarmos o impacto das covari\u00e1veis na curva de sobreviv\u00eancia podemos tentar estimar quanto tempo um indiv\u00edduo que ainda n\u00e3o saiu provavelmente permanecer\u00e1.\n\nNesta se\u00e7\u00e3o faremos isso para os profissionais de RH do nosso dataset","e8386076":"Podemos fazer mais do que an\u00e1lises de coorte a partir das curvas de sobreviv\u00eancia. Essa an\u00e1lise acima representa um caso de uso limitado do potencial da an\u00e1lise de sobreviv\u00eancia para a modelagem da rotatividade, porque a estamos usando para o n\u00edvel agregado dos dados. De fato, podemos criar as curvas de sobreviv\u00eancia at\u00e9 mesmo para casos individuais, com base nos efeitos das covari\u00e1veis e tentar prever a data de sa\u00edda dos colaboradores. Este ser\u00e1 o nosso objetivo na pr\u00f3xima se\u00e7\u00e3o deste notebook.","ba4b27c8":"Em seguida, vemos as probabilidades de permanencia com e sem coach e percebemos que, apesar do coaching parecer ajudar um pouco na permanencia inicial (isso \u00e9, a curva de sobrevida com coaching estar sempre acima da curva at\u00e9 o timeline de 86.5), essa vari\u00e1vel n\u00e3o modifica significativamente a curva ap\u00f3s isso.","e88e04c4":"# An\u00e1lise explorat\u00f3ria","343f5fcc":"# Tratamento de dados\n\nNesta primeira etapa, vamos preparar o que precisamos para a an\u00e1lise de turnover tomando os seguintes passos:\n\n* Carregando bibliotecas e dados;\n* Fazendo corre\u00e7\u00f5es e an\u00e1lises simples, como identifica\u00e7\u00e3o de valores faltantes, identifica\u00e7\u00e3o de categorias distintas, etc\n* Convertendo dados categ\u00f3ricos para num\u00e9ricos","a74986f4":"# An\u00e1lise de Sobreviv\u00eancia - Rotatividade de Funcion\u00e1rios\n\nO objetivo deste notebook em portugu\u00eas \u00e9 mostrar como An\u00e1lise de Sobreviv\u00eancia, em particular a biblioteca lifelines, pode ajudar empresas na modelagem e previs\u00e3o de rotatividade e sa\u00edda de funcion\u00e1rios. Seguirei uma metodologia padr\u00e3o de ci\u00eancia de dados, com se\u00e7\u00f5es como import\u00e2ncia\/necessidade de neg\u00f3cio, prepara\u00e7\u00e3o de dados, an\u00e1lise explorat\u00f3ria, constru\u00e7\u00e3o de modelos, avalia\u00e7\u00e3o e conclus\u00f5es para prever e descrever a rotatividade de funcion\u00e1rios.\n\n**Palavras chave**: an\u00e1lise de sobreviv\u00eancia, an\u00e1lise de sobrevida, turnover, people analytics, Kaplan-Meier, modelo de regress\u00e3o de cox, lifelines, python\n\n\n# Contexto e Necessidade de Neg\u00f3cio\n\nAs t\u00e9cnicas estat\u00edsticas conhecidas como an\u00e1lise de sobreviv\u00eancia ou an\u00e1lise de sobrevida s\u00e3o utilizadas quando se pretende analisar um fen\u00f4meno em rela\u00e7\u00e3o a um per\u00edodo de tempo, isto \u00e9, analisar o tempo transcorrido entre um evento inicial, no qual um sujeito ou um objeto entra em um estado particular e um evento final, que modifica este estado. Assim, descrevem n\u00e3o apenas se pacientes vivem ou morrem, como sugerido por seu nome, mas tamb\u00e9m diversos eventos de interesse em diferentes dom\u00ednios de neg\u00f3cios. \n\nNeste trabalho s\u00e3o abordadas t\u00e9cnicas de an\u00e1lise de sobrevida para tentar prever e modelar a rotatividade dentro das empresas. Afinal, investir em reduzir a rotatividade de funcion\u00e1rios, usando a ci\u00eancia de dados para entender suas causas e consequ\u00eancias, pode resultar em economias de custo significativas para os empregadores. De fato, de acordo com o [Work Institute\u2019s 2019 Retention Report](https:\/\/info.workinstitute.com\/hubfs\/2019%20Retention%20Report\/Work%20Institute%202019%20Retention%20Report%20final-1.pdf#page=9), a rotatividade de funcion\u00e1rios custa \u00e0s empresas mais de 600 bilh\u00f5es de d\u00f3lares todos os anos. O estudo estima que, para cada funcion\u00e1rio que sai, a empresa arca com at\u00e9 33% do sal\u00e1rio anual para substitu\u00ed-los.","fdf84baa":"# Fonte de dados\n\nO conjunto de dados \u00e9 composto das seguintes informa\u00e7\u00f5es:\n\n* stag: Corresponde ao tempo t quando ocorreu o turnover ou tempo de censura do estudo (ie. se o estudo terminou e a pessoa ainda n\u00e3o tinha deixado a empresa).\n* event: Indica se o evento ocorreu no tempo t. Caso seja 1, indica sa\u00edda, ou seja, o funcion\u00e1rio em quest\u00e3o deixou a empresa no tempo t.\n* gender: G\u00eanero do funcion\u00e1rio.\n* age: Idade do funcion\u00e1rio.\n* industry: Ind\u00fastria de atua\u00e7\u00e3o do funcion\u00e1rio.\n* profession: Profiss\u00e3o do funcion\u00e1rio.\n* traffic: De qual canal o funcion\u00e1rio ingressou para a empresa\n* coach: Presen\u00e7a de um coach\n* head_gender: G\u00eanero do supervisor ao qual o funcionario responde\n* greywage: Greywage na R\u00fassia ou na Ucr\u00e2nia significa que o empregador (empresa) paga apenas uma pequena quantia de sal\u00e1rio acima do sal\u00e1rio m\u00ednimo (white).\n* way: Forma que o funcion\u00e1rio se desloca para o escrit\u00f3rio.\n* extraversion: Escala segundo o teste Big5.\n* independ: Escala segundo o teste Big5.\n* selfcontrol: Escala segundo o teste Big5.\n* anxiety: Escala segundo o teste Big5.\n* novator: Escala segundo o teste Big5.\n\nMais informa\u00e7\u00f5es podem ser obtidas no dataset linkado. Aparentemente, tratam-se de dados reais.","fd4857fc":"# Modelagem de dados - Estimador de Kaplan-Meier\n\nO estimador de Kaplan-Meier, tamb\u00e9m conhecido como o estimador de limite de produto, pode ser usado para calcular as probabilidades de permanecer na empresa para o nosso conjuntos de dados.\n\nNa imagem abaixo, podemos ver a probabilidade de permanencia do nosso dataset inteiro."}}