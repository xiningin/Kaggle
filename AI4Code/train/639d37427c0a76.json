{"cell_type":{"a140864e":"code","8a78ed6e":"code","8c3b04c6":"code","59c82f80":"code","b9653111":"code","d9cd2e7d":"code","896caa1d":"code","4255338c":"code","fbff26eb":"code","21c9ec6b":"code","d4c20a06":"code","1a69af71":"code","7ead3df0":"code","187f746c":"code","80244874":"code","63663a35":"code","a3e5ac68":"code","0e9ef09a":"code","ffe47f66":"code","faf082f5":"code","b81e9b31":"code","bb1a1203":"code","d824f5ba":"code","4773cbce":"code","300fff73":"code","b659fef2":"code","6cde1124":"code","ade2f698":"code","3df97a89":"code","ff37ae38":"code","ac3e118d":"code","c06b5a76":"code","4a066687":"code","9596dd1c":"code","6c372572":"code","7c6eb072":"code","e9753805":"code","40e96206":"code","4c5640a8":"code","a6845806":"code","450ed946":"code","4bac8b37":"code","2c8d8dab":"code","1f6d97f3":"code","42683a36":"code","a2083e66":"markdown","764047a9":"markdown","0647f87c":"markdown","eb1fc3f6":"markdown","98d85180":"markdown","f4207f8c":"markdown","a4434ad8":"markdown","8721bb3c":"markdown","9ef28746":"markdown","83b48539":"markdown","a8ca272f":"markdown","f2d40d4f":"markdown","a8f3b908":"markdown","11292331":"markdown","72fa034e":"markdown","200891f9":"markdown","d874e7a1":"markdown","f281b43d":"markdown"},"source":{"a140864e":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\npd.set_option('display.max_columns', None); pd.set_option('display.max_rows', None);\npd.set_option('display.float_format', lambda x: '%.0f' % x)","8a78ed6e":"df_2010_2011 = pd.read_excel(\"online_retail_II.xlsx\", sheet_name = \"Year 2010-2011\")","8c3b04c6":"df = df_2010_2011.copy()\n#Hangi \u00fcr\u00fcnden ka\u00e7 tane var?\ndf[\"Description\"].value_counts().head()","59c82f80":"#E\u015fsiz \u00fcr\u00fcn say\u0131s\u0131 ka\u00e7t\u0131r?\ndf[\"Description\"].nunique()","b9653111":"#En \u00e7ok sipari\u015f edilen \u00fcr\u00fcn hangisidir?\ndf.groupby(\"Description\").agg({\"Quantity\":\"sum\"}).sort_values(\"Quantity\", ascending = False).head()","d9cd2e7d":"#Toplam ka\u00e7 fatura kesilmi\u015ftir?\ndf[\"Invoice\"].nunique()","896caa1d":"#Fatura ba\u015f\u0131na ortalama ka\u00e7 para kazan\u0131lm\u0131\u015ft\u0131r?\ndf[\"TotalPrice\"] = df[\"Quantity\"]*df[\"Price\"]","4255338c":"df.groupby(\"Invoice\").agg({\"TotalPrice\":\"sum\"}).head()\ndf.head()","fbff26eb":"#En pahal\u0131 \u00fcr\u00fcnler hangileridir?\ndf.sort_values(\"Price\", ascending = False).head()","21c9ec6b":"#Hangi \u00fclkeden ka\u00e7 sipari\u015f geldi?\ndf[\"Country\"].value_counts()","d4c20a06":"#Hangi \u00fclke ne kadar kazand\u0131rd\u0131?\ndf.groupby(\"Country\").agg({\"TotalPrice\":\"sum\"}).sort_values(\"TotalPrice\", ascending = False).head()","1a69af71":"#En \u00e7ok iade alan \u00fcr\u00fcn hangisidir? \n#Invoice de\u011fi\u015fkeninde ba\u015f\u0131nda \"C\" ifadesi yer alan \u00fcr\u00fcnler iptal edilmi\u015ftir. Veri setinde \u015fu anda bo\u015f yani de\u011ferler bulunmaktad\u0131r.\n#Bu y\u00fczden str.contains komutu i\u00e7inde na de\u011ferlerini False olarak tan\u0131mlay\u0131p g\u00f6rmezden geliyoruz. \n#Adet i\u015flemi i\u00e7in de \"Quantity\" de\u011fi\u015fkenini azalan \u015fekilde s\u0131ralayarak en \u00e7oktan en aza do\u011fru iadeleri s\u0131ralayabiliriz.\nreturn_ = df[df[\"Invoice\"].str.contains(\"C\", na=False)]\nreturn_.sort_values(\"Quantity\", ascending = True).head(3)","7ead3df0":"#Eksik de\u011fer olup olmad\u0131\u011f\u0131na bak\u0131yoruz.\ndf.isnull().sum()","187f746c":"df.shape","80244874":"#Eksik de\u011ferleri veri setinden \u00e7\u0131kar\u0131yoruz.\ndf.dropna(inplace = True)\ndf.shape","63663a35":"#\u0130statistiksel de\u011ferleri, kartilleri inceleyerek veri seti hakk\u0131nda bilgi ediniyoruz.\ndf.describe([0.01,0.05,0.10,0.25,0.50,0.75,0.90,0.95, 0.99]).T","a3e5ac68":"for feature in [\"Quantity\",\"Price\",\"TotalPrice\"]:\n\n    Q1 = df[feature].quantile(0.01)\n    Q3 = df[feature].quantile(0.99)\n    IQR = Q3-Q1\n    upper = Q3 + 1.5*IQR\n    lower = Q1 - 1.5*IQR\n\n    if df[(df[feature] > upper) | (df[feature] < lower)].any(axis=None):\n        print(feature,\"\u2192 YES\")\n        print(df[(df[feature] > upper) | (df[feature] < lower)].shape[0])\n    else:\n        print(feature, \"\u2192 NO\")","0e9ef09a":"df.info()","ffe47f66":"#Al\u0131\u015fveri\u015f yap\u0131lan ilk g\u00fcn\u00fc buluyoruz.\ndf[\"InvoiceDate\"].min()","faf082f5":"#Al\u0131\u015fveri\u015f yap\u0131lan son g\u00fcn\u00fc buluyoruz.\ndf[\"InvoiceDate\"].max()","b81e9b31":"#\u0130nceleyece\u011fimiz veriler 2010-2011 y\u0131llar\u0131 aras\u0131nda oldu\u011fu i\u00e7in bug\u00fcn\u00fcn tarihini kendimiz belirliyoruz.\nimport datetime as dt\ntoday_date = dt.datetime(2011,12,9)\ntoday_date","bb1a1203":"#M\u00fc\u015fteri ID'sine g\u00f6re son yap\u0131lan al\u0131\u015fveri\u015f tarihlerine ula\u015f\u0131yoruz.\ndf.groupby(\"Customer ID\").agg({\"InvoiceDate\":\"max\"}).head()","d824f5ba":"#(Bizim belirledi\u011fimiz bug\u00fcn\u00fcn tarihi - al\u0131\u015fveri\u015f yap\u0131lan son tarih) i\u015flemi yap\u0131ld\u0131\u011f\u0131nda recency de\u011ferini buluyoruz.\ntemp_df = (today_date - df.groupby(\"Customer ID\").agg({\"InvoiceDate\":\"max\"}))\ntemp_df.rename(columns={\"InvoiceDate\": \"Recency\"}, inplace = True)\ntemp_df.head()","4773cbce":"#Saat de\u011ferlerini silmek i\u00e7in, daha \u00f6nce buras\u0131 Invoice Date de\u011fi\u015fkeni ve veri tipi datetime oldu\u011fu i\u00e7in days'leri se\u00e7ip saatleri siliyoruz.\nrecency_df = temp_df[\"Recency\"].apply(lambda x: x.days)\nrecency_df.head()","300fff73":"temp_df = df.groupby([\"Customer ID\",\"Invoice\"]).agg({\"Invoice\":\"count\"})\ntemp_df.head()","b659fef2":"#Her m\u00fc\u015fteri ka\u00e7 al\u0131\u015fveri\u015f yapm\u0131\u015f toplamda bunu buluyoruz.\ntemp_df.groupby(\"Customer ID\").agg({\"Invoice\":\"count\"}).head()","6cde1124":"#Yukar\u0131da yapm\u0131\u015f oldu\u011fumuz i\u015flemi bir de\u011fi\u015fkene atay\u0131p \"Invoice\" yazan de\u011fi\u015fkeni de \"Frequency\" olarak de\u011fi\u015ftirip g\u00f6zlemliyoruz.\nfreq_df = temp_df.groupby(\"Customer ID\").agg({\"Invoice\":\"count\"})\nfreq_df.rename(columns={\"Invoice\": \"Frequency\"}, inplace = True)\nfreq_df.head()","ade2f698":"monetary_df = df.groupby(\"Customer ID\").agg({\"TotalPrice\":\"sum\"})\nmonetary_df.head()","3df97a89":"#Sut\u00fcn adland\u0131rmas\u0131n\u0131 de\u011fi\u015ftiriyoruz.\nmonetary_df.rename(columns={\"TotalPrice\": \"Monetary\"}, inplace = True)\nmonetary_df.head()","ff37ae38":"print(recency_df.shape,freq_df.shape,monetary_df.shape)","ac3e118d":"#Parametreleri bir dataframe olarak concat fonksiyonu yard\u0131m\u0131 ile birle\u015ftiriyoruz.\nrfm = pd.concat([recency_df, freq_df, monetary_df],  axis=1)\nrfm.head()","c06b5a76":"#De\u011ferler g\u00f6r\u00fcld\u00fc\u011f\u00fc \u00fczere 1 ile 5 aras\u0131nda olan de\u011ferlerdir. 5 \u00e7ok iyi, 1 ise \u00e7ok k\u00f6t\u00fc anlam\u0131na gelmektedir.\nrfm[\"RecencyScore\"] = pd.qcut(rfm['Recency'], 5, labels = [5, 4, 3, 2, 1])\nrfm[\"FrequencyScore\"] = pd.qcut(rfm['Frequency'].rank(method = \"first\"), 5, labels = [1,2,3,4,5])\nrfm[\"MonetaryScore\"] = pd.qcut(rfm['Monetary'], 5, labels = [1, 2, 3, 4, 5])\nrfm.head()","4a066687":"#Skorlar\u0131 yanyana yazd\u0131r\u0131yoruz.\n(rfm['RecencyScore'].astype(str) + \n rfm['FrequencyScore'].astype(str) + \n rfm['MonetaryScore'].astype(str)).head()","9596dd1c":"#RFM_SCORE s\u00fctununu Dataframe tablosuna ekliyoruz.\nrfm[\"RFM_SCORE\"] = rfm['RecencyScore'].astype(str) + rfm['FrequencyScore'].astype(str) + rfm['MonetaryScore'].astype(str)\nrfm.head()","6c372572":"#Betimsel istatistikleri inceliyoruz.\nrfm.describe().T","7c6eb072":"#En iyi m\u00fc\u015fteriler g\u00f6sterilmektedir.\nrfm[rfm[\"RFM_SCORE\"] == \"555\"].head()","e9753805":"#En k\u00f6t\u00fc m\u00fc\u015fteriler g\u00f6sterilmektedir.\nrfm[rfm[\"RFM_SCORE\"] == \"111\"].head()","40e96206":"#RFM skorlar\u0131na g\u00f6re m\u00fc\u015fterileri s\u0131n\u0131flara at\u0131yoruz. Bu s\u0131n\u0131flar\u0131n hangi skor aral\u0131\u011f\u0131nda olaca\u011f\u0131 a\u015fa\u011f\u0131da belirtilmi\u015ftir. \n#\u00d6rnek olarak Hibernating s\u0131n\u0131f\u0131 \u015fu skor de\u011ferlerine sahiptir. \n#Recency de\u011feri 1-2, Frequency de\u011feri 1-2 olanlard\u0131r di\u011fer s\u0131n\u0131flarda bu \u015fekilde okunmaktad\u0131r.\n#Buraya sadece Recency ve Frequency eklenmesinin sebebi tabloda sadece bu iki parametre yer almaktad\u0131r.\n#Ancak Monetary de eklenebilir.\nseg_map = {\n    r'[1-2][1-2]': 'Hibernating',\n    r'[1-2][3-4]': 'At Risk',\n    r'[1-2]5': 'Can\\'t Loose',\n    r'3[1-2]': 'About to Sleep',\n    r'33': 'Need Attention',\n    r'[3-4][4-5]': 'Loyal Customers',\n    r'41': 'Promising',\n    r'51': 'New Customers',\n    r'[4-5][2-3]': 'Potential Loyalists',\n    r'5[4-5]': 'Champions'\n}","4c5640a8":"#Yukar\u0131da tan\u0131mlanan seg_map'i dataframe tablosuna dahil ediyoruz.\nrfm['Segment'] = rfm['RecencyScore'].astype(str) + rfm['FrequencyScore'].astype(str)\nrfm['Segment'] = rfm['Segment'].replace(seg_map, regex=True)\nrfm.head()","a6845806":"#Segmentlere g\u00f6re groupby yaparak elde edilen 3 parametrenin ortalama ve ka\u00e7 adet oldu\u011funu buluyoruz.\nrfm[[\"Segment\", \"Recency\",\"Frequency\",\"Monetary\"]].groupby(\"Segment\").agg([\"mean\",\"count\"])","450ed946":"#\"Need Attention\" grubunu yakal\u0131yoruz.\nrfm[rfm[\"Segment\"] == \"Need Attention\"].head()","4bac8b37":"#Dikkat gerektiren m\u00fc\u015fterilerin Customer ID (indeks) de\u011ferlerine eri\u015filmi\u015ftir.\n#Yeni m\u00fc\u015fterilere \u00f6zel promosyonlar ve mailler bu ID'ler sayesinde at\u0131labilir.\nrfm[rfm[\"Segment\"] == \"Need Attention\"].index","2c8d8dab":"#Yeni bir dataframe olu\u015fturularak i\u00e7erisine Need Attention grubuna ait m\u00fc\u015fterilerin ID bilgileri at\u0131yoruz.\nnew_df = pd.DataFrame()\nnew_df[\"NewCustomerID\"] = rfm[rfm[\"Segment\"] == \"Need Attention\"].index\nnew_df.head()","1f6d97f3":"#Atanan bu ID'ler csv \u00e7\u0131kt\u0131s\u0131 al\u0131narak kullan\u0131ma haz\u0131r hale getirilmi\u015ftir.\nnew_df.to_csv(\"new_customers.csv\")","42683a36":"rfm[[\"Segment\", \"Recency\",\"Frequency\",\"Monetary\"]].groupby(\"Segment\").agg([\"mean\",\"count\",\"max\"]).head(10)","a2083e66":"# RFM Skorlar\u0131","764047a9":"![image.png](attachment:image.png)","0647f87c":"temiz_df=df[~((df[feature] > upper) | (df[feature] < lower)).any(axis=None)]","eb1fc3f6":"# Recency Hesab\u0131","98d85180":"# Veri \u00d6n \u0130\u015fleme","f4207f8c":"Yorum yaparken Recency de\u011ferinin d\u00fc\u015f\u00fck, Frequency de\u011ferinin y\u00fcksek ve Monetary de\u011ferinin y\u00fcksek olmas\u0131n\u0131 dikkate alaca\u011f\u0131z.\nBuna g\u00f6re se\u00e7ilecek olan 4 grup \u015funlard\u0131r;\n\n- Champions\n- Can't Loose\n- Loyal Customers\n- Need Attention\n\n**Champions**\n\n665 ki\u015fi bulunan bu grupta ortalama olarak en son al\u0131\u015fveri\u015f 4 g\u00fcn \u00f6nce ger\u00e7ekle\u015fmi\u015f,\nal\u0131\u015fveri\u015f s\u0131kl\u0131klar\u0131 15, toplamda 248 al\u0131\u015fveri\u015f var, ort. 6510 dolar\/TL harcamalar\u0131 var.\n\n**Can't Loose**\n\n68 ki\u015fi bulunan bu grupta ortalama olarak en son al\u0131\u015fveri\u015f 132 g\u00fcn \u00f6nce ger\u00e7ekle\u015fmi\u015f,\nal\u0131\u015fveri\u015f s\u0131kl\u0131klar\u0131 10, toplamda 35 al\u0131\u015fveri\u015fleri var, ort. 2381 dolar\/TL harcamalar\u0131 var.\n\n**Loyal Customers**\n\n795 ki\u015fi bulunan bu grupta ortalama olarak en son al\u0131\u015fveri\u015f 31 g\u00fcn \u00f6nce ger\u00e7ekle\u015fmi\u015f,\nal\u0131\u015fveri\u015f s\u0131kl\u0131klar\u0131 8, toplamda 76 al\u0131\u015fveri\u015fleri var, ort. 2703 dolar\/TL harcamalar\u0131 var.\n\n**Need Attention**\n\n190 ki\u015fi bulunan bu grupta ortalama olarak en son al\u0131\u015fveri\u015f 48 g\u00fcn \u00f6nce ger\u00e7ekle\u015fmi\u015f,\nal\u0131\u015fveri\u015f s\u0131kl\u0131klar\u0131 3, toplamda 4 al\u0131\u015fveri\u015fleri var, ort. 790 dolar\/TL harcamalar\u0131 var.\n\n\n_**AKS\u0130YON \u00c7ALI\u015eMALARI**_\n\nChampions grubundaki m\u00fc\u015fteriler b\u00fcy\u00fck ihtimalle toplam gelirin y\u00fcksek bir y\u00fczdesini olu\u015fturmaktad\u0131r. Bu nedenle onlar\u0131 memnun etmeye odaklanmak en b\u00fcy\u00fck \u00f6ncelik olmal\u0131d\u0131r. Tercihlerini daha iyi ara\u015ft\u0131r\u0131p analiz ederek, daha ki\u015fiselle\u015ftirilmi\u015f ve \u00f6zel f\u0131rsatlar olu\u015fturulmal\u0131d\u0131r. \u00dcr\u00fcnleri onlar i\u00e7in \u00f6zelle\u015ftirerek promosyon \u015feklinde g\u00f6ndermek hem onlar\u0131 memnun edeceek hem de \u00fcr\u00fcn\u00fcn tan\u0131t\u0131m\u0131 a\u00e7\u0131s\u0131ndan yararl\u0131 olacakt\u0131r.\n\nCan't Loose grubuna \u00e7ok dikkat ve \u00f6nem verilmelidir. Bu kaybedilmek istenmeyen gruptur. Toplam gelirde hatr\u0131 say\u0131l\u0131r y\u00fczdeye sahiplerdir. Toplu bir \u015fekilde al\u0131\u015fveri\u015f yap\u0131p uzun bir s\u00fcre tekrar al\u0131\u015fveri\u015f yapmamaktad\u0131rlar. Bu gruba \u00f6zel promosyonlar haz\u0131rlanarak firma b\u00fcnyesinde tutulabilirler.\n\nLoyal Customers grubundaki ki\u015filere pop\u00fcler \u00fcr\u00fcnler indirimli olarak \u00f6nerilebilir. Toplam yap\u0131lan al\u0131\u015fveri\u015f say\u0131s\u0131 76'd\u0131r ve olduk\u00e7a y\u00fcksek bir say\u0131d\u0131r.\n\nNeed Attention grubundaki ki\u015filere s\u0131n\u0131rl\u0131 s\u00fcreli teklifler yap\u0131labilir. Bu onlar\u0131 harekete ge\u00e7irerek al\u0131\u015fveri\u015f yapma eylemine itecektir. Ge\u00e7mi\u015f sat\u0131n al\u0131mlar incelenerek tavsiyelerde bulunulmal\u0131d\u0131r. Bu onlar\u0131 yeniden etkin hale getirecektir.","a4434ad8":"*Online Retail II isimli veri seti \u0130ngiltere merkezli online bir sat\u0131\u015f ma\u011fazas\u0131n\u0131n 01\/12\/2009 - 09\/12\/2011 tarihleri aras\u0131ndaki sat\u0131\u015flar\u0131n\u0131 i\u00e7ermektedir. Bu \u015firket hediyelik e\u015fya sat\u0131\u015f\u0131 yapmaktad\u0131r. Promosyon \u00fcr\u00fcnleri gibi d\u00fc\u015f\u00fcnebilir ve m\u00fc\u015fterilerinin \u00e7o\u011fu da toptanc\u0131d\u0131r.*","8721bb3c":"https:\/\/archive.ics.uci.edu\/ml\/datasets\/Online+Retail+II","9ef28746":"# Kutu Grafi\u011fi ile Ayk\u0131r\u0131 G\u00f6zlem Analizi","83b48539":"**DE\u011e\u0130\u015eKENLER**\n\n- **InvoiceNo:** *Fatura numaras\u0131. Her i\u015fleme yani faturaya ait e\u015fsiz numara. E\u011fer bu kod C ile ba\u015fl\u0131yorsa i\u015flemin iptal edildi\u011fini ifade eder.*\n- **StockCode:** *\u00dcr\u00fcn kodu. Her bir \u00fcr\u00fcn i\u00e7in e\u015fsiz numara.*\n- **Description:** *\u00dcr\u00fcn ismi.*\n- **Quantity:** *\u00dcr\u00fcn adedi. Faturalardaki \u00fcr\u00fcnlerden ka\u00e7ar tane sat\u0131ld\u0131\u011f\u0131n\u0131 ifade etmektedir.*\n- **InvoiceDate:** *Fatura tarihi ve zaman\u0131.*\n- **UnitPrice:** *\u00dcr\u00fcn fiyat\u0131.(Sterlin cinsinden)*\n- **CustomerID:** *E\u015fsiz m\u00fc\u015fteri numaras\u0131.*\n- **Country:** *\u00dclke ismi. M\u00fc\u015fterinin ya\u015fad\u0131\u011f\u0131 \u00fclke.*","a8ca272f":"# Frequency Hesab\u0131","f2d40d4f":"# RFM Analizi ","a8f3b908":"*M\u00fc\u015fterilerini segmentlere ay\u0131rmak isteyen bir e-ticaret \u015firketi bu segmentlere g\u00f6re pazarlama stratejileri belirlemek istemektedir. Bunu ger\u00e7ekle\u015ftirebilmek i\u00e7in m\u00fc\u015fterilerin davran\u0131\u015flar\u0131 tan\u0131mlanacak ve olu\u015fan \u00f6beklenmelere g\u00f6re gruplar olu\u015fturulacakt\u0131r. Ortak davran\u0131\u015flar sergileyenler ayn\u0131 gruplarda yer alacak ve bu gruplara \u00f6zel sat\u0131\u015f ve pazarlama teknikleri geli\u015ftirmeye \u00e7al\u0131\u015facakt\u0131r.*","11292331":"*RFM Analizi i\u00e7in gerekli olan parametreler hesapland\u0131ktan sonra yorum yapabilmek i\u00e7in baz\u0131 i\u015flemler yapaca\u011f\u0131z.*","72fa034e":"# RFM Analizi ile M\u00fc\u015fteri Segmentasyonu","200891f9":"RFM ifadesi Recency, Frequency, Monetary ifadelerinin ba\u015f harflerinden olu\u015fur.\nM\u00fc\u015fterilerin sat\u0131n alma al\u0131\u015fkanl\u0131klar\u0131 \u00fczerinden pazarlama ve sat\u0131\u015f stratejileri belirlemeye yard\u0131mc\u0131 olan bir tekniktir.\n\n- Recency (Yenilik): M\u00fc\u015fterinin son sat\u0131n almas\u0131ndan bug\u00fcne kadar ge\u00e7en s\u00fcre\n\nDi\u011fer bir ifadesiyle \u201cM\u00fc\u015fterinin son temas\u0131ndan bug\u00fcne kadar ge\u00e7en s\u00fcre\u201d dir. (Bug\u00fcn\u00fcn tarihi - Son sat\u0131n alma) \u015feklinde bulunur.\nBug\u00fcn\u00fcn tarihi - son \u00fcr\u00fcn sat\u0131n alma tarihi. \u00c7\u0131kan de\u011feri k\u00fc\u00e7\u00fck olmas\u0131 istenir.\n\n- Frequency (S\u0131kl\u0131k): Toplam sat\u0131n alma say\u0131s\u0131.\n\n- Monetary (Parasal De\u011fer): M\u00fc\u015fterinin yapt\u0131\u011f\u0131 toplam harcama.","d874e7a1":"# Yorumlama","f281b43d":"# Monetary Hesab\u0131"}}