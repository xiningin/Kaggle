{"cell_type":{"2d7e1e0f":"code","8f8b0b51":"code","c4336aea":"code","ea3dc37d":"code","f7dece19":"code","4b1bc1af":"code","d651c34b":"markdown","0ebaf498":"markdown","b81fe3e4":"markdown"},"source":{"2d7e1e0f":"from IPython.core.display import display, HTML\n\nimport pandas as pd\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport glob\nimport os\nimport gc\nimport plotly.graph_objects as go\n\nfrom joblib import Parallel, delayed\nfrom sklearn import preprocessing, model_selection\nimport matplotlib.pyplot as plt \nimport seaborn as sns\nfrom tqdm import tqdm\n\n\ndata_dir = '..\/input\/optiver-realized-volatility-prediction\/'","8f8b0b51":"def read_train_test():\n    train = pd.read_csv('..\/input\/optiver-realized-volatility-prediction\/train.csv')\n    # Create a key to merge with book and trade data\n    train['row_id'] = train['stock_id'].astype(str) + '-' + train['time_id'].astype(str)\n    print(f'Our training set has {train.shape[0]} rows')\n    return train\n\ndef trade_preprocessor(file_path):\n    df = pd.read_parquet(file_path)\n    stock_id = file_path.split('=')[1]\n    df['row_id'] = df['time_id'].apply(lambda x:f'{stock_id}-{x}')\n    df = df.drop('time_id',axis=1)\n    return df\n\ndef preprocessor(list_stock_ids, is_train = True):\n    \n    # Parrallel for loop\n    def for_joblib(stock_id):\n        # Train\n        file_path_trade = data_dir + \"trade_train.parquet\/stock_id=\" + str(stock_id)\n        df_tmp = trade_preprocessor(file_path_trade)\n        return df_tmp\n    \n    # Use parallel api to call paralle for loop\n    df = Parallel(n_jobs = -1, verbose = 1)(delayed(for_joblib)(stock_id) for stock_id in list_stock_ids)\n    # Concatenate all the dataframes that return from Parallel\n    df = pd.concat(df, ignore_index = True)\n    return df","c4336aea":"# Read train and test\ntrain = read_train_test()\ntrain_stock_ids = train['stock_id'].unique()\nprint(train_stock_ids) \n\ntrain_ = preprocessor(train_stock_ids, is_train = True)\ntrain = train.merge(train_, on = ['row_id'], how = 'left')","ea3dc37d":"# Calculate the min,max,first,last value for each stock_id and time_id\n_train = train[['stock_id','time_id','price']]\nohlc_df = _train.groupby(['stock_id','time_id']).agg(['min','max','first','last']).reset_index()\nohlc_df","f7dece19":"\nfor stock_id in tqdm(np.unique(ohlc_df['stock_id'])[:2]):\n    df_plot = ohlc_df[ohlc_df['stock_id']==stock_id]['price']\n    time_id_title = ohlc_df[ohlc_df['stock_id']==stock_id]['time_id'] \n    fig = go.Figure()\n    fig.add_trace(go.Candlestick(\n        x = time_id_title, \n        open = df_plot['first'],\n        high = df_plot['max'],\n        low = df_plot['min'],\n        close = df_plot['last']\n    ))\n    fig.update_layout(\n        title = 'stock_id :'+str(stock_id),\n        xaxis_title = 'time_id',\n        yaxis_title = 'price'\n    )\n    fig.show()          \n    ","4b1bc1af":"for stock_id in tqdm(np.unique(ohlc_df['stock_id'])[:2]):\n    df_plot = ohlc_df[ohlc_df['stock_id']==stock_id]['price']\n    time_id_title = ohlc_df[ohlc_df['stock_id']==stock_id]['time_id'] \n    fig = go.Figure()\n    fig.add_trace(go.Ohlc(\n        x = time_id_title, \n        open = df_plot['first'],\n        high = df_plot['max'],\n        low = df_plot['min'],\n        close = df_plot['last']\n    ))\n    fig.update_layout(\n        title = 'stock_id :'+str(stock_id),\n        xaxis_title = 'time_id',\n        yaxis_title = 'price'\n    )\n    fig.show()          \n    ","d651c34b":"## OHLC Charts","0ebaf498":"## This Notebook\n\nIn this Notebook, we will draw and summarize CandleStick Charts and OHLC Charts from the data in train_trade.parquet.\n\nFor trade data, it is possible to obtain not only the minimum and maximum values at each time_id, but also the opening and closing prices. And by drawing a diagram from these four values, we can pattern the price movement at that time_id.\n\n\nI have also posted on DISCUSSION about using these charts, so I would appreciate if you could comment on that as well.\n\n[How about using a candlestick charts and OHLC charts?](https:\/\/www.kaggle.com\/c\/optiver-realized-volatility-prediction\/discussion\/270276)","b81fe3e4":"## CandleStick Charts"}}