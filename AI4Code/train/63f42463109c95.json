{"cell_type":{"2bdf757a":"code","e8fe4baf":"code","74201118":"code","f19f75a8":"code","7f608e89":"code","f9e4705d":"code","a9b5201e":"code","74cc1fca":"code","89ed7f21":"code","52b4b120":"code","f0930799":"code","58376e13":"code","31f356aa":"code","e47b7850":"code","ddb0105a":"code","c5bfcb23":"code","d325803c":"code","ca4f03ab":"markdown","beeab925":"markdown","88a46d3b":"markdown","a6d2cf99":"markdown","04cceaab":"markdown","c77418f0":"markdown","e6d79225":"markdown","9af551da":"markdown"},"source":{"2bdf757a":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\n\nimport os\nos.environ['TF_CPP_MIN_LOG_LEVEL'] = '2' \n\nfrom tensorflow import keras\nimport tensorflow as tf","e8fe4baf":"from sklearn.preprocessing import RobustScaler\nrb = RobustScaler()","74201118":"train = pd.read_csv('..\/input\/ventilator-pressure-prediction\/train.csv')\ntest = pd.read_csv('..\/input\/ventilator-pressure-prediction\/test.csv')","f19f75a8":"def plot_double_bid(bid):\n    fig = plt.figure(figsize = (12, 4))\n    ax1 = fig.add_subplot(1, 2, 1)\n    ax2 = fig.add_subplot(1, 2, 2)\n\n    tmp = train.loc[train['breath_id'] == bid]\n\n    R = tmp['R'].reset_index(drop=True)[0]\n    C = tmp['C'].reset_index(drop=True)[0]\n    ax1.set_title(f'bread_id:{bid}, R:{R}, C:{C}')\n    ax1.set_ylabel('Timestep')\n    ax1.set_xlabel('Row No.')\n\n    ax1.plot(train.loc[train['breath_id'] == bid]['time_step'].tolist())\n    \n    ax3 = ax2.twinx()\n\n    ax2.plot(tmp['time_step'], tmp['pressure'], 'r-', label='pressure')\n    ax2.plot(tmp['time_step'], tmp['u_in'], 'g-', label='u_in')\n    ax3.plot(tmp['time_step'], tmp['u_out'], 'b-', label='u_out')\n\n    ax2.set_xlabel('Timestep')\n    \n    R = tmp['R'].reset_index(drop=True)[0]\n    C = tmp['C'].reset_index(drop=True)[0]\n    ax2.set_title(f'bread_id:{bid}, R:{R}, C:{C}')\n\n    ax2.legend(loc=(1.1, 0.8))\n    ax3.legend(loc=(1.1, 0.7))\n    \n    fig.tight_layout()\n    plt.show()\n\nplot_double_bid(28942)\nplot_double_bid(2)\nplot_double_bid(32900)","7f608e89":"train['u_in_lag'] = train.groupby('breath_id')['u_in'].shift(1)\ntrain['u_out_lag'] = train.groupby('breath_id')['u_out'].shift(1)\ntrain['u_in_lag_2'] = train.groupby('breath_id')['u_in'].shift(2)\ntrain['u_out_lag_2'] = train.groupby('breath_id')['u_out'].shift(2)\ntrain['u_in_diff'] = train['u_in'] - train['u_in_lag']\ntrain['u_in_diff_2'] = train['u_in'] - train['u_in_lag_2']\ntrain['u_in_cumsum'] = train['u_in'].groupby(train['breath_id']).cumsum()\ntrain['R*C'] = train['R'] * train['C']\ntrain['RC_sum'] = train['R'] + train['C']\ntrain['RC_div'] = train['R'] \/ train['C']\ntrain['R'] = train['R'].astype(str)\ntrain['C'] = train['C'].astype(str)\ntrain = pd.get_dummies(train)\n\ntest['u_in_lag'] = test.groupby('breath_id')['u_in'].shift(1)\ntest['u_out_lag'] = test.groupby('breath_id')['u_out'].shift(1)\ntest['u_in_lag_2'] = test.groupby('breath_id')['u_in'].shift(2)\ntest['u_out_lag_2'] = test.groupby('breath_id')['u_out'].shift(2)\ntest['u_in_diff'] = test['u_in'] - test['u_in_lag']\ntest['u_in_diff_2'] = test['u_in'] - test['u_in_lag_2']\ntest['u_in_cumsum'] = test['u_in'].groupby(test['breath_id']).cumsum()\ntest['R*C'] = test['R'] * test['C']\ntest['RC_sum'] = test['R'] + test['C']\ntest['RC_div'] = test['R'] \/ test['C']\ntest['R'] = test['R'].astype(str)\ntest['C'] = test['C'].astype(str)\ntest = pd.get_dummies(test)\n\ntrain = train.fillna(0)\ntest = test.fillna(0)","f9e4705d":"train","a9b5201e":"train.columns","74cc1fca":"targets = train['pressure'].to_numpy().reshape(-1, 80)\ntest_id = test['id']\ntrain.drop(columns = ['id','breath_id','pressure'], inplace = True)\ntest.drop(columns = ['id','breath_id'], inplace = True)","89ed7f21":"rb.fit(train)\n\ntrain_new = rb.transform(train)\ntest_new = rb.transform(test)\n\ntrain_re = train_new.reshape(-1, 80, 19)\ntest_re = test_new.reshape(-1, 80, 19)","52b4b120":"print(train_re.shape,targets.shape)","f0930799":"opt = tf.keras.optimizers.Adam(learning_rate = 0.002)","58376e13":"def build_model():\n    model = tf.keras.models.Sequential()\n    model.add(tf.keras.layers.Bidirectional(tf.keras.layers.LSTM(128, return_sequences=True), input_shape=(80, 19)))\n\n    model.add(tf.keras.layers.Bidirectional(tf.keras.layers.LSTM(64, return_sequences=True)))\n    model.add(tf.keras.layers.Dropout(0.2))\n\n    model.add(tf.keras.layers.Dense(32, activation='selu', kernel_initializer='uniform'))\n    model.add(tf.keras.layers.Dense(1))\n    \n    model.compile(optimizer = opt, loss = 'mae', metrics=['mae'])\n\n    model.summary()\n    \n    return model\n\n#model = tf.keras.models.load_model('')\nmodel = build_model()","31f356aa":"call_back = tf.keras.callbacks.ModelCheckpoint(\"ModelLSTM.h5\", monitor='val_loss', save_best_only=True)\nhistory = model.fit(train_re, targets, callbacks=[call_back], batch_size = 64, epochs = 300, validation_split = 0.2, verbose = 1)","e47b7850":"def show_graph(history):\n    plt.plot(history.history['mae'])\n    plt.plot(history.history['val_mae'])\n    plt.title('model mae')\n    plt.ylabel('loss')\n    plt.xlabel('epoch')\n    plt.legend(['train', 'test'], loc='upper right')\n    plt.show()\n    \nshow_graph(history)","ddb0105a":"model.evaluate(train_re,targets)","c5bfcb23":"pred = model.predict(test_re)\npred = pred.reshape(-1,1)","d325803c":"def write_prediction(prediction,test_id):\n    PassengerId = np.array(test_id).astype(int)\n    solution = pd.DataFrame(prediction, PassengerId, columns = ['pressure'])\n    solution.to_csv('.\/submission.csv', index_label = ['id'])\n    \nwrite_prediction(pred,test_id)","ca4f03ab":"**Featured Engneering**","beeab925":"**Model Building**","88a46d3b":"**Data Analysis & Featured Engneering**","a6d2cf99":"**Model Evaluation**","04cceaab":"**Model Training**","c77418f0":"**Model Prediction**","e6d79225":"**Scaling Data using RobustScaler**","9af551da":"**Droping Unwanted Column**"}}