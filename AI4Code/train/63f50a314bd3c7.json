{"cell_type":{"9ea8e6ec":"code","3c4392c2":"code","d563afce":"code","0983e841":"code","e7c67b8d":"code","dc87614b":"code","bf43fd9c":"code","8280d551":"code","aef10cd2":"code","545c62c5":"code","d6ac8782":"code","b7958f2b":"code","87e30ba1":"code","09b23f92":"code","7838b4fc":"code","4340b889":"markdown","5f69c49c":"markdown","c9c593b8":"markdown","066d3c94":"markdown","c807fec1":"markdown","047b2ec7":"markdown","5e537082":"markdown","8e7bf8fa":"markdown","8d463a07":"markdown","1d48a55e":"markdown","bd4514d1":"markdown","1f0d383c":"markdown","81eed784":"markdown","ce6cdbee":"markdown","2df305a6":"markdown","6de1a032":"markdown","ab532b3a":"markdown","31dec186":"markdown","ebc7b15c":"markdown","475b1e47":"markdown","f16bdf19":"markdown","77ff59fd":"markdown","c321e017":"markdown"},"source":{"9ea8e6ec":"!pip install prince\n!pip install adjustText","3c4392c2":"# Web scraping da p\u00e1gina c\u00e2mara\nimport requests\nfrom bs4 import BeautifulSoup\nfrom collections import defaultdict\n\n# Manipula\u00e7\u00e3o de dados\nimport numpy as np\nimport pandas as pd\n\n# An\u00e1lise de correspond\u00eancia e estat\u00edstica chi2\nimport prince\nimport scipy.stats as stats \n\n# Visualiza\u00e7\u00e3o de dados\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom adjustText import adjust_text # similar ao ggrepel do R","d563afce":"# Adquirindo os dados via web scraping\nurl = 'https:\/\/www.camara.leg.br\/presenca-comissoes\/votacao-portal?reuniao=62583'\n\nr = requests.get(url)\nsoup = BeautifulSoup(r.content, 'html.parser')\nr.close()\n\ntable = soup.find('div', attrs={'class':'partidosContainer'})\ntable_items = table.find_all('li')\n\ntable_dict = defaultdict(list)\nfor li in table_items:\n    span_items = li.find_all('span')\n    table_dict['nome'].append(span_items[0].text)\n    partido, uf = span_items[1].text.strip('(|)').split('-')\n    table_dict['partido'].append(partido)\n    table_dict['uf'].append(uf)\n    try:\n        table_dict['voto'].append(span_items[2].find('span').text)\n    except:\n        table_dict['voto'].append('N\/A')\n\ndf = pd.DataFrame(table_dict)\ndf.set_index('nome', inplace=True)\n\n# Adquirindo os dados via API\n# r = requests.get('https:\/\/dadosabertos.camara.leg.br\/api\/v2\/votacoes\/2279513-37\/votos')\n# rdata = r.json()\n# r.close()\n# \n# pd_dict = defaultdict(list)\n# for i,dados in enumerate(rdata['dados']):\n#     pd_dict['nome'].append(dados['deputado_']['nome'])\n#     pd_dict['uf'].append(dados['deputado_']['siglaUf'])\n#     pd_dict['partido'].append(dados['deputado_']['siglaPartido'])\n#     pd_dict['voto'].append(dados['tipoVoto'])\n#     \n# df = pd.DataFrame(pd_dict).set_index('nome')","0983e841":"display(df)","e7c67b8d":"display(df.describe())\nprint('\\033[1;33mPartidos:\\033[m', df.partido.unique())\nprint('\\033[1;33mEstados:\\033[m', df.uf.unique())\nprint('\\033[1;33mTipos de votos:\\033[m', df.voto.unique())","dc87614b":"df['partido'] = df.partido.replace({'Republican':'Republicano', 'Solidaried':'Solidariedade'})\ndf.voto.value_counts()","bf43fd9c":"df = df[df.voto != \"Art. 17\"]","8280d551":"tbl_contigencia = pd.crosstab(df.partido, df.voto)\ndisplay(tbl_contigencia.head())","aef10cd2":"chi2, pvalor, graus_liberdade, valores_esperados = stats.chi2_contingency(tbl_contigencia)\nprint(f'chi2 = {chi2:.2f} e p-valor = {pvalor:}')","545c62c5":"# Num. de dimens\u00f5es\nndim = (np.array(tbl_contigencia.shape) - 1).min()\n# Criando o modelo ANACOR\nca = prince.CA(n_components=ndim)\nca.fit(tbl_contigencia);","d6ac8782":"ca.plot_coordinates(tbl_contigencia, figsize=(12, 8))\nplt.show()","b7958f2b":"# Definir um layout para os gr\u00e1ficos\nsns.set_theme(\n    context='talk', style='ticks', palette='husl', font_scale=1.2,\n    rc={'font.weight':'regular', 'axes.labelpad':15, 'axes.titlepad':30}\n)\n\n# Definir um gr\u00e1fico customizado\ndef plot_ca(model, ct, ax, title):\n    rc = model.row_coordinates(ct)\n    x,y = rc[0],rc[1]\n\n    ax.plot(x, y, 'o', markersize=20, alpha=.9, label=tbl_contigencia.index.name.title())\n\n    texts1 = [ax.text(x[i], y[i], rc.index[i], fontsize='medium') for i in range(len(x))]\n    #adjust_text(texts1, arrowprops=dict(arrowstyle='-', color='black'))\n\n    cc = ca.column_coordinates(tbl_contigencia)\n    x,y = cc[0],cc[1]\n\n    ax.plot(x, y, '*', markersize=35, label=tbl_contigencia.columns.name.title())\n    texts2 = [\n        ax.text(x[i], y[i], cc.index[i], fontsize='large', fontweight='bold',\n                 #fontsize='medium', #fontfamily='Ubuntu',\n                 color='#baa01f', fontstretch=1000)\n        for i in range(len(x))\n    ]\n\n    adjust_text(texts1+texts2)\n    ei = ca.explained_inertia_\n\n    ax.set_title(title, fontsize=24, fontweight=1000, loc='center')\n    ax.set_xlabel('Componente {} ({:.2f}% in\u00e9rcia)'.format(1, 100 * ei[0]), fontsize='small')\n    ax.set_ylabel('Componente {} ({:.2f}% in\u00e9rcia)'.format(2, 100 * ei[1]), fontsize='small')\n    ax.grid()\n    ax.legend()\n    return ax","87e30ba1":"fig,ax = plt.subplots(figsize=(16,10))\nplot_ca(ca, tbl_contigencia, ax, title='An\u00e1lise de correspond\u00eancia partidos e seus respectivos votos na c\u00e2mara');","09b23f92":"fig, (ax1,ax2) = plt.subplots(1, 2, gridspec_kw={'width_ratios': [3, 1]}, figsize=(18,10))\n\nax1 = plt.subplot(1,2,1)\nplot_ca(ca, tbl_contigencia, ax1, title='ANACOR: Partidos vs Votos (PEC 135\/2019)')\n\nax2 = plt.subplot(1,2,2)\nsns.countplot(y='partido', data=df, palette='viridis', order=sorted(df.partido.unique()), ax=ax2)\nax2.set_ylabel(None)\nax2.set_xlabel('N. de votos por partido', fontsize='x-small')\nax2.grid(alpha=0.4)\n\nfig.tight_layout()\nplt.show()","7838b4fc":"_, uf_partido_pvalor, _, _ = stats.chi2_contingency(pd.crosstab(df.uf, df.partido))\n_, uf_voto_pvalor, _, _ = stats.chi2_contingency(pd.crosstab(df.uf, df.voto))\n\nprint(f\"\"\"\np-valor entre UF - Partido: {uf_partido_pvalor:.4f}\np-valor entre UF - Voto: {uf_voto_pvalor:.4f}\n\"\"\")","4340b889":"# An\u00e1lise de correspond\u00eancia simples (ANACOR) e m\u00faltipla (ACM)","5f69c49c":"Agora podemos criar a nossa tabela de contig\u00eancia, que ser\u00e1 o input do nosso modelo:","c9c593b8":"**Se foi \u00fatil, considere dar um upvote =)**\n\n---\nEspero que tenham aproveitado a leitura! Fico \u00e0 disposi\u00e7\u00e3o para sugest\u00f5es e cr\u00edticas\/corre\u00e7\u00f5es.  \nSintam-se livres para me adicionar no [LinkedIn](https:\/\/www.linkedin.com\/in\/cmcouto-silva\/).","066d3c94":"Agora, ser\u00e1 que temos uma superrepresenta\u00e7\u00e3o de algum partido?\nVamos plotar novamente o gr\u00e1fico acima, em conjunto com o total de valores (com \"Sim\", \"N\u00e3o\" ou \"N\/A\") por partido.","c807fec1":"### **An\u00e1lise de correla\u00e7\u00e3o simples (Anacor)**","047b2ec7":"### **E a an\u00e1lise de correspond\u00eancia m\u00faltipla (ACM)?**  \n\nAfinal das contas, temos UF tamb\u00e9m no conjunto de dados.\n\nAssim como a Anacor, tamb\u00e9m \u00e9 importante verificar se h\u00e1 relev\u00e2ncia estat\u00edstica para prosseguir com a an\u00e1lise (coisa que, por sinal, se aplica a muitos modelos de machine learning).  \nSabemos que h\u00e1 relev\u00e2ncia entre Partido vs Voto. Vamos verificar agora a rela\u00e7\u00e3o destes com UF.","5e537082":"Observa-se uma representa\u00e7\u00e3o elevada dos partidos PT e PSL, seguido por PL e PP.  \nEstes partidos, caso os votos n\u00e3o sejam normalizados pelo tamanho do partido (acredito que n\u00e3o \u00e9), podem desempenhar um papel mais relevante nos seus respectivos votos que os demais.","8e7bf8fa":"## **Conclus\u00e3o**\n\n- A an\u00e1lise de correspond\u00eancia simples (anacor) e m\u00faltipla (acm) propicou com sucesso insights da associa\u00e7\u00e3o entre categorias de forma visual.\n- Na an\u00e1lise aqui realizada, pode-se observar claramente quais partidos est\u00e3o mais associados com os votos \"Sim\" e \"N\u00e3o\".","8d463a07":"Aparantemente, pode-se observar que alguns partidos est\u00e3o com os nomes incompletos (e.g. Republicano e Solidariedade), e que h\u00e1 um \"Art. 17\" como op\u00e7\u00e3o de voto.  \nVamos renomear estes partidos e verificar quantas vezes aparecem \"Art. 17\" e as demais op\u00e7\u00f5es de votos.","1d48a55e":"Ok, daqui j\u00e1 podemos tirar algumas conclus\u00f5es, mas antes disso, vamos criar uma fun\u00e7\u00e3o semelhante ao m\u00e9todo `plot_coordinates`, por\u00e9m ajustando as legendas para melhor visualiza\u00e7\u00e3o das categorias.  \nAdicionalmente, vamos mudar o layout dos gr\u00e1ficos.","bd4514d1":"Ok, estamos prontos para prosseguirmos com a anacor. Ou n\u00e3o!?\n\nNa verdade, antes de prosseguirmos, precisamos nos certificar de que h\u00e1 respaldo estat\u00edstico para prosseguirmos com a an\u00e1lise, e conseguimos isso atrav\u00e9s do teste do $\\chi^2$ (qui-quadrado).","1f0d383c":"\"Art. 17\" aparece apenas uma vez. Vamos remov\u00ea-lo, uma vez que n\u00e3o faz sentido para nossa an\u00e1lise.","81eed784":"As an\u00e1lises de correspond\u00eancia simples (ANACOR) ou m\u00faltipla (ACM) s\u00e3o t\u00e9cnicas de machine learning n\u00e3o supervionadas que verificam a **associa\u00e7\u00e3o entre categorias de vari\u00e1veis qualitativas**, sem recorrer \u00e0 pondera\u00e7\u00e3o arbitr\u00e1ria. Apesar do seu potencial, estas t\u00e9cnicas s\u00e3o pouco utilizadas, de modo que o objetivo deste notebook \u00e9 mostrar sua utiliza\u00e7\u00e3o utilizando Python.\n\nAssim como PCA, ANACOR e ACM s\u00e3o t\u00e9cnicas de [redu\u00e7\u00e3o de dimensionalidade](https:\/\/en.wikipedia.org\/wiki\/Dimensionality_reduction). Partindo-se de um [tabela de conting\u00eancia](https:\/\/pt.wikipedia.org\/wiki\/Tabela_de_conting%C3%AAncia) (que no caso da ACM se apresenta como matriz bin\u00e1ria), a t\u00e9cnica realiza transforma\u00e7\u00f5es lineares que levam em considera\u00e7\u00e3o a correspond\u00eacia entre linhas e colunas da matriz de dados. Como resultando obtemos um **mapa conceptual**, que nada mais \u00e9 que uma apresenta\u00e7\u00e3o visual das linhas e colunas da tabela de contig\u00eancia cujos pontos representam as categorias nas respectivas dimens\u00f5es.\n\nPara realizar este teste, utilizei os dados da c\u00e2mara dos deputados referente \u00e0 vota\u00e7\u00e3o para **retirada** da pauta proposta pela [PEC 135\/2019](https:\/\/www.camara.leg.br\/propostas-legislativas\/2220292), que estabelece a obrigatoriedade da expedi\u00e7\u00e3o de c\u00e9dulas f\u00edsicas confer\u00edveis pelo eleitor (voto impresso).","ce6cdbee":"Overview dos dados (primeiras e \u00faltimas linhas), e quantidade de linhas e colunas:","2df305a6":"Bom, se adotarmos um intervalo de confian\u00e7a de 95% (*i.e.* n\u00edvel de signific\u00e2ncia de 5%), podemos considerar que p-valores abaixo de 0.05 rejeitam a hip\u00f3tese nula do teste do $\\chi^2$, que alega que as associa\u00e7\u00f5es da tabela de contig\u00eancia se d\u00e1 de maneira aleat\u00f3ria. Podemos ver acima que o valor foi absurdamente menor, ou seja, podemos prosseguir com a an\u00e1lise! \n\nPara prosseguir com a an\u00e1lise, faremos proveito das fun\u00e7\u00f5es j\u00e1 implementadas no pacote [`prince`](). O n\u00famero de componentes (dimens\u00f5es) sugeridos consiste no menor valor entre o n\u00famero de linhas e colunas -1:  \n$min(I-1,J-1)$ (I=linhas e J=colunas).","6de1a032":"E agora podemos fazer o web scraping da p\u00e1gina.","ab532b3a":"# Web scraping da p\u00e1gina da c\u00e2mara\n\nA primeira abordagem que fiz foi um web scraping [desta p\u00e1gina da c\u00e2mara dos deputados](https:\/\/www.camara.leg.br\/presenca-comissoes\/votacao-portal?reuniao=62583&itemVotacao=9959) contendo os votos totais, bem como de cada deputado. Ap\u00f3s fazer este procedimento e an\u00e1lises iniciais, encontrei o ID destas vota\u00e7\u00f5es ('2279513-37') e percebi que \u00e9 poss\u00edvel utilizar a [REST API](https:\/\/dadosabertos.camara.leg.br\/swagger\/api.html) da c\u00e2mara para puxar estes mesmos dados. A \u00fanica diferen\u00e7a \u00e9 que pela API, os votos nulos (vazios) das tabelas n\u00e3o aparecem.\n\n\nA contagem dos votos aqui est\u00e1 um pouco diferente da contagem das m\u00eddias sociais (por exemplo, [CNN](https:\/\/www.cnnbrasil.com.br\/politica\/2021\/08\/10\/veja-como-votou-cada-deputado-na-pec-do-voto-impresso)), embora est\u00e1 batendo perfeitamente com a [p\u00e1gina da c\u00e2mara](https:\/\/www.camara.leg.br\/presenca-comissoes\/votacao-portal?reuniao=62583&itemVotacao=9959) onde foi feito o web scraping. Particularmente, n\u00e3o sei o motivo disso (se algu\u00e9m souber, por favor me avise), mas como este notebook \u00e9 para mostrar a utiliza\u00e7\u00e3o do algotimo ANACOR, prossegui com este conjunto de dados.\n\nN\u00e3o vou entrar em detalhes do c\u00f3digo para web scraping, mas deixo disponibilizado o c\u00f3digo tanto para o web scraping quanto para aquisi\u00e7\u00e3o via API (comentado). ","31dec186":"Legal! \u00c9 poss\u00edvel observar nitidamente uma separa\u00e7\u00e3o no primeiro componente (eixo x), com 7 partidos claramente relacionados com o voto \"Sim\" (que neste caso, consiste em um voto para impedir o prosseguimento do decreto que legitima voto impresso no Brasil), e os demais mais relacionados com o voto n\u00e3o, mais ou menos distantes entre si.\n\nO eixo y pode estar representando a rela\u00e7\u00e3o das categorias com valores nulos, contudo, apenas 10% da in\u00e9rcia \u00e9 explicada neste eixo.","ebc7b15c":"N\u00e3o h\u00e1 correspond\u00eancia do ponto de vista estat\u00edstico entre UF e as demais vari\u00e1veis, de forma que n\u00e3o \u00e9 adequado prosseguir com esta an\u00e1lise multivariada, uma vez que h\u00e1 rela\u00e7\u00e3o apenas entre duas vari\u00e1veis e podemos realizar a ANACOR, uma an\u00e1lise bivariada.\n\nCaso queiram testar a ACM em outros conjuntos de dados (ou mesmo neste), este modelo tamb\u00e9m est\u00e1 implementado na biblioteca [`prince`](). ","475b1e47":"Podemos acessar inst\u00e2ncias do objeto `ca` para obter informa\u00e7\u00f5es e resultados do modelo aplicado aos nossos dados, como massa das linhas e colunas (`ca.row_masses_` e `ca.col_masses_`, respectivamente), autovalores (`ca.eigenvalues_`), in\u00e9rcia total (`total_inertia_`), in\u00e9rcia explicada (`ca.explained_inertia_`).\n\nAs massas das linhas e colunas s\u00e3o medidas de influ\u00eancia de determinada categoria em rela\u00e7\u00e3o \u00e0s demais. A in\u00e9rcia total corresponde ao total de vari\u00e2ncia dos scores fatoriais, que por sua vez \u00e9 proporcional ao valor do $\\chi^2$ divido pelo n\u00famero de amostras. Os valores da in\u00e9rcia explicada, portanto, mostra a propor\u00e7\u00e3o da in\u00e9rcia total explicada por cada componente criado pela an\u00e1lise.\n\nVamos plotar as coordenadas das categorias utilizando o m\u00e9todo `plot_coordinates`:","f16bdf19":"## Limpeza e corre\u00e7\u00e3o dos dados","77ff59fd":"Vamos verificar algumas estat\u00edsticas descritivas destes dados categ\u00f3ricos:","c321e017":"Primeiramente, vamos carregar as bibliotecas necess\u00e1rias:"}}