{"cell_type":{"49fbd4d7":"code","0afbb1e9":"code","baa6b1f3":"code","25c6b2d3":"code","1e21a708":"code","8be21dc7":"code","53b5a1ab":"code","b1938390":"code","2887596f":"code","3499656b":"code","c53843ee":"code","701d2134":"code","0849a9db":"code","d1ef46dd":"code","42042d02":"code","1499f6f7":"code","8fc47621":"code","31a128b5":"code","2df47a43":"code","ee12f652":"code","515d22df":"code","f2cf2cfe":"code","53806817":"code","b7e81ff9":"code","f4611467":"code","9d42c823":"code","e1f7b06d":"markdown","d1aca59e":"markdown","c9ab27bc":"markdown","593da879":"markdown","dfcb75bc":"markdown","172aa544":"markdown","aabc9d67":"markdown","227d539f":"markdown","ff5aeea0":"markdown","6a48f130":"markdown","fe3bc7a1":"markdown","f5b92b47":"markdown","1ba7bf13":"markdown","5aaf7f89":"markdown","dcee9c2d":"markdown","aaa7ae79":"markdown","136f72c8":"markdown","3e6d1bc1":"markdown","b6f08fe5":"markdown","78d0804f":"markdown","a4ff8d0e":"markdown"},"source":{"49fbd4d7":"!pip install pyvis\n\n#package imports\nimport numpy as np \nimport matplotlib.pyplot as plt \nimport pandas as pd \nimport os\nimport datetime\nimport cufflinks as cf\nimport plotly.offline as py\nimport plotly.graph_objs as go\nimport plotly.express as px\nimport geopandas as gpd\nimport pyvis\nfrom pyvis.network import Network\ncf.go_offline()\ncf.set_config_file(offline=False, world_readable=True)","0afbb1e9":"#load in data from Data NSW\nnswdata = pd.read_csv('https:\/\/data.nsw.gov.au\/data\/dataset\/aefcde60-3b0c-4bc0-9af1-6fe652944ec2\/resource\/21304414-1ff1-4243-a5d2-f52778048b29\/download\/covid-19-cases-by-notification-date-and-postcode-local-health-district-and-local-government-area.csv')\nnswages = pd.read_csv('https:\/\/data.nsw.gov.au\/data\/dataset\/3dc5dc39-40b4-4ee9-8ec6-2d862a916dcf\/resource\/24b34cb5-8b01-4008-9d93-d14cf5518aec\/download\/covid-19-cases-by-notification-date-and-age-range.csv')\nnswfactors = pd.read_csv('https:\/\/data.nsw.gov.au\/data\/dataset\/c647a815-5eb7-4df6-8c88-f9c537a4f21e\/resource\/2f1ba0f3-8c21-4a86-acaf-444be4401a6d\/download\/covid-19-cases-by-notification-date-and-likely-source-of-infection.csv')\nausmapinfo = pd.read_csv('https:\/\/raw.githubusercontent.com\/matthewproctor\/australianpostcodes\/master\/australian_postcodes.csv')\n\n#amend duplicate postcodes and combine with data\nausmapinfo = ausmapinfo.groupby('postcode').agg({\n                             'locality': ' | '.join, \n                             'long':'first',\n                             'lat':'first'}).reset_index()\nnswmaster = pd.merge(nswdata, ausmapinfo, on='postcode', how='left')","baa6b1f3":"#summarise by cases over time\nsummarised_cases = nswmaster.groupby('notification_date').agg({'notification_date':'count'}).rename(columns={'notification_date':'Count'}).reset_index()\nsummarised_cases = summarised_cases.sort_values(by=['notification_date'], ascending=False)\nsummarised_cases[['notification_date','Count']].head(1).style","25c6b2d3":"#New cases by day in NSW over time\nfig = px.bar(summarised_cases, x=\"notification_date\", y=\"Count\", title='New cases by day in NSW over time')\nfig.update_layout(xaxis_title=\"Date\", yaxis_title=\"Count\")\nfig.show()","1e21a708":"summarised_cases['cumulative']=summarised_cases.loc[::-1, 'Count'].cumsum()[::-1]\nsummarised_cases[['notification_date','cumulative']].head(1).style","8be21dc7":"fig = px.line(summarised_cases, x=\"notification_date\", y=\"cumulative\", title='Cumulative cases in NSW over time')\nfig.update_layout(xaxis_title=\"Date\", yaxis_title=\"Count\")\nfig.show()","53b5a1ab":"summarised_cases['Rate of Change']=summarised_cases['cumulative'].pct_change()*-100\nsummarised_cases = summarised_cases.dropna()\nsummarised_cases[['notification_date','Rate of Change']].head(1).style","b1938390":"fig = px.line(summarised_cases, x=\"notification_date\", y=\"Rate of Change\", title='Rate of change of new cases by day in NSW over time')\nfig.update_layout(xaxis_title=\"Date\", yaxis_title=\"Rate\")\nfig.show()","2887596f":"#summarise by suburbs\n\nsummarised_suburb = nswmaster.groupby('locality').agg({'locality':'count','lga_name19':'first'}).rename(columns={'locality':'Count'}).reset_index()\nsummarised_suburb = summarised_suburb.sort_values(by=['Count'], ascending=False)\nsummarised_suburb = summarised_suburb.replace('BEN BUCKLER','BONDI\/BEN BUCKLER')\nsummarised_suburb_histogram = summarised_suburb.head(20)\n\ndata  = go.Data([\n            go.Bar(\n              y = summarised_suburb_histogram.Count,\n              x = summarised_suburb_histogram.locality,\n              orientation='v',\n        )])\nlayout = go.Layout(\n        title = \"NSW Coronavirus Cases By 20 Most Affected Suburbs\"\n)\n","3499656b":"fig = go.Figure(data=data, layout=layout)\npy.iplot(fig)","c53843ee":"summarised_locals = nswmaster.groupby('lhd_2010_name').agg({'lhd_2010_name':'count'}).rename(columns={'lhd_2010_name':'Count'}).reset_index()\nsummarised_locals = summarised_locals.sort_values(by=['Count'], ascending=False)\n\ndata  = go.Data([\n            go.Bar(\n              y = summarised_locals.Count,\n              x = summarised_locals.lhd_2010_name,\n              orientation='v'\n        )])\nlayout = go.Layout(\n        title = \"NSW Coronavirus Cases By Region\"\n)\nfig  = go.Figure(data=data, layout=layout)\npy.iplot(fig)","701d2134":"#Prepare Sydney Metro Cases\nnswmastermap = nswmaster[nswmaster.long != 0.000000]\nnswmastermap = nswmastermap[nswmastermap['postcode'].between(2000, 2234)]\nnswmastermap = nswmastermap.groupby('lga_name19').agg({'lga_name19':'count','long':'first','lat':'first'}).rename(columns={'lga_name19':'Count'}).reset_index()","0849a9db":"#Map Sydney Metro Cases\nfig = px.scatter_mapbox(nswmastermap, lat=\"lat\", lon=\"long\", hover_name=\"lga_name19\", hover_data=[\"Count\"],\n                        color_discrete_sequence=[\"red\"], zoom=9, height=500, size=\"Count\",size_max=25)\nfig.update_layout(mapbox_style=\"stamen-terrain\")\nfig.update_layout(margin={\"r\":0,\"t\":0,\"l\":0,\"b\":0})\nfig.show()","d1ef46dd":"nswmastermap = nswmaster[nswmaster.long != 0.000000]\nnswmastermap = nswmastermap[nswmastermap['postcode'].between(2000, 2234)]\nnswmastermap = nswmastermap.groupby('locality').agg({'locality':'count','long':'first','lat':'first'}).rename(columns={'locality':'Count'}).reset_index()\n\n#Map Sydney Suburbs\nfig = px.scatter_mapbox(nswmastermap, lat=\"lat\", lon=\"long\", hover_name=\"locality\", hover_data=[\"Count\"],\n                        color_discrete_sequence=[\"red\"], zoom=9, height=500, size=\"Count\",size_max=25)\nfig.update_layout(mapbox_style=\"stamen-terrain\")\nfig.update_layout(margin={\"r\":0,\"t\":0,\"l\":0,\"b\":0})\nfig.show()","42042d02":"sydneycases = nswmaster[nswmaster.long != 0.000000]\nsydneycases = sydneycases[sydneycases['postcode'].between(2000, 2234)]\nsydneycases = sydneycases.groupby('lhd_2010_name').agg({'lhd_2010_name':'count'}).rename(columns={'lhd_2010_name':'Count'}).reset_index()\nsydneycases = sydneycases.sort_values(by=['Count'], ascending=False)\n\ndata  = go.Data([\n            go.Bar(\n              y = sydneycases.Count,\n              x = sydneycases.lhd_2010_name,\n              orientation='v'\n        )])\nlayout = go.Layout(\n        title = \"Sydney Cases By Region\"\n)\nfig  = go.Figure(data=data, layout=layout)\npy.iplot(fig)","1499f6f7":"sydneycasessub = nswmaster[nswmaster.long != 0.000000]\nsydneycasessub = sydneycasessub[sydneycasessub['postcode'].between(2000, 2234)]\nsydneycasessub = sydneycasessub.groupby('locality').agg({'locality':'count','lga_name19':'first'}).rename(columns={'locality':'Count'}).reset_index()\nsydneycasessub = sydneycasessub.sort_values(by=['Count'], ascending=False)\nsydneycasessub = sydneycasessub.replace('BEN BUCKLER','BONDI\/BEN BUCKLER')\nsydneycasessub_histogram = sydneycasessub.head(20)\n\ndata  = go.Data([\n            go.Bar(\n              y = sydneycasessub_histogram.Count,\n              x = sydneycasessub_histogram.locality,\n              orientation='v',\n        )])\nlayout = go.Layout(\n        title = \"Sydney Coronavirus Cases By 20 Most Affected Suburbs\"\n)\nfig  = go.Figure(data=data, layout=layout)\npy.iplot(fig)","8fc47621":"#Prepare Non Syd Metro Cases\nnswmastermap = nswmaster[nswmaster.long != 0.000000]\nnswmastermap = nswmastermap[nswmastermap['postcode'].between(2235, 2999)]\nnswmastermap = nswmastermap.groupby('lga_name19').agg({'lga_name19':'count','long':'first','lat':'first'}).rename(columns={'lga_name19':'Count'}).reset_index()","31a128b5":"fig = px.scatter_mapbox(nswmastermap, lat=\"lat\", lon=\"long\", hover_name=\"lga_name19\", hover_data=[\"Count\"],\n                        color_discrete_sequence=[\"red\"], zoom=5, height=500, size=\"Count\",size_max=15)\nfig.update_layout(mapbox_style=\"stamen-terrain\")\nfig.update_layout(margin={\"r\":0,\"t\":0,\"l\":0,\"b\":0})\nfig.show()","2df47a43":"nonsydneycases = nswmaster[nswmaster.long != 0.000000]\nnonsydneycases = nonsydneycases[nonsydneycases['postcode'].between(2235, 2999)]\nnonsydneycases = nonsydneycases.groupby('lhd_2010_name').agg({'lhd_2010_name':'count'}).rename(columns={'lhd_2010_name':'Count'}).reset_index()\nnonsydneycases = nonsydneycases.sort_values(by=['Count'], ascending=False)\n\ndata  = go.Data([\n            go.Bar(\n              y = nonsydneycases.Count,\n              x = nonsydneycases.lhd_2010_name,\n              orientation='v'\n        )])\nlayout = go.Layout(\n        title = \"Non Sydney Cases By Region\"\n)\nfig  = go.Figure(data=data, layout=layout)\npy.iplot(fig)\n","ee12f652":"nonsydneycasessub = nswmaster[nswmaster.long != 0.000000]\nnonsydneycasessub = nonsydneycasessub[nonsydneycasessub['postcode'].between(2235, 2999)]\nnonsydneycasessub = nonsydneycasessub.groupby('locality').agg({'locality':'count','lga_name19':'first'}).rename(columns={'locality':'Count'}).reset_index()\nnonsydneycasessub = nonsydneycasessub.sort_values(by=['Count'], ascending=False)\nnonsydneycasessub_histogram = nonsydneycasessub.head(20)\n\ndata  = go.Data([\n            go.Bar(\n              y = nonsydneycasessub_histogram.Count,\n              x = nonsydneycasessub_histogram.locality,\n              orientation='v',\n        )])\nlayout = go.Layout(\n        title = \"Non Sydney Coronavirus Cases By 20 Most Affected Suburbs\"\n)\nfig  = go.Figure(data=data, layout=layout)\npy.iplot(fig)","515d22df":"summarised_ages = nswages.groupby('age_group').agg({'age_group':'count'}).rename(columns={'age_group':'Count'}).reset_index()\nsummarised_ages = summarised_ages.sort_values(by=['Count'], ascending=False)\nsummarised_ages[['age_group','Count']].head(3).style","f2cf2cfe":"data  = go.Data([\n            go.Bar(\n              y = summarised_ages.Count,\n              x = summarised_ages.age_group,\n              orientation='v'\n        )])\nlayout = go.Layout(\n        title = \"Cases by Age Group\"\n)\nfig  = go.Figure(data=data, layout=layout)\npy.iplot(fig)","53806817":"summarised_factors = nswfactors.groupby('likely_source_of_infection').agg({'likely_source_of_infection':'count'}).rename(columns={'likely_source_of_infection':'Count'}).reset_index()\nsummarised_factors  = summarised_factors.sort_values(by=['Count'], ascending=False)\nsummarised_factors[['likely_source_of_infection','Count']].head(3).style","b7e81ff9":"data  = go.Data([\n            go.Bar(\n              y = summarised_factors.Count,\n              x = summarised_factors.likely_source_of_infection,\n              orientation='v'\n        )])\nlayout = go.Layout(\n        title = \"Cases by Likely Source of Infection\"\n)\nfig  = go.Figure(data=data, layout=layout)\npy.iplot(fig)","f4611467":"nswmasterx = nswmaster[['lhd_2010_name','locality']]\nnswmasterx['Case ID'] = np.arange(len(nswmasterx))+1\nnswmasterx['Case ID'] = nswmasterx['Case ID'].apply(str)\nnswmasterx = nswmasterx.dropna()\nnswmasterx['Total'] = 1\nprint(nswmasterx)","9d42c823":"casenetwork = Network(height=\"600px\", width=\"100%\", font_color=\"black\", notebook=True)\ncasenetwork.set_edge_smooth(\"discrete\")\n\nsources = nswmasterx['locality']\ntargets = nswmasterx['Case ID']\n\nweights = nswmasterx['Total']\n\nedge_data = zip(sources, targets, weights)\n\n\n\nfor e in edge_data:\n    src = e[0]\n    dst = e[1]\n    w = e[2]\n    casenetwork.add_node(src, src, title=src, color=\"#0000ff\", value=10)\n    casenetwork.add_node(dst, dst, title=dst, color =\"#ff0000\", value=2)\n    casenetwork.add_edge(src, dst, value=w, color='#00ff00')\n\n#casenetwork.show(\"covidnswgraph.html\")\n","e1f7b06d":" # Cases within Sydney Metro Region","d1aca59e":"# Likely Source of Infection","c9ab27bc":"This analysis focuses on age groups and likely sources of infection.","593da879":"Those cases broken down by suburb","dfcb75bc":"And by Suburb","172aa544":"# Age Groups","aabc9d67":"Most recent number of cumulative cases in NSW.","227d539f":"Concepts of tracing can start to be useful, particularly where network analysis is involved. Code is slow to run in notebook, so feel free to take a copy and remove commenting below where it needs to be rendered. I try to keep the static image up to date.","ff5aeea0":"Those cases broken down by region:","6a48f130":"The most prevalent Age group is the 70+ range. However perhaps surprisingly, the next two ranges exist win the 20-29 age group.","fe3bc7a1":"# Other Data Points","f5b92b47":"Cases sourced overseas are by far the greatest contributor to cases in NSW.","1ba7bf13":"# NSW Case Analysis","5aaf7f89":"DATA NSW has recently made available three separata COVID-19 data sources relating to cases in New South Wales. They can be found in the following locations.\n\n1. https:\/\/data.nsw.gov.au\/data\/dataset\/covid-19-cases-by-location\n2. https:\/\/data.nsw.gov.au\/data\/dataset\/nsw-covid-19-cases-by-likely-source-of-infection\n3. https:\/\/data.nsw.gov.au\/data\/dataset\/nsw-covid-19-cases-by-age-range\n\nAs things currently stand, the datasets are not linked.","dcee9c2d":"![](https:\/\/pbs.twimg.com\/media\/EVhtYUfUwAIBT8y?format=jpg&name=medium)","aaa7ae79":"This analysis focuses on data specifically relating to COVID-19 cases in New South Wales (Australia) - as made avaialble by Data NSW.\n\nIt analyses the data in a few different ways, including the prevalence of cases in the Sydney metropolitan region vs non-metro cases. The mapping done was achieved with the assistance of an open source index of Australian postcodes and associated latitude and longditude values.\n\nThe size of NSW - and indeed all Australian states - is more indicative of the geographical layout of many small countries. As such it could be useful to understand the problem from a Sydney and non-Sydney perspective.\n\nI've also conducted a short analysis using the ongoing John Hopkins data set - https:\/\/www.kaggle.com\/adrianagius\/australian-covid-19-data-analysis","136f72c8":"Most recent count of new cases in NSW","3e6d1bc1":"# Cases outisde Sydney Metro Region - Mapped","b6f08fe5":"Most recent rate of case increase","78d0804f":"# COVID-19 - NSW Health Data Analysis","a4ff8d0e":"# The Data"}}