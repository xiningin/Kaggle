{"cell_type":{"ca0e74f6":"code","47f394fb":"code","a3f701ba":"code","df2527c1":"code","9156490b":"code","08845433":"code","81e21052":"code","bb053cb4":"code","e1e07f06":"code","077ac3ba":"code","dd348a9f":"code","af52cd38":"code","0df69ccb":"code","771c5f32":"code","0144e4bd":"code","109dd0a0":"code","ba255d15":"code","34fbd6a2":"code","2b1d3efa":"code","2f0efabc":"code","9e0e7013":"code","3c1ea972":"code","d07f1960":"code","c2405fa3":"code","4096ff5e":"code","a255bcd8":"code","969ab400":"code","40f816f1":"code","34643f64":"code","18a4b197":"code","b9729330":"code","e1733d3f":"code","960f167d":"code","bc170fdd":"code","105d71fe":"markdown","6f75ac9f":"markdown","d3d58000":"markdown","3df55f16":"markdown","23cec3de":"markdown","98db730e":"markdown","72c39e10":"markdown","f86b181e":"markdown","769f71f0":"markdown","6dab80ba":"markdown","347157f7":"markdown","a6f7c380":"markdown","d3bb7dea":"markdown","be1680fb":"markdown","92a5c1e1":"markdown","ed1150eb":"markdown","c86c0ec7":"markdown","2fbc6ea7":"markdown","9a33ebea":"markdown","d430d46f":"markdown","ba5ac876":"markdown"},"source":{"ca0e74f6":"import os\nprint(os.listdir(\"..\/input\"))","47f394fb":"%matplotlib inline\nimport numpy as np \nimport pandas as pd \nimport matplotlib.pyplot as plt \nimport seaborn as sns ","a3f701ba":"os.chdir('..\/input')\ndata=pd.read_csv('2004-2019.tsv', sep='\\t',parse_dates=[1,2],index_col=0)","df2527c1":"data.shape","9156490b":"data.head()","08845433":"data.columns","81e21052":"data.rename(columns={'DATA INICIAL':'date_first', \n                     'DATA FINAL':'date_last',\n                     'REGI\u00c3O':'macro_region',\n                     'ESTADO':'state',\n                     'PRODUTO':'product',\n                     'N\u00daMERO DE POSTOS PESQUISADOS':'num_gas_station', \n                     'UNIDADE DE MEDIDA':'unit',\n                     'PRE\u00c7O M\u00c9DIO REVENDA':'mean_mkt_value',\n                     'DESVIO PADR\u00c3O REVENDA':'sd',\n                     'PRE\u00c7O M\u00cdNIMO REVENDA':'min_price',\n                     'PRE\u00c7O M\u00c1XIMO REVENDA':'max_price',\n                     'MARGEM M\u00c9DIA REVENDA':'mean_price_margin',\n                     'COEF DE VARIA\u00c7\u00c3O REVENDA':'coef_var',\n                     'PRE\u00c7O M\u00c9DIO DISTRIBUI\u00c7\u00c3O':'mean_dist_price',\n                     'DESVIO PADR\u00c3O DISTRIBUI\u00c7\u00c3O':'dist_sd',\n                     'PRE\u00c7O M\u00cdNIMO DISTRIBUI\u00c7\u00c3O':'dist_min_price',\n                     'PRE\u00c7O M\u00c1XIMO DISTRIBUI\u00c7\u00c3O':'dist_max_price',\n                     'COEF DE VARIA\u00c7\u00c3O DISTRIBUI\u00c7\u00c3O':'dist_coef_var',\n                     'M\u00caS':'month',\n                     'ANO':'year'}\n            , inplace=True)","bb053cb4":"data.head()","e1e07f06":"for i in list(data.columns):\n    print(i,len(set(data[i])))","077ac3ba":"data.isnull().any()","dd348a9f":"data.info()","af52cd38":"for col in ['mean_price_margin','mean_dist_price','dist_sd','dist_min_price','dist_max_price','dist_coef_var']:\n    data[col]=pd.to_numeric(data[col],errors='coerce')","0df69ccb":"data.info()","771c5f32":"data.isnull().any()","0144e4bd":"data.isnull().sum()","109dd0a0":"data.isnull().any(axis=1).sum()","ba255d15":"data.dropna(inplace=True)","34fbd6a2":"data.shape","2b1d3efa":"data.head()","2f0efabc":"data.describe()","9e0e7013":"set(zip(data['product'],data['unit']))","3c1ea972":"avg_price_by_prod_region = pd.pivot_table(data,index=['product','year'],columns='macro_region',values='mean_mkt_value',aggfunc=np.mean)\navg_price_by_prod_region.head()","d07f1960":"for i in set(avg_price_by_prod_region.index.get_level_values(0)):\n    sub_table = avg_price_by_prod_region[avg_price_by_prod_region.index.get_level_values(0)==i].reset_index(drop=False)\n    sub_table =avg_price_by_prod_region[avg_price_by_prod_region.index.get_level_values(0)==i].reset_index(drop=False)\n    sub_table.drop('product',axis=1,inplace=True)\n    sub_table.set_index('year').plot()\n    plt.title('Price change for {}'.format(i))\n    plt.show()","c2405fa3":"avg_price_by_prod_region_states = pd.pivot_table(data,index=['macro_region','state','year'],columns='product',values='mean_mkt_value',aggfunc=np.mean)\navg_price_by_prod_region_states.head(10)","4096ff5e":"avg_price_by_prod_region_states.reset_index(drop=False,inplace=True)","a255bcd8":"price_increase = {}\n\nfor state in set(data['state']):\n    for prod in set(data['product']):\n        pct_change = []\n        price_list = avg_price_by_prod_region_states[avg_price_by_prod_region_states['state']==state][prod]\n        price_list = price_list[~np.isnan(price_list)]\n        pct_change.append(price_list.pct_change().mean())\n    price_increase[state] = np.mean(pct_change)","969ab400":"price_increase_df = pd.DataFrame.from_dict(price_increase,orient ='index')\nprice_increase_df.reset_index(drop=False,inplace=True)\nprice_increase_df.columns=['state','price_increase']","40f816f1":"region_state = pd.DataFrame(list(set(zip(data['state'],data['macro_region']))),columns=['state','region'])","34643f64":"price_increase_result = pd.merge(price_increase_df,region_state,left_on='state',right_on='state')","18a4b197":"price_increase_result.sort_values('price_increase',ascending=False).drop_duplicates(['region'])","b9729330":"avg_price_ovreall_by_prod_state = pd.pivot_table(data,index=['state'],columns='product',values='mean_mkt_value',aggfunc=np.mean)","e1733d3f":"avg_price_ovreall_by_prod_state.head()","960f167d":"avg_price_ovreall_by_prod_state.idxmax()","bc170fdd":"avg_price_ovreall_by_prod_state.idxmin()","105d71fe":"What can be done with this?\n<br>How different regions of Brazil saw their gas prices change?\n<br>Within a region, which states increased more their prices?\n<br>Which states are the cheapest (or most expensive) for different types of fuels?","6f75ac9f":"To show the prices change, first is to compare within the same product and the same unit\n<br>Therefore first is to know possible sets for products and units ","d3d58000":"### 2. Within a region, which states increased more their prices? ","3df55f16":"So there are some missing values after conversion.\n<br>Next is to check the number of missing records and determine if these records are removed or the whole columns is removed","23cec3de":"There is no missing data in the dataset ","98db730e":"Now is to answer questions ","72c39e10":"# Gas Prices in Brazil","f86b181e":"First is to rename the column names back to English ","769f71f0":"There are some columns showing dtypes = object but they contain numerical values. Therefore it is necessary to change their dtypes back to float64","6dab80ba":"So all gas products raise prices. OLEO DIESEL is the most problematic as the increases are over 130% from 2004 to 2019","347157f7":"Next is to check the dataset. This includes data cleaning and reformating","a6f7c380":"Sao Paulo and Parana are good places for cheap fuels ","d3bb7dea":"### 3. Which states are the cheapest (or most expensive) for different types of fuels?","be1680fb":"Above table shows the state in each region with the highest average price increase for overall products","92a5c1e1":"Since modification is carried, check if any missing values again ","ed1150eb":"Products determine unit.\n<br>So we only need to consider products and then study the price changes","c86c0ec7":"There are 103392 records with 20 columns ","2fbc6ea7":"So there are in total around 3% of records with missing records. So it is safe to remove these row records without harming the overall dataset\n<br>Next step is to remove rows with missing records ","9a33ebea":"To answer this question, first is to calculate the increase (in %) for each product in each state within a region\n<br>Then to calcuclate the average of increase to find the state with highest increase","d430d46f":"So all columns have data variations. ","ba5ac876":"### 1.How different regions of Brazil saw their gas prices change?"}}