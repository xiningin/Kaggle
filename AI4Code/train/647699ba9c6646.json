{"cell_type":{"648fdb6f":"code","968fa046":"code","039ecdc8":"code","c8b59627":"code","140e41eb":"code","1c43c245":"code","e09ab67b":"code","1f1a1c58":"code","9813f603":"code","2fb47514":"code","15dbaabb":"code","b39f4312":"code","34a3ff27":"code","9a735254":"code","c285f779":"code","4300f149":"code","57484310":"code","b1fdadcd":"code","049acf74":"code","71b01ff1":"code","19327aa2":"code","e12fedbd":"code","618340c3":"code","36370c2c":"code","49476587":"code","f76cef05":"code","c3e31251":"code","c52b5bc0":"code","c3a56259":"code","32829384":"code","491ca16b":"code","04df22e5":"code","d3bd07d0":"markdown","0fc3286c":"markdown","7ae7ede8":"markdown","5fd9925b":"markdown","837a541d":"markdown","04ee1a65":"markdown","e7c33f99":"markdown","12c4a098":"markdown","fe9dd485":"markdown","2594b090":"markdown","bfd2a217":"markdown"},"source":{"648fdb6f":"import pandas as pd\nfrom datetime import datetime\nimport matplotlib.pyplot as plt\nfrom statsmodels.graphics.tsaplots import plot_acf, plot_pacf\nfrom statsmodels.tsa.api import VAR\nfrom scipy.stats import pearsonr\nfrom statsmodels.tsa.stattools import grangercausalitytests\n\nimport warnings\nwarnings.filterwarnings('ignore') ","968fa046":"def parser(s):\n    return datetime.strptime(s, '%Y-%m')","039ecdc8":"ice_cream_heater_df = pd.read_csv('..\/input\/time-series-toy-data-set\/ice_cream_vs_heater.csv', parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)","c8b59627":"ice_cream_heater_df","140e41eb":"ice_cream_heater_df = ice_cream_heater_df.asfreq(pd.infer_freq(ice_cream_heater_df.index))","1c43c245":"plt.figure(figsize=(12,6))\nice_cream, = plt.plot(ice_cream_heater_df['ice cream'])\nheater, = plt.plot(ice_cream_heater_df['heater'], color='red')\n\nfor year in range(2004, 2021):\n    plt.axvline(datetime(year,1,1), linestyle='--', color='k', alpha=0.5)\n\nplt.legend(['Ice Cream', 'Heater'], fontsize=16)","e09ab67b":"avgs = ice_cream_heater_df.mean()\ndevs = ice_cream_heater_df.std()","1f1a1c58":"for col in ice_cream_heater_df.columns:\n    ice_cream_heater_df[col] = (ice_cream_heater_df[col] - avgs.loc[col]) \/ devs.loc[col]","9813f603":"plt.figure(figsize=(12,6))\nice_cream, = plt.plot(ice_cream_heater_df['ice cream'])\nheater, = plt.plot(ice_cream_heater_df['heater'], color='red')\n\nfor year in range(2004, 2021):\n    plt.axvline(datetime(year,1,1), linestyle='--', color='k', alpha=0.5)\n    \nplt.axhline(0, linestyle='--', color='k', alpha=0.3)\n\nplt.legend(['Ice Cream', 'Heater'], fontsize=16)","2fb47514":"ice_cream_heater_df = ice_cream_heater_df.diff().dropna()","15dbaabb":"plt.figure(figsize=(12,6))\nice_cream, = plt.plot(ice_cream_heater_df['ice cream'])\nheater, = plt.plot(ice_cream_heater_df['heater'], color='red')\n\nfor year in range(2004, 2021):\n    plt.axvline(datetime(year,1,1), linestyle='--', color='k', alpha=0.5)\n    \nplt.axhline(0, linestyle='--', color='k', alpha=0.3)\nplt.ylabel('First Difference', fontsize=18)\n\nplt.legend(['Ice Cream', 'Heater'], fontsize=16)","b39f4312":"plt.figure(figsize=(12,6))\nice_cream, = plt.plot(ice_cream_heater_df['ice cream'])\n\nfor year in range(2004, 2021):\n    plt.axvline(datetime(year,1,1), linestyle='--', color='k', alpha=0.5)\n    \nplt.axhline(0, linestyle='--', color='k', alpha=0.3)\nplt.ylabel('First Difference', fontsize=18)\n\nplt.legend(['Ice Cream'], fontsize=16)","34a3ff27":"annual_volatility = ice_cream_heater_df.groupby(ice_cream_heater_df.index.year).std()","9a735254":"ice_cream_heater_df['ice_cream_annual_vol'] = ice_cream_heater_df.index.map(lambda d: annual_volatility.loc[d.year, 'ice cream'])\nice_cream_heater_df['heater_annual_vol'] = ice_cream_heater_df.index.map(lambda d: annual_volatility.loc[d.year, 'heater'])","c285f779":"ice_cream_heater_df['ice cream'] = ice_cream_heater_df['ice cream'] \/ ice_cream_heater_df['ice_cream_annual_vol']\nice_cream_heater_df['heater'] = ice_cream_heater_df['heater'] \/ ice_cream_heater_df['heater_annual_vol']","4300f149":"plt.figure(figsize=(12,6))\nice_cream, = plt.plot(ice_cream_heater_df['ice cream'])\n\nfor year in range(2004, 2021):\n    plt.axvline(datetime(year,1,1), linestyle='--', color='k', alpha=0.5)\n    \nplt.axhline(0, linestyle='--', color='k', alpha=0.3)\nplt.ylabel('First Difference', fontsize=18)\n\nplt.legend(['Ice Cream'], fontsize=16)","57484310":"plt.figure(figsize=(12,6))\nice_cream, = plt.plot(ice_cream_heater_df['ice cream'])\nheater, = plt.plot(ice_cream_heater_df['heater'], color='red')\n\nfor year in range(2004, 2021):\n    plt.axvline(datetime(year,1,1), linestyle='--', color='k', alpha=0.5)\n    \nplt.axhline(0, linestyle='--', color='k', alpha=0.3)\nplt.ylabel('First Difference', fontsize=18)\n\nplt.legend(['Ice Cream', 'Heater'], fontsize=16)","b1fdadcd":"month_avgs = ice_cream_heater_df.groupby(ice_cream_heater_df.index.month).mean()","049acf74":"print(month_avgs)","71b01ff1":"ice_cream_heater_df['ice_cream_month_avg'] = ice_cream_heater_df.index.map(lambda d: month_avgs.loc[d.month, 'ice cream'])\nice_cream_heater_df['heater_month_avg'] = ice_cream_heater_df.index.map(lambda d: month_avgs.loc[d.month, 'heater'])","19327aa2":"ice_cream_heater_df","e12fedbd":"ice_cream_heater_df['ice cream'] = ice_cream_heater_df['ice cream'] - ice_cream_heater_df['ice_cream_month_avg']\nice_cream_heater_df['heater'] = ice_cream_heater_df['heater'] - ice_cream_heater_df['heater_month_avg']","618340c3":"ice_cream_heater_df","36370c2c":"plt.figure(figsize=(12,6))\nice_cream, = plt.plot(ice_cream_heater_df['ice cream'])\n\nfor year in range(2004, 2021):\n    plt.axvline(datetime(year,1,1), linestyle='--', color='k', alpha=0.5)\n    \nplt.axhline(0, linestyle='--', color='k', alpha=0.3)\nplt.ylabel('First Difference', fontsize=18)\n\nplt.legend(['Ice Cream'], fontsize=16)","49476587":"plt.figure(figsize=(12,6))\nice_cream, = plt.plot(ice_cream_heater_df['ice cream'])\nheater, = plt.plot(ice_cream_heater_df['heater'], color='red')\n\nfor year in range(2004, 2021):\n    plt.axvline(datetime(year,1,1), linestyle='--', color='k', alpha=0.5)\n    \nplt.axhline(0, linestyle='--', color='k', alpha=0.3)\nplt.ylabel('First Difference', fontsize=18)\n\nplt.legend(['Ice Cream', 'Heater'], fontsize=16)","f76cef05":"plot_pacf(ice_cream_heater_df['heater'])\nplt.show()","c3e31251":"for lag in range(1, 14):\n    heater_series = ice_cream_heater_df['heater'].iloc[lag:]\n    lagged_ice_cream_series = ice_cream_heater_df['ice cream'].iloc[:-lag]\n    print('Lag: %s'%lag)\n    print(pearsonr(heater_series, lagged_ice_cream_series))\n    print('------')","c52b5bc0":"ice_cream_heater_df","c3a56259":"ice_cream_heater_df = ice_cream_heater_df[['ice cream', 'heater']]","32829384":"model = VAR(ice_cream_heater_df)","491ca16b":"model_fit = model.fit(maxlags=20)","04df22e5":"model_fit.summary()","d3bd07d0":"# Normalize","0fc3286c":"# Correlation between \"heater\" and lagged \"ice cream\"","7ae7ede8":"# Remove Seasonality","5fd9925b":"# Take First Difference to Remove Trend","837a541d":"# So our final model is:","04ee1a65":"# Read the Data","e7c33f99":"# Remove Increasing Volatility","12c4a098":"# PACF - Heater","fe9dd485":"$$\n\\hat{h}_t = - 0.41h_{t-1} - 0.19h_{t-2} + 0.2i_{t-13}\n$$","2594b090":"## So consider an AR(2)","bfd2a217":"# Fit a VAR Model"}}