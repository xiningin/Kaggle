{"cell_type":{"a40a9c23":"code","e4d79507":"code","c4c9960b":"code","8f051d0d":"code","613e6521":"code","e760f077":"code","44f1d2c2":"code","aa4b55c4":"code","53df0aee":"code","9d4be823":"code","171ce374":"code","8c1a5fa3":"code","caa5ea9e":"code","37dd3c0f":"code","5e89c920":"code","7f9881bd":"code","7e36bd4d":"code","ed824203":"code","b8586f83":"code","dee87e32":"code","90c280b9":"code","0643e21f":"code","29c2f0bd":"code","aa29ccd0":"code","b6199b46":"code","7295a6a4":"code","f5ac0ecd":"code","f49eb9ae":"code","b6ba9bc1":"code","c0a93b57":"code","3ce38871":"code","29f0c086":"code","9771d045":"code","bfbfd125":"code","14e38629":"code","de06aa6f":"code","24d24f89":"code","683967d3":"code","f5dedeef":"code","452d96e4":"code","d58ec631":"code","3e8e46c6":"code","789edfdd":"code","58478156":"code","84d14139":"code","65b0da9f":"code","d81d3084":"code","d7b3a3f0":"code","d5f28307":"code","c48d828c":"code","6aee3ec8":"code","c00ff855":"code","d1be4824":"code","41875a94":"code","88c66268":"code","736683ec":"code","3243c7d1":"code","bd004c3d":"code","0fa9d0a0":"code","35320bfb":"code","65bf915d":"markdown","abea449e":"markdown","0727a7f4":"markdown","64870e50":"markdown"},"source":{"a40a9c23":"#!pip install multi-prophet","e4d79507":"import gc\nfrom tqdm import tqdm\nimport numpy as np\nimport pandas as pd\nfrom pylab import rcParams\nimport matplotlib.pyplot as plt\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn.preprocessing import LabelEncoder\nfrom scipy.stats import probplot\nimport datetime as dt\nfrom datetime import date\nfrom datetime import timedelta\nfrom fbprophet import Prophet\n#from multi_prophet import MultiProphet\n#import optuna\nimport os\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n%matplotlib inline","c4c9960b":"train=pd.read_csv('..\/input\/tabular-playground-series-jan-2022\/train.csv')\ntest=pd.read_csv('..\/input\/tabular-playground-series-jan-2022\/test.csv')","8f051d0d":"train.info()","613e6521":"train['country_store_product']=train['country']+'_'+train['store']+'_'+train['product']\ntest['country_store_product']=test['country']+'_'+test['store']+'_'+test['product']\nName=train['country_store_product'].unique().tolist()\nprint(Name)\nprint(len(Name))","e760f077":"print(train.columns.tolist())\ntrain","44f1d2c2":"train2=train[['row_id','date','country_store_product','num_sold']]\ntrain2","aa4b55c4":"test","53df0aee":"test2=test[['row_id','date','country_store_product']]\ntest2","9d4be823":"from datetime import datetime as dt\ndate=[]\nfor item in train2['date']:\n    date+=[dt.strptime(item,'%Y-%m-%d')]\ntrain2['date2']=date\ntrain2","171ce374":"start0 = dt.strptime('2015-01-01', '%Y-%m-%d').date()\nend0   = dt.strptime('2020-01-01', '%Y-%m-%d').date()\n  \ndates0=[]\nfor i in range((end0-start0).days):\n    dates0+=[(start0+timedelta(i)).strftime('%Y-%m-%d') ]\nprint(dates0[0:10])","8c1a5fa3":"train3=pd.DataFrame(columns=['date2']+Name)\ntrain3['date2']=dates0\ntrain3","caa5ea9e":"for item in Name:\n    for i in range(len(dates0)-365):\n        train3.loc[i,item]=train2[train2['country_store_product']==item][train2['date2']==dates0[i]]['num_sold'].tolist()[0]\ntrain3","37dd3c0f":"train3.info()","5e89c920":"item0=train3[['date2',Name[0]]]\nitem1=train3[['date2',Name[1]]]\nitem2=train3[['date2',Name[2]]]\nitem3=train3[['date2',Name[3]]]\nitem4=train3[['date2',Name[4]]]\nitem5=train3[['date2',Name[5]]]\nitem6=train3[['date2',Name[6]]]\nitem7=train3[['date2',Name[7]]]\nitem8=train3[['date2',Name[8]]]\nitem9=train3[['date2',Name[9]]]\nitem10=train3[['date2',Name[10]]]\nitem11=train3[['date2',Name[11]]]\nitem12=train3[['date2',Name[12]]]\nitem13=train3[['date2',Name[13]]]\nitem14=train3[['date2',Name[14]]]\nitem15=train3[['date2',Name[15]]]\nitem16=train3[['date2',Name[16]]]\nitem17=train3[['date2',Name[17]]]\n\nitem0.columns=['ds','y']\nitem1.columns=['ds','y']\nitem2.columns=['ds','y']\nitem3.columns=['ds','y']\nitem4.columns=['ds','y']\nitem5.columns=['ds','y']\nitem6.columns=['ds','y']\nitem7.columns=['ds','y']\nitem8.columns=['ds','y']\nitem9.columns=['ds','y']\nitem10.columns=['ds','y']\nitem11.columns=['ds','y']\nitem12.columns=['ds','y']\nitem13.columns=['ds','y']\nitem14.columns=['ds','y']\nitem15.columns=['ds','y']\nitem16.columns=['ds','y']\nitem17.columns=['ds','y']","7f9881bd":"item0['ds']","7e36bd4d":"rcParams['figure.figsize'] = 20,5\nplt.plot(item0.ds, item0.y)","ed824203":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y)","b8586f83":"rcParams['figure.figsize'] = 20,5\nplt.plot(item2.ds, item2.y)","dee87e32":"rcParams['figure.figsize'] = 20,5\nplt.plot(item3.ds, item3.y)","90c280b9":"rcParams['figure.figsize'] = 20,5\nplt.plot(item4.ds, item4.y)","0643e21f":"rcParams['figure.figsize'] = 20,5\nplt.plot(item5.ds, item5.y)","29c2f0bd":"rcParams['figure.figsize'] = 20,5\nplt.plot(item6.ds, item6.y)","aa29ccd0":"rcParams['figure.figsize'] = 20,5\nplt.plot(item7.ds, item7.y)","b6199b46":"rcParams['figure.figsize'] = 20,5\nplt.plot(item8.ds, item8.y)","7295a6a4":"rcParams['figure.figsize'] = 20,5\nplt.plot(item9.ds, item9.y)","f5ac0ecd":"rcParams['figure.figsize'] = 20,5\nplt.plot(item10.ds, item10.y)","f49eb9ae":"rcParams['figure.figsize'] = 20,5\nplt.plot(item11.ds, item11.y)","b6ba9bc1":"rcParams['figure.figsize'] = 20,5\nplt.plot(item12.ds, item12.y)","c0a93b57":"rcParams['figure.figsize'] = 20,5\nplt.plot(item13.ds, item13.y)","3ce38871":"rcParams['figure.figsize'] = 20,5\nplt.plot(item14.ds, item14.y)","29f0c086":"rcParams['figure.figsize'] = 20,5\nplt.plot(item15.ds, item15.y)","9771d045":"rcParams['figure.figsize'] = 20,5\nplt.plot(item16.ds, item16.y)","bfbfd125":"rcParams['figure.figsize'] = 20,5\nplt.plot(item17.ds, item17.y)","14e38629":"ph0 = Prophet()\nph0.fit(item0)\nforecast0 = ph0.predict(item0)\nph0.plot(forecast0)","de06aa6f":"ph1 = Prophet()\nph1.fit(item1)\nforecast1 = ph1.predict(item1)\nph1.plot(forecast1)","24d24f89":"ph2 = Prophet()\nph2.fit(item2)\nforecast2 = ph2.predict(item2)\nph2.plot(forecast2)","683967d3":"ph3 = Prophet()\nph3.fit(item3)\nforecast3 = ph3.predict(item3)\nph3.plot(forecast3)","f5dedeef":"ph4 = Prophet()\nph4.fit(item4)\nforecast4 = ph4.predict(item4)\nph4.plot(forecast4)","452d96e4":"ph5 = Prophet()\nph5.fit(item5)\nforecast5 = ph5.predict(item5)\nph5.plot(forecast5)","d58ec631":"ph6 = Prophet()\nph6.fit(item6)\nforecast6 = ph6.predict(item6)\nph6.plot(forecast6)","3e8e46c6":"ph7 = Prophet()\nph7.fit(item7)\nforecast7 = ph7.predict(item7)\nph7.plot(forecast7)","789edfdd":"ph8 = Prophet()\nph8.fit(item8)\nforecast8 = ph8.predict(item8)\nph8.plot(forecast8)","58478156":"ph9 = Prophet()\nph9.fit(item9)\nforecast9 = ph9.predict(item9)\nph9.plot(forecast9)","84d14139":"ph10 = Prophet()\nph10.fit(item10)\nforecast10 = ph10.predict(item10)\nph10.plot(forecast10)","65b0da9f":"ph11 = Prophet()\nph11.fit(item11)\nforecast11 = ph11.predict(item11)\nph11.plot(forecast11)","d81d3084":"ph12 = Prophet()\nph12.fit(item12)\nforecast12 = ph12.predict(item12)\nph12.plot(forecast12)","d7b3a3f0":"ph13 = Prophet()\nph13.fit(item1)\nforecast13 = ph13.predict(item13)\nph13.plot(forecast13)","d5f28307":"ph14 = Prophet()\nph14.fit(item14)\nforecast14 = ph14.predict(item14)\nph14.plot(forecast14)","c48d828c":"ph15 = Prophet()\nph15.fit(item15)\nforecast15 = ph15.predict(item15)\nph15.plot(forecast15)","6aee3ec8":"ph16 = Prophet()\nph16.fit(item16)\nforecast16 = ph16.predict(item16)\nph16.plot(forecast16)","c00ff855":"ph17 = Prophet()\nph17.fit(item17)\nforecast17 = ph17.predict(item17)\nph17.plot(forecast17)","d1be4824":"y0=forecast0[['ds','yhat']][-365:].reset_index(drop=True)\ny1=forecast1[['ds','yhat']][-365:].reset_index(drop=True)\ny2=forecast2[['ds','yhat']][-365:].reset_index(drop=True)\ny3=forecast3[['ds','yhat']][-365:].reset_index(drop=True)\ny4=forecast4[['ds','yhat']][-365:].reset_index(drop=True)\ny5=forecast5[['ds','yhat']][-365:].reset_index(drop=True)\ny6=forecast6[['ds','yhat']][-365:].reset_index(drop=True)\ny7=forecast7[['ds','yhat']][-365:].reset_index(drop=True)\ny8=forecast8[['ds','yhat']][-365:].reset_index(drop=True)\ny9=forecast9[['ds','yhat']][-365:].reset_index(drop=True)\ny10=forecast10[['ds','yhat']][-365:].reset_index(drop=True)\ny11=forecast11[['ds','yhat']][-365:].reset_index(drop=True)\ny12=forecast12[['ds','yhat']][-365:].reset_index(drop=True)\ny13=forecast13[['ds','yhat']][-365:].reset_index(drop=True)\ny14=forecast14[['ds','yhat']][-365:].reset_index(drop=True)\ny15=forecast15[['ds','yhat']][-365:].reset_index(drop=True)\ny16=forecast16[['ds','yhat']][-365:].reset_index(drop=True)\ny17=forecast17[['ds','yhat']][-365:].reset_index(drop=True)","41875a94":"test2_0=test2[test2['country_store_product']==Name[0]]\ntest2_1=test2[test2['country_store_product']==Name[1]]\ntest2_2=test2[test2['country_store_product']==Name[2]]\ntest2_3=test2[test2['country_store_product']==Name[3]]\ntest2_4=test2[test2['country_store_product']==Name[4]]\ntest2_5=test2[test2['country_store_product']==Name[5]]\ntest2_6=test2[test2['country_store_product']==Name[6]]\ntest2_7=test2[test2['country_store_product']==Name[7]]\ntest2_8=test2[test2['country_store_product']==Name[8]]\ntest2_9=test2[test2['country_store_product']==Name[9]]\ntest2_10=test2[test2['country_store_product']==Name[10]]\ntest2_11=test2[test2['country_store_product']==Name[11]]\ntest2_12=test2[test2['country_store_product']==Name[12]]\ntest2_13=test2[test2['country_store_product']==Name[13]]\ntest2_14=test2[test2['country_store_product']==Name[14]]\ntest2_15=test2[test2['country_store_product']==Name[15]]\ntest2_16=test2[test2['country_store_product']==Name[16]]\ntest2_17=test2[test2['country_store_product']==Name[17]]","88c66268":"y0.columns=['date','num_sold']\ny1.columns=['date','num_sold']\ny2.columns=['date','num_sold']\ny3.columns=['date','num_sold']\ny4.columns=['date','num_sold']\ny5.columns=['date','num_sold']\ny6.columns=['date','num_sold']\ny7.columns=['date','num_sold']\ny8.columns=['date','num_sold']\ny9.columns=['date','num_sold']\ny10.columns=['date','num_sold']\ny11.columns=['date','num_sold']\ny12.columns=['date','num_sold']\ny13.columns=['date','num_sold']\ny14.columns=['date','num_sold']\ny15.columns=['date','num_sold']\ny16.columns=['date','num_sold']\ny17.columns=['date','num_sold']\n","736683ec":"y0['date']=y0['date'].astype(str)\ny1['date']=y1['date'].astype(str)\ny2['date']=y2['date'].astype(str)\ny3['date']=y3['date'].astype(str)\ny4['date']=y4['date'].astype(str)\ny5['date']=y5['date'].astype(str)\ny6['date']=y6['date'].astype(str)\ny7['date']=y7['date'].astype(str)\ny8['date']=y8['date'].astype(str)\ny9['date']=y9['date'].astype(str)\ny10['date']=y10['date'].astype(str)\ny11['date']=y11['date'].astype(str)\ny12['date']=y12['date'].astype(str)\ny13['date']=y13['date'].astype(str)\ny14['date']=y14['date'].astype(str)\ny15['date']=y15['date'].astype(str)\ny16['date']=y16['date'].astype(str)\ny17['date']=y17['date'].astype(str)\n","3243c7d1":"test2_0=test2_0.merge(y0,on='date')\ntest2_1=test2_1.merge(y1,on='date')\ntest2_2=test2_2.merge(y2,on='date')\ntest2_3=test2_3.merge(y3,on='date')\ntest2_4=test2_4.merge(y4,on='date')\ntest2_5=test2_5.merge(y5,on='date')\ntest2_6=test2_6.merge(y6,on='date')\ntest2_7=test2_7.merge(y7,on='date')\ntest2_8=test2_8.merge(y8,on='date')\ntest2_9=test2_9.merge(y9,on='date')\ntest2_10=test2_10.merge(y10,on='date')\ntest2_11=test2_11.merge(y11,on='date')\ntest2_12=test2_12.merge(y12,on='date')\ntest2_13=test2_13.merge(y13,on='date')\ntest2_14=test2_14.merge(y14,on='date')\ntest2_15=test2_15.merge(y15,on='date')\ntest2_16=test2_16.merge(y16,on='date')\ntest2_17=test2_17.merge(y17,on='date')","bd004c3d":"test3=pd.concat([test2_0,test2_1,test2_2,test2_3,test2_4,test2_5,\n                 test2_6,test2_7,test2_8,test2_9,test2_10,test2_11,\n                 test2_12,test2_13,test2_14,test2_15,test2_16,test2_17],\n                 axis=0)\ntest3","0fa9d0a0":"test3=test3[['row_id','num_sold']].sort_values('row_id')\ntest3","35320bfb":"test3.to_csv('submission.csv',index=False)","65bf915d":"# **TPS0122 Single Prophet**","abea449e":"# Set Prophet","0727a7f4":"# Fit and Predict","64870e50":"# Submit"}}