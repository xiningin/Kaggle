{"cell_type":{"ab290aa0":"code","eaf667b2":"code","54c86208":"code","b2ebbc6f":"code","a10c256b":"code","0bc26deb":"code","c80006e4":"code","9e6a637a":"code","198ff0a7":"code","3e503a7b":"code","f2f18668":"code","be842afe":"markdown","f4307d10":"markdown","177818f5":"markdown"},"source":{"ab290aa0":"# import libraries: TODO\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom datetime import date","eaf667b2":"# read the preprocessed dataset: TODO\ndf=pd.read_csv('..\/input\/preprocessed-sales\/preprocessed_sales.csv')\ndf['InvoiceDate']=pd.to_datetime(df['InvoiceDate'])\ndf['InvoiceDate'] = df['InvoiceDate'].dt.date\ndate1=df.InvoiceDate.max()\ndate1\ntoday = date(2010, 12, 10)","54c86208":"df['Days']= (today-df['InvoiceDate'])\ndf['total']=(df.Quantity)*(df.UnitPrice)\ndf","b2ebbc6f":"me=df.copy()\nle=me.drop_duplicates(subset=['InvoiceNumber'])\n#df3=df.groupby('CustomerId').InvoiceNumber.size()\ndf3=le.groupby('CustomerId').InvoiceNumber.size()\ndf3","a10c256b":"df4=df.groupby('CustomerId').total.sum()\ndf4","0bc26deb":"df1 = df.groupby('CustomerId')['Days'].min()\ndf1","c80006e4":"df5=pd.concat([df1,df3, df4.reindex(df3.index)], axis=1)\ndf5","9e6a637a":"d1=[(df5['Days']<=df5['Days'].quantile(0.25)),\n(df5['Days']>df5['Days'].quantile(0.25))&((df5['Days']<=df5['Days'].quantile(0.5))),\n(df5['Days']>df5['Days'].quantile(0.5))&((df5['Days']<=df5['Days'].quantile(0.75))),\n(df5['Days']>df5['Days'].quantile(0.75))]\nd2=['1','2','3','4']\ndf5['R_quartile']=np.select(d1,d2)\n#############################################\nf1=[(df5['InvoiceNumber']<=df5['InvoiceNumber'].quantile(0.25)),\n(df5['InvoiceNumber']>df5['InvoiceNumber'].quantile(0.25))&((df5['InvoiceNumber']<=df5['InvoiceNumber'].quantile(0.5))),\n(df5['InvoiceNumber']>df5['InvoiceNumber'].quantile(0.5))&((df5['InvoiceNumber']<=df5['InvoiceNumber'].quantile(0.75))),\n(df5['InvoiceNumber']>df5['InvoiceNumber'].quantile(0.75))]\nf2=['1','2','3','4']\ndf5['F_quartile']=np.select(f1,f2)\n###########################################\nm1=[(df5['total']<=df5['total'].quantile(0.25)),\n(df5['total']>df5['total'].quantile(0.25))&((df5['total']<=df5['total'].quantile(0.5))),\n(df5['total']>df5['total'].quantile(0.5))&((df5['total']<=df5['total'].quantile(0.75))),\n(df5['total']>df5['total'].quantile(0.75))]\nm2=['1','2','3','4']\ndf5['M_quartile']=np.select(m1,m2)\n###########################################\ndf5['RFM']=df5['R_quartile']+df5['F_quartile']+df5['M_quartile']\n###########################################\ndf5","198ff0a7":"RM=[(df5['RFM']=='144'),\n(df5['RFM']=='344'),\n(df5['RFM']=='444'),\n(df5['RFM']=='441'),\n(df5['RFM']=='143'),(df5['RFM']=='142'),(df5['RFM']=='141'),(df5['RFM']=='244'),(df5['RFM']=='243'),(df5['RFM']=='242'),(df5['RFM']=='241')\n,(df5['RFM']=='342'),(df5['RFM']=='343'),(df5['RFM']=='341'),(df5['RFM']=='443'),(df5['RFM']=='442')\n,(df5['RFM']=='114'),(df5['RFM']=='124'),(df5['RFM']=='134'),(df5['RFM']=='214'),(df5['RFM']=='224'),(df5['RFM']=='234'),(df5['RFM']=='314')\n    ,(df5['RFM']=='324'),(df5['RFM']=='334'),(df5['RFM']=='414'),(df5['RFM']=='424'),(df5['RFM']=='434')]\nRM2=['Best','AlmostLost','LostBigSpenders','LostCheap','Loyal','Loyal','Loyal','Loyal','Loyal','Loyal','Loyal','Loyal','Loyal','Loyal','Loyal'\n    ,'Loyal','BigSpenders','BigSpenders','BigSpenders','BigSpenders','BigSpenders','BigSpenders','BigSpenders','BigSpenders','BigSpenders','BigSpenders'\n     ,'BigSpenders','BigSpenders']\ndf5['Segment']=np.select(RM,RM2 ,default='Normal')\ndf5","3e503a7b":"df6=df5.iloc[:,[7]]\ndf6.reset_index(inplace=True)\ndf6","f2f18668":"df_customer_segments = df6","be842afe":"# Libraries","f4307d10":"\n<\/font>\n<\/p>\n\n<div dir=rtl style=\"direction: ltr;text-align: left;line-height:200%;font-family:vazir;font-size:medium\">\n<font>\n    <ul>\n        <li><b>Group1<\/b>: value <= Q1<\/li>\n        <li><b>Group2<\/b>: Q1 &lt; value <= Q2<\/li>\n        <li><b>Group3<\/b>: Q2 &lt; value <= Q3<\/li>\n        <li><b>Group4<\/b>: Q3 &lt; value<\/li>\n    <\/ul>\n<\/font>\n<\/div>\n\n\n<\/font>\n<\/p>\n\n\n<div dir=rtl style=\"direction: ltr;text-align: left;line-height:200%;font-family:vazir;font-size:medium\">\n<font>\n    \n| CustomerID | Recency | Frequency | Monetary value| R_quartile      | F_quartile      | M_quartile      | RFM    |\n| ---------- | ------- | --------- | -------- | ------ | ------ | ------ | ------ |\n| 12346      | 325     | 1         | 77183.60 | 1      | 1      | 4      | 114    |\n| 12347      | 2       | 182       | 4310.00  | 4      | 4      | 4      | 444    |\n| 12348      | 75      | 31        | 1797.24  | 2      | 2      | 4      | 224    |\n<\/font>\n<\/div>\n\n    <br>\n<\/font>\n<\/p>\n\n\n<p dir=rtl style=\"direction: rtl;text-align: right;line-height:200%;font-family:vazir;font-size:medium\">\n<font> \n\n<\/font>\n<\/p>\n\n\n\n<div dir=rtl style=\"direction: ltr;text-align: left;line-height:200%;font-family:vazir;font-size:medium\">\n<font>\n    \n| Segment | RFM |\n|:-------------:|:------|\n| Best | 144 |\n| AlmostLost | 344 |  \n| LostBigSpenders | 444  | \n| LostCheap | 441 |\n| Loyal | X4X | \n| BigSpenders | XX4 | \n\n\n<\/font>\n<\/div>\n\n\n","177818f5":"# RFM"}}