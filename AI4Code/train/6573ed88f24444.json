{"cell_type":{"b23419bb":"code","f41981d6":"code","1020c06c":"code","e2d50454":"code","cf1c5d82":"code","606ace52":"code","1b627f15":"code","256d3673":"code","fc379645":"code","d8ce6f8e":"code","ba0ee8d4":"code","af1f04a4":"code","ea38dd23":"code","4b644d68":"code","a94c8373":"markdown","223a197b":"markdown","314d5ea5":"markdown","560300f3":"markdown","b805c962":"markdown","d2dedbc2":"markdown","745ec743":"markdown","7eddd315":"markdown","b2b2d070":"markdown","112c2919":"markdown","8c994ebe":"markdown","7ed24bc3":"markdown","364a651c":"markdown","7ad68a58":"markdown","7b90a4ff":"markdown","f36be825":"markdown","c2e9d66b":"markdown","99cd1d90":"markdown"},"source":{"b23419bb":"%%capture\n!pip uninstall -y albumentations\n!pip install -U git+https:\/\/github.com\/albumentations-team\/albumentations","f41981d6":"import cv2\nimport pathlib\n\nimport numpy as np\n\nimport albumentations as A\nimport matplotlib.pyplot as plt\n\nfrom torch.utils.data import Dataset\n\nfrom typing import List, Optional","1020c06c":"def read_image(path):\n    src = cv2.imread(path)\n    src = cv2.cvtColor(src, cv2.COLOR_BGR2RGB)\n    return src\n\ndef show_image(img, keypoints=None, title='image', rad=1, ax=None):\n    src = img.copy()\n    if keypoints is not None:\n        for i, (x, y) in enumerate(keypoints):\n            cv2.circle(src, (int(x), int(y)), rad, (0, 255, 0), -1)\n    ax = ax or plt.gca()\n    ax.set_title(title)\n    ax.imshow(src)","e2d50454":"img = read_image('\/kaggle\/input\/generated-car-plates\/generated_60k\/\u0440848\u043d\u043a23.png')\nimg.shape","cf1c5d82":"KEYPOINTS = np.array([[3, 3], [232, 3], [232, 47], [3, 47]])\nshow_image(img, keypoints=KEYPOINTS, rad=2)","606ace52":"fig, axes = plt.subplots(1, 2, figsize=(12, 5))\ntrans = (\n    (A.Downscale(p=1, scale_min=.5, scale_max=.5), axes[0], '\u0427\u0438\u0442\u0430\u0435\u043c\u044b\u0439'),\n    (A.Downscale(p=1, scale_min=.22, scale_max=.22), axes[1], '\u041d\u0435\u0447\u0438\u0442\u0430\u0435\u043c\u044b\u0439')\n)\nfor t, ax, title in trans:\n    show_image(t(image=img)['image'], title=title, ax=ax)","1b627f15":"fig, axes = plt.subplots(1, 2, figsize=(12, 5))\ntrans = (\n    (A.Blur(p=1, blur_limit=(5, 5)), axes[0], '\u0427\u0438\u0442\u0430\u0435\u043c\u044b\u0439'),\n    (A.Blur(p=1, blur_limit=(9, 9)), axes[1], '\u041d\u0435\u0447\u0438\u0442\u0430\u0435\u043c\u044b\u0439')\n)\nfor t, ax, title in trans:\n    show_image(t(image=img)['image'], title=title, ax=ax)","256d3673":"t = A.CoarseDropout(p=1, max_holes=1, max_height=50, max_width=70, min_height=20, min_width=30)\nshow_image(t(image=img)['image'], title='\u041d\u0435\u0447\u0438\u0442\u0430\u0435\u043c\u044b\u0439 (\u043f\u043e \u0443\u0441\u043b\u043e\u0432\u0438\u044e \u043a\u043e\u043d\u0442\u0435\u0441\u0442\u0430)')","fc379645":"fig, axes = plt.subplots(1, 4, figsize=(20, 5))\ntrans = (\n    (A.RandomRain(p=1, blur_value=1, rain_type='heavy'), axes[0], 'RandomRain'),\n    (A.Perspective(p=1, fit_output=True), axes[1], 'Perspective'),\n    (A.RandomFog(p=1, fog_coef_lower=.7, fog_coef_upper=.7), axes[2], 'RandomFog'),\n    (A.RandomBrightnessContrast(p=1, contrast_limit=(-.6, -.6)), axes[3], 'RandomBrightnessContrast')\n)\nfor t, ax, title in trans:\n    show_image(t(image=img)['image'], title=title, ax=ax)","d8ce6f8e":"real_t = A.Compose([\n    A.ISONoise(p=.3),\n    A.OneOf([\n        A.RandomBrightnessContrast(p=.5, contrast_limit=(-.6, -.2)),\n        A.RandomRain(p=.5, blur_value=1, rain_type='heavy')\n    ], p=1),\n    A.OneOf([\n        A.RandomFog(p=.3, fog_coef_lower=.3, fog_coef_upper=.7),\n        A.Downscale(p=.3, scale_min=.45, scale_max=.7),\n        A.Blur(p=.3, blur_limit=(3, 5))\n    ], p=1),\n    A.Perspective(p=.3, fit_output=True),\n    A.SafeRotate(limit=30, p=.8, border_mode=cv2.BORDER_CONSTANT),\n    A.RandomScale(scale_limit=0.2, p=1)\n], p=1, keypoint_params=A.KeypointParams(format='xy'))\n\nfig, axes = plt.subplots(1, 4, figsize=(20, 5))\nfor ax in axes:\n    res = real_t(image=img, keypoints=KEYPOINTS)\n    show_image(res['image'], res['keypoints'], ax=ax)","ba0ee8d4":"class CoarseDropout(A.CoarseDropout):\n     def apply_to_keypoint(self, keypoint, **params):\n        return keypoint","af1f04a4":"spoil_t = A.Compose([\n    A.OneOf([\n        A.RandomBrightnessContrast(p=.5, contrast_limit=(-.6, -.2)),\n        A.RandomRain(p=.5, blur_value=1, rain_type='heavy')\n    ], p=1),\n    A.OneOf([\n        A.Downscale(p=.4, scale_min=.15, scale_max=.22),\n        A.Blur(p=.4, blur_limit=(10, 13)),\n        CoarseDropout(p=.2, max_holes=1, max_height=50, max_width=70, min_height=20, min_width=30)\n    ], p=1),\n    A.Perspective(p=.3, fit_output=True),\n    A.SafeRotate(limit=30, p=.8, border_mode=cv2.BORDER_CONSTANT),\n    A.RandomScale(scale_limit=.5, p=1)\n], p=1, keypoint_params=A.KeypointParams(format='xy'))\n\nfig, axes = plt.subplots(1, 4, figsize=(20, 5))\nfor ax in axes:\n    res = spoil_t(image=img, keypoints=KEYPOINTS)\n    show_image(res['image'], res['keypoints'], ax=ax)","ea38dd23":"class CarPlatesDataset(Dataset):\n    \"\"\"Car plates dataset.\"\"\"\n\n    AUG = A.Compose([\n        A.ISONoise(p=.3),\n        A.OneOf([\n            A.RandomBrightnessContrast(p=.5, contrast_limit=(-.6, -.2)),\n            A.RandomRain(p=.5, blur_value=1, rain_type='heavy')\n        ], p=1),\n        A.OneOf([\n            A.RandomFog(p=.3, fog_coef_lower=.3, fog_coef_upper=.7),\n            A.Downscale(p=.3, scale_min=.45, scale_max=.7),\n            A.Blur(p=.3, blur_limit=(3, 5))\n        ], p=1),\n        A.Perspective(p=.3, fit_output=True),\n        A.SafeRotate(limit=30, p=.8, border_mode=cv2.BORDER_CONSTANT),\n        A.RandomScale(scale_limit=0.2, p=1)\n    ], p=1, keypoint_params=A.KeypointParams(format='xy'))\n\n    SPOIL = A.Compose([\n        A.OneOf([\n            A.RandomBrightnessContrast(p=.5, contrast_limit=(-.6, -.2)),\n            A.RandomRain(p=.5, blur_value=1, rain_type='heavy')\n        ], p=1),\n        A.OneOf([\n            A.Downscale(p=.4, scale_min=.15, scale_max=.22),\n            A.Blur(p=.4, blur_limit=(10, 13)),\n            CoarseDropout(p=.2, max_holes=1, max_height=50, max_width=70, min_height=20, min_width=30)\n        ], p=1),\n        A.Perspective(p=.3, fit_output=True),\n        A.SafeRotate(limit=30, p=.8, border_mode=cv2.BORDER_CONSTANT),\n        A.RandomScale(scale_limit=.5, p=1)\n    ], p=1, keypoint_params=A.KeypointParams(format='xy'))\n\n    def __init__(\n        self, \n        files: List[pathlib.PosixPath], \n        spoil_proba: float=.5, \n        transform: Optional[List[A.BasicTransform]]=None\n    ):\n        \"\"\"\n        Args:\n            files (List[PosixPath]): Pathes to the image files.\n            spoil_proba (float [0, 1)): Probability to spoil the image.\n        \"\"\"\n        self.files = files\n        self.spoil_proba = spoil_proba\n        self.transform = transform\n\n    def __len__(self):\n        return len(self.landmarks_frame)\n\n    def __getitem__(self, idx):\n        image = cv2.imread(str(self.files[idx]))\n        image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n        keypoints = np.array([[3, 3], [232, 3], [232, 47], [3, 47]])\n\n        t, label = (self.SPOIL, 0) if np.random.random() < self.spoil_proba else (self.AUG, 1)\n        augmented = t(image=image, keypoints=keypoints)\n\n        if self.transform:\n            augmented = self.transform(**augmented)\n\n        augmented['label'] = label\n        return augmented","4b644d68":"data_dir = '\/kaggle\/input\/generated-car-plates\/generated_60k'\nfiles = [\n    file_name \n    for file_name in pathlib.Path(data_dir).iterdir()\n]\ndata = CarPlatesDataset(files)\n\nlabels_mapping = {0: '\u0418\u0441\u043f\u043e\u0440\u0447\u0435\u043d\u043d\u044b\u0439', 1: '\u0427\u0438\u0442\u0430\u0435\u043c\u044b\u0439'}\nfig, axes = plt.subplots(1, 4, figsize=(20, 5))\nfor i, ax in enumerate(axes):\n    item = data[i]\n    show_image(item['image'], item['keypoints'], title=f\"{labels_mapping[item['label']]}\", ax=ax)","a94c8373":"## \u041f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 \u0447\u0438\u0442\u0430\u0435\u043c\u043e\u0441\u0442\u0438 \u043d\u043e\u043c\u0435\u0440\u0430","223a197b":"\u0412\u043d\u0435\u0437\u0430\u043f\u043d\u043e \u043e\u043a\u0430\u0437\u0430\u043b\u043e\u0441\u044c, \u0447\u0442\u043e A.CoarseDropout \u043d\u0435 \u0443\u043c\u0435\u0435\u0442 \u0432 keypoints, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u043f\u0440\u043e\u0441\u0442\u043e \u0437\u0430\u0431\u044c\u0435\u043c \u0438 \u0431\u0443\u0434\u0435\u043c \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u0442\u043e\u0447\u043a\u0438 \u043a\u0430\u043a \u0435\u0441\u0442\u044c, \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u043e\u043d\u0438 \u043f\u0435\u0440\u0435\u043a\u0440\u044b\u0432\u0430\u044e\u0442\u0441\u044f","314d5ea5":"\u041f\u043e\u0440\u0442\u044f\u0449\u0438\u0435 \u043d\u043e\u043c\u0435\u0440:","560300f3":"\u041d\u0430\u043f\u0438\u0448\u0435\u043c \u0441\u0432\u043e\u0439 \u0434\u0430\u0442\u0430\u0441\u0435\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441 \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u0439 \u0432\u0435\u0440\u043e\u044f\u0442\u043d\u043e\u0441\u0442\u044c\u044e \u043f\u043e\u0440\u0442\u0438\u0442 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443 \u0438 \u043f\u0440\u0438\u0441\u0432\u0430\u0438\u0432\u0430\u0435\u0442 \u043e\u0434\u0438\u043d \u0438\u0437 \u0434\u0432\u0443\u0445 \u043b\u0435\u0439\u0431\u043b\u043e\u0432:\n* \u041d\u0435\u0447\u0438\u0442\u0430\u0435\u043c\u044b\u0439 \u043d\u043e\u043c\u0435\u0440\n* \u0427\u0438\u0442\u0430\u0435\u043c\u044b\u0439 \u043d\u043e\u043c\u0435\u0440","b805c962":"### \u0418 \u0447\u0442\u043e \u0434\u0430\u043b\u044c\u0448\u0435?","d2dedbc2":"\u041f\u0440\u043e\u0432\u0435\u0440\u0438\u043c \u0432\u0441\u0435 \u043b\u0438 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442:","745ec743":"\u041f\u0435\u0440\u0435\u0434 \u043d\u0430\u043c\u0438 \u0441\u0442\u043e\u0438\u0442 \u0437\u0430\u0434\u0430\u0447\u0430 \u043f\u043e\u043d\u044f\u0442\u044c \u0447\u0438\u0442\u0430\u0435\u043c\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u0438\u043b\u0438 \u043d\u0435\u0442. \u041c\u043d\u0435 \u043f\u0440\u0438\u0445\u043e\u0434\u044f\u0442 \u0432 \u0433\u043e\u043b\u043e\u0432\u0443 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 \u043f\u0440\u0438\u0447\u0438\u043d\u044b \u0434\u043b\u044f \u043d\u0435\u0447\u0438\u0442\u0430\u0435\u043c\u043e\u0441\u0442\u0438 \u043d\u043e\u043c\u0435\u0440\u0430:\n1. \u0421\u043b\u0438\u0448\u043a\u043e\u043c \u043f\u043b\u043e\u0445\u043e\u0435 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u0435\n2. \u0421\u043c\u0430\u0437\u0430\u043d\u043d\u043e\u0435 \u0444\u043e\u0442\u043e (\u0438\u0437-\u0437\u0430 \u0434\u0432\u0438\u0436\u0435\u043d\u0438\u044f \u0438 \u0442.\u043f)\n3. \u041d\u043e\u043c\u0435\u0440 \u0447\u0430\u0441\u0442\u0438\u0447\u043d\u043e \u0437\u0430\u043a\u0440\u044b\u0442\n\n\u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0435\u043c \u0441\u044b\u043c\u0438\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u044d\u0442\u0438 \u043f\u0440\u0438\u0447\u0438\u043d\u044b","7eddd315":"\u0421\u043e\u0433\u043b\u0430\u0441\u043d\u043e \u0443\u0441\u043b\u043e\u0432\u0438\u044f\u043c \u0441\u043e\u0440\u0435\u0432\u043d\u043e\u0432\u0430\u043d\u0438\u044f \u0432 \u0442\u0435\u0441\u0442\u043e\u0432\u043e\u0439 \u0432\u044b\u0431\u043e\u0440\u043a\u0435 \u0431\u044b\u043b\u0438 \u0440\u0430\u0437\u043c\u0435\u0447\u0435\u043d\u044b \u0442\u043e\u043b\u044c\u043a\u043e \u0447\u0438\u0442\u0430\u0435\u043c\u044b\u0435 \u0438 \u043d\u0438\u0447\u0435\u043c \u043d\u0435 \u043f\u0435\u0440\u0435\u043a\u0440\u044b\u0442\u044b\u0435 \u043d\u043e\u043c\u0435\u0440\u0430. \u0418\u0437 \u0438\u0441\u0445\u043e\u0434\u043d\u043e\u0433\u043e \u0434\u0430\u0442\u0430\u0441\u0435\u0442\u0430 \u0443\u0437\u043d\u0430\u0442\u044c \u0447\u0438\u0442\u0430\u0435\u043c\u043e\u0441\u0442\u044c \u043d\u043e\u043c\u0435\u0440\u0430 \u043d\u0435 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u044b\u043c, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0432\u043e\u0437\u044c\u043c\u0435\u043c \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u043d\u043e\u043c\u0435\u0440\u0430 \u0438 \u0431\u0443\u0434\u0435\u043c \u0438\u0445 \u043f\u043e\u0440\u0442\u0438\u0442\u044c)","b2b2d070":"\u0421 \u043f\u043e\u0440\u0447\u0435\u0439 \u043d\u043e\u043c\u0435\u0440\u043e\u0432 \u0440\u0430\u0437\u043e\u0431\u0440\u0430\u043b\u0438\u0441\u044c, \u0442\u0435\u043f\u0435\u0440\u044c \u0445\u043e\u0442\u0435\u043b\u043e\u0441\u044c \u0431\u044b \u043f\u0440\u0435\u0432\u0440\u0430\u0442\u0438\u0442\u044c \u043d\u043e\u043c\u0435\u0440\u0430 \u0432 \u0431\u043e\u043b\u0435\u0435 \u0440\u0435\u0430\u043b\u044c\u043d\u044b\u0435. \u041c\u043d\u0435 \u043f\u0440\u0438\u0433\u043b\u044f\u043d\u0443\u043b\u0438\u0441\u044c \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 \u0442\u0440\u0430\u043d\u0441\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438:","112c2919":"\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u043d\u0430 \u0440\u0430\u0437\u043c\u0435\u0440\u044b \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f:","8c994ebe":"\u041e\u0431\u044a\u0435\u0434\u0438\u043d\u0438\u043c \u0432\u0441\u0435 \u044d\u0442\u043e \u0432 2 \u0442\u0438\u043f\u0430 \u0442\u0440\u0430\u043d\u0441\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0439","7ed24bc3":"\u041d\u0435 \u043f\u043e\u0440\u0442\u044f\u0449\u0438\u0435 \u043d\u043e\u043c\u0435\u0440:","364a651c":"\u0418\u0441\u0445\u043e\u0434\u044f \u0438\u0437 \u0440\u0430\u0437\u043c\u0435\u0440\u043e\u0432 \u0432\u044b\u0431\u0435\u0440\u0435\u043c \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u0442\u043e\u0447\u043a\u0438 \u0438 \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u0447\u0442\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u043b\u043e\u0441\u044c:","7ad68a58":"\u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 \u043c\u043e\u0436\u043d\u043e \u043d\u0430\u0442\u0440\u0435\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043a\u043b\u0430\u0441\u0441\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u0442\u044c \u043f\u043e\u0441\u043b\u0435 \u0441\u0435\u0442\u043a\u0438 \u0441 \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0435\u0439\\\u0434\u0435\u0442\u0435\u043a\u0446\u0438\u0435\u0439. \n\n\u0418\u043b\u0438 \u0436\u0435 \u0435\u0449\u0435 \u043f\u043e\u0442\u0440\u0435\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044e \u043d\u0430 \u044d\u0442\u0438\u0445 \u043d\u043e\u043c\u0435\u0440\u0430\u0445. \n\n\u0410 \u043c\u043e\u0436\u043d\u043e \u0438 \u0440\u0430\u0441\u043f\u043e\u0437\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u043e\u0442\u0440\u0435\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043d\u0430 \u0442\u0435\u0445, \u0447\u0442\u043e \u043d\u0435 \u0438\u0441\u043f\u043e\u0440\u0442\u0438\u043b\u0438\u0441\u044c - \u0440\u0435\u0448\u0430\u0442\u044c \u0432\u0430\u043c","7b90a4ff":"\u041f\u0435\u0440\u0435\u043a\u0440\u044b\u0442\u0438\u0435 \u0447\u0430\u0441\u0442\u0438 \u043d\u043e\u043c\u0435\u0440\u0430:","f36be825":"\u041f\u0430\u0440\u0443 \u0432\u0441\u043f\u043e\u043c\u043e\u0433\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0444\u0443\u043d\u043a\u0446\u0438\u0439:","c2e9d66b":"\u0421\u043c\u0430\u0437\u0430\u043d\u043d\u043e\u0435 \u0444\u043e\u0442\u043e:","99cd1d90":"\u041f\u043b\u043e\u0445\u043e\u0435 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u0435:"}}