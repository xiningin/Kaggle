{"cell_type":{"832e0db9":"code","920ea22c":"code","2f40f305":"code","ab297649":"code","1c01c9b2":"code","e969ffe5":"code","9c9dfcee":"code","d668b52a":"code","3b05e365":"code","b5f188d1":"code","f53d91c5":"code","7027f8fc":"code","2f04e4ee":"code","2131b3cd":"markdown","fe6ec1f2":"markdown","c917d2f2":"markdown","cf0866bd":"markdown","b875c5ad":"markdown","a5c3b09c":"markdown","cc64e658":"markdown","acf08b4c":"markdown","15dc12c6":"markdown","197aa225":"markdown","0ee381fa":"markdown","0be62f47":"markdown"},"source":{"832e0db9":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n# pepi\nimport os\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport pydicom \n\n\nimport missingno as msno \nfrom sklearn.metrics import roc_curve, roc_auc_score, auc\n\nbase_dir = '\/kaggle\/input\/siim-isic-melanoma-classification\/'\nexternal_base_dir = '\/kaggle\/input\/melanoma-external-malignant-256\/'\nsns.set(style=\"darkgrid\")","920ea22c":"# Helper functions to be used later\ndef add_percentage_sns(ax, total):\n    for p in ax.patches:\n        height = p.get_height()\n        ax.text(p.get_x()+p.get_width()\/2.,\n                height + 3,\n                '{:1.2f}%'.format((height\/total)*100),\n                ha=\"center\") \n        \n        ","2f40f305":"train_df = pd.read_csv(base_dir + 'train.csv')\ntest_df = pd.read_csv(base_dir + '\/test.csv')\ntrain_df.head(10)","ab297649":"train_df.isna().sum().sort_values(ascending=False)","1c01c9b2":"\nf, (ax1, ax2, ax3) = plt.subplots(1, 3, figsize = (25, 6))\n\nmsno.bar(train_df, ax = ax1)\nmsno.matrix(train_df, ax = ax2, color=(207\/255, 196\/255, 171\/255), fontsize=10)\nmsno.matrix(test_df, ax = ax3, color=(218\/255, 136\/255, 130\/255), fontsize=10)\n\nax1.set_title('Train Missing Values Bar Chart', fontsize = 16)\nax2.set_title('Train Missing Values Map', fontsize = 16)\nax3.set_title('Test Missing Values Map', fontsize = 16);","e969ffe5":"unique_patients_train = train_df.drop_duplicates('patient_id')\nplt.figure(figsize=(6,6))\nax = sns.countplot(x=\"sex\", hue=\"sex\", data=unique_patients_train)\nax.legend(loc='upper center')\nadd_percentage_sns(ax, unique_patients_train.shape[0])","9c9dfcee":"plt.xticks(rotation=90)\nsns.countplot(train_df['age_approx'], color='blue')","d668b52a":"plt.figure(figsize=(10,10))\nunique_patients_train = train_df.drop_duplicates('patient_id')\nunique_patients_train.shape[0]\nsns.distplot(train_df['patient_id'].value_counts(), kde=True, color='blue')","3b05e365":"fig, ax = plt.subplots(3,2,figsize=(16,23))\n\nsns.barplot(x=train_df['anatom_site_general_challenge'].value_counts().sort_values(ascending=False).index.values,\n            y=train_df['anatom_site_general_challenge'].value_counts().sort_values(ascending=False).values,\n            ax=ax[0,0])\nax[0,0].set_xticklabels(ax[0,0].get_xticklabels(), rotation=20, ha='right')\nadd_percentage_sns(ax[0,0], train_df.shape[0])\nax[0,0].set_title(\"Distribution of the location\")\n\n\nsns.countplot(train_df['diagnosis'], ax=ax[1,0])\nax[1,0].set_xticklabels(ax[1,0].get_xticklabels(), rotation=20, ha='right')\nadd_percentage_sns(ax[1,0], train_df.shape[0])\nax[1,0].set_title(\"Distribution of the diagnosis\")\n\n\nsns.countplot(train_df['benign_malignant'], ax=ax[2,0])\nax[2,0].set_xticklabels(ax[2,0].get_xticklabels(), rotation=20, ha='right')\nadd_percentage_sns(ax[2,0], train_df.shape[0])\nax[2,0].set_title(\"Distribution of malignality\")\n\nsns.boxplot(train_df['benign_malignant'], train_df['age_approx'], ax=ax[2,1], palette=\"Greens\");\nax[2,1].set_title(\"Age and cancer\");\n","b5f188d1":"path_train = base_dir + '\/train\/' + train_df['image_name'] + '.dcm'\npath_test = base_dir + '\/test\/' + test_df['image_name'] + '.dcm'\n\ntrain_df['path_dicom'] = path_train\ntest_df['path_dicom'] = path_test\n\npath_train = base_dir + '\/jpeg\/train\/' + train_df['image_name'] + '.jpg'\npath_test = base_dir + '\/jpeg\/test\/' + test_df['image_name'] + '.jpg'\n\ntrain_df['path_jpeg'] = path_train\ntest_df['path_jpeg'] = path_test","f53d91c5":"def show_images(data, n = 5, rows=1, cols=5, title='Default'):\n    plt.figure(figsize=(16,4))\n\n    for k, path in enumerate(data['path_dicom'][:n]):\n        image = pydicom.read_file(path)\n        image = image.pixel_array\n        \n        # image = resize(image, (200, 200), anti_aliasing=True)\n\n        plt.suptitle(title, fontsize = 16)\n        plt.subplot(rows, cols, k+1)\n        plt.imshow(image)\n        plt.axis('off')","7027f8fc":"show_images(train_df[train_df['target'] == 1], n=10, rows=2, cols=5, title='Malign Sample')","2f04e4ee":"show_images(train_df[train_df['target'] == 0], n=10, rows=2, cols=5, title='Benign Sample')","2131b3cd":"![image.png](attachment:image.png)\nAnother interesting thing that we can see in the figure above is that there isn't a distinguishible diference between the location where the images were taken, relative to the sex of our patients!\n\nLet us now look at some other features","fe6ec1f2":"Here are some nice numbers, but it is easier for a human to understand this in the following way:\n","c917d2f2":"\n\n![image.png](attachment:image.png)\nThis figure can show that there seems to be a slightly higher percentage of women with positive malignant images than for men. This may, like we saw before, relate to our data having a higher count of older men than women. It is also possible to see that none of our images from patients who did not provide their sex are from cancerigenous lesions.\n","cf0866bd":"There is a lot that we can learn from these plots\n\n* We clearly have a lot more data on the torso region, while the oral\/genital and palms\/soles are very rare on our training data.\n* Only 0.02% of our images actually report malignant lesions.\n    * This means that we might need to do some data augmentation, worry about metrics such as accuracy.\n* Although we have 9 possible classes for the diagnosis of the lesion, we have very little information about most of these classes.\n","b875c5ad":"It is easy to see that we have some null values but nothing out of this world, especially compared to the actual dataset size - 33.126 images of 2.056 different patients! Now we can try to see some interesting information about each of these features We will first analyse the simpler information, age and sex!\n\n","a5c3b09c":"It is easy to retrieve some insights:\n\n* We have more male patients although the difference is not that large\n* We have an age distribution that is very normally distributed\n\n\n![image.png](attachment:image.png)\nWe can already see some outliers, such as only two images that were taken of patients with ages from 0-5, as well as some patients for which we do not have the age nor their sex.\nAlso we can see that there are some accentuated diferences in the ages compared to the sex of our patients, we have much larger percentage of women over the age of 90. It also seems like for the earlier ages, from 10 to 40, there is a much larger presence of feminine images.\n\n","cc64e658":"We have several columns but some of these might not be interesting for now such as the image name, the patient id and the target (since we can use the benign malignant column).\nIt is also needed to check how much of our information is nulled\/outliers.","acf08b4c":"# 1. Data Analysis\nWe must first understand what data we have and how it is distributed before actually developing anything, the most important part of Data Science!\nTo do this we will be using both python frameworks such as pyplot and seaborn, but also Tableau for some more in depth visualisations. \n\nLet's see what metadata we have about our pacients!\n\n","15dc12c6":"## 1.1 Data exploration and Null values","197aa225":"\n\n\n![image.png](attachment:image.png)\nIn the image above it is possible to see that there seems to be a very direct correlation between the age of the patients when the image was taken and the possiblity of it being of a malignant lesion, meaning this feature can provide us with some information for the future. Also none of the patients with no data about age ended up testing positive for a malignant melanoma.\n","0ee381fa":"## 1.2 Age and Sex\n","0be62f47":"We have only 2056 different patients, where for most of them we have from 1 to 20 images, while for some others we have over 100 images.\n"}}