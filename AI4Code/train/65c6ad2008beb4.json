{"cell_type":{"92514ea6":"code","56582e81":"code","ea4c405b":"code","69a826e5":"code","f7996d79":"code","5f932f0f":"code","e8134ff7":"code","6cd99ab9":"code","a1732766":"code","52d01ab9":"code","dd9ce98a":"code","ee163983":"code","1baaead1":"code","f19d3b26":"code","fd354fdd":"code","9b808ea6":"code","36c9980c":"code","4af823e0":"code","8b6f9142":"code","f227fe45":"code","e81fb88b":"code","3386715d":"code","d193b5bf":"code","85132091":"code","e8ea99be":"code","bc488178":"code","01863f2f":"code","1e4ad317":"code","db4e20d7":"code","08ca7a1b":"code","1496d24b":"code","25837d1b":"code","9d2bf7cf":"code","14ce56f1":"code","4bbefb93":"code","57139e4c":"code","c2f48b41":"code","9deca448":"code","78d49dd1":"code","4c86cb6e":"code","aecfa00d":"markdown","d14a1141":"markdown","9bc230f0":"markdown","50e339e5":"markdown"},"source":{"92514ea6":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","56582e81":"# import some libraries\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set()\n%matplotlib inline","ea4c405b":"# !pip3 install fbprophet","69a826e5":"from fbprophet import Prophet\nfrom fbprophet.diagnostics import cross_validation\nfrom fbprophet.diagnostics import performance_metrics","f7996d79":"block_0_df = pd.read_csv(\"..\/input\/halfhourly_dataset\/halfhourly_dataset\/block_0.csv\")","5f932f0f":"block_0_df.head()","e8134ff7":"block_0_df.dtypes","6cd99ab9":"# set tstp to index with datetime type\nblock_0_df = block_0_df.set_index(\"tstp\")\nblock_0_df.index = block_0_df.index.astype(\"datetime64\")","a1732766":"# set energy consumption data to float type\nblock_0_df = block_0_df[block_0_df[\"energy(kWh\/hh)\"] != \"Null\"]\nblock_0_df[\"energy(kWh\/hh)\"] = block_0_df[\"energy(kWh\/hh)\"].astype(\"float64\")","52d01ab9":"# Choose only 1 house by LCLid \"MAC000002\"\nblock_0_df = block_0_df[block_0_df[\"LCLid\"] == \"MAC000002\" ]","dd9ce98a":"# plot energy consumption data with dataframe module\nblock_0_df.plot(y=\"energy(kWh\/hh)\", figsize=(12, 4))","ee163983":"train_size = int(0.8 * len(block_0_df))\nX_train, X_test = block_0_df[:train_size].index, block_0_df[train_size:].index\ny_train, y_test = block_0_df[:train_size][\"energy(kWh\/hh)\"].values, block_0_df[train_size:][\"energy(kWh\/hh)\"].values","1baaead1":"train_df = pd.concat([pd.Series(X_train), pd.Series(y_train)], axis=1, keys=[\"ds\", \"y\"])\ntest_df = pd.concat([pd.Series(X_test), pd.Series([0]*len(y_test))], axis=1, keys=[\"ds\", \"y\"])\nanswer_df = pd.concat([pd.Series(X_test), pd.Series(y_test)], axis=1, keys=[\"ds\", \"y\"])","f19d3b26":"# make model with Prophet by Facebook\nmodel = Prophet()\nmodel.fit(train_df)","fd354fdd":"forecast = model.predict(test_df)","9b808ea6":"forecast.head()","36c9980c":"model.plot(forecast)","4af823e0":"# with plot_components method, we can visualize the data components\nmodel.plot_components(forecast)","8b6f9142":"# Analysis with cross validation method\n# This cell takes some minutes.\ndf_cv = cross_validation(model, horizon=\"60 days\")\ndf_cv.head()","f227fe45":"# With performance_metrics, we can visualize the score\ndf_p = performance_metrics(df_cv)\ndf_p","e81fb88b":"plt.plot(answer_df[\"ds\"], answer_df[\"y\"])\nplt.plot(forecast[\"ds\"], forecast[\"yhat\"])","3386715d":"# We have to add week and month seasonality\nmodel = Prophet(weekly_seasonality=True)\nmodel.add_seasonality(name=\"monthly\", period=30.5, fourier_order=5)\nmodel.fit(train_df)","d193b5bf":"forecast = model.predict(test_df)\nforecast.head()","85132091":"model.plot(forecast)","e8ea99be":"model.plot_components(forecast)","bc488178":"# add daily seasonality\nmodel = Prophet(weekly_seasonality=True, daily_seasonality=True, yearly_seasonality=True, growth=\"logistic\")\nmodel.add_seasonality(name=\"monthly\", period=30.5, fourier_order=5)\ntrain_df[\"cap\"] = 0.25\ntrain_df[\"floor\"] = 0.1\nmodel.fit(train_df)","01863f2f":"test_df[\"cap\"] = 0.25\ntest_df[\"floor\"] = 0.1\nforecast = model.predict(test_df)\nforecast.head()","1e4ad317":"model.plot(forecast)","db4e20d7":"model.plot_components(forecast)","08ca7a1b":"df_cv = cross_validation(model, horizon=\"60 days\")\ndf_cv.head()","1496d24b":"df_p = performance_metrics(df_cv)\ndf_p","25837d1b":"plt.figure(figsize=(12, 4))\nplt.plot(answer_df[\"ds\"], answer_df[\"y\"])\nplt.plot(forecast[\"ds\"], forecast[\"yhat\"])","9d2bf7cf":"holiday_df = pd.read_csv(\"..\/input\/uk_bank_holidays.csv\", names=(\"ds\", \"holiday\"), header=0)\nholiday_df.head()","14ce56f1":"# add daily seasonality\nmodel = Prophet(weekly_seasonality=True, daily_seasonality=True, yearly_seasonality=True, \n                growth=\"logistic\", holidays=holiday_df, changepoint_prior_scale=0.2)\nmodel.add_seasonality(name=\"monthly\", period=30.5, fourier_order=5)\ntrain_df[\"cap\"] = 0.25\ntrain_df[\"floor\"] = 0.1\nmodel.fit(train_df)","4bbefb93":"test_df[\"cap\"] = 0.25\ntest_df[\"floor\"] = 0.1\nforecast = model.predict(test_df)\nforecast.head()","57139e4c":"model.plot(forecast)","c2f48b41":"model.plot_components(forecast)","9deca448":"df_cv = cross_validation(model, horizon=\"60 days\")\ndf_cv.head()","78d49dd1":"df_p = performance_metrics(df_cv)\ndf_p","4c86cb6e":"plt.figure(figsize=(12, 4))\nplt.plot(answer_df[\"ds\"], answer_df[\"y\"])\nplt.plot(forecast[\"ds\"], forecast[\"yhat\"])","aecfa00d":"# Smart Home Energy Analysis with Prophet\nThis kernel focuses  on these things\n* ## Time Series Analysis with Prophet\n* ## Data Visualization with seaborn\n\nFor my dataset, I use \"smart-meters-in-London\" dataset. Thank you for this great dataset.\n","d14a1141":"## Basic Prediction with Prophet","9bc230f0":"## More advanced model with Prophet","50e339e5":"# 1 House Analysis\nFrom now on, I use only 1 house data for my analysis"}}