{"cell_type":{"2f0102e4":"code","d929e78d":"code","84cdecea":"code","8dec03b2":"code","7e75f953":"code","d570ee67":"code","8a6efba7":"code","7967c5ea":"code","c2254320":"code","6a4cf858":"code","878d8317":"code","9d8b71e4":"code","26a5c872":"code","0420e9d2":"code","06f6c7ba":"code","ee992d17":"code","ada39f6f":"code","1b9ac730":"code","f267dc8f":"code","d4c43ef2":"code","197bbc38":"code","491afe54":"code","4c133b99":"code","510eace7":"code","406a2014":"code","3effbe33":"code","10f59bf6":"code","35de1421":"code","fc4bf970":"code","762b3d46":"code","a1018a2c":"code","35e22b10":"code","1dbcdc38":"code","31878df2":"code","7d241794":"code","cba9ee7c":"code","ec417373":"code","6ba40d9e":"code","71eef8a5":"code","b09127f1":"code","b3732fb7":"code","d4123d34":"code","229fb28c":"code","0d94a838":"code","196b84d2":"code","7cbc0873":"code","d1541e3a":"code","74435195":"code","081284a1":"code","2063b84c":"code","aa5fc1da":"code","3b6170ae":"code","638c2f77":"code","6fc4c91a":"code","e0ea6881":"code","1b757916":"code","7062d6cd":"code","8b570b77":"code","2d6340df":"code","000bedc5":"code","6e4628cb":"code","effdca1a":"code","15daf86d":"code","72df6d7e":"code","d77761d1":"code","f2c7d369":"code","82887a76":"code","7d1df8f7":"code","7874c544":"code","58d8573d":"code","7da8cd8b":"code","0fd24476":"code","692ab50a":"code","75dc8d92":"code","ed2ae950":"code","836ef45e":"code","9f8e65b4":"code","c6023a43":"code","49f57dfa":"code","a3a820fc":"code","f41b6321":"code","5f202017":"code","3d469d25":"code","91c3fd53":"code","b9be1c7f":"code","c8b01c9a":"code","0a2867c8":"code","65732568":"code","9eeb97e1":"code","df28638e":"code","c94b0404":"code","5aa229f7":"code","26e8b396":"code","5e931c89":"code","6c12162e":"code","62a102fa":"code","c293fab3":"code","21968dda":"code","895f37d3":"code","41286f71":"code","24b59bdd":"code","29d1afeb":"markdown"},"source":{"2f0102e4":"import pandas as pd\npd.set_option('display.max_columns', None)\npromo=pd.read_csv('..\/input\/promo-abuse-detection-for-payment-apps\/Promo_Abuse_Detection_Dataset.csv')\npromo.head()","d929e78d":"promo.nunique().sort_values(ascending=False)","84cdecea":"promo['UserId'].value_counts().sort_values(ascending=False)[:1] #abuse detected","8dec03b2":"promo[promo['UserId']==13341428].head()","7e75f953":"promo.loc[promo['Unnamed: 0'] == 16, \"Target\"] = 0\npromo.loc[promo['Unnamed: 0'] == 17, \"Target\"] = 1\npromo[promo['UserId']==13341428].head()","d570ee67":"promo['Device Id'].value_counts().sort_values(ascending=False)[:1]#abuse detected","8a6efba7":"fix=promo[promo['Device Id']=='iosvd:++djsadjscior34728128MSASCDMVERww38rmbe8=:2537']\nfix.head()","7967c5ea":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","c2254320":"promo.loc[promo['Unnamed: 0'] == 950, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Device Id']=='iosvd:++djsadjscior34728128MSASCDMVERww38rmbe8=:2537']","6a4cf858":"promo['Ref PC AC Number'].value_counts().sort_values(ascending=False)[:6]#abuse detected","878d8317":"fix=promo[promo['Ref PC AC Number']=='IN312XXXXX1298']\nfix.head()","9d8b71e4":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","26a5c872":"promo.loc[promo['Unnamed: 0'] == 656, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN312XXXXX1298']","0420e9d2":"fix=promo[promo['Ref PC AC Number']=='IN312XXXXX1299']\nfix.head()","06f6c7ba":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","ee992d17":"promo.loc[promo['Unnamed: 0'] == 666, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN312XXXXX1299']","ada39f6f":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1188']\nfix.head()","1b9ac730":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","f267dc8f":"promo.loc[promo['Unnamed: 0'] == 19, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1188']","d4c43ef2":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1190']\nfix.head()","197bbc38":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","491afe54":"promo.loc[promo['Unnamed: 0'] == 678, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1190']","4c133b99":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1186']\nfix.head()","510eace7":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","406a2014":"promo.loc[promo['Unnamed: 0'] == 18, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1186']","3effbe33":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1185']\nfix.head()","10f59bf6":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","35de1421":"promo.loc[promo['Unnamed: 0'] == 658, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1185']","fc4bf970":"promo['Name']=promo['FirstName']+' '+promo['LastName']\npromo.nunique().sort_values(ascending=False)","762b3d46":"promo=promo.drop(['FirstName','LastName'],axis=1)\npromo.head()","a1018a2c":"promo['Name'].value_counts().sort_values(ascending=False)[:6]#abuse detected","35e22b10":"fix=promo[promo['Name']=='amit kumar']\nfix.head()","1dbcdc38":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","31878df2":"promo.loc[promo['Unnamed: 0'] == 595, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='amit kumar']","7d241794":"fix=promo[promo['Name']=='akash gupta']\nfix.head()","cba9ee7c":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","ec417373":"promo.loc[promo['Unnamed: 0'] == 822, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='akash gupta']","6ba40d9e":"fix=promo[promo['Name']=='rohit kumar']\nfix.head()","71eef8a5":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","b09127f1":"promo.loc[promo['Unnamed: 0'] == 886, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='rohit kumar']","b3732fb7":"fix=promo[promo['Name']=='raman ralhan']\nfix.head()","d4123d34":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","229fb28c":"promo.loc[promo['Unnamed: 0'] == 456, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='raman ralhan']","0d94a838":"fix=promo[promo['Name']=='sunil kumar']\nfix.head()","196b84d2":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","7cbc0873":"promo.loc[promo['Unnamed: 0'] == 490, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='sunil kumar']","d1541e3a":"round(promo.Name.isnull().sum()*100\/len(promo),2)","74435195":"promo[['Name']]=promo[['Name']].fillna('Unknown')\nfix=promo[promo['Name']=='Unknown']#abuse detected as posssibility of hacker expected.\nfix.head()","081284a1":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)\nlen(i)","2063b84c":"for j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo.head()","aa5fc1da":"round(promo.Target.isnull().sum()*100\/len(promo),2)","3b6170ae":"promo.Target=promo.Target.fillna(0)\nround(promo.Target.value_counts()*100\/len(promo),2)","638c2f77":"promo[['Sim_OS','Sim_Info','Sim_User']] = promo['Sim Id'].str.split(':',expand=True)\npromo.head()","6fc4c91a":"promo[['Device_OS','Device_Info','Device_User']] = promo['Device Id'].str.split(':',expand=True)\npromo.head()","e0ea6881":"promo=promo.drop(['Device Id','Sim Id'],axis=1)\npromo.head()","1b757916":"promo[['LastLoginTime','PresentLoginTime']].info()","7062d6cd":"promo['LastLoginTime']=promo['LastLoginTime'].replace('01-01-1900 00:00','00:00:00')\npromo['LastLoginTime'].unique()","8b570b77":"promo[['LastLoginTime_HH','LastLoginTime_MM','LastLoginTime_SS']] = promo['LastLoginTime'].str.split(':',expand=True)\npromo.head()","2d6340df":"promo[['PresentLoginTime_HH','PresentLoginTime_MM','PresentLoginTime_SS']] = promo['PresentLoginTime'].str.split(':',expand=True)\npromo.head()","000bedc5":"promo=promo.drop(['LastLoginTime','PresentLoginTime'],axis=1)\npromo.head()","6e4628cb":"promo[['Meta Data_1','Meta Data_2','Meta Data_3','Meta Data_4']] =promo['Meta Data'].str.split('-',expand=True)\npromo.head()","effdca1a":"promo[['Email_user','Email_Domain']] =promo['Email'].str.split('@',expand=True)\npromo.head()","15daf86d":"promo=promo.drop(['Email','Meta Data'],axis=1)\npromo.head()","72df6d7e":"promo[['Reg Client IP_1','Reg Client IP_2','Reg Client IP_3','Reg Client IP_4']] =promo['Reg Client IP'].str.split('.',expand=True)\npromo.head()","d77761d1":"promo=promo.drop(['Unnamed: 0','Reg Client IP'],axis=1)\npromo.head()","f2c7d369":"promo.nunique().sort_values(ascending=False)","82887a76":"promo=promo.drop(['ProgramId','ProgramName','Meta Data_1','Meta Data_3','Status','Email_Domain','BadTryCount'],axis=1)\npromo.head()","7d1df8f7":"promo['Reg Referral Code']=promo['Reg Referral Code'].str.strip().str[-3:]\npromo['Reg Referral Code'].head()","7874c544":"promo['RegisteredOn']=pd.to_datetime(promo['RegisteredOn'])\npromo['Dob']=pd.to_datetime(promo['Dob'])\npromo.head()","58d8573d":"promo.info()","7da8cd8b":"promo[['UserId','Mobile','PostalCode']]=promo[['UserId','Mobile','PostalCode']].astype(object)\npromo.info()","0fd24476":"promo.nunique().sort_values(ascending=False)","692ab50a":"promo.columns","75dc8d92":"promo.info()","ed2ae950":"(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","836ef45e":"promo[['Reg Referral Code','Reg Referral Prefix']]=promo[['Reg Referral Code',\n                                                                 'Reg Referral Prefix']].fillna('Unknown')\n(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","9f8e65b4":"promo.Gender.value_counts()","c6023a43":"promo['Gender']=promo['Gender'].fillna('U')\n(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","49f57dfa":"promo.nunique().sort_values(ascending=False)","a3a820fc":"promo.Name.value_counts()[:5]","f41b6321":"!pip install pycaret","5f202017":"promo.nunique().sort_values(ascending=False)*100\/len(promo)","3d469d25":"promo.columns\n","91c3fd53":"promo.info()","b9be1c7f":"promo.nunique().sort_values(ascending=False)","c8b01c9a":"!pip install pandas-profiling","0a2867c8":"from pandas_profiling import ProfileReport\nProfileReport(promo, title=\"EDA Report\")","65732568":"data = promo.sample(frac=0.8, random_state=42)\ndata_unseen = promo.drop(data.index)\ndata.reset_index(inplace=True, drop=True)\ndata_unseen.reset_index(inplace=True, drop=True)\nprint('Data for Modeling: ' + str(data.shape))","9eeb97e1":"print('Unseen Data For Predictions: ' + str(data_unseen.shape))","df28638e":"from pycaret.classification import *\npromo= setup(data =data, session_id=42,\n             target = 'Target',\n                  normalize = True, \n                  transformation = True, \n                  log_experiment = True,\n                  remove_multicollinearity = True, #rop one of the two features that are highly correlated with each other\n                  date_features=['RegisteredOn','Dob'],\n            categorical_features=[ 'Gender', 'UserId', 'Mobile', 'PostalCode',\n       'OS Type', 'Reg Referral Code', 'Reg Referral Prefix',\n       'Ref PC AC Number', 'Name', 'Sim_OS', 'Sim_Info', 'Sim_User',\n       'Device_OS', 'Device_Info', 'Device_User', 'LastLoginTime_HH',\n       'LastLoginTime_MM', 'LastLoginTime_SS', 'PresentLoginTime_HH',\n       'PresentLoginTime_MM', 'PresentLoginTime_SS', 'Meta Data_2',\n       'Meta Data_4', 'Email_user', 'Reg Client IP_1', 'Reg Client IP_2',\n       'Reg Client IP_3', 'Reg Client IP_4'],\n            high_cardinality_features =[ 'UserId', 'Mobile', 'PostalCode',\n       'OS Type', 'Reg Referral Code',\n       'Ref PC AC Number', 'Name', 'Sim_User',\n        'Device_User', 'LastLoginTime_HH',\n       'LastLoginTime_MM', 'LastLoginTime_SS', 'PresentLoginTime_HH',\n       'PresentLoginTime_MM', 'PresentLoginTime_SS',\n       'Meta Data_4', 'Email_user', 'Reg Client IP_1', 'Reg Client IP_2',\n       'Reg Client IP_3', 'Reg Client IP_4']  ,         \n            train_size = 0.8)","c94b0404":"lr = create_model('lr')","5aa229f7":"print(lr)","26e8b396":"tuned_lr = tune_model(lr,optimize = 'Precision')","5e931c89":"plot_model(tuned_lr, plot = 'auc')","6c12162e":"plot_model(tuned_lr, plot = 'pr')","62a102fa":"plot_model(tuned_lr, plot='feature')","c293fab3":"plot_model(tuned_lr, plot = 'confusion_matrix')","21968dda":"evaluate_model(tuned_lr)","895f37d3":"predict_model(tuned_lr)","41286f71":"unseen_predictions = predict_model(tuned_lr, data=data_unseen)\nunseen_predictions.head()","24b59bdd":"print(\"Confidence Score :   {}\".format(round(unseen_predictions.Score.mean(),2)))#Confidence Score","29d1afeb":"There are few considerations , we are working with.\n- A device can be use once\n- Cashback to same account more than once is an abuse\n- Name with same email ID is an abuse"}}