{"cell_type":{"6de33277":"code","77501a25":"code","0d4bdddc":"code","69bb1be3":"code","ec617712":"code","42b0c9df":"code","d8809696":"code","0a2fa6a7":"code","e1235d8f":"code","0d858cbc":"code","cf373d6b":"code","54fb3b04":"code","742be852":"code","29f6a816":"code","35a4dfd5":"code","0b0797fc":"code","e6e901e2":"code","5fa107e1":"code","d339ff62":"code","3528f2d7":"code","7ac60ab8":"code","4d451a5c":"code","91314080":"code","caef2dd0":"code","b4a8651d":"code","1dfb9e81":"code","751a2efb":"code","b45cf6b0":"code","475c1290":"code","67889f6e":"code","84e9f03f":"markdown","e399f5ec":"markdown","896d13d6":"markdown","47c7784c":"markdown","68b3cc1f":"markdown","557eaec6":"markdown","5f196b07":"markdown","3b03a428":"markdown"},"source":{"6de33277":"import datetime\nimport os\nimport numpy as np\nimport pandas as pd\nfrom scipy import stats\nfrom pandas.io import gbq\nimport geopandas as gpd\nfrom shapely import wkt\nimport matplotlib.pyplot as plt\nimport urllib\nimport gmaps\nimport json\nfrom IPython.display import Image\nimport os\n!ls ..\/input","77501a25":"data = pd.read_csv(\"..\/input\/new-york-city-airbnb-open-data\/AB_NYC_2019.csv\")\ndata.info()","0d4bdddc":"df_exp = data.groupby(['neighbourhood_group'])[[\"price\", \"host_id\", \"name\", \"neighbourhood\", \"room_type\", \"latitude\",\n                                                \"longitude\", \"minimum_nights\", \"number_of_reviews\"]]\\\n.agg(lambda x: {\n    \"price\": x[\"price\"].max(),\n    \"host_id\": x.loc[x[\"price\"]==x[\"price\"].max(), \"host_id\"].iloc[0],\n    \"name\": x.loc[x[\"price\"]==x[\"price\"].max(), \"name\"].iloc[0],\n    \"neighbourhood\": x.loc[x[\"price\"]==x[\"price\"].max(), \"neighbourhood\"].iloc[0],\n    \"room_type\": x.loc[x[\"price\"]==x[\"price\"].max(), \"room_type\"].iloc[0],\n    \"latitude\": x.loc[x[\"price\"]==x[\"price\"].max(), \"latitude\"].iloc[0],\n    \"longitude\": x.loc[x[\"price\"]==x[\"price\"].max(), \"longitude\"].iloc[0],\n    \"minimum_nights\": x.loc[x[\"price\"]==x[\"price\"].max(), \"minimum_nights\"].iloc[0],\n    \"number_of_reviews\": x.loc[x[\"price\"]==x[\"price\"].max(), \"number_of_reviews\"].iloc[0]\n})","69bb1be3":"df_exp.head()","ec617712":"plt.figure(figsize=(18,15))\nurl=urllib.request.urlopen('https:\/\/upload.wikimedia.org\/wikipedia\/commons\/e\/ec\/Neighbourhoods_New_York_City_Map.PNG')\nmap_nyc=plt.imread(url)\nplt.imshow(map_nyc,zorder=0,extent=[-74.258, -73.7, 40.49,40.92])\nax=plt.gca()\ndf_exp.plot(kind='scatter', x='longitude', y='latitude', c='price', ax=ax, \n           cmap=plt.get_cmap('Spectral'), colorbar=True, alpha=1.0, zorder=10, s=80)\nfor i, txt in enumerate(df_exp.room_type):\n    ax.annotate(txt, (df_exp.longitude[i], df_exp.latitude[i]), xytext=(-20, 20),\n        textcoords='offset points', ha='right', va='bottom',\n        bbox=dict(boxstyle='round,pad=0.5', fc='yellow', alpha=0.5),\n        arrowprops=dict(arrowstyle = '->', connectionstyle='arc3,rad=0'))\nfor i, txt in enumerate(df_exp.neighbourhood):\n    ax.annotate(txt, (df_exp.longitude[i], df_exp.latitude[i]), ha='right', va='bottom', color='blue', \n               alpha=1.0, fontsize=15, weight='bold')\nplt.title(\"Most Expensive Airbnb For Each Neighbourhood\")\nplt.show()","42b0c9df":"from math import radians, cos, sin, asin, sqrt\n\ndef haversine(lon1, lat1, lon2, lat2):\n    \"\"\"\n    Calculate the great circle distance between two points \n    on the earth (specified in decimal degrees)\n    \"\"\"\n    # convert decimal degrees to radians \n    lon1, lat1, lon2, lat2 = map(radians, [lon1, lat1, lon2, lat2])\n\n    # haversine formula \n    dlon = lon2 - lon1 \n    dlat = lat2 - lat1 \n    a = sin(dlat\/2)**2 + cos(lat1) * cos(lat2) * sin(dlon\/2)**2\n    c = 2 * asin(sqrt(a)) \n    r = 6371 # Radius of earth in kilometers. Use 3956 for miles\n    return c * r","d8809696":"data.boxplot(column='price', by='neighbourhood_group', figsize=(12,8), showfliers=False, grid=False)","0a2fa6a7":"df_median = data.groupby(['neighbourhood_group'])['price'].median()","e1235d8f":"data_aff = data.loc[data.apply(lambda x: x[\"price\"] <= df_median.loc[x[\"neighbourhood_group\"]], axis=1)]","0d858cbc":"data_aff.groupby(['neighbourhood_group', 'room_type'])['id'].count()","cf373d6b":"office_coord = [{'lat': 40.7103, 'lng': -74.0123}]\n\ndef return_in_out(x):\n\n    aff_airbnb_coord = [{'lat': x.latitude, 'lng': x.longitude}]\n\n    lat1 = office_coord[0]['lat']\n    lon1 = office_coord[0]['lng']\n    lat2 = aff_airbnb_coord[0]['lat']\n    lon2 = aff_airbnb_coord[0]['lng']\n\n    radius = 1.6 # in kilometer\n\n    a = haversine(lon1, lat1, lon2, lat2)\n\n    if a <= radius:\n        return 'Inside'\n    return 'Outside'","54fb3b04":"data_aff['range'] = data_aff.apply(return_in_out, axis=1)","742be852":"df_within_range = data_aff[data_aff.range=='Inside']\ndf_within_range.shape","29f6a816":"df_within_range_good_quality = df_within_range[df_within_range.number_of_reviews>df_within_range.number_of_reviews.mean()]\ndf_within_range_good_quality.shape","35a4dfd5":"df_within_range_good_quality.groupby(['room_type'])['id'].count()","0b0797fc":"df_shared = df_within_range_good_quality[df_within_range_good_quality.room_type=='Shared room']","e6e901e2":"all_info = (df_shared[[\"name\", \"price\", \"number_of_reviews\", \"neighbourhood\", 'latitude', 'longitude']].to_dict(orient=\"records\"))\nall_info = [((x[\"latitude\"], x[\"longitude\"]), x) for x in (all_info)]","5fa107e1":"airbnb_lat_long = [x[0] for x in all_info]\n\n\ninfo_box_template = \"\"\"\n<dl>\n<dt>Name<\/dt><dd>{name}<\/dd>\n<dt>Price<\/dt><dd>{price}<\/dd>\n<dt>Number of reviews<\/dt><dd>{number_of_reviews}<\/dd>\n<dt>Neighbourhood<\/dt><dd>{neighbourhood}<\/dd>\n<\/dl>\n\"\"\"\n\nairbnb_info = [info_box_template.format(**info) for info in ([x[1] for x in all_info])]","d339ff62":"office_location = gmaps.symbol_layer([(40.7103, -74.0123)], fill_color='blue', stroke_color='blue', scale=6)\nshared_airbnbs = gmaps.symbol_layer(airbnb_lat_long, \n                                 fill_color='red', stroke_color='red', scale=3, info_box_content=airbnb_info)\nfig = gmaps.figure()\nfig.add_layer(office_location)\nfig.add_layer(shared_airbnbs)\nfig","3528f2d7":"Image(\"..\/input\/gmaps-airbnb\/Screen Shot 2019-09-21 at 12.00.46 PM.png\")","7ac60ab8":"df_shared = df_within_range_good_quality[df_within_range_good_quality.room_type=='Private room']","4d451a5c":"all_info = (df_shared[[\"name\", \"price\", \"number_of_reviews\", \"neighbourhood\", 'latitude', 'longitude']].to_dict(orient=\"records\"))\nall_info = [((x[\"latitude\"], x[\"longitude\"]), x) for x in (all_info)]","91314080":"airbnb_lat_long = [x[0] for x in all_info]\n\n\ninfo_box_template = \"\"\"\n<dl>\n<dt>Name<\/dt><dd>{name}<\/dd>\n<dt>Price<\/dt><dd>{price}<\/dd>\n<dt>Number of reviews<\/dt><dd>{number_of_reviews}<\/dd>\n<dt>Neighbourhood<\/dt><dd>{neighbourhood}<\/dd>\n<\/dl>\n\"\"\"\n\nairbnb_info = [info_box_template.format(**info) for info in ([x[1] for x in all_info])]","caef2dd0":"office_location = gmaps.symbol_layer([(40.7103, -74.0123)], fill_color='blue', stroke_color='blue', scale=6)\nshared_airbnbs = gmaps.symbol_layer(airbnb_lat_long, \n                                 fill_color='red', stroke_color='red', scale=3, info_box_content=airbnb_info)\nfig = gmaps.figure()\nfig.add_layer(office_location)\nfig.add_layer(shared_airbnbs)\nfig","b4a8651d":"Image(\"..\/input\/gmaps-airbnb\/Screen Shot 2019-09-21 at 12.01.43 PM.png\")","1dfb9e81":"df_shared = df_within_range_good_quality[df_within_range_good_quality.room_type=='Entire home\/apt']","751a2efb":"all_info = (df_shared[[\"name\", \"price\", \"number_of_reviews\", \"neighbourhood\", 'latitude', 'longitude']].to_dict(orient=\"records\"))\nall_info = [((x[\"latitude\"], x[\"longitude\"]), x) for x in (all_info)]","b45cf6b0":"airbnb_lat_long = [x[0] for x in all_info]\n\n\ninfo_box_template = \"\"\"\n<dl>\n<dt>Name<\/dt><dd>{name}<\/dd>\n<dt>Price<\/dt><dd>{price}<\/dd>\n<dt>Number of reviews<\/dt><dd>{number_of_reviews}<\/dd>\n<dt>Neighbourhood<\/dt><dd>{neighbourhood}<\/dd>\n<\/dl>\n\"\"\"\n\nairbnb_info = [info_box_template.format(**info) for info in ([x[1] for x in all_info])]","475c1290":"office_location = gmaps.symbol_layer([(40.7103, -74.0123)], fill_color='blue', stroke_color='blue', scale=6)\nshared_airbnbs = gmaps.symbol_layer(airbnb_lat_long, \n                                 fill_color='red', stroke_color='red', scale=3, info_box_content=airbnb_info)\nfig = gmaps.figure()\nfig.add_layer(office_location)\nfig.add_layer(shared_airbnbs)\nfig","67889f6e":"Image(\"..\/input\/gmaps-airbnb\/Screen Shot 2019-09-21 at 12.01.55 PM.png\")","84e9f03f":"This kernel explores the New York city Airbnb data to find out the following:\n1. Most expensive Airbnb in each neighbourhood. \n2. Affordable and good quality airbnbs within 1 mile of World Trade Center, Manhattan. \n\nUtilizing Google Maps API (Gmaps, API needed) to visualize these airbnbs alongwith more details when you click on the airbnb. Gmaps doesn't show up the visualization on this kernel, I have included the pics separately to see how the output looks.\n\n","e399f5ec":"## Affordable Airbnb Options Near 4World Trade Center","896d13d6":"### Good Quality, within a mile affordable Private room","47c7784c":"## Most Expensive Airbnbs in each Neighbourhood","68b3cc1f":"The above shows the type and neighbourhood of most expensive airbnbs in the given 5 neighbourhoods of the New York city. The color of the dots show the price range.","557eaec6":"### Good Quality, within a mile affordable Entire Apt","5f196b07":"Affordable if below the median price of each neighbourhood, after removing the outliers","3b03a428":"### Good Quality, within a mile affordable shared rooms"}}