{"cell_type":{"4b5f0d81":"code","2a1a4666":"code","9dbf50f4":"code","0eccc7d7":"code","c46e8192":"code","17072391":"code","e6ceb333":"code","38021f2a":"code","bca51b44":"code","24fa8cbc":"code","c9e60aa8":"code","b53a4ef6":"code","8ae1cfa6":"code","a3ab191b":"code","d644ea46":"markdown","c3cd667b":"markdown","b5e29620":"markdown","cb63aeea":"markdown","4e1cc8b9":"markdown","6a4f9505":"markdown","9e8c6da9":"markdown","a6b95f47":"markdown","d3a70295":"markdown","b84de0e5":"markdown","645f7a16":"markdown","36918859":"markdown","6a3c79b8":"markdown","b6882b1c":"markdown","0e142069":"markdown","d1839759":"markdown","b7db0833":"markdown","3198d1cb":"markdown","36094dde":"markdown"},"source":{"4b5f0d81":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","2a1a4666":"#import numpy\nimport numpy as np\n\n#import visualization seaborn \nimport seaborn as sns\n\n#import pandas \nimport pandas as pd\n\n#import visualization matplotlib\nimport matplotlib.pyplot as plt\n\n#import random forest classifier\nfrom sklearn.ensemble import RandomForestClassifier\n\n#ignire warnings\nimport warnings\nwarnings.simplefilter(action='ignore', category=FutureWarning)","9dbf50f4":"df = pd.read_csv('..\/input\/telco-customer-churn\/WA_Fn-UseC_-Telco-Customer-Churn.csv')","0eccc7d7":"df.head()","c46e8192":"df.info()","17072391":"df.isnull().any()","e6ceb333":"ax = sns.catplot(y='Churn', kind='count', data=df, height=2.6, aspect=2.5)","38021f2a":"def barplot_percentages(feature, orient='v', axis_name=\"percentage of customers\"):\n    ratios = pd.DataFrame()\n    g = df.groupby(feature)[\"Churn\"].value_counts().to_frame()\n    g = g.rename({\"Churn\": axis_name}, axis=1).reset_index()\n    g[axis_name] = g[axis_name]\/len(df)\n    if orient == 'v':\n        ax = sns.barplot(x=feature, y= axis_name, hue='Churn', data=g, orient=orient)\n        ax.set_yticklabels(['{:,.0%}'.format(y) for y in ax.get_yticks()])\n    else:\n        ax = sns.barplot(x= axis_name, y=feature, hue='Churn', data=g, orient=orient)\n        ax.set_xticklabels(['{:,.0%}'.format(x) for x in ax.get_xticks()])\n    ax.plot()\nbarplot_percentages(\"SeniorCitizen\")\n","bca51b44":"g = sns.FacetGrid(df, row='SeniorCitizen', col='gender', hue='Churn', height=3.5)\ng.map(plt.scatter, 'tenure', 'MonthlyCharges', alpha=0.6)\ng.add_legend();","24fa8cbc":"fig,axis = plt.subplots(1,2,figsize=(12,4))\naxis[0].set_title('Has partner')\naxis[1].set_title('Has dependents')\naxis_y = 'Percentage of customers'\n\n#plot Partner column\ngp_partner = df.groupby('Partner')['Churn'].value_counts()\/len(df)\ngp_partner = gp_partner.to_frame().rename({\"Churn\":axis_y}, axis=1).reset_index()\nax = sns.barplot(x='Partner', y=axis_y, hue='Churn', data=gp_partner, ax=axis[0])\n\n\n#plot Dependents column\ngp_dependent = df.groupby('Dependents')['Churn'].value_counts()\/len(df)\ngp_dependent = gp_dependent.to_frame().rename({\"Churn\":axis_y}, axis=1).reset_index()\nax = sns.barplot(x='Dependents', y=axis_y, hue='Churn', data=gp_dependent, ax=axis[1])\n","c9e60aa8":"plt.figure(figsize=(9, 4.5))\nbarplot_percentages(\"MultipleLines\", orient='h')","b53a4ef6":"plt.figure(figsize=(9, 4.5))\nbarplot_percentages(\"InternetService\", orient='h')","8ae1cfa6":"plt.figure(figsize=(9, 4.5))\nbarplot_percentages(\"PaymentMethod\", orient='h')\n\n","a3ab191b":"params = {'random_state': 0, 'n_jobs': 4, 'n_estimators': 5000, 'max_depth': 8}\n# One-hot encode\ndf = pd.get_dummies(df)\n# Drop redundant columns (for features with two unique values)\ndrop = ['Churn_Yes', 'Churn_No', 'gender_Female', 'Partner_No',\n        'Dependents_No', 'PhoneService_No', 'PaperlessBilling_No']\nx, y = df.drop(drop,axis=1), df['Churn_Yes']\n# Fit RandomForest Classifier\nclf = RandomForestClassifier(**params)\nclf = clf.fit(x, y)\n# Plot features importances\nimp = pd.Series(data=clf.feature_importances_, index=x.columns).sort_values(ascending=False)\nplt.figure(figsize=(10,12))\nplt.title(\"Feature importance\")\nax = sns.barplot(y=imp.index, x=imp.values, palette=\"Blues_d\", orient='h')","d644ea46":"### <span style='color:violet'>1.4 Contract and Payment<\/span>\n","c3cd667b":"## <span style='color:Blue'> **Read the Dateset** <\/span>","b5e29620":"We are trying to predict if the client left the company in the previous month. Therefore we have a binary classification problem with a slightly unbalanced target:\n\n* Churn: No - 72.4%\n* Churn: Yes - 27.6%\n","cb63aeea":"### <span style='color:violet'> **1. Categorical Feature** <\/span>","4e1cc8b9":"This dataset has 16 categorical features:\n\n* Six binary features (Yes\/No)\n* Nine features with three unique values each (categories)\n* One feature with four unique values\n","6a4f9505":"* Gender is not an indicative of churn.\n* SeniorCitizens are only 16% of customers, but they have a much higher churn rate: 42% against 23% for non-senior customers.\n* There are no special relations between this categorical values and the main numerical features.\n\n","9e8c6da9":"### <span style='color:violet'>1.2 Partner and dependents<\/span>\n","a6b95f47":"#### Internet Service\n","d3a70295":"### <span style='color:violet'>1.3 Phone and Internet Service<\/span>\n","b84de0e5":"### <span style='color:violet'> **1. Target Variable** <\/span>","645f7a16":"## <span style='color:Blue'> **Import the Required Libraries** <\/span>","36918859":"### <span style='color:violet'>1.1 Gender and Age(SeniorCitizen)<\/span>","6a3c79b8":"A few observations:\n\n* Customers with paperless billing are more probable to churn\n\n* The preferred payment method is Electronic check with around 35% of customers. This method also has a very high churn rate\n\n* Short term contracts have higher churn rates\n","b6882b1c":"#### Phone services","0e142069":" I've used one-hot encode to encode the categorical features and dropped the 'No' columns for binary features. I've also manually tested a few hyperparameters to get a better model.\n\nThe importances are the mean decrease in impurity for each feature across all tree","d1839759":"### <span style='color:violet'>1.6 Features Importance<\/span>\n","b7db0833":"* Customers that doesn't have partners are more likely to churn\n* Customers without dependents are also more likely to churn\n","3198d1cb":"## <span style='color:Blue'> **Impute Missing** <\/span>\n","36094dde":"There are only two main services: phone and internet but the former has many additionals like online backup and security."}}