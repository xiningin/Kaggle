{"cell_type":{"c96c4846":"code","22e0561e":"code","f178ada6":"code","3b493e89":"code","72f98ca8":"code","1637c4f4":"code","8c177a22":"code","65091e73":"code","684e506a":"code","db3e3329":"code","019cd017":"code","380a0e79":"code","401e4b77":"markdown","8f6af764":"markdown","739f92b3":"markdown","1f011140":"markdown","c3d05d69":"markdown"},"source":{"c96c4846":"import numpy as np\nimport pandas as pd\nimport getpass\nimport matplotlib.pyplot as plt\n\n# ==== Setup =======================================================================================\n\nnp.set_printoptions(suppress=True)\npd.set_option('display.max_columns', 500)\npd.set_option('display.width', 0)\n\nif getpass.getuser() in ['Ben']:\n    input_file = 'input\/train.csv'\nelse:\n    from kaggle.competitions import nflrush\n    env = nflrush.make_env()\n    input_file = '\/kaggle\/input\/nfl-big-data-bowl-2020\/train.csv'\n\n# read train\ntrain = pd.read_csv(filepath_or_buffer = input_file, low_memory = False)","22e0561e":"def plot_play(playId, arrows_as = 'Dir'):\n    \"\"\"\n    Plot a single play\n    :param playId: id of the play \n    :param arrows_as: should be either 'Dir' or 'Orientation'\n    :return: plot of players with arrows\n    \"\"\"\n\n    # Get 'play players' and 'play' from train\n    play_players = train.loc[train.PlayId == playId].copy()\n    play = play_players.iloc[[0]]\n\n    # Determine which players are on offense by identifying which team the rusher is on\n    rusher = play_players.loc[play_players.NflId == play_players.NflIdRusher]\n    play_players.loc[:, 'PlayerOnOffense'] = play_players.Team.values == rusher.Team.values\n\n    # Create field 'ArrowAngle'\n    play_players['ArrowAngle'] = play_players['Dir'] if arrows_as == 'Dir' else play_players['Orientation']\n    if (play.Season.values[0] == 2017 and arrows_as == 'Orientation'):\n        play_players['ArrowAngle'] = (360 - play_players.ArrowAngle).mod(360)\n    else:\n        play_players['ArrowAngle'] = (360 - play_players.ArrowAngle + 90).mod(360)\n\n    # Create fields Arrow_dx, Arrow_dy\n    play_players['Arrow_dx'] = np.cos(play_players.ArrowAngle * (np.pi\/180))\n    play_players['Arrow_dy'] = np.sin(play_players.ArrowAngle * (np.pi\/180))\n\n    # Split offense and defense players\n    play_players_offense = play_players.loc[play_players.PlayerOnOffense].copy()\n    play_players_defense = play_players.loc[~play_players.PlayerOnOffense].copy()\n\n    # Plot\n    fig, ax = plt.subplots(figsize=(20, 10))\n    ax.axvline(x=10, linewidth=1)\n    ax.axvline(x=110, linewidth=1)\n    ax.axhline(y=0, linewidth=1)\n    ax.axhline(y=53.5, linewidth=1)\n    ax.scatter(play_players_offense.X, play_players_offense.Y, color=\"red\", label=\"offense\", s = 20)\n    ax.scatter(play_players_defense.X, play_players_defense.Y, color=\"blue\", label=\"defense\", s = 20)\n    for i in range(0, play_players.shape[0]):\n        ax.arrow(\n            x = play_players.X.values[i],\n            y = play_players.Y.values[i],\n            dx = play_players.Arrow_dx.values[i],\n            dy = play_players.Arrow_dy.values[i],\n            head_width=0.5,\n            head_length=0.5,\n            fc='k',\n            ec='k'\n        )\n    ax.text(60, 0 - 5, 'Home Sideline', horizontalalignment='center', verticalalignment='bottom')\n    ax.text(60, 53.5 + 5, 'Away Sideline', horizontalalignment='center', verticalalignment='top', rotation=180)\n    ax.set_xlim(0, 120)\n    ax.set_ylim(0 - 5, 53.5 + 5)\n    ax.set_title(f\"PlayId: {play.PlayId.values[0]} (moving {play.PlayDirection.values[0]})\\n{arrows_as}\")\n    fig.legend()\n    fig.show()","f178ada6":"# Derrick Henry, 2018, moving right, https:\/\/www.youtube.com\/watch?v=tlZvgdcIXvI\nplot_play(20181206001238, 'Orientation')","3b493e89":"# Lamar Miller, 2018, moving left, https:\/\/www.youtube.com\/watch?v=p-ptA3nQxCA\nplot_play(20181126001222, 'Orientation')","72f98ca8":"# Nick Chubb, 2018, moving left, https:\/\/www.youtube.com\/watch?v=NvQiykZIBNA\nplot_play(20181111022155, 'Orientation')","1637c4f4":"# Adrian Peterson, 2018, moving left, https:\/\/www.youtube.com\/watch?v=AMLKvNs2Ec8\nplot_play(20181203001224, 'Orientation')","8c177a22":"# Leonard Fournette, 2017, moving right, https:\/\/youtu.be\/Dp3zkB3NRDA?t=114\nplot_play(20171008074020, 'Orientation')","65091e73":"# Melvin Gordon, 2017, moving right, https:\/\/www.youtube.com\/watch?v=oUHaQKmyn7U\nplot_play(20171029030426, 'Orientation')","684e506a":"# Bilal Powell, 2017, moving left, https:\/\/www.youtube.com\/watch?v=zDtDanILhAc\nplot_play(20171001080397, 'Orientation')","db3e3329":"# Saquon Barkley, 2018, moving left, https:\/\/www.youtube.com\/watch?v=E4IesbDwpq4\nplot_play(20181209081494, 'Orientation')","019cd017":"# Kerryon Johnson, 2018, moving right, https:\/\/youtu.be\/cgZnUFAtd0c?t=27\nplot_play(20181021060782, 'Orientation')","380a0e79":"# Alvin Kamara, 2017, moving right, https:\/\/www.youtube.com\/watch?v=4XAYJKiT2rc\nplot_play(20171126070740, 'Orientation')","401e4b77":"# The Two Coordinate Reference Systems\n*Dir* and *Orientation* are both given as angles in the range \\[0, 360\\]. *Dir* gives the angle the player is moving and *Orientation* gives the angle the player is facing, each at the time the ball is handed to the rusher. Through some experimentation, I've determined that there are two different coordinate reference systems for these measuring angles. They are\n\n## 1. (0\u00b0 on right, clockwise rotation)\n**Used for:**\n1. *Orientation* where *Season* == 2017\n![Imgur](https:\/\/i.imgur.com\/MFAW8FQ.png)\n\n## 2. (0\u00b0 on top, clockwise rotation)\n1. *Orientation* where *Season* > 2017 and\n2. *Dir*\n![Imgur](https:\/\/i.imgur.com\/a0jxkYp.png)\n\n(Thanks to Peter Hurford for [pointing out that Orientation is shifted by 90 degrees in 2017](https:\/\/www.kaggle.com\/c\/nfl-big-data-bowl-2020\/discussion\/113384#latest-653467))","8f6af764":"A few notes before moving on\n\n1. X and Y give the player positions on the field\n2. The field is 120 yards long by 53.3 yards wide but players can go out of bounds so don't expect every player's (X,Y) to be within that range\n3. Suppose a rusher's X coordinate is 20. If *PlayDirection* is 'left', he is 10 yards from scoring. If *PlayDirection* is 'right', he is 90 yards from scoring.","739f92b3":"# Examples\nHere's a dirty `plot_play()` method with some examples including links to youtube videos with the corresponding play.","1f011140":"This is my attempt to explain `X`, `Y`, `Dir` and `Orientation` as I understand them.\n\nTo start, **we'll always want to assume we are observing the field from the home team's sideline.** The [image at the bottom of the data section](https:\/\/www.kaggle.com\/c\/nfl-big-data-bowl-2020\/data) is a good one to use as long as you don't look at the \"Increasing Dir and O\" bit which is not quite right.\n\n![Imgur](https:\/\/i.imgur.com\/I0iPp0A.png)","c3d05d69":"# How to Standardize?\nThere are a number of ways you could standardize this data. I prefer to transform every angle into the system (0\u00b0 on right, counter clockwise rotation), because this makes cos(angle) increase in the same direction as X and sin(angle) increase in the same direction as Y. I've done this transformation in the `plot_play()` method below."}}