{"cell_type":{"57c6cf1c":"code","5857ff49":"code","f9728706":"code","603d4ff8":"code","0ed56cf9":"code","516e95db":"code","7073be74":"code","4bf5a76c":"code","46ad7f53":"code","e13b0992":"code","3aa72cfa":"code","b820d9c1":"code","9b37db1b":"code","9f4bc92c":"code","78278e7c":"code","cf9dc2f3":"code","c3830300":"code","8b9701bd":"code","a568cbf0":"code","b8c727d5":"code","ed74df9a":"code","74c4f790":"code","85f04615":"code","49ff99ff":"code","81dcea3c":"code","0d6adc9b":"code","84d0e922":"code","ddb2b95e":"code","1babe922":"code","f5525b36":"code","d4d28278":"markdown","65b414d9":"markdown","7cddc8a7":"markdown","e423ea16":"markdown","081648fe":"markdown","0588bcca":"markdown","dc53a5b3":"markdown","5d52b2b5":"markdown","9e5d7fbd":"markdown","2c557e0c":"markdown","7688fcd4":"markdown","0ea28de1":"markdown","aa2f4ae1":"markdown","46b5a80a":"markdown","cad631b1":"markdown","b4a98016":"markdown","a030528a":"markdown","bf8734ef":"markdown","203fe8a5":"markdown","55a319f4":"markdown","65cdbc9f":"markdown","be0bcd39":"markdown","f03e086a":"markdown","f80947bc":"markdown","ec05a821":"markdown","d3c8fced":"markdown","122ebfda":"markdown","c44b6273":"markdown","ed7cc1a0":"markdown"},"source":{"57c6cf1c":"import pandas as pd\ndf = pd.read_csv('..\/input\/perrin-freres-monthly-champagne-sales\/Perrin Freres monthly champagne sales millions.csv')\ndf.head()","5857ff49":"df.tail()","f9728706":"df.isnull().sum()","603d4ff8":"df.drop([105,106], axis = 0, inplace = True)","0ed56cf9":"df.isnull().sum()","516e95db":"df.columns = ['Month', 'Sales']\ndf.head()","7073be74":"df.shape","4bf5a76c":"df.dtypes","46ad7f53":"df['Month'] = pd.to_datetime(df['Month'])","e13b0992":"df.dtypes","3aa72cfa":"df.head()","b820d9c1":"df.set_index('Month', inplace = True)","9b37db1b":"df.head()","9f4bc92c":"df.plot()","78278e7c":"from statsmodels.tsa.stattools import adfuller\n\ndef adfuller_test(sales):\n    result = adfuller(sales)\n    labels = ['ADF test statistics', 'P-value', '#Lags used', 'Number of observation used']\n    for value, label in zip(result, labels):\n        print(label+' : '+str(value))\n    if result[1] <= 0.05:\n        print('Strong evidence against the null hypothesis (Ho), Reject the null hypothesis, Data has no unit root and is stationary')\n    else:\n        print('Weak evidence against the null hypothesis (Ho), time series has a unit root, indicating it is non stationary. ')\n        \n        \nadfuller_test(df['Sales'])","cf9dc2f3":"df['seasional_first_difference'] = df['Sales'] - df['Sales'].shift(12)\ndf","c3830300":"adfuller_test(df['seasional_first_difference'].dropna())","8b9701bd":"df['seasional_first_difference'].plot()","a568cbf0":"from statsmodels.graphics.tsaplots import plot_acf, plot_pacf","b8c727d5":"import statsmodels.api as sm\nfig = plt.figure(figsize=(12,8))\nax1 = fig.add_subplot(211)\nfig = sm.graphics.tsa.plot_acf(df['seasional_first_difference'].iloc[13:],lags=40,ax=ax1)\nax2 = fig.add_subplot(212)\nfig = sm.graphics.tsa.plot_pacf(df['seasional_first_difference'].iloc[13:],lags=40,ax=ax2)","ed74df9a":"from statsmodels.tsa.arima_model import ARIMA\n\nmodel_arima = ARIMA(df['Sales'], order = (1,1,1))     #order = (p, d, q)\nmodel_arima_fit = model_arima.fit()","74c4f790":"model_arima_fit.summary()","85f04615":"df['forecast_arima']=model_arima_fit.predict(start=90, end=103, dynamic=True)\ndf[['Sales','forecast_arima']].plot()","49ff99ff":"model_sarimax = sm.tsa.statespace.SARIMAX(df['Sales'],\n                                          order = (1,1,1),                  # order = (p, d, q)\n                                          seasonal_order = (1,1,1, 12))     # seasonal_order = (p, d, q, shift)  \nmodel_sarimax_fit = model_sarimax.fit()","81dcea3c":"df['forecast_sarimax']=model_sarimax_fit.predict(start=90, end=103, dynamic=True)      # 90 and 103 are the index range to be predicted\ndf[['Sales','forecast_sarimax']].plot(figsize = (12, 8))","0d6adc9b":"from pandas.tseries.offsets import DateOffset\nfuture_dates = [df.index[-1] + DateOffset (months = x) for x in range(0, 24)]","84d0e922":"future_date_dataset = pd.DataFrame(index = future_dates[1:], columns = df.columns)\nfuture_date_dataset.tail()","ddb2b95e":"merged_df = pd.concat([df, future_date_dataset])\nmerged_df.tail()","1babe922":"df.tail()","f5525b36":"merged_df['forecast_sarimax'] = model_sarimax_fit.predict(start =104, end = 120, dynamic= True )\nmerged_df[['Sales', 'forecast_sarimax']].plot(figsize = (12, 8))","d4d28278":"## Load the dataset and Reconnaissance\ndataset used here: Perrin Freres monthly champagne sales","65b414d9":"<br\/>\n\n## Plotting our new stational data","7cddc8a7":"#### Note:\nFrom the plot, we are seeing that it's kind of a seasional data. It may not be stationary. To clarify the confusion, we can apply here the 'Dickey Fuller Test' to see whether it is stationary or not.","e423ea16":"<br\/>\n\n### Data types of the variables","081648fe":"### Now concate as well as merge the new dataset with the existing one","0588bcca":"<br\/>\n\n## Plotting the model","dc53a5b3":"#### Note:\nAs the P-value is grater than 0.005, the Dickey Fuller Test tells us that the data is not stationary.  \nNow it's time to make the data stationary","5d52b2b5":"<br\/>\n<br\/>\n\nGratitude: Krish Naik\n### Feel free to share your thoughts and if you find it helpful, please upvote. It will keep me motivated. Thyanks!","9e5d7fbd":"<br\/>\n\n## Plotting ACF and PACF\nACF = Auto correlation function  \nPACF= Partial Auto correlation function\n<br\/>\n\nACF and PACF are used to find the best lag value for the model. \n##### PACF is most suitable for AR model.  \n##### And ACF is most suitable for MA model.\n<br\/>\n\nshuts off - The abrupt decrease in PACF. It normally happens in PACF only. And in ACF the decrease is exponential.","2c557e0c":"<br\/>\n\n# ARIMA model\n#### Note : ARIMA should be selected when the data is seasional. Though we have seasional data here, we are implementing ARIMA to see the process.","7688fcd4":"<br\/>\n\n## PLot the dataset","0ea28de1":"<br\/>\n\n## Making the data stationary by Differencing (Integrated)\n\nAs the data is seasional and each year consists 12 month, from the graph we are seeing that the per cycle difference of the data is 12 months.  \nThat's why we will shift 12 here and the substraction from the 'Sales' column will be stored in a new column titled 'seasonal_first_difference'.","aa2f4ae1":"# ARIMA (Autoregressive Integrated Moving Averages)\n\n##### The general process for ARIMA models is the following:\n    1. Visualize the Time Series Data\n    2. Make the time series data stationary\n    3. Plot the Correlation and AutoCorrelation Charts\n    4. Construct the ARIMA Model or Seasonal ARIMA based on the data\n    5. Use the model to make predictions\n\n##### Formula of Auto Regressive Model:\n    yt = c + \u03d51 yt\u22121 + \u03d52 yt\u22122 + .............. + \u03d5p yt\u2212p + \u03b5t\n    Here,\n    p = 1, 2, 3, ......\n    t-1, t-2, ..... = lags\n    \n<br\/>\n<br\/>","46b5a80a":"<br\/>\n<br\/>\n\n### Creating a additional dataset for forecasting","cad631b1":"### Model summary","b4a98016":"<br>\n\n## Again applying Dickey Fuller Test\nNow, we want to see if our new data became stationary or not.  \nBut this time we should pay extra attention to 'dropna()'. Because for shifting 12, the 1st 12 values of the 'Sales_first_difference' will be NaN. We have to keep them aside.","a030528a":"### Removing the rows containing missing values","bf8734ef":"<br\/>\n\n# SARIMAX model","203fe8a5":"<br\/>\n\n### Checking if there is any missing values in the dataset\nWe got one missing value in the 'Month' column and two in the rest.","55a319f4":"<br\/>\n\n### Shape of the dataset","65cdbc9f":"#### After changing the data type, it will be looking like this","be0bcd39":"##### As the data isn't seasional, ARIMA model doesn't perform well","f03e086a":"<br\/>\n\n## Dickey Fuller Test","f80947bc":"<br\/>\n\n### Changing the name of the 2nd column\nWe shouldn't break our teeth pronouncing any column name.","ec05a821":"<br\/>\n\n## Plotting the model","d3c8fced":"<br\/>\n\n### Convert the month column into index","122ebfda":"<br\/>\n\n### Change the data type of the month column","c44b6273":"#### ARIMA Model takes 3 values.\n\n###### p - AR model lag   : find out from the PACF, where shuts off happens.  \n###### d - Differencing    : how many times the shifting are done?\n###### q - MA model lag : find out from ACF, where exponential decrease happens.  \n<br\/>\n\nIn our case,  \np = 1 (As abrupt decrease happens in 1)  \nd = 1  \nq = 0 (As we can't see any exponential decrease in ACF. The decrease in ACF is also abrupt. but in this case, we can also consider an exponential decrease in 1. Then q value can also be 1.)","ed7cc1a0":"#### Note:\nDone! As our P-value this time becomes less than 0.005, we can easily tell this data a stationary one."}}