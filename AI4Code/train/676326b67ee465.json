{"cell_type":{"ef6cbefe":"code","a6281924":"code","5e876434":"code","e88ab208":"code","e868c1f1":"code","5a1d2b7f":"code","9807124c":"code","43db14f1":"code","d37255d6":"code","5bc0af25":"code","764a07fc":"code","a503b2de":"code","d9345e9a":"markdown","515fb397":"markdown"},"source":{"ef6cbefe":"import numpy as np\nimport pandas as pd\nimport os\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport tensorflow as tf\nfrom tensorflow.keras.layers.experimental import preprocessing\nfrom tensorflow.keras import layers\nfrom sklearn.model_selection import train_test_split","a6281924":"heart_data_original = pd.read_csv('\/kaggle\/input\/heart-attack-analysis-prediction-dataset\/heart.csv')\nheart_data = heart_data_original.copy()","5e876434":"heart_data.rename(columns={'cp': 'chestpaintype',\n                   'caa': '# major blood vessels',\n                   'trtbps': 'resting blood pressure',\n                   'chol': 'cholestrol',\n                   'fbs': 'fasting blood sugar',\n                   'restecg': 'resting electrocardiographic results',\n                   'thalachh': 'max heart rate achieved',\n                   'exng': 'exercise induced angina',\n                   'oldpeak': 'ST Depression',\n                   'slp': 'ST slope',\n                   'thall': 'Thalassemia'\n                  }, inplace=True)","e88ab208":"heart_data.head()","e868c1f1":"heart_data.corr().style.background_gradient(cmap ='coolwarm')","5a1d2b7f":"heart_data.describe().transpose()","9807124c":"correlated_cols = ['sex', 'chestpaintype', 'exercise induced angina',\n                   'ST slope', '# major blood vessels', 'Thalassemia']\n\nfor col in correlated_cols:\n    heart_data.groupby(col).output.value_counts().unstack().plot(kind='bar')","43db14f1":"class PreProcessing:\n    \"\"\"Creates a trainable model\"\"\"\n    def __init__(self, df):\n        self.df = df\n        \n    def split_data(self):\n        #Split data into train and test data\n        train, test = train_test_split(self.df, test_size=0.2)\n        return train, test\n    \n    def df_to_dataset(self, data, shuffle=True, batch_size=32):\n        # Creates tf.data drom pandas daraframe\n        data = data.copy()\n        labels = data.pop('output')\n        tensor_dataset = tf.data.Dataset.from_tensor_slices((dict(data), labels))\n        if shuffle:\n            tensor_dataset = tensor_dataset.shuffle(buffer_size=len(data))\n        tensor_dataset = tensor_dataset.batch(batch_size)\n        tensor_dataset = tensor_dataset.prefetch(batch_size)\n        return tensor_dataset\n    \n    def get_normalization_layer(self, name, dataset):\n        # Normalizes the input to have 0 mean and 1 standard deviation\n        normalizer = preprocessing.Normalization()\n        feature_ds = dataset.map(lambda x, y: x[name])\n        normalizer.adapt(feature_ds)\n        return normalizer\n    \n    def get_normalized_features(self):\n        train, test = self.split_data()\n        train_ds = self.df_to_dataset(train, batch_size=4)\n        test_ds = self.df_to_dataset(test, batch_size=4)\n        all_inputs = []\n        encoded_features = []\n        for header in self.df:\n            if header != 'output':\n                numeric_col = tf.keras.Input(shape=(1,), name=header)\n                normalization_layer = self.get_normalization_layer(header, train_ds)\n                encoded_numeric_col = normalization_layer(numeric_col)\n                all_inputs.append(numeric_col)\n                encoded_features.append(encoded_numeric_col)\n        return all_inputs, encoded_features, train_ds, test_ds\n        \n    ","d37255d6":"preProcessing = PreProcessing(heart_data)\nall_inputs, encoded_features, train_ds, test_ds = preProcessing.get_normalized_features()","5bc0af25":"class BuildModel:\n    \"\"\"Creates model for prediction\"\"\"\n    def __init__(self, all_inputs, encoded_features):\n        self.all_inputs = all_inputs\n        self.encoded_features = encoded_features\n    \n    def create_model(self):\n        all_features = tf.keras.layers.concatenate(encoded_features)\n        x = tf.keras.layers.Dense(32, activation='relu')(all_features)\n        x = tf.keras.layers.Dropout(0.5)(x)\n        output = tf.keras.layers.Dense(1)(x)\n        self.model = tf.keras.Model(self.all_inputs, output)\n        self.model.compile(optimizer='adam',\n              loss=tf.keras.losses.BinaryCrossentropy(from_logits=True),\n              metrics=[\"accuracy\"])\n        return None\n    \n    def fit(self, train_ds, valid_dataset, epochs=10):\n        self.create_model()\n        self.model.fit(train_ds, epochs=epochs, validation_data = valid_dataset)\n        return None\n        ","764a07fc":"buildModel = BuildModel(all_inputs, encoded_features)\nbuildModel.fit(train_ds, test_ds)","a503b2de":"tf.keras.utils.plot_model(buildModel.model, show_shapes=True, rankdir=\"LR\")","d9345e9a":"### Chest Pain Type\n    Value 0: typical angina\n    Value 1: atypical angina\n    Value 2: non-anginal pain\n    Value 3: asymptomatic\n   \n### Output Type\n    0 = less chance of heart attack \n    1= more chance of heart attack","515fb397":"### Building Model"}}