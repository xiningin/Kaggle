{"cell_type":{"7ad633ad":"code","f2a40e9a":"code","0b931b06":"code","3aa99d92":"code","2835bf02":"markdown"},"source":{"7ad633ad":"import matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd","f2a40e9a":"def rle_to_mask(rle_string, width, height):\n    '''\n    convert RLE(run length encoding) string to numpy array\n\n    Parameters:\n    rle_string (str): string of rle encoded mask\n    height (int): height of the mask\n    width (int): width of the mask\n\n    Returns:\n    numpy.array: numpy array of the mask\n    '''\n\n    rows, cols = height, width\n\n    if rle_string == -1:\n        return np.zeros((height, width))\n    else:\n        rle_numbers = [int(num_string) for num_string in rle_string.split(' ')]\n        rle_pairs = np.array(rle_numbers).reshape(-1, 2)\n        img = np.zeros(rows * cols, dtype=np.uint8)\n        for index, length in rle_pairs:\n            index -= 1\n            img[index:index + length] = 255\n        img = img.reshape(cols, rows)\n        img = img.T\n        return img","0b931b06":"df = pd.read_csv('..\/input\/understanding_cloud_organization\/train.csv')\ndf['Label'] = df['Image_Label'].apply(lambda x: x.split('_')[1])\nlabels = sorted(list(df['Label'].unique()))","3aa99d92":"for l in labels:\n    m = np.zeros((1400, 2100), dtype=np.float)\n    count = 0\n\n    for idx, row in df.iterrows():\n        if row['Label'] == l:\n            if not isinstance(row['EncodedPixels'], float):\n                rle = row['EncodedPixels']\n                mask = rle_to_mask(rle, 2100, 1400)\n                mask = np.clip(mask, 0, 1)\n                m += mask.astype(np.float)\n            count += 1\n\n    view = m \/ count\n\n    plt.figure()\n    plt.imshow(view)\n    plt.title(l)\n    \n    plt.figure()\n    plt.hist(view.flatten(), bins=100)\n    plt.title('Histogram of Values for {}'.format(l))","2835bf02":"# Average Masks\n\nGiven that almost everyone will be using largely translation invariant CNN architectures, it seems important that location within an image impacts the prior probability that a pixel is a part of a mask."}}