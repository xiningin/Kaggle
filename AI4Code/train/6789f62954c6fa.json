{"cell_type":{"65f8c986":"code","309eb455":"code","a2947293":"code","32eda471":"code","99ac83e6":"code","12b1ba13":"code","24cbbcc1":"code","6cc21eef":"code","f53674e9":"code","5b1a1d6e":"code","0630c697":"code","6e0601e2":"code","44db19d7":"code","04936270":"code","ac33850d":"code","78a2a1a0":"code","0d91af46":"code","8ce61bc4":"code","6da99e50":"code","da71fcdc":"code","798a6902":"code","a02ccebc":"code","381184f9":"code","3fd80b89":"code","ee73ecde":"markdown","fc97e6b6":"markdown","82e9816e":"markdown","bf6cac30":"markdown","546b9097":"markdown","90c24c51":"markdown","f8daadaa":"markdown"},"source":{"65f8c986":"import os\nimport pandas as pd \nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom glob import glob\nfrom keras.preprocessing.image import ImageDataGenerator\nfrom keras.models import Sequential\nfrom keras.layers import Conv2D, MaxPooling2D, Flatten, Dense, BatchNormalization, Dropout\nfrom sklearn.model_selection import train_test_split","309eb455":"print(os.listdir(\"..\/input\/diabetic-retinopathy-resized\"))","a2947293":"path = \"..\/input\/diabetic-retinopathy-resized\/resized_train_cropped\/resized_train_cropped\"","32eda471":"#os.mkdir(\"..\/output\/kaggle\/working\/train\")","99ac83e6":"data = \"..\/input\/diabetic-retinopathy-resized\/resized_train_cropped\/resized_train_cropped\"\nprint('number of images in total - ',len(os.listdir(data)))","12b1ba13":"index = pd.read_csv(\"..\/input\/diabetic-retinopathy-resized\/trainLabels_cropped.csv\") \nprint('number of images in total - ',len(index))","24cbbcc1":"#format correctly\nindex['image_name'] = [i+\".jpeg\" for i in index['image'].values]\nindex['level_binary'] = [i for i in index['level'].values]\n\nfor i in range(len(index.level)):\n    if index['level'][i] == 0:\n        index['level_binary'][i] = 0\n    else:\n        index['level_binary'][i] = 1\n    \nindex.head(10)","6cc21eef":"temp = path + '\/10_left' + '.jpeg'\n\nplt.imshow(plt.imread(temp))\n#plt.imshow(plt.imread(\"..\/input\/diabetic-retinopathy-resized\/resized_train_cropped\/resized_train_cropped\/43233_left.jpeg\"))","f53674e9":"temp = path + '\/16_left' + '.jpeg'\n\nplt.imshow(plt.imread(temp))","5b1a1d6e":"index['level_binary'].hist()\nindex['level_binary'].value_counts()","0630c697":"train1, val = train_test_split(index, test_size=0.2)\ntrain, test = train_test_split(train1, test_size=0.25)\n#80\/20\/20 split","6e0601e2":"x = index['image']\ny = index['level']\n#x,y = shuffle(x,y)\n\ntrain_x, valid_x, train_y, valid_y = train_test_split(x,y, test_size=0.15,stratify=y)\nprint(train_x.shape, train_y.shape, valid_x.shape, valid_y.shape)\ntrain_y.hist()\nvalid_y.hist()\nprint(train_x)\nprint(train)","44db19d7":"print(train.shape, val.shape, test.shape)\ntrain.hist()\nval.hist()\ntest.hist()","04936270":"train_datagen = ImageDataGenerator(rescale            = 1\/255,\n                                   shear_range        = 0.2,\n                                   zoom_range         = 0.2,\n                                   horizontal_flip    = True,\n                                   rotation_range     = 40,\n                                   width_shift_range  = 0.2,\n                                   height_shift_range = 0.2)\n\ntest_datagen = ImageDataGenerator(rescale = 1\/255)","ac33850d":"train_set = train_datagen.flow_from_dataframe(\n    train,\n    \"..\/input\/diabetic-retinopathy-resized\/resized_train_cropped\/resized_train_cropped\",\n    x_col=\"image_name\",\n    y_col=\"level_binary\",\n    class_mode=\"raw\",\n    color_mode=\"grayscale\",\n    batch_size=32,\n    target_size=(64, 64))\n\nval_set = test_datagen.flow_from_dataframe(\n    val,\n    \"..\/input\/diabetic-retinopathy-resized\/resized_train_cropped\/resized_train_cropped\",\n    x_col=\"image_name\",\n    y_col=\"level_binary\",\n    class_mode=\"raw\",\n    color_mode=\"grayscale\",\n    batch_size=32,\n    target_size=(64, 64))\n\ntest_set = test_datagen.flow_from_dataframe(\n    test,\n    \"..\/input\/diabetic-retinopathy-resized\/resized_train_cropped\/resized_train_cropped\",\n    x_col=\"image_name\",\n    y_col=\"level_binary\",\n    class_mode=\"raw\",\n    color_mode=\"grayscale\",\n    batch_size=32,\n    target_size=(64, 64))","78a2a1a0":"print(train_set)","0d91af46":"model = Sequential()\n\nmodel.add(Conv2D(32, (3, 3), activation='relu', input_shape=(64, 64, 1), padding='same'))\nmodel.add(MaxPooling2D(pool_size=(2, 2)))\n\nmodel.add(Conv2D(32, (3, 3), activation='relu', padding='same'))\nmodel.add(MaxPooling2D(pool_size=(2, 2)))\n\nmodel.add(Conv2D(64, (3, 3), activation='relu', padding='same'))\nmodel.add(MaxPooling2D(pool_size=(2, 2)))\n\nmodel.add(Flatten())\nmodel.add(Dense(128, activation = 'relu'))\nmodel.add(Dropout(0.5))\nmodel.add(Dense(1, activation = 'sigmoid'))","8ce61bc4":"model.compile(optimizer='adam', loss='binary_crossentropy', metrics=['accuracy'])","6da99e50":"model.summary()","da71fcdc":"model_train = model.fit_generator(\n    train_set,\n    steps_per_epoch = 200,\n    epochs = 10,\n    validation_data = val_set,\n    validation_steps = 100)","798a6902":"#plt.plot(model_train.history['acc'])\n#plt.plot(model_train.history['val_acc'])\nplt.title('model accuracy')\nplt.ylabel('accuracy')\nplt.xlabel('epoch')\nplt.legend(['train', 'var'], loc='best')\nplt.show()\n\nplt.plot(model_train.history['loss'])\nplt.plot(model_train.history['val_loss'])\nplt.title('model loss')\nplt.ylabel('loss')\nplt.xlabel('epoch')\nplt.legend(['train', 'var'], loc='best')\nplt.show()","a02ccebc":"from PIL import Image\nim = Image.open(\"..\/input\/diabetic-retinopathy-resized\/resized_train\/resized_train\/\" + val.iloc[0].image_name)\nim = np.array(im.resize((224, )*2, resample=Image.LANCZOS))\nim.shape","381184f9":"import matplotlib.pyplot as plt\nplt.imshow(im)","3fd80b89":"import cv2\n\ntestimage = cv2.resize(im, (224,224))\ntestimage = cv2.addWeighted(image,4,cv2.GaussianBlur(image,(0,0),10) ,-4 ,128) \n\nprint(\"predicted:\", np.argmax(model.predict(testimage.reshape(1, *im.shape))[0]))\nprint(\"actual:\", val.iloc[0].level)","ee73ecde":"# Test Some Images","fc97e6b6":"# Build Model","82e9816e":"# Train Model","bf6cac30":"# Imports","546b9097":"# Data Prep","90c24c51":"# Batch Generation","f8daadaa":"# Data Visualization"}}