{"cell_type":{"6a653db4":"code","8ecf10f3":"code","76ce4c81":"code","a06552a2":"code","5c4b1f40":"code","c02ce042":"code","17a69095":"code","febb91d4":"code","6be9ccd5":"code","09fa403b":"code","001276a1":"code","6754a1ca":"code","d28ac5a4":"code","9fce4f3c":"code","dbc12ef9":"code","39193939":"code","76c3af25":"code","99675690":"code","fb9a8d46":"code","4354f0b4":"code","522cc538":"code","8609fe0d":"code","85202c7e":"code","720eda12":"code","5b879032":"code","55728e9c":"code","9e2dd661":"code","44fa84f6":"code","b96a3a36":"code","9fa3dcaa":"code","b424468b":"code","0bdb0861":"code","0bee701f":"code","11fbc97a":"code","7230b971":"code","ca73f7ba":"code","74914250":"code","1e53850a":"code","d57ccba2":"code","0c4a1cff":"code","85952d21":"code","1035fece":"code","bbe8fdda":"code","565c6b96":"code","489fbd8e":"code","0b3805bd":"code","cb30afeb":"code","85706ad3":"code","c8951a4c":"code","bd10c68f":"code","4f89c664":"markdown","549bb930":"markdown","03876346":"markdown","3da89e7a":"markdown","3bd61f3d":"markdown","8e5d5cbc":"markdown","2188b7ce":"markdown","5c0d7402":"markdown","8445072d":"markdown","50684a00":"markdown","b8f50fe8":"markdown","a79f03da":"markdown","f63b6a5f":"markdown","febe422b":"markdown","908cd7d1":"markdown","04685d40":"markdown","9c9ce3b7":"markdown","95d12227":"markdown","b8ab1885":"markdown"},"source":{"6a653db4":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom IPython.display import clear_output\nclass Output:\n    def clear(self):\n        clear_output()\noutput = Output()\nsns.set(rc={\"figure.figsize\": (10, 2)})\nimport gc\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","8ecf10f3":"\ndef plot(d,t='area'):\n  if t =='area':\n    return pd.DataFrame(d).sort_index().plot.area()\n  if t =='line':\n    return pd.DataFrame(d).sort_index().plot.line()\n  if t =='hist':\n    return pd.DataFrame(d).sort_index().plot.hist()\n  if t =='bar':\n    return pd.DataFrame(d).sort_index().plot.bar()\n\ndef transpose(d,l=100):\n  x = pd.DataFrame(d)\n  return x.head(l).transpose()","76ce4c81":"_path = '\/kaggle\/input\/competitive-data-science-predict-future-sales\/'\nitem_categories =  pd.read_csv(_path+'\/item_categories.csv')\nitems =  pd.read_csv(_path+'\/items.csv')\nsales_train =  pd.read_csv(_path+'\/sales_train.csv')\nsubmission =  pd.read_csv(_path+'\/sample_submission.csv')\nshops =  pd.read_csv(_path+'\/shops.csv')\ntest =  pd.read_csv(_path+'\/test.csv')","a06552a2":"!pip install -U textblob\nfrom textblob import TextBlob\nfor i in range(len(shops)):\n  text = shops.loc[i,\"shop_name\"]\n  hi_blob = TextBlob(text)\n  text_pt = hi_blob.translate(to='pt',from_lang='ru')\n  shops.loc[i,\"shop_name\"] =str(text_pt)\noutput.clear()","5c4b1f40":"for i in range(len(item_categories)):\n  text = item_categories.loc[i,\"item_category_name\"]\n  hi_blob = TextBlob(u''+text)\n  text_pt = hi_blob.translate(to='pt')\n  item_categories.loc[i,\"item_category_name\"] =str(text_pt)\noutput.clear()","c02ce042":"shops.describe().transpose()","17a69095":"shops.shop_id.plot.line()\nplt.show()","febb91d4":"import urllib.request\nimport codecs\nfrom bs4 import BeautifulSoup\nwiki = 'https:\/\/pt.wikipedia.org\/wiki\/Lista_de_cidades_da_R%C3%BAssia_por_popula%C3%A7%C3%A3o'\npage = urllib.request.urlopen(wiki)\nsoup = BeautifulSoup(page, 'html5lib')\ntable = soup.find('table', attrs={'class': 'wikitable'})\ncities = []\ntds = [row for row in table.findAll('tr')]\nfor td in tds:\n  if len(td.findAll(\"td\"))==4:\n    cities.append([td.findAll(\"td\")[1].find(\"a\").text.strip().upper(),\n                 td.findAll(\"td\")[2].find(\"a\").text.strip().upper(),\n                 td.findAll(\"td\")[3].find(\"i\").text.replace('\\xa0','').strip()])\ncities\n","6be9ccd5":"!pip install fuzzywuzzy\n!pip install python-Levenshtein\noutput.clear()","09fa403b":"from fuzzywuzzy import fuzz \nfrom fuzzywuzzy import process \nimport re\ndef fn_city(n):\n  n if n.find('\"')==-1 else n[0:n.find('\"')].strip()\n  n = re.sub('[^A-Za-z]+', ' ', n).strip().upper()\n  n = n.replace(\"CENTRO\",\"\")\n  n = n.replace(\"CENTRAL\",\"\")\n  n = n.replace(\"COMERCIAL\",\"\")\n  n = n.replace(\"COMERCIO\",\"\")\n  n = n.replace(\"CENTRAL\",\"\")\n  n = n.replace(\"N \",\"\")\n  n = n.replace(\"DE \",\"\")\n  n = n.replace(\"MEGA \",\"\")\n  n = n.replace(\"COMPLEXO E \",\"\")\n  if n.find(\"SPB\")>=0:\n    n = \"Distrito Federal do Noroeste\"\n  else:\n    if n.find(\"UFA\")>=0:\n      n = \"Bascortost\u00e3o\"\n    else:\n      if n.find(\"MOSC\")>=0:\n        n = \"distrito federal central\"\n      else:\n        n = n.split(' ')[0]\n        c = [m[1] for m in cities]\n        n, s= process.extractBests(n, c)[0]  \n  return n\nshops[\"shop_shortname\"] = shops.shop_name.transform(lambda n:fn_city(n))\n\nshops[\"shop_city\"] = \"\"\nshops[\"shop_district\"]=\"\"\nshops[\"shop_population\"]=0\n\nquery = list(shops.shop_shortname.value_counts().index)\noutput.clear()\nfor q in query:\n  print(q.lower())\n  r, i = process.extractBests(q, cities)[0]\n  shops.loc[(shops.shop_shortname==q),\"shop_city\"] = r[0]\n  shops.loc[(shops.shop_shortname==q),\"shop_district\"]= r[1]\n  shops.loc[(shops.shop_shortname==q),\"shop_population\"]= int(r[2])","001276a1":"transpose(shops.shop_city.sort_values())","6754a1ca":"shops[\"shop_category\"] = shops.shop_name.str.split(\" \").map( lambda x: x[1].replace(\"(\",\"\").replace(\",\",\"\").replace(\".\",\"\").replace('\\\"','').upper()[0:1] )\ncats = list(shops.shop_category.value_counts().index)\nshops.loc[(shops.shop_category.isin(cats[3:])),\"shop_category\"]='O'\ntranspose(shops.shop_category.value_counts())","d28ac5a4":"cols = [ 'shop_id', 'shop_city', 'shop_district',  'shop_category']\nshops = shops[cols]\nshops.shop_district = shops.shop_district.astype('category')\nshops.shop_district = shops.shop_district.cat.codes\nshops.shop_category = shops.shop_category.astype('category')\nshops.shop_category = shops.shop_category.cat.codes\nshops.shop_city = shops.shop_city.astype('category')\nshops.shop_city = shops.shop_city.cat.codes\nshops.head()","9fce4f3c":"shops.shop_city.sort_index().plot.hist()\nplt.show()","dbc12ef9":"item_categories.head(1)","39193939":"item_categories[\"type\"] = item_categories.item_category_name.apply( lambda x: x.split(\" \")[0] ).astype(str)","76c3af25":"item_categories[\"type\"].value_counts()","99675690":"from subprocess import check_output\nfrom wordcloud import WordCloud, STOPWORDS\nstopwords = set(STOPWORDS)\nwordcloud = WordCloud(\n                          background_color='white',\n                          stopwords=stopwords,\n                          max_words=120,\n                          max_font_size=410, \n                          random_state=42\n                         ).generate(str(item_categories[\"type\"]))\n\nfig = plt.figure(1)\nplt.imshow(wordcloud)\nplt.axis('off')\nplt.show()","fb9a8d46":"item_categories.describe().transpose()","4354f0b4":"item_categories[\"item_category_type\"] =  item_categories.item_category_name+'- '\nitem_categories[\"item_category_type\"] = item_categories.item_category_type.transform(lambda c: c.split(\"-\")[0].strip().upper() if c.find(\" \")==-1 else c.split(\" \")[0].strip().upper()  )\nitem_categories[\"item_category_type\"] = item_categories.item_category_type.transform(lambda c: c if c.find(\"-\")==-1 else c.split(\"-\")[0].strip().upper()  )\ncategories = (item_categories[\"item_category_type\"].value_counts().index)\nitem_categories.loc[(item_categories.item_category_type.isin(categories[8:])),\"item_category_type\"]='OUTROS'\ntranspose(item_categories.item_category_type.value_counts()).transpose()","522cc538":"import re\ndef name(x):\n    x = x.lower() \n    x = x.partition('[')[0]\n    x = x.partition('(')[0] \n    x = re.sub('[^A-Za-z0-9\u0410-\u042f\u0430-\u044f]+', ' ', x) \n    x = x.replace('  ', ' ') \n    x = x.strip() \n    hi_blob = TextBlob(x)\n    x = hi_blob.translate(to='pt',from_lang='ru')\n    return str(x).upper()\n\nsample = items.sample(5)\nsample[\"item_name\"] = sample[\"item_name\"].apply(lambda x: name(x))\nsample.head(5)","8609fe0d":"items.describe().transpose()","85202c7e":"items.item_category_id.sort_index().plot.hist()\nplt.show()","720eda12":"items_categories = items.merge(item_categories,how='left',left_on='item_category_id', right_on='item_category_id')","5b879032":"items_categories.describe().transpose()","55728e9c":"items_categories = items_categories[[\"item_id\",\"item_category_id\",\"item_category_type\"]]\nitems_categories.reset_index(drop=True, inplace=True)\nitems_categories.head()","9e2dd661":"items_categories.item_category_id.sort_index().plot.hist()\nplt.show()","44fa84f6":"sales_train.head()","b96a3a36":"sales_train.describe().transpose()","9fa3dcaa":"fig, (ax1, ax2) = plt.subplots(1, 2)\nsales_train.item_price.sort_index().plot.hist(ax=ax1)\nax1.set_xlabel(\"item_price\")\nsales_train.item_cnt_day.sort_index().plot.hist(ax=ax2)\nax2.set_xlabel(\"item_cnt_day\")\nplt.show()","b424468b":"sales = sales_train.copy()\nsales = items.merge(sales,how='right',left_on='item_id', right_on='item_id')\nlen(sales),len(sales_train),len(items)","0bdb0861":"sales.head()","0bee701f":"sales.describe()","11fbc97a":"sales = items_categories.merge(sales,how='right',on=[\"item_id\",\"item_category_id\"])\nlen(sales),len(sales_train),len(items_categories)","7230b971":"sales.date_block_num.sort_index().plot.hist()","ca73f7ba":"import time\nts = time.time()\nsales.date  = pd.to_datetime(sales.date,errors='coerce')\nyears = (sales.date.dt.year.value_counts().index)\nmonths= (sales.date.dt.month.value_counts().index)\nyears\nsequence = 0\nfor i,y in enumerate(years.sort_values()):\n  for m in months.sort_values():\n    if y==2013 and m ==1:\n      sales.loc[(sales.date.dt.year==y)&(sales.date.dt.month==m),\"date_block_num\"]=0\n    else:\n      sequence+=1\n      sales.loc[(sales.date.dt.year==y)&(sales.date.dt.month==m),\"date_block_num\"]=sequence\ngc.collect()\ntime.time() - ts","74914250":"sales[\"dayofweek\"]= sales.date.dt.dayofweek\nsales[\"weekday\"]= sales.date.dt.weekday\nsales[\"quarter\"]= sales.date.dt.quarter\nsales[\"week\"]= sales.date.dt.week\nsales[\"month\"]= sales.date.dt.month\n#sales[\"year\"]= sales.date.dt.year\nsales[\"weekofyear\"]= sales.date.dt.weekofyear\nsales.head()","1e53850a":"sales.date_block_num.sort_index().plot.hist()","d57ccba2":"transpose(sales.item_price.describe())","0c4a1cff":"transpose(sales.item_price.describe())","85952d21":"transpose(sales.item_cnt_day.describe())","1035fece":"transpose(sales.item_cnt_day.describe())","bbe8fdda":"sales.pivot_table(index=[\"item_cnt_day\"])","565c6b96":"sales.pivot_table(index=[\"shop_id\"],columns=[\"date_block_num\"], aggfunc=[\"mean\"])","489fbd8e":"pd.pivot_table(sales,index=[\"date_block_num\",\"shop_id\",\"item_category_id\"],values=[\"item_cnt_day\"],aggfunc=[\"sum\",\"mean\"])","0b3805bd":"pd.pivot_table(sales,index=[\"date_block_num\",\"shop_id\",\"item_category_id\",\"item_id\"],values=[\"item_cnt_day\"],aggfunc=[\"sum\",\"mean\"])","cb30afeb":"pd.pivot_table(sales,index=[\"date_block_num\",\"shop_id\",\"item_category_id\",\"item_id\"],values=[\"item_cnt_day\"],aggfunc=[\"sum\",\"mean\"])","85706ad3":"sales.head()","c8951a4c":"pd.pivot_table(sales,index=[\"date_block_num\",\"month\"],values=[\"item_cnt_day\"],aggfunc=[\"sum\"])","bd10c68f":"pd.pivot_table(sales,index=[\"shop_id\"],values=[\"item_cnt_day\"],aggfunc=['mean','max','min','count'])","4f89c664":"**items_categories**","549bb930":"###### Overview","03876346":"##### Descri\u00e7\u00e3o\nEste desafio serve como projeto final para o curso Coursera \"Como ganhar um concurso de ci\u00eancia de dados\" .\n\nNesta competi\u00e7\u00e3o, voc\u00ea trabalhar\u00e1 com um conjunto de dados de s\u00e9rie temporal desafiador que consiste em dados di\u00e1rios de vendas, gentilmente cedidos por uma das **maiores empresas de software da russa** - a **1C Company** . \n\nPedimos que voc\u00ea preveja as vendas totais de cada produto e loja no pr\u00f3ximo m\u00eas. Ao resolver esta competi\u00e7\u00e3o, voc\u00ea poder\u00e1 aplicar e aprimorar suas habilidades em ci\u00eancia de dados.","3da89e7a":"*Obtendo mais informa\u00e7\u00f5es da wikipedia...*","3bd61f3d":"##### Dados","8e5d5cbc":"##### Regras","2188b7ce":"Voc\u00ea recebe dados hist\u00f3ricos de vendas di\u00e1rios. A tarefa \u00e9 prever a quantidade total de produtos vendidos em cada loja para o conjunto de teste. Observe que a lista de lojas e produtos muda ligeiramente a cada m\u00eas. Criar um modelo robusto que possa lidar com tais situa\u00e7\u00f5es \u00e9 parte do desafio.\n\n**Descri\u00e7\u00f5es de arquivo**\n> * **sales_train.csv** - o conjunto de treinamento. Dados hist\u00f3ricos di\u00e1rios de janeiro de 2013 a outubro de 2015.\n> * **test.csv** - o conjunto de teste. Voc\u00ea precisa prever as vendas dessas lojas e produtos para novembro de 2015.\n> * **sample_submission.csv** - um arquivo de envio de amostra no formato correto.\n> * **items.csv** - informa\u00e7\u00f5es complementares sobre os itens \/ produtos.\n> * **item_categories.csv**  - informa\u00e7\u00f5es complementares sobre as categorias de itens.\n> * **shops.csv** - informa\u00e7\u00f5es complementares sobre as lojas.\n\n**Campos de dados**\n> * **ID  - um Id que representa uma tupla (Loja, Item) dentro do conjunto de teste\n> * **shop_id** - identificador \u00fanico de uma loja\n> * **item_id** - identificador \u00fanico de um produto\n> * **item_category_id** - identificador \u00fanico da categoria do item\n> * **item_cnt_day** - n\u00famero de produtos vendidos. **Voc\u00ea est\u00e1 prevendo um valor mensal desta medida**  \ud83d\udca5\n> * **item_price** - pre\u00e7o atual de um item\n> * **data**  - data no formato dd \/ mm \/ aaaa\n> * **date_block_num** - um n\u00famero de m\u00eas consecutivo, usado por conveni\u00eancia. Janeiro de 2013 \u00e9 0, fevereiro de 2013 \u00e9 1, ..., outubro de 2015 \u00e9 33\n> * **item_name**  - nome do item\n> * **shop_name** - nome da loja\n> * **item_category_name** - nome da categoria do item","5c0d7402":"##### Traduzindo dados...","8445072d":"###### **Pivot Table**","50684a00":"<p><img alt=\"Colaboratory logo\" height=\"99px\" \nsrc='https:\/\/encrypted-tbn0.gstatic.com\/images?q=tbn:ANd9GcTpw-4GbEpC5PiordgozbjH7ILPI-X6NU_d7Q&usqp=CAU'\nalign=\"left\" hspace=\"10px\" vspace=\"0px\" ><\/p>\n<h1>Prever Vendas Futuras \n<p>Projeto final para o curso Coursera \"Como ganhar um concurso de ci\u00eancia de dados\"<\/p>\n<\/h1>\n<hr \/>\n<a href=\"https:\/\/www.kaggle.com\/c\/competitive-data-science-predict-future-sales\/rules\">Kaggle<\/a>\n","b8f50fe8":"##### Setup","a79f03da":">* **Limites de envio**: No m\u00e1ximo 5 inscri\u00e7\u00f5es por dia.\n\n[Submissions](https:\/\/www.kaggle.com\/c\/competitive-data-science-predict-future-sales\/submissions)","f63b6a5f":"**items**","febe422b":"\n<p><img alt=\"Colaboratory logo\" height=\"49px\" \nsrc='https:\/\/static.1c.ru\/images\/logo.png'\nalign=\"left\" hspace=\"10px\" vspace=\"0px\" ><\/p>\n<h1> 1C COMPANY\n<\/h1>\nFundada em 1991, a 1C Company \u00e9 especializada em desenvolvimento, distribui\u00e7\u00e3o, publica\u00e7\u00e3o e suporte de software para o mercado de massa. \n <a href=\"https:\/\/1c.ru\/eng\/title.htm\">site daa empresa<\/a>","908cd7d1":"**sales**","04685d40":"#### Analises","9c9ce3b7":"**item_categories**","95d12227":"> **shops**","b8ab1885":"**sales_train**"}}