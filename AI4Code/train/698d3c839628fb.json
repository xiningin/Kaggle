{"cell_type":{"69c5b74a":"code","4cd62aa0":"code","4070d256":"code","2b3b805f":"code","1449e5c1":"code","cca548f4":"code","e9966c5d":"code","847715bf":"code","e459ecc7":"code","ceba1ae0":"code","2bfd91e1":"code","3e3156bd":"code","1172ceda":"code","c63b4910":"code","f7e48ddc":"code","d3bdaa31":"code","540c15cc":"code","1feee17a":"code","7170e15c":"code","e6963106":"markdown","34386f29":"markdown","e4309372":"markdown","b6e52c69":"markdown"},"source":{"69c5b74a":"!pip install dataprep","4cd62aa0":"# load libraries\nimport numpy as np \nimport pandas as pd \nfrom dataprep.clean import clean_country\nfrom tabulate import tabulate\nfrom functools import reduce","4070d256":"# WHO national life expectancy data set\n# load data\nhealth_data = pd.read_csv(\"..\/input\/who-national-life-expectancy\/who_life_exp.csv\")\n\n# drop all years except 2016\nhealth_data.drop(health_data[health_data.year != 2016].index, inplace=True)\n\n# choose only relevant columns, drop NAs\nhealth = health_data[['country', 'life_expect', 'life_exp60', 'adult_mortality', \n                      'infant_mort', 'age1-4mort', 'alcohol', 'bmi', 'basic_water'\n                     ]].copy().dropna()\n# data set preview\nprint(health.shape)\nprint(health.info())\nprint(\"Unique countries: \", health.country.nunique())\nhealth.sort_values('country').head()","2b3b805f":"# 2016 Global Ecological Footprint data set\n# load data\neco_data = pd.read_csv(\"..\/input\/ecological-footprint\/countries.csv\")\n\n# choose only relevant columns, drop NAs\neco = eco_data[['Country', 'Population (millions)', 'HDI', 'GDP per Capita', \n                'Total Ecological Footprint', 'Total Biocapacity', \n                'Biocapacity Deficit or Reserve'\n               ]].copy().dropna()\n\n# clean column names \neco = eco.rename(columns={'Country': 'country', \n                          'Population (millions)': 'pop_mils',\n                          'HDI': 'development_index',\n                          'GDP per Capita': 'gdp_per_capita',\n                          'Total Ecological Footprint': 'eco_footprint',\n                          'Total Biocapacity': 'biocapacity',\n                          'Biocapacity Deficit or Reserve': 'deficit_or_reserve'})\n\n# clean GDP column: it is 'object' type, need to remove dollar sign and format column as float\neco['gdp_per_capita'] = eco['gdp_per_capita'].replace('[\\$,]', '', regex=True).astype(float)\n\n# data set preview\nprint(eco.shape)\nprint(eco.info())\nprint(\"Unique countries: \", eco.country.nunique())\neco.sort_values('country').head()","1449e5c1":"# The Human Freedom Index data set\n# load data\nfreedom_data = pd.read_csv(\"..\/input\/the-human-freedom-index\/hfi_cc_2018.csv\")\n\n# drop all years except 2016\nfreedom_data.drop(freedom_data[freedom_data.year != 2016].index, inplace=True)\n\n# choose only relevant columns, drop NAs \nfreedom = freedom_data[['countries', 'pf_rol', 'pf_ss', 'pf_movement', 'pf_religion',\n                       'pf_expression', 'pf_identity', 'pf_score', 'ef_government', 'ef_legal',\n                       'ef_money', 'ef_trade', 'ef_regulation', 'ef_score', 'hf_score']].copy().dropna()\n\n# rename columns for consistency\nfreedom = freedom.rename(columns={'countries': 'country'})\n\n# data set preview\nprint(freedom.shape)\nprint(freedom.info())\nprint(\"Unique countries: \", freedom.country.nunique())\nfreedom.sort_values('country').head()","cca548f4":"# World Happiness Report data set\n# load data\nhappiness_data = pd.read_csv('..\/input\/world-happiness\/2016.csv')\n\n# choose only relevant columns\nhappiness = happiness_data[['Country', 'Happiness Score']].copy()\n\n# rename columns for consistency\nhappiness = happiness.rename(columns={'Country': 'country',\n                                      'Happiness Score': 'happiness_score'})\n\n# data set preview\nprint(happiness.shape)\nprint(happiness.info())\nprint(\"Unique countries: \", happiness.country.nunique())\nhappiness.sort_values('country').head()","e9966c5d":"# clean country names for further merging \nhealth_clean = clean_country(health, \"country\")\neco_clean = clean_country(eco, \"country\")\nfreedom_clean = clean_country(freedom, \"country\")\nhappiness_clean = clean_country(happiness, \"country\")","847715bf":"# look at the country name that wasn't cleaned properly (if freedom data set)\nfreedom_clean[pd.isna(freedom_clean['country_clean'])]","e459ecc7":"# clean that country name manually\nfreedom_clean['country_clean'] = freedom_clean.apply(lambda row: 'Central African Republic' \n                                                                   if row['country'] == 'Central Afr. Rep.' \n                                                     else row['country_clean'], axis=1)","ceba1ae0":"# check that there are no more NAs\nfreedom_clean.info()","2bfd91e1":"# create sets of countries for each dataset\nhealth_set = set(health_clean.country_clean)\neco_set = set(eco_clean.country_clean)\nfreedom_set = set(freedom_clean.country_clean)\nhappiness_set = set(happiness_clean.country_clean)\nsets = {'health' : health_set, \n        'eco' : eco_set, \n        'freedom' : freedom_set, \n        'happiness' : happiness_set}\n\n# count unique values\nfor i in sets: \n    print(f\"In the set {i} - {len(sets[i])} countries\")\n    \n# how many intersections between sets do we have?\nintersection = set.intersection(*[sets[i] for i in sets])\nprint(\"Intersections: \", len(intersection))","3e3156bd":"# check for duplicates in cleaned country names in case clean_country function mislabeled them\ndfs = [health_clean, eco_clean, freedom_clean, happiness_clean]\nfor df in dfs:\n    print(\"%d unique countries out of %d\" % (df.country_clean.nunique(), len(df.country_clean)))","1172ceda":"# take a look at duplicates\nhappiness_clean[happiness_clean.duplicated(['country_clean'], keep=False)]","c63b4910":"# search for these countries in other data sets - are they mislabeled too?\nfor df in dfs:\n    print(tabulate(df.loc[df['country'].str.contains(\"cyprus\", case=False)].iloc[: , :3], \n                   headers='keys', tablefmt='psql'))\n    print(tabulate(df.loc[df['country'].str.contains(\"somali\", case=False)].iloc[: , :3], \n                   headers='keys', tablefmt='psql'))","f7e48ddc":"# other data sets have only Cyprus and Somalia, no mislabeling \n# drop rows 61 and 96 in happiness_clean\nhappiness_clean.drop(happiness_clean.index[[61,96]], inplace=True)\nfor df in dfs:\n    print(\"%d unique countries out of %d\" % (df.country_clean.nunique(), len(df.country_clean)))","d3bdaa31":"# merge 4 data sets on 'cuntry_clean' column\n# need to drop 'country' column first\nfor df in dfs:\n    df.drop(['country'], axis=1, inplace=True)\nfull_data = reduce(lambda  left,right: pd.merge(left,right,on=['country_clean'],\n                                            how='inner'), dfs)\n\n# reorder columns\nfull_data = full_data[['country_clean', 'life_expect', 'life_exp60', 'adult_mortality', \n                       'infant_mort', 'age1-4mort', 'alcohol', 'bmi', 'basic_water', \n       'pop_mils', 'development_index', 'gdp_per_capita', 'eco_footprint',\n       'biocapacity', 'deficit_or_reserve', 'pf_rol', 'pf_ss', 'pf_movement',\n       'pf_religion', 'pf_expression', 'pf_identity', 'pf_score',\n       'ef_government', 'ef_legal', 'ef_money', 'ef_trade', 'ef_regulation',\n       'ef_score', 'hf_score', 'happiness_score']]\n\n# rename 'country_clean' to 'country'\nfull_data = full_data.rename(columns={'country_clean': 'country'})\nfull_data.info()","540c15cc":"# ckeck for duplicates in the resulting data set after merging\nfull_data[full_data.duplicated(['country'], keep=False)].shape","1feee17a":"# merged data set\nfull_data.sort_values('country').head()","7170e15c":"# save merged data set\nfull_data.to_csv('2016_world_metrics.csv', index=False)","e6963106":"# Introduction\n## Main objective\n\nThis notebook focuses on merging 4 data sets (by country) to construct the single data set containing information on health and life expectancy data, ecological footprint, human freedom scores, and happiness scores to analyze which factors have the most prominent effect on happiness levels.\n\n## Data description\n\nDataset covers 137 countries (for 2016). \n\n|No|Column              |Description                                                       |Data type|Source|\n|--|--------------------|------------------------------------------------------------------|:-------:|:----:|\n|01|country             |country name                                                      |object   |      |\n|02|life_expect         |Life expectancy at birth (years)                                  |float    |1     |\n|03|life_exp60          |Life expectancy at age 60 (years)                                 |float    |1     |\n|04|adult_mortality     |Adult (15 to 60 years) Mortality Rates (per 1000 population)      |float    |1     |\n|05|infant_mort         |Death rate up to age 1                                            |float    |1     |\n|06|age1-4mort          |Death rate between ages 1 and 4                                   |float    |1     |\n|07|alcohol             |Alcohol consumption per capita (15+, in litres of pure alcohol)   |float    |1     |\n|08|bmi                 |Mean BMI (kg\/m^2) (18+, age-standardized estimate)                |float    |1     |\n|09|basic_water         |Population using at least basic drinking-water services           |float    |1     |\n|10|pop_mils            |Population (millions)                                             |float    |2     |\n|11|development_index   |Human Development Index                                           |float    |2     |\n|12|gdp_per_capita      |Gross Domestic Product (GDP) per capita (dollars)                 |float    |2     |\n|13|eco_footprint       |Use of ecological assets (measured in gha per person)             |float    |2     |\n|14|biocapacity         |Productivity of ecological assets (measured in gha per person)    |float    |2     |\n|15|defecit_or_reserve  |Biocapacity Deficit or Reserve (measured in gha per person)       |float    |2     |\n|16|pf_rol              |Personal Freedom score (Rule of Law)                              |float    |3     |\n|17|pf_ss               |Personal Freedom score (Security and Safety)                      |float    |3     |\n|18|pf_movement         |Personal Freedom score (Movement)                                 |float    |3     |\n|19|pf_religion         |Personal Freedom score (Religion)                                 |float    |3     |\n|20|pf_expression       |Personal Freedom score (Expression and Information)               |float    |3     |\n|21|pf_identity         |Personal Freedom score (Identity and Relationships)               |float    |3     |\n|22|pf_score            |General Personal Freedom score                                    |float    |3     |\n|23|ef_government       |Economic Freedom score (Size of Government)                       |float    |3     |\n|24|ef_legal            |Economic Freedom score (Legal System and Property Rights)         |float    |3     |\n|25|ef_money            |Economic Freedom score (Access to Sound Money)                    |float    |3     |\n|26|ef_trade            |Economic Freedom score (Freedom to Trade Internationally)         |float    |3     |\n|27|ef_regulation       |Economic Freedom score (Regulation of Credit, Labor, and Business)|float    |3     |\n|28|ef_score            |General Economic Freedom score                                    |float    |3     |\n|29|hf_score            |General Human Freedom score                                       |float    |3     |\n|30|happiness_score     |Ladder score (between 10 (best) and 0 (worst) possible life)      |float    |4     |\n  \n\n#### Sources\n1. [WHO national life expectancy](https:\/\/www.kaggle.com\/mmattson\/who-national-life-expectancy)\n>This set was primarily made using GHO (Global Health Observatory) and UNESCO (United Nations Educational Scientific and Culture Organization) information. The set covers the years 2000-2016 for 183 countries, in a single CSV file. Missing data is left in place, for the user to decide how to deal with it.\n2. [2016 Global Ecological Footprint](https:\/\/www.kaggle.com\/footprintnetwork\/ecological-footprint)\n>The ecological footprint measures the ecological assets that a given population requires to produce the natural resources it consumes and to absorb its waste, especially carbon emissions. The footprint tracks the use of six categories of productive surface areas: cropland, grazing land, fishing grounds, built-up (or urban) land, forest area, and carbon demand on land. A nation\u2019s biocapacity represents the productivity of its ecological assets.\nBoth the ecological footprint and biocapacity are expressed in global hectares \u2014 globally comparable, standardized hectares with world average productivity.\nIf a population\u2019s ecological footprint exceeds the region\u2019s biocapacity, that region runs an ecological deficit. Its demand for the goods and services exceeds what the region\u2019s ecosystems can renew. A region in ecological deficit meets demand by importing, liquidating its own ecological assets (such as overfishing), and\/or emitting carbon dioxide into the atmosphere. If a region\u2019s biocapacity exceeds its ecological footprint, it has an ecological reserve.\n3. [The Human Freedom Index](https:\/\/www.kaggle.com\/gsutters\/the-human-freedom-index)\n>The Human Freedom Index presents a broad measure of human freedom, understood as the absence of coercive constraint. It uses 79 distinct indicators of personal and economic freedom in the following areas: \n>* Rule of Law\n>* Security and Safety\n>* Movement\n>* Religion\n>* Association, Assembly, and Civil Society\n>* Expression and Information\n>* Identity and Relationships\n>* Size of Government\n>* Legal System and Property Rights\n>* Access to Sound Money\n>* Freedom to Trade Internationally\n>* Regulation of Credit, Labor, and Business\n4. [World Happiness Report](https:\/\/www.kaggle.com\/unsdsn\/world-happiness)\n>The World Happiness Report is a landmark survey of the state of global happiness. The happiness scores and rankings use data from the Gallup World Poll. The scores are based on answers to the main life evaluation question asked in the poll. This question, known as the Cantril ladder, asks respondents to think of a ladder with the best possible life for them being a 10 and the worst possible life being a 0 and to rate their own current lives on that scale.\n","34386f29":"<p style=\"text-align: center; font-weight: 700;\"> \nThank you for reading!<br \/>\nSince I am only at the beginning of my Data Science journey,<br \/> \nany kind of feedback (positive or negative) is greatly appreciated.\n\n<\/p>","e4309372":"# Merging data","b6e52c69":"# Loading and cleaning data"}}