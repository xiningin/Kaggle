{"cell_type":{"23a3e224":"code","a237d7d5":"code","4e958ca5":"code","f3842f06":"code","eaa2107d":"markdown","818e1837":"markdown","548e58bc":"markdown","ac628a84":"markdown"},"source":{"23a3e224":"import os\n\nimport pandas as pd\nimport transformers as trm\nfrom tqdm.auto import tqdm\n\n# Uses this utility script: https:\/\/www.kaggle.com\/xhlulu\/ner-tagging\nimport ner_tagging as tag","a237d7d5":"%%time\ntrain_df = pd.read_csv('..\/input\/feedback-prize-2021\/train.csv')\n\ntrain_dir = '..\/input\/feedback-prize-2021\/train'\ntrain_files = list(os.listdir(train_dir))\ntrain_ids = [f.replace('.txt', '') for f in train_files]\n\ntrain_essays = [\n    open(os.path.join(train_dir, f)).read()\n    for f in tqdm(train_files)\n]\n\ntrain_id_to_df = dict(list(train_df.groupby('id')))","4e958ca5":"tokenizer = trm.AutoTokenizer.from_pretrained(\"bert-base-cased\")\ntokens = tokenizer(train_essays, return_offsets_mapping=True, truncation=True, max_length=1024, padding='max_length')","f3842f06":"train_targets = []\n\n# First, you need to generate the tags from labels in the training dataframe\ntags, tag_to_num = tag.generate_tags(train_df.discourse_type, scheme=\"BILOU\")\n\nfor i, essay in enumerate(tqdm(train_essays)):\n    essay_df = train_id_to_df[train_ids[i]]\n    \n    # Using the offset_mapping obtained from the tokenizer, we can align\n    # it with the tagged characters to create the target for our model\n    target = tag.create_target(\n        text=essay,\n        labels=essay_df.discourse_type,\n        start=essay_df.discourse_start,\n        end=essay_df.discourse_end,\n        offset_mapping=tokens.offset_mapping[i],\n        tag_to_num=tag_to_num,\n        scheme=\"BILOU\"\n    )\n    train_targets.append(target)","eaa2107d":"Let's first load the training dataframe, along with the essays text and a dictionary to quickly map a id to a subset of the dataframe for the corresponding essay:","818e1837":"Let's use any tokenizer (you can change it here if needed) to tokenize our training text. I selected `bert-base-cased` but you can choose any tokenize you want; the important part is to keep the `return_offsets_mapping` to true so we can use it in the `iob.create_target` function later.","548e58bc":"We will now generate the target training data. ","ac628a84":"## NER Tagging Demo\n\nSee details at: https:\/\/www.kaggle.com\/c\/feedback-prize-2021\/discussion\/296669"}}