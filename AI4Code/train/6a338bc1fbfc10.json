{"cell_type":{"551d3d0c":"code","b5050e32":"code","6ccd9dde":"code","6e7af0eb":"code","7efffcea":"code","da894c95":"code","3540bcdd":"code","42637268":"markdown","e513728e":"markdown","fc7ab43b":"markdown","2e19eb01":"markdown","974aed3a":"markdown","4acde84b":"markdown","fe294ec9":"markdown"},"source":{"551d3d0c":"from scipy.stats.contingency import expected_freq\nfrom scipy.stats import power_divergence\nimport pandas as pd\nimport numpy as np\nimport warnings\n\ndata = pd.read_csv('..\/input\/heart.csv')\ndata.head()","b5050e32":"lambdas = [\n    'pearson', 'log-likelihood', 'freeman-tukey',\n    'mod-log-likelihood', 'neyman', 'cressie-read'\n]\n\ndef chi2(data, x, y):    \n    observed = pd.crosstab(data[x], data[y])\n    expected = pd.DataFrame(expected_freq(observed))\n    expected.columns = observed.columns\n    expected.index = observed.index\n    \n    if (observed < 5).sum().sum() > 0 or (expected < 5).sum().sum() > 0:\n        # An often quoted guideline for the validity of this\n        # calculation is that the test should be used only if\n        # the observed and expected frequencies in each cell\n        # are at least 5. (from SciPy docs)\n        warnings.warn('Low count on observed or expected frequencies.')\n    \n    dof = expected.size - sum(expected.shape) + expected.ndim - 1\n    delta_dof = observed.size - 1 - dof\n    \n    if dof == 0:\n        tests = [{'lambda':'any', 'chi2':0, 'p':1}]\n    else:\n        if dof == 1:\n            # Adjust `observed` according to Yates' correction for continuity.\n            observed = observed + 0.5 * np.sign(expected - observed)\n        tests = []\n        for lambda_ in lambdas:\n            chi2, p = power_divergence(\n                observed, expected, ddof=delta_dof,\n                axis=None, lambda_=lambda_)\n            tests.append({'lambda':lambda_, 'chi2':chi2, 'p':p})\n    tests = pd.DataFrame(tests)[['lambda', 'chi2', 'p']]\n    return expected, observed, dof, tests","6ccd9dde":"data['sex'].value_counts(ascending=True).plot(kind='bar')","6e7af0eb":"expected, observed, dof, tests = chi2(data, 'sex', 'target')","7efffcea":"expected.plot(kind='bar')","da894c95":"observed.plot(kind='bar')","3540bcdd":"tests","42637268":"## Defining the *chi2* function","e513728e":"## Evaluating the *sex* column","fc7ab43b":"Very low p-values, indeed. The *sex* column qualifies as a good predictor for heart diseases on this dataset.","2e19eb01":"There are more men than women on the dataset. So, **if the null hypothesis is true**, we should expect *proportionally* more men with heart diseases than women.","974aed3a":"Let's see what the data says.","4acde84b":"There is a **noticeable** difference. Women seem to be more vulnerable to heart diseases.\n\nThe chi-squared hypothesis tests should be sensitive to this. Let's take a look.","fe294ec9":"## Loading libs and data"}}