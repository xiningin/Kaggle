{"cell_type":{"8d654fc7":"code","93d8d0d7":"code","85de5308":"code","3483ec21":"code","079927e2":"code","385eb1a2":"code","5ff2952d":"code","5c023d4a":"code","6afca6f0":"code","1f52ac87":"code","54a1eef8":"code","18d96981":"code","20b3782d":"code","9f135e87":"code","ff2fd130":"code","d7a0d935":"code","d4e59a6f":"code","fbf5bf7a":"code","6bea0ce1":"code","d03bf9e8":"code","7f716fdf":"code","cb85c3e8":"code","d29c51c0":"code","0a12f847":"code","3fce5b85":"code","ba74637d":"code","24e96e77":"code","fd56c7a3":"code","96e0a210":"code","83505708":"markdown","f363b88a":"markdown","9e2aeab2":"markdown","136eea06":"markdown","bc7f0493":"markdown","07bd737d":"markdown","c44d57bd":"markdown","9025fc1c":"markdown","be61403d":"markdown"},"source":{"8d654fc7":"\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport nltk\nimport os\nimport pandas\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set_style('darkgrid')\n%matplotlib inline\nprint(os.listdir(\"..\/input\"))\n","93d8d0d7":"df_review = [line.rstrip() for line in open('..\/input\/amazon_alexa.tsv')]\nprint('the samples length is: ',len(df_review))","85de5308":"\ndf_review = pandas.read_csv('..\/input\/amazon_alexa.tsv', sep='\\t')\ndf_review.head()","3483ec21":"df_review.describe()","079927e2":"df_review.groupby('rating').describe()","385eb1a2":"# \u62bd\u53d6\u8bc4\u8bba\u8fd9\u4e00\u5217\u7684\u6570\u636e\u7684\u957f\u5ea6\ndf_review['length'] = df_review['verified_reviews'].apply(len)\ndf_review.head()","5ff2952d":"df_review['length'].plot(bins=50, kind='hist')","5c023d4a":"# \u53d6\u5bf9\u6570\u4ee5\u540e\u518d\u770b\ndf_review['loglength'] = df_review['length'].apply(lambda x:np.log(x+1))\ndf_review['loglength'].plot(bins=50, kind='hist')","6afca6f0":"df_review[['length','rating']].groupby('rating').describe()","1f52ac87":"df_review[['loglength','rating']].groupby('rating').describe()","54a1eef8":"df_review[df_review['length'] == df_review['length'].max()]['verified_reviews'].iloc[0]","18d96981":"df_review.hist(column='loglength', by='feedback', bins=50,figsize=(10,4))","20b3782d":"import numpy as np\nimport matplotlib.pyplot as plt","9f135e87":"# \u8bfb\u53d6\u6570\u636e\u96c6\ndataset = pd.read_csv('..\/input\/amazon_alexa.tsv', delimiter = '\\t', quoting = 3)\n","ff2fd130":"# \u521d\u6b65\u6e05\u7406\u5355\u8bcd\nimport re\nimport nltk\nfrom nltk.corpus import stopwords # \u52a0\u8f7d\u505c\u7528\u8bcd\nfrom nltk.stem.porter import PorterStemmer # \u5c06\u5355\u8bcd\u8fdb\u884c\u8fd8\u539f\ncorpus=[] # \u5904\u7406\u540e\u7684\u5355\u8bcd\u5217\u8868\nps=PorterStemmer() \nfor i in range(0,3150):\n    review = re.sub('[^a-zA-Z]', ' ', dataset['verified_reviews'][i] )\n    corpus.append(' '.join([ps.stem(word) for word in review.lower().split() if not word in set(stopwords.words('english'))]))\n","d7a0d935":"# \u5efa\u7acb\u8bcd\u888b\u6a21\u578b\nfrom sklearn.feature_extraction.text import CountVectorizer\ncv=CountVectorizer(max_features=1500)\ncv.fit(corpus)\nX=cv.transform(corpus).toarray()\ny=dataset.iloc[:,4].values","d4e59a6f":"X = np.array([np.hstack([X[i], df_review['loglength'].values[i]]) for i in range(3150)])","fbf5bf7a":"# Splitting the dataset into the Training set and Test set\nfrom sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.30, random_state = 0,stratify = y)\n","6bea0ce1":"import xgboost as xgb","d03bf9e8":"# \u5206\u7c7b\nfrom xgboost import XGBClassifier\nclassifier = XGBClassifier()\nclassifier.fit(X_train, y_train)","7f716fdf":"# \u9884\u6d4b\ny_pred = classifier.predict(X_test)\n","cb85c3e8":"# \u6df7\u6dc6\u77e9\u9635\nfrom sklearn.metrics import confusion_matrix\ncm = confusion_matrix(y_test, y_pred)","d29c51c0":"cm","0a12f847":"# \u5206\u7c7b\u62a5\u544a\nfrom  sklearn.metrics import classification_report as cr\nprint(cr(y_test, y_pred))","3fce5b85":"# \u5728\u7528lightGBM\u8bd5\u4e00\u4e0b\u770b\u770b\nimport lightgbm as lgb","ba74637d":"clf = lgb.LGBMClassifier(\n        boosting_type='gbdt', num_leaves=55, reg_alpha=0.0, reg_lambda=1,\n        max_depth=15, n_estimators=6000, objective='binary',\n        subsample=0.8, colsample_bytree=0.8, subsample_freq=1,\n        learning_rate=0.06, min_child_weight=1, random_state=20, n_jobs=4,is_unbalance = True\n    )\nclf.fit(X_train, y_train)\n","24e96e77":"y_pred = clf.predict(X_test)\nprint(cr(y_test, y_pred))","fd56c7a3":"cm2 = confusion_matrix(y_test, y_pred)\ncm2","96e0a210":"cm","83505708":"\u6240\u4ee5\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u5206\u5e03\u8fd8\u662f\u5448\u73b0\u5bf9\u6570\u6b63\u592a\u5206\u5e03\u7684\uff0c\u9664\u4e86\u4e00\u4e9b\u6570\u636e\u4e3a1\uff01","f363b88a":"Using rstrip() plus a list comprehension to get a list of all the lines of text reviews.","9e2aeab2":"\u81f3\u6b64\uff0c\u6211\u4eec\u7684\u6570\u636e\u5c31\u5df2\u7ecf\u8bfb\u53d6\u5b8c\u6bd5\uff0c\u540e\u9762\u5f00\u59cb\u7b80\u5355\u7684\u6570\u636e\u5206\u6790\u548c\u5efa\u6a21\u7684\u8fc7\u7a0b\uff01\n","136eea06":"\u770b\u4e00\u4e0b\u6700\u957f\u7684\u8bc4\u8bba\u662f\u4ec0\u4e48\u6837\u5b50\u7684\uff01\n","bc7f0493":"\u53ef\u4ee5\u770b\u5230\uff0c\u8bc4\u4ef7\u7ed9\u51fa5\u661f\u7684\u6700\u591a\u3002\n\n![](http:\/\/)Making a new column to detect how long the text messages are:","07bd737d":"\u5148\u7528XGBoost\u770b\u4e00\u4e0b\u6548\u679c\uff01","c44d57bd":"\u6211\u4eec\u5ea6\u5bf9\u4e24\u4e2a\u5206\u7c7b\u5668\u505a\u4e00\u4e0b\u5bf9\u6bd4\uff0c\u57280\u7c7b\u522b\u7684\u6837\u672c\u4e0a\uff0clightgbm\u7684\u6548\u679c\u8981\u5f88\u591a\u3002\n\n\u5f53\u7136\uff0c\u53ea\u662f\u8fd9\u6837\u7b80\u5355\u7684\u6bd4\u8f83\uff0c\u4e0b\u8fd9\u6837\u7684\u7ed3\u8bba\u8fd8\u592a\u65e9\uff0c\u5c31\u662f\u770b\u770b\u800c\u5df2\uff0c\u6bd5\u7adf\u6211\u4eec\u8fd8\u6ca1\u6709\u7cbe\u7ec6\u5730\u53bb\u5904\u7406\u6570\u636e\u96c6\uff01\n\n\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u8fd8\u6ca1\u6709\u505a\u53c2\u6570\u641c\u7d22\uff0c\u4f46\u662f\u5f97\u5230\u7684\u7ed3\u679c\uff0c\u663e\u7136\u5df2\u7ecf\u5f88\u4e0d\u9519\u4e86\uff01","9025fc1c":"\u53ef\u4ee5\u770b\u5230\uff0c\u7ed9\u51fa5\u661f\u8bc4\u4ef7\u7684\uff0c\u53cd\u800c\u603b\u4f53\u7684\u8bc4\u8bba\u5b57\u6570\u6700\u5c11\uff01","be61403d":"\u592a\u957f\u4e86\uff0c\u6211\u4e5f\u61d2\u5f97\u770b\uff01"}}