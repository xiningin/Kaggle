{"cell_type":{"5098300a":"code","caf4a48b":"code","bcae5f42":"code","c9fb1725":"code","e4f30fec":"code","6cf0a988":"code","9b86dcef":"code","1a6c17af":"code","06441813":"code","cc5a84ae":"code","9efad141":"code","ffbf60d5":"code","1bf63285":"code","ad39d732":"code","3654afc7":"code","46f91194":"code","e6cfd8e9":"code","be943e04":"code","f448f158":"code","0e5e6b92":"markdown","8c3adaa4":"markdown","ba5b7109":"markdown","1e5408f1":"markdown","f994e0b5":"markdown","34b58296":"markdown","e52afab2":"markdown","9c1f7aef":"markdown","5ee503ab":"markdown","e5a0182f":"markdown","25a7c64d":"markdown"},"source":{"5098300a":"from sklearn.datasets import fetch_20newsgroups","caf4a48b":"# CONSIDER 4 CATEGORIES\ncategories = ['alt.atheism', 'soc.religion.christian', 'comp.graphics', 'sci.med']","bcae5f42":"newsgroups_train = fetch_20newsgroups(subset='train', categories=categories)\nnewsgroups_test = fetch_20newsgroups(subset='test', categories=categories)","c9fb1725":"class_names = ['atheism', 'christian','graphics','med']","e4f30fec":"import sklearn","6cf0a988":"vectorizer = sklearn.feature_extraction.text.TfidfVectorizer(lowercase=False)\ntrain_vectors = vectorizer.fit_transform(newsgroups_train.data)\ntest_vectors = vectorizer.transform(newsgroups_test.data)","9b86dcef":"from sklearn.ensemble import RandomForestClassifier\nfrom sklearn.metrics import mean_absolute_error","1a6c17af":"rf = RandomForestClassifier(n_estimators=500)\nrf.fit(train_vectors, newsgroups_train.target)","06441813":"pred = rf.predict(test_vectors)\nmean_absolute_error(newsgroups_test.target, pred)","cc5a84ae":"pip install lime","9efad141":"from lime import lime_text\nfrom sklearn.pipeline import make_pipeline\nc = make_pipeline(vectorizer, rf)","ffbf60d5":"newsgroups_test.data[0]","1bf63285":"print(c.predict_proba([newsgroups_test.data[0]]))","ad39d732":"from lime.lime_text import LimeTextExplainer\nexplainer = LimeTextExplainer(class_names=class_names)","3654afc7":"idx = 83\nexp = explainer.explain_instance(newsgroups_test.data[idx], c.predict_proba, num_features=6,top_labels=4)#generate an explanation with at most 6 features \nprint('Document id: %d' % idx)\nprint('Probability(atheism) =', c.predict_proba([newsgroups_test.data[idx]])[0,0])\nprint('Probability(christian) =', c.predict_proba([newsgroups_test.data[idx]])[0,1])\nprint('Probability(graphics) =', c.predict_proba([newsgroups_test.data[idx]])[0,2])\nprint('Probability(med) =', c.predict_proba([newsgroups_test.data[idx]])[0,3])\nprint('True class: %s' % class_names[newsgroups_test.target[idx]])","46f91194":"exp.as_list()#explainer","e6cfd8e9":"print('Original prediction:', rf.predict_proba(test_vectors[idx])[0,1])\ntmp = test_vectors[idx].copy()\ntmp[0,vectorizer.vocabulary_['AVS']] = 0\ntmp[0,vectorizer.vocabulary_['graphics']] = 0\nprint('Prediction removing some features:', rf.predict_proba(tmp)[0,1])\nprint('Difference:', rf.predict_proba(tmp)[0,1] - rf.predict_proba(test_vectors[idx])[0,1])","be943e04":"fig = exp.as_pyplot_figure()","f448f158":"exp.show_in_notebook(text=False)","0e5e6b92":"These are the probablities for all 4 categories for the data shown above.","8c3adaa4":"Step 7 :Lime prediction","ba5b7109":"Step 6: Training using RandomForest","1e5408f1":"Step 5: Tokenizing the text using Vectoriser","f994e0b5":"## LIME ON TEXT","34b58296":"Step 1: loading the text dataset from sklearn","e52afab2":"INTERPRETATION -\nThe prediction probability of Christian is the highest.  The other 4 grpahs on right show the respective probabilities of being and not being the category.","9c1f7aef":"The highest probability was for christian , thus it is predicted right. ","5ee503ab":"Step 3: Splitting into 2","e5a0182f":"Step 4: Defining the class names according to the categories","25a7c64d":"Step 2: Text classification - determiming the type of text"}}