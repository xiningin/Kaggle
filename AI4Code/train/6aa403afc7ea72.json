{"cell_type":{"a090b321":"code","ddb32a7a":"code","78a70855":"code","9df9e824":"code","9aaacf50":"code","c0d0594f":"code","861e20ac":"code","25249920":"code","6d03723c":"code","70908ca5":"code","78e61ed0":"code","2fe59e31":"code","20196c47":"code","693dc68b":"code","9fdcde9f":"code","a906963a":"code","c9e8be3d":"code","cb3f3a8c":"code","fb0aea0c":"code","47ee882d":"code","06198163":"code","beb43cef":"code","656c2fce":"code","bb4993fe":"code","be05c960":"markdown","0550d994":"markdown","dbb6dcfb":"markdown","41aca39f":"markdown","60905f63":"markdown","a17c1df3":"markdown","a5ac74ee":"markdown"},"source":{"a090b321":"!pip install pmdarima","ddb32a7a":"import pandas as pd\nimport numpy as np\nimport pandas_datareader as pdr\nimport datetime as dt\nimport matplotlib.pyplot as plt\nplt.style.use('seaborn')\nimport seaborn as sns\n\n\nfrom statsmodels.tsa.stattools import adfuller\nfrom statsmodels.tsa.seasonal import seasonal_decompose\nfrom numpy import log\nfrom statsmodels.graphics.tsaplots import plot_acf, plot_pacf\nfrom statsmodels.tsa.arima.model import ARIMA\nfrom pmdarima import auto_arima\n","78a70855":"plt.rcParams['figure.figsize'] = (20,15)","9df9e824":"ticker = \"AAPL\"\nstart = dt.datetime(2015,1,1)\ndf = pdr.get_data_yahoo(ticker,start=start)","9aaacf50":"df.info()","c0d0594f":"df = df['Close']\ndf","861e20ac":"df.plot()","25249920":"result = adfuller(df)\nprint(f'Test Statistics : {result[0]} \\np-value : {result[1]}')","6d03723c":"fig, ax = plt.subplots(3,2)\nfor i in range(3):\n    ax[i,0].plot(df.diff())\n    ax[i,0].set_title(f'{i+1}-th Difference')\n    plot_acf(df.diff(periods=i+1).dropna(), ax=ax[i,1])","70908ca5":"for i in range(3):\n    result = adfuller(df.diff(i+1).dropna()) \n    print(f'\\nFor {i+1}-th diffrence we have the following \\nTest Statistics : {result[0]} \\np-value : {result[1]}')","78e61ed0":"plt.plot(df.diff())\nplt.title(f'1st Difference')\nplot_pacf(df.diff().dropna())","2fe59e31":"model = ARIMA(df, order=(1,1,1))\nmodel_fit = model.fit()\nprint(model_fit.summary())","20196c47":"plt.subplot(211)\nplt.plot(model_fit.resid)\nplt.subplot(212)\nsns.kdeplot(model_fit.resid)","693dc68b":"model_fit.plot_diagnostics()\nplt.tight_layout()","9fdcde9f":"plt.figure(figsize=(15,10))\nmodel_fit.predict(dynamic=False).plot(label='Predicted')\ndf.plot(label='Original')\nplt.legend()","a906963a":"train_size = int(len(df)*.85)\n\ntrain, test = df[:train_size], df[train_size:]","c9e8be3d":"model = ARIMA(train, order=(1,1,1))\nmodel_fit = model.fit()\nprint(model_fit.summary())","cb3f3a8c":"fc = pd.Series(model_fit.forecast(len(test)))\nfc.index = test.index\nfc","fb0aea0c":"train.plot(label='Training data')\ntest.plot(label='Test data')\nfc.plot(label='Predictions')\nplt.legend()\n","47ee882d":"res = seasonal_decompose(pd.DataFrame(df), period=30, model='add')\nres.plot();","06198163":"model = auto_arima(pd.DataFrame(df), max_p=6, max_q=3, m=5, seasonal=True, max_P=4, max_Q=4, max_D=2, max_order=None,\n                   d=None, trace=True, trend='ct',\n                   out_of_sample_size = int(len(df)*.2),\n                   error_action='ignore',   # we don't want to know if an order does not work\n                   suppress_warnings=True,  # we don't want convergence warnings\n                   stepwise=True) # set to stepwise\nmodel.summary()\n","beb43cef":"model = ARIMA(train, order=(0,2,1), seasonal_order=(0,0,0,5))\nmodel_fit = model.fit()\nprint(model_fit.summary())","656c2fce":"fc = pd.Series(model_fit.forecast(len(test)))\nfc.index = test.index\nfc","bb4993fe":"train.plot(label='Training data')\ntest.plot(label='Test data')\nfc.plot(label='Predictions')\nplt.legend()","be05c960":"Hence, we take d = 1. Next, we find p.","0550d994":"Next, we restrict ourself to the 'Close' column. ","dbb6dcfb":"So d = 1 seem to be the right choice. Let us check p-values to check if d = 1 is a right choice. Also, it is clear that q = 1.","41aca39f":"Clearly, it is not stationary. DF Test will made sure that.","60905f63":"So p = 1 seem to be right.","a17c1df3":"So far we have modelled using all data, which does not help us conclude if model is good. So now we do train test split.","a5ac74ee":"# Auto ARIMA.\nA wonderful video to understand autoarima, https:\/\/www.youtube.com\/watch?v=U6DYCaTUBpA"}}