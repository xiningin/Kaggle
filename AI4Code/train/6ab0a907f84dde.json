{"cell_type":{"d3d787c3":"code","aa62397b":"code","aeb9675d":"code","92207566":"code","e53d7f04":"code","fe81d32a":"code","7660bb43":"code","4fbc6e74":"code","f35fea54":"code","0f7d1bff":"code","16c92cb2":"markdown","3dceb1c2":"markdown","a8b22f66":"markdown","18aa4ba4":"markdown","7dcc4680":"markdown"},"source":{"d3d787c3":"import numpy as np \nimport pandas as pd \n\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.model_selection import StratifiedKFold\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.metrics import classification_report\nfrom sklearn.metrics import confusion_matrix\n\nfrom imblearn.under_sampling import RandomUnderSampler\nfrom imblearn.over_sampling import SMOTE","aa62397b":"class config:\n    ROOT_DIR = \"\/kaggle\/input\/predicting-pulsar-starintermediate\"\n    SEED = 0\n    N_FOLD = 5","aeb9675d":"train_df = pd.read_csv(f\"{config.ROOT_DIR}\/pulsar_data_train.csv\")\ntest_df = pd.read_csv(f\"{config.ROOT_DIR}\/pulsar_data_test.csv\")","92207566":"train_df = train_df.fillna(train_df.mean())\ntest_df = test_df.fillna(test_df.mean())","e53d7f04":"x_train_df = train_df.drop(\"target_class\", axis=1)\nx_test_df = test_df.drop(\"target_class\", axis=1)\ny_train = train_df[\"target_class\"].values","fe81d32a":"scaler = StandardScaler()\nscaler.fit(x_train_df.values)\n\nx_train = scaler.transform(x_train_df.values)\nx_test = scaler.transform(x_test_df.values)","7660bb43":"skf = StratifiedKFold(n_splits=config.N_FOLD, random_state=config.SEED, shuffle=True)\n\noof = np.zeros(len(y_train))\nfor fold, (fit_i, val_i) in enumerate(skf.split(x_train, y_train)):\n    \n    x_fit = x_train[fit_i, :]\n    y_fit = y_train[fit_i]\n    x_val = x_train[val_i, :]\n    y_val = y_train[val_i]\n    \n    model = LogisticRegression()\n    model.fit(x_fit, y_fit)\n    \n    y_pred = model.predict(x_val)\n    \n    oof[val_i] = y_pred\n\nres_d = classification_report(y_train, oof, output_dict=True)\nacc, pre, rec, f1 = res_d[\"accuracy\"], res_d[\"1.0\"][\"precision\"], res_d[\"1.0\"][\"recall\"], res_d[\"1.0\"][\"f1-score\"]\nprint(f\"accuracy={acc:.4}, precision={pre:.4}, recall={rec:.4}, f1-score={f1:.4}\")\n\ncm = confusion_matrix(y_train, oof)\ndisplay(pd.DataFrame(cm, columns=[\"TP\", \"FP\"], index=[\"FN\", \"TN\"]))","4fbc6e74":"skf = StratifiedKFold(n_splits=config.N_FOLD, random_state=config.SEED, shuffle=True)\n\noof = np.zeros(len(y_train))\nfor fold, (fit_i, val_i) in enumerate(skf.split(x_train, y_train)):\n    \n    x_fit = x_train[fit_i, :]\n    y_fit = y_train[fit_i]\n    x_val = x_train[val_i, :]\n    y_val = y_train[val_i]\n    \n    # UnderSampling\n    positive_count_train = int(y_fit.sum())\n    rus = RandomUnderSampler(sampling_strategy={0:positive_count_train, 1:positive_count_train}, random_state=config.SEED)\n    x_fit_resampled, y_fit_resampled = rus.fit_resample(x_fit, y_fit)\n    \n    model = LogisticRegression()\n    model.fit(x_fit_resampled, y_fit_resampled)\n    \n    y_pred = model.predict(x_val)\n    \n    oof[val_i] = y_pred\n\nres_d = classification_report(y_train, oof, output_dict=True)\nacc, pre, rec, f1 = res_d[\"accuracy\"], res_d[\"1.0\"][\"precision\"], res_d[\"1.0\"][\"recall\"], res_d[\"1.0\"][\"f1-score\"]\nprint(f\"accuracy={acc:.4}, precision={pre:.4}, recall={rec:.4}, f1-score={f1:.4}\")\n\ncm = confusion_matrix(y_train, oof)\ndisplay(pd.DataFrame(cm, columns=[\"P(predict)\", \"N(Predict)\"], index=[\"P(True)\", \"N(True)\"]))","f35fea54":"skf = StratifiedKFold(n_splits=config.N_FOLD, random_state=config.SEED, shuffle=True)\n\noof = np.zeros(len(y_train))\nfor fold, (fit_i, val_i) in enumerate(skf.split(x_train, y_train)):\n    \n    x_fit = x_train[fit_i, :]\n    y_fit = y_train[fit_i]\n    x_val = x_train[val_i, :]\n    y_val = y_train[val_i]\n    \n    # OverSampling\n    sm = SMOTE()\n    x_fit_resampled, y_fit_resampled = sm.fit_resample(x_fit, y_fit)\n    \n    model = LogisticRegression()\n    model.fit(x_fit_resampled, y_fit_resampled)\n    \n    y_pred = model.predict(x_val)\n    \n    oof[val_i] = y_pred\n\nres_d = classification_report(y_train, oof, output_dict=True)\nacc, pre, rec, f1 = res_d[\"accuracy\"], res_d[\"1.0\"][\"precision\"], res_d[\"1.0\"][\"recall\"], res_d[\"1.0\"][\"f1-score\"]\nprint(f\"accuracy={acc:.4}, precision={pre:.4}, recall={rec:.4}, f1-score={f1:.4}\")\n\ncm = confusion_matrix(y_train, oof)\ndisplay(pd.DataFrame(cm, columns=[\"P(predict)\", \"N(Predict)\"], index=[\"P(True)\", \"N(True)\"]))","0f7d1bff":"skf = StratifiedKFold(n_splits=config.N_FOLD, random_state=config.SEED, shuffle=True)\n\noof = np.zeros(len(y_train))\nfor fold, (fit_i, val_i) in enumerate(skf.split(x_train, y_train)):\n    \n    x_fit = x_train[fit_i, :]\n    y_fit = y_train[fit_i]\n    x_val = x_train[val_i, :]\n    y_val = y_train[val_i]\n    \n    # UnderSampling\n    y_preds = []\n    for i in range(10):\n        positive_count_train = int(y_fit.sum())\n        rus = RandomUnderSampler(sampling_strategy={0:positive_count_train, 1:positive_count_train}, random_state=config.SEED+i)\n        x_fit_resampled, y_fit_resampled = rus.fit_resample(x_fit, y_fit)\n    \n        model = LogisticRegression()\n        model.fit(x_fit_resampled, y_fit_resampled)\n    \n        _y_pred = model.predict(x_val)\n        y_preds.append(_y_pred)\n    \n    y_pred = (np.array(y_preds).mean(0) > 0.5).astype(int)\n    oof[val_i] = y_pred\n\nres_d = classification_report(y_train, oof, output_dict=True)\nacc, pre, rec, f1 = res_d[\"accuracy\"], res_d[\"1.0\"][\"precision\"], res_d[\"1.0\"][\"recall\"], res_d[\"1.0\"][\"f1-score\"]\nprint(f\"accuracy={acc:.4}, precision={pre:.4}, recall={rec:.4}, f1-score={f1:.4}\")\n\ncm = confusion_matrix(y_train, oof)\ndisplay(pd.DataFrame(cm, columns=[\"P(predict)\", \"N(Predict)\"], index=[\"P(True)\", \"N(True)\"]))","16c92cb2":"## Load and Arrange Dataset","3dceb1c2":"## UnderSampling Ensemble","a8b22f66":"## UnderSampling","18aa4ba4":"## OverSampling(SMOTE)","7dcc4680":"## Original"}}