{"cell_type":{"021ca786":"code","d284675b":"code","b75e8c58":"code","df538ca8":"code","38ec18f9":"code","c2fc768d":"code","57b6399b":"code","e961ee5d":"code","51b357dc":"code","0579d783":"code","3d7ad0d6":"code","ff90b2de":"code","edf346bb":"code","d33f69af":"code","566ab8ef":"markdown","08b98a54":"markdown","e8ff7dcc":"markdown","2e2971c5":"markdown","d9082832":"markdown","8e885342":"markdown","c45f6e77":"markdown","30b3156a":"markdown","21ebc0db":"markdown","e65b06e3":"markdown","6869e437":"markdown"},"source":{"021ca786":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nimport tensorflow as tf\nfrom tensorflow.keras.preprocessing import image\nfrom keras.preprocessing.image import ImageDataGenerator,load_img, img_to_array\nfrom tensorflow.keras.metrics import categorical_crossentropy\nfrom keras.models import Sequential, Model\nfrom keras.layers import Conv2D, MaxPooling2D,GlobalAveragePooling2D\nfrom keras.layers import Activation, Dropout, BatchNormalization, Flatten, Dense, AvgPool2D,MaxPool2D\nfrom keras.models import Sequential, Model\nfrom keras.optimizers import Adam, SGD, RMSprop\nfrom keras import backend as K\n\nimport cv2\nimport shutil\nimport glob\nimport os","d284675b":"data = '..\/input\/brain-mri-images-for-brain-tumor-detection\/'\nNo_brain_tumor = '..\/input\/brain-mri-images-for-brain-tumor-detection\/no\/'\nYes_brain_tumor = '..\/input\/brain-mri-images-for-brain-tumor-detection\/yes\/'","b75e8c58":"dirlist=[No_brain_tumor, Yes_brain_tumor]\nclasses=['No', 'Yes']\nfilepaths=[]\nlabels=[]\nfor i,j in zip(dirlist, classes):\n    filelist=os.listdir(i)\n    for f in filelist:\n        filepath=os.path.join (i,f)\n        filepaths.append(filepath)\n        labels.append(j)\nprint ('filepaths: ', len(filepaths), '   labels: ', len(labels))","df538ca8":"Files=pd.Series(filepaths, name='filepaths')\nLabel=pd.Series(labels, name='labels')\ndf=pd.concat([Files,Label], axis=1)\ndf=pd.DataFrame(np.array(df).reshape(253,2), columns = ['filepaths', 'labels'])\ndf.head()","38ec18f9":"print(df['labels'].value_counts())","c2fc768d":"plt.figure(figsize=(12,8))\nfor i in range(15):\n    random = np.random.randint(1,len(df))\n    plt.subplot(3,5,i+1)\n    plt.imshow(cv2.imread(df.loc[random,\"filepaths\"]))\n    plt.title(df.loc[random, \"labels\"], size = 15, color = \"white\") \n    plt.xticks([])\n    plt.yticks([])\n    \nplt.show()","57b6399b":"from sklearn.model_selection import train_test_split\n\ntrain, test = train_test_split(df, train_size=0.95, random_state=0)\ntrain_new, valid = train_test_split(train, train_size=0.90, random_state=0)\n\nprint(f\"train set shape: {train_new.shape}\")\nprint(f\"test set shape: {test.shape}\")\nprint(f\"validation set shape: {valid.shape}\")","e961ee5d":"train_datagen = ImageDataGenerator(rescale = 1.\/255.,rotation_range = 40, width_shift_range = 0.2, height_shift_range = 0.2, \n                                   shear_range = 0.2, zoom_range = 0.2, horizontal_flip = True, vertical_flip =True)\ntest_datagen = ImageDataGenerator(rescale = 1.0\/255.)","51b357dc":"train_gen = train_datagen.flow_from_dataframe(dataframe = train_new,\n                                              x_col = 'filepaths', y_col ='labels',\n                                              target_size = (150,150), batch_size = 16, \n                                              class_mode = 'binary', shuffle = True)\nval_gen = train_datagen.flow_from_dataframe(valid, \n                                            target_size=(150,150), x_col = 'filepaths', y_col ='labels', \n                                            class_mode='binary',\n                                            batch_size= 16, shuffle=True)\ntest_gen = test_datagen.flow_from_dataframe(test,\n                                            target_size = (150,150), x_col = 'filepaths', y_col ='labels',\n                                             class_mode = 'binary',\n                                            batch_size = 16, shuffle = False)","0579d783":"train_gen.class_indices","3d7ad0d6":"base_model = tf.keras.applications.InceptionResNetV2(weights='imagenet', input_shape = (200,200,3),\n                                                     include_top=False)\n    \nmodel = Sequential()\nmodel.add(base_model)\nmodel.add(GlobalAveragePooling2D())\nmodel.add(Dense(128, activation = 'relu'))\nmodel.add(BatchNormalization())\nmodel.add(Dropout(0.2))\nmodel.add(Dense(1, activation = 'sigmoid'))\nmodel.summary()\n","ff90b2de":"callbacks = [\n    tf.keras.callbacks.ModelCheckpoint(\"Tumor_classifier_model.h5\", save_best_only=True, verbose = 0),\n    tf.keras.callbacks.EarlyStopping(patience=3, monitor='val_loss', verbose=1),\n]\n\n\nmodel.compile(loss='binary_crossentropy', optimizer=Adam(lr = 0.0001), metrics=['accuracy'])\n\n\nhistory = model.fit(train_gen, validation_data = val_gen, epochs = 40, \n                    callbacks = [callbacks], verbose = 1)","edf346bb":"model.load_weights(\"Tumor_classifier_model.h5\")\nmodel.evaluate(test_gen)","d33f69af":"\nacc = history.history['accuracy']\nval_acc = history.history['val_accuracy']\nloss = history.history['loss']\nval_loss = history.history['val_loss']\nepochs_range = range(1, len(history.epoch) + 1)\n\nplt.figure(figsize=(15,5))\n\nplt.subplot(1, 2, 1)\nplt.plot(epochs_range, acc, label='Train Set')\nplt.plot(epochs_range, val_acc, label='Val Set')\nplt.legend(loc=\"best\")\nplt.xlabel('Epochs')\nplt.ylabel('Accuracy')\nplt.title('Model Accuracy')\n\nplt.subplot(1, 2, 2)\nplt.plot(epochs_range, loss, label='Train Set')\nplt.plot(epochs_range, val_loss, label='Val Set')\nplt.legend(loc=\"best\")\nplt.xlabel('Epochs')\nplt.ylabel('Loss')\nplt.title('Model Loss')\n\nplt.tight_layout()\nplt.show()","566ab8ef":"Now fit the them to get the images from directory (name of the images are given in dataframe) with augmentation","08b98a54":"# CNN model","e8ff7dcc":"# Data Augmentation","2e2971c5":"# Importing necessary libraries","d9082832":"_We will create a model which will correctly classify if the MRI image of the brain has tumor or not._","8e885342":"Let's start the modelling task\nThe ImageDataGenerator for keras is awesome.\nIt lets you augment your images in real-time while your model is still training! \nYou can apply any random transformations on each training image as it is passed to the model. \nThis will not only make your model robust but will also save up on the overhead memory!\n\n\nWe will apply the Image Data Generator on training with various parameters, but we won't apply \nthe same parameters on testin. Why?\nBecause we want the test iamges as it is, we don't want biasedness,\nalso if we fit it we will be applying\nthe model only on these test images only, it can't predict new images if fed into model\nBecause new images will not be augmented this way","c45f6e77":"# Brain Tumor Detection using CNN and tranfer learning","30b3156a":"**84.6% Accuracy on test set**","21ebc0db":"# plot model performance","e65b06e3":"# visualize brain tumor images","6869e437":"# Data import & preprocessing"}}