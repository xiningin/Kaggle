{"cell_type":{"63b38ff8":"code","9907e512":"code","1b43e2c8":"code","3cba8ae7":"code","0bddf533":"code","2e9f2307":"code","96a0642e":"code","3c6b5361":"code","15194ae9":"code","909b6d86":"code","a20df976":"code","5b4e3504":"code","e8253f8b":"code","f8b952d0":"code","f9c33978":"code","7167282a":"code","c32b3206":"code","aa743bbc":"code","29dc881b":"code","0466f4f8":"code","a4f13fe6":"code","f6e1cd60":"code","6fa041bc":"code","6124da3a":"code","32574351":"code","24b14bfe":"code","6d4cec75":"code","aa0ab84c":"code","67cb8bc7":"code","98c6a9da":"markdown","67687044":"markdown","77079c99":"markdown","691e9db3":"markdown","8872c368":"markdown","115f5506":"markdown","b8b6ad15":"markdown","491f2aff":"markdown","177a2b1e":"markdown","25a3d7eb":"markdown","1d0c76e6":"markdown","d4fe8974":"markdown","c51ab2d4":"markdown","eff3d7bc":"markdown","c6df17e3":"markdown","6a447d4f":"markdown","b1382706":"markdown","9ee9688a":"markdown","2fdc1bf0":"markdown","3a6ab0bd":"markdown","f8dcf250":"markdown","128d94ba":"markdown","be089f03":"markdown","a257c7dd":"markdown","f3821c43":"markdown","cbd7d972":"markdown","93400c1e":"markdown","6240adec":"markdown","3589aa06":"markdown","cd0a811d":"markdown","b3b79a3f":"markdown"},"source":{"63b38ff8":"import plotly.express as px\nfrom plotly.subplots import make_subplots\nimport matplotlib.pyplot as plt\n\nimport random as rnd\nimport re\nimport string\nimport operator\nimport numpy as np\nimport pandas as pd\n\nfrom wordcloud import WordCloud\n\nfrom nltk.corpus import stopwords\nfrom nltk.tokenize import TweetTokenizer, word_tokenize","9907e512":"df = pd.read_csv('..\/input\/trip-advisor-hotel-reviews\/tripadvisor_hotel_reviews.csv')","1b43e2c8":"print(f\"Theres {df.shape[0]} reviews in this dataset. Lets explore it!\")","3cba8ae7":"color_map = {\n                \"1\": \"#EF553B\",\n                \"2\": \"#FFA15A\",\n                \"3\": \"#FECB52\",\n                \"4\": \"#B6E880\",\n                \"5\": \"#00CC96\"\n            }","0bddf533":"x = df.Rating.value_counts().reset_index().rename(columns={'index': 'Rating', 'Rating': 'Count'})\nfig = px.bar(x, \n             x=\"Rating\", \n             y=\"Count\", \n             color=\"Rating\", \n             color_continuous_scale=[\"#EF553B\", \"#FFA15A\", \"#FECB52\", \"#B6E880\", \"#00CC96\"],\n             title=\"Reviews by rating\"\n            )\n\n\nfig.update_layout(\n    autosize=False,\n    width=800,\n    height=500,\n    margin=dict(l=0,r=0,b=0)\n)\n\nfig.update_layout(coloraxis_showscale=False)\n\nfig.show()","2e9f2307":"len(df.Review.unique()), df.isna().sum()","96a0642e":"df['text_length'] = df.Review.str.len()\n\nfig = px.histogram(df, \n                   x='text_length', \n                   color='Rating', \n                   color_discrete_sequence=[\"#B6E880\", \"#FFA15A\", \"#FECB52\", \"#00CC96\", \"#EF553B\"],\n                   title=\"Review length distributions\"\n                  )\n\nfig.update_layout(\n    autosize=False,\n    width=800,\n    height=500,\n    margin=dict(l=0,r=0,b=0)\n)\n\nfig.show()","3c6b5361":"df['number_of_words'] = df.Review.str.split().map(lambda x: len(x))\n\nfig = px.histogram(df, \n                   x='number_of_words', \n                   color='Rating', \n                   color_discrete_sequence=[\"#B6E880\", \"#FFA15A\", \"#FECB52\", \"#00CC96\", \"#EF553B\"],\n                   title=\"Number of words distribution\"\n                  )\n\nfig.update_layout(\n    autosize=False,\n    width=800,\n    height=500,\n    margin=dict(l=0,r=0,b=0)\n)\n\nfig.show()","15194ae9":"def create_corpus_df(df):\n    corpus = []\n    \n    \n    for i in range(df.shape[0]):\n        words = word_tokenize(df.loc[i, 'Review'])\n        rating = df.loc[i, 'Rating']\n        \n        for w in words:\n            corpus.append([w, rating])\n            \n    return np.asarray(corpus)","909b6d86":"corpus = create_corpus_df(df)","a20df976":"corpus_df = pd.DataFrame(corpus, columns=['token', 'rating'])","5b4e3504":"def get_stopwords_from_corpus(corpus_df, n=10):\n    stop = set(stopwords.words('english'))\n    \n    corpus_stop_df = corpus_df[corpus_df['token'].isin(stop)].copy()\n    \n    corpus_stop_df['count'] = 1\n    \n    corpus_stop_df = corpus_stop_df.groupby(by=['token', 'rating']).count().reset_index().sort_values('count', ascending=False)\n\n    tokens = corpus_stop_df['token'].unique().tolist()[:n]\n        \n    return corpus_stop_df[corpus_stop_df['token'].isin(tokens)]","e8253f8b":"x = get_stopwords_from_corpus(corpus_df, n=5)\n\nfig = px.bar(x, \n             x=\"token\", \n             y=\"count\", \n             color=\"rating\", \n             color_discrete_map=color_map,\n             title=\"Top common stopwords\"\n            )\n\n\nfig.update_layout(\n    autosize=False,\n    width=800,\n    height=500,\n    margin=dict(l=0,r=0,b=0),\n    barmode='group'\n)\n\nfig.show()","f8b952d0":"def get_common_words_from_corpus(corpus_df, n_top=20):\n    stop = set(stopwords.words('english'))\n    puncts = word_tokenize(string.punctuation)\n    \n    corpus_stop_df = corpus_df[(~corpus_df['token'].isin(stop)) & (~corpus_df['token'].isin(puncts))].copy()\n    \n    corpus_stop_df['count'] = 1\n    \n    corpus_stop_df = corpus_stop_df.groupby(by=['token', 'rating']).count().reset_index().sort_values('count', ascending=False)\n\n    tokens = corpus_stop_df['token'].unique().tolist()[:n_top]\n    \n    return corpus_stop_df[corpus_stop_df['token'].isin(tokens)]","f9c33978":"x = common_words = get_common_words_from_corpus(corpus_df, n_top=10)\n\nfig = px.bar(x, x=\"token\", y=\"count\", color=\"rating\", color_discrete_map=color_map, title=\"Top common words\")\n\n\nfig.update_layout(\n    autosize=False,\n    width=800,\n    height=500,\n    margin=dict(l=0,r=0,b=0),\n    barmode='group'\n)\n\nfig.show()","7167282a":"def get_common_punctuations_from_corpus(corpus_df):\n    puncts = word_tokenize(string.punctuation)\n    \n    corpus_stop_df = corpus_df[corpus_df['token'].isin(puncts)].copy()\n    \n    corpus_stop_df['count'] = 1\n    \n    corpus_stop_df = corpus_stop_df.groupby(by=['token', 'rating']).count().reset_index().sort_values('count', ascending=False)\n    \n    return corpus_stop_df","c32b3206":"x = get_common_punctuations_from_corpus(corpus_df)\n\nx.groupby('token')['count'].sum()","aa743bbc":"def remove_punctuation(df):\n    \n    # remove punctuations\n    table = str.maketrans('', '', string.punctuation)\n    df['Review'] = df['Review'].str.translate(table)\n    \n    # remove extra spaces '  '\n    df['Review'] = df['Review'].replace(r'\\s\\s+', ' ', regex=True)\n    \n    return df","29dc881b":"df = remove_punctuation(df)","0466f4f8":"%%time\ncorpus = df['Review'].apply(word_tokenize).tolist()\nlen(corpus), df.shape[0]","a4f13fe6":"corpus = np.asarray(corpus)\ntargets = np.asarray(df['Rating'].tolist())","f6e1cd60":"%%time\ncorpus_1 = df[df['Rating'] == 1]['Review'].apply(word_tokenize).tolist()\ncorpus_2 = df[df['Rating'] == 2]['Review'].apply(word_tokenize).tolist()\ncorpus_3 = df[df['Rating'] == 3]['Review'].apply(word_tokenize).tolist()\ncorpus_4 = df[df['Rating'] == 4]['Review'].apply(word_tokenize).tolist()\ncorpus_5 = df[df['Rating'] == 5]['Review'].apply(word_tokenize).tolist()","6fa041bc":"def count_n_grams(corpus, n=2, n_top=None):\n    n_grams = {}\n    \n    for review in corpus:\n        review = tuple(review)\n        \n        for i in range(0, len(review) - n + 1): \n                # Get the n-gram from i to i+n\n                n_gram = review[i:i+n]\n                \n                # check if the n-gram is in the dictionary\n                if n_gram in n_grams:\n                    # Increment the count for this n-gram\n                    n_grams[n_gram] += 1\n                else:\n                    # Initialize this n-gram count to 1\n                    n_grams[n_gram] = 1\n                    \n    n_grams = pd.DataFrame.from_dict(n_grams, orient='index', columns=['count']).sort_values('count', ascending=False)\n    \n    n_grams.reset_index(inplace=True)\n    \n    n_grams['index'] = n_grams['index'].str.join(', ')\n    \n    \n    if (n_top):\n        n_grams = n_grams[:n_top]    \n        \n    return n_grams","6124da3a":"%%time\nbi_grams_1 = count_n_grams(corpus_1, n_top=10)\nbi_grams_2 = count_n_grams(corpus_2, n_top=10)\nbi_grams_3 = count_n_grams(corpus_3, n_top=10)\nbi_grams_4 = count_n_grams(corpus_4, n_top=10)\nbi_grams_5 = count_n_grams(corpus_5, n_top=10)\n\nbi_grams_1['Rating'] = 1\nbi_grams_2['Rating'] = 2\nbi_grams_3['Rating'] = 3\nbi_grams_4['Rating'] = 4\nbi_grams_5['Rating'] = 5\n\nbi_grams = pd.concat([bi_grams_5, bi_grams_4, bi_grams_3, bi_grams_2, bi_grams_1])","32574351":"fig = px.bar(bi_grams, x=\"index\", y=\"count\", color=\"Rating\", facet_col=\"Rating\",  color_continuous_scale=[\"#EF553B\", \"#FFA15A\", \"#FECB52\", \"#B6E880\", \"#00CC96\"])\nfig.update_xaxes(matches=None)\nfig.update_layout(coloraxis_showscale=False)\nfig.show()","24b14bfe":"%%time\ntri_grams_1 = count_n_grams(corpus_1, n=3, n_top=10)\ntri_grams_2 = count_n_grams(corpus_2, n=3, n_top=10)\ntri_grams_3 = count_n_grams(corpus_3, n=3, n_top=10)\ntri_grams_4 = count_n_grams(corpus_4, n=3, n_top=10)\ntri_grams_5 = count_n_grams(corpus_5, n=3, n_top=10)\n\ntri_grams_1['Rating'] = 1\ntri_grams_2['Rating'] = 2\ntri_grams_3['Rating'] = 3\ntri_grams_4['Rating'] = 4\ntri_grams_5['Rating'] = 5\n\ntri_grams = pd.concat([tri_grams_5, tri_grams_4, tri_grams_3, tri_grams_2, tri_grams_1])","6d4cec75":"fig = px.bar(tri_grams, x=\"index\", y=\"count\", color=\"Rating\", facet_col=\"Rating\", color_continuous_scale=[\"#EF553B\", \"#FFA15A\", \"#FECB52\", \"#B6E880\", \"#00CC96\"])\nfig.update_xaxes(matches=None)\nfig.update_layout(coloraxis_showscale=False)\nfig.show()","aa0ab84c":"stops = stopwords.words('english') + ['hotel', 'room', 'not']\n\nw1 = WordCloud(color_func=lambda *args, **kwargs: \"#EF553B\", \n               background_color='white', \n               max_words=50, \n               stopwords=stops,\n               random_state=42,\n               height=1000, \n               width=1000) \\\n            .generate(\" \".join(df[df['Rating'] == 1]['Review']))\n\nw2 = WordCloud(color_func=lambda *args, **kwargs: \"#FFA15A\", \n               background_color='white', \n               max_words=50, \n               stopwords=stops,\n               random_state=42,\n               height=1000, \n               width=1000) \\\n            .generate(\" \".join(df[df['Rating'] == 2]['Review']))\n\nw3 = WordCloud(color_func=lambda *args, **kwargs: \"#FECB52\", \n               background_color='white', \n               max_words=50, \n               stopwords=stops,\n               random_state=42,\n               height=1000, \n               width=1000) \\\n            .generate(\" \".join(df[df['Rating'] == 3]['Review']))\n\nw4 = WordCloud(color_func=lambda *args, **kwargs: \"#B6E880\", \n               background_color='white', \n               max_words=50, \n               stopwords=stops,\n               random_state=42,\n               height=1000, \n               width=1000) \\\n            .generate(\" \".join(df[df['Rating'] == 4]['Review']))\n\nw5 = WordCloud(color_func=lambda *args, **kwargs: \"#00CC96\", \n               background_color='white', \n               max_words=50,\n               stopwords=stops,\n               random_state=42,\n               height=1000, \n               width=1000) \\\n            .generate(\" \".join(df[df['Rating'] == 5]['Review']))\n\n","67cb8bc7":"fig = plt.figure(figsize=(26, 12))\n\nfig.add_subplot(1, 3, 1)\nplt.axis('off')\nplt.title('Rating=5')\nplt.imshow(w5)\n\nfig.add_subplot(1, 3, 2)\nplt.title('Rating=4')\nplt.axis('off')\nplt.imshow(w4)\n\nfig.add_subplot(1, 3, 3)\nplt.axis('off')\nplt.title('Rating=3')\nplt.imshow(w3)\n\nfig = plt.figure(figsize=(26, 12))\n\n\nfig.add_subplot(1, 2, 1)\nplt.title('Rating=2')\nplt.axis('off')\nplt.imshow(w2)\n\nfig.add_subplot(1, 2, 2)\nplt.title('Rating=1')\nplt.axis('off')\nplt.imshow(w1)","98c6a9da":"Traveling is exciting! \n\nFor the experience be all good, the hotel were we stay must be good enough to receive us.\n\nThe main idea behind this kernel is explore tripadvisor reviews about hotels and make a model that be capable to predict hotel rating based on a new review :)\n\nIf you like, please do a upvote! \n","67687044":"# Tri-grams","77079c99":"# WordCloud","691e9db3":"`This kernel is in under construction \ud83d\udd28`","8872c368":"# Common punctuations ","115f5506":"# Bi-grams","b8b6ad15":"# Exploratory Data Analysis","491f2aff":"# Common stopwords in reviews","177a2b1e":"# Data Cleaning + Modelling","25a3d7eb":"# Clean Data","1d0c76e6":"For now we only remove all punctuations (major comma) and extra spaces from reviews to create N-grams and WordClouds","d4fe8974":"![tripadvisor](https:\/\/static.tacdn.com\/img2\/brand_refresh\/Tripadvisor_lockup_horizontal_secondary_registered.svg)","c51ab2d4":"# Review number of words by sentiment","eff3d7bc":"# Creating corpus","c6df17e3":"# Tripadvisor Hotel Reviews","6a447d4f":"# Review length by sentiment","b1382706":"There's no null on this data. This is very good!","9ee9688a":"# What's in this kernel?\n\n* Exploratory Data Analysis (with [Plotly](https:\/\/plotly.com\/))\n* Data Cleaning \n* A simple LSTM model for sentiment analysis using PyTorch and GloVe pre trained embeddings","2fdc1bf0":"The most used word is `hotel` followed by `room`. That's expected in hotel reviews.\n\nWords that describe characteristics like `location`, `breakfast`, `service`, `clean`... are mostly used on good reviews. ","3a6ab0bd":"The average size of a review is ~700 characters. \n\nThere are some really big reviews in this dataset, mostly about 3+ stars ratings.","f8dcf250":"Analyzing tri-grams we can collect more details about reviews on diferent ratings. \n\nIn lower ratings we have bad sequence of words about hotel. Like (worst, hotel, stayed) and (not, recoomend, hotel).\n\nIn high ratings we have compliments about hotel services, rooms and locations.","128d94ba":"## Loading data","be089f03":"The number of words follow the same characteristic of length. \n\n\n\nHigh rating reviews have greater number of words than lower ratings reviews.","a257c7dd":"Coming soon!\n\n:) ","f3821c43":"This dataset does not have punctuations. Just comma that was used to substitute tabs `\\t` and break lines `\\n`.\n\nThere's also one `:` lost on 3 star rating review. ","cbd7d972":"The most part of this reviews is about 5 stars rating hotels. Followed by 4, 3... and so on.\n\nFor better visualization understand, along this notebook i will keep fixed the color for each rating:\n\n1. red\n2. orange\n3. yellow\n4. light green\n5. green\n\nPlease note: The graphs made with Plotly are interactive. You can zoom in\/zoom out and filter by some ratings.","93400c1e":"The most used stopword in review is `not`, even on 5 rating reviews. This is curious. Generally the word not is associated with a bad opinion.\n\nHere i limited to show top five stopwords. The magnitude of another stopwords are too little when compared with those five.","6240adec":"For finish exploratory data analisys, i will plot some wordclouds to observe words used on different ratings.\n\nI exclude from wordcloud common english stopwords and three words that are most used on reviews: `hotel`, `room`, `not`.\n\nAs expected: sentiment expressed by words are declined with rating associated. We can point too that basic hotel aspectics like breakfast, bathroom, pool and employees are important to guests rating.","3589aa06":"![](https:\/\/media.giphy.com\/media\/fVeAI9dyD5ssIFyOyM\/giphy.gif)","cd0a811d":"# Common words in review","b3b79a3f":"All ratings have (did, nt) and (did, not) pairs mostly used on reviews.\n\n\nLower rating reviews (1 and 2) do not have (great, location) pair. Instead, they have (room, not) and (hotel, not) pairs that can be describing bad characteristics about hotel. \n\nHigh ratings (3+) have good pairs of words about hotel characteristics, like (staff, friendly), (great, location) and (punta, cana) \ud83d\ude05 "}}