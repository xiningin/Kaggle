{"cell_type":{"5f078d9c":"code","553ae892":"code","cda6698f":"code","27b0a662":"code","2426ad25":"code","ac1561cf":"code","3995788b":"code","243a9859":"code","1b51cc69":"code","5ab475f7":"code","9d52fc5e":"code","1b10d569":"code","da96184f":"markdown","cabe79cc":"markdown","2136d562":"markdown","58de0313":"markdown","34c64c49":"markdown","98f4d689":"markdown","793b11a0":"markdown","69093807":"markdown","487edb4e":"markdown","cf9b11f5":"markdown","cb7ebc55":"markdown","d370395e":"markdown","9641c711":"markdown","07c7e105":"markdown"},"source":{"5f078d9c":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport sqlite3\nimport plotly.express as px\n\nfrom IPython.display import display, Markdown, Latex\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","553ae892":"conn = sqlite3.connect(\"\/kaggle\/input\/mental-health-in-the-tech-industry\/mental_health.sqlite\")","cda6698f":"query = \"\"\"\n        SELECT *\n        FROM Question\n        \"\"\"\ndf_question = pd.read_sql(query, conn)\ndf_question.shape[0]","27b0a662":"query = \"\"\"\n        SELECT questionid AS QuestionID, questiontext AS QuestionText\n        FROM Question\n        \"\"\"\ndf = pd.read_sql(query, conn)\n\nquestions = \"**Survey Questions:** \\n\"\nfor i in range(len(df)):\n     questions += str(df.QuestionID[i]) + \". \" + df.QuestionText[i] + \"\\n\"\ndisplay(Markdown(questions))","2426ad25":"query = \"\"\"\n        SELECT SurveyID AS Year, COUNT(DISTINCT QuestionID) AS QuestionsCount\n        FROM Answer \n        GROUP BY SurveyID\n        ORDER BY 1\n        \"\"\"\nyearlyQuestionsCount = pd.read_sql(query, conn)\nfig = px.bar(yearlyQuestionsCount, x='Year', y='QuestionsCount', text=\"QuestionsCount\", title=\"Yearly Survey Questions Count\")\nfig.update_traces(textposition='outside')\nfig.show()\n","ac1561cf":"query = \"\"\"\n        SELECT SurveyID AS Year, COUNT(DISTINCT UserID) AS RespondentsCount\n        FROM Answer\n        GROUP BY SurveyID\n        ORDER BY 1\n        \"\"\"\nyearlyRespondents = pd.read_sql(query, conn)\nfig = px.bar(yearlyRespondents, x='Year', y='RespondentsCount', text='RespondentsCount', title=\"Yearly Survey Respondents Count\")\nfig.update_traces(textposition='outside')\nfig.show()","3995788b":"query = \"\"\"\n        WITH y2014 AS (\n        SELECT DISTINCT UserID\n        FROM Answer\n        WHERE SurveyID = 2014\n        ), \n        y2016 AS (\n        SELECT DISTINCT UserID\n        FROM Answer\n        WHERE SurveyID = 2016\n        ),\n        y2017 AS (\n        SELECT DISTINCT UserID\n        FROM Answer\n        WHERE SurveyID = 2017\n        ),\n        y2018 AS (\n        SELECT DISTINCT UserID\n        FROM Answer\n        WHERE SurveyID = 2017\n        )\n        SELECT 2014 AS FirstSurveyYear, COUNT(DISTINCT UserID) AS returnVisit\n        FROM Answer\n        WHERE SurveyID > 2014 AND UserID IN (SELECT * FROM y2014)\n        UNION ALL\n        SELECT 2016 AS FirstSurveyYear, COUNT(DISTINCT UserID) AS returnVisit\n        FROM Answer\n        WHERE SurveyID > 2016 AND UserID IN (SELECT * FROM y2016)\n        UNION ALL\n        SELECT 2017 AS FirstSurveyYear, COUNT(DISTINCT UserID) AS returnVisit\n        FROM Answer\n        WHERE SurveyID > 2017 AND UserID IN (SELECT * FROM y2017)\n        UNION ALL\n        SELECT 2018 AS FirstSurveyYear, COUNT(DISTINCT UserID) AS returnVisit\n        FROM Answer\n        WHERE SurveyID > 2018 AND UserID IN (SELECT * FROM y2018)\n        \n        \"\"\"\nReturnVisit = pd.read_sql(query, conn)\nReturnVisit","243a9859":"query = \"\"\"\n        SELECT\n            MIN(CAST(AnswerText AS int)) AS MinAge, \n            MAX(CAST(AnswerText AS int)) AS MaxAge\n        FROM Answer\n        WHERE QuestionID = 1\n        \"\"\"\nAgeRange = pd.read_sql(query, conn)\nAgeRange","1b51cc69":"query = \"\"\"\n        WITH UserAge AS (\n        SELECT UserID, CAST(AnswerText AS int) As Age\n        FROM Answer\n        WHERE QuestionID = 1 AND Age >= 18 AND Age <= 70\n        ORDER BY 2\n        ),\n        AgeGroup AS (\n        SELECT UserID, \n            (CASE\n                WHEN Age <= 25 THEN \"18-25\"\n                WHEN Age > 25 AND Age <= 30 THEN \"26-30\"\n                WHEN Age > 30 AND Age <= 35 THEN \"31-35\"\n                WHEN Age > 35 AND Age <= 40 THEN \"36-40\"\n                WHEN Age > 40 AND Age <= 45 THEN \"41-45\"\n                WHEN Age > 45 AND Age <= 50 THEN \"46-50\"\n                WHEN Age > 50 AND Age <= 55 THEN \"51-55\"\n                WHEN Age > 55 AND Age <= 60 THEN \"56-60\"\n                WHEN Age > 60 AND Age <= 65 THEN \"61-65\"\n                WHEN Age > 65 AND Age <= 70 THEN \"66-70\"\n            END) AS AgeGroup\n        FROM UserAge\n        )\n        SELECT AgeGroup, COUNT(DISTINCT UserID) AS Cnt\n        FROM AgeGroup\n        GROUP BY 1\n        \"\"\"\n\nAgeGroup_df = pd.read_sql(query, conn)\n\nfig = px.bar(AgeGroup_df, x='AgeGroup', y='Cnt', text='Cnt', title=\"Respondents Age Group Analysis\")\nfig.update_traces(textposition='outside')\nfig.show()","5ab475f7":"query = \"\"\"\n        WITH UserGender AS (\n        SELECT UserID, \n        (CASE \n            WHEN UPPER(AnswerText) LIKE \"%AGENDER%\" THEN \"Agender\"\n            WHEN UPPER(AnswerText) LIKE \"%FLU%\" THEN \"Non-Binary\/Genderfluid\/Queer\"\n            WHEN UPPER(AnswerText) LIKE \"%BI%\" THEN \"Non-Binary\/Genderfluid\/Queer\"\n            WHEN UPPER(AnswerText) LIKE \"%QUEER%\" THEN \"Non-Binary\/Genderfluid\/Queer\"\n            WHEN UPPER(AnswerText) LIKE \"%TRANS%\" THEN \"Trans\"\n            WHEN UPPER(AnswerText) LIKE \"%FEM%\" THEN \"Female\"\n            WHEN UPPER(AnswerText) LIKE \"%WOMAN%\" THEN \"Female\"\n            WHEN UPPER(AnswerText) LIKE \"%MALE%\" THEN \"Male\"\n            WHEN UPPER(AnswerText) LIKE \"%MASCUL%\" THEN \"Male\"\n            ELSE \"Other\"\n        END) AS GenderTag\n        FROM Answer\n        WHERE QuestionID = 2\n        ORDER BY 2\n        )\n        SELECT GenderTag, COUNT(DISTINCT UserID) AS Cnt\n        FROM UserGender\n        GROUP BY 1\n        \"\"\"\nGender_df = pd.read_sql(query, conn)\n\nfig = px.pie(Gender_df, values='Cnt', names='GenderTag', title='Respondents Gender Group Analysis')\nfig.show()","9d52fc5e":"query = \"\"\"\n        WITH Status AS (\n        SELECT \"Had in Past\" AS Status, \n                (CASE\n                    WHEN AnswerText = \"Yes\" OR AnswerText = \"No\" THEN AnswerText\n                    ELSE \"Not Sure\"\n                END) AS Result, \n                COUNT(DISTINCT UserID) AS Cnt\n        FROM Answer\n        WHERE QuestionID = 32\n        GROUP BY 2\n        UNION ALL\n        SELECT \"Currently Have\" AS Status, \n                (CASE\n                    WHEN AnswerText = \"Yes\" OR AnswerText = \"No\" THEN AnswerText\n                    ELSE \"Not Sure\"\n                END) AS Result, \n                COUNT(DISTINCT UserID) AS Cnt\n        FROM Answer\n        WHERE QuestionID = 33\n        GROUP BY 2\n        UNION ALL\n        SELECT \"Been Diagnosed\" AS Status, \n                (CASE\n                    WHEN AnswerText = \"Yes\" OR AnswerText = \"No\" THEN AnswerText\n                    ELSE \"Not Sure\"\n                END) AS Result, \n                COUNT(DISTINCT UserID) AS Cnt\n        FROM Answer\n        WHERE QuestionID = 34\n        GROUP BY 2\n        )\n        \n        SELECT\n          Status,\n          MAX(CASE WHEN Result = \"No\" THEN Cnt END) AS No,\n          MAX(CASE WHEN Result = \"Not Sure\" THEN Cnt END) AS \"Not Sure\",\n          MAX(CASE WHEN Result = \"Yes\" THEN Cnt END) AS Yes\n        FROM Status\n        GROUP BY Status\n        \"\"\"\nMentalHealthStatus = pd.read_sql(query, conn)\ndisplay(Markdown(\"**Counted Mental Health Disorder Status of Respondents:**\"))\ndisplay(MentalHealthStatus)","1b10d569":"query = \"\"\"\n        WITH UserAge AS (\n        SELECT UserID, CAST(AnswerText AS int) As Age\n        FROM Answer\n        WHERE QuestionID = 1 AND Age >= 18 AND Age <= 70\n        ORDER BY 2\n        ),\n        AgeGroup AS (\n        SELECT UserID, \n            (CASE\n                WHEN Age <= 25 THEN \"18-25\"\n                WHEN Age > 25 AND Age <= 30 THEN \"26-30\"\n                WHEN Age > 30 AND Age <= 35 THEN \"31-35\"\n                WHEN Age > 35 AND Age <= 40 THEN \"36-40\"\n                WHEN Age > 40 AND Age <= 45 THEN \"41-45\"\n                WHEN Age > 45 AND Age <= 50 THEN \"46-50\"\n                WHEN Age > 50 AND Age <= 55 THEN \"51-55\"\n                WHEN Age > 55 AND Age <= 60 THEN \"56-60\"\n                WHEN Age > 60 AND Age <= 65 THEN \"61-65\"\n                WHEN Age > 65 AND Age <= 70 THEN \"66-70\"\n            END) AS AgeGroup\n        FROM UserAge\n        ), \n        UserStatus AS (\n            SELECT UserID,\n                    \"Had in Past\" AS Status, \n                    (CASE\n                        WHEN AnswerText = \"Yes\" THEN 1\n                        ELSE 0\n                    END) AS Answer\n            FROM Answer\n            WHERE QuestionID = 32\n            UNION ALL\n            SELECT UserID,\n                    \"Currently Have\" AS Status, \n                    (CASE\n                        WHEN AnswerText = \"Yes\" THEN 1\n                        ELSE 0\n                    END) AS Answer\n            FROM Answer\n            WHERE QuestionID = 33\n            UNION ALL\n            SELECT UserID,\n                    \"Been Diagnosed\" AS Status, \n                    (CASE\n                        WHEN AnswerText = \"Yes\" THEN 1\n                        ELSE 0\n                    END) AS Answer\n            FROM Answer\n            WHERE QuestionID = 34\n        )\n        \n        SELECT * \n        FROM\n            (SELECT AgeGroup, COUNT(y.UserID) AS YES\n            FROM AgeGroup\n            JOIN\n                (SELECT UserID\n                FROM UserStatus\n                GROUP BY UserID\n                HAVING SUM(Answer) > 0) AS y USING(UserID)\n             GROUP BY 1) Yes\n        JOIN\n            (SELECT AgeGroup, COUNT(n.UserID) AS NO\n            FROM AgeGroup\n            JOIN\n                (SELECT UserID\n                FROM UserStatus\n                GROUP BY UserID\n                HAVING SUM(Answer) = 0) AS n USING(UserID)\n             GROUP BY 1) No\n        USING(AgeGroup)\n\n        \"\"\"\nMentalHealth = pd.read_sql(query, conn)\ndisplay(MentalHealth)\nfig = px.bar(MentalHealth, x=\"AgeGroup\", y=[\"YES\", \"NO\"], title=\"Mental Health Disorder Status Count of Each Age Group\")\nfig.show()","da96184f":"### 3.2 Mental Health Disorder Status Count of Each Age Group\n**Note:** Whatever the respondent have been diagnosed, had in the past, or currently have the Mental Health Disorder, the respondent will be counted as \"YES\", otherwise, they will be counted as \"NO\"","cabe79cc":"Compare to the previous Age Groups Chart in Section 2, it is obvious that not all respondents answered at least one of these three questions.    \nThe respondents in 18 to 25 years old have the least Mental Health Disorder percentage, but it is still over 50%.    \nCompared other age groups' \"YES\" percantage, it is worth studying whether the proportion of tech worplace employees with mental health disorders increases with age.","2136d562":"Since the respondents of survey are employees of Tech Workplace, age as -1 or 329 are not the expected answer. So this age range will be manually selected from 18 to 80:","58de0313":"## 3. Mental Health Disorder Status of Respondents of the Survey\nBased on the following questions:    \n\n32. Have you had a mental health disorder in the past?    \n33. Do you currently have a mental health disorder?    \n34. Have you ever been diagnosed with a mental health disorder?","34c64c49":"Most respondents'ages are in the range of 26-40. Both 26-30 and 31-35 groups have over 1000 respondents. This age distribution is sknew right, since they work in tech workplace, this distribution is acceptable.","98f4d689":"The gender distribution of respondents is somewhat unfair. There are about three times as many male as female. However, consider the stereotype of the Tech Workplace, the gap in male and female respondents is also acceptable.    \nIn conclution, the profile the respondents are more like males between 26-40.","793b11a0":"### 3.1 Overall Mental Health Disorder Status Count","69093807":"## 1. Start With Reading the Survey Questions","487edb4e":"Thus, there is no return visit showing up for the same UserID.","cf9b11f5":"## 2. Gender and Age Groups of the Respondents of the Survey\nBased on the following questions:    \n\n1. What is your age?    \n2. What is your gender?","cb7ebc55":"There is no survey in 2015, the question number increased over years, but not all 105 questions are asked at the same year.","d370395e":"## 0. Build Connection to SQL Database","9641c711":"The most respondents count of the survey is on 2016, and then the numbers went down year by year.    \nThen, it will be interesting to see if anyone accepts a return visit:","07c7e105":"## 2. Counts of Survey Questions and Survey Respondents"}}