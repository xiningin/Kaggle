{"cell_type":{"36ff04cd":"code","e70560d1":"code","31633bb5":"markdown"},"source":{"36ff04cd":"import os\nimport pickle\n\nimport numpy as np\nimport pandas as pd\nfrom glob import glob\n\nimport lightgbm as lgbm\n\ndef pred_lightgbm(X, dataset_dir, add_suffix=''):\n    models = glob(os.path.join(dataset_dir, f'model\/lgbm*{add_suffix}.pkl'))\n    models = [pickle.load(open(model, 'rb')) for model in models]\n    preds = np.array([model.predict(X) for model in models])\n    preds = np.mean(preds, axis=0)\n    return preds","e70560d1":"# =========================\n# Inference\n# =========================\nfeature_cols = [f'f_{i}' for i in range(300)]\n\nimport ubiquant\nenv = ubiquant.make_env()\niter_test = env.iter_test()\n\nfor (test, sub) in iter_test:\n    test_X = test[['investment_id'] + feature_cols]\n    sub_base_pred = pred_lightgbm(test_X, '..\/input\/ump-exp001-colabtraining', add_suffix='_base')\n    sub['target'] = sub_base_pred\n    env.predict(sub)","31633bb5":"This notebook infers using models trained in [[Ubiquant] Google Colaboratory Training Code](https:\/\/www.kaggle.com\/columbia2131\/ubiquant-google-colaboratory-training-code)."}}