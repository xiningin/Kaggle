{"cell_type":{"ef504a26":"code","c7f66ec5":"code","1f125d53":"code","92bd50d7":"code","82bee5c9":"code","2c51e77d":"code","11db940e":"code","c5c5fbb3":"code","7bbaeee5":"code","4bc2ba02":"code","f0a76193":"code","aa2dff98":"code","53e271e7":"code","fd5f71ad":"code","a6a1d15a":"code","e420dbb6":"code","58a203bf":"code","7aa3d711":"code","5f075710":"code","84d5759e":"code","0c8a3c49":"code","66dd0547":"code","2beeb0bd":"code","a357c5ee":"code","d2285899":"code","03315996":"code","78a3e818":"code","79e7f138":"code","1dbe656f":"code","7f361a70":"code","4eaf075a":"code","f22c8715":"code","041616b6":"code","a651a6a1":"code","831beca4":"code","2097573a":"code","27ebb0c4":"code","bd8db0b4":"code","be4b10bf":"code","4b08f105":"code","92364742":"code","4742e8fc":"code","d36be198":"code","580eae07":"code","10a629c0":"code","b4b55cfd":"code","8c9efa77":"code","9f9e3b91":"code","f6c739f4":"code","01b4418c":"code","7a378848":"code","e6253e48":"code","b3790279":"code","f7d51d3b":"code","10785a22":"code","dae54d3a":"code","9ca3e7db":"code","166a7572":"code","cdf7a215":"code","b8f267c5":"code","782f906a":"code","d7bea4de":"code","83b8b322":"code","3c82292e":"code","ead0757f":"code","9be40027":"code","bd1eb60e":"code","6c98376e":"code","15e41c78":"code","22f258d7":"code","0f52b1eb":"code","aab461b6":"code","cab3342c":"code","ad64c295":"code","8416a914":"code","c7d24def":"code","8e2189c8":"code","44c1a92a":"code","7ad628f7":"code","99eea93d":"code","ed9c1db5":"code","1c01830e":"code","4176d45f":"code","c3783d8d":"code","561bb303":"code","d813a7fc":"code","36b781e7":"code","6b4d75b0":"code","abcda087":"code","f31be91a":"code","423adef8":"code","69c6bfb5":"code","01fdf6ab":"code","8d34de8e":"code","dec5eec1":"code","e037333e":"code","563ec987":"code","1b6de4fc":"code","217cc930":"code","b41c8d43":"code","fb111145":"code","12f2b18c":"code","e818be04":"code","11043903":"code","34b79a0d":"code","4fd4ac8b":"code","1edb9ebc":"code","5483bc6d":"code","bfb19d42":"code","dfc26b7e":"markdown","770fec7b":"markdown","c1494f7f":"markdown","800b77e3":"markdown","cfb21bbd":"markdown","6e3e205d":"markdown","417a6441":"markdown"},"source":{"ef504a26":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline\nfrom sklearn import preprocessing\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","c7f66ec5":"# importing train and test data and submission \n\ntrain=pd.read_csv('..\/input\/covid19-global-forecasting-week-4\/train.csv')\ntest=pd.read_csv('..\/input\/covid19-global-forecasting-week-4\/test.csv')\npopulation_info=pd.read_csv('..\/input\/population\/population_by_country_2020.csv')\nsubmission_df=pd.read_csv('..\/input\/covid19-global-forecasting-week-4\/submission.csv')","1f125d53":"submission_df.info()","92bd50d7":"train.head()","82bee5c9":"submission_df.head()","2c51e77d":"test.head()","11db940e":"population_info.head()","c5c5fbb3":"train.info()","7bbaeee5":"test.info()","4bc2ba02":"# Converting date column to date object\n\ntrain['Date']=pd.to_datetime(train['Date'])\ntest['Date']=pd.to_datetime(test['Date'])","f0a76193":"# looking for null values in train a\ntrain.isnull().sum()","aa2dff98":"train.isnull().sum()","53e271e7":"# Lets drop Province_State   from test and train as it has high number of null values\n\n# Dropping province column\ntrain.drop(columns='Province_State',axis=1,inplace=True)\ntest.drop(columns='Province_State',axis=1,inplace=True)","fd5f71ad":"time_df=train.groupby('Date')['ConfirmedCases','Fatalities'].max()","a6a1d15a":"plt.figure(figsize=(16,8))\nsns.lineplot(data=time_df['ConfirmedCases'])\nplt.show()","e420dbb6":"# Method to split date into day,month and year\ndef createDateDetails(df,col_name):\n    df[col_name+'_day']=df[col_name].dt.day\n    df[col_name+'_month']=df[col_name].dt.month\n    df[col_name+'_year']=df[col_name].dt.year","58a203bf":"# splitting ddate columns\ncreateDateDetails(train,'Date')\ncreateDateDetails(test,'Date')","7aa3d711":"train.head()","5f075710":"plt.figure(figsize=(16,8))\nsns.lineplot(data=time_df['Fatalities'])\nplt.title('Fatalities vs Time')\nplt.show()","84d5759e":"# Creating few pivot for better visualization of fatality and confirmed cases \n\nmonth_day_pivot=pd.pivot_table(data=train,values='Fatalities',columns='Date_month',index='Date_day',aggfunc='sum')\n","0c8a3c49":"month_day_pivot.fillna(value=0,inplace=True)","66dd0547":"plt.figure(figsize=(20,10))\nsns.heatmap(data=month_day_pivot,cmap='YlGnBu')\nplt.title('DEATH IN MONTH WORLD WIDE')\n","2beeb0bd":"month_day_cases_pivot=pd.pivot_table(data=train,values='ConfirmedCases',columns='Date_month',index='Date_day',aggfunc='sum')\nplt.figure(figsize=(20,10))\nsns.heatmap(data=month_day_cases_pivot,cmap='YlGnBu')","a357c5ee":"# Method to find the total number of cases in each country\ncount_dict={}\ndef total_case(df):\n    for val in list(train.Country_Region.unique()):\n        count_dict[val]=df[df['Country_Region']==val]['ConfirmedCases'].max()","d2285899":"total_case(train)","03315996":"# Converting values taken into count_dict  country as key and cases as values into dictionary\ncount_df=pd.DataFrame(count_dict.items(),columns=['countries','case'])\ncount_df=count_df.sort_values(by=['case'],ascending=False)","78a3e818":"plt.figure(figsize=(20,50))\nsns.barplot(data=count_df.iloc[:50,:],x='case',y='countries')#Top 50 countries only included\nplt.title('TOTAL CASES ACROSS THE WORLD')","79e7f138":"list(population_info.columns)\n","1dbe656f":"list(train.columns)","7f361a70":"# Lets convert the country name in all the table to lower case so that we can merge the table\n\npopulation_info[\"Country (or dependency)\"]=population_info[\"Country (or dependency)\"].apply(lambda x:x.lower())\ntrain['Country_Region']=train['Country_Region'].apply(lambda x:x.lower())\ntest['Country_Region']=test['Country_Region'].apply(lambda x:x.lower())","4eaf075a":"population_info.head()","f22c8715":"train.head()","041616b6":"test.head()","a651a6a1":"# lets check the non mataching countries in population_info and train table\n\nnot_match=train[~train['Country_Region'].isin(population_info[\"Country (or dependency)\"])]","831beca4":"not_match.head()","2097573a":"not_match.Country_Region.unique()","27ebb0c4":"# replacing new values of 'congo (kinshasa)' to congo in training file and doing similar for other non matching values in countries column\n\ntrain['Country_Region']=train.Country_Region.replace({\"congo (kinshasa)\": \"dr congo\",\"congo (brazzaville)\":\"congo\",\"korea, south\": \"south korea\",\"burma\":\"myanmar\",\"cote d'ivoire\":\"c\u00f4te d'ivoire\",\"us\":\"united states\",\"saint Kitts & nevis\":\"saint kitts & nevis\",\"saint vincent and the grenadines\":\"st. vincent & grenadines\",\"taiwan*\":\"taiwan\",\"west bank and gaza\":\"state of palestine\",\"Czech Republic (Czechia)\":\"czech republic (czechia)\"})","bd8db0b4":"not_match2=train[~train['Country_Region'].isin(population_info[\"Country (or dependency)\"])]","be4b10bf":"not_match2.Country_Region.unique()","4b08f105":"test['Country_Region']=test.Country_Region.replace({\"congo (kinshasa)\": \"dr congo\",\"congo (brazzaville)\":\"congo\",\"korea, south\": \"south korea\",\"burma\":\"myanmar\",\"cote d'ivoire\":\"c\u00f4te d'ivoire\",\"us\":\"united states\",\"saint Kitts & nevis\":\"saint kitts & nevis\",\"saint vincent and the grenadines\":\"st. vincent & grenadines\",\"taiwan*\":\"taiwan\",\"west bank and gaza\":\"state of palestine\",\"Czech Republic (Czechia)\":\"czech republic (czechia)\"})","92364742":"# As above values are mostly cruise we can ignore and proceed to join the tables \n# Using left join \npopulation_info=population_info.rename(columns={\"Country (or dependency)\":\"Country_Region\"})#renaming column of population_info to do the join\n","4742e8fc":"# Merging the columns\n\ntrain_pop_df=train.merge(population_info,how='left',on='Country_Region')\ntest_pop_df=test.merge(population_info,how='left',on='Country_Region')","d36be198":"train_pop_df.info()","580eae07":"test_pop_df.info()","10a629c0":"(train_pop_df.isnull().sum()\/len(train_pop_df.index))*100","b4b55cfd":"(test_pop_df.isnull().sum()\/len(train_pop_df.index))*100","8c9efa77":"# Dropping few columns such as World Share,fert Rate as it seems to be irrelevant in this case\n\ntrain_pop_df.drop(columns=['World Share','Fert. Rate','Yearly Change','Migrants (net)','Net Change'],inplace=True,axis=1)\ntest_pop_df.drop(columns=['World Share','Fert. Rate','Yearly Change','Migrants (net)','Net Change'],inplace=True,axis=1)","9f9e3b91":"train_pop_df['Urban Pop %']=train_pop_df['Urban Pop %'].astype(str)\ntrain_pop_df['Med. Age']=train_pop_df['Med. Age'].astype(str)","f6c739f4":"test_pop_df['Urban Pop %']=test_pop_df['Urban Pop %'].astype(str)\ntest_pop_df['Med. Age']=test_pop_df['Med. Age'].astype(str)","01b4418c":"# train_pop_df['Urban Pop %'].fillna(train_pop_df['Urban Pop %'].mean())\ntrain_pop_df['Urban Pop %']=train_pop_df['Urban Pop %'].apply(lambda x:x[:-1])\ntest_pop_df['Urban Pop %']=test_pop_df['Urban Pop %'].apply(lambda x:x[:-1])","7a378848":"# Lets convert 'Med. Age' AND 'Urban Pop %' to numeric columns\n\ntrain_pop_df['Urban Pop %']=train_pop_df['Urban Pop %'].apply(lambda x:'0' if x.isdigit()==False else x)\ntrain_pop_df['Med. Age']=train_pop_df['Med. Age'].apply(lambda x:'0' if x.isdigit()==False else x)","e6253e48":"\ntest_pop_df['Urban Pop %']=test_pop_df['Urban Pop %'].apply(lambda x:'0' if x.isdigit()==False else x)\ntest_pop_df['Med. Age']=test_pop_df['Med. Age'].apply(lambda x:'0' if x.isdigit()==False else x)","b3790279":"train_pop_df['Urban Pop %']=train_pop_df['Urban Pop %'].astype('int32')\ntrain_pop_df['Med. Age']=train_pop_df['Med. Age'].astype('int32')","f7d51d3b":"test_pop_df['Urban Pop %']=test_pop_df['Urban Pop %'].astype('int32')\ntest_pop_df['Med. Age']=test_pop_df['Med. Age'].astype('int32')","10785a22":"train_pop_df['Urban Pop %']","dae54d3a":"train_pop_df.iloc[8265]","9ca3e7db":"train_pop_df['Urban Pop %'].unique()","166a7572":"train_pop_df.info()","cdf7a215":"train_pop_df.head()","b8f267c5":"test_pop_df.head()","782f906a":"(test_pop_df.isnull().sum()\/len(train_pop_df.index))*100","d7bea4de":"(train_pop_df.isnull().sum()\/len(train_pop_df.index))*100","83b8b322":"train_pop_df.describe()","3c82292e":"train_pop_df.isnull().sum()","ead0757f":"train_pop_df[train_pop_df['Population (2020)'].isnull()].index.tolist()","9be40027":"train_pop_df.iloc[8455:8456,]","bd1eb60e":"train_pop_df[train_pop_df['Country_Region']=='czechia']['Population (2020)'].fillna(10649800)","6c98376e":"train_pop_df.loc[train_pop_df['Country_Region']=='czechia','Population (2020)']=train_pop_df.loc[train_pop_df['Country_Region']=='czechia','Population (2020)'].fillna(10649800)","15e41c78":"test_pop_df.loc[test_pop_df['Country_Region']=='czechia','Population (2020)']=test_pop_df.loc[test_pop_df['Country_Region']=='czechia','Population (2020)'].fillna(10649800)","22f258d7":"train_pop_df.loc[train_pop_df['Country_Region']=='czechia','Density (P\/Km\u00b2)']=train_pop_df.loc[train_pop_df['Country_Region']=='czechia','Density (P\/Km\u00b2)'].fillna(134)\ntest_pop_df.loc[test_pop_df['Country_Region']=='czechia','Density (P\/Km\u00b2)']=test_pop_df.loc[test_pop_df['Country_Region']=='czechia','Density (P\/Km\u00b2)'].fillna(134)","0f52b1eb":"train_pop_df.loc[train_pop_df['Country_Region']=='czechia','Land Area (Km\u00b2)']=train_pop_df.loc[train_pop_df['Country_Region']=='czechia','Land Area (Km\u00b2)'].fillna(78866)\ntest_pop_df.loc[test_pop_df['Country_Region']=='czechia','Land Area (Km\u00b2)']=test_pop_df.loc[test_pop_df['Country_Region']=='czechia','Land Area (Km\u00b2)'].fillna(78866)","aab461b6":"train_pop_df.loc[train_pop_df['Country_Region']=='czechia','Urban Pop %']=train_pop_df.loc[train_pop_df['Country_Region']=='czechia','Urban Pop %'].fillna(73.5)\ntest_pop_df.loc[test_pop_df['Country_Region']=='czechia','Urban Pop %']=test_pop_df.loc[test_pop_df['Country_Region']=='czechia','Urban Pop %'].fillna(73.5)","cab3342c":"train_pop_df.isnull().sum()","ad64c295":"# train_pop_df.Country_Region in ['diamond princess', 'kosovo', 'ms zaandam','saint kitts and nevis', 'sao tome and principe']].index.values\nexclude_list=['diamond princess', 'kosovo', 'ms zaandam','saint kitts and nevis', 'sao tome and principe']\nidx_list=[]\nidx_list_test=[]\nfor val in exclude_list:\n    idx_list.extend(train_pop_df[train_pop_df.Country_Region==val].index.values)\n\nfor val in exclude_list:\n    idx_list_test.extend(test_pop_df[train_pop_df.Country_Region==val].index.values)","8416a914":"train_pop_df.columns.to_list()\n","c7d24def":"train_pop_df.loc[idx_list, ['Date','ConfirmedCases', 'Fatalities','Date_day', 'Date_month','Date_year', 'Population (2020)', 'Density (P\/Km\u00b2)', 'Land Area (Km\u00b2)', 'Med. Age', 'Urban Pop %']]=0\ntest_pop_df.loc[idx_list_test,['Date','Date_day', 'Date_month','Date_year', 'Population (2020)', 'Density (P\/Km\u00b2)', 'Land Area (Km\u00b2)', 'Med. Age', 'Urban Pop %']]=0","8e2189c8":"train_pop_df.info()","44c1a92a":"test_pop_df.info()","7ad628f7":"   \n#     Method for Label Encoding\n    def label_encoding(df,col):\n        label_encoders=dict()\n        output_df = df.copy(deep=True)\n        for c in col:\n            lbl = preprocessing.LabelEncoder()\n            lbl.fit(df[c].values)\n            output_df.loc[:, c] = lbl.transform(df[c].values)\n            label_encoders[c] = lbl\n        return output_df","99eea93d":"train_pop_df=label_encoding(train_pop_df,['Country_Region'])","ed9c1db5":"train_pop_df.head()","1c01830e":"test_pop_df=label_encoding(test_pop_df,['Country_Region'])","4176d45f":"train_pop_df.columns","c3783d8d":"train_pop_df['Fatalities']","561bb303":"X_train_final=train_pop_df.drop(['ConfirmedCases','Fatalities','Id','Date'],axis=1)\ny_train1=train_pop_df['ConfirmedCases']\ny_train2=train_pop_df['Fatalities']","d813a7fc":"import xgboost as xgb\nfrom xgboost import plot_importance, plot_tree","36b781e7":"#Fitting XGB regressor \nmodel1 = xgb.XGBRegressor()\nmodel2=xgb.XGBRegressor()","6b4d75b0":"model1.fit(X_train_final,y_train1)\nprint (model1)","abcda087":"model2.fit(X_train_final,y_train2)\nprint (model1)","f31be91a":"test_pop_df.columns","423adef8":"X_train_final.columns","69c6bfb5":"test_pop_df.columns","01fdf6ab":"test_pop_df.drop(columns=['Date'],axis=1,inplace=True)","8d34de8e":"plot = plot_importance(model1, height=0.9, max_num_features=5)","dec5eec1":"plot = plot_importance(model2, height=0.9, max_num_features=5)","e037333e":"xout = pd.DataFrame({'ForecastId': [], 'ConfirmedCases': [], 'Fatalities': []})","563ec987":"x_test_Id = test_pop_df.loc[:, 'ForecastId']","1b6de4fc":"test_pop_df.drop(columns=['ForecastId'],axis=1,inplace=True)","217cc930":"#Predict \noutput1 = model1.predict(data=test_pop_df)\noutput2 = model2.predict(data=test_pop_df)\n# final_df = pd.DataFrame()\n# final_df[\"ID\"] = id_vals\n# final_df[\"Prediction\"] = output\n# #final_df.to_csv(\"Output_1.csv\")\n# final_df.head()","b41c8d43":"sub_data = pd.DataFrame({'ForecastId': x_test_Id, 'ConfirmedCases': output1, 'Fatalities': output2})","fb111145":"xout = pd.concat([xout, sub_data], axis=0)","12f2b18c":"xout","e818be04":"xout['ConfirmedCases'] = xout['ConfirmedCases'].apply(int)\nxout['Fatalities'] = xout['Fatalities'].apply(int)","11043903":"xout.reindex()","34b79a0d":"xout.to_csv('submission.csv', index=False)","4fd4ac8b":"# ## Hyper Parameter Optimization\n\n\n# n_estimators = [100, 500, 900, 1100, 1500]\n# max_depth = [2, 3, 5, 10, 15]\n# booster=['gbtree','gblinear']\n# learning_rate=[0.05,0.1,0.15,0.20]\n# min_child_weight=[1,2,3,4]\n\n# # Define the grid of hyperparameters to search\n# hyperparameter_grid = {\n#     'n_estimators': n_estimators,\n#     'max_depth':max_depth,\n#     'learning_rate':learning_rate,\n#     'min_child_weight':min_child_weight,\n#     'booster':booster,\n#     'base_score':base_score\n#     }","1edb9ebc":"# from sklearn.model_selection import RandomizedSearchCV","5483bc6d":"# # Set up the random search with 5-fold cross validation\n# random_cv = RandomizedSearchCV(estimator=regressor,\n#             param_distributions=hyperparameter_grid,\n#             cv=5, n_iter=50,\n#             scoring = 'neg_mean_absolute_error',n_jobs = 4,\n#             verbose = 5, \n#             return_train_score = True,\n#             random_state=42)","bfb19d42":"# random_cv.fit(X_train_final,y_train1)","dfc26b7e":"## Lets convert 'Med. Age' AND 'Urban Pop %' to numeric columns\n\n","770fec7b":"## Doing Label Encoding for countries column","c1494f7f":"#### We can observe from above the value such as 'czechia', 'diamond princess', 'kosovo', 'ms zaandam','saint kitts and nevis', 'sao tome and principe'] has null .Those which are countries we can google search and impute the missing value and few of them are cruises .SO for every such values will set the values as 0","800b77e3":"## Basic EDA","cfb21bbd":"### Lets merge train and test with population dataset and do some more visualization","6e3e205d":"### Observations\u00b6\nWe can see the the fatalities and confirmed cases has very high growth rate with every day of month since Jan The darker the region higher is the count of confirmed cases and fatalities","417a6441":"czechia Population is 10649800,Density is 134 ,Land area is \t78866,Med is 43.2 and urban pop % is 73.5"}}