{"cell_type":{"15adc8bb":"code","aef614fb":"code","68f01077":"code","d0e182bf":"code","e1da0bc6":"code","2402989b":"code","1137cd6f":"code","960a8ad4":"code","58c527d4":"code","a3db9606":"code","62e23edf":"code","ec14f95a":"code","29fb0635":"code","752b4e99":"code","5f19125f":"code","f6f90e67":"code","07ce3d91":"code","02a0d0a1":"code","a247faed":"code","1ba93863":"code","ec838058":"code","2b316e53":"code","d99f4db3":"code","0f05b9aa":"code","c478670a":"code","78c1f0fd":"code","1af7cbe9":"code","78279d31":"code","01edf0cc":"code","2908c262":"code","67683ca0":"code","5af9207d":"code","0578241d":"code","d2f62ade":"code","dbfb5bde":"code","a4406662":"code","e6b0bd95":"code","13bc753a":"code","dace39cd":"code","5f496790":"code","ba49ea31":"code","d411fd52":"code","49f82242":"code","aad89cd5":"code","191becf1":"code","dd96fcd1":"code","a88d7f23":"code","7f7e920e":"code","285763a0":"code","9212459e":"code","b4d3b389":"code","234749a2":"code","78765a3a":"code","4bf40d58":"code","1674f7ca":"code","26ef8668":"code","ca64bbe3":"code","a427cca5":"code","634a9741":"code","794329c4":"code","01466cb0":"code","11e70f26":"code","48e1f60e":"code","1f27b55d":"markdown","cf422253":"markdown","62fe6290":"markdown","457c69fb":"markdown","6ec4d3a2":"markdown","6332a368":"markdown","0f8b0a0f":"markdown","21e9d632":"markdown","0ddf14f7":"markdown","43b1e732":"markdown","cce6ae1b":"markdown","f7ba7c8b":"markdown","35845ed1":"markdown","bd697d50":"markdown","088f9e91":"markdown","944b3a30":"markdown","7a8f91d5":"markdown","4e9defbf":"markdown","f0307c4d":"markdown"},"source":{"15adc8bb":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt","aef614fb":"# to display all columns and rows\n\npd.set_option(\"display.max_columns\", None);\npd.set_option(\"display.max_rows\", None);\n\n# set how many digits we want to see after comma\npd.set_option(\"display.float_format\", lambda x: '%.2f' % x)","68f01077":"# Now import the data and select the year we want to work with\n\ndf_2010_2011 = pd.read_excel(\"..\/input\/uci-online-retail-ii-data-set\/online_retail_II.xlsx\", sheet_name = \"Year 2010-2011\")","d0e182bf":"# to prevent any loss of data do not use df while uploading main data\n\ndf = df_2010_2011.copy()","e1da0bc6":"df.head()","2402989b":"df.tail()","1137cd6f":"df.info()","960a8ad4":"df.isnull().values.any()","58c527d4":"df.isnull().sum()","a3db9606":"df[\"StockCode\"].nunique()","62e23edf":"df[\"StockCode\"].value_counts().head()","ec14f95a":"df.groupby(\"StockCode\").agg({\"Quantity\":\"sum\"}).head()","29fb0635":"df.groupby(\"StockCode\").agg({\"Price\":\"mean\"}).head()","752b4e99":"df.groupby(\"Description\").agg({\"Quantity\":\"sum\"}).sort_values(\"Quantity\", ascending = False).head()","5f19125f":"df[\"TotalPrice\"] = df[\"Quantity\"] * df[\"Price\"]","f6f90e67":"df.head()","07ce3d91":"df.groupby(\"Invoice\").agg({\"TotalPrice\" : \"sum\"}).sort_values(\"TotalPrice\", ascending = False).head(10)","02a0d0a1":"df.groupby(\"Customer ID\").agg({\"TotalPrice\":\"sum\"}).sort_values(\"TotalPrice\", ascending = False). head(15)","a247faed":"df_C_inv = df[df[\"Invoice\"].str.contains(\"C\", na = False)]","1ba93863":"df_C_inv.nunique()","ec838058":"df_C_inv.head()","2b316e53":"df_C_inv.groupby(\"Description\").agg({\"Quantity\":\"sum\"}).sort_values(\"Quantity\").head(10)","d99f4db3":"df_C_inv[\"Description\"].value_counts().head()","0f05b9aa":"df = df[~df[\"Invoice\"].str.contains(\"C\", na = False)]","c478670a":"df.head()","78c1f0fd":"df.info()","1af7cbe9":"df.isnull().sum()","78279d31":"df.groupby(\"Country\").agg({\"TotalPrice\":\"sum\"}).sort_values(\"TotalPrice\", ascending = False).head()","01edf0cc":"df.dropna(inplace = True)","2908c262":"df.head()","67683ca0":"df.isnull().sum()","5af9207d":"df.info()","0578241d":"df.describe([0.01, 0.05, 0.10, 0.25, 0.50, 0.75, 0.95, 0.99]).T","d2f62ade":"df[\"InvoiceDate\"].min()","dbfb5bde":"df[\"InvoiceDate\"].max()","a4406662":"import datetime as dt","e6b0bd95":"today_date = dt.datetime(2011, 12, 31)","13bc753a":"today_date","dace39cd":"df[\"Customer ID\"] = df[\"Customer ID\"].astype(int)","5f496790":"df.head()","ba49ea31":"temp_df = today_date - df.groupby(\"Customer ID\").agg({\"InvoiceDate\": \"max\"})\ntemp_df.head()","d411fd52":"temp_df.rename(columns = {\"InvoiceDate\":\"Recency\"}, inplace = True)\nrecency_df = temp_df[\"Recency\"].apply(lambda x: x.days)","49f82242":"recency_df.head()","aad89cd5":"df.groupby([\"Customer ID\",\"Invoice\"]).agg({\"Invoice\":\"nunique\"}).head(50)","191becf1":"df.groupby(\"Customer ID\").agg({\"Invoice\":\"nunique\"}).head(10)","dd96fcd1":"freq_df = df.groupby(\"Customer ID\").agg({\"Invoice\":\"nunique\"})","a88d7f23":"freq_df.head()","7f7e920e":"freq_df.rename(columns = {\"Invoice\": \"Frequency\"}, inplace = True)\nfreq_df.head()","285763a0":"monetary_df = df.groupby(\"Customer ID\").agg({\"TotalPrice\": \"sum\"})\nmonetary_df.head()","9212459e":"monetary_df.rename(columns = {\"TotalPrice\":\"Monetary\"}, inplace = True)","b4d3b389":"monetary_df.head()","234749a2":"print(recency_df.shape, freq_df.shape, monetary_df.shape)","78765a3a":"rfm = pd.concat([recency_df, freq_df, monetary_df], axis = 1)\nrfm.head()","4bf40d58":"rfm[\"RecencyScore\"] = pd.qcut(rfm[\"Recency\"], 5, labels = [5,4,3,2,1])\nrfm[\"FrequencyScore\"] = pd.qcut(rfm[\"Frequency\"].rank(method = \"first\"), 5 , labels = [1,2,3,4,5])\nrfm[\"MonetaryScore\"] = pd.qcut(rfm[\"Monetary\"], 5, labels = [1,2,3,4,5])\nrfm[\"RFM_SCORE\"] = (rfm[\"RecencyScore\"].astype(str) + rfm[\"FrequencyScore\"].astype(str) + rfm[\"MonetaryScore\"].astype(str))\nrfm.head()","1674f7ca":"# Regular Expressions are used to define RFM map\nseg_map = {\n    r'[1-2][1-2]': 'Hibernating',\n    r'[1-2][3-4]': 'At Risk',\n    r'[1-2]5': 'Can\\'t Loose',\n    r'3[1-2]': 'About to Sleep',\n    r'33': 'Need Attention',\n    r'[3-4][4-5]': 'Loyal Customers',\n    r'41': 'Promising',\n    r'51': 'New Customers',\n    r'[4-5][2-3]': 'Potential Loyalists',\n    r'5[4-5]': 'Champions'\n}","26ef8668":"rfm['Segment'] = rfm['RecencyScore'].astype(str) + rfm['FrequencyScore'].astype(str)","ca64bbe3":"rfm['Segment'] = rfm['Segment'].replace(seg_map, regex=True)","a427cca5":"rfm.head()","634a9741":"rfm[[\"Segment\",\"Recency\",\"Frequency\", \"Monetary\"]].groupby(\"Segment\").agg([\"mean\",\"median\",\"count\"])","794329c4":"rfm[rfm[\"Segment\"]== \"Loyal Customers\"].head()","01466cb0":"rfm[rfm[\"Segment\"] == \"Loyal Customers\"].index","11e70f26":"new_df = pd.DataFrame()\nnew_df[\"LoyalCustomersID\"] = rfm[rfm[\"Segment\"] == \"Loyal Customers\"].index","48e1f60e":"new_df.to_csv(\"loyal_customers_ID.csv\", index = False)","1f27b55d":"**Lets start EDA (Explanatory Data Analysis)**","cf422253":"Now its time for the scoring to our metrics which we will use quantile method by dividing all our metrics into 5 segments and label them accordingly. 5 is good 1 is poor (that's why we labeled Recency on a descending order)","62fe6290":"Lets see how many times our customers make the purchases","457c69fb":"We saw that we have N\/A values in our data, lets see how many we have","6ec4d3a2":"some fine tunings for visualisation","6332a368":"first import the relevant libraries","0f8b0a0f":"Dataset includes 2 set of data 2009-2010 and 2010-2011, I think they are using special year-end for reporting purposes","21e9d632":"As we are dealing with 541K rows, we need to understand data by groupby, value count, unique amount, aggregation functions, we know that there are return stocks starting with \"C\" code, we will eliminate them to better analysis. Then we will delete N\/A rows. Finally we have our final dataframe.","0ddf14f7":"## Frequency","43b1e732":"## Recency","cce6ae1b":"Now lets set our Recency metric, we will set 31-12-2011 as our analysis date and figure out when our customers make the latest purchase. ","f7ba7c8b":"# Business Problem\n\nOur client is an E-commerce company which is willing to segregate its customers to segments in order to apply related marketing strategies commonly.\n\nWe need to define customer attitudes based on their purchases. Then we will divide the customers into segments.\n\nWe will use RFM Analysis method to define customer attitutes. \n\n**What is RFM?**\n\nRFM is a method used for analyzing customer value. It is commonly used in database marketing and direct marketing and has received particular attention in retail and professional services industries.\n\nRFM stands for the three dimensions:\n\n- Recency \u2013 How recently did the customer purchase?\n- Frequency \u2013 How often do they purchase?\n- Monetary Value \u2013 How much do they spend?\n\nCustomer purchases may be represented by a table with columns for the customer name, date of purchase and purchase value. One approach to RFM is to assign a score for each dimension on a scale from 1 to 10*. The maximum score represents the preferred behavior and a formula could be used to calculate the three scores for each customer. For example, a service-based business could use these calculations:\n\nRecency = the maximum of \"10 \u2013 the number of months that have passed since the customer last purchased\" and 1\nFrequency = the maximum of \"the number of purchases by the customer in the last 12 months (with a limit of 10)\" and 1\nMonetary = the highest value of all purchases by the customer expressed as a multiple of some benchmark value\nAlternatively, categories can be defined for each attribute. For instance, Recency might be broken into three categories: customers with purchases within the last 90 days; between 91 and 365 days; and longer than 365 days. Such categories may be derived from business rules or using data mining techniques to find meaningful breaks.\n\nOnce each of the attributes has appropriate categories defined, segments are created from the intersection of the values. If there were three categories for each attribute, then the resulting matrix would have twenty-seven possible combinations (one well-known commercial approach uses five bins per attributes, which yields 125 segments. Companies may also decide to collapse certain subsegments, if the gradations appear too small to be useful. The resulting segments can be ordered from most valuable (highest recency, frequency, and value) to least valuable (lowest recency, frequency, and value). Identifying the most valuable RFM segments can capitalize on chance relationships in the data used for this analysis. For this reason, it is highly recommended that another set of data be used to validate the results of the RFM segmentation process. Advocates of this technique point out that it has the virtue of simplicity: no specialized statistical software is required, and the results are readily understood by business people. In the absence of other targeting techniques, it can provide a lift in response rates for promotions.\n\nhttps:\/\/en.wikipedia.org\/wiki\/RFM_(market_research)\n\n*We will use 1 to 5 instead of 1 to 10. \n\n\n**Data Set Information:**\n\nThis Online Retail II data set contains all the transactions occurring for a UK-based and registered, non-store online retail between 01\/12\/2009 and 09\/12\/2011.\n\nThe company mainly sells unique all-occasion gift-ware. \n\nMany customers of the company are wholesalers.\n\n**Attribute Information:**\n\nInvoiceNo: Invoice number. Nominal. A 6-digit integral number uniquely assigned to each transaction. If this code starts with the letter 'c', it indicates a cancellation.\n\nStockCode: Product (item) code. Nominal. A 5-digit integral number uniquely assigned to each distinct product.\n\nDescription: Product (item) name. Nominal.\n\nQuantity: The quantities of each product (item) per transaction. Numeric.\n\nInvoiceDate: Invice date and time. Numeric. The day and time when a transaction was generated.\n\nUnitPrice: Unit price. Numeric. Product price per unit in sterling (\u00c2\u00a3).\n\nCustomerID: Customer number. Nominal. A 5-digit integral number uniquely assigned to each customer.\n\nCountry: Country name. Nominal. The name of the country where a customer resides.\n\nhttps:\/\/archive.ics.uci.edu\/ml\/datasets\/Online+Retail+II","35845ed1":"It is time to give special gifts to our Loyal Customers!","bd697d50":"Recency and Frequency are used to define the RFM segmentation","088f9e91":"135K N\/A values on Customer ID is too much, 25% of our data, under normal project cycle we need to talk with client to fill most of them properly, but now we will skip that step. \n\nAlso we can not apply fillna options here due its Customer ID...","944b3a30":"## RFM Analysis as Homework for VBO DSMLBC3 by Tu\u011fbay Tez","7a8f91d5":"![RFM%20Visual.png](attachment:RFM%20Visual.png)","4e9defbf":"How much did our customers make purchases from us?","f0307c4d":"## Monetary"}}