{"cell_type":{"760861e4":"code","8953b6a2":"code","22151246":"code","bbd6de4e":"code","3573c73f":"code","3fd848e8":"code","9ca1473f":"code","753dd58b":"code","ae95e355":"code","6ceaf381":"code","1c072074":"code","2f843e5b":"code","3aa4eb5a":"code","77a46680":"code","7c728f62":"code","fe918229":"code","0eff3e86":"code","0bb2c21f":"code","f067f822":"code","6fdf8e48":"code","bfa30da0":"code","13185394":"code","6a119cd8":"code","e0cbfb64":"code","7961caa9":"markdown","9f08292f":"markdown","9179efb8":"markdown","080438f5":"markdown","6e717d53":"markdown","229ceee3":"markdown","f49bfbd4":"markdown","5e5c2ce5":"markdown","b772a40c":"markdown","13425d5d":"markdown","cbc8e7ec":"markdown","3f36eca3":"markdown"},"source":{"760861e4":"import sys\nimport os\nimport subprocess\nfrom six import string_types\n\n# Make sure you have all of these packages installed, e.g. via pip\nimport numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport matplotlib.image as mpimg\nimport scipy\nfrom skimage import io\nfrom scipy import ndimage\nimport rasterio\nimport openslide\nfrom IPython.display import display\nimport os\nfrom tqdm.auto import tqdm \nimport PIL\nfrom IPython.display import Image, display\nimport plotly.graph_objs as go\nsns.set_style(\"darkgrid\")\n# import the necessary packages\n%matplotlib inline","8953b6a2":"ROOT = \"\/kaggle\/input\/prostate-cancer-grade-assessment\/\"\n!ls {ROOT}","22151246":"# image and mask directories\ndata_dir = f'{ROOT}\/train_images'\nmask_dir = f'{ROOT}\/train_label_masks'","bbd6de4e":"train_path = ROOT + \"train.csv\"\ntrain_df = pd.read_csv(train_path)","3573c73f":"train_df.head()\n","3fd848e8":"print(\"shape : \", train_df.shape)\nprint(\"unique data provider : \", len(train_df.data_provider.unique()))\nprint(\"unique isup_grade(target) : \", len(train_df.isup_grade.unique()))\nprint(\"unique gleason_score : \", len(train_df.gleason_score.unique()))","9ca1473f":"ax = sns.countplot(x=\"isup_grade\", data=train_df)\nplt.title(\"target distribution\")\nplt.show()","753dd58b":"ax = sns.countplot(x=\"data_provider\", data=train_df)\nplt.title(\"Data Provider\")\nplt.show()","ae95e355":"fig= plt.figure(figsize=(10,6))\nax = sns.countplot(x=\"isup_grade\", hue=\"data_provider\", data=train_df)\nplt.show()","6ceaf381":"fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(12,5))\nsns.countplot(ax=ax1, y=\"gleason_score\", data=train_df)\nsns.countplot(ax=ax2, y=\"gleason_score\",hue='data_provider', data=train_df)\nplt.tight_layout()\nplt.title(\"counts of different gleason_score\")\nplt.show()","1c072074":"path = '\/kaggle\/input\/prostate-cancer-grade-assessment\/train_images\/0005f7aaab2800f6170c399693a96917.tiff'\nsrc = rasterio.open(path)","2f843e5b":"src.name\narray = src.read(1)","3aa4eb5a":"array","77a46680":"from matplotlib import pyplot\npyplot.imshow(array)\npyplot.show()  ","7c728f62":"train_label_masks = '\/kaggle\/input\/prostate-cancer-grade-assessment\/train_label_masks\/00412139e6b04d1e1cee8421f38f6e90_mask.tiff'\nsrc = rasterio.open(train_label_masks)\nsrc.name\narray = src.read(1)\npyplot.imshow(array)\npyplot.show()  ","fe918229":"files = os.listdir(ROOT+\"train_images\/\")\nprint(f\"there are {len(files)} tiff files in train_images folder\")\nfor i in train_df.image_id:\n    assert i+\".tiff\" in files\nprint(\"all training image_ids have their files in train_images folder\")","0eff3e86":"slide = openslide.OpenSlide(ROOT+\"train_images\/\"+files[0])\nspacing = 1 \/ (float(slide.properties['tiff.XResolution']) \/ 10000)\nprint(f\"File id: {slide}\")\nprint(f\"Dimensions: {slide.dimensions}\")\nprint(f\"Microns per pixel \/ pixel spacing: {spacing:.3f}\")\nprint(f\"Number of levels in the image: {slide.level_count}\")\nprint(f\"Downsample factor per level: {slide.level_downsamples}\")\nprint(f\"Dimensions of levels: {slide.level_dimensions}\")\npatch = slide.read_region((1780,1950), 0, (256, 256))\ndisplay(patch) # Display the image\nslide.close()","0bb2c21f":"dims, spacings, level_counts = [], [], []\ndown_levels, level_dims = [], []\n\n# train = train.sample(300)\nfor i in tqdm(train_df.image_id, leave=False):\n    slide = openslide.OpenSlide(ROOT+\"train_images\/\"+i+\".tiff\")\n    spacing = 1 \/ (float(slide.properties['tiff.XResolution']) \/ 10000)\n    dims.append(slide.dimensions)\n    spacings.append(spacing)\n    level_counts.append(slide.level_count)\n    down_levels.append(slide.level_downsamples)\n    level_dims.append(slide.level_dimensions)\n    slide.close()\n    del slide","f067f822":"train_df['width']  = [i[0] for i in dims]\ntrain_df['height'] = [i[1] for i in dims]\ntrain_df['spacing'] = spacings\ntrain_df['level_count'] = level_counts\n","6fdf8e48":"fig = plt.figure(figsize=(10,6))\nax = sns.scatterplot(x='width', y='height', data=train_df, alpha=0.3)\nplt.title(\"height(y) width(x) scatter plot\")\nplt.show()","bfa30da0":"fig = plt.figure(figsize=(10,6))\nax = sns.scatterplot(x='width', y='height', hue='isup_grade', data=train_df, alpha=0.6)\nplt.title(\"height(y) width(x) scatter plot with target\")\nplt.show()","13185394":"fig, (ax1, ax2, ax3) = plt.subplots(1, 3, figsize=(15,4))\nsns.countplot(ax=ax1, x=train_df['level_count'])\nax1.set_title(\"level counts\")\nsns.distplot(ax=ax2, a=[j for i in down_levels for j in i], bins=12, kde=False)\nax2.set_title(\"down level\")\nsns.distplot(ax=ax3, a=train_df['spacing'], kde=False)\nax2.set_title(\"spacing distribution\")\nplt.show()","6a119cd8":"def display_images(slides):     \n    for slide in slides:\n        image = openslide.OpenSlide(os.path.join(data_dir, f'{slide}.tiff'))\n        spacing = 1 \/ (float(image.properties['tiff.XResolution']) \/ 10000)\n        patch = image.read_region((1780,1950), 0, (256, 256))\n        display(patch) # Display the image\n        \n        print(f\"File id: {slide}\")\n        print(f\"Dimensions: {image.dimensions}\")\n        print(f\"Microns per pixel \/ pixel spacing: {spacing:.3f}\")\n        print(f\"Number of levels in the image: {image.level_count}\")\n        print(f\"Downsample factor per level: {image.level_downsamples}\")\n        print(f\"Dimensions of levels: {image.level_dimensions}\")\n        \n        image.close()","e0cbfb64":"images = [\n    '005e66f06bce9c2e49142536caf2f6ee',\n    '001c62abd11fa4b57bf7a6c603a11bb9',\n    '000920ad0b612851f8e01bcc880d9b3d'\n]\n\ndisplay_images(images)","7961caa9":"![image.png](attachment:image.png)","9f08292f":"# Reading Image File","9179efb8":"A Video has been attached that , will show the **Gleason Score** https:\/\/www.youtube.com\/watch?v=1Q7ERNtLcvk","080438f5":"# Introduction\nProstate cancer is cancer that occurs in the prostate \u2014 a small walnut-shaped gland in men that produces the seminal fluid that nourishes and transports sperm.\n\nProstate cancer is one of the most common types of cancer in men. Usually prostate cancer grows slowly and is initially confined to the prostate gland, where it may not cause serious harm. However, while some types of prostate cancer grow slowly and may need minimal or even no treatment, other types are aggressive and can spread quickly","6e717d53":"# Gleason Score","229ceee3":"<table class=\"table table-striped table-hover\">\n<thead>\n<tr>\n<th><b>Risk Group<\/b><\/th>\n<th><b>Grade Group<\/b><\/th>\n<th><b>Gleason Score<\/b><\/th>\n<\/tr>\n<\/thead>\n<tbody>\n<tr>\n<td>Low<\/td>\n<td>Grade Group 1<\/td>\n<td>Gleason Score \u2264 6<\/td>\n<\/tr>\n<tr>\n<td>Intermediate Favorable<\/td>\n<td>Grade Group 2<\/td>\n<td>Gleason Score 7 (3 + 4)<\/td>\n<\/tr>\n<tr>\n<td>Intermediate Unfavorable<\/td>\n<td>Grade Group 3<\/td>\n<td>Gleason Score 7 (4 + 3)<\/td>\n<\/tr>\n<tr>\n<td>High<\/td>\n<td>Grade Group 4<\/td>\n<td>Gleason Score 8<\/td>\n<\/tr>\n<tr>\n<td>High<\/td>\n<td>Grade Group 5<\/td>\n<td>Gleason Score 9-10<\/td>\n<\/tr>\n<\/tbody>\n<\/table>","f49bfbd4":"The Gleason Score is the grading system used to determine the aggressiveness of prostate cancer. ... The Gleason Score ranges from 1-5 and describes how much the cancer from a biopsy looks like healthy tissue (lower score) or abnormal tissue (higher score). Most cancers score a grade of 3 or higher.","5e5c2ce5":"# Grade Group?\nIn 2014, the International Society of Urological Pathologists released supplementary guidance and a revised prostate cancer grading system, called the Grade Groups.\n\nThe Grade Group system is simpler, with just five grades, 1 through 5.","b772a40c":"# Reading A Train Mask Image","13425d5d":"In the following sections we will load data from the slides with OpenSlide. The benefit of OpenSlide is that we can load arbitrary regions of the slide, without loading the whole image in memory. Want to interactively view a slide? We have added an interactive viewer to this notebook in the last section.","cbc8e7ec":"# Display Images together","3f36eca3":"# target Distribution"}}