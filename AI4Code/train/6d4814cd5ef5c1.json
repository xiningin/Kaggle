{"cell_type":{"2e260a4f":"code","9fc091dc":"code","c3cf2e2f":"code","3fe1034d":"code","187fbad5":"code","1a36e83e":"code","99e0322c":"code","8af0fe32":"code","a80ffbb8":"code","ae41f2f9":"code","5ee99381":"code","5e69001c":"code","a8521b9f":"code","55ed1140":"code","1d35bda4":"code","685e28f1":"code","06df6718":"code","76d4b164":"code","a502d69b":"code","781de0e4":"code","3a656124":"code","4c468f2a":"code","272e3e1d":"code","485f2425":"code","d907af8c":"code","59922bc6":"code","2568422b":"code","8455f734":"code","291b6105":"code","f2238c38":"code","6fa9ef86":"code","921f1814":"code","4083fd52":"code","7dfaebc8":"code","d50d3c9a":"code","35874eba":"code","a862c838":"code","5a7c55f7":"code","f62f68d6":"code","26a616d4":"code","c2d45b9b":"code","a37c93e2":"code","d6e90648":"code","43dfe58a":"code","49a89c6e":"code","c18ba36a":"code","5e70f914":"code","307ca3cb":"code","0ee21feb":"code","a04c9c29":"code","4cdb886a":"code","9aba2143":"code","eb3f9989":"code","0d635ed9":"code","91a7c7d6":"code","4bf72fda":"code","ee32c65e":"code","de97f33f":"code","1452855a":"code","3ac075e9":"code","ebaa1bd0":"code","cb7c8499":"code","4723ed56":"code","8581a9ba":"code","1231067e":"code","4d36d9ed":"code","7a9ef213":"code","c1ff9f6c":"code","909ed110":"code","511c0cc8":"code","4267c796":"code","ac394d49":"code","96445bf7":"code","dcfc2409":"code","b6ce2f2c":"code","77467aec":"code","e70da0cb":"code","bcdef63e":"code","513b1963":"code","a63b320c":"code","ec6ba596":"code","050fea4d":"code","c5897522":"code","863f8f7c":"code","79223c85":"code","c8150137":"code","72ff01b1":"code","fb6af042":"code","352c1ba2":"code","d6d3b4dc":"code","2e97f9f5":"code","7135e0bb":"code","c967693b":"code","68fb0323":"code","75f67777":"code","138fecd0":"code","37535975":"code","9e03b1ec":"code","eb30f328":"code","5757ba66":"code","3bc0734f":"code","e99c16f8":"markdown"},"source":{"2e260a4f":"import pandas as pd\npd.set_option('display.max_columns', None)\npromo=pd.read_csv('..\/input\/promo-abuse-detection-for-payment-apps\/Promo_Abuse_Detection_Dataset.csv')\npromo.head()","9fc091dc":"promo.nunique().sort_values(ascending=False)","c3cf2e2f":"promo['UserId'].value_counts().sort_values(ascending=False)[:1] #abuse detected","3fe1034d":"promo[promo['UserId']==13341428].head()","187fbad5":"promo.loc[promo['Unnamed: 0'] == 16, \"Target\"] = 0\npromo.loc[promo['Unnamed: 0'] == 17, \"Target\"] = 1\npromo[promo['UserId']==13341428].head()","1a36e83e":"promo['Device Id'].value_counts().sort_values(ascending=False)[:1]#abuse detected","99e0322c":"fix=promo[promo['Device Id']=='iosvd:++djsadjscior34728128MSASCDMVERww38rmbe8=:2537']\nfix.head()","8af0fe32":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","a80ffbb8":"promo.loc[promo['Unnamed: 0'] == 950, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Device Id']=='iosvd:++djsadjscior34728128MSASCDMVERww38rmbe8=:2537']","ae41f2f9":"promo['Ref PC AC Number'].value_counts().sort_values(ascending=False)[:6]#abuse detected","5ee99381":"fix=promo[promo['Ref PC AC Number']=='IN312XXXXX1298']\nfix.head()","5e69001c":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","a8521b9f":"promo.loc[promo['Unnamed: 0'] == 656, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN312XXXXX1298']","55ed1140":"fix=promo[promo['Ref PC AC Number']=='IN312XXXXX1299']\nfix.head()","1d35bda4":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","685e28f1":"promo.loc[promo['Unnamed: 0'] == 666, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN312XXXXX1299']","06df6718":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1188']\nfix.head()","76d4b164":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","a502d69b":"promo.loc[promo['Unnamed: 0'] == 19, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1188']","781de0e4":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1190']\nfix.head()","3a656124":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","4c468f2a":"promo.loc[promo['Unnamed: 0'] == 678, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1190']","272e3e1d":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1186']\nfix.head()","485f2425":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","d907af8c":"promo.loc[promo['Unnamed: 0'] == 18, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1186']","59922bc6":"fix=promo[promo['Ref PC AC Number']=='IN012XXXXX1185']\nfix.head()","2568422b":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","8455f734":"promo.loc[promo['Unnamed: 0'] == 658, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Ref PC AC Number']=='IN012XXXXX1185']","291b6105":"promo['Name']=promo['FirstName']+' '+promo['LastName']\npromo.nunique().sort_values(ascending=False)","f2238c38":"promo=promo.drop(['FirstName','LastName'],axis=1)\npromo.head()","6fa9ef86":"promo['Name'].value_counts().sort_values(ascending=False)[:6]#abuse detected","921f1814":"fix=promo[promo['Name']=='amit kumar']\nfix.head()","4083fd52":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","7dfaebc8":"promo.loc[promo['Unnamed: 0'] == 595, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='amit kumar']","d50d3c9a":"fix=promo[promo['Name']=='akash gupta']\nfix.head()","35874eba":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","a862c838":"promo.loc[promo['Unnamed: 0'] == 822, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='akash gupta']","5a7c55f7":"fix=promo[promo['Name']=='rohit kumar']\nfix.head()","f62f68d6":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","26a616d4":"promo.loc[promo['Unnamed: 0'] == 886, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='rohit kumar']","c2d45b9b":"fix=promo[promo['Name']=='raman ralhan']\nfix.head()","a37c93e2":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","d6e90648":"promo.loc[promo['Unnamed: 0'] == 456, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='raman ralhan']","43dfe58a":"fix=promo[promo['Name']=='sunil kumar']\nfix.head()","49a89c6e":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)[:-1]\ni","c18ba36a":"promo.loc[promo['Unnamed: 0'] == 490, \"Target\"] = 0\nfor j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo[promo['Name']=='sunil kumar']","5e70f914":"round(promo.Name.isnull().sum()*100\/len(promo),2)","307ca3cb":"promo[['Name']]=promo[['Name']].fillna('Unknown')\nfix=promo[promo['Name']=='Unknown']#abuse detected as posssibility of hacker expected.\nfix.head()","0ee21feb":"i=sorted(fix['Unnamed: 0'].unique().tolist(),reverse=True)\nlen(i)","a04c9c29":"for j in i:\n    promo.loc[promo['Unnamed: 0'] == j, \"Target\"] = 1\npromo.head()","4cdb886a":"round(promo.Target.isnull().sum()*100\/len(promo),2)","9aba2143":"promo.Target=promo.Target.fillna(0)\nround(promo.Target.value_counts()*100\/len(promo),2)","eb3f9989":"promo[['Sim_OS','Sim_Info','Sim_User']] = promo['Sim Id'].str.split(':',expand=True)\npromo.head()","0d635ed9":"promo[['Device_OS','Device_Info','Device_User']] = promo['Device Id'].str.split(':',expand=True)\npromo.head()","91a7c7d6":"promo=promo.drop(['Device Id','Sim Id'],axis=1)\npromo.head()","4bf72fda":"promo[['LastLoginTime','PresentLoginTime']].info()","ee32c65e":"promo['LastLoginTime']=promo['LastLoginTime'].replace('01-01-1900 00:00','00:00:00')\npromo['LastLoginTime'].unique()","de97f33f":"promo[['LastLoginTime_HH','LastLoginTime_MM','LastLoginTime_SS']] = promo['LastLoginTime'].str.split(':',expand=True)\npromo.head()","1452855a":"promo[['PresentLoginTime_HH','PresentLoginTime_MM','PresentLoginTime_SS']] = promo['PresentLoginTime'].str.split(':',expand=True)\npromo.head()","3ac075e9":"promo=promo.drop(['LastLoginTime','PresentLoginTime'],axis=1)\npromo.head()","ebaa1bd0":"promo[['Meta Data_1','Meta Data_2','Meta Data_3','Meta Data_4']] =promo['Meta Data'].str.split('-',expand=True)\npromo.head()","cb7c8499":"promo[['Email_user','Email_Domain']] =promo['Email'].str.split('@',expand=True)\npromo.head()","4723ed56":"promo=promo.drop(['Email','Meta Data'],axis=1)\npromo.head()","8581a9ba":"promo[['Reg Client IP_1','Reg Client IP_2','Reg Client IP_3','Reg Client IP_4']] =promo['Reg Client IP'].str.split('.',expand=True)\npromo.head()","1231067e":"promo=promo.drop(['Unnamed: 0','Reg Client IP'],axis=1)\npromo.head()","4d36d9ed":"promo.nunique().sort_values(ascending=False)","7a9ef213":"promo=promo.drop(['ProgramId','ProgramName','Meta Data_1','Meta Data_3','Status','Email_Domain','BadTryCount'],axis=1)\npromo.head()","c1ff9f6c":"promo['Reg Referral Code']=promo['Reg Referral Code'].str.strip().str[-3:]\npromo['Reg Referral Code'].head()","909ed110":"promo['RegisteredOn']=pd.to_datetime(promo['RegisteredOn'])\npromo['Dob']=pd.to_datetime(promo['Dob'])\npromo.head()","511c0cc8":"promo.info()","4267c796":"promo[['UserId','Mobile','PostalCode']]=promo[['UserId','Mobile','PostalCode']].astype(object)\npromo.info()","ac394d49":"promo.nunique().sort_values(ascending=False)","96445bf7":"promo.columns","dcfc2409":"promo.info()","b6ce2f2c":"(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","77467aec":"promo[['Reg Referral Code','Reg Referral Prefix']]=promo[['Reg Referral Code',\n                                                                 'Reg Referral Prefix']].fillna('Unknown')\n(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","e70da0cb":"promo.Gender.value_counts()","bcdef63e":"promo['Gender']=promo['Gender'].fillna('U')\n(promo.isnull().sum()*100\/len(promo)).sort_values(ascending=False)","513b1963":"promo.nunique().sort_values(ascending=False)","a63b320c":"promo.Name.value_counts()[:5]","ec6ba596":"!pip install pycaret","050fea4d":"promo.nunique().sort_values(ascending=False)*100\/len(promo)","c5897522":"promo.columns\n","863f8f7c":"promo.info()","79223c85":"promo.nunique().sort_values(ascending=False)","c8150137":"!pip install pandas-profiling","72ff01b1":"from pandas_profiling import ProfileReport\nProfileReport(promo, title=\"EDA Report\")","fb6af042":"data = promo.sample(frac=0.8, random_state=42)\ndata_unseen = promo.drop(data.index)\ndata.reset_index(inplace=True, drop=True)\ndata_unseen.reset_index(inplace=True, drop=True)\nprint('Data for Modeling: ' + str(data.shape))","352c1ba2":"print('Unseen Data For Predictions: ' + str(data_unseen.shape))","d6d3b4dc":"from pycaret.classification import *\npromo= setup(data =data, session_id=42,\n             target = 'Target',\n                  normalize = True, \n                  transformation = True, \n                  log_experiment = True,\n                  remove_multicollinearity = True, #rop one of the two features that are highly correlated with each other\n                  date_features=['RegisteredOn','Dob'],\n            categorical_features=[ 'Gender', 'UserId', 'Mobile', 'PostalCode',\n       'OS Type', 'Reg Referral Code', 'Reg Referral Prefix',\n       'Ref PC AC Number', 'Name', 'Sim_OS', 'Sim_Info', 'Sim_User',\n       'Device_OS', 'Device_Info', 'Device_User', 'LastLoginTime_HH',\n       'LastLoginTime_MM', 'LastLoginTime_SS', 'PresentLoginTime_HH',\n       'PresentLoginTime_MM', 'PresentLoginTime_SS', 'Meta Data_2',\n       'Meta Data_4', 'Email_user', 'Reg Client IP_1', 'Reg Client IP_2',\n       'Reg Client IP_3', 'Reg Client IP_4'],\n            high_cardinality_features =[ 'UserId', 'Mobile', 'PostalCode',\n       'OS Type', 'Reg Referral Code',\n       'Ref PC AC Number', 'Name', 'Sim_User',\n        'Device_User', 'LastLoginTime_HH',\n       'LastLoginTime_MM', 'LastLoginTime_SS', 'PresentLoginTime_HH',\n       'PresentLoginTime_MM', 'PresentLoginTime_SS',\n       'Meta Data_4', 'Email_user', 'Reg Client IP_1', 'Reg Client IP_2',\n       'Reg Client IP_3', 'Reg Client IP_4']  ,         \n            train_size = 0.8)","2e97f9f5":"lr = create_model('lr')","7135e0bb":"print(lr)","c967693b":"tuned_lr = tune_model(lr,optimize = 'F1')","68fb0323":"plot_model(tuned_lr, plot = 'auc')","75f67777":"plot_model(tuned_lr, plot = 'pr')","138fecd0":"plot_model(tuned_lr, plot='feature')","37535975":"plot_model(tuned_lr, plot = 'confusion_matrix')","9e03b1ec":"evaluate_model(tuned_lr)","eb30f328":"predict_model(tuned_lr)","5757ba66":"unseen_predictions = predict_model(tuned_lr, data=data_unseen)\nunseen_predictions.head()","3bc0734f":"print(\"Confidence Score :   {}\".format(round(unseen_predictions.Score.mean(),2)))#Confidence Score","e99c16f8":"There are few considerations , we are working with.\n- A device can be use once\n- Cashback to same account more than once is an abuse\n- Name with same email ID is an abuse"}}