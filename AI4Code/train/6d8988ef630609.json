{"cell_type":{"ba12fea8":"code","b20d9c24":"code","14c65f9c":"code","0ac8030d":"code","ac04f937":"code","3b3925f1":"code","364e7218":"code","6b71545e":"code","4282dc23":"code","452d838e":"code","a81122f5":"code","46b1ab5d":"code","7f58c191":"code","4cd95fd1":"code","8f183e6b":"code","a9777bbd":"code","6c1f4b80":"code","682b1132":"code","697bb6f9":"code","4390550c":"code","0c9a389f":"markdown","55416947":"markdown","5ee1b567":"markdown","239c8753":"markdown","73e87f3e":"markdown","8c043d36":"markdown","605b039c":"markdown","302e2ca5":"markdown","b18eba18":"markdown","e74923c3":"markdown","6e9abcba":"markdown","57e81ef5":"markdown","ba48ab7e":"markdown","512c1e76":"markdown","d219be36":"markdown","9e6fad1f":"markdown","ac090043":"markdown","289c518e":"markdown","24013265":"markdown","676462e2":"markdown","86671b2a":"markdown","3ba263c3":"markdown","87fd55a6":"markdown","24552ab0":"markdown","109a439c":"markdown","0a857b5e":"markdown","79fc7333":"markdown","5ffd55a7":"markdown","018d197b":"markdown"},"source":{"ba12fea8":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport seaborn as sns\nimport matplotlib.pyplot as plt \nimport plotly.graph_objs as go # interactive plotting library\nimport plotly.express as px\nfrom plotly.subplots import make_subplots\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.naive_bayes import GaussianNB\nfrom sklearn.model_selection import cross_val_score\nfrom sklearn.metrics import roc_curve,confusion_matrix,auc","b20d9c24":"heart_data = pd.read_csv(\"..\/input\/heart-disease-uci\/heart.csv\")\nheart_data.head()","14c65f9c":"sexMap={1:\"male\",0:\"female\"}\nheart_data['sex_label']=heart_data['sex'].map(sexMap)\ncpMap={1:\"typical angina\",2:\"atypical angina\",3:\"non-anginal pain\",4:\"asymptomatic\"}\nheart_data['cp_label']=heart_data['cp'].map(cpMap)\nfbsMap={1:\"true\",0:\"false\"}\nheart_data['fbs_label']=heart_data['fbs'].map(fbsMap)\nrestecgMap={0:\"normal\",1:\"having ST-T wave abnormality\",2:\"showing probable or definite left ventricular hypertrophy by Estes' criteria\"}\nheart_data['restecg_label']=heart_data['restecg'].map(restecgMap)\nexangMap={0:\"no\",1:\"yes\"}\nheart_data['exang_label']=heart_data['exang'].map(exangMap)\nslopeMap={1:\"upsloping\",2:\"flat\",3:\"downsloping\"}\nheart_data['slope_label']=heart_data['slope'].map(slopeMap)\nthalMap={1:\"normal\",2:\"fixed defect\",3:\"reversable defect\"}\nheart_data['thal_label']=heart_data['thal'].map(thalMap)\n\ntargetMap={1:\"heart disease\",0:\"health\"}\nheart_data['target_label']=heart_data['target'].map(targetMap)\n\nheart_data['trestbps_label'] = heart_data.trestbps.apply(lambda x: \"normal\" if x<120  else(\"elevated\" if x < 130 else ( \"high stage1\" if x < 140 else( \"high stage2\" if x < 180 else \"hypertensive crisis\" ))))","0ac8030d":"fig = px.violin(heart_data, y=\"age\", x=\"sex_label\", color=\"target_label\", box=True, points=\"all\",\n                labels={\n                    \"sex_label\": \"Gender\",\n                     \"target_label\": \"Health Condition\"\n                 },title=\"Age Distribution by Gender And Health Condition\",\n          hover_data=heart_data.columns)\nfig.show()","ac04f937":"fig = px.histogram(heart_data, x=\"trestbps\", color=\"target_label\",labels={\n                     \"trestbps\": \"Resting blood pressure\",\n                     \"target_label\": \"Health Condition\"\n                 },title=\"Resting Blood Pressure Distribution by Health Condition\",marginal=\"box\")\nfig.update_traces(opacity=0.85)\nfig.show()","3b3925f1":"fig = px.histogram(heart_data, x=\"chol\", color=\"target_label\",labels={\n                     \"chol\": \"Serum cholestoral in mg\/dl\",\n                     \"target_label\": \"Health Condition\"\n                 },title=\"Serum Cholestoral Distribution by Health Condition\",marginal=\"box\")\nfig.update_traces(opacity=0.85)\nfig.show()","364e7218":"fig = px.histogram(heart_data, x=\"thalach\", color=\"target_label\",labels={\n                     \"thalach\": \"The person's maximum heart rate achieved\",\n                     \"target_label\": \"Health Condition\"\n                 },title=\"Maximum Heart Rate Achieved Distribution by Health Condition\",marginal=\"box\")\nfig.update_traces(opacity=0.85)\nfig.show()","6b71545e":"fig = px.histogram(heart_data, x=\"oldpeak\", color=\"target_label\",labels={\n                     \"oldpeak\": \"ST depression induced by exercise relative to rest\",\n                     \"target_label\": \"Health Condition\"\n                 },title=\"Oldpeak Distribution by Health Condition\",marginal=\"box\")\nfig.update_traces(opacity=0.85)\nfig.show()","4282dc23":"# Taking the count of each Sex value of the disease\nheart_disease_cp= heart_data[heart_data.target.eq(1)]['cp_label'].value_counts()\nheart_disease_cp = pd.DataFrame({'cp':heart_disease_cp.index, 'count':heart_disease_cp.values})\n\n# Taking the count of each Sex value of the health\nheart_health_cp = heart_data[heart_data.target.eq(0)]['cp_label'].value_counts()\nheart_health_cp = pd.DataFrame({'cp':heart_health_cp.index, 'count':heart_health_cp.values})\n\nfig = make_subplots(rows=1, cols=2, specs=[[{'type':'domain'}, {'type':'domain'}]])\nfig.add_trace(go.Pie(labels=heart_disease_cp['cp'], values=heart_disease_cp['count'], name=\"disease\"),\n              1, 1)\nfig.add_trace(go.Pie(labels=heart_health_cp['cp'], values=heart_health_cp['count'], name=\"health\"),\n              1, 2)\n\n# Use `hole` to create a donut-like pie chart\nfig.update_traces(hole=.45, hoverinfo=\"label+percent+value+name\")\n\nfig.update_layout(\n    title_text=\"The Chest Pain Distribution by Health Condition\",\n    # Add annotations in the center of the donut pies.\n    annotations=[dict(text='Heart Disease', x=0.14, y=0.5, font_size=16, showarrow=False),\n                 dict(text='Health', x=0.82, y=0.5, font_size=16, showarrow=False)])\nfig.show()","452d838e":"# Taking the count of each Sex value of the disease\nheart_disease_restecg= heart_data[heart_data.target.eq(1)]['restecg_label'].value_counts()\nheart_disease_restecg = pd.DataFrame({'restecg':heart_disease_restecg.index, 'count':heart_disease_restecg.values})\n\n# Taking the count of each Sex value of the health\nheart_health_restecg = heart_data[heart_data.target.eq(0)]['restecg_label'].value_counts()\nheart_health_restecg = pd.DataFrame({'restecg':heart_health_restecg.index, 'count':heart_health_restecg.values})\n\nfig = make_subplots(rows=1, cols=2, specs=[[{'type':'domain'}, {'type':'domain'}]])\nfig.add_trace(go.Pie(labels=heart_disease_restecg['restecg'], values=heart_disease_restecg['count'], name=\"disease\"), \n              1, 1)\nfig.add_trace(go.Pie(labels=heart_health_restecg['restecg'], values=heart_health_restecg['count'], name=\"health\"),\n              1, 2)\n\n# Use `hole` to create a donut-like pie chart\nfig.update_traces(hole=.45, hoverinfo=\"label+percent+value+name\")\n\nfig.update_layout(\n    title_text=\"Resting Electrocardiographic Distribution by Health Condition\",\n    legend=dict( yanchor=\"top\", y=-0.1, xanchor=\"left\", x=0.6),\n    # Add annotations in the center of the donut pies.\n    annotations=[dict(text='Heart Disease', x=0.15, y=0.5, font_size=16, showarrow=False),\n                 dict(text='Health', x=0.82, y=0.5, font_size=16, showarrow=False)])\nfig.show()","a81122f5":"# Taking the count of each Sex value of the disease\nheart_disease_slope= heart_data[heart_data.target.eq(1)]['slope'].value_counts()\nheart_disease_slope = pd.DataFrame({'slope':heart_disease_slope.index, 'count':heart_disease_slope.values})\n\n# Taking the count of each Sex value of the health\nheart_health_slope = heart_data[heart_data.target.eq(0)]['slope'].value_counts()\nheart_health_slope = pd.DataFrame({'slope':heart_health_slope.index, 'count':heart_health_slope.values})\n\nfig = make_subplots(rows=1, cols=2, specs=[[{'type':'domain'}, {'type':'domain'}]])\nfig.add_trace(go.Pie(labels=heart_disease_slope['slope'], values=heart_disease_slope['count'], name=\"disease\"),\n              1, 1)\nfig.add_trace(go.Pie(labels=heart_health_slope['slope'], values=heart_health_slope['count'], name=\"health\"),\n              1, 2)\n\n# Use `hole` to create a donut-like pie chart\nfig.update_traces(hole=.45, hoverinfo=\"label+percent+value+name\")\n\nfig.update_layout(\n    title_text=\"Slope Distribution by Health Condition\",\n    # Add annotations in the center of the donut pies.\n    annotations=[dict(text='Heart Disease', x=0.15, y=0.5, font_size=16, showarrow=False),\n                 dict(text='Health', x=0.82, y=0.5, font_size=16, showarrow=False)])\nfig.show()","46b1ab5d":"# Taking the count of each Sex value of the disease\nheart_disease_thal= heart_data[heart_data.target.eq(1)]['thal_label'].value_counts()\nheart_disease_thal = pd.DataFrame({'thal':heart_disease_thal.index, 'count':heart_disease_thal.values})\n\n# Taking the count of each Sex value of the health\nheart_health_thal = heart_data[heart_data.target.eq(0)]['thal_label'].value_counts()\nheart_health_thal = pd.DataFrame({'thal':heart_health_thal.index, 'count':heart_health_thal.values})\n\nfig = make_subplots(rows=1, cols=2, specs=[[{'type':'domain'}, {'type':'domain'}]])\nfig.add_trace(go.Pie(labels=heart_disease_thal['thal'], values=heart_disease_thal['count'], name=\"disease\"),\n              1, 1)\nfig.add_trace(go.Pie(labels=heart_health_thal['thal'], values=heart_health_thal['count'], name=\"health\"),\n              1, 2)\n\n# Use `hole` to create a donut-like pie chart\nfig.update_traces(hole=.45, hoverinfo=\"label+percent+value+name\")\n\nfig.update_layout(\n    title_text=\"Thalassemia Distribution by Health Condition\",\n    # Add annotations in the center of the donut pies.\n    annotations=[dict(text='Heart Disease', x=0.15, y=0.5, font_size=16, showarrow=False),\n                 dict(text='Health', x=0.82, y=0.5, font_size=16, showarrow=False)])\nfig.show()","7f58c191":"heart_data.corr()['target'].sort_values(ascending =False)[0:15]","4cd95fd1":"fig = px.imshow(heart_data.corr(),color_continuous_scale='rdbu_r',zmin=-1,zmax=1)\nfig.show()","8f183e6b":"data_X=heart_data.iloc[:, 0:13]\ndata_y=heart_data[['target']]\nX_train,X_test,y_train,y_test = train_test_split(data_X, data_y, test_size = 0.25, random_state = 250)","a9777bbd":"std = StandardScaler()\nX_train = std.fit_transform(X_train)\nX_test = std.transform(X_test)","6c1f4b80":"lg = LogisticRegression()  \nlg.fit(X_train, y_train.values.ravel())\n#y_predict = lg.predict(X_test)\ny_scores_lg = lg.predict_proba(X_test)\nfpr_lg, tpr_lg, threshold_lg = roc_curve(y_test, y_scores_lg[:, 1])\nroc_auc_lg = auc(fpr_lg, tpr_lg)","682b1132":"knn = KNeighborsClassifier(n_neighbors=20)\nknn.fit(X_train, y_train.values.ravel())\ny_scores_knn = knn.predict_proba(X_test)\nfpr_knn, tpr_knn, threshold_knn = roc_curve(y_test, y_scores_knn[:, 1])\nroc_auc_knn = auc(fpr_knn, tpr_knn)","697bb6f9":"NB = GaussianNB()\nNB.fit(X_train, y_train.values.ravel())\ny_scores_NB = NB.predict_proba(X_test)\nfpr_NB, tpr_NB, threshold_NB = roc_curve(y_test, y_scores_NB[:, 1])\nroc_auc_NB = auc(fpr_NB, tpr_NB)","4390550c":"fig = go.Figure()\n# Create and style traces\nline_lg=go.Scatter(x=fpr_lg, y=tpr_lg, name='LG AUC = %0.2f' % roc_auc_lg,\n                         line=dict(color='firebrick', width=4))\nline_knn=go.Scatter(x=fpr_knn, y=tpr_knn, name='KNN AUC = %0.2f' % roc_auc_knn,\n                         line=dict(color='royalblue', width=4))\nline_NB=go.Scatter(x=fpr_NB, y=tpr_NB, name='GaussianNB AUC = %0.2f' % roc_auc_NB,\n                         line=dict(color='green', width=4))\n\nfig.add_trace(line_lg)\nfig.add_trace(line_knn)\nfig.add_trace(line_NB)\nfig.add_trace(go.Scatter(x=[0,1],y=[0,1],name='',line=dict(color='black',dash='dash')))\nfig.update_layout(title='ROC Curve',\n                   xaxis_title='False Positive Rate',\n                   yaxis_title='True Positive Rate')\n\n\nfig.show()","0c9a389f":"# Set up environment and import data","55416947":"# Summary","5ee1b567":"## Gaussian Naive Bayes","239c8753":"## Features","73e87f3e":"![image.png](attachment:image.png)","8c043d36":"## Compare ROC Curves Chart","605b039c":"# Data Description","302e2ca5":"## Approach\nFirstly, I would use EDA to view the relationship between different attributes and find is there any obvious pattern to cause a heart disease. And then I would do data feature engineer according to the EDA. Lastly, I will split the data into train data and test data and build models to predict heart disease according to these features.  \nThe specific approaches and steps are as follows:  \n![image.png](attachment:image.png)\n* Make data more readable through converting code into actual meaning (label decode).\n* Use scatter plots, bar chart to understand the relationship between different attributes and heart disease. Use distribution plots to view the age\/gender difference in heart disease.\n* Transform some indicator data into qualitative data according to health standards defined, and view whether the classification of health standards will result in a more obvious correlation with heart disease.\n* View and remove outliers if have.\n* Feature engineering and feature selection (if necessary).\n* Divide the data set into training set and test set and use cross-validation.\n* Use classification models training: KNN, Naive Bayes, Logistic Regression, Decision Tree, SVM. Compare the ROC-curve and stacked the models.","b18eba18":"## Correlation","e74923c3":"cholestoral:","6e9abcba":"\n* **age**  \n* **sex**   (1 = male, 0 = female)\n* **cp:**   Chest pain type (4 values)   (Value 1: typical angina, Value 2: atypical angina, Value 3: non-anginal pain, Value 4: asymptomatic)    \nAngina (Chest Pain) is chest pain or discomfort caused when your heart muscle doesn't get enough oxygen-rich blood. It may feel like pressure or squeezing in your chest. The discomfort also can occur in your shoulders, arms, neck, jaw, or back.  \n* **trestbps:** Resting blood pressure.   \nideal blood pressure is considered to be between 90\/60mmHg and 120\/80mmHg. high blood pressure is considered to be 140\/90mmHg or higher. low blood pressure is considered to be 90\/60mmHg or lower.\n* **chol:**  Serum cholestoral in mg\/dl.   \nCholesterol is often associated with heart disease. That\u2019s because low-density lipoproteins (LDL) can build up in your arteries and restrict or block blood flow. Your body still needs a little cholesterol for healthy digestion and to make vitamin D and certain hormones.    \n* **fbs:**  Fasting blood sugar > 120 mg\/dl.    \nFasting blood sugar test. A blood sample will be taken after an overnight fast. A fasting blood sugar level less than 100 mg\/dL (5.6 mmol\/L) is normal. A fasting blood sugar level from 100 to 125 mg\/dL (5.6 to 6.9 mmol\/L) is considered prediabetes. If it's 126 mg\/dL (7 mmol\/L) or higher on two separate tests, you have diabetes.  \n* **restecg:**  Resting electrocardiographic measurement (0 = normal, 1 = having ST-T wave abnormality, 2 = showing probable or definite left ventricular hypertrophy by Estes' criteria)\n* **thalach:**  Maximum heart rate achieved   \nYou can calculate your maximum heart rate by subtracting your age from 220. For example, if you're 45 years old, subtract 45 from 220 to get a maximum heart rate of 175. This is the average maximum number of times your heart should beat per minute during exercise.\n* **exang:**  Exercise induced angina (1 = yes; 0 = no)\n* **oldpeak:**  Oldpeak = ST depression induced by exercise relative to rest  \n* **slope:**  The slope of the peak exercise ST segment (Value 1: upsloping, Value 2: flat, Value 3: downsloping) \n* **ca:**  number of major vessels (0-3) colored by flourosopy  \nNumber of major vessels colored by fluoroscopy had a medium effect on the CAD diagnosis that could be due to the small sample size of the study population.\n* **thal:**  A blood disorder called thalassemia (3 = normal; 6 = fixed defect; 7 = reversable defect)","57e81ef5":"blood pressure:","ba48ab7e":"# Exploratory Data Analysis","512c1e76":"## Split data set into train and test","d219be36":"![image.png](attachment:image.png)","9e6fad1f":"# Build Model","ac090043":"![image.png](attachment:image.png) ","289c518e":"## Background\n`Heart diseases`, also known as cardiovascular diseases (CVDs) are the number 1 cause of death around the world.  \nIn 2016 alone, 17.9 million people died from CVDs, accounting for 31% of deaths globally, with 85% of these having been due to a heart attack or stroke.    \n\n## Business\/Research need\nThe diagnosis of heart disease is done on a combination of clinical signs and test results. We want to see if we can find any trends in heart data to predict certain cardiovascular events or find any clear indications of heart health.\n","24013265":"## Visualization Analysis","676462e2":"## Data Scaler","86671b2a":"## KNN","3ba263c3":"## Problems Definition\nHere we want to know:\n* Is there any group more susceptible to heart disease? (like age, gender)\n* Which attributes are mainly related to heart disease?\n* How do these factors affect heart disease? Is there a big correlation between some normal and abnormal indicators and heart disease?\n* Is any other trends in heart data to predict certain cardiovascular events or could we find any clear indications of heart health?\n* How can we predict heart disease according to machine learning models? And how about their accuracy?","87fd55a6":"Information we got from the visualization analysis:  \n* **People with heart disease have a greater maximum heart rate.** healthy people have maximum heart rate achieved from 125 to 155, while people with heart disease range from 150 to 170.\n* **People with heart disease seems have a lower oldpeak than healthy people.** \n* **People with typical angina are more likely having a heart disease.** \n* **People having ST-T wave abnormality are more likely having a heart disease.** \n* **People whose value of the slope of the peak exercise ST segment equal to 2 are more likely having a heart disease.** \n* **People who have fixed defect thalassemia are more likely having a heart disease.** ","24552ab0":"After EDA and modeling, we can figure out that:\n* The average age of heart disease in male is younger than female.\n* The chest pain, exercise induced angina have obvious correlation with heart disease which indicate that these signs worthing attracting people's attention.\n* We use Logistic Regression, KNN, Gaussian Naive Bayes to predict the heart disease in this case. And compared these models performance, they all have good accuracy at around 0.88.  Based on the patient\u2019s clinical medical database, perhaps in the future these classification models can help us identify heart disease and alert patients in time. ","109a439c":"## Logistic Regression","0a857b5e":"Here we can see that **\"cp\", \"thalach\", \"exang\", \"oldpeak\", \"ca\"** have obvious correlation with heart disease","79fc7333":"## Add readable features","5ffd55a7":"## References  \n* Cardiovascular Diseases Overview,World Health Organization,viewed 2th September 2020  \nhttps:\/\/www.who.int\/health-topics\/cardiovascular-diseases#tab=tab_1\n* 'Angina (Chest Pain)', heart.org, 19th September 2020  \nhttps:\/\/www.heart.org\/en\/health-topics\/heart-attack\/angina-chest-pain#:~:text=Angina%20is%20chest%20pain%20or,neck%2C%20jaw%2C%20or%20back.\n* 'resting blood pressure', Wikipedia, 19th September 2020  \nhttps:\/\/en.wikipedia.org\/wiki\/Blood_pressure#:~:text=Normal%20resting%20blood%20pressure%2C%20in,to%20the%20present%2C%20at%20approx.\n* 'Diabetes', mayoclinic.org, 19th September 2020  \nhttps:\/\/www.mayoclinic.org\/diseases-conditions\/diabetes\/diagnosis-treatment\/drc-20371451#:~:text=Fasting%20blood%20sugar%20test.&text=A%20fasting%20blood%20sugar%20level,separate%20tests%2C%20you%20have%20diabetes.\n* 'major vessels colored by flourosopy',US National Library of Medicine National Institutes of Health, 24th September 2020  \nhttps:\/\/www.ncbi.nlm.nih.gov\/pmc\/articles\/PMC4468223\/","018d197b":"Transform some indicator data into qualitative data according to health standards defined."}}