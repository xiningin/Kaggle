{"cell_type":{"fc8e7b07":"code","fa292fc6":"code","bd39cd4b":"code","4ac96b47":"code","bddb923a":"code","7ea410d5":"code","1543260a":"code","a5adf7d4":"code","4777d99f":"code","971ba0b5":"code","a89dfddf":"code","6656def2":"code","3322404b":"code","1bea9cc0":"code","a75792dc":"code","8e93335c":"code","c846c90a":"code","722d3a2b":"code","26d5caca":"code","8190bc8d":"code","ca75e741":"markdown","76068b07":"markdown","85ac272a":"markdown","e285f7df":"markdown","36e8227b":"markdown","025a725b":"markdown","85b50ad3":"markdown","965bea3b":"markdown","e8b75d6d":"markdown","55a396fd":"markdown","34adf008":"markdown","75b08edd":"markdown","f6002616":"markdown","380f8f45":"markdown","5a6bea92":"markdown","91ef938a":"markdown","3745e799":"markdown","729e9e15":"markdown","e04fe3ad":"markdown","5d44d27a":"markdown","9c7b50a1":"markdown","955cc10b":"markdown","3a711043":"markdown"},"source":{"fc8e7b07":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport plotly.express as px\nimport plotly.graph_objects as go\n\nfrom scipy.stats import pearsonr\n\nfrom sklearn.cluster import KMeans\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.pipeline import make_pipeline\n\nfrom sklearn.manifold import TSNE\n\nnp.random.seed(42)\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n        \nos.chdir('\/kaggle\/input\/russian-passenger-air-service-20072020\/')","fa292fc6":"cargo = pd.read_csv('russian_air_service_CARGO_AND_PARCELS.csv')\nair_service = pd.read_csv('russian_passenger_air_service_2.csv')","bd39cd4b":"cargo.head()","4ac96b47":"air_service.head()","bddb923a":"def lat(x):\n    try:\n        return float(x.replace('Decimal', '').replace('(', '').replace(')', '').replace('\\'', '').split(',')[0])\n    except:\n        return np.nan\n    \ndef long(x):\n    try:\n        return float(x.replace('Decimal', '').replace('(', '').replace(')', '').replace('\\'', '').split(',')[1])\n    except:\n        return np.nan\n\nair_service['Latitude'] = air_service['Airport coordinates'].apply(lat)\nair_service['Longitude'] = air_service['Airport coordinates'].apply(long)\n\ncargo['Latitude'] = cargo['Airport coordinates'].apply(lat)\ncargo['Longitude'] = cargo['Airport coordinates'].apply(long)","7ea410d5":"fig = go.Figure()\nfig.add_trace(go.Bar(y=[(air_service[(air_service.Year==2020)].January>0).sum(), \n                            (air_service[(air_service.Year==2020)].February>0).sum(),\n                            (air_service.loc[(air_service.Year==2020), ['January', 'February']].sum(axis=1)>0).sum()],\n                         x=['January', 'February', 'Any']))\nfig.update_layout(title='Reported airports (positive January\/February)')\nfig.show()","1543260a":"print('There is', (air_service.groupby('Airport name')['Whole year'].sum()>0).sum(), '\/', air_service['Airport name'].nunique(), 'airports with any positive traffic since 2007')","a5adf7d4":"monthes = air_service.columns[2:14]\nalive = air_service.groupby('Airport name')['Whole year'].sum()>0\nair_service = air_service[air_service['Airport name'].apply(lambda x: alive[x])]\n\nfig = go.Figure()\n\nfor month in monthes:\n    sum_traffic_per_year = air_service.groupby('Year')[month].sum().reset_index()\n    sum_traffic_per_year = sum_traffic_per_year.rename(columns={month:'Traffic'})\n    fig.add_trace(go.Scatter(y=sum_traffic_per_year['Traffic'], x=sum_traffic_per_year['Year'], name=month))\n    \nfig.update_layout(title='Traffic in every month grouped by year (sum)')\nfig.show()","4777d99f":"monthes = air_service.columns[2:14]\n\nfig = go.Figure()\n\nyear_2019 = air_service.Year == 2019\n\nfig.add_trace(go.Scattergeo(lat=air_service.loc[year_2019, 'Longitude'],\n                           lon=air_service.loc[year_2019, 'Latitude'],\n                           text=air_service.loc[year_2019, 'Airport name'].values,\n                           marker={'size':np.clip(air_service.loc[year_2019, 'Whole year']\/(2*10e4), 0, 30)}))\n\nfig.update_layout(title='Location of airports and their year traffic in 2019',)\nfig.show()","971ba0b5":"average_year = air_service.groupby('Airport name')['Whole year'].mean().reset_index().sort_values(by='Whole year').iloc[-8:]\naverage_year = average_year.rename(columns={'Whole year': 'Average traffic'})\n\nfig = go.Figure()\n\nfig.add_trace(go.Bar(x=average_year['Airport name'].values, y=average_year['Average traffic'].values))\nfig.update_layout(title='Average traffic of 8 most popular airports',)\nfig.show()","a89dfddf":"cluster_number = 8\n\nclusterizer = make_pipeline(StandardScaler(), KMeans(random_state=42, \n                                        n_clusters=cluster_number)).fit(air_service.loc[air_service.Year==2019, monthes])","6656def2":"fig = go.Figure()\n\nfor cluster in range(cluster_number):\n    inCluster = clusterizer[1].labels_==cluster\n    \n    fig.add_trace(go.Scattergeo(lat=air_service.loc[year_2019].loc[inCluster, 'Longitude'],\n                               lon=air_service.loc[year_2019].loc[inCluster, 'Latitude'],\n                               text=air_service.loc[year_2019].loc[inCluster, 'Airport name'].values,\n                               name=cluster,\n                               marker={'size':np.log1p(air_service.loc[year_2019].loc[inCluster, 'Whole year'])}))\n\nfig.update_layout(title='Location of airports and their year traffic (logarithmic) in 2019',)\nfig.show()","3322404b":"tsne_decomposed = make_pipeline(StandardScaler(), TSNE(random_state=42))\\\n                .fit_transform(air_service.loc[air_service.Year==2019, monthes])\n\nfig = go.Figure()\nfor cluster in range(cluster_number):\n    fig.add_trace(go.Scatter(x=tsne_decomposed[clusterizer[1].labels_==cluster, 0],\n                             y=tsne_decomposed[clusterizer[1].labels_==cluster, 1],\n                             mode='markers', text=air_service.loc[air_service.Year==2019].\\\n                             loc[clusterizer[1].labels_==cluster, 'Airport name'], name=cluster))\nfig.update_layout(title='TSNE decomposition (2019, monthes)')\nfig.show()","1bea9cc0":"fig = go.Figure()\nfor cluster in range(cluster_number):\n    fig.add_trace(go.Scatter(x=monthes,\n                             y=air_service.loc[air_service.Year==2019, monthes].loc[clusterizer[1].labels_==cluster].mean(axis=0),\n                             mode='markers+lines', name=cluster))\nfig.update_layout(title='Mean traffic per month for every cluster')\nfig.show()","a75792dc":"cargo.head()","8e93335c":"print(\"Only\", (cargo.groupby('Airport name')['Whole year'].sum()>0).sum(), 'airports are \"alive\"')","c846c90a":"alive = cargo.groupby('Airport name')['Whole year'].sum()>0\ncargo = cargo[cargo['Airport name'].apply(lambda x: alive[x])]","722d3a2b":"average_year = cargo.groupby('Airport name')['Whole year'].mean().reset_index().sort_values(by='Whole year').iloc[-8:]\naverage_year = average_year.rename(columns={'Whole year': 'Average cargo'})\n\nfig = go.Figure()\n\nfig.add_trace(go.Bar(x=average_year['Airport name'].values, y=average_year['Average cargo'].values))\nfig.update_layout(title='Average cargo of 8 most popular airports',)\nfig.show()","26d5caca":"same_airports = set(cargo['Airport name'].unique()).intersection(set(air_service['Airport name'].unique()))\n\ncargo_pivot = pd.pivot_table(cargo[cargo['Airport name'].isin(same_airports)], values=monthes,\n                             columns=['Year'], index=['Airport name']).fillna(0)\nairser_pivot = pd.pivot_table(air_service[air_service['Airport name'].isin(same_airports)], values=monthes,\n                              columns=['Year'], index=['Airport name']).fillna(0)\n\ncorr = pd.Series([pearsonr(cargo_pivot.values[a], airser_pivot.values[a])[0] for a in range(cargo_pivot.shape[0])],\n          index=cargo_pivot.index)\n\ncorr = corr.reset_index().rename(columns={0:'Correlation'})\n\npx.histogram(corr, x='Correlation', title='Distribution of correlation between cargo and traffic')","8190bc8d":"print('Skewness is', corr.Correlation.skew(), '; Mean is', corr.Correlation.mean())","ca75e741":"### KMeans clusterization. ","76068b07":"### How many airports reported in 2020?","85ac272a":"### For quicker preview I'd like to use .head() again.","e285f7df":"#### We have data from a very little amount of airports in 2020. But what if not only in 2020?","36e8227b":"## Hello,\nthis is my first **serious** kernel. I wanted to make it as informative as possible preserving the simplicity.\nHope you will find this code and visualizations useful.\n\nFor plots I use [plotly](https:\/\/plotly.com\/python\/). \n\nIf you found this notebook interesting or useful please upvote it.\n\n### Some ideas...\n1. Russia is a big country. But the most of it's population and economics is in european part of it. How strongly distance from Moscow and airport traffic are correlated? (can be a trap - both can be correlated with population) \n\n### Links to parts\n1. [Introduction and first important notices](#First-steps)\n2. [Air_service EDA](#Air-Service)\n3. [CARGO_AND_PARCELS EDA](#CARGO_AND_PARCELS)","025a725b":"### But what affects correlation? Why some airports have a visisbly higher correlation?\n### Why some have negative Pearson coefficient?","85b50ad3":"### Let's take a deeper look at air_service file. ","965bea3b":"### Most popular airports","e8b75d6d":"### What can we see here?\n\n1. Traffic increases from year to year. (not including December ;) )\n2. The closer summer is - more people want to travel to somewhere. December is absolutely not popular time for traveling.\n3. 2009 and 2016 showed decrease in traffic. Maybe because of financial crisis.\n4. We have not enough information about 2020: it shows growth like there is no COVID-19. ","55a396fd":"### Importing libraries and getting path to files","34adf008":"### Wow, almost 2\/3 of airports are \"dead\". Let's delete them.","75b08edd":"### What can we see here? \n1. Most of the traffic belongs to cities with the highest population.\n2. Some popular places for vacation like Sochi also had a higher trafic in 2019.","f6002616":"# Air Service","380f8f45":"\n# CARGO_AND_PARCELS","5a6bea92":"### What can we see\n1. Sochi, Krasnodar, Ekaterinburg are in the same cluster - these cities are the centers of tourism.\n2. Moscow and Saint-Petersburg are the most popular cities and got their own clusters.","91ef938a":"### What's here?\n1. Khabarovsk and Vladivostok are new here, comparing to average traffic barplot.\n2. Moscow and Saint Petersburg are still the top-4 airports.","3745e799":"### Since top have slightly changed, what can we expect from correlation between cargo and traffic?","729e9e15":"### What can we see\n1. Distribution is skewed. Skewness is negative, most of the correlations are positive\n2. Mean is ~0.45. For some airports correlation is very high (>=0.7)","e04fe3ad":"### The only difference between clusters is popularity of each airport. Trends are the same.","5d44d27a":"## Map","9c7b50a1":"### Looking deeper into KMeans decisions...","955cc10b":"### Let's take a quick look at both files.","3a711043":"# First steps"}}