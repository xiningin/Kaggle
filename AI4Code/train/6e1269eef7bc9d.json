{"cell_type":{"fb794abe":"code","16d36ad3":"code","eeb0e835":"code","f57eff01":"code","09db13f0":"code","19a922d1":"code","b8f066cf":"code","57c3ce9f":"code","3e61308b":"code","de36977a":"code","43d65139":"code","196f04fa":"code","1e60c0eb":"code","edb0ad24":"code","b4d77d82":"code","77dff0df":"code","0f94c426":"code","2bd96b31":"code","960b0700":"code","9a4d9aca":"code","2eefef8e":"code","19dd6724":"code","19c4d029":"code","0fd2c0e9":"code","ff221f2c":"code","5837c609":"code","8d7f52f6":"code","6e84179b":"code","6db9fcd6":"code","7defbe67":"code","9cfc966f":"code","3850d4f2":"code","9b2c0adf":"code","e322dcb1":"code","a0928bc9":"markdown","6161e62e":"markdown","dd75c243":"markdown","974b02df":"markdown","fb8444e3":"markdown","d4edbf99":"markdown","9805c5ad":"markdown","9717421f":"markdown","5730b53a":"markdown","a45df1ff":"markdown","1237e824":"markdown","d40608b1":"markdown","a2970fdd":"markdown","d0d336c2":"markdown","fc27a959":"markdown","5a285162":"markdown","ea00ac45":"markdown","c3edbffa":"markdown","b6921d3d":"markdown","97974b42":"markdown","98240009":"markdown","bebe4805":"markdown","953e4340":"markdown","f5f8b906":"markdown","eb5190b9":"markdown","194d5325":"markdown","5e268e38":"markdown","4a199327":"markdown","ef181aa1":"markdown","98d13eeb":"markdown","91c73f9a":"markdown","8d1e6ae1":"markdown","64fabdaf":"markdown","fcdbb5e7":"markdown","fa4b913f":"markdown","29d46e61":"markdown","f5bb6ba8":"markdown","45d3610c":"markdown","db216224":"markdown","5bf592aa":"markdown","4743193c":"markdown","1d8a3c54":"markdown","abe17c4c":"markdown","e6982787":"markdown","0a05e31b":"markdown","5ea27e86":"markdown","3d2e0ca0":"markdown","07461214":"markdown","96b68c2f":"markdown","fdfe09fc":"markdown","d82d1f12":"markdown","7fc0371a":"markdown","7dd4bdf0":"markdown","3b3ab96b":"markdown","656fbc4f":"markdown","14ae2c9a":"markdown","d938cc3d":"markdown","b26e803f":"markdown"},"source":{"fb794abe":"import pandas as pd #Library to handle with dataframes\nimport matplotlib.pyplot as plt # Library to plot graphics\nimport numpy as np # To handle with matrices\nimport seaborn as sns # to build modern graphics\nfrom scipy.stats import kurtosis, skew # it's to explore some statistics of numerical values\nfrom scipy import stats","16d36ad3":"def resumetable(df):\n    print(f\"Dataset Shape: {df.shape}\")\n    summary = pd.DataFrame(df.dtypes,columns=['dtypes'])\n    summary = summary.reset_index()\n    summary['Name'] = summary['index']\n    summary = summary[['Name','dtypes']]\n    summary['Missing'] = df.isnull().sum().values    \n    summary['Uniques'] = df.nunique().values\n    summary['First Value'] = df.loc[0].values\n    summary['Second Value'] = df.loc[1].values\n    summary['Third Value'] = df.loc[2].values\n\n    for name in summary['Name'].value_counts().index:\n        summary.loc[summary['Name'] == name, 'Entropy'] = round(stats.entropy(df[name].value_counts(normalize=True), base=2),2) \n\n    return summary\n\ndef CalcOutliers(df_num): \n    '''\n    \n    Leonardo Ferreira 20\/10\/2018\n    Set a numerical value and it will calculate the upper, lower and total number of outliers\n    It will print a lot of statistics of the numerical feature that you set on input\n    \n    '''\n    # calculating mean and std of the array\n    data_mean, data_std = np.mean(df_num), np.std(df_num)\n\n    # seting the cut line to both higher and lower values\n    # You can change this value\n    cut = data_std * 3\n\n    #Calculating the higher and lower cut values\n    lower, upper = data_mean - cut, data_mean + cut\n\n    # creating an array of lower, higher and total outlier values \n    outliers_lower = [x for x in df_num if x < lower]\n    outliers_higher = [x for x in df_num if x > upper]\n    outliers_total = [x for x in df_num if x < lower or x > upper]\n\n    # array without outlier values\n    outliers_removed = [x for x in df_num if x > lower and x < upper]\n    \n    print('Identified lowest outliers: %d' % len(outliers_lower)) # printing total number of values in lower cut of outliers\n    print('Identified upper outliers: %d' % len(outliers_higher)) # printing total number of values in higher cut of outliers\n    print('Identified outliers: %d' % len(outliers_total)) # printing total number of values outliers of both sides\n    print('Non-outlier observations: %d' % len(outliers_removed)) # printing total number of non outlier values\n    print(\"Total percentual of Outliers: \", round((len(outliers_total) \/ len(outliers_removed) )*100, 4)) # Percentual of outliers in points\n    \n    return\n\n","eeb0e835":"# Importing our dataset in variable df_wine1\ndf_wine1 = pd.read_csv('..\/input\/winemag-data-130k-v2.csv', index_col=0)","f57eff01":"resumetable(df_wine1)","09db13f0":"# The function describe is focused on numerical features\n# in this case are points and price\nprint(\"Statistics of numerical data: \")\nprint(df_wine1.describe())","19a922d1":"# define the size of figures that I will build\nplt.figure(figsize=(16,5))\n\nplt.subplot(1,2,1) # this will create a grid of 1 row and 2 columns; this is the first graphic\ng = sns.countplot(x='points', data=df_wine1, color='forestgreen') # seting the seaborn countplot to known the points distribuition\ng.set_title(\"Points Count distribuition \", fontsize=20) # seting title and size of font\ng.set_xlabel(\"Points\", fontsize=15) # seting xlabel and size of font\ng.set_ylabel(\"Count\", fontsize=15) # seting ylabel and size of font\n\nplt.subplot(1,2,2)  # this will set the second graphic of our grid\nplt.scatter(range(df_wine1.shape[0]), np.sort(df_wine1.points.values), color='forestgreen') # creating a cumulative distribution\nplt.xlabel('Index', fontsize=15)  # seting xlabel and size of font\nplt.ylabel('Points Dist(US)', fontsize=15)  # seting ylabel and size of font\nplt.title(\"Points Distribuition\", fontsize=20) # seting title and size of font\n\nplt.show() #rendering the graphs","b8f066cf":"def cat_points(points):\n    if points in list(range(80,83)):\n        return 0\n    elif points in list(range(83,87)):\n        return 1\n    elif points in list(range(87,90)):\n        return 2\n    elif points in list(range(90,94)):\n        return 3\n    elif points in list(range(94,98)):\n        return 4\n    else:\n        return 5\n\ndf_wine1[\"rating_cat\"] = df_wine1[\"points\"].apply(cat_points)","57c3ce9f":"total = len(df_wine1)\nplt.figure(figsize=(14,6))\n\ng = sns.countplot(x='rating_cat', color='darkgreen',\n                  data=df_wine1)\ng.set_title(\"Point Categories Counting Distribution\", fontsize=20)\ng.set_xlabel(\"Categories \", fontsize=15)\ng.set_ylabel(\"Total Count\", fontsize=15)\n\nsizes=[]\n\nfor p in g.patches:\n    height = p.get_height()\n    sizes.append(height)\n    g.text(p.get_x()+p.get_width()\/2.,\n            height + 3,\n            '{:1.2f}%'.format((height\/total)*100),\n            ha=\"center\", fontsize=14) \n    \ng.set_ylim(0, max(sizes) * 1.15)\n\nplt.show()","3e61308b":"CalcOutliers(df_wine1['points'])","de36977a":"plt.figure(figsize=(14,5))\n\ng1 = plt.subplot(121)\ng1 = sns.distplot(np.log(df_wine1['price'].dropna() + 1),\n                  color='darkgreen')\ng1.set_title(\"Price Log distribuition  \", fontsize=20)\ng1.set_xlabel(\"Price(Log)\", fontsize=15)\ng1.set_ylabel(\"Frequency LOG\", fontsize=15)\n\nplt.subplot(122)\nplt.scatter(range(df_wine1.shape[0]), np.sort(df_wine1.price.values), \n            color='darkgreen')\nplt.xlabel('Index', fontsize=15)\nplt.ylabel('Prices(US)', fontsize=15)\nplt.title(\"Distribuition of prices\", fontsize=20)\n\n\nplt.show()","43d65139":"CalcOutliers(df_wine1['price'])","196f04fa":"plt.figure(figsize=(12,5))\n\ng = sns.distplot(df_wine1[df_wine1['price'] < 300]['price'], color='darkgreen')\ng.set_title(\"Price Distribuition Filtered 300\", fontsize=20)\ng.set_xlabel(\"Prices(US)\", fontsize=15)\ng.set_ylabel(\"Frequency Distribuition\", fontsize=15)\n\n\nplt.show()","1e60c0eb":"# Let's get tehe price_log to better work with this feature\ndf_wine1['price_log'] = np.log(df_wine1['price'])","edb0ad24":"plt.figure(figsize=(10,4))\n\ng = sns.regplot(x='points', y='price_log', \n                data=df_wine1, line_kws={'color':'red'},\n                x_jitter=True, fit_reg=True, color='darkgreen')\ng.set_title(\"Points x Price Distribuition\", fontsize=20)\ng.set_xlabel(\"Points\", fontsize= 15)\ng.set_ylabel(\"Price (log)\", fontsize= 15)\n\nplt.show()","b4d77d82":"plt.figure(figsize=(14,6))\n\ncountry = df_wine1.country.value_counts()[:20]\n\ng = sns.countplot(x='country', \n                  data=df_wine1[df_wine1.country.isin(country.index.values)],\n                 color='darkgreen')\ng.set_title(\"Country Of Wine Origin Count\", fontsize=20)\ng.set_xlabel(\"Country's \", fontsize=15)\ng.set_ylabel(\"Count\", fontsize=15)\ng.set_xticklabels(g.get_xticklabels(),rotation=45)\n\nplt.show()","77dff0df":"plt.figure(figsize=(16,12))\n\nplt.subplot(2,1,1)\ng = sns.boxplot(x='country', y='price_log',\n                  data=df_wine1.loc[(df_wine1.country.isin(country.index.values))],\n                 color='darkgreen')\ng.set_title(\"Price by Country Of Wine Origin\", fontsize=20)\ng.set_xlabel(\"Country's \", fontsize=15)\ng.set_ylabel(\"Price Dist(US)\", fontsize=15)\ng.set_xticklabels(g.get_xticklabels(),rotation=45)\n\nplt.subplot(2,1,2)\ng1 = sns.boxplot(x='country', y='points',\n                   data=df_wine1[df_wine1.country.isin(country.index.values)],\n                 color='darkgreen')\ng1.set_title(\"Points by Country Of Wine Origin\", fontsize=20)\ng1.set_xlabel(\"Country's \", fontsize=15)\ng1.set_ylabel(\"Points\", fontsize=15)\ng1.set_xticklabels(g1.get_xticklabels(),rotation=45)\n\nplt.subplots_adjust(hspace = 0.6,top = 0.9)\n\nplt.show()","0f94c426":"plt.figure(figsize=(15,5))\ng = sns.boxplot(x='country', y='price_log', color='darkgreen',\n                  data=df_wine1)\ng.set_title(\"Price by Country Of Wine Origin\", fontsize=20)\ng.set_xlabel(\"Country's \", fontsize=15)\ng.set_ylabel(\"Price Dist(US)\", fontsize=15)\ng.set_xticklabels(g.get_xticklabels(),rotation=90)\n\nplt.show()","2bd96b31":"plt.figure(figsize=(14,15))\n\nprovinces = df_wine1['province'].value_counts()[:20]\n\nplt.subplot(3,1,1)\ng = sns.countplot(x='province', \n                  data=df_wine1.loc[(df_wine1.province.isin(provinces.index.values))], \n                  color='darkgreen')\ng.set_title(\"Province Of Wine Origin \", fontsize=20)\ng.set_xlabel(\"Provinces\", fontsize=15)\ng.set_ylabel(\"Count\", fontsize=15)\ng.set_xticklabels(g.get_xticklabels(),rotation=45)\n\nplt.subplot(3,1,2)\ng1 = sns.boxplot(y='price', x='province',\n                  data=df_wine1.loc[(df_wine1.province.isin(provinces.index.values))], \n                  color='darkgreen')\ng1.set_title(\"Province Of Wine Origin \", fontsize=20)\ng1.set_xlabel(\"Province\", fontsize=15)\ng1.set_ylabel(\"Price\", fontsize=15)\ng1.set_xticklabels(g1.get_xticklabels(),rotation=45)\n\nplt.subplot(3,1,3)\ng2 = sns.boxplot(y='points', x='province',\n                  data=df_wine1.loc[(df_wine1.province.isin(provinces.index.values))], \n                  color='darkgreen')\ng2.set_title(\"Province Of Wine Origin\", fontsize=20)\ng2.set_xlabel(\"Provinces\", fontsize=15)\ng2.set_ylabel(\"Points\", fontsize=15)\ng2.set_xticklabels(g2.get_xticklabels(),rotation=45)\n\nplt.subplots_adjust(hspace = 0.6,top = 0.9)\n\nplt.show()","960b0700":"plt.figure(figsize=(14,16))\n\nprovinces = df_wine1['province'].value_counts()[:20]\n\nplt.subplot(3,1,1)\ng = sns.countplot(x='taster_name', data=df_wine1, color='darkgreen')\ng.set_title(\"Taster Name Count - TOP 20 \", fontsize=20)\ng.set_xlabel(\"Taster Name\", fontsize=15)\ng.set_ylabel(\"Count\", fontsize=15)\ng.set_xticklabels(g.get_xticklabels(),rotation=45)\n\nplt.subplot(3,1,2)\ng1 = sns.boxplot(y='price_log', x='taster_name', data=df_wine1, \n                 color='darkgreen')\ng1.set_title(\"Taster Name Wine Values Distribuition \", fontsize=20)\ng1.set_xlabel(\"Taster Name\", fontsize=15)\ng1.set_ylabel(\"Price\", fontsize=15)\ng1.set_xticklabels(g1.get_xticklabels(),rotation=45)\n\nplt.subplot(3,1,3)\ng2 = sns.boxplot(y='points', x='taster_name',\n                  data=df_wine1, color='darkgreen')\ng2.set_title(\"Taster Name Points Distribuition\", fontsize=20)\ng2.set_xlabel(\"Taster Name\", fontsize=15)\ng2.set_ylabel(\"Points\", fontsize=15)\ng2.set_xticklabels(g2.get_xticklabels(),rotation=45)\n\nplt.subplots_adjust(hspace = 0.6,top = 0.9)\n\nplt.show()","9a4d9aca":"plt.figure(figsize=(14,16))\n\ndesignation = df_wine1.designation.value_counts()[:20]\n\nplt.subplot(3,1,1)\ng = sns.countplot(x='designation', \n                  data=df_wine1.loc[(df_wine1.designation.isin(designation.index.values))],\n                  color='darkgreen')\ng.set_title(\"Province Of Wine Origin \", fontsize=20)\ng.set_xlabel(\"Country's \", fontsize=15)\ng.set_ylabel(\"Count\", fontsize=15)\ng.set_xticklabels(g.get_xticklabels(),rotation=45)\n\nplt.subplot(3,1,2)\ng1 = sns.boxplot(y='price_log', x='designation',\n                  data=df_wine1.loc[(df_wine1.designation.isin(designation.index.values))], \n                 color='darkgreen')\ng1.set_title(\"Province Of Wine Origin \", fontsize=20)\ng1.set_xlabel(\"Province\", fontsize=15)\ng1.set_ylabel(\"Price\", fontsize=15)\ng1.set_xticklabels(g1.get_xticklabels(),rotation=45)\n\nplt.subplot(3,1,3)\ng2 = sns.boxplot(y='points', x='designation',\n                  data=df_wine1.loc[(df_wine1.designation.isin(designation.index.values))], \n                 color='darkgreen')\ng2.set_title(\"Province Of Wine Origin\", fontsize=20)\ng2.set_xlabel(\"Provinces\", fontsize=15)\ng2.set_ylabel(\"Points\", fontsize=15)\ng2.set_xticklabels(g2.get_xticklabels(),rotation=45)\n\nplt.subplots_adjust(hspace = 0.6,top = 0.9)\n\nplt.show()","2eefef8e":"plt.figure(figsize=(14,16))\n\nvariety = df_wine1.variety.value_counts()[:20]\n\nplt.subplot(3,1,1)\ng = sns.countplot(x='variety', \n                  data=df_wine1.loc[(df_wine1.variety.isin(variety.index.values))], \n                  color='darkgreen')\ng.set_title(\"TOP 20 Variety \", fontsize=20)\ng.set_xlabel(\" \", fontsize=15)\ng.set_ylabel(\"Count\", fontsize=15)\ng.set_xticklabels(g.get_xticklabels(),rotation=45)\n\nplt.subplot(3,1,2)\ng1 = sns.boxplot(y='price_log', x='variety',\n                  data=df_wine1.loc[(df_wine1.variety.isin(variety.index.values))], \n                 color='darkgreen')\ng1.set_title(\"Price by Variety's\", fontsize=20)\ng1.set_xlabel(\"\", fontsize=15)\ng1.set_ylabel(\"Price\", fontsize=15)\ng1.set_xticklabels(g1.get_xticklabels(),rotation=45)\n\nplt.subplot(3,1,3)\ng2 = sns.boxplot(y='points', x='variety',\n                  data=df_wine1.loc[(df_wine1.variety.isin(variety.index.values))], \n                 color='darkgreen')\ng2.set_title(\"Points by Variety's\", fontsize=20)\ng2.set_xlabel(\"Variety's\", fontsize=15)\ng2.set_ylabel(\"Points\", fontsize=15)\ng2.set_xticklabels(g2.get_xticklabels(),rotation=90)\n\nplt.subplots_adjust(hspace = 0.7,top = 0.9)\n\nplt.show()","19dd6724":"plt.figure(figsize=(14,16))\n\nwinery = df_wine1.winery.value_counts()[:20]\n\nplt.subplot(3,1,1)\ng = sns.countplot(x='winery', \n                  data=df_wine1.loc[(df_wine1.winery.isin(winery.index.values))], \n                  color='darkgreen')\ng.set_title(\"TOP 20 most frequent Winery's\", fontsize=20)\ng.set_xlabel(\" \", fontsize=15)\ng.set_ylabel(\"Count\", fontsize=15)\ng.set_xticklabels(g.get_xticklabels(),rotation=45)\n\nplt.subplot(3,1,2)\ng1 = sns.boxplot(y='price_log', x='winery',\n                  data=df_wine1.loc[(df_wine1.winery.isin(winery.index.values))],\n                 color='darkgreen')\ng1.set_title(\"Price by Winery's\", fontsize=20)\ng1.set_xlabel(\"\", fontsize=15)\ng1.set_ylabel(\"Price\", fontsize=15)\ng1.set_xticklabels(g1.get_xticklabels(),rotation=45)\n\nplt.subplot(3,1,3)\ng2 = sns.boxplot(y='points', x='winery',\n                  data=df_wine1.loc[(df_wine1.winery.isin(winery.index.values))],\n                 color='darkgreen')\ng2.set_title(\"Points by Winery's\", fontsize=20)\ng2.set_xlabel(\"Winery's\", fontsize=15)\ng2.set_ylabel(\"Points\", fontsize=15)\ng2.set_xticklabels(g2.get_xticklabels(),rotation=90)\n\nplt.subplots_adjust(hspace = 0.7,top = 0.9)\n\nplt.show()","19c4d029":"df_wine1 = df_wine1.assign(desc_length = df_wine1['description'].apply(len))\n\nplt.figure(figsize=(14,6))\ng = sns.boxplot(x='points', y='desc_length', data=df_wine1,\n                color='darkgreen')\ng.set_title('Description Length by Points', fontsize=20)\ng.set_ylabel('Description Length', fontsize = 16) # Y label\ng.set_xlabel('Points', fontsize = 16) # X label\nplt.show()","0fd2c0e9":"plt.figure(figsize=(14,6))\n\ng = sns.boxplot(x='taster_name', y='desc_length', \n                data=df_wine1, color='darkgreen')\ng.set_title('Description Length by Taster Name', fontsize=20)\ng.set_ylabel('Description Length', fontsize = 16) # Y label\ng.set_xlabel('Taster Name', fontsize = 16) # X label\ng.set_xticklabels(g.get_xticklabels(),rotation=45)\nplt.show()","ff221f2c":"plt.figure(figsize=(14,6))\n\ng = sns.regplot(x='desc_length', y='price_log', line_kws={'color':'red'},\n                data=df_wine1, fit_reg=True, color='darkgreen', )\ng.set_title('Price by Description Length', fontsize=20)\ng.set_ylabel('Price(USD)', fontsize = 16) \ng.set_xlabel('Description Length', fontsize = 16)\ng.set_xticklabels(g.get_xticklabels(),rotation=45)\n\nplt.show()","5837c609":"\nfrom wordcloud import WordCloud, STOPWORDS\n\nstopwords = set(STOPWORDS)\n\nnewStopWords = ['fruit', \"Drink\", \"black\", 'wine', 'drink']\n\nstopwords.update(newStopWords)\n\nwordcloud = WordCloud(\n    background_color='white',\n    stopwords=stopwords,\n    max_words=300,\n    max_font_size=200, \n    width=1000, height=800,\n    random_state=42,\n).generate(\" \".join(df_wine1['description'].astype(str)))\n\nprint(wordcloud)\nfig = plt.figure(figsize = (12,14))\nplt.imshow(wordcloud)\nplt.title(\"WORD CLOUD - DESCRIPTION\",fontsize=25)\nplt.axis('off')\nplt.show()","8d7f52f6":"wordcloud = WordCloud(\n    background_color='white',\n    stopwords=stopwords,\n    max_words=300,\n    max_font_size=200, \n    width=1000, height=800,\n    random_state=42,\n).generate(\" \".join(df_wine1['title'].astype(str)))\n\nprint(wordcloud)\nfig = plt.figure(figsize = (12,14))\nplt.imshow(wordcloud)\nplt.title(\"WORD CLOUD - TITLES\",fontsize=25)\nplt.axis('off')\nplt.show()","6e84179b":"from sklearn.feature_extraction.text import CountVectorizer, TfidfVectorizer\nimport matplotlib.gridspec as gridspec # to do the grid of plots\n\ngrid = gridspec.GridSpec(5, 2)\nplt.figure(figsize=(16,7*4))\n\nfor n, cat in enumerate(country.index[:10]):\n    \n    ax = plt.subplot(grid[n])   \n    # print(f'PRINCIPAL WORDS CATEGORY: {cat}')\n    # vectorizer = CountVectorizer(ngram_range = (3,3)) \n    # X1 = vectorizer.fit_transform(df_train[df_train['host_cat'] == cat]['answer'])  \n    # print(cat)\n    # Applying TFIDF \n    vectorizer = TfidfVectorizer(ngram_range = (2, 3), min_df=5, \n                                 stop_words='english',\n                                 max_df=.5) \n    \n    X2 = vectorizer.fit_transform(df_wine1.loc[(df_wine1.country == cat)]['description']) \n    features = (vectorizer.get_feature_names()) \n    scores = (X2.toarray()) \n    \n    # Getting top ranking features \n    sums = X2.sum(axis = 0) \n    data1 = [] \n    \n    for col, term in enumerate(features): \n        data1.append( (term, sums[0,col] )) \n\n    ranking = pd.DataFrame(data1, columns = ['term','rank']) \n    words = (ranking.sort_values('rank', ascending = False))[:15]\n    \n    sns.barplot(x='term', y='rank', data=words, ax=ax, \n                color='blue', orient='v')\n    ax.set_title(f\"Wine's from {cat} N-grams\", fontsize=19)\n    ax.set_xticklabels(ax.get_xticklabels(),rotation=90)\n    ax.set_ylabel(' ')\n    ax.set_xlabel(\" \")\n\nplt.subplots_adjust(top = 0.95, hspace=.9, wspace=.1)\n\nplt.show()","6db9fcd6":"from nltk.sentiment.vader import SentimentIntensityAnalyzer\n\nSIA = SentimentIntensityAnalyzer()\n\n# Applying Model, Variable Creation\nsentiment = df_wine1.sample(15000).copy()\nsentiment['polarity_score']=sentiment.description.apply(lambda x:SIA.polarity_scores(x)['compound'])\nsentiment['neutral_score']=sentiment.description.apply(lambda x:SIA.polarity_scores(x)['neu'])\nsentiment['negative_score']=sentiment.description.apply(lambda x:SIA.polarity_scores(x)['neg'])\nsentiment['positive_score']=sentiment.description.apply(lambda x:SIA.polarity_scores(x)['pos'])\n\nsentiment['sentiment']= np.nan\nsentiment.loc[sentiment.polarity_score>0,'sentiment']='POSITIVE'\nsentiment.loc[sentiment.polarity_score==0,'sentiment']='NEUTRAL'\nsentiment.loc[sentiment.polarity_score<0,'sentiment']='NEGATIVE'\n","7defbe67":"plt.figure(figsize=(14,5))\n\nplt.suptitle('Sentiment of the reviews by: \\n- Points and Price(log) -', size=22)\n\nplt.subplot(121)\nax = sns.boxplot(x='sentiment', y='points', data=sentiment)\nax.set_title(\"Sentiment by Points Distribution\", fontsize=19)\nax.set_ylabel(\"Points \", fontsize=17)\nax.set_xlabel(\"Sentiment Label\", fontsize=17)\n\nplt.subplot(122)\nax1= sns.boxplot(x='sentiment', y='price_log', data=sentiment)\nax1.set_title(\"Sentiment by Price Distribution\", fontsize=19)\nax1.set_ylabel(\"Price (log) \", fontsize=17)\nax1.set_xlabel(\"Sentiment Label\", fontsize=17)\n\nplt.subplots_adjust(top = 0.75, wspace=.2)\nplt.show()","9cfc966f":"from sklearn.neighbors import NearestNeighbors # KNN Clustering \nfrom scipy.sparse import csr_matrix # Compressed Sparse Row matrix\nfrom sklearn.decomposition import TruncatedSVD # Dimensional Reduction","3850d4f2":"# Lets choice rating of wine is points, title as user_id, and variety,\ncol = ['province','variety','points']\n\nwine1 = df_wine1[col]\nwine1 = wine1.dropna(axis=0)\nwine1 = wine1.drop_duplicates(['province','variety'])\nwine1 = wine1[wine1['points'] > 85]\n\nwine_pivot = wine1.pivot(index= 'variety',columns='province',values='points').fillna(0)\nwine_pivot_matrix = csr_matrix(wine_pivot)","9b2c0adf":"knn = NearestNeighbors(n_neighbors=10, algorithm= 'brute', metric= 'cosine')\nmodel_knn = knn.fit(wine_pivot_matrix)","e322dcb1":"for n in range(5):\n    query_index = np.random.choice(wine_pivot.shape[0])\n    #print(n, query_index)\n    distance, indice = model_knn.kneighbors(wine_pivot.iloc[query_index,:].values.reshape(1,-1), n_neighbors=6)\n    for i in range(0, len(distance.flatten())):\n        if  i == 0:\n            print('Recmmendation for ## {0} ##:'.format(wine_pivot.index[query_index]))\n        else:\n            print('{0}: {1} with distance: {2}'.format(i,wine_pivot.index[indice.flatten()[i]],distance.flatten()[i]))\n    print('\\n')","a0928bc9":"# TFIDF Vectorizer in the Wine Review","6161e62e":"![Wine quality](https:\/\/images.unsplash.com\/photo-1506377247377-2a5b3b417ebb?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjExNzczfQ)","dd75c243":"I'll start exploring the data to find for interesting informations about the wine quality based on the sommeliers comments. \n\nAfter it, I will try to predict the wine region, based on the review of the sommeliers.","974b02df":"We can clearly see the distribuitioon of the data. It seems very similar with a normal distribution. \n\nJust a few number of wines have less than 82 points and more than 95 points. \n\nAs Points are one of the most important metrics in this dataset, I will explore it furthuer more. \n\nI will find for more important informations like quantiles and maybe try to set wines in categories based on it","fb8444e3":"# Taster Feature","d4edbf99":"## WORDCLOUDS OF DESCRIPTIONS","9805c5ad":"## WORDCLOUD OF WINE TITLES","9717421f":"It's very interesting that all wines have  quartiles in a values lower than 100","5730b53a":"## Importing Libraries","a45df1ff":"## Detecting Outlier Points","1237e824":"## Taking a look on values lowest than 500","d40608b1":"### Needed Libraries","a2970fdd":"Very cool. It seems a very meaningful information about the wine quality and characteristics. Let's try to explore it further below;<br>\nI will try to create an Tfidf to each different country. ","d0d336c2":"Cool! To the first model it's an OK system. \n\nI will implement something using the Description feature to better recomemend the wines","fc27a959":"## PROVINVCE FEATURE","5a285162":"# Generate a word cloud image\nmask = np.array(Image.open(\"img\/france.png\"))\nwordcloud_fra = WordCloud(stopwords=stopwords, background_color=\"white\",\n                          mode=\"RGBA\", max_words=5200, mask=mask).generate(fra)\n\n# create coloring from image\nimage_colors = ImageColorGenerator(mask)\nplt.figure(figsize=[7,7])\nplt.imshow(wordcloud_fra.recolor(color_func=image_colors), interpolation=\"bilinear\")\nplt.axis(\"off\")\n\n# store to file\nplt.savefig(\"img\/fra_wine.png\", format=\"png\")\n\n#plt.show()","ea00ac45":"<h2>Let's start looking the distribuition of Points and Prices <\/h2>","c3edbffa":"## Sentiment Analysis","b6921d3d":"## Outliers in Prices","97974b42":"- A simple histogram can be a great first step in understanding a dataset. <br>\n\n*I will start with univariate analysis and after it, I will cross some features by the numerical *","98240009":"Better understanding the lenght of reviews","bebe4805":"## Instantiating the KNN algorithmn and fiting in the Wine Matrix","953e4340":"We can see that some winery's have +- 200 label in his portfolio's. \n\nAlso, we can verify that Willians Selyem have highest points distribuition","f5f8b906":"## Who are the sommeliers with biggest descriptions length?!","eb5190b9":"Wow, very interesting distribuition. I was expecting to see Italy, Chile or Argentina as the biggest wine productor. <br>\n If you want take a better look, look the print output below","194d5325":"## VARIETY FEATURE","5e268e38":"## Let's take a look at Winery Distribuitions ","4a199327":"# Price Distribution","ef181aa1":"Very meaningful scatter plot. \n- The highest prices isn't of the wine with highest pontuation. \n- The most expensive wine have ponctuation between 87 and 90\n\nMaybe it would be interesting to build an recommender system to find cheapest wines with the same quality.","98d13eeb":"## Scatter plot of the description length and the price","91c73f9a":"Some resources: <br>\nhttps:\/\/www.kaggle.com\/sudhirnl7\/wine-recommender","8d1e6ae1":"# Welcome to my kernel.\nIn this notebook, I will create a baseline analysis to understand some characteristics about the different wines based on the regions and different wineries. ","64fabdaf":"Wow, we can see a difference description length per taster name","fcdbb5e7":"# Let's see a filtered distribution of Prices","fa4b913f":"## Let's set the points into categories.\n- I will create a new feature containing the range of the points with a rank to this pontuations","29d46e61":"Nice. It confirms what we saw in the above exploration. The greastest part of all analyzed wines have values under $ 100;","f5bb6ba8":"### Transforming the Columns","45d3610c":"Very interesting informations! \n\nWe can see that all outliers of this feature is in upper values.<br>\n\nAlso, we have less than 0,01% of outlier values in points.... Just 129 wines have more than 98 points.  \n\nWe will apply it on Price too... Let's start the understanding of it now. ","db216224":"# Country Feature","5bf592aa":"## Context\nAfter watching Somm (a documentary on master sommeliers) I wondered how I could create a predictive model to identify wines through blind tasting like a master sommelier would. The first step in this journey was gathering some data to train a model. I plan to use deep learning to predict the wine variety using words in the description\/review. The model still won't be able to taste the wine, but theoretically it could identify the wine based on a description that a sommelier could give. If anyone has any ideas on how to accomplish this, please post them\n","4743193c":"## Running our baseline Model","1d8a3c54":"## Province Exploration","abe17c4c":"Very cool! We can see that the wine's with highest points also have the biggest descriptions length. It's very interesting to understand.\n","e6982787":"## Ploting Rating categories\n- Let's see the distribution after the transformation","0a05e31b":"## Recommender System using a Collaborative Filtering method\n\nA small recommender system is made using Nearest Neighbors algorithm.\n\n- Similarity is the cosine of the angle between the 2 vectors of the item vectors of A and B\n- Closer the vectors, smaller will be the angle and larger the cosine\n\n***NEXT STEPS: I want to implement a recommender system using the Description***","5ea27e86":"## Stay tuned and if you liked this kernel, please votes up! ","3d2e0ca0":"Nice! Now we can have a clearly understand of our data in a more clean way. It could be interesting to compare each other regions; \n\nto ","07461214":"Cool. Now we can clearly see that we have less than 1% of outliers, that is 1177 prices that is out of our range","96b68c2f":"# Points Distribution\n- I will start exploring points and after I will see the same on price\n- Let's see the points distributions and quantiles","fdfe09fc":"Very interesting distribuition of Points and Price.\n- We can see that the values of points are distributed between 80 and 100\n- The price have a high difference between the values and a high standard deviation\n- In prices, the IQR (Interquantil Range) is 25. The max value is 3300;\n\nWe will explore it further later, lets start. ","d82d1f12":"## Ploting the sentiment labels","7fc0371a":"## Now, I will take a look in the distribuition of this top 20 countrys by price and rating","7dd4bdf0":"## Crossing prices and Points","3b3ab96b":"## Functions def","656fbc4f":"\n## I will try answer a batch of questions, like:\n\n- Have an Provinces the same number of wines? <br>\n- Whats the distribuition of Price and Points by Province? <br>\n- Whats the country distribuition<br>\n- The taster's have the same number of votings? <br>\n- What's the distribuition of Points and Prices by taster's name?   <br>\n- Taking a look on the word clouds.    <br>\n     ","14ae2c9a":"<h2>Let's take a first look on our data<\/h2>","d938cc3d":"Nice!!! The Price Log give us an impression that the data could normaly distributed, but like in points, we need to test.","b26e803f":"## Description N-gram "}}