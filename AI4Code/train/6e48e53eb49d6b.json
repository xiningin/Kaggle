{"cell_type":{"855fc23f":"code","52a6733a":"code","81bb9538":"code","b33cf7a7":"code","a7ca9112":"code","241cf34e":"code","64fa013f":"code","370f2e6e":"code","d4f04687":"code","493adb78":"code","7abc865a":"code","feccf295":"code","5af05829":"code","4da55457":"code","246882fb":"code","e8d29b41":"code","a84fc97a":"code","a0ecdd66":"code","6191ab07":"code","8de740e9":"code","d043c32d":"code","569afe0c":"code","93bcae89":"code","7bddf967":"code","018814fe":"code","a533369f":"code","62950366":"code","b6ae1a6a":"code","2b05be2a":"code","c866f9d7":"code","8548ea51":"code","b41fb9e2":"code","5faed1cf":"code","50b07903":"code","f4fc4430":"code","f029f623":"code","56d5de5d":"code","76ede627":"markdown","66619902":"markdown","51a95911":"markdown","e50617e0":"markdown"},"source":{"855fc23f":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport os\nprint(os.listdir(\"..\/input\"))","52a6733a":"import matplotlib.pyplot as plt\nimport seaborn as sns","81bb9538":"drugsComTrain_raw = pd.read_csv('..\/input\/drugsComTrain_raw.csv', parse_dates=['date'])","b33cf7a7":"drugsComTrain_raw.shape","a7ca9112":"drugsComTrain_raw.head()","241cf34e":"drugsComTrain_raw.describe()","64fa013f":"len(drugsComTrain_raw.drugName.unique())","370f2e6e":"len(drugsComTrain_raw.condition.unique())","d4f04687":"drugsComTrain_raw.rating.value_counts()","493adb78":"len(drugsComTrain_raw.date.unique())","7abc865a":"drugsComTrain_raw.groupby(['drugName'])['rating'].agg(['count', 'mean']).sort_values(by=['count', 'mean'], ascending=False)[:10]","feccf295":"temp_df = drugsComTrain_raw.groupby(['drugName'])['rating'].agg(['count', 'mean']).sort_values(by=['count', 'mean'], ascending=False)","5af05829":"temp_df.describe()","4da55457":"# https:\/\/stackoverflow.com\/questions\/1411199\/what-is-a-better-way-to-sort-by-a-5-star-rating\n# (WR) = (v \u00f7 (v+m)) \u00d7 R + (m \u00f7 (v+m)) \u00d7 C\n# * R = average for the movie (mean) = (Rating)\n# * v = number of votes for the movie = (votes)\n# * m = minimum votes required to be listed in the Top 250 (currently 1300)\n# * C = the mean vote across the whole report (currently 6.8)\n\nC = drugsComTrain_raw.rating.mean() \nm = temp_df['count'].mean()","246882fb":"tempdf = drugsComTrain_raw.groupby(['drugName']).agg({'rating': [np.average, np.count_nonzero]}).reset_index()","e8d29b41":"v = tempdf['rating']['count_nonzero']\nR = tempdf['rating']['average']\ntempdf['actual_rating'] = (v * R + m * C) \/ (v + m)","a84fc97a":"tempdf.sort_values(by=['actual_rating'], ascending=False, inplace=True)","a0ecdd66":"tempdf.head()","6191ab07":"tempdf2 = drugsComTrain_raw.groupby(['drugName', 'condition']).agg({'rating': [np.average, np.count_nonzero]}).reset_index()","8de740e9":"v2 = tempdf2['rating']['count_nonzero']\nR2 = tempdf2['rating']['average']\ntempdf2['actual_rating'] = (v2 * R2 + m * C) \/ (v2 + m)","d043c32d":"tempdf2.sort_values(by=['actual_rating'], ascending=False, inplace=True)","569afe0c":"tempdf2.set_index(['condition', 'drugName'], inplace=True)","93bcae89":"tempdf2.head(20)","7bddf967":"# example\ntempdf2.loc['mance Anxiety', 'Propranolol']['actual_rating'][0]","018814fe":"\ndrugsComTrain_raw['positive'] = drugsComTrain_raw['rating']>5","a533369f":"tempdf3 = drugsComTrain_raw.groupby(['drugName']).agg({'rating': [np.average, np.count_nonzero, np.std], 'positive': [np.sum]}).reset_index()","62950366":"tempdf3.head()","b6ae1a6a":"tempdf3.fillna(0, inplace=True) ","2b05be2a":"\ntempdf3.head()","c866f9d7":"\ntempdf3['quality_normal'] = tempdf3['rating']['average']\\\n                - (1.96 * tempdf3['rating']['std'] \/ np.sqrt(tempdf3['rating']['count_nonzero']))","8548ea51":"\ntempdf3.head()","b41fb9e2":"\nnp.min(tempdf3['quality_normal']), np.max(tempdf3['quality_normal'])","5faed1cf":"\ntempdf3['percentage'] = tempdf3['positive']['sum'] \/ tempdf3['rating']['count_nonzero']","50b07903":"\ntempdf3.head()","f4fc4430":"\ntempdf3['quality_binormal'] = tempdf3['percentage'] +   (1.96**2)\/ (2*tempdf3['rating']['count_nonzero']) \\\n                - 1.96 * (np.sqrt(tempdf3['percentage'] * (1-tempdf3['percentage']) + 1.96**2 \/ (4*tempdf3['rating']['count_nonzero'])) \/ tempdf3['rating']['count_nonzero']) \/ \\\n                    (1 + 1.96**2 \/ tempdf3['rating']['count_nonzero'])","f029f623":"\ntempdf3.head()","56d5de5d":"\nnp.min(tempdf3['quality_binormal']), np.max(tempdf3['quality_binormal'])","76ede627":"**rating of drug for each condition**","66619902":"### we can see from the table above that two records [0, 3] with one rating and different ratings values have the same quality binormal.","51a95911":"## Calculate quality of each rating per drug as in \n#### https:\/\/static.googleusercontent.com\/media\/research.google.com\/ar\/\/pubs\/archive\/36265.pdf","e50617e0":"**Calculate the average rating per drug**"}}