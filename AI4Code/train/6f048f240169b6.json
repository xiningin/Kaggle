{"cell_type":{"4eee5c5a":"code","eeb0efc9":"code","a6a1e450":"code","0b4864e2":"code","2cfddddb":"code","5c6dea6a":"code","f41cd23e":"code","e4faa241":"code","875691c9":"code","97f5ff39":"code","7e1486cb":"code","2924120c":"code","e19291f0":"code","859a0227":"code","ec2e26b5":"code","61f860e7":"code","489dbedd":"code","730ba49c":"code","f784435e":"code","0f2db290":"code","c3132ddb":"code","6edd5336":"code","9615752d":"code","87423ef3":"code","e9dd79a7":"code","d3585e67":"code","5a950d8e":"code","181f9e02":"code","201481f5":"code","84fc7c90":"code","9bbec626":"code","d22ab885":"code","6fb97ffa":"code","81a29593":"code","08865890":"code","9aee7577":"code","cee9b29a":"code","5e1b1806":"code","7935b2c6":"code","b1de3c3c":"code","eaab9f74":"code","2fb7ab92":"code","e596c126":"code","4e2420f4":"code","e061627b":"code","cb7f063f":"code","c6e435b1":"code","68ec9bdd":"code","7c4d13cc":"code","2063e3ec":"code","6329ce6d":"code","dcc3d7e0":"code","1aa173c6":"markdown","c3207489":"markdown","41eba9a1":"markdown","ced97040":"markdown","c07140ec":"markdown","4ebb92a4":"markdown","6db68ff1":"markdown","28b55e3c":"markdown","e62dee8d":"markdown","8911bfad":"markdown","6eebbea8":"markdown","186f5bdc":"markdown","311180ce":"markdown","a854d4a3":"markdown","0c63a434":"markdown","1dd5bbd0":"markdown","5998d899":"markdown","2aef66db":"markdown","4c2f3916":"markdown","8c88a9a6":"markdown"},"source":{"4eee5c5a":"import numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport plotly.graph_objects as go\nimport plotly.express as px\nimport plotly\nfrom plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot\nplotly.offline.init_notebook_mode (connected = True)","eeb0efc9":"df=pd.read_csv('..\/input\/av-healthcare-analytics-ii\/healthcare\/train_data.csv')\ndf['Count']=1\ndf.head()","a6a1e450":"df.info()","0b4864e2":"sns.heatmap(df.isna(),cmap='gnuplot')","2cfddddb":"df.isna().any()","5c6dea6a":"df_hos_code=df.groupby('Hospital_type_code')['Count'].sum().reset_index().sort_values(by='Count',ascending=False)","f41cd23e":"fig1=px.bar(df_hos_code,x='Hospital_type_code',y='Count',color='Count',labels={'Hospital_type_code':'Hospital Type Code','Count':'Number of patients'})\nfig1.update_layout(title='Patient distribution per hospital type code',title_x=0.5,template='plotly_dark')\nfig1.show()","e4faa241":"fig2=px.sunburst(df,path=['Hospital_region_code','Hospital_type_code'])\nfig2.update_layout(title='Hospital region case load distribution',title_x=0.5)\nfig2.show()","875691c9":"\nfig3=px.histogram(df,x='Available Extra Rooms in Hospital',marginal='box',color_discrete_sequence=['orange'],opacity=0.7)\nfig3.update_layout(template='plotly_dark',title='Number of hospitals with extra rooms',title_x=0.5)\nfig3.show()","97f5ff39":"df_beds=df[['Hospital_code','Available Extra Rooms in Hospital','Hospital_region_code']]\ndf_beds['Hospital_region_code']=df_beds['Hospital_region_code'].map({'X':1,'Y':2,'Z':3})\ndf_beds_grouped=df_beds.groupby('Hospital_code')[['Available Extra Rooms in Hospital','Hospital_region_code']].median().reset_index()\n","7e1486cb":"df_beds_grouped['Hospital_region_code']=df_beds_grouped['Hospital_region_code'].map({1:'X',2:'Y',3:'Z'})\ndf_beds_grouped.head()","2924120c":"df_beds_1=df_beds_grouped.groupby('Hospital_region_code')['Available Extra Rooms in Hospital'].sum().reset_index()\nfig4=px.pie(df_beds_1,values='Available Extra Rooms in Hospital',names='Hospital_region_code',hole=0.4)\nfig4.update_layout(title='Number of extra rooms in each region code',title_x=0.5)\nfig4.update_traces(textinfo='percent+label')","e19291f0":"df_dept=df.groupby('Department')['Count'].sum().reset_index().sort_values(by='Count',ascending=False)\n","859a0227":"fig5=px.bar(df_dept,x='Department',y='Count',color='Department',labels={'Count':'Number of patients'})\nfig5.update_layout(title='Case load distribution per department',title_x=0.5,template='plotly_dark')\nfig5.show()","ec2e26b5":"df_sev=df.groupby('Severity of Illness')['Count'].sum().reset_index().sort_values(by='Count',ascending=False)\nfig6=px.funnel(df_sev,x='Count',y='Severity of Illness',labels={'Count':'Number of patients'},color='Count')\nfig6.update_layout(title='Case load depending upon severity of illness',title_x=0.5,template='plotly_dark')\nfig6.show()","61f860e7":"fig7=px.sunburst(df,path=['Age','Severity of Illness'])\nfig7.update_layout(title='Age (in years) and Severity of Illness',title_x=0.5)\nfig7.show()","489dbedd":"fig8=px.sunburst(df,path=['Stay','Severity of Illness'])\nfig8.update_layout(title='Stay period (in days) vs Severity of illness',title_x=0.5)\nfig8.show()","730ba49c":"df.head()","f784435e":"from sklearn.preprocessing import LabelEncoder","0f2db290":"le=LabelEncoder()\ndf['Hospital_type_code_cat']=le.fit_transform(df['Hospital_type_code'])","c3132ddb":"df_reg_codes=pd.get_dummies(df['Hospital_region_code'])\n\ndf=pd.merge(df,df_reg_codes,on=df.index)","6edd5336":"df.drop('key_0',axis=1,inplace=True)","9615752d":"df_dept=pd.get_dummies(df['Department'])\ndf=pd.merge(df,df_dept,on=df.index)\ndf.drop('key_0',axis=1,inplace=True)","87423ef3":"df['Ward_Type_cat']=le.fit_transform(df['Ward_Type'])\ndf['Ward_Facility_Code_cat']=le.fit_transform(df['Ward_Facility_Code'])","e9dd79a7":"df_adm=pd.get_dummies(df['Type of Admission'])\ndf=pd.merge(df,df_adm,on=df.index)\ndf.drop('key_0',axis=1,inplace=True)\ndf_sev_ill=pd.get_dummies(df['Severity of Illness'])\ndf=pd.merge(df,df_sev_ill,on=df.index)\ndf.drop('key_0',axis=1,inplace=True)","d3585e67":"df['Age_cat']=le.fit_transform(df['Age'])\ndf['Stay_cat']=le.fit_transform(df['Stay'])","5a950d8e":"df_train=df.copy()","181f9e02":"unn_cols=['case_id','Hospital_type_code','Hospital_region_code','Department','Ward_Type',\n          'Ward_Facility_Code','Type of Admission','Severity of Illness','Age','Stay',\n          'Count','Admission_Deposit','Bed Grade','City_Code_Patient']\n\nfor cols in unn_cols:\n    df_train.drop(cols,axis=1,inplace=True)","201481f5":"df_train.info()","84fc7c90":"correlations=df_train.corr()\nplt.figure(figsize=(20,10))\nsns.heatmap(correlations,cmap='summer',annot=True,fmt='.2g')","9bbec626":"target=df_train['Stay_cat']\ntrain_df=df_train.iloc[:,:-1]","d22ab885":"from sklearn.linear_model import LogisticRegression\nfrom sklearn.model_selection import train_test_split\nreg_log=LogisticRegression()","6fb97ffa":"X_train,X_test,y_train,y_test=train_test_split(train_df,target,test_size=0.3,shuffle=True,random_state=0)\n","81a29593":"reg_log.fit(X_train,y_train)","08865890":"reg_log.score(X_train,y_train)","9aee7577":"y_predict_log=reg_log.predict(X_test)\nreg_log.score(X_test,y_test)","cee9b29a":"from sklearn.ensemble import RandomForestClassifier","5e1b1806":"rfc=RandomForestClassifier(max_depth=10,random_state=0)","7935b2c6":"rfc.fit(X_train,y_train)\nrfc.score(X_train,y_train)","b1de3c3c":"y_preds_rfc=rfc.predict(X_test)\nrfc.score(X_test,y_test)","eaab9f74":"from catboost import CatBoostClassifier","2fb7ab92":"cb_clf=CatBoostClassifier(iterations=800,\n                           learning_rate=0.08,\n                           depth=8,\n                           loss_function='MultiClass',\n                           eval_metric='Accuracy')","e596c126":"cb_clf.fit(X_train,y_train)\ncb_clf.score(X_train,y_train)","4e2420f4":"y_preds_cb=cb_clf.predict(X_test)\ncb_clf.score(X_test,y_test)","e061627b":"df_test=pd.read_csv('..\/input\/av-healthcare-analytics-ii\/healthcare\/test_data.csv')\ndf_test.head()\n\nid_df=df_test['patientid']","cb7f063f":"df_test['Hospital_type_code_cat']=le.fit_transform(df_test['Hospital_type_code'])\ndf_reg_codes=pd.get_dummies(df_test['Hospital_region_code'])\ndf_test=pd.merge(df_test,df_reg_codes,on=df_test.index)\ndf_test.drop('key_0',axis=1,inplace=True)\ndf_dept=pd.get_dummies(df_test['Department'])\ndf_test=pd.merge(df_test,df_dept,on=df_test.index)\ndf_test.drop('key_0',axis=1,inplace=True)\n\ndf_test['Ward_Type_cat']=le.fit_transform(df_test['Ward_Type'])\ndf_test['Ward_Facility_Code_cat']=le.fit_transform(df_test['Ward_Facility_Code'])\n\ndf_adm=pd.get_dummies(df_test['Type of Admission'])\ndf_test=pd.merge(df_test,df_adm,on=df_test.index)\ndf_test.drop('key_0',axis=1,inplace=True)\ndf_sev_ill=pd.get_dummies(df_test['Severity of Illness'])\ndf_test=pd.merge(df_test,df_sev_ill,on=df_test.index)\ndf_test.drop('key_0',axis=1,inplace=True)\n\n\ndf_test['Age_cat']=le.fit_transform(df_test['Age'])\n","c6e435b1":"unn_cols=['Hospital_type_code','Hospital_region_code','Department','Ward_Type',\n          'Ward_Facility_Code','Type of Admission','Severity of Illness','Age',\n          'Admission_Deposit','Bed Grade','City_Code_Patient']\n\nfor cols in unn_cols:\n    df_test.drop(cols,axis=1,inplace=True)","68ec9bdd":"df_test=df_test[['Hospital_code', 'City_Code_Hospital',\n       'Available Extra Rooms in Hospital', 'patientid',\n       'Visitors with Patient', 'Hospital_type_code_cat', 'X', 'Y', 'Z',\n       'TB & Chest disease', 'anesthesia', 'gynecology', 'radiotherapy',\n       'surgery', 'Ward_Type_cat', 'Ward_Facility_Code_cat', 'Emergency',\n       'Trauma', 'Urgent', 'Extreme', 'Minor', 'Moderate', 'Age_cat']]","7c4d13cc":"y_preds=cb_clf.predict(df_test)","2063e3ec":"df['Stay_cat']=le.fit_transform(df['Stay'])\ny_final=le.inverse_transform(y_preds)","6329ce6d":"sample_df=pd.read_csv('..\/input\/av-healthcare-analytics-ii\/healthcare\/sample_sub.csv')\ndf_final=pd.DataFrame(sample_df.iloc[:,0],columns=['case_id'])\ndf_final['Stay']= y_final","dcc3d7e0":"final_sub=df_final.to_csv('Catboost predictions',index=False)","1aa173c6":"We now need to convert the numerical stay data into categorical data.","c3207489":"As we can see, most of columns don't have any missing values associated to them. This is a very good sign that we are dealing with pre processed data.\n\n# 2. Data Visualisations\n\nHere, we shall emphasise on the EDA with the available data to find out some key insights.\n\n## Hospital type code\n\nLet us check which code of hospitals have the highest patient density.","41eba9a1":"From the above pie chart, we see that the number of extra available rooms are almost equally distributed amongst the three region codes. This is an ideal scenario.\n\n## Department\n\nHere, we shall check which departments have the highest number of case loads.\n","ced97040":"As we can see, the logistic regression has performed extremely poorly with only 28 % accuracy. Let us check another algorithm.\n\n\n## b) Random Forest Classifier","c07140ec":"As we can see from the sunburst plot above, extreme cases are least for each age group. However, the extreme cases in relation to the moderate and minor cases seem to increase with higher age groups.\n\n\n## Severity of illness Vs Stay\n\nLet us check how the severity of illness and stay period changes.\n","4ebb92a4":"As we can see, the hospital type **A** has a much higher patient case load when in comparison any of the other hospital codes. Hospital type **G** has the least case load. Hence, hospital type A has a much higher likelihood of running out of patient beds while G has the least. The ideal distribution would've been a uniform distribution where the under utilised beds of other hospital type codes may have been equally utilised.\n\n## Hospital region code\n\nThe region code would likely divide all the available hospitals into three regions encoded as X,Y and Z. This will again let us know which hospital type belongs to which region and their corresponding case loads as well.","6db68ff1":"As we can see from the above sunburst plot, the case loads in hospital region **X** is marginally higher than hospital region **Y** and the least in region **Z** .  For region X, the hospital type A had highest case load while it was more equally balanced between a and b in region Y. For region Z, highest case loads were in hospital type C. Hospitals in region X seem to show better distribution amogst all the hospital types.\n\nFor region Y, distribution between A and B is ideal but f,d and g have been under utilised. For Z, cases in hospital c were easily the highest but a and d are extremely under utilised.\n\n## Available Extra Rooms in Hospital\n\nThis is an important indicator as to how the hospital is coping with the case loads. Let us check how the extra rooms are distributed across the various hospitals.","28b55e3c":"# Introduction\n\nHealthcare is one of the extremely important services of a nation to keep their population healthy and working for the economy to boom. Lack of healthcare or the collapse of healthcare can lead to massive implications for a country's development. This is the reason as to why every goverment of every country spends billions of dollars to improve and keep their healthcare functioning so as to give the general population affordable healthcare options.\n\nHowever, challenges faced by a country such as India are far more complicated than the rest of the world. A country with 1.33 billion people with sizeable population living in the remote areas make it a very tough task for everyone to be provided with equal and afforable healthcare oppoptunities. Many poor people need to travel thousands of KMs to get the required healthcare. Another issue faced by healthcares due to the increasing population is the lack of beds and healthcare personnel. This has been especially observed during the tough times of COVID-19 where people with even mild symptoms would flock in big numbers at the goverment healthcare facilities making it extremely tough for the officials to manage the patients.\n\nInnovative methods must be sought after so that the officials can be able to forecast the traffic of patients. Judging the health problems, we can come up with a ML algorithm that can predict how long would a patient require hospitalisation. If the algorithm can help the officials get a ballpark value of hospitalisation period, they'll be able to handle the traffic of patients much better.\n\n![1*KNbv0LOpKwA6g_8-d25mxw.png](attachment:1*KNbv0LOpKwA6g_8-d25mxw.png)\n\n# 1. Importing datasets and relevant libraries","e62dee8d":"As we can see, catboost seems to have done well at classifying the results better than the other algorithms. We shall use this for our test dataframe.\n\n## Testing phase","8911bfad":"As we can see, all the available data is now in numerical form and hence, can be used for ML algorithms. Let us check the correlation of each feature with each other through a heatmap.","6eebbea8":"# 4. Machine Learning\n\n\nIn this section, we shall apply some of the ML algorithms for correct classfication.\n\n## Training phase\n\n## a) Logistic Regression","186f5bdc":"As we can see from the above histogram, majority of hospitals have extra rooms in the size of 2,3 or 4 rooms. The median extra rooms is 3.\n\n\n## Available rooms Vs Region code\n\nLet us check which region of X,Y and Z have most number of extra rooms available to them. Ideally, they should have a uniform distribution showing equal case loads. Let us check what the data says.","311180ce":"## Heatmap for missing values","a854d4a3":"We can see that the scores for Random Forest Classifier are better than logistic regression for a pre pruned max_depth of 10.\n\n\n## c) CatBoost\n\n","0c63a434":"From the above plot, it is seen that generally for lower stay duration(upto 20 days), the severity of illness is majorly minor or moderate. For higher stay duration, the extreme severity cases start rising.\n\n21-30 days and 11-20 days are the most common stay periods across the hospitals.\n\n\n# 3. Data wrangling\n\nAs we can see, we have a lot of data available to us. Some of these data provide us useful information while the other portion doesn't. A portion of the data is not numerical and for this purpose, we will have to wrangle with the data to either label encode or one hot encode them. ","1dd5bbd0":"As we can see, we have numerous columns showing information such as hospital code, hospital type code and many other such identifiers. While a detailed documentation is not available as to what these codes mean, we will preserve them as they could provide great insight for our machine learning.","5998d899":"From the above funnel plot, we see that most numner of cases are moderate in nature followed by minor and then, extreme.\n\n\n## Age Vs Severity of illness\n\nLet us check if there's any relation amongst age and severity of illness","2aef66db":"From the above bar plot, we see that majority of the patients register themselves at the gynecology department. Surgery department has the least number of case loads. This is expected as daily birth cases are far higher than daily surgeries.\n\n\n## Severity of illness\n\nLet us check the number of patients of each severity of illness.","4c2f3916":"# Conclusion\n\n\nIt was seen that from the available data, about 42 % of the cases could be correctly classified. While this is not a very high value, it could definitely mean a situation of life and death maybe avoided by allowing a patient to reach a hospital which definitely has free beds available. ","8c88a9a6":"Now that we've either label encoded or one-hot encoded all the data, let us remove the previous categorical columns from the dataframe."}}