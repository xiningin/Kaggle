{"cell_type":{"5513f666":"code","4151c9f7":"code","65c1b782":"code","1c1305e5":"code","f8116de3":"code","e0eeb2a8":"code","0a036b66":"code","00166592":"code","a3eb246c":"code","8b73cec4":"code","17d9bd17":"code","6cbc5b00":"code","b4b64df5":"code","e650c6c7":"code","5e963309":"code","b3b9958d":"code","a4781e51":"code","ce76d36c":"code","4cba824a":"code","fd2bc70b":"code","9f1accfe":"markdown","9dbaefb7":"markdown","f32dcc41":"markdown","a179de7c":"markdown","13973df0":"markdown"},"source":{"5513f666":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport tensorflow as tf\nimport keras\nfrom keras.preprocessing import image\nfrom keras.models import Sequential\nfrom keras.layers import Conv2D, MaxPool2D, Flatten, Dense, Dropout, BatchNormalization, Input, GlobalAveragePooling2D, Flatten\nfrom keras.utils.vis_utils import plot_model\nfrom keras.callbacks import ModelCheckpoint,EarlyStopping,ReduceLROnPlateau\nfrom tensorflow.keras.layers.experimental import preprocessing\n\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","4151c9f7":"print(\"Num GPUs Available: \", len(tf.config.experimental.list_physical_devices('GPU')))","65c1b782":"train = pd.read_csv(\"\/kaggle\/input\/cassava-leaf-disease-classification\/train.csv\")\ntrain['label'] = train['label'].astype('string')\ntrain.head()","1c1305e5":"diseases = pd.read_json(\"\/kaggle\/input\/cassava-leaf-disease-classification\/label_num_to_disease_map.json\", typ='series')\ndiseases","f8116de3":"train['label'].value_counts(normalize=True)","e0eeb2a8":"IMG_SIZE = 224","0a036b66":"datagen = image.ImageDataGenerator(rescale=1\/255,\n                                validation_split=0.15)\n\nval_datagen = image.ImageDataGenerator(rescale=1\/255,\n                                       validation_split = 0.2)","00166592":"train_generator = datagen.flow_from_dataframe(\n    dataframe=train,\n    directory=\"\/kaggle\/input\/cassava-leaf-disease-classification\/train_images\",\n    x_col='image_id',\n    y_col='label',\n    target_size=(IMG_SIZE, IMG_SIZE),\n    batch_size=64,\n    subset='training',\n    shuffle = True,\n    class_mode='categorical'\n)\n\nval_generator = val_datagen.flow_from_dataframe(\n    dataframe=train,\n    directory=\"\/kaggle\/input\/cassava-leaf-disease-classification\/train_images\",\n    x_col='image_id',\n    y_col='label',\n    target_size=(IMG_SIZE, IMG_SIZE),\n    batch_size=32,\n    subset='validation',\n    class_mode = 'categorical',\n    shuffle = True\n)","a3eb246c":"train_imgs, labels = next(train_generator)\nprint(train_imgs.shape)","8b73cec4":"plt.figure(figsize=(20,10))\nfor i in range(25):\n    plt.subplot(5,5,i+1)\n    plt.xticks([])\n    plt.yticks([])\n    plt.grid(False)\n    plt.imshow(train_imgs[i])\n    label1 = np.argmax(labels[i])\n    plt.xlabel(diseases.get(label1))\nplt.show()","17d9bd17":"from tensorflow.keras.applications import Xception\nfrom keras.callbacks import ReduceLROnPlateau","6cbc5b00":"base_model = Xception(include_top=False, weights='..\/input\/keras-pretrained-models\/xception_weights_tf_dim_ordering_tf_kernels_notop.h5',input_shape=[IMG_SIZE,IMG_SIZE,3])\nbase_model.trainable = False","b4b64df5":"model = tf.keras.Sequential()\nmodel.add(base_model)\nmodel.add(GlobalAveragePooling2D())\nmodel.add(BatchNormalization())\nmodel.add(Flatten())\nmodel.add(Dropout(0.15))\nmodel.add(Dense(2048))\nmodel.add(Dropout(0.15))\nmodel.add(Dense(5, activation='softmax'))\n\nmodel.compile(loss=tf.keras.losses.CategoricalCrossentropy(), optimizer='adam', metrics=['accuracy'])\nmodel.summary()","e650c6c7":"plot_model(model, to_file='model.png', show_shapes=True, show_layer_names=True)","5e963309":"reduce_lr = ReduceLROnPlateau(monitor='val_loss', factor=0.2, patience=5, min_lr=0.001)","b3b9958d":"history = model.fit_generator(train_generator, steps_per_epoch=17118\/\/64, epochs=60,\n                              validation_data=val_generator, validation_steps = 4279\/\/32,\n                              callbacks=[reduce_lr]\n)","a4781e51":"model_history = history.history\nloss_accuracy_train = model.evaluate(train_generator)\nprint(\"Training Loss: {:.4f}\".format(loss_accuracy_train[0]))\nprint(\"Training Accuracy: {:.2%}\".format(loss_accuracy_train[1]))\nloss_accuracy = model.evaluate(val_generator)\nprint(\"Validation Loss: {:.4f}\".format(loss_accuracy[0]))\nprint(\"Validation Accuracy: {:.2%}\".format(loss_accuracy[1]))","ce76d36c":"fig , ax = plt.subplots(1,2)\ntrain_acc = history.history['accuracy']\ntrain_loss = history.history['loss']\nfig.set_size_inches(12,4)\n\nax[0].plot(history.history['accuracy'])\nax[0].plot(history.history['val_accuracy'])\nax[0].set_title('Training Accuracy vs Validation Accuracy')\nax[0].set_ylabel('Accuracy')\nax[0].set_xlabel('Epoch')\nax[0].legend(['Train', 'Validation'], loc='upper left')\n\nax[1].plot(history.history['loss'])\nax[1].plot(history.history['val_loss'])\nax[1].set_title('Training Loss vs Validation Loss')\nax[1].set_ylabel('Loss')\nax[1].set_xlabel('Epoch')\nax[1].legend(['Train', 'Validation'], loc='upper left')\n\nplt.show()","4cba824a":"preds = []\nss = pd.read_csv('..\/input\/cassava-leaf-disease-classification\/sample_submission.csv')\n\nfor image in ss.image_id:\n    img = tf.keras.preprocessing.image.load_img('..\/input\/cassava-leaf-disease-classification\/test_images\/' + image)\n    img = tf.keras.preprocessing.image.img_to_array(img)\n    img = tf.keras.preprocessing.image.smart_resize(img, (IMG_SIZE, IMG_SIZE))\n    img = tf.reshape(img, (-1, IMG_SIZE, IMG_SIZE, 3))\n    prediction = model.predict(img\/255)\n    preds.append(np.argmax(prediction))\n\nsubmission = pd.DataFrame({'image_id': ss.image_id, 'label': preds})\nsubmission","fd2bc70b":"submission.to_csv('submission.csv', index = False)","9f1accfe":"# Prediction","9dbaefb7":"# Training the Model","f32dcc41":"# Model","a179de7c":"# Importing important libraries","13973df0":"# Data Augmentation"}}