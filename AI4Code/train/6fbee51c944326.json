{"cell_type":{"a73b7bca":"code","09295389":"code","e2a3aef7":"code","cd33a532":"code","e88a6056":"code","6951c1f7":"code","e908d76a":"code","602dc1c9":"code","3e01e74c":"code","cfccf047":"code","5b989ca2":"code","23c3e16f":"code","15533a67":"code","c354b2de":"code","35f2f167":"code","e5b4556a":"code","0aa1e11e":"code","64577829":"code","ccb20702":"code","844e72b6":"code","9dd7767e":"code","448d38ef":"code","d97c07f3":"code","ecd62ee0":"code","d35cd258":"code","3f427ab4":"code","3d5dbd63":"code","cc7d77fa":"code","bfe62410":"code","d2d7adea":"code","933c51e4":"code","ed466a2b":"code","f5bc4936":"code","ea0ba5fe":"code","1e397cf9":"code","1137ab5d":"code","dd39387e":"code","7aec6caa":"code","ce052262":"code","5a00e93b":"code","86223cad":"code","d89d3c2a":"code","74b80074":"code","4600b461":"code","a450e4ac":"code","ea37afd9":"code","c774cb40":"code","210c06a9":"code","a85404ac":"code","80b682e8":"code","2aa061a7":"code","2d5b4a4e":"code","09132da8":"code","60b5eb92":"code","44a5dffd":"code","383a0155":"code","ab8108b3":"code","dc525707":"code","aa67c72e":"code","10d8511f":"code","fda3984b":"code","6ca821a7":"code","cbb2df79":"code","7c2e062a":"code","fb6b68c2":"code","1e849fbf":"code","f9d64679":"code","975b0d86":"code","a8e0b128":"code","0360670b":"code","c8527806":"code","7565ccf2":"code","33fa83cc":"code","c9a5b85d":"code","c6567019":"code","8668775a":"code","6db2ce18":"code","5a003091":"code","e4cc7054":"code","108fa1ad":"code","5a25db3c":"code","ec860641":"code","2a3a601f":"code","2c065617":"code","c0a575a4":"code","c127da56":"code","9cb2176b":"code","8242cf00":"code","385a310e":"code","8fd60fe3":"code","aa09472f":"code","33cb2c23":"code","63b35d9e":"code","57cba323":"code","79a2e00d":"code","24e4106c":"markdown","0ffc0949":"markdown","0f136ec4":"markdown","f2bb7540":"markdown","4d9f277c":"markdown","323cb924":"markdown","94955d5c":"markdown","51cb2408":"markdown","be01e1a8":"markdown","04013d5e":"markdown","24cc09f4":"markdown","bf13ac25":"markdown","68cd5047":"markdown","121755df":"markdown","3f434788":"markdown","bb8124dc":"markdown","9e215ea5":"markdown","3f2143c0":"markdown","8a547e63":"markdown","1175b710":"markdown","b68ec138":"markdown","1df551d5":"markdown","43c72fc3":"markdown","80a7a8a4":"markdown","e99755a5":"markdown","898c98fd":"markdown","e96c3a79":"markdown","41c5f984":"markdown","ae7be5e0":"markdown","2580f3d3":"markdown","e19832b2":"markdown","89c6c58c":"markdown","125c11de":"markdown","3b71be82":"markdown","47431e5b":"markdown","a61d2666":"markdown","0cb164b9":"markdown","8ea29bdc":"markdown","3c9a14f3":"markdown","d1db7c92":"markdown","15fc544a":"markdown","7ad1bca8":"markdown","fb1788ec":"markdown","125abcf7":"markdown","9cfd92b9":"markdown","a6992cf6":"markdown","191257dd":"markdown"},"source":{"a73b7bca":"# data analysis libraries:\nimport numpy as np\nimport pandas as pd\n\n# data visualization libraries:\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline\n\n# to ignore warnings:\nimport warnings\nwarnings.filterwarnings('ignore')\n\n# to display all columns:\npd.set_option('display.max_columns', None)\n\nfrom sklearn.model_selection import train_test_split, GridSearchCV\n\n","09295389":"#import train and test CSV files\n\ntrain_data = pd.read_csv(\"\/kaggle\/input\/titanic\/train.csv\")\ntest_data = pd.read_csv(\"\/kaggle\/input\/titanic\/test.csv\")","e2a3aef7":"# copy data in order to avoid any change in the original:\n\ntrain = train_data.copy()\ntest = test_data.copy()","cd33a532":"#take a look at the training data\n\ntrain.describe(include=\"all\")","e88a6056":"#get information about the dataset\n\ntrain.info()","6951c1f7":"#get a list of the features within the dataset\n\nprint(train.columns)\n","e908d76a":"#head \n\ntrain.head()\n","602dc1c9":"#head \n\ntest.head()\n","3e01e74c":"#tail\n\ntrain.tail()","cfccf047":"#see a sample of the dataset to get an idea of the variables\n\ntrain.sample(5)\n\n","5b989ca2":"#check for any other unusable values\n\nprint(pd.isnull(train).sum())\n","23c3e16f":"#see a summary of the training dataset\n\ntrain.describe().T\n","15533a67":"100*train.isnull().sum()\/len(train)","c354b2de":"train['Pclass'].value_counts()","35f2f167":"train['Sex'].value_counts()","e5b4556a":"train['SibSp'].value_counts()","0aa1e11e":"train['Parch'].value_counts()","64577829":"train['Ticket'].value_counts()","ccb20702":"train['Cabin'].value_counts()","844e72b6":"train['Embarked'].value_counts()","9dd7767e":"#draw a bar plot of survival by sex\n\nsns.barplot(x=\"Sex\", y=\"Survived\", data=train)\n\n#print percentages of females vs. males that survive\n\nprint(\"Percentage of females who survived:\", train[\"Survived\"][train[\"Sex\"] == 'female'].value_counts(normalize = True)[1]*100)\n\nprint(\"Percentage of males who survived:\", train[\"Survived\"][train[\"Sex\"] == 'male'].value_counts(normalize = True)[1]*100)\n","448d38ef":"#draw a bar plot of survival by Pclass\n\nsns.barplot(x=\"Pclass\", y=\"Survived\", data=train)\n\n#print percentage of people by Pclass that survived\n\nprint(\"Percentage of Pclass = 1 who survived:\", train[\"Survived\"][train[\"Pclass\"] == 1].value_counts(normalize = True)[1]*100)\n\nprint(\"Percentage of Pclass = 2 who survived:\", train[\"Survived\"][train[\"Pclass\"] == 2].value_counts(normalize = True)[1]*100)\n\nprint(\"Percentage of Pclass = 3 who survived:\", train[\"Survived\"][train[\"Pclass\"] == 3].value_counts(normalize = True)[1]*100)","d97c07f3":"#draw a bar plot for SibSp vs. survival\n\nsns.barplot(x=\"SibSp\", y=\"Survived\", data=train)\n\n#I won't be printing individual percent values for all of these.\n\nprint(\"Percentage of SibSp = 0 who survived:\", train[\"Survived\"][train[\"SibSp\"] == 0].value_counts(normalize = True)[1]*100)\n\nprint(\"Percentage of SibSp = 1 who survived:\", train[\"Survived\"][train[\"SibSp\"] == 1].value_counts(normalize = True)[1]*100)\n\nprint(\"Percentage of SibSp = 2 who survived:\", train[\"Survived\"][train[\"SibSp\"] == 2].value_counts(normalize = True)[1]*100)\n\nprint(\"Percentage of SibSp = 3 who survived:\", train[\"Survived\"][train[\"SibSp\"] == 3].value_counts(normalize = True)[1]*100)\n\nprint(\"Percentage of SibSp = 4 who survived:\", train[\"Survived\"][train[\"SibSp\"] == 4].value_counts(normalize = True)[1]*100)\n","ecd62ee0":"#draw a bar plot for Parch vs. survival\n\nsns.barplot(x=\"Parch\", y=\"Survived\", data=train)\nplt.show()\n","d35cd258":"\ntrain[\"CabinBool\"] = (train[\"Cabin\"].notnull().astype('int'))\ntest[\"CabinBool\"] = (test[\"Cabin\"].notnull().astype('int'))\n\n#calculate percentages of CabinBool vs. survived\n\nprint(\"Percentage of CabinBool = 1 who survived:\", train[\"Survived\"][train[\"CabinBool\"] == 1].value_counts(normalize = True)[1]*100)\n\nprint(\"Percentage of CabinBool = 0 who survived:\", train[\"Survived\"][train[\"CabinBool\"] == 0].value_counts(normalize = True)[1]*100)\n\n#draw a bar plot of CabinBool vs. survival\n\nsns.barplot(x=\"CabinBool\", y=\"Survived\", data=train)\n\nplt.show()\n","3f427ab4":"test.describe().T","3d5dbd63":"# Create CabinBool variable which states if someone has a Cabin data or not:\n\ntrain = train.drop(['Cabin'], axis = 1)\ntest = test.drop(['Cabin'], axis = 1)\n\ntrain.head()\n","cc7d77fa":"train.isnull().sum()","bfe62410":"test.isnull().sum()","d2d7adea":"print(pd.isnull(train.CabinBool).sum())\n","933c51e4":"# We can drop the Ticket feature since it is unlikely to have useful information\n\ntrain = train.drop(['Ticket'], axis = 1)\ntest = test.drop(['Ticket'], axis = 1)\n\ntrain.head()","ed466a2b":"train.describe().T\n","f5bc4936":"# It looks like there is a problem in Fare max data. Visualize with boxplot.\n\nsns.boxplot(x = train['Fare']);","ea0ba5fe":"Q1 = train['Fare'].quantile(0.05)\nQ3 = train['Fare'].quantile(0.95)\nIQR = Q3 - Q1\n\nlower_limit = Q1- 1.5*IQR\nlower_limit\n\nupper_limit = Q3 + 1.5*IQR\nupper_limit","1e397cf9":"# observations with Fare data higher than the upper limit:\n\ntrain['Fare'] > (upper_limit)","1137ab5d":"train.sort_values(\"Fare\", ascending=False).head()","dd39387e":"# In boxplot, there are too many data higher than upper limit; we can not change all. Just repress the highest value -512- \n\ntrain['Fare'] = train['Fare'].replace(512.3292, 270)","7aec6caa":"train.sort_values(\"Fare\", ascending=False).head()","ce052262":"train.sort_values(\"Fare\", ascending=False)","5a00e93b":"test.sort_values(\"Fare\", ascending=False)","86223cad":"test['Fare'] = test['Fare'].replace(512.3292, 270)","d89d3c2a":"test.sort_values(\"Fare\", ascending=False)","74b80074":"#drop the name feature since it contains no more useful information.\n\ntrain = train.drop(['Name'], axis = 1)\ntest = test.drop(['Name'], axis = 1)","4600b461":"train.describe().T","a450e4ac":"train.isnull().sum()","ea37afd9":"train[\"Age\"] = train[\"Age\"].fillna(train[\"Age\"].median())","c774cb40":"test[\"Age\"] = test[\"Age\"].fillna(test[\"Age\"].median())","210c06a9":"train.isnull().sum()","a85404ac":"test.isnull().sum()","80b682e8":"train.describe().T","2aa061a7":"train.isnull().sum()","2d5b4a4e":"test.isnull().sum()","09132da8":"#now we need to fill in the missing values in the Embarked feature\n\nprint(\"Number of people embarking in Southampton (S):\")\nsouthampton = train[train[\"Embarked\"] == \"S\"].shape[0]\nprint(southampton)\n\nprint(\"Number of people embarking in Cherbourg (C):\")\ncherbourg = train[train[\"Embarked\"] == \"C\"].shape[0]\nprint(cherbourg)\n\nprint(\"Number of people embarking in Queenstown (Q):\")\nqueenstown = train[train[\"Embarked\"] == \"Q\"].shape[0]\nprint(queenstown)\n","60b5eb92":"train[\"Embarked\"].value_counts()","44a5dffd":"#replacing the missing values in the Embarked feature with S\n\ntrain = train.fillna({\"Embarked\": \"S\"})","383a0155":"test = test.fillna({\"Embarked\": \"S\"})","ab8108b3":"train.Embarked","dc525707":"train.isnull().sum()","aa67c72e":"test.isnull().sum()","10d8511f":"print(pd.isnull(train.Embarked).sum())\n","fda3984b":"test[test[\"Fare\"].isnull()]","6ca821a7":"test[[\"Pclass\",\"Fare\"]].groupby(\"Pclass\").mean()","cbb2df79":"test[\"Fare\"] = test[\"Fare\"].fillna(12)","7c2e062a":"test[\"Fare\"].isnull().sum()","fb6b68c2":"#check train data\n\ntrain.head()","1e849fbf":"#check test data\n\ntest.head()","f9d64679":"#map each Sex value to a numerical value\n\nsex_mapping = {\"male\": 0, \"female\": 1}\ntrain['Sex'] = train['Sex'].map(sex_mapping)\ntest['Sex'] = test['Sex'].map(sex_mapping)\n\ntrain.head()","975b0d86":"#map each Embarked value to a numerical value\nfrom sklearn import preprocessing\nlbe = preprocessing.LabelEncoder()\ntrain[\"Embarked\"] = lbe.fit_transform(train[\"Embarked\"])\ntest[\"Embarked\"] = lbe.fit_transform(test[\"Embarked\"])\ntrain.head()\n","a8e0b128":"bins = [0, 5, 12, 18, 24, 35, 60, np.inf]\nmylabels = ['Baby', 'Child', 'Teenager', 'Student', 'Young Adult', 'Adult', 'Senior']\ntrain['AgeGroup'] = pd.cut(train[\"Age\"], bins, labels = mylabels)\ntest['AgeGroup'] = pd.cut(test[\"Age\"], bins, labels = mylabels)","0360670b":"# Map each Age value to a numerical value:\nage_mapping = {'Baby': 1, 'Child': 2, 'Teenager': 3, 'Student': 4, 'Young Adult': 5, 'Adult': 6, 'Senior': 7}\ntrain['AgeGroup'] = train['AgeGroup'].map(age_mapping)\ntest['AgeGroup'] = test['AgeGroup'].map(age_mapping)","c8527806":"train.head()","7565ccf2":"#dropping the Age feature for now, might change:\ntrain = train.drop(['Age'], axis = 1)\ntest = test.drop(['Age'], axis = 1)","33fa83cc":"train.head()","c9a5b85d":"# Map Fare values into groups of numerical values:\ntrain['FareBand'] = pd.qcut(train['Fare'], 4, labels = [1, 2, 3, 4])\ntest['FareBand'] = pd.qcut(test['Fare'], 4, labels = [1, 2, 3, 4])","c6567019":"# Drop Fare values:\ntrain = train.drop(['Fare'], axis = 1)\ntest = test.drop(['Fare'], axis = 1)","8668775a":"train.head()","6db2ce18":"train.head()","5a003091":"train[\"FamilySize\"] = train_data[\"SibSp\"] + train_data[\"Parch\"] + 1","e4cc7054":"test[\"FamilySize\"] = test_data[\"SibSp\"] + test_data[\"Parch\"] + 1","108fa1ad":"# Create new feature of family size:\n\ntrain['Single'] = train['FamilySize'].map(lambda s: 1 if s == 1 else 0)\ntrain['SmallFam'] = train['FamilySize'].map(lambda s: 1 if  s == 2  else 0)\ntrain['MedFam'] = train['FamilySize'].map(lambda s: 1 if 3 <= s <= 4 else 0)\ntrain['LargeFam'] = train['FamilySize'].map(lambda s: 1 if s >= 5 else 0)","5a25db3c":"train.head()","ec860641":"# Create new feature of family size:\n\ntest['Single'] = test['FamilySize'].map(lambda s: 1 if s == 1 else 0)\ntest['SmallFam'] = test['FamilySize'].map(lambda s: 1 if  s == 2  else 0)\ntest['MedFam'] = test['FamilySize'].map(lambda s: 1 if 3 <= s <= 4 else 0)\ntest['LargeFam'] = test['FamilySize'].map(lambda s: 1 if s >= 5 else 0)","2a3a601f":"test.head()\n","2c065617":"# Convert Title and Embarked into dummy variables:\n\ntrain = pd.get_dummies(train, columns = [\"Embarked\"], prefix=\"Em\")","c0a575a4":"train.head()","c127da56":"\ntest = pd.get_dummies(test, columns = [\"Embarked\"], prefix=\"Em\")\n","9cb2176b":"test.head()","8242cf00":"from sklearn.model_selection import train_test_split\nfrom sklearn.metrics import accuracy_score\npredictors = train.drop(['Survived', 'PassengerId'], axis=1)\ntarget = train[\"Survived\"]\nx_train, x_test, y_train, y_test = train_test_split(predictors, target, test_size = 0.20, random_state = 0)\n","385a310e":"x_train.shape","8fd60fe3":"x_test.shape","aa09472f":"from sklearn.linear_model import LogisticRegression\nlogreg = LogisticRegression()\nlogreg.fit(x_train, y_train)\ny_pred = logreg.predict(x_test)\nacc_logreg = round(accuracy_score(y_pred, y_test) * 100, 2)\nprint(acc_logreg)\n","33cb2c23":"from sklearn.ensemble import RandomForestClassifier\nrandomforest = RandomForestClassifier()\nrandomforest.fit(x_train, y_train)\ny_pred = randomforest.predict(x_test)\nacc_randomforest = round(accuracy_score(y_pred, y_test) * 100, 2)\nprint(acc_randomforest)","63b35d9e":"from sklearn.ensemble import GradientBoostingClassifier\ngbk = GradientBoostingClassifier()\ngbk.fit(x_train, y_train)\ny_pred = gbk.predict(x_test)\nacc_gbk = round(accuracy_score(y_pred, y_test) * 100, 2)\nprint(acc_gbk)\n\n","57cba323":"xgb_params = {\n        'n_estimators': [200, 500],\n        'subsample': [0.6, 1.0],\n        'max_depth': [2,5,8],\n        'learning_rate': [0.1,0.01,0.02],\n        \"min_samples_split\": [2,5,10]}\n\nxgb = GradientBoostingClassifier()\n\nxgb_cv_model = GridSearchCV(xgb, xgb_params, cv = 10, n_jobs = -1, verbose = 2)\n\nxgb_cv_model.fit(x_train, y_train)\n\nxgb_cv_model.best_params_\n\nxgb = GradientBoostingClassifier(learning_rate = xgb_cv_model.best_params_[\"learning_rate\"], \n                    max_depth = xgb_cv_model.best_params_[\"max_depth\"],\n                    min_samples_split = xgb_cv_model.best_params_[\"min_samples_split\"],\n                    n_estimators = xgb_cv_model.best_params_[\"n_estimators\"],\n                    subsample = xgb_cv_model.best_params_[\"subsample\"])\nxgb_tuned =  xgb.fit(x_train,y_train)\n\ny_pred = xgb_tuned.predict(x_test)\nacc_gbk = round(accuracy_score(y_pred, y_test) * 100, 2)\nprint(acc_gbk)\n","79a2e00d":"test\n\n#set ids as PassengerId and predict survival \nids = test['PassengerId']\npredictions = xgb_tuned.predict(test.drop('PassengerId', axis=1))\n\n#set the output as a dataframe and convert to csv file named submission.csv\noutput = pd.DataFrame({ 'PassengerId' : ids, 'Survived': predictions })\noutput.to_csv('submission.csv', index=False)\n\noutput.head()\n","24e4106c":"## 1) Import Necessary Libraries\nFirst off, we need to import several Python libraries such as numpy, pandas, matplotlib and seaborn.","0ffc0949":"People with less than four parents or children aboard are more likely to survive than those with four or more.\n\nAgain, people traveling alone are less likely to survive than those with 1-3 parents or children.","0f136ec4":"#### Spliting the train data\n","f2bb7540":"##### Parch Feature","4d9f277c":"## 5) Cleaning Data","323cb924":"We can drop the name feature now that we've extracted the titles.","94955d5c":"##### SibSp Feature","51cb2408":"## 6) Feature Engineering\n","be01e1a8":"\nWe'll fill in the missing values in the Age feature.\n","04013d5e":"#### Gradient Boosting Classifier","24cc09f4":"We can see that except for the above mentioned missing values, not NaN values exist.","bf13ac25":"#### Fare Feature","68cd5047":"## 7) Modeling","121755df":"## 3) Data Analysis\nWe're going to consider the features in the dataset and how complete they are.\n","3f434788":"# 4) Data Visualization\nIt's time to visualize our data so we can see whether our predictions were accurate! \nIn general, barplot is used for categorical variables while histogram, density and boxplot are used for numerical data.\n\n","bb8124dc":"#### Random Forest","9e215ea5":"#### Embarked Feature","3f2143c0":"### Variable Transformation\n","8a547e63":"#### Embarked & Title","1175b710":"#### AgeGroup","b68ec138":"## 2) Loading Data\nIt's time to read in our training and testing data using pd.read_csv, and take a first look at the training data using the describe() function. We will take train and test copies.\n","1df551d5":"Some Observations:\n\nThere are a total of 891 passengers in our training set.\nThe Age feature is missing approximately 19.8% of its values. I'm guessing that the Age feature is pretty important to survival, so we should probably attempt to fill these gaps.\nThe Cabin feature is missing approximately 77.1% of its values. Since so much of the feature is missing, it would be hard to fill in the missing values. We'll probably drop these values from our dataset.\nThe Embarked feature is missing 0.22% of its values, which should be relatively harmless.","43c72fc3":"In general, it's clear that people with more siblings or spouses aboard were less likely to survive.\n\nHowever, contrary to expectations, people with no siblings or spouses were less to likely to survive than those with one or two. (34.5% vs 53.4% vs. 46.4%)\n","80a7a8a4":"#### Name Feature","e99755a5":"##### Family Size","898c98fd":"As predicted, females have a much higher chance of survival than males. The Sex feature is essential in our predictions.","e96c3a79":"#### Ticket Feature","41c5f984":"#### Embarked Feature","ae7be5e0":"# Titanic Survival Prediction:\n\nUse machine learning to create a model that predicts which passengers survived the Titanic shipwreck.\n","2580f3d3":"### Variable Notes:\n\nPclass: A proxy for socio-economic status (SES)\n\n    1st = Upper\n    2nd = Middle\n    3rd = Lower\n\nAge: Age is fractional if less than 1. If the age is estimated, is it in the form of xx.5\n\nSibSp: The dataset defines family relations in this way...\n\n    Sibling = brother, sister, stepbrother, stepsister\n    Spouse = husband, wife (mistresses and fianc\u00e9s were ignored)\n\nParch: The dataset defines family relations in this way...\n\n    Parent = mother, father\n    Child = daughter, son, stepdaughter, stepson Some children travelled only with a nanny, therefore parch=0 for them.\n#### Now  we have an idea of what kinds of features we're working with.\n","e19832b2":"##### Pclass Feature","89c6c58c":"#### Age Feature","125c11de":"### Missing Value Treatment\n","3b71be82":"##### Sex Feature","47431e5b":"### Classes of some categorical variables","a61d2666":"#### Cabin Feature\n","0cb164b9":"#### Logistic Regression","8ea29bdc":"As predicted, people with higher socioeconomic class had a higher rate of survival. (62.9% vs. 47.3% vs. 24.2%)\n","3c9a14f3":"#### Sex Feature","d1db7c92":"I think the idea here is that people with recorded cabin numbers are of higher socioeconomic class, and thus more likely to survive. \n\n","15fc544a":"Time to clean our data to account for missing values and unnecessary information!\n\nLooking at the Test Data\n\nLet's see how our test data looks!\n","7ad1bca8":"People with a recorded Cabin number are, in fact, more likely to survive. (66.6% vs 29.9%)","fb1788ec":"## Deployment","125abcf7":"##### Cabin Feature\n","9cfd92b9":"#### Fare","a6992cf6":"It's time separate the fare values into some logical groups as well as filling in the single missing value in the test dataset.","191257dd":"### Variables and Their Types:\n\nSurvival: Survival -> 0 = No, 1 = Yes\n\nPclass: Ticket class -> 1 = 1st, 2 = 2nd, 3 = 3rd\n\nSex: Sex\n\nAge: Age in years\n\nSibSp: # of siblings \/ spouses aboard the Titanic\n\nParch: # of parents \/ children aboard the Titanic\n\nTicket: Ticket number\n\nFare: Passenger fare\n\nCabin: Cabin number\n\nEmbarked: Port of Embarkation -> C = Cherbourg, Q = Queenstown, S = Southampton\n\n#### Types\n\nNumerical Features: Age , Fare , SibSp , Parch \n\n    Age: float\n    Fare: float\n    SibSp: int\n    Parch: int   \n    \nCategorical Features: Survived, Sex, Embarked, Pclass\n\n    Survived: int\n    Sex: string\n    Embarked: string\n    Pclass: int\n    \nAlphanumeric Features: Ticket, Cabin\n\n    Ticket: string\n    Cabin: string\n"}}