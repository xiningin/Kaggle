{"cell_type":{"e9ad4624":"code","e0aa84ec":"code","36dd849f":"code","c24a903d":"code","0e515c70":"code","2450ab8a":"code","48fe2b59":"code","ca850e98":"code","06999df3":"code","5f0afe1c":"code","4daa7bb8":"code","34d9e2c9":"code","3c4c66ff":"code","9bf08958":"code","bf6d4128":"code","3afe6075":"code","a6613105":"code","41e4273a":"code","b773ded1":"code","28576069":"code","a6a7fc9e":"code","b3cac918":"markdown","6f1191b9":"markdown"},"source":{"e9ad4624":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.tree import plot_tree\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.metrics import accuracy_score\nfrom sklearn.metrics import confusion_matrix\nfrom sklearn.metrics import classification_report\nfrom sklearn.model_selection import GridSearchCV\n!pip install multi_imbalance\nfrom multi_imbalance.resampling.mdo import MDO\npd.set_option(\"display.max_rows\",None)","e0aa84ec":"src = pd.read_csv(\"..\/input\/fish-market\/Fish.csv\")","36dd849f":"src.head()","c24a903d":"src.dtypes","0e515c70":"src.isnull().mean()","2450ab8a":"src.shape","48fe2b59":"src.Species.value_counts()","ca850e98":"src.hist(figsize=(10,10))\nplt.show()","06999df3":"sns.pairplot(src,diag_kind=\"kde\")\nplt.show()","5f0afe1c":"sns.heatmap(src.corr(),annot=True,mask=np.triu(src.corr()))\nplt.show()","4daa7bb8":"X = src.iloc[:,1:].copy()\ny = src.iloc[:,0].copy()\nle = LabelEncoder()\nylab= le.fit_transform(y)\nlabels = pd.DataFrame({\"y\":y,\"ylabel\":ylab})\nlabels.drop_duplicates(inplace=True)\nlabels = labels.sort_values(by=\"ylabel\")\nlabels","34d9e2c9":"X_train, X_test, y_train, y_test = train_test_split(X,ylab,test_size=0.2,random_state=11)\nX_train.shape","3c4c66ff":"pd.Series(y_train).value_counts()","9bf08958":"dtree_model = DecisionTreeClassifier(random_state=11)\ndtree_grid = GridSearchCV(estimator=dtree_model,\n                       param_grid={\"max_leaf_nodes\":list(np.arange(2,50,1)),\n                                  \"criterion\":[\"gini\",\"entropy\"]}\n                                  ,scoring=\"f1_weighted\",cv=5,n_jobs=-1)\nm = dtree_grid.fit(X_train,y_train)\nprint(\"Best Model: \"+str(m.best_estimator_))\nprint(\"Decision Tree CV F1 Score: \"+str(m.best_score_))\nprint(\"Decision Tree Test F1 Score: \"+str(m.score(X_test,y_test)))","bf6d4128":"final_dtree = m.best_estimator_\nfinal_dtree.fit(X_train,y_train)\nplt.figure(figsize=(17,20))\nplot_tree(final_dtree,filled=True,feature_names=list(X.columns))\nplt.show()","3afe6075":"mdo = MDO(k=3, k1_frac=0, seed=0)\nX_train_mdo, y_train_mdo = mdo.fit_resample(X_train, y_train)\npd.Series(y_train_mdo).value_counts()","a6613105":"dtree_model = DecisionTreeClassifier(random_state=11)\ndtree_grid = GridSearchCV(estimator=dtree_model,\n                       param_grid={\"max_leaf_nodes\":list(np.arange(2,50,1)),\n                                  \"criterion\":[\"gini\",\"entropy\"]}\n                                  ,scoring=\"f1_weighted\",cv=5,n_jobs=-1)\nm = dtree_grid.fit(X_train_mdo,y_train_mdo)\nprint(\"Best Model: \"+str(m.best_estimator_))\nprint(\"Decision Tree CV F1 Score: \"+str(m.best_score_))\nprint(\"Decision Tree Test F1 Score: \"+str(m.score(X_test,y_test)))","41e4273a":"final_dtree_mdo = m.best_estimator_\nfinal_dtree_mdo.fit(X_train_mdo,y_train_mdo)\nplt.figure(figsize=(17,20))\nplot_tree(final_dtree_mdo,filled=True,feature_names=list(X.columns))\nplt.show()","b773ded1":"pred = final_dtree_mdo.predict(X_test)","28576069":"fig = plt.figure(figsize=(8,7))\nsns.heatmap(confusion_matrix(y_test,pred,labels=list(labels[\"ylabel\"])),annot=True,xticklabels=labels[\"y\"],yticklabels=labels[\"y\"])\nplt.show()","a6a7fc9e":"print(accuracy_score(y_test,pred))","b3cac918":"Predictions on Imbalanced class can be weird, like the one below","6f1191b9":"Using Mahalanobis Distance Oversampling to handle imbalanced class"}}