{"cell_type":{"410c6851":"code","006af7f3":"code","a65e687e":"code","539da98c":"code","ac8baa64":"code","92098d16":"code","26ef70f0":"code","d252ae5d":"code","5fef2bd2":"code","4f408c02":"code","9aaff938":"code","8c968882":"code","57187136":"code","8ee9cc9d":"code","52d53f57":"code","ce7cc514":"code","3483cc08":"code","a6c7f708":"code","58c455dd":"code","b57c7010":"code","1e497dba":"code","756940ab":"code","de740e3c":"code","8279c06b":"code","38f8d8a1":"code","cc63be91":"code","6638c88c":"code","04c6a2d8":"code","eee71b33":"markdown","58584ce6":"markdown","598241b6":"markdown","330c69ad":"markdown","e0987a1e":"markdown","683e641a":"markdown","a1ad7aa3":"markdown","568e1349":"markdown","77075ad1":"markdown","70eb4db2":"markdown","067c4c95":"markdown","260b7ed0":"markdown","24da316f":"markdown","e41ed29d":"markdown","e5e13ee9":"markdown","000d724a":"markdown","80d3a8ef":"markdown","fe129f35":"markdown"},"source":{"410c6851":"import pandas as pd\nimport numpy as np\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nplt.rcParams[\"figure.figsize\"] = (10, 8)","006af7f3":"book = pd.read_parquet('..\/input\/optiver-realized-volatility-prediction\/book_train.parquet\/stock_id=0')\ntrade =  pd.read_parquet('..\/input\/optiver-realized-volatility-prediction\/trade_train.parquet\/stock_id=0')","a65e687e":"book = book.set_index('time_id')\ntrade = trade.set_index('time_id')","539da98c":"book.head()","ac8baa64":"trade.head()","92098d16":"book","26ef70f0":"def log_return(list_stock_prices):\n    return np.log(list_stock_prices).diff() \n\ndef realized_volatility(series_log_return):\n    return np.sqrt(np.sum(series_log_return**2))\n\n# More to come...\ndef calc_stats(df):\n    df['size_spread_l1'] = df['ask_size1'] - df['bid_size1']\n    df['size_spread_l2'] = df['ask_size2'] - df['bid_size2']\n    \n    df['price_spread_l1'] = df['ask_price1'] - df['bid_price1']\n    df['price_spread_l2'] = df['ask_price2'] - df['bid_price2']\n    \n    df['wap'] = (df['bid_price1'] * df['ask_size1'] + df['ask_price1'] * df['bid_size1']) \/ (df['bid_size1']+ df['ask_size1'])\n    \n    df.loc[:,'log_return'] = log_return(df['wap'])\n    df = df[~df['log_return'].isnull()]\n    \n    # This is wrong\n    df['realized_vol'] = realized_volatility(df['log_return'])\n    \n    return df","d252ae5d":"book = calc_stats(book)","5fef2bd2":"book","4f408c02":"book.describe()","9aaff938":"plt.plot(book['size_spread_l1'])\nplt.title('Layer 1 Size Spread on Stock 0')\nplt.xlabel('Time ID')\nplt.ylabel('Spread')\nplt.show()","8c968882":"plt.hist(book['size_spread_l1'], bins='auto')\nplt.title('Layer 1 Size Spread on Stock 0 Distribution')\nplt.yscale('log')\nplt.xlabel('Time ID')\nplt.ylabel('Spread')\nplt.show()","57187136":"plt.hist(book['size_spread_l1'], bins='auto')\nplt.title('Layer 1 Size Spread on Stock 0 Distribution')\nplt.xlabel('Time ID')\nplt.ylabel('Spread')\nplt.show()","8ee9cc9d":"book['size_spread_l1'].describe()","52d53f57":"plt.plot(book['size_spread_l2'])\nplt.title('Layer 2 Size Spread on Stock 0')\nplt.xlabel('Time ID')\nplt.ylabel('Spread')\nplt.show()","ce7cc514":"plt.hist(book['size_spread_l2'], bins='auto')\nplt.title('Layer 2 Size Spread on Stock 0 Distribution')\nplt.yscale('log')\nplt.xlabel('Time ID')\nplt.ylabel('Spread')\nplt.show()","3483cc08":"plt.hist(book['size_spread_l2'], bins='auto')\nplt.title('Layer 2 Size Spread on Stock 0 Distribution')\nplt.xlabel('Time ID')\nplt.ylabel('Spread')\nplt.show()","a6c7f708":"book['size_spread_l2'].describe()","58c455dd":"book.head()","b57c7010":"plt.plot(book['bid_price1'], c='b', label='Bid Price')\nplt.plot(book['ask_price1'], c='r', label='Ask Price', alpha=0.7)\nplt.title('Best Bid\/Ask Prices')\nplt.xlabel('Time ID')\nplt.ylabel('Price')\nplt.legend()\nplt.show()","1e497dba":"plt.plot(book[:100000]['bid_price1'], c='b', label='Bid Price')\nplt.plot(book[:100000]['ask_price1'], c='r', label='Ask Price', alpha=0.7)\nplt.title('Best Bid\/Ask Prices')\nplt.xlabel('Time ID')\nplt.ylabel('Price')\nplt.legend()\nplt.show()","756940ab":"plt.plot(book['bid_price2'], c='b', label='Bid Price')\nplt.plot(book['ask_price2'], c='r', label='Ask Price', alpha=0.7)\nplt.title('L2 Bid\/Ask Prices')\nplt.xlabel('Time ID')\nplt.ylabel('Price')\nplt.legend()\nplt.show()","de740e3c":"plt.plot(book[:100000]['bid_price2'], c='b', label='Bid Price')\nplt.plot(book[:100000]['ask_price2'], c='r', label='Ask Price', alpha=0.7)\nplt.title('L2 Bid\/Ask Prices')\nplt.xlabel('Time ID')\nplt.ylabel('Price')\nplt.legend()\nplt.show()","8279c06b":"plt.hist(book['bid_price1'], bins='auto', label='Best Bids')\nplt.hist(book['bid_price2'], bins='auto', label='L2 Bids', alpha=0.7)\nplt.title('Bids on Stock 0 Distribution')\nplt.xlabel('Time ID')\nplt.ylabel('Bid Value')\nplt.legend()\nplt.show()","38f8d8a1":"plt.hist(book['bid_price1'], bins='auto', label='Best Bids')\nplt.hist(book['bid_price2'], bins='auto', label='L2 Bids', alpha=0.7)\nplt.title('Bids on Stock 0 Distribution')\nplt.xlabel('Time ID')\nplt.ylabel('Bid Value')\nplt.yscale('log')\nplt.legend()\nplt.show()","cc63be91":"plt.hist(book['ask_price1'], bins='auto', label='Best Ask')\nplt.hist(book['ask_price2'], bins='auto', label='L2 Ask', alpha=0.7)\nplt.title('Asks on Stock 0 Distribution')\nplt.xlabel('Time ID')\nplt.ylabel('Ask Value')\nplt.legend()\nplt.show()","6638c88c":"plt.hist(book['ask_price1'], bins='auto', label='Best Ask')\nplt.hist(book['ask_price2'], bins='auto', label='L2 Ask', alpha=0.7)\nplt.title('Asks on Stock 0 Distribution')\nplt.xlabel('Time ID')\nplt.ylabel('Ask Value')\nplt.yscale('log')\nplt.legend()\nplt.show()","04c6a2d8":"plt.plot(book['log_return'], label='Log Returns')\nplt.title('Log Returns on Stock 0')\nplt.xlabel('Time ID')\nplt.ylabel('Returns')\nplt.legend()\nplt.show()","eee71b33":"# Size Spread Plots","58584ce6":"From the plot below we can see that the ask is consistently higher than the bid which makes perfect sense considering market dynamics (sellers always want more than you can buy for!)","598241b6":"From the plot below we can see that the spread on the size offered widens significantly at certain periods, this is most likely due to market volatility which causes a sudden bout of illiquidity as market participants try and all dump at once - we can also seperate most markets into two regimes which is something I have done on my website [here](https:\/\/www.munum-butt.tech\/blog-posts\/gold-volatility-modelling-using-hidden-markov-models-hmms\/)","330c69ad":"# EDA On the Orderbook\n\nThis competition is really exciting to me because I am actually writing a research paper on Ethereum Orderbook modelling (although that is on the forwards spread rather than vol) currently and so thought I would share some of the techniques I have picked up with the amazing kaggle community!\n\nI am eventually going to build models based of this EDA but feel free to beat me to it because i can tell this competition will definitley be the hardest thing I have attempted in a long time\n\n<div class=\"alert alert-info\">\n  <strong>This notebook is indeed a work in progress so please check back later ;)<\/strong>\n<\/div>","e0987a1e":"You can see that the second layer is more volatile, as you would expect for a slightly worse quote. These are likely larger players.","683e641a":"# Price Spread Plots","a1ad7aa3":"# Import Libraries","568e1349":"I eventually hope to automate it for everything and build an automated PDF!","77075ad1":"This is most definitely not normally distributed! Something like a Cauchy or Exponential may work far better - do not let the log scale fool you","70eb4db2":"# Returns Analysis","067c4c95":"# Realised Volatility Analysis","260b7ed0":"It is subtle, but you can see the ask is a touch higher regularly implying again that these are worse quotes","24da316f":"# Select Single Stock For EDA ","e41ed29d":"Notice how you get clusters of peaks? Why is explained [here](https:\/\/www.kaggle.com\/c\/jane-street-market-prediction\/discussion\/227793#1248042)","e5e13ee9":"# Calculate Orderbook Statistics","000d724a":"Again it is very clear that neither of the bids offered are from a normal distribution!\n\n**Proceeds to throw out 90% of markets research which has that BS assumption**","80d3a8ef":"<div class=\"alert alert-info\">\n  <strong>This notebook is indeed a work in progress so please check back later ;):<\/strong>\n<\/div>","fe129f35":"Volatility is an immensly rich subject...where most of the research is utter rubbish.\n\nFor those who really want to blow their minds (and have a major advantage in this competition) have a look at 'Rough Volatility'..."}}