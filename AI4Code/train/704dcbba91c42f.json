{"cell_type":{"31bcade4":"code","707f231a":"code","77ac88e0":"code","7d1da6b7":"code","7a6f9e5a":"code","fbce04a9":"code","71cb88b3":"code","1515a6a7":"code","424b4576":"code","18f9ec75":"code","34cebfda":"code","49647d4b":"code","f431b6cd":"code","2283f434":"code","f69e1ff0":"code","022b4f9a":"code","ad68cfd2":"code","e7e7bab5":"code","81bd4998":"code","6cc7b7be":"code","190104ac":"code","44fd9556":"code","324e9e9d":"code","46b5e506":"code","85c2ebde":"markdown","bc3e6a51":"markdown","e065cf31":"markdown","fec28948":"markdown","f5bc3ec2":"markdown","2633045c":"markdown","f6ed28fc":"markdown"},"source":{"31bcade4":"import gc, os, sys, time\nimport pandas as pd, numpy as np\nimport matplotlib.pyplot as plt\nfrom IPython.display import HTML, display\n\nIN_DIR = os.path.join('..', 'input', 'meta-kaggle')\n\ncomps = pd.read_csv(os.path.join(IN_DIR, 'Competitions.csv'))\ncomps['DeadlineDate'] = pd.to_datetime(comps.DeadlineDate)\ncomps['EnabledDate'] = pd.to_datetime(comps.EnabledDate)\ncomps['Days'] = (comps.DeadlineDate - comps.EnabledDate) \/ pd.Timedelta(1, 'd')\ncomps['FinalWeek'] = (comps.DeadlineDate - pd.Timedelta(1, 'w'))\ncomps.shape","707f231a":"pd.read_csv(os.path.join(IN_DIR, 'Teams.csv'), nrows=4).columns","77ac88e0":"teams = pd.read_csv(os.path.join(IN_DIR, 'Teams.csv'), usecols=['Id', 'CompetitionId'])\nteams.shape","7d1da6b7":"pd.read_csv(os.path.join(IN_DIR, 'Submissions.csv'), nrows=4).columns","7a6f9e5a":"subs = pd.read_csv(os.path.join(IN_DIR, 'Submissions.csv'), usecols=['Id', 'TeamId', 'SubmissionDate', 'ScoreDate', 'IsAfterDeadline'])\nsubs.shape","fbce04a9":"subs['SubmissionDate'] = pd.to_datetime(subs.SubmissionDate)","71cb88b3":"subs['CompetitionId'] = subs.TeamId.map(teams.set_index('Id').CompetitionId)","1515a6a7":"subs['DeadlineDate'] = subs.CompetitionId.map(comps.set_index('Id').DeadlineDate)","424b4576":"subs['DeadlineDiff'] = (subs['SubmissionDate'] - subs['DeadlineDate']) \/ pd.Timedelta(1, 'd')","18f9ec75":"subs.count()","34cebfda":"comp = comps[comps.Slug.str.startswith('mercedes')].squeeze()\ncomp_id = comp.Id","49647d4b":"merc = subs.query(f'CompetitionId=={comp_id}')\nmerc.shape","f431b6cd":"merc.groupby('IsAfterDeadline').size()","2283f434":"merc.groupby('IsAfterDeadline').SubmissionDate.agg(['min','max'])","f69e1ff0":"merc.groupby(['SubmissionDate', 'IsAfterDeadline']).size().unstack().head(55)","022b4f9a":"plt.rc(\"figure\", figsize=(12, 10))\nplt.rc(\"font\", size=12)","ad68cfd2":"def colors(df):\n    return np.where(df['IsAfterDeadline'], 'red', 'blue')","e7e7bab5":"merc.plot.scatter('SubmissionDate', 'TeamId', c=colors(merc), alpha=.1, title=comp.Title);","81bd4998":"m1 = merc.query('DeadlineDiff<=21')\nm1.plot.scatter('SubmissionDate', 'TeamId', c=colors(m1), alpha=.1, title=comp.Title);","6cc7b7be":"m1 = merc.query('DeadlineDiff<=21')\nm1.plot.scatter('Id', 'TeamId', c=colors(m1), alpha=.1, title=comp.Title);","190104ac":"comps = comps.set_index('Id')","44fd9556":"comps.nlargest(20, 'TotalTeams')[['Slug', 'Title', 'DeadlineDate', 'TotalTeams']]","324e9e9d":"THRES = 3000","46b5e506":"for comp_id, subset in subs.groupby('CompetitionId'):\n    if comp_id not in comps.index: # KeyError: 23099 for \"SIIM-ISIC Melanoma Classification\" ?\n        continue\n    comp = comps.loc[comp_id]\n    if comp.TotalTeams < THRES:\n        continue\n    window = subset.query('DeadlineDiff<=21')\n    \n    markup = (\n        '<h1 id=\"{Slug}\">{Title}<\/h1>'\n        '<p>'\n        'Type: {HostSegmentTitle} &mdash; <i>{Subtitle}<\/i>'\n        '<br\/>'\n        '<a href=\"https:\/\/www.kaggle.com\/c\/{Slug}\/leaderboard\">Leaderboard<\/a>'\n        '<br\/>'\n        'Dates: <b>{EnabledDate}<\/b> &mdash; <b>{DeadlineDate}<\/b>'\n        '<br\/>'\n        '<b>{TotalTeams}<\/b> teams; <b>{TotalCompetitors}<\/b> competitors; '\n        '<b>{TotalSubmissions}<\/b> submissions'\n        '<br\/>').format(**comp)\n\n    display(HTML(markup))\n    window.plot.scatter('SubmissionDate', 'TeamId', c=colors(window), alpha=.1, title=comp.Title)\n    plt.show()","85c2ebde":"### Problem:\n\nSubmissions only have a date, not a time. Working out exactly which submissions are post-deadline is not possible which is presumably why there is a handy `IsAfterDeadline` in the Submissions table. `IsAfterDeadline` looks to be correct *after* the given deadline date (in Competitions table) but it is incorrectly(?) set to true for some early submissions.\n\nPerhaps another explanation is that `IsAfterDeadline` is correct but the submission dates are wrong?\n\nEither way, hope this helps find the issue...","bc3e6a51":"positive values mean after deadline","e065cf31":"# Large Competitions","fec28948":"# Zoom In","f5bc3ec2":"submission Id is similar to time but shows same effect","2633045c":"# Plot\n\nPlot submissions by teams over time - normal submissions in blue, post-deadline in red.","f6ed28fc":"# Mercedes"}}