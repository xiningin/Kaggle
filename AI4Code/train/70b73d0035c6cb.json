{"cell_type":{"15f12c21":"code","de3f63ff":"code","c634a800":"code","ef6e9f29":"code","875d3cca":"code","33708009":"code","b708df5e":"code","fc42e77a":"code","72dfb3a3":"code","cea6c781":"code","05495ec1":"code","924ae0ec":"code","ae72429a":"code","0da43ed0":"code","c4cd5433":"code","ac82939d":"code","3cabb6c3":"code","3bb5c314":"code","cae60f77":"code","47116154":"markdown","6b818a21":"markdown","a6ac9d18":"markdown","05058beb":"markdown","0c39e991":"markdown","783d81ab":"markdown","72de7219":"markdown","af55d734":"markdown","502a92ce":"markdown","8f3a1caf":"markdown","ea682bb1":"markdown","04e5d514":"markdown","c7cb0479":"markdown","43ad9861":"markdown","1fe3c739":"markdown","eaa97e02":"markdown","3a9b4b52":"markdown","27c8801e":"markdown","b0ab9521":"markdown","d592484e":"markdown","884dd282":"markdown","873bffcd":"markdown","4d7f9e5d":"markdown","67627933":"markdown","372bd94a":"markdown","fe652580":"markdown","bc81b881":"markdown","6b08c0e4":"markdown","807f2de7":"markdown","867a6306":"markdown","01263065":"markdown","c614e06b":"markdown","f67ff252":"markdown"},"source":{"15f12c21":"import requests\nimport os\nimport pandas as pd\nimport seaborn as sns\nimport numpy as np\nimport folium\nfrom random import randint\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.cluster import DBSCAN\nimport matplotlib.pyplot as plt\n%matplotlib inline","de3f63ff":"BOURNEMOUTH = (50.721680, -1.878530)\nZOOM = 15\n\nCOL_LAT = 'Latitude'\nCOL_LNG = 'Longitude'\nCOL_VENUE_NAME = 'Venue Name'\nCOL_VENUE_LAT = 'Venue Latitude'\nCOL_VENUE_LNG = 'Venue Longitude'\nCOL_VENUE_CAT = 'Venue Category'\nCOL_VENUE_GRP = 'Venue Group'\nCOL_VENUE_CLS = 'Venue Cluster'\n\nDRINK = 'Drink'\nENTERTAINMENT = 'Entertainment'\nFOOD = 'Food'\nHOTEL = 'Hotel'\nSHOPPING = 'Shopping'\nTRANSPORT = 'Transport'","c634a800":"path_data = os.path.join('..', 'input', 'bournemouth_venues.csv')\n\ndf = pd.read_csv(path_data)\n\nprint(df.shape)\ndf.head()","ef6e9f29":"def generate_map(df, lat, lng, zoom, col_lat, col_lng,\n                 col_popup=None, popup_colors=False, def_color='red',\n                 tiles='cartodbpositron'):\n    folmap = folium.Map(location=[lat, lng], zoom_start=zoom, tiles=tiles)\n    \n    popup = list(df[col_popup].unique())\n    \n    if popup_colors:\n        colors = make_color_palette(len(popup))\n    \n    for index, row in df.iterrows():\n        folium.CircleMarker(\n            location=(row[col_lat], row[col_lng]),\n            radius=6,\n            popup=row[col_popup] if col_popup is not None else '',\n            fill=True,\n            color=colors[popup.index(row[col_popup])] if popup_colors else def_color,\n            fill_opacity=0.6\n            ).add_to(folmap)\n    \n    return folmap","875d3cca":"def make_color_palette(size, n_min=50, n_max=205):\n    r = lambda: hex(randint(0, 255))[2:]\n    colors = []\n    \n    while len(colors) < size:\n        c = '#{}{}{}'.format(r(), r(), r())\n        \n        if c not in colors:\n            colors.append(c)\n    \n    return colors","33708009":"generate_map(df, BOURNEMOUTH[0], BOURNEMOUTH[1], ZOOM, COL_VENUE_LAT, COL_VENUE_LNG, col_popup=COL_VENUE_NAME)","b708df5e":"venue_cat = df[COL_VENUE_CAT].unique()\nvenue_cat.sort()\n\nprint('Venue count:', len(venue_cat))\nvenue_cat","fc42e77a":"def change_group(df, grp_from_list, grp_to):\n    for grp_from in grp_from_list:\n        df.loc[df[COL_VENUE_GRP] == grp_from, COL_VENUE_GRP] = grp_to","72dfb3a3":"# Quickly set venue groups to the last word in each venue category\ndf[COL_VENUE_GRP] = df[COL_VENUE_CAT].str.split(' ').str[-1]\n\n# Remove the train station platform venue because we already have the nearby train station as a venue\ndf = df[df[COL_VENUE_GRP] != 'Platform']\n\n# Change the crude, last-word groups into more high-level groups\nchange_group(df,\n             ['Bar', 'Brewery', 'Nightclub', 'Pub'],\n             DRINK)\n\nchange_group(df,\n             ['Aquarium', 'Beach', 'Center', 'Garden', 'Gym', 'Lookout',\n              'Multiplex', 'Museum', 'Outdoors', 'Park', 'Theater'],\n             ENTERTAINMENT)\n\nchange_group(df,\n             ['Caf\u00e9', 'Diner', 'House', 'Joint', 'Place', 'Restaurant'],\n             FOOD)\n\nchange_group(df,\n             ['Plaza', 'Shop', 'Store'],\n             SHOPPING)\n\nchange_group(df,\n             ['Station', 'Stop'],\n             TRANSPORT)\n\nvenue_grp = df[COL_VENUE_GRP].unique()\nvenue_grp.sort()\n\nprint('Group count:', len(venue_grp))\nvenue_grp","cea6c781":"generate_map(df, BOURNEMOUTH[0], BOURNEMOUTH[1], ZOOM, COL_VENUE_LAT, COL_VENUE_LNG, col_popup=COL_VENUE_GRP, popup_colors=True)","05495ec1":"df_latlng = df[[COL_VENUE_LAT, COL_VENUE_LNG]]\ndf_latlng.head()","924ae0ec":"latlng = StandardScaler().fit_transform(np.nan_to_num(df_latlng))\nlatlng[:5]","ae72429a":"dbscan = DBSCAN(eps=0.2, min_samples=3)\ndbscan.fit(latlng)\n\nprint('labels:', np.unique(dbscan.labels_))","0da43ed0":"df[COL_VENUE_CLS] = dbscan.labels_\ndf.head()","c4cd5433":"generate_map(df, BOURNEMOUTH[0], BOURNEMOUTH[1], ZOOM, COL_VENUE_LAT, COL_VENUE_LNG, col_popup=COL_VENUE_CLS, popup_colors=True)","ac82939d":"df[COL_VENUE_CLS].plot(kind='hist')","3cabb6c3":"df_0 = df.loc[df[COL_VENUE_CLS] == 0]\ndf_2 = df.loc[df[COL_VENUE_CLS] == 2]\n\nprint('df_0:', df_0.shape)\nprint('df_2:', df_2.shape)","3bb5c314":"df_0[COL_VENUE_GRP].value_counts().plot(kind='barh', title='df_0: {} venues'.format(df_0.shape[0]))","cae60f77":"df_2[COL_VENUE_GRP].value_counts().plot(kind='barh', title='df_2: {} venues'.format(df_2.shape[0]))","47116154":"This is quite a lot!\nLet's put these categories into six high-level groups:\n`Drink`, `Entertainment`, `Food`, `Hotel`, `Shopping`, and `Transport`.\nWe will use `change_group` to help change many groups into a single group.","6b818a21":"Now, we train a DBSCAN model, called `dbscan`, which generates `8` labels, as well as the outlier label `-1`.","a6ac9d18":"Let's also define the constants we will use in this notebook.","05058beb":"This function uses `make_color_palette` to help product random colours for different categories.","0c39e991":"There are **10,500** Fish & Chips shops in the UK, with an annual spend of **\u00a31.2 billion** on fish and chips ([source](https:\/\/www.nfff.co.uk\/pages\/fish-and-chips)).\n[Bournemouth](https:\/\/www.bournemouth.co.uk) was ranked as the number one most popular seaside resort of 2019\nin the UK ([source](https:\/\/www.independent.co.uk\/travel\/news-and-advice\/uk-seaside-towns-beach-best-heatwave-summer-staycation-british-a8978111.html)).\nWe want to open a new Fish & Chips shop in **Bournemouth** to capitalise on its popularity with a food shop that is likely to be popular with the locals.\n\nThere are some considerations that we need to make when choosing where to open our new shop.\nWe want it to be in an area of the town where people would want to eat this kind of food.\nThat is, in an area that has lots of activities, such as drinking, shopping, and entertainment venues.\nPreferably, such an area would have few existing food venues, so that competition is as low as possible.","783d81ab":"Now, we will import our Bournemouth venue data that we had previously requested from the Foursquare API on `June 30 2019`, which was downloaded with the following specification:\n\n* We used the Foursquare API version no later than `June 30 2019`.\n* We used a latitude of `50.721680` and longitude of `-1.878530` to point to Bournemouth.\n* We wanted venues up to `1.5km` around Bournemouth.\n* We limited our results to `100` venues.\n\nWe store these data in a dataframe called `df` and show its shape, as well as the first five rows.","72de7219":"We see that, of the two clusters, cluster `0` has fewer `Food` venues, which is desirable, but is only marginally lower than the `Food` venues in `2`.\nHowever, cluster `2` has a more non-`Food` venues than `0`, which is more preferable.\nAreas with many places to `Drink` are a hotspot for Fish & Chips food after a night of drinking, and people who do `Shopping` in the day time might like to eat Fish & Chips for lunch or dinner.","af55d734":"Now, we map the venues again, but color code them by the cluster value to which they've been assigned.","502a92ce":"# Conclusion","8f3a1caf":"Let's check which clusters are the most densely populated.","ea682bb1":"We will use these groups to understand how venues are dispersed by business type.\nThen, we will use [DBSCAN](https:\/\/scikit-learn.org\/stable\/modules\/generated\/sklearn.cluster.DBSCAN.html), an unsupervised data clustering algorithm, to cluster venues based on their relative distance from each other.\nThis information will help us to determine where to open up our own Fish & Chips shop based upon existing venue density and business type.","04e5d514":"## Density-Based Clustering","c7cb0479":"## Cluster Analysis","43ad9861":"In this notebook, we consider how someone can analyse the existing venues in a seaside town in the UK in order to decide on the best place in which to open a new Fish & Chips shop.","1fe3c739":"# Data","eaa97e02":"We have identified the two largest venue clusters in Bournemouth.\nNow, we want to analyse the venue distribution within each cluster, to help us reason about which cluster we should open our own Fish & Chips shop in.\nWe create two bar charts showing venue frequency per clusters `0` and `2`.","3a9b4b52":"In conclusion, we would want to open our Fish & Chips shop in **cluster 2**, given that it is densely popular with venues that are not `Food` related, despite having slightly more `Food` venues than cluster `0`.","27c8801e":"Now we graph venues based upon their new group instead.\nWe see that `Entertainment` venus are closer to the beach, and most `Food` and `Drink` cluster in the center of town, along with all of the `Shopping` venues.\n`Hotel` venues are dispersed across town, and `Transport` is the furthest out of town.","b0ab9521":"# Introduction","d592484e":"We will normalise these data using a [StandardScaler](https:\/\/scikit-learn.org\/stable\/modules\/generated\/sklearn.preprocessing.StandardScaler.html), so that DBSCAN can interpret these data without losing relative distances between venues.","884dd282":"We plot all `100` venues as follows.\nClicking on the markers will show the name of the venue.","873bffcd":"How many different types of venue category have been returned?","4d7f9e5d":"To begin, let's import our dependent modules.","67627933":"To tackle this problem, we need to understand what venues are already in Bournemouth, so that we can analyse them and decide on the best area in which to open our own shop.\nWe will use the [venue explore API](https:\/\/developer.foursquare.com\/docs\/api\/venues\/explore) by Foursquare to gain insight into the existing venues in Bournemouth.\nWe will then categorize these venues into six high-level groups: `Drink`, `Entertainment`, `Food`, `Hotel`, `Shopping`, and `Transport`.","372bd94a":"# Methodology","fe652580":"Let's now perform a density-based clustering to locate areas of high venue density.\nWe will use the **DBSCAN** data clustering algorithm for this task.\nFirstly, we need to convert the **latitude** and **longitude** of each venue into a format that is more appropriate for DBSCAN to process.\nWe extract the latitude and longitude, as follows.","bc81b881":"# Business Problem","6b08c0e4":"We add the labels to the data frame as `Venue Cluster`.","807f2de7":"This project was in fulfilment of the [Applied Data Science Capstone](https:\/\/www.coursera.org\/learn\/applied-data-science-capstone) course offered by IBM and hosted on Coursera.\nThe task was to think of an idea that leveraged [Foursquare](https:\/\/foursquare.com) location data to explore or\ncompare neighborhoods or cities.","867a6306":"We see that, outside of the outlier class `-1`, the two most densely populated clusters are `0` and `2`, which are both in the center of town.\nLet's put these into their own separate data frames.","01263065":"Let's quickly visualise the venues in Bournemouth.\nWe use `generate_map` to visualise venue information.","c614e06b":"## Venue Groups","f67ff252":"## Which Cluster?"}}