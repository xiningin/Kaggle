{"cell_type":{"19c586a9":"code","033433e5":"code","85392135":"code","348368db":"code","e77c6f89":"code","4ff92afe":"code","e550215a":"code","1bb81166":"code","511759b9":"code","146ccc9e":"code","c66dae5d":"code","bf093ccf":"code","3a3fb2fd":"code","8a6e2585":"code","dfd1149b":"code","8bbb2ba5":"code","2b78a866":"code","5a02ff2e":"code","aa5d17bf":"code","d0466602":"code","b7e32fe2":"code","c51ac159":"code","0c7a184b":"code","1efa7a2f":"markdown","f184856e":"markdown","385be105":"markdown"},"source":{"19c586a9":"!ls -ald \/kaggle\/input\/*","033433e5":"# !pip install -qqq --no-cache-dir torch==1.7.1+cu101 torchvision==0.8.2+cu101 torchtext==0.8.0 -f https:\/\/download.pytorch.org\/whl\/torch_stable.html","85392135":"# !pip install -U fastcore --upgrade\n!pip install -U ..\/input\/fastcore1319py3wheel\/fastcore-1.3.19-py3-none-any.whl","348368db":"# !pip install -U fastai --upgrade\n!pip install -U ..\/input\/fastai227py3wheel\/fastai-2.2.7-py3-none-any.whl","e77c6f89":"!pip install -U ..\/input\/fastai-xla-extensions0011py3wheel\/fastai_xla_extensions-0.0.11-py3-none-any.whl\n# !pip install -Uqq fastai_xla_extensions\n# !pip install -Uqq git+https:\/\/github.com\/butchland\/fastai_xla_extensions.git","4ff92afe":"# !pip install -U cloud-tpu-client==0.10 https:\/\/storage.googleapis.com\/tpu-pytorch\/wheels\/torch_xla-1.7-cp37-cp37m-linux_x86_64.whl\n!pip install -U ..\/input\/torchxla17wheel\/torch_xla-1.7-cp37-cp37m-linux_x86_64.whl","e550215a":"# !curl -s https:\/\/course19.fast.ai\/setup\/colab | bash","1bb81166":"!pip freeze | grep torch\n!pip freeze | grep fast","511759b9":"from fastai.vision.all import *\nfrom fastai_xla_extensions.all import *","146ccc9e":"# path = untar_data(URLs.MNIST_TINY)\n# path = untar_data(URLs.MNIST); Path.BASE_PATH = path; path.ls()\n# path = untar_data(URLs.PETS)\/'images'; Path.BASE_PATH = path; path.ls()","c66dae5d":"path = Path('..\/input\/the-oxfordiiit-pet-dataset')\/'images'\nPath.BASE_PATH = path\npath.ls()","bf093ccf":"bs = 64\narch = resnet34","3a3fb2fd":"pat = r'(.+)_\\d+.jpg'\ndata = DataBlock(\n    blocks=(ImageBlock,CategoryBlock),\n    get_items=get_image_files,\n    get_y=using_attr(RegexLabeller(pat),'name'),\n    splitter=RandomSplitter(seed=42),\n    item_tfms=Resize(112),\n    batch_tfms=[Normalize.from_stats(*imagenet_stats)]\n)","8a6e2585":"dls = data.dataloaders(path, bs=bs)","dfd1149b":"!mkdir -p \/root\/.cache\/torch\/hub\/checkpoints\n!cp ..\/input\/resnet34\/resnet34.pth \/root\/.cache\/torch\/hub\/checkpoints\/resnet34-333f7ec4.pth","8bbb2ba5":"learner = cnn_learner(dls, arch, metrics=accuracy, concat_pool=False)","2b78a866":"%%time\nlearner.xla_fit(5, lr=4e-3)","5a02ff2e":"learner.validate()","aa5d17bf":"data2 = data.new(item_tfms=Resize(224), batch_tfms=[Normalize.from_stats(*imagenet_stats)])","d0466602":"dls2 = data2.dataloaders(path, bs=64)","b7e32fe2":"learner.dls = dls2 # replace with size 224 sized","c51ac159":"learner.xla_fit(5, lr=6e-3)","0c7a184b":"learner.save('stage-2-pet-956acc')","1efa7a2f":"<a href=\"https:\/\/colab.research.google.com\/github\/butchland\/fastai_xla_extensions\/blob\/master\/samples\/test_fast_tpu_pets.ipynb\" target=\"_parent\"><img src=\"https:\/\/colab.research.google.com\/assets\/colab-badge.svg\" alt=\"Open In Colab\"\/><\/a>","f184856e":"Start of kernel restart","385be105":"# Pets Sample (Multi Core TPU Sample)"}}