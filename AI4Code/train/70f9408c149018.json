{"cell_type":{"91ae48c9":"code","617a3e0f":"code","02eb5729":"code","16d36b27":"code","9a80c0a0":"code","e039ccad":"code","73f4cf75":"code","cf382b07":"code","e96cc421":"code","42767971":"code","fe26e320":"code","5cba3e1d":"code","c70203ce":"code","dff82924":"code","8287acdc":"code","d4d105c0":"code","f25c4c86":"code","4a4a0d2b":"code","b3a26c7a":"code","bc7f4528":"markdown","38108275":"markdown","b1dd17f7":"markdown","f20b064b":"markdown","eb288e53":"markdown","cd63e0bc":"markdown","09232605":"markdown","e228bd0c":"markdown","c7694c81":"markdown","8dc227d8":"markdown","85c87bf7":"markdown","6ed2ebb5":"markdown"},"source":{"91ae48c9":"import pandas as pd\nimport numpy as np\nhitters=pd.read_csv(\"..\/input\/hittlers\/Hitters.csv\")\ndf=hitters.copy()\ndf.columns\n","617a3e0f":"df.head(2)","02eb5729":"df.info()","16d36b27":"df.shape","9a80c0a0":"import pandas as pd\nimport numpy as np\ndf=df.dropna()\ndf.shape","e039ccad":"dms=pd.get_dummies(df[['League', 'Division', 'NewLeague']])  \ndms.head(2)","73f4cf75":"x=df.drop([\"Salary\",'League', 'Division', 'NewLeague'], axis=1).astype(\"float64\")\nx.head(2)\n","cf382b07":"X = pd.concat([x, dms[['League_N', 'Division_W', 'NewLeague_N']]], axis=1)\nX.head(2)","e96cc421":"y=df[\"Salary\"]","42767971":"from sklearn.model_selection import train_test_split\nX_train,X_test,y_train, y_test= train_test_split(X,y,test_size=0.25, random_state=42)","fe26e320":"\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.neighbors import KNeighborsRegressor\n\nknn=KNeighborsRegressor()\nk_params={\"n_neighbors\":np.arange(1,30,1)}\n\n\nknncv=GridSearchCV(knn,k_params, cv=10)\nknncv.fit(X_train, y_train)\n","5cba3e1d":"knncv.best_params_[\"n_neighbors\"]   #the best k for this dataset","c70203ce":"from sklearn.metrics import mean_squared_error, r2_score \nknn_tune=KNeighborsRegressor(n_neighbors = knncv.best_params_[\"n_neighbors\"]).fit(X_train, y_train)\nnp.sqrt(mean_squared_error(y_test, knn_tune.predict(X_test)))","dff82924":"# Create KNN model object with default settings (n_neighbors=5 which means k value=5)\nfrom sklearn.neighbors import KNeighborsRegressor\nknn_model=KNeighborsRegressor().fit(X_train, y_train)\nknn_model\n","8287acdc":"knn_model.n_neighbors","d4d105c0":"#Find Test Error (RMSE) within predicted y values and \"test data real y values\". \n#To do that, first predict y values from \"test data x values\". \n#In brief,from test data x values--> gain predicted y values and compare it with test data real y values\nypredict=knn_model.predict(X_test)\nypredict[0:5]","f25c4c86":"#### Find Test Error (RMSE) within predicted y values and \"test data y values.\nfrom sklearn.metrics import mean_squared_error, r2_score \nnp.sqrt(mean_squared_error(ypredict,y_test))","4a4a0d2b":"from sklearn.model_selection import train_test_split, GridSearchCV,cross_val_score\nRMSE=[]     \nRMSECV=[]    #rmse values with cross validation.\nfor k in range(10):\n    k=k+1\n    knn_model = KNeighborsRegressor(n_neighbors = k).fit(X_train, y_train)    #train error\n    ytrainpredict=knn_model.predict(X_train)\n    rmse=np.sqrt(mean_squared_error(ytrainpredict,y_train))\n    rmsecv=np.sqrt(-1*cross_val_score(knn_model,X_train,y_train,cv=10, scoring=\"neg_mean_squared_error\").mean())\n    RMSE.append(rmse)\n    RMSECV.append(rmsecv)\n    print(\"for k=\", k, \"    RMSE value=\",rmse, \"     Cross Validated RMSE\", rmsecv)\n    #Here the result of RMSE with CV : the range of it is btw 283 and 301. It is smaller than rmse range.","b3a26c7a":"knn_tune=KNeighborsRegressor(n_neighbors = knncv.best_params_[\"n_neighbors\"]).fit(X_train, y_train)\nnp.sqrt(mean_squared_error(y_test, knn_tune.predict(X_test)))","bc7f4528":"#### https:\/\/github.com\/mvahit\/DSMLBC\/blob\/master\/README.md","38108275":"# 413 is real RMSE for test data","b1dd17f7":"# CROSSCHECK and exercises for different k values with not validated model","f20b064b":"# STEPS FOR KNN \n1. ## import data and indicate x-y values\n2. ## split the data into train and test datasets\n3. ## set cross validated KNN model object and fit it to train dataset\n4. ## choose best \"k\" for tuned KNN model and find final RMSE","eb288e53":" # 2.Split the data into train and test data","cd63e0bc":"# 3.set cross validated KNN model object and fit it to train dataset","09232605":"#### Let's create not validated KNN model object and fit it W\u0130TH default n_neighbors=5  (this is our k number for now) and find RMSE\n\n\n","e228bd0c":" # 4.choose best \"k\" for tuned KNN model and find final RMSE for test error","c7694c81":"# CROSSCHECK and exercises for different k values with not validated and validated model","8dc227d8":"# 1.Import data","85c87bf7":"\n\n####Create X variables( from dummies ) and y variable\n\n\n","6ed2ebb5":"### Now, we gain train error(RMSE):                   from train data\n### And we gain train error(Cross Validated RMSE):    from cross validated model\n\n## Note that,it is not important to have small RMSE which is misleading here.\n## We are looking for small range. RMSE range is 179-271. CV RMSE range is 283-301.\n## We always consider that test error must be calculated from validated  model."}}