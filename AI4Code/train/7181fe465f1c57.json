{"cell_type":{"bf906ece":"code","c3385e3a":"code","5903c871":"code","f7d4da4b":"code","1c4c00e3":"code","a86495e1":"code","3edea6eb":"code","1b6021b0":"code","c8e7d0bf":"code","10c075e9":"code","fc57d395":"code","dd69d816":"code","17adf701":"code","bcb2a593":"code","a41534ea":"code","a5a06bf3":"code","cba319e0":"code","ca1c8ee1":"code","becc4818":"code","e695b2aa":"code","ec6ddb01":"code","b0dbebb6":"code","4bc52049":"code","4f3790ba":"code","edfc252a":"code","fa9724b7":"code","79c70e83":"code","97c0b437":"markdown","2c0891ad":"markdown","b7852d03":"markdown","fe00e026":"markdown","c4251dca":"markdown"},"source":{"bf906ece":"import pandas as pd\nimport numpy as np\nimport matplotlib.pylab as plt\n%matplotlib inline\nfrom matplotlib.pylab import rcParams\nrcParams['figure.figsize'] = 15, 6","c3385e3a":"air_passengers = pd.read_csv(\"..\/input\/air-passengers\/AirPassengers.csv\", header = 0, parse_dates = [0], names = ['Month', 'Passengers'], index_col = 0)","5903c871":"log_air_passengers = np.log(air_passengers.Passengers)","f7d4da4b":"log_air_passengers_diff = log_air_passengers - log_air_passengers.shift()","1c4c00e3":"plt.plot(log_air_passengers_diff)","a86495e1":"# %load snippets\/7_diff2.py\n\n","3edea6eb":"# think physics!","1b6021b0":"log_air_passengers_diff.dropna(inplace=True)","c8e7d0bf":"# try out nc, ct, ctt\n# http:\/\/www.statsmodels.org\/0.6.1\/generated\/statsmodels.tsa.stattools.adfuller.html\nfrom statsmodels.tsa.stattools import adfuller\nuseful_values_raw = adfuller(log_air_passengers_diff, autolag = 'AIC', regression = 'c')[:5]\nuseful_values = [v for v in useful_values_raw[:4]]\nuseful_values.extend([useful_values_raw[4]['1%'], useful_values_raw[4]['5%'], useful_values_raw[4]['10%']])\npd.DataFrame({ 'Value':useful_values, 'Label':['Test Statistic','p-value','#Lags Used','Number of Observations Used', 'Critical value for 1%', 'Critical value for 5%', 'Critical value for 10%']})","10c075e9":"# Let's talk about the ARIMA model\n# Auto-Regressive Integrated Moving Average\n# In this case we're talking about a series with dependence among values (more natural)","fc57d395":"# Nothing but a linear regression with a few times\n# 1. The number of Auto-Regressive Terms (p)\n# 2. The number of differences taken (d)\n# 3. The number of Moving Average Terms (q)","dd69d816":"# We don't pull these out of thin air, but rather draw them from the data\nfrom statsmodels.tsa.stattools import acf, pacf\n\nlag_acf = acf(log_air_passengers_diff.values, nlags = 20)\nlag_pacf = pacf(log_air_passengers_diff.values, nlags = 20)","17adf701":"plt.subplot(121) \nplt.bar(left = range(len(lag_acf)), height = lag_acf)\nplt.axhline(y=0,linestyle='--')\nplt.axhline(y=-1.96\/np.sqrt(len(log_air_passengers_diff)),linestyle='--')\nplt.axhline(y=1.96\/np.sqrt(len(log_air_passengers_diff)),linestyle='--')","bcb2a593":"# look at where the plot crosses the upper confidence interval for the first time\n# for ACF this is 1 and gives us the p value","a41534ea":"plt.subplot(121) \nplt.bar(left = range(len(lag_pacf)), height = lag_pacf)\nplt.axhline(y=0,linestyle='--')\nplt.axhline(y=-1.96\/np.sqrt(len(log_air_passengers_diff)),linestyle='--')\nplt.axhline(y=1.96\/np.sqrt(len(log_air_passengers_diff)),linestyle='--')","a5a06bf3":"# look at where the plot crosses the upper confidence interval for the first time\n# for PACF this is 2 and gives us the p value","cba319e0":"from statsmodels.tsa.arima_model import ARIMA","ca1c8ee1":"# AR model\n# try different values of p\nmodel = ARIMA(log_air_passengers, order=(2, 1, 0))  \nresults_AR = model.fit(disp=-1)  \nplt.plot(log_air_passengers_diff)\nplt.plot(results_AR.fittedvalues, color='red')\nplt.title('RSS: %.4f'% sum((results_AR.fittedvalues-log_air_passengers_diff)**2))","becc4818":"# try different values of q\n# MA model\nmodel = ARIMA(log_air_passengers, order=(0, 1, 1))  \nresults_MA = model.fit(disp=-1)  \nplt.plot(log_air_passengers_diff)\nplt.plot(results_MA.fittedvalues, color='red')\nplt.title('RSS: %.4f'% sum((results_MA.fittedvalues-log_air_passengers_diff)**2))","e695b2aa":"# ARIMA model\n# try p = 1 or 2\nmodel = ARIMA(log_air_passengers, order=(1, 1, 1))  \nresults_ARIMA = model.fit(disp=-1)  \nplt.plot(log_air_passengers_diff)\nplt.plot(results_ARIMA.fittedvalues, color='red')\nplt.title('RSS: %.4f'% sum((results_ARIMA.fittedvalues-log_air_passengers_diff)**2))","ec6ddb01":"# should we do un-log and then un-diff?\n# or un-diff and then un-log?\n# let's go back and see what we did","b0dbebb6":"predictions_ARIMA_diff = pd.Series(results_ARIMA.fittedvalues, copy=True)\nprint(predictions_ARIMA_diff.head())","4bc52049":"predictions_ARIMA_diff_cumsum = predictions_ARIMA_diff.cumsum()\nprint(predictions_ARIMA_diff_cumsum.head())","4f3790ba":"predictions_ARIMA_log = pd.Series(log_air_passengers.iloc[0], index=log_air_passengers.index)","edfc252a":"predictions_ARIMA_log = pd.Series(log_air_passengers.ix[0], index=log_air_passengers.index)\npredictions_ARIMA_log = predictions_ARIMA_log.add(predictions_ARIMA_diff_cumsum,fill_value=0)\npredictions_ARIMA_log.head()","fa9724b7":"predictions_ARIMA = np.exp(predictions_ARIMA_log)\nplt.plot(air_passengers)\nplt.plot(predictions_ARIMA)","79c70e83":"# Seasonal ARIMA\n# http:\/\/www.statsmodels.org\/dev\/generated\/statsmodels.tsa.statespace.sarimax.SARIMAX.html\n# Confidence interval for ARIMA \n# http:\/\/statsmodels.sourceforge.net\/devel\/generated\/statsmodels.tsa.arima_model.ARIMAResults.forecast.html#statsmodels.tsa.arima_model.ARMAResults.forecast","97c0b437":"### By the way, how would I difference again?","2c0891ad":"# Let's do it","b7852d03":"# Let's do a quick and dirty detrend","fe00e026":"# Know more","c4251dca":"### What information are you losing when you difference? What about when you difference twice?"}}