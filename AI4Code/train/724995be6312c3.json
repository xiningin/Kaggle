{"cell_type":{"fae141bc":"code","8425b7a6":"code","7208fb89":"code","4665c011":"code","76593de4":"code","6cca5091":"code","4c4d7a59":"code","9001cf76":"code","045025cb":"code","85e36dd0":"code","f3b99f0a":"markdown","15c85d53":"markdown","6e0ae43a":"markdown","5c9a0b5f":"markdown","4b4879e1":"markdown","4b60e86e":"markdown"},"source":{"fae141bc":"!pip install iterative-stratification","8425b7a6":"import pandas as pd\nfrom iterstrat.ml_stratifiers import MultilabelStratifiedKFold\n\nimport numpy as np\nimport joblib\nimport glob\nfrom tqdm import tqdm\n\nfrom zipfile import ZipFile\n","7208fb89":"if __name__ == \"__main__\":\n    df = pd.read_csv(\"..\/input\/bengaliai-cv19\/train.csv\")\n    print(df.head())\n    df.loc[:, 'kfold'] = -1\n    \n    #shuffling dataset\n    #frac = ?\n    df = df.sample(frac = 1).reset_index(drop = True)\n    \n    x = df.image_id.values\n    y = df[[\"grapheme_root\", \"vowel_diacritic\", \"consonant_diacritic\"]].values\n    \n    mskf = MultilabelStratifiedKFold(n_splits = 5)\n    \n    for fold, (trn_, val_) in enumerate(mskf.split(x, y)):\n        print(\"TRAIN: \", trn_, \"VAL: \",  val_)\n        df.loc[val_, \"kfold\"] = fold\n        \n    print(df.kfold.value_counts())\n    ","4665c011":"df.head()","76593de4":"df_1 = pd.read_parquet(\"..\/input\/bengaliai-cv19\/train_image_data_0.parquet\")","6cca5091":"df_1.head()","4c4d7a59":"!mkdir image_pickles.zip","9001cf76":"\nif __name__ == \"__main__\":\n    files = glob.glob(\"..\/input\/bengaliai-cv19\/train_*.parquet\")\n    folder = \"..output\/kaggle\/working\/image_pickles.zip\"\n    zipObj = ZipFile(folder, \"w\")\n    for f in files:\n        df = pd.read_parquet(f)\n        image_ids = df.image_id.values\n        df = df.drop(\"image_id\", axis = 1)\n        image_array = df.values\n        for j, image_id in tqdm(enumerate(image_ids), total = len(image_ids)):\n            label = \"image_pickles\" + image_id + \".pkl\"\n            joblib.dump(image_array[j, :], label)\n            zipObj.write(label)\n    zipObj.close()","045025cb":"df.head()","85e36dd0":"class BengaliDatasetTrain:\n    def __init__(self, folds, img_height, img_width, mean, std):\n        df = df\n        df = df[[\"image_id\", \"grapheme_root\", \"vowel_diacritic\", \"consonent_diacritic\", \"kfold\"]]\n        \n        df = df[df.kfold.isin(folds)].reset_index(drop = True)\n        self.image_ids = df.image_id.values\n        self.grapheme_root = df.grapheme_root.values\n        self.vowel_diacritic = df.vowel_diacritic.values\n        self.consonent_diacritic = df.consonent_diacritic.values\n        \n    def __len__(self):\n        return len(self.image_ids)\n    \n    def __getitem__(self, item):\n        image = joblib.load(\"..input\/image_pickles\/{self.image_ids[item]}.pkl\")\n        #image is vector\n        image = image.reshape(137, 236).astype(float)\n        \n    \n    ","f3b99f0a":"Ref: https:\/\/www.youtube.com\/watch?v=8J5Q4mEzRtY&list=PL98nY_tJQXZntH5WUtKB0bghZeKVIJHJc","15c85d53":"Yeah Kaggle :\/ whatever","6e0ae43a":"# Create folds\nMultilabel classification problem, we can have multiple model, or a single model can do the job\nFor multilabel classification, we are using Multilabel Stratified KFold","5c9a0b5f":"* First build a good cross validation system","4b4879e1":"# Pickles","4b60e86e":"# Model\n* three different model\n* one model\n\nFirst create a dataset class"}}