{"cell_type":{"fce19dd5":"code","5de8409c":"code","13ebca09":"code","040c02f7":"code","232a2c99":"code","2a7ce981":"code","0c36a5ef":"code","af6dbe88":"code","ac57d7b4":"code","c59fb7f3":"code","cbd46ed2":"code","41d659f1":"code","2f0d4f30":"code","10a74045":"code","d836ca3d":"markdown","25fc92dd":"markdown","29301d08":"markdown","bdb6a152":"markdown","d5e7030b":"markdown","2331987f":"markdown","49563988":"markdown","cbc46a03":"markdown","7f75d87e":"markdown","4abbd130":"markdown","74ea5e02":"markdown","315116b2":"markdown","0df6ac2b":"markdown","808b6f37":"markdown","db5cf9e6":"markdown","a842bec1":"markdown","360e743b":"markdown"},"source":{"fce19dd5":"# Import librairies\n%matplotlib inline \nimport matplotlib.pylab\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nplt.style.use('seaborn')\nplt.rcParams['figure.figsize'] = [20, 9]\nplt.rcParams['lines.linewidth'] = 1","5de8409c":"# Load the data\ndf = pd.read_csv(\"..\/input\/tesla-stock-data-from-2010-to-2020\/TSLA.csv\")\ndf['Date'] = pd.to_datetime(df['Date'])\ndf.index = df['Date']\ndf.tail(10)","13ebca09":"def plot_with_rolling(data,short_rolling,long_rolling,lbl='Close Price'):\n    # Plot \n    fig, ax = plt.subplots(figsize=(20,9))\n\n    ax.plot(data.index, data, label=lbl)\n    ax.plot(short_rolling.index, short_rolling, label='20 days rolling')\n    ax.plot(long_rolling.index, long_rolling, label='100 days rolling')\n    ax.axvline(x='2019-12-19',linewidth=0.8, color='r')\n    ax.axvline(x='2019-06-01',linewidth=0.8, color='g')\n    ax.set_xlabel('Date')\n    ax.set_ylabel(lbl)\n    ax.legend()\n\n    plt.show()\n\nshort = df.Close.rolling(window=20).mean()\nlong = df.Close.rolling(window=100).mean() \nplot_with_rolling(data=df.Close,short_rolling=short,long_rolling=long,lbl='Close Price')    \n    \nshort = df.Close[df.index>'2018-12-21'].rolling(window=20).mean()\nlong = df.Close[df.index>'2018-12-21'].rolling(window=100).mean() \nplot_with_rolling(data=df.Close[df.index>'2018-12-21'],short_rolling=short,long_rolling=long,lbl='Close Price')","040c02f7":"short = df.Volume.rolling(window=20).mean()\nlong = df.Volume.rolling(window=100).mean()\nplot_with_rolling(data=df.Volume,short_rolling=short,long_rolling=long,lbl='Volume')    \n    \nshort = df.Volume[df.index>'2018-12-21'].rolling(window=20).mean()\nlong = df.Volume[df.index>'2018-12-21'].rolling(window=100).mean() \nplot_with_rolling(data=df.Volume[df.index>'2018-12-21'],short_rolling=short,long_rolling=long,lbl='Volume')\n","232a2c99":"# Calculate the daily return and the daily log return\ndaily_rtn = df.Close\/df.Close.shift(1) - 1\ndaily_log_rtn = np.log(df.Close).diff()\n# Calculate the daily return (another way)\n# daily_rtn = close.pct_change(1)\n\ndaily_rtn.plot()\nplt.show()\n# log return\n","2a7ce981":"daily_rtn.rolling(30).var().plot()\nplt.show()","0c36a5ef":"df['Volume'].rolling(50).var().plot()\nplt.show()","af6dbe88":"# Calculate diff\ndiff=df.Close.diff().dropna()\n# Ups\nplus=diff.map(lambda x: x if x>0 else 0).rename('Plus')\n# Downs\nminus=diff.map(lambda x: -1*x if x<0 else 0).rename('Minus')\n\nrsi14=pd.concat([diff,plus,minus],axis=1)\n# init average up\nrsi14['AvgUP'] = rsi14.Plus[:14].sum()\/14\n# init average down\nrsi14['AvgDOWN'] = rsi14.Minus[:14].sum()\/14\n\n# calculate AvgUP and AvgDown with the recurrent formula\nfor i in range(14,rsi14.Close.size):\n    rsi14['AvgUP'].iloc[i]=(rsi14['Plus'].iloc[i] + 13*rsi14['AvgUP'].iloc[i-1])\/14\n    rsi14['AvgDOWN'].iloc[i]=(rsi14['Minus'].iloc[i] + 13*rsi14['AvgDOWN'].iloc[i-1])\/14\n\nrsi14['RSI']=100 - 100 \/ (1+rsi14['AvgUP']\/rsi14['AvgDOWN'])\nrsi14.tail(10)","ac57d7b4":"short = rsi14['RSI'].rolling(window=20).mean()\nlong = rsi14['RSI'].rolling(window=100).mean()\nplot_with_rolling(data=rsi14['RSI'],short_rolling=short,long_rolling=long,lbl='Close Price')    ","c59fb7f3":"ema_short = df.Close.ewm(span=12, adjust=False).mean()\nema_long = df.Close.ewm(span=26, adjust=False).mean()\nmacd_line = ema_short - ema_long\nmacd_signal = macd_line.ewm(span=9, adjust=False).mean()\n","cbd46ed2":"# Plot \nfig, ax = plt.subplots(figsize=(20,9))\n\nax.plot(macd_line.index, macd_line, label='MACD Line')\nax.plot(macd_signal.index, macd_signal, label='MACD Signal')\nax.axvline(x='2019-12-19',linewidth=0.8, color='r')\nax.set_xlabel('Date')\nax.set_ylabel('MACD')\nax.legend()\n\nplt.show()\n","41d659f1":"momentum = df.Close.diff(20)\nmomentum.plot()\nplt.show()","2f0d4f30":"\ndef plot_all(close=df.Close,rsi=rsi14['RSI'],macd=macd_line,momentum=momentum):\n    fig = plt.figure(constrained_layout=True,figsize=(20,16))\n    gs = fig.add_gridspec(10, 1)\n    ax1 = fig.add_subplot(gs[:4, 0])\n    ax1.set_title('Close')\n    ax1.plot(close.index, close, label='Close')\n    ax1.axvline(x='2019-12-19',linewidth=0.8, color='r')\n    ax2 = fig.add_subplot(gs[4:6,0])\n    ax2.set_title('RSI14')\n    ax2.plot(rsi.index, rsi)\n    ax2.axhline(y=30,linewidth=0.5, color='blue')\n    ax2.axhline(y=70,linewidth=0.5, color='red')\n    ax2.axvline(x='2019-12-19',linewidth=0.8, color='r')\n    ax3 = fig.add_subplot(gs[6:8,0])\n    ax3.set_title('MACD')    \n    ax3.plot(macd.index, macd)\n    ax3.axhline(y=0,linewidth=0.5, color='black')\n    ax3.axvline(x='2019-12-19',linewidth=0.8, color='r')\n    ax4 = fig.add_subplot(gs[8:,0])\n    ax4.set_title('Momentum')\n    ax4.plot(momentum.index, momentum)\n    ax4.axhline(y=0,linewidth=0.5, color='black')\n    ax4.axvline(x='2019-12-19',linewidth=0.8, color='r')\n    plt.show()\nplot_all()\n","10a74045":"startd = '2018-12-31'\nplot_all(close=df.Close[df.index>startd],rsi=rsi14['RSI'][rsi14.index>startd],macd=macd_line[macd_line.index>startd],momentum=momentum[momentum.index>startd])","d836ca3d":"# Zoom on the last year","25fc92dd":"# Let's check classical indicator\n# RSI14 - a trend oscillator\n\n$$ RSI_{14} = 100 - (\\frac{100}{1 + RS}) $$ \n\n\n$$ RS = Relative Strength = \\frac{\\text{average of all up moves in the last 14 days}}{\\text{average of all down moves in the last 14 days}} = \\frac{\\text{AvgUP}}{\\text{AvgDOWN}} $$\n\nThis leading indicator is limited from 0 to 100, when its value is below 30 it is said that it is overbought and when its value is above 70 it is said that it is overbought.\n\n### How to calcul it ?\nhttps:\/\/www.macroption.com\/rsi-calculation\/\n\nhttps:\/\/www.investopedia.com\/terms\/r\/rsi.asp\n\n* Evaluate average_gain and average_loss for the first 14 days\n* Caculate average_up and average_down with a recurrent formula\n\n$$AvgUP(t) = \\frac{UP(t) + 13 \\times AvgUP(t-1)}{14}$$\n$$AvgDOWN(t) = \\frac{DOWN(t) + 13 \\times AvgDOWN(t-1)}{14}$$","29301d08":"> <span>&#171;<\/span>There is no spike of variance of the daily returns before the rise<span>&#187;<\/span>","bdb6a152":"> <span>&#171;<\/span>Volume are not exceptionally high before our end point (2019-12-19),<br\/> but volumes are constantly very high over the year 2019<span>&#187;<\/span>","d5e7030b":"# The momentum\n\nhttps:\/\/www.macroption.com\/momentum\/\n\n\nMomentum shows how much the closing price has changed, it indicates how much a trend is strong.\n\nMomentum is the difference between current closing price and the closing price n days before\n\n`Momentum = Close(Today) \u2013 Close(Today - n days)`","2331987f":"# Calculate the daily returns","49563988":"<div style=\"color: #004085;background-color: #cce5ff;border-color: #b8daff;\">\n  I'm not a trader, but if you like my try, please upvote\n<\/div>","cbc46a03":"# First look at the shape and at the trend of the data (close & volume)\n\n> Build a rolling windows of 20\/100 days and plot the mean on this windows","7f75d87e":"> <span>&#171;<\/span>There is no spike of variance of the volumes before the rise<span>&#187;<\/span>","4abbd130":"# Let's gather all this\n","74ea5e02":"> <span>&#171;<\/span>My comments ...<span>&#187;<\/span>\n\n![tesla.png](attachment:tesla.png)","315116b2":"> <span>&#171;<\/span>The trend was really bullish since June, which is remarkable is perhaps the slope of the moving average 20 during the last months before our end point (2019-12-19)<span>&#187;<\/span>\n\n> <span>&#171;<\/span>On the zoom, we see that the rise is very powerful after the beginning of september, the MA100 has absorded the decrease of the past and follow the MA20 <span>&#187;<\/span>","0df6ac2b":"# MACD (Moving Average Convergence-Divergence)\nhttps:\/\/www.macroption.com\/macd\/\n\nhttps:\/\/www.investopedia.com\/terms\/m\/macd.asp\n\n*EMA stands for \"exponential moving average\"*\n\n* **MACD line = (shorter EMA of close prices) \u2013 (longer EMA of close prices)**\n* **MACD Signal = EMA of MACD line**\n\nWith \n\n* s = period of the shorter EMA\n* l = period of the longer EMA\n* p = period of the EMA of MACD\n\nThese periods can be equal to (s=12, l=26, p=9) or (s=8, l=22, p=11), for instance\n\n\n**How to interprete it ?**\n\n| MACD line   | Description |\n| ----------- | ----------- |\n| positive and rising   | Market\u2019s bullish momentum is accelerating        |\n| negative and falling   | Market\u2019s bearish momentum is accelerating        |\n| positive but falling   | The bullish momentum in the market is fading        |\n| negative but increasing   | The bearish momentum in the market is fading        |\n| zero      | Balanced       |","808b6f37":"> <span>&#171;<\/span>Nothing to say ... <span>&#187;<\/span>","db5cf9e6":"# The question is whether we could see signs of the sudden rise in share prices ?\n# or is it a kind of black swan ?\n![blackSwanSmall.jpg](attachment:blackSwanSmall.jpg)\n\n> The price exceeds 400 dollars on 12\/19\/2019, and goes up to around 800 afterwards.\n\n> So, can we see signs of this rise before the 12\/19\/2019 ?","a842bec1":"# Importing the data","360e743b":"# The variance of the close and of the volume\n"}}