{"cell_type":{"75445c96":"code","b070b951":"code","1d859e2f":"code","eebd242c":"code","3fc78c15":"code","70c68840":"code","7b6bf5ca":"code","fb780ec6":"markdown"},"source":{"75445c96":"import gc\n\nimport pandas as pd\nimport numpy as np\n\nfrom sklearn.decomposition import LatentDirichletAllocation","b070b951":"df = pd.read_feather('\/kaggle\/input\/riiidtrainfeather\/train.f', \n                     columns=['user_id', 'content_id', 'content_type_id', 'answered_correctly']).head(20000000)\nq = pd.read_csv('\/kaggle\/input\/riiid-test-answer-prediction\/questions.csv')\n\ndf = df[(df['answered_correctly'] == 0) & (df['content_type_id'] == 0)].drop('answered_correctly', axis=1)\ngc.collect()","1d859e2f":"mat = df.groupby(['content_id', 'user_id'])['content_type_id'].count()\nmat = mat.astype(np.uint8)\nmat = mat.unstack(fill_value=0)","eebd242c":"LDA_DIM = 10\n\nlda = LatentDirichletAllocation(LDA_DIM, random_state=0)\ntransformed = lda.fit_transform(mat)","3fc78c15":"transformed_df = pd.DataFrame(transformed)\ntransformed_df.columns = [f'lda_item_inc_{i}' for i in range(LDA_DIM)]\ntransformed_df = transformed_df.astype(np.float32)\ntransformed_df['question_id'] = mat.index.tolist()","70c68840":"qmat = pd.merge(q[['question_id']], transformed_df, on='question_id', how='left')\nqmat.head()","7b6bf5ca":"qmat.columns = ['question_id'] + [f'lda_item_inc_{i}' for i in range(LDA_DIM)]\nqmat.to_feather('question_lda_incorrect_mat.f')","fb780ec6":"## About\n\nThis Notebook generates LDA feature used in the [9th place LightGBM](https:\/\/www.kaggle.com\/c\/riiid-test-answer-prediction\/discussion\/210354) with 20M rows of data.\n\nIn the actual solution, I ran this script in GCP with all rows (due to [this behavior](https:\/\/github.com\/pandas-dev\/pandas\/issues\/26314), pandas version must be 0.21 or earlier to run this script with all rows)."}}