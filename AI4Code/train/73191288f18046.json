{"cell_type":{"593775b6":"code","78a538fb":"code","ee644a4a":"code","98c0793d":"code","0a0e348b":"code","edfd6755":"code","8cff251a":"code","daccdd92":"code","101dd174":"code","fcc36d03":"code","4797e64f":"code","8fa36226":"code","4a1d3c2b":"code","12e58c1a":"code","a79650e3":"code","f219a51e":"code","a6e37cb8":"code","f899f58c":"code","589494ee":"code","5cf5bd30":"code","5a3210ec":"code","9721bf6f":"markdown","13e48dc6":"markdown","7a044ed9":"markdown","a1bba060":"markdown","3e43fd1f":"markdown"},"source":{"593775b6":"from typing import Mapping\n\nimport pandas as pd\nimport numpy as np\nimport seaborn as sns\n\nfrom functools import reduce\nfrom sklearn.model_selection import StratifiedKFold\nfrom matplotlib import pyplot as plt\n\n%matplotlib inline","78a538fb":"path = '..\/input\/stanford-covid-vaccine\/'\ntrain = pd.read_json(f'{path}\/train.json',lines=True).drop(columns='index')\ntest = pd.read_json(f'{path}\/test.json', lines=True).drop(columns='index')\nsub = pd.read_csv(f'{path}\/sample_submission.csv')","ee644a4a":"print(f\"Train columns: \\n{train.columns}\")","98c0793d":"print(f\"Test columns: \\n{test.columns}\")","0a0e348b":"print('=======================Train========================')\nsns.countplot(train.seq_length)\nplt.show()\n\nsns.countplot(train.seq_scored)\nplt.show()\n\nsns.countplot(train.SN_filter)\nplt.show()\n\nplt.title('signal_to_noise')\ntrain['signal_to_noise'].hist()\nplt.show()","edfd6755":"print('=======================Test========================')\nsns.countplot(test.seq_length)\nplt.show()\n\nsns.countplot(test.seq_scored)\nplt.show()","8cff251a":"def apply_seq2id(\n    seq: str,\n    a_seq2id: Mapping[str,int]\n):\n    return np.array([a_seq2id[el] for el in seq])","daccdd92":"STRUCTURE_CODE = {\n    '(': 0, \n    '.': 1, \n    ')': 2\n}\nSTRUCTURE_CODE","101dd174":"PREDICTED_LOOP_TYPE_CODE = {\n    'H': 0, \n    'E': 1, \n    'B': 2, \n    'M': 3, \n    'X': 4, \n    'S': 5, \n    'I': 6\n}\nPREDICTED_LOOP_TYPE_CODE","fcc36d03":"SEQUANCE_CODE = {\n    'U': 0, \n    'C': 1, \n    'A': 2, \n    'G': 3\n}\nSEQUANCE_CODE","4797e64f":"print('=======================Train========================')\nidx = 0\n\ntarget_len = train.iloc[idx].seq_scored\n\nplt.title('sequence')\nplt.plot(apply_seq2id(train.iloc[idx].sequence, SEQUANCE_CODE)[:target_len])\nplt.show()\n\nplt.title('predicted_loop_type')\nplt.plot(apply_seq2id(train.iloc[idx].predicted_loop_type, PREDICTED_LOOP_TYPE_CODE)[:target_len])\nplt.show()\n\nplt.title('structure')\nplt.plot(apply_seq2id(train.iloc[idx].structure, STRUCTURE_CODE)[:target_len])\nplt.show()\n\nplt.title('reactivity')\nplt.plot(train.iloc[idx].reactivity[:target_len])\nplt.show()\n\nplt.title('deg_Mg_pH10')\nplt.plot(train.iloc[idx].deg_Mg_pH10[:target_len])\nplt.show()\n\nplt.title('deg_Mg_50C')\nplt.plot(train.iloc[idx].deg_Mg_50C[:target_len])\nplt.show()\n\nplt.title('deg_50C')\nplt.plot(train.iloc[idx].deg_50C[:target_len])\nplt.show()\n\nplt.title('reactivity_error')\nplt.plot(train.iloc[idx].reactivity_error[:target_len])\nplt.show()\n\nplt.title('deg_error_Mg_pH10')\nplt.plot(train.iloc[idx].deg_error_Mg_pH10[:target_len])\nplt.show()\n\nplt.title('deg_error_pH10')\nplt.plot(train.iloc[idx].deg_error_pH10[:target_len])\nplt.show()\n\nplt.title('deg_error_Mg_50C')\nplt.plot(train.iloc[idx].deg_error_Mg_50C[:target_len])\nplt.show()\n\nplt.title('deg_error_50C')\nplt.plot(train.iloc[idx].deg_error_50C[:target_len])\nplt.show()","8fa36226":"print('=======================Test========================')\nidx = 0\n\ntarget_len = test.iloc[idx].seq_scored\n\nplt.title('sequence')\nplt.plot(apply_seq2id(test.iloc[idx].sequence, SEQUANCE_CODE)[:target_len])\nplt.show()\n\nplt.title('predicted_loop_type')\nplt.plot(apply_seq2id(test.iloc[idx].predicted_loop_type, PREDICTED_LOOP_TYPE_CODE)[:target_len])\nplt.show()\n\nplt.title('structure')\nplt.plot(apply_seq2id(test.iloc[idx].structure, STRUCTURE_CODE)[:target_len])\nplt.show()","4a1d3c2b":"all_structures = reduce(lambda x,y: x+y, train['structure'].apply(list).tolist())\nall_sequences = reduce(lambda x,y: x+y, train['sequence'].apply(list).tolist())\nall_predicted_loop_types = reduce(lambda x,y: x+y, train['predicted_loop_type'].apply(list).tolist())\nall_reactivitys = reduce(lambda x,y: x+y, train['reactivity'].apply(list).tolist())\nall_deg_Mg_pH10s = reduce(lambda x,y: x+y, train['deg_Mg_pH10'].apply(list).tolist())\nall_deg_Mg_50Cs = reduce(lambda x,y: x+y, train['deg_Mg_50C'].apply(list).tolist())\nall_deg_50Cs = reduce(lambda x,y: x+y, train['deg_50C'].apply(list).tolist())\nall_deg_pH10s = reduce(lambda x,y: x+y, train['deg_pH10'].apply(list).tolist())","12e58c1a":"print('=======================Train========================')\n\nplt.title('Structure distribution')\nsns.countplot(all_structures)\nplt.show()\n\nplt.title('sequence distribution')\nsns.countplot(all_sequences)\nplt.show()\n\nplt.title('predcited loop types distribution')\nsns.countplot(all_predicted_loop_types)\nplt.show()\n\nplt.title('reactivity distribution')\nplt.hist(all_reactivitys)\nplt.show()\n\nplt.title('deg_Mg_pH10 distribution')\nplt.hist(all_deg_Mg_pH10s)\nplt.show()\n\nplt.title('deg_Mg_50C distribution')\nplt.hist(all_deg_Mg_50Cs)\nplt.show()\n\nplt.title('deg_50C distribution')\nplt.hist(all_deg_50Cs)\nplt.show()\n\nplt.title('deg_pH10 distribution')\nplt.hist(all_deg_pH10s)\nplt.show()","a79650e3":"all_structures = reduce(lambda x,y: x+y, test['structure'].apply(list).tolist())\nall_sequences = reduce(lambda x,y: x+y, test['sequence'].apply(list).tolist())\nall_predicted_loop_types = reduce(lambda x,y: x+y, test['predicted_loop_type'].apply(list).tolist())","f219a51e":"print('=======================Test========================')\nplt.title('Structure distribution')\nsns.countplot(all_structures)\nplt.show()\n\nplt.title('sequence distribution')\nsns.countplot(all_sequences)\nplt.show()\n\nplt.title('predcited loop types distribution')\nsns.countplot(all_predicted_loop_types)\nplt.show()","a6e37cb8":"median_raw_reactivity = train['reactivity'].apply(np.median)\nmedian_raw_deg_Mg_pH10 = train['deg_Mg_pH10'].apply(np.median)\nmedian_raw_deg_Mg_50C = train['deg_Mg_50C'].apply(np.median)\nmedian_raw_deg_50C = train['deg_50C'].apply(np.median)\nmedian_raw_deg_pH10 = train['deg_pH10'].apply(np.median)","f899f58c":"print('=======================Train========================')\n\nplt.title('Median raw reactivity distribution')\nmedian_raw_reactivity.hist()\nplt.show()\n\nplt.title('Median raw deg_Mg_pH10 distribution')\nmedian_raw_deg_Mg_pH10.hist()\nplt.show()\n\nplt.title('Median raw deg_Mg_50C distribution')\nmedian_raw_deg_Mg_50C.hist()\nplt.show()\n\nplt.title('Median raw deg_50C distribution')\nmedian_raw_deg_50C.hist()\nplt.show()\n\nplt.title('Median raw deg_pH10 distribution')\nmedian_raw_deg_pH10.hist()\nplt.show()","589494ee":"stratify_col = 'reactivity'\nbins = 20\n\ntrain[f'median_raw_{stratify_col}'] = train[stratify_col].apply(np.median)\n\nbins = np.linspace(\n    train[f'median_raw_{stratify_col}'].min(), \n    train[f'median_raw_{stratify_col}'].max(), \n    bins\n)\ntrain[f'median_raw_bins_{stratify_col}'] = np.digitize(\n    train[f'median_raw_{stratify_col}'],\n    bins\n)\n\nfinal_stratify_col = f'median_raw_bins_{stratify_col}'","5cf5bd30":"skf = StratifiedKFold(\n    n_splits=5,\n    random_state=42,\n    shuffle=True\n)\n\nprint(\"N folds : \"+str(skf.get_n_splits(train, train[final_stratify_col])))\n\nfold_indices = list(skf.split(train, train[final_stratify_col]))","5a3210ec":"for idx, (train_indices, test_indices) in enumerate(fold_indices):\n    train_fold = train.iloc[train_indices]\n    test_fold = train.iloc[test_indices]\n    \n    print(f'========Fold {idx+1}=========')\n    \n    print(f'Train len: {train_fold.shape[0]}')\n    print(f'Test len: {test_fold.shape[0]}')\n    \n    plt.title(f'Train median raw {stratify_col} distribution')\n    plt.hist(train_fold[stratify_col].apply(np.median))\n    plt.show()\n    \n    plt.title(f'Test median raw {stratify_col} distribution')\n    plt.hist(train_fold[stratify_col].apply(np.median))\n    plt.show()\n    \n    plt.title(f'Train median raw deg_Mg_pH10 distribution')\n    plt.hist(train_fold['deg_Mg_pH10'].apply(np.median))\n    plt.show()\n    \n    plt.title(f'Test median raw deg_Mg_pH10 distribution')\n    plt.hist(train_fold['deg_Mg_pH10'].apply(np.median))\n    plt.show()\n    \n    plt.title(f'Train median raw deg_pH10 distribution')\n    plt.hist(train_fold['deg_pH10'].apply(np.median))\n    plt.show()\n    \n    plt.title(f'Test median raw deg_pH10 distribution')\n    plt.hist(train_fold['deg_pH10'].apply(np.median))\n    plt.show()\n    \n    plt.title(f'Train median raw deg_Mg_50C distribution')\n    plt.hist(train_fold['deg_Mg_50C'].apply(np.median))\n    plt.show()\n    \n    plt.title(f'Test median raw deg_Mg_50C distribution')\n    plt.hist(train_fold['deg_Mg_50C'].apply(np.median))\n    plt.show()\n    \n    plt.title(f'Train median raw deg_50C distribution')\n    plt.hist(train_fold['deg_50C'].apply(np.median))\n    plt.show()\n    \n    plt.title(f'Test median raw deg_50C distribution')\n    plt.hist(train_fold['deg_50C'].apply(np.median))\n    plt.show()","9721bf6f":"## Read Data","13e48dc6":"## Examine sequences","7a044ed9":"## Examine sequences stats","a1bba060":"# Stratification","3e43fd1f":"## Examine scalars"}}