{"cell_type":{"4fc97b81":"code","3a7f15b2":"code","84e8d56f":"code","a2c1d95c":"code","e860c602":"code","9a3a9e42":"code","59a71513":"code","2a761afb":"code","e4c1a386":"code","6a7d7aa4":"code","0c0dae0e":"code","8fd582eb":"code","9e225545":"code","09d8bc22":"code","6ad5ec2e":"code","25324650":"code","28e8f888":"code","b1a9d6e4":"code","2f44cbe2":"code","3ff6747e":"code","494117ae":"code","f6bc5532":"code","58ddd6dd":"code","89fa3fe4":"markdown","4da06006":"markdown","d33a5a5c":"markdown","6682b490":"markdown","7a1741b1":"markdown","fba5e425":"markdown","d45e19c9":"markdown"},"source":{"4fc97b81":"import pandas as pd\nimport matplotlib.pyplot as plt \n%matplotlib inline\nimport seaborn as sns\nimport numpy as np\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn import preprocessing\nfrom sklearn.feature_selection import RFE\nfrom sklearn.metrics import roc_curve, roc_auc_score","3a7f15b2":"df= pd.read_csv(\"..\/input\/heart-failure-clinical-data\/heart_failure_clinical_records_dataset.csv\")\ndf.head(10)","84e8d56f":"print (df.dtypes)\nprint (df.shape)","a2c1d95c":"df.describe()","e860c602":"sns.pairplot(df, vars=[\"age\", \"creatinine_phosphokinase\", \"ejection_fraction\", \"platelets\", \n                       \"serum_creatinine\", \"serum_sodium\", \"time\"])","9a3a9e42":"categorical_data= df.drop(\"age\", axis=1)\ncategorical_data= categorical_data.drop(\"creatinine_phosphokinase\", axis=1)\ncategorical_data= categorical_data.drop(\"ejection_fraction\", axis=1)\ncategorical_data= categorical_data.drop(\"platelets\", axis=1)\ncategorical_data= categorical_data.drop(\"serum_creatinine\", axis=1)\ncategorical_data= categorical_data.drop(\"serum_sodium\", axis=1)\ncategorical_data= categorical_data.drop(\"time\", axis=1)\ncategorical_data.head(10)","59a71513":"plt.style.use(\"bmh\")\nsns.catplot(y = \"sex\", data = categorical_data, kind = \"count\").set(title=\"Count of women and men\");","2a761afb":"sns.catplot(y = \"DEATH_EVENT\", data = categorical_data, kind = \"count\").set(title=\"Deceased cases\");","e4c1a386":"df= df.rename(columns={'DEATH_EVENT': 'y'})\ndf_0 = df[df['y'] == 0]\ndf_1 = df[df['y'] == 1]\nprint(\"0 shape\", df_0.shape)\nprint(\"1 shape\", df_1.shape)","6a7d7aa4":"df_0_reduced = df_0.sample(96,random_state=100)\ndf_reduced = pd.concat([df_0_reduced,df_1],axis=0)\ndf_reduced = df_reduced.sample(frac=1,random_state=100)\ndf_reduced.head()","0c0dae0e":"df_reduced.shape","8fd582eb":"plt.figure(figsize=(5,5))\nsns.catplot(y = \"y\", data = df_reduced, kind = \"count\").set(title=\"Deceased cases\");","9e225545":"plt.figure(figsize=(5,10))\nsns.heatmap(pd.DataFrame(df_reduced.corr().y), annot=True,linewidth=0.5,cmap=\"RdBu\");","09d8bc22":"df_reduced.anaemia=df_reduced.anaemia.replace({1:\"uno\", 0:\"cero\"})\ndf_reduced.diabetes=df_reduced.diabetes.replace({1:\"uno\", 0:\"cero\"})\ndf_reduced.high_blood_pressure=df_reduced.high_blood_pressure.replace({1:\"uno\", 0:\"cero\"})\ndf_reduced.sex=df_reduced.sex.replace({0:\"cero\", 1:\"uno\"})\ndf_reduced.smoking=df_reduced.smoking.replace({0:\"cero\", 1:\"uno\"})\ndf_reduced.y=df_reduced.y.replace({0:\"cero\", 1:\"uno\"})\ndf_reduced.head()","6ad5ec2e":"columns_to_dummy = df_reduced.columns[df_reduced.dtypes == np.object]\ndf_reduced_w_dummy = pd.get_dummies(df_reduced,prefix=columns_to_dummy)\ndf_reduced_w_dummy.head()","25324650":"df_reduced_w_dummy=df_reduced_w_dummy.drop([\"anaemia_uno\", \"diabetes_uno\", \"high_blood_pressure_uno\", \"sex_uno\", \"smoking_uno\", \"y_cero\"], axis=1)\ndf_reduced_w_dummy.head()","28e8f888":"df_reduced_w_dummy.head()\ndf_reduced=df_reduced_w_dummy\nplt.figure(figsize=(5,10))\nsns.heatmap(pd.DataFrame(df_reduced.corr().y_uno), annot=True,linewidth=0.5,cmap=\"RdBu\");","b1a9d6e4":"df_reduced=df_reduced.drop(\"creatinine_phosphokinase\", axis=1)\ndf_reduced=df_reduced.drop(\"platelets\", axis=1)\ndf_reduced=df_reduced.drop(\"anaemia_cero\", axis=1)\ndf_reduced=df_reduced.drop(\"diabetes_cero\", axis=1)\ndf_reduced=df_reduced.drop(\"high_blood_pressure_cero\", axis=1)\ndf_reduced=df_reduced.drop(\"sex_cero\", axis=1)\ndf_reduced=df_reduced.drop(\"smoking_cero\", axis=1)\ndf_reduced.head()","2f44cbe2":"y = df_reduced[\"y_uno\"]\nX = df_reduced.drop([\"y_uno\"], axis=1)\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=100)","3ff6747e":"clf = LogisticRegression(solver=\"liblinear\").fit(X_train, y_train)\ny_train_hat = clf.predict(X_train)\ny_test_hat = clf.predict(X_test)\nprint (\"Traning\")\nprint (clf.score(X_train,y_train))\nprint(\"Test\")\nprint (clf.score(X_test,y_test))","494117ae":"plt.figure(figsize = (10, 6))\nplt.plot([0,1], [0,1], 'r--')\n\nprobs = clf.predict_proba(X_test)\nprobs = probs[:, 1]\nfpr, tpr, thresholds = roc_curve(y_test,probs)\nroc_auc = roc_auc_score(y_test, y_test_hat)\nlabel = 'AUC:' + ' {0:.2f}'.format(roc_auc)\nplt.plot(fpr, tpr, color=\"#514EBD\", label = label, linewidth = 4)\nplt.xlabel('FPR', fontsize = 16)\nplt.ylabel('TPR', fontsize = 16)\nplt.title('ROC', fontsize = 16)\nplt.legend();\nplt.savefig(\"ROC cardio.jpeg\", bbox_inches='tight')","f6bc5532":"df_cap = df_reduced.sample(90,random_state=20)\ncap_X = df_cap.drop(\"y_uno\", axis=1)\ndf_cap.y_uno.value_counts()","58ddd6dd":"df_cap = df_reduced.sample(90,random_state=20)\ncap_X = df_cap.drop(\"y_uno\", axis=1)\nplt.figure(figsize = (10, 6))\nplt.plot([0,90], [0,44], 'r--')\nperfect_model = np.cumsum(np.repeat(1,44))\nperfect_model.resize(90)\nperfect_model[44:] = 44\nperfect_model\nplt.plot(perfect_model);\ndf_cap[\"probs\"] = clf.predict_proba(cap_X)[:, 1]\ndf_cap = df_cap.sort_values(by=\"probs\",ascending=False)\nprobs = np.cumsum(df_cap.y_uno).values\nplt.plot(probs, color=\"#098B4A\", label = label, linewidth = 4);\nplt.axvline(x=43, color=\"#100F3E\", linestyle='--',alpha=0.4)\nplt.axhline(y=probs[43], color=\"#100F3E\", linestyle='--',alpha=0.4);\nplt.xlabel('Total of people', fontsize = 16)\nplt.ylabel('Total of heart failure cases', fontsize = 16)\nplt.title('CAP', fontsize = 16)\nprint (probs[43]);","89fa3fe4":"**In this work i study the data to create a logistic model using Sklearn algorithms to predict heart failure deaths**","4da06006":"#### In general the data doesn't has a strong correlation with the variable to predict. The most correlated variables with deceased cases people:\n1. age\n2. ejection_fraction\n3. serum_creatinine\n4. serum_sodium\n4. time","d33a5a5c":"**Convert data to dummies**","6682b490":"**Categorical analysis**","7a1741b1":" **Data**\n 1. age: (quantitative)\n 2. anemia: Decrease of red blood cells or hemoglobin (categorical)\n 3. creatinine_phosphokinase: Level of the CPK enzyme in the blood (mcg\/L) (quantitative)\n 4. diabetes: If the patient has diabetes (categorical)\n 5. ejection_fraction: Percentage of blood leaving the heart at each contraction (quantitative)\n 6. high_blood_pressure: If the patient has hypertension (categorical)\n 7. platelets: Platelets in the blood (kiloplatelets\/mL) (quantitative)\n 8. serum_creatinine: Level of serum creatinine in the blood (mg\/dL) (quantitative)\n 9. serum_sodium: Level of serum sodium in the blood (mEq\/L) (quantitative)\n 10. sex: Woman or man (categorical)\n 11. smoking: If the patient smokes or not  (categorical)\n 12. time: Follow-up period (days) (quantitative)\n 13. DEATH_EVENT: If the patient deceased during the follow-up period (categorical) Value to predict\n \nThe data base has 13 columns with 299 patients cases, non mising values","fba5e425":"#### The difference between positive and negative cases its a problem for predictions, we can do an undersampling with \"0\" cases","d45e19c9":"**Quantitative analysis**"}}