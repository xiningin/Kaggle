{"cell_type":{"6264a906":"code","5be6c678":"code","8472627f":"code","ae545abf":"code","05598279":"code","d95cbccc":"code","8fb76ceb":"code","136f3a64":"code","696daefa":"code","7d46caae":"code","5174bf32":"code","faeaa6fb":"markdown"},"source":{"6264a906":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport cv2\nfrom ast import literal_eval","5be6c678":"train_df = pd.read_csv(\"..\/input\/global-wheat-detection\/train.csv\")\ntrain_df.head()","8472627f":"def convert(size, box):\n    dw = 1. \/ size[0]\n    dh = 1. \/ size[1]\n    x = (box[0] + box[1]) \/ 2.0\n    y = (box[2] + box[3]) \/ 2.0\n    w = box[1] - box[0]\n    h = box[3] - box[2]\n    x = x * dw\n    w = w * dw\n    y = y * dh\n    h = h * dh\n    return [x, y, w, h]\n\ndef convert_to_yolo_label(coco_format_box, w = 1024, h = 1024):\n    bbox = literal_eval(coco_format_box)\n    xmin = bbox[0]\n    xmax = bbox[0] + bbox[2]\n    ymin = bbox[1]\n    ymax = bbox[1] + bbox[3]\n    b = (float(xmin), float(xmax), float(ymin), float(ymax))\n    yolo_box = convert((w, h), b)\n    if np.max(yolo_box) > 1 or np.min(yolo_box) < 0: # Take this opportunity to check that conversion works\n        print(\"BOX HAS AN ISSUE\")\n    return yolo_box","ae545abf":"train_df['yolo_box'] = train_df.bbox.apply(convert_to_yolo_label)","05598279":"unique_img_ids = train_df.image_id.unique()","d95cbccc":"len(unique_img_ids)","8fb76ceb":"from tqdm import tqdm","136f3a64":"for img_id in tqdm(unique_img_ids):\n    filt_df = train_df.query(\"image_id == @img_id\")\n    all_boxes = filt_df.yolo_box.values\n    file_name = img_id+\".txt\"\n\n    s = \"0 %s %s %s %s \\n\"\n    with open(file_name, 'a') as file:\n        for i in all_boxes:\n            new_line = (s % tuple(i))\n            file.write(new_line)  ","696daefa":"import glob\nall_imgs = glob.glob(\"..\/input\/global-wheat-detection\/train\/*.jpg\")\nall_imgs = [i.split(\"\/\")[-1].replace(\".jpg\", \"\") for i in all_imgs]","7d46caae":"negative_images = set(all_imgs) - set(unique_img_ids)","5174bf32":"for i in tqdm(list(negative_images)):\n    file_name = i+\".txt\"\n    with open(file_name, 'w') as fp: \n        pass","faeaa6fb":"# Notebook for converting the bounding boxes as per YOLO format"}}