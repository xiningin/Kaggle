{"cell_type":{"7f730b37":"code","5693ca4b":"code","e7a9db22":"code","8ddd8719":"code","6c1c7038":"code","b762d97c":"code","d54adff8":"code","225a312a":"code","cd3be5a6":"code","9fd2e93b":"code","8a65adec":"code","a0633481":"code","101c9fe9":"code","641e3f02":"markdown","670b6b3c":"markdown","eba14007":"markdown","015357a6":"markdown","2fb37725":"markdown","ca0dd621":"markdown","fe6e4772":"markdown"},"source":{"7f730b37":"import numpy as np \nimport pandas as pd \nfrom pathlib import Path\n\nimport cufflinks as cf\n\n## (from https:\/\/www.kaggle.com\/hotessy\/sir-solver-hyperopt\/)\nfrom sir_solver_hyperopt import Learner","5693ca4b":"pd.set_option('display.max_rows', 500)\npd.set_option('use_inf_as_na', True)\ncf.set_config_file(offline=True, theme='solar');","e7a9db22":"path = Path(\"..\/input\/novel-corona-virus-2019-dataset\/\")","8ddd8719":"recovered_df = (pd.read_csv(path\/'time_series_covid_19_recovered.csv')\n                .drop(columns=['Lat', 'Long'])\n                .groupby('Country\/Region')\n                .sum())\n\ndeaths_df = (pd.read_csv(path\/'time_series_covid_19_deaths.csv')\n             .drop(columns=['Lat', 'Long'])\n             .groupby('Country\/Region')\n             .sum())\n\nconfirmed_df = (pd.read_csv(path\/'time_series_covid_19_confirmed.csv')\n                .drop(columns=['Lat', 'Long'])\n                .groupby('Country\/Region')\n                .sum())","6c1c7038":"class MyLearner(Learner):\n    \n    def __init__(self, country):\n        self.first_case_date = (confirmed_df.filter(items=[country], axis=0).iloc[0] > 0).idxmax()\n        super().__init__(country)\n    \n    def load_confirmed(self, country):\n        return confirmed_df.filter(items=[country], axis=0).iloc[0][self.first_case_date:]\n\n    def load_recovered(self, country):\n        return recovered_df.filter(items=[country], axis=0).iloc[0][self.first_case_date:]\n\n    def load_dead(self, country):\n        return deaths_df.filter(items=[country], axis=0).iloc[0][self.first_case_date:]","b762d97c":"learner = MyLearner('India')","d54adff8":"pd.DataFrame(data=[learner.infected, learner.recovered, learner.dead]).T.head()","225a312a":"first_case_date = (learner.infected > 0).idxmax()\nfirst_recovery_date = (learner.recovered > 0).idxmax()\n\ni_0 = learner.infected[first_case_date:].rolling(14).max().dropna()[0]\nr_0 = learner.recovered[first_recovery_date:].rolling(14).max().dropna()[0]\nd_0 = learner.dead[first_recovery_date:].rolling(14).max().dropna()[0]\n\nprint(i_0, r_0 + d_0)","cd3be5a6":"learner.train(s_0=1e4, i_0=1, r_0=1, weight=0.3, max_evals=50)","9fd2e93b":"print(learner.country.upper())\nprint(f\"\u0393 = {learner.\u0393}\")\nprint(f\"\u03b2 (standardised) = {learner.\u03b2}\")\nprint(f\"Reproduction Rate (standardised) = {learner.\u03b2\/learner.\u0393}\")","8a65adec":"fig, data = learner.plot()","a0633481":"data.to_csv(f'{learner.country}.csv')","101c9fe9":"fig.show()","641e3f02":"## Creating a `Learner` Instance \n\nFrom the script [sir_solver_hyperopt](https:\/\/www.kaggle.com\/hotessy\/sir-solver-hyperopt\/)","670b6b3c":"## Goal\n\n* In this kernel, I try to fit actual CoViD-19 data (by country) on the SIR-D model.\n\n* I use the Tree Parzen Estimator (TPE) algorithm, to calculate $\\beta$, $\\gamma$ and $\\delta$.\n\n* For an explanation of SIR(-D) model, play around with this interactive kernel: [Simple SIR w\/ equation solver](https:\/\/www.kaggle.com\/hotessy\/for-beginners-simple-sir-w-equation-solver)\n\n* Fork a version of this script, [SIR Solver Hyperopt](https:\/\/www.kaggle.com\/hotessy\/sir-solver-hyperopt\/), and add it as a utility script. The `Learner` class is implemented there.","eba14007":"## Reading CoViD-19 data","015357a6":"## Output","2fb37725":"## References:\n\n1. Theory:\n    1. https:\/\/www.maa.org\/book\/export\/html\/115606\n    2. https:\/\/kingaa.github.io\/clim-dis\/parest\/parest.html\n    3. https:\/\/web.stanford.edu\/~jhj1\/teachingdocs\/Jones-on-R0.pdf\n    4. https:\/\/www.nature.com\/articles\/srep46076.pdf\n    5. https:\/\/www.math.uzh.ch\/li\/index.php?file&key1=41327\n    \n    \n2. Code:\n    1. https:\/\/www.lewuathe.com\/covid-19-dynamics-with-sir-model.html\n    2. https:\/\/towardsdatascience.com\/infection-modeling-part-1-87e74645568a","ca0dd621":"## Training\n\n**Note**: This will take considerable time depending on the country and `max_evals`. It is better to commit the notebook and save the output as CSV","fe6e4772":"#### Considering Day 0 as the date when first infected patient was reported\n\nMaximum of 14 days is considered because experts say, the incubation time of the virus is between 1 to 14 days (5 days on average)."}}