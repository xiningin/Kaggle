{"cell_type":{"aebca061":"code","4946b121":"code","186eeb98":"code","3e656bd7":"code","197e3eb4":"code","5820e406":"code","d6a6dabc":"code","8bba8ca4":"code","ded07304":"code","e1083a74":"code","0f35935a":"code","7b2baec4":"code","3e989057":"code","316cc2ac":"code","14fa8a5c":"code","2eb865c7":"code","44817ccb":"code","d794d4d8":"code","4a81e65e":"code","66bd81af":"code","fbd9294c":"code","50689119":"code","87ed78ca":"code","1beeccdb":"code","c3d4f20b":"code","9059bd55":"code","2c039d1f":"code","48a0647a":"markdown","6bfe87d1":"markdown","04659551":"markdown","48f76395":"markdown","1a7c2d1d":"markdown","1a0655ec":"markdown","34ab756a":"markdown","20780979":"markdown","d35b5fb5":"markdown","adc55159":"markdown","35435578":"markdown","995bb981":"markdown","9abd1a9b":"markdown","487bb9d8":"markdown","035da16f":"markdown","9293942a":"markdown","1e6a6a98":"markdown","ee312fc0":"markdown","c94a9dab":"markdown","e58cbdaa":"markdown","199b850d":"markdown","41996d64":"markdown","6a27c4e3":"markdown","d3ac567b":"markdown","03b5d866":"markdown","eb2be243":"markdown","1cb158b4":"markdown","74bed759":"markdown","6285bb67":"markdown","d6a1cdd6":"markdown"},"source":{"aebca061":"# This code is used for loading in data from the Reddit comment database\n# Don't worry about the details of this code\n\nimport sqlite3\nimport pandas as pd\n\n\nsql_conn = sqlite3.connect('..\/input\/reddit-comments-may-2015\/database.sqlite')\n\ncomments = pd.read_sql(\"SELECT body FROM May2015 WHERE subreddit = 'timberwolves'\", sql_conn)\n\ncomments = comments[\"body\"]     # Convert from df to series\n\nprint(comments.shape)\ncomments.head(8)","4946b121":"comments[0].lower()      # Convert the first comment to lowercase","186eeb98":"comments.str.lower().head(8)  # Convert all comments to lowercase","3e656bd7":"comments.str.upper().head(8)  # Convert all comments to uppercase","197e3eb4":"comments.str.len().head(8)  # Get the length of all comments","5820e406":"comments.str.split(\" \").head(8)  # Split comments on spaces","d6a6dabc":"comments.str.strip(\"[]\").head(8)  # Strip leading and trailing brackets","8bba8ca4":"comments.str.cat()[0:500]   # Check the first 500 characters","ded07304":"comments.str.slice(0, 10).head(8)  # Slice the first 10 characters","e1083a74":"comments.str[0:10].head(8)  # Slice the first 10 characters","0f35935a":"comments.str.slice_replace(5, 10, \" Wolves Rule! \" ).head(8)","7b2baec4":"comments.str.replace(\"Wolves\", \"Pups\").head(8)","3e989057":"logical_index = comments.str.lower().str.contains(\"wigg|drew\")\n\ncomments[logical_index].head(10)    # Get first 10 comments about Wiggins","316cc2ac":"len(comments[logical_index])\/len(comments)","14fa8a5c":"my_series = pd.Series([\"will\",\"bill\",\"Till\",\"still\",\"gull\"])\n \nmy_series.str.contains(\".ill\")     # Match any substring ending in ill","2eb865c7":"my_series.str.contains(\"[Tt]ill\")   # Matches T or t followed by \"ill\"","44817ccb":"\"\"\"\nRegular expressions include several special character sets that allow to quickly specify certain common character types. They include:\n[a-z] - match any lowercase letter \n[A-Z] - match any uppercase letter \n[0-9] - match any digit \n[a-zA-Z0-9] - match any letter or digit\nAdding the \"^\" symbol inside the square brackets matches any characters NOT in the set:\n[^a-z] - match any character that is not a lowercase letter \n[^A-Z] - match any character that is not a uppercase letter \n[^0-9] - match any character that is not a digit \n[^a-zA-Z0-9] - match any character that is not a letter or digit\nPython regular expressions also include a shorthand for specifying common sequences:\n\\d - match any digit \n\\D - match any non digit \n\\w - match a word character\n\\W - match a non-word character \n\\s - match whitespace (spaces, tabs, newlines, etc.) \n\\S - match non-whitespace\n\"^\" - outside of square brackets, the caret symbol searches for matches at the beginning of a string:\n\"\"\"\n\nex_str1 = pd.Series([\"Where did he go\", \"He went to the mall\", \"he is good\"])\n\nex_str1.str.contains(\"^(He|he)\") # Matches He or he at the start of a string","d794d4d8":"ex_str1.str.contains(\"(go)$\") # Matches go at the end of a string","4a81e65e":"\"\"\"\n\"( )\" - parentheses in regular expressions are used for grouping and to enforce the proper order of operations just like they are in math and logical expressions. In the examples above, the parentheses let us group the or expressions so that the \"^\" and \"$\" symbols operate on the entire or statement.\n\"*\" - an asterisk matches zero or more copies of the preceding character\n\"?\" - a question mark matches zero or 1 copy of the preceding character\n\"+\" - a plus matches 1 more copies of the preceding character\n\"\"\"\n\n\nex_str2 = pd.Series([\"abdominal\",\"b\",\"aa\",\"abbcc\",\"aba\"])\n\n# Match 0 or more a's, a single b, then 1 or characters\nex_str2.str.contains(\"a*b.+\") ","66bd81af":"# Match 1 or more a's, an optional b, then 1 or a's\nex_str2.str.contains(\"a+b?a+\")","fbd9294c":"\"\"\"\n\"{ }\" - curly braces match a preceding character for a specified number of repetitions:\n\"{m}\" - the preceding element is matched m times\n\"{m,}\" - the preceding element is matched m times or more\n\"{m,n}\" - the preceding element is matched between m and n times\n\"\"\"\n\nex_str3 = pd.Series([\"aabcbcb\",\"abbb\",\"abbaab\",\"aabb\"])\n\nex_str3.str.contains(\"a{2}b{2,}\")    # Match 2 a's then 2 or more b's","50689119":"ex_str4 = pd.Series([\"Mr. Ed\",\"Dr. Mario\",\"Miss\\Mrs Granger.\"])\n\nex_str4.str.contains(\"\\. \") # Match a single period and then a space","87ed78ca":"ex_str4.str.contains(r\"\\\\\") # Match strings containing a backslash","1beeccdb":"comments.str.count(r\"[Ww]olves\").head(8)","c3d4f20b":"comments.str.findall(r\"[Ww]olves\").head(8)","9059bd55":"web_links = comments.str.contains(r\"https?:\")\n\nposts_with_links = comments[web_links]\n\nprint( len(posts_with_links))\n\nposts_with_links.head(5)","2c039d1f":"only_links = posts_with_links.str.findall(r\"https?:[^ \\n\\)]+\")\n\nonly_links.head(10)","48a0647a":"\"\\\" - backslash let you \"escape\" metacharacters. You must escape metacharacters when you actually want to match the metacharacter symbol itself. For instance, if you want to match periods you can't use \".\" because it is a metacharacter that matches anything. Instead, you'd use \".\" to escape the period's metacharacter behavior and match the period itself:","6bfe87d1":"The pattern we used to match web links may look confusing, so let's go over it step by step.\n\nFirst the pattern matches the exact characters \"http\", an optional \"s\" and then \":\".\n\nNext, with [^ \\n)], we create a set of characters to match. Since our set starts with \"^\", we are actually matching the negation of the set. In this case, the set is the space character, the newline character \"\\n\" and the closing parenthesis character \")\". We had to escape the closing parenthesis character by writing \")\". Since we are matching the negation, this set matches any character that is NOT a space, newline or closing parenthesis. Finally, the \"+\" at the end matches this set 1 or more times.\n\nTo summarize, the regex matches http: or https: at the start and then any number of characters until it encounters a space, newline or closing parenthesis. This regex isn't perfect: a web address could contain parentheses and a space, newline or closing parenthesis might not be the only characters that mark the end of a web link in a comment. It is good enough for this small data set, but for a serious project we would probably want something a little more specific to handle such corner cases.\n\nComplex regular expressions can be difficult to write and confusing to read. Sometimes it is easiest to simply search the web for a regular expression to perform a common task instead of writing one from scratch. You can test and troubleshoot Python regular expressions using [this](https:\/\/regex101.com\/#python) online tool.\n\n*Note: If you copy a regex written for another language it might not work in Python without some modifications.","04659551":"Replace a slice with a new substring using str.slice_replace():","48f76395":"A common operation when working with text data is to test whether character strings contain a certain substring or pattern of characters. For instance, if we were only interested in posts about Andrew Wiggins, we'd need to match all posts that make mention of him and avoid matching posts that don't mention him. Use series.str.contains() to get a series of true\/false values that indicate whether each string contains a given substring:","1a7c2d1d":"## Next Lesson: [Python for Data 16: Preparing Numeric Data](https:\/\/www.kaggle.com\/hamelg\/python-for-data-16-preparing-numeric-data)\n[back to index](https:\/\/www.kaggle.com\/hamelg\/python-for-data-analysis-index)","1a0655ec":"\"[ ]\" - Square brackets specify a set of characters to match:","34ab756a":"Combine all the strings in a series together into a single string with series.str.cat():","20780979":"It looks like about 6.6% of comments make mention of Andrew Wiggins. Notice that this string pattern argument we supplied to str.contains() wasn't just a simple substring. Posts about Andrew Wiggins could use any number of different names to refer to him--Wiggins, Andrew, Wigg, Drew--so we needed something a little more flexible than a single substring to match the all posts we're interested in. The pattern we supplied is a simple example of a regular expression.","d35b5fb5":"Pandas has a few more useful string functions, but before we go any further, we need to learn about regular expressions. A regular expression or regex is a sequence of characters and special meta characters used to match a set of character strings. Regular expressions allow you to be more expressive with string matching operations than just providing a simple substring. A regular expression lets you define a \"pattern\" that can match strings of different lengths, made up of different characters.\n\nIn the str.contains() example above, we supplied the regular expression: \"wigg|drew\". In this case, the vertical bar | is a metacharacter that acts as the \"or\" operator, so this regular expression matches any string that contains the substring \"wigg\" or \"drew\".\n\nWhen you provide a regular expression that contains no metacharacters, it simply matches the exact substring. For instance, \"Wiggins\" would only match strings containing the exact substring \"Wiggins.\" Metacharacters let you change how you make matches. Here is a list of basic metacharacters and what they do:\n\n\".\" - The period is a metacharacter that matches any character other than a newline:","adc55159":"## Wrap Up","35435578":"Raw strings are often used for regular expression patterns because they avoid issues that may that arise when dealing with special string characters.\n\nThere are more regular expression intricacies we won't cover here, but combinations of the few symbols we've covered give you a great amount of expressive power. Regular expressions are commonly used to perform tasks like matching phone numbers, email addresses and web addresses in blocks of text.\n\nTo use regular expressions outside of pandas, you can import the regular expression library with: import re.\n\nPandas has several string functions that accept regex patterns and perform an operation on each string in series. We already saw two such functions: series.str.contains() and series.str.replace(). Let's go back to our basketball comments and explore some of these functions.\n\nUse series.str.count() to count the occurrences of a pattern in each string:","995bb981":"It appears the comments we've returned all contain web links. It is possible that a post could contain the string \"http:\" without actually having a web link. If we wanted to reduce this possibility, we'd have to be more specific with our regular expression pattern, but in the case of a basketball-themed forum, it is pretty unlikely.\n\nNow that we've identified posts that contain web links, let's extract the links themselves. Many of the posts contain both web links and a bunch of text the user wrote. We want to get rid of the text keep the web links. We can do with with series.str.findall():","9abd1a9b":"Use series.str.findall() to get each matched substring and return the result as a list:","487bb9d8":"\"$\" - searches for matches at the end of a string:","035da16f":"In this lesson, we learned several functions for dealing with text data in Python and introduced regular expressions, a powerful tool for matching substrings in text. Regular expressions are used in many programming languages and although the syntax for regex varies a bit for one language to another, the basic constructs are similar across languages.\n\nNext time we'll turn our attention to cleaning and preparing numeric data.","9293942a":"Pandas also supports str.upper() and str.len():","1e6a6a98":"## Pandas String Functions","ee312fc0":"If you want to match the escape character backslash itself, you either have to use four backslashes \"\\\\\" or encode the string as a raw string of the form r\"mystring\" and then use double backslashes. Raw strings are an alternate string representation in Python that simplify some oddities in performing regular expressions on normal strings. Read more about them here.","c94a9dab":"Now it's time to use some of the new tools we have in our toolbox on the Reddit comment data. Let's say we are only interested in posts that contain web links. If we want to narrow down comments to only those with web links, we'll need to match comments that agree with some pattern that expresses the textual form of a web link. Let's try using a simple regular expression to find posts with web links.\n\nWeb links begin with \"http:\" or \"https:\" so let's make a regular expression that matches those substrings:","e58cbdaa":"Replace the occurences of a given substring with a different substring using str.replace():","199b850d":"The text in these comments is pretty messy. We see everything from long paragraphs to web links to text emoticons. We already learned about a variety of basic string processing functions in lesson 6; pandas extends built in string functions that operate on entire series of strings.","41996d64":"## Regular Expressions","6a27c4e3":"# Python for Data 15: Working With Text Data\n[back to index](https:\/\/www.kaggle.com\/hamelg\/python-for-data-analysis-index)","d3ac567b":"You can slice each string in a series and return the result in an elementwise fasion with series.str.slice():","03b5d866":"Alternatively, you can use indexing after series.str to take slices:","eb2be243":"Last lesson we learned that there are a lot of questions to consider when you first look at a data set, including whether you should clean or transform the data. We touched briefly on a few basic operations to prepare data for analysis, but the Titanic data set was pretty clean to begin with. Data you encounter in the wild won't always be so friendly. Text data in particular can be extremely messy and difficult to work with because it can contain all sorts of characters and symbols that may have little meaning for your analysis. This lesson will cover some basic techniques and functions for working with text data in Python.\n\nTo start, we'll need some text data that is a little messier than the names in the Titanic data set. As it happens, Kaggle has a data exploration competition giving users access to a database of comments made on Reddit.com during the month of May 2015. Since the Minnesota Timberwolves are my favorite basketball team, let's extract the comments from the team's fan subreddit and use it as an example of messy text for this lesson.\n\nLet's start by loading the data and checking its structure and a few of the comments:","1cb158b4":"For interest's sake, let's also calculate the ratio of comments that mention Andrew Wiggins:","74bed759":"The string splitting and stripping functions also have pandas equivalents:","6285bb67":"## Getting Posts with Web Links","d6a1cdd6":"String functions in pandas mirror built in string functions and many have the same name as their singular counterparts. For example, str.lower() converts a single string to lowercase, while series.str.lower() converts all the strings in a series to lowercase:"}}