{"cell_type":{"8a6b76b2":"code","91beebaa":"code","1fc05483":"code","82dd4a5d":"code","28d2a8c8":"code","e676ff3a":"code","db3b922c":"code","32419fc2":"code","a3b038e8":"code","91be47d5":"code","7bfef156":"code","e0b9c80c":"code","8ab32e96":"code","8f1eb0a4":"code","4eabc146":"code","6b67136f":"code","f1076f48":"code","4f07721a":"code","7e572ece":"code","da50e8ab":"code","febc9f29":"code","8550d1da":"markdown","de88d34c":"markdown","d2259447":"markdown","4fde18f1":"markdown","7d4eedf8":"markdown","6189f08b":"markdown","a701fbb4":"markdown","45f5271e":"markdown","8d1c237a":"markdown","93d831ae":"markdown","3821afa7":"markdown","c1add0f9":"markdown","36fa25d6":"markdown","5122ee2d":"markdown","1071881e":"markdown","8043e21a":"markdown","79ef3757":"markdown","1e0357f7":"markdown","1c3a6290":"markdown","e426720c":"markdown","ff5ed02b":"markdown"},"source":{"8a6b76b2":"import pandas as pd\n\ndata = pd.read_csv('..\/input\/fish-market\/Fish.csv')\ndata.head()","91beebaa":"data.rename(columns={\"Length1\": \"Vlength\", \"Length2\": \"Dlength\", \"Length3\": \"Clength\"},inplace=True)\ndata.head()","1fc05483":"data.shape","82dd4a5d":"for col in data.columns:\n    print('Column {} has {} missing values'.format(col,data[col].isnull().sum()))","28d2a8c8":"for col in data.columns:\n    print('Column {} type is {}'.format(col,data[col].dtype))","e676ff3a":"data['Species'].value_counts()","db3b922c":"data.describe()","32419fc2":"%matplotlib inline\nimport matplotlib.pyplot as plt\nimport seaborn as sns; sns.set()\n\nplt.figure(figsize=(10,5))\nsns.scatterplot(x=\"Weight\", y=\"Height\", hue=\"Species\" ,data=data)","a3b038e8":"f,ax=plt.subplots(figsize=(10,5))\nsns.heatmap(data.corr(), annot=True, cmap='YlGnBu')\nplt.show()","91be47d5":"fig, axes = plt.subplots(3, 2, figsize=(20,10))\n\nax = sns.boxplot(x=\"Species\", y=\"Weight\", data=data, orient='v', \n    ax=axes[0, 0])\nax = sns.boxplot(x=\"Species\", y=\"Height\", data=data, orient='v', \n    ax=axes[0, 1])\nax = sns.boxplot(x=\"Species\", y=\"Vlength\", data=data, orient='v', \n    ax=axes[1, 0])\nax = sns.boxplot(x=\"Species\", y=\"Width\", data=data, orient='v', \n    ax=axes[1, 1])\nax = sns.boxplot(x=\"Species\", y=\"Dlength\", data=data, orient='v', \n    ax=axes[2, 0])\nax = sns.boxplot(x=\"Species\", y=\"Clength\", data=data, orient='v', \n    ax=axes[2, 1])","7bfef156":"data.columns[1:]","e0b9c80c":"outliers_index=[]\nfor dim in data.columns[1:]:   # to exclude species column\n    for species in ['Roach','Smelt','Pike']:\n        print('Outliers for {} in {} dimension'.format(species,dim))\n        col=data[data['Species']==species][dim]\n        Q1 = col.quantile(0.25)\n        Q3 = col.quantile(0.75)\n        IQR = Q3 - Q1\n        outliers = col[(col < Q1 - (1.5 * IQR)) | (col > Q3 + (1.5 * IQR))]\n        for index,outlier in zip(outliers.index,outliers):\n            outliers_index.append(index) if index not in outliers_index else None\n            print(index,outlier) \n    print(\"\")","8ab32e96":"data.drop(outliers_index, inplace=True)\ndata.shape","8f1eb0a4":"y = data.Weight\nX = data.loc[:,data.columns != 'Weight']","4eabc146":"X=pd.get_dummies(X, columns=[\"Species\"])\nX=X.iloc[:,:-1] # remove the last column to avoid dummy variable trap\nX.head()","6b67136f":"from sklearn.model_selection import train_test_split\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=77, shuffle=True)","f1076f48":"from sklearn.linear_model import LinearRegression\nfrom sklearn.metrics import mean_squared_error, r2_score\n\nmodel = LinearRegression() # Tried to normalize the dataset but actually results do not improve that much \nmodel.fit(X_train, y_train)\ny_pred = model.predict(X_test)\nprint(r2_score(y_test, y_pred))","4f07721a":"residuals = y_test-y_pred\nplt.figure(figsize=(12,5))\nplt.axhline(y=0,color=\"black\")\nplt.scatter(y_pred,residuals)","7e572ece":"fig, axes = plt.subplots(3, 2, figsize=(20,15))\n\ny_pred=y_pred.reshape(len(y_pred),)\n\nax = sns.scatterplot(x=X_test['Height'], y=y_pred, ax=axes[0, 0])\nax = sns.scatterplot(x=X_test[\"Height\"], y=y_test, ax=axes[0, 0])\nax = sns.scatterplot(x=X_test['Vlength'], y=y_pred, ax=axes[0, 1])\nax = sns.scatterplot(x=X_test[\"Vlength\"], y=y_test, ax=axes[0, 1])\nax = sns.scatterplot(x=X_test['Dlength'], y=y_pred, ax=axes[1, 0])\nax = sns.scatterplot(x=X_test[\"Dlength\"], y=y_test, ax=axes[1, 0])\nax = sns.scatterplot(x=X_test['Clength'], y=y_pred, ax=axes[1, 1])\nax = sns.scatterplot(x=X_test[\"Clength\"], y=y_test, ax=axes[1, 1])\nax = sns.scatterplot(x=X_test['Width'], y=y_pred, ax=axes[2, 0])\nax = sns.scatterplot(x=X_test[\"Width\"], y=y_test, ax=axes[2, 0])","da50e8ab":"params = pd.Series(model.coef_.flatten(), index=X_test.columns)\nparams","febc9f29":"print(\"y = {} + {}x1 + {}x2 + {}x3 + {}x4 {}x5 + {}x6 + {}x7 {}x8 + {}x9 + {}x10\".format(round(params[0]),round(params[1],2),round(params[2],2),round(params[3],2),round(params[4],2),round(params[5],2),round(params[6],2),round(params[7],2),round(params[8],2),round(params[9],2),round(params[10],2)))","8550d1da":"Lets also plot the formula of the linear regression fitted into this model","de88d34c":"Descriptive analysis of each one of the numerical features available","d2259447":"It seems that on the majority of time we have some outliers for Roach and Smelt species. These outliers can also be found across multiple dimensions and always for the same spceies which is a good indication that in fact, these so called outliers are really outliers. Lets indentify to which rows they belong ","4fde18f1":"Lets rename the length columns","7d4eedf8":"As we can see, the feature that has the biggest contribuition to the overall model is the Species Smelt. This makes a lot of sense since the smelt species has a lot of different characteristics that differientate it from all the other ones. The height weight plot showcased above proves it, where we can clearly see that this fish is a lot smaller than the others, and therefore presents a weight that is completely different from the other fishes. Dlength and Clength also present some contribuition to the overall weight prediciton. ","6189f08b":"### Modelling","a701fbb4":"### Explore the data\n\nLets investigate the provided dataset. First lets see the number of missing values in each column","45f5271e":"It seems that the outliers here are mostly common to every dimension. For roach we have rows 35,40,52,53,54 as outliers and for smelt we have rows 157 and 158. Lets remove them from the data.","8d1c237a":"# Fish market analysis\n\nThis dataset is a record of 7 common different fish species in fish market sales. With this dataset, a predictive model can be performed using machine friendly data and estimate the weight of fish can be predicted.\n\n##### Columns\n- __Species__: species name of fish\n- **Weight**: weight of fish in Gram *g*\n- __Length1__: vertical length in *cm*\n- __Length2__: diagonal length in *cm*\n- __Length3__: cross length in *cm*\n- __Height__: height in *cm*\n- __Widthd__: iagonal width in *cm*","93d831ae":"Now divide the dataset in X_train and X_test and Y_train and Y_test","3821afa7":"As it is possible to see, on the above table, the min weight present in the dataset is 0 which is obviously a bit strange. lets plot weight by height and check what we have","c1add0f9":"### Preprocessing \n\nWe have to encode the cartegorical feature Species, divide the dataset into train and test and finally standardize all the numeric features. ","36fa25d6":"The residual plot looks to have some randomness associated which is an indicator of non bias inclusion. Lets plot the results of the prediction for every feature","5122ee2d":"Now applying a linear regression model to the data","1071881e":"## Modelling - Weight Prediction\n\nNow we are going to attempt to predict the weight of a given fish. First lets divide data in target and train vectors","8043e21a":"There are no missing values in any of the dataset columns. Lets check also the type of each column","79ef3757":"### Outlier Detection\n\nLets create a box plot for each column of the dataset and showcase the outliers per species","1e0357f7":"Plotting the residuals to investigate if the model is being biased or not","1c3a6290":"Correlation of variables","e426720c":"Number of available species and number of individuals in each one","ff5ed02b":"It seems that for the Roach species we clearly have an outlier with 0 in weight. For Smelt the majority of individuals has a weight close to zero (probably a small fish). Also in terms of correlation between diferent dimensions we can say that all the lenghts are extremely correlated and may be reduced in the final model. Lets investigate the outliers available in the dataset"}}