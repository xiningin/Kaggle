{"cell_type":{"8ed6f536":"code","711774d5":"code","0c27d9b1":"code","3185c30b":"code","a707f874":"code","83d0039b":"code","f28210fe":"code","4373351c":"code","f9f4c714":"code","c18f83d9":"code","2cc44d3c":"code","b264505f":"code","881fe946":"code","690818d2":"code","da39b448":"code","54366afa":"code","ca349de5":"code","00315655":"code","d64edca8":"code","3c02bbd5":"code","65619eef":"code","05a33d48":"code","5dbedb7c":"code","ff807ac6":"code","1cf519b6":"code","8d72418c":"markdown","70bf959b":"markdown","e3e4d15d":"markdown","fd055bbb":"markdown","6403aa30":"markdown","ec719321":"markdown","2558a491":"markdown","5f303dd8":"markdown"},"source":{"8ed6f536":"import numpy as np \nimport pandas as pd\nimport os\nimport matplotlib.pyplot as plt\nimport seaborn as sns \nimport datetime as dt\n%matplotlib inline\nimport datetime as dt\nimport plotly.graph_objs as go\nimport plotly.figure_factory as ff\nfrom plotly import tools\nfrom plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot\nfrom shapely.geometry import shape, Point, Polygon\nimport folium\nfrom folium.plugins import HeatMap, HeatMapWithTime\ninit_notebook_mode(connected=True)","711774d5":"data_folder = \"\/kaggle\/input\/local-elections-romania-2020\/\"\ndata_files = os.listdir(data_folder)\n\ndata_df = pd.DataFrame()\nfor data_file in data_files:\n    date_hour = data_file.split(\"_\")\n    date = date_hour[1]\n    hour = date_hour[2].split(\"-\")[0]\n    print(date, hour)\n    _df = pd.read_csv(os.path.join(data_folder, data_file))\n    _df['date'] = date\n    _df['hour'] = hour\n    data_df = data_df.append(_df)\n","0c27d9b1":"print(list(data_df.columns))","3185c30b":"data_df[['Judet', 'UAT', 'Localitate', 'Siruta', 'Nr sectie de votare',\n       'Nume sectie de votare', 'Mediu', 'Votanti pe lista permanenta',\n       'Votanti pe lista complementara', 'LP', 'LC', 'LS', 'UM', 'LT', 'hour']].head()","a707f874":"lt_hour_judet_df = data_df.groupby([\"Judet\", \"hour\"])[\"LT\"].sum().reset_index()\nlt_hour_judet_df.columns = [\"Judet\", \"Hour\", \"Total\"]","83d0039b":"max_hour = lt_hour_judet_df['Hour'].max()\nprint(\"Last hour: \", max_hour)","f28210fe":"\nd_df = lt_hour_judet_df.loc[lt_hour_judet_df.Hour==max_hour]\nd_df = d_df.sort_values(by=['Total'], ascending = False)\n\nhover_text = []\nfor index, row in d_df.iterrows():\n    hover_text.append(('Judet: {}<br>'+\n                      'Votanti: {}').format(row['Judet'], row['Total']))\nd_df['hover_text'] = hover_text\n\n    \ntrace = go.Bar(\n    x = d_df['Judet'],y = d_df['Total'],\n    name='Total',\n    marker=dict(color='Red'),\n    text = hover_text,\n)\n\ndata = [trace]\nlayout = dict(title = 'Numar total votanti \/ judet',\n          xaxis = dict(title = 'Judet', showticklabels=True),\n          yaxis = dict(title = 'Numar total votanti'),\n          hovermode = 'closest',\n         )\nfig = dict(data=data, layout=layout)\niplot(fig, filename='alegeri-locale-2020')","4373351c":"d_df = lt_hour_judet_df.copy()\nd_df = d_df.loc[d_df['Total']>0]\ncounties = list(d_df.Judet.unique())\n\ndata = []\nfor county in counties:\n    dc_df = d_df.loc[d_df.Judet==county]\n    traceC = go.Scatter(\n        x = dc_df['Hour'],y = dc_df['Total'],\n        name=county,\n        mode = \"markers+lines\",\n        text=dc_df['Total']\n    )\n    data.append(traceC)\n\nlayout = dict(title = 'Numar total votanti \/ judet (log scale)',\n          xaxis = dict(title = 'Ora', showticklabels=True), \n          yaxis = dict(title = 'Total votanti (log scale)'),\n          yaxis_type=\"log\",\n          hovermode = 'y',\n          height=1000\n         )\n\nfig = dict(data=data, layout=layout)\niplot(fig, filename='alegeri-locale-2020')","f9f4c714":"total_list_df = data_df.loc[data_df['hour']=='12']\ntotal_list_df = total_list_df.groupby(['Judet', 'hour'])['Votanti pe lista permanenta'].sum().reset_index()\ntotal_list_df.columns = ['Judet', 'Hour', 'TLP']\ntotal_list_df.head()","c18f83d9":"lt_hour_judet_df = lt_hour_judet_df.merge(total_list_df[['Judet', 'TLP']], on=['Judet'])","2cc44d3c":"lt_hour_judet_df['Percent'] = lt_hour_judet_df['Total'] \/ lt_hour_judet_df['TLP']","b264505f":"d_df = lt_hour_judet_df.loc[lt_hour_judet_df.Hour==max_hour]\nd_df = d_df.sort_values(by=['Percent'], ascending = False)\n\nhover_text = []\nfor index, row in d_df.iterrows():\n    hover_text.append(('Judet: {}<br>'+\n                      'Procent votanti: {}').format(row['Judet'], row['Percent']))\nd_df['hover_text'] = hover_text\n\n    \ntrace = go.Bar(\n    x = d_df['Judet'],y = d_df['Percent'],\n    name='Percent',\n    marker=dict(color='Red'),\n    text = hover_text,\n)\n\ndata = [trace]\nlayout = dict(title = 'Procent votanti din numarul total votanti pe lista principala \/ judet',\n          xaxis = dict(title = 'Judet', showticklabels=True),\n          yaxis = dict(title = 'Procent votanti'),\n          hovermode = 'closest',\n         )\nfig = dict(data=data, layout=layout)\niplot(fig, filename='alegeri-locale-2020-procent')","881fe946":"d_df = lt_hour_judet_df.copy()\nd_df = d_df.loc[d_df['Percent']>0]\ncounties = list(d_df.Judet.unique())\n\ndata = []\nfor county in counties:\n    dc_df = d_df.loc[d_df.Judet==county]\n    traceC = go.Scatter(\n        x = dc_df['Hour'],y = dc_df['Percent'],\n        name=county,\n        mode = \"markers+lines\",\n        text=dc_df['Percent']\n    )\n    data.append(traceC)\n\nlayout = dict(title = 'Procent votanti din numarul total de votanti pe liste principale \/ judet',\n          xaxis = dict(title = 'Ora', showticklabels=True), \n          yaxis = dict(title = 'Procent votanti'),\n          hovermode = 'y',\n          height=1000\n         )\n\nfig = dict(data=data, layout=layout)\niplot(fig, filename='alegeri-locale-2020-procent-votanti')","690818d2":"b_df = data_df.loc[data_df.Judet=='B']\nlt_hour_df = b_df.groupby([\"UAT\", \"hour\"])[\"LT\"].sum().reset_index()\nlt_hour_df.columns = [\"UAT\", \"Hour\", \"Total\"]\n","da39b448":"lt_hour_df.head()","54366afa":"total_b_df = b_df.loc[b_df['hour']=='12']\ntotal_b_df = total_b_df.groupby(['UAT', 'hour'])['Votanti pe lista permanenta'].sum().reset_index()\ntotal_b_df.columns = ['UAT', 'Hour', 'TLP']\ntotal_b_df.head(6)","ca349de5":"lt_hour_df = lt_hour_df.merge(total_b_df[['UAT', 'TLP']], on=['UAT'])\nlt_hour_df['Percent'] = lt_hour_df['Total'] \/ lt_hour_df['TLP']","00315655":"d_df = lt_hour_df.loc[lt_hour_df.Hour==max_hour]\nd_df = d_df.sort_values(by=['Percent'], ascending = False)\n\nhover_text = []\nfor index, row in d_df.iterrows():\n    hover_text.append(('Sector: {}<br>'+\n                      'Procent votanti: {}').format(row['UAT'], row['Percent']))\nd_df['hover_text'] = hover_text\n\n    \ntrace = go.Bar(\n    x = d_df['UAT'],y = d_df['Percent'],\n    name='Percent',\n    marker=dict(color='Blue'),\n    text = hover_text,\n)\n\ndata = [trace]\nlayout = dict(title = 'Procent votanti din numarul total votanti pe lista principala \/ UAT',\n          xaxis = dict(title = 'Sector', showticklabels=True),\n          yaxis = dict(title = 'Procent votanti'),\n          hovermode = 'closest',\n         )\nfig = dict(data=data, layout=layout)\niplot(fig, filename='alegeri-locale-2020-procent')","d64edca8":"d_df = lt_hour_df.copy()\nd_df = d_df.loc[d_df['Percent']>0]\nuats = list(d_df.UAT.unique())\n\ndata = []\nfor uat in uats:\n    dc_df = d_df.loc[d_df.UAT==uat]\n    traceC = go.Scatter(\n        x = dc_df['Hour'],y = dc_df['Percent'],\n        name=uat,\n        mode = \"markers+lines\",\n        text=dc_df['Percent']\n    )\n    data.append(traceC)\n\nlayout = dict(title = 'Bucuresti: procent votanti din numarul total de votanti pe liste principale \/ Sector',\n          xaxis = dict(title = 'Ora', showticklabels=True), \n          yaxis = dict(title = 'Procent votanti'),\n          hovermode = 'y',\n          height=800\n         )\n\nfig = dict(data=data, layout=layout)\niplot(fig, filename='alegeri-locale-2020-procent-votanti')","3c02bbd5":"columns = ['Judet', 'UAT', 'Barbati 18-24','Barbati 25-34', 'Barbati 35-44', 'Barbati 45-64', 'Barbati 65+',\n 'Femei 18-24', 'Femei 25-34', 'Femei 35-44', 'Femei 45-64', 'Femei 65+','hour']\nbsa_df = b_df[columns]","65619eef":"bsa_df","05a33d48":"absa_df = bsa_df.groupby(['hour']).sum().reset_index()","5dbedb7c":"d_df = absa_df.copy()\ndata = []\nfor column in absa_df.columns[1:6]:\n    trace = go.Bar(\n        x = d_df['hour'],y = d_df[column],\n        name=column,\n        marker=dict(color='Blue'),\n        text = column,\n    )\n    data.append(trace)\nfor column in absa_df.columns[6:]:\n    trace = go.Bar(\n        x = d_df['hour'],y = d_df[column],\n        name=column,\n        marker=dict(color='Red'),\n        text = column,\n    )\n    data.append(trace)    \nlayout = dict(title = 'Votanti Bucuresti - pe grupe de varsta si sex',\n          xaxis = dict(title = 'Ora', showticklabels=True),\n          yaxis = dict(title = 'Numar votanti - pe grupe de varsta si sex'),\n          hovermode = 'closest',\n         )\nfig = dict(data=data, layout=layout)\niplot(fig, filename='alegeri-locale-2020-procent')","ff807ac6":"colors = ['lightblue', 'aquamarine', 'blue', 'darkblue', 'black']\ncolors_r = ['yellow', 'orange', 'tomato', 'red', 'darkred']\nd_df = bsa_df.loc[bsa_df.UAT=='BUCURE\u015eTI SECTORUL 6'].groupby(['hour']).sum().reset_index().copy()\ndata = []\nfor i, column in enumerate(absa_df.columns[1:6]):\n    trace = go.Bar(\n        x = d_df['hour'],y = d_df[column],\n        name=column,\n        marker=dict(color=colors[i]),\n        text = column,\n    )\n    data.append(trace)\nfor i, column in enumerate(absa_df.columns[6:]):\n    trace = go.Bar(\n        x = d_df['hour'],y = d_df[column],\n        name=column,\n        marker=dict(color=colors_r[i]),\n        text = column,\n    )\n    data.append(trace)    \nlayout = dict(title = 'Votanti Sectorul 6 - pe grupe de varsta si sex',\n          xaxis = dict(title = 'Ora', showticklabels=True),\n          yaxis = dict(title = 'Numar votanti - pe grupe de varsta si sex'),\n          hovermode = 'closest',\n         )\nfig = dict(data=data, layout=layout)\niplot(fig, filename='alegeri-locale-2020-procent')","1cf519b6":"d_df = bsa_df.loc[bsa_df.hour==max_hour].groupby(['UAT']).sum().reset_index().copy()\ndata = []\nfor i, column in enumerate(absa_df.columns[1:6]):\n    trace = go.Bar(\n        x = d_df['UAT'],y = d_df[column],\n        name=column,\n        marker=dict(color=colors[i]),\n        text = column,\n    )\n    data.append(trace)\nfor i, column in enumerate(absa_df.columns[6:]):\n    trace = go.Bar(\n        x = d_df['UAT'],y = d_df[column],\n        name=column,\n        marker=dict(color=colors_r[i]),\n        text = column,\n    )\n    data.append(trace)    \nlayout = dict(title = 'Votanti Bucuresti grupati pe sectoare, grupe de varsta si sex',\n          xaxis = dict(title = 'Sector', showticklabels=True),\n          yaxis = dict(title = 'Numar votanti - pe sectoare, grupe de varsta si sex'),\n          hovermode = 'closest',\n         )\nfig = dict(data=data, layout=layout)\niplot(fig, filename='alegeri-locale-2020-procent')","8d72418c":"![](http:\/\/stiri.botosani.ro\/media\/images\/articles\/big\/peste-7400-de-botosaneni-au-votat-in-prima-ora-de-la-deschiderea-urnelor-uQY.jpg)\n\n\nThis is a hour-by-hour analysis of presence at voting stations for the local elections 2020 in Romania.","70bf959b":"## 1. Load packages","e3e4d15d":"## 3. Data visualization\n\n\n### 3.1. Voters per county (Judet)","fd055bbb":"\nThe files contains the voters count, aggregated on polling station (sectie de votare), but also the higher order teritorial unities: county (Judet), community (UAT). It is specified as well if the locality is a town or village (Mediu). Then, the voters information is structured as following:\n- Votanti pe lista permanents = Voters on permanent list;  \n- Votanti pe liste complementare = Voters on complementary list;  \n- LP = Votes on permanent list;  \n- LC = Votes on complementary list;  \n- LS = Votes on special list;  \n- UM = Mobile polling (for citizens unable to walk to the polling station); \n\nFurthermore, the voters number is specified as well on sex and age, in a number of additional columns, with the columns encoding as following: `sex age`. Sex is either `Barbati` (men) or `Femei` (women) and age is explicit.\n\nWe added 2 more columns to the data files, from the file name we aggregated here:\n- hour;  \n- day;  \n","6403aa30":"### 3.3. Bucharest voters per age and sex\n\n","ec719321":"Let's inspect the data columns.","2558a491":"## 2. Load and prepare the data","5f303dd8":"### 3.2. Bucharest only"}}