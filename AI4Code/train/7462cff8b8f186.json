{"cell_type":{"dc29543a":"code","aeae7298":"code","63a7c071":"code","27d8a3e0":"code","9f50f8ec":"code","7008af5d":"code","4863fb69":"code","1d1fdfc8":"code","0865c89d":"code","9bbfe2f8":"code","f32bebe1":"code","2299f937":"code","3e6f786d":"code","19fb3492":"code","489d121a":"code","e0d0d4a5":"code","a01a296d":"code","2adbbbb1":"code","9aa82025":"code","acddd36a":"code","2efb0802":"code","03b8a2d8":"markdown","18dd19b7":"markdown","351ddb07":"markdown","d9473b76":"markdown","f6b31aa8":"markdown","6d142919":"markdown","b75c8fab":"markdown","70ca508c":"markdown","c5cc0862":"markdown","83eefc7c":"markdown","7f131d2c":"markdown","e42a09ca":"markdown","06804789":"markdown","c2e44ea7":"markdown","95b754f6":"markdown","41efb4ad":"markdown"},"source":{"dc29543a":"import pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Libraries for numerical alculations\nimport numpy as np # linear algebra\nfrom math import radians, cos, sin, asin, sqrt\n\nfrom tqdm import tqdm\n\n# Visualizations\nimport matplotlib.pyplot as plt\nfrom matplotlib.patches import Rectangle, Circle, RegularPolygon\nfrom mpl_toolkits.basemap import Basemap\n\nimport seaborn as sns\n\nimport plotly.express as px\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots\n\nfrom geopy.geocoders import Nominatim\n\nimport warnings\nwarnings.filterwarnings('ignore')\n\nimport re","aeae7298":"water_stress_df = pd.read_csv('..\/input\/aqueduct-global-water-stress-data-maps-30-data\/y2019m07d11_aqueduct30_annual_v01.csv')\nwater_stress_df_mod = water_stress_df[['name_0', 'name_1', 'bws_score']][((water_stress_df.name_0 != '-9999') & (water_stress_df.name_1 != '-9999') & (water_stress_df.bws_score != -9999))]\nwater_stress_df_mod = water_stress_df_mod.drop_duplicates()\nwater_stress_df_mod.columns = ['country', 'area', 'water_stress_level']\n\nwater_stress_df_mod['water_stress_level_norm'] = water_stress_df_mod['water_stress_level'] \/ 5\n\nwater_stress_level_by_country = water_stress_df_mod.groupby(['country']).water_stress_level_norm.mean().to_frame().reset_index(drop=False)\n\nfig = make_subplots(rows=1, cols=1, specs = [[{'type': 'choropleth'} for c in np.arange(1)] for r in np.arange(1)],\n                    subplot_titles = [\"Water Stress Level by Country\"])\n\nfig.add_trace(go.Choropleth(locations = water_stress_level_by_country.country,\n                            z = water_stress_level_by_country.water_stress_level_norm,\n                            zmax=1,\n                            locationmode = 'country names',\n                            colorscale=px.colors.sequential.YlOrRd),\n              row = 1, col = 1)\n","63a7c071":"us_state_abbrev = {\n    'Alabama': 'AL',\n    'Alaska': 'AK',\n    'American Samoa': 'AS',\n    'Arizona': 'AZ',\n    'Arkansas': 'AR',\n    'California': 'CA',\n    'Colorado': 'CO',\n    'Connecticut': 'CT',\n    'Delaware': 'DE',\n    'District of Columbia': 'DC',\n    'Florida': 'FL',\n    'Georgia': 'GA',\n    'Guam': 'GU',\n    'Hawaii': 'HI',\n    'Idaho': 'ID',\n    'Illinois': 'IL',\n    'Indiana': 'IN',\n    'Iowa': 'IA',\n    'Kansas': 'KS',\n    'Kentucky': 'KY',\n    'Louisiana': 'LA',\n    'Maine': 'ME',\n    'Maryland': 'MD',\n    'Massachusetts': 'MA',\n    'Michigan': 'MI',\n    'Minnesota': 'MN',\n    'Mississippi': 'MS',\n    'Missouri': 'MO',\n    'Montana': 'MT',\n    'Nebraska': 'NE',\n    'Nevada': 'NV',\n    'New Hampshire': 'NH',\n    'New Jersey': 'NJ',\n    'New Mexico': 'NM',\n    'New York': 'NY',\n    'North Carolina': 'NC',\n    'North Dakota': 'ND',\n    'Northern Mariana Islands':'MP',\n    'Ohio': 'OH',\n    'Oklahoma': 'OK',\n    'Oregon': 'OR',\n    'Pennsylvania': 'PA',\n    'Puerto Rico': 'PR',\n    'Rhode Island': 'RI',\n    'South Carolina': 'SC',\n    'South Dakota': 'SD',\n    'Tennessee': 'TN',\n    'Texas': 'TX',\n    'Utah': 'UT',\n    'Vermont': 'VT',\n    'Virgin Islands': 'VI',\n    'Virginia': 'VA',\n    'Washington': 'WA',\n    'West Virginia': 'WV',\n    'Wisconsin': 'WI',\n    'Wyoming': 'WY'\n}\n\nwater_stress_df_mod_us = water_stress_df_mod[water_stress_df_mod.country == 'United States'].copy()\nwater_stress_df_mod_us['area'] = water_stress_df_mod_us['area'].replace(us_state_abbrev)\nwater_stress_df_mod_us = water_stress_df_mod_us.groupby(['area', ]).water_stress_level_norm.mean().to_frame().reset_index(drop=False)\n\n\nfig = go.Figure()\nlayout = dict(\n    title_text = \"Water Stress Level by State in the United States of America\",\n    geo_scope='usa',\n)\n\nfig.add_trace(\n    go.Choropleth(\n        locations=water_stress_df_mod_us.area,\n        zmax=1,\n        z = water_stress_df_mod_us.water_stress_level_norm,\n        locationmode = 'USA-states', # set of locations match entries in `locations`\n        marker_line_color='white',\n        geo='geo',\n        colorscale=px.colors.sequential.YlOrRd, \n        \n    )\n)\n            \nfig.update_layout(layout)   \nfig.show()","27d8a3e0":"facility_A = np.array([0.5, 0.3])\nfacility_B = np.array([0.5, 0.7])\n\nfig, ax = plt.subplots(nrows=1, ncols=1, figsize=(6,6))\n\nax.scatter(facility_A[0], facility_A[1], color='black', marker = 'o')\nax.annotate('Facility A', (facility_A * 1.05), fontsize=12)\nax.scatter(facility_B[0], facility_B[1], color='black', marker = 'o')\nax.annotate('Facility B', (facility_B * 1.05), fontsize=12)\n\nax.set_xlabel('Water-Use Efficiency', fontsize= 14)\nax.set_xlim([-0.01, 1.05])\nax.set_ylabel('Normed Water Stress Level', fontsize= 14)\nax.set_ylim([-0.01, 1.05])\nax.imshow([[0.5,1],[0,0.5]], cmap='RdYlGn', interpolation='bilinear')\n\nplt.show()\n\n","9f50f8ec":"def calculate_impact_potential(current_water_efficiency, local_water_stress_level):\n    ideal_water_efficiency =  1\n\n    a = sqrt(current_water_efficiency**2 + local_water_stress_level**2)\n    b = ideal_water_efficiency - current_water_efficiency\n    base = sqrt(ideal_water_efficiency**2 + local_water_stress_level**2)\n\n    # Heron's formula to calculate the area\n    s = (a + b + base) \/ 2\n    area = sqrt(s*(s-a)*(s-b)*(s-base))\n\n    # area = 0.5 * base * height -> height = area \/ (0.5 * base)\n    height = area \/ (0.5 * base)\n    \n    # Normalize\n    return round(height, 3) # Round\n\nfig, ax = plt.subplots(nrows=1, ncols=2, figsize=(14,6))\n\n# Improvement Potential of Water-Use Efficiency\nax[0].scatter(facility_A[0], facility_A[1], color='midnightblue', marker = 'o')\nax[0].scatter(facility_B[0], facility_B[1], color='deepskyblue', marker = 'o')\n\nideal_water_use_efficiency =  1\nax[0].scatter(ideal_water_use_efficiency, facility_A[1], color='midnightblue', marker = '*', s=100)\nax[0].arrow(facility_A[0]+0.05, facility_A[1], 0.4, 0, length_includes_head=True, head_width=0.02, head_length=0.02, color='midnightblue')\nax[0].annotate(f'Improvement Potential A\\n{ideal_water_use_efficiency - facility_A[0]}', (facility_A[0], facility_A[1] + 0.05), fontsize=12)\nax[0].scatter(ideal_water_use_efficiency, facility_B[1], color='deepskyblue', marker = '*', s=100)\nax[0].arrow(facility_B[0]+0.05, facility_B[1], 0.4, 0, length_includes_head=True, head_width=0.02, head_length=0.02, color='deepskyblue')\nax[0].annotate(f'Improvement Potential B\\n{ideal_water_use_efficiency - facility_B[0]}', (facility_B[0], facility_B[1] + 0.05), fontsize=12)\n\nax[0].set_title('Improvement Potential of Water-Use Efficiency', fontsize= 16)\nax[0].set_xlabel('Water-Use Efficiency', fontsize= 14)\nax[0].set_xlim([-0.01, 1.05])\nax[0].set_ylabel('Normed Water Stress Level', fontsize= 14)\nax[0].set_ylim([-0.01, 1.05])\n\n# Impact Potential\nax[1].scatter(facility_A[0], facility_A[1], color='midnightblue', marker = 'o')\nax[1].scatter(facility_B[0], facility_B[1], color='deepskyblue', marker = 'o')\n\nideal_water_use_efficiency =  1\nax[1].scatter(ideal_water_use_efficiency, facility_A[1], color='midnightblue', marker = '*', s=100)\nax[1].scatter(ideal_water_use_efficiency, facility_B[1], color='deepskyblue', marker = '*', s=100)\n\nax[1].plot([0, facility_A[0]], [0, facility_A[1]], linestyle='--', color='midnightblue')\nax[1].plot([0, ideal_water_use_efficiency], [0, facility_A[1]], linestyle='--', color='midnightblue')\nax[1].plot([facility_A[0], facility_A[0]+0.035], [facility_A[1], facility_A[1]-0.14], color='midnightblue', linewidth=4)\nax[1].annotate(f'Impact Potential A\\n{calculate_impact_potential(facility_A[0], facility_A[1])}', (facility_A[0]+ 0.05, facility_A[1] - 0.05), fontsize=12)\n\n\nax[1].plot([0, facility_B[0]], [0, facility_B[1]], linestyle='--', color='deepskyblue')\nax[1].plot([0, ideal_water_use_efficiency], [0, facility_B[1]], linestyle='--', color='deepskyblue')\nax[1].plot([facility_B[0], facility_B[0]+0.15], [facility_B[1], facility_B[1]-0.24], color='deepskyblue', linewidth=4)\nax[1].annotate(f'Impact Potential B\\n{calculate_impact_potential(facility_B[0], facility_B[1])}', (facility_B[0] + 0.05, facility_B[1] - 0.05), fontsize=12)\n\nax[1].set_title('Impact Potential', fontsize= 16)\nax[1].set_xlabel('Water-Use Efficiency', fontsize= 14)\nax[1].set_xlim([-0.01, 1.05])\nax[1].set_ylabel('Normed Water Stress Level', fontsize= 14)\nax[1].set_ylim([-0.01, 1.05])\n\nplt.show()","7008af5d":"fig, ax = plt.subplots(nrows=1, ncols=2, figsize=(14, 6))\n\n# Impact Potential\nfacility_A = np.array([0.5, 0.3])\nfacility_B = np.array([0.5, 0.7])\nax[0].scatter(facility_A[0], facility_A[1], color='midnightblue', marker = 'o')\nax[0].scatter(facility_B[0], facility_B[1], color='deepskyblue', marker = 'o')\n\nax[0].scatter(ideal_water_use_efficiency, facility_A[1], color='midnightblue', marker = '*', s=100)\nax[0].scatter(ideal_water_use_efficiency, facility_B[1], color='deepskyblue', marker = '*', s=100)\n\nax[0].plot([0, facility_A[0]], [0, facility_A[1]], linestyle='--', color='midnightblue')\nax[0].plot([0, ideal_water_use_efficiency], [0, facility_A[1]], linestyle='--', color='midnightblue')\nax[0].plot([facility_A[0], facility_A[0]+0.035], [facility_A[1], facility_A[1]-0.14], color='midnightblue', linewidth=4)\nax[0].annotate(f'Impact Potential\\n{calculate_impact_potential(facility_A[0], facility_A[1])}', (facility_A[0]+ 0.05, facility_A[1] - 0.05), fontsize=12, color='midnightblue')\n\nax[0].plot([0, facility_B[0]], [0, facility_B[1]], linestyle='--', color='deepskyblue')\nax[0].plot([0, ideal_water_use_efficiency], [0, facility_B[1]], linestyle='--', color='deepskyblue')\nax[0].plot([facility_B[0], facility_B[0]+0.15], [facility_B[1], facility_B[1]-0.24], color='deepskyblue', linewidth=4)\nax[0].annotate(f'Impact Potential\\n{calculate_impact_potential(facility_B[0], facility_B[1])}', (facility_B[0] + 0.05, facility_B[1] - 0.05), fontsize=12, color='deepskyblue')\n\nax[0].set_title(r\"$\\bf{Same}$\" + ' Water-Use Efficiency \\nin ' + r\"$\\bf{Different}$\" + ' Water Stress Levels', fontsize= 16)\nax[0].set_xlabel('Water-Use Efficiency', fontsize= 14)\nax[0].set_xlim([-0.01, 1.05])\nax[0].set_ylabel('Normed Water Stress Level', fontsize= 14)\nax[0].set_ylim([-0.01, 1.05])\n\n# Impact Potential\nfacility_A = np.array([0.5, 0.3])\nfacility_B = np.array([0.8, 0.3])\n\nax[1].scatter(facility_A[0], facility_A[1], color='midnightblue', marker = 'o')\nax[1].scatter(facility_B[0], facility_B[1], color='deepskyblue', marker = 'o')\n\nax[1].scatter(ideal_water_use_efficiency, facility_A[1], color='midnightblue', marker = '*', s=100)\nax[1].scatter(ideal_water_use_efficiency, facility_B[1], color='deepskyblue', marker = '*', s=100)\n\nax[1].plot([0, facility_A[0]], [0, facility_A[1]], linestyle='--', color='midnightblue')\nax[1].plot([0, ideal_water_use_efficiency], [0, facility_A[1]], linestyle='--', color='midnightblue')\nax[1].plot([facility_A[0], facility_A[0]+0.035], [facility_A[1], facility_A[1]-0.14], color='midnightblue', linewidth=4)\nax[1].annotate(f'Impact Potential\\n{calculate_impact_potential(facility_A[0], facility_A[1])}', (facility_A[0]-0.15, facility_A[1] + 0.05), fontsize=12, color='midnightblue')\n\nax[1].plot([0, facility_B[0]], [0, facility_B[1]], linestyle='--', color='deepskyblue')\nax[1].plot([0, ideal_water_use_efficiency], [0, facility_B[1]], linestyle='--', color='deepskyblue')\nax[1].plot([facility_B[0], facility_B[0]+0.015], [facility_B[1], facility_B[1]-0.05], color='deepskyblue', linewidth=4)\nax[1].annotate(f'Impact Potential\\n{calculate_impact_potential(facility_B[0], facility_B[1])}', (facility_B[0]-0.1, facility_B[1] + 0.05), fontsize=12, color='deepskyblue')\n\nax[1].set_title(r\"$\\bf{Different}$\" + ' Water-Use Efficiency \\nin ' + r\"$\\bf{Same}$\" + ' Water Stress Levels', fontsize= 16)\nax[1].set_xlabel('Water-Use Efficiency', fontsize= 14)\nax[1].set_xlim([-0.01, 1.05])\nax[1].set_ylabel('Normed Water Stress Level', fontsize= 14)\nax[1].set_ylim([-0.01, 1.05])\n\nplt.show()\n","4863fb69":"fig, ax = plt.subplots(nrows=1, ncols=2, figsize=(14, 6))\n\n# Impact Potential\nfacility_A = np.array([1, 0.9])\nfacility_B = np.array([1, 0.1])\n\nax[0].scatter(facility_A[0], facility_A[1], color='midnightblue', marker = 'o')\nax[0].scatter(facility_B[0], facility_B[1], color='deepskyblue', marker = 'o')\n\nax[0].scatter(ideal_water_use_efficiency, facility_A[1], color='midnightblue', marker = '*', s=100)\nax[0].scatter(ideal_water_use_efficiency, facility_B[1], color='deepskyblue', marker = '*', s=100)\n\nax[0].plot([0, facility_A[0]], [0, facility_A[1]], linestyle='--', color='midnightblue')\nax[0].plot([0, ideal_water_use_efficiency], [0, facility_A[1]], linestyle='--', color='midnightblue')\nax[0].annotate(f'Impact Potential\\n{calculate_impact_potential(facility_A[0], facility_A[1])}', (facility_A[0] - 0.3, facility_A[1] + 0.05), fontsize=12, color='midnightblue')\n\nax[0].plot([0, facility_B[0]], [0, facility_B[1]], linestyle='--', color='deepskyblue')\nax[0].plot([0, ideal_water_use_efficiency], [0, facility_B[1]], linestyle='--', color='deepskyblue')\nax[0].annotate(f'Impact Potential\\n{calculate_impact_potential(facility_B[0], facility_B[1])}', (facility_B[0] - 0.3, facility_B[1] + 0.05), fontsize=12, color='deepskyblue')\n\nax[0].set_title(r\"$\\bf{Best}$\" + ' Water-Use Efficiency \\nin ' + r\"$\\bf{Different}$\" + ' Water Stress Levels', fontsize= 16)\nax[0].set_xlabel('Water-Use Efficiency', fontsize= 14)\nax[0].set_xlim([-0.01, 1.05])\nax[0].set_ylabel('Normed Water Stress Level', fontsize= 14)\nax[0].set_ylim([-0.01, 1.05])\n\n# Impact Potential\nfacility_A = np.array([0, 1])\nfacility_B = np.array([0, 0.2])\nax[1].scatter(facility_A[0], facility_A[1], color='midnightblue', marker = 'o')\nax[1].scatter(facility_B[0], facility_B[1], color='deepskyblue', marker = 'o')\n\nax[1].scatter(ideal_water_use_efficiency, facility_A[1], color='midnightblue', marker = '*', s=100)\nax[1].scatter(ideal_water_use_efficiency, facility_B[1], color='deepskyblue', marker = '*', s=100)\n\nax[1].plot([0, facility_A[0]], [0, facility_A[1]], linestyle='--', color='midnightblue')\nax[1].plot([0, ideal_water_use_efficiency], [0, facility_A[1]], linestyle='--', color='midnightblue')\nax[1].plot([facility_A[0], facility_A[0]+0.5], [facility_A[1], facility_A[1]-0.5], color='midnightblue', linewidth=4)\nax[1].annotate(f'Impact Potential\\n{calculate_impact_potential(facility_A[0], facility_A[1])}', (facility_A[0]+ 0.05, facility_A[1] - 0.05), fontsize=12, color='midnightblue')\n\nax[1].plot([0, facility_B[0]], [0, facility_B[1]], linestyle='--', color='deepskyblue')\nax[1].plot([0, ideal_water_use_efficiency], [0, facility_B[1]], linestyle='--', color='deepskyblue')\nax[1].plot([facility_B[0], facility_B[0]+0.032], [facility_B[1], facility_B[1]-0.19], color='deepskyblue', linewidth=4)\nax[1].annotate(f'Impact Potential\\n{calculate_impact_potential(facility_B[0], facility_B[1])}', (facility_B[0] + 0.05, facility_B[1] - 0.05), fontsize=12, color='deepskyblue')\n\nax[1].set_title(r\"$\\bf{Worst}$\" + ' Water-Use Efficiency \\nin ' + r\"$\\bf{Different}$\" + ' Water Stress Levels', fontsize= 16)\nax[1].set_xlabel('Water-Use Efficiency', fontsize= 14)\nax[1].set_xlim([-0.01, 1.05])\nax[1].set_ylabel('Normed Water Stress Level', fontsize= 14)\nax[1].set_ylim([-0.01, 1.05])\n\nplt.show()","1d1fdfc8":"year = 2020\nPATH = \"..\/input\/cdp-unlocking-climate-solutions\/\"\n\n# Load corporations disclosing (Water Security Questionnaire)\ncorporations_disclosing_df = pd.read_csv(f\"{PATH}Corporations\/Corporations Disclosing\/Water Security\/{year}_Corporates_Disclosing_to_CDP_Water_Security.csv\")\n\n# Load corporations' responses\ncorporations_df = pd.read_csv(f\"{PATH}Corporations\/Corporations Responses\/Water Security\/{year}_Full_Water_Security_Dataset.csv\")\ncorporations_df['section'] = 'tbd'\n\ndef unify_column_names_corp(columns):\n    new_cols = []\n    \"\"\"\n    Unifies column naming to match column names in city questionnaire\n    \"\"\"\n    for c in columns:\n        if c == 'question_unique_reference':\n            new_cols.append('question_name')\n        elif c == 'module_name':\n            new_cols.append('parent_section')\n        elif c == 'data_point_name':\n            new_cols.append('subquestion_name')\n        else:\n            new_cols.append(c)\n\n    return new_cols\n\ncorporations_df.columns = unify_column_names_corp(corporations_df.columns)\n\n# Unify column 'module_name' and 'questionnaire'\ncorporations_df['parent_section'] = corporations_df['parent_section'].apply(lambda x: x.split('. ')[1])\n\n# Reduce columns in survey responses\ncorporation_cols = ['account_number', 'organization','parent_section', 'section', 'question_number',\n                    'question_name', 'column_number', \n                    'column_name','table_columns_unique_reference', 'data_point_id', \n                    'subquestion_name', 'row_number', 'row_name', \n                    'response_value', 'comments',]\n\ncorporations_df = corporations_df[corporation_cols]\n\n# Merge survey responses and base data\ncorporations_df = corporations_df.merge(corporations_disclosing_df[['account_number', 'country','theme', 'primary_activity', 'primary_sector', 'primary_industry','primary_questionnaire_sector',]], on='account_number', how='left')\n\n### Help functions ###\ndef get_pivoted_df_by_question_corp(question_number):\n    df = corporations_df[corporations_df.question_number == question_number]\n    df = df.pivot(index = ['account_number', 'organization', 'primary_activity', 'primary_sector', 'primary_industry', 'primary_questionnaire_sector', 'row_number'], columns = 'table_columns_unique_reference')['response_value']\n    return df\n\ndef convert_columns_numbers(columns):\n    converted_columns = []\n    for c in columns:\n        c_converted = c.split(\"-\")[1:]\n        c_converted = ''.join(c_converted)\n        c_converted = c_converted.lower()\n        c_converted = re.sub(' ','_', c_converted)\n        converted_columns.append(c_converted)\n    return converted_columns\n\ndef convert_columns(columns):\n    converted_columns = []\n    for c in columns:\n        c_converted = c.lower()\n        c_converted = re.sub(' ','_', c_converted)\n        converted_columns.append(c_converted)\n    return converted_columns\n\nprint(f\"{corporations_df.account_number.nunique()} corporations disclosed information on water security to CDP in 2020.\")","0865c89d":"# Corporate Questionnaire \n# Question 5.1 \n# For each facility referenced in W4.1c, provide coordinates, water accounting data, and a comparison with the previous reporting year. \n\ncorporate_facilities_df = get_pivoted_df_by_question_corp('W5.1')\ncorporate_facilities_df.columns = convert_columns_numbers(corporate_facilities_df.columns)\ncorporate_facilities_df = corporate_facilities_df.reset_index(drop=False)\ncorporate_facilities_df.latitude = corporate_facilities_df.latitude.astype(float)\ncorporate_facilities_df.longitude = corporate_facilities_df.longitude.astype(float)\n\ncorporate_facilities_df = corporate_facilities_df[['account_number', 'organization', 'primary_activity', 'primary_sector','primary_industry', 'row_number', 'facility_reference_number',\n                                                   'withdrawals_from_fresh_surface_water,_including_rainwater,_water_from_wetlands,_rivers_and_lakes',\n                                                   'withdrawals_from_brackish_surface_water\/seawater', \n                                                   'withdrawals_from_groundwater__renewable',\n                                                   'withdrawals_from_groundwater__nonrenewable', \n                                                   'withdrawals_from_produced\/entrained_water',\n                                                   'withdrawals_from_third_party_sources',\n                                                   'total_water_withdrawals_at_this_facility_(megaliters\/year)',\n                                                   'discharges_to_fresh_surface_water', \n                                                   'discharges_to_brackish_surface_water\/seawater',\n                                                   'discharges_to_groundwater', \n                                                   'discharges_to_third_party_destinations',\n                                                   'total_water_discharges_at_this_facility_(megaliters\/year)',\n                                                   'total_water_consumption_at_this_facility_(megaliters\/year)',\n                                                   'country\/area_&_river_basin', 'country\/area_&_river_basin_g', 'latitude', 'longitude',\n                                                   'located_in_area_with_water_stress',]]\n\n# Convert numerical columns to float\nfor c in corporate_facilities_df.columns:\n    if ('withdrawals' in c) | ('discharges' in c)| ('consumption' in c):\n        corporate_facilities_df[c] = corporate_facilities_df[c].astype(float)\n\ncorporate_facilities_df['facility_id'] = corporate_facilities_df.apply(lambda x: ((str(x.account_number) + '_' + x.facility_reference_number.split(' ')[1]) if x.facility_reference_number == x.facility_reference_number else np.nan), axis=1)\n\ncorporate_facilities_df = corporate_facilities_df[['account_number', 'facility_id', 'organization', 'primary_activity', 'primary_sector',\n       'primary_industry', 'row_number', \n       'country\/area_&_river_basin', 'country\/area_&_river_basin_g',\n       'latitude', 'longitude', 'located_in_area_with_water_stress',\n       'total_water_withdrawals_at_this_facility_(megaliters\/year)',\n       'total_water_consumption_at_this_facility_(megaliters\/year)', ]]\n\ncorporate_facilities_df.columns = ['account_number', 'facility_id', 'organization', 'primary_activity', 'primary_sector', 'primary_industry',  'row_number',\n                                   'basin', 'country', 'latitude', 'longitude', 'water_stress_area',\n                                   'total_water_withdrawals', 'total_water_consumption']\n\ncorporate_facilities_df = corporate_facilities_df[(corporate_facilities_df.facility_id.notna()) & (corporate_facilities_df.total_water_consumption.notna())]\nprint(f\"{corporate_facilities_df.account_number.nunique()} corporations disclosed detailed information on water security for {corporate_facilities_df.facility_id.nunique()} facilities from {corporate_facilities_df.country.nunique()} countries\")","9bbfe2f8":"fig = plt.figure(figsize=(18, 18))\nm = Basemap(projection='mill')\nm.drawcoastlines()\nm.scatter(corporate_facilities_df.longitude.values, corporate_facilities_df.latitude.values, latlon=True, s=10, c='blue')\nplt.show()","f32bebe1":"corporate_facilities_df['water_use_efficiency'] = (corporate_facilities_df['total_water_withdrawals'] - corporate_facilities_df['total_water_consumption']) \/ corporate_facilities_df['total_water_withdrawals']    \ncorporate_facilities_df.country = corporate_facilities_df.country.replace({'United States of America' : 'United States',\n                                                                           'Republic of Korea' : 'South Korea',\n                                                                           'Taiwan, Greater China' : 'Taiwan',\n                                                                           'United Kingdom of Great Britain and Northern Ireland' : 'United Kingdom',\n                                                                           'Russian Federation' : 'Russia',\n                                                                           'United Republic of Tanzania' : 'Tanzania',\n                                                                           'Viet Nam' : 'Vietnam',\n                                                                           'North Macedonia' : 'Macedonia',\n                                                                           \"C\u00c3\u00b4te d'Ivoire\" : \"C\u00f4te d'Ivoire\",\n                                                                           'China, Hong Kong Special Administrative Region' : 'Hong Kong'})\n\n# Get longitude and latitude for each area in with know water stress level\nwater_stress_df_mod = water_stress_df_mod[water_stress_df_mod.country.isin(corporate_facilities_df.country.unique())]\nwater_stress_df_mod = water_stress_df_mod.groupby(['country', 'area']).water_stress_level_norm.mean().to_frame().reset_index(drop=False)\n\ngeolocator = Nominatim(user_agent='myapplication')\n\nwater_stress_df_mod['location'] = 1\n\ndef get_lat_long(area, country):\n    try:\n        location = geolocator.geocode(f\"{area} {country}\")\n        return location[1]\n    except:\n        return np.nan\n    \n    \nfor i in tqdm(water_stress_df_mod.index):\n    try:\n        coordinates = get_lat_long(water_stress_df_mod.loc[i].area, water_stress_df_mod.loc[i].country)\n        water_stress_df_mod.at[i, 'latitude'] = coordinates[0]\n        water_stress_df_mod.at[i, 'longitude'] = coordinates[1]\n    except:\n        water_stress_df_mod.at[i, 'latitude'] = np.nan\n        water_stress_df_mod.at[i, 'longitude'] = np.nan","2299f937":"def haversine(lon1, lat1, lon2, lat2):\n    \"\"\"\n    Function copied from https:\/\/stackoverflow.com\/questions\/4913349\/haversine-formula-in-python-bearing-and-distance-between-two-gps-points\n    Calculate the great circle distance between two points \n    on the earth (specified in decimal degrees)\n    \"\"\"\n\n    R = 6372.8 # Earth radius in kilometers\n\n    dLat = radians(lat2 - lat1)\n    dLon = radians(lon2 - lon1)\n    lat1 = radians(lat1)\n    lat2 = radians(lat2)\n\n    a = sin(dLat\/2)**2 + cos(lat1)*cos(lat2)*sin(dLon\/2)**2\n    c = 2*asin(sqrt(a))\n\n    return round(R * c, 0)\n\n\n\ndef get_affected_cities(facility_id, radius):\n    \"\"\"\n    * facility_id\n    * radius in km\n    \"\"\"\n    area = []\n    distances = []\n    water_stress_level = []\n    country = corporate_facilities_df[(corporate_facilities_df.facility_id == facility_id)]['country'].values[0]\n    latitude = corporate_facilities_df[(corporate_facilities_df.facility_id == facility_id)]['latitude'].values[0]\n    longitude = corporate_facilities_df[(corporate_facilities_df.facility_id == facility_id)]['longitude'].values[0]\n\n    temp_cities = water_stress_df_mod[water_stress_df_mod['country'] == country].reset_index(drop=True)\n\n    for j in range(len(temp_cities)):\n        distance = haversine(longitude, latitude, temp_cities.iloc[j].longitude, temp_cities.iloc[j].latitude)\n        if distance <= radius:\n            area.append(temp_cities.iloc[j].area)\n            distances.append(distance)\n            water_stress_level.append(temp_cities.iloc[j].water_stress_level_norm)\n  \n    return area, distances, water_stress_level\n\nfacility_cities_lookup_df = pd.DataFrame(columns=['facility_id','closest_area', 'distance', 'water_stress_level_norm'])\n\nfor facility in tqdm(corporate_facilities_df[corporate_facilities_df.country.isin(water_stress_df_mod.country)].facility_id.unique()):\n    area_account_numbers, distances, water_stress_level = get_affected_cities(facility, 100)\n    \n    if len(area_account_numbers) > 0:\n        row = {}\n        row['facility_id'] = facility\n        row['closest_area'] = area_account_numbers[distances.index(min(distances))]\n        row['distance'] = distances[distances.index(min(distances))]\n        row['water_stress_level_norm'] = water_stress_level[distances.index(min(distances))]\n\n        facility_cities_lookup_df = facility_cities_lookup_df.append(row, ignore_index=True)\n        \nfacility_cities_lookup_df","3e6f786d":"corporate_facilities_df = corporate_facilities_df[['account_number', 'facility_id', 'organization', 'primary_activity',\n       'primary_sector', 'primary_industry', 'basin', 'country',\n       'latitude', 'longitude', 'water_stress_area',\n       'total_water_withdrawals', 'total_water_consumption',\n       'water_use_efficiency']].merge(facility_cities_lookup_df[['facility_id', 'closest_area', 'water_stress_level_norm']], on='facility_id', how='left')\n\ncorporate_facilities_df['impact_potential'] = corporate_facilities_df.apply(lambda x: calculate_impact_potential(x.water_use_efficiency, x.water_stress_level_norm), axis=1)#water_stress_level_norm\/test.water_use_efficiency\ncorporate_facilities_df['impact_potential_norm'] = corporate_facilities_df['impact_potential'].apply(lambda x: x\/(sqrt(2)\/2))\ncorporate_facilities_df['impact_potential'].describe()\n","19fb3492":"fig = plt.figure(figsize=(18, 6))\n\narea = 'S\u00e3o Paulo'\ntemp = corporate_facilities_df[corporate_facilities_df.closest_area == area]\nfig.suptitle(f'{area} Area (Scaled Water-Stress Level: {round(temp.water_stress_level_norm.values[0],2)})', fontsize = 14)\n\nax = fig.add_subplot(131)\nax.set_title(f\"Facilities in {area} Area\", fontsize=14)\nm = Basemap(projection='lcc', resolution=None,\n            width=6E6, height=6E6, \n            lat_0=-23, lon_0=-46,)\n\nm.etopo(scale=0.5, alpha=0.5)\nm.scatter(corporate_facilities_df[corporate_facilities_df.closest_area == area].longitude.values, corporate_facilities_df[corporate_facilities_df.closest_area == area].latitude.values, latlon=True, s=50, c='blue')\n#m.scatter(-46.625290, -23.533773, latlon=True, s=50, c='red')\n\nax = fig.add_subplot(132)\nax.set_title(f\"Close Up of Facilities in {area} Area\", fontsize=14)\nm = Basemap(projection='lcc', resolution=None,\n            width=3E5, height=3E5, \n            lat_0=-23, lon_0=-46.5,)\n\nm.etopo(scale=0.5, alpha=0.5)\nm.scatter(corporate_facilities_df[corporate_facilities_df.closest_area == area].longitude.values, corporate_facilities_df[corporate_facilities_df.closest_area == area].latitude.values, latlon=True, s=50, c='blue')\n#m.scatter(-46.625290, -23.533773, latlon=True, s=50, c='red')\n\nax = fig.add_subplot(133)\nsns.barplot(data=temp, y= 'water_use_efficiency', x='facility_id', ax=ax, palette='Blues')\nax.set_ylim([0,1])\nax.set_ylabel('Water-Use Efficiency', fontsize=14)\nax.set_xlabel('Facilities', fontsize=14)\nplt.show()\n\nfig = plt.figure(figsize=(18, 6))\n\narea = 'Andhra Pradesh'\ntemp = corporate_facilities_df[corporate_facilities_df.closest_area == area]\nfig.suptitle(f'{area} Area (Scaled Water-Stress Level: {round(temp.water_stress_level_norm.values[0],2)})', fontsize = 14)\n\nax = fig.add_subplot(131)\nax.set_title(f\"Facilities in {area} Area\", fontsize=14)\nm = Basemap(projection='lcc', resolution=None,\n            width=6E6, height=6E6, \n            lat_0=16, lon_0=80,)\n\nm.etopo(scale=0.5, alpha=0.5)\nm.scatter(corporate_facilities_df[corporate_facilities_df.closest_area == area].longitude.values, corporate_facilities_df[corporate_facilities_df.closest_area == area].latitude.values, latlon=True, s=50, c='blue')\n#m.scatter(80.632095, 16.515099, latlon=True, s=50, c='red')\n\nax = fig.add_subplot(132)\nax.set_title(f\"Close Up of Facilities in {area} Area\", fontsize=14)\nm = Basemap(projection='lcc', resolution=None,\n            width=3E5, height=3E5, \n            lat_0=16, lon_0=80,)\n\nm.etopo(scale=0.5, alpha=0.5)\nm.scatter(corporate_facilities_df[corporate_facilities_df.closest_area == area].longitude.values, corporate_facilities_df[corporate_facilities_df.closest_area == area].latitude.values, latlon=True, s=50, c='blue')\n#m.scatter(80.632095, 16.515099, latlon=True, s=50, c='red')\n\nax = fig.add_subplot(133)\nsns.barplot(data=temp, y= 'water_use_efficiency', x='facility_id', ax=ax, palette='Blues')\nax.set_ylim([0,1])\nax.set_ylabel('Water-Use Efficiency', fontsize=14)\nax.set_xlabel('Facilities', fontsize=14)\n\nplt.show()","489d121a":"fig, ax = plt.subplots(nrows=1, ncols=1, figsize=(6,6))\nexample_df = corporate_facilities_df[corporate_facilities_df.closest_area.isin(['Andhra Pradesh', 'S\u00e3o Paulo'])].reset_index(drop=True)\nim = sns.scatterplot(data=example_df, x = 'water_use_efficiency', y= 'water_stress_level_norm', hue='impact_potential_norm', hue_norm=(0,1), palette='RdYlGn_r', s=75) # Use cool warm for colorblindness optimization\n\nax.annotate(example_df.iloc[0].facility_id, (example_df.iloc[0].water_use_efficiency+0.01, example_df.iloc[0].water_stress_level_norm-0.05), fontsize=12)\nax.annotate(example_df.iloc[1].facility_id, (example_df.iloc[1].water_use_efficiency-0.1, example_df.iloc[1].water_stress_level_norm-0.05), fontsize=12)\nax.annotate(example_df.iloc[2].facility_id, (example_df.iloc[2].water_use_efficiency, example_df.iloc[2].water_stress_level_norm+0.02), fontsize=12)\nax.annotate(example_df.iloc[3].facility_id, (example_df.iloc[3].water_use_efficiency-0.05, example_df.iloc[3].water_stress_level_norm+0.03), fontsize=12)\nax.annotate(example_df.iloc[4].facility_id, (example_df.iloc[4].water_use_efficiency-0.2, example_df.iloc[4].water_stress_level_norm+0.03), fontsize=12)\nax.annotate(example_df.iloc[5].facility_id, (example_df.iloc[5].water_use_efficiency, example_df.iloc[5].water_stress_level_norm-0.05), fontsize=12)\nax.annotate(example_df.iloc[6].facility_id, (example_df.iloc[6].water_use_efficiency, example_df.iloc[6].water_stress_level_norm-0.05), fontsize=12)\nax.annotate(example_df.iloc[7].facility_id, (example_df.iloc[7].water_use_efficiency, example_df.iloc[7].water_stress_level_norm+0.02), fontsize=12)\n\nax.set_title('Impact Potential of Example', fontsize= 16)\nax.set_xlabel('Water-Use Efficiency', fontsize= 14)\nax.set_xlim([-0.01, 1.05])\nax.set_ylabel('Normed Water Stress Level', fontsize= 14)\nax.set_ylim([-0.01, 1.05])\nax.legend(bbox_to_anchor=(1.5,0.5))\nplt.show()","e0d0d4a5":"fig, ax = plt.subplots(nrows=1, ncols=1, figsize=(6,6))\nsns.scatterplot(data=corporate_facilities_df, x = 'water_use_efficiency', y= 'water_stress_level_norm', hue='impact_potential_norm', hue_norm=(0,1), palette='RdYlGn_r', s=75)\nax.set_title('Impact Potential of all Disclosed Facilities', fontsize= 16)\nax.set_xlabel('Water-Use Efficiency', fontsize= 14)\nax.set_xlim([-0.01, 1.05])\nax.set_ylabel('Normed Water Stress Level', fontsize= 14)\nax.set_ylim([-0.01, 1.05])\nax.legend(bbox_to_anchor=(1.5,0.5))\nplt.show()","a01a296d":"temp = corporate_facilities_df[['account_number', 'facility_id', 'country',   'closest_area',  'total_water_withdrawals',\n       'total_water_consumption', 'water_use_efficiency', 'water_stress_level_norm',  'impact_potential_norm']].sort_values(by='impact_potential_norm', ascending=False)\ntemp = temp[temp.water_use_efficiency.notna() & temp.impact_potential_norm.notna()]\ntemp.columns = ['Corporation ID', 'Facility ID', 'Country', 'Area', 'Water Withdrawal (Ml)', 'Water Consumption (Ml)', 'Water-Use Efficiency', 'Water Stress Level', 'Impact Potential']\n\ntemp.head(7).style.set_caption('Facilities with Highest Impact Potential')\\\n.format({\"Water Withdrawal (Ml)\": \"{:20,.0f}\", \"Water Consumption (Ml)\": \"{:20,.0f}\",  \"Water-Use Efficiency\": \"{:20,.2f}\",\"Water Stress Level\":\"{:20,.2f}\", \"Impact Potential\":\"{:20,.2f}\"})\\\n.background_gradient(subset=[\"Water Stress Level\", \"Impact Potential\",], cmap='RdYlGn_r', vmin=-0.1, vmax=1.0)\\\n.background_gradient(subset=[\"Water-Use Efficiency\"], cmap='RdYlGn', vmin=-0.1, vmax=1.0)","2adbbbb1":"temp = corporate_facilities_df[['account_number', 'primary_industry', 'facility_id', 'country',   'closest_area',  'total_water_withdrawals',\n       'total_water_consumption', 'water_use_efficiency', 'water_stress_level_norm',  'impact_potential_norm']].sort_values(by='impact_potential_norm', ascending=False)\ntemp = temp[temp.water_use_efficiency.notna() & temp.impact_potential_norm.notna()]\n\ntemp = temp.groupby(['account_number', 'primary_industry'])[['total_water_withdrawals', 'total_water_consumption', 'water_use_efficiency', 'water_stress_level_norm',  'impact_potential_norm']].mean().reset_index(drop=False)\ntemp = temp.sort_values(by='impact_potential_norm', ascending=False)\ntemp.columns = ['Corporation ID', 'Industry', 'Water Withdrawal (Ml)', 'Water Consumption (Ml)', 'Water-Use Efficiency', 'Water Stress Level', 'Impact Potential']\n\ntemp.head(5).style.set_caption('Corporations with Highest Impact Potential')\\\n.format({\"Water Withdrawal (Ml)\": \"{:20,.0f}\", \"Water Consumption (Ml)\": \"{:20,.0f}\",  \"Water-Use Efficiency\": \"{:20,.2f}\",\"Water Stress Level\":\"{:20,.2f}\", \"Impact Potential\":\"{:20,.2f}\"})\\\n.background_gradient(subset=[\"Water Stress Level\", \"Impact Potential\",], cmap='RdYlGn_r', vmin=-0.1, vmax=1.0)\\\n.background_gradient(subset=[\"Water-Use Efficiency\"], cmap='RdYlGn', vmin=-0.1, vmax=1.0)","9aa82025":"temp = corporate_facilities_df[['account_number', 'primary_industry', 'facility_id', 'country',   'closest_area',  'total_water_withdrawals',\n       'total_water_consumption', 'water_use_efficiency', 'water_stress_level_norm',  'impact_potential_norm']].sort_values(by='impact_potential_norm', ascending=False)\ntemp = temp[temp.water_use_efficiency.notna() & temp.impact_potential_norm.notna()]\n\ntemp = temp.groupby(['country']).agg({'total_water_withdrawals' : 'mean', 'total_water_consumption': 'mean', 'water_use_efficiency': 'mean', 'water_stress_level_norm': 'mean',  'impact_potential_norm': 'mean', 'facility_id' : 'nunique'}).reset_index(drop=False)\ntemp = temp.sort_values(by='impact_potential_norm', ascending=False).reset_index(drop=True)\n\ntemp.columns = ['Country', 'Mean Water Withdrawal (Ml)', 'Mean Water Consumption (Ml)', 'Mean Water-Use Efficiency', 'Mean Water Stress Level', 'Mean Impact Potential', '# Disclosing Facilities']\n\ntemp.head(5).style.set_caption('Countries with Facilities with Highest Impact Potential')\\\n.format({\"Mean Water Withdrawal (Ml)\": \"{:20,.0f}\", \"Mean Water Consumption (Ml)\": \"{:20,.0f}\",  \"Mean Water-Use Efficiency\": \"{:20,.2f}\",\"Mean Water Stress Level\":\"{:20,.2f}\", \"Mean Impact Potential\":\"{:20,.2f}\"})\\\n.background_gradient(subset=[\"Mean Water Stress Level\", \"Mean Impact Potential\",], cmap='RdYlGn_r', vmin=-0.1, vmax=1.0)\\\n.background_gradient(subset=[\"Mean Water-Use Efficiency\"], cmap='RdYlGn', vmin=-0.1, vmax=1.0)","acddd36a":"from sklearn.metrics import confusion_matrix\ncorporate_facilities_df['water_stress_area_actual'] = corporate_facilities_df['water_stress_level_norm'].apply(lambda x: 1 if ((x==x) & (x >0.4)) else 0)\ncorporate_facilities_df['water_stress_area_stated'] = corporate_facilities_df['water_stress_area'].apply(lambda x: 1 if ((x==x) & (x == 'Yes')) else 0)\n\ncm = confusion_matrix(corporate_facilities_df['water_stress_area_actual'], corporate_facilities_df['water_stress_area_stated'])#, labels=[\"ant\", \"bird\", \"cat\"])\ncm = pd.DataFrame(cm, columns=np.unique(['No', 'Yes']), index = np.unique(['No', 'Yes']))\ncm.index.name = 'Actual'\ncm.columns.name = 'Stated'\n\nlabels = ['True Neg','False Pos','False Neg','True Pos']\nlabels = np.asarray(labels).reshape(2,2)\n\nfig, ax = plt.subplots(nrows=1, ncols=2, figsize=(16,6))\n\nsns.heatmap(cm, annot=True, fmt='', cmap='Blues', ax=ax[0])\nax[0].set_title('Confusion Matrix of Water Stressed Area', fontsize=14)\n\n\nsns.scatterplot(data=corporate_facilities_df, x = 'water_use_efficiency', y= 'water_stress_level_norm', hue='water_stress_area', palette='Set1', ax=ax[1])#, hue_norm=(0,1), palette='RdYlGn_r', s=75)\nax[1].set_title('Impact Potential of all Disclosed Facilities', fontsize= 16)\nax[1].set_xlabel('Water-Use Efficiency', fontsize= 14)\nax[1].set_xlim([-0.01, 1.05])\nax[1].set_ylabel('Normed Water Stress Level', fontsize= 14)\nax[1].set_ylim([-0.01, 1.05])\nax[1].legend(bbox_to_anchor=(1.5,0.5))\n\nplt.show()\n","2efb0802":"corp_temp_df = corporate_facilities_df.copy()\n\ntemp = get_pivoted_df_by_question_corp('W8.1a')\ntemp.columns = convert_columns_numbers(temp.columns)\ntemp = temp.reset_index(drop=False)\n\ntemp.category_of_target = temp.category_of_target.fillna('Other')\ntemp['category_of_target_mod'] = temp.category_of_target.apply(lambda x: np.nan if ((x==x) & ('Other' in x))  else x)\n\ncorp_temp_df['target_water_use_efficiency'] = corp_temp_df.account_number.apply(lambda x: 1 if x in temp[temp.category_of_target == 'Water use efficiency'].account_number.unique() else 0)\n\nfig, ax = plt.subplots(nrows=1, ncols=2, figsize=(14,6))\n\nfig.suptitle('Distribution of Facilities According to \\nAvailability of Water-Use Efficiency Target', fontsize=16)\n\nsns.kdeplot(data=corp_temp_df[corp_temp_df.target_water_use_efficiency == 0].water_use_efficiency, label='No Target Available', ax=ax[0], color='tomato')\nsns.kdeplot(data=corp_temp_df[corp_temp_df.target_water_use_efficiency == 1].water_use_efficiency, label='Target Available', ax=ax[0], color='dodgerblue')\n\nax[0].set_xlim([-0.5,1.5])\nax[0].set_xlabel('Water-Use Efficiency', fontsize=14)\n\nsns.kdeplot(corp_temp_df[corp_temp_df.target_water_use_efficiency == 0].impact_potential_norm, label='No Target Available', ax=ax[1], color='tomato')\nsns.kdeplot(data=corp_temp_df[corp_temp_df.target_water_use_efficiency == 1].impact_potential_norm, label=' Target Available', ax=ax[1], color='dodgerblue')\nax[1].set_xlim([-0.5,1.5])\nax[1].set_xlabel('Impact Potential', fontsize=14)\n\nplt.show()","03b8a2d8":"In both regions, there are facilities with a water-use efficiency of around 0.8 or higher and there are also facilities with low water-use efficiency of around 0.2. While facilities with low water-use efficiency have more room for improvement than facilities with higher water-use efficiency, we can see that the local water stress level can give us more insight. Although facility 3564_12 has a better water-use efficiency than facility 15132_20, it has more potential of generating a positive impact because it is generated in an area with high levels of water stress.","18dd19b7":"As shown on the left in below figure, both facilities have an improvement potential of 0.5 for their water-use efficiency. However, if only the water-use efficiency is analyzed as a KPI, we could not see that the impact of facility B improving their water-use efficiency is greater than if facility A improved their water-use efficiency. \n\nTherefore, we have developed a metric to incorporate the local water stress level to improve the assessment of a facility\u2019s impact potential as shown on the right in below figure. **The impact potential is represented by the altitude of the triangle created by the  three points (0,0), (`current_water_use_efficiency`, `local_water_stress_level`), (`ideal_water_use_efficiency`, `local_water_stress_level`)**.\n\n\n\n\nImpact Potential = $\\dfrac{\\sqrt{s\\cdot(s-d_1)\\cdot(s-d_2)\\cdot(s-d_3)}}{0.5 \\cdot d_3} $ \n\n\n\n\n* Distance (0,0) to ($\\eta$, ws): $d_1 = \\sqrt{\\eta^2 + ws^2}$\n* Distance ($\\eta$, ws) to ($\\eta_{ideal}$, ws): $d_2 = \\eta_{ideal} - \\eta$\n* Distance (0,0) to ($\\eta_{ideal}$, ws): $d_3 = \\sqrt{\\eta_{ideal}^2 + ws^2}$\n* Heron's theorem $s = \\dfrac{(d_1 + d_2 + d_3)}{2}$ \n* Local water stress level $ws$\n* Facilitie's current water-use efficiency $\\eta$\n* Ideal water-use efficiency $\\eta_{ideal} = 1$","351ddb07":"# Conclusion\n\nIn this analysis we developed a metric that indicates the positive impact potential of a facility based on its water-use efficiency and the water stress level in the operating area. The metric is effective, visually easy to understand and easy to calculate. By including the local water stress level it is a good means for comparisons. \n**The result of the proposed metric is an impact potential based on the water-use efficiency according to the local water stress level.**\n\nAs water stress level is an important metric to describe the relation of supply and demand for water in a given geographical region, it can be attested that regions with high water stress level are at high risk of running into severe crisis that affects both nature and humans located in that area. Since taking actions on water supply in specific regions is limited, the proposed metric intends to demonstrate high impact examples to save water, thus tackling the demand side.\nBy assigning a relatively higher impact to facilities located in water stressed areas, the impact potential is a good KPI to reveal for which facilities a reduction of water consumption would be most effective.\nSince specific industries rely on heavy water usage, the local water stress level should be taken into account when making decisions for the location of facilities.\n\nThe proposed approach is superior to simpler approaches which would only compare water-use efficiency of individual facilities without taking into account the local water stress level.\n**Policy makers should make use of the impact potential to identify high impact solutions in the most vulnerable areas. By implementing policies, e.g. higher cost for water discharge or higher taxation, selective for areas at highest risk, a positive impact can be achieved without dampening economic activity in other areas which might have a lower water stress level.**\n\nOne limitation of this metric is that currently disclosure of water security data is low in comparison to climate change data. With this analysis, we want to stress the importance of disclosure in general and especially increase awareness of water related risks. Another limitation of this metric is its isolated consideration of water-use efficiency. To fully employ the proposed impact potential analysis it has to be expanded to a broader approach. Amongst others, the inclusion of a water quality factor would be highly recommended to reveal the issues of quality of drinking water and water pollution.\n\nAs a next step, the impact of less \"water pollution\" of a company\u2019s utilities could be calculated the same way by looking into the contamination of water output in the context of water pollution in a specific area. The extension of the Water Security Questionnaire in this direction would be a first step to integrate this approach.\n\n\n# References\n\n[1] United Nations. \"Transforming our world: the 2030 Agenda for Sustainable Development\" (2015): https:\/\/www.un.org\/ga\/search\/view_doc.asp?symbol=A\/RES\/70\/1&Lang=E\n\n[2] V\u00f6r\u00f6smarty, C. J., et al. \"Scientifically assess impacts of sustainable investments.\" Science 359.6375 (2018): 523-525.\n\n[3] V\u00f6r\u00f6smarty, C. J., et al. \"Global threats to human water security and river biodiversity.\" nature 467.7315 (2010): 555-561.\n\n[4] World Economic Forum. \"Measuring Stakeholder Capitalism\" (2020): http:\/\/www3.weforum.org\/docs\/WEF_IBC_Measuring_Stakeholder_Capitalism_Report_2020.pdf\n\n","d9473b76":"# Experiments\n\n## Datasets and Setup\n\n### CDP Water Security Questionnaire for Corporations (2020)\nTo apply the above presented methodology, data from the CDP Water Security Questionnaire for Corporations from 2020 will be used. Disclosure on water security in general is low. This shows that **water risks seem to have less priority than other, more well-known risks such as carbon emissions and climate change**. In the CDP Water Security Questionnaire from 2020, 295 corporations from North America have published data out of which 96 corporations have provided facility-level data for at least one facility world wide. The detailed information is drawn from the  Water Security Questionnaire's question W5.1 \"For each facility referenced in W4.1c, provide coordinates, water accounting data, and a comparison with the previous reporting year\". The final aggregated dataset contains **658 facilities in 54 countries from 91 corporations**. The global distribution is visualized in the following map.","f6b31aa8":"## Water Stress Education\nBelow figure shows that corporations seem to be unsure whether their facility is located in a water stressed area. While question W5.1 asks whether a facility withdraws water from a water stressed area, corporations seem to be unsure what water stress level qualifies a yes or no answer to this question. While the below figure shows a rough tendency that a scaled water stress level below 0.4 could be classified as \"not water stressed area\", unsure corporations seem to prefer disclosing the area as water stressed anyways. Respectively, there are corporations classifying areas with a scaled water stress level of above 0.8 as \"not water stressed area\". \nFrom the geographical mapping of facilities to the Aqueduct map, we can see that **corporations have to be educated on water stress levels**.","6d142919":"The proposed approach is effective as follows: As shown on the left in below figure, we can see that a facility operating in an area with a higher water stress level has a higher impact potential than a facility operating in an area with lower water stress level, if both facilities have the same water-use efficiency. Additionally, as shown on the right in below figure, a facility with lower water-use efficiency has a higher impact potential than a facility with a higher water-use efficiency in the same area. Additionally, this approach is simple to calculate and visually easy to understand.","b75c8fab":"# Methodology\n\nThe objective of this analysis is to develop a key performance indicator (KPI) of the impact of water consumption. Our approach combines the metrics proposed by the SDG [1], WEF [4] and V\u00f6r\u00f6smarty et al. [2]. **The result is an impact potential based on the water-use efficiency according to the local water stress level.** The underlying idea is that a **company in a region with higher water stress level has a higher potential of making a positive impact** by increasing their water-use efficiency than a company operating in a region with lower water stress level. The developed KPI allows for a comparison of corporate facilities\u2019 impact potential on a global scale taking into account the regional characteristic of water stress level.\n\n## Fundamentals\nFor this purpose, **water-use efficiency** is defined as a facility\u2019s amount of consumed water in proportion to the amount of withdrawn water. Withdrawn water is the total amount of water abstracted from freshwater sources and consumed water is the amount of withdrawn water that is no longer available for downstream use. The water-use efficiency ranges between 0 (worst efficiency level) and 1 (highest efficiency level).\n\nWater-Use Efficiency $ \\eta = \\dfrac{\\text{Withdrawn Water - Consumed Water}}{\\text{Withdrawn Water}}$\n\nSecondly, **water stress level** is the freshwater withdrawal as a proportion of available freshwater resources. Below figure shows the water stress levels on a country-wise level from the [Aqueduct Map](https:\/\/www.wri.org\/aqueduct). Water stress level as defined in the mentioned dataset ranges from 0 to 5 with 0 being the best and 5 being the worst. For the following analysis, we will scale the water stress level to 0 and 1 similarly as the water-use-efficiency, with 0 being the lowest water stress level (best outcome) and 1 being the highest water stress level (worst outcome).\n","70ca508c":"# Impact Potential Analysis of Water-Use Efficiency\n\nWater scarcity is - in different ways - a higly important social, economical and environmental issue. Both, societies and companies depend on water and a healthy planet to provide the fresh water. Freshwater systems are directly threatened by human activities. However, water related risks seem to have less priority in the current public discussion than other, more well-known risks such as climate change. Therefore, we want to bring attention to water related topics in this analysis by developing a new key performance indicator (KPI) for this purpose. This metric evaluates the positive impact potential a corporate facility can have by improving its water-use efficiency in a water stressed area. The metric analyses the water stress level from a local point of view instead from a country point of view since water stress level can strongly vary within a country.\n\nThe key findings are:\n* The impact potential KPI is able to provide more insight than only analysing a facility's water-use efficiency\n* The impact potential KPI could be used as an extention of the water-use efficiency metric\n* Corporations with low water-use efficiency or high impact potential are already taking actions by including water related targets in their targets\/goals\n* In general, knowledge and awareness of water related risks, such as water stress, can be increased\n\n![jeff-ackley-YwDo_HwORXs-unsplash.jpg](attachment:jeff-ackley-YwDo_HwORXs-unsplash.jpg)\n<span>Photo by <a href=\"https:\/\/unsplash.com\/@ackley5?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText\">Jeff Ackley<\/a> on <a href=\"https:\/\/unsplash.com\/s\/photos\/africa-water-people?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText\">Unsplash<\/a><\/span>\n\n# Introduction\n\nAlthough 2\/3 of the surface of the earth is covered in water, it can be observed that water is (a) not equally distributed across the surface of the earth and (b) that the quality\/condition of water determines its usefulness to humans. Water is one of the most essential resources on this planet and is vital to all forms of life. Despite this fact, water scarcity is a harsh reality which 80% of the world\u2019s population is already experiencing today [3] and even more are expected to be affected by it in the future. The United Nations dedicate one of the 17 Sustainable Development Goals (\u201eSDGs\u201c) to \"Clean Water and sanitation\u201c [1].\n\nWater scarcity is created where the water withdrawal from a basin exceeds its recharge. On the one side of the equation, places with rapid population growth or water intensive industry, such as agriculture or energy tend to have high demand for water.  On the other side of the equation, low rainfall or insufficient infrastructure lead to low water supply. Over 1.7 billion people\u00a0are currently living in river basins where water use exceeds recharge [1]. While rich nations might be able to invest in water technology that offsets high stressor levels without remedying their underlying causes, less wealthy nations remain vulnerable [3].\n\n**Water scarcity is both a social issue and an environmental issue. Water is at the heart of basic human security because we need it for food, sanitation, health and energy.** Especially, the COVID19 pandemic has shown the importance of sanitation for preventing diseases. The Impact of COVID should be considerably higher on the urban poor living in slums, who don\u2019t have access to clean water [1]. 3 billion people world wide lack basic hand-washing facilities at home [1]. Therefore, water scarcity could displace 700 million people by 2030 [5]. **On the other hand, water is not only important for humans but for other living organisms on this planet. Therefore, responsible resource use and consumption is an important aspect of water scarcity. Although societies cannot succeed and companies cannot create long-term value without a healthy planet to provide the fresh water, freshwater systems are directly threatened by human activities** [3, 4]. Therefore, we need to establish a responsible use of our water supplies to both tackle the social and environmental issues. Hence, there is a necessity to establish a responsible usage of the earth\u2019s water resources. For this purpose a metric is developed which is looking into a company\u2019s water-use efficiency in the context of its local water stress level. Depending on these variables the impact potential of an increased water-use efficiency of each individual facility is calculated.\n\n# Related Work\n\nThe aim of this analysis is to develop a metric to monitor and manage our water demand and water supply to reduce the risk of water scarcity. Although, currently there is no standard established yet, many metrics have already been proposed. In the following, we will first become familiar with already available metrics regarding water related issues.\n\nWhen it comes to water usage, three main quantitative metrics have to be considered: **Water withdrawal** describes the total amount of water abstracted from freshwater sources for agricultural, domestic and industrial uses. Water discharge describes the amount of water returned after the withdrawal. **Water consumption** is the difference between withdrawn water and discharged water. It is the proportion of water abstracted from freshwater sources that is no longer available for downstream use due to evaporation or incorporation into a product. Based on the above, one indicator proposed in the SDG is the **change in water-use efficiency over time** where water-use efficiency is the ratio between consumed water and withdrawn water [1].\n\nAnother set of metrics focuses on geographical aspects. One metric is the freshwater withdrawal as a proportion of available freshwater resources, which is called the level of water stress [4, 1]. Furthermore, V\u00f6r\u00f6smarty et al. [2] suggest that context-oriented metrics can help uncover counter-intuitive results. The context has to consider output, outcome and impact equally. The World Economic Forum (WEF) [4] is suggesting to combine the water quantity metrics with the geographical metrics and proposes to monitor **water consumption and withdrawal in water-stressed areas**. This way, water withdrawal at the cost of others such as residents or other industries can be monitored. ","c5cc0862":"## Corporations' Ambitions\nQuestion W8.1 asks about a corporation's targets and goals of water related metrics. **Water withdrawal, water consumption, and water-use efficiency are the most common water related targets.** Below left figure shows that more corporations with lower (bad) water-use efficiency tend to have water-use efficiency as their target metric, while corporations with higher (good) water-use efficiency tend to not have this target. As discussed above, our developed metric, the impact potential, is able to provide a more fine-grained insight than the water-use efficiency. Additionally, below right figure shows that the impact potential can be used to detect similar insights as the water-use efficiency metric itself. We can see that corporations with low (good) impact potential tend to not have water-use efficiency targets, while corporations with higher impact potential (bad) tend to have water-use efficiency as a target.\n\nBoth the water-use efficiency and the developed impact potential indicate that corporations are already taking their water-use efficiency improvement potential into account.","83eefc7c":"## Ranking of Facilities with Worst Case Water-Use Efficiency\nAnother advantage of the proposed KPI is that it enables ranking among facilities with the worst case water-use efficiency. If the water-use efficiency was analyzed on its own, there would be quite a few facilities with a water-use efficiency of 0 (or even negative water-use efficiency). However, including the local water stress level can show that a facility with a low water-use efficiency in a highly water stressed area has more impact potential than a facility with zero water-use efficiency in an area with a lower water stress level.","7f131d2c":"## Impact Potential Analysis\nIn the following two examples are visualized. On the one hand, the S\u00e3o Paulo region with a low water stress level and on the other hand the Andhra Pradesh region with a higher water stress level are shown with the facilities closest to them. ","e42a09ca":"Below figure shows the **importance of a fine-grained view of the water stress level**. For example, the United States have a medium water stress level from a national point of view. However, by only looking at the water stress level state-wise, it is obvious that depending on the local region, the water stress levels can vary strongly.","06804789":"### Aqueduct Map Dataset (2020)\nFrom the [Aqueduct Map](https:\/\/www.wri.org\/aqueduct) we will retrieve longitude and latitude for each area with a value for the water stress level. Then we will calculate for each facility which area from the aqueduct dataset is closest within a 100 km radius and then map the water stress level of it to the facility.","c2e44ea7":"Below figure shows the impact potential of all disclosed facilities.","95b754f6":"Finally, we will demonstrate that the metric is robust for edge cases also. As shown on the left in below figure, facilities with a water-use efficiency of 1 will have an impact potential of 0 independent of the water stress level in the area. For the worst case scenario as shown on the right, we can see that a facility operating in a area with a higher water stress level has a higher impact potential than a facility operating in an area with lower water stress level if both facilities have the same water-use efficiency of 0. Additionally, we can see that the maximum impact potential is 0.707 ($\\dfrac{\\sqrt{2}}{2}$). \n","41efb4ad":"## KPI: Impact Potential\nThe following figure shows two sample facilities. Both facilities have a water-use efficiency of 0.5. However, facility A is located in an area with lower water stress level than facility B."}}