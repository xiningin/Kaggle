{"cell_type":{"d27dcb0b":"code","5ddddb2c":"code","a595dbac":"code","8bbef393":"code","02a40ab3":"code","fe87127b":"code","93476cda":"code","ab633956":"code","2ea8c130":"code","386a256f":"code","0da0f5e3":"code","efce2e79":"code","5a4e7bfc":"code","8fa3442e":"code","3f9c4e19":"code","d59d01af":"code","e644efc4":"code","f0d9f4f3":"code","4fb6c2b7":"code","bf3bf8e8":"code","f6b45c57":"code","a63613fa":"code","b559ca65":"code","12596dbb":"code","be566064":"code","c85b21b6":"code","55570d49":"code","8e028cbd":"code","edf12bc5":"code","13404235":"code","fd62d344":"code","ee950254":"code","00709f0e":"code","e7f2cd58":"code","404faadf":"code","eac1ba70":"code","5570dc07":"code","f3e6ccdc":"code","6d4b8056":"markdown","9bf49426":"markdown","d35296bb":"markdown","007012bc":"markdown"},"source":{"d27dcb0b":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","5ddddb2c":"import pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport numpy as np\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.metrics import roc_auc_score\n#!pip install catboost\nfrom catboost import CatBoostClassifier\nfrom sklearn.utils import class_weight","a595dbac":"#Reading the Data Files\ntrain=pd.read_csv('..\/input\/jobathon-analytics-vidhya\/train.csv')\nprint(train.shape)\ntrain.head()","8bbef393":"test=pd.read_csv('..\/input\/jobathon-analytics-vidhya\/test.csv')\nprint(test.shape)\ntest.head()","02a40ab3":"sns.countplot(x='Response',data=train)\nplt.show()","fe87127b":"sns.countplot(x='Accomodation_Type',data=train,hue='Response')\nplt.show()","93476cda":"sns.countplot(x='Health Indicator',data=train,hue='Response')\nplt.show()","ab633956":"train.isnull().sum()","2ea8c130":"cols_with_missing = [col for col in train.columns if train[col].isnull().any()]\nprint('Columns with Missing values : ')\ncols_with_missing","386a256f":"#Adding new columns to give the information about missing rows\nfor col in cols_with_missing:\n  train[col + '_was_missing'] = train[col].isnull()\n  train[col + '_was_missing']=train[col + '_was_missing'].apply(lambda x: 1 if x==True else 0)","0da0f5e3":"cols_with_missing = [col for col in test.columns if test[col].isnull().any()]","efce2e79":"for col in cols_with_missing:\n  test[col + '_was_missing'] = test[col].isnull()\n  test[col + '_was_missing']=test[col + '_was_missing'].apply(lambda x: 1 if x==True else 0)","5a4e7bfc":"#Filling missing values with a new category 'X'\n\ntrain['Health Indicator'].fillna('X',inplace=True)\ntest['Health Indicator'].fillna('X',inplace=True)\n\ntrain['Holding_Policy_Duration'].fillna('X',inplace=True)\ntest['Holding_Policy_Duration'].fillna('X',inplace=True)\n\ntrain['Holding_Policy_Type'].fillna('X',inplace=True)\ntest['Holding_Policy_Type'].fillna('X',inplace=True)","8fa3442e":"train.isnull().sum().sum()","3f9c4e19":"#Making the column to be a categorical\n\ntrain['Holding_Policy_Type']=train['Holding_Policy_Type'].apply(lambda x:str(x))\ntest['Holding_Policy_Type']=test['Holding_Policy_Type'].apply(lambda x:str(x))\n\n#Making the column to be a categorical\n\ntrain['Reco_Policy_Cat']=train['Reco_Policy_Cat'].apply(lambda x:str(x))\ntest['Reco_Policy_Cat']=test['Reco_Policy_Cat'].apply(lambda x:str(x))\n\n\n#Getting a new feature age_diff\ntrain['age_diff']=train['Upper_Age']-train['Lower_Age']\ntest['age_diff']=test['Upper_Age']-test['Lower_Age']","d59d01af":"#Making a copies of original data\n\ntrain_org=train.copy()\ntest_org=test.copy()","e644efc4":"def response_coding(data,column,alpha):\n  '''This function performs reponse coding on the given column with laplace smoothing'''\n  responses={}\n  train=train_org\n  unique_categories=list(train[column].unique())\n  for category in unique_categories:\n    prob_score=0\n    if 1 in list(train[train[column]==category]['Response'].value_counts().index):\n      prob_score=(train[train[column]==category]['Response'].value_counts()[1]+alpha*1)\/(len(train[train[column]==category]['Response'])+alpha*2)\n    else:\n      prob_score=(alpha*1)\/(len(train[train[column]==category]['Response'])+alpha*2)\n    responses[category]=prob_score\n  data[column+'_response']=data[column].apply(lambda x : responses[x] if x in responses.keys() else 0 )","f0d9f4f3":"#Getting the reponse coded columns\n\nresponse_coding_columns=['Region_Code','City_Code','Health Indicator','Holding_Policy_Duration','Reco_Policy_Cat','age_diff','Reco_Policy_Premium']\nfor col in response_coding_columns:\n  response_coding(train,col,1)\n  response_coding(test,col,1)","4fb6c2b7":"#Performing One hot Encoding on Categoricla columns\ncategory_labels_dict={}\ncategory_columns=['Holding_Policy_Type','Reco_Policy_Cat','City_Code','Health Indicator']\nfor column in category_columns:\n  unq_categories=list(train[column].unique())\n  #dictionary=dict((value,index) for index,value in enumerate(unq_categories) )\n  category_labels_dict[column]=unq_categories","bf3bf8e8":"def get_dummies(data,column):\n  category_labels=category_labels_dict[column]\n  for category in category_labels:\n    data[column+'_'+category]=data[column].apply(lambda x:1 if x==category else 0)\n  data.drop([column],axis=1,inplace=True)","f6b45c57":"for column in category_columns:\n  get_dummies(train,column)\n  get_dummies(test,column)","a63613fa":"# Converting Holding_Policy_Duration into a numeric column\n\ntrain['Holding_Policy_Duration']=train['Holding_Policy_Duration'].replace('14+','15')\ntest['Holding_Policy_Duration']=test['Holding_Policy_Duration'].replace('14+','15')\ntrain['Holding_Policy_Duration']=train['Holding_Policy_Duration'].apply(lambda x: float(x) if x!='X' else 0 )\ntest['Holding_Policy_Duration']=test['Holding_Policy_Duration'].apply(lambda x: float(x) if x!='X' else 0 )","b559ca65":"#Performing Label encoding on some columns\ntrain['Accomodation_Type']=train['Accomodation_Type'].apply(lambda x : 1 if x=='Rented' else 0)\ntest['Accomodation_Type']=test['Accomodation_Type'].apply(lambda x : 1 if x=='Rented' else 0)\n\ntrain['Reco_Insurance_Type']=train['Reco_Insurance_Type'].apply(lambda x : 1 if x=='Joint' else 0)\ntest['Reco_Insurance_Type']=test['Reco_Insurance_Type'].apply(lambda x : 1 if x=='Joint' else 0)\n\ntrain['Is_Spouse']=train['Is_Spouse'].apply(lambda x : 1 if x=='Yes' else 0)\ntest['Is_Spouse']=test['Is_Spouse'].apply(lambda x : 1 if x=='Yes' else 0)","12596dbb":"#Creating a new column  is_joint_and_married\ntrain['is_joint_and_married']=train['Reco_Insurance_Type']^train['Is_Spouse']\ntest['is_joint_and_married']=test['Reco_Insurance_Type']^test['Is_Spouse']","be566064":"train.head()","c85b21b6":"test.head()","55570d49":"X_train=train.drop(['ID','Response'],axis=1)\ny_train=train[['Response']]\nX_test=test.drop(['ID'],axis=1)","8e028cbd":"#Creating train and test split\nX_train, X_cv, y_train, y_cv = train_test_split(X_train, y_train,stratify=y_train, test_size=0.3, random_state=42)","edf12bc5":"print('X_train : ',X_train.shape,' y_train : ',y_train.shape)\nprint('X_cv : ',X_cv.shape,' y_cv : ',y_cv.shape)\nprint('X_test : ',X_test.shape)","13404235":"scalar=StandardScaler()\ncolumns_std=['City_Code_response','Region_Code_response','Upper_Age','Lower_Age','Health Indicator_response','Holding_Policy_Duration','Region_Code',\n             'Holding_Policy_Duration_response','Reco_Policy_Premium','age_diff','Reco_Policy_Cat_response','age_diff_response','Reco_Policy_Premium_response']\nscalar.fit(X_train[columns_std])","fd62d344":"X_train[columns_std]=scalar.transform(X_train[columns_std])\nX_cv[columns_std]=scalar.transform(X_cv[columns_std])\nX_test[columns_std]=scalar.transform(X_test[columns_std])","ee950254":"weights = class_weight.compute_class_weight('balanced',np.unique(y_train['Response']),y_train['Response'])\nprint('Using class weights while training')\nlist(weights)","00709f0e":"#Training catboost Classifier model\nparams={\n    'loss_function':'Logloss',\n    'eval_metric':'AUC',\n    'verbose':200,\n    'random_seed':42,\n    'class_weights':list(weights)\n}\n\ncat_boost=CatBoostClassifier(**params,)\ncat_boost.fit(X_train,y_train,eval_set=(X_cv,y_cv),use_best_model=True,plot=True)","e7f2cd58":"print('Train AUC :',roc_auc_score(y_train, cat_boost.predict_proba(X_train)[:, 1]))\nprint('CV AUC :',roc_auc_score(y_cv, cat_boost.predict_proba(X_cv)[:, 1]))","404faadf":"feat_imp=[t for t in zip(X_train.columns,cat_boost.get_feature_importance())]\nfeat_imp_df=pd.DataFrame(feat_imp,columns=['feature','importance'])\nfeat_imp_df=feat_imp_df.sort_values('importance',ascending=False)\nprint('Most important Features are :')\nfeat_imp_df=feat_imp_df[feat_imp_df['importance']>=1]\nsns.barplot(x='importance',y='feature',data=feat_imp_df)\nplt.show()","eac1ba70":"def predict(model,filename):\n  '''This function takes model and filename and gives predictions csv file'''\n  predicted_proba=model.predict_proba(X_test)\n  predicted_proba=np.asarray(predicted_proba)\n  predicted_proba=predicted_proba[:,1]\n  predictions=pd.DataFrame(columns=['ID','Response'])\n  predictions['ID']=test['ID']\n  predictions['Response']=predicted_proba\n  predictions.to_csv(filename,index=False)\n  return predictions","5570dc07":"predictions=predict(cat_boost,'submission.csv')","f3e6ccdc":"predictions.head()","6d4b8056":"**Feature Engineering**","9bf49426":"**Training**","d35296bb":"**EDA**","007012bc":"**Filling missing values**"}}