{"cell_type":{"50e272d9":"code","eafe70d2":"code","f40f7816":"code","a743417c":"code","637fe0c8":"code","b56f6387":"code","eb02fdda":"code","4e7ee00c":"code","dd4b4174":"code","99853124":"code","5ca65a03":"code","07b1abd4":"code","86f2d564":"code","4518653b":"code","c1f0de60":"code","f4b4c707":"code","d12e869c":"code","39c42c18":"code","4845ad4c":"code","793b0d5f":"code","11908bae":"code","6c7ff144":"code","67933203":"code","5b4421b3":"code","d4bedfb6":"markdown","8b2b79af":"markdown","ae63a1c1":"markdown","2533a626":"markdown","1cea8520":"markdown","97494650":"markdown","d5fe36ba":"markdown","b79ae2df":"markdown","7e3af04c":"markdown","0a48141c":"markdown","eea80ca3":"markdown","4f9f9372":"markdown","071e020b":"markdown","fb2a699a":"markdown","bd8f6f38":"markdown","448e9075":"markdown","890bd0ff":"markdown","04d3760d":"markdown"},"source":{"50e272d9":"# Import libs\nfrom glob import glob\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns","eafe70d2":"# Set the width to display\npd.set_option('display.width', 120)\n# Increase the number of rows to display\npd.set_option('display.max_rows', 60) \n\n# Get the data\nhappiness = pd.read_csv('\/kaggle\/input\/world-happiness\/2018.csv')\n\n# Column map to rename\ncols_dict = {'Country':'country',\n             'Country or region':'country',\n             'Region':'region',\n             'Happiness Rank':'rank',\n             'Happiness.Rank':'rank',\n             'Overall rank':'rank',\n             'Happiness Score':'score',\n             'Happiness.Score':'score',\n             'Score':'score',\n             'Economy (GDP per Capita)':'gdp_per_capita',\n             'Economy..GDP.per.Capita.':'gdp_per_capita',\n             'GDP per capita':'gdp_per_capita',\n             'Family':'family',\n             'Freedom':'freedom',\n             'Freedom to make life choices':'freedom',\n             'Generosity':'generosity',\n             'Health (Life Expectancy)':'life_expectancy',\n             'Health..Life.Expectancy.':'life_expectancy',\n             'Healthy life expectancy':'life_expectancy',\n             'Perceptions of corruption':'trust_corruption',\n             'Trust (Government Corruption)':'trust_corruption',\n             'Trust..Government.Corruption.':'trust_corruption',\n             'Social support':'social_support',\n             'Dystopia Residual':'dystopia_residual',\n             'Dystopia.Residual':'dystopia_residual',\n             'Standard Error':'standard_error',\n             'Upper Confidence Interval':'whisker_high',\n             'Whisker.high':'whisker_high',\n             'Lower Confidence Interval':'whisker_low',\n             'Whisker.low':'whisker_low'\n            }\n\n# Rename the columns\nhappiness.rename(columns=cols_dict, inplace=True)\n\nprint(happiness.columns) # check the new column names\nhappiness.head() # check the values","f40f7816":"happiness.info()","a743417c":"# Duplicated\nprint('Duplicated: {}'.format(happiness.duplicated(subset='country').sum()))","637fe0c8":"cia_files = glob('\/kaggle\/input\/the-world-factbook-by-cia\/cia.age.*.2018.txt')\n\ncia = pd.DataFrame()\n\nfor file in cia_files:\n    c = pd.read_csv(file,\n                    engine='python', sep=r'\\s{3,}', header=None,\n                    names=['country_cia', file.split('.')[2], 'data_year'],\n                    squeeze=False, skiprows=1, index_col=0,\n                    thousands=',', dtype={file.split('.')[2]:'float64'}\n                   )[['country_cia', file.split('.')[2]]] # read the file\n    if cia.size == 0:\n        cia = cia.append(c)\n        print('Initialize {}: {}'.format(file.split('.')[2], cia.shape[0])) # for the first file\n    else:\n        cia = cia.merge(c, on='country_cia', how='outer')\n        print('Merge {}: {}'.format(file.split('.')[2], cia.shape[0]))\n\ncia.reset_index()\n\ncia.info()\ncia","b56f6387":"cia.describe()","eb02fdda":"# Print the countries with the min life expectancy at birth\nprint('TOP5 countries with the min life expectancy at birth')\ncia[['country_cia', 'life_expectancy_at_birth']].sort_values(by='life_expectancy_at_birth', ascending=True).head()","4e7ee00c":"# Print the countries with the min median age\nprint('TOP5 countries with the min median age')\ncia[['country_cia', 'median_age']].sort_values(by='median_age', ascending=True).head()","dd4b4174":"# Print the countries with the max life expectancy at birth\nprint('TOP5 countries with the max life expectancy at birth')\ncia[['country_cia', 'life_expectancy_at_birth']].sort_values(by='life_expectancy_at_birth', ascending=False).head()","99853124":"# Print the countries with the max median age\nprint('TOP5 countries with the max median age')\ncia[['country_cia', 'median_age']].sort_values(by='median_age', ascending=False).head()","5ca65a03":"cia['country'] = cia['country_cia']","07b1abd4":"happiness_cia = happiness.merge(cia, on='country', how='outer')[['country', 'score', 'population_growth']]\n\npd.set_option('display.max_rows', 100) # increase the number of rows to display\nhappiness_cia[happiness_cia.isnull().any(axis=1)].sort_values(by=['score', 'country']) # the countries don't match","86f2d564":"# Countries map to rename\ncountry_to_rename = {'Cote d\\'Ivoire':'Ivory Coast',\n                     'Congo, Republic of the':'Congo (Brazzaville)',\n                     'Congo, Democratic Republic of the':'Congo (Kinshasa)',\n                     'Burma':'Myanmar',\n                     'Korea, South':'South Korea',\n                     'Czechia':'Czech Republic',\n                     'Trinidad and Tobago':'Trinidad & Tobago',\n                     'Korea, South':'South Korea'\n                    }\n# Rename the countries\ncia['country'].replace(country_to_rename, inplace=True)\n\ncia.sample(5, random_state=11) # check the values randomly","4518653b":"happiness_cia = happiness.merge(cia, on='country', how='left').copy()\n\nhappiness_cia.info()","c1f0de60":"happiness_cia.sort_values(by='median_age', ascending=False)","f4b4c707":"# Select the columns of interest\ncols_corr = ['country', 'score',\n             'life_expectancy_at_birth',\n             'median_age', 'birth',\n             'population_growth', 'death'\n            ]\nhappiness_cia = happiness_cia[cols_corr]\nhappiness_cia","d12e869c":"# Get correlation matrix\nhappiness_cia_corr = happiness_cia.corr()\nhappiness_cia_corr","39c42c18":"%matplotlib inline\n\n# Turn on svg rendering\n%config InlineBackend.figure_format = 'svg'\n\n# Color palette for the blog\nsnark_palette = ['#e0675a', # red\n                 '#5ca0af', # green\n                 '#edde7e', # yellow\n                 '#211c47' # dark blue\n                ]","4845ad4c":"# Color palette for the data\npalette = 'summer_r'\n\n# Inscriptions\ntitle = \"\"\"The Relationship Between Life Expectancy at Birth And Happiness\"\"\"\ndescription = \"\"\"\nCorrelation of the life expectancy at birth with the happiness score by country based on 2018 data.\nData: Gallup World Poll - www.kaggle.com\/unsdsn\/world-happiness & CIA - www.cia.gov\/library\/publications\/the-world-factbook | Author: @data.sugar\n\"\"\"\n\n# Plot size\nfigsize = (6,4)\n\n# Set the figure\nsns.set(context='paper', style='ticks', palette=snark_palette,\n        rc={'xtick.major.size': 4, 'ytick.major.size':4,\n            'axes.spines.left': True, 'axes.spines.bottom': True,\n            'axes.spines.right': False, 'axes.spines.top': False\n           }\n       )\n\n# Create the plot\nfig = plt.figure(figsize=figsize, facecolor='w')\nax = sns.scatterplot(x='life_expectancy_at_birth', y='score',\n                     hue=happiness_cia['score'].tolist(),\n                     size=happiness_cia['life_expectancy_at_birth'].tolist(),\n                     sizes=(10,100),\n                     data=happiness_cia,\n                     palette=palette, legend=False\n                    )\n\n# Set some aesthetic params for the plot\nax.set_title(title, fontdict={'fontsize': 16}, loc='center', pad=10, c=snark_palette[-1]) # set a title of the plot\nax.annotate(description, xy=(0.1, -0.015), size=6, xycoords='figure fraction', c=snark_palette[-1])\nax.spines['bottom'].set_linestyle((0, (1, 10)))\nax.spines['bottom'].set_color(snark_palette[-1])\nax.spines['left'].set_linestyle((0, (1, 10)))\nax.spines['left'].set_color(snark_palette[-1])\nax.set_xlabel('Life Expectancy at Birth', horizontalalignment='center', size='x-large', c=snark_palette[-1]) # set label of x axis\nax.set_xticks([i for i in range(50, 100, 10)])\nax.set_xticklabels([i for i in range(50, 100, 10)], c=snark_palette[-1])\nax.set_ylabel('Score', horizontalalignment='center', size='x-large', c=snark_palette[-1]) # set label of y axis\nax.set_yticks([i for i in range(2, 9)])\nax.set_yticklabels([i for i in range(2, 9)], c=snark_palette[-1])\nax.tick_params(axis='both', labelsize='small', colors=snark_palette[-1], direction='out') # set x\/y ticks\n\n# Save and plot\nplt.savefig('\/kaggle\/working\/plot.happiness.life_exp_at_birth.png', dpi=150, bbox_inches='tight')\nplt.show()","793b0d5f":"# Calculate min and max median age\nmedian_age_min = cia['median_age'].min()\nmedian_age_max = cia['median_age'].max()\n\n# Calculate bins\nbin_step = 5\nbin_from = int((median_age_min \/\/ bin_step) * bin_step)\nbin_to = int((median_age_max \/\/ bin_step) * bin_step + bin_step)\nbins = [i for i in range(bin_from, bin_to, bin_step)] # age groups\n\nhappiness_cia['age_range'] = pd.cut(happiness_cia['median_age'], bins)\nhappiness_cia_grouped = (happiness_cia[['age_range', 'median_age', 'score']].groupby('age_range')\n                                                                            .mean()\n                                                                            .reset_index()\n                        )\nhappiness_cia_grouped","11908bae":"# Inscriptions\ntitle = \"\"\"The Relationship Between Median Age And Happiness\"\"\"\ndescription = \"\"\"\nCorrelation of the median age with the happiness score by country based on 2018 data.\nData: Gallup World Poll - www.kaggle.com\/unsdsn\/world-happiness & CIA - www.cia.gov\/library\/publications\/the-world-factbook | Author: @data.sugar\n\"\"\"\n\n# Plot size\nfigsize = (6,4)\n\n# Set the figure\nsns.set(context='paper', style='whitegrid', palette=snark_palette,\n        rc={'xtick.major.size': 4, 'ytick.major.size':4,\n            'axes.spines.left': False, 'axes.spines.bottom': False,\n            'axes.spines.right': False, 'axes.spines.top': False\n           }\n       )\n\n# Create the plot\nfig = plt.figure(figsize=figsize, facecolor='w')\nax = sns.violinplot(x='age_range', y='score', data=happiness_cia,\n                    inner='quart', linewidth=1,\n                    palette='spring_r'\n                   )\n\n# Set some aesthetic params for the plot\nax.set_title(title, fontdict={'fontsize': 16}, loc='center', pad=10, c=snark_palette[-1]) # set a title of the plot\nax.annotate(description, xy=(0.03, 0), size=6, xycoords='figure fraction', c=snark_palette[-1])\nax.xaxis.set_label_text('') # remove label of x axis\nax.text(s='Median Age', x=3, y=2.2, horizontalalignment='center', verticalalignment='center', size='large', c=snark_palette[-1]) # set label of x axis\nax.set_ylabel('Happiness score', horizontalalignment='center', size='large', c=snark_palette[-1]) # set label of y axis\nax.tick_params(axis='both', labelsize='medium', colors=snark_palette[-1]) # set x\/y ticks\n\n# Save and plot\nplt.savefig('\/kaggle\/working\/plot.happiness.median_age.png', dpi=150, bbox_inches='tight')\nplt.show()","6c7ff144":"# A triangular mask to avoid repeated values\nhappiness_cia_corr = happiness_cia_corr.iloc[1:, :-1]\nmask = np.triu(np.ones_like(happiness_cia_corr), k=1)\n\n# Readable names for the plot\ncols_dict = {'score':'Happiness',\n             'life_expectancy_at_birth':'Life exp.\\nat birth',\n             'median_age':'Median\\nage',\n             'birth':'Birth',\n             'population_growth':'Population\\ngrowth',\n             'death':'Death'\n            }\n# Rename columns in the correlation matrix\nhappiness_cia_corr.rename(columns=cols_dict, index=cols_dict, inplace=True)","67933203":"# Color palette for the data\npalette = [snark_palette[0], # red\n           'lightgrey',\n           snark_palette[1] # green\n          ]\n\n# Inscriptions\ntitle = \"\"\"Relationship Between Age Indicators And The Happiness score\"\"\"\ndescription = \"\"\"\n\u0421orrelation of age indicators with the happiness score by country based on 2018 data.\nData: Gallup World Poll - www.kaggle.com\/unsdsn\/world-happiness & CIA - www.cia.gov\/library\/publications\/the-world-factbook | Author: @data.sugar\n\"\"\"\n\n# Plot size\nfigsize = (6,4)\n\n# Set the figure\nsns.set(context='paper', style='ticks', palette=palette,\n        rc={'xtick.bottom':False, 'ytick.left':False, \n            'axes.spines.left': False, 'axes.spines.bottom': False,\n            'axes.spines.right': False, 'axes.spines.top': False\n           }\n       )\n\n# Create the plot\nfig, ax = plt.subplots(1, 1, figsize=figsize, facecolor='w')\nsns.heatmap(happiness_cia_corr, mask=mask, cmap=palette,\n            vmin=-1, vmax=1, center=0,\n            square=False, linewidths=.5, annot=True, fmt='.2g',\n            cbar_kws={'shrink': 1, 'ticks':[], 'label':'-1 negative <- correlation -> positive +1'},\n            ax=ax)\n\n# Set some aesthetic params for the plot\nax.set_title(title, fontdict={'fontsize': 16}, loc='center', pad=10, c=snark_palette[-1]) # set a title of the plot\nax.annotate(description, xy=(20, -4), size=6, xycoords='figure points', c=snark_palette[-1])\nax.tick_params(axis='both', colors=snark_palette[-1]) # set x\/y ticks\nax.set_yticklabels(ax.get_yticklabels(), rotation=0) # set rotation for y tick labels\n\n# Save and plot\nplt.savefig('\/kaggle\/working\/plot.happiness.age.png', dpi=150, bbox_inches='tight')\nplt.show()","5b4421b3":"# Inscriptions\ntitle = \"\"\"The Relationship Between Median Age And Birth\"\"\"\ndescription = \"\"\"\nCorrelation of the median age with the birth rate by country based on 2018 data.\nData: Gallup World Poll - www.kaggle.com\/unsdsn\/world-happiness & CIA - www.cia.gov\/library\/publications\/the-world-factbook | Author: @data.sugar\n\"\"\"\n\n# Plot size\nfigsize = (6,4)\n\n# Set the figure\nsns.set(context='paper', style='ticks', palette=snark_palette,\n        rc={'xtick.major.size': 4, 'ytick.major.size':4,\n            'axes.spines.left': False, 'axes.spines.bottom': False,\n            'axes.spines.right': False, 'axes.spines.top': False\n           }\n       )\n\n# Create the plot\nfig = plt.figure(figsize=figsize, facecolor='w')\ng = sns.jointplot(x='median_age', y='birth', data=happiness_cia,\n                  kind='reg', truncate=False, dropna=True,\n                  xlim=(10, 50), ylim=(0, 50),\n                  marginal_kws=dict(hist=True, bins=10),\n                  color=snark_palette[0]\n                 )\n\n# Set some aesthetic params for the plot\ng.ax_marg_x.set_title(title, fontdict={'fontsize': 16}, loc='center', pad=10, c=snark_palette[-1]) # set a title of the plot\ng.ax_marg_x.annotate(description, xy=(0.015, -0.01), size=6, xycoords='figure fraction', c=snark_palette[-1])\ng.ax_joint.set_xlabel('Median Age', horizontalalignment='center', size='x-large', c=snark_palette[-1]) # set label of x axis\ng.ax_joint.set_ylabel('Birth', horizontalalignment='center', size='x-large', c=snark_palette[-1]) # set label of y axis\ng.ax_joint.tick_params(axis='both', labelsize='large', colors=snark_palette[-1]) # set x\/y ticks\ng.ax_joint.spines['bottom'].set_color(snark_palette[-1]) # color x axis\ng.ax_joint.spines['left'].set_color(snark_palette[-1]) # color y axis\ng.ax_marg_x.tick_params(axis='x', bottom=False) # disable x margin ticks\ng.ax_marg_x.spines['bottom'].set_color(snark_palette[0])\ng.ax_marg_y.tick_params(axis='y', left=False) # disable y margin ticks\ng.ax_marg_y.spines['left'].set_color(snark_palette[0])\n\n# Save and plot\nplt.savefig('\/kaggle\/working\/plot.happiness.age.birth.png', dpi=150, bbox_inches='tight')\nplt.show()","d4bedfb6":"We can now use the `country` column to merge the two datasets.","8b2b79af":"## Preparing The Data Sets\n\nNow we should combine the `happiness` and `cia` datasets.\n\nFirst, we need to check the columns that will be used for merging.\nCountry names may differ in data sets, for instance, `eSwatini` and `Swaziland`, `Trinidad and Tobago` and `Trinidad & Tobago`. In this case, the rows will not match.\n\nBefore, we store the `country_cia` column of the `cia` in a new column `country`.","ae63a1c1":"Let's compare the `country` columns of the `happiness` data set and the `cia` data set.\nTo do this, we'll combine two data sets using `outer` join.","2533a626":"Life expectancy today is about 73 years. The average age of a modern person is about 30 years.  \nWhat are the countries with the lowest life expectancy at birth and median age?  \nLet's define TOP5 ratings.","1cea8520":"### Happiness Reports\n\nAs we mentioned above, we'll read the happiness report published in 2018.  \nWe'll also rename the columns according to the snake_case format.","97494650":"Unfortunately, the happiness score is not defined for the country with the highest median age, Monaco. We'll have to exclude this country from consideration. However, this doesn't prevent us from high level evaluating the relationships between the indicators.  \nLet's build a correlation matrix by columns.","d5fe36ba":"To provide the same country names:\n\n- Create a dictionary mapping all names to the values in the `happiness` dataset since we explore the happiness data.\n- Rename the countries in the `cia` dataset by replacing the values according to the map dictionary.","b79ae2df":"What are the countries with the highest life expectancy at birth and median age?","7e3af04c":"It's OK. Let's get the CIA data.\n\n### CIA Reports\n\nWe have downloaded The World Factbook archive for different years and saved the data that was collected in 2018.","0a48141c":"## Correlation Map\n\nWe'll plot the correlation matrix below, but first, we'll prepare the data to make the plot easier to read.","eea80ca3":"We see 156 countries in the report of 2018. There are no missing values for the `country`, `rank`, `score` columns.\n\nLet's check for duplicates.","4f9f9372":"## Median Age And Birth","071e020b":"# In Search Of Happiness: When Is It?\n\nThe happiness challenge on the go!  \nWe have already answered some questions about happiness. You can read about this and much more [here](https:\/\/nbviewer.jupyter.org\/github\/chupstee\/data.sugar\/blob\/master\/00002_world_happiness\/world_happiness.map.ipynb).  \nToday we wondered when we are becoming happier.  \nWe'll take [the World Happiness report from Kaggle](https:\/\/www.kaggle.com\/unsdsn\/world-happiness?select=2018.csv), which ranks 156 countries by their level of happiness on a 10-point scale.\n\n\n## The World Happiness Report\n\nRecall quoting Kaggle:\n\nThe World Happiness Report is a landmark survey of the state of global happiness. The first report was published in 2012, the second in 2013, the third in 2015, and the fourth in the 2016 Update. The World Happiness 2017, which ranks 155 countries by their happiness levels, was released at the United Nations at an event celebrating International Day of Happiness on March 20th. The report continues to gain global recognition as governments, organizations and civil society increasingly use happiness indicators to inform their policy-making decisions. Leading experts across fields \u2013 economics, psychology, survey analysis, national statistics, health, public policy and more \u2013 describe how measurements of well-being can be used effectively to assess the progress of nations. The reports review the state of happiness in the world today and show how the new science of happiness explains personal and national variations in happiness.\n\nYou can read more [here](https:\/\/www.kaggle.com\/unsdsn\/world-happiness).\n\nWe are most interested in the following columns:\n\n- `Country or region` - country name\n- `Overall rank` - country's place in the rating\n- `Score` - happiness score\n\n\n## Introduction\n\nWe'll try to identify the relationship between the level of happiness and the age of the population by country.\n\n[The World Factbook](https:\/\/www.cia.gov\/library\/publications\/the-world-factbook) by CIA provides information on the history, people and society, government, economy, energy, geography, communications, transportation, military, and transnational issues for 267 world entities.  \nFor our purposes, we will take the following indicators:\n\n- `Life expectancy at birth` - the average number of years to be lived by a group of people born in the same year, if mortality at each age remains constant in the future. Life expectancy at birth is also a measure of overall quality of life in a country and summarizes the mortality at all ages.  \n- `Median age` - the age that divides a population into two numerically equal groups; that is, half the people are younger than this age and half are older. It is a single index that summarizes the age distribution of a population. Currently, the median age ranges from a low of about 15 in Niger and Uganda to 40 or more in several European countries and Japan.  \n- `Population growth rate` - the average annual percent change in populations, resulting from a surplus (or deficit) of births over deaths and the balance of migrants entering and leaving a country. The rate may be positive or negative.\n- `Death rate` - the average annual number of deaths during a year per 1,000 population at midyear; also known as crude death rate.\n- `Birth rate` - the average annual number of births during a year per 1,000 persons in the population at midyear; also known as crude birth rate.\n\nWe will compare the happiness scores with the CIA rates for 2018, as this is the year when the data is presented in the most complete way.  \n\nLet's find out ***when*** *is happiness*.\n\n\n## Reading The Data","fb2a699a":"## Median Age And Happiness Score\n\nWe would like to see how happiness is distributed according to the age of the population.  \nTo do this, we will divide the countries by age group based on the median age.","bd8f6f38":"It is interesting to see what the median age and life expectancy in the world are.","448e9075":"We can see relationships between some parameters. \nLet's plot the most interesting of them.\n\n## Life Expectancy at Birth And Happiness","890bd0ff":"Not surprisingly, the older the population, the lower the birth rate. It's surprising how strong the correlation is between birth rate and median age.  \nThe younger population has a higher population growth rate, but it is less happy.","04d3760d":"## Conclusions\n\n[In the previous project](https:\/\/nbviewer.jupyter.org\/github\/chupstee\/data.sugar\/blob\/master\/00002_world_happiness\/world_happiness.where.map.ipynb), we have already defined the TOP5 least happy countries. This rating includes Afghanistan and the Central African Republic.  \nThese countries were also included in the TOP5 countries with the lowest life expectancy at birth.  \n\nLife expectancy at birth describes the overall quality of life in the country and indicates the health of the population. Not surprisingly, the higher the life expectancy at birth, the higher the happiness score.  \n\nLet's take a look at the relationship between median age and happiness.  \nIt seems that society in its development reaches some point of saturation, when a person, living a longer life, does not become happier.  \n\nSome correlations indicate that the older the population, the less striving (or able?) to self-reproduction:\n\n- the higher median age, the lower population growth;\n- the higher median age, the lower birth rate.\n\nEarlier, we found out that thirty three is a special age. You will find research on this topic [here](https:\/\/nbviewer.jupyter.org\/github\/chupstee\/data.sugar\/blob\/master\/00001_thirty_years_old\/thirty_years_old.ipynb).  \nIt is curious that the age of the population over which the happiness score does not change significantly is also about thirty five years old.  \nEven more interesting is that the median age of the world's population is thirty years, as we saw above.  \nWell, perhaps humanity is in its prime. On average, of course."}}