{"cell_type":{"5642cf85":"code","5f0ff5b5":"code","02fe2d80":"code","2932ac38":"code","64bbe401":"code","44aed1d7":"markdown"},"source":{"5642cf85":"print('loading libs...')\nimport warnings\nwarnings.filterwarnings(\"ignore\")\nimport os\nimport gc\nimport numpy as np\nimport pandas as pd\nfrom sklearn import preprocessing\nimport xgboost as xgb\nfrom tqdm import tqdm\nfrom sklearn.model_selection import KFold\nimport lightgbm as lgb\nfrom sklearn.metrics import roc_auc_score\nprint('done')","5f0ff5b5":"%%time\nprint('loading data...')\ntrain_transaction = pd.read_csv('..\/input\/ieee-fraud-detection\/train_transaction.csv', index_col='TransactionID')\ntest_transaction = pd.read_csv('..\/input\/ieee-fraud-detection\/test_transaction.csv', index_col='TransactionID')\ntrain_identity = pd.read_csv('..\/input\/ieee-fraud-detection\/train_identity.csv', index_col='TransactionID')\ntest_identity = pd.read_csv('..\/input\/ieee-fraud-detection\/test_identity.csv', index_col='TransactionID')\nsample_submission = pd.read_csv('..\/input\/ieee-fraud-detection\/sample_submission.csv')\nprint('done')\n","02fe2d80":"features=['TransactionDT', 'card1', 'TransactionAmt', 'card2', 'addr1',\n       'P_emaildomain', 'D15', 'card5', 'C13', 'dist1', 'D10', 'D4',\n       'id_02', 'D1', 'id_20', 'C1', 'id_19', 'D2', 'id_31', 'D8', 'C2',\n       'DeviceInfo', 'D11', 'C14', 'C6', 'C11', 'R_emaildomain', 'C9',\n       'id_06', 'V313', 'id_05', 'M4', 'D3', 'id_33', 'M6', 'D5', 'dist2',\n       'V307', 'V310', 'M5', 'id_01', 'card4', 'id_13', 'C5', 'D9',\n       'card3', 'card6', 'id_30', 'V315', 'V314', 'D14', 'C10', 'C8',\n       'V130', 'C12', 'id_14', 'V312', 'V83', 'V87', 'V127', 'V62',\n       'id_18', 'D6', 'V317', 'V308', 'V320', 'ProductCD', 'V82', 'V76',\n       'V61', 'M7', 'V53', 'V54', 'D13', 'V20', 'M3', 'V55', 'V78', 'D12',\n       'V283', 'M8', 'V45', 'V38', 'V75', 'M9', 'V285', 'V309', 'V13',\n       'V311', 'V131', 'V77', 'V291', 'V12', 'V37', 'V281', 'V282', 'V19',\n       'V56', 'V35', 'V36']","2932ac38":"%%time\nprint('merging data...')\ntrain = train_transaction.merge(train_identity, how='left', left_index=True, right_index=True)\ntest = test_transaction.merge(test_identity, how='left', left_index=True, right_index=True)\n\nprint('dropping target...')\ny_train = train['isFraud'].copy()\ndel train_transaction, train_identity, test_transaction, test_identity\nX_train = train.drop('isFraud', axis=1)\nX_test = test.copy()\ndel train, test\n\nprint('fillnas...')\nX_train = X_train.fillna(-999)\nX_test = X_test.fillna(-999)\ngc.collect()\n\nprint('Label Encoding...')\nfor f in X_train.columns:\n    if X_train[f].dtype=='object' or X_test[f].dtype=='object': \n        lbl = preprocessing.LabelEncoder()\n        lbl.fit(list(X_train[f].values) + list(X_test[f].values))\n        X_train[f] = lbl.transform(list(X_train[f].values))\n        X_test[f] = lbl.transform(list(X_test[f].values))\n\nprint('selecting features...')\nX_train = X_train[features]\nX_test=X_test[features]\nprint('Done')","64bbe401":"%%time\nNFOLDS = 5\nfolds = KFold(n_splits=NFOLDS)\ncolumns = X_train.columns\nsplits = folds.split(X_train, y_train)\ny_preds = np.zeros(X_test.shape[0])\ny_oof = np.zeros(X_train.shape[0])\nscore = 0\n  \nfor fold_n, (train_index, valid_index) in enumerate(splits):\n    X_tr, X_val = X_train[columns].iloc[train_index], X_train[columns].iloc[valid_index]\n    y_tr, y_val = y_train.iloc[train_index], y_train.iloc[valid_index]    \n    eval_set = [(X_val, y_val)]\n    clf = xgb.XGBClassifier(base_score=0.5, booster='gbtree', colsample_bylevel=1,\n              colsample_bynode=1, colsample_bytree=0.9, gamma=0,\n              learning_rate=0.05, max_delta_step=0, max_depth=9,\n              min_child_weight=1, missing=-999, n_estimators=500, n_jobs=4,\n              nthread=None, objective='binary:logistic', random_state=2019,\n              reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,\n              silent=None, subsample=0.9, tree_method='gpu_hist', verbosity=1,eval_metric= 'auc')\n    clf.fit(X_tr, y_tr, eval_set=eval_set)    \n    y_pred_valid = clf.predict_proba(X_val)[:,1]\n    y_oof[valid_index] = y_pred_valid\n    print(f\"Fold {fold_n + 1} | AUC: {roc_auc_score(y_val, y_pred_valid)}\")   \n    score += roc_auc_score(y_val, y_pred_valid) \/ NFOLDS\n    y_preds += clf.predict_proba(X_test)[:,1] \/ NFOLDS    \n    del X_tr, X_val, y_tr, y_val\n    gc.collect()    \nprint(f\"\\nMean AUC = {score}\")\nprint(f\"Out of folds AUC = {roc_auc_score(y_train, y_oof)}\")\n\nprint('submission...')\nsample_submission['isFraud'] = y_preds\nsample_submission.to_csv(\"submission_xgb.csv\", index=False)\n","44aed1d7":" From notebooks of\n https:\/\/www.kaggle.com\/xhlulu\/ieee-fraud-xgboost-with-gpu-fit-in-40s  \n https:\/\/www.kaggle.com\/davidcairuz\/feature-engineering-lightgbm"}}