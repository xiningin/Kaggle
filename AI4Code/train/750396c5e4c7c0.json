{"cell_type":{"8390f791":"code","f4cfe1f7":"code","39a072da":"code","5005aacd":"code","ac57e61f":"code","e04e79c3":"code","5a6f2395":"code","d85594aa":"code","767e1f6e":"code","6f7e14ce":"code","8a8f9f33":"code","54d41379":"code","a3573c72":"code","53953b8b":"code","dabf6962":"code","dec2774f":"code","cec71588":"code","98922702":"code","57b946fa":"code","79184aca":"code","c117535a":"code","2cfddb2b":"code","290e4a00":"code","10ab2e3d":"code","2758585a":"code","58b24b89":"code","fa1d3c2f":"code","a17ed5df":"code","efec3f13":"code","306c8545":"code","196d06e4":"code","9a46e37e":"code","c443aecb":"markdown","811bddba":"markdown","bfa11200":"markdown","bf5b9984":"markdown","cf3e51b1":"markdown","4b4d6c28":"markdown","f7062297":"markdown","fc05a7b9":"markdown"},"source":{"8390f791":"#Import the BQ client to interact with python:\n\nfrom google.cloud import bigquery\n\n## Other libraries:\n\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline\nimport warnings\nwarnings.filterwarnings('ignore')","f4cfe1f7":"client=bigquery.Client()","39a072da":"##Get the project ,\n\ndataset_ref=client.dataset(\"chicago_crime\",project='bigquery-public-data')\n\ndataset=client.get_dataset(dataset_ref)","5005aacd":"## Check the list of tables present in this dataset:\ntables=list(client.list_tables(dataset))\n\nfor t in tables:\n    print(t.table_id)","ac57e61f":"## Fetch the table from this dataset,\ntable_ref=dataset_ref.table('crime')\ncrime_table=client.get_table(table_ref)","e04e79c3":"## Check the schema of the table,\ncrime_table.schema","5a6f2395":"## Check out the first 5 rows,\nclient.list_rows(crime_table,max_results=5).to_dataframe()","d85594aa":"## define a function to output the bytes this query will consume,\n\ndef check_bytes(query):\n    dry_run=bigquery.QueryJobConfig(dry_run=True)\n    \n    dry_run_job=client.query(query,job_config=dry_run)\n    \n    return print(f'This query will consume {round((dry_run_job.total_bytes_processed)\/(1000*1000),3)} GBs')","767e1f6e":"query= \"\"\" SELECT EXTRACT(DAYOFWEEK from date) as dayofweek,\n                  primary_type as crime_type,\n                  COUNT(DISTINCT unique_key) crime_count\n            FROM `bigquery-public-data.chicago_crime.crime`\n            GROUP BY primary_type,\n                     dayofweek\n\"\"\"\n\n","6f7e14ce":"check_bytes(query)","8a8f9f33":"## check how many GB's this query will consume since the limit is 5TB \/month\n#one_tb=1000*1000\n#safe_query_config=bigquery.QueryJobConfig(maximum_bytes_billed=one_gb)\n","54d41379":"safe_query_job=client.query(query)\ntype_of_crime=safe_query_job.to_dataframe()","a3573c72":"type_of_crime.head()","53953b8b":"type_of_crime.crime_type.unique()","dabf6962":"The crime Non Criminal appears twice -Should be a formating mistake . Lets combine them,","dec2774f":"type_of_crime.loc[type_of_crime.crime_type=='NON - CRIMINAL','crime_type']='NON-CRIMINAL'","cec71588":"## Convert day of week to string:\nday_values={1:'Sun',2:'Mon',3:'Tue',4:'Wed',5:'Thu',6:'Fri',7:'Sat'}\ntype_of_crime['wkday']=type_of_crime.dayofweek.map(day_values)","98922702":"type_of_crime.sort_values('crime_count',ascending=False).head(10)","57b946fa":"wkday_count=type_of_crime.groupby('wkday')['crime_count'].sum()","79184aca":"wkday_count.sort_values(ascending=False)","c117535a":"query=\"\"\" SELECT year,primary_type,no_of_crimes FROM (SELECT \n                year,\n                primary_type,\n                count(DISTINCT unique_key) as no_of_crimes,\n                RANK() OVER (PARTITION BY year ORDER BY count(DISTINCT unique_key) DESC) as ranking\n                FROM `bigquery-public-data.chicago_crime.crime` WHERE arrest=TRUE and domestic=FALSE\n                GROUP BY year,\n                primary_type ) WHERE ranking=1 ORDER BY year DESC\"\"\"\n\n","2cfddb2b":"check_bytes(query)","290e4a00":"safe_query_job=client.query(query)\ncrime_over_years=safe_query_job.to_dataframe()","10ab2e3d":"crime_over_years","2758585a":"query=\"\"\" SELECT EXTRACT(HOUR from date) as hour,\n                 primary_type,\n                 description,\n                 COUNTIF(year=2018) as arrest_2018,\n                 COUNTIF(year=2019) as arrest_2019,\n                 FORMAT('%3.2f', (COUNTIF(year = 2019) - COUNTIF(year = 2018)) \/ COUNTIF(year = 2018)*100) AS pct_change_2018_to_2019\n            FROM\n          `bigquery-public-data.chicago_crime.crime`\n            WHERE\n              arrest = TRUE\n              AND year IN (2018,\n                2019)\n            GROUP BY\n              primary_type,\n              description,\n              hour\n            HAVING\n              COUNTIF(year = 2018) > 100\n            ORDER BY\n              (COUNTIF(year = 2019) - COUNTIF(year = 2018)) \/ COUNTIF(year = 2018) DESC\"\"\"","58b24b89":"check_bytes(query)","fa1d3c2f":"safe_query_job=client.query(query)\nhourly_crime_increase=safe_query_job.to_dataframe()","a17ed5df":"hourly_crime_increase.head(10)","efec3f13":"query=\"\"\" SELECT primary_type,description,location_description,COUNTIF(year=2001) as arrest_2001,\n            COUNTIF(year=2019) as arrest_2019 ,\n            FORMAT('%3.2f', (COUNTIF(year = 2019) - COUNTIF(year = 2001)) \/ COUNTIF(year = 2001)*100) AS pct_change_2001_to_2019\n            FROM\n          `bigquery-public-data.chicago_crime.crime`\n            WHERE\n              arrest = TRUE and\n              domestic=FALSE\n              AND year IN (2001,\n                2019)\n            GROUP BY\n              primary_type,\n              description,\n              location_description\n            HAVING\n              COUNTIF(year = 2001) > 100\n            ORDER BY\n              (COUNTIF(year = 2019) - COUNTIF(year = 2001)) \/ COUNTIF(year = 2001) DESC\n            \"\"\"","306c8545":"check_bytes(query)","196d06e4":"safe_query_job=client.query(query)\nlocation_crime=safe_query_job.to_dataframe()","9a46e37e":"location_crime.head(10)","c443aecb":"Which crime(non-domestic) gets reported the most in a year ?Is there a change in trend ?","811bddba":"Which hour of the day has seen maximum increase in the crime between 2019 and 2020 ?","bfa11200":"Is there a difference in the types of crime happening over weekday and weekend?","bf5b9984":"References :\n\n1.https:\/\/www.kaggle.com\/dansbecker\/select-from-where\n\n2.https:\/\/cloud.google.com\/bigquery\/docs\/reference\/standard-sql\/date_functions\n\n3.https:\/\/www.kaggle.com\/paultimothymooney\/how-to-query-the-chicago-crime-dataset","cf3e51b1":"There is only one table present in this dataset.","4b4d6c28":"Which location has seen the maximum rise in crime(non-domestic) between 2001 to 2019 ?","f7062297":"Narcotics is the most commited offence over the years.","fc05a7b9":"The crimes are lower on a sunday compared to other days.In fact the crimes are higher on Friday and mid of the week Wednesday .There\nis not much difference between Wed,Tue,Sat and Thursday."}}