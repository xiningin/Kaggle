{"cell_type":{"bb71a508":"code","0123b641":"code","4b96e7d1":"code","183e0dbc":"code","26687368":"code","333107e9":"code","896571c1":"code","0bafc875":"code","aea4433a":"code","a87b614e":"code","d6946469":"code","a28aaf43":"code","422fe751":"code","0e3e6f77":"code","f398288d":"code","cb63b393":"code","681b0db5":"code","45f2d563":"code","3e4af621":"code","4fc36ae6":"code","95722445":"code","ad2bb625":"code","c32e42e7":"code","8bd1b034":"code","3fa9f6ac":"code","6e28a8fe":"code","63e4286d":"code","b994556b":"code","fc2c8447":"code","0477deea":"code","f2f29b7d":"code","1a49ffe9":"code","b0c24393":"code","8c1d1487":"code","24085e82":"code","8e42deb7":"code","520a1c09":"code","ae39b2e8":"code","490c19df":"code","54071fb4":"markdown","5b2145a1":"markdown","ca2b33d7":"markdown","4aae3bc1":"markdown","065e05e7":"markdown","e2190fc8":"markdown","89f11d4f":"markdown","b9daa4cb":"markdown","6eef1e8e":"markdown","b5139fda":"markdown","4765dd3b":"markdown","fa491d30":"markdown"},"source":{"bb71a508":"import os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.\n\nimport pandas as pd\nimport numpy as np\n\nimport datetime as dt\nimport matplotlib.pyplot as plt\nimport seaborn as sns","0123b641":"\npr_data=pd.read_csv(\"..\/input\/covid19-in-italy\/covid19_italy_province.csv\", parse_dates=['Date'])\nre_data=pd.read_csv(\"..\/input\/covid19-in-italy\/covid19_italy_region.csv\", parse_dates=['Date'])\n\nre_data.Date=pd.to_datetime(re_data.Date)\n","4b96e7d1":"print('Columns in provinces database \\n',pr_data.columns)\nprint('Columns in regions database \\n',re_data.columns)","183e0dbc":"pr_data['date'] = pr_data['Date'].dt.date # get ride of hours and minutes\npr_data['date']  = pd.to_datetime(pr_data['date']) # new clean date columnn","26687368":"latest_date = max(pr_data['date'])\nprint(latest_date)\nprovince_latest = pr_data[pr_data['date'] == latest_date]","333107e9":"gb_province = province_latest.groupby(['ProvinceName']).sum().reset_index() # get sum of cases for each province\ndf_province_total = gb_province[['ProvinceName', 'TotalPositiveCases']] # get rid of columns not relevant for this stat\ndf_province_total = df_province_total.sort_values(by=['TotalPositiveCases'], ascending=False) # sort descending\ndf_province_total.head()","896571c1":"highest_prov = df_province_total.iloc[0:25]\n","0bafc875":"re_data['date'] = re_data['Date'].dt.date # get ride of hours and minutes\nre_data['date']  = pd.to_datetime(re_data['date']) # new clean date columnn","aea4433a":"latest_date = max(re_data['date'])\nprint(latest_date)\nregion_latest = re_data[re_data['date'] == latest_date]","a87b614e":"gb_region = region_latest.groupby(['RegionName']).sum().reset_index() # get sum of cases for each province\n\n","d6946469":"df_region_total = gb_region[['RegionName','TestsPerformed', 'TotalPositiveCases', 'HospitalizedPatients', 'IntensiveCarePatients','Recovered', 'Deaths']] # get rid of columns not relevant for this stat\ndf_region_total = df_region_total.sort_values(by=['TotalPositiveCases'], ascending=False) # sort descending\n","a28aaf43":"# Calculation of overall percentages\ndf_region_total['% positive'] = (df_region_total['TotalPositiveCases']\/df_region_total['TestsPerformed'])*100\ndf_region_total['mortality'] = (df_region_total['Deaths']\/df_region_total['TotalPositiveCases'])*100\ndf_region_total['% hospitalized'] = (df_region_total['HospitalizedPatients']\/df_region_total['TotalPositiveCases'])*100\ndf_region_total['% intensive care'] = (df_region_total['IntensiveCarePatients']\/df_region_total['TotalPositiveCases'])*100\ndf_region_total['% recovered'] = (df_region_total['Recovered']\/df_region_total['TotalPositiveCases'])*100\ndf_region_total.head()","422fe751":"plt.bar(highest_prov.ProvinceName,highest_prov.TotalPositiveCases, color = 'g') #recovered by region\nplt.title('Cases by province')\nplt.ylabel('Total positive cases')\nplt.xticks(rotation=90)\nplt.show()","0e3e6f77":"plt.figure(figsize=(18, 6))\n\nplt.subplot(131)\nplt.bar(df_region_total.RegionName,df_region_total.TotalPositiveCases, color = 'tomato') #cases by region\nplt.title('Active cases by region')\nplt.ylabel('Tot Positive Cases ')\nplt.xticks(rotation=90)\nplt.subplot(132)\nplt.bar(df_region_total.RegionName,df_region_total['mortality'], color = 'k') # % deaths by region\nplt.title('Mortality by region')\nplt.ylabel('% deaths')\nplt.xticks(rotation=90)\nplt.subplot(133)\nplt.bar(df_region_total.RegionName,df_region_total['% recovered'], color = 'b') # provinces with highest num. of cases\nplt.title('recovered by region')\nplt.ylabel('% recovered')\nplt.xticks(rotation=90)\nplt.suptitle('Overall selected stats')\nplt.show()","f398288d":"print('the average percentage of positive cases over those tested is: ',round(df_region_total['% positive'].mean(), 1),'%') # this is the average of positives detection ove all regions","cb63b393":"# quick exploration of the features of the main dataframe\nprint(re_data.dtypes)\nre_data.tail()","681b0db5":"gb_time_all = re_data.groupby(['date']).sum().reset_index() # get sum of cases by date\n\ndf_time_all = gb_time_all[['date','TotalPositiveCases', 'IntensiveCarePatients', 'TotalHospitalizedPatients', 'HomeConfinement','Deaths', 'Recovered']]\ndf_time_all['% hospitalized over time'] = (df_time_all['TotalHospitalizedPatients']\/df_time_all['TotalPositiveCases'])*100\ndf_time_all['% deaths over time'] = (df_time_all['Deaths']\/df_time_all['TotalPositiveCases'])*100\ndf_time_all['% intensive care over time'] = (df_time_all['IntensiveCarePatients']\/df_time_all['TotalPositiveCases'])*100\ndf_time_all['% recovered over time'] = (df_time_all['Recovered']\/df_time_all['TotalPositiveCases'])*100\n","45f2d563":"plt.figure(figsize=(18, 6))\n\nplt.subplot(121)\nplt.plot(df_time_all['date'],df_time_all['% hospitalized over time'], color = 'tomato') #trend hospitalized\nplt.title('Hospitalized over time')\nplt.ylabel('%hospitalized ')\nplt.xticks(rotation=90)\n\n\nplt.subplot(122)\nplt.plot(df_time_all['date'],df_time_all['% intensive care over time'], color = 'b') # provinces with highest num. of cases\nplt.title('Intensive care over time')\nplt.ylabel('% intensive care')\nplt.xticks(rotation=90)\nplt.suptitle('Trends hospitalized patients')\nplt.show()","3e4af621":"plt.figure(figsize=(18, 6))\nplt.subplot(121)\nplt.plot(df_time_all['date'],df_time_all['% recovered over time'], color = 'g') #trend deaths\nplt.title('Recovery over time')\nplt.ylabel('% recovered')\nplt.xticks(rotation=90)\nplt.subplot(122)\nplt.plot(df_time_all['date'],df_time_all['% deaths over time'], color = 'k') #trend deaths\nplt.title('Mortality over time')\nplt.ylabel('% deaths')\nplt.xticks(rotation=90)","4fc36ae6":"y = df_time_all['TotalPositiveCases'].values # transform the column to differentiate into a numpy array\n\nderiv_y = np.gradient(y) # now we can get the derivative as a new numpy array\n#np.savetxt(\"contagioitalia.csv\", deriv_y, delimiter=\",\")\noutput = np.transpose(deriv_y)\n#now add the numpy array to our dataframe\ndf_time_all['ContagionRate'] = pd.Series(output)\ndf_time_all.to_csv('contagioitalia.csv')","95722445":"#national data fit\nfrom scipy.optimize import curve_fit\nfrom numpy import exp, linspace, random\nfrom math import pi\n# build an extrapolated gaussian based on italian data fit\ndef gaussian(x, amp, cen, wid):\n    \"\"\"1-d gaussian: gaussian(x, amp, cen, wid)\"\"\"\n    return (amp \/ (np.sqrt(2*pi) * wid)) * exp(-(x-cen)**2 \/ (2*wid**2)) \ndef gauss_function(X, amp, cen, sigma):\n    return amp*exp(-(X-cen)**2\/(2*sigma**2))\n\n#gaussian modelling for Italy\n\nX1 = df_time_all.index.values\ny1 = df_time_all['ContagionRate'].values\n#estimate mean and standard deviation\ninit_vals1 = [2000, 30, 200]  # for [amp, cen, wid]\nbest_vals1, covar1 = curve_fit(gaussian, X1, y1, p0=init_vals1)\n\n# get scipy values, so we can build an extrapolated gaussian\nprint('best_vals1: {}'.format(best_vals1))","ad2bb625":"periods = 80\ntimerange = pd.date_range(start='2\/24\/2020', periods=periods)\nx_e = np.arange(0, periods)\ny_e = gauss_function(x_e, 6000,best_vals1[1],best_vals1[2])","c32e42e7":"dummy = np.zeros(periods)\n\nplt.figure(figsize=(6, 12))\n\nplt.subplot(211)\nplt.plot(df_time_all['date'],df_time_all['TotalPositiveCases'], color = 'g') #trend\nplt.plot(timerange,dummy, ':', color = 'w') \nplt.title('Cases over time')\nplt.ylabel('number of cases')\nplt.xticks(df_time_all['date'],\" \")\nplt.subplot(212)\nplt.plot(df_time_all['date'],df_time_all['ContagionRate'], color = 'r') #derivative\n#plt.plot(df_time_all['date'],gauss_function(X1, *popt1), ':', label = 'Italy-modelled gaussian')\nplt.plot(timerange,y_e, '--', color = 'orange') \nplt.title('Spread rate over time')\nplt.ylabel('Rate (number of cases first derivative)')\nplt.xticks(rotation=90)\nplt.legend()\nplt.suptitle('Virus spread over time')\nplt.show()","8bd1b034":"reduced_re_data = re_data[['date','TotalPositiveCases','RegionName']]\n#creation of a dataframe for each of the four mainly affected regions\ndf_piemonte = reduced_re_data[reduced_re_data.RegionName =='Piemonte']\ndf_lombardia = reduced_re_data[reduced_re_data.RegionName =='Lombardia']\ndf_veneto = reduced_re_data[reduced_re_data.RegionName =='Veneto']\ndf_emilia = reduced_re_data[reduced_re_data.RegionName =='Emilia-Romagna']","3fa9f6ac":"gb_piemonte = df_piemonte.groupby(['date']).sum().reset_index() # get sum of cases by date\ngb_lombardia = df_lombardia.groupby(['date']).sum().reset_index() # get sum of cases by date\ngb_veneto = df_veneto.groupby(['date']).sum().reset_index() # get sum of cases by date\ngb_emilia = df_emilia.groupby(['date']).sum().reset_index() # get sum of cases by date","6e28a8fe":"gb_piemonte.to_csv('piemonte.csv')\ngb_lombardia.to_csv('lombardia.csv')\ngb_veneto.to_csv('veneto.csv')\ngb_emilia.to_csv('emilia.csv')","63e4286d":"yp = gb_piemonte['TotalPositiveCases'].values # transform the column to differentiate into a numpy array\n\nderiv_yp = np.gradient(yp) # now we can get the derivative as a new numpy array\noutput_piemonte = np.transpose(deriv_yp)\n#now add the numpy array to our dataframe\ngb_piemonte['ContagionRate'] = pd.Series(output_piemonte)\ngb_piemonte.head()","b994556b":"yl = gb_lombardia['TotalPositiveCases'].values # transform the column to differentiate into a numpy array\n\nderiv_yl = np.gradient(yl) # now we can get the derivative as a new numpy array\noutput_lombardia = np.transpose(deriv_yl)\n#now add the numpy array to our dataframe\ngb_lombardia['ContagionRate'] = pd.Series(output_lombardia)\ngb_lombardia.head()","fc2c8447":"yv = gb_veneto['TotalPositiveCases'].values # transform the column to differentiate into a numpy array\n\nderiv_yv = np.gradient(yv) # now we can get the derivative as a new numpy array\noutput_veneto = np.transpose(deriv_yv)\n#now add the numpy array to our dataframe\ngb_veneto['ContagionRate'] = pd.Series(output_veneto)\ngb_veneto.head()","0477deea":"ye = gb_emilia['TotalPositiveCases'].values # transform the column to differentiate into a numpy array\n\nderiv_ye = np.gradient(ye) # now we can get the derivative as a new numpy array\noutput_emilia = np.transpose(deriv_ye)\n#now add the numpy array to our dataframe\ngb_emilia['ContagionRate'] = pd.Series(output_emilia)\ngb_emilia.head()","f2f29b7d":"plt.figure(figsize=(6, 6))\nx = gb_piemonte['date']\ny = [ gb_piemonte['TotalPositiveCases'], gb_lombardia['TotalPositiveCases'], gb_veneto['TotalPositiveCases'],gb_emilia['TotalPositiveCases'] ]\nlabels = ['Piemonte', 'Lombardia', 'Veneto', 'Emilia Romagna']\n\nfor y_arr, label in zip(y, labels):\n    plt.plot(x, y_arr, label=label)\nplt.ylabel('Number of cases')\nplt.xticks(rotation=90)\nplt.title('Cases over time')\nplt.legend(bbox_to_anchor=(1.05, 1), loc='upper left', borderaxespad=0.)","1a49ffe9":"plt.figure(figsize=(6, 6))\nx = gb_piemonte['date']\ny = [ gb_piemonte['ContagionRate'], gb_lombardia['ContagionRate'], gb_veneto['ContagionRate'],gb_emilia['ContagionRate'] ]\nlabels = ['Piemonte', 'Lombardia', 'Veneto', 'Emilia Romagna']\n\nfor y_arr, label in zip(y, labels):\n    plt.plot(x, y_arr, label=label)\n\nplt.title('Spread rate over time')\nplt.ylabel('Rate')\nplt.xticks(rotation=90)\n\nplt.legend(bbox_to_anchor=(1.05, 1), loc='upper left', borderaxespad=0.)","b0c24393":"df_lodi = pr_data[pr_data.ProvinceName =='Lodi']\ndf_lodi.reset_index(inplace = True, drop=True)\ndf_torino = pr_data[pr_data.ProvinceName =='Torino']\ndf_torino.reset_index(inplace = True, drop=True)\ndf_roma = pr_data[pr_data.ProvinceName =='Roma']\ndf_roma.reset_index(inplace = True, drop=True)\ndf_ancona = pr_data[pr_data.ProvinceName =='Ancona']\ndf_ancona.reset_index(inplace = True, drop=True)\ndf_milano = pr_data[pr_data.ProvinceName =='Milano']\ndf_milano.reset_index(inplace = True, drop=True)","8c1d1487":"ylodi = df_lodi['TotalPositiveCases'].values # transform the column to differentiate into a numpy array\n\nderiv_ylodi = np.gradient(ylodi) # now we can get the derivative as a new numpy array\noutput_lodi = np.transpose(deriv_ylodi)\n#now add the numpy array to our dataframe\ndf_lodi['ContagionRate'] = pd.Series(output_lodi)\ndf_lodi.tail()","24085e82":"ymilano = df_milano['TotalPositiveCases'].values # transform the column to differentiate into a numpy array\n\nderiv_ymilano = np.gradient(ymilano) # now we can get the derivative as a new numpy array\noutput_milano = np.transpose(deriv_ymilano)\n#now add the numpy array to our dataframe\ndf_milano['ContagionRate'] = pd.Series(output_milano)\ndf_milano.tail()","8e42deb7":"yto = df_torino['TotalPositiveCases'].values # transform the column to differentiate into a numpy array\ndf_torino = df_torino[df_torino.Date !='2020-03-19 17:00:00']# 0 new cases on 19 March close to the peak of epidemy???? \nderiv_yto = np.gradient(yto) # now we can get the derivative as a new numpy array\noutput_to = np.transpose(deriv_yto)\n#now add the numpy array to our dataframe\ndf_torino['ContagionRate'] = pd.Series(output_to)\ndf_torino.tail()","520a1c09":"yroma = df_roma['TotalPositiveCases'].values # transform the column to differentiate into a numpy array\n\nderiv_yroma = np.gradient(yroma) # now we can get the derivative as a new numpy array\noutput_roma = np.transpose(deriv_yroma)\n#now add the numpy array to our dataframe\ndf_roma['ContagionRate'] = pd.Series(output_roma)\ndf_roma.tail()","ae39b2e8":"y_ancona = df_ancona['TotalPositiveCases'].values # transform the column to differentiate into a numpy array\n\nderiv_y_ancona = np.gradient(y_ancona) # now we can get the derivative as a new numpy array\noutput_ancona = np.transpose(deriv_y_ancona)\n#now add the numpy array to our dataframe\ndf_ancona['ContagionRate'] = pd.Series(output_ancona)\ndf_ancona.tail()","490c19df":"plt.figure(figsize=(6, 12))\n\nplt.subplot(211)\nplt.plot(df_lodi['Date'],df_lodi['TotalPositiveCases'], color = 'g', label ='Lodi') \nplt.plot(df_torino['Date'],df_torino['TotalPositiveCases'], color = 'orange',  label ='Torino') \nplt.plot(df_roma['Date'],df_roma['TotalPositiveCases'], color = 'b', label ='Roma') \nplt.plot(df_ancona['Date'],df_ancona['TotalPositiveCases'], color = 'k', label ='Ancona') \nplt.plot(df_milano['Date'],df_milano['TotalPositiveCases'], color = 'm', label ='Milano') \nplt.title('Cases over time')\nplt.ylabel('number of cases')\nplt.xticks(df_time_all['date'],\" \")\nplt.legend()\nplt.subplot(212)\nplt.plot(df_lodi['Date'],df_lodi['ContagionRate'], color = 'g', label ='Lodi') \nplt.plot(df_roma['Date'],df_roma['ContagionRate'], color = 'b', label = 'Roma') \nplt.plot(df_torino['Date'],df_torino['ContagionRate'], color = 'orange', label = 'Torino')\nplt.plot(df_ancona['Date'],df_ancona['ContagionRate'], color = 'k', label ='Ancona') \nplt.plot(df_milano['Date'],df_milano['ContagionRate'], color = 'm', label ='Milano') \nplt.title('Spread rate over time')\nplt.ylabel('Rate (daily new cases)')\nplt.xticks(rotation=90)\nplt.legend()\nplt.suptitle('Virus spread over time - provinces',fontsize = 20)\nplt.show()","54071fb4":"# Spread of Coronavirus in Italy, national and regional statistics","5b2145a1":"## 2.1.1 Gaussian model for cases growth derivative","ca2b33d7":"## 1. Geographical overall counts","4aae3bc1":"Beginning of March situation got worse it seems. To have a clearer picture is useful to calculate the contagion rate.\nTo do this, we have to calculate the time derivative of the total positive cases","065e05e7":"## 2.1 Italy - overall statistics","e2190fc8":"Main 4 regions are Lombardia, Emilia Romagna, Veneto, Piemonte. Contagion has evidently spread from Lodi area, near Milan","89f11d4f":"Import python libraries\n","b9daa4cb":"Import data from csv files","6eef1e8e":"we get the amount of cases for each day using again the groupby function","b5139fda":"## 2.2 Time Series - Regional ","4765dd3b":"## local time series: Italian epicentrum and next to it","fa491d30":"## 2. Virus propagation over time"}}