{"cell_type":{"e4f7d98b":"code","47f6c4ae":"code","ae018bc6":"code","320af5d1":"code","73fceb03":"code","26dac4a5":"code","59c42fb7":"code","96d6cf75":"code","09cba2c5":"code","622daca7":"code","39f62c89":"code","fb7d13f6":"markdown","b48f544f":"markdown","78148a71":"markdown","9ee0fce2":"markdown","4e7bbd58":"markdown","a8fdc79e":"markdown","a931c5ee":"markdown","4a7f715e":"markdown","0516f311":"markdown"},"source":{"e4f7d98b":"# Importando bibliotecas\nimport numpy\nimport matplotlib.pyplot as plt\nimport pandas\nimport math\nfrom keras.models import Sequential\nfrom keras.layers import Dense\nfrom keras.layers import LSTM\nfrom sklearn.preprocessing import MinMaxScaler\nfrom sklearn.metrics import mean_squared_error\nnumpy.random.seed(7)","47f6c4ae":"# Carrega apenas a coluna com o total de passageiros por m\u00eas, em milhares (112 = 122000 passageiros em v\u00f4os)\ndataframe = pandas.read_csv('..\/input\/airlines-passenger-data\/international-airline-passengers.csv', usecols=[1], engine='python', skipfooter=3)\ndataframe.head(3)","ae018bc6":"dataframe.plot()","320af5d1":"#Converte a coluna do dataframe pandas em um vetor numpy\ndataset = dataframe.values\ndataset = dataset.astype('float32')\n\n# Normaliza os dados para ficarem entre 0 e 1\nscaler = MinMaxScaler(feature_range=(0, 1))\ndataset = scaler.fit_transform(dataset)\n\n# Divite os dados de treino (2\/3) e teste (1\/3)\n# Note que a divis\u00e3o n\u00e3o \u00e9 aleat\u00f3ria, mas sim sequencial\ntrain_size = int(len(dataset) * 0.67)\ntest_size = len(dataset) - train_size\ntrain, test = dataset[0:train_size,:], dataset[train_size:len(dataset),:]","73fceb03":"# Recebe uma s\u00e9rie e converte em uma matriz com s\u00e9ries deslocadas.\ndef create_dataset(dataset, look_back=1):\n    dataX, dataY = [], []\n    for i in range(len(dataset)-look_back-1):\n        a = dataset[i:(i+look_back), 0]\n        dataX.append(a)\n        dataY.append(dataset[i + look_back, 0])\n    return numpy.array(dataX), numpy.array(dataY)\n\n# reshape into X=t and Y=t+1\nlook_back = 12\ntrainX, trainY = create_dataset(train, look_back)\ntestX, testY = create_dataset(test, look_back)\n# shape is [samples, time steps, features]\n\ntrainX = trainX.reshape(-1, look_back, 1)\ntestX = testX.reshape(-1, look_back, 1)\n\ntrainX.shape, testX.shape","26dac4a5":"for k in zip(trainX[:5], trainY[:5]):\n    print(k[0],k[1])","59c42fb7":"model = Sequential()\nmodel.add(LSTM(8, input_shape=(look_back, 1), return_sequences=True))\nmodel.add(LSTM(8))\nmodel.add(Dense(1)) \nmodel.compile(loss='mean_squared_error', optimizer='rmsprop')\nmodel.summary()","96d6cf75":"model.fit(trainX, trainY, epochs=100, batch_size=32, verbose=0)\n\n# Realiza as previs\u00f5es. Notar que a utilidade de prever trainX \u00e9 nenhuma. Serve apenas para exibir no gr\u00e1fico.\ntrainPredict = model.predict(trainX)\ntestPredict = model.predict(testX)","09cba2c5":"# Reescala os n\u00fameros para os valores originais (milhares de passageiros)\ntrainPredict = scaler.inverse_transform(trainPredict)\ntrainY = scaler.inverse_transform([trainY])\ntestPredict = scaler.inverse_transform(testPredict)\ntestY = scaler.inverse_transform([testY])","622daca7":"# Calcula os erros de previs\u00e3o\ntrainScore = math.sqrt(mean_squared_error(trainY[0], trainPredict[:,0]))\nprint('Train Score: %.2f RMSE' % (trainScore))\ntestScore = math.sqrt(mean_squared_error(testY[0], testPredict[:,0]))\nprint('Test Score: %.2f RMSE' % (testScore))","39f62c89":"# shift train predictions for plotting\ntrainPredictPlot = numpy.empty_like(dataset)\ntrainPredictPlot[:, :] = numpy.nan\ntrainPredictPlot[look_back:len(trainPredict)+look_back, :] = trainPredict\n\n# shift test predictions for plotting\ntestPredictPlot = numpy.empty_like(dataset)\ntestPredictPlot[:, :] = numpy.nan\ntestPredictPlot[len(trainPredict)+(look_back*2)+1:len(dataset)-1, :] = testPredict\n\n# plot baseline and predictions\nplt.plot(scaler.inverse_transform(dataset))\nplt.plot(trainPredictPlot)\nplt.plot(testPredictPlot)\nplt.show()","fb7d13f6":"Ao final das previs\u00f5es, reescalonamos os dados para a escala original e calculamos as m\u00e9tricas de RMSE.","b48f544f":"Nesse laborat\u00f3rio iremos demonstrar como uma LSTM pode ser usada para previs\u00e3o em s\u00e9ries temporais. Utilizaremos uma rede neuronal LSTM bem simples para tratar um caso de uma s\u00e9rie temporal de n\u00famero de passageiros que viajaram por m\u00eas em v\u00f4os internacionais nos Estados Unidos.","78148a71":"Aqui apenas mostramos como fica a s\u00e9rie temporal nos pares $X$ e $Y$.","9ee0fce2":"# Laborat\u00f3rio 12b - Usando LSTM para prever s\u00e9ries temporais","4e7bbd58":"Aqui criamos nossos pares de dados $X$ e $Y$, onde $Y_{t} = X_{t-1}$ (para look_bak=1). Uma outra forma de pensar no valor de $Y$ para um dado $X$ \u00e9 que ele \u00e9 o pr\u00f3ximo $X$ na s\u00e9rie temporal.","a8fdc79e":"Imprime o gr\u00e1fico da previs\u00e3o (em vermelho)","a931c5ee":"### Agora tente voc\u00ea melhorar o resultado do indicador RMSE","4a7f715e":"Agora criamos nossa rede LSTM com 8 recorr\u00eancias (usa at\u00e9 oito pontos da s\u00e9rie para tentar prever o pr\u00f3ximo n\u00famero) e a treinamos.","0516f311":"Aqui tratamos os dados que vamos usar. Primeiro ajustamos a escala dos dados para ficarem entre 0 e 1. A seguir, dividimos os dados entre treino (66% primeiros meses) e testes (33% dos meses finais da s\u00e9rie)"}}