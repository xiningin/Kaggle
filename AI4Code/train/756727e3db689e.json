{"cell_type":{"3c3b2c6a":"code","299c759d":"code","768d36d6":"code","a595e874":"code","eced0e24":"code","9d97d31a":"code","4accbd69":"code","3089bab4":"code","ceb1f4ac":"code","908e8ba9":"code","97732c37":"code","3900f4ca":"code","5eda38f9":"code","6f6fcf18":"code","c182705e":"code","423949e1":"code","75bcfadc":"code","587aa78a":"code","eed3e9b6":"markdown","b4b9f93e":"markdown","b0683cc4":"markdown","a65ece87":"markdown","496e25f4":"markdown","c69ebde2":"markdown","05800126":"markdown","42e02752":"markdown","31f7fe70":"markdown","15025789":"markdown","abecbee1":"markdown","e2728262":"markdown","9518cebb":"markdown","5616881e":"markdown","648b2564":"markdown","148064f3":"markdown","f6eeec28":"markdown","00b2aa19":"markdown","54ec3b91":"markdown","67813411":"markdown","d2036f87":"markdown","0abe2994":"markdown","9480b0d3":"markdown","7dab68bd":"markdown"},"source":{"3c3b2c6a":"#basic library \nimport pandas as pd\nimport numpy as np\n\n\n#visualization \nimport matplotlib.pyplot as plt \nimport seaborn as sns \nimport cufflinks as cf \nfrom plotly.offline import download_plotlyjs, init_notebook_mode,plot,iplot #iplot for interactive graphs\ninit_notebook_mode(connected=True)\n\ncf.go_offline()\n%matplotlib inline\nsns.set_style('whitegrid')","299c759d":"df=pd.read_csv('..\/input\/loan-data\/loan_data.csv')\ndf.head(5)","768d36d6":"df.describe().head(4)","a595e874":"NAN_value = (df.isnull().sum() \/ len(df)) * 100\nMissing = NAN_value[NAN_value==0].index.sort_values(ascending=False)\nMissing_data = pd.DataFrame({'Missing Ratio' :NAN_value})\nMissing_data.head(20)","eced0e24":"f,ax = plt.subplots(figsize = (15,10))\nsns.heatmap(df.corr(),cmap='viridis',annot=True, ax=ax)\nbottom, top = ax.get_ylim()\nax.set_ylim(bottom + 0.5, top - 0.5)\nprint(\"Correlacion between variables\")","9d97d31a":"f,(ax1,ax2,ax3)= plt.subplots(1,3,figsize=(25,10))\nsns.distplot(df['int.rate'], bins= 30,ax=ax1)\nsns.boxplot(data =df, x ='credit.policy', y= df['int.rate'],ax=ax2).legend().set_visible(False)\nsns.boxplot(data = df['int.rate'], ax=ax3)\nprint(\"Interest Rate Distribution, Credit Policy range based on the Credit policy , General Interest rate\")","4accbd69":"#Finding Relationship between fisco ~ interest rate ~ installment \nsns.jointplot(y='int.rate', x='fico',data= df)\nprint(\"Interest rate - FICO \")","3089bab4":"f,(ax4,ax5,ax6)= plt.subplots(1,3,figsize=(30,10))\n\nsns.countplot(x='purpose',data=df, \n              hue='not.fully.paid',palette='Set1',ax=ax4)\n\nsns.boxplot(x='purpose', y='int.rate',\n            data= df, hue='not.fully.paid',palette='Set2',ax=ax5).legend().set_visible(False)\n\nsns.boxplot(x='purpose', y='int.rate',\n            data= df,ax=ax6)\n\n\nprint('Data1 : Reason of the Loan.    Data2: Interest based on the Reason')","ceb1f4ac":"sns.lmplot(data=df,palette='Set1',x='fico',y='int.rate', hue='credit.policy',col='not.fully.paid')\n","908e8ba9":"# Load the example mpg dataset\nmpg = sns.load_dataset(\"mpg\")\n\n# Plot miles per gallon against horsepower with other semantics\nsns.relplot(x=\"fico\", y=\"int.rate\",hue= 'not.fully.paid', sizes=(30, 200), alpha=.4, size ='installment',\n         height=6, data=df )","97732c37":"plt.figure(figsize=(11,6))\nfico_0 = df[df['not.fully.paid']==0]['fico'].hist(alpha=0.4,color='red',bins=30,label='not.fully.paid=1')\nfico_1 = df[df['not.fully.paid']==1]['fico'].hist(alpha=0.4,color='blue',bins=30,label='not.fully.paid=0')\nplt.legend()\nplt.xlabel('FICO')","3900f4ca":"plt.figure(figsize=(11,6))\nfico_0 = df[df['not.fully.paid']==0]['fico'].hist(alpha=0.4,color='red',bins=30,label='not.fully.paid=1')\nfico_1 = df[df['not.fully.paid']==1]['fico'].hist(alpha=0.4,color='blue',bins=30,label='not.fully.paid=0')\nplt.legend()\nplt.xlabel('FICO')","5eda38f9":"# Attention somo outliers\nout_1 = df[(df['fico']>750) & (df['int.rate']>0.175)].index.to_list()\nout_2 = df[(df['fico']<700) & (df['int.rate']<0.075)].index.to_list()\nOutliers = out_1 + out_2\ndf.iloc[Outliers]\nloan_1 = df.drop(Outliers)","6f6fcf18":"#Purpose to Categorical Data\nfinal_loan  = pd.get_dummies(loan_1,drop_first = True) # without outliers\nfinal_data = pd.get_dummies(df,drop_first = True)\n\n# Applying Machine Learning \nfrom sklearn.model_selection import train_test_split\nX=final_data.drop('not.fully.paid', axis=1)\ny= final_data['not.fully.paid']\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=42)\n\nfrom sklearn.tree import DecisionTreeClassifier\ndtree = DecisionTreeClassifier()\ndtree.fit(X_train,y_train)\ny_pred = dtree.predict(X_test)\n\n# Measuring Accurancy \nfrom sklearn.metrics import classification_report,confusion_matrix\ndtree_score=classification_report(y_test,y_pred)\nprint(classification_report(y_test,y_pred))","c182705e":"X=final_loan.drop('not.fully.paid', axis=1)\ny= final_loan['not.fully.paid']\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=42)\n\ndtree_loan = DecisionTreeClassifier()\ndtree_loan.fit(X_train,y_train)\ny_pred_loan = dtree_loan.predict(X_test)\ndtree_outlier = classification_report(y_test,y_pred_loan)\nprint(classification_report(y_test,y_pred_loan))","423949e1":"from sklearn.ensemble import RandomForestClassifier\nX=final_data.drop('not.fully.paid', axis=1)\ny= final_data['not.fully.paid']\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=42)\nRFC = RandomForestClassifier(n_estimators = 50)\nRFC.fit(X_train,y_train)\ny_pred_RFC = (y_test)\nRFC_report=classification_report(y_test,y_pred_RFC)\nprint(classification_report(y_test,y_pred_RFC))","75bcfadc":"from sklearn.ensemble import RandomForestClassifier\nX=final_data.drop('not.fully.paid', axis=1)\ny= final_data['not.fully.paid']\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=42)\nRFC = RandomForestClassifier(n_estimators = 300)\nRFC.fit(X_train,y_train)\ny_pred_RFC = (y_test)\nRFC_outliers = classification_report(y_test,y_pred_RFC)\nprint(classification_report(y_test,y_pred_RFC))","587aa78a":"#Error_Rate = []\n#for i in range (1,310):\n    \n #   RFC_Error = RandomForestClassifier(n_estimators = i)\n #  RFC_Error.fit(X_train,y_train)\n #  pred_i = RFC_Error.predict(X_test)\n # Error_Rate.append(np.mean(pred_i != y_test))\n    \n#plt.figure(figsize=(10,6))\n#plt.plot(range(1,310), Error_Rate , color = 'blue', linestyle = 'dashed', marker = 'o')","eed3e9b6":"# **Some columns Information**\n* credit.policy: 1 if the customer meets the credit underwriting criteria of LendingClub.com, and 0 otherwise.\n* purpose: The purpose of the loan (takes values \"credit_card\", \"debt_consolidation\", \"educational\", \"major_purchase\", \"small_business\", and \"all_other\").\n* int.rate: The interest rate of the loan, as a proportion (a rate of 11% would be stored as 0.11). Borrowers judged by LendingClub.com to be more risky are assigned higher interest rates.\n* installment: The monthly installments owed by the borrower if the loan is funded.\n* log.annual.inc: The natural log of the self-reported annual income of the borrower.\n* dti: The debt-to-income ratio of the borrower (amount of debt divided by annual income).\n* fico: The FICO credit score of the borrower.\n* days.with.cr.line: The number of days the borrower has had a credit line.\n* revol.bal: The borrower's revolving balance (amount unpaid at the end of the credit card billing cycle).\n* revol.util: The borrower's revolving line utilization rate (the amount of the credit line used relative to total credit available).\n* inq.last.6mths: The borrower's number of inquiries by creditors in the last 6 months.\n* delinq.2yrs: The number of times the borrower had been 30+ days past due on a payment in the past 2 years.\n* pub.rec: The borrower's number of derogatory public records (bankruptcy filings, tax liens, or judgments).","b4b9f93e":"#### In this Data set , I am using Decision Tree and Random Decision Tree to predict weather the payment will be paid in full , I also analyzed some other factor as fico (credit Score), interes rate , etc.\n* I used to work for **Capital one USA**, so I was familiar with this factors , however there are many other that pick my curiosity\n1. It is interesting to notice that t**he interest rate varies depending on the kind of need** (see column \"Purpose), this might be because in U**SA Credit card rate are less risky-lower than loan for small business**, this because CC cash generate more income that loans daily\n2. I found some **Outliers** according to the quarter rules, actually less than 10 so I evaluated the model **with\/without** them \n3. I would asume that **people with better fisco will always pay in full at least the installment** (according to my experience in Capital one customer always paid in full beacuse they were worry about the Credit Score) or recived better interest rate , but no in this Company\n4. There is no a Factor that can lead drastically the company to predict if they willl recieved the payment in full . \n5. Other banks consider the Credit Score inquire as risk factor - If other bank has checked it will reduce your Credit core because it means you applied for more loan and the chances of getting their payment is less\n6.Rndom Forest has a excellent performance over Decision Tree","b0683cc4":"# Interpretation\n1. As I assumed Debt consolidation knowing as \"balance Transfer\" and Credita card are in the top 3 Reason \n2. Interest rate accoding to the Needs\n3. Tis is intersting to notice , in terms of risk \" small business loan\" seems to be more risky, perhaps this could be a reason why USA has no that much start up company as before, instead major purchases (House, car, etc) interest rate is the lowest (\" I could be because is the one that everyone is looking for or simply incentive the economy )","a65ece87":"# **OSEMN Methodology **","496e25f4":"1. Exploring Interest Rate","c69ebde2":"### * Explore (Understand Data , Create Visualization, Deriving Statistic)","05800126":"# Interpretation\n1. Most of the them do not make full payment \n2. the moajority of them make payment lower than 800 \n3. It is interesting to notice that people with lower fico (750) are paying in full , perhaps they are working on their Credit score ","42e02752":"2. Exploring Interest Rate and Needs","31f7fe70":"### * Modeling the Data \n1. Creating Categorical Data","15025789":"# Interpretation\n1. The most common interest rate is arrounf 0.75 - 0.125 respectively\n2. The frist boxplot showed that People who is eligible after the underwriting Process \"1\" , have a better interest rate (I asumme this might be based on previous application, and those who has 0 go to a second review but with higher interest rate \n3. The median of interest rate es 0.12 , it means the average interest rate for customer is 0.12\n4. As expected if your fico (credit Score) it is high your interest rate will be low and vice versa.","abecbee1":"## Decision tree without outlier","e2728262":"> * **There is no** Missing Values`","9518cebb":"2. without Outliers","5616881e":"## **Scrub (filtering, extracting , replacing , handle missing values)** \n1. Looking for Missing Values \n2. \"0\" Values , etc.","648b2564":" # \"DECISION TREE\"","148064f3":"## Decision tree with outlier","f6eeec28":"## **Obtain data**","00b2aa19":"> Finding Coorelation between variables \n1. A start by having a General view to better understand the data\n2. Identify any issue\n3. Find any relationshp between variables \n4. Verify some assumption ","54ec3b91":"3. Exploring FICO and Full Payment ","67813411":"# Interpretation\n1. People with fico > 675 are more likely to pay in full (but cosider the amount of people who has fico > 675 who are not paying in full) ","d2036f87":">### I dont know what is the best number of n_estimator so I would choose the one who has less Error_rate\n>### please if you know the answer let me know in the comments \n>### Any other advance technique or approach of this Data \"please let me know and post the link\" ","0abe2994":"1. Following the Q rules I found some parameters, I will drop them and run the same model and make sure how it affects the final result ","9480b0d3":" # \"Random Forest\"\n 1. With oulier","7dab68bd":"# **Lending club Data Set**\n"}}