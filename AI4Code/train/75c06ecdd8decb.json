{"cell_type":{"ed7705c2":"code","ecd555ef":"code","9a3c2f89":"code","70c196c0":"code","c38b1f6c":"code","c8157855":"code","4b7eafc9":"code","143e2f26":"code","fc4cef8c":"code","d6c0fd37":"code","96eb6ea5":"code","f7193665":"code","91e94c75":"markdown"},"source":{"ed7705c2":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","ecd555ef":"# ==================\n# Library\n# ==================\nimport warnings\nwarnings.simplefilter('ignore')\nimport pandas as pd\nimport numpy as np\nimport sys\nimport time\nimport datetime\nfrom contextlib import contextmanager\nimport logging\nfrom tqdm import tqdm_notebook as tqdm\nimport feather\nimport matplotlib.pyplot as plt\nfrom sklearn.preprocessing import LabelEncoder\nfrom gensim.models import FastText","9a3c2f89":"# ==================\n# Constant\n# ==================\nTRAIN_PATH = \"\/kaggle\/input\/machine-learning-challenge-osaka-2020\/train.csv\"\nTEST_PATH = \"\/kaggle\/input\/machine-learning-challenge-osaka-2020\/test.csv\"\nREVIEW_TRAIN_PATH = \"\/kaggle\/input\/machine-learning-challenge-osaka-2020\/review_train.csv\"\nREVIEW_TEST_PATH = \"\/kaggle\/input\/machine-learning-challenge-osaka-2020\/review_test.csv\" ","70c196c0":"# ===============\n# Settings\n# ===============\nSAVE_PATH = \"review_fasttext.feather\"","c38b1f6c":"# \u30c7\u30fc\u30bf\u306e\u30ed\u30fc\u30c9\ntrain_review = pd.read_csv(REVIEW_TRAIN_PATH)\ntest_review = pd.read_csv(REVIEW_TEST_PATH)","c8157855":"# \u30c7\u30fc\u30bf\u306e\u7d50\u5408\nreview_all = pd.concat([train_review[[\"title\",\"review\"]],test_review[[\"title\",\"review\"]]]).reset_index(drop=True)","4b7eafc9":"# title\u3068review\u3092\u4e00\u3064\u306b\u307e\u3068\u3081\u307e\u3059\nreview_all[\"text\"] = review_all[\"title\"] + \" \" + review_all[\"review\"]","143e2f26":"# list\u306b\u5909\u63db\uff08fasttext\u3067\u5b66\u7fd2\u3059\u308b\u524d\u306e\u524d\u51e6\u7406\uff09\ntext = [str(i).split(\" \") for i in review_all[\"text\"]]","fc4cef8c":"# \u5b66\u7fd2\uff0815\u5206\u3050\u3089\u3044\u304b\u304b\u308a\u307e\u3059\uff09\nmodel_gensim = FastText(size=56,window=7,alpha=0.012,min_count=5)\nmodel_gensim.build_vocab(text)\nmodel_gensim.train(text,total_examples=model_gensim.corpus_count,epochs=10)","d6c0fd37":"# \u6587\u7ae0\u30d9\u30af\u30c8\u30eb\u306e\u4f5c\u6210\uff08\u5358\u8a9e\u306e\u30d9\u30af\u30c8\u30eb\u306e\u5e73\u5747\uff09\ntrain_embedding = np.zeros((len(text),model_gensim.vector_size))\nvector_size = model_gensim.vector_size\nfor m,i in enumerate(tqdm(text)):\n    embedding_ = np.zeros(vector_size)\n    n = 0\n    for t in i:\n        try:\n            embedding_ += model_gensim[t]\n            n += 1\n        except KeyError:\n            pass\n    if n > 0:\n        embedding_ \/= n\n    train_embedding[m,:] = embedding_","96eb6ea5":"#\u30c7\u30fc\u30bf\u306e\u4fdd\u5b58\ndf_embedding = pd.DataFrame(train_embedding)\ndf_embedding.columns = [f\"fasttext{i}\" for i in range(56)]\ndf_embedding.to_feather(SAVE_PATH)","f7193665":"df_embedding.head()","91e94c75":"## fasttext\u3067review\u3092\u30d9\u30af\u30c8\u30eb\u5316\u3057\u307e\u3059\n### \u203breview data\u306erating\u3092\u6d3b\u7528\u3057\u305f\u7279\u5fb4\u91cf\u4f5c\u6210\u306e\u4e00\u90e8\u3067\u3059\u3002"}}