{"cell_type":{"73c59de5":"code","5c7f76b2":"code","f2d8b93e":"code","8491ffe4":"code","f9debd1a":"code","8afa126f":"code","622cc0af":"code","033ca77d":"code","913f24e1":"code","19a5217f":"code","95823657":"code","148f78f2":"code","3e7c9d13":"code","07dc5851":"code","fce82aa9":"code","0239dbf2":"code","6809fedf":"code","9e405c76":"code","731f6017":"code","b471ee01":"markdown","57c80dd5":"markdown","e3c28fd5":"markdown","96c92fe0":"markdown","8198e13e":"markdown","e32cecd8":"markdown","ea2e4f10":"markdown","e5453f2d":"markdown","a73c328d":"markdown"},"source":{"73c59de5":"!pip install -q plotly==4.9.0\n!pip install -q \"notebook>=5.3\" \"ipywidgets>=7.2\"","5c7f76b2":"import numpy as np\nimport pandas as pd\nimport os\nfrom tqdm import tqdm\nimport plotly.graph_objects as go\nfrom plotly.offline import init_notebook_mode, iplot\nfrom plotly.subplots import make_subplots\nimport plotly.express as px\nimport seaborn as sns\ninit_notebook_mode(connected=True)","f2d8b93e":"root_dir = '..\/input\/silkboard-bangalore-ambient-air-covid19lockdown'\nfiles = list(os.listdir(root_dir))\ndfs = {}\nfor file in files:\n    f_name = os.path.join(root_dir, file)\n    dfs[file.split('_')[0]] = pd.read_csv(f_name)","8491ffe4":"for name, df in dfs.items():\n    print(name)\n    print('Columns:', *list(df.columns))\n    print('NaNs:', df.isna().sum().sum())\n    print('-'*10)","f9debd1a":"for name, df in dfs.items():\n    print('name')\n    print('country:', df.country.unique())\n    print('city:', df.city.unique())\n    print('locations:', df.location.unique())\n    print('coordinates:', df.latitude.unique(), df.longitude.unique())","8afa126f":"for name, df in dfs.items():\n    print(name, '\\n', \n          'maximum:', df.value.max(),\n          'minimum:', df.value.min(),\n          'mean:', df.value.mean(),\n          'median:', df.value.median()\n         )","622cc0af":"to_drop =['country', 'city', \n          'location', 'latitude', \n          'longitude']\n\nfor name, df in dfs.items():\n    dfs[name] = df.drop(to_drop, axis=1)","033ca77d":"def plot_dfs(x, y, title=None, transform=None, vis_type='scatter'):\n    if title is None:\n        title=f'{x} {y}'\n    fig = make_subplots(rows=2, cols=3, subplot_titles=tuple(dfs.keys()))\n    fig.update_layout(showlegend=False, title=title)\n    i, j = 1, 1\n    for df in dfs.values():\n        if vis_type == 'scatter':\n            if transform is None:\n                fig.add_trace(go.Scatter(x=df[x], y=df[y]), row=i, col=j)\n            else:\n                fig.add_trace(go.Scatter(x=df[x], y=transform(df[y])), row=i, col=j)\n        else:\n            fig.add_trace(go.Histogram(x=df[x], histnorm='percent'), row=i, col=j)\n            fig.update_layout(barmode='stack')\n        i+=1\n        if i==3:\n            j+=1\n            i=1\n        if j==4:\n            j=1\n            \n    return fig\n\nfig = plot_dfs('utc', 'value', title='Gases concentration values')\niplot(fig)","913f24e1":"fig = plot_dfs('utc', 'value', \n               title='Gases concentration percent change',\n               transform=pd.Series.pct_change)\niplot(fig)","19a5217f":"for df in dfs.values():\n    print(df.unit.unique())","95823657":"for name, df in dfs.items():\n    dfs[name] = df[['value', 'utc']].rename(columns={'value': name})\n    \n\ngases_df = pd.merge(dfs['co'], dfs['no2'], \n                    on='utc', how='outer')\n\ngases_df = pd.merge(gases_df, dfs['o3'], \n                    on='utc', how='outer')\ngases_df = pd.merge(gases_df, dfs['pm10'], \n                    on='utc', how='outer')\ngases_df = pd.merge(gases_df, dfs['pm25'], \n                    on='utc', how='outer')\ngases_df = pd.merge(gases_df, dfs['so2'], \n                    on='utc', how='outer')\ngases_df","148f78f2":"gases_df.isna().sum()","3e7c9d13":"df = gases_df.dropna(how='any')","07dc5851":"fig = go.Figure()\nfor gas in dfs.keys():\n    fig.add_trace(go.Scatter(x=df.utc,\n                             y=df[gas],\n                             mode='lines+markers',\n                            name=gas))\niplot(fig)","fce82aa9":"for gas in dfs.keys():\n    gases_df[gas+'_pct'] = gases_df[gas].pct_change()","0239dbf2":"gases_df","6809fedf":"df = gases_df.dropna(how='any')","9e405c76":"fig = go.Figure()\nfor gas in dfs.keys():\n    fig.add_trace(go.Scatter(x=df.utc,\n                             y=df[gas+'_pct'],\n                             mode='lines+markers',\n                            name=gas))\niplot(fig)","731f6017":"sns.heatmap(gases_df[list(dfs.keys())].corr());","b471ee01":"Well, it does seem to be the case lockdown helped to ease some pollutant concentration like CO and NO2. But that is not sufficient analysis to my eye. Let's dig deeper.","57c80dd5":"Notice the correlations here: o3 seems to be negatively correlcated with so2 concentration, co correlates with no2.","e3c28fd5":"We have a single location in the dataset, as expected. This helps us refine values we need for exploration.","96c92fe0":"So we are seeing spikes of some concentrations. There are periods where concentrations seems to drop but overall we cannot conclude trends truely dropped. If we extrapolate the data before lockdown it might draw us to conclusion quarantine actually caused concentraion to be more volatile with noticable spikes in the march. What is good though co in particular seem to drop with no backing the trend to rise back.","8198e13e":"All the scales seem in tact. It is time to compare all concentrations together, let's merge known data.","e32cecd8":"As we might notice here: so2 measurements seems to have less frequent collection. We do not expect all measures to be made precisely in the time but given the dataset timestamps put onto these events are many of them have been made nearly simultaneously.","ea2e4f10":"Let us check if the measurement units are the same. Of course comparing so2 emmisions to concentration of o3 is not apples to apples comparision but still useful to know the scale.","e5453f2d":"In the dataset we are given some metrics describing dynamics of changing gases concentration. Let us begin the exploration of the story it might tell.","a73c328d":"## Introduction\n\nHumanity is facing a new challanges again and again. Wars, epidemics, resourse scarcity just seem to cycle around never going away. And no matter what issue is the first on our radars at any moment we have to appriciate and protect one thing first: air."}}