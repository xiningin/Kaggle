{"cell_type":{"532d4db2":"code","f26592a1":"code","d6a5c678":"code","7a5f6323":"code","83e1011c":"code","a8972303":"code","809b17c5":"code","8af3508d":"code","6642f9c0":"code","5361d66e":"code","631a0599":"code","4cede182":"code","17195d98":"code","a64d835a":"code","254c2c93":"code","4edbaa99":"code","1e10a79b":"code","553c475f":"code","36984525":"code","a5cf2cca":"code","8db115df":"code","3e21656c":"code","7fea53d9":"code","f997441b":"code","639faa2f":"code","a471b21c":"code","d712175a":"code","4efe90a3":"code","c8749dbd":"code","6859702a":"code","34d1a22b":"code","3c052365":"code","a9b01224":"code","0f7eb588":"code","919afe79":"code","7a19e577":"code","f375a23d":"code","2452c288":"code","4a827fa6":"code","82d8b073":"code","217d8c50":"code","b5766756":"code","4cd897fd":"code","c6defb08":"code","4338cc16":"code","7a28ac3e":"code","1523c415":"code","575f8348":"code","149ddd99":"code","1908eb08":"code","b52d5fa2":"code","1821f0e8":"code","60fda11b":"markdown","e00e767c":"markdown","a3c85d0a":"markdown","ed39294b":"markdown","eb5971fb":"markdown","9ee6df63":"markdown","401280ec":"markdown","e364dd8a":"markdown","18db413d":"markdown","a5403853":"markdown","c440252c":"markdown","04801cff":"markdown","3e051219":"markdown","15a15aba":"markdown","b3b864ef":"markdown","66bfc68e":"markdown","2dffb57f":"markdown","1103e321":"markdown","99d99103":"markdown","75bc144c":"markdown","f735377c":"markdown","220265fb":"markdown","a11dbc80":"markdown","55cac888":"markdown","e5fa4fe5":"markdown","71e732c8":"markdown","0a02d1bf":"markdown","b130a515":"markdown","719b3ad3":"markdown"},"source":{"532d4db2":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","f26592a1":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline\nimport statsmodels.api as sm\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.metrics import mean_absolute_error, mean_squared_error\nfrom sklearn.linear_model import RidgeCV,LassoCV,ElasticNetCV\nfrom sklearn.metrics import r2_score","d6a5c678":"pd.set_option('display.max_columns',None)","7a5f6323":"df=pd.read_csv('..\/input\/life-expectancy-who\/Life Expectancy Data.csv')\ndf.head()","83e1011c":"df.shape","a8972303":"df.info()","809b17c5":"df.isna().sum()","8af3508d":"cols=df.columns\npercent_of_null=[]\nfor i in cols:\n    p=(df[i].isnull().sum()\/df.shape[0])*100\n    percent_of_null.append(p)\n\nfor l,n in zip(df.columns,percent_of_null):\n    print(l,':',n)","6642f9c0":"df['Status']=df['Status'].replace('Developing',1)\ndf['Status']=df['Status'].replace('Developed',0)","5361d66e":"df=df.drop(['Country','Year'],axis=1)","631a0599":"df=df.fillna(df.median())","4cede182":"df.isna().sum()   # rechecking missing values after treatment","17195d98":"df.describe()","a64d835a":"col={'Life expectancy ':1,'Adult Mortality':2,'infant deaths':3,'Alcohol':4,'percentage expenditure':5,'Hepatitis B':6, \n        'Measles ':7,' BMI ':8,'under-five deaths ':9,'Polio':10, 'Total expenditure':11,'Diphtheria ':12, \n     ' HIV\/AIDS':13,'GDP':14,'Population':15,\n        ' thinness  1-19 years':16,' thinness 5-9 years':17,'Income composition of resources':18,'Schooling':19}","254c2c93":"plt.figure(figsize=(20,30))\n\nfor variable,i in col.items():\n                     plt.subplot(5,4,i)\n                     plt.boxplot(df[variable])\n                     plt.title(variable)\n\nplt.show()","4edbaa99":"df=df.transform(lambda x : x**0.5)  # Outliers treatment","1e10a79b":"sns.distplot(df['Life expectancy '],kde=True)","553c475f":"sns.barplot(data=df, x='Life expectancy ',y='Status',orient = 'h')","36984525":"disease_cols=df[['Life expectancy ','Alcohol','Hepatitis B','Measles ',' BMI ','Polio','Diphtheria ',' HIV\/AIDS']]","a5cf2cca":"sns.pairplot(disease_cols,diag_kind='kde')","8db115df":"disease_cols.corr()","3e21656c":"measures_cols=df[['Life expectancy ','Adult Mortality','infant deaths','under-five deaths ',' thinness  1-19 years',' thinness 5-9 years','Schooling']]","7fea53d9":"sns.pairplot(measures_cols,diag_kind='kde')","f997441b":"measures_cols.corr()","639faa2f":"income_exp_cols=df[['Life expectancy ','percentage expenditure','Total expenditure','GDP','Population',\n                    'Income composition of resources']]","a471b21c":"sns.pairplot(income_exp_cols, diag_kind='kde')","d712175a":"income_exp_cols.corr()","4efe90a3":"X=df.drop('Life expectancy ',axis=1)\ny=df['Life expectancy ']","c8749dbd":"X_constant = sm.add_constant(X)\nlin_reg = sm.OLS(y,X_constant).fit()\nlin_reg.summary()","6859702a":"import statsmodels.tsa.api as smt\nacf = smt.graphics.plot_acf(lin_reg.resid, alpha=0.05)\nacf.show()","34d1a22b":"from scipy import stats\nprint(stats.jarque_bera(lin_reg.resid))","3c052365":"sns.distplot(lin_reg.resid)","a9b01224":"sns.set_style('darkgrid')\nsns.mpl.rcParams['figure.figsize'] = (15.0, 9.0)\n\ndef linearity_test(model, y):\n    pred_vals = model.predict()\n    resids = model.resid\n\n    fig, ax = plt.subplots(1,2)\n    \n    sns.regplot(x=pred_vals, y=y, lowess=True, ax=ax[0], line_kws={'color': 'red'})\n    ax[0].set_title('Observed vs. Predicted Values', fontsize=16)\n    ax[0].set(xlabel='Predicted', ylabel='Observed')\n\n    sns.regplot(x=pred_vals, y=resids, lowess=True, ax=ax[1], line_kws={'color': 'red'})\n    ax[1].set_title('Residuals vs. Predicted Values', fontsize=16)\n    ax[1].set(xlabel='Predicted', ylabel='Residuals')\n    \nlinearity_test(lin_reg, y)  ","0f7eb588":"lin_reg.resid.mean()","919afe79":"import statsmodels.stats.api as sms\nfrom statsmodels.compat import lzip\n\nmodel = lin_reg\npred_vals = model.predict()\nresids = model.resid\nresids_standardized = model.get_influence().resid_studentized_internal\nfig, ax = plt.subplots(1,2)\n\nsns.regplot(x=pred_vals, y=resids, lowess=True, ax=ax[0], line_kws={'color': 'red'})\nax[0].set_title('Residuals vs Fitted', fontsize=16)\nax[0].set(xlabel='Fitted Values', ylabel='Residuals')\nsns.regplot(x=pred_vals, y=np.sqrt(np.abs(resids_standardized)), lowess=True, ax=ax[1], line_kws={'color': 'red'})\nax[1].set_title('Scale-Location', fontsize=16)\nax[1].set(xlabel='Fitted Values', ylabel='sqrt(abs(Residuals))')\n\nname = ['F statistic', 'p-value']\ntest = sms.het_goldfeldquandt(model.resid, model.model.exog)\nlzip(name, test)","7a19e577":"from statsmodels.stats.outliers_influence import variance_inflation_factor\n\nvif = [variance_inflation_factor(X_constant.values, i) for i in range(X_constant.shape[1])]\npd.DataFrame({'vif': vif[1:]}, index=X.columns)","f375a23d":"X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=3)","2452c288":"lr = LinearRegression()\nlr.fit(X_train, y_train)\ny_pred=lr.predict(X_test)","4a827fa6":"coll=['Status','Adult Mortality','infant deaths','Alcohol','percentage expenditure','Hepatitis B', \n        'Measles ',' BMI ','under-five deaths ','Polio', 'Total expenditure','Diphtheria ', \n     ' HIV\/AIDS','GDP','Population',\n        ' thinness  1-19 years',' thinness 5-9 years','Income composition of resources','Schooling']","82d8b073":"coefficients = pd.Series(lr.coef_, index= coll)\nprint(coefficients)","217d8c50":"print('Intercept: ',lr.intercept_)\nprint('Mean absolute error for test: ',mean_absolute_error(y_test,y_pred))\nprint('Mean Squared error for test: ',mean_squared_error(y_test,y_pred))\nprint('Root mean squared error for test: ',np.sqrt(mean_squared_error(y_test,y_pred)))\nprint('Accuracy for train: ',lr.score(X_train, y_train))\nprint('Accuracy for test: ',lr.score(X_test, y_test))\nprint('R square of test: ',r2_score(y_test,y_pred))","b5766756":"rcv=RidgeCV(cv=5)\nrcv.fit(X_train,y_train)\ny_pred_rr=rcv.predict(X_test)","4cd897fd":"print('Optimal alpha: ',rcv.alpha_)","c6defb08":"coefficients_rcv=pd.Series(rcv.coef_,index=coll)\nprint(coefficients_rcv)\nprint('Intercept: ',rcv.intercept_)\nprint('Mean absolute error for test: ',mean_absolute_error(y_test,y_pred_rr))\nprint('Mean Squared error for test: ',mean_squared_error(y_test,y_pred_rr))\nprint('Root mean squared error for test: ',np.sqrt(mean_squared_error(y_test,y_pred_rr)))\nprint('Train accuracy: ',rcv.score(X_train,y_train))\nprint('Test accuracy: ',rcv.score(X_test,y_test))\nprint('R square of test:',r2_score(y_test,y_pred_rr))","4338cc16":"lassocv=LassoCV(cv=5,random_state=3)\nlassocv.fit(X_train,y_train)\ny_pred_lasso=lassocv.predict(X_test)","7a28ac3e":"print('Optimal alpha: ',lassocv.alpha_)\nprint('No. of interations: ',lassocv.n_iter_)","1523c415":"coefficients_lasso=pd.Series(lassocv.coef_,index=coll)\nprint(coefficients_lasso)\nprint('Intercept: ',lassocv.intercept_)\nprint('Mean absolute error for test: ',mean_absolute_error(y_test,y_pred_lasso))\nprint('Mean Squared error for test: ',mean_squared_error(y_test,y_pred_lasso))\nprint('Root mean squared error for test: ',np.sqrt(mean_squared_error(y_test,y_pred_lasso)))\nprint('Train accuracy: ',lassocv.score(X_train,y_train))\nprint('Test accuracy: ',lassocv.score(X_test,y_test))\nprint('R square of test:',r2_score(y_test,y_pred_lasso))","575f8348":"en_cv = ElasticNetCV(l1_ratio=[.1, .5, .7, .9, .95, .99, .995, 1], eps=0.001, n_alphas=100, fit_intercept=True, \n                        normalize=True, precompute='auto', max_iter=2000, tol=0.0001, cv=5, \n                        copy_X=True, verbose=0, n_jobs=-1, positive=False, random_state=None, selection='cyclic')","149ddd99":"en_cv.fit(X_train,y_train)\ny_pred_en=en_cv.predict(X_test)","1908eb08":"print('Optimal alpha: ',en_cv.alpha_)\nprint('Optimal l1_ratio: ',en_cv.l1_ratio_)\nprint('Number of iterations: ',en_cv.n_iter_)","b52d5fa2":"coefficients_en=pd.Series(en_cv.coef_,index=coll)\nprint(coefficients_en)\nprint('Intercept: ',en_cv.intercept_)\nprint('Mean absolute error for test: ',mean_absolute_error(y_test,y_pred_en))\nprint('Mean Squared error for test: ',mean_squared_error(y_test,y_pred_en))\nprint('Root mean squared error for test: ',np.sqrt(mean_squared_error(y_test,y_pred_en)))\nprint('Train accuracy: ',en_cv.score(X_train,y_train))\nprint('Test accuracy: ',en_cv.score(X_test,y_test))\nprint('R square of test:',r2_score(y_test,y_pred_en))","1821f0e8":"coefficients_en[abs(coefficients_en)>0.05]","60fda11b":"# Base Model","e00e767c":"# Assumptions of Linear Regression","a3c85d0a":"# Regularization techniques used to reduce overfitting of the model.","ed39294b":"* Assuming alpha= 0.05\n* Significant features (pvalue < 0.05) are: \n    Status, Adult mortality, infant deaths, Alcohol, Hepatitis B, BMI, under-five deaths, polio, Diphtheria, HIV\/AIDS, GDP, population, Income composition of resources, Schooling","eb5971fb":"As the pvalue of Goldfeldquandt test is greater than alpha(0.05), hence there is homoscedasticity distribution which is also seen in the plots.","9ee6df63":"# RidgeCV","401280ec":"Asssumption 3 : Linearity of residuals","e364dd8a":"Assumption 1 : No Autocorrelation","18db413d":"Assumption 2 : Normality of Residuals","a5403853":"* BMI, Diphtheria, HIV\/AIDS are highly correlated to Life expectancy , also evident from the pairplot.\n* Polio - Diphtheria, Hepatitis B - Diphtheria are highly correlated, hence multi collinearity is present.","c440252c":"Assumption 5 : No Multicollinearity","04801cff":"Assumption 4 : Homoscedasticity_test(using goldfeld test)","3e051219":"# Most significant fetaures to predict Life expectancy","15a15aba":"Mean of residuals closer to zero states that the residuals are linear.","b3b864ef":"Developed nations have high life expectancy than Developing nations","66bfc68e":"# Outliers","2dffb57f":"* Adult Mortality,infant deaths,under-five deaths and Schooling are highly correlated to target variable , thus all are significant features to predict target variable.\n* All independent features are highly correlated with each other.","1103e321":"To detect nonlinearity one can inspect plots of observed vs. predicted values or residuals vs. predicted values. The desired outcome is that points are symmetrically distributed around a diagonal line in the former plot or around horizontal line in the latter one. In both cases linearity of residuals can be seen.","99d99103":"# EDA","75bc144c":"* Status\n* infant deaths\n* under-five deaths\n* HIV\/AIDS\n* Income composition of resources\n* Schooling","f735377c":"# Linear Regression","220265fb":"# Missing Values","a11dbc80":"* GDP, population, Income composition of resources are highly correlated to Life expectancy.\n* percentage expenditure and GDP are highly correlated as percentage expenditure is Expenditure on health as a percentage of Gross Domestic Product per capita(%).","55cac888":"infant deaths and under-five deaths are highly multi collinear.","e5fa4fe5":"# Elastic-Net CV","71e732c8":"From the plot it is clear that residuals are left skewed and pvalue of Jarque-Bera test is leass than alpha(0.05), thus residuals are not normally distributed.","0a02d1bf":"# Train-Test split","b130a515":"As residuals are having a pattern and Durbin-Watson test value = 0.637 indicates presence of positive autocorrelation.","719b3ad3":"# LassoCV"}}