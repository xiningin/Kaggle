{"cell_type":{"94ef74b5":"code","747cd84a":"code","68c3766e":"code","d46b324f":"code","48c90753":"code","7b0cd46f":"code","e881d448":"code","2e56b242":"code","25ac3c10":"code","50ec6635":"code","d4c7f68e":"code","eb86fed1":"code","b697987e":"code","b60b572f":"code","b4bf8d27":"code","a3247ebf":"code","bbf894d7":"code","63c15412":"code","afa6c9b0":"code","96e08e30":"code","cd4018f1":"code","bcf9f284":"code","4c268284":"code","da363fdc":"code","5569dce9":"code","cef3e186":"code","30053374":"code","1acea1f5":"markdown","cbdd0dba":"markdown","00652fa7":"markdown","062eb28d":"markdown","a6e4b037":"markdown","c7a3bee3":"markdown","d2dd7f95":"markdown","9786c4f8":"markdown","d31b09d4":"markdown","dec1d18f":"markdown","e1b39f18":"markdown","91bcfbf5":"markdown","0d8e564f":"markdown","109743b9":"markdown","5fa4b94a":"markdown","c2f4f611":"markdown","8a11b184":"markdown","77d66f25":"markdown","2144f40d":"markdown","5ed4e5ec":"markdown","e081a6aa":"markdown","05581dca":"markdown","b86f6bd8":"markdown","580b9108":"markdown","083ced2b":"markdown","1d1e42d5":"markdown","34af0709":"markdown","8ce754f3":"markdown","c965e22a":"markdown","6f5a7d2f":"markdown","6b86c0e7":"markdown","d9db4f36":"markdown","05f5ae9e":"markdown","f9922b17":"markdown","d384b41e":"markdown","e23f8518":"markdown","3b6786a5":"markdown","8e041a49":"markdown","bb210648":"markdown"},"source":{"94ef74b5":"# introduction","747cd84a":"#Basic needed libraries\nimport numpy as np\nimport pandas as pd\n\n#visualization libraries\nimport plotly.express as px\nimport plotly.graph_objects as go\n\n\n#Processing:\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import LabelEncoder","68c3766e":"# I had noticed that the dataframe had commas for decimal, pandas automatically can handle it during loading with the decimal field. \ndf =  pd.read_csv(\"..\/input\/beer-consumption-sao-paulo\/Consumo_cerveja.csv\",  decimal=\",\")\n","d46b324f":"#Finding Number of rows and columns\nprint(\"Dataset contains {} rows and {} columns\".format(df.shape[0], df.shape[1]))","48c90753":"df.head()","7b0cd46f":"df.columns = ['Date', 'Temp_Median', 'Temp_Min', 'Temp_Max', 'Precipitation', 'Weekend', 'Consumption_Litres']","e881d448":"df.head()","2e56b242":"df.isnull().sum()","25ac3c10":"# Dropping rows as after the year ends, there is no information provided, only null values\ndf =  df.dropna()","50ec6635":"df['Consumption_Litres'] = pd.to_numeric(df['Consumption_Litres'])","d4c7f68e":"weekdays = sum(df[df.Weekend == 0]['Consumption_Litres'])\nweekend = sum(df[df.Weekend==1]['Consumption_Litres'])\n\nlabels = ['Weekdays','Weekend']\nvalues = [weekdays, weekend]\ncolors = ['crimson']\n\nfig = go.Figure(data=[go.Bar(\n    x=labels, y=values, marker_color= colors\n)])\nfig.show()","eb86fed1":"df['Date'] = pd.to_datetime(df['Date'])\n","b697987e":"#Extracting day and month from the datetime object:\n\ndf['Months'] = df['Date'].apply(lambda x: x.strftime('%B'))\ndf['Day'] = df['Date'].apply(lambda x: x.strftime('%A'))","b60b572f":"df.head()","b4bf8d27":"fig = px.box(df, x=\"Day\", y=\"Consumption_Litres\", color=\"Day\", orientation='v', notched=True, title = 'Beer Consumption by day of the week' )\n\nfig.show()","a3247ebf":"fig = px.box(df, x=\"Months\", y=\"Consumption_Litres\", color=\"Months\", orientation='v', notched=True, title = 'Beer Consumption by Months of the year' )\n\nfig.show()","bbf894d7":"\n\nfig = go.Figure()\n# Create and style traces\nfig.add_trace(go.Scatter(x=df['Date'], y=df['Temp_Min'], name='Minimum Temperature',\n                         line=dict(color='royalblue', width=3)))\nfig.add_trace(go.Scatter(x=df['Date'], y=df['Temp_Max'], name = 'Max Temperature',\n                         line=dict(color='crimson', width=3)))\nfig.add_trace(go.Scatter(x=df['Date'], y=df['Temp_Median'], name='Median Temperature',\n                         line=dict(color='orange', width=3,\n                              dash='dash') \n))\n\n\n# Edit the layout\nfig.update_layout(title='Temperature throughout Brazil',\n                   xaxis_title='Dates',\n                   yaxis_title='Temperature (degrees C)')\n\n\nfig.show()","63c15412":"seasons_map = {\n    'January': 'Summer',\n    'February': 'Summer',\n    'March': 'Summer',\n    'April': 'Autumn',\n    'May': 'Autumn',\n    'June': 'Winter',\n    'July': 'Winter',\n    'August': 'Winter',\n    'September': 'Winter',\n    'October': 'Spring',\n    'November': 'Spring',\n    'December': 'Summer'\n    \n}\n\n\ndf['Season'] = df['Months'].apply(lambda x: seasons_map[x])","afa6c9b0":"fig = px.box(df, x=\"Season\", y=\"Consumption_Litres\", color=\"Season\", orientation='v', notched=True, title = 'Beer Consumption by Seasons of the year' )\n\nfig.show()","96e08e30":"\n\nfig = go.Figure()\n# Create and style traces\nfig.add_trace(go.Scatter(x=df['Date'], y=df['Precipitation'], name='Rainfall for the year',\n                         line=dict(color='blue', width=3)))\n\n\n\n# Edit the layout\nfig.update_layout(title='Rainfall throughout Brazil',\n                   xaxis_title='Dates',\n                   yaxis_title='Precipitation')\n\n\nfig.show()","cd4018f1":"df","bcf9f284":"label_encoder = LabelEncoder()\n\ndf['Months'] = label_encoder.fit_transform(df['Months'])\ndf['Day'] = label_encoder.fit_transform(df['Day'])\ndf['Season'] = label_encoder.fit_transform(df['Season'])","4c268284":"X, y = df.drop('Consumption_Litres', axis=1), df['Consumption_Litres']","da363fdc":"\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)","5569dce9":"X, y = df['Temp_Median'], df['Consumption_Litres']\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)","cef3e186":"def Simple_Linear_Regression(x, y): \n    n = len(x)\n    x_mean = x.mean()\n    y_mean = y.mean()\n    \n    B1_numerator = sum(((x-x_mean) * (y-y_mean)))\n    B1_denominator = sum((x-x_mean)**2)\n    \n    B1_hat = B1_numerator\/B1_denominator\n    \n    B0_hat = y_mean - B1_hat * x_mean\n    \n    regression_line = f'y = {B0_hat} + {B1_hat}X'\n    \n    return B0_hat, B1_hat, regression_line","30053374":"Simple_Linear_Regression(X, y)","1acea1f5":"Let \n\n$$ (x_1, y_1), (x_2,y_2) ... (x_n, y_n)$$\n\nrepresent n observation pairs, each of which contains a measurement of X and a measurement of Y. \n\nHere, X represents the set of features apart from Consumption litres and Y represents the Consumption Litres, the variable that we are tyring to predict. ","cbdd0dba":"##### Encoding categorical variables into numerical data for calculation","00652fa7":"Let's consider that we have two sets of data. Let's try to be as silly as possible for this. \n- Height (X)\n- Income (Y)\n\nWe are holding an assumption that the data is continuous, i.e, scales up in a specific order as:\n- 100, 200, 300.....\n\nSince both height and income can follow this pattern, this would be a satisfactory dataset. \n\nOur aim, with linear regression, is to find relations between the two datasets. Our entire approach revolves around the question:\n- Is income related to the height of the person? \n- Do taller people earn more? \n- If it really does, can we predict it? \n\nConsidering our dataset for a 1000 people, our dataset would consist of these datapoints: \n- 145 cm, 51000 USD\n- 184 cm, 62000 USD\n- 152 cm, 59000 USD\n\nAnd so on. \n\nLinear regression lets us do some math on these data points and describes the correlation between these datasets. That is, how strongly does height really relate with high income.\n\nSince correlation, in this example, has a range 0f 0-1, the correlation would confirm the following hypothesis: \n- A correlation of 1 would mean being tall always means you have a higher income.\n\n- A correlation of 0 would mean there is no relationship between height and income.\n\n- A negative value means a negative correlation, that is, taller people tend to have lower incomes. A correlation of -1 would mean taller people always make less money than shorter people.\n\n\nThis allows us to understand the relation between two variables, or two types of data. \nAlso, once we have the relation, we can use linear regression for prediction. If we know the rough relationship between X and Y, then we can use this relationship to predict values of Y for a value of X we want.\n\nFor this example, it would be: prediciting income for the height of the person\n","062eb28d":"#### Ensuring that the data is split into train and test dataset, to see how our model will perform. ","a6e4b037":"## [Exploratory Data Analysis]()<a id=\"6\"><\/a> <br>","c7a3bee3":"#### [How was the temperature for the year?]()<a id=\"10\"><\/a> <br>","d2dd7f95":"We can observe that the Beer consumption was higher in the end of the year: December to March, while it decreased around the mid, June and July. \nConsidering that the southern hemisphere has a different time for seasons, the temperature should be checked. \n","9786c4f8":"#### [How much beer was consumed on an average for each day?]()<a id=\"8\"><\/a> <br>","d31b09d4":"Let's begin the journey, there seems to be a few features provided for the dataset. Yet, it all seems to be in a different language. Being only familiar with English, my first step would be to translate them into English and then proceed forward. \n\n","dec1d18f":"### [Simple Linear Regression Data Prep ]()<a id=\"16\"><\/a> <br>","e1b39f18":"Before we head on to the math, let's go through the regular steps:\n- Brief Data Outlook\n- EDA\n- Data Cleaning and Preprocessing\n- Data Modelling\n- Results and Evaluation","91bcfbf5":"From this, we can observe that the seasons really have been changed. \n\nAfter researching on the web, we can observe: (https:\/\/www.frommers.com\/destinations\/brazil\/planning-a-trip\/when-to-go)\n\n- Summer Months: December to March\n- Autumn Months: April-May\n- Winter Months: June - September\n- Spring: October-November\n\nUsing that data, we can assign seasons to the dataset. \n\nThis idea was taken after going through the graph here: kaggle.com\/michau96\/when-brazilian-students-drink-beer\/data\n","0d8e564f":"#### [How much beer was consumed each season?]()<a id=\"11\"><\/a> <br>","109743b9":"We can observe that the highest beer consumption is during Summer and Spring, followed by winter, which is surprising as I had expected Winter to have the least amount of beer consumption. ","5fa4b94a":"#### Converting features to numeric values","c2f4f611":"#### [How is the rainfall for the year?]()<a id=\"12\"><\/a> <br>","8a11b184":"## [Linear Regression Mathematics]()<a id=\"14\"><\/a> <br>","77d66f25":"#### Columns Description\n\n- **Date**: The date, of the year 2015. This seems to be a daily date tracking. \n- **Temp Median**: Median temperature for the day.\n- **Temp Min**: Min temperature for that day. \n- **Temp Max**: Max temperature for that day.\n- **Precipitation**: Chance of rain for that day. \n- **Weekend**: Bool, 1: Weekend, 0: Weekday. \n- **Consumption Litres**: The amount of beer consumed for that day.","2144f40d":"## [Preparing Data]()<a id=\"13\"><\/a> <br>","5ed4e5ec":"# Contents: \n1. [What is Linear Regression? ](#1) \n    1. [ELI5: Linear Regression, as simple as possible](#2)\n3. [Brief Data Outlook](#3)\n    1. [Loading Libraries and Data](#4)\n    2. [Understanding Data](#5)\n3. [Exploratory Data Analysis](#6)\n    1. [How much beer was consumed overall on weekend and weekdays??](#7) \n    2. [How much beer was consumed on an average for each day?](#8)\n    3. [How much beer was consumed each month?](#9)\n    4. [How was the temperature for the year?](#10)\n    5. [How much beer was consumed each season?](#11)\n    6. [How is the rainfall for the year?](#12)\n    \n4. [Preparing Data](#13)","e081a6aa":"### [Simple Linear Regression Math ]()<a id=\"15\"><\/a> <br>","05581dca":"Simple Linear Regression is a very straightforward algorithm to predict the quantative response Y on the basis of a single predictor X. It assumes that there is a mathematical relation between X and Y.\n\n$$ Y = \\beta_0 + \\beta_1X  $$\n\nHere $$ \\beta_0, \\beta_1 $$ can be considered as the model coefficents or the parameters. ","b86f6bd8":"### [Understanding Data]()<a id=\"5\"><\/a> <br>","580b9108":"Based on the math displayed above, we will now write the function to calculate the simple linear regression. ","083ced2b":"#### [How much beer was consumed overall on weekend and weekdays?]()<a id=\"7\"><\/a> <br>","1d1e42d5":"We can observe that the most beer was consumed on Saturdays, with Sunday following it. This gives rise to the conclusion that on an average, beer was consumed most during the weekends. ","34af0709":"It doesn't seem that the rainfall had a tremendous effect on beer consumption. It is highest during the summer months, but since beer is meant to defeat the heat, it could be a case of correlation doesn't equal causality. ","8ce754f3":"#### [How much beer was consumed each month?]()<a id=\"9\"><\/a> <br>","c965e22a":"## [Brief Data Outlook]()<a id=\"3\"><\/a> <br>","6f5a7d2f":"Having gone through the basic EDA, let's head into the crux of this notebook: Linear regression from scratch.","6b86c0e7":"We can now see the Months and the Days of the year 2015. ","d9db4f36":"## [What is Linear Regression?]()<a id=\"1\"><\/a> <br>\n#### [ELI5: Linear Regression, as simple as possible.]()<a id=\"2\"><\/a> <br>","05f5ae9e":"**Least Squares**\n\nThis is a method to calculate the predicitons by minimizing the parameters. At this point, simple linear regression only considers one pair. So, for our example, for this, we will just consider **Temperature_Median** to predict against. \n\nLeast squares assumes:\n\n$$ \\hat y = \\hat \\beta_0 + \\hat \\beta_1X $$\n\nAnd based on that formula, the error or the resuidual is calculated as: \n\n$$ e = y_i - \\hat y_i $$\n\n\nLeast squares is the method of plotting a line with the least Residual Sum of Squares or RSS: \n\n$$ RSS = e_1^2 + e_2^2 .... + e_n^2 $$\n\nor \n\n$$ RSS = ( y_1 - \\hat \\beta_0 - \\hat \\beta_1 X_1) + ..... + (y_n - \\hat \\beta_n - \\hat \\beta_n X_n) $$\n\nThe least square approach uses the parameters to minimize the RSS. \n\nUsing calculus, we can show how to minimize the parameters\n\n$$ \\hat \\beta_1 = \\frac {\\hat \\sum_{i=1}^{n} (x_i - \\bar x) (y_i - \\bar y)}  {\\sum_{i=1}^n (x_i - \\bar x)^2} $$\n\n\nTo estimate the intercept $$ \\hat \\beta_0 $$ we can use the formula $$ \\hat \\beta_0 =  \\hat y - \\hat \\beta_1 \\bar x $$","f9922b17":"First, we will need to add the days into the dataframe. While we are doing this, let's also add the month of the year too. ","d384b41e":"### [Loading Libraries and Data]()<a id=\"4\"><\/a> <br>","e23f8518":"Checking for null values","3b6786a5":"#### [Simple Linear Regression Function]()<a id=\"17\"><\/a> <br>","8e041a49":"Applying the Simple_Linear_Regression function to the feature:","bb210648":"We can observe that on an average, the beer consumed on weekdays was more than the beer consumed on the weekend. But, since this is just an aggregate for how much was consumed overall, we can understand that weekends are less in number. Thus, let's create a chart for per day, where we can observe how much beer was consumed on an average for each day. "}}