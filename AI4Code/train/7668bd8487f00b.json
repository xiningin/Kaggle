{"cell_type":{"cc44dfe0":"code","e8d175fc":"code","6899418d":"code","f91542cf":"code","8458b381":"code","b13c71dc":"code","e0a158e6":"code","52bcacaf":"code","7a347294":"code","944a3c09":"code","0f066480":"code","5794f825":"markdown","f71b66b3":"markdown","b73381bb":"markdown"},"source":{"cc44dfe0":"import numpy as np\nimport pandas as pd\nfrom sklearn.cluster import KMeans\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","e8d175fc":"%%time\ntrain = pd.read_csv('..\/input\/tabular-playground-series-nov-2021\/train.csv')\ntest = pd.read_csv('..\/input\/tabular-playground-series-nov-2021\/test.csv')\nsample_submission = pd.read_csv('..\/input\/tabular-playground-series-nov-2021\/sample_submission.csv')\n\nmemory_usage = train.memory_usage(deep=True) \/ 1024 ** 2\nstart_mem = memory_usage.sum()","6899418d":"cor_1 = train.corr()\ncor_1.head()\ncor_1.shape","f91542cf":"cor_target = cor_1.loc['target':'target']\ncor_2 = cor_target.drop(['id','target'],axis=1)\ncor_3 = abs(cor_2)\ncor_4 = cor_3.sort_values(by='target',axis=1, ascending=False)\npd.set_option('display.max_rows', 1)\npd.set_option('display.max_columns', 285)\ncor_4.head()","8458b381":"useful_features = ['f34','f55','f43','f71','f80','f91','f8','f27']\ndistortions=[]\nfor i in range(1,15):\n    km = KMeans(n_clusters=i,\n              init=\"k-means++\",\n              max_iter=500,\n              random_state=42)\n    km.fit(train[useful_features])\n    distortions.append(km.inertia_)","b13c71dc":"import matplotlib.pyplot as plt\nplt.plot(range(1,15),distortions,marker=\"o\")\nplt.xticks(range(1,15))\nplt.xlabel(\"Number of clusters\")\nplt.ylabel(\"Distortion\")\nplt.show()","e0a158e6":"%%time\nfeature_cols = [col for col in test.columns.tolist()]\nuseful_features = ['f34','f55','f43','f71','f80','f91','f8','f27']\nn_clusters = 8\ncd_feature = True # cluster distance instead of cluster number\ncluster_cols = [f\"cluster{i+1}\" for i in range(n_clusters)]\nkmeans = KMeans(n_clusters=n_clusters, init=\"k-means++\", max_iter=500, random_state=42)\n\nif cd_feature:\n    # train\n    X_cd = kmeans.fit_transform(train[useful_features])\n    X_cd = pd.DataFrame(X_cd, columns=cluster_cols, index=train.index)\n    train = train.join(X_cd)\n    # test\n    X_cd = kmeans.transform(test[useful_features])\n    X_cd = pd.DataFrame(X_cd, columns=cluster_cols, index=test.index)\n    test = test.join(X_cd)\n    \nelse:\n    # train\n    train[\"cluster\"] = kmeans.fit_predict(train[useful_features])\n    # test\n    test[\"cluster\"] = kmeans.predict(test[useful_features])\n    \n    # one-hot encode\n    ohe = OneHotEncoder()\n    X_ohe = ohe.fit_transform(np.array(train[\"cluster\"]).reshape(-1,1)).toarray()\n    T_ohe = ohe.transform(np.array(test[\"cluster\"]).reshape(-1,1)).toarray()\n\n    X_ohe = pd.DataFrame(X_ohe, columns=cluster_cols, index=train.index)\n    T_ohe = pd.DataFrame(T_ohe, columns=cluster_cols, index=test.index)\n\n    train = pd.concat([train, X_ohe],axis=1)\n    test = pd.concat([test, T_ohe],axis=1)\n\nfeature_cols += cluster_cols\ntrain.head()","52bcacaf":"import matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set_style('darkgrid')\nfig = plt.figure(figsize = (10,5))\n\nif cd_feature:\n    sns.kdeplot(data=train[cluster_cols])\nelse:\n    ax = sns.countplot(data=train, x='cluster', hue=\"target\")\n    for p in ax.patches:\n        ax.annotate(f'\\n{p.get_height()}', (p.get_x()+0.2, p.get_height()), ha='center', va='top', color='white', size=5)\n\nplt.show()","7a347294":"def add_feature(df):\n    df[\"new_f1\"] = (df[\"cluster1\"])\/(df[\"cluster8\"])\n    df[\"new_f2\"] = (df[\"cluster1\"])\/(df[\"cluster7\"])\n    df[\"new_f3\"] = (df[\"cluster1\"])\/(df[\"cluster6\"])\n    df[\"new_f4\"] = (df[\"cluster1\"])\/(df[\"cluster5\"])\n    df[\"new_f5\"] = (df[\"cluster1\"])\/(df[\"cluster4\"])\n    df[\"new_f6\"] = (df[\"cluster1\"])\/(df[\"cluster3\"])\n    df[\"new_f7\"] = (df[\"cluster1\"])\/(df[\"cluster2\"])\n    df[\"new_f8\"] = (df[\"cluster2\"])\/(df[\"cluster8\"])\n    df[\"new_f9\"] = (df[\"cluster2\"])\/(df[\"cluster7\"])\n    df[\"new_f10\"] = (df[\"cluster2\"])\/(df[\"cluster6\"])\n    df[\"new_f11\"] = (df[\"cluster2\"])\/(df[\"cluster5\"])\n    df[\"new_f12\"] = (df[\"cluster2\"])\/(df[\"cluster4\"])\n    df[\"new_f13\"] = (df[\"cluster2\"])\/(df[\"cluster3\"])\n    df[\"new_f14\"] = (df[\"cluster3\"])\/(df[\"cluster8\"])\n    df[\"new_f15\"] = (df[\"cluster3\"])\/(df[\"cluster7\"])\n    df[\"new_f16\"] = (df[\"cluster3\"])\/(df[\"cluster6\"])\n    df[\"new_f17\"] = (df[\"cluster3\"])\/(df[\"cluster5\"])\n    df[\"new_f18\"] = (df[\"cluster3\"])\/(df[\"cluster4\"])\n    df[\"new_f19\"] = (df[\"cluster4\"])\/(df[\"cluster8\"])\n    df[\"new_f20\"] = (df[\"cluster4\"])\/(df[\"cluster7\"])\n    df[\"new_f21\"] = (df[\"cluster4\"])\/(df[\"cluster6\"])\n    df[\"new_f22\"] = (df[\"cluster4\"])\/(df[\"cluster5\"])\n    df[\"new_f23\"] = (df[\"cluster5\"])\/(df[\"cluster8\"])\n    df[\"new_f24\"] = (df[\"cluster5\"])\/(df[\"cluster7\"])\n    df[\"new_f25\"] = (df[\"cluster5\"])\/(df[\"cluster6\"])\n    df[\"new_f26\"] = (df[\"cluster6\"])\/(df[\"cluster8\"])\n    df[\"new_f27\"] = (df[\"cluster6\"])\/(df[\"cluster7\"])\n    df[\"new_f28\"] = (df[\"cluster7\"])\/(df[\"cluster8\"])\n    return df\n\nnew_features = [\"new_f1\",\"new_f2\",\"new_f3\",\"new_f4\",\"new_f5\",\"new_f6\",\"new_f7\",\"new_f8\",\"new_f9\",\"new_f10\"\\\n               ,\"new_f11\",\"new_f12\",\"new_f13\",\"new_f14\",\"new_f15\",\"new_f16\",\"new_f17\",\"new_f18\",\"new_f19\",\"new_f20\"\\\n               ,\"new_f21\",\"new_f22\",\"new_f23\",\"new_f24\",\"new_f25\",\"new_f26\",\"new_f27\",\"new_f28\"]\ntrain = add_feature(train)\ntest = add_feature(test)\nfeature_cols += new_features\ntrain.head()","944a3c09":"%%time\nfrom sklearn.feature_selection import mutual_info_regression\nx = train.iloc[:5000,:][feature_cols].copy()\ny = train.iloc[:5000,:]['target'].copy()\nmi_scores = mutual_info_regression(x, y)\nmi_scores = pd.Series(mi_scores, name=\"MI Scores\", index=x.columns)\nmi_scores = mi_scores.sort_values(ascending=False)","0f066480":"import plotly.figure_factory as ff\nimport plotly.express as px\ntop = 20\nfig = px.bar(mi_scores, x=mi_scores.values[:top], y=mi_scores.index[:top])\nfig.update_layout(\n    title=f\"Top {top} Strong Relationships Between Feature Columns and Target Column\",\n    xaxis_title=\"Relationship with Target\",\n    yaxis_title=\"Feature Columns\",\n    yaxis={'categoryorder':'total ascending'},\n    colorway=[\"blue\"]\n)\nfig.show()","5794f825":"'cluster8'\\\n'new_f12' = (cluster2)\/(cluster4)\\\n'new_f1' = (cluster1)\/(cluster8)\\\n top3 strong relationship\\\n good luck!","f71b66b3":"KMeans","b73381bb":"Columns with a correlation of \"target > 0.1\" are used to generate new features using the KMeans method."}}