{"cell_type":{"cf15f861":"code","cc4a1fe9":"code","768c7432":"code","f232ec3f":"code","3eda510a":"code","1c672f82":"code","6ed46086":"code","7c8d0c20":"code","d1202cc4":"code","724604e1":"code","9cb50edd":"code","b64bc95e":"code","0322ed23":"code","5106b6b5":"code","7ee487a5":"code","d2468fe3":"code","7e1c9be9":"code","edfc3212":"code","f2090b84":"code","11cb5ce8":"code","952868dd":"code","98c2d73c":"code","f9909dda":"code","18421576":"code","993000d4":"code","78da07eb":"code","f2f54cba":"code","8d8aca16":"code","60312bd7":"code","b1942f27":"code","3dc86c5e":"code","842cad0a":"code","e675a787":"code","3da0fd47":"code","02c62933":"code","315b430d":"code","d7a0ae4a":"code","be38e4cf":"code","46957923":"code","7fe72d10":"code","be1ef2a6":"code","6a14c42b":"code","6b81e37f":"code","bbde6159":"code","0f9cf784":"code","976017d9":"code","a34ba44b":"markdown","59826962":"markdown","e118d815":"markdown","73e7d077":"markdown","361f4286":"markdown","3823e7b8":"markdown","30dde89b":"markdown"},"source":{"cf15f861":"#importing neccessary libraries\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\nimport datetime\nfrom sklearn.preprocessing import LabelEncoder\nfrom xgboost.sklearn import XGBClassifier\nimport warnings\nwarnings.filterwarnings('ignore')\n","cc4a1fe9":"#Loading the Data\ndf_train = pd.read_csv('..\/input\/airbnb-recruiting-new-user-bookings\/train_users_2.csv.zip')\ndf_test = pd.read_csv('..\/input\/airbnb-recruiting-new-user-bookings\/test_users.csv.zip')\ndf_train.shape, df_test.shape","768c7432":"labels = df_train.country_destination.values\nid_test = df_test.id\ndf_train.drop(['country_destination'], axis = 1)\n#Concatenating train and test data for EDA\ndf_all = pd.concat((df_train, df_test), axis = 0, ignore_index= True)","f232ec3f":"df_all.shape","3eda510a":"df_all.head()","1c672f82":"#Finding the number of null entries in each column.\nfor i in df_all.columns:\n    ab = df_all[i].isnull().sum()\n    if ab != 0:\n        print(i + \" has {} null values.\".format(ab))\n        print()","6ed46086":"df_all.info()","7c8d0c20":"df_all = df_all.drop(['id','country_destination','date_first_booking'], axis = 1)","d1202cc4":"for i in df_all.columns:\n    ab = df_all[i].isnull().sum()\n    if ab != 0:\n        print(i + \" has {} null values.\".format(ab))\n        print()","724604e1":"df_all.head()","9cb50edd":"df_all.gender.value_counts()","b64bc95e":"df_all.age.describe()","0322ed23":"df_all[df_all['age']<15].age = np.nan\ndf_all[df_all['age']>=100].age = np.nan","5106b6b5":"#Converting below columns as categories for plotting in graphs\ncategorical_features = [\n    'affiliate_channel',\n    'affiliate_provider',\n    'first_affiliate_tracked',\n    'first_browser',\n    'first_device_type',\n    'gender',\n    'language',\n    'signup_app',\n    'signup_method',\n    'signup_flow'\n]\n\nfor categorical_feature in categorical_features:\n    df_all[categorical_feature] = df_all[categorical_feature].astype('category')","7ee487a5":"df_all['date_account_created'] = pd.to_datetime(df_all['date_account_created'])\ndf_all['timestamp_first_active'] = pd.to_datetime(df_all['timestamp_first_active'], format='%Y%m%d%H%M%S')","d2468fe3":"sns.set_style('whitegrid')\nsns.set_context(\"talk\")","7e1c9be9":"#Finding the gender distribution\n\nplt.figure(figsize=(14,8))\norder1 = df_all['gender'].value_counts().index\nsns.countplot(data = df_all, x = 'gender', order = order1, color = sns.color_palette()[0])\nplt.xlabel('Gender')\nplt.ylabel('Count')\nplt.title('Gender Distribution')\norder2 = df_all['gender'].value_counts()\n\nfor i in range(order2.shape[0]):\n    count = order2[i]\n    strt='{:0.1f}%'.format(100*count \/ df_all.shape[0])\n    plt.text(i,count+1000,strt,ha='center')","edfc3212":"#Finding Destination Distribution.\n\nplt.figure(figsize=(14,8))\norder1 = df_train['country_destination'].value_counts().index\nsns.countplot(data = df_train, x = 'country_destination', order = order1, color = sns.color_palette()[1])\nplt.xlabel('Destination')\nplt.ylabel('Count')\nplt.title('Destination Distribution')\norder2 = df_train['country_destination'].value_counts()\n\nfor i in range(order2.shape[0]):\n    count = order2[i]\n    strt='{:0.1f}%'.format(100*count \/ df_train.shape[0])\n    plt.text(i,count+1000,strt,ha='center')","f2090b84":"#Extracting year for date_account_created\ndf_all['acc_year'] = df_all['date_account_created'].dt.year\n\n\ndf1 = df_all.groupby('acc_year').count()\ndf1.head()\n\nyears = [2010,2011,2012,2013,2014]\nyearsOrder=pd.api.types.CategoricalDtype(ordered=True, categories=years)\ndf1.reset_index(inplace = True)\ndf1.acc_year = df1.acc_year.astype(yearsOrder)","11cb5ce8":"#Finding year-wise distribution\n\nplt.figure(figsize=[14,8])\nsns.barplot(data=df1,x='acc_year',y='affiliate_provider',color=sns.color_palette()[2]);\nplt.title('Year wise distribution');\nplt.xlabel('Year')\nplt.ylabel('Counts')\nfor i in range(df1.shape[0]):\n    count=df1.iloc[i]['affiliate_provider']\n    strt='{:0.2f}%'.format(100*count\/df_all.shape[0])\n    plt.text(i,count+1000,strt,ha='center')","952868dd":"# Creating a month centered dataframe for 2014\ndf2 = df_all[df_all['date_account_created'].dt.year==2014]\ndf2['monthYear14'] = df2['date_account_created'].map(lambda x: x.strftime('%m-%Y'))\ndf2 = df2.groupby('monthYear14').count()","98c2d73c":"#Number of accounts created in different month of 2014\n\nplt.figure(figsize=[14,8])\nsns.barplot(data=df2,x=df2.index,y='affiliate_provider',color=sns.color_palette()[3]);\nplt.title('2014 month wise distribution');\nplt.xlabel('Month-Year')\nplt.ylabel('Counts')\nfor i in range(df2.shape[0]):\n    count=df2.iloc[i]['affiliate_provider']\n    strt='{:0.2f}%'.format(100*count\/df_all.shape[0])\n    plt.text(i,count+100,strt,ha='center')","f9909dda":"#Dividing member ages into various bins\n\ndf_all['member_age_bins']=df_all['age'].apply(lambda x: '18 - 20' if 18<x<=20\n                                                  else '20 - 30' if 20<x<=30\n                                                  else '30 - 40' if 30<x<=40\n                                                  else '40 - 50' if 40<x<=50\n                                                  else '50 - 60' if 50<x<=60\n                                                  else '60-70' if 60<x<=70\n                                                  else '70+' if 70<x<=100\n                                                  else np.nan)","18421576":"df_all.head()","993000d4":"# Creating a month centered dataframe for 2014\n\ndf3 = df_all[df_all['date_account_created'].dt.year==2013]\ndf3['monthYear13'] = df3['date_account_created'].map(lambda x: x.strftime('%m-%Y'))\ndf3 = df3.groupby('monthYear13').count()","78da07eb":"#Number of accounts created in different month of 2014\n\nplt.figure(figsize=[14,8])\nsns.barplot(data=df3,x=df3.index,y='affiliate_provider',color=sns.color_palette()[4]);\nplt.title('2013 month wise distribution');\nplt.xlabel('Month-Year')\nplt.ylabel('Counts')\nfor i in range(df3.shape[0]):\n    count=df3.iloc[i]['affiliate_provider']\n    strt='{:0.2f}%'.format(100*count\/df_all.shape[0])\n    plt.text(i,count+100,strt,ha='center')","f2f54cba":"#Plotting Age distribution of the members\nplt.figure(figsize=[14,8])\nsns.distplot(df_all.age.dropna(),bins=np.arange(18,100+5,5),color=sns.color_palette()[5],kde=False);\nplt.xlabel('Age of members')\nplt.ylabel('Count')\nplt.title('Age distribution of Users')\nplt.xlim(18,100);","8d8aca16":"#Destination-Age distribution plot\n\nplt.figure(figsize=[14,8])\nsns.boxplot(data=df_train,y='age',x='country_destination',color=sns.color_palette()[6]);\nplt.ylim(18,100)\nplt.xlabel('Country');\nplt.ylabel('Age');\nplt.title('Country-Age Distribution');","60312bd7":"#Gender-Age Distribution plot\n\nplt.figure(figsize=[14,8])\nsns.boxplot(data=df_all,y='age',x='gender',color=sns.color_palette()[7]);\nplt.ylim(18,100)\nplt.xlabel('Gender');\nplt.ylabel('Age');\nplt.title('Gender-Age Distribution');","b1942f27":"#Gender-Destination Distribution Plot\n\nplt.figure(figsize=(14,8))\norder1 = df_train['country_destination'].value_counts().index\nsns.countplot(data = df_train, x = 'country_destination', order = order1,hue='gender')\nplt.xlabel('Destination')\nplt.ylabel('Count')\nplt.title('Gender-Destination Distribution')\norder2 = df_train['country_destination'].value_counts()","3dc86c5e":"df3 = df_all[df_all['date_account_created'].dt.year==2013]\ndf3['monthYear13'] = df3['date_account_created'].map(lambda x: x.strftime('%m-%Y'))\n\ndf3= df3.groupby(['monthYear13','member_age_bins']).count()\n\ndf3.reset_index(inplace=True)","842cad0a":"#Age wise distribution of the booking in different months of 2013\n\nplt.figure(figsize=[14,8])\nsns.pointplot(data=df3,x='monthYear13',y='affiliate_provider',hue='member_age_bins');\nplt.title('2013 month-age wise distribution');\nplt.xlabel('Month-Year')\nplt.ylabel('Counts')","e675a787":"df3 = df_all[df_all['date_account_created'].dt.year==2013]\ndf3['monthYear13'] = df3['date_account_created'].map(lambda x: x.strftime('%m-%Y'))\n\ndf3= df3.groupby(['monthYear13','gender']).count()\n\ndf3.reset_index(inplace=True)","3da0fd47":"#Gender wise distribution of the booking in different months of 2013\n\nplt.figure(figsize=[14,8])\nsns.pointplot(data=df3,x='monthYear13',y='affiliate_provider',hue='gender');\nplt.title('2013 month-gender wise distribution');\nplt.xlabel('Month-Year')\nplt.ylabel('Counts')","02c62933":"#Relation ship between age-gender-destination\n\nplt.figure(figsize=[14,8])\nsns.boxplot(data=df_train,y='age',x='country_destination',hue='gender');\nplt.ylim(18,100)\nplt.xlabel('Country');\nplt.ylabel('Age');\nplt.title('Country-Age Distribution');","315b430d":"df_train = df_train.drop(['country_destination'], axis=1)","d7a0ae4a":"dfWork = pd.concat((df_train, df_test), axis=0, ignore_index=True)\ndfWork = dfWork.drop(['id', 'date_first_booking'], axis=1)\n#Filling nan\ndfWork = dfWork.fillna(-1)\n","be38e4cf":"#date_account_created\n\ndac = np.vstack(dfWork.date_account_created.astype(str).apply(lambda x: list(map(int, x.split('-')))).values)\ndfWork['dac_year'] = dac[:,0]\ndfWork['dac_month'] = dac[:,1]\ndfWork['dac_day'] = dac[:,2]\ndfWork = dfWork.drop(['date_account_created'], axis=1)","46957923":"#timestamp_first_active\n\ntfa = np.vstack(dfWork.timestamp_first_active.astype(str).apply(lambda x: list(map(int, [x[:4],x[4:6],x[6:8],x[8:10],x[10:12],x[12:14]]))).values)\ndfWork['tfa_year'] = tfa[:,0]\ndfWork['tfa_month'] = tfa[:,1]\ndfWork['tfa_day'] = tfa[:,2]\ndfWork = dfWork.drop(['timestamp_first_active'], axis=1)","7fe72d10":"av = dfWork.age.values\ndfWork['age'] = np.where(np.logical_or(av<14, av>100), -1, av)","be1ef2a6":"#One-hot-encoding features\nohe_feats = ['gender', 'signup_method', 'signup_flow', 'language', 'affiliate_channel',\n             'affiliate_provider', 'first_affiliate_tracked', 'signup_app', 'first_device_type', 'first_browser']\nfor f in ohe_feats:\n    dfWork_dummy = pd.get_dummies(dfWork[f], prefix=f)\n    dfWork = dfWork.drop([f], axis=1)\n    dfWork = pd.concat((dfWork, dfWork_dummy), axis=1)","6a14c42b":"#Splitting train and test\nvals = dfWork.values\nX = vals[:df_train.shape[0]]\nle = LabelEncoder()\ny = le.fit_transform(labels)   \nX_test = vals[df_train.shape[0]:]","6b81e37f":"#Classifier\nxgb = XGBClassifier(max_depth=6, learning_rate=0.3, n_estimators=25,\n                    objective='multi:softprob', subsample=0.5, colsample_bytree=0.5, seed=0)                  \nxgb.fit(X, y)","bbde6159":"#Prediction\ny_pred = xgb.predict_proba(X_test)","0f9cf784":"#Taking the 5 classes with highest probabilities\nids = []  #list of ids\ncts = []  #list of countries\nfor i in range(len(id_test)):\n    idx = id_test[i]\n    ids += [idx] * 5\n    cts += le.inverse_transform(np.argsort(y_pred[i])[::-1])[:5].tolist()","976017d9":"#Generate submission\nsub = pd.DataFrame(np.column_stack((ids, cts)), columns=['id', 'country'])\nsub.to_csv('sub.csv',index=False)","a34ba44b":"#### Univariate plots","59826962":"#### Multivariate Plot","e118d815":"# Visualizations","73e7d077":"### Feature Engineering","361f4286":"### One hot Encoding","3823e7b8":"#### Bivariate Plots","30dde89b":"# Computation for the Booking Destination"}}