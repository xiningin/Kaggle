{"cell_type":{"4c12b7aa":"code","414d9867":"code","50778f50":"code","9be673a9":"code","e769909a":"code","a3b56f11":"code","fad5d37b":"code","e03a9cc4":"code","3c3f79d7":"code","646ced93":"code","8d5dc36c":"code","462e7a41":"code","1d223fbe":"code","9e4af125":"code","bd3e6efc":"code","538c089b":"code","6a8df11c":"code","acb9f351":"code","89e92bb4":"markdown","345909d3":"markdown","53da1db8":"markdown","38d62811":"markdown","52724237":"markdown","77ea2fde":"markdown","8b4545bb":"markdown","daea76c3":"markdown","e1138bea":"markdown"},"source":{"4c12b7aa":"import numpy as np\nimport pandas as pd\n\nfrom fastai.basics import *\nfrom fastai.callback.all import *\nfrom fastai.vision.all import *\nfrom fastai.medical.imaging import *\nimport pydicom","414d9867":"train_image_path = \"..\/input\/siim-covid19-detection\/train_image_level.csv\"\nsample_sub_path = \"..\/input\/siim-covid19-detection\/sample_submission.csv\"\ntrain_study_path = \"..\/input\/siim-covid19-detection\/train_study_level.csv\"\nprint (\"__study level csv__\")\ntrain_study_level = pd.read_csv(train_study_path)\nprint (train_study_level.head())\n\nprint (\"__sample submission__\")\nsample_sub = pd.read_csv(sample_sub_path)\nprint (sample_sub.head())\n\nprint (\"__train level csv__\")\ntrain_image_level = pd.read_csv(train_image_path)\nprint (train_image_level.head())","50778f50":"#rename the column to merge the dataframes\ntrain_study_level.rename(columns = {'id': 'StudyInstanceUID'}, inplace =True)\ntrain_study_level[:1]","9be673a9":"#remove the _study in 'StudyInstanceUID'\ntrain_study_level['StudyInstanceUID'] = train_study_level['StudyInstanceUID'].str.strip('_study')\ntrain_study_level[:5]","e769909a":"#merging the two dataframes\ntrain_df = train_image_level.merge(train_study_level)\ntrain_df[:1]","a3b56f11":"train_df['id'] = train_df['id'].str.strip('_image')\ntrain_df.loc[train_df['Negative for Pneumonia']==1, 'class_y'] = 'Negative'\ntrain_df.loc[train_df['Typical Appearance']==1, 'class_y'] = 'Typical'\ntrain_df.loc[train_df['Indeterminate Appearance']==1, 'class_y'] = 'Indeterminate'\ntrain_df.loc[train_df['Atypical Appearance']==1, 'class_y'] = 'Atypical'\ntrain_df.drop(['boxes', 'Negative for Pneumonia', 'Typical Appearance', \n             'Indeterminate Appearance', 'Atypical Appearance', 'StudyInstanceUID'], axis=1, inplace=True)\ntrain_df[:5]","fad5d37b":"train_df.class_y.value_counts()","e03a9cc4":"#identifying number of boxes\nnum_of_boxes = []\nfor i in train_df.index:\n    label_len = len(train_df.label[i].split(' '))\n    num_box = label_len\/\/6\n    num_of_boxes.append(num_box)","3c3f79d7":"train_df['num_of_boxes'] = num_of_boxes\ntrain_df.head() ","646ced93":"train_df.num_of_boxes.value_counts()","8d5dc36c":"\nlabel_COORD = []\nfor i in train_df.index:\n    num_of_boxes = train_df.num_of_boxes[i]\n    val = train_df.label[i].split(' ')\n    if num_of_boxes == 1 : coord = val[2:6]\n    if num_of_boxes == 2 : coord = val[2:6] + val [8:12]\n    if num_of_boxes == 3 : coord = val[2:6] + val [8:12] + val [14:18]\n    if num_of_boxes == 4 : coord = val[2:6] + val [8:12] + val [14:18] + val[20:24]\n    if num_of_boxes == 5 : coord = val[2:6] + val [8:12] + val [14:18] + val[20:24] + val[26:30]\n    label_COORD.append(coord)\n     ","462e7a41":"train_df['label_COORD'] = label_COORD\ndel train_df['label']\ntrain_df.head()","1d223fbe":"train_df.rename(columns = {'id':'SOPInstanceUID'},inplace = True)\ntrain_df[:1]","9e4af125":"dicom_df = pd.read_pickle('..\/input\/visualizing-dicoms\/dicoms_df.pkl')\ndicom_df.head()","bd3e6efc":"dicom_merge = pd.merge(dicom_df,train_df, on = 'SOPInstanceUID')\ndicom_merge[:1]","538c089b":"dicom_merge['fname'][100]","6a8df11c":"dicom_merge['SOPInstanceUID'][100]","acb9f351":"dicom_merge.to_csv('dicom_merge.csv', index = False)","89e92bb4":"[We then load the DICOM metadata that we have obtained](https:\/\/www.kaggle.com\/slimshadymm\/visualizing-dicoms) ","345909d3":"# 2 WORKING ON DATAFRAMES","53da1db8":"# 0 IMPORT","38d62811":"We then clean up the dataframe. We drop a few columns and make a single column as class label. We also drop `boxes` since we can use `label` to obtain coordinates for binding boxes.","52724237":"Save the dataframe as `.csv` file. Before that, we check that the file path `fname` corresponds to the correct `SOPINstanceUID`","77ea2fde":"Rename the column `id` to `SOPInstanceUID` to merge the dataframe with meta data","8b4545bb":"# 1 LOADING THE DATASET","daea76c3":"# 3 LOADING THE META DATA","e1138bea":"Now we extract co-ordinates of the binding boxes from `label`"}}