{"cell_type":{"957828ad":"code","178150b7":"code","677f3a81":"code","7697e43a":"code","b9626dd4":"code","82ae9f03":"code","25f12437":"code","f8eded3a":"code","38621099":"code","189812de":"code","5784dd58":"code","d30d4ac8":"code","79e47bf7":"code","a0a0aac9":"code","8cb89fb7":"code","f7c91922":"code","ec80a836":"code","937379a2":"code","160d626c":"code","9accb268":"code","0a82b2af":"code","fe701db4":"code","01bb1489":"code","d42f140d":"code","581ce9d0":"code","34eccc66":"code","b35e687e":"code","5b1b922e":"code","e1ec423a":"code","f652bb22":"code","f1c725fc":"code","82a6f5d8":"code","9d554492":"code","351e5ba9":"code","ad12d28f":"code","389855ed":"code","04d99ea8":"code","b4496a7f":"code","46873bfd":"code","485aa2d3":"markdown","c8f47591":"markdown","68c8c0ae":"markdown","3a8848a0":"markdown","440701bd":"markdown","7d0367f9":"markdown","fb9ab389":"markdown","f24ee582":"markdown","cea0df60":"markdown","4e6b77ec":"markdown","f5bb347d":"markdown","9b5f57e8":"markdown","3a9c5435":"markdown","fb4e0d2b":"markdown","0f54dbab":"markdown","772aa1a9":"markdown","01416e6d":"markdown"},"source":{"957828ad":"# import packages\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport datetime as dt\n\n%matplotlib inline","178150b7":"# load data\ndf=pd.read_csv('..\/input\/renfe.csv')\ndf.head(1)","677f3a81":"df.info()","7697e43a":"df.shape","b9626dd4":"# handling missing data\n# check missing data rows\nsum(df.isna().any(axis=1))","82ae9f03":"# check columns with missing data\ndf.isna().any(axis=0)","25f12437":"# View rows with missing data\ndf[df.isna().any(axis=1)].tail(10)","f8eded3a":"# Drop rows with missing value\ndf.dropna(inplace=True)\nsum(df.isna().any(axis=1))","38621099":"# change data types\ndf['insert_date']=pd.to_datetime(df['insert_date'])\ndf['start_date'] =pd.to_datetime(df['start_date'])\ndf['end_date']=pd.to_datetime(df['end_date'])","189812de":"# create new columns\ndf['duration']=df['end_date']-df['start_date']\ndf['duration_mins']=df['duration']\/np.timedelta64(1, 'm')\ndf['start_time']=df['start_date'].dt.time\ndf.head(1)","5784dd58":"#drop unwanted columns\ndf.drop(['insert_date'],axis=1,inplace=True)","d30d4ac8":"# histgram of price \ndf['price'].hist()","79e47bf7":"# histgram of duration\ndf['duration_mins'].hist()","a0a0aac9":"# plot train type\ndf['train_type'].value_counts().plot.bar()","8cb89fb7":"# plot train class\ndf['train_class'].value_counts().plot.bar()","f7c91922":"# plot fare\ndf['fare'].value_counts().plot.bar()","ec80a836":"df.groupby(by=['origin','destination'])['duration','duration_mins','price'].agg({'count','mean'})","937379a2":"#calc total counts and revenue by orgin, destination,and train class\ndf_mjr=df.groupby(by=['origin','destination','train_type','train_class'])['price'].agg({'count',('sum',lambda x: x.astype(float).sum())}).reset_index()\ndf_mjr.head(10)","160d626c":"df_mjr['count_per']=df_mjr['count']\/sum(df_mjr['count'])\ndf_mjr['sum_per']=df_mjr['sum']\/sum(df_mjr['sum'])","9accb268":"df_mjr.sort_values('count_per',ascending=False, inplace=True)","0a82b2af":"df_mjr['origin_destination']=df_mjr['origin']+\"-\"+df_mjr['destination']\ndf_mjr.set_index('origin_destination',inplace=True)\ndf_mjr.head(6).sum()","fe701db4":"df_mjr.head(6).plot(kind='pie',y='count_per',legend=False)","01bb1489":"df_mjr.head(6).plot(kind='pie',y='sum_per',legend=False)","d42f140d":"#create dataset for trips between Barcelona and Mardrid only\ndf_bm=df.query('origin in (\"BARCELONA\",\"MADRID\") and destination in (\"BARCELONA\",\"MADRID\")')\ndf_bm.head(1)","581ce9d0":"# boxplot price groupped by train class and fare\ndf_bm.boxplot(column=['price','duration_mins'],by=['train_class','fare'],rot=45,layout=(2, 1),figsize=(10,9))","34eccc66":"# group data by origin, destination, train class, and fare\n# since most travllers travel between Madrid and Barcelona, the investigation will focus on Barcelona and Madrid \ndf_app=df_bm.groupby(by=['origin','destination','train_type','train_class','fare','duration_mins'])['price'].describe().reset_index()\ndf_app.head(6)","b35e687e":"# view info in order\ndf_app.sort_values(['mean']).head(2)","5b1b922e":"# investigate fixed price and non-fixed price\n# fixed price \ndf_app_fixed=df_app[df_app['std'] == 0]\ndf_app_fixed.sort_values(['min','origin'])","e1ec423a":"#boxplot fixed travel packages groupped by train class and fare\ndf_app_fixed.boxplot(column=['mean','duration_mins'],by=['train_class','fare'],rot=45,layout=(3, 1),figsize=(10,9))","f652bb22":"# investigate if there is travel time restrictions.\ndf_fixed_cheapest=df_bm.query('train_class==\"Turista\" and fare==\"Adulto ida\"')\ndf_fixed_cheapest.head(1)","f1c725fc":"# check available travel time\ndf_fixed_cheapest['start_time'].unique()","82a6f5d8":"# non-fixed price\ndf_app_vary=df_app[df_app['std'] != 0]\ndf_app_vary.sort_values(['std','min'],ascending=True).head(4)","9d554492":"# investigate non-fixed trips\ndf_app_vary.sort_values(by='min',ascending=True).head(2)","351e5ba9":"# plot non-fixed trips\ndf_app_vary.boxplot(column=['mean','duration_mins'],by=['train_class','fare'],rot=45,layout=(3, 1),figsize=(10,9))","ad12d28f":"# merge two dataset to get travel start time.\ndf_bm_vary=pd.merge(df_bm,df_app_vary, how='left',on=['origin','destination','train_type','train_class','fare','duration_mins'])\ndf_bm_vary.head(1)","389855ed":"# find out available travel time\ndf_bm_tp=df_bm_vary.query('train_class ==\"Turista\" and fare==\"Promo\"')\ndf_bm_tp.head(5)\n","04d99ea8":"# convert start_time data type to time\ndf_bm_tp['start_time'].astype(dt.datetime, inplace=True)\ndf_bm_tp.head(1)","b4496a7f":"# plot average price by start time\ndf_bm_tp.groupby('start_time')['price'].mean().plot.line()","46873bfd":"# plot average price by start time\ndf_bm_tp.groupby('start_time')['price'].count().plot.line()","485aa2d3":"### Question 2: Which route is the key revenue contributor?","c8f47591":"### Observations\n- Two typs of ticket price to travel between BARCELONA and MADRID: fixed and non-fixed.\n- If a traveller is risk-averse and wish to travel at lowest cost, the traveller can choose Turista + Adulto ida package at 43.25 Euro per trip. however, the travller need to sacrifice time and spend longest hours on trip, which is more than 562.0 minutes.\n- Overall, if the travelelr prefer fixed price, Turista class on Adulto ida package provides the lowest price but longest hours to travel, which is 43.25 Euro and selected by majority travellers.","68c8c0ae":"### Conclusion\n- The most popular travel route is the between Madrid and Barcelona. \n- There are two types of tickets available to travel:  fixed price ticket, and non-fixed price ticket.\n- If a travel is risk averse and prefer fixed price ticket, there are four options to choose from. The most cost-saving approach(Turista, Adulto ida) takes longest travel time, that is nearly 3 times of normal travel time. Besides, this approach has constraints, traveller can only take trains start at 7:15am and 9:30am.\n- If a travel prefer non-fixed price ticket. The (Turista, Poromo) package offers overall better price. If traveler\u2019s schedule is flexible, he\/she can choose non-peak hours to enjoy the lowest price.\n\n\n\n\n","3a8848a0":"## Introduction\n\n> The data source of this project is from [Kaggle](https:\/\/www.kaggle.com\/thegurus\/spanish-high-speed-rail-system-ticket-pricing). The project will explore various approaches to travel from most popular routes, and recommend the best cost-saving approach for travellers.","440701bd":"### Obeservations\n- The combination of (Turista,Adulto ida) provides the loweset and fixed price, yet, this option also takes longest travel time.\n- Some combination provided fixed price, while some provides non-fixed price.","7d0367f9":"### Observations\n\n- The ticket price of (Turista,Poromo) package depends on train start time, during morning and afternoon peak hours, the price goes up, while during non-peak hours, price goes down.","fb9ab389":"### Observations\n- 58.2% travellers travel among three cities: MADRID,BARCELONA,and SEVILLA taking AVE train and Turista class.This group of travellers also contributes highest revenue, which is 61% of total.\n- However, travellers between MADRID and BARCELONA contribute relatively higher revenue per trip than others.","f24ee582":"### Question 1: Where marjority travellers go? ","cea0df60":"### Data Wragling","4e6b77ec":"### Observations: \n\nThere is restrictions to use Turista + Adulto ida package, traveller can only use it on 9:30 and 7:15.","f5bb347d":"## Exploratary Analysis","9b5f57e8":"### Obeservations\n- MADRID,Spain's central capital, has the biggest inbound and outbound trafic volume.\n- The volume and ticket price of trips between BARCELONA and MADRID are highest among others.","3a9c5435":"### Question 3: Which is the most cost-saving approach to travel between Madrid and Barcelona?","fb4e0d2b":"### Observations\n- for non-fixed price options, trips usually take about 180 mins, that is 3 hours. The time difference is negligible.\n- (Turista,Poromo) package offers overall better price","0f54dbab":"### Question 4: Is there any travel time restrictions to use Turista class on Adulto ida package?","772aa1a9":"# Spanish High Speed Rail Tickets Pricing Analytics\n\n\nCreated by Venessa M Yuhong on 13-Jun-2019.\n\n\n## Table of Contents\n<ul>\n<li><a href=\"#intro\">Introduction<\/a><\/li>\n<li><a href=\"#wrangling\">Data Wrangling<\/a><\/li>\n<li><a href=\"#eda\">Exploratory Data Analysis<\/a><\/li>\n<li><a href=\"#conclusions\">Conclusions<\/a><\/li>\n<\/ul>\n","01416e6d":"### Question 5: What if traveller prefer non-fixed package? which one is the most cost-saving way?"}}