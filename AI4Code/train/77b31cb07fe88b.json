{"cell_type":{"2fe87b79":"code","fa750bdc":"code","385a93ba":"code","56938fe7":"code","c8acdc1a":"code","6c7ab2bb":"code","af074efc":"code","b1ca4c43":"code","c58da4af":"code","1a199c97":"code","be620da7":"code","25a16d65":"markdown","97086744":"markdown","31dfc1fd":"markdown","fd2bbaab":"markdown","661d44fa":"markdown","01940189":"markdown"},"source":{"2fe87b79":"from google.cloud import bigquery\nimport numpy as np\nimport pandas as pd","fa750bdc":"client = bigquery.Client()\ndataset_ref = client.dataset(\"chicago_taxi_trips\", project=\"bigquery-public-data\")\ntaxi_dat = client.get_dataset(dataset_ref)","385a93ba":"tables = list(client.list_tables(taxi_dat))\nfor table in tables:\n    print(table.table_id)","56938fe7":"table_ref = dataset_ref.table('taxi_trips')\ntable = client.get_table(table_ref)\ntable.schema","c8acdc1a":"## First to see how many payment methods there are total\npreliminary_query =\"\"\"\nSELECT DISTINCT payment_type\nFROM `bigquery-public-data.chicago_taxi_trips.taxi_trips`\n\"\"\" \n\nsafe_config = bigquery.QueryJobConfig(maximum_bytes_billed=10**10)\npreliminary_query_job =client.query(preliminary_query,job_config=safe_config)\npreliminary_query_result = preliminary_query_job.to_dataframe()\npreliminary_query_result.head(10)\n","6c7ab2bb":"query =\"\"\"\nSELECT payment_type, COUNT(1) AS transactions\nFROM `bigquery-public-data.chicago_taxi_trips.taxi_trips`\nGROUP BY payment_type\nORDER BY transactions DESC\n\"\"\" \n\nsafe_config = bigquery.QueryJobConfig(maximum_bytes_billed=10**10)\nquery_job =client.query(query,job_config=safe_config)\nquery_result = query_job.to_dataframe()\nquery_result.head(10)","af074efc":"query =\"\"\"\nSELECT payment_type, COUNT(1) AS transactions\nFROM `bigquery-public-data.chicago_taxi_trips.taxi_trips`\nWHERE payment_type = 'Credit Card' OR payment_type = 'Cash'\nGROUP BY payment_type\nORDER BY transactions DESC\n\"\"\" \n\nsafe_config = bigquery.QueryJobConfig(maximum_bytes_billed=10**10)\nquery_job =client.query(query,job_config=safe_config)\nquery_result = query_job.to_dataframe()\nquery_result.head(10)","b1ca4c43":"import matplotlib.pyplot as plt\nimport seaborn as sns\nplt.subplots(figsize=(12, 2))\nsns.barplot(x=query_result['transactions'],y=query_result['payment_type'], palette='Blues_r')\n#generating the graph pictured above","c58da4af":"query =\"\"\"\nSELECT EXTRACT(YEAR FROM trip_start_timestamp) AS year, payment_type, COUNT(1) AS transactions\nFROM `bigquery-public-data.chicago_taxi_trips.taxi_trips`\nWHERE payment_type = 'Credit Card' OR payment_type = 'Cash'\nGROUP BY year, payment_type\nORDER BY year, transactions DESC\n\"\"\" \n\nsafe_config = bigquery.QueryJobConfig(maximum_bytes_billed=10**10)\nquery_job =client.query(query,job_config=safe_config)\nquery_result = query_job.to_dataframe()\nquery_result.head(10)","1a199c97":"years = [2013,2014,2015,2016,2017,2018,2019,2020]\nind = 0\ncash = []\ncc = []\nfor num in query_result.transactions:\n    if ind % 2 == 0:\n        cash = cash + [num]\n        ind += 1\n    else:\n        cc = cc + [num]\n        ind += 1\ncash = pd.Series(cash, index=years, name='Cash')\ncash = pd.DataFrame(cash, index=cash.index)\ncc = pd.Series(cc, index=years, name='Credit_Card')\ncc = pd.DataFrame(cc, index=cash.index)\n\n#The irony of using python for a join when I initially chose this project to practice SQL is not lost on me\npay_df = pd.merge(cash, cc, left_index=True, right_index=True)\npay_df","be620da7":"plt.subplots(figsize=(10, 8))\nsns.lineplot(data=pay_df, palette=\"Blues_r\", linewidth=3.5)\n","25a16d65":"# Initial findings:\nI was not expecting there to be so many different payment methods used. Though it would appear that cash and credit card are used in about 99.9% of all transactions. Next I want to graph card\/cash usage over time. The horizontal bar graph above answers the question sufficiently, however I've answered the last 3 tasks with horizontal bar charts so I want to try something else.","97086744":"# Final Thoughts:\nFor the graph above the report was run in January 2020 so there hasn't been much activity recorded yet. There is a downward trend, but not as extreme as this graph would imply.\n\nI find it interesting that cash has had such a large role in the business model of taxi services. While I didn't look at what the totals were, it might be interesting to see if there is a signifigant delta in the average fare for the two catagories. \n\nIt also raises an interesting idea: is the payment method the cause of success of ridesharing services of Uber\/Lyft based on the level of purchase friction. Purchase friction is the psycological burden of closing a transaction, for payment methods cash has the highest friction whereas credit cards\/mobile pay is the lowest mobile pay has a fast and simple process time and you never handle the money that you give over. For an example of this in action just lookup the average cart comparison between payment methods, for vending machines the difference is about a 33% difference is average amount spent when comparing cash to cards. ","31dfc1fd":"Looking above, what I really want is a table where the years are the index and cash and credit card are the two columns.\n\nI like to believe that one day I will return to this notebook and add the correct query to magically generate that table. But for now in stead I will create that table with python instead.","fd2bbaab":"I'm always up to constructive feedback, feel free to comment this article or message me directly. If you would like to collaborate on a future weekly task let me know.\n\nFor past examples of my kaggle tasks view my profile or you can also view them on github at: https:\/\/github.com\/Neil-Kloper\/Weekly-Kaggle-Task","661d44fa":"![week_4_task_head.png](attachment:week_4_task_head.png)\n\nAs we can see above, cash is king for the taxi service. See below for the details on how I generated this graph and what other findings I came across","01940189":"This kernal is for the \"Mode of payment usually used\" Task. Like the previous task I did. \n\nPart 1 of this notebook addressed the other challenge regaurding the most popular taxi company https:\/\/www.kaggle.com\/schorsi\/chicago-taxi-tasks-part-1. I'm currently in week four of my personal challenge to compete one Kaggle task a week.\n\nThanks to:\n   * The city of Chicago for the dataset https:\/\/www.kaggle.com\/chicago\/chicago-taxi-trips-bq\n   * Tinotenda for the Task https:\/\/www.kaggle.com\/tinotendamhlanga"}}