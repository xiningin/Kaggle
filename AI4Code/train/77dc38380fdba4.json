{"cell_type":{"be195ff1":"code","ceddf39f":"code","ab190642":"code","254a10dd":"code","74076b7c":"code","02741e29":"code","35ebdb29":"code","87269fb3":"code","250c1a46":"code","46e6d8d9":"code","02645802":"code","a882a68b":"code","c9c1eefe":"code","3436596c":"code","e23a3e24":"code","0e01980d":"code","33baf54f":"code","6b1cbe37":"code","e2cfa46c":"code","81536d3d":"code","8b3b155e":"code","cb8fa93b":"code","7f430d3a":"code","8dfebfb6":"code","adbff0fd":"code","dfc51c8b":"code","f2a6056c":"code","180efd8c":"code","2133961a":"code","4b4c52d0":"code","b8fdf093":"code","af41adf6":"code","d9057d70":"code","e0cec7bd":"code","69482f64":"code","209f2f91":"code","771470df":"code","dea69d89":"code","d0a637da":"code","df9d6b60":"code","53e76d76":"code","6959a96e":"code","aaafb084":"code","d3c32d5e":"code","44521deb":"code","4fb55bb7":"code","65292f81":"code","39773588":"code","def05e5c":"code","baa358e2":"code","4ad803ed":"code","a658c6c3":"code","674ba6a1":"code","0d31dc06":"code","50d92350":"code","9227da35":"code","4de5da3e":"code","9c157453":"code","7bd62d49":"code","fbef70bb":"code","bb85bf8a":"code","1918652d":"code","0705186b":"code","3d3fcad4":"code","a44c83ed":"code","80b538a6":"code","5c0d78e7":"code","f5cd8505":"code","4cc3aae6":"markdown","aa0db144":"markdown","f6a92848":"markdown","8cca3fe1":"markdown","582a089e":"markdown","37218941":"markdown","b0301c12":"markdown","12b0dd72":"markdown","1f65e688":"markdown","453593ba":"markdown","1784f8d4":"markdown","49d17cf5":"markdown","8038a1e1":"markdown","e134729a":"markdown","a1809f90":"markdown","3df02d5d":"markdown","ffb6639b":"markdown","51c23f6a":"markdown","efdbc15d":"markdown"},"source":{"be195ff1":"%reload_ext autoreload\n%autoreload 2\n%matplotlib inline","ceddf39f":"from fastai import *\nfrom fastai.text import *","ab190642":"# bs=48\n# bs=24\nbs=192","254a10dd":"torch.cuda.set_device(0)","74076b7c":"import pandas as pd","02741e29":"%%capture\ntrain = pd.read_csv('..\/input\/fakenewsvortexbsb\/train_df.csv', sep=';');","35ebdb29":"train.head()","87269fb3":"train.shape","250c1a46":"train.groupby('Class').count()","46e6d8d9":"train = train.rename(columns={'Class': 'label', 'manchete': 'text'})","02645802":"del train['index']","a882a68b":"import os\npath = os.getcwd()","c9c1eefe":"%%capture\ntrain2 = pd.read_csv('..\/input\/news-of-the-site-folhauol\/articles.csv');","3436596c":"train2.head(10)","e23a3e24":"train2.groupby('category').count()","0e01980d":"train2 = train2.loc[train2['category'].isin(['poder','mundo','mercado'])].reset_index(drop=True)","33baf54f":"train2.head(10)","6b1cbe37":"train2.shape","e2cfa46c":"del train2['text']\ndel train2['date']\ndel train2['subcategory']\ndel train2['link']\ndel train2['category']","81536d3d":"train2 = train2.dropna()","8b3b155e":"from sklearn.model_selection import train_test_split\ntrain_ml, test_ml = train_test_split( train2, test_size=0.10, random_state=42)","cb8fa93b":"data_lm = TextLMDataBunch.from_df('.\/', train_df=train_ml, valid_df=test_ml, text_cols=0)","7f430d3a":"from sklearn.model_selection import train_test_split\ntrain_c, test_c = train_test_split( train, test_size=0.25, random_state=42)","8dfebfb6":"%%capture\nvalid = pd.read_csv('..\/input\/fakenewsvortexbsb\/sample_submission.csv', sep=';');","adbff0fd":"valid.head()","dfc51c8b":"index = valid['index']","f2a6056c":"valid.shape","180efd8c":"valid = valid.rename(columns={ 'Manchete': 'text'})\ndel valid['index']\nvalid= valid.dropna()","2133961a":"train_c.head()","4b4c52d0":"test_c.head()","b8fdf093":"valid.head()","af41adf6":"data_clas = TextDataBunch.from_df('.\/', train_df=train_c , valid_df=test_c , test_df=valid, vocab=data_lm.train_ds.vocab, bs=32, text_cols=0, label_cols=1)","d9057d70":"data_lm.vocab.itos[:10]","e0cec7bd":"data_lm.train_ds[0][0]","69482f64":"data_lm.train_ds[0][0].data[:10]","209f2f91":"data_lm.show_batch()","771470df":"data_clas.show_batch()","dea69d89":"len(data_lm.vocab.itos),len(data_lm.train_ds)","d0a637da":"learn_lm = language_model_learner(data_lm, AWD_LSTM, drop_mult=0.3)","df9d6b60":"learn_lm.lr_find()","53e76d76":"learn_lm.recorder.plot(skip_end=15)","6959a96e":"lr = 1e-3\nlr *= bs\/48","aaafb084":"learn_lm.to_fp16();","d3c32d5e":"learn_lm.fit_one_cycle(10, lr*10, moms=(0.8,0.7))","44521deb":"learn_lm.save('fit_1')","4fb55bb7":"learn_lm.unfreeze()","65292f81":"learn_lm.fit_one_cycle(10, lr, moms=(0.8,0.7))","39773588":"learn_lm.save('fine_tuned')","def05e5c":"learn_lm.save_encoder('fine_tuned_enc')","baa358e2":"enc = learn_lm.model[0].encoder","4ad803ed":"TEXT = \"Bolsonaro\"\nN_WORDS = 10\nN_SENTENCES = 2","a658c6c3":"print(\"\\n\".join(learn_lm.predict(TEXT, N_WORDS, temperature=0.75) for _ in range(N_SENTENCES)))","674ba6a1":"bs=48","0d31dc06":"learn_c = text_classifier_learner(data_clas, AWD_LSTM, drop_mult=0.3).to_fp16()\nlearn_c.load_encoder('fine_tuned_enc')\nlearn_c.freeze()","50d92350":"learn_c.lr_find()","9227da35":"learn_c.recorder.plot()","4de5da3e":"learn_c.fit_one_cycle(1, 1e-3, moms=(0.8,0.7))","9c157453":"learn_c.save('first')","7bd62d49":"learn_c.freeze_to(-2)\nlearn_c.fit_one_cycle(10, 1e-3, moms=(0.8,0.7))","fbef70bb":"preds, targets = learn_c.get_preds(ds_type=DatasetType.Valid)\n\npredictions = np.argmax(preds, axis = 1)\npd.crosstab(predictions, targets)","bb85bf8a":"from sklearn.metrics import accuracy_score, classification_report\naccuracy_score(predictions, targets)","1918652d":"print (classification_report(predictions, targets))","0705186b":"preds, targets = learn_c.get_preds(ds_type=DatasetType.Test, ordered=True)\n\npredictions = np.argmax(preds, axis = 1)\npd.crosstab(predictions, targets)","3d3fcad4":"preds, _ = learn_c.get_preds(ds_type=DatasetType.Test, ordered=True)\npred_prob, pred_class = preds.max(1)","a44c83ed":"pred_class","80b538a6":"minha_sub = pd.DataFrame({'index':index,'Category':pred_class})","5c0d78e7":"minha_sub","f5cd8505":"minha_sub.to_csv('submission.csv', index=False)","4cc3aae6":"# Modelos de Lingagem e Classifca\u00e7\u00e3o de textos de Fake News","aa0db144":"Uma importante parte do modelo de linguagem \u00e9 codificador para as entradas desse modelo, portanto para inferir novas informa\u00e7\u00f5es \u00e9 preciso ter esse Encoder logo abaixo.","f6a92848":"fim","8cca3fe1":"### Vantagens na utiliza\u00e7\u00e3o dos blocos de dados","582a089e":"A problem\u00e1tica de Fake News abordada \u00e9 um tema central no debate politico, social e academico.  Queremos determinar por uso de IA se dada noticia \u00e9 falsa ou verdedeira, essa ferramenta pode auxiliar pessoas e grandes m\u00eddias a n\u00e3o cair em falsas noticias e seus efeitos nocivos.\n\nA t\u00e9cnica de Transfer learning foi amplamente utilizada e com grande sucesso em problemas de vis\u00e3o computacional nos ultimos tempos, por\u00e9m no ultimo ano conseguimos aplicar com sucesso em problemas de NLP.\n\nNoticias sobre a t\u00e9cnica de NLP e Transfer learning [The Gradient](https:\/\/thegradient.pub\/) ultimo ano, [NLP's ImageNet moment has arrived](https:\/\/thegradient.pub\/nlp-imagenet\/).","37218941":"Since this is relatively slow to train, we will save our weights:","b0301c12":"### Gerando Manchetes com a nossa nova base de dados","12b0dd72":"### Dados valida\u00e7\u00e3o da Competi\u00e7\u00e3o (Submission)","1f65e688":"### Dados de treinamento do Modelo de Linguagem","453593ba":"## Preparando os Dados","1784f8d4":"### Amostra dos blocos de dados","49d17cf5":"### Dados de treinamento do Modelo Classificador","8038a1e1":"## Modelo Classificador","e134729a":"A API de bloco de dados fornece um flexibilidade e r\u00e1pidez no desenvovimento de IA, utilizando um processo unico que une as t\u00e9cnincas de Argumenta\u00e7\u00e3o de dados como Tokeniza\u00e7\u00e3o e Enumerar em uma fun\u00e7\u00e3o. Precisando apenas utilizar Hiperpar\u00e2metros para obter dados totalmente formatados e pronto para treinamento.\n","a1809f90":"## Treino do Modelo de Linguagem","3df02d5d":"O [dataset](https:\/\/www.kaggle.com\/c\/fakenewsvortexbsb)  foi criado por mim, Pedro Henrique Rodrigues Mendes, consegui essas informa\u00e7\u00f5es por meio de webscraping no facebook, precisamente em p\u00e1ginas de noticias reais como grandes jornais e as noticias falsas em paginas de humor jornalistico. ","ffb6639b":"### Cria\u00e7\u00e3o do Databunch do Modelo de Linguagem (Data_ml)","51c23f6a":"## Modelos de linguagem","efdbc15d":"### Cria\u00e7\u00e3o do Databunch do Modelo Classificador (Data_clas)"}}