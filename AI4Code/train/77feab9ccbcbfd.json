{"cell_type":{"fe7a609c":"code","c33497ce":"code","d5a4f1d1":"code","f9f5d243":"code","7e003c56":"code","c9439cb0":"code","54e32505":"code","a377d858":"code","260656b1":"code","e2ed0eda":"code","57594fd9":"code","7a82c325":"code","594dfc92":"code","f76e8286":"code","b296a0a2":"code","fa45da96":"code","9655930b":"code","c1826826":"code","6cbe0373":"code","92a34ca2":"code","7f3df413":"code","d106434b":"code","002e2c46":"markdown","920ec96d":"markdown","697c9408":"markdown","abb8418d":"markdown","8a966a7b":"markdown","411dd525":"markdown","5f15e7ad":"markdown","6ecef5b8":"markdown","75bc12ed":"markdown","0e6d0f7c":"markdown","d08da411":"markdown","2a2f1817":"markdown","87812818":"markdown","a991e068":"markdown","1c5bc7f6":"markdown","2cfb2b00":"markdown","4eb6ca0e":"markdown","aa7bc547":"markdown","f4775fa4":"markdown","f61239ed":"markdown"},"source":{"fe7a609c":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nfrom datetime import date, datetime\n#visualization libraries\nimport plotly.graph_objs as go\nimport plotly.express as px\nfrom plotly.figure_factory import create_annotated_heatmap\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","c33497ce":"data = pd.read_csv('..\/input\/nba2k20-player-dataset\/nba2k20-full.csv')\ndata.head(5)","d5a4f1d1":"data.info()","f9f5d243":"def prepare_data(data: pd.DataFrame):\n    '''\n        Preprocesses data\n    '''\n    def calculateAge(birthDate: str):\n        '''\n        calculates age of person, on given birth day\n        '''\n        datetime_object = datetime.strptime(birthDate, '%m\/%d\/%y')\n        today = date.today() \n        age = today.year - datetime_object.year -  \\\n              ((today.month, today.day) < (datetime_object.month, datetime_object.day)) \n        return age \n    \n    data['jersey'] = data['jersey'].apply(lambda x: int(x[1:]))\n    data['age'] = data['b_day'].apply(calculateAge)\n    data['height'] = data['height'].apply(lambda x: float(x.split('\/')[1]))\n    data['weight'] = data['weight'].apply(lambda x: float(x.split('\/')[1].split(' ')[1]))\n    data['salary'] = data['salary'].apply(lambda x: float(x[1:]))\n    data['draft_round'].replace('Undrafted', 0, inplace = True)\n    data['draft_round'] = data['draft_round'].apply(int)\n    data['team'] = data['team'].fillna('No team')\n    data['college'] = data['college'].fillna('No education')\n    data.drop(['b_day', 'draft_peak'], axis = 1, inplace = True)","7e003c56":"prepare_data(data)","c9439cb0":"data.info()","54e32505":"fig = px.scatter(data, x=\"rating\", y=\"salary\", trendline=\"ols\", \n                 title = \"Relationship between rating and salary\", \n                 marginal_x = 'box', marginal_y = 'box')\nfig.show()","a377d858":"\nfig = px.scatter(data, x=\"rating\", y=\"salary\", trendline=\"ols\", \n                 color=\"draft_year\", facet_col=\"draft_round\", \n                 title = \"Relationship between rating and salary by draft round with draft year distribution\")\nfig.show()","260656b1":"fig = px.histogram(data, x=\"salary\", marginal = \"box\", title = \"distribution of salary\")\nfig.show()","e2ed0eda":"df = data['age'].value_counts().sort_index().reset_index()\ndf.columns = ['age', 'count']\nfig = px.bar(data_frame = df, x='age', y='count', \n             color = 'age', title = 'distribution of age')\nfig.show()","57594fd9":"df = data.groupby('age')['salary'].mean().reset_index()\nfig = px.bar(data_frame = df, x='age', y='salary', \n             color = 'age', title = 'Mean salary by age')\nfig.show()","7a82c325":"fig = px.scatter(data, x=\"age\", y=\"salary\", trendline=\"ols\", \n                 title = \"Relationship between age and salary\")\nfig.show()","594dfc92":"\nval = [[round(elem, 2) for elem in row] for row in data.corr().values] \nfig = create_annotated_heatmap(z=val, \n                               x = data.corr().columns.tolist(), \n                               y = data.corr().columns.tolist(),  \n                               colorscale = px.colors.diverging.balance, \n                               showscale = True)\nlayout = {'title' : 'Correlation map'}\nfig.update_layout(layout)\nfig.show()\n","f76e8286":"step = 5\nintervals = list(range(min(data['draft_year']), max(data['draft_year'] + step), step))\ndata['draft_year_intervals'] = pd.cut(data['draft_year'], intervals).apply(str)\nfig = px.box(data, x = 'draft_year_intervals', y = 'salary', \n             title = 'Distribution of salary on draft year intervals')\nfig.show()","b296a0a2":"most_common_country = data['country'].value_counts()[:5]\ndf = data[data['country'].isin(most_common_country.index.tolist())]\ncount_by_countries = df['country'].value_counts().reset_index()\ncount_by_countries.columns = ['country', 'count']\nfig = px.bar(count_by_countries, x = 'country', y = 'count', \n             title = 'Count of players NBA on countries(top 5)')\nfig.show()","fa45da96":"salary_per_country = data[['country', 'salary']]\nsalary_per_country.loc[salary_per_country['country'] != 'USA', 'country'] = 'not USA'\nfig = px.box(salary_per_country, x = 'country', y = 'salary', \n             title = 'Distribution of salary based on countries')\nfig.show()","9655930b":"salary = data[['salary', 'position']]\nsalary = salary.groupby('position').describe()['salary'][['mean', 'count']]\\\n         .reset_index().sort_values(by='mean', ascending = False)\nfig = px.bar(salary, x = 'position', y = 'mean', color = 'count', \n             title = 'Mean salary of players NBA per position with gradation on count')\nfig.show()","c1826826":"rating_age_pos = data[['position', 'salary', 'age']]\nrating_age_pos.loc[data['position'] == 'C-F', 'position'] = 'F-C'\nrating_age_pos.loc[data['position'] == 'F-G', 'position'] = 'F'\nrating_age_pos.loc[data['position'] == 'G-F', 'position'] = 'F'\n\nfig = px.scatter(rating_age_pos, x=\"age\", y=\"salary\", trendline=\"ols\", \n                 color = 'position', facet_col=\"position\", facet_col_wrap=2,\n                 title = \"Relationship between age and salary with hue on position\")\n\nfig.show()","6cbe0373":"college = data['college'].value_counts()>10\ncollege = college.loc[college]\ndf = data[data['college'].isin(college.index.tolist())]","92a34ca2":"salary_per_col = df[['salary', 'college']]\nsalary_per_col = salary_per_col.groupby('college').describe()['salary'][['mean', 'count']]\\\n                 .reset_index().sort_values(by=\"mean\", ascending = False)\nfig = px.bar(salary_per_col, x = 'college', y = 'mean', color = 'count', \n             title = 'Mean salary of players NBA per college(>10 players from college with No education)')\nfig.show()","7f3df413":"rating = df[['rating', 'college']]\nrating = rating.groupby('college').mean().reset_index().sort_values(by=\"rating\", ascending = False)\nfig = px.bar(rating, x = 'college', y = 'rating', color = 'rating', \n             title = 'Mean rating of players NBA per college(>10 players from college  with No education)')\nfig.show()","d106434b":"salary = data[['salary', 'team']]\nsalary = salary.groupby('team').describe()['salary'][['mean', 'count']]\\\n         .reset_index().sort_values(by='mean', ascending = False)\nfig = px.bar(salary, x = 'team', y = 'mean', color = 'count')\nfig.show()","002e2c46":"# **Visualization**","920ec96d":"Let's take a little closer look to relationship between rating and salary and for now let's divide players by draft round and draft year.\n\nWe can see that undrafted players have worse maximum rating and salary. Also they have worse correlation between rating and salary,\n\nAlso we can see, that players that were drafted recently (2015+) have less rating and salary","697c9408":"Now we have 9 numerical columns, so we can start visualization","abb8418d":"This graph is much more interesting.\n\nThis is a plot of mean salary by age.\n\nThe histogram is asymmetric and skewed to the left now. So older players get bigger salaries. ","8a966a7b":"So let's take a look on correlation map.\n\nRating has strong postive correlation with salary (0.78), so we can say, that salary depends on rating of a player, it might be helpful in prediction salary.\n\nAge has weak postive correlation with salary (0.43), so we can say, that the more age of player, the bigger salary he gets.\n\nDraft year has medium negative correlation with salary (-0.51), so the players that were drafted earlier gets bigger salary. \n\nAlso we can see, that weight and height are highly correlated, it's obvious. And also we can see weak positive correlation between rating and draft year, nothing special, because the longer player plays on high level - then bigger rating he has.","411dd525":"Firstly, let's take a look on a scatter plot of rating and salary.\n\nAs we can see on the graph, that rating and salary are highly correlated, due to slope of the regrssion line. Also we can see that median value of rating is 75 and median value of salary is 4.38M","5f15e7ad":"On this plot we can see distribution of age.\n\nThe histogram is asymmetric and skewed to the right. It's because players can't sign with the NBA until they are 19 years or older. Nothing interesting.","6ecef5b8":"As we can see from this count plot, the data is highly imbalanced, so we should somehow handle it, because there is no sense to explore it. So we should combine all countries that are not USA into one category. ","75bc12ed":"On this plot we can see, that in average, players on position C-F get the biggest salary, but as with the countries, we also should take into account count of this players. So we should remember and use it in feature engineering. ","0e6d0f7c":"Now let's take a look on college data. First, let's select colleges that occur more than 10 times","d08da411":"As we can see there is a difference between mean salary of players in team, so we can use it in prediction. But we should also look at counts of players in each team. As we can see, each team have less than 25 players, so it might be too small group for model. So in feature engineering we should split teams into groups.","2a2f1817":"On this plot we can see the distribution of salary on draft year intervals. We can see, that median values of intervals [2001, 2006] and (2006, 2011] higher then median values of another intervals. So this plot confirms the fact, that salary depends on draft year. \n\nBut as we can see players that were drafted in (2006, 2011] have higher median and max values than players that were drafted in [2001, 2006], but have less min value.","87812818":"We also can compare mean salary and mean rating per college. Thus Texas and UCLA also remain in the lead and Kentucky also stayed third, but difference in rating between second and third places much less, than difference in salary.","a991e068":"Let's take a look on data types","1c5bc7f6":"As we can see, we have only 2 int columns, but we have data, that we can preprocess to get numerical data","2cfb2b00":"We can see, that UCLA and Texas colleges have higher mean salary, but due to the fact, that they occures only 12 and 11 players respectively, we can't take it into account in feature engineering in that form.","4eb6ca0e":"Now we can see, that salary and correlation have different correlation per position. For example on position C Pearson correlation coefficient = 0.17, so we can say, that there is no relationship between age and salary, but on the position F-C coefficient = 0.54, this is medium correlation. So this might be a good feature.","aa7bc547":"Now we can see, that legionnaires on the average get's bigger salary (because they have bigger quantile values and mean value also bigger), but have less max salary, i.e. superstars from USA get's more salary. It can be explained of media coverage of this players.","f4775fa4":"As we can see there is weak correlation between age and salary, it can be usefull ","f61239ed":"On this plot we can see distribution of salary.\n\nminimum salary = 50k, maximum salary = 40.23M\n\nThe histogram is asymmetric and skewed to the right. This is due to the fact that 50% of the data lies within [50k, 4.38M] and other 50% lies in interval (4.38M, 40.23M], which much bigger"}}