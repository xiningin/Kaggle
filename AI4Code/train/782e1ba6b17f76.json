{"cell_type":{"e35d10a7":"code","8181894f":"code","f093fd40":"code","04096ef3":"code","e4882dbf":"code","76b1a032":"code","714b1926":"code","609fc95e":"code","e77ceb39":"code","fa217061":"code","20b97110":"code","be98d1b9":"code","a41b9b55":"code","031497dd":"code","ad600c44":"markdown"},"source":{"e35d10a7":"from fastai.text.all import *\n","8181894f":"input_path = Path('..\/input\/jigsaw-toxic-severity-rating')\nsub_df = pd.read_csv(input_path\/'sample_submission.csv')\ntest_df = pd.read_csv(input_path\/'comments_to_score.csv')\ndf = pd.read_csv(input_path\/'comments_to_score.csv')\ndf['total_tox'] = 5\ndf.shape","f093fd40":"vocab = pd.read_csv('..\/input\/initial-files\/lm_vocab.csv')\nlm_vocab = vocab['0'].values","04096ef3":"! mkdir ..\/working\/models\n","e4882dbf":"!cp ..\/input\/initial-files\/initial_model.pth ..\/working\/models","76b1a032":"path = Path('..\/input\/initial-files\/')","714b1926":"path.ls()","609fc95e":"toxic_db = DataBlock(blocks=(TextBlock.from_df('text', vocab=lm_vocab), RegressionBlock),\n                     get_x = ColReader('text'),\n                     get_y = ColReader('total_tox'),\n                     splitter = RandomSplitter())\n","e77ceb39":"dls = toxic_db.dataloaders(df[:100], bs=64)\nlearner = text_classifier_learner(dls, AWD_LSTM, drop_mult=0.5, metrics=accuracy, pretrained=False)","fa217061":"learner.load('initial_model');","20b97110":"learner.model","be98d1b9":"test_dl = dls.test_dl(test_df['text'])\nlen(test_dl)","a41b9b55":"preds = learner.get_preds(dl=test_dl) \nlen(preds), preds[0].shape","031497dd":"sub_df.score = preds[0]\nsub_df.to_csv('submission.csv', index=False)","ad600c44":"Training pipeline can be found here: https:\/\/www.kaggle.com\/alibaba19\/jigsaw-training-ulmfit-w-fastai"}}