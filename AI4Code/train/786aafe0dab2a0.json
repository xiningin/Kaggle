{"cell_type":{"b154ebe3":"code","a6ec9ecd":"code","7a7f4ed2":"code","5ef14c8e":"code","1f766a4f":"code","e9eb8a38":"code","ab603904":"code","d0e1309c":"code","4a29a39f":"code","bef369cd":"code","79e0342d":"code","dc2b05ef":"markdown","1cca9e71":"markdown","c4badf85":"markdown","9492694f":"markdown","fbef31d2":"markdown"},"source":{"b154ebe3":"import numpy as np\nimport pandas as pd\nimport cv2\nfrom PIL import Image\nfrom pathlib import Path\nimport matplotlib.pyplot as plt\n%matplotlib inline","a6ec9ecd":"df = pd.read_csv('..\/input\/train_v2.csv')\nprint(df.shape)\ndf.head(3)","7a7f4ed2":"np.random.seed(34)\nsample = 10_000\ndf = df.sample(sample)\ndf.shape","5ef14c8e":"img_size = 96\n\ndef read_img(path):\n    x = cv2.imread('..\/input\/train-jpg\/'+path+'.jpg')\n    x = cv2.resize(x, (img_size, img_size))\n    x = cv2.cvtColor(x, cv2.COLOR_BGR2RGB)\n    return x","1f766a4f":"from joblib import Parallel, delayed\n\nwith Parallel(n_jobs=12, prefer='threads', verbose=1) as ex:\n    x = ex(delayed(read_img)(file) for file in df.image_name)\n    \nx = np.stack(x)\nx.shape","e9eb8a38":"labels = sorted({ee for e in df.tags.unique() for ee in e.split(' ')})\nlabels","ab603904":"for lbl in labels:\n    df[lbl] = df.tags.str.contains(lbl)\n    \ndf.head(3)","d0e1309c":"y =  df.iloc[:,2:].astype(np.int).values\ny","4a29a39f":"from sklearn.model_selection import train_test_split\n\nx_train, x_val, y_train, y_val = train_test_split(x, y, test_size=0.2, random_state=42)\nx_train.shape, x_val.shape","bef369cd":"def plot_img(x, y):\n    fig, (ax1,ax2) = plt.subplots(1, 2, figsize=(15,6))\n    lbls = [lbl for lbl,prob in zip(labels, y) if prob == 1]\n    ax1.imshow(x)\n    ax1.set_axis_off()\n    ax1.set_title('\\n'.join(lbls), size=14)\n    ax2.bar(np.arange(len(y)), y)\n    ax2.set_xticks(np.arange(len(y)))\n    ax2.set_xticklabels(labels, rotation=90)\n    plt.show()","79e0342d":"idx = np.random.choice(len(x_train))\nsample_x, sample_y = x_train[idx], y_train[idx]\nplot_img(sample_x, sample_y)","dc2b05ef":"# Train validation split","1cca9e71":"# View data","c4badf85":"# Read data","9492694f":"## Labels","fbef31d2":"# Model"}}