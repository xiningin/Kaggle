{"cell_type":{"1dd53f50":"code","1fdda4f6":"code","a000ca39":"code","004e0877":"code","fe9b3be7":"code","142a55b7":"code","20052f82":"code","231b2206":"code","b71fd5d1":"code","c38ecf92":"code","0174c8db":"code","14a2ab82":"code","86877e65":"code","4a2ffb5c":"code","aad590d6":"code","9b5a0c8f":"markdown","3c81a155":"markdown","0b72d009":"markdown","4edb387c":"markdown","bcb168dc":"markdown","2c2ff71d":"markdown","f8f2e219":"markdown"},"source":{"1dd53f50":"from kaggle.competitions import twosigmanews\n# You can only call make_env() once, so don't lose it!\nenv = twosigmanews.make_env()\nprint('Done!')","1fdda4f6":"(market_train_df, news_train_df) = env.get_training_data()","a000ca39":"import xgboost as xgb\nimport numpy as np\nimport pandas as pd","004e0877":"def get_xy(market_train_df):\n    x = get_x(market_train_df)\n    y = market_train_df['returnsOpenNextMktres10']\n    return x, y\n\ndef get_x(market_train_df):\n    x = market_train_df.drop(columns=['assetCode', 'assetName'])\n    try:\n        x.drop(columns=['returnsOpenNextMktres10'], inplace=True)\n    except:\n        pass\n    try:\n        x.drop(columns=['universe'], inplace=True)\n    except:\n        pass\n    x['dayofweek'], x['month']  = market_train_df.time.dt.dayofweek, market_train_df.time.dt.month\n    x.drop(columns='time', inplace=True)\n    x.fillna(-1000,inplace=True)\n    return x","fe9b3be7":"x, y = get_xy(market_train_df)\n\ndata = xgb.DMatrix(x, label=y, feature_names=x.columns)\n\ntrain_cols = x.columns","142a55b7":"m = xgb.train({}, data, )","20052f82":"xgb.plot_importance(m)","231b2206":"best_cols = ['volume', 'close', 'open','returnsClosePrevRaw1','returnsClosePrevMktres10']","b71fd5d1":"def get_xy(market_train_df):\n    x = get_x(market_train_df)\n    y = market_train_df['returnsOpenNextMktres10']\n    return x, y\n\ndef get_x(market_train_df):\n    x = market_train_df[best_cols]\n    x.fillna(-1000,inplace=True)\n    return x","c38ecf92":"x, y = get_xy(market_train_df)\n\ndata = xgb.DMatrix(x, label=y, feature_names=x.columns)\n\ntrain_cols = x.columns","0174c8db":"m = xgb.train({}, data, )","14a2ab82":"xgb.plot_importance(m)","86877e65":"def make_predictions(predictions_template_df, market_obs_df):\n    x = get_x(market_obs_df)\n    x = x[train_cols]\n    data = xgb.DMatrix(x)\n    predictions_template_df.confidenceValue = np.clip(m.predict(data),-1,1)","4a2ffb5c":"days = env.get_prediction_days()\n\nfor (market_obs_df, news_obs_df, predictions_template_df) in days:\n    make_predictions(predictions_template_df, market_obs_df)\n    env.predict(predictions_template_df)\nprint('Done!')","aad590d6":"env.write_submission_file()","9b5a0c8f":"![](https:\/\/meme.xyz\/uploads\/posts\/t\/l-21806-you-are-fake-news.jpg )","3c81a155":"# Submission time!!","0b72d009":"## A simple model - using the market data\nYou just can't trust media sources these days.","4edb387c":"This model gets 0.06071 on public leaderboard","bcb168dc":"# Feature Importance\nLet's see what actually makes the difference","2c2ff71d":"Next up, a result including the news","f8f2e219":"### It looks like a lot of these are redundant - and the time factors seem pretty unhelpful. So let's make a new model that removes them"}}