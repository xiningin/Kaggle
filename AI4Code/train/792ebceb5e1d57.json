{"cell_type":{"d9858540":"code","bcb1c899":"code","d943efa5":"code","e83b28a7":"code","06ed2080":"code","a060e700":"code","412693a2":"code","c2eaefc6":"code","e99829fa":"code","7bcc9df0":"code","af83df9a":"code","7ba12127":"code","1a034020":"code","b59b3f9b":"code","1eca97a4":"code","ebc012b8":"code","478acc5a":"code","b8b21b4d":"code","af3a004b":"code","e6d3c9cc":"code","73fa7b59":"code","6725ae38":"code","92ead4fa":"code","a7bc30cf":"code","e9354415":"code","f7754c3f":"code","c4130551":"code","c6b28ebf":"code","97d26a5b":"code","f10805a4":"code","79b2fd87":"code","07263d5d":"code","d4c9eca4":"markdown","a2136570":"markdown","394acb48":"markdown","0cb5e8a2":"markdown","a021a531":"markdown","77058692":"markdown","bc611289":"markdown","a6264712":"markdown","498fdbf9":"markdown","1b2688af":"markdown","3c75a00e":"markdown","52b9d556":"markdown","a3c0853b":"markdown","3c89851a":"markdown","6b100288":"markdown","6b96f063":"markdown","7f6cbf00":"markdown","ac09abbc":"markdown","64842b68":"markdown","6716bcfd":"markdown","f5078216":"markdown","d82fdfa1":"markdown","eca0f78d":"markdown","4bc0cc51":"markdown","8a4d6615":"markdown","a52a671a":"markdown","9d2d1cab":"markdown","a8d50442":"markdown","9a26ff84":"markdown","0cda55e7":"markdown","292a424c":"markdown","4f6357fc":"markdown","a2b9dd34":"markdown","f9c322d2":"markdown","3e6f2e1a":"markdown","395e9874":"markdown","8957bada":"markdown","4987a6b6":"markdown","60515bfb":"markdown","1beee62f":"markdown","e6a83993":"markdown","3d4bfbb7":"markdown","170ecd95":"markdown","7f068ba1":"markdown","a9d1f479":"markdown","bd5b6ac0":"markdown"},"source":{"d9858540":"import pandas as pd\nimport numpy as np\nfrom matplotlib import dates as dates, patches as mpatches, pyplot as plt\nimport seaborn as sns\nfrom plotly import plotly as py, graph_objs  as go\nfrom plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot","bcb1c899":"df_Ins = pd.read_csv('..\/input\/inspections.csv')\ndf_Vio = pd.read_csv('..\/input\/violations.csv')","d943efa5":"df_Ins['facility_name'] = df_Ins['facility_name'].str.upper() \ndf_Ins.activity_date = pd.to_datetime(df_Ins.activity_date)","e83b28a7":"df_merged = pd.merge(df_Ins,df_Vio, on='serial_number', how='left')","06ed2080":"df_merged['activity_date'] = pd.to_datetime(df_merged['activity_date'])\ndf_merged['year'] = df_merged['activity_date'].dt.year\ndf_merged['month'] = df_merged['activity_date'].dt.month\ndf_merged.sort_values(by = 'activity_date', ascending = True, inplace = True)","a060e700":"df_merged[\"time\"] = df_merged['activity_date'].apply(lambda x:x.strftime('%Y%m')) ","412693a2":"df_selected = df_merged[['facility_address', 'facility_name', 'facility_city', 'grade', 'score', 'serial_number', 'points',\n          'violation_description', 'violation_status','time', 'activity_date', 'year']]","c2eaefc6":"df_selected['points'].fillna(0, inplace = True) \ndf_selected['violation_description'].fillna('No violation', inplace = True)\ndf_selected['violation_status'].fillna('No violation', inplace = True)","e99829fa":"df_visits = df_selected.groupby(by = ['facility_name', 'activity_date']).first()","7bcc9df0":"df_first_visit = df_visits.groupby('facility_name').head(1)","af83df9a":"df_first_visit.reset_index(level = 0, inplace = True)\ndf_first_visit['score'] = pd.to_numeric(df_first_visit.score)","7ba12127":"df_first_visit = df_first_visit.sort_values(by = 'score', ascending = True )\ndf_worst = df_first_visit.head(10)","1a034020":"fig, ax = plt.subplots(figsize = (15, 9))\nsns.barplot(x = 'score', y = 'facility_name', data = df_worst, color = 'g')\nax.tick_params(axis='x',length = 10.0, labelsize = 18)\nax.tick_params(axis='y',length = 10,  labelsize = 18)\nplt.title(\"Worst Violators Initial Scores\", fontsize = 25, y =1.01)\nplt.xlabel(\"Score\", fontsize = 20, labelpad = 15)\nplt.ylabel(\"Facility Name\", fontsize = 20, labelpad = 15)\nplt.xlim(60, 72)\nplt.show()","b59b3f9b":"init_notebook_mode(connected = True)\ntrace1 = go.Scatter(\n    x = df_merged[df_merged.facility_name =='FORTUNE CORNER CHINESE FOOD'].activity_date,\n    y = df_merged[df_merged.facility_name =='FORTUNE CORNER CHINESE FOOD'].score,\n    mode = 'lines+markers',\n    name = 'FORTUNE CORNER CHINESE FOOD'\n)\ntrace2 = go.Scatter(\n    x = df_merged[df_merged.facility_name =='SOL NIGHT CLUB'].activity_date,\n    y = df_merged[df_merged.facility_name =='SOL NIGHT CLUB'].score,\n    mode = 'lines+markers',\n    name = 'SOL NIGHT CLUB'\n)\ntrace3 = go.Scatter(\n    x = df_merged[df_merged.facility_name =='THREE BEARS BAR-B-Q'].activity_date,\n    y = df_merged[df_merged.facility_name =='THREE BEARS BAR-B-Q'].score,\n    mode = 'lines+markers',\n    name = 'THREE BEARS BAR-B-Q'\n)\ntrace4 = go.Scatter(\n    x = df_merged[df_merged.facility_name =='ANTOJITOS Y GARNACHERIA DONA ROSITA'].activity_date,\n    y = df_merged[df_merged.facility_name =='ANTOJITOS Y GARNACHERIA DONA ROSITA'].score,\n    mode = 'lines+markers',\n    name = 'ANTOJITOS Y GARNACHERIA DONA ROSITA'\n)\ntrace5 = go.Scatter(\n    x = df_merged[df_merged.facility_name =='EASTERN EXPRESS CAFE'].activity_date,\n    y = df_merged[df_merged.facility_name =='EASTERN EXPRESS CAFE'].score,\n    mode = 'lines+markers',\n    name = 'EASTERN EXPRESS CAFE'\n)\ndata = [trace1,trace2,trace3,trace4,trace5]\nlayout = go.Layout(title = 'Worst Violators Over Time',\n              xaxis = dict(title = 'Date'),\n              yaxis = dict(title = 'Score'),\n              width = 990,\n              height = 500,\n              legend = dict(x =.35, y =.1)\n              )\nfig = dict(data = data, layout = layout)\niplot(fig, filename = 'resturant')","1eca97a4":"df_worst5 = df_merged[(df_merged.facility_name == 'FORTUNE CORNER CHINESE FOOD') | (df_merged.facility_name == 'SOL NIGHT CLUB') | \n    (df_merged.facility_name == 'ANTOJITOS Y GARNACHERIA DONA ROSITA') | (df_merged.facility_name == 'EASTERN EXPRESS CAFE') |\n    (df_merged.facility_name == 'THREE BEARS BAR-B-Q')].groupby(['facility_name', 'violation_description']).agg({\n    'points':'mean',\n    'score':'mean',\n    'facility_address': 'count'\n}).reset_index(level=['facility_name', 'violation_description'])\n\ndf_worst5.columns = ['Restaurant', 'Violation Description', 'Avg_Points', 'Avg_Scores', 'Count']\ndf_worst5['Losing Point'] = df_worst5.Avg_Points * df_worst5.Count\ndf_worst5['Violation Description'] = df_worst5['Violation Description'].apply(lambda x: x[6:])","ebc012b8":"df_frequency = df_worst5[['Restaurant', 'Violation Description', 'Count']]","478acc5a":"plt.figure(figsize = (16, 12))\nsns.set(font_scale = 1.2)\nsns.heatmap(df_frequency.pivot(index = 'Violation Description', columns = 'Restaurant', values = 'Count'),  \n            annot = True, fmt = \"g\", cmap = 'Blues')\nplt.title('Most Common Violations in Worst 5 (frequency)', fontsize = 36,  y = 1.05)\nplt.xlabel('Restaurant', fontsize = 32)\nplt.ylabel('Violation Description', fontsize = 32)\nplt.xticks(fontsize = 18, rotation = '80')\nplt.yticks(fontsize = 14)\nplt.show()","b8b21b4d":"df_losing_point = df_worst5[['Restaurant', 'Violation Description', 'Losing Point']]","af3a004b":"plt.figure(figsize = (16,12))\nsns.set(font_scale = 1.2)\nsns.heatmap(df_losing_point.pivot(index = 'Violation Description', columns = 'Restaurant', values = 'Losing Point'),  \n            annot = True, fmt = \"g\", cmap = 'YlGnBu')\nplt.title('Most Common Violations in Worst 5 (Losing Points)', fontsize = 36,  y = 1.05)\nplt.xlabel('Restaurant', fontsize = 32)\nplt.ylabel('Violation Description', fontsize= 32)\nplt.xticks(fontsize = 18, rotation='80')\nplt.yticks(fontsize = 14)\nplt.show()","e6d3c9cc":"#Filter more rows and focus on more frequency & losing points base on 50% metrics\ndf_median = df_worst5.groupby('Violation Description').sum().reset_index()\ndf_median.describe().iloc[5, :]","73fa7b59":"df_frequency_Median = df_worst5[df_worst5['Violation Description'].isin(df_median[df_median.Count > 5][\n    'Violation Description'])][['Restaurant', 'Violation Description', 'Count']]","6725ae38":"df_Compared_50 = df_worst5[df_worst5['Violation Description'].isin(df_median[df_median.Count > 5][\n    'Violation Description']) | df_worst5['Violation Description'].isin(df_median[df_median['Losing Point'] > 8][\n    'Violation Description'])]","92ead4fa":"sns.set(font_scale = 1.8)\nplt.figure(figsize = (16, 10))\nsns.heatmap(df_Compared_50[['Restaurant', 'Violation Description', 'Count']].pivot(index = 'Violation Description',\n            columns = 'Restaurant', values = 'Count'), annot = True, fmt = \"g\", cmap = 'Blues', \n            xticklabels =\n            ['ANTOJITOS Y \\nGARNACHERIA \\nDONA \\nROSITA',\n             'EASTERN\\n EXPRESS \\nCAFE',\n             'FORTUNE \\nCORNER \\nCHINESE \\nFOOD'\n             ,'SOL \\nNIGHT \\nCLUB',\n             'THREE \\nBEARS \\nBAR-B-Q'], \n            yticklabels = \n            ['Food safety certification',\n             'Water available',\n             'Handwashing facilities',\n             'Ventilation and lighting',\n             'Equipment \/ Utensils',\n             'Floors, walls and ceilings',\n             'Food contact surfaces',\n             'Food in good condition',\n             'Food storage containers',\n             'Food separated and protected',\n             'No insects or animals',\n             'Nonfood-contact surfaces',\n             'Plumbing',\n             'Proper holding temperatures',\n             'Sewage & wastewater disposed',\n             'Toilet facilities',\n             'Toxic substances'\n             'Warewashing facilities'\n            ])\nplt.title('Frequency of Violations by Resturant', fontsize = 36,  y = 1.05)\nplt.xlabel('Restaurant', fontsize = 32, y = 0.85)\nplt.ylabel('Violation Description', fontsize= 32)\n\nplt.legend(labels = ['1','2','3','4','5'], loc = 2)\nplt.xticks(fontsize = 22)\nplt.yticks(fontsize = 28)\nplt.show()","a7bc30cf":"sns.set(font_scale = 1.8)\nplt.figure(figsize = (16, 10))\nsns.heatmap(df_Compared_50[['Restaurant', 'Violation Description', 'Losing Point']].pivot(index = 'Violation Description',\n            columns = 'Restaurant', values = 'Losing Point'), annot = True, fmt = \"g\", cmap = 'YlGnBu', \n            xticklabels =\n            ['ANTOJITOS Y \\nGARNACHERIA \\nDONA \\nROSITA',\n             'EASTERN\\n EXPRESS \\nCAFE',\n             'FORTUNE \\nCORNER \\nCHINESE \\nFOOD'\n             ,'SOL \\nNIGHT \\nCLUB',\n             'THREE \\nBEARS \\nBAR-B-Q'], \n            yticklabels = \n            ['Food safety certification',\n             'Water available',\n             'Handwashing facilities',\n             'Ventilation and lighting',\n             'Equipment \/ Utensils',\n             'Floors, walls and ceilings',\n             'Food contact surfaces',\n             'Food in good condition',\n             'Food storage containers',\n             'Food separated and protected',\n             'No insects or animals',\n             'Nonfood-contact surfaces',\n             'Plumbing',\n             'Proper holding temperatures',\n             'Sewage & wastewater disposed',\n             'Toilet facilities',\n             'Toxic substances'\n             'Warewashing facilities'\n            ])\nplt.title('Points Lost by Violation and Resturant', fontsize = 36,  y = 1.05)\nplt.xlabel('Restaurant', fontsize = 32, y = 0.85)\nplt.ylabel('Violation Description', fontsize= 32)\n\nplt.legend(labels = ['1','2','3','4','5'], loc = 2)\nplt.xticks(fontsize = 22)\nplt.yticks(fontsize = 28)\nplt.show()","e9354415":"df_Agg_Violation = df_merged.groupby(['violation_description']).agg({\n    'points':'mean',\n    'facility_address':'count'\n})","f7754c3f":"df_Agg_Violation['Losing_Points'] = df_Agg_Violation.points * df_Agg_Violation.facility_address","c4130551":"df_Agg_Violation.columns = ['Avg_points', 'Count', 'Losing_Points']\ndf_Agg_Violation = df_Agg_Violation[(df_Agg_Violation.Avg_points > 0) & (\n    df_Agg_Violation.Losing_Points.nlargest(10))].reset_index()\ndf_Agg_Violation = df_Agg_Violation.sort_values(by = 'Losing_Points', ascending = False)\ndf_Agg_Violation['violation_description'] = df_Agg_Violation['violation_description'].apply(lambda x: x[6:])","c6b28ebf":"fig, ax = plt.subplots(figsize=(15, 9))\nsns.barplot(x = 'Losing_Points', y = 'violation_description', data = df_Agg_Violation, ax = ax)\nplt.title('Total Points Lost per Violation',fontsize = 36, y = 1.05 )\nplt.xlabel('Points Lost',fontsize = 30)\nplt.ylabel('Violation Description', fontsize = 30)\nplt.xticks(fontsize = 22)\nplt.yticks(fontsize = 26)\nplt.show();","97d26a5b":"df_trend = df_merged.groupby(['time']).agg({\n    'score':'mean',\n    'points' : 'mean'\n}).dropna().sort_index().reset_index()","f10805a4":"df_trend['mean'] = df_trend.score.mean()","79b2fd87":"df_trend['time'] = df_trend['time'].apply(lambda x: x[4:]) + '\/' + df_trend['time'].apply(lambda x: x[2:4])","07263d5d":"fig, ax = plt.subplots(figsize = (15, 9))\nplt.style.use('ggplot')\nplt.plot( 'score', data = df_trend, marker = 'o', markerfacecolor = 'blue', markersize = 10, \n         color = 'blue', linewidth=2.5)\nplt.plot( 'time', 'mean', data = df_trend, marker = '+', markerfacecolor = 'green', markersize = 10, \n         color = 'green', linewidth=2.5)\nplt.title('Trend of Violation',fontsize = 24)\nplt.xlabel('2015\/07 - 2017\/12 (Month)',fontsize = 16)\nplt.ylabel('Score', fontsize=20)\nplt.xticks(df_trend.index, df_trend.time, fontsize=14, rotation = '60')\nplt.yticks(fontsize = 14)\nplt.show();","d4c9eca4":"### Research Question 2: How do resturants respond to bad health inspection scores. Do they improve or do they stay the same? ","a2136570":"#### Create The Subset of Losing Point ","394acb48":"### Research Question 3: What Violations do these Restaurants have trouble fixing? And What Violations had the greatest impact on score? ","0cb5e8a2":"#### Aggregate Data Based on Violation Description","a021a531":"##  <center> How do low score restaurants respond over time? <\/center>","77058692":"#### Aggregate Data Based on Violation Time","bc611289":"## Table of Contents\n\n### 1. Preparing the data.\n### 2. Restaurants with the worst initial scores.\n### 3. How do low score restaurants respond over time?\n### 4. Violations of Restaurants\n    A. Frequency of Violations\n    B. Score Value of Violations\n### 5. Reference\n","a6264712":"### General Description\nWe did this project because we were interested in the effectiveness of health inspections and how restaurants respond to a bad health inspection score. We also wanted to explore what kind of violations are the most detrimental to a good score and what violations are the most persistant. Our investigation is important because it allows us to examine how well our current health inspection system is working and also see what kinds of violations are either difficult for restaurants to fix or unwilling to fix. ","498fdbf9":"#### Data Cleaning","1b2688af":"### Extra Question 1: What are the most common health code violations for losing points?","3c75a00e":"## Insights\n1. There seem to be three kinds of responses that restaurants take\n    1. put off correcting violations until they have to be inspected\n    1. immediatly correct most of the worst violations \n    1. close down because they cannot correct the violations\n1. All restaurants just aim for a score of at least 90 and do not improve\n","52b9d556":"### Insights of Research Question 1:  \nTHREE BEARS BAR-B-Q got the worst score: **65**","a3c0853b":"#### Replace the NaN value\n","3c89851a":"#### Create The Losing Point Column As Metrics to Evaluate the Losing Points of Inspection ","6b100288":"## <center>  Preparing the Data <\/center>","6b96f063":"#### A: Plot Heatmap of Frequency Above Median","7f6cbf00":"#### Set Average Score As The Benchmark ","ac09abbc":"####  Plot Heatmap of Frequency","64842b68":"## <center> Reference <\/center>","6716bcfd":"## <center> Violations of Restaurants <\/center>","f5078216":"#### Uppercase all names","d82fdfa1":"#### Select the first visit of each restaurant","eca0f78d":"#### Load data \n","4bc0cc51":"### Insights of Research Question 3: \nComparing heatmaps of the count and point losing, we found the most common violations of the worst are related to the equipment, however, these violations are not the main reason that they lose many points in the inspection. Most of the points that are lost are due to poor termperature for holding foods and pests in the restaurant. If you don't want to have a bad score on your health inspection, you have to focus on having proper temperatures and keeping pests away. \n\nIn addition, we found that: \n\n1. All resturants have difficulty fixing these violations\n    1. Adequate ventiilation and lighting\n    1. Equipment and utensils are not clean\/repaired\/approved\n    1. There are rodents, insects, birds, or animals\n1. Individual restaurants have different issues with other violations\n    1. Antojitos has issues fixing their plumbing \n    2. Eastern Express Cafe has issues with toilet facilities\n    3. Fortune Corner has issues with damaged non-food contact surfaces and food storage","8a4d6615":"#### Group by the resturant name and date of inspection","a52a671a":"#### Select the columns we want to use.","9d2d1cab":"### Research Question 1: What are the worst scoring restaurants in LA?","a8d50442":"#### Ordering the Restaurants by Score","9a26ff84":"**Dataset Description:** \n\nRestaurants and markets in Los Angeles county are regularly inspected for health code violations. This Dataset includes data on health inspection visits (inspections.csv) and health code violations (violation.csv) from 2015 to 2017 \n\n**Theme**\n\nThe subject of this project is to explore How restaurants handle violations in LA. First of all, we pick up what are the worst scoring restaurants in LA. Then, we check those restaurants' scores over time to depict their reaction. Finally, We figure out what violations do these restaurants have trouble fixing and what violations had the greatest impact on score.","0cda55e7":"#### B: Plot Heatmap of Losing Point Above Median","292a424c":"### Extra Question 2: What is the trend of health code violations over time?","4f6357fc":"#### Plot The Worst Starting Resturants Over Time","a2b9dd34":"#### Create the order index for later \n","f9c322d2":"#### Merge data","3e6f2e1a":"### Insights of Extra Question 2:\nAs we can see from the graph above, the performance of 2016 is better than other years. The scores for 2016 are higher than the average.","395e9874":"### Insights of Extra Question 1: \nWe surprisingly found that the most common violation of restaurants is related to temperature (shown as below). Be careful about temperature if you running a restaurant. ","8957bada":"##  <center> Restaurants with the worst initial scores <\/center>","4987a6b6":"#### Shrink Dataset to Compare The Data Over 50% (Frequency & Losing Point)","60515bfb":"#### Create The Subset of Frequency\n","1beee62f":"#### Select the top 10 worst restaurants","e6a83993":"#### Create Subset Focus On Top 5 worst Restaurants and \"Losing Point\" As Indicator.","3d4bfbb7":"#### Getting months and years","170ecd95":"#### Filter Dataframe Based on 50% Metrics (Median) to Optimize The Visualization of Heatmap","7f068ba1":"####  Plot Heatmap of Losing Point","a9d1f479":"#### Create the Subset to Focus On The Data Over 50% (Median) Count","bd5b6ac0":"#### Clean Data and Set Index"}}