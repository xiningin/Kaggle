{"cell_type":{"3b908ac6":"code","4a934427":"code","ee209377":"code","aa47f49b":"code","68f05101":"code","72aa57e7":"code","368e5ed0":"code","9f383103":"code","f25b1d3b":"code","2ead6ff3":"code","7ebf75ee":"code","2e8ad205":"code","13a80d1a":"code","ce56917c":"code","7ccdc389":"code","fb136862":"code","9284c631":"code","2500010d":"code","629ce1d2":"code","99ec55d2":"code","bda5f9ec":"code","60b00f10":"code","ebdae27b":"code","7aa4aa2f":"code","09a01e51":"code","80077ed2":"code","e107cd81":"code","f1de8b62":"code","cd345ad0":"code","6221adfd":"code","365ac5e3":"code","badda0bd":"markdown","5ee4b4bc":"markdown","6badfb9b":"markdown","943c4c6b":"markdown","f5e29dde":"markdown","1be3769e":"markdown","ffb753d6":"markdown","26cea4ee":"markdown","84569dca":"markdown","da71e669":"markdown","2e3faee6":"markdown","a3a6af1b":"markdown","553ac40c":"markdown","a39ab39b":"markdown","2ed8c6e7":"markdown"},"source":{"3b908ac6":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","4a934427":"all_elo = pd.read_csv('\/kaggle\/input\/nfl-elo-ratings-from-538\/nfl_elo.csv')","ee209377":"all_elo.head(15)","aa47f49b":"all_elo[~all_elo.qb1_game_value.isna()][['qb1','qb2','elo1_pre','elo2_pre','qbelo1_pre','qbelo2_pre','qb1_game_value','qb2_game_value']]","68f05101":"len(all_elo)","72aa57e7":"#First, remove the NaN values (only in season 2019)\nall_elo = all_elo[~all_elo.score1.isna()==True]\nall_elo ['predicted_tie'] = all_elo.elo1_pre == all_elo.elo2_pre\nall_elo ['actual_tie'] = all_elo.score1 == all_elo.score2","368e5ed0":"all_elo [all_elo.predicted_tie == True]","9f383103":"all_elo [all_elo.actual_tie == True]","f25b1d3b":"import plotly.express as px\nties_by_season = pd.DataFrame(all_elo.groupby(['season'])['actual_tie'].sum())\nties_by_season = ties_by_season.reset_index(drop=False)\nprint(ties_by_season.columns)\n#fig, ax = plt.subplots()\nfig = px.bar(ties_by_season, x='season', y='actual_tie',width = 600,height = 400, orientation = 'v')\nfig.show()\n","2ead6ff3":"non_ties = all_elo[~all_elo.actual_tie == True]\nnon_ties = non_ties[~non_ties.predicted_tie == True]","7ebf75ee":"non_ties","2e8ad205":"non_ties ['team1_predicted'] = non_ties.elo1_pre > non_ties.elo2_pre\nnon_ties ['team1_won'] = non_ties.score1 > non_ties.score2","13a80d1a":"\n\nnon_ties['correct_prediction']=non_ties.team1_predicted == non_ties.team1_won","ce56917c":"non_ties[['team1_predicted','team1_won','correct_prediction']]","7ccdc389":"non_ties.tail()","fb136862":"non_ties.correct_prediction.describe().freq\/len(non_ties)","9284c631":"non_ties_2019 = non_ties[non_ties.season==2019]\nnon_ties_2019.correct_prediction.describe().freq\/len(non_ties_2019)\n","2500010d":"non_ties_2019.correct_prediction.describe()","629ce1d2":"non_ties['point_spread'] = (non_ties.elo2_pre - non_ties.elo1_pre)\/25.0","99ec55d2":"non_ties.point_spread.describe()","bda5f9ec":"non_ties[non_ties.point_spread <=-20]","60b00f10":"non_ties['score1_adj'] = non_ties.score1 + non_ties.point_spread","ebdae27b":"non_ties['team1_won_adj'] = non_ties.score1_adj > non_ties.score2","7aa4aa2f":"non_ties[non_ties.team1_won != non_ties.team1_won_adj]","09a01e51":"non_ties['correct_spread_prediction']=non_ties.team1_predicted == non_ties.team1_won_adj","80077ed2":"non_ties.correct_spread_prediction.describe().freq\/len(non_ties)","e107cd81":"from statsmodels.stats.proportion import proportions_ztest\nbefore_1950 = non_ties[non_ties.season<1950]\nsince_1950 = non_ties[non_ties.season>=1950]","f1de8b62":"print('Probability of correct prediction before 1950: ' +str(before_1950.correct_prediction.describe().freq\/len(before_1950)))\nprint('Probability of correct since 1950:             ' + str(since_1950.correct_prediction.describe().freq\/len(since_1950)))","cd345ad0":"# Get sample sizes for each\nn_pre = len(before_1950)\nn_post = len(since_1950)\ncorrect_pre = before_1950.correct_prediction.describe().freq\ncorrect_post = since_1950.correct_prediction.describe().freq","6221adfd":"correct = np.array([correct_pre, correct_post])\noverall = np.array([n_pre, n_post])\nz, pval = proportions_ztest(correct, overall)","365ac5e3":"print ('The results of the z proportion test are: ')\nprint ('  z = ' + str(round(z,2)) )\nprint ('  p = ' + str((pval)) )","badda0bd":"## Finally - Prediction With and Without QB Information\n\nWe know that Elo is a decent predictor overall with correct predictions of 64.0%. We need a statistical test to compare two ratios - win percentage before and after 1950.\n\nOne test we can use is a z statistic to compare two proportions. \n\n","5ee4b4bc":"## The Elo Rating as a Predictor\n\nHow good is Elo as a predictor? We need a few enhancements to the dataset.\n\nFor this analysis, I will discard tie games, unless Elo predicts a tie.\n\n\n\n","6badfb9b":"The point spread predictions are better than 50% at 52.4%. That is probably not enough to beat the line in Las Vegas, due to the house advantage of 10%. You might make some money in your office pool!","943c4c6b":"The P-value is the probability that the z-score is greater than than 2.13. Therefore, with a z value of 7.04, we reject the null hypothesis and conclude that the addition of QB ratings did not improve the Elo prediction algorithm.\n\nThis is a curious finding. It seems that, in general, addition of predictive factors should improve the prediction function.","f5e29dde":"Based on the mean of the point spread of -0.15, we can assume team1 is the home team, with a slight advantage in point spread.\n","1be3769e":"## Addition of QB Data\n\nIn 2019, the 538 Elo prediction added QB data as well as some additional features. However, it appears that the retrofitted their model back to 1950 with QB. This analysis will do a simple statistical comparision to find out whether QB data improves predictions.\n","ffb753d6":"## Quick Look at the Data","26cea4ee":"There are only 7 games with predicted ties. These were all in league start-up seasons when there was no prior history. ","84569dca":"For 2019, Elo performs slighly lower with 64.0% correct. That would still place Elo in the top 6 of professional football predictors in the sports media!\n\n## How Does Elo Do Against Point Spread?\n\nThe Elo predictions are design such that the prediction difference divided by 25 is an effective point spread. With this known, we now examine Elo's prediction against its own point spreads.","da71e669":"There have been 315 tie games since the start of the NFL. This has fallen off dramatically in the last 45 years, with the introduction of overtime in 1974. The overtime rules have been tweaked several times in the last 10 years. ","2e3faee6":"## Check on Prediction\n\nWe first eliminate the tie predictions and actual ties. ","a3a6af1b":"This is interesting. Why are the predictions better before the addition of the quarterback and home field data? \n\nWe now have a null hypothesis to test:\n\n* H0 - Prediction probability of games before 1950 and games since 1950 are the same; P(before) = P(since)\n* H1 - Prediction probability of games before > games since 1950; P(before) > P(since)\n* Test is at \n\n","553ac40c":"## Background\n\nAn obvious first thing we need is a team identification table. The team identifiers will not be recognized by any modern day NFL fan. The first two seasons were from a professional league called the American Professional Football Association, which became the National Football Leaguge (NFL) in 1922. It grew from the Ohio League and the New Your Pro Football League.\n\nThe very first game between Rock Island Independents (RII) and the St. Paul Ideals (STP) was won by Rock Island 48-0.   \n\nIn the first season, the league title was won by the Akron Pros, who were undefeated (with several ties). \n\nIn the modern NFL, only two teams survive, the Chicago Cardinals (now Arizona Cardinals) and the Decatur Staleys, now the Chicago Bears. The Muncie Flyers had a short season, with a record of 0-1. They did play a few other games that year against local teams; however these games did not count in the APFA standings.","a39ab39b":"There were over 2000 games where the point spread changed the outcome, i.e. a team beat the spread. How that change the prediction?\n","2ed8c6e7":"An overall prediction percentage of 64.8% seems quite good. How well does it compare to industry experts?\n\nThis year, Trey Wingo of ESPN has predicted 158 of 240 NFL games so far. This is 65.8%, almost the same as Elo. How did Elo do in 2019?"}}