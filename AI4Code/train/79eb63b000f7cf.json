{"cell_type":{"5fdc6795":"code","d1f9e002":"code","3e4b6253":"code","0bc5efa1":"code","515afbcd":"code","5f39ce5d":"code","308a1f4b":"code","56310e96":"code","1e88c218":"code","0cfb4784":"code","24f273e8":"code","40379c94":"code","29464dd5":"code","787753c4":"code","d6d4fbcd":"code","0e20e412":"code","048cb9a6":"code","f0282e6a":"code","2796222f":"code","2a435c43":"code","0ad3a576":"code","1b1c1d09":"code","31554f60":"code","06c51111":"code","bbf60491":"code","23c7535f":"code","f3eda34d":"code","f5e6147f":"code","70310e8c":"code","e1428ff5":"code","b69bd039":"code","f8658069":"markdown","5f9f88b1":"markdown","544a7621":"markdown","a05a7ddf":"markdown","731a96e5":"markdown","98edd551":"markdown","76c2021a":"markdown","65294f74":"markdown","b03b72fc":"markdown","d715b165":"markdown","5ebd9e74":"markdown","2a6de923":"markdown","a1b054a7":"markdown","af64d979":"markdown","c1086ddf":"markdown","2edf4d40":"markdown","bd5ac36f":"markdown","ba6ac725":"markdown","4dbdb6f7":"markdown","b132bce8":"markdown","3c5076f4":"markdown","8f54ecac":"markdown","0e2310fb":"markdown","47c7285f":"markdown","98942f8d":"markdown","7224dfcb":"markdown","5bde65f1":"markdown","2ebc8da2":"markdown","c6543c6e":"markdown","ae53ce02":"markdown","81becf97":"markdown","c2552430":"markdown","7fb9b917":"markdown","86a94533":"markdown","617d8e8b":"markdown","a7141595":"markdown","d54106bb":"markdown","7adeeb9d":"markdown","d14290c1":"markdown","885c0a34":"markdown","ed3f947c":"markdown","574e9f4e":"markdown","65cc5411":"markdown","83f183d2":"markdown"},"source":{"5fdc6795":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom sklearn.model_selection import train_test_split\nfrom sklearn import metrics\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.svm import SVR\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.ensemble import RandomForestRegressor\n\n\n\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","d1f9e002":"df = pd.read_csv('\/kaggle\/input\/fifa19\/data.csv')\ndf.head()","3e4b6253":"df.info()","0bc5efa1":"#makes the wage and value objects into floats\ndef fix_value(Value):\n    out = Value.replace('\u20ac', '')\n    if 'M' in out:\n        out = float(out.replace('M', ''))*1000000\n    elif 'K' in Value:\n        out = float(out.replace('K', ''))*1000\n    return float(out)\n\ndf['Wage'] = df['Wage'].apply(lambda x: fix_value(x))\ndf['Value'] = df['Value'].apply(lambda x: fix_value(x))","515afbcd":"df.describe().T","5f39ce5d":"stats = ['Wage','Value','Overall','Potential', 'Special', 'Age','Weak Foot','Crossing', 'Finishing',\n         'HeadingAccuracy','Volleys','Dribbling', 'Curve', 'BallControl','Vision',\n         'ShortPassing','LongPassing', 'Acceleration', 'Aggression', 'ShotPower', 'Agility', 'Positioning', \n         'Composure', 'Marking', 'StandingTackle']\n\nmain_df = df[stats]\n\nprint(df[stats].isnull().sum())","308a1f4b":"for stat in stats: \n    main_df[stat].fillna(main_df[stat].median(), inplace=True)","56310e96":"fig = plt.figure(figsize=(10,10))\nsns.distplot(a=df['Overall'], color = 'g', bins = 49)\nplt.title('Distribution of Overall Ratings')\nplt.show()","1e88c218":"main_df = main_df[main_df['Overall'] > 70]","0cfb4784":"corr = main_df.corr()\nfig, ax = plt.subplots(figsize=(15, 15))\nmask = np.zeros_like(corr)\nmask[np.triu_indices_from(mask)] = True\nsns.heatmap(corr,annot=False, ax=ax,mask = mask,cmap=\"Greens\").set(\n    title='Feature Correlations')\nplt.show()","24f273e8":"#makes new dataframe for each position group\nforwards = ['ST','LS', 'RS', 'LF','RF', 'CAM', 'CF','RW', 'LW']\nmidfield = ['CM', 'LCM', 'RCM', 'CDM', 'RDM', 'LDM','RM','LM','RAM','LAM']\ndefense = ['LB', 'RB', 'RCB', 'LCB', 'RWB', 'LWB']\ngoalie = ['GK']\n\nforward_df = df[df['Position'].isin(forwards)]\nmid_df = df[df['Position'].isin(midfield)]\ndefense_df = df[df['Position'].isin(defense)]\ngoalies = df[df['Position'].isin(goalie)]\n\n#Makes new column in original df to have general position group\ndef group_positions(Position):\n    if Position in forwards:\n        return 'Forward'\n    elif Position in midfield:\n        return 'Midfield'\n    elif Position in defense:\n        return 'Defense'\n    elif Position in goalie:\n        return 'Goalkeeper'\n    \nmain_df['Position Group'] = df['Position'].apply(lambda x: group_positions(x))","40379c94":"g = sns.pairplot(data=main_df, vars=['Overall','Wage', 'Age', 'Value', 'Dribbling', 'Agility','Composure'], hue='Position Group',palette=\"Paired\")\ng.fig.suptitle('Feature Relations')\nplt.show()","29464dd5":"fig = plt.figure(figsize=(10,10))\nsns.violinplot(x=\"Position Group\", y=\"Overall\", data=main_df)\nplt.title('Overall Rating by Position Group')\nfig = plt.figure(figsize=(10,10))\nsns.violinplot(x=\"Position Group\", y=\"Wage\", data=main_df)\nplt.title('Wage by Position Group')\nplt.show()","787753c4":"fig = plt.figure(figsize=(15,10))\nsns.lineplot(x=\"Age\", y=\"Overall\", data=main_df,color='g')\nplt.title('Age vs Overall Rating')\nplt.show()","d6d4fbcd":"df.loc[(df['Overall']==71) & (df['Age']==45)]","0e20e412":"fig = plt.figure(figsize=(15,10))\nsns.lineplot(x=\"Age\", y=\"Wage\", data=main_df,color='g')\nplt.title('Age vs Wage')\nplt.show()","048cb9a6":"fig = plt.figure(figsize=(10,10))\nsns.distplot(a=main_df['Wage'],kde=False, color = 'g')\nplt.title('Distribution of Wages')\nplt.show()","f0282e6a":"main_df = main_df[main_df.Wage != 0] #removes players with 0 wage, which allows us to scale logarithmically\nmain_df['logwage'] = np.log(main_df['Wage'])","2796222f":"fig = plt.figure(figsize=(10,10))\nsns.distplot(a=main_df['logwage'],kde=False,color='g')\nplt.title('Distribution of Log Wages')\nplt.show()","2a435c43":"regs = ['Overall','Special','Composure', 'Dribbling', 'Vision', 'ShortPassing', 'BallControl']\nx = main_df[regs]\ny = main_df['logwage']\n\nX_train, X_test, y_train, y_test = train_test_split(x,y)","0ad3a576":"lr = LinearRegression()\nlr.fit(X_train, y_train)\nlr_prediction = lr.predict(X_test)\n\nprint('Linear Regression Performance ')\nprint('MAE: ', metrics.mean_absolute_error(y_test, lr_prediction))\nprint('RMSE: ', metrics.mean_squared_error(y_test, lr_prediction))\nprint('R2: ', metrics.r2_score(y_test, lr_prediction))","1b1c1d09":"print('Coefficients')\nfor num, col in enumerate(x.columns,start = 0):\n    print(col, ':', lr.coef_[num])","31554f60":"fig = plt.figure(figsize=(12,6))\nplt.scatter(y_test, lr_prediction, color='teal')\nplt.xlabel('Actual Player Log Wage')\nplt.ylabel('Predicted Player Log Wage')\nplt.title('Linear Regression Performance')\nplt.show()","06c51111":"forward_df = forward_df[forward_df.Wage != 0]\nforward_df['logwage'] = np.log(forward_df['Wage'])\n\nmain_stats = ['Overall', 'Special', 'Composure']\nx2 = forward_df[main_stats]\ny2 = forward_df['logwage']\nX2_train, X2_test, y2_train, y2_test = train_test_split(x2,y2)\n\nlr2 = LinearRegression()\nlr2.fit(X2_train, y2_train)\nlr2_prediction = lr2.predict(X2_test)\n\nprint('Linear Regression with Selected Variables Performance ')\nprint('MAE: ', metrics.mean_absolute_error(y2_test, lr2_prediction))\nprint('RMSE: ', metrics.mean_squared_error(y2_test, lr2_prediction))\nprint('R2: ', metrics.r2_score(y2_test, lr2_prediction))","bbf60491":"print('Coefficients for Second Linear Model')\nfor num, col in enumerate(x2.columns,start = 0):\n    print(col, ':', lr2.coef_[num])","23c7535f":"svm = SVR(kernel = 'rbf')\nsvm.fit(X_train, y_train)\nsvm_prediction = svm.predict(X_test)\n\nprint('SVM Performance')\nprint('MAE: ', metrics.mean_absolute_error(y_test, svm_prediction))\nprint('RMSE: ', metrics.mean_squared_error(y_test, svm_prediction))\nprint('R2: ', metrics.r2_score(y_test, svm_prediction))","f3eda34d":"fig = plt.figure(figsize=(12,6))\nplt.scatter(y_test, svm_prediction, color='teal')\nplt.title('SVM Performance')\nplt.xlabel('Actual Player Log Wage')\nplt.ylabel('Predicted Player Log Wage')\nplt.show()","f5e6147f":"tree_stats = ['Overall', 'Special', 'Composure', 'Dribbling', 'Vision', 'ShortPassing', 'LongPassing', 'Agility', 'BallControl', 'Dribbling', 'ShotPower', 'Positioning']\nx3 = main_df[tree_stats]\ny3 = main_df['logwage']\nX3_train, X3_test, y3_train, y3_test = train_test_split(x3,y3)\ndt = DecisionTreeRegressor(random_state=1)\ndt.fit(X3_train,y3_train)\ndt_prediction = dt.predict(X3_test)\n\nprint('Decision Tree Performance')\nprint('MAE: ', metrics.mean_absolute_error(y3_test, dt_prediction))\nprint('RMSE: ', metrics.mean_squared_error(y3_test, dt_prediction))\nprint('R2: ', metrics.r2_score(y3_test, dt_prediction))","70310e8c":"fig = plt.figure(figsize=(12,6))\nplt.scatter(y3_test, dt_prediction, color = 'teal')\nplt.xlabel('Actual Player Log Wage')\nplt.ylabel('Predicted Player Log Wage')\nplt.title('Decision Tree Performance')\nplt.show()","e1428ff5":"rf = RandomForestRegressor(n_estimators = 100)\nrf.fit(X3_train,y3_train)\nrf_prediction = rf.predict(X3_test)\n\nprint('Random Forest Performance')\nprint('MAE: ', metrics.mean_absolute_error(y3_test, rf_prediction))\nprint('RMSE: ', metrics.mean_squared_error(y3_test, rf_prediction))\nprint('R2: ', metrics.r2_score(y3_test, rf_prediction))","b69bd039":"fig = plt.figure(figsize=(12,6))\nplt.scatter(y3_test, rf_prediction, color= 'teal')\nplt.xlabel('Actual Player Log Wage')\nplt.ylabel('Predicted Player Log Wage')\nplt.title('Random Forest Performance')\nplt.show()","f8658069":"# Conclusion","5f9f88b1":"**Position Analysis:** Recognizing differences in position is important. Let's split the player's up by position group in order to capture the general trends between each stat for each position group. A pairplot will effectively display this information.","544a7621":"It turns out the 45 year old legend is Oscar Perez, a Goalkeeper from Mexico who is regarded as one of the greatest Mexican Goalkeepers of all time. \n[Here's a great article](http:\/\/www.fmfstateofmind.com\/2019\/7\/27\/8933511\/el-conejo-oscar-perez-mexican-goalkeeping-legend-retires-from-football) from sbnation that highlights his career in light of his recent retirement from the game of Soccer.","a05a7ddf":"It seems that every position group has a similar spread of ratings and wages. Knowing this, I don't think we'll need to specify our models to any position group, since they have such similar stats. ","731a96e5":"Now that all of our data is formatted properly lets check for any null values. For now let's just check the columns that might be relevant to our analysis.","98edd551":"The fine tuned linear model performs slightly better than the original linear model. Lets try some other methods to see if we can improve upon this.","76c2021a":"We can see the graph of Wage is far from a normal distribution. This is important because many ML techniques like linear regression perform much better with a normal distribution. We'll try to scale this logarithmically to help. ","65294f74":"**Linear Regression**","b03b72fc":"Notable Insights:\n* Overall and Value are closely tied together, but their relationship is not linear\n* Dribbling and Value do not have as close of a relationship as I would have expected\n* All of the FIFA Ratings(Dribbling, Agility, and Finishing) have an extremely similar relationship with Value\n* There is no clear trend between Composure and Age, but there is a moderate linear relationship between Composure and Overall, which we noted earlier","d715b165":"Notable Insights:\n* Composure has a high correlation with Wage and Overall, with a .42 and a .73 respectively. \n* While Overall Rating has a high correlation with Wage, it was still a little lower than I would've expected it to be, at .58.\n\nComposure's high correlation is a very interesting finding. Out of every on field performance rating, it has by far the highest correlation with both Wage and Overall Rating. \n\nEA's Gameplay director Sam Rivera defines composure as the distance which the player with the ball starts feeling the pressure from the opponent. This then affects the chances of the player making an error when he shoots, passes and crosses. Let's keep this in mind as we continue our analysis.","5ebd9e74":"Overall, I found that the Random Forest had the best performance of all the models. The fine tuned Linear Model was close behind in its performance, followed by the Decision Tree, and SVM in last place. ","2a6de923":"Here's a first glance at the dataset we have to work with.","a1b054a7":"Thanks for reading!","af64d979":"For the Decision Tree and Random Forest, we can include more variables since we do not have to worry about multicollinearity.","c1086ddf":"**Goal:** In this kernel, I'd like to gain a better understanding of how EA calculates their Overall Rating. Once we have a better understanding, I'd like to try to predict a player's real life wage based off their FIFA Overall Rating and other specific ratings.","2edf4d40":"**Correlation Table**","bd5ac36f":"As a longtime FIFA player and soccer fan, I always enjoyed the Ultimate Team game mode. In this game mode, you can build your own team filled with real life players from various clubs, and compete with other FIFA players' \"Ultimate Teams.\"\n\nI've always found it interesting how some of the best players in FIFA weren't the best players in real life, nor did they have the highest Overall Rating. This made me curious about what goes into a player's overall rating, and how this relates to their actual skill and value to a team in real life. For this analysis, I will use a player's wage as our best metric for a player's value to a team in real life, since I believe it best reflects what a team is willing to pay for them. Especially in a game as competitive as international soccer, I believe that teams will generally pay competitive wages that accurately reflect a player's true value.","ba6ac725":"**Random Forest**","4dbdb6f7":"For our models, I've chosen to go through with the following variables:\n1. Overall\n2. Special \n3. Composure\n4. Dribbling\n5. Vision\n6. Short Passing\n7. Ball Control\n\nI chose 3 - 7 because they were the 5 on field ratings with the highest correlation with Wage. ","b132bce8":"**Recap:** \n* Composure is a great indicator of a player's Overall Rating and Wage, so we'll make sure to include that in our models\n* Overall actually had a lower correlation with Wage(.58) than I would've expected\n* Each position group displayed a similar spread of ratings, so we don't necessarily have to make our models specific to any position group\n* Age has a low correlation with Wage and Overall, so it might not be important in our models","3c5076f4":"**Support Vector Machine**","8f54ecac":"We can replace all of these null values with the median for each category.","0e2310fb":"Let's get a better look at the spread of Overall Rating and Wage by Position Group.","47c7285f":"**Data Splitting**","98942f8d":"**Histograms for Wage**","7224dfcb":"We have a ton of data ranging from categorical data like club and nationality, to performance stats like Shot Power or Dribbling, and other metrics like Wage and Value. Rows 0-27 seem to be mostly categorical information about the player. Rows 28-53 help us understand the player's preferred positioning in a game. Rows 54-88 are evaluations of players skill in certain aspects of the game, decided by the developers of FIFA.\n\n\"Value\" is defined as the \"Current Market Value\" of the player. If they got traded today, this is an estimate of the transfer fee involved in the transaction. A transfer fee is the price a team has to pay for the player's rights when they are moving clubs. This metric could be helpful in our analysis.\n\n\"Special\" is linked with a player's flair attribute. Player's that are known for their flashy footwork and skill moves will likely have a high special stat.\n\nWe do have some issues. Wage and Value represent numerical data, but are expressed as objects in the data set. The code block below fixes this. ","5bde65f1":"**Overall Rating Distribution**","2ebc8da2":"# EDA","c6543c6e":"This line chart has no clear trend, which shows us that Age is not an important factor when examining a player's Overall Rating.\n\nThis could be affected by a survivorship bias however, since only the best players will continue to be signed with a team into their mid 30's. \n\nWe do see a 45 year old that maintained a 71 rating in FIFA 19, so let's just see who the 45 year old legend is.","ae53ce02":"We can see the mean Overall is about 66, meaning there are tons of players below that mark. For our analysis, we will just be focusing on players above a 70 rating, since those will be the players in the most popular international leagues (Premier League, Ligue Un, La Liga, etc.). ","81becf97":"**Fine Tuning the Linear Model**\n\nSince we observed a possible functional form misspecification, lets try to eliminate multicollinearity by only using one of the on field statistics(composure). Also, lets try to make it specific to a position group like forwards to see if that will give us more accuracy.","c2552430":"*For each model I'll include a graph of the predicted Log Wage versus the actual Log Wage. If my models were perfect, the graph would be a straight diagonal line. Evidently, they are not.","7fb9b917":"It seems that the SVM Mode underestimated the wages on the higher end of the spectrum.","86a94533":"# Models","617d8e8b":"For the SVM model, I'll use the rbf kernel to start off, since some of the parameters are nonlinear.","a7141595":"We can see that we have 89 columns worth of data for each player, so let's get a list of all the specific columns and their data types.","d54106bb":"**Decision Tree**","7adeeb9d":"# **FIFA 19 Player Ratings vs Real Life Wage**","d14290c1":"It seems that some of our variables have a negative coefficient, even though they had a positive correlation with Wage. I think this functional form misspecification is due to multicollinearity between variables like Composure, Dribbling and Vision, which all had moderately strong positive correlations with each other. ","885c0a34":"Let's also get a glimpse at the distributions for all of our numeric data to get a better understanding of what we are working with.","ed3f947c":"This is a much better distribution. It also seems there are some clusters of players that have the exact same low wage. This could be due to minimums that teams have to offer their players.","574e9f4e":"I'll use a Multiple Linear Regression as a starting point. MLR's easily interpretable coefficients might also give us a better understanding of some of the relationships within our model.","65cc5411":"**Line Charts**","83f183d2":"Wage, unlike Overall Rating, is dependant on age, as we see the slight upside down-u shaped trend on this line chart. \n\nThe peak for player wage occurs around the 30-32 age range. This could confirm my suspicion of a survivorship bias in the previous chart, since Wage declines before Overall in our two charts."}}