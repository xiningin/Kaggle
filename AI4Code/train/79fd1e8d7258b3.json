{"cell_type":{"9b93bc39":"code","2f3bd743":"code","b2ad30da":"code","0de85944":"code","86930598":"code","284fd82a":"code","646b84ce":"code","972d1b17":"code","d5d81eb2":"code","cef8e1a4":"code","840994bd":"code","609cfdcd":"code","6a3603d6":"code","e80ab4be":"code","71195c59":"code","1ace0dd4":"code","3c4ddaf1":"code","f8205f8e":"code","1616acfc":"code","3c9972b7":"code","33077d91":"code","ad53c4b5":"code","84077b92":"code","62f1b3c3":"code","8034f0e3":"code","00ae7b35":"code","c8edb44d":"code","bcff0a9f":"code","d191f586":"code","9396ff82":"code","5ae6fafe":"code","2454801f":"code","2c6cdcda":"code","e44282a6":"code","c925ba89":"code","49b76d65":"code","faf5dc70":"code","d9577655":"code","0f900e82":"code","7508cc78":"code","7c0f1c77":"code","d076ab1d":"code","01b6c4d5":"code","289bd967":"code","1c8e0d1e":"code","9559cb7f":"code","21f52305":"code","b3744620":"code","6c1ef8dc":"code","b37201ef":"code","0ab47547":"code","919c306d":"code","2a7f0393":"code","2a31bde2":"code","cf49419c":"code","89d18181":"code","c3f839e2":"code","4934b23a":"code","5836c978":"code","566ced70":"code","43b0f6ab":"code","e0bda6ca":"code","517b79d0":"code","be0e5eb8":"markdown","5c2f0901":"markdown"},"source":{"9b93bc39":"import numpy as np\nimport pandas as pd\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nimport tensorflow as tf\nfrom tensorflow import keras\n\nfrom sklearn.preprocessing import MinMaxScaler\n\nfrom tensorflow.keras.preprocessing.sequence import TimeseriesGenerator\n\nfrom tensorflow.keras.models import Sequential\nfrom tensorflow.keras.layers import Dense, LSTM\n\nfrom tensorflow.keras.callbacks import EarlyStopping","2f3bd743":"dataset_path = '..\/input\/retail-sales-clothing-clothing-accessory-stores\/RSCCASN.csv'","b2ad30da":"sales_data = pd.read_csv(dataset_path,  parse_dates=True, index_col='DATE')","0de85944":"type(sales_data)","86930598":"sales_data.columns","284fd82a":"sales_data.columns = ['Sales']","646b84ce":"sales_data.columns","972d1b17":"print(sales_data.info())","d5d81eb2":"print(sales_data.describe())","cef8e1a4":"sales_data.head()","840994bd":"sales_data.tail()","609cfdcd":"sales_data.plot(figsize=(12, 8))","6a3603d6":"len(sales_data)","e80ab4be":"len(sales_data) - 18    # 1.5 year","71195c59":"test_size = 18\ntest_index = len(sales_data) - test_size","1ace0dd4":"test_index","3c4ddaf1":"train = sales_data.iloc[:test_index]\ntest = sales_data.iloc[test_index:]","f8205f8e":"train.head()","1616acfc":"train.tail()","3c9972b7":"test.head()","33077d91":"test.tail()","ad53c4b5":"# help(MinMaxScaler)","84077b92":"scaler = MinMaxScaler()","62f1b3c3":"scaler.fit(train)","8034f0e3":"scaled_train = scaler.transform(train)\nscaled_test = scaler.transform(test)","00ae7b35":"scaled_train[:5]","c8edb44d":"scaled_test[:5]","bcff0a9f":"# help(TimeseriesGenerator)","d191f586":"length = 12","9396ff82":"generator = TimeseriesGenerator(scaled_train, scaled_train, length=length, batch_size=1)","5ae6fafe":"X, y = generator[0]","2454801f":"X","2c6cdcda":"y","e44282a6":"len(X[0])","c925ba89":"# help(LSTM)","49b76d65":"n_features = 1","faf5dc70":"model = Sequential()\nmodel.add(LSTM(100, activation='relu', input_shape=(length, n_features)))\nmodel.add(Dense(1))\n\nmodel.compile(optimizer='adam', loss='mse')","d9577655":"model.summary()","0f900e82":"# help(EarlyStopping)","7508cc78":"early_stop = EarlyStopping(monitor='val_loss', patience=2)","7c0f1c77":"validation_generator = TimeseriesGenerator(scaled_test, scaled_test, length=length, batch_size=1)","d076ab1d":"model.fit(generator, epochs=20, \n          validation_data=validation_generator,\n          callbacks=[early_stop])","01b6c4d5":"losses = pd.DataFrame(model.history.history)","289bd967":"losses.plot()","1c8e0d1e":"test_predictions = []\n\nfirst_eval_batch = scaled_train[-length:]\ncurrent_batch = first_eval_batch.reshape((1, length, n_features))\n\nfor i in range(len(test)):\n    \n    # get prediction 1 time  stamp ahead \n    current_pred = model.predict(current_batch)[0]\n    \n    # store prediction \n    test_predictions.append(current_pred)\n    \n    # update batch to now include prediction and drop first value \n    current_batch = np.append(current_batch[:, 1:, :], [[current_pred]], axis=1)","9559cb7f":"true_prediction = scaler.inverse_transform(test_predictions)","21f52305":"test['Predictions'] = true_prediction","b3744620":"test","6c1ef8dc":"test.plot(figsize=(12, 8))","b37201ef":"full_scaler = MinMaxScaler()\nscaled_full_data = full_scaler.fit_transform(sales_data)","0ab47547":"length = 12\ngenerator = TimeseriesGenerator(scaled_full_data, scaled_full_data, \n                                length=length, batch_size=1)","919c306d":"model = Sequential()\nmodel.add(LSTM(100, activation='relu', input_shape=(length, n_features)))\nmodel.add(Dense(1))\n\nmodel.compile(optimizer='adam', loss='mse')\n\nmodel.fit(generator, epochs=8)","2a7f0393":"forecast = []\n# Replace periods with whatever forecast lengt you want \nperiods = 12\n\nfirst_eval_batch = scaled_full_data[-length:]\ncurrent_batch = first_eval_batch.reshape((1, length, n_features))\n\nfor i in range(periods):\n    \n    # get prediction 1 time  stamp ahead \n    current_pred = model.predict(current_batch)[0]\n    \n    # store prediction \n    forecast.append(current_pred)\n    \n    # update batch to now include prediction and drop first value \n    current_batch = np.append(current_batch[:, 1:, :], [[current_pred]], axis=1)","2a31bde2":"forecast = scaler.inverse_transform(forecast)","cf49419c":"sales_data","89d18181":"forecast","c3f839e2":"forecast_index = pd.date_range(start='2019-11-01', periods=periods,\n                              freq='MS')","4934b23a":"forecast_index","5836c978":"forecast_data = pd.DataFrame(data=forecast, index=forecast_index, \n                             columns=['Forecast'])","566ced70":"forecast_data","43b0f6ab":"forecast_data.plot()","e0bda6ca":"ax = sales_data.plot()\nforecast_data.plot(ax=ax)","517b79d0":"ax = sales_data.plot()\nforecast_data.plot(ax=ax)\nplt.xlim('2018-01-01', '2020-12-01')","be0e5eb8":"**Time Series Forecasting**","5c2f0901":"**Happy Learning :)**"}}