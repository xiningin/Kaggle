{"cell_type":{"3d9fea7e":"code","c0a3ab59":"code","c504f30f":"code","5dd4b2ab":"code","93186448":"code","e367482c":"code","97c6bf4c":"code","412d881f":"code","95981634":"code","7ddf516d":"code","399f8e39":"code","b46f086c":"code","a42c0513":"code","6149f31e":"code","e204c18b":"code","b8afe4ed":"code","078cf8c6":"code","34c7b569":"code","d1a76441":"code","e5a12661":"code","24b9c5a7":"code","1e1313aa":"code","af1d17e7":"code","7421e470":"code","2a908596":"code","20458aa7":"code","86a9b8c7":"code","7d58831d":"code","e322fe91":"code","d3260c0c":"code","f5f954b0":"code","464fb3c6":"code","904d263a":"code","833e5569":"markdown","83bd2a94":"markdown","338c5053":"markdown","7d7aae12":"markdown","53f6ca7d":"markdown","f0e8704a":"markdown","ac8f75ae":"markdown","c1d3071c":"markdown","1ac8e029":"markdown","acea6112":"markdown","eecd38a4":"markdown","af59caa6":"markdown","a3e9096e":"markdown","4ca784e0":"markdown","48bc4adb":"markdown","cc66c848":"markdown","20958fd3":"markdown","7ad68353":"markdown","ccb24565":"markdown","0575c6e4":"markdown","53a7342f":"markdown","d62c8609":"markdown","059cd852":"markdown","0b5198d8":"markdown","234ab3da":"markdown","f6c04368":"markdown","1af7e782":"markdown","f1a803bf":"markdown"},"source":{"3d9fea7e":"import os\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set(style=\"ticks\", color_codes=True)\nimport pydicom","c0a3ab59":"list(os.listdir(\"..\/input\/osic-pulmonary-fibrosis-progression\"))","c504f30f":"folder_path = \"..\/input\/osic-pulmonary-fibrosis-progression\/\"\n\ntrain_df = pd.read_csv(folder_path + '\/train.csv')\ntest_df = pd.read_csv(folder_path + '\/test.csv')","5dd4b2ab":"train_df.head()","93186448":"train_df.info()","e367482c":"train_df.isnull().sum()","97c6bf4c":"# train_df['Patient'].value_counts().shape[0]\nprint(f\"No. of patients are {train_df['Patient'].count()} with {train_df['Patient'].value_counts().shape[0]} unique patient ids\")","412d881f":"train_patient_id = set(train_df['Patient'].unique())\ntest_patient_id = set(test_df['Patient'].unique())\n\ntrain_patient_id.intersection(test_patient_id)","95981634":"columns = list(train_df.columns)\nprint(f'The colums are {columns}')","7ddf516d":"train_df['Patient'].value_counts().max()","399f8e39":"folders = []\nfiles = []\n\npath = \"..\/input\/osic-pulmonary-fibrosis-progression\/train\"\n\nfor _, dirnames, filenames in os.walk(path):\n    files.append(len(filenames))\n    folders.append(len(dirnames))\n\nprint(f\"No. of patients\/folders:  {sum(folders)}\")\nprint(f\"No. of images\/files:  {sum(files)}\")\nprint(f\"AVG images\/files of patient:  {round(np.mean(files))}\")\nprint(f\"MAX images\/files of a patient:  {round(np.max(files))}\")","b46f086c":"patient_df = train_df[['Patient', 'Age', 'Sex', 'SmokingStatus']].drop_duplicates()\n\npatient_df.head()","a42c0513":"train_dir = '..\/input\/osic-pulmonary-fibrosis-progression\/train\/'\ntest_dir = '..\/input\/osic-pulmonary-fibrosis-progression\/test\/'\n\navailable_images = []\n\nfor patient_id in patient_df['Patient']:\n    available_images.append(len(os.listdir(train_dir + patient_id)))\n    \npatient_df[\"available_images\"] = available_images\n\npatient_df.head()","6149f31e":"patient_df[\"SmokingStatus\"].value_counts()","e204c18b":"plt.figure(figsize=(8, 6))\nsns.countplot(x='SmokingStatus', data=patient_df)\nplt.title('Smoking Status')\nplt.show()","b8afe4ed":"train_df['Weeks'].value_counts()","078cf8c6":"n_bins = int(np.sqrt(len(train_df[\"Weeks\"])))\n\nplt.figure(figsize=(12, 8))\nsns.distplot(train_df[\"Weeks\"],bins=n_bins, kde=False)\nplt.title('Week Distribution')\nplt.show()","34c7b569":"plt.figure(figsize=(12, 6))\nsns.distplot(train_df[\"Age\"], hist=False, kde_kws=dict(lw=6, ls=\"--\"))\n# sns.countplot(x=\"Age\", data=train_df, order=train_df['Age'].value_counts().index)\nplt.title(\"Age count\")\nplt.show()","d1a76441":"plt.figure(figsize=(8, 6))\nsns.catplot(x='Sex', kind='count', data=train_df)\nplt.title('Sex Count')","e5a12661":"train_df['FVC'].value_counts()","24b9c5a7":"plt.figure(figsize=(12, 6))\nsns.boxplot(train_df['FVC'])\nplt.show()","1e1313aa":"n_bins = int(np.sqrt(len(train_df[\"FVC\"])))\n\nplt.figure(figsize=(12, 6))\nsns.distplot(train_df[\"FVC\"], bins=n_bins, kde=False)\nplt.title('Distribution of the FVC')\nplt.show()","af1d17e7":"n_bins = int(np.sqrt(len(train_df[\"Percent\"])))\n\nplt.figure(figsize=(12, 6))\nsns.distplot(train_df[\"Percent\"], bins=n_bins, kde=False)\nplt.title('Distribution of the Percent')\nplt.show()","7421e470":"plt.figure(figsize=(12, 6))\nsns.kdeplot(patient_df.loc[patient_df['Sex'] == 'Male', 'Age'], label = 'Male',shade=True)\nsns.kdeplot(patient_df.loc[patient_df['Sex'] == 'Female', 'Age'], label = 'Female',shade=True)\nplt.xlabel('Age (years)')\nplt.ylabel('Density')\nplt.title('Age vs Sex')","2a908596":"temp_df = patient_df.groupby(['Sex', 'SmokingStatus'])['Sex'].count().unstack(['Sex'])\ntemp_df.plot.bar(rot=0, figsize=(12, 6))\nplt.title('Sex vs SmokingStatus')\nplt.show()","20458aa7":"plt.figure(figsize=(12, 6))\nsns.kdeplot(patient_df.loc[patient_df['SmokingStatus'] == 'Ex-smoker', 'Age'], label = 'Ex-smoker',shade=True)\nsns.kdeplot(patient_df.loc[patient_df['SmokingStatus'] == 'Never smoked', 'Age'], label = 'Never smoked',shade=True)\nsns.kdeplot(patient_df.loc[patient_df['SmokingStatus'] == 'Currently smokes', 'Age'], label = 'Currently smokes', shade=True)\nplt.xlabel('Age (years)')\nplt.ylabel('Density')\nplt.title('Age vs SmokingStatus');","86a9b8c7":"plt.figure(figsize=(12,12))\nsns.jointplot(x=train_df[\"FVC\"], y=train_df[\"Percent\"],size=10)\nplt.title(\"Joint plot FVC vs Percent\")\nplt.show()","7d58831d":"plt.figure(figsize=(12,12))\nsns.jointplot(x=train_df[\"FVC\"], y=train_df[\"Percent\"], kind='kde',size=10)\nplt.title(\"Joint plot FVC vs Percent\")\nplt.show()","e322fe91":"plt.figure(figsize=(12,12))\nsns.jointplot(x=train_df[\"FVC\"], y=train_df[\"Age\"],size=10)\nplt.title(\"Joint plot FVC vs Percent\")\nplt.show()","d3260c0c":"plt.figure(figsize=(12,12))\nsns.jointplot(x=train_df[\"FVC\"], y=train_df[\"Age\"], kind='kde',size=10)\nplt.title(\"Joint plot FVC vs Percent\")\nplt.show()","f5f954b0":"corr = train_df.corr()\nf, ax = plt.subplots(figsize =(9, 8)) \nsns.heatmap(corr, ax = ax, cmap = 'RdYlBu_r', linewidths = 0.5) ","464fb3c6":"# Normalization\ntrain_df['Age'] = (train_df['Age'] - train_df['Age'].min() ) \/ ( train_df['Age'].max() - train_df['Age'].min() )\ntrain_df['FVC'] = (train_df['FVC'] - train_df['FVC'].min() ) \/ ( train_df['FVC'].max() - train_df['FVC'].min() )\ntrain_df['Weeks'] = (train_df['Weeks'] - train_df['Weeks'].min() ) \/ ( train_df['Weeks'].max() - train_df['Weeks'].min() )\ntrain_df['Percent'] = (train_df['Percent'] - train_df['Percent'].min() ) \/ ( train_df['Percent'].max() - train_df['Percent'].min() )","904d263a":"imdir = \"\/kaggle\/input\/osic-pulmonary-fibrosis-progression\/train\/ID00123637202217151272140\"\nprint(\"total images for patient ID00123637202217151272140: \", len(os.listdir(imdir)))\n\nfig=plt.figure(figsize=(12, 12))\ncolumns = 4\nrows = 5\nimglist = os.listdir(imdir)\nfor i in range(1, columns*rows +1):\n    filename = imdir + \"\/\" + str(i) + \".dcm\"\n    ds = pydicom.dcmread(filename)\n    fig.add_subplot(rows, columns, i)\n    plt.imshow(ds.pixel_array, cmap='gray')\nplt.show()","833e5569":"# Aim of this competition -\n In this competition we have to predict a patient\u2019s severity of decline in lung function based on a CT scan of their lungs. We have to determine lung function based on output from a spirometer, which measures the volume of air inhaled and exhaled. The challenge is to use machine learning techniques to make a prediction with the image, metadata, and baseline FVC as input.","83bd2a94":"# Check correlation","338c5053":"Check if any col has missing vals","7d7aae12":"Columns\n* Patient- a unique Id for each patient (also the name of the patient's DICOM folder)\n* Weeks- the relative number of weeks pre\/post the baseline CT (may be negative)\n* FVC - the recorded lung capacity in ml\n* Percent- a computed field which approximates the patient's FVC as a percent of the typical FVC for a person of similar characteristics\n* Age\n* Sex\n* SmokingStatus","53f6ca7d":"# Age vs FVC","f0e8704a":"# FVC column","ac8f75ae":"What to do we know after doing the EDA ?\n* most of the patients are ex-smoker\n* most of the week values are within 5 - 19 \n* most patients are aged between 65 - 73\n* most of the patients are male\n* most ex-smokers are male\n* most of the patients who currently smokes are aged nearly 70 and they are mostly male\n* fvc value 3000 is more frequent on the dataset for ages nearer to 70\n* FVC and Percent column are highly correlated","c1d3071c":"# Weeks distribution column","1ac8e029":"Check the max occurance of a patient id","acea6112":"# Feature Engineering","eecd38a4":"# Age column","af59caa6":"# Percent Column","a3e9096e":"# Age vs SmokingStatus","4ca784e0":"Store the number of images available for each patient on a new column","48bc4adb":"# FVC vs Percent","cc66c848":"# Sex column","20958fd3":"So FVC and Percent is more correlated than others","7ad68353":"# Now we will look at DECOM images of a patient","ccb24565":"So most of the patients are male","0575c6e4":"# Exploring smoking status column","53a7342f":"We can treat the FVC value greater than 6000 as an outlier","d62c8609":"# The Evaluation Metric -\n\nThis competition is evaluated on a modified version of the Laplace Log Likelihood\n\nI would like to recommend https:\/\/www.kaggle.com\/rohanrao\/osic-understanding-laplace-log-likelihood to learn more about Laplace Log Likelihood\n","059cd852":"# Age vs Sex","0b5198d8":"Creating unique patient id df","234ab3da":"\ud83d\udd25 Now let's start by looking at the data and doing some EDA  \ud83d\udd25","f6c04368":"All test set patient ids are also present in the train !","1af7e782":"Check if any train set unique patient id is in test set","f1a803bf":"# Sex vs SmokingStatus"}}