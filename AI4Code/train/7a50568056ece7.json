{"cell_type":{"461bd117":"code","740463b9":"code","27a51b1c":"code","e5b7a730":"code","4b31710f":"code","586da09f":"code","5b7b6d0d":"code","c02144ad":"code","0bb7e574":"code","94e58b96":"code","17eb3c1f":"code","f518e410":"code","3e9c37ff":"code","50701892":"code","9944d894":"code","bf386506":"code","ecb8666b":"code","f5820c34":"code","8a9a85fb":"code","5ab3cd01":"code","faf79628":"code","9b2d70eb":"code","b7938bc8":"code","2e5d7669":"code","63814368":"code","de6e77cc":"code","c733ac1b":"code","29970dd0":"code","db3dad43":"code","18d84425":"code","abd4464a":"code","36e1c1e8":"code","36cd5ecd":"code","ae2554cc":"code","47a0cb89":"code","75f6c429":"code","51993690":"code","9d2995a2":"code","6b5935c8":"code","bbd12efd":"code","de361630":"markdown","3a5d4b12":"markdown","62bff26f":"markdown","56a3bbaa":"markdown","1bdaa812":"markdown","3d781caa":"markdown","f7abfae4":"markdown","fa500ae2":"markdown","40308d7a":"markdown","09ddd5bc":"markdown","84dfa22c":"markdown","fdd8fd75":"markdown","74c25934":"markdown","a4cb9021":"markdown","190a4ed0":"markdown"},"source":{"461bd117":"import pandas as pd\nimport sklearn\nimport matplotlib.pyplot as plt\nimport numpy as np","740463b9":"train_data = \"..\/input\/costa-rican-household-poverty-prediction\/train.csv\"\ntest_data = \"..\/input\/costa-rican-household-poverty-prediction\/test.csv\"","27a51b1c":"train_df = pd.read_csv(train_data)","e5b7a730":"train_df.shape","4b31710f":"train_df = train_df.groupby('idhogar').first()","586da09f":"train_df.shape","5b7b6d0d":"train_df.head()","c02144ad":"attributes = list(train_df)\nattributes","0bb7e574":"ntrain_df = train_df.dropna()","94e58b96":"ntrain_df.shape","17eb3c1f":"na_per_column = train_df.isna().sum()\nna_per_column","f518e410":"nan_indexes = na_per_column.nonzero()\nnan_indexes","3e9c37ff":"na_per_column[nan_indexes[0]]","50701892":"train_df[['v2a1','v18q1','rez_esc','meaneduc','SQBmeaned']].describe()","9944d894":"train_df['v18q1'] = train_df['v18q1'].fillna(0)\ntrain_df['meaneduc'] = train_df['meaneduc'].fillna(4)\ntrain_df['SQBmeaned'] = train_df['SQBmeaned'].fillna(97)","bf386506":"train_df[['v18q1','meaneduc','SQBmeaned']].describe()","ecb8666b":"na_per_column = train_df.isna().sum()\nnan_indexes = na_per_column.nonzero()\nna_per_column[nan_indexes[0]]","f5820c34":"wall_col = ['paredblolad','paredzocalo', 'paredpreb', 'pareddes', 'paredmad', 'paredzinc','paredfibras', 'paredother']","8a9a85fb":"def join_binary_columns(df, cols, new_column_label):\n    df[new_column_label] = df[cols[0]]\n    for i in range(1,len(cols)):\n        df[new_column_label] = df[new_column_label] + df[cols[i]]*(2**i)\n    return df.drop(columns = cols)","5ab3cd01":"train_df = join_binary_columns(train_df, wall_col, 'wall')","faf79628":"train_df['wall'].describe()","9b2d70eb":"train_df['wall'].value_counts().plot(kind=\"bar\")","b7938bc8":"floor_col = ['pisonotiene', 'pisomoscer', 'pisocemento', 'pisoother', 'pisonatur', 'pisomadera']\nroof_col = ['techozinc', 'techoentrepiso', 'techocane', 'techootro']\nwater_col = ['abastaguadentro', 'abastaguafuera', 'abastaguano']\nelectricity_col = ['public', 'planpri', 'noelec', 'coopele']\ntoilet_col = ['sanitario1', 'sanitario2', 'sanitario3', 'sanitario5', 'sanitario6']\nenergy_col = ['energcocinar1', 'energcocinar2', 'energcocinar3', 'energcocinar4']\nrubbish_col = ['elimbasu1', 'elimbasu2', 'elimbasu3', 'elimbasu4', 'elimbasu5', 'elimbasu6']\nqua_wall_col = ['epared1', 'epared2', 'epared3']\nqua_roof_col = ['etecho1', 'etecho2', 'etecho3']\nqua_floor_col = ['eviv1', 'eviv2', 'eviv3']\nhouse_state_col = ['tipovivi1', 'tipovivi2', 'tipovivi3', 'tipovivi4', 'tipovivi5']\nlocation_col = ['lugar1', 'lugar2', 'lugar3', 'lugar4', 'lugar5', 'lugar6']\narea_col = ['area1', 'area2']\n# some social variables aggregation that maybe useful to refine training (not used in this notebook)\n# males_col = ['r4h1', 'r4h2', 'r4h3']\n# females_col = ['r4m1', 'r4m2', 'r4m3']\n# person_col = ['r4t1', 'r4t2', 'r4t3']\n# civil_state_col = ['estadocivil1', 'estadocivil2', 'estadocivil3', 'estadocivil4', 'estadocivil5', 'estadocivil6', 'estadocivil7']\n# family_col = ['parentesco1', 'parentesco2', 'parentesco3', 'parentesco4', 'parentesco5', 'parentesco6', 'parentesco7', 'parentesco8', 'parentesco9', 'parentesco10', 'parentesco11', 'parentesco12']","2e5d7669":"train_df = join_binary_columns(train_df, floor_col, 'floor')\ntrain_df = join_binary_columns(train_df, roof_col, 'roof')\ntrain_df = join_binary_columns(train_df, water_col, 'water')\ntrain_df = join_binary_columns(train_df, electricity_col, 'electricity')\ntrain_df = join_binary_columns(train_df, toilet_col, 'toilet')\ntrain_df = join_binary_columns(train_df, energy_col, 'energy')\ntrain_df = join_binary_columns(train_df, rubbish_col, 'rubbish')\ntrain_df = join_binary_columns(train_df, qua_wall_col, 'qua_wall')\ntrain_df = join_binary_columns(train_df, qua_roof_col, 'qua_roof')\ntrain_df = join_binary_columns(train_df, qua_floor_col, 'qua_roof')\ntrain_df = join_binary_columns(train_df, house_state_col, 'house_state')\ntrain_df = join_binary_columns(train_df, location_col, 'location')\ntrain_df = join_binary_columns(train_df, area_col, 'area')","63814368":"train_df[\"Target\"].value_counts().plot(kind=\"bar\")","de6e77cc":"attributes = list(train_df)\nattributes","c733ac1b":"from sklearn import preprocessing\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.model_selection import cross_val_score\nfrom sklearn.metrics import accuracy_score","29970dd0":"drop_columns = ['v2a1', 'rez_esc']\ntrain_df = train_df.drop(columns = ['v2a1', 'rez_esc'])\nattributes.remove('Target')\nattributes.remove('Id')\nfor e in drop_columns:\n    attributes.remove(e)","db3dad43":"corr = train_df[attributes].apply(preprocessing.LabelEncoder().fit_transform).apply(lambda x: x.corr(train_df.Target))\ncorr","18d84425":"corr_thresh = 0.2\ncorr.where(abs(corr) > corr_thresh).dropna()","abd4464a":"train_attr = corr.where(abs(corr) > corr_thresh).dropna().index.values","36e1c1e8":"train_attr","36cd5ecd":"train_df_x = train_df[train_attr].apply(preprocessing.LabelEncoder().fit_transform)\ntrain_df_y = train_df.Target","ae2554cc":"test_df = pd.read_csv(test_data)\ntest_df['v18q1'] = test_df['v18q1'].fillna(0)\ntest_df['meaneduc'] = test_df['meaneduc'].fillna(4)\ntest_df['SQBmeaned'] = test_df['SQBmeaned'].fillna(97)\ntest_df = join_binary_columns(test_df, wall_col, 'wall')\ntest_df = join_binary_columns(test_df, floor_col, 'floor')\ntest_df = join_binary_columns(test_df, roof_col, 'roof')\ntest_df = join_binary_columns(test_df, water_col, 'water')\ntest_df = join_binary_columns(test_df, electricity_col, 'electricity')\ntest_df = join_binary_columns(test_df, toilet_col, 'toilet')\ntest_df = join_binary_columns(test_df, energy_col, 'energy')\ntest_df = join_binary_columns(test_df, rubbish_col, 'rubbish')\ntest_df = join_binary_columns(test_df, qua_wall_col, 'qua_wall')\ntest_df = join_binary_columns(test_df, qua_roof_col, 'qua_roof')\ntest_df = join_binary_columns(test_df, qua_floor_col, 'qua_roof')\ntest_df = join_binary_columns(test_df, house_state_col, 'house_state')\ntest_df = join_binary_columns(test_df, location_col, 'location')\ntest_df = join_binary_columns(test_df, area_col, 'area')\ntest_df_x = test_df[train_attr].apply(preprocessing.LabelEncoder().fit_transform)","47a0cb89":"columns = ['neighbors', 'scores']\nresults = [columns]\nfor n in range (5, 40):\n    neighbors = n\n    cross = 5\n    knn = KNeighborsClassifier(n_neighbors = neighbors)\n    scores = cross_val_score(knn, train_df_x, train_df_y, cv = cross)\n    results.append([neighbors, scores])","75f6c429":"import statistics as st\n\nanalysis = [['neighbors', 'mean', 'max', 'min']]\nfor i in range(1, len(results)):\n    analysis.append([results[i][0], st.mean(results[i][1]), max(results[i][1]), min(results[i][1])])","51993690":"analysis","9d2995a2":"neighbors = 32\ncross = 5\nKNeighborsClassifier(n_neighbors = neighbors)\ncross_val_score(knn, train_df_x, train_df_y, cv = cross)\nknn.fit(train_df_x, train_df_y)\ntest_pred_y = knn.predict(test_df_x)\ntest_pred_y","6b5935c8":"result = pd.DataFrame({'Id':test_df.Id.values, 'Target':test_pred_y})\nresult","bbd12efd":"result.to_csv(\"submission.csv\", index = False)","de361630":"### Dealing with binary columns\nIn this database we have many columns with binary data, only to express whether an attribute is present or not in the household, therefore let's combine those columns into a single one according to its characteristic, taking the walls attribute as an example","3a5d4b12":"Still, many variables, let's just see the correlation between the variables and output","62bff26f":"Filtering with the best correlation we can find","56a3bbaa":"From the data field description:\n\nv2a1, Monthly rent payment\n\nv18q1, number of tablets household owns\n\nrez_esc, Years behind in school\n\nmeaneduc,average years of education for adults (18+)\n\nSQBmeaned, square of the mean years of education of adults (>=18) in the household","1bdaa812":"From the output above we can filter the collumns with missing data and see which one have too many, therefore should be discarded\n\nGetting the indexes of the columns with missing data:","3d781caa":"Getting the collumn names and the respectives amount of missing data","f7abfae4":"### Data analysis\nAfter filtering and managing the data, we can start doing some analysis","fa500ae2":"Applying the same data preparation to test dataframe","40308d7a":"### Dealing with missing data\nAnalizying the missing data variables","09ddd5bc":"### Intro\nSince it should be an analysis by household: grouping by the household id","84dfa22c":"cleared the nan values","fdd8fd75":"Applying this transformation to the other many binary decomposed variables:\n- Floor\n- Roof\n- Water provision\n- Electricity\n- Toilet\n- Energy cooking\n- Rubbish disposal\n- quality of walls\n- quality of roof\n- quality of floor\n- State of house\n- location of house","74c25934":"From above info, we see that applying dropna() directly to the raw data it is left with few rows, since the amount of data is not great we need to analyze and see which collumns have missing data","a4cb9021":"So much smaller, let's start exploring the data","190a4ed0":"From the analysis above, for 'v18q1' we can infer that the missing data are household with 0 tablets, and for 'meaneduc' and 'SQB meaned' we can use the standard value."}}