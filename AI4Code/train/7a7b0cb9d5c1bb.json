{"cell_type":{"b619bee2":"code","d3716dba":"code","f353f44c":"code","63c6c253":"code","e3764e43":"code","fb757511":"code","59d66cf9":"code","1982cead":"code","a63a6f18":"code","1faaf39b":"code","8c3786f3":"code","ab9b8949":"code","0f25a86b":"code","b1d38d2e":"code","e9520e5e":"code","69a10c11":"code","6e4079dd":"code","c2cc92e5":"code","e3bc6f30":"code","d3534491":"code","e29926bb":"code","dd3a41c0":"code","0775108b":"code","c328db0e":"code","792ec829":"code","82349544":"code","7a1967c9":"code","bb91600d":"code","0c6602e6":"code","6cbafa16":"code","7af48488":"markdown","1d5846ca":"markdown","049d35ff":"markdown","260e9277":"markdown","b826452f":"markdown","6cb70ce3":"markdown","f761a9b7":"markdown","d10e19b4":"markdown","70ea530a":"markdown","d3ccb079":"markdown","4b8aa2d2":"markdown","2c43e43b":"markdown","8acf72fe":"markdown","f3b314ef":"markdown","ee558d7c":"markdown","a719b1dc":"markdown","0b2c3dc3":"markdown"},"source":{"b619bee2":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nimport seaborn as sns\n\nimport warnings\nwarnings.filterwarnings(\"ignore\")","d3716dba":"data = pd.read_csv('..\/input\/Mall_Customers.csv')","f353f44c":"data.info()","63c6c253":"data.head()","e3764e43":"data.shape","fb757511":"#Count of males & females\nplt.title('Count of Males & Females')\nsns.set(style=\"darkgrid\")\nsns.countplot(x = 'Gender', data = data)","59d66cf9":"#Exploring Customer Spending Section\nplt.title('Customer Spending Score distribution')\nsns.distplot(data['Spending Score (1-100)'], color=\"g\", kde = False)","1982cead":"#Exploring Customer Income Section\nplt.title('Customer Income distribution')\nsns.distplot(data['Annual Income (k$)'], color=\"b\", kde = True)","a63a6f18":"plt.title('Customer logged Income distribution')\nsns.distplot(np.log(data['Annual Income (k$)']), color=\"b\", kde = True)","1faaf39b":"sqrt_tran = data.apply(lambda x: x['Annual Income (k$)'] ** 0.5, axis=1)\nplt.title('Customer Squared Root Transformed Income distribution')\nsns.distplot(sqrt_tran, color=\"b\", kde = True)","8c3786f3":"#Customer age distribution in terms of gender\nplt.title('Customer age distribution in terms of gender')\nax = sns.violinplot(x=\"Gender\", y=\"Age\",\n                   data=data, palette=\"Blues\", split=True)","ab9b8949":"#Customer Income distribution in terms of gender\nplt.title('Customer income distribution in terms of gender')\nax = sns.violinplot(x=\"Gender\", y=\"Annual Income (k$)\",\n                   data=data, palette=\"GnBu_d\", split=True)","0f25a86b":"#Customer Spending Score distribution in terms of gender\nplt.title('Customer spending distribution in terms of gender')\nax = sns.violinplot(x=\"Gender\", y=\"Spending Score (1-100)\",\n                   data=data, palette=\"coolwarm\", split=True)","b1d38d2e":"sns.jointplot(\"Annual Income (k$)\", \"Spending Score (1-100)\", data=data, color=\"m\")","e9520e5e":"sns.jointplot(\"Age\", \"Spending Score (1-100)\", data=data, color=\"b\")","69a10c11":"sns.jointplot(\"Age\", \"Annual Income (k$)\", data=data, color=\"r\")","6e4079dd":"#Regression plot from Kushal\n#https:\/\/www.kaggle.com\/kushal1996\/customer-segmentation-k-means-analysis\n\nplt.figure(1 , figsize = (15 , 7))\nn = 0 \nfor x in ['Age' , 'Annual Income (k$)' , 'Spending Score (1-100)']:\n    for y in ['Age' , 'Annual Income (k$)' , 'Spending Score (1-100)']:\n        n += 1\n        plt.subplot(3 , 3 , n)\n        plt.subplots_adjust(hspace = 0.5 , wspace = 0.5)\n        sns.regplot(x = x , y = y , data = data)\n        plt.ylabel(y.split()[0]+' '+y.split()[1] if len(y.split()) > 1 else y )\nplt.show()","c2cc92e5":"#Dummy encoding the gender variable\none_hot = pd.get_dummies(data['Gender'])\ndata_2 = data.join(one_hot)\ndata_2 = data_2.drop(['Gender', 'Male'], axis = 1)\ndata_2.head()","e3bc6f30":"data_without_id = data_2.drop('CustomerID', axis = 1)\ndata_without_id.rename(columns={'Female':'Is_Female', 'Spending Score (1-100)': 'Spending_Score',\n                               'Annual Income (k$)':'Annual_Income'}, inplace=True)\ncolormap = plt.cm.inferno\nplt.figure(figsize=(8,6))\nplt.title('Pearson Correlation of Features', y=1.05, size=15)\nsns.heatmap(data_without_id.corr(),linewidths=0.1,vmax=1.0, \n            square=True, cmap=colormap, linecolor='white', annot=True)","d3534491":"from sklearn.cluster import KMeans\nfrom sklearn import metrics\nfrom scipy.spatial.distance import cdist\n\n# k means determine k\ndef PlotElbow(X):\n    distortions = []\n    K = range(1,10)\n    for k in K:\n        kmeanModel = KMeans(n_clusters=k).fit(X)\n        kmeanModel.fit(X)\n        distortions.append(sum(np.min(cdist(X, kmeanModel.cluster_centers_, 'euclidean'), axis=1)) \/ X.shape[0])\n\n    # Plot the elbow\n    plt.figure(figsize = (10, 8))\n    plt.plot(K, distortions, 'bx-')\n    plt.xlabel('k')\n    plt.ylabel('Distortion')\n    plt.title('The Elbow Method showing the optimal k')\n    plt.show()","e29926bb":"#We started off by clustering age vs spending score\ndata_age = data_without_id[['Age' , 'Spending_Score']].iloc[: , :].values\n\nPlotElbow(data_age)","dd3a41c0":"#The follow plot is from Kushal: referring to\n#https:\/\/www.kaggle.com\/kushal1996\/customer-segmentation-k-means-analysis\n#Fit model and plot the graph\nalgorithm = (KMeans(n_clusters = 4 ,init='k-means++', n_init = 10 ,max_iter=300, \n                        tol=0.0001,  random_state= 111  , algorithm='elkan') )\nalgorithm.fit(data_age)\nlabels1 = algorithm.labels_\ncentroids1 = algorithm.cluster_centers_","0775108b":"h = 0.02\nx_min, x_max = data_age[:, 0].min() - 1, data_age[:, 0].max() + 1\ny_min, y_max = data_age[:, 1].min() - 1, data_age[:, 1].max() + 1\nxx, yy = np.meshgrid(np.arange(x_min, x_max, h), np.arange(y_min, y_max, h))\nZ = algorithm.predict(np.c_[xx.ravel(), yy.ravel()]) ","c328db0e":"plt.figure(1 , figsize = (15 , 7) )\nplt.clf()\nZ = Z.reshape(xx.shape)\nplt.imshow(Z , interpolation='nearest', \n           extent=(xx.min(), xx.max(), yy.min(), yy.max()),\n           cmap = plt.cm.Pastel2, aspect = 'auto', origin='lower')\n\nplt.scatter( x = 'Age' ,y = 'Spending Score (1-100)' , data = data , c = labels1 , \n            s = 200 )\nplt.scatter(x = centroids1[: , 0] , y =  centroids1[: , 1] , s = 300 , c = 'red' , alpha = 0.5)\nplt.ylabel('Spending Score (1-100)') , plt.xlabel('Age')\nplt.show()","792ec829":"#Then we do spending score vs annual income\ndata_income = data_without_id[['Annual_Income' , 'Spending_Score']].iloc[: , :].values\n\nPlotElbow(data_income)","82349544":"#As we expected, k = 5 is the right cluster where the elbow forms\n#Fit model and plot the graph\nalgorithm = (KMeans(n_clusters = 5 ,init='k-means++', n_init = 10 ,max_iter=300, \n                        tol=0.0001,  random_state= 111  , algorithm='elkan') )\nalgorithm.fit(data_income)\nlabels2 = algorithm.labels_\ncentroids2 = algorithm.cluster_centers_\n\nh = 0.02\nx_min, x_max = data_income[:, 0].min() - 1, data_income[:, 0].max() + 1\ny_min, y_max = data_income[:, 1].min() - 1, data_income[:, 1].max() + 1\nxx, yy = np.meshgrid(np.arange(x_min, x_max, h), np.arange(y_min, y_max, h))\nZ = algorithm.predict(np.c_[xx.ravel(), yy.ravel()])\n\nplt.figure(1 , figsize = (15 , 7) )\nplt.clf()\nZ = Z.reshape(xx.shape)\nplt.imshow(Z , interpolation='nearest', \n           extent=(xx.min(), xx.max(), yy.min(), yy.max()),\n           cmap = plt.cm.Pastel2, aspect = 'auto', origin='lower')\n\nplt.scatter( x = 'Annual Income (k$)' ,y = 'Spending Score (1-100)' , data = data , c = labels2 , \n            s = 200 )\nplt.scatter(x = centroids2[: , 0] , y =  centroids2[: , 1] , s = 300 , c = 'red' , alpha = 0.5)\nplt.ylabel('Spending Score (1-100)') , plt.xlabel('Anuual Income')\nplt.show()","7a1967c9":"data_all = data_without_id[['Is_Female','Age', 'Annual_Income' , 'Spending_Score']].iloc[: , :].values\n\nPlotElbow(data_all)","bb91600d":"algorithm = (KMeans(n_clusters = 6 ,init='k-means++', n_init = 10 ,max_iter=300, \n                        tol=0.0001,  random_state= 111  , algorithm='elkan') )\nalgorithm.fit(data_all)\nlabels3 = algorithm.labels_\ncentroids3 = algorithm.cluster_centers_","0c6602e6":"import plotly as py\nimport plotly.graph_objs as go\npy.offline.init_notebook_mode(connected = True)","6cbafa16":"data['label3'] =  labels3\ntrace1 = go.Scatter3d(\n    x= data['Age'],\n    y= data['Spending Score (1-100)'],\n    z= data['Annual Income (k$)'],\n    mode='markers',\n     marker=dict(\n        color = data['label3'], \n        size= 20,\n        line=dict(\n            color= data['label3'],\n            width= 12\n        ),\n        opacity=0.8\n     )\n)\nnew_data = [trace1]\nlayout = go.Layout(\n    title= 'Clusters',\n    scene = dict(\n            xaxis = dict(title  = 'Age'),\n            yaxis = dict(title  = 'Spending Score'),\n            zaxis = dict(title  = 'Annual Income')\n        )\n)\nfig = go.Figure(data=new_data, layout=layout)\npy.offline.iplot(fig)","7af48488":"We will choose the point where our improvement stops declining rapidly creating this elbow shaped graph as our optimal value for k, in this case, k = 4 would be a good choice","1d5846ca":"From the data in this particular dataset, we can see neither of these 3 factors: annual income, age and spending score seems to correlate each other much. We can further demonstrate this correlation with heatmap. ","049d35ff":"We can see that the male customers registered for membership card is about 90, while female customers are about 110. The distribution of gender for membership card is slightly unbalanced.","260e9277":"### __Visualizing some features__","b826452f":"This plot is particularly interesting, it seems that it is composed of 5 different segment alreay:\n- Annual Income between 20 to 40 k upper part, spending score decreasing with the increase of income\n- Annual Income between 20 to 40 k lower part, spending score increase with the increase of income\n- Annual income between 40 to 60 k in the middle, the spending score scattered randomly in between 40 to 60\n- Annual Income between 70 to 140 k upper part, spending score decrease with the increase of income\n- Annual Income between 70 to 140 k lower part, spending score increase with the increase of income\n\nThis might enables us to select k = 5 as 5 clusters (each with a centroid) in latter part of the analysis","6cb70ce3":"- Although we have visualize the number of ks that we are going to use from previous graphs, it would be wise to use the ELBOW method to give us the k that has the smallest __sum of squared errors (SSE)__.\n\n\n- I think we do not need PCA before doing clustering, since we have relatively lower dimensions for this dataset. In addition, they are relatively independent of each other.\n\n\n- Lastly, it is a good idea to standardize the data before we do k-mean clustering. For this particular dataset, the range of each column of data is roughly set in between 1 to 100. So I will skip the standardization part. You could use standardscaler in sklearn lib to do it.","f761a9b7":"As we can see from the income section: the customer income is not normally distributed - The graph is skewed to the left. We can try to apply transformation to the income below: ","d10e19b4":"It seems that square root transformation do the best job normalizing the customer annual income column\n\n### __2d relationship between features__","70ea530a":"__Content__\n\nYou are owing a supermarket mall and through membership cards , you have some basic data about your customers like Customer ID, age, gender, annual income and spending score. Spending Score is something you assign to the customer based on your defined parameters like customer behavior and purchasing data.\n\nProblem Statement You own the mall and want to understand the customers like who can be easily converge [Target Customers] so that the sense can be given to marketing team and plan the strategy accordingly.","d3ccb079":"From the violin plot we can see that most of the male customers are around 33~34 while most of the female customers are around 31~33. ","4b8aa2d2":"Most male customers have income around 75k which is about the same with female customers.","2c43e43b":"Indeed, the highesr correlation in the heatmap is less tha 0.07. So we can say that these features are independent of each other","8acf72fe":"### __K-Means Clustering__","f3b314ef":"Most of the customer spending score is around 40, and the distribution of spending score is roughly symmetric.","ee558d7c":"The overall spending interquartile range 25% to 75% is slightly higher for female customers\n\nwhile the mean spending of male is slightly higher than female","a719b1dc":"### __Heat Map__","0b2c3dc3":"Tring out one more transformation technique"}}