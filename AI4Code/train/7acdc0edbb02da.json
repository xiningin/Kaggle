{"cell_type":{"c8b9db1c":"code","82728153":"code","240d299c":"code","2a4bb4f4":"code","df367859":"code","26c0747c":"code","1803741d":"code","924bdeb7":"code","9bc7d2a1":"code","d6f90917":"code","3ef17c8c":"code","3b01bb6e":"code","890276cf":"code","ce3b4789":"code","e6ee64ae":"code","60dc7092":"code","7b915aa7":"code","8c5ccffd":"code","bd1223c0":"code","916a388e":"code","958e1ccd":"code","bea9f3aa":"code","393bae9a":"code","ec577e6a":"code","409e8f97":"code","4851f4bf":"code","91e0156a":"code","d703225b":"code","2aa13edf":"code","ed7b4445":"code","50dd49a2":"markdown","109fa5e4":"markdown","ff5bb5fd":"markdown","c09d0db2":"markdown","de28ed6a":"markdown","ec2a8a6c":"markdown","f6042928":"markdown","2ef54d4e":"markdown","7bf6dccc":"markdown","d566a359":"markdown","3fe28a54":"markdown","40f48cec":"markdown","ad71e179":"markdown","a4d91568":"markdown","effff693":"markdown","a1817895":"markdown","6e244ed9":"markdown","f7a7f381":"markdown","da7ff25c":"markdown","61d210f8":"markdown"},"source":{"c8b9db1c":"#importing modules\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport numpy as np\n%matplotlib inline","82728153":"#Load Dataset\nTextFileReader = pd.read_csv(\"\/kaggle\/input\/onlineretail\/OnlineRetail.csv\",engine='python', chunksize=100000)  # the number of rows per chunk\n\nDS = []\nfor df in TextFileReader:\n    DS.append(df)\n\ndf = pd.concat(DS,sort=False)","240d299c":"DS_2 = DS[0]\nprint (DS_2.columns)\nDS_2.head(10)","2a4bb4f4":"#Some data Stats\nDS_2.shape # Shape\nDS_2.info() # information\nDS_2.describe() #Summary Stastics","df367859":"#Looking out for missing values and handling them\nDS_2.isnull().sum()","26c0747c":"#finding out unique variables\nprint(\"Description : \",DS_2.Description.unique())\nprint(\"Country  : \",DS_2.Country.unique())","1803741d":"# using Pandas function to_numeric to check if there is other value than number it will convert into Nan\nDS_2['InvoiceNo'] = pd.to_numeric(DS_2['InvoiceNo'], errors='coerce')\n\nDS_2.isnull().sum()","924bdeb7":"# using Pandas function to_numeric to check if there is other value than number it will convert into Nan\n\nDS_2['StockCode'] = pd.to_numeric(DS_2['StockCode'], errors='coerce')\nDS_2.isnull().sum()","9bc7d2a1":"# replace the matching strings \nDS_2['Description'] = DS_2['Description'].replace('lost', np.NaN)\nDS_2.isnull().sum()","d6f90917":"# Applying abs() to Quantity column which will change negative values to positive \nDS_2['Quantity'] = DS_2['Quantity'].abs() ","3ef17c8c":"# Applying abs() to UnitPrice column which will change negative values to positive \nDS_2['UnitPrice'] = DS_2['UnitPrice'].abs() ","3b01bb6e":"#Filling Values with mode in all Categorical columns which have NaN values in it\nstringcols = DS_2.select_dtypes(exclude=np.number)\nfor cat in stringcols:\n    DS_2[cat] = DS_2[cat].fillna(DS_2[cat].mode().values[0])\nDS_2.isnull().sum()","890276cf":"#Changing Datatype of InvoiceDate to_datetime \nDS_2['InvoiceDate'] = pd.to_datetime(DS_2['InvoiceDate'])","ce3b4789":"#Filling Values with mean in all number columns which have NaN values in it\nnumcols = DS_2.select_dtypes(include=np.number)\nfor cat in numcols:\n    DS_2[cat] = DS_2[cat].fillna(DS_2[cat].median())\nDS_2.isnull().sum()","e6ee64ae":"#label encoder\nfrom numpy import array\nfrom sklearn.preprocessing import LabelEncoder\n\nlabel_encoder=LabelEncoder()\nDS_2['DescriptionCode']=label_encoder.fit_transform(DS_2.Description)\nDS_2.head()","60dc7092":"sns.pairplot(DS_2)","7b915aa7":"#create correlation\ncorr = DS_2.corr(method = 'pearson')\n\n#convert correlation to numpy array\nmask = np.array(corr)\n\n#to mask the repetitive value for each pair\nmask[np.tril_indices_from(mask)] = False\nfig, ax = plt.subplots(figsize = (15,12))\nfig.set_size_inches(15,15)\nsns.heatmap(corr, mask = mask, vmax = 0.9, square = True, annot = True)","8c5ccffd":"DS_2_cluster = pd.DataFrame()\nDS_2_cluster['Quantity'] = DS_2['Quantity']\nDS_2_cluster['UnitPrice'] = DS_2['UnitPrice']\nDS_2_cluster['DescriptionCode'] = DS_2['DescriptionCode']\nDS_2_cluster.head()","bd1223c0":"BOLD = '\\033[1m'\nEND = '\\033[0m'\nfor col in numcols:\n\n    fig, (ax1, ax2) = plt.subplots(1,2,figsize=(12,3))\n    sns.boxplot(DS_2[col], linewidth=1, ax = ax1)\n    DS_2[col].hist(ax = ax2)\n\n    plt.tight_layout()\n    plt.show()\n    print(BOLD+col.center(115)+END)","916a388e":"fig, (ax1, ax2, ax3) = plt.subplots(3,1, figsize=(8,8))\nsns.distplot(DS_2[\"Quantity\"], ax=ax1)\nsns.distplot(DS_2[\"UnitPrice\"], ax=ax2)\nsns.distplot(DS_2[\"DescriptionCode\"], ax=ax3)\nplt.tight_layout()\nplt.legend()","958e1ccd":"Q1 = DS_2_cluster.quantile(0.25)\nQ3 = DS_2_cluster.quantile(0.75)\nIQR = Q3 - Q1\nprint(IQR)","bea9f3aa":"DS_2_clusters = DS_2_cluster[~((DS_2_cluster < (Q1 - 1.5 * IQR)) |(DS_2_cluster > (Q3 + 1.5 * IQR))).any(axis=1)]\nDS_2_clusters","393bae9a":"fig, (ax1, ax2, ax3) = plt.subplots(3,1, figsize=(8,8))\nsns.distplot(DS_2_clusters[\"Quantity\"], ax=ax1)\nsns.distplot(DS_2_clusters[\"UnitPrice\"], ax=ax2)\nsns.distplot(DS_2_clusters[\"DescriptionCode\"], ax=ax3)\nplt.tight_layout()","ec577e6a":"#Fit and transform\nDS_2_clusters.head()","409e8f97":"from sklearn.preprocessing import StandardScaler\n\nscaler = StandardScaler()\ncluster_scaled = scaler.fit_transform(DS_2_clusters)","4851f4bf":"from sklearn.cluster import KMeans\n\nSum_of_squared_distances = []\nK = range(1,15)\nfor k in K:\n    km = KMeans(n_clusters=k)\n    km = km.fit(cluster_scaled)\n    Sum_of_squared_distances.append(km.inertia_)\nplt.figure(figsize=(20,5))\nplt.plot(K, Sum_of_squared_distances, 'bx-')\nplt.xlabel('k')\nplt.ylabel('Sum_of_squared_distances')\nplt.title('Elbow Method For Optimal k')\nplt.show()","91e0156a":"from mpl_toolkits.mplot3d import Axes3D\n\nmodel = KMeans(n_clusters=4)\nmodel.fit(cluster_scaled)\nkmeans_labels = model.labels_\n\nfig = plt.figure(num=None, figsize=(15, 10), dpi=80, facecolor='w', edgecolor='k')\nax = plt.axes(projection=\"3d\")\n\nax.scatter3D(DS_2_clusters['DescriptionCode'],DS_2_clusters['Quantity'],DS_2_clusters['UnitPrice'],c=kmeans_labels, cmap='rainbow')\n\nxLabel = ax.set_xlabel('DescriptionCode', linespacing=3.2)\nyLabel = ax.set_ylabel('Quantity', linespacing=3.1)\nzLabel = ax.set_zlabel('UnitPrice', linespacing=3.4)\nprint(\"K-Means\")","d703225b":"DS2_clustered_kmeans = DS_2_clusters.assign(Cluster=kmeans_labels)\ngrouped_kmeans = DS2_clustered_kmeans.groupby(['Cluster']).mean().round(1)\ngrouped_kmeans","2aa13edf":"from sklearn.cluster import MiniBatchKMeans\nkmeans = MiniBatchKMeans(n_clusters=4,random_state=0,batch_size=6,max_iter=10).fit(cluster_scaled)\nkmeans_labels = kmeans.labels_\n\nfig = plt.figure(num=None, figsize=(15, 10), dpi=80, facecolor='w', edgecolor='k')\nax = plt.axes(projection=\"3d\")\n\nax.scatter3D(DS_2_clusters['DescriptionCode'],DS_2_clusters['Quantity'],DS_2_clusters['UnitPrice'],c=kmeans_labels, cmap='rainbow')\n\nxLabel = ax.set_xlabel('DescriptionCode', linespacing=3.2)\nyLabel = ax.set_ylabel('Quantity', linespacing=3.1)\nzLabel = ax.set_zlabel('UnitPrice', linespacing=3.4)\nprint(\"K-Means\")","ed7b4445":"DS2_clustered_kmeans = DS_2_clusters.assign(Cluster=kmeans_labels)\ngrouped_kmeans = DS2_clustered_kmeans.groupby(['Cluster']).mean().round(1)\ngrouped_kmeans","50dd49a2":"The heatmap shows best correlation between Stock Code and Customer ID.","109fa5e4":"# Feature Engineering\n## IQR\nWe can use IQR to reduce the outliers and distribution skewness","ff5bb5fd":"K-means\nFirst we use the Elbow Method to determine the optimal k value for the k-means","c09d0db2":"# K-means","de28ed6a":"### Features\n\nInvoiceNo (numeric)\n\nStockCode (numeric)\n\nGender (text: male, female)\n\nJob (numeric: 0 - unskilled and non-resident, 1 - unskilled and resident, 2 - skilled, 3 - highly skilled)\n\nHousing (text: own, rent, or free)\n\nSaving accounts (text - little, moderate, quite rich, rich)\n\nChecking account (numeric, in DM - Deutsch Mark)\n\nCredit amount (numeric, in DM)\n\nDuration (numeric, in month)\n\nPurpose (text: car, furniture\/equipment, radio\/TV, domestic appliances, repairs, education, business, vacation\/others)","ec2a8a6c":"Plotting Box plots to find outliers - The box plot shows outliers in the numerical features","f6042928":"#### 3. Missing Values identification and handling","2ef54d4e":"This has caused the skewness to be removed.","7bf6dccc":"From the figure above we can see that the most optimal values are 4. So we choose 4 as the k values of the k-means model.","d566a359":"The above diagram shows pairplot of all the numerical features.","3fe28a54":"#### 1. Loading the Dataset","40f48cec":"### Objective\nWe are trying to find the creditworthiness of the customer on the German Credit DataSet.","ad71e179":"The table shows centroids of each clusters that could determine the clusters rule.\nThese are:\n\nCluster 0: Less Quantity, Mid Unit Price, Description Code High\n\nCluster 1: More Quantity, Low Unit Price, Description Code Mid\n\nCluster 2: Less Quantity, High Unit Price, Description Code Mid\n    \nCluster 3: Less Quantity, Mid Unit Price, Description Code low\n    \nDescription Code low: It means that codes which label encoder makes by its own first 1000 is describe as Low\n\nDescription Code Mid: It means that codes which label encoder makes by its own from 1000-2000 is describe as Mid\n\nDescription Code High: It means that codes which label encoder makes by its own first 2000-3000 is describe as High","a4d91568":"### 1. Business Understanding","effff693":"#### 4. Visualize","a1817895":"#### 2.Descriptive Statistics","6e244ed9":"The table shows centroids of each clusters that could determine the clusters rule.\nThese are:\n\nCluster 0: Less Quantity, Mid Unit Price, Description Code High\n\nCluster 1: Less Quantity, Mid Unit Price, Description Code low\n\nCluster 2: Less Quantity, High Unit Price, Description Code High\n    \nCluster 3: Less Quantity, low Unit Price, Description Code Mid\n    \nDescription Code low: It means that codes which label encoder makes by its own first 1000 is describe as Low\n\nDescription Code Mid: It means that codes which label encoder makes by its own from 1000-2000 is describe as Mid\n\nDescription Code High: It means that codes which label encoder makes by its own first 2000-3000 is describe as High","f7a7f381":"### Positive Skewness\nmeans when the tail on the right side of the distribution is longer or fatter. The mean and median will be greater than the mode.","da7ff25c":"# Online Retail Dataset","61d210f8":"This dataset is about Products in Stock Market. Each Product has a Code, Each Customer will buy a product with a provided code "}}