{"cell_type":{"b55db42f":"code","a6ee3c21":"code","6d145876":"code","e6832d72":"code","639907c3":"code","545dae76":"code","9ed4b101":"code","799bdce6":"code","19707212":"code","72d1c7be":"code","be74d91c":"code","d9355d38":"code","3cf4312a":"code","53d79f21":"code","2c2c232e":"code","e10d765c":"code","bcc932bf":"code","9bd98a16":"code","cfcecf66":"code","06f02cfc":"code","87a479eb":"code","8b51bfc7":"code","97ddd752":"code","32cd4a0b":"markdown","a1aa32e3":"markdown","7b850b19":"markdown","cb9adc78":"markdown","dc6080d8":"markdown","a717f683":"markdown","68847e4a":"markdown","8f5978d5":"markdown"},"source":{"b55db42f":"import os\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport zipfile\nfrom tensorflow import keras\nfrom tensorflow.keras.preprocessing.image import ImageDataGenerator\nfrom sklearn.utils import shuffle\nfrom sklearn.metrics import confusion_matrix\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import confusion_matrix, classification_report","a6ee3c21":"test = pd.read_csv('..\/input\/histopathologic-cancer-detection\/sample_submission.csv')\n\nprint('Test Set Size:', test.shape)","6d145876":"test.head()","e6832d72":"train_data = pd.read_csv('\/kaggle\/input\/histopathologic-cancer-detection\/train_labels.csv')\ntrain_data.head()","639907c3":"y = train_data['label']\ntrain_df, valid_df = train_test_split(train_data, test_size=0.2, random_state=45, stratify=y)\n\nprint(train_df.shape)\nprint(valid_df.shape)","545dae76":"def append_ext(fn):\n    return fn+\".tif\"","9ed4b101":"train_df['id'] = train_df['id'].apply(append_ext)\nvalid_df['id'] = valid_df['id'].apply(append_ext)\nvalid_df.head()","799bdce6":"y_valid = valid_df['label']","19707212":"test_path = \"..\/input\/histopathologic-cancer-detection\/test\/\"\nprint('Test Images:', len(os.listdir(test_path)))","72d1c7be":"test['id'] = test['id'].apply(append_ext)\ntest.head()","be74d91c":"train_path = '..\/input\/histopathologic-cancer-detection\/train'\n","d9355d38":"BATCH_SIZE = 64\n\ntest_datagen = ImageDataGenerator(rescale=1\/255)\nvalid_datagen = ImageDataGenerator(rescale=1\/255)\n\ntest_loader = test_datagen.flow_from_dataframe(\n    dataframe = test,\n    directory = test_path,\n    x_col = 'id',\n    batch_size = BATCH_SIZE,\n    shuffle = False,\n    class_mode = None,\n    target_size = (32,32)\n)\n\n\nvalid_loader = valid_datagen.flow_from_dataframe(\n    dataframe = valid_df,\n    directory = train_path,\n    x_col = 'id',\n    batch_size = BATCH_SIZE,\n    shuffle = False,\n    class_mode = None,\n    target_size = (32,32)\n)","3cf4312a":"cnn = keras.models.load_model('..\/input\/cancer-detection-models\/cancer_detection_model_v25.h5')\ncnn.summary()","53d79f21":"test_probs = cnn.predict(test_loader)\nprint(test_probs.shape)","2c2c232e":"print(test_probs[:10,].round(2))","e10d765c":"valid_probs = cnn.predict(valid_loader)\nprint(valid_probs.shape)","bcc932bf":"valid_pred = np.argmax(valid_probs, axis=1)\nprint(valid_pred[:10])","9bd98a16":"cm = confusion_matrix(y_valid, valid_pred)\ncm_df = pd.DataFrame(cm)\ncm_df","cfcecf66":"pd.DataFrame(cm, index=['True No', 'True Has'], \n            columns=['Pred No', 'Pred Has'] )","06f02cfc":"print(classification_report(y_valid, valid_pred))","87a479eb":"submission = pd.read_csv('..\/input\/histopathologic-cancer-detection\/sample_submission.csv')\nsubmission.head()","8b51bfc7":"submission.label = test_probs[:,1]\nsubmission.head()","97ddd752":"submission.to_csv('submission.csv', header=True, index=False)","32cd4a0b":"## Data Generator","a1aa32e3":"## Extract Test Images","7b850b19":"## Prepare Submission","cb9adc78":"## Test Predictions","dc6080d8":"## Load DataFrame\n","a717f683":"## Load Model","68847e4a":"- We can see 20432 sample is correctly predicted as No cancer, and 16163 samples is correctly predicted as Has Cancers. \n- There are 5750 samples predicted as has cancer, but actually dont't have cancer.\n- Ther are 1660 samples predicted as has no-cancer, but actually have cancer.","8f5978d5":"## Import Statements"}}