{"cell_type":{"c207c6f5":"code","c0927e8d":"code","f601b52a":"code","f2b9b84b":"code","82868c35":"code","077f408b":"code","78e8f5d2":"code","b28e5de5":"code","15d9dcb1":"code","d604fd9d":"code","1c76c35d":"code","c0a2ee11":"code","c207896a":"code","358269ba":"code","181004ae":"code","2e60695c":"code","892128da":"code","595611ac":"code","cc215e98":"code","e23625d7":"code","cdd9f404":"code","369d64e7":"code","cc5ffc04":"code","1f618695":"code","ee16a3f5":"code","1acdf065":"code","071050b1":"code","3e8a1783":"code","78e17b7e":"code","d77b9235":"code","dafdee04":"code","c2c525c6":"code","bc4349c9":"code","4569c2a9":"code","810b080e":"code","c13ebf80":"code","6fe3b485":"code","89aa5707":"code","fe12fad5":"markdown","bb752556":"markdown","87062ec3":"markdown","58e895b3":"markdown","2b0fdf94":"markdown","08d4a057":"markdown","8fb07e6f":"markdown","18cc6284":"markdown","31ce507c":"markdown","cef74826":"markdown","115a8871":"markdown","e81ceb8a":"markdown","cfa45ee7":"markdown","baef89c7":"markdown","c1c5e632":"markdown","ce5e05f2":"markdown","17bb1679":"markdown","de77a131":"markdown","c013e6d6":"markdown","2e647c42":"markdown","2f35ec23":"markdown"},"source":{"c207c6f5":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport sqlite3\n\n%matplotlib inline","c0927e8d":"conn = sqlite3.connect('..\/input\/soccer\/database.sqlite')\ncursor = conn.cursor()\n\nsql = \"\"\"SELECT * FROM Match\"\"\" # sql query to get data","f601b52a":"# loading the data\nmatch = pd.read_sql(sql, conn, index_col='id')\nmatch.shape","f2b9b84b":"match.head()","82868c35":"# selecting relevant col for matches\nselected_cols = ['country_id', 'league_id', 'season', 'stage', 'date', 'match_api_id',\n       'home_team_api_id', 'away_team_api_id', 'home_team_goal', 'away_team_goal']\n\nmatch_data = match[selected_cols]\n\n# selecting relevant col for betting data,\nbetting_data = match[['home_team_api_id', 'away_team_api_id', 'home_team_goal',\n       'away_team_goal','B365H', 'B365D', 'B365A', 'BWH', 'BWD', 'BWA','IWH',\n         'IWD', 'IWA', 'LBH', 'LBD', 'LBA', 'PSH', 'PSD', 'PSA', 'WHH', 'WHD',\n     'WHA', 'SJH', 'SJD', 'SJA', 'VCH', 'VCD', 'VCA', 'GBH', 'GBD', 'GBA', 'BSH', 'BSD', 'BSA']]","077f408b":"# no any missing values or wrong data type was found except `date`\n# we will ignore it for a this time\nmatch_data.info()","78e8f5d2":"match_data.describe()","b28e5de5":"# data types look right,\nbetting_data.info()","15d9dcb1":"# But, there are many sources for which we don't have betting scores for all matches\nbetting_data.isnull().any(axis=1).sum()   # there are 23K rows which have atleast one missing value","d604fd9d":"# lets select data for top 3 sources by data availability - B365, BW, WH\nbetting_data = betting_data.drop(columns=['IWH', 'IWD', 'IWA', 'LBH', 'LBD', 'LBA', 'PSH', 'PSD', 'PSA',\n     'SJH', 'SJD', 'SJA', 'VCH', 'VCD', 'VCA', 'GBH', 'GBD', 'GBA', 'BSH', 'BSD', 'BSA'])\nbetting_data.info()","1c76c35d":"# still we have around 3K rows with atleast one missing value\nbetting_data.isnull().any(axis=1).sum()   ","c0a2ee11":"# lets check the number of matches for which we don't have betting score at all\nbetting_data.loc[:,\"B365H\":\"WHA\"].isnull().all(axis=1).sum()","c207896a":"# lets remove these records\nall_indexes = betting_data.loc[:,\"B365H\":\"WHA\"].isnull().all(axis=1)\nidx_to_del = all_indexes[all_indexes==True].index\n\nbetting_data = betting_data.drop(idx_to_del)\n\nbetting_data.loc[:,\"B365H\":\"WHA\"].isnull().all(axis=1).sum() # checking if we deleted the correct records","358269ba":"# now we have 45 rows with atleast one missing value\nbetting_data.isnull().any(axis=1).sum() ","181004ae":"betting_data.info()","2e60695c":"# lets fill them with mean values\nmean_dict = betting_data.loc[:,'B365H':].mean().to_dict()\nbetting_data.fillna(value=mean_dict, inplace=True)","892128da":"# No any missing values. Yay!\nbetting_data.isnull().any(axis=1).sum() ","595611ac":"# lets look at big picture. \nmatch_data[['home_team_goal','away_team_goal']].describe()","cc215e98":"# let's calculate the match outcome. This determines who won the match or it was a draw\ndef outcome(m):\n    if m.home_team_goal > m.away_team_goal:\n        return 'Home'\n    elif m.home_team_goal < m.away_team_goal:\n        return 'Away'\n    elif m.home_team_goal == m.away_team_goal:\n        return 'Draw'","e23625d7":"match_data['Outcome'] = match_data.apply(outcome, axis=1);","cdd9f404":"# lets look what we got\nmatch_data.Outcome.value_counts().plot(kind='pie');","369d64e7":"match_data.Outcome.value_counts(normalize=True).round(4)*100","cc5ffc04":"# calculating the mean goals a team scored when it played home and away\nteam_mean_home_scores = match_data.groupby(['home_team_api_id'])['home_team_goal'].mean()\nteam_mean_away_scores = match_data.groupby(['away_team_api_id'])['away_team_goal'].mean()","1f618695":"# merging both dataset based on team id\nteam_scores_home_away = pd.concat([team_mean_home_scores,team_mean_away_scores], axis=1, join='inner')","ee16a3f5":"# lets examine the scores individually\nsns.distplot(team_scores_home_away.home_team_goal);","1acdf065":"sns.distplot(team_scores_home_away.away_team_goal);","071050b1":"# comparing a team's mean goals when played home and away\nteam_scores_home_away['score_higher_at'] = team_scores_home_away.apply(outcome, axis=1)","3e8a1783":"team_scores_home_away.score_higher_at.value_counts(normalize=True).plot(kind='pie');","78e17b7e":"team_scores_home_away.score_higher_at.value_counts(normalize=True).round(4)*100","d77b9235":"team_scores_home_away.plot.scatter(x='home_team_goal',y='away_team_goal', alpha=0.2);","dafdee04":"team_scores_home_away[['home_team_goal','away_team_goal']].corr()","c2c525c6":"# computing the score difference where teams have scored higher at home\nteam_scores_home_away['pos_score_diff'] = team_scores_home_away.home_team_goal - team_scores_home_away.away_team_goal","bc4349c9":"# deleting negative differences\nteam_scores_home_away[team_scores_home_away.pos_score_diff<0]=np.NaN","4569c2a9":"team_scores_home_away.pos_score_diff.plot(kind='box');","810b080e":"betting_data.describe()","c13ebf80":"# lets look at the betting odds distribution from the three sources \n\nf, axes = plt.subplots(1, 2, figsize=(10, 5), sharey=True, sharex=True)\nsns.kdeplot(betting_data.BWH, shade=False, ax=axes[0]);\nsns.kdeplot(betting_data.B365H, shade=False, ax=axes[0]);\nsns.kdeplot(betting_data.WHH, shade=False, ax=axes[0]);\n\nsns.kdeplot(betting_data.BWA, shade=False, ax=axes[1]);\nsns.kdeplot(betting_data.B365A, shade=False, ax=axes[1]);\nsns.kdeplot(betting_data.WHA, shade=False, ax=axes[1]);","6fe3b485":"# lets check if the odds are in favour of home team or not for B365 odds\nbetting_data['B365Fav'] = betting_data['B365H'] < betting_data['B365A']","89aa5707":"betting_data.B365Fav.value_counts(normalize=True).round(4)*100","fe12fad5":"<a id='conclusions'><\/a>\n## Conclusions\n\nSo, the answer to our question - 'Is playing home advantageous to the soccer team?' is **Yes!!**. Below are our findings:  \n1. A team playing home has almost 1.5 time the chances to win the match.\n2. 96% out of 299 teams scored higher goals playing home than their respective mean away score.\n3. Teams can score upto 0.5 goals extra playing home\n4. There is a strong correlation between a team's home score and away scores. Generally this suggests that a team will score similar at both home and away conditions.\n5. 70% matches have home team as favourable (from odd scores)","bb752556":"> Both the features follow normal distribution","87062ec3":"> It is seen from the mean that home teams generally score higher than away team, in turn win the match  \n> Let's check the distribution of match outcomes","58e895b3":"> For B365 scores, `70%` of matches have home odds less than away odds, which indicates home teams are favourable to win","2b0fdf94":"### Question\n> Do teams playing home have an advantage? ","08d4a057":"The data is present is a SQLite file, which is a kind of database, that contains data in different tables. We will be using the `Match` table for analysis.","8fb07e6f":"**Limitations**\n1. Current analysis consider *mean* values for calculation. However, *mean* can be effected by presence of outliers in dataset (some teams may have scored exceptionally high goals in some matches). We could have used *median* instead (which can be seen same for both home and away teams).\n2. The analysis performed does not has any statistical inference.\n3. This dataset does not contains data for all matches. (sample data) There could have been different number of samples available for a team's matches played at home and away.","18cc6284":"<a id='wrangling'><\/a>\n## Data Wrangling\n### General Properties","31ce507c":"# Project: Is playing home advantageous to the soccer team?\n\n## Table of Contents\n<ul>\n<li><a href=\"#intro\">Introduction<\/a><\/li>\n<li><a href=\"#wrangling\">Data Wrangling<\/a><\/li>\n<li><a href=\"#eda\">Exploratory Data Analysis<\/a><\/li>\n<li><a href=\"#conclusions\">Conclusions and Limitations<\/a><\/li>\n<\/ul>","cef74826":"### And How large this difference in score can be?","115a8871":"> Looks like all the sources have similar odds, ","e81ceb8a":"> It was seen that `96%` teams have scored higher at home location in comparison to their away scores","cfa45ee7":"We will try to validate the possibility the above question.","baef89c7":"<a id='eda'><\/a>\n## Exploratory Data Analysis\n\n<!-- ### Research Question 1 (Replace this header name!) -->\n### Does team playing home have high changes to win?","c1c5e632":"> There is a `strong correlation` between a team's home scoring and away scoring.","ce5e05f2":"Let's explore this advantage. How exactly a team playing home is benefitted?  \n### Does a team scores higher playing at home in comparison to away locations?","17bb1679":"### How do betting odds compare for home and away teams? ","de77a131":"> The above composition suggests that Home teams won around `46%` of matches, while away team won `29%`. A quarter of all matches were a draw.  \n> This asserts that playing at home boosts the chances of a team to win the match","c013e6d6":"<a id='intro'><\/a>\n## Introduction\n> In this report, we will be analysing the Europeon Soccer Dataset to find out the titled question. This dataset comes from Kaggle and is well suited for data analysis and machine learning. It contains data for 25k+ soccer matches, 10k+ players, and teams from several European countries from 2008 to 2016.","2e647c42":"> It looks like the team can score `0.2` to `0.5` goals extra playing at home. However, in extreme cases, this can go high upto `0.8`","2f35ec23":"Let's see if this holds in team-wise comparison"}}