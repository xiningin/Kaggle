{"cell_type":{"821f8cfb":"code","7b2b27b5":"code","6846f0ef":"code","93d5245f":"code","91246ae6":"code","2f9ea273":"code","d83963ea":"code","63e4fedb":"code","e566b764":"code","65086315":"code","9bbc7656":"code","9a4eea10":"code","fc840d18":"code","cf92630f":"code","b61cdf7e":"code","b437468f":"code","31b31c45":"code","3fd89749":"code","225606a9":"code","3476e1dd":"code","a06c3607":"code","4a1e1d7d":"code","3c6e6173":"code","011a8ccb":"code","71b5e542":"code","81b7e26b":"code","06fbc327":"code","f256339f":"code","3d3b85f2":"code","9387c8b6":"code","d305aa02":"code","abf41d06":"code","ddeb0438":"markdown","b9df52ce":"markdown","8ef9c66c":"markdown","8f5ea64b":"markdown","ce380f94":"markdown","be3bde5f":"markdown","a049c3f3":"markdown","65fc2a32":"markdown","2d53500b":"markdown","5fc9806f":"markdown","0433f9eb":"markdown"},"source":{"821f8cfb":"!pip install calmap","7b2b27b5":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport datetime as dt\nimport matplotlib.pyplot as plt\nfrom scipy.interpolate import make_interp_spline, BSpline\n\nimport plotly.express as px\nimport plotly.offline as ply\nimport plotly.graph_objs as go\nply.init_notebook_mode(connected=True)\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\nfrom sklearn.linear_model import LinearRegression\n\nimport calmap\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","6846f0ef":"majordir='\/kaggle\/input\/covid19-us-county-trend\/'\ndatadir=majordir+'csse_covid_19_daily_reports\/'\nstart_date='03-22-2020'\ndate_today='04-07-2020'\ndays=(pd.to_datetime(date_today)-pd.to_datetime(start_date)).days\ndays","93d5245f":"# 48201.0\n# aa=covid_data_world_daily_start_date[(covid_data_world_daily_start_date['Country_Region']=='US')]\n# aa[(aa['FIPS']==49057.0)]\n# covid_data_world_daily_start_date[(covid_data_world_daily_start_date['Province_State']=='New Hampshire')&(covid_data_world_daily_start_date['Admin2']=='Hillsborough')]","91246ae6":"covid_data_world_daily_start_date=pd.read_csv(datadir+start_date+'.csv')\ncovid_data_us_daily_start_date=covid_data_world_daily_start_date[(covid_data_world_daily_start_date['Country_Region']=='US')][['FIPS','Lat','Long_','Confirmed']].copy()\ncovid_data_us_daily_start_date.rename(columns={'Confirmed':start_date},inplace=True)\ncovid_data_us_daily_start_date.head()","2f9ea273":"covid_data_us_daily_start_date= covid_data_us_daily_start_date[covid_data_us_daily_start_date['FIPS'].notna()]\nvc=covid_data_us_daily_start_date['FIPS'].value_counts()\nvclist=vc[vc > 1].index.tolist()\ncovid_data_us_daily_start_date=covid_data_us_daily_start_date[~(covid_data_us_daily_start_date['FIPS'].isin(vclist)&(covid_data_us_daily_start_date[start_date]>0))]\ncovid_data_us_daily_start_date.shape","d83963ea":"# covid_data_us_daily_start_date[(covid_data_us_daily_start_date['FIPS']==33011.0)]","63e4fedb":"for i in range(days):\n    date=(pd.to_datetime(start_date)+pd.DateOffset(i+1)).date().isoformat()\n    date_reframe=date[5:7]+'-'+date[8:]+'-'+date[0:4]\n    dataset=datadir+date_reframe+'.csv'\n    covid_data_world_daily=pd.read_csv(dataset)\n    covid_data_world_daily.rename(columns={'Confirmed':date_reframe},inplace=True)    \n    covid_data_us_daily=covid_data_world_daily[covid_data_world_daily['Country_Region']=='US'].copy() \n#     print(covid_data_us_daily[(covid_data_us_daily['FIPS']==35013.0)][date_reframe])\n    if i==0:\n        print(i)\n        covid_data_us_dailytrend=covid_data_us_daily_start_date[['FIPS','Lat','Long_',start_date]].merge(covid_data_us_daily[['FIPS',date_reframe]],on='FIPS').dropna()\n    else:\n        print(i)\n        covid_data_us_dailytrend=covid_data_us_dailytrend.merge(covid_data_us_daily[['FIPS',date_reframe]],on='FIPS').dropna()\n#     print(covid_data_us_dailytrend[(covid_data_us_dailytrend['FIPS']==33011.0)])\ncovid_data_us_dailytrend.shape","e566b764":"covid_data_us_dailytrend[(covid_data_us_dailytrend['FIPS']==33011.0)]","65086315":"covid_data_us_dailytrend=covid_data_us_dailytrend.drop_duplicates(['FIPS'])\nvc=covid_data_us_dailytrend['FIPS'].value_counts()\nvclist=vc[vc > 1].index.tolist()\nvc[vc > 1]\ncovid_data_us_dailytrend.sort_values(by=date_today,ascending=False).head()","9bbc7656":"covid_data_us_dailytrend[(covid_data_us_dailytrend['FIPS']==33011.0)]","9a4eea10":"census_df_fips = pd.read_excel(majordir+'PopulationEstimates_us_county_level_2018.xlsx',skiprows=1)\ncensus_df_fips.FIPS=census_df_fips.FIPS.astype(float)\ncensus_density_df_fips = pd.read_csv(majordir+'uscounty_populationdesity.csv', encoding = \"ISO-8859-1\",skiprows=1)\ncensus_density_df_fips.rename(columns={'Target Geo Id2':'FIPS'},inplace=True)\ncensus_pop_density_df_fips=census_df_fips.merge(census_density_df_fips[['FIPS','Density per square mile of land area - Population']],on='FIPS')\ncensus_pop_density_df_fips.shape","fc840d18":"census_pop_density_fips_covid=census_pop_density_df_fips.merge(covid_data_us_dailytrend,on='FIPS')\ncensus_pop_density_fips_covid.sort_values(by=date_today,ascending=False).head()","cf92630f":"census_pop_density_fips_covid.loc[census_pop_density_fips_covid.FIPS==36061,'POP_ESTIMATE_2018']=8398748\ncensus_pop_density_fips_covid.sort_values(by=date_today,ascending=False).head()","b61cdf7e":"census_pop_density_fips_covid_st200=census_pop_density_fips_covid[(census_pop_density_fips_covid[start_date]>200)].sort_values(by=date_today,ascending=False)\ncensus_pop_density_fips_covid_st200['Combined_Key']=census_pop_density_fips_covid_st200['Area_Name'] +', '+ census_pop_density_fips_covid_st200['State']\n# census_pop_density_fips_covid_st200[['State','Area_Name',start_date,date_today,'POP_ESTIMATE_2018']]\n\ncensus_pop_density_fips_covid_st200[['State','Area_Name',start_date,date_today,'POP_ESTIMATE_2018']].style.background_gradient(cmap='Blues',subset=[\"03-22-2020\"])\\\n                        .background_gradient(cmap='Reds',subset=[\"04-07-2020\"])\\\n                        .background_gradient(cmap='Greens',subset=[\"POP_ESTIMATE_2018\"]) ","b437468f":"census_pop_density_fips_covid_st200.head()\n# census_pop_density_fips_covid_st200.T.iloc[5:-1].tail()","31b31c45":"census_pop_density_fips_covid_st200_timeseries=census_pop_density_fips_covid_st200.T.iloc[7:-1]\ncensus_pop_density_fips_covid_st200_timeseries.index=pd.to_datetime(census_pop_density_fips_covid_st200_timeseries.index)\ncensus_pop_density_fips_covid_st200_timeseries.index","3fd89749":"f = plt.figure(figsize=(20,10))\ncensus_pop_density_fips_covid_st200_timeseries[1241]\ncalmap.yearplot(census_pop_density_fips_covid_st200_timeseries[1241], fillcolor='white', cmap='Blues', linewidth=0.5,linecolor=\"#fafafa\",year=2020,)\nplt.title(\"Daily Confirmed Cases\",fontsize=20)\nplt.tick_params(labelsize=15)","225606a9":"census_pop_density_fips_covid_st200_timeseries.columns=census_pop_density_fips_covid_st200.Combined_Key\ncensus_pop_density_fips_covid_st200_timeseries.T","3476e1dd":"# Thanks to Tarun Kumar: https:\/\/www.kaggle.com\/tarunkr\/covid-19-case-study-analysis-viz-comparisons\ntemp = census_pop_density_fips_covid_st200_timeseries.T.copy()\nthreshold = 1000\nf = plt.figure(figsize=(10,12))\nax = f.add_subplot(111)\nfor i,Combined_Key in enumerate(temp.index):\n#     x = 30\n    t = temp.loc[temp.index== Combined_Key].values[0]\n    t = t[t>threshold]\n     \n    date = np.arange(0,len(t))\n    xnew = np.linspace(date.min(), date.max(), 30)\n    spl = make_interp_spline(date, t, k=1)  # type: BSpline\n    power_smooth = spl(xnew)\n    if Combined_Key[-2:] != 'NY':\n        plt.plot(xnew,power_smooth,'-o',label = Combined_Key,linewidth =3, markevery=[-1])\n#     else:\n#         marker_style = dict(linewidth=4, linestyle='-', marker='o',markersize=10, markerfacecolor='#ffffff')\n#         plt.plot(date,t,\"-.\",label = country,**marker_style)\n\nplt.tick_params(labelsize = 14)        \nplt.xticks(np.arange(0,30,7),[ \"Day \"+str(i) for i in range(30)][::7])     \n\n# Reference lines \n# x = np.arange(0,18)\n# y = 2**(x+np.log2(threshold))\n# plt.plot(x,y,\"--\",linewidth =2,color = \"gray\")\n# plt.annotate(\"No. of cases doubles every day\",(x[-2],y[-1]),xycoords=\"data\",fontsize=14,alpha = 0.5)\n\n# x = np.arange(0,26)\n# y = 2**(x\/2+np.log2(threshold))\n# plt.plot(x,y,\"--\",linewidth =2,color = \"gray\")\n# plt.annotate(\".. every second day\",(x[-3],y[-1]),xycoords=\"data\",fontsize=14,alpha = 0.5)\n\nx = np.arange(0,26)\ny = 2**(x\/7+np.log2(threshold))\nplt.plot(x,y,\"--\",linewidth =2,color = \"gray\")\nplt.annotate(\".. every week\",(x[-3],y[-1]),xycoords=\"data\",fontsize=14,alpha = 0.5)\n\nx = np.arange(0,26)\ny = 2**(x\/30+np.log2(threshold))\nplt.plot(x,y,\"--\",linewidth =2,color = \"gray\")\nplt.annotate(\".. every month\",(x[-3],y[-1]),xycoords=\"data\",fontsize=14,alpha = 0.5)\n\n\nx = np.arange(0,26)\ny = 2**(x\/4+np.log2(threshold))\nplt.plot(x,y,\"--\",linewidth =2,color = \"Red\")\nplt.annotate(\".. every 4 days\",(x[-3],y[-1]),color=\"Red\",xycoords=\"data\",fontsize=14,alpha = 0.8)\n\n# plot Params\nplt.xlabel(\"Days\",fontsize=17)\nplt.ylabel(\"Number of Confirmed Cases\",fontsize=17)\nplt.title(\"Trend Comparison of Different Counties (confirmed) (except for counties in New York State)\",fontsize=22)\nplt.legend(loc = \"upper left\")\nplt.yscale(\"log\")\nplt.grid(which=\"both\")\nplt.show()","a06c3607":"fig = px.scatter(census_pop_density_fips_covid_st200,x=start_date,y=date_today,hover_data=[\"Combined_Key\"],color='State',size='POP_ESTIMATE_2018',size_max=40)\nfig.update_layout(xaxis_type=\"log\", yaxis_type=\"log\")\nfig.show()","4a1e1d7d":"census_pop_density_fips_covid_200=census_pop_density_fips_covid[(census_pop_density_fips_covid[date_today]>500)&(census_pop_density_fips_covid[date_today]<2000)].sort_values(by=date_today,ascending=False)\ncensus_pop_density_fips_covid_200['Combined_Key']=census_pop_density_fips_covid_200['Area_Name'] +', '+ census_pop_density_fips_covid_200['State']\ncensus_pop_density_fips_covid_200[['State','Area_Name','POP_ESTIMATE_2018',start_date,date_today,'Combined_Key']]","3c6e6173":"X = census_pop_density_fips_covid_200[start_date].values.reshape(-1, 1)  # values converts it into a numpy array\nY = census_pop_density_fips_covid_200[date_today].values.reshape(-1, 1)  # -1 means that calculate the dimension of rows, but have 1 column\nlinear_regressor = LinearRegression()  # create object for the class\nlinear_regressor.fit(X, Y)  # perform linear regression\nY_pred = linear_regressor.predict(X)  # make predictions","011a8ccb":"# census_pop_density_fips_covid_200[census_pop_density_fips_covid_200['Combined_Key'].isin(['Snohomish County, WA'])]","71b5e542":"X1 = census_pop_density_fips_covid_200[census_pop_density_fips_covid_200['Combined_Key']!='Snohomish County, WA'][start_date].values.reshape(-1, 1)  # values converts it into a numpy array\nY1 = census_pop_density_fips_covid_200[census_pop_density_fips_covid_200['Combined_Key']!='Snohomish County, WA'][date_today].values.reshape(-1, 1)  # -1 means that calculate the dimension of rows, but have 1 column\nlinear_regressor = LinearRegression()  # create object for the class\nlinear_regressor.fit(X1, Y1)  # perform linear regression\nY_pred1 = linear_regressor.predict(X1)  # make predictions","81b7e26b":"fig = px.scatter(census_pop_density_fips_covid_200,x=start_date,y=date_today,color='State',size='POP_ESTIMATE_2018',size_max=40, hover_data=[\"Area_Name\"])\n# fig.add_scatter(x=X, y=Y_pred, mode='lines')\nfig.add_traces(go.Scatter(x=census_pop_density_fips_covid_200[start_date].tolist(), y=pd.DataFrame(Y_pred)[0].tolist(),\n                          mode = 'lines',\n                          marker_color='black',\n                          name='with Snohomish County')\n                          )\nfig.add_traces(go.Scatter(x=census_pop_density_fips_covid_200[census_pop_density_fips_covid_200['Combined_Key']!='Snohomish County, WA'][start_date].tolist(), y=pd.DataFrame(Y_pred1)[0].tolist(),\n                          mode = 'lines',\n                          marker_color='red',\n                          name='without Snohomish County')\n                          )\nfig.show()","06fbc327":"census_pop_density_fips_covid['Combined_Key']=census_pop_density_fips_covid['Area_Name'] +', '+ census_pop_density_fips_covid['State']\ncensus_pop_density_fips_covid.head()","f256339f":"county_series=pd.DataFrame(census_pop_density_fips_covid[census_pop_density_fips_covid.columns[7:]].set_index('Combined_Key').unstack().reset_index()).merge(census_pop_density_fips_covid[['Combined_Key','Lat','Long_']],on='Combined_Key')\ncounty_series.columns=['Date','county','Confirmed','Latitude','Longitude']\n# county_series=county_series[county_series['Confirmed']>0].copy()\ncounty_series['Confirmed_log']=np.log2(county_series['Confirmed'])\ncounty_series.loc[county_series['Confirmed_log']==np.float('-inf'),'Confirmed_log']=0.0\ncounty_series.sort_values(by='Date').head()","3d3b85f2":"import plotly.express as px\nfrom plotly.offline import init_notebook_mode\nimport plotly.graph_objs as go\ninit_notebook_mode(connected=True)\n\n\n# tmp = df.copy()\n# tmp['Date'] = tmp['Date'].dt.strftime('%Y\/%m\/%d')\nfig = px.scatter_geo(county_series,lat=\"Latitude\", lon=\"Longitude\", color='Confirmed_log', size='Confirmed_log', locationmode = 'USA-states',\n                     hover_name=\"county\",hover_data=[\"Confirmed\"], scope='usa', animation_frame=\"Date\",\n                     color_continuous_scale=px.colors.diverging.curl,center={'lat':39.50, 'lon':-98.35}, \n                     range_color=[0, max(county_series['Confirmed_log'])])\nfig.update_layout(plot_bgcolor='rgb(275, 270, 273)')\nfig.show()","9387c8b6":"pop_lakh_covid=census_pop_density_fips_covid[(census_pop_density_fips_covid['POP_ESTIMATE_2018']>100000)]['FIPS'].tolist()\npop_lakh_df=census_pop_density_df_fips[census_pop_density_df_fips['POP_ESTIMATE_2018']>100000]\n# ST=['NY','PR']\n# pop_lakh_df[(~pop_lakh_df.FIPS.isin(pop_lakh_covid) )& (~pop_lakh_df.State.isin(ST) ) ]","d305aa02":"# census_pop_density_df_fips[(census_pop_density_df_fips['State']=='NH')]","abf41d06":"# census_pop_density_fips_covid[(census_pop_density_fips_covid['State']=='NH')]","ddeb0438":"## As we did above let's look at the relation between confirmed cases at current date to start date in plot. Lets also plot the linear prediction line and size of the county population. ","b9df52ce":"# Lets look at counties that had atleast 200 cases at start date","8ef9c66c":"### Note: These values also depends on the number of tests that have been done in each county","8f5ea64b":"## Let's look at counties that have cases between 500 and 2000 at current date","ce380f94":"## Let's look at the relation between confirmed cases at current date to start date in plot along with county population","be3bde5f":"# Below is an analysis of how the confirmed cases has been rising in counties across US. I have used march 22nd as starting date (bit arbitrary) for comparison to current date cases.","a049c3f3":"## Looks like only washington state has done more effective measures to reduce the rise in confirmed cases compared to start date. For others the trend follows almost linear relation for all counties.i.e higher the number of confirmed cases at start date higher the confirmed cases at current date.","65fc2a32":"## Also more strict containment measures for Los Angeles and Chicago(cook county,IL) required to prevent becoming next hot spot like New york","2d53500b":"### Couple of Inference:\n### As expected counties in New jersey,Philadelphia County (in PA) and Fairfield (in Connecticut) close to New York hotspot has cases rising faster. \n### Maricopa County Arizona being larger in size and seem to be rising faster, can also be expected to have large increase in cases in next few days.","5fc9806f":"### The counties above linear line show fastest growth of confirmed cases.\n#### Note:Since Snohomish County, Washington looks more of an outliner. I did linear prediction line with and without it.","0433f9eb":"### Merging confirmed cases  and county population "}}