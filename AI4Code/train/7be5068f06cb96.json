{"cell_type":{"901d8fbe":"code","624c41ca":"code","9818a81c":"code","3731cc89":"code","100dd4d7":"code","96eddacf":"code","e2543e42":"code","51064b05":"code","4d259541":"code","89ffae82":"code","d0cb5207":"code","49243ea9":"code","cf2d84a3":"code","c80e8df4":"code","bb7626ed":"code","ee13acbd":"code","9454e75a":"code","2ca857ba":"code","9f34ee43":"code","7dbea0b2":"code","82875fd4":"code","5a0c4109":"code","8d7cf2da":"code","6c1cdecf":"code","afaaea81":"code","748eebcf":"code","a2c372c4":"code","22d1a3d2":"code","8a14b31d":"code","a66f8829":"code","c4c1b556":"code","828c3305":"code","45e0db3c":"code","e4b8564d":"code","56b0d3d3":"code","05248226":"code","19c037fb":"code","42c54ecf":"code","00cf36dc":"code","cf5e7c08":"code","07766af3":"code","72a35ead":"code","d5e9f83a":"code","0671faf4":"code","d3870b05":"code","b4d7d403":"code","f1210875":"code","86ba62d1":"code","9c7b53da":"code","1341a40c":"code","27b66c3c":"code","41767881":"code","26e13d1d":"code","f56b3734":"code","5fc7585e":"code","7ded5bd6":"code","94337ee7":"code","36cbb50b":"markdown","28b8fd78":"markdown","ab78f8e7":"markdown","4d0b4649":"markdown","f670c81f":"markdown","1fc1242a":"markdown","c5a88b95":"markdown","6934b939":"markdown","e1545bae":"markdown","684a6102":"markdown","b967e8f4":"markdown","23973c50":"markdown","3fccd721":"markdown","e9a49347":"markdown","ce38266f":"markdown","38c5e608":"markdown","8a1325d3":"markdown","e8274a08":"markdown","73b3e787":"markdown","c0c78a4d":"markdown","c07d409e":"markdown","c3b2ee05":"markdown","979132c7":"markdown","8b4e4746":"markdown","def7d3ca":"markdown","984fa2f7":"markdown","2d098bda":"markdown","bb6da711":"markdown","4e7f3cac":"markdown","4e809c82":"markdown","9b7d841c":"markdown"},"source":{"901d8fbe":"# loading the libraries\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom collections import Counter\n%matplotlib inline","624c41ca":"# Plot settings\nplt.style.use(\"ggplot\")\nplt.rcParams[\"figure.figsize\"] = [12, 6]\nplt.rcParams[\"figure.dpi\"] = 150","9818a81c":"%%bash\ncd ..\/input\/suicide-rates-overview-1985-to-2016\nls","3731cc89":"# Reading the data into memory\nsuicide = pd.read_csv(\"..\/input\/suicide-rates-overview-1985-to-2016\/master.csv\")","100dd4d7":"suicide.shape","96eddacf":"suicide.columns","e2543e42":"suicide.head()","51064b05":"replacement_cols = {\"suicides\/100k pop\" : \"suicide_100k\", \"country-year\": \"country_year\",\n                   \"HDI for year\": \"hdi_for_year\", \" gdp_for_year ($) \" : \"current_gdp\",\n                   \"gdp_per_capita ($)\" : \"gdp_capita\"}","4d259541":"suicide = suicide.rename(columns = replacement_cols)\nsuicide[\"current_gdp\"] = suicide[\"current_gdp\"].str.replace(\",\", \"\").astype(\"float64\")","89ffae82":"suicide.head()","d0cb5207":"suicide.isna().sum()","49243ea9":"# Number of unique countries\nlen(pd.unique(suicide[\"country\"]))","cf2d84a3":"Counter(suicide[\"country\"]).most_common()[:10]","c80e8df4":"Counter(suicide[\"country\"]).most_common()[-10:]","bb7626ed":"len(pd.unique(suicide[\"year\"]))","ee13acbd":"min(suicide[\"year\"])","9454e75a":"max(suicide[\"year\"])","2ca857ba":"suicide[\"year\"].value_counts().plot.bar()\nplt.title(\"Number of occurences of each year\", size = 30)\nplt.ylabel(\"# Counts\");","9f34ee43":"suicide[\"sex\"].value_counts().plot.bar()\nplt.title(\"Gender repartition\", size = 30)\nplt.ylabel(\"# Counts\");","7dbea0b2":"suicide[\"age\"].value_counts().plot.bar()\nplt.title(\"Age group repartition\", size = 30)\nplt.ylabel(\"# Counts\");","82875fd4":"suicide[\"generation\"].value_counts().plot.bar()\nplt.title(\"generation repartition\", size = 30)\nplt.ylabel(\"# Counts\");","5a0c4109":"def correlation_plot(data, year):\n    df = suicide[suicide[\"year\"] == year].drop(columns = \"year\").copy()\n    sns.heatmap(\n    df.groupby(\"country\").agg(\"sum\").corr(), cmap = \"viridis\", annot = True)\n    plt.title(f\"Correlation among numeric variables in {year}\")\n    plt.show();","8d7cf2da":"plt.figure(figsize= (5, 3))\ncorrelation_plot(suicide, 1985)","6c1cdecf":"plt.figure(figsize= (5, 3))\ncorrelation_plot(suicide, 2015)","afaaea81":"suicide[\"year\"] = pd.to_datetime(suicide[\"year\"], format = \"%Y\")","748eebcf":"df = suicide.groupby([\"year\", \"sex\"]).agg(\"mean\").reset_index()\nsns.lineplot(x = \"year\", y = \"suicide_100k\", hue = \"sex\", data = df)\nplt.xlim(\"1985\", \"2015\")\nplt.title(\"Evolution of the mean of suicide 100k (1985 - 2015)\", size = 30);","a2c372c4":"df = suicide.groupby([\"year\", \"sex\", \"age\"]).agg(\"mean\").reset_index()\n\nsns.relplot(x = \"year\", y = \"suicide_100k\", \n            hue = \"sex\", col = \"age\", col_wrap = 3, data = df, \n            facet_kws=dict(sharey=False), kind = \"line\")\n\nplt.xlim(\"1985\", \"2015\")\nplt.subplots_adjust(top = 0.9)\nplt.suptitle(\"Evolution of suicide per sex and age category (1985 - 2015)\", size = 30);","22d1a3d2":"def barplot(year:int, nb:int, column = \"suicide_100k\"):\n    \"\"\"\n    This function plots the top \/ bottom n countries of the specified variable.\n    \"\"\"\n    df = suicide.groupby([\"year\", \"country\"]).agg(\"sum\").reset_index()\n    suicide_rate_year = df[df[\"year\"] == f\"{year}-01-01\"].set_index(\"country\")[column]\n    if nb > 0:\n        suicide_rate_year.nlargest(nb).sort_values().plot(kind = \"barh\")\n        plt.title(f\"Top {nb} country with highest {column} in {year}\", size = 20)\n        plt.show()\n    elif nb < 0:\n        suicide_rate_year.nsmallest(abs(nb)).sort_values().plot(kind = \"barh\")\n        plt.title(f\" Top {abs(nb)} countries with smallest {column} in {year}\", size = 20)\n        plt.show()","8a14b31d":"barplot(year= 1985, nb = 12, column= \"suicide_100k\")","a66f8829":"barplot(year= 1985, nb = -12, column= \"suicide_100k\")","c4c1b556":"barplot(2015, 10, \"suicide_100k\")","828c3305":"barplot(2015, -10, \"suicide_100k\")","45e0db3c":"def plot_scatter_links(x:str, y:str, years:list, \n                       agg_fun = \"sum\", n_col = None):\n    \n    df = suicide[suicide[\"year\"].isin(years)]\n    \n    df = df.groupby([\"year\", \"country\"]).agg(agg_fun).reset_index()\n    df[\"year\"] = df[\"year\"].dt.year.astype(\"object\")\n    sns.lmplot(x, y, scatter = True, fit_reg= True, \n               data = df, col = \"year\", col_wrap = n_col, sharex = False, sharey = False)","e4b8564d":"plot_scatter_links(x = \"gdp_capita\", y = \"suicide_100k\", \n                   years = [\"1985\",\"1995\", \"2005\", \"2015\"], n_col= 2, agg_fun= \"mean\")\nplt.subplots_adjust(top=.9)\nplt.suptitle(\"Sense of causation between Suicide and GDP\/capita\", size = 30);","56b0d3d3":"suicide.head()","05248226":"suicide[\"occurence\"] = 1\nsuicide[\"part_generation\"] = 0\n","19c037fb":"suicide_wide = suicide.groupby([\"year\", \"country\"]).agg(\"sum\").reset_index()\n\nsuicide_wide[\"year\"] = suicide_wide[\"year\"].dt.year","42c54ecf":"suicide_wide.head(10)","00cf36dc":"suicide_wide.shape","cf5e7c08":"interm = suicide.pivot(columns = \"generation\", values = \"population\")\nsuicide_new = pd.concat([suicide, interm], axis = 1).fillna(0)\nsuicide_new = suicide_new.groupby([\"year\", \"country\"]).agg(\"sum\").reset_index()","07766af3":"suicide_new.shape","72a35ead":"suicide_new[\"current_gdp\"] = suicide_new[\"current_gdp\"] \/ suicide_new[\"occurence\"]\nsuicide_new[\"gdp_capita\"] = suicide_new[\"gdp_capita\"] \/ suicide_new[\"occurence\"]\nsuicide_new[\"hdi_for_year\"] = suicide_new[\"hdi_for_year\"] \/ suicide_new[\"occurence\"]\ndel suicide_new[\"occurence\"]\ndel suicide_new[\"population\"]","d5e9f83a":"suicide_new.head()","0671faf4":"from sklearn.preprocessing import StandardScaler","d3870b05":"X = StandardScaler()","b4d7d403":"X = X.fit_transform(suicide_new.drop([\"year\", \"country\"], axis = 1))","f1210875":"selected_columns = ['suicides_no', 'suicide_100k', 'hdi_for_year',\n       'current_gdp', 'gdp_capita', 'part_generation', 'Boomers',\n       'G.I. Generation', 'Generation X', 'Generation Z', 'Millenials',\n       'Silent']\n\nsuicide_new[selected_columns] = X","86ba62d1":"suicide_new.head()","9c7b53da":"from sklearn.cluster import KMeans\ndata = suicide_new[suicide_new[\"year\"] == \"1985\"].drop([\"year\", \"suicides_no\"], \n                                                       axis = 1).set_index(\"country\")","1341a40c":"model = KMeans(init= \"k-means++\", n_clusters= 4, n_init = 20)\nmodel = model.fit(data)","27b66c3c":"pd.value_counts(model.labels_, sort = False)","41767881":"k = 4\nclusters = []\nfor j in range(0,k):\n    clusters.append([])\nfor i in range(0,data.shape[0]):\n    clusters[model.labels_[i]].append(data.index[i])\n#\n# Print out clusters\n#\nfor j in range(0,k):\n    print(30*\"-\", \"\\n\")\n    print( j, clusters[j])","26e13d1d":"data = suicide_new[suicide_new[\"year\"] == \"2015\"].drop([\"year\", \"suicides_no\"], \n                                                       axis = 1).set_index(\"country\")\nmodel = KMeans(init= \"k-means++\", n_clusters= 4, n_init = 20)\nmodel = model.fit(data)","f56b3734":"k = 4\nclusters = []\nfor j in range(0,k):\n    clusters.append([])\nfor i in range(0,data.shape[0]):\n    clusters[model.labels_[i]].append(data.index[i])\n#\n# Print out clusters\n#\nfor j in range(0,k):\n    print(30*\"-\", \"\\n\")\n    print( j, clusters[j])","5fc7585e":"from scipy.cluster import hierarchy as sch","7ded5bd6":"z = sch.linkage(data, method = \"ward\")","94337ee7":"info = sch.dendrogram(z, orientation = \"top\", labels= data.index)\nplt.title(\"Countries similarities in 2015\", size = 30);","36cbb50b":"Let's now use the function","28b8fd78":"The dataset contains 27820 observation and 12 columns.","ab78f8e7":"There is a significant gap between the suicide rate of man and woman. ","4d0b4649":"For the purpose of consistency on the column names, let's redefine the columns `suicides\/100k pop , country-year, gdp_for_year ($) , gdp_per_capita ($) `","f670c81f":"# Top \/ Bottom countries in variables","1fc1242a":"Fortunately the dataset doesn't have missing values except the `hdi_for_year` column.","c5a88b95":"Before we aggregate the data, it's important we track every single occurence so we can have back the original values. For that purpose I'm adding a new column called `occurence` which gives tha value 1 to every row so that whenever we group and sum the numeric data we can come back to the original data by dividing it.","6934b939":"The two previous columns are well balanced","e1545bae":"# Evolution of the variables","684a6102":"# Exploration\nHere we want to understand the dataset, the number of countries, the number of levels in different group categories, visualisations etc...","b967e8f4":"Now we have a column for each of the generation. \n# Scaling the dataset\nIt's now important to scale the dataset so each column will have the same weight. This is important because of the distance metric the KNN algorithm uses.","23973c50":"# How suicide rate has evolved since 1985 worldwide in regards of some socio-economic and demographic indicators ?\n\nThe World Health Organisation (WHO) is a specialised agency for the United Nations that is concerned with international public health (Wikipedia). For a long period of time the WHO has collected data on the suicide worlwide since 1985.  \nAccording to the WHO close to 800 000 people die due to suicide every year, which is one person every 40 seconds. Suicide is a global phenomenon and occurs throughout the lifespan. Effective and evidence-based interventions can be implemented at population, sub-population and individual levels to prevent suicide and suicide attempts.  \n\nI did previously an analysis of this data with R, in this notebook I'd like to use Python to explore the data. \nFeel free to fork this notebook if you want to extend it, and if you enjoy please upvote ! Thanks","3fccd721":"According to the KMeans Algorithms this is how similar are the countries in 1985. Let's build something much more deeper","e9a49347":"The dataset does not contain the same number of occurence for each country. This is mainly because the data is not available for every year for each country.  \nLet's explore the number of data points available for each years.","ce38266f":"## Suicide vs GDP per capita","38c5e608":"The data covers the period of 1985 to 2016","8a1325d3":"# Hierarchical clustering algorithm","e8274a08":"## For year 2015","73b3e787":"The dataset covers a period of 32 years. What is the range of the dataset ?","c0c78a4d":"Let's define a function that plots horizontal barplots to represent the countries with higher or smallest value for variables.","c07d409e":"# Kmeans clustering\n## for year 1985","c3b2ee05":"## Correlation among numeric variables\nWe need to group the data in order to aggregate the values that are spread into multiple rows. ","979132c7":"## Categorical variables","8b4e4746":"# Make the dataset wider \nHere I want to have a column for each of the generation. For that purpose I'll use the pivot function.","def7d3ca":"Let's view the shape of the dataset. ","984fa2f7":"# Link between the evolution of suicide and the evolution of other variables  \nWe want to see whether there has been links amongs the numeric variables","2d098bda":"We don't have data for all the countries everytime. Some years have very few observation, that's the case of 2016.","bb6da711":"# Data dictionary\nThis short section aims to present what some of the columns stand for.  \n- suicide_100k : This column represents the number of death by suicide out of total of 100.000 deaths. You can think of it as percentage but with a base 100.000 instead of 100.\n- hdi_for_year : It stands for the the Human Development Index for the year. It's between 0 and 1. Higher values represent higher life quality (education, health, and income )\n- current_gdp : It stands for the the Gross Domestic Product (the amount of wealth produced in the country in one year).\n\n## Note on the structure of the data\nAs we can see on the first five rows of the dataset, there seem to be redundant entries but there are not. There seems to have redundant entries because of the levels of the categorical columns (sex, age, generation). Each row represents different entries with one or more changes in the categorical columns.","4e7f3cac":"There is a total of 101 unique countries in the dataset. But does this mean that every countries have the same number of occurences ? Let's check for the number of occurences","4e809c82":"## Countries with highest suicide rate over years","9b7d841c":"# Cluster Analysis"}}