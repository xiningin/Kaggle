{"cell_type":{"7cff8369":"code","da324b8e":"code","96c287bb":"code","176aba75":"code","9112c8b6":"code","c0057443":"code","5200f48c":"code","bd74e7d4":"code","6046d63b":"code","1c2ca030":"code","3a3c8f25":"code","641c69ed":"code","f3582fab":"code","3a32322a":"code","4be1736a":"code","710d2610":"code","5c38e7f7":"code","58bc379f":"code","9b44f29b":"code","e73ddb32":"code","39846bc8":"code","753f5fc5":"code","af16c78e":"code","c3463950":"markdown","1b0c8673":"markdown","d706b41b":"markdown","b665aeab":"markdown","c4f11631":"markdown","44cb60e4":"markdown","e286fadd":"markdown","f8ed6c6b":"markdown","5f3af4fb":"markdown","ce709ab8":"markdown","995a1781":"markdown","83353a4d":"markdown"},"source":{"7cff8369":"import zipfile\nimport os\nimport pandas as pd\nimport tensorflow as tf\nfrom tensorflow import keras\nimport numpy as nps\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nfrom sklearn.model_selection import train_test_split","da324b8e":"with zipfile.ZipFile('..\/input\/dogs-vs-cats\/train.zip', 'r') as z :\n    z.extractall()","96c287bb":"filenames = os.listdir(\".\/train\")\ncategories = []\nfor image in filenames :\n    category = image.split('.')[0]\n    if category == 'dog' :\n        categories.append(1)\n    else :    \n        categories.append(0)","176aba75":"df = pd.DataFrame({'filename' : filenames, 'category' : categories})\ndf.head()","9112c8b6":"df['category'].value_counts()","c0057443":"for i in range(10) :\n    sample = filenames[i+10]\n    image = tf.keras.preprocessing.image.load_img('.\/train\/' + sample)\n    plt.imshow(image)\n    plt.title('dog' if categories[i+10]==1 else 'cat')\n    plt.show()","5200f48c":"#model \nmodel = keras.models.Sequential()\n\n##  Conv_1\nmodel.add(keras.layers.Conv2D(32, 3,input_shape = [128, 128, 3], activation = 'relu', padding = 'same'))\nmodel.add(keras.layers.BatchNormalization())\nmodel.add(keras.layers.MaxPool2D(2))\nmodel.add(keras.layers.Dropout(0.2))\n\n## Conv_2\nmodel.add(keras.layers.Conv2D(64, 3, activation = 'relu', padding = 'same'))\nmodel.add(keras.layers.BatchNormalization())\nmodel.add(keras.layers.MaxPool2D(2))\nmodel.add(keras.layers.Dropout(0.2))\n\n## Conv_3\nmodel.add(keras.layers.Conv2D(128, 3, activation = 'relu', padding = 'same'))\nmodel.add(keras.layers.BatchNormalization())\nmodel.add(keras.layers.MaxPool2D(2))\nmodel.add(keras.layers.Dropout(0.2))\n\n## Conv_4\nmodel.add(keras.layers.Conv2D(256, 3, activation = 'relu', padding = 'same'))\nmodel.add(keras.layers.BatchNormalization())\nmodel.add(keras.layers.MaxPool2D(2))\nmodel.add(keras.layers.Dropout(0.2))\n\n## Flatten\nmodel.add(keras.layers.Flatten())\n\n## fc_1\nmodel.add(keras.layers.Dense(1024, activation = 'relu'))\nmodel.add(keras.layers.Dropout(0.25))\n\n## fc_2\nmodel.add(keras.layers.Dense(2, activation = 'sigmoid'))\n\n## optimizer and loss\n#optimizer = keras.optimizers.RMSprop(lr = 0.01)\nmodel.compile(loss = 'categorical_crossentropy', optimizer = 'rmsprop', metrics = ['accuracy'])\n\nmodel.summary()","bd74e7d4":"earlystop = keras.callbacks.EarlyStopping(patience=10)\nlearning_rate_reduction = keras.callbacks.ReduceLROnPlateau(monitor='val_acc', \n                                            patience=2, \n                                            verbose=1, \n                                            factor=0.5, \n                                            min_lr=0.00001)\ncallbacks = [earlystop, learning_rate_reduction]","6046d63b":"df['category'] = df['category'].map({0 : 'cat', 1 : 'dog'})","1c2ca030":"train_df, valid_df = train_test_split(df, test_size=0.2, random_state=42)\ntrain_df = train_df.reset_index(drop=True)\nvalid_df = valid_df.reset_index(drop=True)","3a3c8f25":"total_train = train_df.shape[0]\ntotal_valid = valid_df.shape[0]\nbatch_size = 10","641c69ed":"train_data = keras.preprocessing.image.ImageDataGenerator(rotation_range=20,\n                                                         rescale = 1.\/255,\n                                                         horizontal_flip=True)\ntrain_generator = train_data.flow_from_dataframe(train_df,\n                                                '.\/train\/',\n                                                x_col = 'filename',\n                                                y_col = 'category',\n                                                target_size=[128,128],\n                                                class_mode='categorical',\n                                                batch_size=batch_size)\n","f3582fab":"valid_data = keras.preprocessing.image.ImageDataGenerator(rescale = 1.\/255)\n                                                         \n                                                         \nvalid_generator = valid_data.flow_from_dataframe(valid_df,\n                                                '.\/train\/',\n                                                x_col = 'filename',\n                                                y_col = 'category',\n                                                target_size=[128,128],\n                                                class_mode='categorical',\n                                                batch_size=batch_size)\n","3a32322a":"epochs = 30\nhistory = model.fit_generator(\n    train_generator, \n    epochs=epochs,\n    validation_data=valid_generator,\n    validation_steps=total_valid\/\/batch_size,\n    steps_per_epoch=total_train\/\/batch_size,\n    callbacks=callbacks)\n","4be1736a":"model.save_weights(\"model.h5\")","710d2610":"import numpy as np\nplt.plot(history.history['loss'], color='b', label=\"Training loss\")\nplt.plot(history.history['val_loss'], color='r', label=\"validation loss\")\nplt.xticks(np.arange(1, epochs, 1))\nplt.yticks(np.arange(0, 1, 0.1))\nplt.legend()\nplt.title('Training Loss VS Validation Loss')\nplt.show()","5c38e7f7":"plt.plot(history.history['accuracy'], color='b', label=\"Training accuracy\")\nplt.plot(history.history['val_accuracy'], color='r',label=\"Validation accuracy\")\nplt.xticks(np.arange(1, epochs, 1))\nplt.title('Training Accuracy VS Validation Accuracy')\nplt.legend()\nplt.show()","58bc379f":"with zipfile.ZipFile('..\/input\/dogs-vs-cats\/test1.zip', 'r') as z :\n    z.extractall()","9b44f29b":"filenames = os.listdir(\".\/test1\")\ntest_df = pd.DataFrame({'filename' : filenames})    \nsamples = test_df.shape[0]","e73ddb32":"test_data = keras.preprocessing.image.ImageDataGenerator(rescale=1.\/255)\ntest_generator = test_data.flow_from_dataframe(\n    test_df, \n    \".\/test1\/\", \n    x_col='filename',\n    y_col=None,\n    class_mode=None,\n    target_size=[128,128],\n    batch_size=batch_size,\n    shuffle=False)","39846bc8":"predict = model.predict_generator(test_generator, steps=np.ceil(samples\/batch_size))\n","753f5fc5":"test_df['category'] = np.argmax(predict, axis=-1)\ntest_df['category'] = test_df['category'].replace({ 'dog': 1, 'cat': 0 })","af16c78e":"submission_df = test_df.copy()\nsubmission_df['id'] = submission_df['filename'].str.split('.').str[0]\nsubmission_df['label'] = submission_df['category']\nsubmission_df.drop(['filename', 'category'], axis=1, inplace=True)\nsubmission_df.to_csv('submission.csv', index=False)","c3463950":"## Impots","1b0c8673":"2. Create Validation Set","d706b41b":"## Saving Parameters","b665aeab":"## Training Model ","c4f11631":"## Valid Generator","44cb60e4":"## Get The Images","e286fadd":"## Data Preparation\n","f8ed6c6b":"## Show some images ","5f3af4fb":"## Create The Model ","ce709ab8":"1. Encoding labels","995a1781":"## Train Generator","83353a4d":"## Prepaing Test Data"}}