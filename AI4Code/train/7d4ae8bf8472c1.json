{"cell_type":{"abea0155":"code","d4ffa7ea":"code","6469ca56":"code","c893004a":"code","44aee778":"markdown","9d228b95":"markdown","3bdfb826":"markdown","936ffb7a":"markdown","5eab16d8":"markdown"},"source":{"abea0155":"import numpy as np\nimport pydicom\nfrom pydicom.pixel_data_handlers.util import apply_voi_lut\n\nfrom skimage import exposure\n\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\n\ndef read_xray(path, voi_lut = True, fix_monochrome = True):\n    dicom = pydicom.read_file(path)\n    \n    # VOI LUT (if available by DICOM device) is used to transform raw DICOM data to \"human-friendly\" view\n    if voi_lut:\n        data = apply_voi_lut(dicom.pixel_array, dicom)\n    else:\n        data = dicom.pixel_array\n               \n    # depending on this value, X-ray may look inverted - fix that:\n    if fix_monochrome and dicom.PhotometricInterpretation == \"MONOCHROME1\":\n        data = np.amax(data) - data\n    \n    data = data - np.min(data)\n        \n    return data","d4ffa7ea":"img = read_xray('..\/input\/vinbigdata-chest-xray-abnormalities-detection\/train\/0108949daa13dc94634a7d650a05c0bb.dicom')\nplt.figure(figsize = (12,12))\nplt.imshow(img, 'gray')","6469ca56":"img = read_xray('..\/input\/vinbigdata-chest-xray-abnormalities-detection\/train\/0108949daa13dc94634a7d650a05c0bb.dicom')\nimg = exposure.equalize_hist(img)\nplt.figure(figsize = (12,12))\nplt.imshow(img, 'gray')","c893004a":"img = read_xray('..\/input\/vinbigdata-chest-xray-abnormalities-detection\/train\/0108949daa13dc94634a7d650a05c0bb.dicom')\nimg = exposure.equalize_adapthist(img\/np.max(img))\nplt.figure(figsize = (12,12))\nplt.imshow(img, 'gray')","44aee778":"### Summary\n\nX-ray devices generate device-specific pixel distributions - which are easy to overfit to. Histogram normalization and CLAHE are good approaches to minimze this effect.","9d228b95":"Different X-ray devices by different manufacturers may provide different looking X-rays for the same patient. In medical AI industry, overfitting to the device pixel distributions is quite a big problem. \n\nTherefore, it is standard practice to apply some kind of contrast\/brightness normalizations to minimize this problem.\n\nLet's define generic x-ray reading function:","3bdfb826":"### Histogram normalization\n\nThe general idea is to make pixel distribution uniform. This makes X-rays appear a little darker.\nThis generates view, which radiologist would not see in his standard workplace. \n\nSuch normalization is used in popular open-source X-ray datasets, such as CheXpert.","936ffb7a":"### CLAHE normalization\n\nThis method produces sharper images and is quite often used in chest X-ray research. \nThis generates view, which radiologist would not see in his standard workplace. However, it closely resembles the \"bone-enhanced\" view in some X-rays done (usually due to broken ribs).","5eab16d8":"### No normalization"}}