{"cell_type":{"2886e466":"code","3b7c858b":"code","8c82450b":"code","c574f99b":"code","8e3fcb3a":"code","63fc9159":"code","f5e8c5cf":"code","825d448c":"code","26d1b1d7":"code","cb7b6b33":"markdown","44c0dd8f":"markdown","03070fcf":"markdown","0f1c3c91":"markdown","264fa8d3":"markdown"},"source":{"2886e466":"import pandas as pd\nimport pickle\n\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.metrics import confusion_matrix, classification_report, accuracy_score, mean_squared_error\nfrom sklearn.model_selection import train_test_split, GridSearchCV","3b7c858b":"#Importing Our dataset\ndf = pd.read_csv(\"..\/input\/hotel-booking-demand\/hotel_bookings.csv\", sep=',')","8c82450b":"def meal_parser(x):\n    if x != 'Undefined':\n        return x.split(' ')[0]\n    else:\n        return 'Undefined'\n\ndef clean_RSD(x, dt='d'):\n    try:\n        if dt=='d':\n            dt_no = 2\n        elif dt=='m':\n            dt_no = 1\n        elif dt=='y':\n            dt_no = 0\n        return list(x)[0].split('-')[dt_no]\n    except:\n        return x.split('-')[dt_no]","c574f99b":"def cleananomalies(filepath='..\/input\/hotel-booking-demand\/hotel_bookings.csv'):\n\n    df = pd.read_csv(filepath, sep=',')\n    \n    # Cleaning reservation_status_date\n    \n    RSD = pd.DataFrame(pd.to_datetime(df[\"reservation_status_date\"]).astype(\"str\"))\n    \n    RSD[\"ReservationStatusDate_year\"] = RSD[\"reservation_status_date\"].apply(clean_RSD, args=(\"y\")).astype(int)\n    RSD[\"ReservationStatusDate_month\"] = RSD[\"reservation_status_date\"].apply(clean_RSD, args=(\"m\")).astype(int)\n    RSD[\"ReservationStatusDate_day\"] = RSD[\"reservation_status_date\"].apply(clean_RSD, args=(\"d\")).astype(int)\n    \n    df = pd.concat([df, RSD.iloc[:, 1:]], axis=1)\n    df.drop(\"reservation_status_date\", axis=1, inplace=True)\n    \n    # Cleaning arrival_date_month\n    \n    month_to_num = {\n        'January': '01',\n        'February': '02',\n        'March': '03',\n        'April': '04',\n        'May': '05',\n        'June': '06',\n        'July': '07',\n        'August': '08',\n        'September':'09',\n        'October': '10',\n        'November': '11',\n        'December': '12'\n    }\n    \n    df[\"arrival_date_month\"] = df[\"arrival_date_month\"].map(month_to_num).astype(int)\n    \n    df.drop(\"company\", axis=1, inplace=True)\n    df.drop(\"hotel\", axis=1, inplace=True)\n    \n    # Cleaning meal\n    \n    meal_data = df[\"meal\"].apply(meal_parser)\n    meal_data = pd.get_dummies(meal_data)\n    \n    # df = pd.concat([df, meal_data], axis=1)\n    df.drop(\"meal\", axis=1, inplace=True)\n    \n    # Cleaning reservation_status\n    \n    df = pd.concat([df, pd.get_dummies(df[\"reservation_status\"])], axis=1)\n    df.drop(\"reservation_status\", axis=1, inplace=True)\n    \n    # Cleaning customer_type\n    \n    # df = pd.concat([df, pd.get_dummies(df[\"customer_type\"])], axis=1)\n    df.drop(\"customer_type\", axis=1, inplace=True)\n    \n    # Cleaning distribution_channel\n    \n    # df = pd.concat([df, pd.get_dummies(df[\"distribution_channel\"])], axis=1)\n    df.drop(\"distribution_channel\", axis=1, inplace=True)\n    \n    # Cleaning market_segment\n    \n    # df = pd.concat([df, pd.get_dummies(df[\"market_segment\"])], axis=1)\n    df.drop(\"market_segment\", axis=1, inplace=True)\n    \n    drop_object_cols = ['country',\n                    'reserved_room_type',\n                    'assigned_room_type',\n                    'deposit_type','agent', 'children']\n    df.drop(drop_object_cols, axis=1, inplace=True)\n    \n    return(df)\n","8e3fcb3a":"def RandomForestClassifierImpl(X_train, X_test, y_train, y_test):\n    rfc = RandomForestClassifier(n_estimators=1000)\n    rfc.fit(X_train, y_train)\n    \n    # predicting values\n    pred = rfc.predict(X_test)\n    pred_proba = rfc.predict_proba(X_test)\n    \n    accuracy = accuracy_score(y_test, pred)\n    \n    print(accuracy)\n    \n    print(mean_squared_error(y_test, pred))\n    \n    df1 = pd.DataFrame()\n    df1 = df1.append(X_test)\n    df1['Predictions'] = pred\n    \n    return(df1)","63fc9159":"#Calling our custom function to clean Input data\ndf = cleananomalies()","f5e8c5cf":"# Label\ny = df[\"Canceled\"]\n\n# Features\nX = df.drop(['is_canceled', 'Canceled', 'Check-Out'], axis=1)\n\n# Splitting the dataset into Train-Test Split\nX_train, X_test, y_train, y_test = train_test_split(X, y)\n\ndf1 = RandomForestClassifierImpl(X_train, X_test, y_train, y_test)","825d448c":"df1.head()","26d1b1d7":"#Exporting Output to export.csv\ndf1.to_csv(\".\/export.csv\", index=False)","cb7b6b33":"# **Creating custom function to clean anomalies in data**","44c0dd8f":"# **Importing Libraries**","03070fcf":"# **Defining Our Function to clean Meal and to Seggregate Reservation status date**","0f1c3c91":"# **Predicting whether a person booking a hotel will cancel their booking**","264fa8d3":"# **Using Random Forest Classification to predict which person is more likely to cancel their booking**"}}