{"cell_type":{"e4a62ebb":"code","c480ccdc":"code","d5df3a8f":"code","5f2afc27":"code","322b2eec":"code","88d59e15":"code","041b3534":"code","43ef43c1":"code","a3acb922":"markdown","9a636c1a":"markdown","1c5f32fb":"markdown","44ca4237":"markdown","2ed332f5":"markdown","75c77d06":"markdown","01e8944f":"markdown"},"source":{"e4a62ebb":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport bq_helper\ngithub = bq_helper.BigQueryHelper(active_project=\"bigquery-public-data\",\n                                              dataset_name=\"github_repos\")","c480ccdc":"query = (\"\"\"\n        SELECT L.license, COUNT(sf.path) AS number_of_files\n        FROM `bigquery-public-data.github_repos.files` as sf\n        INNER JOIN `bigquery-public-data.github_repos.licenses` as L \n            ON sf.repo_name = L.repo_name\n        GROUP BY L.license\n        ORDER BY number_of_files DESC\n        \"\"\")\n\nfile_count_by_license = github.query_to_pandas_safe(query, max_gb_scanned=200)\nsns.barplot(x='license', y='number_of_files', data=file_count_by_license);\nplt.xticks(rotation=45);","d5df3a8f":"query = (\"\"\"\n        WITH tmp1 AS (\n        SELECT repo_name, SUM(size) AS total_size\n        FROM `bigquery-public-data.github_repos.files` f\n        INNER JOIN `bigquery-public-data.github_repos.contents` c\n          ON f.id = c.id\n        GROUP BY repo_name\n        ), tmp2 AS (\n        SELECT tmp1.repo_name, SUM(size) AS binary_size\n        FROM `bigquery-public-data.github_repos.files` f\n        INNER JOIN `bigquery-public-data.github_repos.contents` c\n          ON f.id = c.id\n          AND c.binary=True\n        INNER JOIN tmp1\n          ON tmp1.repo_name = f.repo_name\n        GROUP BY repo_name\n        ), tmp3 AS(\n        SELECT tmp1.repo_name, SUM(size) AS text_size\n        FROM `bigquery-public-data.github_repos.files` f\n        INNER JOIN `bigquery-public-data.github_repos.contents` c\n          ON f.id = c.id\n          AND c.binary=False\n        INNER JOIN tmp1\n          ON tmp1.repo_name = f.repo_name\n        GROUP BY repo_name\n        )\n        SELECT tmp1.repo_name, total_size, binary_size, text_size\n        FROM tmp1\n        INNER JOIN tmp2\n          ON tmp1.repo_name = tmp2.repo_name\n        INNER JOIN tmp3\n          ON tmp2.repo_name = tmp3.repo_name\n        ORDER BY total_size\n        LIMIT 20\n        \"\"\")\n\nrepo_sizes = github.query_to_pandas_safe(query, max_gb_scanned=200)\n\ng = sns.factorplot(x='repo_name', y='value', hue='variable', \n               data=repo_sizes.melt(id_vars=['repo_name'], value_vars=['total_size', 'binary_size', 'text_size']),\n               size=10,\n               kind='bar'\n              )\nfor ax in g.axes.flat:\n    labels = ax.get_xticklabels()\n    ax.set_xticklabels(labels, rotation=90)","5f2afc27":"query = (\"\"\"\n        WITH tmp as (\n        SELECT language.name AS name, language.bytes as bytes\n        FROM `bigquery-public-data.github_repos.languages` l\n        CROSS JOIN UNNEST(l.language) as language\n        )\n        SELECT name, SUM(bytes) as total_bytes\n        FROM tmp\n        GROUP BY name\n        ORDER BY total_bytes DESC\n        \"\"\")\n\nlanguage_bytes = github.query_to_pandas_safe(query, max_gb_scanned=200)\nplt.pie(x=language_bytes['total_bytes'][:10], labels=language_bytes['name'][:10], autopct='%.0f%%');\nlanguage_bytes","322b2eec":"query = (\"\"\"\n        SELECT repo_name, COUNT(1) as commit_count\n        FROM `bigquery-public-data.github_repos.commits` c\n        CROSS JOIN UNNEST(c.repo_name) as repo_name\n        GROUP BY repo_name\n        ORDER BY commit_count DESC\n        LIMIT 10\n        \"\"\")\n\nrepo_commits = github.query_to_pandas_safe(query, max_gb_scanned=200)\ng = sns.factorplot(x='repo_name', y='commit_count', \n               data=repo_commits,\n               size=10,\n               kind='bar'\n              )\nfor ax in g.axes.flat:\n    labels = ax.get_xticklabels()\n    ax.set_xticklabels(labels, rotation=90)","88d59e15":"query = (\"\"\"\n        SELECT repo_name, COUNT(DISTINCT author.name) as author_count\n        FROM `bigquery-public-data.github_repos.commits` c\n        CROSS JOIN UNNEST(c.repo_name) as repo_name\n        GROUP BY repo_name\n        ORDER BY author_count DESC\n        LIMIT 10\n        \"\"\")\n\nrepo_commits = github.query_to_pandas_safe(query, max_gb_scanned=200)\ng = sns.factorplot(x='repo_name', y='author_count', \n               data=repo_commits,\n               size=10,\n               kind='bar'\n              )\nfor ax in g.axes.flat:\n    labels = ax.get_xticklabels()\n    ax.set_xticklabels(labels, rotation=90)","041b3534":"query = (\"\"\"\n        SELECT author.name as author, COUNT(1) as commit_count\n        FROM `bigquery-public-data.github_repos.commits` c\n        GROUP BY author\n        ORDER BY commit_count DESC\n        LIMIT 10\n        \"\"\")\n\nrepo_commits = github.query_to_pandas_safe(query, max_gb_scanned=200)\ng = sns.factorplot(x='author', y='commit_count', \n               data=repo_commits,\n               size=10,\n               kind='bar'\n              )\nfor ax in g.axes.flat:\n    labels = ax.get_xticklabels()\n    ax.set_xticklabels(labels, rotation=90)","43ef43c1":"query = (\"\"\"\n        WITH tmp as (\n        SELECT CAST(SUM(language.bytes)\/1024 AS INT64) as kilos\n        FROM `bigquery-public-data.github_repos.languages` l\n        CROSS JOIN UNNEST(l.language) as language\n        GROUP BY repo_name\n        HAVING kilos < 1024\n        )\n        SELECT kilos\n          , COUNT(1) AS count\n        FROM tmp\n        GROUP BY kilos\n        ORDER BY kilos ASC\n        \"\"\")\n\nrepo_commits = github.query_to_pandas_safe(query, max_gb_scanned=200)\ng = sns.factorplot(x='kilos', y='count', \n               data=repo_commits,\n               size=10,\n               kind='bar'\n              )\nfor ax in g.axes.flat:\n    ax.set_xticklabels([], rotation=90)","a3acb922":"## Active repos by Authors","9a636c1a":"## Popular Languages by Bytes","1c5f32fb":"## Popular Licenses","44ca4237":"## Active repos by commits","2ed332f5":"##  Repo Size Distribution","75c77d06":"## Largest repos in size","01e8944f":"## Active Authors by Commits"}}