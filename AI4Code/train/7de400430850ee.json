{"cell_type":{"2333395d":"code","f62c4838":"code","94746dcf":"code","28a37782":"code","45250be5":"code","33dc6632":"code","cb149d9d":"code","1dc3a76f":"code","0a42da44":"code","1d091297":"code","ce4d54b6":"code","98ba9325":"code","695f6823":"code","8c5d34a7":"code","970c9b83":"code","7510915f":"code","d3a87c8f":"code","cb0c4aad":"code","9b288361":"code","4ef6efaf":"code","4a536b1e":"code","a11510a3":"code","2f904c1b":"code","21086440":"code","46ee35ee":"markdown","5b90d8fc":"markdown","f311b7a1":"markdown","c4cb80af":"markdown","c221bd74":"markdown","4b1ac85d":"markdown","9681625b":"markdown","53e2157a":"markdown","1e0a9674":"markdown","03672f55":"markdown"},"source":{"2333395d":"%reload_ext autoreload\n%autoreload 2\n%matplotlib inline\nimport torch\nimport torch.nn.functional as F\nimport torchvision\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom torchvision.datasets import CIFAR10\nfrom torchvision.transforms import ToTensor\nfrom torchvision.utils import make_grid\nfrom torch.utils.data.dataloader import DataLoader\nfrom torch.utils.data import random_split\nimport collections\n%matplotlib inline","f62c4838":"from fastai.vision import *\nfrom fastai.metrics import error_rate","94746dcf":"bs = 64\n# bs = 16   # uncomment this line if you run out of memory even after clicking Kernel->Restart","28a37782":"help(untar_data)","45250be5":"from torchvision.datasets import CIFAR10\nfrom torchvision.transforms import ToTensor\n","33dc6632":"dataset = CIFAR10(root='data\/', download=True, transform=ToTensor())\ntest_dataset = CIFAR10(root='data\/', train=False, transform=ToTensor())","cb149d9d":"type(dataset)","1dc3a76f":"torch.manual_seed(43)\nval_size = 5000\ntrain_size = len(dataset) - val_size","0a42da44":"from torch.utils.data.dataloader import DataLoader\nfrom torch.utils.data import random_split","1d091297":"train_ds, val_ds = random_split(dataset, [train_size, val_size])\nlen(train_ds), len(val_ds)","ce4d54b6":"from psutil import *\nbatch_size = 128\n\ntrain_loader = DataLoader(train_ds, batch_size, shuffle=True, num_workers=cpu_count(), pin_memory=True)\nval_loader = DataLoader(val_ds, batch_size*2, num_workers=cpu_count(), pin_memory=True)\ntest_loader = DataLoader(test_dataset, batch_size*2, num_workers=cpu_count(), pin_memory=True)","98ba9325":"type(train_loader)","695f6823":"data = ImageDataBunch(train_loader, val_loader, None, test_loader)","8c5d34a7":"# cnn_learner() threw an error because data.c wasn't set\ndata.c = 10\nImageDataBunch","970c9b83":"learn = cnn_learner(data, models.resnet34, metrics=error_rate)","7510915f":"?models","d3a87c8f":"learn.model","cb0c4aad":"learn.fit_one_cycle(10)","9b288361":"learn.fit_one_cycle(10)","4ef6efaf":"interp.classes = ['airplane',\n 'automobile',\n 'bird',\n 'cat',\n 'deer',\n 'dog',\n 'frog',\n 'horse',\n 'ship',\n 'truck']","4a536b1e":"interp = ClassificationInterpretation.from_learner(learn)\n\nlosses,idxs = interp.top_losses()\nlen(data.valid_ds)==len(losses)==len(idxs)","a11510a3":"interp.most_confused(min_val=100)","2f904c1b":"learn.unfreeze # at this point I unlocked the whole model.\nlearn.fit_one_cycle(10)","21086440":"interp = ClassificationInterpretation.from_learner(learn)\ninterp.most_confused(min_val=100)","46ee35ee":"## Training: resnet34","5b90d8fc":"Now we will start training our model. We will use a [convolutional neural network](http:\/\/cs231n.github.io\/convolutional-networks\/) backbone and a fully connected head with a single hidden layer as a classifier. Don't know what these things mean? Not to worry, we will dive deeper in the coming lessons. For the moment you need to know that we are building a model which will take images as input and will output the predicted probability for each of the categories (in this case, it will have 37 outputs).\n\nWe will train for 4 epochs (4 cycles through all our data).","f311b7a1":"If you're using a computer with an unusually small GPU, you may get an out of memory error when running this notebook. If this happens, click Kernel->Restart, uncomment the 2nd line below to use a smaller *batch size* (you'll learn all about what this means during the course), and try again.","c4cb80af":"Hard problems stay hard. The model gains were in getting better at solving the easier classifications.","c221bd74":"We import all the necessary packages. We are going to work with the [fastai V1 library](http:\/\/www.fast.ai\/2018\/10\/02\/fastai-ai\/) which sits on top of [Pytorch 1.0](https:\/\/hackernoon.com\/pytorch-1-0-468332ba5163). The fastai library provides many useful functions that enable us to quickly and easily build neural networks and train our models.","4b1ac85d":"# Lesson 1 - What's your pet","9681625b":"Welcome to lesson 1! For those of you who are using a Jupyter Notebook for the first time, you can learn about this useful tool in a tutorial we prepared specially for you; click `File`->`Open` now and click `00_notebook_tutorial.ipynb`. \n\nIn this lesson we will build our first image classifier from scratch, and see if we can achieve world-class results. Let's dive in!\n\nEvery notebook starts with the following three lines; they ensure that any edits to libraries you make are reloaded here automatically, and also that any charts or images displayed are shown in this notebook.","53e2157a":"## Looking at the data","1e0a9674":"## Results","03672f55":"We are going to use the [Oxford-IIIT Pet Dataset](http:\/\/www.robots.ox.ac.uk\/~vgg\/data\/pets\/) by [O. M. Parkhi et al., 2012](http:\/\/www.robots.ox.ac.uk\/~vgg\/publications\/2012\/parkhi12a\/parkhi12a.pdf) which features 12 cat breeds and 25 dogs breeds. Our model will need to learn to differentiate between these 37 distinct categories. According to their paper, the best accuracy they could get in 2012 was 59.21%, using a complex model that was specific to pet detection, with separate \"Image\", \"Head\", and \"Body\" models for the pet photos. Let's see how accurate we can be using deep learning!\n\nWe are going to use the `untar_data` function to which we must pass a URL as an argument and which will download and extract the data."}}