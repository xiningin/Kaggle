{"cell_type":{"97c7995a":"code","f43d8892":"code","952075a5":"code","4bd9f45f":"code","3b7e2159":"code","97d8de02":"code","f7dcbae2":"code","dae0cb97":"code","5b80cb09":"code","63fae64b":"code","9580ee78":"code","d7d1545d":"code","679f6115":"code","20bb5f67":"code","0fa94024":"code","81b7fd09":"code","23f6638b":"code","7d45260f":"code","59051a3e":"code","6b5cb5f5":"code","4e2f8205":"code","cf7fe304":"code","ca1ac6b8":"code","d6ae049d":"code","98e4c200":"code","272b66dd":"code","e7d1f946":"code","4479a78f":"code","44451f74":"code","0f4112e8":"code","46a7cc03":"code","68feb940":"code","8e690c0b":"code","8c1fadde":"code","814c4758":"code","a0df9850":"code","e9ad9e3f":"markdown","32107400":"markdown","f1e5afc0":"markdown","e69e6a2b":"markdown","7771ba1e":"markdown","6c1d3e04":"markdown","b4072915":"markdown","6a7e3601":"markdown","add06a78":"markdown","ae7edceb":"markdown","0bc047a2":"markdown","1c813987":"markdown","3d2c36a8":"markdown","b3e931a5":"markdown","007f1b9e":"markdown","f7b0b9e6":"markdown","2cabb60e":"markdown","8904335f":"markdown","4b7d3e25":"markdown","55ce4119":"markdown","48e9aa0e":"markdown","1fdf733c":"markdown","95937e30":"markdown","8caedc33":"markdown","412254a9":"markdown","68a01099":"markdown","a0450ae7":"markdown","abb0332d":"markdown","12f4b154":"markdown","ece15092":"markdown","a9236bef":"markdown"},"source":{"97c7995a":"\nimport numpy as np \nimport pandas as pd \npd.plotting.register_matplotlib_converters()\nimport matplotlib.pyplot as plt\n#%matplotlib inline\nimport seaborn as sns\nimport datetime as dt\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\nprint('Setup Complete')","f43d8892":"my_filepath = '..\/input\/moroccocoronavirus\/corona_morocco.csv'\nmy_data = pd.read_csv(my_filepath)","952075a5":"my_data['Date']=[dt.datetime.strptime(x,'%d\/%m\/%Y') for x in my_data['Date'] ]","4bd9f45f":"# Print the first five rows of the data\nmy_data.head()","3b7e2159":"my_data = my_data.fillna(0) ","97d8de02":"my_data = my_data.set_index('Date')\n\nmy_data.head()","f7dcbae2":"actif_column= my_data['Confirmed'] - my_data['Recovered'] - my_data['Deaths']\ntotal_test_perDay = my_data['Confirmed'] + my_data['Excluded']\nmy_data['Actif'] = actif_column\nmy_data['Total Test'] = total_test_perDay\n","dae0cb97":"\nplt.figure(figsize=(10,5))\nsns.lineplot(data = my_data['Confirmed'],label='Confirmed')\nsns.lineplot(data = my_data['Recovered'],label='Recovered')\nplt.xlabel('Date')\nplt.ylabel('Total number')\nplt.title('Graph chart of confirmed and recovered cases in Morocco')\n\nplt.legend()","5b80cb09":"\nmy_data['2020-04-13':'2020-04-16']","63fae64b":"my_data_ori = my_data.copy() # later we will need all Confirmed,Death and Recovered collumns for all date uncluding 14,15 April\n\nmy_data = my_data[my_data.index != '2020-04-14']\nmy_data = my_data[my_data.index != '2020-04-15']","9580ee78":"plt.figure(figsize=(10,5))\nsns.lineplot(data = my_data['Total Test'],label='Total Test')\nplt.xlabel('Date')\nplt.ylabel('Number of tests')\n","d7d1545d":"plt.figure(figsize=(10,5))\nsns.regplot(x = my_data['Total Test'],y = my_data['Confirmed'])","679f6115":"# Selecting regions\nRegions1 = ['Beni Mellal-Khenifra',\n       'Casablanca-Settat', 'Draa-Tafilalet', 'Dakhla-Oued Ed-Dahab',\n       'Fes-Meknes', 'Laayoune-Sakia El Hamra','Guelmim-Oued Noun', 'Laayoune-Sakia El Hamra',\n       'Marrakesh-Safi', 'Oriental', 'Rabat-Sale-Kenitra', 'Souss-Massa','Tanger-Tetouan-Al Hoceima']\n\n\nplt.figure(figsize=(14,8))\nsns.lineplot(data = my_data[Regions1],dashes=False)\nplt.text('2020-05-10', 2250, 'Casabalanca-Settat', fontsize=12,color='#ff4500')\nplt.text('2020-05-12', 1350, 'Marrakesh-Safi', fontsize=12,color='#4682B4')\nplt.text('2020-05-10', 1100, 'Tanger-Tetouan-Al Hoceima', fontsize=10,color='#FF69B4')\nplt.title('Total cases evolution per region',fontsize = 20)","20bb5f67":"region_bar = my_data.iloc[[-1]].transpose()\nregion_bar = region_bar.drop(['Confirmed','Recovered','Deaths','Excluded','Actif','Total Test'])\nregion_bar.columns=['Total cases']\nregion_bar.index.name = 'Regions'\nplt.figure(figsize=(20,6))\nsns.barplot(x=region_bar.index,y='Total cases',data=region_bar)\nplt.title('Total case per region',fontsize=20)","0fa94024":"plt.figure(figsize=(14,8))\nsns.lineplot(data = my_data['Actif'],label='Acif')\nplt.axvline('2020-03-20',ls = '--',c = 'r')\nplt.axvline('2020-04-20',ls = '--',c = 'r')\nplt.axvline('2020-05-20',ls = '--',c = 'r')\nplt.axvline('2020-06-10',ls = '--',c = 'g')\nplt.text('2020-03-21', 1500, 'Lockdown', fontsize=12,color='#FF0000')\nplt.text('2020-04-21', 1500, 'Lockdown extended', fontsize=12,color='#FF0000')\nplt.text('2020-05-21', 1500, 'Lockdown extended', fontsize=12,color='#FF0000')\nplt.text('2020-06-11', 1500, 'Lockdown End', fontsize=12,color='#00FA00')\nplt.xlabel('Date')\nplt.ylabel('Total actif cases')\nplt.title('Actif cases ')\nplt.legend()","81b7fd09":"# getting the data that we want to plot\nplt.figure(figsize=(15,5))\ndataVar1 =(my_data_ori['Actif']*100\/my_data_ori['Confirmed'])[15:]\ndataVar3 =(my_data_ori['Deaths']*100\/my_data_ori['Confirmed'])[15:]\ndataVar2 =(my_data_ori['Recovered']*100\/my_data_ori['Confirmed'])[15:]\n\n\n# plot each data\np1 = plt.bar(dataVar1.index, \n             dataVar1,label='Actif')\n\np2 = plt.bar(dataVar2.index, \n             dataVar2,\n             bottom=dataVar1,color='g',label='Recovered')\n\np3 = plt.bar(dataVar3.index,\n             dataVar3,\n             bottom=dataVar1+dataVar2,color='r',label='Deaths')\n\nplt.xlabel('Date')\nplt.ylabel('Pourcentage %')\nplt.title('Pourcentage of distribution of cases')\nplt.legend()","23f6638b":"\nplt.figure(figsize=(25,10))\n\nBM = my_data['Beni Mellal-Khenifra']\nCS = my_data['Casablanca-Settat']\nDT = my_data['Draa-Tafilalet']\nDO = my_data['Dakhla-Oued Ed-Dahab']\nFM = my_data['Fes-Meknes']\nGO = my_data['Guelmim-Oued Noun']\nLS = my_data['Laayoune-Sakia El Hamra']\nMS = my_data['Marrakesh-Safi']\nOr = my_data['Oriental']\nRS = my_data['Rabat-Sale-Kenitra']\nSM = my_data['Souss-Massa']\nTT = my_data['Tanger-Tetouan-Al Hoceima']\n\nax1 = plt.subplot(4, 3, 1)\nsns.lineplot(data = BM,label='Beni Mellal-Khenifra')\nax2 = plt.subplot(4, 3, 2)\nsns.lineplot(data = CS,label='Casablanca-settat')\nax3 = plt.subplot(4, 3, 3)\nsns.lineplot(data = DT,label='Draa-Tafilalet')\nax4 = plt.subplot(4, 3, 4)\nsns.lineplot(data = DO,label='Dakhla-Oued Ed Dahab')\nax5 = plt.subplot(4, 3, 5)\nsns.lineplot(data = FM,label='Fes-Meknes')\nax6 = plt.subplot(4, 3, 6)\nsns.lineplot(data = GO,label='Guelmim Oued Noun')\nax7 = plt.subplot(4, 3, 7)\nsns.lineplot(data = LS,label='Laayoune Sakia El Hamra')\nax8 = plt.subplot(4, 3, 8)\nsns.lineplot(data = MS,label='Marakesh Safi')\nax9 = plt.subplot(4, 3, 9)\nsns.lineplot(data = Or,label='Rabat Sale Kenitra')\nax10 = plt.subplot(4, 3, 10)\nsns.lineplot(data = RS,label='Souss Massa')\nax11 = plt.subplot(4, 3, 11)\nsns.lineplot(data = SM,label='Acif')\nax12 = plt.subplot(4, 3, 12)\nsns.lineplot(data = TT,label='Tanger Tetouane Al Hoceima')\n","7d45260f":"plt.figure(figsize=(16,8))\nSlice = [my_data['Beni Mellal-Khenifra'][-1],my_data['Casablanca-Settat'][-1],my_data['Draa-Tafilalet'][-1],\n        my_data['Dakhla-Oued Ed-Dahab'][-1],my_data['Fes-Meknes'][-1],my_data['Guelmim-Oued Noun'][-1],\n        my_data['Rabat-Sale-Kenitra'][-1],my_data['Souss-Massa'][-1],my_data['Tanger-Tetouan-Al Hoceima'][-1],\n        my_data['Laayoune-Sakia El Hamra'][-1],my_data['Marrakesh-Safi'][-1],my_data['Oriental'][-1]]\nLabels = ['Beni Mellal-Khenifra','Casablanca-Settat','Draa-Tafilalet','Dakhla-Oued Ed-Dahab','Fes-Meknes',\n         'Guelmim-Oued Noun','Rabat-Sale-Kenitra','Souss-Massa','Tanger-Tetouan-Al Hoceima','Laayoune-Sakia El Hamra',\n         'Marrakesh-Safi','Oriental']\nColors = ['#f78fA7','#EE204D','#FF7538','#1F75FE','#4CB7A5','#1CAC78','#FCE833', '#926EAE', '#828E84' ,\n          '#000000', '#008080','#808080']\nExplode = [0,0,0,0,0,0,0,0,0,0,0,0]\nplt.pie(Slice,colors = Colors,explode = Explode,shadow = True,autopct='%1.1f%%',\n        labels = Labels,wedgeprops = {'edgecolor':'white'})\n\n\nplt.title('Pie Chart of Total cases per region')\n","59051a3e":"my_data","6b5cb5f5":"from fbprophet import Prophet","4e2f8205":"total_Deaths = my_data['Deaths']\ntotal_Confirmed = my_data['Confirmed']\ntotal_Recovered = my_data['Recovered']\nmortaloty_rate = 100*total_Deaths\/total_Confirmed","cf7fe304":"# Adding a new daily cases column to our data\nnew_cases = []\nfor i in range(len(total_Confirmed)):\n    if i == 0:\n        new_cases.append(0)\n    elif total_Confirmed[i] < total_Confirmed[i-1]:\n        new_cases.append(0)\n    else:\n        temp = int(total_Confirmed[i] - total_Confirmed[i-1])\n        new_cases.append(temp)\n    \nnew_cases = np.array(new_cases)\nmy_data['New cases'] = new_cases","ca1ac6b8":"df = pd.DataFrame(my_data['New cases'])\ndf.style.background_gradient(cmap='Reds')","d6ae049d":"# Hands of plotly to visualise the current situation\n\nimport plotly.express as px\nimport plotly.graph_objects as go\n\n\nfig = px.bar(my_data, x=my_data.index, y=\"New cases\", color='New cases', orientation='v', height=600,\n             title='Confirmed Cases in Morocco', color_discrete_sequence = px.colors.cyclical.IceFire)\nfig.show()\n\nfig = go.Figure()\nfig.add_trace(go.Scatter(x=my_data.index, y = my_data['Confirmed'], mode= 'lines+markers',name='Total Cases'))\nfig.add_trace(go.Scatter(x=my_data.index, y = my_data['Recovered'], mode='lines+markers',name='Recovered',line=dict(color='Green', width=2)))\nfig.add_trace(go.Scatter(x=my_data.index, y=my_data['Deaths'], mode='lines+markers', name='Deaths', line=dict(color='Red', width=2)))\nfig.update_layout(title_text='Trend of Coronavirus Cases in Morocco (Cumulative cases)',plot_bgcolor='rgb(230, 230, 230)')\n\nfig.show()\n\nfig = go.Figure()\nfig.add_trace(go.Scatter(x=my_data.index, y = my_data['Actif'], mode= 'lines+markers',name='Total Cases'))\nfig.update_layout(title_text='Trend of Actif Coronavirus Cases in Morocco ',plot_bgcolor='rgb(230, 230, 230)')\nfig.show()","98e4c200":"confirmed = my_data.groupby('Date').sum()['Confirmed'].reset_index()\n\nconfirmed.columns = ['ds','y']","272b66dd":"m = Prophet(interval_width=0.95)\nm.fit(confirmed)\nfuture = m.make_future_dataframe(periods=10)\nfuture.tail(10)","e7d1f946":"#predicting the future with date, and upper and lower limit of y value\nforecast = m.predict(future)\nforecast[['ds', 'yhat', 'yhat_lower', 'yhat_upper']].tail()","4479a78f":"\nfig = go.Figure()\nfig.add_trace(go.Scatter(x=forecast.ds, y = abs(forecast['yhat'].round()), mode= 'lines+markers',name='Predicted daily cases'))\nfig.add_trace(go.Scatter(x=forecast.ds, y = abs(forecast['yhat_lower'].round()), mode= 'markers',name='Predicted daily cases yhat_lower'))\nfig.add_trace(go.Scatter(x=forecast.ds, y = abs(forecast['yhat_upper'].round()), mode= 'markers',name='Predicted daily cases yhat_upper'))\n\nfig.add_trace(go.Scatter(x=my_data.index, y = my_data['Confirmed'], mode= 'lines+markers',name='Daily cases'))","44451f74":"new_cases = my_data.groupby('Date').sum()['New cases'].reset_index()\nnew_cases.columns = ['ds','y']","0f4112e8":"m_1 = Prophet(interval_width=0.95)\nm_1.fit(new_cases)\nfuture_1 = m_1.make_future_dataframe(periods=10)\nfuture_1.tail()","46a7cc03":"forecast_1 = m_1.predict(future_1)\nforecast_1[['ds', 'yhat', 'yhat_lower', 'yhat_upper']].tail()","68feb940":"\nfig = go.Figure()\nfig.add_trace(go.Scatter(x=forecast_1.ds, y = abs(forecast_1['yhat'].round()), mode= 'lines+markers',name='Predicted daily cases'))\n\nfig.add_trace(go.Scatter(x=my_data.index, y = my_data['New cases'], mode= 'lines+markers',name='Daily cases'))","8e690c0b":"deaths = my_data.groupby('Date').sum()['Deaths'].reset_index()\ndeaths.columns = ['ds','y']","8c1fadde":"m_2 = Prophet(interval_width=0.95)\nm_2.fit(deaths)\nfuture_2 = m_2.make_future_dataframe(periods=10)\nfuture_2.tail()","814c4758":"forecast_2 = m_2.predict(future_2)\nforecast_2[['ds', 'yhat', 'yhat_lower', 'yhat_upper']].tail()","a0df9850":"\nfig = go.Figure()\nfig.add_trace(go.Scatter(x=forecast_2.ds, y = abs(forecast_2['yhat'].round()), mode= 'lines+markers',name='Predicted total deaths'))\n\nfig.add_trace(go.Scatter(x=my_data.index, y = my_data['Deaths'], mode= 'lines+markers',name='Daily cases'))","e9ad9e3f":"Replacing missing Values with the value 0","32107400":"Graphing the number of confirmed cases and recoveries.","f1e5afc0":"Daily increases of total test ","e69e6a2b":"# Part 1: Analysing the present condition in Morocco","7771ba1e":"Repartition of new cases for rows 14 and 15 Avril  on region are not available and that will affect our analysis \n","6c1d3e04":"\nImport the data","b4072915":"![](https:\/\/i.pinimg.com\/originals\/0d\/60\/9f\/0d609f75fa434c08ea210397644981fa.png)","6a7e3601":"The model predict more new cases in Morocco and it will get worse with the end of restrictions in some provinces","add06a78":"Generating a 10 days ahead forecast of confirmed cases  using Prophet, with 95% prediction interval by creating a base model with no tweaking of seasonality-related parameters and additional regressors.","ae7edceb":"Pie Chart of total cases per region","0bc047a2":"Graphing the evolution of total cases per regions","1c813987":"Importing prophet\n","3d2c36a8":"Pourcentage of Actif,death and recovered cases per day","b3e931a5":"# 3. Predicting the total deaths","007f1b9e":"The input to Prophet is always a dataframe with two columns: ds and y. The ds (datestamp) column should be of a format expected by Pandas, ideally YYYY-MM-DD for a date or YYYY-MM-DD HH:MM:SS for a timestamp. The y column must be numeric, and represents the measurement we wish to forecast","f7b0b9e6":"Graphing actif cases \n> > NB : the red vertical lines represents the lockdown periods","2cabb60e":"Setting Date column as index","8904335f":"# Part 2: Forecasting Total Number of Cases - Deaths and Confirmed Cases","4b7d3e25":"the optimal solution for the missing datas in this example is to **drop them out**.\n","55ce4119":"Importing libraries ","48e9aa0e":"Correlation between number of tests per day and the new confirmed cases\n","1fdf733c":"As shown the model predict a stable daily cases for the next 10 days.\n","95937e30":"**Casablanca-Settat,Tanger-Tetouan Al Hoceima ,Marrakesh Safi have the greatest values of the total cases, because of the comercial,industrial and familial epicenter, especially for the cities of Casablanca and Tangier that represent the  largest industrial zones in Morocco.**","8caedc33":"Adding actif case and total tests per day to the dataset\n","412254a9":"\nConvert Date collumn into datetime for better visualization","68a01099":"# COVID-19 - Pandemic in Morocco! \n   Coronavirus is a family of viruses that are named after their spiky crown. The novel coronavirus, also known as SARS-CoV-2, is a contagious respiratory virus that first reported in Wuhan, China. On 2\/11\/2020, the World Health Organization designated the name COVID-19 for the disease caused by the novel coronavirus. This notebook aims at exploring COVID-19 in Morocco through data analysis and projections.\n   Morocco reacted decisively to the threat of Covid-19 pandemic, declared a state of emergency, and imposed a strict one-month curfew on 20 March and extended it until 20 May 2020 and added 20 day until 10 Juin. The Moroccan authorities implemented several measures to control the spread of the virus.\nHere some important dates and news :\n\n* 02 March 2020 Health ministry confirms first COVID-19 case \n* 10 March 2020 Government suspends all travel to Italy \n* 10 March 2020 Government confirms first COVID-19 fatality\n* 15 March 2020 Government suspends all international travel \n* 15 March 2020 Morocco Suspends School Amid Coronavirus Fears\n* 19 March 2020 Government declares state of emergency \n* 21 March 2020 Intercity transport suspended \n* 07 April 2020 Face masks required in the public space \n* 27 April 2020 Government introduces Ramadan overnight curfew until May 20\n* 19 May 2020 Authorities extend state of emergency and nationwide lockdown to June 10\n* 10 Juin 2020 Authorities extend state of emergency to July 10\n* 10 Juin 2020 Restrictions to be eased in some provinces from June 11\n\nReferences :\n*  [GARDAWORLD](https:\/\/www.garda.com\/crisis24\/histoire-complete-alerte-de-securite\/NctzfWdtzBiz43uLt\/morocco-royal-air-maroc-suspends-flights-to-mainland-china-due-to-novel-coronavirus-as-of-january-31)\n* [Morocco World news](https:\/\/www.moroccoworldnews.com\/2020\/03\/296119\/morocco-suspends-school-amid-coronavirus-fears\/)\n* [ALZAJEERA CENTER OF STUDIES](https:\/\/studies.aljazeera.net\/en\/reports\/how-arab-states-take-coronavirus-morocco-case-study)\n\n\n![](https:\/\/i.ibb.co\/6JHC2vc\/c-OVID-TEMPLATE-EVOUTION2.png)\n\n\n\n> STAY HOME, STAY SAFE!\n\n Last update: 12\/06\/2020 4:24 PM ","a0450ae7":"# 2. Predicting the new daily cases","abb0332d":"Graphing total cases per regions","12f4b154":"Prophet is open source software released by Facebook\u2019s Core Data Science team. It is available for download on CRAN and PyPI.\n\nWe use Prophet, a procedure for forecasting time series data based on an additive model where non-linear trends are fit with yearly, weekly, and daily seasonality, plus holiday effects. It works best with time series that have strong seasonal effects and several seasons of historical data. Prophet is robust to missing data and shifts in the trend, and typically handles outliers well. ","ece15092":"# 1. Predecting the trend of confirmed cases in the next 10 Days","a9236bef":"A quick look to what we have "}}