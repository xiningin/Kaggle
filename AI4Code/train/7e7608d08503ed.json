{"cell_type":{"2cc7cc62":"code","bda564fc":"code","3cfb113d":"code","41d4bdb2":"code","de2f0237":"code","f9a62652":"code","376a2740":"code","ffc1b03c":"code","870c5c52":"code","2d2bcf5b":"code","71e94c17":"code","afb69e06":"code","66a9a0dd":"code","6135f914":"code","c4a9f45a":"code","7e6b2292":"code","db820d84":"code","c660fc3c":"code","35e38cc2":"code","43a50cd7":"code","b35699e8":"code","23c4bbdc":"code","0ce32273":"code","0f0cebb7":"code","d8a7780d":"code","6ace6f2b":"code","287a43c6":"code","41010922":"code","773d5c21":"code","0c28e0ab":"code","43897324":"code","66f54107":"code","32fdf033":"markdown","82301536":"markdown","1426e1d0":"markdown","9fd7d0cb":"markdown","64097592":"markdown","cc41e2ea":"markdown","cb48ddf1":"markdown","5ed4ee56":"markdown","042e9fe8":"markdown","38b80eac":"markdown","48298758":"markdown","1a6c8071":"markdown"},"source":{"2cc7cc62":"# packages\n\n# standard\nimport numpy as np\nimport pandas as pd\nimport time\n\n# plots\nimport matplotlib.pyplot as plt\nimport plotly.express as px\nimport seaborn as sns\n\n# PCA\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.decomposition import PCA\n\n# Machine Learning\/H2O\nimport h2o\nfrom h2o.estimators import H2ORandomForestEstimator","bda564fc":"# load data\ndf = pd.read_csv('..\/input\/pulsar-classification-for-class-prediction\/Pulsar.csv')\n\n# type conversions\ndf.Class = df.Class.astype('category')","3cfb113d":"# preview\ndf.head()","41d4bdb2":"# structure of data frame\ndf.info()","de2f0237":"# eval target\nprint(df['Class'].value_counts())\nprint()\nprint(df['Class'].value_counts(normalize=True))\n\nplt.figure(figsize=(8,6))\ndf['Class'].value_counts().plot(kind='bar')\nplt.title('Target (Class)')\nplt.grid()\nplt.show()","f9a62652":"features_num = ['Mean_Integrated', 'SD', 'EK', \n                'Skewness', 'Mean_DMSNR_Curve',\n                'SD_DMSNR_Curve', 'EK_DMSNR_Curve',\n                'Skewness_DMSNR_Curve']\n\n# summary stats for numerical features\ndf[features_num].describe()","376a2740":"# plot distributions (histogram + boxplot)\nfor f in features_num:\n    fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(11,7), sharex=True)\n    ax1.hist(df[f], bins=20)\n    ax1.grid()\n    ax1.set_title(f)\n    ax2.boxplot(df[f], vert=False)\n    ax2.grid()   \n    ax2.set_title(f + ' - boxplot')\n    plt.show()","ffc1b03c":"# pairwise scatter plot\nsns.pairplot(df[features_num], \n             kind='reg',\n             plot_kws={'line_kws':{'color':'magenta'}, \n                       'scatter_kws': {'alpha': 0.25}})\nplt.show()","870c5c52":"# calc correlations\ncorr_pearson = df[features_num].corr(method='pearson')\ncorr_spearman = df[features_num].corr(method='spearman')\n\n# and plot\nplt.figure(figsize=(8,6))\nsns.heatmap(corr_pearson, annot=True, cmap='RdYlGn', vmin=-1, vmax=+1)\nplt.title('Pearson Correlation')\nplt.show()","2d2bcf5b":"# plot correlation matrix (Spearman)\nplt.figure(figsize=(8,6))\nsns.heatmap(corr_spearman, annot=True, cmap='RdYlGn', vmin=-1, vmax=+1)\nplt.title('Spearman Correlation')\nplt.show()","71e94c17":"for f in features_num:\n    plt.figure(figsize=(10,4))\n    sns.violinplot(x=f, y='Class', data=df)\n    my_title = 'Distribution by Class for ' + f\n    plt.title(my_title)\n    plt.grid()","afb69e06":"# use PCA to reduce dimension of data\ndf4pca = df[features_num]\n# standardize first\ndf4pca_std = StandardScaler().fit_transform(df4pca)\n# define 3D PCA\npc_model = PCA(n_components=3)\n# apply PCA\npc = pc_model.fit_transform(df4pca_std)\n# add to original data frame\ndf['pc_1'] = pc[:,0]\ndf['pc_2'] = pc[:,1]\ndf['pc_3'] = pc[:,2]\n# show extended data frame\ndf.head()","66a9a0dd":"# interactive plot - click on legend to filter for individual classes\ndf_subset = df.sample(2500) # use subset only to get performant plot\ndf_subset['size'] = 1\nfig = px.scatter_3d(df_subset, x='pc_1', y='pc_2', z='pc_3',\n                    color='Class',\n                    size='size',\n                    size_max=10,\n                    opacity=0.5)\nfig.update_layout(title='PCA 3D Interactive')\nfig.show()","6135f914":"# init H2O\nh2o.init(max_mem_size='12G', nthreads=4)","c4a9f45a":"# upload data frame in H2O environment\nt1 = time.time()\ndf_hex = h2o.H2OFrame(df)\nt2 = time.time()\nprint('Elapsed time [s]: ', np.round(t2-t1,2))","7e6b2292":"# define target\ntarget = 'Class'\n# select features\nfeatures = features_num\nprint('Features used:', features)\n# explicitly convert target to categorical => classification problem\ndf_hex[target] = df_hex[target].asfactor()","db820d84":"# train \/ test split\ntrain_perc = 0.7\ntrain_hex, test_hex = df_hex.split_frame(ratios=[train_perc], seed=999)","c660fc3c":"# check target distribution in train set\ntrain_hex[target].as_data_frame().value_counts()","35e38cc2":"# check target distribution in test set\ntest_hex[target].as_data_frame().value_counts()","43a50cd7":"# define (distributed) random forest model\nn_cv = 5\nfit_DRF = H2ORandomForestEstimator(ntrees=50,\n                                   max_depth=20,\n                                   min_rows=5,\n                                   nfolds=n_cv,\n                                   score_each_iteration=True,\n                                   stopping_metric='auc',\n                                   stopping_rounds=5,\n                                   stopping_tolerance=1e-4,\n                                   seed=999)\n\n# train model\nt1 = time.time()\nfit_DRF.train(x=features,\n              y=target,\n              training_frame=train_hex)\nt2 = time.time()\nprint('Elapsed time [s]: ', np.round(t2-t1,2))","b35699e8":"# variable importance\nfit_DRF.varimp_plot()","23c4bbdc":"# alternative variable importance using SHAP\n# => see direction as well as severity of feature impact\nt1 = time.time()\nfit_DRF.shap_summary_plot(train_hex);\nt2 = time.time()\nprint('Elapsed time [s]: ', np.round(t2-t1,2))","0ce32273":"# cross validation metrics\nfit_DRF.cross_validation_metrics_summary()","0f0cebb7":"# show scoring history - training vs cross validations\nfor i in range(n_cv):\n    cv_model_temp = fit_DRF.cross_validation_models()[i]\n    df_cv_score_history = cv_model_temp.score_history()\n    my_title = 'CV ' + str(1+i) + ' - Scoring History [AUC]'\n    plt.scatter(df_cv_score_history.number_of_trees,\n                y=df_cv_score_history.training_auc, \n                c='blue', label='training')\n    plt.scatter(df_cv_score_history.number_of_trees,\n                y=df_cv_score_history.validation_auc, \n                c='darkorange', label='validation')\n    plt.title(my_title)\n    plt.xlabel('Number of Trees')\n    plt.ylabel('AUC')\n    plt.ylim(0.9,1.0)\n    plt.legend()\n    plt.grid()\n    plt.show()","d8a7780d":"# training performance\nperf_train = fit_DRF.model_performance(train=True)\nperf_train.plot()","6ace6f2b":"# cross validation performance\nperf_cv = fit_DRF.model_performance(xval=True)\nperf_cv.plot()","287a43c6":"# predict on training set\npred_train = fit_DRF.predict(train_hex)\n# add actual target\npred_train['target'] = train_hex[target]\npred_train = pred_train.as_data_frame()\n# preview\npred_train.head()","41010922":"# confusion matrix; rows ~ actual observations, cols ~ predictions\nconf_train = pd.crosstab(pred_train['target'], pred_train['predict'])\n# visualize\nsns.heatmap(conf_train, cmap='Blues', annot=True, \n            cbar=False, fmt='d',\n            linecolor='black',\n            linewidths=0.1)\nplt.show()","773d5c21":"# predict\npred_test = fit_DRF.predict(test_hex)\n# add actual target\npred_test['target'] = test_hex[target]\npred_test = pred_test.as_data_frame()\npred_test.head()","0c28e0ab":"# confusion matrix; rows ~ actual observations, cols ~ predictions\nconf_test = pd.crosstab(pred_test['target'], pred_test['predict'])\n# visualize\nsns.heatmap(conf_test, cmap='Blues', annot=True, \n            cbar=False, fmt='d',\n            linecolor='black',\n            linewidths=0.1)\nplt.show()","43897324":"# pick an example\nmy_row = 5\ntrain_hex[my_row,:]","66f54107":"# show explanations for this row\nfit_DRF.explain_row(frame=train_hex, row_index=my_row);","32fdf033":"### Correlations","82301536":"# Binary Classification of Pulsars\n\n## Table of Contents\n* [Target](#1)\n* [Numerical Features](#2)\n* [Target vs Features](#3)\n* [Visualization using PCA](#4)\n* [Fit Model](#5)\n* [Evaluate Model Performance](#6)\n* [Explanations](#7)\n","1426e1d0":"<a id='7'><\/a>\n# Explanations","9fd7d0cb":"<a id='3'><\/a>\n# Target vs Features","64097592":"#### No missing values...","cc41e2ea":"<a id='4'><\/a>\n# Visualization using PCA","cb48ddf1":"<a id='5'><\/a>\n# Fit Model","5ed4ee56":"### Test Set Performance","042e9fe8":"<a id='1'><\/a>\n# Target","38b80eac":"<a id='2'><\/a>\n# Numerical Features","48298758":"### Train Set \/ CV Performance","1a6c8071":"<a id='6'><\/a>\n# Evaluate Model Performance"}}