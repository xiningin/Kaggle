{"cell_type":{"3fe3b88e":"code","9cd22c6f":"code","6acd9e0c":"code","4e1d2876":"code","4c315494":"code","a9ff5e12":"markdown","7d3f24b2":"markdown","abf6cd4f":"markdown"},"source":{"3fe3b88e":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\nimport matplotlib.pyplot as plt\nimport pydicom\nimport matplotlib.patches as patches\nfrom skimage.filters import *\n\n# Any results you write to the current directory are saved as output.","9cd22c6f":"def my_list(rows):\n    for row in rows:\n        return list(row)\ndf = pd.read_csv(\"..\/input\/stage_1_train_labels.csv\")\n#                 converters={\"x\" : np.float64, \"y\" : np.float64, \"width\" : np.float64, \"height\" : np.float64})\ndf.head()\ndf_patient = pd.DataFrame(df.groupby(\"patientId\")[\"x\"].apply(list))\ndf_patient[\"y\"] = pd.DataFrame(df.groupby(\"patientId\")[\"y\"].apply(list))\ndf_patient[\"width\"] = pd.DataFrame(df.groupby(\"patientId\")[\"width\"].apply(list))\ndf_patient[\"height\"] = pd.DataFrame(df.groupby(\"patientId\")[\"height\"].apply(list))\ndf_patient[\"Target\"] = pd.DataFrame(df.groupby(\"patientId\")[\"Target\"].apply(list))\n","6acd9e0c":"def display_image(row, col, img, values, title):\n    ax[row][col].set_title(title)\n    ax[row][col].imshow(img, cmap=plt.cm.bone) \n    for val in values:\n        for i in range(len(val[0])):\n            rect = patches.Rectangle((val[0][i], val[1][i]),\n                                     val[2][i], val[3][i],linewidth=1,edgecolor='r',facecolor='none')\n            ax[row][col].add_patch(rect)\n","4e1d2876":"last_target = 1\ncount = 0\nnum_cols = 2\nfig,ax = plt.subplots(nrows=3, ncols=2, figsize=(8, 20))\nwhile count < 6:\n    sample = df_patient.sample()\n    if  sample.iloc[0][\"Target\"][0] == last_target:\n        continue\n    last_target = 0 if last_target == 1 else 1\n    filename =  \"..\/input\/stage_1_train_images\/\" + sample.index[0] + \".dcm\"\n    ds = pydicom.dcmread(filename)\n    row = int(count\/num_cols)\n    col = count%num_cols\n    display_image(row, col,ds.pixel_array,sample.values, sample.index[0]  )\n    count += 1\n\nplt.show()\n","4c315494":"# def display_image(row, col, ax, image, values):\n#     ax[row][col].imshow(image, cmap=plt.cm.bone) \n#     for val in values:\n#         for i in range(len(val[0])):\n#             rect = patches.Rectangle((val[0][i], val[1][i]),\n#                                      val[2][i], val[3][i],linewidth=1,edgecolor='r',facecolor='none')\n#             ax[row][col].add_patch(rect)\n  \n\ncount = 0\nnum_cols = 2\nfig,ax = plt.subplots(nrows=4, ncols=2, figsize=(8, 20))\nwhile count < 6:\n    sample = df_patient.sample()\n    filename =  \"..\/input\/stage_1_train_images\/\" + sample.index[0] + \".dcm\"\n    ds = pydicom.dcmread(filename)\n    row = int(count\/num_cols)\n    col = count%num_cols\n    img = ds.pixel_array\n    display_image(row, col, img, sample.values, \"original\" )\n    count += 1\n    from skimage import exposure\n    # Contrast stretching\n    p2, p98 = np.percentile(img, (2, 98))\n    img_rescale = exposure.rescale_intensity(img, in_range=(p2, p98))\n\n    # Equalization\n    img_eq = exposure.equalize_hist(img)\n\n    # Adaptive Equalization\n    img_adapteq = exposure.equalize_adapthist(img, clip_limit=0.03)\n    row = int(count\/num_cols)\n    col = count%num_cols\n    display_image(row, col, img_rescale, sample.values, \"rescale\" )\n    count += 1\n    row = int(count\/num_cols)\n    col = count%num_cols\n    display_image(row, col, img_eq, sample.values, \"hist eq\" )\n    count += 1\n    row = int(count\/num_cols)\n    col = count%num_cols\n    display_image(row, col, img_adapteq, sample.values, \"adaptive eq\" )\n    count += 1\nplt.show()\n","a9ff5e12":"## Normalize contrasts","7d3f24b2":"## sample 3 each of positive and negative images and display with tags","abf6cd4f":"## build a dataframe indexed by patient"}}