{"cell_type":{"59996e89":"code","f0638486":"code","6b30ba05":"code","57b09dfc":"code","30828e31":"code","27b5323b":"code","8abae5f4":"code","c370d699":"code","812f102d":"code","59118a14":"code","052d6d7e":"code","8bb87afa":"code","aa83bcb1":"code","9d9ced2b":"code","07852d32":"code","ad9c1acd":"code","d5bdb9be":"code","07aea3f0":"code","f9c04e7c":"code","a4b588de":"code","ddc95bff":"code","93557bb9":"code","0435fd87":"code","7debca9b":"code","182299ed":"code","214586a4":"code","aef42974":"code","371a7c3b":"code","aa5a0619":"code","d463e5ca":"code","d41e8976":"code","fef703b5":"code","f1ae56ae":"code","c48b651b":"code","86ba28d7":"code","2e325494":"code","24f7be77":"code","3ec6770d":"code","1843d138":"code","e1cfd87e":"code","7c940b0a":"code","e1f118f8":"code","375f9927":"code","e320350c":"code","840b911c":"code","c90e345a":"code","a04d11ad":"code","c706b861":"code","973911a4":"code","75270dd3":"code","5d2f48f2":"code","ab0a39a7":"code","3c3e540b":"code","1e8c1f49":"code","ec61d0a2":"code","753e065d":"code","2c9db6d4":"code","c1fb8a30":"code","50f3856e":"code","0e31adc4":"code","b9d65edb":"code","8375b443":"code","b63b8444":"code","ce4bdb12":"code","20520fce":"code","8e6d7a6b":"code","61b8e87e":"code","7b852bc4":"code","3aa5cf6e":"code","9feebac1":"code","0c13d6bd":"code","3d522c15":"code","c87b14c1":"code","01a5ccdd":"code","25cb32c4":"code","26551753":"code","c459df7c":"code","1060da67":"code","8fee4329":"code","017d1b5d":"code","7c67c7f5":"code","d8be383e":"code","9b74f973":"code","9fb14785":"code","e4bce509":"code","0c3c6718":"code","b0e6e419":"code","c60b2a25":"code","ceadacba":"code","589de90d":"code","baffc8d1":"code","287b07cf":"code","6e62d3ab":"code","864b3fa3":"code","57cb662d":"code","f8b34cbc":"code","0c5a2e1b":"code","294675ae":"code","7563aa23":"code","d6e09d7e":"code","a47dfe83":"markdown","008ca330":"markdown","10c76e14":"markdown","97776054":"markdown","24990758":"markdown","8fd7a8b1":"markdown","5d05a312":"markdown","bdf6950b":"markdown","bc1729b9":"markdown","6537d851":"markdown","6088d89c":"markdown","f531d440":"markdown","f0ce5ebb":"markdown","d59077b6":"markdown","8215aa12":"markdown","eb783261":"markdown","b6b34a6b":"markdown"},"source":{"59996e89":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n\npd.set_option('display.max_columns', None)\npd.set_option('display.max_rows', None)","f0638486":"pwd","6b30ba05":"data_info = pd.read_csv(\"..\/input\/lendingclub-data-sets\/lending_club_info.csv\",index_col='LoanStatNew')","57b09dfc":"data_info.head()","30828e31":"print(data_info.loc['revol_util']['Description'])","27b5323b":"def feat_info(col_name):\n    print(data_info.loc[col_name]['Description'])","8abae5f4":"feat_info('mort_acc')","c370d699":"df = pd.read_csv('..\/input\/lendingclub-data-sets\/lending_club_loan_two.csv')","812f102d":"df.head()","59118a14":"sns.countplot(x=\"loan_status\",data=df);","052d6d7e":"plt.figure(figsize=(10,6))\nsns.distplot(df[\"loan_amnt\"],kde=True,bins=50);","8bb87afa":"df.corr()","aa83bcb1":"plt.figure(figsize=(10,8))\nsns.heatmap(df.corr(),annot=True,cmap =\"viridis\");\nplt.ylim(10,0)","9d9ced2b":"feat_info(\"installment\")","07852d32":"feat_info(\"loan_amnt\")","ad9c1acd":"plt.figure(figsize=(10,6))\nsns.scatterplot(x=\"installment\",y=\"loan_amnt\",data=df);","d5bdb9be":"sns.boxplot(x=\"loan_status\",y=\"loan_amnt\",data=df)","07aea3f0":"df.groupby(\"loan_status\")[\"loan_amnt\"].describe()","f9c04e7c":"df[\"grade\"].unique()","a4b588de":"df[\"sub_grade\"].unique()","ddc95bff":"sns.countplot(x=\"grade\",data=df,hue=\"loan_status\");","93557bb9":"plt.figure(figsize=(15,5))\nsubgrade_order = sorted(df[\"sub_grade\"].unique())\nsns.countplot(x=\"sub_grade\",data=df,order=subgrade_order,palette=\"coolwarm\");","0435fd87":"plt.figure(figsize=(15,5))\nsubgrade_order = sorted(df[\"sub_grade\"].unique())\nsns.countplot(x=\"sub_grade\",data=df,order=subgrade_order,palette=\"coolwarm\",hue=\"loan_status\");","7debca9b":"f_and_g = df[(df[\"grade\"]==\"G\") | (df[\"grade\"]==\"F\")]\n\nplt.figure(figsize=(15,5))\nsubgrade_order = sorted(f_and_g[\"sub_grade\"].unique())\nsns.countplot(x=\"sub_grade\",data=f_and_g,order=subgrade_order,hue=\"loan_status\");","182299ed":"df[\"loan_repaid\"] = df[\"loan_status\"].map({\"Fully Paid\":1,\"Charged Off\":0})","214586a4":"df.corr()[\"loan_repaid\"].sort_values().drop(\"loan_repaid\").plot(kind=\"bar\");","aef42974":"df.describe().T","371a7c3b":"df.shape","aa5a0619":"df.isnull().sum()","d463e5ca":"100 * df.isnull().sum() \/ len(df)","d41e8976":"df[\"emp_title\"].nunique()","fef703b5":"df[\"emp_title\"].value_counts()","f1ae56ae":"df.drop(\"emp_title\",axis=1,inplace=True)","c48b651b":"sorted(df[\"emp_length\"].dropna().unique())","86ba28d7":"emp_length_order = ['< 1 year',\n '1 year',\n '2 years',\n '3 years',\n '4 years',\n '5 years',\n '6 years',\n '7 years',\n '8 years',\n '9 years',\n '10+ years'] ","2e325494":"plt.figure(figsize=(15,5))\nsns.countplot(x=\"emp_length\",data=df,order=emp_length_order);","24f7be77":"plt.figure(figsize=(15,5))\nsns.countplot(x=\"emp_length\",data=df,order=emp_length_order,hue=\"loan_status\");","3ec6770d":"emp_co = df[df[\"loan_status\"] == \"Charged Off\"].groupby(\"emp_length\").count()[\"loan_status\"]","1843d138":"emp_fp = df[df[\"loan_status\"] == \"Fully Paid\"].groupby(\"emp_length\").count()[\"loan_status\"]","e1cfd87e":"emp_len = emp_co\/(emp_co+emp_fp)","7c940b0a":"emp_len.plot(kind=\"bar\");","e1f118f8":"df.drop(\"emp_length\",axis=1,inplace=True)","375f9927":"df.head()","e320350c":"df[\"purpose\"].head(10)","840b911c":"df[\"title\"].head(10)","c90e345a":"df.drop(\"title\",axis=1,inplace=True)","a04d11ad":"feat_info(\"mort_acc\")","c706b861":"df.corr()[\"mort_acc\"].sort_values().drop(\"mort_acc\").plot(kind=\"bar\");","973911a4":"total_acc_avg = df.groupby(\"total_acc\").mean()[\"mort_acc\"]","75270dd3":"def fill_mort_acc(total_acc,mort_acc):\n    if np.isnan(mort_acc):\n        return total_acc_avg[total_acc]\n    else:\n        return mort_acc","5d2f48f2":"df[\"mort_acc\"] = df.apply(lambda x: fill_mort_acc(x[\"total_acc\"],x[\"mort_acc\"]),axis=1)","ab0a39a7":"df.isnull().sum()","3c3e540b":"df.dropna(inplace=True)","1e8c1f49":"df.select_dtypes([\"object\"]).columns","ec61d0a2":"feat_info(\"term\")","753e065d":"df[\"term\"].value_counts()","2c9db6d4":"df[\"term\"] = df[\"term\"].apply(lambda term: int(term[:3]))","c1fb8a30":"feat_info(\"grade\")","50f3856e":"df[\"grade\"].value_counts().sort_values(ascending=False)","0e31adc4":"df.drop(\"grade\",axis=1,inplace=True)","b9d65edb":"dummies = pd.get_dummies(df[\"sub_grade\"],drop_first=True)","8375b443":"df = pd.concat([df.drop(\"sub_grade\",axis=1),dummies],axis=1)","b63b8444":"df.columns","ce4bdb12":"dummies = pd.get_dummies(df[[\"verification_status\",\"application_type\",\"initial_list_status\",\"purpose\"]],drop_first=True)\ndf = pd.concat([df.drop([\"verification_status\",\"application_type\",\"initial_list_status\",\"purpose\"],axis=1),dummies],axis=1)","20520fce":"df.head()","8e6d7a6b":"df[\"home_ownership\"].value_counts()","61b8e87e":"df[\"home_ownership\"] = df[\"home_ownership\"].replace([\"NONE\",\"ANY\"],\"OTHER\")","7b852bc4":"df[\"home_ownership\"].value_counts()","3aa5cf6e":"dummies = pd.get_dummies(df[\"home_ownership\"],drop_first=True)\ndf = pd.concat([df.drop(\"home_ownership\",axis=1),dummies],axis=1)","9feebac1":"df[\"zip_code\"] = df[\"address\"].apply(lambda x:x[-5:])","0c13d6bd":"df[\"zip_code\"].value_counts()","3d522c15":"dummies = pd.get_dummies(df[\"zip_code\"],drop_first=True)\ndf = pd.concat([df.drop(\"zip_code\",axis=1),dummies],axis=1)","c87b14c1":"df.drop(\"address\",axis=1,inplace=True)","01a5ccdd":"feat_info(\"issue_d\")","25cb32c4":"df.drop(\"issue_d\",axis=1,inplace=True)","26551753":"df[\"earliest_cr_year\"] = df[\"earliest_cr_line\"].apply(lambda x: int(x[-4:]))","c459df7c":"df.drop(\"earliest_cr_line\",axis=1,inplace=True)","1060da67":"df = df.drop(\"loan_status\",axis=1)","8fee4329":"X = df.drop(\"loan_repaid\",axis=1).values\ny = df[\"loan_repaid\"].values","017d1b5d":"from sklearn.model_selection import train_test_split","7c67c7f5":"X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=101)","d8be383e":"from sklearn.preprocessing import MinMaxScaler","9b74f973":"scaler = MinMaxScaler()","9fb14785":"X_train = scaler.fit_transform(X_train)\nX_test = scaler.transform(X_test)","e4bce509":"X_train.shape","0c3c6718":"import tensorflow as tf \nfrom tensorflow.keras.models import Sequential\nfrom tensorflow.keras.layers import Dense,Dropout","b0e6e419":"model = Sequential()\n\nmodel.add(Dense(78,activation=\"relu\"))\nmodel.add(Dropout(0.2))\n\nmodel.add(Dense(39,activation=\"relu\"))\nmodel.add(Dropout(0.2))\n\nmodel.add(Dense(19,activation=\"relu\"))\nmodel.add(Dropout(0.2))\n\nmodel.add(Dense(1,activation=\"sigmoid\"))\n\nmodel.compile(loss=\"binary_crossentropy\",optimizer=\"adam\")","c60b2a25":"model.fit(x=X_train, y=y_train, epochs=10, batch_size=256, validation_data=(X_test,y_test))","ceadacba":"from tensorflow.keras.models import load_model","589de90d":"model.save(\"lending_club_model.h5\")","baffc8d1":"losses = pd.DataFrame(model.history.history)","287b07cf":"losses.plot();","6e62d3ab":"from sklearn.metrics import classification_report,confusion_matrix","864b3fa3":"predictions = model.predict_classes(X_test)","57cb662d":"print(classification_report(y_test,predictions))","f8b34cbc":"confusion_matrix(y_test,predictions)","0c5a2e1b":"import random\nrandom.seed(101)\nrandom_ind = random.randint(0,len(df))\n\nnew_customer = df.drop(\"loan_repaid\",axis=1).iloc[random_ind]\nnew_customer","294675ae":"new_customer = scaler.transform(new_customer.values.reshape(1,78))","7563aa23":"model.predict_classes(new_customer)","d6e09d7e":"df.iloc[random_ind][\"loan_repaid\"]","a47dfe83":"### Creating Model","008ca330":"### Data Preprocessing","10c76e14":"### EDA","97776054":"### earliest_cr_line","24990758":"### Save the Model","8fd7a8b1":"###\u00a0Categorical Variables and Dummy Variables","5d05a312":"### grade feature","bdf6950b":"### address","bc1729b9":"### Data Manipulation","6537d851":"* extract the year from this feature","6088d89c":"### issue_d","f531d440":"### term feature","f0ce5ebb":"### verification_status, application_type, initial_list_status, purpose","d59077b6":"* charge off rated are extremely similar across all employement lengths. So we drop the emp_lentgh column","8215aa12":"### home_ownership","eb783261":"### Evaluating Model Performance","b6b34a6b":"* this would be data leakage, we wouldn't know beforehand whether or not a loan would be issued when using our model, so drop this feature"}}