{"cell_type":{"0ed10d7b":"code","7604600e":"code","00e4655d":"code","8b3e14bf":"code","90b8c831":"code","3d6fa49f":"code","186fac8b":"code","13418878":"code","023f7990":"code","d33d8c41":"code","781954b9":"code","aef3b34b":"markdown","efcc24a1":"markdown","ecc6c215":"markdown"},"source":{"0ed10d7b":"!pip install -U geovoronoi[plotting]","7604600e":"## Importing the packages \nimport pandas as pd\nimport geopandas as gpd\nimport numpy as np\nimport requests as re\nfrom shapely.geometry import Point, Polygon\n\nfrom geovoronoi import coords_to_points, points_to_coords, voronoi_regions_from_coords\nfrom geovoronoi.plotting import subplot_for_map, plot_voronoi_polys_with_points_in_area\nimport matplotlib.pyplot as plt\n\nimport folium\nfrom folium.plugins import MarkerCluster\nfrom folium.features import DivIcon\nfrom folium.plugins import HeatMap","00e4655d":"## Lets get boundary of Kolkata city from OSM and plot it, using folium and the \nsearch_string = 'Kolkata+India'\nurlData = re.get(f'https:\/\/nominatim.openstreetmap.org\/search.php?q={search_string}&polygon_geojson=1&format=json').json()\nbounds = pd.DataFrame.from_dict(urlData)\nbounds.head(2)","8b3e14bf":"## for now lets define the bounds for enclosing the kolkata boundries\nrec_bound = [[88.2459, 22.6621], [88.4498, 22.6621], [88.4498, 22.4627], [88.2459, 22.4627], [88.2459, 22.6621]]\nrec_poly = Polygon(rec_bound)\nrec_poly","90b8c831":"## lets define some 21 points inside this rectangular bound, these have been taken from the pollution stations in Kolkata region \npoint_arr = [[88.3559   , 22.6322   ],\n       [88.354    , 22.6115   ],\n       [88.2965754, 22.5673377],\n       [88.3804785, 22.6270488],\n       [88.3426   , 22.5448   ],\n       [88.343274 , 22.585611 ],\n       [88.408248 , 22.561763 ],\n       [88.3707   , 22.5676   ],\n       [88.431324 , 22.569032 ],\n       [88.3541   , 22.5609   ],\n       [88.370977 , 22.495709 ],\n       [88.373702 , 22.601706 ],\n       [88.365247 , 22.519741 ],\n       [88.345842 , 22.516881 ],\n       [88.354387 , 22.537326 ],\n       [88.360217 , 22.582806 ],\n       [88.349983 , 22.555199 ],\n       [88.3444   , 22.571949 ],\n       [88.376852 , 22.658795 ],\n       [88.353041 , 22.546349 ],\n       [88.358787 , 22.562954 ]]\ncoords = np.array(point_arr)","3d6fa49f":"coords.shape","186fac8b":"## Creating voronoi cells using geo-voronoi \npoly_shapes, pts, poly_to_pt_assignments = voronoi_regions_from_coords(coords, rec_poly)","13418878":"df_voronoi_cells = gpd.GeoDataFrame()\ndf_voronoi_cells['geometry'] = poly_shapes\ndf_voronoi_cells['cell_id'] = np.array(poly_to_pt_assignments)\ndf_voronoi_cells['points'] = pts\ndf_voronoi_cells.head()","023f7990":"#Plotting the geo dataframe \ndf_voronoi_cells.plot(figsize=(8,8))","d33d8c41":"## Getting Kolkata city bounds\ntempdf = pd.DataFrame(bounds[bounds.type == 'administrative'].head(1).geojson.to_dict()[1]['coordinates'][0], columns=['lat','lon'])\nnp.array(tempdf[['lon','lat']])","781954b9":"m = folium.Map( location=[22.56241245, 88.4067751581234] ,tiles='Stamen Toner', zoom_start=12)\nfolium.TileLayer('openstreetmap').add_to(m)\n\n## Adding voronoi layer\nkolkata_voronoi_cells = folium.FeatureGroup(name=\"pollution voronoi\")\nfor index, row in df_voronoi_cells.iterrows():\n    lat, lon = row.geometry.exterior.coords.xy\n    folium.PolyLine(np.array([var for var in zip(lon , lat)]),color='orange', weight=3, fill=True,opacity=.3).add_to(kolkata_voronoi_cells)\n        \nkolkata_voronoi_cells.add_to(m)\n\n## Adding boundary layer Kolkata\nkolkata_boundary = folium.FeatureGroup(name=\"kolkata\")\nfolium.PolyLine(np.array(tempdf[['lon','lat']]),color='purple', weight=3).add_to(kolkata_boundary)\nkolkata_boundary.add_to(m)\n   \n## Adding Station Markers Layers\nfor point in point_arr:\n    folium.Marker([point[1], point[0]], popup = (f'station point \\n [Lat, Lon] \\n{[point[1], point[0]]}'),\n                 icon= folium.Icon(color='red',\n                                   icon_color='yellow',icon = 'cloud')).add_to(m)\n    \nfolium.LayerControl().add_to(m)\n\nm","aef3b34b":"## Lets define bounds for a city in India name Kolkata using shaply ploygon \n1. For getting boundries for a city we can use OSM api as below\n* search_string = 'Kolkata+India'\n* urlData = requests.get(f'https:\/\/nominatim.openstreetmap.org\/search.php?q={search_string}&polygon_geojson=1&format=json').json()\n* bounds = pd.DataFrame.from_dict(urlData)","efcc24a1":"## Notbook uses geopandas, geovoronoi and shaply and shows a way for \n1. Creating cells in spatial region based on voronoi tessilation and \n2. Corresponding plotting using geopandas\n3. An approach to get the geobounds of cities using OSM Maps\n4. Plotting geo spatial data using folium","ecc6c215":"## Voronoi cells can be used to devide a geometry into cells based on placement of the points inside it\n[Details](https:\/\/en.wikipedia.org\/wiki\/Voronoi_diagram)"}}