{"cell_type":{"a4db9fe8":"code","6da170e0":"code","cdfc25c2":"code","25d5c5e7":"code","d9fa5c82":"code","e45df0e1":"code","df35d7f0":"code","090e6c5f":"code","fb841faf":"code","e2f53f5b":"code","a7746fb9":"code","960b64e1":"code","33f50edd":"code","35b3c1ef":"code","33a5def0":"code","b7e80a8e":"code","6a40843c":"code","35f6c947":"code","1ed61e7d":"code","a1271468":"code","b9cde7eb":"code","fddc3324":"code","2c1b7fd4":"code","47809a97":"code","993bb3c8":"code","b573d714":"code","99d9f9c4":"code","517a7135":"code","1a786c00":"markdown","3ceed96f":"markdown","ac89dd75":"markdown","d7a9d0e3":"markdown","f5de1d56":"markdown","a44d3e1e":"markdown","e43e6de3":"markdown","89461a13":"markdown","f8f30e19":"markdown","c3405932":"markdown","f4f623d1":"markdown","079449d7":"markdown","d9078b79":"markdown","ad65a910":"markdown","0b7beffa":"markdown","2ef395e8":"markdown","a328e394":"markdown"},"source":{"a4db9fe8":"import os\nimport pandas as pd\nimport numpy as np\nimport random\nimport cv2\n\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nimport warnings\nwarnings.filterwarnings('ignore')\n\nfrom pylab import rcParams\nrcParams['figure.figsize'] = 20,10\n\nimport torch\nfrom torch.utils.data import Dataset,DataLoader\nimport albumentations as A","6da170e0":"#iafoss dataset\nTRAIN = '..\/input\/hubmap-256x256\/train\/'\nMASKS = '..\/input\/hubmap-256x256\/masks\/'\nLABELS = '..\/input\/hubmap-kidney-segmentation\/train.csv'","cdfc25c2":"class HuBMAPDataset(Dataset):\n    def __init__(self,tfms=None):\n        ids = pd.read_csv(LABELS).id.values\n        self.fnames = [fname for fname in os.listdir(TRAIN) if fname.split('_')[0] in ids]\n        self.tfms = tfms\n        \n    def __len__(self):\n        return len(self.fnames)\n    \n    def __getitem__(self, idx):\n        fname = self.fnames[idx]\n        img = cv2.cvtColor(cv2.imread(os.path.join(TRAIN,fname)), cv2.COLOR_BGR2RGB)\n        mask = cv2.imread(os.path.join(MASKS,fname),cv2.IMREAD_GRAYSCALE)\n        if self.tfms is not None:\n            augmented = self.tfms(image=img,mask=mask)\n            img,mask = augmented['image'],augmented['mask']\n        return img,mask","25d5c5e7":"#\u753b\u50cf\u8868\u793a\u306e\u305f\u3081\u306e\u95a2\u6570\ngood_img_index = [1,5,7,8]\ndef show_images(tfms):\n    dataset_show = HuBMAPDataset(tfms)\n    for i in range(2):\n        f, axarr = plt.subplots(1,4)\n        for p in range(2):\n            idx = i*2+p\n            img, mask = dataset_show[good_img_index[idx]]\n            img = img.astype(np.uint8)\n            axarr[p*2].imshow(img)\n            axarr[p*2+1].imshow(mask)","d9fa5c82":"#transform\u306a\u3057(\u5143\u753b\u50cf)\nshow_images(tfms=None)","e45df0e1":"tfms = A.Compose([\n    A.Resize(512, 512),\n])\n\nshow_images(tfms=tfms)","df35d7f0":"#\u6c34\u5e73\u65b9\u5411\ntfms = A.Compose([\n    A.HorizontalFlip(p=1.), #\u78ba\u304b\u521d\u671f\u5024\u306f0.5\n])\n\nshow_images(tfms=tfms)","090e6c5f":"#\u5782\u76f4\u65b9\u5411\ntfms = A.Compose([\n    A.VerticalFlip(p=1.),\n])\n\nshow_images(tfms=tfms)","fb841faf":"tfms = A.Compose([\n    A.RandomRotate90(p=1.), #0,90,180,270\u00b0\u65b9\u5411\u306b\u30e9\u30f3\u30c0\u30e0\u306bRotate\n])\n\nshow_images(tfms=tfms)","e2f53f5b":"tfms = A.Compose([\n    A.Transpose(p=1.),\n])\n\nshow_images(tfms=tfms)","a7746fb9":"tfms = A.Compose([\n    A.ShiftScaleRotate(shift_limit=0.0625, scale_limit=0.2, rotate_limit=15, p=0.9, \n                         border_mode=cv2.BORDER_REFLECT),\n])\n\nshow_images(tfms=tfms)","960b64e1":"#\u30dc\u30fc\u30c0\u30fc(\u5916\u633f)\u306a\u3057\ntfms = A.Compose([\n    A.ShiftScaleRotate(shift_limit=0.1, scale_limit=0.1, rotate_limit=15, border_mode=0, p=0.85),\n])\n\nshow_images(tfms=tfms)","33f50edd":"tfms = A.Compose([\n    A.RandomBrightness(limit=0.2, p=0.75),\n])\n\nshow_images(tfms=tfms)","35b3c1ef":"tfms = A.Compose([\n    A.RandomContrast(limit=0.2, p=0.75),\n])\n\nshow_images(tfms=tfms)","33a5def0":"tfms = A.Compose([\n    A.MotionBlur(blur_limit=5),\n])\n\nshow_images(tfms=tfms)","b7e80a8e":"tfms = A.Compose([\n    A.MedianBlur(blur_limit=5),\n])\n\nshow_images(tfms=tfms)","6a40843c":"tfms = A.Compose([\n    A.GaussianBlur(blur_limit=5),\n])\n\nshow_images(tfms=tfms)","35f6c947":"tfms = A.Compose([\n    A.GaussNoise(var_limit=(5.0, 30.0),p=1.),\n])\n\nshow_images(tfms=tfms)","1ed61e7d":"tfms = A.Compose([\n    A.ISONoise(p=1.),\n])\n\nshow_images(tfms=tfms)","a1271468":"tfms = A.Compose([\n    A.OpticalDistortion(distort_limit=1.0),\n])\n\nshow_images(tfms=tfms)","b9cde7eb":"tfms = A.Compose([\n    A.GridDistortion(num_steps=5, distort_limit=1.),\n])\n\nshow_images(tfms=tfms)","fddc3324":"tfms = A.Compose([\n    A.ElasticTransform(alpha=3),\n])\n\nshow_images(tfms=tfms)","2c1b7fd4":"tfms = A.Compose([\n    A.CLAHE(clip_limit=4.0, p=0.7),\n])\n\nshow_images(tfms=tfms)\n","47809a97":"#\u5f93\u6765\u306eCutout,\u73fe\u5728\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u3053\u306e\u95a2\u6570\u3092\u4f7f\u3046\u3053\u3068\u306f\u63a8\u5968\u3055\u308c\u3066\u3044\u306a\u3044(DeprecationWarning)\n#\u30bb\u30b0\u30e1\u30f3\u30c8\u753b\u50cf\u306bCutout\u306f\u9069\u7528\u3067\u304d\u306a\u3044\u3002(\u4eca\u56de\u306e\u30b3\u30f3\u30da\u3067\u306f\u3053\u3063\u3061\u306f\u4f7f\u308f\u306a\u3044\u65b9\u304c\u7121\u96e3\u3067\u3042\u308b)\n\"\"\"\nConventional Cutout function, in the current version it is not recommended to use this function (DeprecationWarning)\nCutout cannot be applied to mask images.\n\"\"\"\ntfms = A.Compose([\n    A.Cutout(max_h_size=50, max_w_size=50, num_holes=2, p=1.),\n])\n\nshow_images(tfms=tfms)","993bb3c8":"#\u305d\u3053\u3067\u3001\u73fe\u5728\u63a8\u5968\u3055\u308c\u3066\u3044\u308bCutout\u306f\u3001\"CoarseDropout\"\u95a2\u6570\u3067\u5229\u7528\u3067\u304d\u308b\u3002\n#\u5f15\u6570mask_fill_value=0\u3068\u3059\u308c\u3070\u3001\u30de\u30b9\u30af\u753b\u50cf\u306b\u3082\u30ab\u30c3\u30c8\u30a2\u30a6\u30c8\u3092\u9069\u7528\u3067\u304d\u308b\u3002\n\"\"\"\nCutout, which is currently recommended, is available in the \"CoarseDropout\" function.\nIf you set the argument mask_fill_value=0, you can apply the cutout to the masked image as well.\n\"\"\"\ntfms = A.Compose([\n    A.CoarseDropout(max_holes=2,min_holes=1,max_height=50,max_width=50,min_height=20,min_width=20,mask_fill_value=0, p=1.),\n])\n\nshow_images(tfms=tfms)","b573d714":"tfms = A.Compose([\n    A.HueSaturationValue(hue_shift_limit=10, sat_shift_limit=20, val_shift_limit=10, p=1.),\n])\n\nshow_images(tfms=tfms)","99d9f9c4":"tfms = A.Compose([\n    A.OneOf([\n        A.MotionBlur(blur_limit=5),\n        A.MedianBlur(blur_limit=5),\n        A.GaussianBlur(blur_limit=5),\n        A.GaussNoise(var_limit=(5.0, 30.0)),\n    ], p=0.7),\n])\n\nshow_images(tfms=tfms)\n","517a7135":"tfms = A.Compose([\n    A.Transpose(p=0.5),\n    A.VerticalFlip(p=0.5),\n    A.HorizontalFlip(p=0.5),\n    A.RandomBrightness(limit=0.2, p=0.75),\n    A.RandomContrast(limit=0.2, p=0.75),\n    A.OneOf([\n        A.MotionBlur(blur_limit=5),\n        A.MedianBlur(blur_limit=5),\n        A.GaussianBlur(blur_limit=5),\n        A.GaussNoise(var_limit=(5.0, 30.0)),\n    ], p=0.7),\n\n    A.OneOf([\n        A.OpticalDistortion(distort_limit=1.0),\n        A.GridDistortion(num_steps=5, distort_limit=1.),\n        A.ElasticTransform(alpha=3),\n    ], p=0.7),\n\n    A.CLAHE(clip_limit=4.0, p=0.7),\n    A.HueSaturationValue(hue_shift_limit=10, sat_shift_limit=20, val_shift_limit=10, p=0.5),\n    A.ShiftScaleRotate(shift_limit=0.1, scale_limit=0.1, rotate_limit=15, border_mode=0, p=0.85),\n    A.Resize(256, 256),\n    A.Cutout(max_h_size=int(256 * 0.375), max_w_size=int(256 * 0.375), num_holes=1, p=0.7),    \n    #A.Normalize()\n])\n\nshow_images(tfms=tfms)","1a786c00":"# HSV\u8272\u7a7a\u9593\n\nhttps:\/\/ja.wikipedia.org\/wiki\/HSV%E8%89%B2%E7%A9%BA%E9%96%93","3ceed96f":"# \u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u5e73\u5766\u5316(Histogram Flattening)  \n\nhttp:\/\/labs.eecs.tottori-u.ac.jp\/sd\/Member\/oyamada\/OpenCV\/html\/py_tutorials\/py_imgproc\/py_histograms\/py_histogram_equalization\/py_histogram_equalization.html","ac89dd75":"# Transpose  \n\u8ee2\u7f6e\u3002  \n\u5bfe\u89d2\u6210\u5206\u3092\u57fa\u6e96\u306b\u3057\u3066\u93e1\u5199\u3057\u306b\u5165\u308c\u66ff\u308f\u308b\u3002  ","d7a9d0e3":"# Rotate","f5de1d56":"# Dataset  ","a44d3e1e":"# Cutout  \nAlbumentations\u306b\u306f2\u7a2e\u985e\u306e\u30ab\u30c3\u30c8\u30a2\u30a6\u30c8\u304c\u5b9f\u88c5\u3055\u308c\u3066\u304a\u308a\u3001\u73fe\u5728\u306f\"Cutout\"\u95a2\u6570\u3067\u306f\u306a\u304f\u3001\"CoarseDropout\"\u95a2\u6570\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u308b\u3002    \n\u524d\u8005\u3067\u306f\u30de\u30b9\u30af\u753b\u50cf\u3078\u306eCutout\u306e\u9069\u7528\u304c\u3067\u304d\u306a\u3044\u3053\u3068\u306b\u6ce8\u610f\u3002  \nAlbumentations implements two types of Cutouts, and it is now recommended to use the \"CoarseDropout\" function instead of the \"Cutout\" function.      \nNote that the former does not allow you to apply Cutout to a masked image.  ","e43e6de3":"# Blur(\u307c\u304b\u3057)\u7cfb","89461a13":"# Contrast  ","f8f30e19":"# \u3059\u3054\u3044\u3084\u3064  \nMelanoma\u30b3\u30f3\u30da1st place\u306eData Augmentation.(\u4eca\u56de\u306e\u30b3\u30f3\u30da\u306b\u5411\u3044\u3066\u3044\u308b\u3068\u3044\u3046\u308f\u3051\u3067\u306f\u7121\u3044\u306e\u3067\u6ce8\u610f)  \n\u51e6\u7406\u306b\u3082\u3059\u3054\u3044\u6642\u9593\u304c\u304b\u304b\u308b\u306e\u3067Kaggle Notebook\u3067\u306f\u975e\u73fe\u5b9f\u7684\u2026(GPU\u4e0a\u3067Augmentation\u3067\u304d\u308bdali\u3084kornia\u306a\u3089\u3042\u308b\u3044\u306f\u2026)  \nhttps:\/\/www.kaggle.com\/haqishen\/1st-place-soluiton-code-small-ver  ","c3405932":"# \u6b6a\u307f\u7cfb(Distortion)","f4f623d1":"# Flip  ","079449d7":"# Albumentation\u3092\u7528\u3044\u305fData Augmentation  \n\nDataset\uff1a  \nhttps:\/\/www.kaggle.com\/iafoss\/256x256-images  \niafoss\u6c0f\u306e256\u30af\u30ed\u30c3\u30d7\u6e08\u307f\u30c7\u30fc\u30bf\u3092\u7528\u3044\u308b\u3002  \n\n\u5b9f\u969b\u306bPytorch\u3067\u5b66\u7fd2\u3092\u56de\u3059\u3053\u3068\u3092\u610f\u8b58\u3057\u3001\u6bce\u56deDataset\u30af\u30e9\u30b9\u306b\u8f09\u305b\u3066\u8aad\u307f\u8fbc\u3080\u3002(\u4f46\u3057\u3001\u3044\u3089\u306a\u3044\u90e8\u5206\u306f\u3072\u305f\u3059\u3089\u524a\u3063\u3066\u3042\u308b)  \n\u306a\u304a\u3001\u4eca\u56de\u306f\u53ef\u8996\u5316\u304c\u76ee\u7684\u306e\u305f\u3081\u3001Normalize\u3092\u884c\u308f\u306a\u3044\u3002  \n\nAlbumentations Documentation :  \nhttps:\/\/albumentations.ai\/docs\/  \n\u5206\u304b\u3089\u306a\u3044\u95a2\u6570\u3084\u5f15\u6570\u304c\u3042\u3063\u305f\u5834\u5408\u306f\u3001\u3053\u306e\u30b5\u30a4\u30c8\u306e\u691c\u7d22\u7a93\u306b\u305d\u306e\u307e\u307e\u5165\u529b\u3059\u308c\u3070\u5927\u4f53\u89e3\u6c7a\u3057\u307e\u3059\u3002","d9078b79":"# Brightness  ","ad65a910":"# \u3069\u308c\u304b\u4e00\u3064\u3092\u9069\u7528\u3059\u308b \"OneOf\"  \n\u4f3c\u305f\u3088\u3046\u306a\u51e6\u7406\u3067\u307e\u3068\u3081\u308b\u3053\u3068\u304c\u591a\u3044  ","0b7beffa":"# Resize  \n\u57fa\u672c\u7684\u306b\u306fAugmentation\u306e\u6700\u5f8c\u306b\u884c\u3046\u3002","2ef395e8":"# Noise\u7cfb  ","a328e394":"# \u30a2\u30d5\u30a3\u30f3\u5909\u63db(Affine Transform)  \nAlbumentation\u5185\u3067\u306f\u3001\"ShiftScaleRotate\"\u3002  \n\u753b\u50cf\u306e\u62e1\u5927\u7e2e\u5c0f\u3001\u56de\u8ee2\u3001\u5e73\u884c\u79fb\u52d5\u306a\u3069\u3092\u307e\u3068\u3081\u3066\u884c\u3046\u3002  \n\n\u53c2\u8003\uff1a  \nhttps:\/\/imagingsolution.blog.fc2.com\/blog-entry-284.html  "}}