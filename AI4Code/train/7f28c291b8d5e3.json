{"cell_type":{"3455042b":"code","4af46e32":"code","31a64866":"code","2f588c51":"code","61840f37":"code","3623ebb0":"code","cddca3af":"code","192d136f":"code","4c8e7b16":"code","b89b989e":"code","7f26382f":"code","f1e26d79":"code","1b1c9e63":"code","bd357490":"code","9c97ee50":"code","a9ac8334":"code","cd36acd2":"markdown","639f1ec8":"markdown","e3f8de4b":"markdown","969c547c":"markdown","446d99dc":"markdown","eaba296f":"markdown","31399ad0":"markdown","5aa71a97":"markdown","4517707f":"markdown","91f55535":"markdown","d7f77709":"markdown","69d94a87":"markdown","8cc3b225":"markdown","df5dd3d7":"markdown","d584f50e":"markdown","ee9b47f5":"markdown"},"source":{"3455042b":"import numpy as np \nimport pandas as pd \nimport os\nfrom xml.etree import ElementTree\n\n# text processing libraries\nimport re\nimport string\nimport nltk\nfrom nltk.corpus import stopwords\n\n# Visualisation libraries\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\nsns.set()\nimport pycountry\nimport plotly.express as px\nfrom plotly.offline import init_notebook_mode, iplot \nimport plotly.graph_objs as go\nimport plotly.offline as py\nfrom plotly.offline import download_plotlyjs,init_notebook_mode,plot,iplot\n!pip install chart_studio\nimport chart_studio.plotly as py\nimport cufflinks\ncufflinks.go_offline()\ncufflinks.set_config_file(world_readable=True, theme='pearl')\n#py.init_notebook_mode(connected=True)\n\n#Geographical Plotting\nimport folium\nfrom folium import Choropleth, Circle, Marker\nfrom folium import plugins\nfrom folium.plugins import HeatMap, MarkerCluster\n\n#Racing Bar Chart\n!pip install bar_chart_race\nimport bar_chart_race as bcr\nfrom IPython.display import HTML\n\n# Increase the default plot size and set the color scheme\nplt.rcParams['figure.figsize'] = 8, 5\nplt.style.use(\"fivethirtyeight\")# for pretty graphs\n\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Disable warnings \nimport warnings\nwarnings.filterwarnings('ignore')","4af46e32":"data = pd.read_csv(\"..\/input\/search-results-from-clinical-trials\/SearchResults.csv\")\ndf = data.copy()\ndf.head()","31a64866":"## last 5 years trials\n## To investigate the last 5 years results I determine the time scale by using \"Primary Completion Date\" instead \"Completion Date\".\n# Since the Completion Date has the estimation results of when the study goint to reach an end, it would have studies unfinished\n\ndf['Primary Completion Date'] = pd.to_datetime(df['Primary Completion Date'])\nfiltered_df = df.loc[(df['Primary Completion Date'] >= 'July 1 2016')\n                     & (df['Primary Completion Date'] < 'July 1 2021')]","2f588c51":"def missing_values_table(dataframe, na_name=False):\n    na_columns = [col for col in dataframe.columns if dataframe[col].isnull().sum() > 0]\n    n_miss = dataframe[na_columns].isnull().sum().sort_values(ascending=False)\n    ratio = (dataframe[na_columns].isnull().sum() \/ dataframe.shape[0] * 100).sort_values(ascending=False)\n    missing_df = pd.concat([n_miss, np.round(ratio, 2)], axis=1, keys=['n_miss', 'ratio'])\n    print(missing_df, end=\"\\n\")\n    if na_name:\n        return na_columns\n    \nmissing_values_table(filtered_df, na_name=False)","61840f37":"## dataframe = df_drug[df_drug[\"Conditions\"].str.contains(\"oncology\") | df_drug[\"Conditions\"].str.contains(\"Oncology\")]","3623ebb0":"filtered_df[filtered_df['NCT Number'].str.contains(\"NCT04386967\")] # NCT04386967\n## Even though this is an oncology-drug used trial, do not contain \"Oncology\" keyword.","cddca3af":"df_drug = filtered_df[filtered_df[\"Interventions\"].str.contains(\"drug\") | filtered_df[\"Interventions\"].str.contains(\"Drug\")]","192d136f":"df_drug[\"Phases\"].unique() \ncolumns = ['Title','Interventions', 'Status', 'Phases','Conditions', 'Locations', 'Primary Completion Date', 'Outcome Measures']\nmy_data = pd.DataFrame(df_drug, columns=columns)\nmy_data['Year'] = pd.DatetimeIndex(my_data['Primary Completion Date']).year\n\n## creating a \"Year\" column helps us to classify drugs by year","4c8e7b16":"my_data[\"Status\"].unique()","b89b989e":"failed_drugs = ['Withdrawn', 'Suspended','Terminated', 'Unknown status' ]\nin_progress = ['Not yet recruiting', 'Recruiting',\n              'Enrolling by invitation', 'Active, not recruiting']\ntrials_completed = [\"Completed\"]\n\ndf_failed = my_data.loc[my_data['Status'].isin(failed_drugs)]\ndf_in_progress = my_data.loc[my_data['Status'].isin(in_progress)]\ndf_completed = my_data.loc[my_data['Status'].isin(trials_completed)]","7f26382f":"fig = go.Figure(go.Bar(\n    x= df_failed.groupby('Year').agg('count')[\"Interventions\"].sort_values(ascending=False).index,\n    y= df_failed.groupby('Year').agg('count')[\"Interventions\"].sort_values(ascending=False).values, \n    textposition='outside' ))\nfig.update_layout(title='Failed Drug Trials Per Year in Oncology')\nfig.show()","f1e26d79":"import plotly.express as px\nfig = px.bar(df_failed, x=\"Status\", color=\"Phases\", barmode=\"group\",\n             facet_col=\"Year\",hover_data=[\"Interventions\"],\n             title='Failed Drugs of last 5 years',\n             category_orders={\"Year\": [\"2016\", \"2017\", \"2018\", \"2019\", \"2020\",\"2021\"]})\nfig.show()","1b1c9e63":"## removing successful drugs\nfda_succeed = my_data[my_data[\"Status\"].str.contains(\"Completed\") | my_data[\"Phases\"].str.contains(\"Phase 4\")]\nmy_new_df = my_data.drop(my_data[(my_data['Status'] == \"Completed\") & (my_data['Phases'] == \"Phase 4\")].index)","bd357490":"fig = go.Figure(go.Bar(\n    x= my_new_df.groupby('Year').agg('count')[\"Interventions\"].sort_values(ascending=False).index,\n    y= my_new_df.groupby('Year').agg('count')[\"Interventions\"].sort_values(ascending=False).values, \n    textposition='outside' ))\nfig.update_layout(title='Failed Drug Trials Per Year')\nfig.show()","9c97ee50":"df_fda_failed = df_drug.drop(my_data[(df_drug['Status'] == \"Completed\") & (df_drug['Phases'] == \"Phase 4\")].index)\n\ndef splitLoc(loc):\n    return loc.split(',')[-1].strip()\ndf_fda_failed['Loc'] = df_fda_failed.Locations.apply(lambda x:splitLoc(str(x)))\nfig = go.Figure([go.Choropleth(\n    locations=df_fda_failed.groupby(['Loc']).agg('count')['Rank'].index,\n    z=df_fda_failed.groupby(['Loc']).agg('count')['Rank'].values.astype(float),\n    locationmode='country names',\n    colorscale='Greens',\n    autocolorscale=True,\n    marker_line_color='white',\n    showscale = True,\n)])\nfig.update_layout(title='Study Locations')\nfig.show()","a9ac8334":"# Lets explore the data, and see the most studied failed drugs\n# Returns list of Series index and its count where count > threshold\ndef most_studied(col,threshold):\n    idx = []\n    counts = []\n    other = 0\n    for index,vcount in zip(my_new_df[col].value_counts().index,my_new_df[col].value_counts().values):\n        if vcount < threshold:\n            other+=1\n            continue\n        idx.append(index)\n        counts.append(vcount)\n    idx.append('Others')\n    counts.append(other)\n    return idx,counts\n\nidx , counts = most_studied('Interventions', threshold = 8)\nfig = go.Figure([go.Pie(labels=idx,values=counts,textinfo='label+percent')])\nfig.update_layout(title='Most Studied Drugs')\nfig.show()","cd36acd2":"<b> <span style=\"color:SlateBlue; text-align:center; font-size:17px;\" >But, this would eliminate some of search we need, such as<\/span> <b>","639f1ec8":"<b> <span style=\"color:SlateBlue; text-align:center; font-size:17px;\" > What are the most studied drugs within failed oncolgy trials? <span> <b> ","e3f8de4b":"<b> <span style=\"color:SlateBlue; text-align:center; font-size:17px;\" > Glossary <span> <b>","969c547c":"![image.png](attachment:ff186df1-5667-44b5-85d5-8d8d8e497562.png)\n![image.png](attachment:e4bc74de-5115-4fc1-8d76-7be65016fcae.png)\n![image.png](attachment:d6b6d955-daf1-498d-bf54-9a96330b8e15.png)\n![image.png](attachment:c6ba3320-44ec-4fde-9c00-2339ab9bd161.png)\n![image.png](attachment:6f12c2ad-210a-45af-af5e-8efdfe1ab28f.png)","446d99dc":"<b> <span style=\"color:SlateBlue; text-align:center; font-size:15px;\" > In our data frame, there are also other interventions performed without using drugs. Since we want to calculate the drug failure we need to narrow the data frame by eliminating non-drug interventions, such as \"Radiation: Stereotactic body radiotherapy\" or in other words to exclude nontherapeutic products, such as diagnostic tests, as well as blood and blood component products <span> <b>\n    \n<b> <span style=\"color:SlateBlue; text-align:center; font-size:15px;\" >to explore drug studies lets only brings studies drug in it <span> <b>","eaba296f":"<b> <span style=\"color:SlateBlue; text-align:center; font-size:17px;\" > to decide the drug success and failure, checking phases could be helpful to understand drugs progress. Lets clarify the phases we have. <span> <b>","31399ad0":"<b> <span style=\"color:SlateBlue; text-align:center; font-size:17px;\" >  \nTo focus on cancer\/oncology-related studies, I narrowed the data frame by searching cancer-related words in the cancer trials search engine. I would like to indicate that for oncologic trials, only searching the word \"Oncology\" would limit the trials we need to examine. <\/span> <b>\n\n![image.png](attachment:5fcc90ea-368b-4f98-a278-2c77d9290542.png)\n    \n<b> <span style=\"color:SlateBlue; text-align:center; font-size:17px;\" >  \nThe words above are the recommended words from clinicaltrials.com for cancer-related studies.  <\/span> <b>","5aa71a97":"<b> <span style=\"color:SlateBlue; text-align:center; font-size:17px;\" > Clinical Trial Success\/Failure Rates By Phase <span> <b> \n\nHow many of the drugs are likely to be successful?\n\n* The best way to answer that question is to examine the success rates of previous drugs and vaccines that have gone through clinical trials. \n*\"Success\" means that the drug or vaccine eventually received approval from a regulatory body like the FDA.*\n\nThere is also **phase success rate**,[Here, this study ](https:\/\/www.ncbi.nlm.nih.gov\/pmc\/articles\/PMC6226120\/#cts12577-bib-0003) calculate the phase success rate as the number of drugs that progressed from one phase to the next divided by the sum of the number of drugs that progressed to the next phase and the number of drugs that were suspended.\n\n**The LOA (likelihood of approvals)** was shown as the cumulative success rate from phase I to approval and obtained by multiplying the success rate of each phase.\n\nNotes = \n\n(1) The same drug can go through multiple clinical trials.\n\n(2) Typically, the overall probability of success is calculated by multiplying the probability of success for transitioning from Phase 1 to Phase 2, Phase 2 to Phase 3, and Phase 3 to Approval. ","4517707f":"<b> <span style=\"color:SlateBlue; text-align:center; font-size:17px;\" > Where these failed studies take place? <span> <b> \n    \n<b> <span style=\"color:SlateBlue; text-align:center; font-size:14px;\" > Distribution of oncology drug trials that are failed to reach FDA approval <span> <b> ","91f55535":"<b> <span style=\"color:SlateBlue; text-align:center; font-size:17px;\" >First lets explore our data from https:\/\/clinicaltrials.gov\/. <span> <b>","d7f77709":"<b> <span style=\"color:SlateBlue; text-align:center; font-size:17px;\" > Let's import the libraries that we are going to use <span> <b> ","69d94a87":"<b> <span style=\"color:FireBrick; text-align:center; font-size:16px;\" >Determining failure by referencing The Phase of Approval: Phase 4<span> <b>\n    \n<span style=\"color:Black; text-align:center; font-size:16px;\" >One of the key measures of success used in drug trial reports is the Likelihood of Approval (LOA) from Phase I. This LOA success rate is simply a multiplication of all four Phases success rates, a compounded probability calculation. For example, if each phase had \na 50% chance of success, then the LOA from Phase I would be 0.5 x 0.5 x 0.5 x 0.5 = 6.25%. <span> \n    \n<span style=\"color:Black; text-align:center; font-size:16px;\" > So that, Failure to take FDA approval is an indicator of the failure of drugs, therefore, drugs not reached phase 4 and not completed classified as failed.\n   <span> ","8cc3b225":"<b> <span style=\"color:SlateBlue; text-align:center; font-size:17px;\" > Why do drug trials fail? <span> <b>\n\n<span style=\"color:Black; text-align:center; font-size:17px;\" >\nClinical trials for pharmaceuticals and medical devices offer many opportunities for failure. Failures can arise from a lack of efficacy, issues with safety, or a lack of funding to complete a trial, as well as other factors such as failing to maintain good manufacturing protocols, failing to follow FDA guidance, or problems with patient recruitment, enrollment, and retention. <span>\n    \n\n![image.png](attachment:d5ee8680-4fcc-4f95-a1f0-304386541418.png)\n    \n[source](https:\/\/www.nature.com\/articles\/nbt.2374)","df5dd3d7":"<b> <span style=\"color:SlateBlue; text-align:center; font-size:17px;\" > Let's look at the failed ones in more detail: Now we can see with the precise name of the used drug and the phase of failure <span> <b>","d584f50e":"<b> <span style=\"color:SlateBlue; text-align:center; font-size:17px;\" > What is the number of failed drugs of last 5 year? <span> <b>\n \n<b> <span style=\"color:FireBrick; text-align:center; font-size:16px;\" >Determining failure with the Status of the drug <span> <b>\n    \n<span style=\"color:Black; text-align:center; font-size:16px;\" >For drugs that have status as \"withdrawn\", \"suspended\", \"unknown\", \"terminated\" classified as failures since they have intervened or stopped their development. <span> ","ee9b47f5":"<b> <span style=\"color:SlateBlue; text-align:center; font-size:17px;\" >We can just bring precise studies on oncolgy with the below code <\/span> "}}