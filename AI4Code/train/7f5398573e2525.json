{"cell_type":{"eb8e1a5b":"code","bc24c339":"code","090646c2":"code","3e1790de":"code","07d19e0a":"code","95305495":"code","e67aeb41":"code","01c8eef6":"code","f2441aca":"code","21990134":"code","7fa0a4ed":"code","7c8c6cda":"code","47399bd1":"code","645f59ff":"code","d2dbb7ec":"code","967d1fb1":"code","ce03a28b":"code","2e118b0f":"code","b4c548f7":"markdown","e847f870":"markdown","f927e143":"markdown"},"source":{"eb8e1a5b":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\nimport fuzzywuzzy\nfrom fuzzywuzzy import process\nimport chardet\n\nfrom subprocess import check_output\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","bc24c339":"# Read data\n# wondering how we got data in the first place, here is how \n#https:\/\/github.com\/muhammadusman786\/Elections2018\/blob\/master\/ScrapingElectionsData.ipynb\n# this cell is cleaning script for intial cleaning, let's reuse it, why not?\nNA2 = pd.read_csv(\"..\/input\/National Assembly 2002 - Updated.csv\", encoding = \"ISO-8859-1\")\nNA8 = pd.read_csv(\"..\/input\/National Assembly 2008.csv\", encoding = \"ISO-8859-1\")\nNA13 = pd.read_csv(\"..\/input\/National Assembly 2013.csv\", encoding = \"ISO-8859-1\")\n\n# rename coloumns\nNA8.rename(columns={'Unnamed: 0':'District'}, inplace=True)\nNA13.rename(columns={'Unnamed: 0':'District'}, inplace=True)\n\n#Get districts separated out of seats\nNA8.District = NA8.Seat.str.split(\"-\", expand=True)[0]\nNA13.District = NA13.Seat.str.split(\"-\", expand=True)[0]\n\n#Change Data type of turnout\nNA8['Turnout'] = NA8['Turnout'].str.rstrip('%').str.rstrip(' ')\nNA13['Turnout'] = NA13['Turnout'].str.rstrip('%').str.rstrip(' ')\nNA8['Turnout'] = pd.to_numeric(NA8['Turnout'], errors='coerce')\nNA13['Turnout'] = pd.to_numeric(NA13['Turnout'], errors='coerce')\n\n#Add Year Column\nNA2['Year'] = \"2002\"\nNA8['Year'] = \"2008\"\nNA13['Year'] = \"2013\"\n\n#Rename coloumns in NA2\nNA2.rename(columns={'Constituency_title':'ConstituencyTitle', 'Candidate_Name':'CandidateName', 'Total_Valid_Votes':'TotalValidVotes',\n                    'Total_Rejected_Votes':'TotalRejectedVotes', 'Total_Votes':'TotalVotes', 'Total_Registered_Voters':'TotalRegisteredVoters', }, inplace=True)\n\n#Concat all results\ndf = pd.concat([NA2, NA8, NA13])\n\ndf['District'] = df['District'].str.lower()\n# remove trailing white spaces\ndf['District'] = df['District'].str.strip()\n","090646c2":"#convert textual content to lower case\ndf['CandidateName'] = df['CandidateName'].str.lower()\ndf['Party'] = df['Party'].str.lower()\n# remove trailing white spaces\ndf['CandidateName'] = df['CandidateName'].str.strip()\ndf['Party'] = df['Party'].str.strip()","3e1790de":"# Let's write a function to filter parties which fuzzy wuzzy thinks are same but actually they are not\n# Parties like Pakistan Muslim League(n),Pakistan Muslim League(qa),Pakistan Muslim League(q) and Pakistan Muslim League will have high similarity scores \ndef filter_similarity_exceptions(party_to_match,party_list):\n    #find sub party name\n    sub_party = party_to_match[party_to_match.find(\"(\")+1:party_to_match.find(\")\")].strip()\n    \n    # if party_to_match has no sub party, filter out parties with sub party from party_list\n    if(len(party_to_match.split('(')) < 2):\n        party_list = [x for x in party_list if len(x.split('(')) < 2]\n    \n    #make sure sub party names upto length 2 are same, because they can fall in specified similarity score threshold \n    if(len(sub_party) <= 2):\n        party_list = [x for x in party_list if x[x.find(\"(\")+1:x.find(\")\")].strip() == sub_party]\n    \n    return party_list","07d19e0a":"# modification of function written by zeeshan to filter similarity exceptions\ndef replace_matches_in_party(df,string_to_match, min_ratio = 90, column='Party'):\n    # get a list of unique strings\n    strings = df[column].unique()\n    \n    # get the top 10 closest matches to our input string\n    matches = fuzzywuzzy.process.extract(string_to_match, strings, \n                                         limit=10, scorer=fuzzywuzzy.fuzz.token_sort_ratio)\n\n    # only get matches with a ratio > 90\n    close_matches = [matches[0] for matches in matches if matches[1] >= min_ratio]\n    \n    #filter similarity exceptions\n    close_matches = filter_similarity_exceptions(string_to_match,close_matches)\n    \n    # get the rows of all the close matches in our dataframe\n    rows_with_matches = df[column].isin(close_matches)\n\n    # replace all rows with close matches with the input matches \n    df.loc[rows_with_matches, column] = string_to_match","95305495":"# iterate unique parties and replace the same parties which are spelled differntly\nfor party in df['Party'].unique():\n    replace_matches_in_party(df,party, min_ratio = 93, column='Party')","e67aeb41":"# have a look at the results after sorting\ncandidates = df.sort_values('Party')['Party'].unique()\nprint(candidates)","01c8eef6":"# Ah it's look like, if we decrease the threshold(min_score) further it may cause problems\n# I know these parties have addition of words like Pakitan and Party but are similar, let's replace them\ndf['Party'].replace(['muttahida qaumi movement pakistan'], 'muttahida qaumi movement', inplace = True)\ndf['Party'].replace(['indeindependentdente','independent (retired)','indepndent'], 'independent',inplace = True)\ndf['Party'].replace(['indeindependentdente','independent (retired)','indepndent'], 'independent',inplace = True)\ndf['Party'].replace(['muttahidda majlis-e-amal pakistan','mutthida\\xa0majlis-e-amal\\xa0pakistan'\n                     ,'mutthida\u00ef\u00bf\u00bdmajlis-e-amal\u00ef\u00bf\u00bdpakistan'] \n                     ,'muttahidda majlis-e-amal' ,inplace = True)\ndf['Party'].replace(['nazim-e-mistafa'], 'nizam-e-mustafa party' ,inplace = True)","f2441aca":"# we are all set to meet winners\n#reset the index \ndf.reset_index(inplace = True)\n#find candidates with max votes in a constituency and year, aka the winners\nwinning_candidates = df.loc[df.groupby(['Year','ConstituencyTitle'])['Votes'].idxmax()].sort_values('ConstituencyTitle')\nwinning_candidates.head()","21990134":"# let's find year wise number of seats won by each party \nyear_wise_party_results = winning_candidates.groupby(['Party','Year']).size().to_frame('count').sort_values('count')\nyear_wise_party_results.head()","7fa0a4ed":"# find number of times a candidate won from the same constituency\nconstituency_wise_candidate_wins = winning_candidates.groupby(['ConstituencyTitle','CandidateName']).size().to_frame('wins')\nconstituency_wise_candidate_wins.head()","7c8c6cda":"# find candidates who won atleast twice from the same constituency\nstrong_candidates = constituency_wise_candidate_wins[constituency_wise_candidate_wins['wins'] >=2 ].sort_values('wins', ascending = False)\nstrong_candidates.head()","47399bd1":"# find  of number of times a party won from the same constituency\nconstituency_wise_party_wins = winning_candidates.groupby(['ConstituencyTitle','Party']).size().to_frame('wins')\n#find constittuencies where same party won in all three elections\nconfirmed_constituencies_by_party = constituency_wise_party_wins[constituency_wise_party_wins['wins'] == 3].sort_values('wins', ascending = False)\nconfirmed_constituencies_by_party.head()","645f59ff":"#Swing constituencies are those where maximum wins by the same party are 1 i.e. where no party won twice\n#First we will find constituency wise maximum number of wins by a party \nconstituency_wise_max_party_wins = constituency_wise_party_wins.groupby(['ConstituencyTitle'])['wins'].max().to_frame('max_wins_by_any_party')\n#filter out those constituencies where max wins by any party is 1\nswing_constituencies = constituency_wise_max_party_wins[constituency_wise_max_party_wins['max_wins_by_any_party'] == 1]\nswing_constituencies.head()","d2dbb7ec":"# Time to find Lotas, Ah ha (candidates who changed their parties while competing from the same constituency)\nnum_parties_by_candidate = df[['CandidateName','ConstituencyTitle','Party']].groupby(['CandidateName','ConstituencyTitle'])['Party'].nunique()\\\n.to_frame('count').sort_values('count', ascending = False)\n#find candidates with party count greater than 1\nlotas = num_parties_by_candidate[num_parties_by_candidate['count'] > 1]\n#some lotas for you\nlotas.head()","967d1fb1":"# first value in a constituency may have a null value, let's fill it with next value from same constituency and year\ndf['Turnout'] = df.groupby(['ConstituencyTitle','Year'])['Turnout'].fillna(method = 'bfill')","ce03a28b":"# find min, max , average turnout and valid votes constituency wise\naggregations_by_constituency = df.groupby('ConstituencyTitle').agg({'TotalValidVotes' : [np.max, np.min, np.average ],'Turnout' : [np.max, np.min, np.average]})\naggregations_by_constituency.head()","2e118b0f":"# now we will find total number of votes casted to all parties(year wise) and sort them to see popular vote winners\npopular_vote_winners = df.groupby(['Party', 'Year'])['Votes'].sum().to_frame('total_votes').sort_values('total_votes', ascending = False)\npopular_vote_winners.head()","b4c548f7":"## Let's clean textual columns before moving to the fun part","e847f870":"## That's all for today, building visualizations on top of these insights might be an interesting idea for you","f927e143":"# Lets Use the Initial Cleaning script and move on to interesting analysis and Insights  "}}