{"cell_type":{"e8d3033b":"code","321a0ba1":"code","482cfc78":"code","2c64a6ba":"code","a8fa1018":"markdown","8c128b66":"markdown","436df34f":"markdown","3b236a47":"markdown","9890bdc9":"markdown","a43b5704":"markdown"},"source":{"e8d3033b":"!cp -r ..\/input\/lux-ai-2021\/* .","321a0ba1":"%%writefile agent.py\n\n\nfrom lux.game import Game\nfrom lux.game_map import Cell, RESOURCE_TYPES\nfrom lux.constants import Constants\nfrom lux.game_constants import GAME_CONSTANTS\nfrom lux import annotate\nimport math\nimport sys\n\n### Define helper functions\n\n# +++++++++++++++++++++++++++++++++++++++++++++++++\n#   FIND RESOURCES IN THE MAP\n# +++++++++++++++++++++++++++++++++++++++++++++++++\ndef find_resources(game_state):\n    resource_tiles: list[Cell] = []\n    width, height = game_state.map_width, game_state.map_height\n    for y in range(height):\n        for x in range(width):\n            cell = game_state.map.get_cell(x, y)\n            if cell.has_resource():\n                resource_tiles.append(cell)\n    return resource_tiles\n\n\n# +++++++++++++++++++++++++++++++++++++++++++++++++\n#   FIND RESOURCES CLOSEST TO UNIT FULL OF CARGO\n# +++++++++++++++++++++++++++++++++++++++++++++++++\ndef find_closest_resources(pos, player, resource_tiles):\n    closest_dist = math.inf\n    for resource_tile in resource_tiles:\n        dist = resource_tile.pos.distance_to(pos)\n        if dist < closest_dist:\n            if (resource_tile.resource.type=='uranium') & (player.researched_uranium()): \n                closest_dist = dist\n                closest_resource_tile = resource_tile\n            elif (resource_tile.resource.type=='coal') & (player.researched_coal()): \n                closest_dist = dist\n                closest_resource_tile = resource_tile\n            elif (resource_tile.resource.type=='wood'):\n                closest_dist = dist\n                closest_resource_tile = resource_tile\n    return closest_resource_tile\n\n# +++++++++++++++++++++++++++++++++++++++++++++++++\n#   FIND CITYTILE TO DELIVERY RESOURCES\n# +++++++++++++++++++++++++++++++++++++++++++++++++\ndef find_closest_city_tile(pos, player):\n    closest_city_tile = None\n    if len(player.cities) > 0:\n        closest_dist = math.inf\n        # the cities are stored as a dictionary mapping city id to the city object, which has a citytiles field that\n        # contains the information of all citytiles in that city\n        for k, city in player.cities.items():\n            for city_tile in city.citytiles:\n                dist = city_tile.pos.distance_to(pos)\n                if dist < closest_dist:\n                    closest_dist = dist\n                    closest_city_tile = city_tile\n    return closest_city_tile\n\n# ===========================================\n#  FIND THE TILES ADJACENT TO GIVEN POSITION\n# ============================================\ndef adjacent_tiles(pos):\n    ''' Get adjacent tiles given a tile'''\n    x1,y1 = pos.x, pos.y\n    w, h = game_state.map.width, game_state.map.height\n    adjacent_tiles_pos = [(x1-1,y1),(x1+1,y1),(x1,y1+1),(x1,y1-1)]\n    return [ game_state.map.get_cell(x,y) for (x,y) in adjacent_tiles_pos if (x<w)&(y<w)&(x>=0)&(y>=0) ]\n\n# ==============================================================\n#  FIND THE TILE TO BUILD ADJACENT TO CLOSEST CITYTILE\n# ==============================================================\ndef building_tiles(player, pos):\n    tile_to_build = None\n    cell_position = game_state.map.get_cell_by_pos(pos)\n    if (cell_position.has_resource() == False):\n        tile_to_build = game_state.map.get_cell_by_pos(pos)\n    else:\n        tiles_next_pos = adjacent_tiles(pos)\n        for cell in tiles_next_pos:\n            cell_found = False\n            if (cell.has_resource()==False) & (cell.citytile==None) & (cell_found==False):\n                tile_to_build = cell\n                cell_found = True\n    return tile_to_build\n \n# ======================================================\n#         AGENT\n# ++++++++++++++++++++++++++++++++++++++++++++++++++++++\ngame_state = None\n\ndef agent(observation, configuration):\n    global game_state\n\n    ### Do not edit ###\n    if observation[\"step\"] == 0:\n        game_state = Game()\n        game_state._initialize(observation[\"updates\"])\n        game_state._update(observation[\"updates\"][2:])\n        game_state.id = observation.player\n    else:\n        game_state._update(observation[\"updates\"])\n\n    ### AI Code goes down here! ### \n    # =======================================================================\n    #          INITIAL CONDITIONS\n    # ======================================================================\n    player = game_state.players[observation.player]\n    opponent = game_state.players[(observation.player + 1) % 2]\n    width, height = game_state.map.width, game_state.map.height\n    \n    actions = []\n    resource_tiles = find_resources(game_state)\n\n    # =======================================================================\n    #          INITIAL ORDERS\n    # ======================================================================\n    tiles_in_cities = [ ct for k,city in player.cities.items() for ct in city.citytiles ]\n    for k, city in player.cities.items():\n#         if (len(tiles_in_cities)>(len(player.units))):\n        for i,city_tile in enumerate(city.citytiles):\n            if city_tile.can_act():\n                if (i%3==0):\n                    action = city_tile.build_worker()\n                    print(\"<<< Train >>>\", action)\n                    actions.append(action)\n                elif (i%3==1):\n                    action = city_tile.research()\n                    print('<<< Research >>> ')\n                    actions.append(action)\n                else:\n                    action = city_tile.build_cart()\n                    print(\"<<< Train Cart >>>\", action)\n                    actions.append(action)\n                        \n#     # Uncomment line below to see the  the turn and situation of city  \n#     print(\"\\nTURN: \", game_state.turn )    \n#     print(\"Units:\",  len (player.units ),\"|| City :\" , len(player.cities.items())\"|| Research points: \", player.research_points)\n\n    # =======================================================================\n    #    Loop through units and give orders (workers and carts) \n    # =======================================================================\n    for i, unit in enumerate(player.units):\n        if unit.is_worker() and unit.can_act():\n            if unit.get_cargo_space_left()>0:\n                closest_resource_tile = find_closest_resources(unit.pos,player,resource_tiles)\n                next_direction = unit.pos.direction_to(closest_resource_tile.pos)\n                action = unit.move(next_direction)\n                actions.append(action)\n            else:  \n                closest_city_tile = find_closest_city_tile(unit.pos, player)\n                required_fuel_city =player.cities[closest_city_tile.cityid].get_light_upkeep()*10\n                if player.cities[closest_city_tile.cityid].fuel < required_fuel_city:\n                    next_direction = unit.pos.direction_to(closest_city_tile.pos)\n                    action = unit.move(next_direction)\n                    actions.append(action)\n                else:  \n                    tile_to_build = building_tiles(player, unit.pos)\n                    if tile_to_build != None:\n                        if unit.pos.equals(tile_to_build.pos):\n                            if unit.can_build(game_state.map):\n                                action = unit.build_city()\n                                actions.append(action)\n                        else:\n                            next_direction = unit.pos.direction_to(tile_to_build.pos)\n                            action = unit.move(next_direction)\n                            actions.append(action) \n                            \n                            \n        if unit.is_cart() and unit.can_act():   \n            middle_cell = game_state.map.get_cell(width\/\/2, height\/\/2)\n            action = unit.move(unit.pos.direction_to(middle_cell.pos) )\n            actions.append(action)\n#     # Uncomment line below to see actions given by agent    \n#     print('Actions: ', actions)         \n    return actions","482cfc78":"# from kaggle_environments import make\n# env = make(\"lux_ai_2021\", configuration={\"seed\": 1000, \"loglevel\": 2, \"annotations\": True}, debug=True)\n# # steps = env.run([agent, agent])\n# steps = env.run([agent, \"simple_agent\"])\n# env.render(mode=\"ipython\", width = 1000, height = 800)","2c64a6ba":"# Submission file\n!tar -czvf submission.tar.gz __init__.py agent.py main.py lux","a8fa1018":"This notebook aims to help you begin in the challenge such as:\n\n- print annotation when run locally;\n- build worker, cart and citytiles;\n- set actions to units (workers and carts);\n- how to research, build workers and carts;\n- check warnings given programm.\n\nIt returns error in submission in some maps.\n\n### I hope it helps to start.","8c128b66":"### 3 - Run the agent below and check the results.\n\nIn the cell below, about the first line '%%writefile agent.py'\n\na) Comment the first line to run agent locally. \n\nb) Uncomment the first line to generate de file to submit","436df34f":"### 5 - Generate the file to sumbission\n\nUncomment the cell below to generate file to sumbission; \"submission.tar.gz\" ","3b236a47":"### 2- Then, copy the folder to \/kaggle\/output folder to be used in submission file.","9890bdc9":"### 4 - Run the cell below to simulate the agent with simple agent\n\nIn the cell below, comment all lines below to generate file to submit.","a43b5704":"# Naive First Approach\nThis notebook focus on create the first units in the game and deliver a first agent more developed than a \"simple agent\". \n### 1 - Add the data to \/kaggle\/input folder\na) Click \"+ Add data\"\nb) Select \"Competition Data\"\nc) Find \"Lux AI\"\nd) Click \"Add\" button.\n\nInput folder will show \"lux-ai-2021\" folder with \"lux\" subfolder.\n\nIn order to generate the file to submission you must: (1)  comment the simulation cell; (2) uncomment the first line of agent cell and (3) uncomment the cell that generates the submisison file.\n\nTo simulate it locally do the opposite of above.\n\nVersion 1 is ready to run loccaly. Version 2 ready to submit."}}