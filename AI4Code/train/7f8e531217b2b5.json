{"cell_type":{"53a179dc":"code","6913605c":"code","39b0374b":"code","d837a10e":"code","0a7de14c":"code","6b9731bb":"code","53bec979":"markdown","a07b1b75":"markdown","5751ca24":"markdown","9ea9de1e":"markdown","4ea6ea90":"markdown","a526e8e4":"markdown","cc4108d4":"markdown"},"source":{"53a179dc":"import numpy as np\nimport pandas as pd\nimport datetime as dt\nimport matplotlib.pyplot as plt\nfrom scipy import stats\nimport seaborn as sns\n\nprefix = '\/kaggle\/input\/the-depression-dataset\/data'\n\nimport os\nfor dirname, _, filenames in os.walk(prefix):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","6913605c":"df = pd.read_csv(f'{prefix}\/scores.csv')\n\ndf_cond = df[df['number'].str.contains('condition')]\ndf_cont = df[df['number'].str.contains('control')]\ndf_cont = df_cont[['number','days', 'gender', 'age']]\n\nsample_df = pd.merge(df_cond, df_cont, how='inner', left_on=['days','gender','age'], right_on = ['days','gender','age'],\n          suffixes=('_cond', '_cont'))\n\ncol = sample_df.pop(\"number_cont\")\nsample_df.insert(0, col.name, col)\n\nsample_df","39b0374b":"nrow_count = len(sample_df)\n\ndef load_and_prep(path, col, i):\n    df = pd.read_csv(f'{prefix}\/{path}\/{sample_df.iloc[i][col]}.csv',\n                     parse_dates=['date','timestamp'])   \n    df = df[df.date < (min(df.date) + dt.timedelta(days=int(sample_df.iloc[i][\"days\"])))]\n    df['minute_index'] = df.index\n    \n    return(df)\n\nactivity_list = ['activity_cond', 'activity_cont']\n\ndata = []\n\nfor i in range(nrow_count):\n    cond_plot = load_and_prep('condition','number_cond',i)\n    cont_plot = load_and_prep('control','number_cont',i)\n    \n    new_df = pd.merge(cond_plot, cont_plot, how='inner',\n                      left_on=['minute_index'], right_on = ['minute_index'],\n                      suffixes=('_cond', '_cont'))\n    \n    new_df = new_df[['timestamp_cont','timestamp_cond',\n                     'minute_index', 'activity_cond', 'activity_cont']]\n    \n    for activity in activity_list:\n        new_df = new_df[(np.abs(stats.zscore(new_df[activity])) < 3)]\n    \n    data.append(new_df)","d837a10e":"_, ax1 = plt.subplots(nrow_count,1, figsize=(20, 80))\n\nfor i,_ in enumerate(data):\n\n    ax1[i].plot(data[i].minute_index, data[i].activity_cond, color='r', alpha = 0.5)\n    ax1[i].plot(data[i].minute_index, data[i].activity_cont, color='b',\n                marker='o', markersize=2,linestyle = '', alpha = 0.5)\n\n    ax1[i].legend((f'{sample_df.iloc[i][\"number_cond\"]}',\n                   f'{sample_df.iloc[i][\"number_cont\"]}'),\n                  loc='upper right', shadow=True)\n    \n    y_max =round(max([data[i].activity_cond.max(),data[i].activity_cont.max()]),-3)\n    \n    ax1[i].set_ylim(0, y_max)","0a7de14c":"_, ax2 = plt.subplots(nrow_count,1, figsize=(20, 80))\n\nfor i, _ in enumerate(data):\n    temp = data[i][[\"minute_index\", \"activity_cond\", \"activity_cont\"]]\n    \n    temp2 = temp.rename(columns = {\"activity_cond\": f'{sample_df.iloc[i][\"number_cond\"]}',\n                 \"activity_cont\": f'{sample_df.iloc[i][\"number_cont\"]}'})\n    \n    temp2 = pd.melt(temp2, id_vars=['minute_index'], var_name='activity')\n    \n    my_pal = {f'{sample_df.iloc[i][\"number_cond\"]}': \"r\",\n              f'{sample_df.iloc[i][\"number_cont\"]}': \"b\"}\n    \n    sns.boxplot(x='activity', y='value', data=temp2,  orient='v' , ax=ax2[i], palette=my_pal)\n    \n    for patch in ax2[i].artists:\n         r, g, b, a = patch.get_facecolor()\n         patch.set_facecolor((r, g, b, .5))","6b9731bb":"_, ax3 = plt.subplots(nrow_count,1, figsize=(20, 80))\n\nfor i, _ in enumerate(data):\n    temp = data[i][[\"minute_index\", \"activity_cond\", \"activity_cont\"]]\n    \n    temp2 = temp.rename(columns = {\"activity_cond\": f'{sample_df.iloc[i][\"number_cond\"]}',\n                 \"activity_cont\": f'{sample_df.iloc[i][\"number_cont\"]}'})\n    \n    temp2 = pd.melt(temp2, id_vars=['minute_index'], var_name='activity')\n    \n    my_pal = {f'{sample_df.iloc[i][\"number_cond\"]}': \"r\",\n              f'{sample_df.iloc[i][\"number_cont\"]}': \"b\"}\n    \n    sns.violinplot(x='activity', y='value', data=temp2,  orient='v' , ax=ax3[i], palette=my_pal)","53bec979":"Next step...looking at the actigraphy data to predict sleep. This is a difficult task, as we have univariate time series for each individual, with one channel of info.\n\nThe approach isn't obvious - one is to define features on a sliding window then feed into an unsupervised model.\n\nOne for the future...","a07b1b75":"# **Plotting box plots**\nThis quantifies the difference in activity. This makes it quite clear that there is a significant difference between the activity levels.","5751ca24":"In general, the activity levels drop for the condition vs control. This suggests that depression leads to a drop in activity.","9ea9de1e":"# **Plotting the controls vs conditions**\nPlots up the pairs of controls and conditions as determined above.","4ea6ea90":"# **Plotting violin plots**\nThis quantifies the difference in activity. This makes it quite clear that there is a significant difference between the activity levels.","a526e8e4":"# **Finding the between-participants matches**\n\nHere the participants are aligned based on number of days the tracker was worn, gender and age. This enables similar attributed individuals to be compared.","cc4108d4":"# **Cleaning and pairing controls vs conditions**\nIt appears that the users forgot to take off the actigraph, as readings were well beyond the dates that the reader was stated to be worn for. The assumption is they started on the first day as they were supposed to, up to the stated number of days in scores.csv.\n\nThe conditions and controls are then merged together into a single dataframe, and the outliers are removed ($z \\leq 3$)."}}