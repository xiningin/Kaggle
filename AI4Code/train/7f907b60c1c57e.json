{"cell_type":{"4c35f8cc":"code","4f9e1d99":"code","b4721e38":"code","542896bc":"code","54efbc4b":"code","a6644029":"code","738c83cd":"code","911c5d5d":"code","804f8c29":"code","7ac50539":"code","4bad3b36":"code","13b3a61a":"code","9325c7c4":"code","7eab7dd7":"code","e520a302":"code","e097f4fc":"code","c31df95a":"code","84ee830b":"code","2d3be613":"code","0b3a2f8f":"code","009c9e21":"code","1bb38fae":"code","2da635bf":"code","659f8f4f":"code","d4d36896":"code","5e945cdb":"code","86e64888":"code","03a83bd8":"code","48a3e3bf":"code","9240b171":"code","747bd49c":"code","8925f85f":"code","e1b94295":"code","d1145cf2":"code","b59b1e2a":"code","b0da2854":"code","7d8c6bc1":"code","6dd1e801":"code","5b56d3d9":"code","8e966c04":"markdown","19f53717":"markdown","0c048b1c":"markdown","a3a1c081":"markdown","6fd47d1d":"markdown","a8bc33e6":"markdown","6271b217":"markdown","b7db2517":"markdown","979cc5dd":"markdown","de55da9a":"markdown","6cde9f04":"markdown","1abfd552":"markdown","29c1dd82":"markdown","8c9d715c":"markdown","a153a2f3":"markdown","52ab95a8":"markdown","53fbe3be":"markdown","5489cc24":"markdown","876b5d88":"markdown","d6c5f01e":"markdown","ab6fcae6":"markdown","ccc36a29":"markdown","58f66b87":"markdown","2c3a5137":"markdown","6bfc7367":"markdown","a6eb715a":"markdown","536253b7":"markdown","3e5c3637":"markdown","f1fe463a":"markdown","dbbb3952":"markdown","354d75af":"markdown","2ed8db57":"markdown","b1b1e344":"markdown","fd194e02":"markdown","d909fa17":"markdown","e0fc5928":"markdown","35b682f5":"markdown","3ce74095":"markdown","2843ec4f":"markdown","b1f2396a":"markdown","112d93b1":"markdown","4039e4dc":"markdown","d1a833fd":"markdown","6aa1f820":"markdown","c89e3ece":"markdown","0ae4e8a4":"markdown","987ebb2a":"markdown","a7979042":"markdown"},"source":{"4c35f8cc":"import pandas as pd\nimport numpy as np\n\n#visualization\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\n#Linear Regression\nfrom scipy.stats import linregress\n\n#Train_test_split\nfrom sklearn.model_selection import train_test_split\n\n#cross_val_score\nfrom sklearn.model_selection import cross_val_score\n\n#scaling\nfrom sklearn.preprocessing import StandardScaler\n\n\n\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.metrics import precision_score,recall_score, confusion_matrix, classification_report,accuracy_score, f1_score\nfrom sklearn.metrics import r2_score, mean_squared_error\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.model_selection import cross_val_score \nimport matplotlib.pyplot as plt\n#models\n\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.neighbors import KNeighborsRegressor\nfrom sklearn.ensemble import AdaBoostRegressor\nfrom sklearn.ensemble import GradientBoostingRegressor\nfrom xgboost import XGBRegressor\nfrom catboost import CatBoostRegressor\n#score\nfrom sklearn.metrics import r2_score\n\n#Importing data\ndf = pd.read_csv(\"..\/input\/insurance\/insurance.csv\")","4f9e1d99":"# take a look at the data\ndf.head()","b4721e38":"# statistical measuers\ndisplay(df.describe())","542896bc":"# Getting some informations about the dataset\ndf.info()","54efbc4b":"fig, ax = plt.subplots(figsize=(8,6))\nsns.heatmap(df.corr(), annot=True, fmt='.1g', cmap=\"viridis\", cbar=True);","a6644029":"df.isna().sum()","738c83cd":"df.describe()","911c5d5d":"# Bmi\nsns.boxplot(df['bmi'])","804f8c29":"Q1 = df.bmi.quantile(0.25)\nQ3 = df.bmi.quantile(0.75)\nQ1, Q3","7ac50539":"IQR = Q3 - Q1\nIQR","4bad3b36":"lower_limit = Q1 - 1.5*IQR\nupper_limit = Q3 + 1.5*IQR\nlower_limit, upper_limit","13b3a61a":"df[df['bmi'] > upper_limit]","9325c7c4":"df_new = df.drop(df.index[[116,401,286,543,847,860,1047,1088,1317]])","7eab7dd7":"f = plt.figure(figsize=(14,6))\nax = f.add_subplot(122)\nsns.scatterplot(x='bmi',y='charges',data=df,palette='viridis',hue='smoker')\nax.set_title('Scatter plot of Charges vs bmi')\nplt.savefig('sc.png');","e520a302":"df[\"bmi\"].value_counts()   # Body mass index, providing an understanding of body, ideally 18.5 to 24.9","e097f4fc":"df['weight_condition'] = np.nan\ndata = [df]\n\nfor col in data:\n    col.loc[col.bmi < 18.5, \"weight_condition\"] = \"Underweight\"\n    col.loc[(col.bmi >= 18.5) & (col.bmi < 24.986), \"weight_condition\"] = \"Normal\"\n    col.loc[(col.bmi >= 25) & (col.bmi < 29.926), \"weight_condition\"] = \"Overweight\"\n    col.loc[col.bmi >= 30, \"weight_condition\"] = \"Obese\"\n","c31df95a":"df.drop(\"bmi\", axis = 1, inplace = True)\ndisplay(df.head())","84ee830b":"f = plt.figure(figsize=(14,6))\nax = f.add_subplot(121)\nsns.scatterplot(x='age',y='charges',data=df,palette='magma',hue='smoker',ax=ax)\nax.set_title('Scatter plot of Charges vs age')\n","2d3be613":"df['age_cat'] = np.nan\nlst = [df]\n\nfor col in lst:\n    col.loc[(col['age'] >= 18) & (col['age'] <= 35), 'age_cat'] = 'Young Adult'\n    col.loc[(col['age'] > 35) & (col['age'] <= 55), 'age_cat'] = 'Senior Adult'\n    col.loc[col['age'] > 55, 'age_cat'] = 'Elder'\n    ","0b3a2f8f":"df.drop(\"age\", axis = 1, inplace = True)\ndf.head()","009c9e21":"plt.style.use(\"seaborn\")\nfig, ax = plt.subplots(figsize=(5,5))\nplt.pie(x=df[\"sex\"].value_counts(), \n        colors=[\"skyblue\",\"pink\"], \n        labels=[\"Male\",\"Female\"], \n        shadow = True, \n        autopct=\"%1.2f%%\", \n        explode = (0, 0.1)\n        )\nplt.show()","1bb38fae":"#Cheking the charges distributions for males and females\nx1 = sns.FacetGrid(df, row='sex', height=4, aspect=3)\nx1 = x1.map(sns.distplot, 'charges', color='cornflowerblue')\nplt.show()\n","2da635bf":"plt.style.use(\"seaborn\")\nfig, ax = plt.subplots(figsize=(6,6))\nsns.countplot(df[\"children\"], palette=\"hls\");","659f8f4f":"#Creating a violinplot for each category\nplt.figure(figsize=(12,4))\nsns.violinplot(x='children', y='charges', data=df, hue='sex', palette='YlGnBu')\nplt.title('Charges according to number of children', size='23')\nplt.ylabel('Charges',size=18)\nplt.xlabel('Number of children',size=18)\nplt.show()","d4d36896":"#Countplot to compare the number of smokers and non-smokers\nplt.figure(figsize=(12,4))\nsns.countplot(x='smoker', data=df, hue='sex', palette='YlOrBr') \nplt.title('Number of smokers and non-smokers', size='23')\nplt.ylabel('Count',size=18)\nplt.xlabel('Smoker',size=18)\nplt.show()","5e945cdb":"#Countplot to compare the number of individuals from diffrent regions\nplt.figure(figsize=(12,4))\nsns.countplot(x='region', data=df, palette='husl') \nplt.title('Number of individuals from diffrent regions', size='23')\nplt.ylabel('Count',size=18)\nplt.xlabel('Region',size=18)\nplt.show()","86e64888":"from sklearn.preprocessing import LabelEncoder\nle = LabelEncoder()\nles = {}\nfor col in ['sex','smoker','region', 'weight_condition', 'age_cat']:\n    les[col] = LabelEncoder()\n    df[col]  = les[col].fit_transform(df[col])","03a83bd8":"df.head()","48a3e3bf":"df =df.drop(columns=['sex','region'])\ndf.head()","9240b171":"x= df.drop('charges',axis=1).values\ny =df.charges.values\nx_tr,x_tst,y_tr,y_tst = train_test_split(x,y,test_size=.2,random_state=25)","747bd49c":"sc = StandardScaler()\nx_tr = sc.fit_transform(x_tr)\nx_tst = sc.transform(x_tst)","8925f85f":"lr  = LinearRegression()\nknn = KNeighborsRegressor(n_neighbors=10)\ndt  = DecisionTreeRegressor(max_depth = 3)\nrf  = RandomForestRegressor(max_depth = 3, n_estimators=500)\nada = AdaBoostRegressor( n_estimators=50, learning_rate =.01)\ngbr = GradientBoostingRegressor(max_depth=2, n_estimators=100, learning_rate =.2)\nxgb = XGBRegressor(max_depth = 3, n_estimators=50, learning_rate =.2)\ncb  = CatBoostRegressor(learning_rate =.01, max_depth =5, verbose = 0)\n\nregressors = [('Linear Regression', lr), ('K Nearest Neighbours', knn),('Decision Tree', dt), ('Random Forest', rf), \n              ('AdaBoost', ada),('Gradient Boosting Regressor', gbr),('XGBRegressor', xgb),('CatBoostRegressor', cb)]\n","e1b94295":"\nfor regressor_name, regressor in regressors:\n\n    regressor.fit(x_tr, y_tr)    \n  \n    y_pred = regressor.predict(x_tst)\n    accuracy = round(r2_score(y_tst,y_pred),3)*100\n    \n    print('{:s} : {:.0f} %'.format(regressor_name, accuracy))\n    plt.rcParams[\"figure.figsize\"] = (20,8)\n    plt.bar(regressor_name,accuracy)","d1145cf2":"y_predict = gbr.predict(x_tst)\ngbr_r2_score = r2_score(y_tst, y_predict)\nprint('R square Score = ', round(gbr_r2_score, 5))\n\nmse = mean_squared_error(y_tst, y_predict)\nrmse_1 = np.sqrt(mse)\nprint('Root Mean Squared Error = ', round(rmse_1,5))","b59b1e2a":"y_predict = xgb.predict(x_tst)\nxgb_r2_score = r2_score(y_tst, y_predict)\nprint('R square Score = ', round(xgb_r2_score, 5))\n\nmse = mean_squared_error(y_tst, y_predict)\nrmse_2 = np.sqrt(mse)\nprint('Root Mean Squared Error = ', round(rmse_2, 5))","b0da2854":"y_predict = cb.predict(x_tst)\ncb_r2_score = r2_score(y_tst, y_predict)\nprint('R square Score = ', round(cb_r2_score, 5))\n\nmse = mean_squared_error(y_tst, y_predict)\nrmse_3 = np.sqrt(mse)\nprint('Root Mean Squared Error = ', round(rmse_3, 5))","7d8c6bc1":"score = cross_val_score(xgb, x, y, cv=5)\nprint(score)","6dd1e801":"\nr2_scores = [gbr_r2_score*1000,xgb_r2_score*1000,cb_r2_score*1000]\nmodel_names = [\"Gradient Boosting R\",\"XGBRegressor\",\"CatBoostRegresso\"]\n\ntotal_bar = np.arange(len(model_names))\ncolor = ['#9edd1d', '#3edd1d', '#f7c851']\n\nfig, ax = plt.subplots(figsize=(15, 5))\nbar = plt.bar(model_names, r2_scores, alpha=1,color=color)\nplt.xticks(total_bar, model_names)\nplt.ylabel('Accuracy',fontsize=15, color='black')\nplt.xlabel('Model Name',fontsize=15, color='black')\nplt.title('Model Performance Comparison', fontsize=16, color='black', fontweight='bold')\n\ndef autolabel(bar):\n    for bar in bar:\n        height = int(bar.get_height())\n        ax.text(bar.get_x() + .4, .5*height,\n                height, va='bottom',\n                fontsize=14, color='black')\n        \nautolabel(bar)\n\nplt.show()","5b56d3d9":"m = [rmse_1,rmse_2,rmse_3]\nmodel_names = [\"Gradient Boosting R\",\"XGBRegressor\",\"CatBoostRegresso\"]\n\ntotal_bar = np.arange(len(model_names))\ncolor = ['#9edd1d', '#3edd1d', '#f7c851']\n\nfig, ax = plt.subplots(figsize=(15, 5))\nbar = plt.bar(model_names, m, alpha=1,color=color)\nplt.xticks(total_bar, model_names)\nplt.ylabel('Accuracy',fontsize=15, color='black')\nplt.xlabel('Model Name',fontsize=15, color='black')\nplt.title('Root Mean Squared Error', fontsize=16, color='black', fontweight='bold')\n\ndef autolabel(bar):\n    for bar in bar:\n        height = int(bar.get_height())\n        ax.text(bar.get_x() + .4, .5*height,\n                height, va='bottom',\n                fontsize=14, color='black')\n        \nautolabel(bar)\n\nplt.show()","8e966c04":"- Gradient Boosting Regressor","19f53717":"### insights:\n- Most of the people who smoke are obese people\n- Even though a person is not obese but he\/she smokes, his\/her charges tends to be higher.\n","0c048b1c":"##### As we can see the two distributions are almost the same for both women\/men, so we can affirm that there is no influence on the medical charges when it comes to the sex variable.","a3a1c081":"### Model Accuracy Comparison","6fd47d1d":"### Cross Validation\nIt is a resampling procedure wich is used to evaluate the machine learning models on limited data samples. Its goal is to predict new data that is that is not tested before. ","a8bc33e6":"###  let's see how many children our patients have.\n\n","6271b217":" first we will need some statistical information...","b7db2517":"> # EDA","979cc5dd":"#### i got them \ud83d\ude08","de55da9a":"#### I see that It will be clearer if we classify people into categories according to their \"bmi\" \ud83d\udca1","6cde9f04":" ### R square (r2) Score & Root Mean Squared Error(RMSE)\n ","1abfd552":"##### Great \u2665\ufe0f","29c1dd82":"Hmmm... not much","8c9d715c":"##### Almost the same proportion...","a153a2f3":"> # Splitting the data into Training data & Testing Data:","52ab95a8":"#### i'll do the same thing with \"age\" so that the data to be follow the same flo \ud83e\udd19\ud83c\udffb","53fbe3be":"##### is there is a relationship between the features and each other?","5489cc24":"#### Findings:\n\nThere are four numerical variables:\n    - Continuous:\n    - Age\n    - BMI\n    - Charges\n    - Discrete:\n    - children  \nThere are three categorical variables:\n    - Sex\n    - Smoker\n    - Region","876b5d88":"##### Almsot all the regions have equal number of individuals.","d6c5f01e":"As we can see, almost all categories have the same range and mean of costs also the distributions are very similar, except for the people who have 5 children. This might be because of the small size of the sample of this kind of people!","ab6fcae6":"### checking the missing data:","ccc36a29":"### before go  to modeling, we have to prepare the data types of the features:","58f66b87":"###  Relation between regions and charges: ","2c3a5137":" > ## Importing libraries and data\u00b6\n","6bfc7367":"## Conclusion:\n##### We have found out that region and gender does not bring significant difference on charges among its groups. Age, BMI,      number of children and smoking are the once that drives the charges. \nAs:\n-  age has an impact on the charges, when a person is older the health costs are larger.\n-  if you are a smoker you must expect some huge medical charges compared to non-smokers. Especially for people who have high BMI values (>35) it will result very serious health care charges.\n- no matter where you live, this won't have any impact on your medical insurance bills.\n- the number of children doesn't affect the medical costs billed by health insurance.\n-  it doesn't matter if you are a men or a women your health bills won't change.","a6eb715a":"#### Let's find out which this data is..","536253b7":"### Does it indicate that the data is really stable? check the outliers...","3e5c3637":"### take a look at the features and its effect in the target \"charges\" ...\n","f1fe463a":"> ## Analyze by describing the data","dbbb3952":"> # Modeling :\nThere are good models, But we looking for the Best!","354d75af":"No missing data, cool!","2ed8db57":"- CatBoostRegressor.\n","b1b1e344":"##### As we can see charges for smokers are much higher than charges for non-smokers. Sex doesn't have any effect on charges when you are a smoker","fd194e02":"### We are almost ready to finally prepare the models! so let's split the data to work on it...","d909fa17":"#### notice :\n- 0 for females\n- 1 for males\n------------------\n- smokers = 1: yes\n- smokers = 0: no\n\n Males tend to smoke more than females.","e0fc5928":"only 9 records! we can get red of them safely ","35b682f5":"- Experience 8 algorithms\n","3ce74095":"##### The rest of the features are stable, thank God .","2843ec4f":"### Relation between smoking and charges: ","b1f2396a":"##### Most patients do not have children","112d93b1":"> ## It's time to prepare our data \ud83d\ude4c\ud83c\udffb:","4039e4dc":"### age VS charges","d1a833fd":"- Feature Scaling","6aa1f820":"### Relation between sex and charges: ","c89e3ece":"> # label encoding:\n","0ae4e8a4":"- XGBRegressor\n- note : the best algorithm","987ebb2a":"### Best Models\n- Gradient Boosting Regressor : 88 %\n- CatBoostRegressor : 88 %\n- XGBRegressor : 88 %\n","a7979042":"#### Insights\n- Charges increases as the age of the person increases\n- Smokers and obese people have the highest charges regardless of their age.\n"}}