{"cell_type":{"6a758bab":"code","9e0db0b2":"code","1e92f18f":"code","47fa0c79":"code","64260aa8":"code","62f40a6c":"code","a2c526e9":"code","c0988533":"code","8032f9dc":"code","19da34de":"code","c7a9cb19":"code","40767eb5":"code","b5539a45":"code","a59c1db9":"code","b1ac3da7":"code","1453d8f1":"code","4184466d":"code","1dc11b12":"code","b3dced84":"code","0bfdb857":"code","6f63afa9":"code","518e15e8":"code","b1042d4f":"code","a5aaa3e0":"code","9435fc31":"code","e57c528a":"code","ae39db52":"code","763a30dc":"code","06afda2e":"code","5eb8f3cb":"code","06bc9839":"code","c9e4db09":"code","6bd03193":"code","197d11c0":"code","d45b8289":"code","637aac59":"code","e57721cb":"code","5060c5d5":"code","def069b4":"code","6f8c01c8":"code","43a93296":"code","86cfbf98":"code","693eb997":"code","25f6ef3b":"code","65220741":"code","5565e898":"markdown","2bfc12aa":"markdown","17da5704":"markdown","a8966368":"markdown","2a30d60d":"markdown","9ceeaa53":"markdown","ae206ec6":"markdown","b37ed177":"markdown","004a4ee9":"markdown","59b5455b":"markdown","50e2698a":"markdown","c5e8623d":"markdown","ab3bc5f6":"markdown","b85a9588":"markdown","f2fbc4cd":"markdown","50120795":"markdown","e9464b94":"markdown","0efa8ba2":"markdown","14b10877":"markdown","373daa34":"markdown","6644b944":"markdown","14c959aa":"markdown","24a5c55f":"markdown","9d4867e2":"markdown","3d7d8ffb":"markdown","dd26077f":"markdown","77bdd43d":"markdown","4fbb6715":"markdown","bd3addf8":"markdown","532107d5":"markdown"},"source":{"6a758bab":"!ls -lh ..\/input\/ashrae-energy-prediction\/","9e0db0b2":"import os\nimport numpy as np\nimport pandas as pd\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom tqdm import tqdm_notebook\n\nimport altair as alt\nfrom altair.vega import v5\nfrom IPython.display import HTML\n\n%matplotlib inline\nplt.rc('figure', figsize=(15.0, 8.0))","1e92f18f":"%%time\nroot = '..\/input\/ashrae-energy-prediction\/'\ntrain_df = pd.read_csv(root + 'train.csv')\nweather_train_df = pd.read_csv(root + 'weather_train.csv')\ntest_df = pd.read_csv(root + 'test.csv')\nweather_test_df = pd.read_csv(root + 'weather_test.csv')\nbuilding_meta_df = pd.read_csv(root + 'building_metadata.csv')\nsample_submission = pd.read_csv(root + 'sample_submission.csv')","47fa0c79":"train_df.head()","64260aa8":"print(f'There are {train_df.shape[0]} rows in train data.')\nprint(f\"There are {train_df['meter'].nunique()} distinct meters in train data.\")\nprint(f\"There are {train_df['building_id'].nunique()} distinct buildings in train data, same as the number of rows in building_meta data\")","62f40a6c":"building_meta_df.head()","a2c526e9":"print(f'There are {building_meta_df.shape[0]} rows in building meta data.')","c0988533":"weather_train_df.head()","8032f9dc":"print(f'There are {weather_train_df.shape} rows in weather train data.')","19da34de":"test_df.head()","c7a9cb19":"print(f'There are {test_df.shape[0]} rows in test data.')\nprint(f\"There are {test_df['meter'].nunique()} distinct meters in test data.\")\nprint(f\"There are {test_df['building_id'].nunique()} distinct buildings in test data.\")","40767eb5":"sorted(train_df['building_id'].unique()) == sorted(test_df['building_id'].unique())","b5539a45":"weather_test_df.head()","a59c1db9":"print(f'There are {weather_test_df.shape} rows in weather test data.')","b1ac3da7":"sample_submission.head()","1453d8f1":"print(f'There are {sample_submission.shape} rows in sample submission file.')","4184466d":"train_df = train_df.merge(building_meta_df, on='building_id', how='left')\ntrain_df = train_df.merge(weather_train_df, on=['site_id', 'timestamp'], how='left')","1dc11b12":"train_df.describe()","b3dced84":"fig, ax = plt.subplots(figsize=(10, 10))\nplot = sns.countplot(y=\"meter\", data=train_df, palette=['navy', 'darkblue', 'blue', 'dodgerblue']).set_title('Meter count', fontsize=16)\nplt.yticks(fontsize=14)\nplt.xlabel(\"Count\", fontsize=15)\nplt.ylabel(\"Meter number\", fontsize=15)\nplt.show(plot)","0bfdb857":"fig, ax = plt.subplots(figsize = (18, 6))\nplt.subplot(1, 2, 1);\nplt.hist(train_df['meter_reading']);\nplt.title('Basic meter_reading histogram');\nplt.subplot(1, 2, 2);\nsns.violinplot(x='meter', y='meter_reading', data=train_df);\nplt.title('Violinplot of meter_reading by meter');","6f63afa9":"train_df.query('meter_reading==0').shape, train_df.shape","518e15e8":"def plot_dist(meter, clip_from):\n    '''Plots distribution of non zero train data vs meter number''' \n    df = train_df.query(f'meter=={meter} and meter_reading!=0')\n    fig, ax = plt.subplots(figsize = (18, 6))\n    plt.subplot(1, 3, 1);\n    plt.hist(df['meter_reading']);\n    plt.title('Basic meter_reading histogram');\n    plt.subplot(1, 3, 2);\n    sns.violinplot(x='meter', y='meter_reading', data=df);\n    plt.title('Violinplot of meter_reading by meter');\n    plt.subplot(1, 3, 3);\n    sns.violinplot(x='meter', y='meter_reading', data=df.query(f'meter_reading < {clip_from}'));\n    plt.title('*Clipped* Violinplot of meter_reading by meter');","b1042d4f":"plot_dist(0, 2000)","a5aaa3e0":"plot_dist(1, 10000)","9435fc31":"plot_dist(2, 10000)","e57c528a":"plot_dist(3, 2000)","ae39db52":"# Compute the correlation matrix\ncorr = train_df.corr()\n\n# Generate a mask for the upper triangle\nmask = np.zeros_like(corr, dtype=np.bool)\nmask[np.triu_indices_from(mask)] = True\n\n# Set up the matplotlib figure\nf, ax = plt.subplots(figsize=(11, 9))\n\n# Generate a custom diverging colormap\ncmap = sns.diverging_palette(220, 10, as_cmap=True)\n\n# Draw the heatmap with the mask and correct aspect ratio\nsns.heatmap(corr, mask=mask, cmap=cmap, vmax=.3, center=0,\n            square=True, linewidths=.5, cbar_kws={\"shrink\": .5})","763a30dc":"from statsmodels.tsa.seasonal import seasonal_decompose","06afda2e":"building_id = 400\nbuilding = train_df.query(f'building_id == {building_id} and meter==0')","5eb8f3cb":"decomposition = seasonal_decompose(building['meter_reading'].values, freq=24)\ndecomposition.plot();","06bc9839":"weather_train_df.columns","c9e4db09":"def plot_kde(column):\n    plot = sns.jointplot(x=train_df[column][:10000], y=train_df['meter_reading'][:10000], kind='kde', color='blueviolet')\n    plot.set_axis_labels('meter', 'meter_reading', fontsize=16)\n    plt.show()","6bd03193":"def plot_dist_col(column):\n    '''plot dist curves for train and test weather data for the given column name'''\n    fig, ax = plt.subplots(figsize=(10, 10))\n    sns.distplot(weather_train_df[column].dropna(), color='darkorange', ax=ax).set_title(column, fontsize=16)\n    sns.distplot(weather_test_df[column].dropna(), color='purple', ax=ax).set_title(column, fontsize=16)\n    plt.xlabel(column, fontsize=15)\n    plt.legend(['train', 'test'])\n    plt.show()","197d11c0":"plot_dist_col('air_temperature')","d45b8289":"plot_dist_col('cloud_coverage')","637aac59":"plot_dist_col('dew_temperature')","e57721cb":"plot_dist_col('precip_depth_1_hr')","5060c5d5":"plot_dist_col('sea_level_pressure')","def069b4":"plot_dist_col('wind_direction')","6f8c01c8":"plot_dist_col('wind_speed')","43a93296":"building_meta_df.head()","86cfbf98":"fig, ax = plt.subplots(figsize=(10, 10))\nplot = sns.countplot(y=\"primary_use\", data=building_meta_df, \n                     palette='YlGn').set_title('Primary category of activities for the building', fontsize=16)\nplt.yticks(fontsize=14)\nplt.xlabel(\"Count\", fontsize=15)\nplt.ylabel(\"Building use type\", fontsize=15)\nplt.show(plot)","693eb997":"fig, ax = plt.subplots(figsize=(10, 10))\nsns.distplot(building_meta_df['square_feet'], color='indigo', \n             ax=ax).set_title('Gross floor area of the building', fontsize=16)\nplt.xlabel('square_feet', fontsize=15)\nplt.show()","25f6ef3b":"fig, ax = plt.subplots(figsize=(10, 10))\nsns.distplot(building_meta_df['year_built'].dropna(), color='crimson', \n             ax=ax).set_title('Year building was opened', fontsize=16)\nplt.xlabel('year_built', fontsize=15)\nplt.show()","65220741":"fig, ax = plt.subplots(figsize=(10, 10))\nsns.distplot(building_meta_df['floor_count'].dropna(), color='crimson', \n             ax=ax).set_title('Number of floors of the building', fontsize=16)\nplt.xlabel('floor_count', fontsize=15)\nplt.show()","5565e898":"### Let's take a brief overview of the train and test data","2bfc12aa":"Let's see `meter` counts","17da5704":"In this competition our task is to estimate the energy consumption of buildings over time. Significant investments are being made to improve building efficiencies to reduce costs and emissions but current methods of estimation are fragmented and do not scale well. In this competition, we have to develop accurate predictions of metered building energy usage in the following areas: chilled water, electric, natural gas, hot water, and steam meters. The data comes from over 1,000 buildings over a three-year timeframe. ","a8966368":"# Let's do some deeper analysis","2a30d60d":"Few interesting inferences:\n\n* Almost all of meter_reading values are close to zero\n* meter_readings from meter number 2 is exceptionally higher compared to other meters","9ceeaa53":"* https:\/\/www.kaggle.com\/tarunpaparaju\/lyft-competition-understanding-the-data\n* https:\/\/www.kaggle.com\/artgor\/molecular-properties-eda-and-models","ae206ec6":"All buildings were built between 1990 and 2017","b37ed177":"Conclusion: the train and test weather distributions are quite similar","004a4ee9":"We can see meter_reading has low correlation with other attributes, hmm ..","59b5455b":"`test.csv`\n\nThe submission files use row numbers for ID codes in order to save space on the file uploads. test.csv has no feature data; it exists so you can get your predictions into the correct order.\n\n* `row_id` - Row id for your submission file\n* `building_id` - Building id code\n* `meter` - The meter id code\n* `timestamp` - Timestamps for the test data period","50e2698a":"<font size=4 color='red'>Do upvote if you liked this kernel :)<\/font>","c5e8623d":"* `building_id` - Foreign key for the building metadata.\n* `meter` - The meter id code. Read as {0: electricity, 1: chilledwater, 2: steam, hotwater: 3}. Not every building has all meter types.\n* `timestamp` - When the measurement was taken\n* `meter_reading` - **The target variable.** Energy consumption in kWh (or equivalent). Note that this is real data with measurement error, which we expect will impose a baseline level of modeling error.","ab3bc5f6":"## References","b85a9588":"We can see that meter frequency is in order of 0 (electricity) > 1 (chilledwater) > 2 (steam) > 3 (hotwater)","f2fbc4cd":"### Let's analyse the train\/test weather data","50120795":"#### Let's take a look at the test data","e9464b94":"`weather_test_df` has same attribute definitions as that of `weather_train_df`","0efa8ba2":"You can try out different building ids to see that the seasonality is not that significant in many cases.","14b10877":"Work in Progress ..","373daa34":"# ASHRAE - Great Energy Predictor III","6644b944":"`weather_[train\/test].csv` contains weather data from a meteorological station as close as possible to the site.\n\n* `site_id`\n* `air_temperature` - Degrees Celsius\n* `cloud_coverage` - Portion of the sky covered in clouds, in oktas\n* `dew_temperature` - Degrees Celsius\n* `precip_depth_1_hr` - Millimeters\n* `sea_level_pressure` - Millibar\/hectopascals\n* `wind_direction` - Compass direction (0-360)\n* `wind_speed` - Meters per second","14c959aa":"Let's look at the correlation plot","24a5c55f":"### Let's try to find out the trend and seasonality in meter_readings","9d4867e2":"So, about 10% of meter_readings are zero, let's plot `meter_readings` by `meter` distribution plot one by one.","3d7d8ffb":"### Let's analyse the building meta data","dd26077f":"So, the we have 1449 `building_id`s in train and test data and both share the same set of ids and meta features as present in `building_meta.csv`","77bdd43d":"`row_id` is a foreign_key to `test.csv`, we have to predict `meter_reading` for corresponding row in the test.csv","4fbb6715":"Let's analyse meter readings with histograms and violin plots:","bd3addf8":"`building_meta.csv` contains meta features for each building present in the dataset, the attributes definitions are as follows:\n* `site_id` - Foreign key for the weather files.\n* `building_id` - Foreign key for training.csv\n* `primary_use` - Indicator of the primary category of activities for the building based on EnergyStar property type definitions\n* `square_feet` - Gross floor area of the building\n* `year_built` - Year building was opened\n* `floor_count` - Number of floors of the building\n","532107d5":"Work in progress.."}}