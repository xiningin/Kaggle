{"cell_type":{"b680923a":"code","8042898a":"code","03c84989":"code","a31b7bc9":"code","d5c5ed4f":"code","73df4d51":"code","b7faddc9":"code","c24e385c":"code","70364eab":"code","37aba69b":"code","c798048f":"code","685ddb21":"code","3ddc2398":"code","3761ef90":"code","cc6e59f6":"code","4b669e53":"code","de22aa9f":"code","d9cd6f90":"code","9d253981":"code","334ddf58":"code","2e0bb9ee":"code","349d804b":"code","53cdec7c":"code","4ed6b2f7":"code","d62ffae6":"code","3955b7b2":"code","a6308e6f":"code","f14ee149":"code","7b5df824":"code","daf6962c":"code","b8abba5b":"code","06d4bc87":"code","cd136a18":"code","2488f96d":"code","363f5c18":"code","c672719c":"code","8e685832":"code","6f9d4f63":"code","b485a7a6":"code","a146f23b":"code","f91f0003":"code","9c9630c4":"code","362b8ab0":"code","05f1c2ab":"code","957e2bc2":"code","525aa12f":"code","3ac1d273":"code","b16863c9":"code","0604ec3e":"code","858ce4e0":"code","4d4ad033":"code","03fe7b79":"markdown","6a51ee3d":"markdown"},"source":{"b680923a":"# https:\/\/www.kaggle.com\/rsrishav\/youtube-trending-video-dataset\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport os","8042898a":"data = []\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        if filename.endswith('csv'):\n            dft = pd.DataFrame(pd.read_csv(os.path.join(dirname, filename), header=0))\n            dft['country'] = filename[:2]\n            data.append(dft)\n\ndf = pd.concat(data, axis=0, ignore_index=True)","03c84989":"country = df.country.unique().tolist()\ndf['countryId'] = df.country.apply(lambda x: country.index(x))","a31b7bc9":"df.head(2)","d5c5ed4f":"def eda(dfA, all=False, desc='Exploratory Data Analysis'):\n    print(desc)\n    print(f'\\nShape:\\n{dfA.shape}')\n    print(f'\\nIs Null: {dfA.isnull().sum().sum()}')\n    print(f'{dfA.isnull().mean().sort_values(ascending=False)}')\n    dup = dfA.duplicated()\n    print(f'\\nDuplicated: \\n{dfA[dup].shape}\\n')\n    try:\n        print(dfA[dfA.duplicated(keep=False)].sample(4))\n    except:\n        pass\n    if all:  # here you put yours prefered analysis that detail more your dataset\n        \n        print(f'\\nDTypes - Numerics')\n        print(dfA.describe(include=[np.number]))\n        print(f'\\nDTypes - Categoricals')\n        print(dfA.describe(include=['object']))\n        \n        #print(df.loc[:, df.dtypes=='object'].columns)\n        print(f'\\nHead:\\n{dfA.head()}')\n        print(f'\\nSamples:\\n{dfA.sample(2)}')\n        print(f'\\nTail:\\n{dfA.tail()}')","73df4d51":"eda(df)","b7faddc9":"# Is Null: 912\n# description          0.014809\nlen(df[df.description.isna()])","c24e385c":"df.description = df.description.fillna('no-discription')","70364eab":"eda(df)","37aba69b":"import seaborn as sns\nimport matplotlib.pyplot as plt","c798048f":"g = df[['countryId', 'country']].groupby('country').count()\na = df[['likes', 'dislikes', 'view_count', 'country']].groupby('country').sum()","685ddb21":"g","3ddc2398":"sns.barplot(x=g.index, y=g.countryId).set_title('Number videos WW')","3761ef90":"a","cc6e59f6":"sns.barplot(x=a.index, y=a.view_count).set_title('Sum of Views by country')","4b669e53":"sns.barplot(x=a.index, y=a.likes).set_title('Sum of likes by country')","de22aa9f":"sns.barplot(x=a.index, y=a.dislikes).set_title('Sum of dislikes by country')","d9cd6f90":"br = df.query(\"country == 'BR' or country == 'US'\")","9d253981":"def sepColumns(dataset):\n    num = []\n    cat = []\n    for i in dataset.columns:\n        if dataset[i].dtype == 'object':\n            cat.append(i)\n        else:\n            num.append(i)\n    return num, cat","334ddf58":"num, categ = sepColumns(br)","2e0bb9ee":"br[num].describe()","349d804b":"br[['title', 'dislikes']].groupby('title').sum().sort_values(by='dislikes', ascending=False).head()","53cdec7c":"br[['title', 'likes']].groupby('title').sum().sort_values(by='likes', ascending=False).head()","4ed6b2f7":"br[['title', 'view_count']].groupby('title').sum().sort_values(by='view_count', ascending=False).head()","d62ffae6":"dashbr=br[['title', 'view_count', 'likes', 'dislikes']].groupby('title').sum().sort_values(by='view_count', ascending=False).head()\ndashbr","3955b7b2":"br.sample()","a6308e6f":"def correlation(df, varT, xpoint=-0.5, showGraph=True):\n    corr = df.corr()\n    print(f'\\nFeatures correlation:\\n'\n          f'Target: {varT}\\n'\n          f'Reference.: {xpoint}\\n'\n          f'\\nMain features:')\n    corrs = corr[varT]\n    features = []\n    for i in range(0, len(corrs)):\n        if corrs[i] > xpoint and corrs.index[i] != varT:\n            print(corrs.index[i], f'{corrs[i]:.2f}')\n            features.append(corrs.index[i])\n    if showGraph:\n        sns.heatmap(corr,\n                    annot=True, fmt='.2f', vmin=-1, vmax=1, linewidth=0.01,\n                    linecolor='black', cmap='RdBu_r'\n                    )\n        plt.title('Correlations between features w\/ target')\n        plt.show()\n    return features","f14ee149":"varTarget = 'likes'","7b5df824":"varFeatures = correlation(br, varTarget, 0.5)","daf6962c":"def removeOutliers(out, varTarget):\n    print('\\nOutliers\\nRemoving ...', end='')\n    cidgrp = out[varTarget]\n    print('..', end='')\n    # quantiles\n    qtl1 = cidgrp.quantile(.25)  \n    qtl3 = cidgrp.quantile(.75)\n    print('..', end='')\n    # calculating iqr\n    iqr = qtl3 - qtl1\n    print('..', end='')\n\n    # creating limits\n    baixo = qtl1 - 1.5 * iqr\n    alto = qtl3 + 1.5 * iqr\n    print('..', end='')\n\n    # removing outliers\n    novodf = pd.DataFrame()\n    print('..', end='')\n\n    limites = out[varTarget].between(left=baixo, right=alto, inclusive=True)\n    novodf = pd.concat([novodf, out[limites]])\n\n    print('.....Done')\n\n    return novodf","b8abba5b":"noOut = removeOutliers(br, varTarget)","06d4bc87":"# Two subplots\nfig, (ax1, ax2) = plt.subplots(ncols=2, sharey=True, figsize=(15,5))\nsns.boxplot(x=br[varTarget], ax=ax1).set_title('Original')\nsns.boxplot(x=noOut[varTarget], ax=ax2).set_title('Original No outliers')","cd136a18":"print(br[varTarget].describe())\nsns.barplot(x=br[varTarget].describe().index[1:], y=br[varTarget].describe().values[1:])","2488f96d":"print(noOut[varTarget].describe())\nsns.barplot(x=noOut[varTarget].describe().index[1:], y=noOut[varTarget].describe().values[1:])","363f5c18":"varFeatures = correlation(noOut, varTarget, 0.5)","c672719c":"# ML Algoritmos\nfrom sklearn.ensemble import RandomForestRegressor, GradientBoostingRegressor\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.linear_model import LinearRegression, LogisticRegression, PoissonRegressor\nfrom sklearn.svm import SVR\nfrom sklearn.naive_bayes import GaussianNB\nfrom sklearn.dummy import DummyRegressor\n\n# ML selecao de dados de treino e teste\nfrom sklearn.model_selection import train_test_split\n# calcular o menor erro medio absoluto entre 2 dados apresentados\nfrom sklearn.metrics import mean_absolute_error","8e685832":"regressors = [\n        DecisionTreeRegressor(),\n        RandomForestRegressor(),\n#         SVR(),\n#         LinearRegression(),\n#         GradientBoostingRegressor(),\n#         PoissonRegressor(),\n#         DummyRegressor(),\n#         LogisticRegression(),\n#         GaussianNB()\n    ]","6f9d4f63":"X = noOut[varFeatures]\ny = noOut[varTarget]\nXtreino, Xteste, ytreino, yteste = train_test_split(X, y, test_size=0.3, random_state=42)","b485a7a6":"reg = []\nmae = []\nsco = []\nfor regressor in regressors:\n    modelo = regressor\n    modelo.fit(Xtreino, np.array(ytreino))\n    sco.append(modelo.score(Xtreino, ytreino))\n    previsao = modelo.predict(Xteste)\n    mae.append(round(mean_absolute_error(yteste, previsao), 2))\n    reg.append(regressor)","a146f23b":"meuMae = pd.DataFrame(columns=['Regressor', 'mae', 'score'])\nmeuMae['Regressor'] = reg\nmeuMae['mae'] = mae\nmeuMae['score'] = sco","f91f0003":"meuMae = meuMae.sort_values(by='score', ascending=False)\nmeuMae","9c9630c4":"meuMae[\"Regressor\"].values[0]","362b8ab0":"model = meuMae[\"Regressor\"].values[0]\nx = noOut['view_count']\ny = noOut[varTarget]\nmodel.fit(np.array(x).reshape(-1, 1), y)","05f1c2ab":"# what is the prediction to 1mi views?\nvalFeatures = [1000000]\npredict = float(model.predict([valFeatures]))","957e2bc2":"print(f'Summary:\\n'\n          f'Regs analyzed: {len(noOut)}\\n'\n          f'ML applied: {meuMae[\"Regressor\"].values[0]}\\n'\n          f'Features analyzed:')\n\nprint(f' - {varFeatures[0]}: {valFeatures[0]}')\n\nprint(f\"Predicted likes: {predict:.0f} \")","525aa12f":"noOut[noOut.view_count > 1000000][['view_count', 'likes']].describe()","3ac1d273":"go = noOut[['countryId', 'country']].groupby('country').count()\nao = noOut[['likes', 'dislikes', 'view_count', 'country']].groupby('country').sum()","b16863c9":"sns.barplot(x=go.index, y=go.countryId).set_title('Number videos WW')","0604ec3e":"sns.barplot(x=ao.index, y=ao.view_count).set_title('Sum of Views by country')","858ce4e0":"sns.barplot(x=ao.index, y=ao.likes).set_title('Sum of likes by country')","4d4ad033":"sns.barplot(x=ao.index, y=ao.dislikes).set_title('Sum of dislikes by country')","03fe7b79":"**Predictions**","6a51ee3d":"# Brazil and USA\n"}}