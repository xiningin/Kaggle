{"cell_type":{"811dcce1":"code","7f5cc00a":"code","a06d1b3c":"code","49d8b6b5":"code","2aa1e0f3":"code","966b1226":"code","74d18f11":"code","c75266d3":"code","6daf13c0":"code","dec930cc":"code","245fff00":"code","420129fb":"code","f94b9797":"code","5793f313":"code","7fa999f1":"code","a6702fe9":"code","cf0b8cb3":"code","897e9326":"code","20d3b2e3":"code","d9600a7e":"code","945c917e":"code","7903a702":"code","bf537d88":"code","d5eccaea":"code","711c4ee1":"code","e181c694":"code","a741fbb0":"code","835ac4a5":"code","951c9035":"code","7dfe8b12":"code","4d0a9e21":"code","fd62f14c":"code","9e61d4ee":"code","eee3cac7":"code","f5084d2e":"code","21874533":"code","808e6502":"code","7cfb8a77":"code","2dadafd8":"code","1a1d5601":"code","dfc28fb7":"code","00fdc02e":"code","f9df0e0d":"code","50e82692":"code","2c211819":"code","4b799592":"code","ffe4d10b":"code","f5313a7a":"code","ef8c7798":"code","f73124fb":"code","8eeed523":"code","23bb54c3":"code","97790b64":"code","3de233a2":"code","e396829a":"code","b5eba9f1":"code","a0648ed7":"code","96bdfe4a":"code","cc62afb4":"code","105476ef":"code","99676994":"code","56faf943":"code","3be244e6":"code","5efee7ae":"code","44bd3294":"code","ec082e57":"code","4326a091":"code","4e6bb69a":"code","57cdaa8f":"code","0b2acef1":"code","4a36b43f":"markdown","8cd981b3":"markdown","cffc06a8":"markdown","91f7389f":"markdown","0e687480":"markdown","0e353f76":"markdown","81829fc8":"markdown","2a148913":"markdown","11b5e76a":"markdown","c18da914":"markdown","e63a66f6":"markdown","251c5930":"markdown","32c2aba8":"markdown","7ab25765":"markdown","d999dacc":"markdown","45fbd32a":"markdown","9e4a850a":"markdown","3d5162e3":"markdown","2fba6c31":"markdown","9d5e17c4":"markdown","c7aeb12c":"markdown","6a485000":"markdown","bac5e3d9":"markdown","1845f90e":"markdown","3e6dbc47":"markdown","44e38e30":"markdown","e8fa982a":"markdown","d61ab41e":"markdown","396a59c0":"markdown","9bb8e091":"markdown","4a5adba8":"markdown","9bed2cd0":"markdown","92923a36":"markdown","1c663331":"markdown","c9ac305c":"markdown","e37e5f30":"markdown","a89ad670":"markdown","83202efe":"markdown","778445fb":"markdown","7c2849f7":"markdown","02ddaf94":"markdown","32d301ec":"markdown","bf281a3b":"markdown","607c6f81":"markdown","e209c0df":"markdown","ffae12fb":"markdown","f5f45475":"markdown","dc95877b":"markdown","230e5cdb":"markdown","6e223ffb":"markdown","158401b3":"markdown","fee140c6":"markdown","25941e0f":"markdown","4c466d18":"markdown","c03e0e72":"markdown"},"source":{"811dcce1":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline","7f5cc00a":"df=pd.read_csv('..\/input\/house-prices-advanced-regression-techniques\/train.csv')\ndf","a06d1b3c":"df.columns","49d8b6b5":"with open('..\/input\/house-prices-advanced-regression-techniques\/data_description.txt', 'r') as f:\n    print(f.read())","2aa1e0f3":"df.shape","966b1226":"df.corr()['SalePrice'].sort_values()","74d18f11":"sns.scatterplot(data=df, x='OverallQual', y='SalePrice')\nplt.axhline(y=200000,color='r')","c75266d3":"df[(df['OverallQual']>8) &(df['SalePrice']<200000)][['SalePrice', 'OverallQual']]","6daf13c0":"sns.scatterplot(x='GrLivArea', y='SalePrice', data=df)\nplt.axhline(y=200000, color='r')\nplt.axvline(x=4000, color='r')","dec930cc":"df[(df['GrLivArea']>4000) & (df['SalePrice']<200000)][['SalePrice', 'GrLivArea']]","245fff00":"#Remove the outliers:\nindex_drop=df[(df['GrLivArea']>4000) & (df['SalePrice']<200000)].index\ndf=df.drop(index_drop, axis=0)","420129fb":"df.info()","f94b9797":"df= df.drop('Id', axis=1)","5793f313":"df.isnull().sum()","7fa999f1":"def missing_percent(df):\n    nan_percent= 100*(df.isnull().sum()\/len(df))\n    nan_percent= nan_percent[nan_percent>0].sort_values()\n    return nan_percent\n\npercentage = missing_percent(df)\npercentage","a6702fe9":"plt.figure(figsize=(12,6))\nsns.barplot(x=percentage.index, y=percentage)\nplt.xticks(rotation=90)","cf0b8cb3":"percentage[percentage<1]","897e9326":"df[df['Electrical'].isnull()][['Electrical']]","20d3b2e3":"df[df['MasVnrType'].isnull()][['MasVnrType']]","d9600a7e":"df[df['MasVnrArea'].isnull()][['MasVnrArea']]","945c917e":"df= df.dropna(axis=0, subset=['Electrical', 'MasVnrType', 'MasVnrArea'])","7903a702":"missing_percent(df)","bf537d88":"df['BsmtQual']= df['BsmtQual'].fillna('None')\ndf['BsmtCond']= df['BsmtCond'].fillna('None')\ndf['BsmtFinType1']= df['BsmtFinType1'].fillna('None')\ndf['BsmtExposure']= df['BsmtExposure'].fillna('None')\ndf['BsmtFinType2']= df['BsmtFinType2'].fillna('None')","d5eccaea":"missing_percent(df)","711c4ee1":"df['GarageType']= df['GarageType'].fillna('None')\ndf['GarageYrBlt']= df['GarageYrBlt'].fillna(0)\ndf['GarageFinish']= df['GarageFinish'].fillna('None')\ndf['GarageQual']= df['GarageQual'].fillna('None')\ndf['GarageCond']= df['GarageCond'].fillna('None')","e181c694":"missing_percent(df)","a741fbb0":"df= df.drop(['Fence', 'Alley', 'MiscFeature','PoolQC'], axis=1)","835ac4a5":"missing_percent(df)","951c9035":"df['FireplaceQu']= df['FireplaceQu'].fillna('None')","7dfe8b12":"missing_percent(df)","4d0a9e21":"plt.figure(figsize=(8,12))\nsns.boxplot(data=df, x='LotFrontage', y='Neighborhood')","fd62f14c":"df.groupby('Neighborhood')['LotFrontage'].mean()","9e61d4ee":"df['LotFrontage']=df.groupby('Neighborhood')['LotFrontage'].transform(lambda val: val.fillna(val.mean()))","eee3cac7":"missing_percent(df)","f5084d2e":"df.shape","21874533":"df = df.reset_index(drop = True)\ndf.tail(10)","808e6502":"df['MSSubClass']= df['MSSubClass'].apply(str)","7cfb8a77":"df_num= df.select_dtypes(exclude='object')\ndf_obj= df.select_dtypes(include='object')","2dadafd8":"df_obj.info()","1a1d5601":"df_obj= pd.get_dummies(df_obj)","dfc28fb7":"df_obj","00fdc02e":"df_num.info()","f9df0e0d":"df_num","50e82692":"y_train = df_num['SalePrice']\ndf_num = df_num.drop( ['SalePrice'] , axis=1)\ny_train","2c211819":"names_num = df_num.columns","4b799592":"from sklearn.preprocessing import StandardScaler\nscaler= StandardScaler()\nscaler.fit(df_num)\ndf_num = scaler.transform(df_num)\ndf_num = pd.DataFrame(df_num, columns= names_num)\ndf_num","ffe4d10b":"x_train= pd.concat([df_num, df_obj], axis=1)\nx_train","f5313a7a":"df_test=pd.read_csv('..\/input\/house-prices-advanced-regression-techniques\/test.csv')\ndf_test.shape","ef8c7798":"df_test.drop('Id', axis=1, inplace=True)\ndf_test.drop(['Fence', 'Alley', 'MiscFeature','PoolQC'], axis=1, inplace=True)\ndf_test['MSSubClass']= df_test['MSSubClass'].apply(str)\n\ndf_test","f73124fb":"df_test.isnull().sum()","8eeed523":"missing_percent(df_test)","23bb54c3":"df_test['BsmtQual']= df_test['BsmtQual'].fillna('None')\ndf_test['BsmtCond']= df_test['BsmtCond'].fillna('None')\ndf_test['BsmtFinType1']= df_test['BsmtFinType1'].fillna('None')\ndf_test['BsmtExposure']= df_test['BsmtExposure'].fillna('None')\ndf_test['BsmtFinType2']= df_test['BsmtFinType2'].fillna('None')\ndf_test['BsmtFinSF1']= df_test['BsmtFinSF1'].fillna(0)\ndf_test['BsmtFinSF2']= df_test['BsmtFinSF2'].fillna(0)\ndf_test['BsmtUnfSF']= df_test['BsmtUnfSF'].fillna(0)\ndf_test['BsmtFullBath']= df_test['BsmtFullBath'].fillna(0)\ndf_test['BsmtHalfBath']= df_test['BsmtHalfBath'].fillna(0)\ndf_test['TotalBsmtSF']= df_test['TotalBsmtSF'].fillna(0)","97790b64":"df_test['GarageType']= df_test['GarageType'].fillna('None')\ndf_test['GarageYrBlt']= df_test['GarageYrBlt'].fillna(0)\ndf_test['GarageFinish']= df_test['GarageFinish'].fillna('None')\ndf_test['GarageQual']= df_test['GarageQual'].fillna('None')\ndf_test['GarageCond']= df_test['GarageCond'].fillna(0)\ndf_test['GarageArea']= df_test['GarageArea'].fillna(0)\ndf_test['GarageCars']= df_test['GarageCars'].fillna(0)","3de233a2":"df_test['FireplaceQu']= df_test['FireplaceQu'].fillna('None')\ndf_test['LotFrontage']=df_test.groupby('Neighborhood')['LotFrontage'].transform(lambda val: val.fillna(val.mean()))","e396829a":"df_test['Electrical'] = df_test['Electrical'].fillna(df['Electrical'].mode()[0])\ndf_test['MasVnrType'] = df_test['MasVnrType'].fillna(df['MasVnrType'].mode()[0])\ndf_test['MasVnrArea'] = df_test['MasVnrArea'].fillna(df['MasVnrArea'].mode()[0])\ndf_test['Exterior1st'] = df_test['Exterior1st'].fillna(df['Exterior1st'].mode()[0])\ndf_test['Exterior2nd'] = df_test['Exterior2nd'].fillna(df['Exterior2nd'].mode()[0])\ndf_test['KitchenQual'] = df_test['KitchenQual'].fillna(df['KitchenQual'].mode()[0])\ndf_test['SaleType'] = df_test['SaleType'].fillna(df['SaleType'].mode()[0])\ndf_test['Utilities'] = df_test['Utilities'].fillna(df['Utilities'].mode()[0])\ndf_test['MSZoning'] = df_test['MSZoning'].fillna(df['MSZoning'].mode()[0])\ndf_test['Functional'] = df_test['Functional'].fillna(df['Functional'].mode()[0])","b5eba9f1":"missing_percent(df_test)","a0648ed7":"df_num_test= df_test.select_dtypes(exclude='object')\ndf_obj_test= df_test.select_dtypes(include='object')","96bdfe4a":"df_obj_test.info()","cc62afb4":"df_obj_test= pd.get_dummies(df_obj_test)","105476ef":"for i in df_obj_test.columns:\n    if i not in df_obj.columns:\n         df_obj_test = df_obj_test.drop(columns = i, axis=1)\n\ndf_obj_test = df_obj_test.reindex(columns = df_obj.columns, fill_value=0)","99676994":"df_obj_test","56faf943":"df_num_test.info()","3be244e6":"df_num_test = scaler.transform(df_num_test)\ndf_num_test = pd.DataFrame(df_num_test, columns= names_num)\ndf_num_test","5efee7ae":"x_test= pd.concat([df_num_test, df_obj_test], axis=1)\nx_test","44bd3294":"from sklearn.model_selection import train_test_split\nfrom sklearn.linear_model import LinearRegression\nlr=LinearRegression()\nlr.fit(x_train, y_train)","ec082e57":"y_pred=lr.predict(x_test)\ny_pred","4326a091":"y_test=pd.read_csv('..\/input\/house-prices-advanced-regression-techniques\/sample_submission.csv')\ny_test.shape","4e6bb69a":"y_test = y_test['SalePrice']\ny_test","57cdaa8f":"from sklearn import metrics\nMAE=metrics.mean_absolute_error(y_test,y_pred)\nMSE=metrics.mean_squared_error(y_test,y_pred)\nRMSE=np.sqrt(MSE)","0b2acef1":"pd.DataFrame(data=[MAE,MSE,RMSE],index=[\"MAE\",\"MSE\",\"RMSE\"],columns=[\"LinearRegression\"])","4a36b43f":"Let's look at the information about the basement:\n\nBsmtQual: Evaluates the height of the basement\n\n       Ex\tExcellent (100+ inches)\t\n       Gd\tGood (90-99 inches)\n       TA\tTypical (80-89 inches)\n       Fa\tFair (70-79 inches)\n       Po\tPoor (<70 inches\n       NA\tNo Basement\n\t\t\nBsmtCond: Evaluates the general condition of the basement\n\n       Ex\tExcellent\n       Gd\tGood\n       TA\tTypical - slight dampness allowed\n       Fa\tFair - dampness or some cracking or settling\n       Po\tPoor - Severe cracking, settling, or wetness\n       NA\tNo Basement\n\t\nBsmtFinType1: Rating of basement finished area\n\n       GLQ\tGood Living Quarters\n       ALQ\tAverage Living Quarters\n       BLQ\tBelow Average Living Quarters\t\n       Rec\tAverage Rec Room\n       LwQ\tLow Quality\n       Unf\tUnfinshed\n       NA\tNo Basement\n\t\t\nBsmtExposure: Refers to walkout or garden level walls\n\n       Gd\tGood Exposure\n       Av\tAverage Exposure (split levels or foyers typically score average or above)\t\n       Mn\tMimimum Exposure\n       No\tNo Exposure\n       NA\tNo Basement\n\t\t\nBsmtFinType2: Rating of basement finished area (if multiple types)\n\n       GLQ\tGood Living Quarters\n       ALQ\tAverage Living Quarters\n       BLQ\tBelow Average Living Quarters\t\n       Rec\tAverage Rec Room\n       LwQ\tLow Quality\n       Unf\tUnfinshed\n       NA\tNo Basement","8cd981b3":"Some data do not give us useful information. Like Id. So let's drop that:","cffc06a8":"MSSubClass: Identifies the type of dwelling involved in the sale.\t\n\n        20\t1-STORY 1946 & NEWER ALL STYLES\n        30\t1-STORY 1945 & OLDER\n        40\t1-STORY W\/FINISHED ATTIC ALL AGES\n        45\t1-1\/2 STORY - UNFINISHED ALL AGES\n        50\t1-1\/2 STORY FINISHED ALL AGES\n        60\t2-STORY 1946 & NEWER\n        70\t2-STORY 1945 & OLDER\n        75\t2-1\/2 STORY ALL AGES\n        80\tSPLIT OR MULTI-LEVEL\n        85\tSPLIT FOYER\n        90\tDUPLEX - ALL STYLES AND AGES\n       120\t1-STORY PUD (Planned Unit Development) - 1946 & NEWER\n       150\t1-1\/2 STORY PUD - ALL AGES\n       160\t2-STORY PUD - 1946 & NEWER\n       180\tPUD - MULTILEVEL - INCL SPLIT LEV\/FOYER\n       190\t2 FAMILY CONVERSION - ALL STYLES AND AGES\n\nSo we need to change it to string:","91f7389f":"Let's visualize the percentage of missing data on a graph:","0e687480":"### Numerical data (feature scaling)","0e353f76":"### Encoding:","81829fc8":"### Basement data: BsmtQual, BsmtCond, BsmtFinType1, BsmtExposure, BsmtFinType2","2a148913":"# Step 8: Building a model (Linear Regression)","11b5e76a":"We have 17.7% of missing data and we cannot just drop it. Lot frontage means the side of a lot abutting on a legally accessible street right-of-way other than an alley or an improved county road. We need to replace the Nan value with a suitable amount.\nLet's look if the lot frintage is corrolated with neighbourhood:","c18da914":"And now let's look at the ones with less than 1%.","e63a66f6":"Let's look at the information about the garage:","251c5930":"# Step 1: Importing the dataset and neccessary libraries","32c2aba8":"Let's do the encoding:","7ab25765":"We can see that the overall quality and then GrLivArea has the most corrolation with the sale price! Let's get a visual view of these two:","d999dacc":"# Step 7: Importing the test dataset and do the changes","45fbd32a":"How many missing data do we have?","9e4a850a":"### Categorical data (creating dummy variables)","3d5162e3":"# Step 3: Dealing with the missing data","2fba6c31":"We see that it is the same as before. So let's remove these 2 data from the dataset:","9d5e17c4":"As we can see in the information from the dataset we have:","c7aeb12c":"If we look at the data information we can see:\n\nMasVnrType: Masonry veneer type\n\n       BrkCmn\tBrick Common\n       BrkFace\tBrick Face\n       CBlock\tCinder Block\n       None\tNone\n       Stone\tStone","6a485000":"Finally we don't have any missing data!","bac5e3d9":"# Step 2: Getting to know the data","1845f90e":"As you can see, in overall quality of 10 we have 2 data that are for houses less than 200,000. This does not seem to be reasonable as they are too cheap for a house with the quality of 10. But let's analyze some more to be sure those are outliers.","3e6dbc47":"# Step 6: Merging the categorical and numerical values","44e38e30":"### Less than 1%: Electrical, MasVnrType, MasVnrArea","e8fa982a":"GarageType: Garage location\n\t\t\n       2Types\tMore than one type of garage\n       Attchd\tAttached to home\n       Basment\tBasement Garage\n       BuiltIn\tBuilt-In (Garage part of house - typically has room above garage)\n       CarPort\tCar Port\n       Detchd\tDetached from home\n       NA\tNo Garage\n\t\t\nGarageYrBlt: Year garage was built\n\t\t\nGarageFinish: Interior finish of the garage\n\n       Fin\tFinished\n       RFn\tRough Finished\t\n       Unf\tUnfinished\n       NA\tNo Garage\n\t\t\nGarageQual: Garage quality\n\n       Ex\tExcellent\n       Gd\tGood\n       TA\tTypical\/Average\n       Fa\tFair\n       Po\tPoor\n       NA\tNo Garage\n\t\t\nGarageCond: Garage condition\n\n       Ex\tExcellent\n       Gd\tGood\n       TA\tTypical\/Average\n       Fa\tFair\n       Po\tPoor\n       NA\tNo Garage","d61ab41e":"We have obviosly a low rate of missing values here, so we also drop them.","396a59c0":"### Remaining missing data: FireplaceQu","9bb8e091":"So the ones with null value have no Masonry veneer and this is not a missing data. We should replace it with None.","4a5adba8":"### Remaining missing data: LotFrontage ","9bed2cd0":"If we look at the data information we can see:\n\nMasVnrArea: Masonry veneer area in square feet","92923a36":"Let's see how many percent of each missing data is null:","1c663331":"It is just one row so we drop it.","c9ac305c":"We divide the categorical and numerical features to create dummy variables from the categorical ones:","e37e5f30":"So the Na values are not missing data, the house simply has no garage. We have to change them to None.","a89ad670":"## Dealing with the missing data:","83202efe":"For these qualities, the amount of valid data is very low. So we drop these columns:","778445fb":"As we can see from the information:\nFireplaceQu: Fireplace quality\n\n       Ex\tExcellent - Exceptional Masonry Fireplace\n       Gd\tGood - Masonry Fireplace in main level\n       TA\tAverage - Prefabricated Fireplace in main living area or Masonry Fireplace in basement\n       Fa\tFair - Prefabricated Fireplace in basement\n       Po\tPoor - Ben Franklin Stove\n       NA\tNo Fireplace\nSo the Na values are not missing data, the house simply has no fireplace. We have to change them to None.","7c2849f7":"So the Na values are not missing data, the house simply has no basement. We have to change them to None.","02ddaf94":"We can substitue the missing value with the mean of lot frontage in each neighbourhood:","32d301ec":"As you can see we have 248 columns. We need to make the columns like the columns of train dataset. We remove the columns which have extra amounts that do not exist in the train dataset:","bf281a3b":"Now, let's look at the Nan values.","607c6f81":"### More than 80%: Fence, Alley, Miscfeature, PoolQC","e209c0df":"### Garage data: GarageCond, GarageQual, GarageFinish, GarageType, GarageYrBlt","ffae12fb":"The Ames Housing dataset is a famous dataset to exersice the regression models using machine learning. With 79 explanatory variables describing (almost) every aspect of residential homes in Ames, Iowa, the challenges is to predict the final price of each home.","f5f45475":"We need to feature scale the numerical data:","dc95877b":"We do every change we did on the train dataset, inclusing deleting some columns and changing the MSSubClass to str.","230e5cdb":"### Numerical Columns to Categorical\nWe need to be careful when it comes to encoding categorical as numbers. We want to make sure that the numerical relationship makes sense for model. For example, the encoding MSSubClass is essentially just a code per class:","6e223ffb":"If we look at the data information:\nElectrical: Electrical system\n\n       SBrkr\tStandard Circuit Breakers & Romex\n       FuseA\tFuse Box over 60 AMP and all Romex wiring (Average)\t\n       FuseF\t60 AMP Fuse Box and mostly Romex wiring (Fair)\n       FuseP\t60 AMP Fuse Box and mostly knob & tube wiring (poor)\n       Mix\tMixed","158401b3":"### Merging the categorical and numerical data","fee140c6":"# Step 5: Numerical data (feature scaling)","25941e0f":"### Nan-values","4c466d18":"# Step 4: Categorical data","c03e0e72":"GrLivArea is above grade (ground) living area square feet. If the house is bigger than 4000 and the sales price is less than 200,000, this is definately something unusual and it can be an outlier."}}