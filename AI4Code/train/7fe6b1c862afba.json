{"cell_type":{"c055a8ed":"code","68501986":"code","195ce5c4":"code","1da22f57":"code","cca408b5":"code","1810b62c":"code","c8dc5f18":"code","06782875":"code","4ae886a5":"code","94eea2a2":"code","02d783b7":"code","dc788eff":"code","a243bbe7":"code","202cdee3":"code","08855fea":"code","299c3856":"code","2bf1517b":"code","ce144201":"code","0bf9abaf":"code","aef47d31":"code","e946c7a4":"code","9b2ca33a":"code","110161a8":"code","ee51b4cc":"code","0153f8e7":"code","d6011250":"code","cbca60d6":"markdown"},"source":{"c055a8ed":"from fastai.vision import *\nimport os","68501986":"os.makedirs('\/root\/.cache\/torch\/checkpoints')","195ce5c4":"!cp ..\/input\/resnet34fastai\/resnet34.pth \/root\/.cache\/torch\/checkpoints\/resnet34-333f7ec4.pth","1da22f57":"model_path = 'models'\nplot_path = 'plots'\n\nif not os.path.exists(model_path):\n    os.makedirs(model_path)\n    os.makedirs(os.path.join(model_path, plot_path))","cca408b5":"'''\nSeverity Levels\n\n0 - 'No_DR',\n1 - 'Mild',\n2 - 'Moderate',\n3 - 'Severe',\n4 - 'Proliferate_DR'\n'''\n\nclasses = ['No_DR', 'Mild', 'Moderate', 'Severe', 'Proliferate_DR']","1810b62c":"path = Path('..\/input\/diabetic-retinopathy-224x224-2019-data\/colored_images')\npath.ls()","c8dc5f18":"# remove the images that we cannot open\n# for c in classes:\n#     print(c)\n#     verify_images(path\/c, delete=True, max_size=500)","06782875":"np.random.seed(42)\ndata = ImageDataBunch.from_folder(path, train='.', valid_pct=0.2, \n                                  ds_tfms=get_transforms(), size=224, \n                                  num_workers=4, bs=32).normalize(imagenet_stats)","4ae886a5":"data.classes","94eea2a2":"data.show_batch(rows=3, figsize=(10, 7))","02d783b7":"data.classes, data.c, len(data.train_ds), len(data.valid_ds)","dc788eff":"learn = cnn_learner(data, models.resnet34, metrics=error_rate, model_dir='\/kaggle\/working\/models')\n# learner = load('..\/input\/resnet34-fastai\/resnet34.pth')\n# learn = cnn_learner(data, learner, metrics=error_rate)","a243bbe7":"learn.fit_one_cycle(20)    ","202cdee3":"learn.recorder.plot_losses()","08855fea":"!pwd\nprint(os.listdir('..\/..\/'))","299c3856":"learn.save('colored_stage1')","2bf1517b":"learn.unfreeze()","ce144201":"learn.lr_find()","0bf9abaf":"learn.recorder.plot()","aef47d31":"learn.fit_one_cycle(3, max_lr=slice(1e-6, 1e-5))","e946c7a4":"learn.save('colored_stage2')","9b2ca33a":"learn.load('colored_stage2')","110161a8":"interp = ClassificationInterpretation.from_learner(learn)","ee51b4cc":"interp.plot_confusion_matrix()","0153f8e7":"!pwd","d6011250":"learn.export('\/kaggle\/working\/models\/colored_export.pkl')","cbca60d6":"## 1) Introduction\n* This kernel trains a ResNet34 model on the colored images of Diabetic Retinopathy dataset. All the intermediate models, and the final model is being exported. \n* You can either download the final model or use it in your own kernels as well."}}