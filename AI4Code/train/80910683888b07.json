{"cell_type":{"b8e7ac49":"code","745e5cca":"code","f357414b":"code","a794b35b":"code","8189bf2a":"code","90ae03c4":"code","9200ac7d":"code","8d64b2db":"code","1c0acefa":"code","0b4f2292":"code","f53da067":"code","24391f35":"code","dbb48a32":"code","94abcea0":"code","8ea9ed63":"code","106e4a31":"code","62081847":"code","a716cfda":"code","979d1281":"code","9a358949":"code","20a6a9d5":"code","5abbb026":"code","58e47ffe":"code","54c21fd1":"code","6d390057":"code","2eabee8e":"code","7a276153":"code","0da3f3e1":"code","159aa7fc":"code","026374ea":"code","1357005e":"code","2bf3318e":"code","6899a5da":"code","b011da6a":"code","18402633":"code","4c50a169":"code","e4d684d1":"code","13cc3cdf":"code","df85f972":"code","6d832adc":"code","33a757bf":"code","0cd03bc7":"code","8ad5f6b3":"code","cb1fd9de":"code","88131a96":"code","255286ae":"code","4f8859b2":"code","627d4846":"code","aba05d3c":"code","18f3569f":"code","e00f65ba":"code","dae7e7b1":"code","a1d1e467":"code","3af3a8f0":"code","2acd066f":"code","7de07fb8":"code","6c133266":"code","d66ccd56":"code","91042238":"code","1d548a35":"code","0d6ac8c3":"markdown","250fe903":"markdown","49be898c":"markdown","87f72207":"markdown","62e79570":"markdown","7d84d120":"markdown","90ca9913":"markdown","4ec52a7b":"markdown","4ea6f560":"markdown","9565f329":"markdown","88d1bfa3":"markdown","ff4b46c1":"markdown","3709416a":"markdown","e4ae2e53":"markdown","302404d1":"markdown","cf1d132c":"markdown","71c89081":"markdown","3f48cc12":"markdown","cc2ff794":"markdown","d7d1efdd":"markdown","42acd413":"markdown","f745456b":"markdown","00b7326b":"markdown","ad4cf520":"markdown","0b6f6fd1":"markdown","0a20542b":"markdown","fd4f4b1a":"markdown"},"source":{"b8e7ac49":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\nfrom sklearn.metrics import mean_squared_error, mean_absolute_error, r2_score, explained_variance_score\nimport xgboost\nfrom sklearn.model_selection import RandomizedSearchCV\nfrom sklearn.model_selection import train_test_split\n\nimport folium\nfrom folium import plugins\nfrom folium.plugins import HeatMap, FastMarkerCluster\n\n%matplotlib inline\nsns.set_style('whitegrid')\nsns.set_context('paper', font_scale=1.5)","745e5cca":"df2 = pd.read_csv('..\/input\/house-prices-in-poland\/Houses.csv', encoding='ISO-8859-2', index_col=0)","f357414b":"df2.info()","a794b35b":"df2.describe().transpose()","8189bf2a":"df3 = df2.copy()\n\n# create new column,which tells us: what is the price per square meter?\ndf3['price_per_sqmeter'] = df3['price'] \/ df3['sq']\ndf3.head()","90ae03c4":"df4 = df3\n\n# create new column, which tells us: how many square meters per room?\ndf4['sqm_per_room'] = df4['sq'] \/ df4['rooms']\ndf4.head()","9200ac7d":"## sq\ndf4.sort_values('sq')","8d64b2db":"# Create list of rows with mistakenly sq value\nout_sq = df4[(df4['sq'] > 450) | (df4['sq'] < 10)].index.tolist()\n\n# Remove \ndf4 = df4.drop(out_sq)","1c0acefa":"## year\ndf4.sort_values('year')","0b4f2292":"# Create list of rows with mistakenly year value\nout_year = df4[(df4['year'] > 2024) | (df4['year'] < 1200)].index.tolist()\n\n# Remove \ndf4 = df4.drop(out_year)","f53da067":"## sqm_per_room\ndf4.sort_values('sqm_per_room', ascending = True)","24391f35":"# mean sqm_per_room\ndf4['sqm_per_room'].mean()","dbb48a32":"# How many rows are there more square meters per room than 51?\nlen(df4[df4['sqm_per_room'] > 51])","94abcea0":"# How many rows are there less square meters per room than 10?\nlen(df4[df4['sqm_per_room'] < 10])","8ea9ed63":"# Create a list of these rows\nout_sqm_per_room = df4[(df4['sqm_per_room'] > 51) | (df4['sqm_per_room'] < 10)].index.tolist()\n\n# Remove \ndf5 = df4.drop(out_sqm_per_room)","106e4a31":"## price_per_sqmeter\ndf5.sort_values('price_per_sqmeter')","62081847":"df5[(df5['price_per_sqmeter'] > 58000.0) | (df5['price_per_sqmeter'] < 2000.0)]","a716cfda":"# Create a list of rows where price_per_sqmeter > 58k and price_per_sqmeter < 2k\nout_price_per_sqmeter = df5[(df5['price_per_sqmeter'] > 58000.0) | (df5['price_per_sqmeter'] < 2000.0)].index.tolist()\nout_price_per_sqmeter","979d1281":"# remove these rows\ndf5 = df5.drop(out_price_per_sqmeter)","9a358949":"df5.describe().transpose()","20a6a9d5":"# Count of sales announcement in a given city\nplt.figure(figsize=(12,6))\nsns.countplot(x = 'city', data = df5, \n              order = ['Warszawa', 'Krak\u00f3w', \n                       'Pozna\u0144']).set_title(\"Count of sales announcement in a given city\")","5abbb026":"# Histogram of price per square meter\nplt.figure(figsize=(12,6))\ng = sns.histplot(x = 'price_per_sqmeter', data = df5, bins = 25, color = 'tomato', \n                 kde = True)\ng.set(xlim=(0, None))\ng.set_title('Histogram of price per square meter')","58e47ffe":"# Histogram of an apartments prices closer look\nplt.figure(figsize=(12,6))\nplt.ticklabel_format(style='plain', axis='x')\ng = sns.histplot(x = 'price', data = df5[df5['price'] < 2000000], bins = 50, color = 'tomato', \n                 kde = True)\ng.set(xlim=(0, None))\ng.set_title('Histogram of an apartments prices')","54c21fd1":"# Histogram of price per square meter in Pozna\u0144\nplt.figure(figsize=(12,6))\ng = sns.histplot(x = 'price_per_sqmeter', data = df5[df5['city'] == \"Pozna\u0144\"], bins = 25, color = 'green', \n                 kde = True)\ng.set(xlim=(0, None))\ng.set_title('Histogram of price per square meter in Pozna\u0144')","6d390057":"# Histogram of an apartments prices in Pozna\u0144\nplt.figure(figsize=(12,6))\ng = sns.histplot(x = 'price', data = df5[df5['city'] == \"Pozna\u0144\"], bins = 25, color = 'green', \n                 kde = True)\ng.set(xlim=(0, None))\ng.set_title('Histogram of an apartments prices in Pozna\u0144')\nplt.ticklabel_format(style='plain', axis='x')","2eabee8e":"# Histogram of price per square meter in Warszawa\nplt.figure(figsize=(12,6))\ng = sns.histplot(x = 'price_per_sqmeter', data = df5[df5['city'] == \"Warszawa\"], bins = 25, color = 'blue', \n                 kde = True)\ng.set(xlim=(0, None))\ng.set_title('Histogram of price per square meter in Warszawa')","7a276153":"# Histogram of an apartments prices in Warszawa\nplt.figure(figsize=(12,6))\n\ng = sns.histplot(x = 'price', data = df5[df5['city'] == \"Warszawa\"], bins = 40, color = 'blue', \n                 kde = True)\n\ng.set(xlim=(0, None))\ng.set_title('Histogram of an apartments prices in Warszawa')\nplt.ticklabel_format(style='plain', axis='x')","0da3f3e1":"# Histogram of an apartments prices in Warszawa closer look\nplt.figure(figsize=(12,6))\n\ng = sns.histplot(x = 'price', data = df5[(df5['city'] == \"Warszawa\") & (df5['price'] < 2000000)], \n                 bins = 20, color = 'blue', kde = True)\n\ng.set(xlim=(0, None))\ng.set_title('Histogram of an apartments prices in Warszawa')\nplt.ticklabel_format(style='plain', axis='x')","159aa7fc":"# Count of price per square meter in Krak\u00f3w\nplt.figure(figsize=(12,6))\ng = sns.histplot(x = 'price_per_sqmeter', data = df5[df5['city'] == \"Krak\u00f3w\"], bins = 25, color = 'orange',\n                kde = True)\ng.set(xlim=(0, None))\ng.set_title('Count of price per square meter in Krak\u00f3w')","026374ea":"# Histogram of an apartments prices in Krak\u00f3w\nplt.figure(figsize=(12,6))\n\ng = sns.histplot(x = 'price', data = df5[df5['city'] == \"Krak\u00f3w\"], bins = 40, color = 'orange', \n                 kde = True)\n\ng.set(xlim=(0, None))\ng.set_title('Histogram of an apartments prices in Krak\u00f3w')\nplt.ticklabel_format(style='plain', axis='x')","1357005e":"# Histogram of an apartments prices in Krak\u00f3w closer look\nplt.figure(figsize=(12,6))\n\ng = sns.histplot(x = 'price', data = df5[(df5['city'] == \"Krak\u00f3w\") & (df5['price'] < 2000000)], \n                 bins = 20, color = 'orange', kde = True)\n\ng.set(xlim=(0, None))\ng.set_title('Histogram of an apartments prices in Krak\u00f3w')\nplt.ticklabel_format(style='plain', axis='x')","2bf3318e":"# Scatter plot of The size of the apartment [sqm] vs price'\nplt.figure(figsize=(12,6))\nplt.ticklabel_format(style='plain', axis='y')\ng = sns.scatterplot(x = 'sq', y = 'price', data = df5, hue = 'city', \n                    hue_order = ['Warszawa', 'Krak\u00f3w', 'Pozna\u0144'])\ng.set_title('The size of the apartment [sqm] vs price')","6899a5da":"# Scatter plot The size of the apartment [sqm] vs price Pozna\u0144\nplt.figure(figsize=(12,6))\nplt.ticklabel_format(style='plain', axis='y')\n\ng = sns.scatterplot(x='sq', y= 'price', data = df5[df5['city'] == \"Pozna\u0144\"], color = 'green')\ng.set_title('The size of the apartment [sqm] vs price Pozna\u0144')","b011da6a":"# Scatter plot The size of the apartment [sqm] vs price Warszawa\nplt.figure(figsize=(12,6))\nplt.ticklabel_format(style='plain', axis='y')\n\ng = sns.scatterplot(x='sq', y= 'price', data = df5[df5['city'] == \"Warszawa\"], color = 'blue')\ng.set_title('The size of the apartment [sqm] vs price Warszawa')","18402633":"# Scatter plot The size of the apartment [sqm] vs price Krak\u00f3w\nplt.figure(figsize=(12,6))\nplt.ticklabel_format(style='plain', axis='y')\n\ng = sns.scatterplot(x='sq', y= 'price', data = df5[df5['city'] == \"Krak\u00f3w\"], color = 'orange')\ng.set_title('The size of the apartment [sqm] vs price Krak\u00f3w')","4c50a169":"# Correlation heatmap\nplt.figure(figsize=(14,12))\nsns.set_context('paper', font_scale=2)\n\ncorr= df5.corr()\n# Generate a mask for the upper triangle\nmask = np.triu(np.ones_like(corr, dtype=bool))\nsns.heatmap(corr, annot=True, cmap='Blues', mask=mask)","e4d684d1":"# Count of sales announcements by number of rooms in the apartment'\nplt.figure(figsize=(12,6))\nsns.countplot(x = 'rooms', hue_order = ['Warszawa', 'Krak\u00f3w', 'Pozna\u0144'],\n              data = df5, \n              hue = 'city').set_title('Count of sales announcements by number of rooms in the apartment')","13cc3cdf":"# Strip plot Price vs Rooms\nplt.figure(figsize=(12,8))\nplt.ticklabel_format(style='plain', axis='y')\nsns.stripplot(x = 'rooms', data = df5, y = 'price', hue = 'city', jitter=True,\n             hue_order = ['Warszawa', 'Krak\u00f3w', 'Pozna\u0144'], dodge = True).set_title('Price vs Rooms')","df85f972":"# Box plots Price vs year of building\nplt.figure(figsize=(24,12))\nplt.ticklabel_format(style='plain', axis='y')\nplt.xticks(fontsize=8, rotation=90)\ng = sns.boxplot(x = 'year', data = df5, y = 'price', \n                palette = 'rocket_r').set_title('Price vs year of building')","6d832adc":"df5[df5['year'] >= 2021].describe().transpose()","33a757bf":"# Heatmap Pozna\u0144\n\n# list of all latitude \npzn_lat = df5[df5['city'] == \"Pozna\u0144\"].latitude.tolist()\n# list of all longitude \npzn_lng = df5[df5['city'] == \"Pozna\u0144\"].longitude.tolist()\n# matrix of all [[latitude,longitude], ...[]]\npzn_data = np.column_stack((pzn_lat, pzn_lng))\n\nm = folium.Map(location=[52.4127903, 16.9222533], zoom_start=12, tiles=\"Stamen Terrain\")\n\nHeatMap(pzn_data).add_to(folium.FeatureGroup(name='Heat Map').add_to(m))\nfolium.LayerControl().add_to(m)\n\nm","0cd03bc7":"# Heatmap Warszawa\n\n# list of all latitude \nwaw_lat = df5[df5['city'] == \"Warszawa\"].latitude.tolist()\n# list of all longitude \nwaw_lng = df5[df5['city'] == \"Warszawa\"].longitude.tolist()\n# matrix of all [[latitude,longitude], ...[]]\nwaw_data = np.column_stack((waw_lat, waw_lng))\n\nm = folium.Map(location=[52.235, 21.035], zoom_start=11, tiles=\"Stamen Terrain\")\n\nHeatMap(waw_data).add_to(folium.FeatureGroup(name='Heat Map').add_to(m))\nfolium.LayerControl().add_to(m)\n\nm","8ad5f6b3":"# Heatmap Krak\u00f3w\n\n# list of all latitude \nkrk_lat = df5[df5['city'] == \"Krak\u00f3w\"].latitude.tolist()\n# list of all longitude \nkrk_lng = df5[df5['city'] == \"Krak\u00f3w\"].longitude.tolist()\n# matrix of all [[latitude,longitude], ...[]]\nkrk_data = np.column_stack((krk_lat, krk_lng))\n\nm = folium.Map(location=[50.063367, 19.935186], zoom_start=12, tiles=\"Stamen Terrain\")\n\nHeatMap(krk_data).add_to(folium.FeatureGroup(name='Heat Map').add_to(m))\nfolium.LayerControl().add_to(m)\n\nm","cb1fd9de":"df5.info()","88131a96":"# one hot encoding on city\ndf6 = pd.get_dummies(df5, columns = ['city'])\ndf6.info()","255286ae":"# setting X with columns important to the model and y\nX = df6.drop(['address', 'id', 'latitude', 'longitude', 'price', 'price_per_sqmeter', 'sqm_per_room'], axis =1)\ny = df6['price']","4f8859b2":"X.info()","627d4846":"# train test split\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=42)","aba05d3c":"# xgboost \nregressor=xgboost.XGBRegressor()","18f3569f":"## Hyper Parameter Optimization\n\nn_estimators = [100, 500, 900, 1100, 1500]\nmax_depth = [2, 3, 5, 10, 15]\nbooster=['gbtree','gblinear']\nlearning_rate=[0.05,0.1,0.15,0.20]\nmin_child_weight=[1,2,3,4]\nbase_score=[0.25,0.5,0.75,1]\n\n# Define the grid of hyperparameters to search\nhyperparameter_grid = {\n    'n_estimators': n_estimators,\n    'max_depth':max_depth,\n    'learning_rate':learning_rate,\n    'min_child_weight':min_child_weight,\n    'booster':booster,\n    'base_score':base_score\n    }","e00f65ba":"# Set up the random search with 4-fold cross validation\n\nrandom_cv = RandomizedSearchCV(estimator=regressor,\n            param_distributions=hyperparameter_grid,\n            cv=5, n_iter=50,\n            scoring = 'neg_mean_absolute_error',n_jobs = 4,\n            verbose = 5, \n            return_train_score = True,\n            random_state=42)","dae7e7b1":"# fit the train data\n# random_cv.fit(X_train, y_train)","a1d1e467":"# checking best estimator\n# random_cv.best_estimator_","3af3a8f0":"# define regressor with the best estimator\nregressor = xgboost.XGBRegressor(base_score=1, booster='gbtree', colsample_bylevel=1,\n             colsample_bynode=1, colsample_bytree=1, gamma=0, gpu_id=-1,\n             importance_type='gain', interaction_constraints='',\n             learning_rate=0.1, max_delta_step=0, max_depth=15,\n             min_child_weight=1, missing=None, monotone_constraints='()',\n             n_estimators=900, n_jobs=4, num_parallel_tree=1, random_state=0,\n             reg_alpha=0, reg_lambda=1, scale_pos_weight=1, subsample=1,\n             tree_method='exact', validate_parameters=1, verbosity=None)","2acd066f":"# fit the train data\nregressor.fit(X_train, y_train)","7de07fb8":"# predict the price for test data\ny_pred =regressor.predict(X_test)","6c133266":"print(\"\\tModel Evaluation\")\nprint('\\n')\nprint('mean_absolute_error:')\nprint(mean_absolute_error(y_test, y_pred))\nprint('\\n')\nprint('sqrt mean_squared_error:')\nprint(np.sqrt(mean_squared_error(y_test,y_pred)))\nprint('\\n')\nprint('r2_score:')\nprint(r2_score(y_test,y_pred))\nprint('\\n')\nprint('explained_variance_score:')\nprint(explained_variance_score(y_test,y_pred))","d66ccd56":"# Our predictions\nplt.figure(figsize=(12,8))\nplt.scatter(y_test,y_pred)\n\n# Perfect predictions\nline = plt.plot(y_test,y_test,'r')\n\n# labels\nplt.xlabel('True Price')\nplt.ylabel('Predicted Price')\nplt.title('True Price vs Predicted Price')\nplt.legend(line, ['Perfect Predictions']);","91042238":"# mean price for a apartment\ndf5['price'].mean()","1d548a35":"# MAE * 100 \/ (mean price for a apartment)\nmean_absolute_error(y_test, y_pred) * 100 \/ df5['price'].mean()\n\n# we off by around 13,7 %","0d6ac8c3":"<span id = \"7\"><\/span>\n# Model Evaluation","250fe903":"<p>In Warsaw, the average price per square meter is PLN 12.000.<\/p>","49be898c":"<p>Finally, let's look at the average values referring only to apartments from 2021 or newer.<\/p>\n<p>We can say that the average price of a flat is PLN 546.000. It is a three-room apartment on the 3rd floor with an area of approximately 56 square meters.<\/p>","87f72207":"<p>When it comes to the price of an apartment, in Cracow we have to pay an average of PLN 590.000.<\/p>","62e79570":"<span id = \"3\"><\/span>\n# Feature Engineering and Data Cleaning","7d84d120":"<p>The average price for an apartment, taking three cities into account, is PLN 641.818.<\/p>","90ca9913":"<span id = \"3.1\"><\/span>\n#### Feature Engineering","4ec52a7b":"<span id = \"4\"><\/span>\n# EDA","4ea6f560":"<p>In Pozna\u0144, the average price per square meter is PLN 8.500.<\/p>\n<p>However, it can be noticed that in most of the sale announcements it is around PLN 7.500.<\/p>","9565f329":"<p>In the chart above, we can see that in each of the three cities, ads for two and three-room apartments have an advantage.<\/p>","88d1bfa3":"<p>Take a look at the heatmap correlation. The most positive correlation is shown by the following \nvariables: the number of square meters and the number of rooms in an apartment. \nWhich makes sense, because the more rooms, the bigger the apartment is.<\/p>\n\n<p>The second variable that strongly correlates with the number of square meters is the price, \nwhich also makes sense, because the larger the apartment, the greater its price. \nThis has also been shown to us by scatter plots.<\/p>","ff4b46c1":"<p>When it comes to the price of an apartment, in Warsaw we have to pay an average of PLN 766.000.<\/p>\n<p>However, it can be noticed that in most of the sale announcements it is around PLN 450,000 - 550.000 for apartment.<\/p>","3709416a":"<p>How does it look like in Warsaw?<\/p>","e4ae2e53":"<p>How do these prices look for individual cities?<\/p>","302404d1":"# Contents\n\n[1. The Data](#1)\n\n[2. Imports](#2)\n\n[3. Feature Engineering and Data Cleaning](#3)\n\n&emsp; [3.1. Feature Engineering](#3.1) <br>\n&emsp; [3.2. Outliers removal](#3.2)\n\n\n[4. Exploratory Data Analysis](#4)\n\n[5. Apartments Location Heatmap](#5)\n\n[6. Regression Model](#6)\n\n[7. Model Evaluation](#7)","cf1d132c":"<p>In Krakow, the average price per square meter is PLN 10.000.\nHowever, it can be noticed that in most of the sale announcements it is around PLN 8.000.<\/p>","71c89081":"<span id = \"5\"><\/span>\n# Apartments Location Heatmap","3f48cc12":"<p>How does it look like in Cracow?<\/p>","cc2ff794":"<p>The graph shows the price vs the year of the building \/ apartment.\nThe oldest apartment is from 1390, probably in an old tenement house. The newest apartment is 2024, so it is probably planned to be built, but it is already possible to buy it. The average year of a building \/ apartment from all advertisements is 2001.<\/p>\n<p>We can also notice that in newer flats in the 1995-2024 range, there are many outliers. It is probably related to previously mentioned exclusive apartments.<\/p>","d7d1efdd":"<p>In total, in the three cities we have a little less than 24,000 housing ads.\nWarsaw and Krakow are on a similar level with slightly less than 10,000 ads per city. Pozna\u0144 has around 4,000 ads.<\/p>","42acd413":"<p>The chart above shows the price of flats in relation to the number of rooms.<\/p>\n<p>We know that most of the ads are two or three-room apartments.\nWe can notice that their price, similarly to the other values of the number of rooms, is about PLN 500.000.<\/p>","f745456b":"<span id = \"2\"><\/span>\n# Imports","00b7326b":"<p>The average price per square meter, taking into account the three cities, is PLN 10.735.<\/p>","ad4cf520":"<span id = \"3.2\"><\/span>\n#### Outliers Removal ","0b6f6fd1":"<p>When it comes to the price of an apartment, in Pozna\u0144 we have to pay an average of PLN 467.000.<\/p>","0a20542b":"<span id = \"6\"><\/span>\n# Regression Model","fd4f4b1a":"<p>On the above scatter plots we can see regressions. As the size of the apartment increases, so does its price.<\/p>\n\n<p>We can still notice outliers in each of the cities. They are often more exclusive flats, where, despite similar parameters, the flat can be in a very convenient location with very good modern equipment.<\/p>"}}