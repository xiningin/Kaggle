{"cell_type":{"dfd5f988":"code","e758deda":"code","e599abe7":"code","b74b73f0":"code","a42d73b6":"code","4d846d13":"code","46aa030c":"code","cc393d62":"code","a812794e":"code","95c66144":"code","f264f3fd":"code","871a7827":"code","7ee00147":"markdown","07d67ca7":"markdown","033edf03":"markdown","cba2b54d":"markdown","caa9a689":"markdown","2fa5ff34":"markdown"},"source":{"dfd5f988":"\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport glob\nimport json\nimport re\nimport scipy as sc\nimport warnings\n\nimport matplotlib.pyplot as plt\nimport os\n\n","e758deda":"root_path = '\/kaggle\/input\/CORD-19-research-challenge\/'\nmetadata_path = f'{root_path}\/metadata.csv'\nmeta_df = pd.read_csv(metadata_path, dtype={\n    'pubmed_id': str,\n    'Microsoft Academic Paper ID': str, \n    'doi': str\n})\nmeta_df.head()\nmeta_df.info()","e599abe7":"meta_df.head()\n","b74b73f0":"df=pd.read_csv('..\/input\/covid19prepareddata\/Prepared_data.csv')\ndf.head()\ndf.info()","a42d73b6":"task1=\"\"\"Specifically, we want to know what the literature reports about:\n\nWhat do we know about viral shedding in stool?\nWhat do we know about viral shedding nasopharynx?\nWhat do we know about viral shedding in urine?\nWhat do we know about viral shedding in blood?\nHow does the virus persist on inanimate surfaces?\nHow long can other HCoV strains remain viable on common surfaces_\nPersistence of virus on surfaces of different materials\nAdhesion to hydrophilic_phobic surfaces\nCoronavirus susceptibility to heat light and radiation\nSusceptibility to environmental cleaning agents\nDecontamination based on physical science\"\"\"","4d846d13":"task=[task1]\nquery=[]\nfor i in range(len(task)):\n    task[i]=task[i].split(\"\\n\")\n    query.append(task[i][2:])\nprint(query)","46aa030c":"!pip install -U sentence-transformers","cc393d62":"from sklearn.metrics.pairwise import cosine_similarity\nfrom sentence_transformers import SentenceTransformer\n\nwarnings.filterwarnings(\"ignore\")\nmodel = SentenceTransformer('bert-base-nli-mean-tokens')\n    ","a812794e":"query_embeddings=[]\nfor i in range(len(query)):\n    query_embeddings.append(model.encode(query[i]))","95c66144":"df.reset_index(drop = True, inplace = True)\ndf['abstract_summary']\nabstract_summary_embeddings = model.encode(df['abstract_summary'])\n","f264f3fd":"def getfile_insensitive(path):\n    directory, filename = os.path.split(path)\n    directory, filename = (directory or '.'), filename.lower()\n    for f in os.listdir(directory):\n        newpath = os.path.join(directory, f)\n        if os.path.isfile(newpath) and f.lower() == filename:\n            return newpath\n\ndef isfile_insensitive(path):\n    return getfile_insensitive(path) is not None\n\nsample_document='5_materials'\n","871a7827":"scores=[]\ndef formatting(_topdf):\n    _topdf.rename(columns={'journal':'Journal'},inplace=True)\n    _topdf.rename(columns={'url':'Study Link'},inplace=True)\n    _topdf.rename(columns={'publish_time':'Date'},inplace=True)\n    _topdf.rename(columns={'title':'Study'},inplace=True)\n    \n    return _topdf\nfor tsk in range(len(task)):\n    \n    for prob, query_embedding in zip(query[tsk], query_embeddings[tsk]):\n        dis = sc.spatial.distance.cdist([query_embedding], abstract_summary_embeddings, \"cosine\")[0]\n        #print(dis)\n        results = zip(range(len(dis)), dis)\n        results = sorted(results, key=lambda x: x[1])\n        #print(\"Query:\", prob)\n        #print(\"Answer:\" )\n        scores.append(1-results[0][1])\n        #print(df['abstract'][results[0][0]].strip(), \"\\n(Score: %.4f)\" % (1-results[0][1]),\"\\n\")\n        k=50\n        #print(results[:k])\n        topk=results[:k]\n        id,id_v=zip(*topk)\n        topData=df.iloc[1]\n        _topdf = df.iloc[list(id), :]\n        _topdf = formatting(_topdf)\n        csv_str=prob.replace('?','_')+'.csv'\n        #print(csv_str)\n        path1 = f'{root_path}Kaggle\/target_tables\/{sample_document}\/'+csv_str\n        path1 = f'{path1}'\n        print(path1)\n        if (isfile_insensitive(path1)):\n            path1=getfile_insensitive(path1)\n            q_df = pd.read_csv(path1)\n            print(\"exist!\")\n        else:      \n            path1 = f'{root_path}Kaggle\/target_tables\/{sample_document}\/'\n            path1 = os.path.join(path1,os.listdir(path1)[-1])\n            q_df = pd.read_csv(path1)\n            q_df.drop(q_df.index,inplace=True)\n        #print(path1)\n        q_df.head()\n        q_df\n        #print(len(q_df))\n        #print(len(_topdf))\n        #print(q_df.columns)\n        res_df = pd.merge(q_df, _topdf, how='outer', on=['Study','Study Link','Date','Journal'])[q_df.columns[1:]]\n        #print(len(res_df))\n        res_df.info()\n        res_csv=r'\/kaggle\/output\/'+ csv_str\n        print(res_csv)\n        res_df.to_csv( csv_str, index = True)","7ee00147":"Specifically, we want to know what the literature reports about:\n\n- What do we know about viral shedding in stool?\n- What do we know about viral shedding nasopharynx?\n- What do we know about viral shedding in urine?\n- What do we know about viral shedding in blood?\n- How does the virus persist on inanimate surfaces?\n- How long can the virus remain viable on surfaces?\n- Persistence on different materials\n- Adhesion to hydrophilic\/phobic surfaces\n- Susceptibility to environmental cleaning agents\n- Decontamination based on physical science","07d67ca7":"# Prepare data","033edf03":"# Get data from Prepared data. This data is created in another notebook in kaggle I made.\n\nCite:\nhttps:\/\/www.kaggle.com\/nike0good\/population-studies-that-related-to-covid-19","cba2b54d":"@inproceedings{Population studies that related to COVID-19, author = {Hang, Wu}, title = {Population studies that related to COVID-19}, year = {2020}, month = {June}, url = {\\url{https:\/\/www.kaggle.com\/nike0good\/population-studies-that-related-to-covid-19} } }","caa9a689":"# This is a notebook that address material studies related to COVID-19","2fa5ff34":"# Check the keywords of the problems."}}