{"cell_type":{"a25c0dc2":"code","fdad23c0":"code","e5a1b642":"code","5df30ae3":"code","31395fc0":"code","13836561":"code","8efadc38":"code","1c331e7f":"code","724d7fd4":"code","1a09715b":"code","c816b3dd":"code","ca3bd7c1":"code","ecad070b":"markdown","fb829f6d":"markdown","3b0d78f5":"markdown","d0b2d00e":"markdown","e41707b2":"markdown","7084b151":"markdown"},"source":{"a25c0dc2":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","fdad23c0":"accounts = pd.read_csv(\"\/kaggle\/input\/medium-daily-digests\/accounts.csv\", index_col=0)\naccounts.head()","e5a1b642":"mails = pd.read_csv(\"\/kaggle\/input\/medium-daily-digests\/mails.csv\")\nmails.sample(5)","5df30ae3":"articles_mails = pd.read_csv(\"\/kaggle\/input\/medium-daily-digests\/articles_mails.csv\")\narticles_mails.sample(5)","31395fc0":"mails.groupby(\"to\")[\"id\"].count()","13836561":"best_in = \"Best in \"\nbest_in_length = len(best_in)\ntopics ={section: section[best_in_length:] for section in articles_mails[\"section_title\"].unique() if section.startswith(best_in)}\nprint(f\"Identified {len(topics)} unique topics\")","8efadc38":"all_original_topics = set(accounts.set_index(\"account\").values.ravel())\nall_promoted_topics = set(topics.values())\n\nall_original_topics - all_promoted_topics","1c331e7f":"articles_mails[\"topic\"] = articles_mails[\"section_title\"].apply(lambda section: topics.get(section))\nmail_topics = articles_mails[[\"mail_id\", \"topic\"]]","724d7fd4":"topic_replacement = {}\ntopic_key = {}\nfor account_id, row in  accounts.iterrows():\n    for topic_label, actual_topic in row.to_dict().items():\n        topic_replacement[actual_topic] = topic_label\n        topic_key[(account_id, topic_label)] = actual_topic","1a09715b":"merged_inner = pd.merge(left=mail_topics, right=mails, left_on='mail_id', right_on='id')\nmerged_inner = merged_inner[~merged_inner[\"topic\"].isna()]\ngrouped = merged_inner.groupby([\"to\",\"topic\"]).count()[[\"mail_id\"]].rename(columns={\"mail_id\":\"count_per_topic\"})\ngrouped_totals = merged_inner.groupby(\"to\").count()[[\"topic\"]].rename(columns={\"topic\":\"total\"})\n\ndata = grouped.join(grouped_totals, how=\"inner\")\ndata[\"percentage_within_account\"] = data[\"count_per_topic\"] \/ data[\"total\"]\ndata = data.reset_index()\ndata[\"topic_replacement\"] = data[\"topic\"].apply(lambda topic: topic_replacement.get(topic))\ndata = data.set_index([\"to\", \"topic_replacement\"])\ndata = data[\"percentage_within_account\"].unstack().fillna(0)","c816b3dd":"next(data.iterrows())[1].index","ca3bd7c1":"import matplotlib.pyplot as plt\nimport seaborn as sns\n\nfig = plt.figure(figsize=(20, 10))\naxes = fig.subplots(5, 4)\n\nfor idx, (account_id, counts) in enumerate(data.iterrows()):\n    row = idx \/\/ 4\n    column = idx % 4\n    ax = axes[row][column]\n    sns.barplot(counts.index, counts.values, alpha=0.8, ax = ax)\n    ax.set_ylim([0,0.5])\n    tickslabels = ax.get_xticklabels()\n    ax.set_xticklabels([topic_key[(account_id, topic_label.get_text())] for topic_label in tickslabels])\n    ax.set_xlabel(None)\n\nplt.tight_layout()","ecad070b":"## Percentage of topics promoted for each account","fb829f6d":"Let's find how many emails per account I received:","3b0d78f5":"What do you have against Food, Marketing and Podcasting, Medim? WHAT?","d0b2d00e":"Let's see which ones are the most promoted sections per account:","e41707b2":"It seems I have received 42 emails on average... it would be interesting to find out why this number is not the same for all accounts given that I registered all at the same time \ud83e\udd14","7084b151":"It is very weird that there are 100 topics to choose from when you register in Medium, and yet there are only 97 being actively promoted on their emails, I wonder which ones are the \"banned\" ones:"}}