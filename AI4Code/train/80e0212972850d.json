{"cell_type":{"12e73489":"code","40fb8ade":"code","18cb5f59":"code","7e48c009":"code","f3f3ef8e":"code","f5feb558":"code","5ddfc7e1":"code","0fe7095c":"code","ecfd4413":"code","a321b263":"code","58b9e247":"code","642ff5f9":"code","07a91027":"code","f9b5bef4":"code","f9eb039d":"code","700efa1d":"code","567f0101":"code","ad45c690":"code","ae793624":"code","6deb68b9":"code","f3721a93":"code","c4a98203":"code","860ad98c":"code","51b9f7c0":"code","f976c726":"code","f9634f8e":"code","3154d5b3":"code","4cbc9f40":"code","6f65b5be":"code","af3aff05":"code","51236753":"code","690ab171":"code","df48edae":"markdown","109af0e3":"markdown","3a61fba0":"markdown","de59e94e":"markdown","d0d28f3a":"markdown","0b94e170":"markdown","005f16f9":"markdown","01fe0883":"markdown","6ad2b7e9":"markdown","cd6d53d2":"markdown","6cada35d":"markdown","0a77024e":"markdown","b870bece":"markdown","91186e33":"markdown","d43a1ba8":"markdown","6c489855":"markdown","b5d45ac4":"markdown","dd225212":"markdown","5351e377":"markdown","82680ff3":"markdown","f0978805":"markdown","79b4c5af":"markdown","6807a8ce":"markdown","f6f6655d":"markdown","334e4d2e":"markdown","b708134a":"markdown","109fc5c1":"markdown","6f59ccf4":"markdown","859b0b28":"markdown","024fe70c":"markdown"},"source":{"12e73489":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","40fb8ade":"import matplotlib.pyplot as plt\n%matplotlib inline\n\nimport seaborn as sns\nsns.set()\n\nfrom scipy.special import boxcox, inv_boxcox\nfrom scipy import stats\n\nimport warnings\nwarnings.filterwarnings('ignore')","18cb5f59":"# Read in data\ndata = pd.read_csv('\/kaggle\/input\/insurance\/insurance.csv')\nsplit = round(len(data) * .8)\ntrain = data[:split]\ntest = data[split:]","7e48c009":"f, ax = plt.subplots(ncols = 2, figsize=(15,5))\nsns.distplot(train['charges'], color='g', ax=ax[0])\nax[0].set_title('Train')\nsns.distplot(test['charges'], color='g', ax=ax[1])\nax[1].set_title('Test')","f3f3ef8e":"train.describe()","f5feb558":"train.head()","5ddfc7e1":"train.info()","0fe7095c":"print('Train Shape: {}'.format(train.shape))\nprint('Test Shape:  {}'.format(test.shape))","ecfd4413":"numeric_features = train.select_dtypes(include=['int64','float64']).columns\nnumeric_features","a321b263":"categorical_features = train.select_dtypes(include=['object']).columns\ncategorical_features","58b9e247":"f, ax = plt.subplots(ncols = 2, figsize=(15,5))\nsns.distplot(data['charges'], color='g', ax=ax[0])\nsns.kdeplot(data['charges'], cumulative=True, shade=True, color='g', ax=ax[1])","642ff5f9":"f, ax = plt.subplots(ncols = 2, figsize=(15,5))\nsns.distplot(data['age'], color='g', ax=ax[0])\nsns.kdeplot(data['age'], cumulative=True, shade=True, color='g', ax=ax[1])","07a91027":"f, ax = plt.subplots(ncols = 2, figsize=(15,5))\nsns.distplot(data['bmi'], color='g', ax=ax[0])\nsns.kdeplot(data['bmi'], cumulative=True, shade=True, color='g', ax=ax[1])\nprint(data['bmi'].describe())","f9b5bef4":"f, ax = plt.subplots(ncols = 2, figsize=(15,5))\nsns.distplot(data['children'], color='g', ax=ax[0])\nsns.kdeplot(data['children'], cumulative=True, shade=True, color='g', ax=ax[1])\nprint(data['children'].describe())","f9eb039d":"children_tab = pd.crosstab(index=data['children'], columns='Count', colnames=['Frequency'])\nchildren_tab_percentage = children_tab\/children_tab.sum()\nprint('{}\\n\\n{}'.format(children_tab, children_tab_percentage))","700efa1d":"has_children = len(data[data['children'] > 0])\/len(data)\nsns.barplot(x=data['children'].value_counts().index, y=data['children'].value_counts(), data=data)","567f0101":"print('There are {:.3}% of patients with at least 1 or more children and {:.3}% without children'.format(has_children * 100, (1 - has_children) * 100))","ad45c690":"sex_tab = pd.crosstab(index=data['sex'], columns='count', colnames=['Frequency'])\nsex_tab_percentage = sex_tab\/sex_tab.sum()\nprint('{}\\n\\n{}'.format(sex_tab, sex_tab_percentage))\nsns.barplot(x=data['sex'].value_counts().index, y=data['sex'].value_counts(), data=data)","ae793624":"smoker_tab = pd.crosstab(index=data['smoker'], columns='count', colnames=['Frequency'])\nsmoker_tab_percentage = smoker_tab\/smoker_tab.sum()\nprint('{}\\n\\n{}'.format(smoker_tab, smoker_tab_percentage))\nsns.barplot(x=data['smoker'].value_counts().index, y=data['smoker'].value_counts(), data=data)","6deb68b9":"sns.catplot(x='sex', y='charges', kind='boxen', data=data)\nplt.title('Medical Costs of Males and Females')","f3721a93":"sns.catplot(x='sex', y='charges', kind='boxen', hue='smoker', data=data)\nplt.title('Medical Costs of smokers and non-smokers for males and females')","c4a98203":"sns.catplot(x='sex', y='bmi', kind='boxen', data=data)\nplt.title('BMI of Males and Females')","860ad98c":"sns.catplot(x='region', y='charges', kind='boxen', data=data)\nplt.title('Medical Costs of different regions')","51b9f7c0":"sns.catplot(x='sex', y='charges', kind='boxen', hue='region', data=data)\nplt.title('Medical Costs of different regions for males and females')","f976c726":"# Distribution of charges by age\nwith sns.axes_style(\"white\"):\n    sns.jointplot(x='age',y='charges',data=data, kind='hex', color='#4CB391')","f9634f8e":"# Distribution of charges by bmi\nwith sns.axes_style(\"white\"):\n    sns.jointplot(x='bmi',y='charges',data=data, kind='hex', color='#4CB391')","3154d5b3":"sns.heatmap(train.corr(), annot=True, linewidths=0.5, fmt='.1f', cmap='Blues')\nplt.title('Correlation Matrix')","4cbc9f40":"data['bmi_risk'] = np.where(data.bmi < 26, 'Healthy', \n                           np.where((data.bmi > 25) & (data.bmi < 31), 'Overweight', \n                                   np.where((data.bmi > 30) & (data.bmi < 41), 'Obese',\n                                           np.where(data.bmi > 40, 'Morbid Obese', data['bmi']))))\n\ny_healthy_smoker_yes = data[(data['bmi_risk'] == 'Healthy') & (data.smoker=='yes')].charges\ny_overweight_smoker_yes = data[(data['bmi_risk'] == 'Overweight') & (data.smoker=='yes')].charges\ny_obese_smoker_yes = data[(data['bmi_risk'] == 'Obese') & (data.smoker=='yes')].charges\ny_morbid_smoker_yes = data[(data['bmi_risk'] == 'Morbid Obese') & (data.smoker=='yes')].charges\n\nsns.kdeplot(y_healthy_smoker_yes, shade=True, label='Healthy')\nsns.kdeplot(y_overweight_smoker_yes, shade=True, label='Overweight')\nsns.kdeplot(y_obese_smoker_yes, shade=True, label='Obese')\nsns.kdeplot(y_morbid_smoker_yes, shade=True, label='Morbid Obese')\nplt.title('Smokers')","6f65b5be":"y_healthy_smoker_no = data[(data['bmi_risk'] == 'Healthy') & (data.smoker=='no')].charges\ny_overweight_smoker_no = data[(data['bmi_risk'] == 'Overweight') & (data.smoker=='no')].charges\ny_obese_smoker_no = data[(data['bmi_risk'] == 'Obese') & (data.smoker=='no')].charges\ny_morbid_smoker_no = data[(data['bmi_risk'] == 'Morbid Obese') & (data.smoker=='no')].charges\n\nsns.kdeplot(y_healthy_smoker_no, shade=True, label='Healthy')\nsns.kdeplot(y_overweight_smoker_no, shade=True, label='Overweight')\nsns.kdeplot(y_obese_smoker_no, shade=True, label='Obese')\nsns.kdeplot(y_morbid_smoker_no, shade=True, label='Morbid Obese')\nplt.title('Non-Smokers')","af3aff05":"print('Skew:\\n{}\\n\\nKurtosis:\\n{}'.format(train.skew(),train.kurt()))","51236753":"f, ax = plt.subplots(ncols=2, figsize=(25,6))\n\n# distribution of charges\ng1 = sns.distplot(train['charges'], fit=stats.norm, ax=ax[0], color='g')\n\n# Get fitted parameters used by the function\n(mu, sigma) = stats.norm.fit(train['charges'])\nprint( '\\n mu = {:.2f} and sigma = {:.2f}\\n'.format(mu, sigma))\n\n# plot the following distribution\ng1.legend(['Normal dist. ($\\mu=$ {:.2f} and $\\sigma=$ {:.2f} )'.format(mu, sigma)], loc='best')\nplt.ylabel('Frequency')\nplt.title('charges distribution')\n\n# plot the QQ-plot\nres = stats.probplot(train['charges'], plot=plt)","690ab171":"# Apply boxcox transformation\ntrain[\"charges\"],  maxlog = stats.boxcox(train[\"charges\"])\n\n# distribution of charges\nf, ax = plt.subplots(ncols=2, figsize=(25,6))\ng1 = sns.distplot(train['charges'], fit=stats.norm, ax=ax[0], color='g')\n\n# Get fitted parameters used by the function\n(mu, sigma) = stats.norm.fit(train['charges'])\nprint( '\\n mu = {:.2f} and sigma = {:.2f}\\n'.format(mu, sigma))\n\n# plot the distribution\ng1.legend(['Normal dist. ($\\mu=$ {:.2f} and $\\sigma=$ {:.2f} )'.format(mu, sigma)], loc='best')\nplt.ylabel('Frequency')\nplt.title('charges distribution')\n\n# plot the QQ-plot\nres = stats.probplot(train['charges'], plot=plt)","df48edae":"- 20.48% of patients are smokers","109af0e3":"# Bivariate Analysis","3a61fba0":"Charges has high positive skew. I will apply boxcox transformations to reduce the skewness","de59e94e":"### Categorical Univariate Analysis","d0d28f3a":"To see an [in-depth regression analysis](https:\/\/www.kaggle.com\/littleotter\/medical-costs-in-depth-regression-analysis) where I perform feature engineering, add polynomial terms, model selection, feature selection, hyperparater tuning, and model evaluation, I encourage you to follow the given link.","0b94e170":"- The most frequent age group is 20 year olds which is surprising -- one would expect older patients to have more frequency.\n- The distribution of age is similar among the majority of age groups if we exclude the high frequency of 20 year olds","005f16f9":"### Numerical Univariate Analysis","01fe0883":"**Apply boxcox transformation**","6ad2b7e9":"- We can see a tendency that as age increases, the medical cost charges increases","cd6d53d2":"- Males have higher medical costs than females","6cada35d":"- Males on average have higher medical costs at all regions than females except at northeast","0a77024e":"- BMI is normally distributed with an average patient having 30 bmi which is reasonable","b870bece":"# Transformations","91186e33":"# In-depth Regression Analysis","d43a1ba8":"There seems to not be a strong correlation among the numeric features","6c489855":"Excellent, now lets explore our train dataset.","b5d45ac4":"- Medical costs for 80% of patients is approximately equal to or less than \\\\$20,000. \n- The range of top 20% of medical costs is roughly \\\\$40,000 which can have an impact on our predictions","dd225212":"- Patients who smoke have significantly higher medical costs than non-smokers","5351e377":"Let's examine categorical features in the train dataset","82680ff3":"Let's examine numerical features in the train dataset","f0978805":"**BMI Groups with respect to smokers and non-smokers**","79b4c5af":"**Smoker**","6807a8ce":"# Univariate Analysis","f6f6655d":"- The distribution is approximately equal between male and female","334e4d2e":"![](https:\/\/www.ammfitness.co.uk\/information-advice\/wp-content\/uploads\/2019\/04\/bmi-chart.jpg)","b708134a":"After splitting our dataset, it's important to verify that the target for our test dataset is distributed similarily to our train dataset.","109fc5c1":"- Males and females have roughly the same bmi distribution","6f59ccf4":"# Feature Engineering ","859b0b28":"**Sex**","024fe70c":"The distribution charges for patients of different BMIs are all similar for non smokers. However, there are clear groups for smokers where each group with an worse bmi have increased charges."}}