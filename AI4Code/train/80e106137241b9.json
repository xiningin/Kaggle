{"cell_type":{"58533b83":"code","1cd60ab8":"code","2f4a4a7d":"code","208537cd":"code","16e15f61":"code","be8df9d1":"code","5a468467":"code","cb817f80":"code","e7cbdddf":"code","984cae5b":"code","b547f8bc":"code","57c5f321":"code","11254708":"code","27a3c1e0":"code","3ae2aabc":"code","29e6ae97":"code","1213305f":"code","7813d2bb":"code","9987e042":"code","55f1f3eb":"code","46288781":"code","e9afc346":"code","81af0113":"code","046f7198":"code","6ea54c95":"code","e01471be":"code","a5aff939":"code","f0f25d74":"code","7c4df973":"code","837d6baf":"markdown","8b251d96":"markdown","b18b380b":"markdown","99415115":"markdown","30c16112":"markdown","bc7b57e5":"markdown","359a159c":"markdown","2b410bc6":"markdown","ebfc27e3":"markdown","7e6059ba":"markdown","d11bca9d":"markdown","e3257b5c":"markdown","44ec8106":"markdown","907b7506":"markdown","9231f59d":"markdown","17d6d6a0":"markdown","c82e12f0":"markdown","48d72207":"markdown","b3096cff":"markdown","c764d862":"markdown","be134eae":"markdown","0489ae51":"markdown","43fffbc8":"markdown","1be77d72":"markdown","5949feba":"markdown"},"source":{"58533b83":"# Setup notebook by importing necessary librairies\nimport numpy as np\nimport pandas as pd\npd.plotting.register_matplotlib_converters() # Register pandas formatters and converters with matplotlib\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.metrics import r2_score\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.feature_selection import mutual_info_regression\nfrom sklearn.feature_selection import SelectKBest","1cd60ab8":"# Read data\nTRAIN_FILE_PATH = \"..\/input\/bigmart-sales-data\/Train.csv\"\ndata = pd.read_csv(TRAIN_FILE_PATH)\nprint(\"Shape of data: \", data.shape)","2f4a4a7d":"data.head()","208537cd":"data.describe()","16e15f61":"target = 'Item_Outlet_Sales'\nfeatures = [col for col in data.columns if col!=target]\nprint(\"We have\", len(features), \"features:\", features)","be8df9d1":"# make two lists, one for categorial features names and second for others features\ncat_features = list(data[features].select_dtypes(include='object').columns)\nnum_features = list(set(features)-set(cat_features))\nprint(\"Categorical features:(\",len(cat_features),\")\", cat_features)\nprint(\"Numerical features(\",len(num_features),\"):\", num_features)","5a468467":"# get name of columns which contains null values\ndef summarize_null_cols(X, cols):\n    null_columns = list(X[cols].isnull().sum()[X[cols].isnull().sum()>0].index)\n    print(\"Columns which contain null:\",null_columns)\n    for col in null_columns:\n        percent = (X[col].isnull().sum().sum()\/len(X[col]))*100\n        print(\"For\", col,\"column we have\", round(percent,2),\"%of null values\")\nall_cols = features + [target]\nsummarize_null_cols(data, all_cols)","cb817f80":"# plot correlation between numerical features and target\nfig = plt.figure()\ncorr = data[num_features+[target]].corr()\nsns.heatmap(corr, mask=np.zeros_like(corr, dtype=np.bool), cmap=sns.diverging_palette(240,10,as_cmap=True),\n            square=True)","e7cbdddf":"plt.figure()\nplt.scatter(data['Item_MRP'], data[target])\nplt.xlabel(\"Item_MRP\")\nplt.ylabel(\"Item_Outlet_Sales\")","984cae5b":"plt.figure()\nsns.distplot(data[target], color=\"blue\")\nplt.show()\nprint(\"Skew (is positive): \", data[target].skew())","b547f8bc":"for col in cat_features:\n    unique_val = data[col].unique()\n    print(col,'(', len(unique_val),'):',unique_val)","57c5f321":"plt.figure()\ndata[['Outlet_Type', target]].groupby('Outlet_Type').median().plot(kind='bar')\nplt.show()","11254708":"plt.figure()\ndata[['Outlet_Location_Type', target]].groupby('Outlet_Location_Type').median().plot(kind='bar')\nplt.show()","27a3c1e0":"plt.figure()\ndata[['Item_Fat_Content', target]].groupby('Item_Fat_Content').median().plot.barh()\nplt.show()","3ae2aabc":"plt.figure()\ndata[['Outlet_Size', target]].groupby('Outlet_Size').median().plot(kind='bar')\nplt.show()","29e6ae97":"data.pivot_table(values='Item_Outlet_Sales', index='Item_Type').sort_values(by='Item_Outlet_Sales').plot(kind=\"barh\")","1213305f":"for otype in data['Outlet_Type'].unique():\n    print(\"\\n\",otype)\n    print(data[data['Outlet_Type']==otype]['Outlet_Size'].value_counts(dropna=False))","7813d2bb":"data[['Outlet_Identifier', target]].groupby('Outlet_Identifier').median().plot(kind='bar')\nplt.show()","9987e042":"items_weight_mean = data[['Item_Identifier', 'Item_Weight']].groupby('Item_Identifier').mean()\nprint(items_weight_mean[items_weight_mean['Item_Weight'].isnull()])\nitems_weight_mean[items_weight_mean['Item_Weight'].isnull()] = data['Item_Weight'].mean()\nprint(items_weight_mean[items_weight_mean['Item_Weight'].isnull()])","55f1f3eb":"def impute_item_weight(row):\n    item_id = row['Item_Identifier']\n    item_weight = row['Item_Weight']\n    \n    if not pd.isnull(item_weight):\n        return item_weight\n    # else\n    return items_weight_mean['Item_Weight'][items_weight_mean.index==item_id]\n    \n# impute item_weight\ndata['Item_Weight'] = data.apply(impute_item_weight, axis=1).astype(float)\nsummarize_null_cols(data, features)","46288781":"most_outlet_size_by_type = data.pivot_table(values='Outlet_Size', columns='Outlet_Type', aggfunc=(lambda x: x.mode()[0]))\n\ndef impute_outlet_size(row):\n    outlet_type = row['Outlet_Type']\n    outlet_size = row['Outlet_Size']\n    \n    if not pd.isnull(outlet_size):\n        return outlet_size\n    return most_outlet_size_by_type.loc['Outlet_Size'][most_outlet_size_by_type.columns==outlet_type][0]\n\n# impute outlet_size\n\ndata['Outlet_Size'] = data.apply(impute_outlet_size, axis=1)\nsummarize_null_cols(data, features)","e9afc346":"data.replace({'Item_Fat_Content': {'low fat':'Low Fat','LF':'Low Fat', 'reg':'Regular'}}, inplace=True)","81af0113":"for col in cat_features:\n    encoder = LabelEncoder()\n    data[col] = encoder.fit_transform(data[col])","046f7198":"data.head()","6ea54c95":"X_train, X_valid, y_train, y_valid = train_test_split(data[features], data[target], test_size=0.3, random_state=1)","e01471be":"model = RandomForestRegressor(n_estimators=1000, random_state=0)\nmodel.fit(X_train, y_train)\npreds = model.predict(X_valid)\nscore = r2_score(y_valid, preds)\nprint('R2:', score)","a5aff939":"model = RandomForestRegressor(random_state=0)\n\nmy_pipeline = Pipeline(steps=[\n                              ('rfr', model)\n                             ])\n\nparam_grid = [\n{'rfr__n_estimators': [100, 1000], 'rfr__max_features': [\"auto\", \"log2\"], \n 'rfr__max_depth': [None, 25]}\n]\n\ngrid_search_rfr = GridSearchCV(my_pipeline, param_grid, cv=4, scoring='r2', n_jobs=-1)\ngrid_search_rfr.fit(X_train, y_train)","f0f25d74":"print(\"Best parameter (CV score=%0.3f):\" % grid_search_rfr.best_score_)\nprint(grid_search_rfr.best_params_)","7c4df973":"model = RandomForestRegressor(n_estimators=1000, random_state=0, max_depth=None, max_features='log2')\nmodel.fit(X_train, y_train)\npreds = model.predict(X_valid)\nscore = r2_score(y_valid, preds)\nprint('R2:', score)","837d6baf":"### Numerical features exploratory","8b251d96":"In this notebook, I am building a sales predictor based on BigMart Outlets data recolted by their data scientists. In the first time, I will try to understand every features of our data(Exploratory Data Analysis, EDA). Then, I will move to preprocessing step to prepare data to the final step, training model.\n\n#### Steps:\n===========\n- Information about data (with recall of the goal of work)\n- Exploratory Data Analysis (EDA)\n- Data preprocessing\n- Model training\n- Conclusion\n","b18b380b":"Check if we still have null values in our datasets","99415115":"Let's make the values of the column \"Item_Fat_Content\" uniform ","30c16112":"Let's try a simple model on our data","bc7b57e5":"## Exploratory Data Analysis (EDA)\nLet's to make some hypotheses about features of data. Let's ask what element can increase or decrease items sales for a supermarket?\n\n- The usefulness of product for the vast majority of customers. It is defined by product category or the brand of product, and so one... But here, based on our dataset, we can use \"Item_Type\" feature to estimate the kind of product is loved by customers.\n- The price of product can influence the sales. To valid this hypothese we will check correlation between Item_MRP and \"Item_Outlet_Sales\"\n- The visibility of product in the store: Column \"Item_Visibility\"\n- The place where the store is established: depending on the location of the store the product's price may be different so column \"Outlet_Location_Type\" is important\n\nThese hypotheses are subjective. but with further exploration of the data, we will accept or reject each of these assumptions","359a159c":"Our target is skewed. We can make transformation like 'log' to reduce the skewness(We will do it later)","2b410bc6":"If you remember, one of my assumptions above is this: Item sales can depend on the price of the items. With this graph, we can notice the strong correlation between \"Item_MRP\" and \"Item_Sales_Outlet\".\n<br>\nBut one thing seems odd to me about the correlation graph. I thought the correlation between \"Item_Visibility\" and \"Item_Outlet_Sales\" would have been higher than what I get because the more visible a product is the more likely it is to be sold, vice versa. Maybe it's due to the many values of 0.0 we have in the \"Item_Visibility\" columns? My answer is subjective (yes). Because having 0.0% visibility area for a product is inconceivable, I guess it's probably missing data and they set 0.0% by default.","ebfc27e3":"We can notice that, supermarket Type1 is alone which have 'High' as Outlet Size. Supermarket Type2 and Type3 have only a Medium size for its outlets. This analysis will be helpful in preprocessing step to do imputation in order to give value which will have sense for Outlet_Size column","7e6059ba":"Here,we can notice we need to preprocess this feature to make value uniform","d11bca9d":"## Model Training and parameters tuning\n\nI choose RandomForestRegressor as model. Let's prepare data. I will use gridsearchcv to find best parameters of my model.","e3257b5c":"### Explore Data Analysis","44ec8106":"## Data Preprocessing\n\nAs we saw it, our dataset contains null values in two columns: Item_Weight and Outlet_Size. By making exploratory we found some idea about how we can deal with NaN values in these columns. \n<br>\nFor 'Item_Weight' column, we have items which weights are known except 4 items (like you can see below). So for these 4 items we will use the mean value of 'Item_Weight'\n<br>","907b7506":"First observations we can make it is:\n- There are 4 numerical features and target\n- \"Item_Weight\" and \"Outlet_Size\" columns have some null entries, so we must do imputation in preprocessing step\n","9231f59d":"Let's read dataset and make quick review","17d6d6a0":"Among the categorical characteristics, we can notice that there are ordinal characteristics. An ordinal characteristic is first of all a categorical characteristic which contains values which can be ordered. In our dataset we have:\n- 'Item_Fat_Content'\n- 'Outlet_Size'\n- 'Outlet_Type'\n- 'Outlet_Location_Type'\n\nFollowing anlysis is based on median value. When you have a skewed distribution, the median is a better measure of central tendency than the mean.","c82e12f0":"###### Information about dataset\nThis notebook has two main goals: make analysis of data and build Machine Learning model to predict the sales of each item at a particular outlet. We have 12 columns in our dataset.\n\n| Column          | Description       | Data Type    |\n|-----------------|-------------------|--------------|\n| Item_Identifier | Unique product ID | Alphanumeric |\n| Item_Weight     | Weight of product | Numeric      |\n| Item_Fat_Content | Wether the product is low fat or not | Alphanumeric |\n| Item_Visibility | The percent of total display area of all products in a store allocated to a particular product |  Numeric  |\n| Item_Type       |  Category of product |  Alphanumeric |\n| Item_MRP        |  Maximum Retail Price of product | Numeric             |\n| Outlet_Identifier| Unique store ID | Alphanumeric |\n| Item_Established_Year | The year in which store was created | Numeric |\n| Outlet_Size     | Size of the store in terms of ground area covered | Numeric |\n| Outlet_Location_Type | The type of city in which the store is located | Alphanumeric |\n| Outlet_Type | Whether the outlet is just a grocery store or some sort of supermarket | Alphanumeric |\n| Item_Outlet_Sales | Sales of the product in the particular store. This is the outcome variable to be predicted. | Numeric |","48d72207":"For 'Outlet_Size' column, we found previously a relation between Outlet_Size and Outlet_Type. We will use this to impute Outlet_Size by taking most frequent Size based on Outlet type.","b3096cff":"Now, we will try to improve model by tuning model parameters","c764d862":"# Big Mart Sales Predictions","be134eae":"Now, let's manage categorical columns with labelencoder","0489ae51":"### Categorical features exploratory","43fffbc8":"As we can see it, \"Item_Outlet_Sales\" is the target we must predict with our future model.","1be77d72":"This is the end of notebook, we started by making some assumptions, analyzes and then preprocessing the data and finally learning the model and tuning parameters. The score I have can be improved by using another model like XGRegressor, but also by doing some feature engineering which is also important to get a better score. In my work, I did not make any transformation on the skwed target's data. I will try to improve that point. I have seen a few articles that deal with this and I tried the logarithmic transformation which did not give good results. Reason why I did not keep it in the final version of the notebook.\n\nI will appreciate if anyone has a suggestion or question for me, please feel free to write a comment. Thank you:)","5949feba":"I make correlation figure analyse numericals features interaction with target"}}