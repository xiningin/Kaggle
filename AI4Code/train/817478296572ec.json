{"cell_type":{"ef5981bb":"code","111f5dba":"code","81831109":"code","2c187c65":"code","59ad5c08":"code","a7d37f2a":"code","946c033b":"code","abc43e49":"code","44814deb":"code","2bf65881":"code","ffea241c":"code","e3b9d7da":"code","c02d4042":"code","50a2ed15":"code","b157900b":"code","26c88a62":"code","d24589d0":"code","026b6c68":"code","7c9acc73":"markdown","4e98fe05":"markdown","cbadbf73":"markdown","32577c24":"markdown","fb8fecd6":"markdown","aa84456a":"markdown","d452aa67":"markdown","36473851":"markdown","2fe43750":"markdown"},"source":{"ef5981bb":"from fastai.vision.widgets import *\nfrom fastai.vision.all import *\nimport fastai","111f5dba":"path = Path('\/kaggle\/input\/chessman-image-dataset\/Chessman-image-dataset\/Chess')","81831109":"#path of each image file\nfns = get_image_files(path)\nfns ","2c187c65":"chesspieces = DataBlock(blocks=(ImageBlock, CategoryBlock), \n    get_items=get_image_files, \n    splitter=RandomSplitter(valid_pct=0.2, seed=42),\n    get_y=parent_label,\n    item_tfms=Resize(128))","59ad5c08":"#Tell Data loader where to find the images\ndls = chesspieces.dataloaders(path)","a7d37f2a":"dls.valid.show_batch(max_n = 8, nrows=2)","946c033b":"from torchvision.models import resnet34","abc43e49":"learn = cnn_learner(dls = dls, arch=resnet34, metrics=error_rate)\nlearn.fine_tune(2, base_lr = 1e-3)","44814deb":"learn.lr_find()","2bf65881":"learn.unfreeze()\nlearn.fit_one_cycle(5, lr_max = slice(1e-4, 1e-3))","ffea241c":"interp = ClassificationInterpretation.from_learner(learn)\ninterp.plot_confusion_matrix()","e3b9d7da":"interp.plot_top_losses(8, largest= True, nrows=2)","c02d4042":"# cleaner = ImageClassifierCleaner(learn)\n# cleaner","50a2ed15":"#to remove the images chosen to be deleted\n# for idx in cleaner.delete(): cleaner.fns[idx].unlink()\n","b157900b":"learn.export('export.pkl')","26c88a62":"learn_inf = load_learner('export.pkl')","d24589d0":"#copy paste a file name including path like the example below\nlearn_inf.predict('\/kaggle\/input\/chessman-image-dataset\/Chessman-image-dataset\/Chess\/Pawn\/00000007.jpg')","026b6c68":"#check what the available classes are\nlearn_inf.dls.vocab","7c9acc73":"# Train the Model","4e98fe05":"Enable internet setting on to download the weights for the pre-trained resnet model","cbadbf73":"## Store the model","32577c24":"# Classification of Chess-piece images using fastai\n\nThis notebook uses the image dataset below:\n\nhttps:\/\/www.kaggle.com\/niteshfre\/chessman-image-dataset\n\nThis notebook will walk you through how to create a model for classifying images of chess pieces using fastai.","fb8fecd6":"fastai provides an image classifier cleaner widget to clean the images based on top losses. After getting the index of what needs to be deleted\/moved, further cleaning can be done.","aa84456a":"## Model inference","d452aa67":"Resize was not recognized until I imported using following:\nfrom fastai.vision.all import *","36473851":"The training images are in each of the folders under Chess. They are ['Bishop', 'King', 'Knight', 'Pawn', 'Queen', 'Rook']","2fe43750":"It looks like some more cleaning is needed for the images. It is best to remove the images that are cropped and do not show the full piece since it adds confusion. In some cases, there are multiple pieces on the board. We should remove those as well."}}