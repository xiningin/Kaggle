{"cell_type":{"a7bbf91b":"code","d35bb859":"code","ee4bd9f1":"code","1ae590fa":"code","2f444df1":"code","404e3ac2":"code","9d843849":"code","006cab5f":"code","3244aa63":"code","93106711":"code","6522074f":"code","675dd1c1":"code","f452212c":"code","f3f465d2":"code","f2bf8955":"code","bd49a67c":"code","904da784":"code","fd57150c":"code","1c44e2db":"code","9ef8188b":"code","75e5f8c6":"code","2b449732":"code","2a3fd685":"code","7d18287b":"code","71c33850":"code","f0989e72":"code","91f20e74":"code","0bf1a5e4":"code","4540b08b":"code","cfc0c141":"code","53f6cec8":"code","2c7442f0":"code","05ecffe1":"code","95f8b8f7":"code","26e9580a":"code","0ae59a71":"code","b129b0b3":"code","72a63b20":"code","a45a9794":"code","f1539c8c":"code","059bc07e":"code","827d976a":"code","db28cb36":"code","acd24e4c":"code","e2549ff8":"code","d415f6dc":"code","8b189a3b":"code","5980ebac":"code","7641a2ee":"code","3074d84e":"code","61c7b0ff":"code","ab40ac12":"code","ed799711":"code","8929cccb":"code","6cf26031":"code","8e78b2fe":"code","f5c61e73":"code","1957d7f9":"code","775719cc":"code","00a4bdb0":"code","84ced71c":"code","1c450cdb":"code","b1c3f778":"code","dde78640":"code","6b8679ce":"markdown","54df3026":"markdown","a248119a":"markdown","b96b8e75":"markdown","e727573e":"markdown","7ebab8c1":"markdown","fdea310b":"markdown","ab0bf980":"markdown","82469753":"markdown","cb6bfd55":"markdown","8417d3a5":"markdown","4083e649":"markdown","44d86dd5":"markdown","cfcdb24e":"markdown","921621ce":"markdown","1c8accfc":"markdown","bd93fc4b":"markdown","bcfdb4e0":"markdown","52cff5d5":"markdown","5b502a02":"markdown","a6a4d9b8":"markdown","fcb76cbf":"markdown","e6eec848":"markdown","27738d2c":"markdown","9c6a2b92":"markdown","700b3836":"markdown","3fb60979":"markdown","28b8e15a":"markdown","aa5633dc":"markdown","6b84260b":"markdown","5729f9cf":"markdown","fa9f3f2c":"markdown","6613292b":"markdown","a16bfe85":"markdown"},"source":{"a7bbf91b":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\n\n# to display all columns and rows:\npd.set_option('display.max_columns', None); pd.set_option('display.max_rows', None);\n","d35bb859":"pd.set_option('display.float_format', lambda x: '%.0f' % x)\nimport matplotlib.pyplot as plt","ee4bd9f1":"df_2009_2010 = pd.read_excel(\"..\/input\/online-retail-ii-data-set-from-ml-repository\/online_retail_II.xlsx\", sheet_name = \"Year 2009-2010\")","1ae590fa":"df = df_2009_2010.copy()","2f444df1":"df[\"Description\"].nunique()","404e3ac2":"df[\"Description\"].value_counts().head()","9d843849":"df.groupby(\"Description\").agg({\"Quantity\":\"sum\"}).head()","006cab5f":"df.groupby(\"Description\").agg({\"Quantity\":\"sum\"}).sort_values(\"Quantity\", ascending = False).head()","3244aa63":"df[\"Invoice\"].nunique()","93106711":"# it is necessary to create a new variable by multiplying two variables\n\ndf[\"TotalPrice\"] = df[\"Quantity\"]*df[\"Price\"]","6522074f":"df.head()","675dd1c1":"df.groupby(\"Invoice\").agg({\"TotalPrice\":\"sum\"}).head()","f452212c":"df.sort_values(\"Price\", ascending = False).head()","f3f465d2":"df[\"Country\"].value_counts()","f2bf8955":"df.groupby(\"Country\").agg({\"TotalPrice\":\"sum\"}).sort_values(\"TotalPrice\", ascending = False).head()","bd49a67c":"df[df['Invoice'].str.startswith(\"C\", na=False)].sort_values(\"Quantity\", ascending = True).head()","904da784":"df.isnull().sum()","fd57150c":"df.dropna(inplace = True)","1c44e2db":"df.shape","9ef8188b":"df.describe([0.01,0.05,0.10,0.25,0.50,0.75,0.90,0.95, 0.99]).T","75e5f8c6":"for feature in [\"Quantity\",\"Price\",\"TotalPrice\"]:\n\n    Q1 = df[feature].quantile(0.01)\n    Q3 = df[feature].quantile(0.99)\n    IQR = Q3-Q1\n    upper = Q3 + 1.5*IQR\n    lower = Q1 - 1.5*IQR\n\n    if df[(df[feature] > upper) | (df[feature] < lower)].any(axis=None):\n        print(feature,\"yes\")\n        print(df[(df[feature] > upper) | (df[feature] < lower)].shape[0])\n    else:\n        print(feature, \"no\")","2b449732":"df.head()","2a3fd685":"df.info()","7d18287b":"df[\"InvoiceDate\"].min()","71c33850":"df[\"InvoiceDate\"].max()","f0989e72":"import datetime as dt\n\ntoday_date = dt.datetime(2010,12,9)","91f20e74":"today_date","0bf1a5e4":"df.groupby(\"Customer ID\").agg({\"InvoiceDate\":\"max\"}).head()","4540b08b":"df[\"Customer ID\"] = df[\"Customer ID\"].astype(int)","cfc0c141":"(today_date - df.groupby(\"Customer ID\").agg({\"InvoiceDate\":\"max\"})).head()","53f6cec8":"temp_df = (today_date - df.groupby(\"Customer ID\").agg({\"InvoiceDate\":\"max\"}))","2c7442f0":"temp_df.rename(columns={\"InvoiceDate\": \"Recency\"}, inplace = True)","05ecffe1":"temp_df.head()","95f8b8f7":"recency_df = temp_df[\"Recency\"].apply(lambda x: x.days)","26e9580a":"recency_df.head()","0ae59a71":"#df.groupby(\"Customer ID\").agg({\"InvoiceDate\": lambda x: (today_date - x.max()).days}).head()","b129b0b3":"temp_df = df.groupby([\"Customer ID\",\"Invoice\"]).agg({\"Invoice\":\"count\"})","72a63b20":"temp_df.head()","a45a9794":"temp_df.groupby(\"Customer ID\").agg({\"Invoice\":\"count\"}).head()","f1539c8c":"freq_df = temp_df.groupby(\"Customer ID\").agg({\"Invoice\":\"sum\"})\nfreq_df.rename(columns={\"Invoice\": \"Frequency\"}, inplace = True)\nfreq_df.head()","059bc07e":"monetary_df = df.groupby(\"Customer ID\").agg({\"TotalPrice\":\"sum\"})","827d976a":"monetary_df.head()","db28cb36":"# lets change names\n\nmonetary_df.rename(columns={\"TotalPrice\": \"Monetary\"}, inplace = True)","acd24e4c":"print(recency_df.shape,freq_df.shape,monetary_df.shape)","e2549ff8":"rfm = pd.concat([recency_df, freq_df, monetary_df],  axis=1)","d415f6dc":"rfm.head()","8b189a3b":"rfm[\"RecencyScore\"] = pd.qcut(rfm['Recency'], 5, labels = [5, 4, 3, 2, 1])   ","5980ebac":"rfm[\"FrequencyScore\"] = pd.qcut(rfm['Frequency'].rank(method = \"first\"), 5, labels = [1, 2, 3, 4, 5])","7641a2ee":"rfm[\"MonetaryScore\"] = pd.qcut(rfm['Monetary'], 5, labels = [1, 2, 3, 4, 5])","3074d84e":"rfm.head()","61c7b0ff":"(rfm['RecencyScore'].astype(str) + \n rfm['FrequencyScore'].astype(str) + \n rfm['MonetaryScore'].astype(str)).head()","ab40ac12":"rfm[\"RFM_SCORE\"] = rfm['RecencyScore'].astype(str) + rfm['FrequencyScore'].astype(str) + rfm['MonetaryScore'].astype(str)","ed799711":"rfm.head()","8929cccb":"rfm.describe().T","6cf26031":"rfm[rfm[\"RFM_SCORE\"] == \"555\"].head()","8e78b2fe":"rfm[rfm[\"RFM_SCORE\"] == \"111\"].head()","f5c61e73":"seg_map = {\n    r'[1-2][1-2]': 'Hibernating',\n    r'[1-2][3-4]': 'At Risk',\n    r'[1-2]5': 'Can\\'t Loose',\n    r'3[1-2]': 'About to Sleep',\n    r'33': 'Need Attention',\n    r'[3-4][4-5]': 'Loyal Customers',\n    r'41': 'Promising',\n    r'51': 'New Customers',\n    r'[4-5][2-3]': 'Potential Loyalists',\n    r'5[4-5]': 'Champions'\n}","1957d7f9":"rfm['Segment'] = rfm['RecencyScore'].astype(str) + rfm['FrequencyScore'].astype(str)\nrfm['Segment'] = rfm['Segment'].replace(seg_map, regex=True)\nrfm.head()","775719cc":"rfm[[\"Segment\", \"Recency\",\"Frequency\",\"Monetary\"]].groupby(\"Segment\").agg([\"mean\",\"count\"])","00a4bdb0":"rfm[rfm[\"Segment\"] == \"Need Attention\"].head()","84ced71c":"rfm[rfm[\"Segment\"] == \"New Customers\"].index","1c450cdb":"new_df = pd.DataFrame()\nnew_df[\"NewCustomerID\"] = rfm[rfm[\"Segment\"] == \"New Customers\"].index","b1c3f778":"new_df.head()","dde78640":"new_df.to_csv(\"new_customers.csv\")","6b8679ce":"For each customer, we need to deduce the customers' last purchase date from today's date.\n\nThen we have singularized customer deadlines.","54df3026":"## 10. Which product is the most returned?","a248119a":"The number of numbers that will be shown after the comma. For variables such as 'price', the option below is replaced with 0 instead.","b96b8e75":"Now, let's choose the class (Need Attention) that needs attention.\nIf we make strategy evaluations: you can take their \"Customer ID\" and keep it in excel, send sales department and prepare a campaign for them and make it more efficient.","e727573e":"# Data Preparation","7ebab8c1":"## 13. Scoring for RFM\n\n- Let's start with the last 5 here. Let's use the 'qcut' method to score.","fdea310b":"## 2. Which product do you have?","ab0bf980":"## Now, we need to score according to the most recent (Recency), the cyclic (Frequency) and the monetary expenditure (Monetary).","82469753":"## 4. How do we rank this output?","cb6bfd55":"# Business Problem with Customer Segmentation\n\n\nAn e-commerce company wants to segment its customers and determine marketing strategies according to these segments.\n\nFor this purpose, we will define the behavior of customers and we will form groups according to clustering.\n\nIn other words, we will take those who exhibit common behaviors into the same groups and we will try to develop sales and marketing techniques specific to these groups.\n\n\n\n### Data Set Story:\n\nhttps:\/\/archive.ics.uci.edu\/ml\/datasets\/Online+Retail+II\n\nThis Online Retail II data set contains all the transactions occurring for a UK-based and registered, non-store online retail between 01\/12\/2009 and 09\/12\/2011.\n\nThe company mainly sells unique all-occasion gift-ware. \n\nMany customers of the company are wholesalers.\n\n\n\n\n### Attribute Information:\n\n- InvoiceNo: Invoice number. Nominal. A 6-digit integral number uniquely assigned to each transaction. If this code starts with the letter 'c', it indicates a cancellation.\n- StockCode: Product (item) code. Nominal. A 5-digit integral number uniquely assigned to each distinct product.\n- Description: Product (item) name. Nominal.\n- Quantity: The quantities of each product (item) per transaction. Numeric.\n- InvoiceDate: Invice date and time. Numeric. The day and time when a transaction was generated.\n- UnitPrice: Unit price. Numeric. Product price per unit in sterling (\u00c2\u00a3).\n- CustomerID: Customer number. Nominal. A 5-digit integral number uniquely assigned to each customer.\n- Country: Country name. Nominal. The name of the country where a customer resides.\n\n","8417d3a5":"## If we need to comment, let's make an example of champions.\n\n- Recency is the last 666 number of shopping last 5,\n- Frequency average of 272 out of 666 how much shopping it makes,\n- Monetary has spent an average of 6533 currencies over 666 shoppers.","4083e649":"\n\n# Conclusion\n\n    After this notebook, my aim is to prepare 'kernel' which is 'not clear' data set.\n\n    If you have any suggestions, please could you write for me? I wil be happy for comment and critics!\n\n    Thank you for your suggestion and votes ;)\n\n","44d86dd5":"Let's write code with RFM values side by side","cfcdb24e":"Now we have the last shopping dates of each customer. Let's fix \"Customer ID\"s.","921621ce":"# Customer Segmentation with RFM Scores\n\nConsists of initials of Recency, Frequency, Monetary expressions.\n\nIt is a technique that helps determine marketing and sales strategies based on customers' buying habits.\n\n- Recency (innovation): Time since customer last purchased\n\n     -- In other words, it is the \u201ctime since the last contact of the customer\u201d.\n\n     -- Today's date - Last purchase\n\n     -- To give an example, if we are doing this analysis today, today's date is the last product purchase date.\n\n     -- This can be for example 20 or 100. We know that 20 customers are hotter. He has been in contact with us recently.\n\n- Frequency: Total number of purchases.\n\n- Monetary (Monetary Value): Total spending by the customer.\n","1c8accfc":"## 6. How much money has been earned per invoice?","bd93fc4b":"If we rank 5 points out of 3, 555 are champions.","bcfdb4e0":"## 12. What should we do for customer segmentation with RFM?","52cff5d5":"## 5. How many invoices have been issued?","5b502a02":"Let's do regex segmentation. With the help of regex, we will set rfm aside and consider r and f.\n\nExample: If you see 1-2 in r and 1-2 in f, write 'Hibernating'","a6a4d9b8":"What is today? Now if we take today's date, then there will be a very serious difference.\n\nFor this reason, let us determine ourselves a \"today\" according to the structure of this data set.\n\nWe can set this day as the maximum day of the data set.\n\nWe can segmentation according to the day of the last recording.","fcb76cbf":"## 11. Show the last shopping dates of each customer.","e6eec848":"# Monetary","27738d2c":"## 3. Which product is the most ordered?","9c6a2b92":"## 8. How many orders came from which country?","700b3836":"## 14. Finally, create an excel file named New Customer.","3fb60979":"Try to understand the data by using the functions that can be used as a first look at the data in the pandas section.","28b8e15a":"# Questions from data set\n\n\nAll questions about 2009-2010 years\n\n1. What is the number of unique products?\n2. Which product do you have?\n3. Which product is the most ordered?\n4. How do we rank this output?\n5. How many invoices have been issued?\n6. How much money has been earned per invoice?\n7. Which are the most expensive products?\n8. How many orders came from which country?\n9. which country gained how much?\n10. which product is the most returned?\n11. What should we do for customer segmentation with RFM?\n12. Scoring for RFM.\n13. Finally, create an excel file named New Customer.","aa5633dc":"# Data Understanding ","6b84260b":"## 1. What is the number of unique products?","5729f9cf":"## 9. Which country gained how much?","fa9f3f2c":"If we rank 1 point out of 3, that is, 111 ones are the lowest.","6613292b":"# Frequency","a16bfe85":"## 7. Which are the most expensive products?"}}