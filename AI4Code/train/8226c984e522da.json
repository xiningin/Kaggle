{"cell_type":{"5315b794":"code","bd6f29bd":"code","1e127d75":"code","87cc1dfc":"code","d415fc7c":"code","810397a6":"code","4beb13eb":"code","7b5ce208":"code","ea3c6c04":"code","0434a1b7":"code","0bf96188":"code","d6a3e2e2":"code","e769c0a0":"code","75d6d1d2":"code","e2db054f":"code","fce2afbd":"code","840a32db":"code","4f862592":"code","5654d04c":"code","61b2032b":"code","ec5c4310":"code","b6b097dc":"code","a5dfe5f4":"code","bd5e2311":"code","61d9fc23":"code","c39f4794":"code","bb86f13d":"code","a3d0df95":"code","72cf0e9f":"code","3f6a704a":"code","35e9e580":"code","7650557e":"code","9a03e6ee":"code","a4423d8c":"code","179010ff":"code","d0af990b":"code","59a45a43":"code","a34fc433":"code","5027a8a7":"code","0409563c":"code","a7ada934":"code","0a94da21":"code","0272da9d":"code","cd92c974":"code","474d993c":"code","64cd612b":"code","f0aa976c":"code","b591447f":"code","96df3b3b":"code","b088d72f":"code","54ac3d58":"code","3500e392":"markdown","6d45cc0a":"markdown","4ed3d230":"markdown","0c454daf":"markdown","a298871c":"markdown","1136ce96":"markdown","dcdd6b8f":"markdown","0a4c19fd":"markdown","3b11f9e3":"markdown","9cff39e0":"markdown","021a8b37":"markdown","b36e0afa":"markdown","9352e3a6":"markdown","f319355a":"markdown","9a89e8e8":"markdown","811d5581":"markdown","d53de9e8":"markdown","3386d579":"markdown","ff372d00":"markdown","8a8526d9":"markdown","bfeae829":"markdown","e4eac5e5":"markdown","7a3cf612":"markdown","1159bfa2":"markdown","f0dc266c":"markdown","20177390":"markdown","b9cf797f":"markdown","c0be23b2":"markdown","700ca5f4":"markdown","ea8a216e":"markdown","0e53d8d2":"markdown","a3a5b98f":"markdown","75688096":"markdown","98f1ef8d":"markdown","16ad28a8":"markdown"},"source":{"5315b794":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt # this is used for the plot the graph \nimport seaborn as sns # used for plot interactive graph.\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n\nfrom pylab import rcParams\n\n\n%matplotlib inline","bd6f29bd":"data = pd.read_csv('..\/input\/WA_Fn-UseC_-Telco-Customer-Churn.csv')","1e127d75":"data.columns","87cc1dfc":"data.shape","d415fc7c":"data.head(5)","810397a6":"data.drop(['customerID'], axis=1, inplace=True)","4beb13eb":"data['Churn'].value_counts(sort = False)","7b5ce208":"data['Churn'].value_counts(sort = False)","ea3c6c04":"# Data to plot\nlabels =data['Churn'].value_counts(sort = True).index\nsizes = data['Churn'].value_counts(sort = True)\n\n\ncolors = [\"whitesmoke\",\"red\"]\nexplode = (0.1,0)  # explode 1st slice\n \nrcParams['figure.figsize'] = 8,8\n# Plot\nplt.pie(sizes, explode=explode, labels=labels, colors=colors,\n        autopct='%1.1f%%', shadow=True, startangle=270,)\n\nplt.title('Percent of churn in customer')\nplt.show()","0434a1b7":"data['Churn'] = data['Churn'].map(lambda s :1  if s =='Yes' else 0)","0bf96188":"data.info()","d6a3e2e2":"#missing data\ntotal = data.isnull().sum().sort_values(ascending=False)\npercent = (data.isnull().sum()\/data.isnull().count()).sort_values(ascending=False)\nmissing_data = pd.concat([total, percent], axis=1, keys=['Total', 'Percent'])\nmissing_data.head(6)","e769c0a0":"data.head(5)","75d6d1d2":"data['gender'].head()","e2db054f":"g = sns.factorplot(y=\"Churn\",x=\"gender\",data=data,kind=\"bar\" ,palette = \"Pastel1\")\n","fce2afbd":"data = pd.get_dummies(data=data, columns=['gender'])","840a32db":"data['SeniorCitizen'].value_counts()","4f862592":"data['Partner'].value_counts()","5654d04c":"data['Partner'] = data['Partner'].map(lambda s :1  if s =='Yes' else 0)\ndata['Partner'].value_counts()","61b2032b":"data['Dependents'] = data['Dependents'].map(lambda s :1  if s =='Yes' else 0)\ndata['PhoneService'] = data['PhoneService'].map(lambda s :1  if s =='Yes' else 0)\ndata['PaperlessBilling'] = data['PaperlessBilling'].map(lambda s :1  if s =='Yes' else 0)\n","ec5c4310":"data['tenure'].head()","b6b097dc":"# tenure distibution \ng = sns.kdeplot(data.tenure[(data[\"Churn\"] == 0) ], color=\"Red\", shade = True)\ng = sns.kdeplot(data.tenure[(data[\"Churn\"] == 1) ], ax =g, color=\"Blue\", shade= True)\ng.set_xlabel(\"tenure\")\ng.set_ylabel(\"Frequency\")\nplt.title('Distribution of tenure comparing with churn feature')\ng = g.legend([\"Not Churn\",\"Churn\"])","a5dfe5f4":"data['MultipleLines'].value_counts()","bd5e2311":"data['MultipleLines'].replace('No phone service','No', inplace=True)\ndata['MultipleLines'] = data['MultipleLines'].map(lambda s :1  if s =='Yes' else 0)\ndata['MultipleLines'].value_counts()","61d9fc23":"data['InternetService'].value_counts()","c39f4794":"data['Has_InternetService'] = data['InternetService'].map(lambda s :0  if s =='No' else 1)\ndata['Fiber_optic'] = data['InternetService'].map(lambda s :1  if s =='Fiber optic' else 0)\ndata['DSL'] = data['InternetService'].map(lambda s :1  if s =='DSL' else 0)\n","bb86f13d":"print(data['Has_InternetService'].value_counts())\nprint(data['Fiber_optic'].value_counts())\nprint(data['DSL'].value_counts())\ndata.drop(['InternetService'], axis=1, inplace=True)","a3d0df95":"data['OnlineSecurity'] = data['OnlineSecurity'].map(lambda s :1  if s =='Yes' else 0)\ndata['OnlineBackup'] = data['OnlineBackup'].map(lambda s :1  if s =='Yes' else 0)\ndata['DeviceProtection'] = data['DeviceProtection'].map(lambda s :1  if s =='Yes' else 0)\ndata['TechSupport'] = data['TechSupport'].map(lambda s :1  if s =='Yes' else 0)\ndata['StreamingTV'] = data['StreamingTV'].map(lambda s :1  if s =='Yes' else 0)\ndata['StreamingMovies'] = data['StreamingMovies'].map(lambda s :1  if s =='Yes' else 0)","72cf0e9f":"data['PaymentMethod'].value_counts()","3f6a704a":"data = pd.get_dummies(data=data, columns=['PaymentMethod'])","35e9e580":"data[['PaymentMethod_Electronic check',\n      'PaymentMethod_Mailed check',\n      'PaymentMethod_Bank transfer (automatic)',\n      'PaymentMethod_Credit card (automatic)']].head()","7650557e":"data['Contract'].value_counts()","9a03e6ee":"data = pd.get_dummies(data=data, columns=['Contract'])","a4423d8c":"data['MonthlyCharges'].head()","179010ff":"g = sns.factorplot(x=\"Churn\", y = \"MonthlyCharges\",data = data, kind=\"box\", palette = \"Pastel1\")","d0af990b":"data['TotalCharges'].head()","59a45a43":"## because 11 rows contain \" \" , it means 11 missing data in our dataset\nlen(data[data['TotalCharges'] == \" \"])","a34fc433":"## Drop missing data\ndata = data[data['TotalCharges'] != \" \"]","5027a8a7":"data['TotalCharges'] = pd.to_numeric(data['TotalCharges'])\n## At first time I use this command but it error because some value contain \" \"\n## That why I know \" \" hide in our dataset ","0409563c":"g = sns.factorplot(y=\"TotalCharges\",x=\"Churn\",data=data,kind=\"boxen\", palette = \"Pastel2\")","a7ada934":"data.info()","0a94da21":"data[\"Churn\"] = data[\"Churn\"].astype(int)\n\nY_train = data[\"Churn\"]\nX_train = data.drop(labels = [\"Churn\"],axis = 1)","0272da9d":"from sklearn.ensemble import RandomForestClassifier\nfrom sklearn.model_selection import  cross_val_score,GridSearchCV\n\nRfclf = RandomForestClassifier(random_state=15)\nRfclf.fit(X_train, Y_train)","cd92c974":"# 10 Folds Cross Validation \nclf_score = cross_val_score(Rfclf, X_train, Y_train, cv=10)\nprint(clf_score)\nclf_score.mean()","474d993c":"%%time\nparam_grid  = { \n                'n_estimators' : [500,1200],\n               # 'min_samples_split': [2,5,10,15,100],\n               # 'min_samples_leaf': [1,2,5,10],\n                'max_depth': range(1,5,2),\n                'max_features' : ('log2', 'sqrt'),\n                'class_weight':[{1: w} for w in [1,1.5]]\n              }\n\nGridRF = GridSearchCV(RandomForestClassifier(random_state=15), param_grid)\n\nGridRF.fit(X_train, Y_train)\n#RF_preds = GridRF.predict_proba(X_test)[:, 1]\n#RF_performance = roc_auc_score(Y_test, RF_preds)\n\nprint(\n    #'DecisionTree: Area under the ROC curve = {}'.format(RF_performance)\n     \"\\nBest parameters \\n\" + str(GridRF.best_params_))","64cd612b":"rf = RandomForestClassifier(random_state=15,**GridRF.best_params_)\nrf.fit(X_train, Y_train)","f0aa976c":"# 10 Folds Cross Validation \nclf_score = cross_val_score(rf, X_train, Y_train, cv=10)\nprint(clf_score)\nclf_score.mean()\n    ","b591447f":"Rfclf_fea = pd.DataFrame(rf.feature_importances_)\nRfclf_fea[\"Feature\"] = list(X_train) \nRfclf_fea.sort_values(by=0, ascending=False).head()","96df3b3b":"g = sns.barplot(0,\"Feature\",data = Rfclf_fea.sort_values(by=0, ascending=False)[0:5], palette=\"Pastel1\",orient = \"h\")\ng.set_xlabel(\"Weight\")\ng = g.set_title(\"Random Forest\")","b088d72f":"# Confusion Matrix\nfrom sklearn.metrics import confusion_matrix\n\ny_pred = rf.predict(X_train)\n\nprint(confusion_matrix(Y_train, y_pred))","54ac3d58":"from sklearn.metrics import classification_report\n\nprint(classification_report( Y_train, y_pred))","3500e392":"## Feature importances\n    another advantage from rule-based model","6d45cc0a":"# <font color='red'> Introduction <\/font>\n\n     Welcome to basic binary classification task\n     this dataset want us to create model which can predict customer that will churn in future\n\n\nIn this kernel,\n\n - Simple Exploratory Data Analysis\n - Data wrangling\n - Creating predictive models\n - Fine tuning by GridSearch","4ed3d230":"**<font color='royalblue'> Preprocessing<\/font>**\n\n#### MultipleLines : Whether the customer has multiple lines or not (Yes, No, No phone service)\n    look like Yes No feature but it contain 3 values. \n    I should create new column that can tell model this customer has phone service or not.\n    but we already have 'PhoneService' columns, \n    then I decide to assume that \"No phone service\" has the same meaning with \"No\"\n    ","0c454daf":"**<font color='royalblue'> Preprocessing<\/font>**\n\n#### Tenure : Number of months the customer has stayed with the company\n    This is numerical feature we can cut it to bin width but I think it ready to use  \n    ","a298871c":"**<font color='tomato'> Finding<\/font>**\n\n    My default random forest get around 78% accuracy from cross-validation","1136ce96":"**<font color='royalblue'> Preprocessing<\/font>**\n\n#### SeniorCitizen : Whether the customer is a senior citizen or not (1, 0)\n    this feature is ready to use","dcdd6b8f":"    7043 data objects with 21 attributes","0a4c19fd":"**<font color='tomato'> Finding<\/font>**\n\n    From boxen plot, most of churn customer has less than 2000 in total chrage.\n    In range of 2500 to 8000, population of loyalty customer is around twice as amount as churn customer.","3b11f9e3":"## Confusion Matrix\n\n    also known as an error matrix, it is a specific table layout that allows visualization of the performance of an algorithm","9cff39e0":"**<font color='tomato'> Finding<\/font>**\n\n    My grid-search random forest get around 80% accuracy from cross-validation,\n    a little bit improve from default parameter","021a8b37":"**<font color='royalblue'> Preprocessing<\/font>**\n\n#### Gender : Customer gender (female, male)\n\n    Because we can't put string in model, then I decide to create new binary columns.","b36e0afa":"# Teleco Churn Prediction","9352e3a6":"## Target Feature","f319355a":"**<font color='royalblue'> Preprocessing<\/font>**\n\n#### Contract : The contract term of the customer (Month-to-month, One year, Two year)\n    this is also categorical value, let \"get_dummies\" it\n","9a89e8e8":"## Data Exploration","811d5581":"##  CreatingModel & Evaluate\n\n      In this step, I will use model with default parameter compare with tuning parameter by using grid search\n      Gridsearch is just like try to put all possible combining between parameter in ranges that we input.\n      It consume a lot of time, I decide to comment some line. you can try uncomment it when run in your local PC.","d53de9e8":"## K-Fold CV with accuracy metric\n","3386d579":"## Data Wrangling","ff372d00":"**<font color='royalblue'> Preprocessing<\/font>**\n\n#### MonthlyCharges : The amount charged to the customer monthly\n    numerical features and lucky!! it ready to use","8a8526d9":"## Random Forest","bfeae829":"**<font color='royalblue'> Preprocessing<\/font>**\n\n**OnlineSecurity OnlineBackup DeviceProtection <br>\n TechSupport StreamingTV StreamingMovies**\n\n     All of these columns have the same format,I do the samething what I do in \"MultipleLines\" column","e4eac5e5":"**<font color='royalblue'> Preprocessing<\/font>**\n\n#### Partner : Whether the customer has a partner or not (Yes, No)\n    This feature value has the same meaning with SeniorCitizen \n    but it is a \"Yes\/No\" values then we need to change format","7a3cf612":"**<font color='royalblue'> Preprocessing<\/font>**\n\n#### InternetService : Customer\u2019s internet service provider (DSL, Fiber optic, No)\n    First of all, I want something like \"PhoneService\" column, \n    then I decide to create Has_InternetService column which can tell this customer has internet service or not.\n    Next, if they have internet service we need to tell model what kind of service","1159bfa2":"**<font color='tomato'> Finding<\/font>**\n    \n    In training set, contain Churn customer only 26.5%","f0dc266c":"**<font color='forestgreen'> Note<\/font>**\n\n    First of all, drop customerID because it should not effect to churn probability","20177390":"![imglink](http:\/\/www.oxper.in\/wp-content\/uploads\/2017\/06\/churn-1-900x444.png)\n","b9cf797f":"**<font color='tomato'> Finding<\/font>**\n\n    According to above plot, High MonthlyCharges may affect to churn probability.\n    And seem like customer will not churn if they have low amount in MonthlyCharges","c0be23b2":"**Thank you for reading until the end : )** \n\n    I will try to update new version\n    please vote or comment If you like it ^_^\n    If you have any suggestion let me know in comment.","700ca5f4":"**<font color='forestgreen'> Note<\/font>**\n\n    What we got from get_dummies ??","ea8a216e":"## Import package","0e53d8d2":"**<font color='royalblue'> Preprocessing<\/font>**\n\n#### PaymentMethod : The customer\u2019s payment method (Electronic check, Mailed check, Bank transfer (automatic), Credit card (automatic))\n    This is categorical feature, I will use pandas function \"get_dummies\" for this feature","a3a5b98f":"**<font color='royalblue'> Preprocessing<\/font>**\n\n#### Dependents, PhoneService, PaperlessBilling\n    Do the same what we do in \"Partner\" column\n    ","75688096":"**<font color='tomato'> Finding<\/font>**\n\n    Seem like most of churn customer stayed in company less than 20 months\n    and customer with high value in tenure has low probability to churn","98f1ef8d":"**<font color='tomato'> Finding<\/font>**\n\n    No missing data ??","16ad28a8":"**<font color='royalblue'> Preprocessing<\/font>**\n\n#### TotalCharges : The total amount charged to the customer\n    numerical feature !?, but now it still in object type.\n    we need to fix it."}}