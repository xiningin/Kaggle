{"cell_type":{"99707cc7":"code","f6eef5fd":"code","ea9dc67e":"code","1d7e12ea":"code","d1888b36":"code","afb46ac6":"code","640575e0":"code","cd0ea522":"code","45d881e7":"code","f9fbe096":"code","35d7a767":"code","feee474a":"code","c4177535":"code","62841b44":"markdown","dd1bd7fe":"markdown","1d12dbbb":"markdown","a563fb23":"markdown","35851161":"markdown","0a9d341a":"markdown","b2116dc1":"markdown"},"source":{"99707cc7":"%matplotlib inline\nimport pandas as pd\nimport numpy as np\nimport seaborn as sns\nfrom matplotlib import pyplot as plt, rcParams\nrcParams.update({'font.size': 21})","f6eef5fd":"months = ['January', 'February', 'March', 'April', 'May', 'June', 'July']\n\ndef create_pivot(data, xcol, ycol, bins = 10):\n    data['xcol'] = pd.qcut(LB[xcol], bins, duplicates = 'drop')\n    data['ycol'] = pd.qcut(LB[ycol], bins, duplicates = 'drop')\n    data['ones'] = 1\n    pt = data.pivot_table(index = 'ycol', columns = 'xcol', values = 'ones', aggfunc = len).fillna(0).astype(int)\n    data.drop(columns = ['xcol', 'ycol', 'ones'], inplace = True)\n    return pt\n\ndef create_plots_for_data(LB, title_prefix):\n    plt.figure(figsize = (20, 10))\n    sns.barplot(data = LB['TeamMembersCnt'].value_counts().reset_index(), x = 'index', y = 'TeamMembersCnt')\n    plt.title(title_prefix + 'How many members were inside teams?')\n    plt.xlabel('teamMembersCnt')\n    plt.ylabel('Count')\n    plt.grid(True)\n    \n    plt.figure(figsize = (20, 10))\n    sns.histplot(data = LB, x = 'ChangeWithPublic', bins = 100)\n    plt.title(title_prefix + 'LB Shakeup')\n    plt.xlabel('# positions win\/lose on private LB')\n    plt.ylabel('Count')\n    plt.grid(True)\n    \n    plt.figure(figsize = (20, 10))\n    sns.heatmap(create_pivot(LB, 'ChangeWithPublic', \n                             'SubmissionsCount', bins = 10), annot = True, fmt = 'd')\n    plt.title(title_prefix + 'Submissions count vs. shakeup');\n    plt.xlabel('# positions win\/lose on private LB');\n    plt.ylabel('Submissions count');\n    \n    plt.figure(figsize = (20, 10))\n    sns.heatmap(create_pivot(LB, 'ChangeWithPublic', \n                             'Score', bins = 10), annot = True, fmt = 'd')\n    plt.title(title_prefix + 'Submissions scores vs. shakeup')\n    plt.xlabel('# positions win\/lose on private LB')\n    plt.ylabel('Submission scores');\n    \n    plt.figure(figsize = (20, 10))\n    sns.heatmap(create_pivot(LB, 'DaysDiffBetweenLastSubAndDeadline', \n                             'Score', bins = 10), annot = True, fmt = 'd')\n    plt.title(title_prefix + 'Submission scores vs. difference between last submit and deadline')\n    plt.xlabel('Difference between last submit and deadline (in days)')\n    plt.ylabel('Submissions count');\n    \n    \ndef get_change_with_public_lb(data):\n    change_with_public = []\n    for team, change in list(zip(data['TeamMembersList'].str.split(';').values,\n                                 data['ChangeWithPublic'])):\n        if str(team) == 'nan':\n            continue\n        change_with_public += [[user, change] for user in team]\n    return pd.DataFrame(change_with_public, columns = ['User', 'ChangeWithPublic'])","ea9dc67e":"change_with_public = []\n\nfor month in months[:-1]:\n    print(month)\n\n    LB = pd.read_csv('..\/input\/tps-competitions-private-leaderboards\/TPS_{}_leaderboard.csv'.format(month))\n    create_plots_for_data(LB, 'TPS {}: '.format(month))\n    plt.show()\n\n    print(LB[['ChangeWithPublic', \n        'Score', \n        'SubmissionsCount', \n        'TeamMembersCnt', \n        'DaysDiffBetweenLastSubAndDeadline']].describe(percentiles=np.arange(0.1, 1, 0.1)))\n    \n    change_with_public.append(get_change_with_public_lb(LB))\n    \n    print('=' * 30)","1d7e12ea":"month = months[-1]\nprint(month)\n\nLB = pd.read_csv('..\/input\/tps-competitions-private-leaderboards\/TPS_{}_leaderboard.csv'.format(month))\ncreate_plots_for_data(LB, 'TPS {}: '.format(month))\nplt.show()\n\nprint(LB[['ChangeWithPublic', \n    'Score', \n    'SubmissionsCount', \n    'TeamMembersCnt', \n    'DaysDiffBetweenLastSubAndDeadline']].describe(percentiles=np.arange(0.1, 1, 0.1)))\n\nchange_with_public.append(get_change_with_public_lb(LB))","d1888b36":"change_df = pd.concat(change_with_public).reset_index(drop = True)\nagg_df = change_df.groupby('User')['ChangeWithPublic'].agg(CompetitionsCnt = len, \n                                                           MedianChange = np.median,\n                                                           WorstDrop = np.min,\n                                                           BestJump = np.max).reset_index()\nagg_df","afb46ac6":"vc = (agg_df['CompetitionsCnt'].value_counts() \/ \n          len(agg_df) * 100).reset_index().rename({'index': 'CompsCnt'}, axis = 1)\n\nprint(vc)\n\nplt.figure(figsize = (20, 10))\nsns.barplot(data = vc, x = 'CompsCnt', y = 'CompetitionsCnt')\nplt.title('What percent of users participate in specific number of TPS competitions?')\nplt.xlabel('Number of TPS competitions')\nplt.ylabel('Users percent')\nplt.grid(True)","640575e0":"median_change_sort = agg_df.sort_values('MedianChange')\nprint(median_change_sort.shape)\nprint('Worst-10 median changes:')\nmedian_change_sort.head(10)","cd0ea522":"print('Top-10 median changes:')\nmedian_change_sort.tail(10).iloc[::-1, :]","45d881e7":"median_change_sort_3 = agg_df[agg_df['CompetitionsCnt'] >= 3].sort_values('MedianChange').reset_index(drop = True)\nprint(median_change_sort_3.shape)\nprint('Worst-10 median changes for users with 3 comps and more:')\nmedian_change_sort_3.head(10)","f9fbe096":"print('Top-10 median changes for users with 3 comps and more:')\nmedian_change_sort_3.tail(10).iloc[::-1, :]","35d7a767":"median_change_sort_3[median_change_sort_3['User'] == 'alexryzhkov']","feee474a":"best_jumpers = agg_df.sort_values('BestJump', ascending = False).reset_index(drop = True)\nprint(best_jumpers.shape)\nprint('Top-15 jumpers on Private LB:')\nbest_jumpers.head(10)","c4177535":"best_jumpers[best_jumpers['User'] == 'alexryzhkov']","62841b44":"### Cool. 6888 users have already done that (maybe several times as well). But how many of them participated in the specific number of competitions?","dd1bd7fe":"# Necessary imports","1d12dbbb":"# It's time to build the aggregated table for each user participated in TPS competitions","a563fb23":"# EDA for the private leaderboards\n\nThe graphs for all datasets are collapsed - open the output of the cell below to see them:","35851161":"### For the latest competition we create the same EDA in separate cell below:","0a9d341a":"### Only ~15% participated in 2 competitions, the more the number of competitions - the less users fit.\n\n# Let's check different user tops","b2116dc1":"# Constants and helper functions"}}