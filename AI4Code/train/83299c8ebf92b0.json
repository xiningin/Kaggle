{"cell_type":{"3c1f715f":"code","d60f30fd":"code","7373bc8d":"code","48570778":"code","33f6d07e":"code","124720c2":"code","716c2ba3":"code","35a704b5":"code","005fb2a0":"code","df8af566":"code","db1a2779":"code","353ebcd3":"code","de405eef":"code","6bb19999":"code","1969be37":"code","24988565":"code","7482e29a":"code","e665bae2":"code","7f1bfbe1":"code","8d92c41f":"code","507d6b40":"code","7a1dd8bc":"code","fa542b99":"code","30a000b4":"code","4ba6460a":"code","17a84b4e":"code","a42769b6":"code","75f490dc":"code","e974e663":"code","5861c361":"code","21458b65":"code","3b7455bf":"code","633f8066":"code","0fa66d9c":"code","980b90d4":"code","88514184":"code","e942885d":"code","d716ed72":"code","4e5fb0aa":"code","06a93de3":"code","503ab4ec":"code","e05838a6":"code","2dd0baf1":"code","00974cba":"code","614affa8":"code","f2f56bee":"code","13aa1772":"code","0a0e0f09":"code","1819d1d5":"code","09525e2e":"code","f706093a":"code","243cb37d":"markdown","77f053ad":"markdown","d42b4177":"markdown","0fcf3b49":"markdown","181111a7":"markdown","9c547ffd":"markdown","2099e735":"markdown","5647547c":"markdown","bd84ca4b":"markdown","bd049a60":"markdown","62881eb1":"markdown","c85f76e0":"markdown","d33f682e":"markdown","10a93e5f":"markdown","8de2a1a5":"markdown","bf8a0ed2":"markdown","3705840d":"markdown","288e7b22":"markdown","13a322df":"markdown","41abfb9d":"markdown","cf93aeac":"markdown","8318f4cc":"markdown","27e98b93":"markdown","ad95cc69":"markdown","0e4f48ae":"markdown","b685c33a":"markdown","39e7ca8c":"markdown","7bcff691":"markdown","a4497e7a":"markdown","bad55e44":"markdown","23829cbf":"markdown","123f9971":"markdown","4cc54c21":"markdown","9d1cee15":"markdown","0929d43d":"markdown","edbb6cbc":"markdown","be9d9168":"markdown","59267425":"markdown","4235d1d9":"markdown","e4c31455":"markdown","c1a66678":"markdown","aa5264e1":"markdown","9822fab8":"markdown","ffd6fe5c":"markdown","279ed6d6":"markdown","afbd7e3d":"markdown","df651ab8":"markdown","406e54bb":"markdown","d87508eb":"markdown","0604a71d":"markdown","e6dae743":"markdown","17a1ed4c":"markdown","5b3c3f5b":"markdown"},"source":{"3c1f715f":"import pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport folium\nimport warnings\nwarnings.filterwarnings('ignore')\n\nsns.set_style('darkgrid')","d60f30fd":"results_df = pd.read_csv('..\/input\/international-football-results-from-1872-to-2017\/results.csv')\nshootouts_df = pd.read_csv('..\/input\/international-football-results-from-1872-to-2017\/shootouts.csv')","7373bc8d":"results_df.head()","48570778":"shootouts_df.head()","33f6d07e":"results_df.describe().T","124720c2":"results_df[(results_df['home_score'] == 31) | (results_df['away_score'] == 21)]","716c2ba3":"results_df.isnull().sum()","35a704b5":"shootouts_df.isnull().sum()","005fb2a0":"results_df.drop(results_df[results_df.isna().any(axis=1)].index, inplace=True)","df8af566":"afc = [team.strip() for team in open('..\/input\/national-football-team-affiliations\/AFC', 'r').read().split('\\n')]\ncaf = [team.strip() for team in open('..\/input\/national-football-team-affiliations\/CAF', 'r').read().strip().split('\\n')]\nconcacaf = [team.strip() for team in open('..\/input\/national-football-team-affiliations\/Concacaf', 'r').read().strip().split('\\n')]\nconmebol = [team.strip() for team in open('..\/input\/national-football-team-affiliations\/Conmebol', 'r').read().strip().split('\\n')]\nofc = [team.strip() for team in open('..\/input\/national-football-team-affiliations\/OFC', 'r').read().strip().split('\\n')]\nuefa = [team.strip() for team in open('..\/input\/national-football-team-affiliations\/UEFA', 'r').read().strip().split('\\n')]\n\n# Fix some typos in the names and change others to match the names in the already available data\nafc[afc.index(\"Brunei Darussalam\")] = \"Brunei\"\nafc[afc.index(\"Chinese Taipei\")] = \"Taiwan\"\ncaf[caf.index(\"Libya1\")] = \"Libya\"\ncaf[caf.index(\"Mauritania1\")] = \"Mauritania\"\ncaf[caf.index(\"Morocco1\")] = \"Morocco\"\ncaf[caf.index(\"Congo DR\")] = \"Congo\"\ncaf[caf.index(\"Swaziland\")] = \"Eswatini\"\nconcacaf[concacaf.index(\"US Virgin Islands\")] = \"United States Virgin Islands\"\nuefa[uefa.index(\"FYR Macedonia\")] = \"North Macedonia\"","db1a2779":"football_cities_df = pd.read_csv('..\/input\/footballcities\/football_cities.csv', index_col=[0])\nfootball_cities_df.head()","353ebcd3":"results_df.rename(columns={'date': 'Date', \n                           'home_team': 'Home Team', \n                           'away_team': 'Away Team',\n                           'home_score': 'Home Score',\n                           'away_score': 'Away Score',\n                           'tournament': 'Tournament',\n                           'city': 'City',\n                           'country': 'Country',\n                           'neutral': 'Neutral'}, inplace=True)\n\nshootouts_df.rename(columns={'date': 'Date',\n                             'home_team': 'Home Team', \n                             'away_team': 'Away Team',\n                             'winner': 'Winner'}, inplace=True)","de405eef":"results_df['Outcome'] = results_df.apply(lambda x : 'H' if x['Home Score'] > x['Away Score'] \n                                         else ('A' if x['Home Score'] < x['Away Score'] else 'D'),\n                                         axis=1)\n\nresults_df['Winning Team'] = results_df.apply(lambda x : x['Home Team'] if x['Home Score'] > x['Away Score'] \n                                              else (x['Away Team'] if x['Home Score'] < x['Away Score'] else np.nan),\n                                              axis=1)\n\nresults_df['Losing Team'] = results_df.apply(lambda x : x['Away Team'] if x['Home Score'] > x['Away Score'] \n                                             else (x['Home Team'] if x['Home Score'] < x['Away Score'] else np.nan),\n                                             axis=1)\n\nresults_df['Total Goals'] = results_df['Home Score'] + results_df['Away Score']\nresults_df['Year'] = pd.DatetimeIndex(results_df['Date']).year\nresults_df['Decade'] = results_df['Year'] - results_df['Year'] % 10\nresults_df['Month'] = pd.DatetimeIndex(results_df['Date']).month\nresults_df['Month Name'] = pd.DatetimeIndex(results_df['Date']).month_name()\nresults_df['Day of Week'] = pd.DatetimeIndex(results_df['Date']).day_name()","6bb19999":"results_df['Home Team'].iloc[31849] = 'South Africa'\nresults_df['Away Team'].iloc[31849] = 'Zimbabwe'\nresults_df['Home Team'].iloc[40795] = 'Uganda'\nresults_df['Away Team'].iloc[40795] = 'South Africa'","1969be37":"football_df = results_df.merge(shootouts_df, how='left', on=['Home Team', 'Away Team', 'Date'])\n\nfootball_df['Winning Team'] = football_df.apply(\n    lambda x: x['Winner'] if not pd.isnull(x['Winner']) and pd.isnull(x['Winning Team']) \n    else x['Winning Team'], \n    axis=1)\n\nfootball_df['Losing Team'] = football_df.apply(\n    lambda x: x['Home Team'] if x['Winning Team'] == x['Away Team'] and x['Outcome'] == 'D' \n    else x['Away Team'] if x['Winning Team'] == x['Home Team'] and x['Outcome'] == 'D' \n    else x['Losing Team'], axis=1)\n\nfootball_df.drop(columns = ['Winner'], inplace=True)","24988565":"football_df.head()","7482e29a":"affiliations_df = pd.DataFrame({\n    'Affiliation' : ['AFC'] * len(afc) + ['CAF'] * len(caf) + ['CONCACAF'] * len(concacaf) + \\\n    ['CONMEBOL'] * len(conmebol) + ['OFC'] * len(ofc) + ['UEFA'] * len(uefa),\n    'Region' : ['Asia'] * len(afc) + ['Africa'] * len(caf) + ['North and Central America'] * len(concacaf) + \\\n    ['South America'] * len(conmebol) + ['Oceania'] * len(ofc) + ['Europe'] * len(uefa),\n    'Team': afc + caf + concacaf + conmebol + ofc + uefa\n})","e665bae2":"all_teams = list(football_df['Home Team'].unique())\nall_teams.extend(list(football_df['Away Team'].unique()))\nall_teams_df = pd.DataFrame({'Team': list(set(all_teams))})\nall_teams_df['First Game Year'] = all_teams_df['Team'].apply(lambda x: football_df[(football_df['Home Team'] == x) | (football_df['Away Team'] == x)].head(1)['Year'].values[0])\nall_teams_df['First Game Decade'] = all_teams_df['First Game Year'] - all_teams_df['First Game Year'] % 10\nall_teams_df = all_teams_df.merge(affiliations_df, how='left', on=['Team'])\nall_teams_df.sort_values(by='First Game Year', inplace=True)\nall_teams_df.head()","7f1bfbe1":"week_days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']","8d92c41f":"new_teams_decade = all_teams_df['First Game Decade'].value_counts().sort_index()","507d6b40":"plt.figure(figsize=(20,10))\nax = sns.lineplot(data=new_teams_decade, x=new_teams_decade.index, y=new_teams_decade.values)\nax.set_title('How has football been adopted over time?', size=20)\nax.set_xlabel(xlabel='Decade', size=12)\nax.set_ylabel(ylabel='New National Teams', size=12)\nax.set(xticks=new_teams_decade.index);","7a1dd8bc":"new_teams_decade_region_df = all_teams_df[['First Game Decade', 'Region']].value_counts().sort_index().reset_index(level=1)\nnew_teams_decade_region_df.rename(columns={0: 'Count'}, inplace=True)\nnew_teams_decade_region_df = pd.pivot(new_teams_decade_region_df,columns='Region', values='Count')","fa542b99":"ax = new_teams_decade_region_df.plot(kind='bar', stacked=True, figsize=(20,10))\nax.set_title('How has football been adopted over time?', size=20)\nax.set_xlabel(xlabel='Decade', size=12)\nax.set_ylabel(ylabel='New National Teams', size=12)\nplt.xticks(rotation=0);","30a000b4":"games_per_year = football_df['Year'].value_counts().sort_index()\n\n# Get list of decades to define the labels of the x-axis\ndecades = football_df['Decade'].unique()\n\n# Get World Cup years to point out the number of matches in those years\nworld_cup_years = football_df[football_df['Tournament'] == 'FIFA World Cup']['Year'].unique()\nworld_cup_years_games = games_per_year[games_per_year.index.isin(world_cup_years)]","4ba6460a":"plt.figure(figsize=(20,10))\n\n# Mark the time intervals of the World Wars on the chart\nplt.axvline(x = 1914, color = 'r', linestyle = 'dashed', linewidth=1, ymax=0.2)\nplt.axvline(x = 1918, color = 'r', linestyle = 'dashed', linewidth=1, ymax=0.2)\nplt.text(1912, 200, 'World War I', color='red')\n\nplt.axvline(x = 1939, color = 'r', linestyle = 'dashed', linewidth=1, ymax=0.2)\nplt.axvline(x = 1945, color = 'r', linestyle = 'dashed', linewidth=1, ymax=0.2)\nplt.text(1938, 200, 'World War II', color='red')\n\n# Highlight years of the World Cup\nplt.plot(world_cup_years_games, 'go', label='World Cup')\n\n# Annotate emergence of COVID-19\nplt.text(2017, 250, 'COVID-19', color='red'); \n\nax = sns.lineplot(data=games_per_year, x=games_per_year.index, y=games_per_year.values)\nax.set_title('How many matches per year?', size=20)\nax.set_xlabel(xlabel='Year', size=12)\nax.set_ylabel(ylabel='Matches', size=12)\nax.set(xticks=decades);","17a84b4e":"games_per_month = football_df[['Month', 'Month Name', 'Year']].value_counts().reset_index().sort_values(by=['Month', 'Year'])\ngames_per_month.rename(columns={0: 'Count'}, inplace=True)","a42769b6":"fig, ax = plt.subplots(ncols=3, nrows=4, figsize=(20,10))\nindex = 0\nax = ax.flatten()\n\nfor value in games_per_month['Month Name'].unique():\n    sns.lineplot(data=games_per_month[games_per_month['Month Name'] == value], x='Year', y='Count', ax=ax[index])\n    ax[index].set_title(value, size=12)\n    ax[index].set_ylabel(ylabel='Matches')\n    ax[index].set_xlim(left=1870)\n    ax[index].set_ylim(top=300)\n    index+=1\n    \nfig.tight_layout(pad=2)\nfig.suptitle('How many matches per month?', fontsize=20, y=1.025);","75f490dc":"games_per_dow = football_df[['Day of Week', 'Year']].value_counts().reset_index().sort_values(by=['Year'])\ngames_per_dow.rename(columns={0: 'Count'}, inplace=True)","e974e663":"fig, ax = plt.subplots(ncols=2, nrows=4, figsize=(20,10))\nindex = 0\nax = ax.flatten()\n\nfor value in week_days:\n    sns.lineplot(data=games_per_dow[games_per_dow['Day of Week'] == value], x='Year', y='Count', ax=ax[index])\n    ax[index].set_title(value, size=12)\n    ax[index].set_ylabel(ylabel='Matches')\n    ax[index].set_xlim(left=1870)\n    ax[index].set_ylim(top=450)\n    index+=1\n\nfig.delaxes(ax[7])\nfig.tight_layout(pad=2)\nfig.suptitle('How many matches per day of week?', fontsize=20, y=1.025);","5861c361":"m = folium.Map(location=[20,0], tiles='OpenStreetMap', zoom_start=2)\n\nfor index, value in football_cities_df.iterrows():\n    if not pd.isnull(value['Latitude']) and not pd.isnull(value['Longitude']):\n        folium.Circle(\n          location=[value['Latitude'], value['Longitude']],\n          popup=f\"{value['City']}: {value['Count']}\",\n          radius=value['Count'] * 1000,\n          color='crimson',\n          fill=True,\n          fill_color='crimson'\n       ).add_to(m)\n\n# Add a title to the map \ntitle = 'Which cities hosted most games?'\ntitle_html = '''<h3 align=\"center\" style=\"font-size:16px\"><b>{}<\/b><\/h3>'''.format(title)   \nm.get_root().html.add_child(folium.Element(title_html))\n\nm","21458b65":"home_team_wins_by_city = pd.DataFrame(\n    football_df[(football_df['Neutral'] == False) & (football_df['Home Team'] == football_df['Winning Team'])][['Home Team', 'City']].value_counts().reset_index())\nhome_team_wins_by_city.rename(columns={0: 'City Wins'}, inplace=True)\n\nhome_team_games_by_city = pd.DataFrame(football_df[(football_df['Neutral'] == False)][['Home Team', 'City']].value_counts().reset_index())\nhome_team_games_by_city.rename(columns={0: 'City Games'}, inplace=True)\n\nhome_team_wins_by_city = home_team_wins_by_city.merge(home_team_games_by_city, how='inner', on=['Home Team', 'City'])\nhome_team_wins_by_city['Win Ratio'] = home_team_wins_by_city['City Wins'] \/ home_team_wins_by_city['City Games']\n\nhome_team_total_games = pd.DataFrame(football_df[(football_df['Neutral'] == False)][['Home Team']].value_counts().reset_index())\nhome_team_total_games.rename(columns={0: 'Home Games'}, inplace=True)\n\nhome_team_wins_by_city = home_team_wins_by_city.merge(home_team_total_games, how='inner', on=['Home Team'])\nhome_team_wins_by_city['City Games %'] = home_team_wins_by_city['City Games'] \/ home_team_wins_by_city['Home Games']\n\n# 25% of the cities only hosted one game, let's exclude them\nhome_team_wins_by_city = home_team_wins_by_city[home_team_wins_by_city['City Wins'] > 1]\n\n# Exclude cities that received less than 10% of team games\nhome_team_wins_by_city = home_team_wins_by_city[home_team_wins_by_city['City Games %'] >= 0.1]\n\n# Sort by Win Ratio and only keep first city of each team\nhome_team_wins_by_city.sort_values(by = ['Home Team', 'Win Ratio'], ascending=False, inplace=True)\nhome_team_wins_by_city.drop_duplicates(subset=['Home Team'], keep='first', inplace=True)\n\n# Get latitude and longitude of each city\nhome_team_wins_by_city = home_team_wins_by_city.merge(football_cities_df[['City', 'Latitude', 'Longitude']], how='left', on=['City'])","3b7455bf":"m = folium.Map(location=[20,0], tiles='OpenStreetMap', zoom_start=2)\n\nfor index, value in home_team_wins_by_city.iterrows():\n    if not pd.isnull(value['Latitude']) and not pd.isnull(value['Longitude']):\n        folium.Circle(\n          location=[value['Latitude'], value['Longitude']],\n          popup=f\"{value['Home Team']} - {value['City']}:{value['Win Ratio']:.2f}\",\n          radius=value['Win Ratio'] * 200000,\n          color='crimson',\n          fill=True,\n          fill_color='crimson'\n       ).add_to(m)\n\n# Add a title to the map \ntitle = 'Which city is best for the home team?'\ntitle_html = '''<h3 align=\"center\" style=\"font-size:16px\"><b>{}<\/b><\/h3>'''.format(title)   \nm.get_root().html.add_child(folium.Element(title_html))\n\nm","633f8066":"tournament_counts = pd.DataFrame(football_df['Tournament'].value_counts().reset_index()).rename(columns={'index': 'Tournament', 'Tournament': 'Count'})\ntournament_counts = tournament_counts[(tournament_counts['Tournament'] != 'Friendly') & \n                                      (~ tournament_counts['Tournament'].str.endswith('qualification')) & \n                                      (tournament_counts['Count'] >= 100)]\ntournament_counts.reset_index(inplace=True)","0fa66d9c":"plt.figure(figsize=(20,10))\nax = sns.barplot(y=tournament_counts['Tournament'], x=tournament_counts['Count'], orient='h')\nax.set_title('Which tournaments had the most games?', size=20)\nax.set_xlabel(xlabel='Matches', size=12)\nax.set_ylabel(ylabel='Tournament', size=12)\n\n# Annotate value labels to each team\nfor index, value in tournament_counts.iterrows(): \n    plt.annotate(value['Count'], xy=(value['Count'] - 20, index + 0.2), color='white')","980b90d4":"major_tournaments = ['FIFA World Cup', 'Confederations Cup', 'Copa Am\u00e9rica', 'African Cup of Nations', \n                     'African Nations Championship', 'AFC Asian Cup', 'Gold Cup', 'CONCACAF Nations League', \n                     'UEFA Euro', 'UEFA Nations League', 'Oceania Nations Cup']\n\nmajor_tournaments_df = football_df[football_df[\"Tournament\"].isin(major_tournaments)]","88514184":"home_team_game_counts = major_tournaments_df[major_tournaments_df['Neutral'] == False]['Home Team'].value_counts()\n\nneutral_team_game_counts = pd.concat([major_tournaments_df[major_tournaments_df['Neutral'] == True]['Home Team'].value_counts(),\n           major_tournaments_df[major_tournaments_df['Neutral'] == True]['Away Team'].value_counts()], axis=1)\nneutral_team_game_counts['Neutral'] = neutral_team_game_counts['Home Team'] + neutral_team_game_counts['Away Team']\n\naway_team_game_counts = major_tournaments_df[major_tournaments_df['Neutral'] == False]['Away Team'].value_counts()\n\ngame_counts = pd.concat([home_team_game_counts, neutral_team_game_counts['Neutral'], away_team_game_counts], axis=1)\ngame_counts['Total'] = game_counts['Home Team'] + game_counts['Neutral'] + game_counts['Away Team']\ngame_counts_top10 = game_counts.sort_values(by='Total', ascending=False).head(10)","e942885d":"ax = game_counts_top10[['Home Team', 'Neutral', 'Away Team']].plot(kind='bar', stacked=True, figsize=(20,10))\nax.set_title('Which national teams have played the most games in major tournaments?', size=20)\nax.set_xlabel(xlabel='National Team', size=12)\nax.set_ylabel(ylabel='Matches', size=12)\nax.set_xticklabels(ax.get_xticklabels(), rotation=20);\nax.legend(['Home', 'Neutral', 'Away'], loc='upper right', title='Condition', fontsize=12);\n\n# Annotate value labels to each team\ni = 0\nfor index, value in game_counts_top10.iterrows(): \n    plt.annotate(int(value['Total']), xy=(i - 0.07, value['Total'] - 10), color='white')\n    i += 1","d716ed72":"goals_per_year = pd.DataFrame(football_df.groupby(['Year'])['Total Goals'].sum().reset_index())\ngames_per_year = pd.DataFrame(football_df['Year'].value_counts().sort_index().reset_index())\ngames_per_year.rename(columns={'index': 'Year', 'Year': 'Matches'}, inplace=True)\n\ngoals_per_year = goals_per_year.merge(games_per_year, how='inner', on=['Year'])\ngoals_per_year['Goals Per Game'] = goals_per_year['Total Goals'] \/ goals_per_year['Matches']","4e5fb0aa":"plt.figure(figsize=(20,10))\nax = sns.lineplot(data=goals_per_year, x='Year', y='Goals Per Game')\nax.set_title('How many goals are scored per match?', size=20)\nax.set_xlabel(xlabel='Year', size=12)\nax.set_ylabel(ylabel='Goals Per Game', size=12)\nax.set(xticks=decades);","06a93de3":"goals_per_year_major_tournaments = pd.DataFrame(football_df[football_df['Tournament'].isin(major_tournaments)].groupby(['Year', 'Tournament'])['Total Goals'].sum().reset_index())\ngames_per_year_major_tournaments = pd.DataFrame(football_df['Year'].value_counts().sort_index().reset_index())\ngames_per_year_major_tournaments.rename(columns={'index': 'Year', 'Year': 'Matches'}, inplace=True)\ngoals_per_year_major_tournaments = goals_per_year_major_tournaments.merge(games_per_year_major_tournaments, how='inner', on=['Year'])\ngoals_per_year_major_tournaments['Goals Per Game'] = goals_per_year_major_tournaments['Total Goals'] \/ goals_per_year_major_tournaments['Matches']","503ab4ec":"fig, ax = plt.subplots(ncols=2, nrows=6, figsize=(20,10))\nindex = 0\nax = ax.flatten()\n\nfor value in major_tournaments:\n    sns.lineplot(data=goals_per_year_major_tournaments[goals_per_year_major_tournaments['Tournament'] == value], x='Year', y='Goals Per Game', ax=ax[index])\n    ax[index].set_title(value, size=12)\n    ax[index].set_ylabel(ylabel='Goals Per Game')\n    index+=1\n\nfig.delaxes(ax[11])\nfig.tight_layout(pad=2)\nfig.suptitle('How many goals are scored per match in major tournaments?', fontsize=20, y=1.025);","e05838a6":"home_team_goals = pd.DataFrame(major_tournaments_df.groupby(by=['Home Team'])['Home Score'].sum().reset_index())\naway_team_goals = pd.DataFrame(major_tournaments_df.groupby(by=['Away Team'])['Away Score'].sum().reset_index())\nhome_team_goals.rename(columns={'Home Team': 'Team'}, inplace=True)\naway_team_goals.rename(columns={'Away Team': 'Team'}, inplace=True)\nteam_goals = home_team_goals.merge(away_team_goals, how='inner', on=['Team'])\nteam_goals['Total Goals'] = team_goals['Home Score'] + team_goals['Away Score']\n\ntotal_games = game_counts.reset_index().rename(columns={'index': 'Team', 'Total': 'Total Games'})[['Team', 'Total Games']]\nteam_goals = team_goals.merge(total_games, how='inner', on=['Team'])\nteam_goals['Goals Per Game'] = team_goals['Total Goals'] \/ team_goals['Total Games']\n\n# 25% of the teams has played 21 games or less, let's exclude them\nteam_goals = team_goals[team_goals['Total Games'] > 21]\nteam_goals_top10 = team_goals.sort_values(by='Goals Per Game', ascending=False).head(10)","2dd0baf1":"plt.figure(figsize=(20,10))\nax = sns.barplot(y=team_goals_top10['Team'], x=team_goals_top10['Goals Per Game'], orient='h')\nax.set_title('Which are the best attacking teams?', size=20)\nax.set_xlabel(xlabel='Goals Per Game', size=12)\nax.set_ylabel(ylabel='National Team', size=12)\n\n# Annotate value labels to each team\ni = 0\nfor index, value in team_goals_top10.iterrows(): \n    plt.annotate(float(\"{:.2f}\".format(value['Goals Per Game'])), xy=(value['Goals Per Game'] - 0.1, i), color='white')\n    i += 1","00974cba":"home_team_goals = pd.DataFrame(major_tournaments_df.groupby(by=['Home Team'])['Away Score'].sum().reset_index())\naway_team_goals = pd.DataFrame(major_tournaments_df.groupby(by=['Away Team'])['Home Score'].sum().reset_index())\nhome_team_goals.rename(columns={'Home Team': 'Team'}, inplace=True)\naway_team_goals.rename(columns={'Away Team': 'Team'}, inplace=True)\nteam_goals = home_team_goals.merge(away_team_goals, how='inner', on=['Team'])\nteam_goals['Total Goals'] = team_goals['Home Score'] + team_goals['Away Score']\n\ntotal_games = game_counts.reset_index().rename(columns={'index': 'Team', 'Total': 'Total Games'})[['Team', 'Total Games']]\nteam_goals = team_goals.merge(total_games, how='inner', on=['Team'])\nteam_goals['Goals Per Game'] = team_goals['Total Goals'] \/ team_goals['Total Games']\n\n# 25% of the teams has played 21 games or less, let's exclude them\nteam_goals = team_goals[team_goals['Total Games'] > 21]\nteam_goals_top10 = team_goals.sort_values(by='Goals Per Game', ascending=True).head(10)","614affa8":"plt.figure(figsize=(20,10))\nax = sns.barplot(y=team_goals_top10['Team'], x=team_goals_top10['Goals Per Game'], orient='h')\nax.set_title('Which are the best defending teams?', size=20)\nax.set_xlabel(xlabel='Goals Per Game', size=12)\nax.set_ylabel(ylabel='National Team', size=12)\n\n# Annotate value labels to each team\ni = 0\nfor index, value in team_goals_top10.iterrows(): \n    plt.annotate(float(\"{:.2f}\".format(value['Goals Per Game'])), xy=(value['Goals Per Game'] - 0.1, i), color='white')\n    i += 1","f2f56bee":"win_ratios = pd.concat([major_tournaments_df['Winning Team'].value_counts(), game_counts['Total']], axis=1)\nwin_ratios['Win Ratio'] = win_ratios['Winning Team'] \/ win_ratios['Total']\n\n# 25% of the teams has played 21 games or less, let's exclude them\nwin_ratios = win_ratios[win_ratios['Total'] > 21]\nwin_ratios_top_10 = win_ratios.sort_values(by='Win Ratio', ascending=False).head(10)","13aa1772":"plt.figure(figsize=(20,10))\nax = sns.barplot(x=win_ratios_top_10['Win Ratio'], y=win_ratios_top_10.index, orient='h')\nax.set_title('Which teams have the best win ratio in major tournaments?', size=20)\nax.set_xlabel(xlabel='Win Ratio', size=12)\nax.set_ylabel(ylabel='National Team', size=12)\nax.set_xlim(right=1)\n\n# Annotate value labels to each team\ni = 0\nfor index, value in win_ratios_top_10.iterrows(): \n    plt.annotate(float(\"{:.2f}\".format(value['Win Ratio'])), xy=(value['Win Ratio']-0.03, i+0.075), color='white')\n    i += 1","0a0e0f09":"win_ratio_per_decade = pd.concat(\n    [pd.DataFrame(major_tournaments_df.groupby('Decade')['Winning Team'].apply(lambda x: x.value_counts())),\n     pd.DataFrame(major_tournaments_df.groupby('Decade')['Home Team'].apply(lambda x: x.value_counts())),\n     pd.DataFrame(major_tournaments_df.groupby('Decade')['Away Team'].apply(lambda x: x.value_counts()))],\n    axis=1)\n\nwin_ratio_per_decade['Total'] = win_ratio_per_decade['Home Team'] + win_ratio_per_decade['Away Team']\nwin_ratio_per_decade['Win Ratio'] = win_ratio_per_decade['Winning Team'] \/ win_ratio_per_decade['Total']","1819d1d5":"win_ratio_per_decade.reset_index().groupby('Decade').describe()['Total']","09525e2e":"win_ratio_per_decade = win_ratio_per_decade[win_ratio_per_decade['Total'] > 5]\nwin_ratio_per_decade_top_3 = win_ratio_per_decade.sort_values(by=['Decade', 'Win Ratio'], axis=0, na_position='first').groupby(level=0).tail(3)\nwin_ratio_per_decade_top_3 = win_ratio_per_decade_top_3.reset_index()\nwin_ratio_per_decade_top_3.rename(columns={'level_1': 'National Team'}, inplace=True)","f706093a":"plt.figure(figsize=(20,10))\nax = sns.scatterplot(x = 'Decade', y = 'Win Ratio', hue ='National Team', data=win_ratio_per_decade_top_3, palette='tab20')\nax.set_title('Which are the best teams per decade in major tournaments?', size=20)\nax.set_xlabel(xlabel='Decade', size=12)\nax.set_ylabel(ylabel='Win Ratio', size=12)\nax.set_ylim(bottom=0, top=1)\nax.set(xticks=decades[4:]);\n\n# Annotate the top 3 national teams\nfor index, row in win_ratio_per_decade_top_3.iterrows():\n    # Georgia and North Macedonia annotations were superimposed\n    if row['Decade'] == 2010 and row['National Team'] == 'North Macedonia':\n        plt.annotate(row['National Team'], xy=(row['Decade'] - 9, row['Win Ratio']), fontsize=10)\n    else:\n        plt.annotate(row['National Team'], xy=(row['Decade'], row['Win Ratio']), fontsize=10)","243cb37d":"We will consider two competitions played between teams from all continents (World Cup and Confederations Cup) and the main competitions of each continent. So, these are the tournaments in the dataset that we will take as the main ones:\n- FIFA World Cup\n- Confederations Cup\n- Copa Am\u00e9rica\n- African Cup of Nations\n- African Nations Championship\t\n- AFC Asian Cup\n- Gold Cup\n- CONCACAF Nations League\n- UEFA Euro\n- UEFA Nations League\n- Oceania Nations Cup\n\n","77f053ad":"**Which are the best attacking teams?**\n\nContinuing to talk about goals, let's see which teams score the most.","d42b4177":"**How many goals are scored per match?**\n\nYou can't say football without goals, so let's look at the statistics of what makes football beautiful.","0fcf3b49":"The first trend was that in World Cup years there were more international matches. However, that trend has long since reversed, which makes sense because there are now many qualifying matches in previous years and continental competitions like the UEFA Euro and Copa Am\u00e9rica.\n\nTo note that as expected there were fewer matches during the World Wars. Yet, the biggest drop was caused by COVID-19. ","181111a7":"Finally, let's load a csv file I built with the latitude and longitude of the cities in the dataset and the number of games there were there. It will be useful to make some maps.\n\nTo get the latitudes and logitudes I used [geopy](https:\/\/geopy.readthedocs.io\/en\/stable\/).","9c547ffd":"We are ready to plot!","2099e735":"The results_df dataframe does not include results after penalties, so we are filling in the **Winning Team** and **Losing Team** columns in games that required penalties to determine the winners.","5647547c":"Once again we need to be fair, so let's take a look at the distribution of the number of matches per decade.","bd84ca4b":"# Descriptive Statistics\nLet's load the dataset and look at the descriptive statistics.","bd049a60":"# Imports","62881eb1":"Europe hosted most of the games, with cities like London, Budapest, Copenhagen and Oslo at the top, but there are a few surprises like Kuala Lumpur and Qatar's capital Doha.\n\nMost of the larger bubbles are capitals, which was to be expected.","c85f76e0":"**If you like this notebook, please give it an upvote as it keeps me motivated. Plus, I am open to feedback.**","d33f682e":"There are some big teams in this top 10 (Brazil, Argentina, Uruguay, Germany and France) but there are some surprises too, like New Caledonia, Guadeloupe and Tahiti.","10a93e5f":"Everything checks out!\n\nNext we are creating a dataframe with all the teams, the year of their first international match and their affiliations.","8de2a1a5":"A list with the days of the week will come in handy for visualizations.","bf8a0ed2":"It makes sense that teams from **South America (Brazil, Argentina, Uruguay, Chile, Paraguay, Peru and Colombia)** dominate this top 10. Copa Am\u00e9rica is the second most played tournament among the considered as major. Plus, the top 3 (Brazil, Argentina and Uruguay) add up to nine World Cups,  thirty nine Copa Am\u00e9ricas, and five Confederations Cups!\n\nBrazil, Colombia and Peru were invited to the Gold Cup. In three editions, Brazil was runner-up twice and third once. Colombia also played three times, reaching the final once and Peru reached the semifinals the only time they played in this competition.\n\n**Mexico** is the most powerful team in the CONCACAF region. Mexico has won eleven Gold Cups and one Confederations Cup.\n\n**Germany** is the only European team that appears, which is explained by the fact that it is the most successful European team. It has won four World Cups, three Euros and one Confederations Cup. \n\nThe **United States** has won seven Gold Cups and one CONCACAF Nations League (there has been only one edition). The high number of home games for the United States is due to having been the hosts or co-hosts of all editions of the Gold Cup. \n\nMexico and the United States have participated in 10 and 4 editions of the Copa Am\u00e9rica, respectively. Mexico achieved two second places and three third places, while the United States finished fourth twice. This also contributed to the high number of games played by these two nations.","3705840d":"The team that plays at home scores more goals on average.\n\nThere was a game where the home team scored 31 goals and another where the away team scored 21. Before we go any further, let's check which games we are talking about.","288e7b22":"**How many matches per month?**\n\nLet's see how the matches have been distributed by the months of the year.","13a322df":"The first five international football matches were played between Scotland and England.","41abfb9d":"# References","cf93aeac":"The first penalty shoot-out took place in a friendly match between India and Taiwan. More info about the history of penalty shoot-outs can be seen [here](https:\/\/www.fifamuseum.com\/en\/blog-stories\/blog\/why-the-lottery-that-is-penalty-shoot-outs-were-introduced-2610606\/).","8318f4cc":"The number of new national teams spiked up between the very beginning and the 1920s. Then the trend reversed for a long time, until the 80s.\n\nBefore drawing any further conclusions, let's analyze these numbers grouped by region.","27e98b93":"# Data Visualization\n\nLet's go through the rest of this notebook creating different charts to answer a few questions.","ad95cc69":"**Which national teams have played the most games in major tournaments?**\n\nNow we are ready to see the top 10 of the teams that have played the most games in major tournaments.","0e4f48ae":"# Data Processing\nFor starters, we are renaming the columns for plotting purposes.","b685c33a":"**How many goals are scored per match in major tournaments?**\n\nLet's dive a little deeper and see if this trend is the same for the big tournaments.","39e7ca8c":"Exclude teams with 5 or less matches per decade seems to be a good choice.","7bcff691":"**How has football been adopted over time?**\n\nTo understand how football has been adopted over time, we are looking at the number of new national teams per decade.","a4497e7a":"**Which are the best teams per decade in major tournaments?**\n\nLet's find out the golden eras of the best national teams. ","bad55e44":"The first games (between 1872 and 1900) took place mainly on Saturdays and Mondays. There was no match on Sundays until 1902, on Tuesdays until 1905, and on a Friday until 1910.\n\nAll days of the week show a long-term upward trend except Wednesdays, these were a very common choice in the 2000s. Tuesdays, Thursdays, and Fridays have become more popular in the last few years.\n\nNow it's time to look at the data differently, we are making some maps!","23829cbf":"**How many matches per year?**\n\nWe are going to plot the number of matches per year to have another metric that shows how football has been adopted over time. For a better understanding, let's highlight the World Cup years and some big events (World War I, World War II and COVID-19).","123f9971":"Note that there is a difference between the previous chart and the sum of all regions. The affiliations dataset does not have all the teams present in this dataset. In addition, the latter contains some regional teams like Madrid and Catalonia. However, the trend is the same.\n\nEurope was the first major contributor to new national teams. Then the Americas took the lead in the 20s and 30s. \n\nAfrica and Asia dominated between the 40s and the 80s. The growth in Europe in the 90s might be explained by the emergence of new countries, such as those derived from the former Yugoslavia.","4cc54c21":"There are missing values. Since they are few, let's just ignore them by deleting these rows.","9d1cee15":"**Which city is best for the home team?**\n\nNext, we'll find out where each national team performs best at home.","0929d43d":"There are no teams from the previous top, so there are no teams with the best attack and defense. There are also some great teams like Italy, England and Portugal and less powerful ones like Norway and Zambia.\n\nBut more than attacking and defending well, football is about winning!","edbb6cbc":"The downward trend clearly holds for the following tournaments: FIFA World Cup, Copa Am\u00e9rica, African Cup of Nations and Oceania Nations Cup. On the other hand, the UEFA Euro shows an increase in the number of goals per game.","be9d9168":"1. Anim-Ayeko, A. (2021). Making Cool Maps with Geopy and Folium. Available at: https:\/\/towardsdatascience.com\/making-simple-maps-with-folium-and-geopy-4b9e8ab98c00\n2. gpoudel. (2018). 150 years of the beautiful game. Available at: https:\/\/www.kaggle.com\/gpoudel\/150-years-of-the-beautiful-game\n3. Julien, P. (2018). A journey through the history of soccer. Available at: https:\/\/www.kaggle.com\/phjulien\/a-journey-through-the-history-of-soccer\n4. The Python Graph Gallery. (2018). Bubble map with Python and Folium. Available at: https:\/\/www.python-graph-gallery.com\/313-bubble-map-with-folium","59267425":"**Australia vs American Samoa** can be considered a David vs Goliath fight. Australia has won 4 OFC Nations Cup and 1 AFC Asian Cup, while American Samoa has lost 45 out of 51 matches in its entire history.\n\nThe **EAFF Championship** is a competition in East Asia for national teams like China, South Korea and Japan. The current champion is South Korea.\n\nMissing values might affect the analysis, so we are going to see if there are any.","4235d1d9":"By creating columns with the outcome of the match, the total number of goals scored and the winning and losing teams, we are having faster access to the result of the match. In addition, we will add some date-related features: decade, year, month and day of the week.","e4c31455":"**Which tournaments had the most games?**\n\nTo answer this, we are excluding friendly matches, qualifiers and tournaments with less than 100 matches.","c1a66678":"There are some teams that can make home their fortress, such as Spain (Seville) and Czech Republic (Teplice). It is interesting that none of these are capitals.\n\nThe opposite can also be noted. Belgium, which is number 1 in the FIFA ranking has only won 53% of the matches in Brussels.","aa5264e1":"**Which cities hosted most games?**\n\nThe first map is a bubble map, which we'll use to figure out where the matches took place.","9822fab8":"There is a clear downward trend, has football become boring?","ffd6fe5c":"There has been a recent drop in the number of international matches in February, April and August, which makes sense since February and April are very active months for clubs and the pre-season is in August. \n\nMarch, September, October and November usually are months having matches of the qualifiers, which explains the increase. \n\nJune and July are the months when the World Cup, Euro, Asian Cup and Copa America usually take place. But the next World Cup will be in November and December!","279ed6d6":"**Which teams have the best win ratio in major tournaments?**","afbd7e3d":"**How many matches per day of week?**\n\nWe've analyzed how international matches are spread over the various months of the year, now let's look at another dimension: days of the week.","df651ab8":"We should check if the above features were created correctly.","406e54bb":"To complement the data we already have, we will load the lists of teams belonging to each [FIFA confederation](https:\/\/en.wikipedia.org\/wiki\/List_of_football_federations#FIFA_Confederations).","d87508eb":"Uruguay is still a strong team, but its heyday was in the first competitions, from 1910s to 1940s. The same goes for Argentina from 1910s to 1950s. The first place in this decade that has just begun is explained by the last victory of the Copa Am\u00e9rica.\n\nThere are three temporal intervals of dominance of Brazil: 1910s to 1920s, 1940s to 1950s and 1990s to 2000s. Who can forget the Brazil of Ronaldo, Ronaldinho and Roberto Carlos?   \n\nMoving to European teams, Italy dominated the 30s by winning the 1934 and 1938 World Cups. Then they appear in the current decade with the second best win ratio, probably due to their recent [winning streak](https:\/\/www.uefa.com\/european-qualifiers\/news\/026d-132c3f1155e7-e4c679188d16-1000--italy-s-record-unbeaten-run\/) and the victory of the UEFA Euro 2020. \n\nAlso to highlight France in the 50s, 80s and 90s and Netherlands in the 80s. France won the World Cup in 1998, finished fourth in 1982 and third in 1986. Plus, they won the 1984 Euro. Netherlands won the UEFA Euro championship in 1988, their only international title so far.\n\nAnother team that will always remain in the hearts of football lovers is the Spain of Casillas, Xavi and Iniesta. They only appear in the above plot in the 2000s, but besides the Euro 2008 they won the Euro in 2012 and the World Cup in 2010.\n\nOther teams deserve mention, such as Ghana in the 60s and 90s, Egypt in the 2000s, Iran in the 70s and Saudi Arabia in the 80s, as they won competitions on their continents.\n\nEven though we've found some fantastic teams with this metric, it might not be the best. For example, as already mentioned, Germany are the most powerful European team and they don't appear here even once. Looking at the number of titles per decade should be a good addition to this analysis.","0604a71d":"<span style=\"font-size:2em;\">International football results from 1872 to 2021<\/span>\n\nThis dataset has over 42000 results from international men's football matches from 1972 to 2021. It includes different competitions like FIFA World Cup and friendly matches and is divided into two files: **results** and **shootouts**. \n\nThe **results** file is composed of the following variables:\n- **date** - date of the match.\n- **home_team** - the name of the home team.\n- **away_team** - the name of the away team.\n- **home_score** - full-time home team score including extra time, not including penalty-shootouts.\n- **away_score** - full-time away team score including extra time, not including penalty-shootouts.\n- **tournament** - the name of the tournament.\n- **city** - the name of the city\/town\/administrative unit where the match was played.\n- **country** - the name of the country where the match was played.\n- **neutral** - TRUE\/FALSE column indicating whether the match was played at a neutral venue.\n\nThe **shootouts** csv has 4 columns:\n- **date** - date of the match.\n- **home_team** - the name of the home team.\n- **away_team** - the name of the away team.\n- **winner** - winner of the penalty-shootout.","e6dae743":"One of the fiercest rivalries in the history of football stands on top: Brazil and Argentina. Note that 5 of the 10 teams are European: Germany, France, Portugal, Netherlands and Italy.\n\nThe United States, Iran and Nigeria aren't the teams with most titles in their regions but they usually go far, which explains the high win ratio.","17a1ed4c":"**Which are the best defending teams?**\n\nNow we are going to see which teams are more solid defensively.","5b3c3f5b":"There are two matches with teams in the wrong order in the **results.csv** file, it is necessary to correct them to merge results and shootouts."}}