{"cell_type":{"17ad540b":"code","5243274f":"code","5096a13e":"code","67b45cfd":"code","1c793e42":"code","36e11866":"code","9d481acc":"code","e4c47937":"code","60742b29":"code","ae50cb3a":"code","2fc22d63":"code","0dfa1d91":"code","9970207e":"code","8857e0f0":"code","b266936c":"code","19cba3dd":"code","37a408cf":"code","73a4728a":"code","1e02e0d4":"code","3dc345e9":"code","1180695f":"code","42b20fa4":"markdown","47436e21":"markdown","440f56cd":"markdown","0ac3c03e":"markdown","7857b1a9":"markdown","1cc25934":"markdown","d0784cb3":"markdown","9b7034fc":"markdown","8dc61933":"markdown","8bd42f11":"markdown","29a6c300":"markdown","9a6a434f":"markdown","e7d10da1":"markdown","23838557":"markdown","39a22be2":"markdown","2340d56f":"markdown","fd92e63e":"markdown","ca36c597":"markdown","12c78b02":"markdown","907f20b1":"markdown","b4ff59d8":"markdown"},"source":{"17ad540b":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session\nimport numpy as np\nimport pandas as pd\nimport seaborn as sns\n# Using plotly\nimport plotly.express as px\nimport plotly.graph_objects as go\nimport plotly.offline as pyo\npyo.init_notebook_mode()","5243274f":"data=pd.read_csv('..\/input\/coronavirus-top-cities-and-trending-searches\/United Kingdom.csv')\ndata.fillna('',inplace=True)\ndata.head()","5096a13e":"columns=list(data.columns)\n\ndef get_info(text):\n    a=text.split(',')\n    return {'town': a[0],'country':a[1]}\ndef get_date(text):\n    b=text.split(' ')\n    return b[0]\nfor i in range(0,len(columns),2):\n    data[columns[i]][1:]=data[columns[i]][1:].apply(lambda x:get_info(x))\nfor i in range(0,len(columns)):\n    data[columns[i]][0]=get_date(data[columns[i]][0])\ndata.head()    ","67b45cfd":"country=[]\nfor i in range(0,len(columns),2):\n    for j in range(1,data.shape[0]):\n        country.append(data[columns[i]][j]['country'])\n\ncountry=list(set(country))\n\ntown=[]\nfor i in range(0,len(columns),2):\n    for j in range(1,data.shape[0]):\n        town.append(data[columns[i]][j]['town'])\n\nl=list(set(town))\n\ndates=[]\nfor i in range(len(columns)):\n    dates.append(data[columns[i]][0])\n\ndates=list(set(dates))","1c793e42":"import itertools\ndata_=pd.DataFrame(columns=dates,index=l)\nc = list(itertools.product(dates, l))\nfor i in c:\n    for j in range(0,len(columns),2):\n        if data[columns[j]][0]==i[0]:\n            trend=[]\n            for k in range(1,data.shape[0]):\n                if data[columns[j]][k]['town']==i[1]:\n                    trend.append(data[columns[j+1]][k])\n                    \n            data_[i[0]][i[1]]=trend\n                    \n            \nfor j in data_.columns:\n    \n    data_[j] = data_[j].apply(lambda y: np.nan if y==[] or y==[''] else y)","36e11866":"data_","9d481acc":"df=data_.dropna(how='all',axis=0)\ndf.isnull().sum()\ndf=df[df.columns[df.isnull().sum()<470]]\ndf.fillna('',inplace=True)","e4c47937":"df=df.transpose()\ndf","60742b29":"df['Date']=df.index\ndf['Month_Name']=pd.DatetimeIndex((df['Date'])).month_name()\ndf.fillna('',inplace=True)\nlist_df=[]\nfor i in list(df.columns[:-2]):\n    df_monthly=df.groupby('Month_Name').agg({i: lambda x: list(x)}).reset_index()\n    list_df.append(df_monthly) \ndf_monthly_=pd.concat(list_df,axis=1,join='inner').drop('Month_Name',axis=1)\ndf_monthly_['Month']=df_monthly['Month_Name']\nfor i in list(df.columns[:-2]):\n    df_monthly_[i]=df_monthly_[i].apply(lambda t:[item for sublist in t for item in sublist])\ncategory=list(df.columns[:-2])\n\ndf_monthly_","ae50cb3a":"fig = go.Figure()\n\nfor i in range(len(df_monthly_['Month'])):\n    fig.add_trace(\n        go.Bar(\n            visible=False,\n            x=['1','2','3','4','5'], y=[2.5,2.5,2.5,2.5,2.5],\n            text=list(pd.Series(np.array(df_monthly_['Oadby'][i])).value_counts()[:5].index)\n            ))\nfig.data[0].visible = True\n\nsteps = []\nfor i in range(len(fig.data)):\n    step = dict(\n        method=\"update\",\n        args=[{\"visible\": [False] * len(fig.data)},\n              {\"title\": \"Townwise Search Trends: \" + str(df_monthly_['Month'][i])},\n              ],  # layout attribute     \n        label = df_monthly_['Month'][i]     \n    )\n    step[\"args\"][0][\"visible\"][i] = True  # Toggle i'th trace to \"visible\"\n    steps.append(step)\n\nsliders = [dict(\n    active=10,\n    currentvalue={\"prefix\": \"Month: \"},\n    pad={\"t\": 50},\n    steps=steps\n)]\n\nfig.update_traces(textposition='outside',hoverinfo='text')\nfig.update_traces(marker_color='white')\nfig.update_layout(plot_bgcolor='yellow')\nfig.update_traces(textfont_size=40)\n\nfig.update_yaxes(showticklabels=False, range=[0,8])\nfig.update_xaxes(showticklabels=False)\n\nfig.update_layout(\n    sliders=sliders,\n)\n\nbutton_dict =[]\nfor i in range(len(category)):\n    button = dict(\n        args=[\"text\",[\n            list(pd.Series(np.array(df_monthly_[category[i]][0])).value_counts()[:5].index),\n            list(pd.Series(np.array(df_monthly_[category[i]][1])).value_counts()[:5].index),\n            list(pd.Series(np.array(df_monthly_[category[i]][2])).value_counts()[:5].index),\n            \n                     ]],\n        label=category[i],\n        method=\"restyle\"\n    )\n    button_dict.append(button)\n\nfig.update_layout(\n    updatemenus=[\n        dict(\n            buttons= button_dict,\n            direction=\"down\",\n            pad={\"l\": 10, \"t\": 10},\n            showactive=True,\n            x=0.25,\n            xanchor=\"left\",\n            y=1.15,\n            yanchor=\"top\"\n            ),\n    ],\n)\nfig.update_layout(annotations=[\n                    dict(text='1', x=0, y=1.5, font_size=15, showarrow=False,bgcolor=\"#ff7f0e\"),\n                    dict(text='2', x=1, y=1.5, font_size=15, showarrow=False,bgcolor=\"#ff7f0e\"),\n                    dict(text='3', x=2, y=1.5, font_size=15, showarrow=False,bgcolor=\"#ff7f0e\"),\n                    dict(text='4', x=3, y=1.5, font_size=15, showarrow=False,bgcolor=\"#ff7f0e\"),\n                    dict(text='5', x=4, y=1.5, font_size=15, showarrow=False,bgcolor=\"#ff7f0e\"),\n\n])\n\nfig.update_traces(opacity = .9)\nfig.update_layout(title=\"Google Search Trends: August\",height=500)\n\n\nfig.show()","2fc22d63":"import itertools\ndata_2=pd.DataFrame(columns=dates,index=country)\nc = list(itertools.product(dates, country))\nfor i in c:\n    for j in range(0,len(columns),2):\n        if data[columns[j]][0]==i[0]:\n            trend=[]\n            for k in range(1,data.shape[0]):\n                if data[columns[j]][k]['country']==i[1]:\n                    if data[columns[j+1]][k]!='':\n                        trend.append(data[columns[j+1]][k]  )\n                    \n            data_2[i[0]][i[1]]=trend\n                    \nfor j in data_2.columns:\n    data_2[j] = data_2[j].apply(lambda y: np.nan if y==[] or y==[''] else y)\ndf_=data_2.transpose()\ndf_","0dfa1d91":"df_['Date']=df_.index\ndf_['Month_Name']=pd.DatetimeIndex((df_['Date'])).month_name()\ndf_.fillna('',inplace=True)\ndf_monthly_1=df_.groupby('Month_Name').agg({' Northern Ireland': lambda x: list(x)}).reset_index()\ndf_monthly_2=df_.groupby('Month_Name').agg({' Scotland': lambda x: list(x)}).reset_index()\ndf_monthly_3=df_.groupby('Month_Name').agg({' Wales': lambda x: list(x)}).reset_index()\ndf_monthly_4= df_.groupby('Month_Name').agg({' England': lambda x: list(x)}).reset_index()\ndf_monthly=pd.concat([df_monthly_3,df_monthly_2,df_monthly_1,df_monthly_4],axis=1,join='inner').drop('Month_Name',axis=1)\ndf_monthly['Month']=df_monthly_1['Month_Name']\ndf_monthly[' England']=df_monthly[' England'].apply(lambda t:[item for sublist in t for item in sublist])\ndf_monthly[' Wales']=df_monthly[' Wales'].apply(lambda t:[item for sublist in t for item in sublist])\ndf_monthly[' Scotland']=df_monthly[' Scotland'].apply(lambda t:[item for sublist in t for item in sublist])\ndf_monthly[' Northern Ireland']=df_monthly[' Northern Ireland'].apply(lambda t:[item for sublist in t for item in sublist])\ncategory=[' England', ' Wales', ' Scotland', ' Northern Ireland']","9970207e":"df_monthly","8857e0f0":"fig = go.Figure()\n\nfor i in range(len(df_monthly['Month'])):\n    fig.add_trace(\n        go.Bar(\n            visible=False,\n            x=['1','2','3','4','5'], y=[2.5,2.5,2.5,2.5,2.5],\n            text=list(pd.Series(np.array(df_monthly[' England'][i])).value_counts()[:5].index)\n            ))\nfig.data[0].visible = True\n\nsteps = []\nfor i in range(len(fig.data)):\n    step = dict(\n        method=\"update\",\n        args=[{\"visible\": [False] * len(fig.data)},\n              {\"title\": \"Country Wise Search Trends: \" + str(df_monthly['Month'][i])},\n              ],  # layout attribute     \n        label = df_monthly['Month'][i]     \n    )\n    step[\"args\"][0][\"visible\"][i] = True  # Toggle i'th trace to \"visible\"\n    steps.append(step)\n\nsliders = [dict(\n    active=10,\n    currentvalue={\"prefix\": \"Month: \"},\n    pad={\"t\": 50},\n    steps=steps\n)]\n\nfig.update_traces(textposition='outside',hoverinfo='text')\nfig.update_traces(marker_color='white')\nfig.update_layout(plot_bgcolor='yellow')\nfig.update_traces(textfont_size=40)\n\nfig.update_yaxes(showticklabels=False, range=[0,8])\nfig.update_xaxes(showticklabels=False)\n\nfig.update_layout(\n    sliders=sliders,\n)\n\nbutton_dict =[]\nfor i in range(len(category)):\n    button = dict(\n        args=[\"text\",[\n            list(pd.Series(np.array(df_monthly[category[i]][0])).value_counts()[:5].index),\n            list(pd.Series(np.array(df_monthly[category[i]][1])).value_counts()[:5].index),\n            list(pd.Series(np.array(df_monthly[category[i]][2])).value_counts()[:5].index),\n            \n                     ]],\n        label=category[i],\n        method=\"restyle\"\n    )\n    button_dict.append(button)\n\nfig.update_layout(\n    updatemenus=[\n        dict(\n            buttons= button_dict,\n            direction=\"down\",\n            pad={\"l\": 10, \"t\": 10},\n            showactive=True,\n            x=0.25,\n            xanchor=\"left\",\n            y=1.15,\n            yanchor=\"top\"\n            ),\n    ],\n)\nfig.update_layout(annotations=[\n                    dict(text='1', x=0, y=1.5, font_size=15, showarrow=False,bgcolor=\"#ff7f0e\"),\n                    dict(text='2', x=1, y=1.5, font_size=15, showarrow=False,bgcolor=\"#ff7f0e\"),\n                    dict(text='3', x=2, y=1.5, font_size=15, showarrow=False,bgcolor=\"#ff7f0e\"),\n                    dict(text='4', x=3, y=1.5, font_size=15, showarrow=False,bgcolor=\"#ff7f0e\"),\n                    dict(text='5', x=4, y=1.5, font_size=15, showarrow=False,bgcolor=\"#ff7f0e\"),\n\n])\n\n\nfig.update_traces(opacity = .9)\nfig.update_layout(title=\"Google Search Trends: August\",height=500)\n\n\nfig.show()","b266936c":"!pip install biterm\nimport nltk","19cba3dd":"a=[]\nfor i in df_[' England']:\n    for j in i:\n        a.append(j)","37a408cf":"from sklearn.feature_extraction.text import CountVectorizer\nfrom biterm.utility import vec_to_biterms, topic_summuary\nstpwrd = nltk.corpus.stopwords.words('english')\nnew_stopwords=['coronavirus','uk','cases','deaths','news','today']\nstpwrd.extend(new_stopwords)\nvec = CountVectorizer(stop_words=stpwrd)\nX = vec.fit_transform(a).toarray()\nfrom biterm.utility import vec_to_biterms\nvocab = np.array(vec.get_feature_names())\nbiterms = vec_to_biterms(X)\nfrom biterm.cbtm import oBTM\n\nbtm = oBTM(num_topics=10, V=vocab)\ntopics = btm.fit_transform(biterms, iterations=90)\n","73a4728a":"topic_summuary(btm.phi_wz.T, X, vocab, 20)","1e02e0d4":"for i in range(len(a)):\n    print(\"{} (topic: {})\".format(a[i], topics[i].argmax()))","3dc345e9":"topic=[]\nfor i in df_[' England']:\n    x=[]\n    for j in i:\n        for k in range(len(a)):\n            if j==a[k]:\n                x.append(topics[k].argmax())\n    topic.append(list(set(x)))","1180695f":"final_df=pd.DataFrame(index=df_.index)\n\nfinal_df['England']=df_[' England']\nfinal_df['Topic']=pd.Series(np.array(topic,dtype='object')).values\nfinal_df","42b20fa4":"# **Plotly Visualization of the monthly Town wise trends.**","47436e21":"**Looks like a lot of usable information but not in a much usable format.Let's do some transformations to make it usable for further analysis!**","440f56cd":"The resulting dataset df_monthly_ gives us the list of all the trending queries corresponding to the respective COUNTRIES in July,August and September.","0ac3c03e":"Note:For some instances the graph shows no searches ranked as they were the null values in the dataset","7857b1a9":"# **BITERM TOPIC MODELLING FOR ENGLAND SEARCH QUERIES**\n","1cc25934":"Importing packages\n","d0784cb3":"The resulting dataset **df_monthly_** gives us the list of all the trending queries corresponding to the respective towns in July,August and September.\n","9b7034fc":"  Extract the towns and country names","8dc61933":"# **A Similar Trend-Analysis Based on the Countries this time**","8bd42f11":"# **Plotly Visualization of the monthly Country wise trends.**","29a6c300":"# **TOWN-BASED Transformation**","9a6a434f":"This model is accurate in short text classification. It explicitly models the word co-occurrence patterns in the whole corpus to solve the problem of sparse word co-occurrence at document-level.","e7d10da1":"Let's Look At The Dataset first","23838557":"**We will classify the queries in 10 topics using a biterm topic model and specify the topics of the queries in the dataframe.**","39a22be2":"# **TOWN BASED MONTHLY SEARCH TRENDS ANALYSIS**","2340d56f":"# **COUNTRY BASED MONTHLY SEARCH TRENDS ANALYSIS**","fd92e63e":"\nCountry Based Transformation Of Dataset","ca36c597":"> Getting the list of the **unique** towns,country and dates from our dataset for further transformation","12c78b02":"**Transforming the dataset into a more usable format in which the Trending queries corresponding to a particular town and date are clearly identified.**","907f20b1":"* Here you can select the town from the dropdown to get the corresponding top searches \n* The slider can be used to toggle between the months and see the trends","b4ff59d8":"# **UNITED KINGDOM SEARCH TRENDS**"}}