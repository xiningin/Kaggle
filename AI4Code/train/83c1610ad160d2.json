{"cell_type":{"573a1068":"code","3e14dd83":"code","e3290402":"code","3c88a2fd":"code","d05de85a":"code","466682fa":"code","e4fd7d4f":"code","974b6656":"markdown","bccd2d70":"markdown","bbc61214":"markdown","577d3728":"markdown","4224fdf5":"markdown","7fc428e7":"markdown","79c3ecca":"markdown","072cd0f2":"markdown","18815e9a":"markdown","3be62f26":"markdown","af31687b":"markdown","64bbdc55":"markdown","4ddbedc6":"markdown","20b26c4d":"markdown","759f89ec":"markdown"},"source":{"573a1068":"import pandas as pd\nfrom PIL import Image, ImageStat\nimport numpy as np\nimport os\nimport glob\n\nimport cv2 \nimport matplotlib.pyplot as plt  \nimport seaborn as seabornInstance \nfrom sklearn.model_selection import train_test_split , GridSearchCV\nfrom sklearn.linear_model import LinearRegression, Ridge, Lasso\nfrom sklearn.ensemble import RandomForestRegressor \nfrom sklearn import metrics\nfrom sklearn.metrics import mean_squared_error\n%matplotlib inline\n\nfrom xgboost import XGBRegressor\nfrom xgboost import plot_tree\nfrom sklearn.model_selection import train_test_split #cannot use train test split as data is time series\nfrom sklearn.metrics import mean_squared_error\nfrom xgboost import plot_importance\nimport seaborn as sns\n\nfrom statsmodels.tsa.ar_model import AR","3e14dd83":"Crude_oil_trend=pd.read_csv('..\/input\/ntt-data-global-ai-challenge-06-2020\/Crude_oil_trend.csv')\nCrude_oil_trend.index=Crude_oil_trend.iloc[:,0]\nCrude_oil_trend.drop(columns=['Date'],inplace=True)\nCrude_oil_trend.tail()","e3290402":"Train_data=pd.read_csv('..\/input\/ntt-data-global-ai-challenge-06-2020\/COVID-19_and_Price_dataset.csv')\nTrain_data.index=Train_data.iloc[:,0]\nTrain_data.drop(columns=['Date'],inplace=True)\nTrain_data.tail()","3c88a2fd":"fig, axs = plt.subplots(1,2)\naxs[0].set_title('Price')\naxs[0].plot('Price', data=Train_data, marker='', color='skyblue', linewidth=2)\naxs[1].set_title('World Total Cases')\naxs[1].plot('World_total_cases', data=Train_data, marker='', color='olive', linewidth=2)","d05de85a":"plt.figure(figsize=(40,40))\nplt1 = sns.heatmap(Train_data.corr())\nplt1.plot()","466682fa":"a=glob.glob(r\"..\/input\/ntt-data-global-ai-challenge-06-2020\\NTL-dataset\\tif\\*.tif\")\nbrightness_array=[]\nfor i in a:\n    image = Image.open(i).convert('L')\n    stat = ImageStat.Stat(image)\n    brightness_array.append(stat.mean[0])","e4fd7d4f":"brightness_array=pd.Series(brightness_array)\nbrightness_array.to_excel('brightness_array.xls')","974b6656":"Now, in order to derive significant information from the night-time light satellite images, we use mean of pixel values as an index of brightness per image. We do not use the images geographically since they are already classifed into countries and evaluating prices deeper than country-level would complicate the model.  ","bccd2d70":"For the testing set, we built a mock up dataset of all these values with some values forecast. For France, Italy and China, we used linear time series forecasting. Since the United States has followed an exponential curve when it comes to Covid cases, we used exponential smoothing (ETS) to forecast the numbers for the US from July 15-August 21. We used WHO data from July 6-July 14. ","bbc61214":"Then, we rescaled all the numerical values. This included all the values except the date variable. This was done so that all the numbers could be fit into the model on an even scale. Next, we created a model based on 70\/15\/15 split between Training, Testing and Validation sets. We explored several models,and eventually decided to go with the one that yeilded the best RMSE. These were the neural net model and the linear regression. Here's a look at some of the evaluation metrics on the linear regression model:\n\n![Linear_metrics.PNG](attachment:Linear_metrics.PNG)","577d3728":"From the above image, we can infer the following:\n\n\n\t\n1. Over the period from Jan 2020 up until now, as cases soar and crude oil price decreases, night time light intensity exhibits an abberant decreasing trend with a supposed seasonality factor.\n2.\tAll four countries' night time light intensity exhibits similar seasonality and trend\n3. Night time light intensity of USA is higher in the initial phase, however drops below other countries in recent times. This seems logical as Covid-19 cases in China, France and Italy grew much rapidly initially as compared to USA which grew recently.\n4. This implies, more the cases, lower the light intensity, leading to drop in economy, hence lower the oil prices.","4224fdf5":"Now, adding the brightness index as 4 new columns for China, France, Italy and USA, to the training data set. Also, manipulating, indices for incorporating missing data using indices of former and latter dates around dates of images with missing data.","7fc428e7":"Now, drawing a correlation between all features in the Training Data set using a heat map","79c3ecca":"![NTL.PNG](attachment:NTL.PNG)","072cd0f2":"****Model Creation****\n\n\nSince this starting dataset was too large, we decided to connect it to the light features by restricting it to the countries in question. So, the features included new cases, new deaths, total cases and total deaths for China, France, Italy and the United States. We also factored in the brightness factors of each day and each country. Our smaller dataset for modelling purposes was chosen to limit covariance of the many countries and their factors. A simple correlation analysis yielded these results: \n![Correlations.PNG](attachment:Correlations.PNG)","18815e9a":"Many of the features seem significant from the above heat map. Due to a large number of features, we shall subsequently use machine learning models that pick the best features or shall use a reduced training data set.   ","3be62f26":"To find the best model, we also ran a neural network model, with a very high pseudo R square. ![Neural%20Net_Rsquare.PNG](attachment:Neural%20Net_Rsquare.PNG)","af31687b":"Importing COVID-19_and_Price_dataset as Training Data","64bbdc55":"Plotting Price and World Total Cases to draw a correlation between the two.\nAs expected, increase in World Total Covid-19 Cases lead to decline in Crude Oil Prices.","4ddbedc6":"Importing all necessary packages","20b26c4d":"Then, we used this test dataset and deployed our two best models on it (Neural Net and Linear Regression) to get the values for prices.","759f89ec":"Importing Crude Oil Data"}}