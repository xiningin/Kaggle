{"cell_type":{"729d40d2":"code","5f89aa3c":"code","9cd83b00":"code","3dab83d0":"code","a1198258":"code","21bfddad":"code","98bd3cc7":"code","cd572ca6":"code","ee8c5762":"code","54770deb":"code","7840394f":"code","b5011312":"code","bab5f513":"code","4329dfd8":"code","b685ac7d":"code","fd94c81c":"code","02a10a48":"code","6f2b0709":"code","dfe82434":"code","26365c45":"code","a626ccc3":"code","34169d7b":"code","99cd1d5b":"code","4b7ee574":"code","03425e14":"code","dfdb0424":"code","2c146150":"code","5690784f":"code","9649806e":"code","80d1cd8a":"code","19e6077e":"code","fc180e2c":"code","3690bd83":"code","087a99d3":"code","322e0fcb":"code","023e276d":"code","a75e3985":"code","bd005dce":"code","5ef9183b":"code","40e1ef7a":"code","6383234e":"code","9886935c":"code","8c855edf":"code","c66841e4":"code","938102d1":"code","c0c00d9d":"code","600f928b":"code","897ed28e":"code","fc562558":"code","86302ebc":"code","eda29ee3":"code","008dbc92":"code","03b98619":"code","ddfc189b":"code","ba989f37":"code","d7daea0a":"code","407a36be":"code","7958248b":"code","f93555e0":"code","fe60ff47":"code","efc4b23e":"code","090b53bf":"code","2989adf2":"code","ded4e42b":"code","c96bbc1f":"code","8826045d":"code","7eb26d65":"code","ad8cd580":"code","3109e20e":"markdown","d147b918":"markdown","c90d4655":"markdown"},"source":{"729d40d2":"import numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport warnings\nimport numpy as np\nimport random\nfrom scipy.stats import zscore\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.metrics import mean_squared_error\n\nfrom xgboost import XGBRegressor\nfrom sklearn.ensemble import AdaBoostRegressor\nfrom catboost import CatBoostRegressor\nfrom lightgbm import LGBMRegressor\nwarnings.filterwarnings(\"ignore\")\nfrom pandas_profiling import ProfileReport\nplt.ion()","5f89aa3c":"def set_seed(seed=42):\n    random.seed(seed)\n    np.random.seed(seed)","9cd83b00":"set_seed()","3dab83d0":"df=pd.read_csv(\"..\/input\/beyond-analysis\/train.csv\")\ndf","a1198258":"df.describe()","21bfddad":"df.info()","98bd3cc7":"sns.distplot(x=df[\"Y1\"])","cd572ca6":"profile = ProfileReport(df, title=\"Pandas Profiling Report\")\nprofile","ee8c5762":"sns.distplot(x=df[\"Y2\"])","54770deb":"sns.countplot(x=\"STATUS_CHECK\", data=df)\nplt.show()","7840394f":"sns.countplot(x=\"CATEGORY_1\", data=df)\nplt.show()","b5011312":"sns.countplot(x=\"CATEGORY_2\", data=df)\nplt.show()","bab5f513":"sns.countplot(x=\"ACTIVE_YN\", data=df)\nplt.show()","4329dfd8":"df[\"DEPOSIT_TRAILS\"].nunique()","b685ac7d":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"DEPOSIT_TRAILS\")\nsns.distplot(x=df[\"DEPOSIT_TRAILS\"],ax=ax[0])\nax[1].set_title(\"DEPOSIT_TRAILS Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"DEPOSIT_TRAILS\"],0.25)), ax=ax[1])\nplt.show()","fd94c81c":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"REVENUE\")\nsns.distplot(x=df[\"REVENUE\"],ax=ax[0])\nax[1].set_title(\"REVENUE Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"REVENUE\"],0.25)), ax=ax[1])\nplt.show()","02a10a48":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"WINNINGS_1\")\nsns.distplot(x=df[\"WINNINGS_1\"],ax=ax[0])\nax[1].set_title(\"WINNINGS_1 Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"WINNINGS_1\"],0.25)), ax=ax[1])\nplt.show()","6f2b0709":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"WINNINGS_2\")\nsns.distplot(x=df[\"WINNINGS_2\"],ax=ax[0])\nax[1].set_title(\"WINNINGS_2 Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"WINNINGS_2\"],0.25)), ax=ax[1])\nplt.show()","dfe82434":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"DISCOUNT\")\nsns.distplot(x=df[\"DISCOUNT\"],ax=ax[0])\nax[1].set_title(\"DISCOUNT Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"DISCOUNT\"],0.1)), ax=ax[1])\nplt.show()","26365c45":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"DEPOSIT\")\nsns.distplot(x=df[\"DEPOSIT\"],ax=ax[0])\nax[1].set_title(\"DEPOSIT Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"DEPOSIT\"],0.25)), ax=ax[1])\nplt.show()","a626ccc3":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"WITHDRAW\")\nsns.distplot(x=df[\"WITHDRAW\"],ax=ax[0])\nax[1].set_title(\"WITHDRAW Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"WITHDRAW\"],0.25)), ax=ax[1])\nplt.show()","34169d7b":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"ENTRY_NUMBER\")\nsns.distplot(x=df[\"ENTRY_NUMBER\"],ax=ax[0])\nax[1].set_title(\"ENTRY_NUMBER Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"ENTRY_NUMBER\"],0.25)), ax=ax[1])\nplt.show()","99cd1d5b":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"WINNINGS_NUMBER\")\nsns.distplot(x=df[\"WINNINGS_NUMBER\"],ax=ax[0])\nax[1].set_title(\"WINNINGS_NUMBER Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"WINNINGS_NUMBER\"],0.25)), ax=ax[1])\nplt.show()","4b7ee574":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"PRACTICE_ENTRY\")\nsns.distplot(x=df[\"PRACTICE_ENTRY\"],ax=ax[0])\nax[1].set_title(\"PRACTICE_ENTRY Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"PRACTICE_ENTRY\"],0.25)), ax=ax[1])\nplt.show()","03425e14":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"PRACTICE_WINNINGS\")\nsns.distplot(x=df[\"PRACTICE_WINNINGS\"],ax=ax[0])\nax[1].set_title(\"PRACTICE_WINNINGS Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"PRACTICE_WINNINGS\"],0.25)), ax=ax[1])\nplt.show()","dfdb0424":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"PRACTICE_ENTRY_NUMBER\")\nsns.distplot(x=df[\"PRACTICE_ENTRY_NUMBER\"],ax=ax[0])\nax[1].set_title(\"PRACTICE_ENTRY_NUMBER Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"PRACTICE_ENTRY_NUMBER\"],0.25)), ax=ax[1])\nplt.show()","2c146150":"plt.rcParams['figure.figsize'] = [14,7]\nfig,ax=plt.subplots(1,2)\nax[0].set_title(\"PRACTICE_WINNINGS_NUMBER\")\nsns.distplot(x=df[\"PRACTICE_WINNINGS_NUMBER\"],ax=ax[0])\nax[1].set_title(\"PRACTICE_WINNINGS_NUMBER Transformed\")\nsns.distplot(x=np.log(1+np.power(df[\"PRACTICE_WINNINGS_NUMBER\"],0.25)), ax=ax[1])\nplt.show()","5690784f":"sns.jointplot(data=df, y=\"REVENUE\", x=\"Y1\")","9649806e":"sns.jointplot(data=df, y=\"REVENUE\", x=\"Y2\")","80d1cd8a":"categorical_variables=[\"STATUS_CHECK\", \"CATEGORY_1\", \"CATEGORY_2\", \"ACTIVE_YN\"]","19e6077e":"le_cat1=LabelEncoder()\nle_cat1.fit(df[\"CATEGORY_1\"])","fc180e2c":"le_cat2=LabelEncoder()\nle_cat2.fit(df[\"CATEGORY_2\"])","3690bd83":"continuous_variables=[\"REVENUE\", \"WINNINGS_1\", \"DEPOSIT_2\", \"DISCOUNT\", \"DEPOSIT\", \"WITHDRAW\", \"ENTRY_NUMBER\", \"ENTRY_NUMBER\", \"WINNINGS_NUMBER\"]","087a99d3":"df[\"CATEGORY_1\"]=le_cat1.transform(df[\"CATEGORY_1\"])\ndf[\"CATEGORY_2\"]=le_cat2.transform(df[\"CATEGORY_2\"])","322e0fcb":"df=df.groupby([\"UNIQUE_IDENTIFIER\"]).mean().reset_index(drop=True)\ndf","023e276d":"num_bins = int(np.floor(1 + np.log2(len(df)))) \ndf.loc[:, \"bins\"] = pd.cut(df[\"Y2\"], bins=num_bins, labels=False)","a75e3985":"trans_df=df","bd005dce":"for col in continuous_variables:\n    trans_df[f\"t_{col}\"]=np.log(1+np.power(df[col],0.25))","5ef9183b":"drop_cols=[\"SEQUENCE_NO\", \"PRACTICE_ENTRY\", \"PRACTICE_WINNINGS\", \"PRACTICE_ENTRY_NUMBER\", \"PRACTICE_WINNINGS_NUMBER\", \"CATEGORY_1\", \"CATEGORY_2\"]","40e1ef7a":"trans_df=trans_df.drop(columns=continuous_variables+drop_cols,axis=1)","6383234e":"trans_df.head()","9886935c":"sns.heatmap(trans_df.corr(),annot=True)","8c855edf":"train_df,val_df=train_test_split(trans_df,test_size=0.26,stratify=trans_df[\"bins\"])","c66841e4":"y1_train=train_df[\"Y1\"].values\ny1_val=val_df[\"Y1\"].values\ny2_train=train_df[\"Y2\"].values\ny2_val=val_df[\"Y2\"].values","938102d1":"X_train=train_df.drop(columns=[\"Y1\",\"Y2\",\"bins\"]).values\nX_val=val_df.drop(columns=[\"Y1\",\"Y2\",\"bins\"]).values","c0c00d9d":"xgb1=XGBRegressor(n_estimators=600, max_depth=8 ,verbosity=0,learning_rate=0.15)\nxgb1.fit(X_train,y1_train)","600f928b":"pred_val=xgb1.predict(X_val)","897ed28e":"mean_squared_error(y1_val, pred_val, squared=False)","fc562558":"xgb2=XGBRegressor()\nxgb2.fit(X_train,y2_train)\npred_val=xgb2.predict(X_val)\nmean_squared_error(y2_val, pred_val, squared=False)","86302ebc":"test_df=pd.read_csv(\"..\/input\/beyond-analysis\/test.csv\")\ntest_df","eda29ee3":"test_df=test_df.groupby([\"UNIQUE_IDENTIFIER\"]).mean()","008dbc92":"print(len(test_df))","03b98619":"for col in continuous_variables:\n    test_df[f\"t_{col}\"]=np.log(1+np.power(test_df[col],0.2))","ddfc189b":"test_df.head()","ba989f37":"drop_cols_test=[\"SEQUENCE_NO\", \"PRACTICE_ENTRY\", \"PRACTICE_WINNINGS\", \"PRACTICE_ENTRY_NUMBER\", \"PRACTICE_WINNINGS_NUMBER\"]","d7daea0a":"test_df=test_df.drop(columns=continuous_variables+drop_cols_test,axis=1)","407a36be":"test_df.head()","7958248b":"X_test=test_df.values\ny1_pred_xgb=xgb1.predict(X_test)\ny2_pred_xgb=xgb2.predict(X_test)","f93555e0":"ids=list(test_df.index)","fe60ff47":"cat2=CatBoostRegressor(depth=8, learning_rate=0.15)\ncat2.fit(X_train,y2_train,eval_set=(X_val,y2_val))\npred_val=cat2.predict(X_val)\nmean_squared_error(y2_val, pred_val, squared=False)","efc4b23e":"cat1=CatBoostRegressor(depth=5, learning_rate=0.05)\ncat1.fit(X_train,y1_train,eval_set=(X_val,y1_val))\npred_val=cat1.predict(X_val)\nmean_squared_error(y1_val, pred_val, squared=False)","090b53bf":"X_test=test_df.values\ny1_pred_cat=cat1.predict(X_test)\ny2_pred_cat=cat2.predict(X_test)","2989adf2":"lgbm2=LGBMRegressor()\nlgbm2.fit(X_train,y2_train,eval_set=(X_val,y2_val))\npred_val=lgbm2.predict(X_val)\nmean_squared_error(y2_val, pred_val, squared=False)","ded4e42b":"lgbm1=LGBMRegressor()\nlgbm1.fit(X_train,y1_train,eval_set=(X_val,y1_val))\npred_val=lgbm1.predict(X_val)\nmean_squared_error(y1_val, pred_val, squared=False)","c96bbc1f":"X_test=test_df.values\ny1_pred_lgbm=lgbm1.predict(X_test)\ny2_pred_lgbm=lgbm2.predict(X_test)\n","8826045d":"y1_pred = (y1_pred_xgb +  y1_pred_cat +  y1_pred_lgbm)\/3\ny2_pred = (y2_pred_xgb +  y2_pred_cat +  y2_pred_lgbm)\/3","7eb26d65":"ids=list(test_df.index)\nsub=pd.DataFrame(columns=[\"UNIQUE_IDENTIFIER\",\"Y1\",\"Y2\"])\nsub[\"UNIQUE_IDENTIFIER\"]=ids\nsub[\"Y1\"]=np.clip(y1_pred,0,1e9)\nsub[\"Y2\"]=np.clip(y2_pred,0,1e9)\nsub.head()","ad8cd580":"sub.to_csv(\"submission.csv\",index=None)","3109e20e":"# XGBOOST","d147b918":"# CATBOOST","c90d4655":"# LGBM"}}