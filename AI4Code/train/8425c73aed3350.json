{"cell_type":{"96a239ce":"code","aed9cf5e":"code","66192d1b":"code","c6aa2f17":"code","3b304aba":"code","47782021":"code","ceaac2a2":"code","9c58d513":"code","5308bcf4":"code","0b75ecbc":"code","0ebdd5a9":"code","1bb19fb0":"code","7b0a4e78":"code","9037711c":"code","c4c8b094":"code","d86ca081":"code","7e93c960":"code","41c35521":"code","08e19b10":"code","b3b028f3":"code","a4d345db":"code","328fb0ad":"code","90bc1c5e":"code","0f2970a5":"code","c8e0e571":"code","9c08ec00":"code","6a9734d1":"code","2d65aa05":"code","cbc42e4d":"code","5d889aa5":"code","cedb8a05":"code","271567d5":"code","998a7ab1":"code","1ce24111":"code","14f848ec":"code","de28ed2a":"code","785bc33d":"code","135321b2":"code","08f2699b":"code","48c31c15":"code","931e69f0":"code","1db76536":"code","1ad1a7aa":"code","c1e4ffce":"code","2fd946b0":"code","1892468a":"code","dbf10f1e":"code","30d74843":"code","4ee311c5":"code","fa7a05fd":"code","30d1ff0e":"code","d50fe3cf":"code","7cfb4176":"markdown","bdbb84c1":"markdown","5e9400a1":"markdown","b5f71b33":"markdown","ffde20bf":"markdown","b6c226ad":"markdown","bc8797ac":"markdown","c87de295":"markdown","f8f4800b":"markdown","2bee6456":"markdown","67e064b2":"markdown","d3ee140c":"markdown","2bd9defa":"markdown","45ea26c1":"markdown","e8f1b493":"markdown","448aa8af":"markdown","f98db21d":"markdown","4d53b359":"markdown","fc616781":"markdown","7ca583bc":"markdown","1057883b":"markdown","8cf68a52":"markdown","f842264e":"markdown","9a42a0f8":"markdown","afa9da04":"markdown","a29db621":"markdown","47291ed4":"markdown","a8ffa358":"markdown","cd33d946":"markdown","fe9cf67c":"markdown","8a43cc0b":"markdown","0a91c3e9":"markdown","a70a8ace":"markdown","85c194fc":"markdown"},"source":{"96a239ce":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n# pd.set_option('display.max_rows', None)\nimport gc\nimport os\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.model_selection import KFold\nfrom sklearn.metrics import roc_auc_score\nfrom sklearn.linear_model import LogisticRegression\nimport random\nimport cv2\n\n","aed9cf5e":"base_data_folder = \"..\/input\/siim-isic-melanoma-classification\"\n","66192d1b":"def read_train():\n    train=pd.read_csv('..\/input\/siim-isic-melanoma-classification\/train.csv')\n    print('Train set : Total Images are {} and columns are {}'.format(train.shape[0], train.shape[1])) \n    return train\n\ndef read_test():\n    test=pd.read_csv('..\/input\/siim-isic-melanoma-classification\/test.csv')\n    print('Train set : Total Images are {} and columns are {}'.format(test.shape[0], test.shape[1])) \n    return test\n\ntrain_df = read_train()\ntest_df = read_test()","c6aa2f17":"train_df.tail(5)","3b304aba":"test_df.tail(5)","47782021":"import os\nprint(os.listdir(\"..\/input\/siim-isic-melanoma-classification\"))","ceaac2a2":"\nfolder_path = os.path.join(base_data_folder, \"jpeg\")\nall_data = os.listdir(folder_path)\nfor folders in all_data:\n    files_in_path = os.path.join(folder_path, folders)\n    count = len([cnt for cnt in os.scandir(files_in_path)])\n    print('Jpeg Images from {} are : {}'.format(files_in_path, count)) \n    print(\"Size is \" + str(round(os.path.getsize(files_in_path) \/ 1000000, 2)) + 'MB')\n\n    \n\ntrain_folder_path = os.path.join(base_data_folder, \"train\")\ncount = len([cnt for cnt in os.scandir(train_folder_path)])\nprint('\\n\\nDICOM Images from {} are : {}'.format(train_folder_path, count)) \nprint(\"Size is \" + str(round(os.path.getsize(train_folder_path) \/ 1000000, 2)) + 'MB')\n\n\ntest_folder_path = os.path.join(base_data_folder, \"test\")\ncount = len([cnt for cnt in os.scandir(test_folder_path)])\nprint('DICOM Images from {} are : {}'.format(test_folder_path, count)) \nprint(\"Size is \" + str(round(os.path.getsize(test_folder_path) \/ 1000000, 2)) + 'MB')\n\n\n\n\ntf_folder_path = os.path.join(base_data_folder, \"tfrecords\")\ncount = len([cnt for cnt in os.scandir(tf_folder_path)])\nprint('\\n\\ntfrecords from {} are : {}'.format(tf_folder_path, count)) \n","9c58d513":"train_df.info()","5308bcf4":"train_df.isna().sum()","0b75ecbc":"test_df.info()","0ebdd5a9":"test_df.isna().sum()","1bb19fb0":"train_df[train_df.sex.isna() == True]","7b0a4e78":"train_df[train_df.sex.isna() == True].patient_id.unique()\n","9037711c":"train_df[train_df.age_approx.isna() == True].patient_id.unique()\n","c4c8b094":"train_df[train_df.anatom_site_general_challenge.isna() == True].patient_id.count()\n","d86ca081":"train_df[train_df.anatom_site_general_challenge.isna() == True].patient_id.unique()\n","7e93c960":"train_df['anatom_site_general_challenge'].value_counts(normalize=True).sort_values().plot(kind='bar')\n","41c35521":"train_df.head()","08e19b10":"for cols in train_df.columns:\n    if (cols != 'patient_id') and (cols != 'image_name'):\n        plt.figure()\n        train_df[cols].value_counts().head(10).plot(kind='bar',title=cols)","b3b028f3":"# 1. Which gender is highly impacted? \n# 2. Which age people highly impacted?\n# 3. by location where issue comes in?\n# 4. what daignosis been done to them?","a4d345db":"temp=train_df.groupby(['target','sex'])['benign_malignant'].count().to_frame().reset_index()\nsns.catplot(x='target',y='benign_malignant', hue='sex',data=temp,kind='bar')","328fb0ad":"sns.stripplot(x=\"sex\", y=\"age_approx\", hue=\"benign_malignant\", data=train_df,jitter=0.20);","90bc1c5e":"temp=train_df.groupby(['anatom_site_general_challenge','sex','benign_malignant'])['target'].count().to_frame().reset_index()\ntemp","0f2970a5":"temp=train_df.groupby(['anatom_site_general_challenge','sex','benign_malignant','diagnosis'])['target'].count().to_frame().reset_index()\ntemp","c8e0e571":"train_df.head()","9c08ec00":"def show_images(df, base_data_folder, what_to_show):\n    n_row, n_col = 3,3\n    img_dir = base_data_folder+what_to_show\n    \n    _, axs = plt.subplots(n_row, n_col, figsize=(10, 10))\n    axs = axs.flatten()\n    \n    for ax in axs:\n        random_image = np.random.choice(df+'.jpg')\n        img = cv2.imread(os.path.join(img_dir, random_image),cv2.IMREAD_COLOR)\n        ax.imshow(img)\n    plt.show()\n    plt.tight_layout()  \n    \n    \n    cv2.waitKey(0)\n    cv2.destroyAllWindows()\n    gc.collect()","6a9734d1":"what_to_show = \"\/jpeg\/train\"\nwhat_images = train_df[train_df['benign_malignant'] == 'benign']['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)\n\n","2d65aa05":"what_to_show = \"\/jpeg\/train\"\nwhat_images = train_df[train_df['benign_malignant'] == 'malignant']['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)","cbc42e4d":"what_to_show = \"\/jpeg\/train\"\nwhat_images = train_df[(train_df['benign_malignant'] == 'benign') & (train_df['sex'] == 'male')]['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)\n","5d889aa5":"what_to_show = \"\/jpeg\/train\"\nwhat_images = train_df[(train_df['benign_malignant'] == 'benign') & (train_df['sex'] == 'female')]['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)\n","cedb8a05":"what_to_show = \"\/jpeg\/train\"\nwhat_images = train_df[(train_df['benign_malignant'] == 'malignant') & (train_df['sex'] == 'male')]['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)","271567d5":"what_to_show = \"\/jpeg\/train\"\nwhat_images = train_df[(train_df['benign_malignant'] == 'malignant') & (train_df['sex'] == 'female')]['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)","998a7ab1":"train_df.head(5)","1ce24111":"train_df['anatom_site_general_challenge'].value_counts()","14f848ec":"what_to_show = \"\/jpeg\/train\"\nwhat_images = train_df[(train_df['benign_malignant'] == 'benign') & (train_df['anatom_site_general_challenge'] == 'oral\/genital')]['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)","de28ed2a":"what_to_show = \"\/jpeg\/train\"\nwhat_images = train_df[(train_df['benign_malignant'] == 'malignant') & (train_df['anatom_site_general_challenge'] == 'oral\/genital')]['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)","785bc33d":"what_to_show = \"\/jpeg\/train\"\nwhat_images = train_df[(train_df['benign_malignant'] == 'benign') & (train_df['anatom_site_general_challenge'] == 'palms\/soles')]['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)","135321b2":"what_to_show = \"\/jpeg\/train\"\nwhat_images = train_df[(train_df['benign_malignant'] == 'malignant') & (train_df['anatom_site_general_challenge'] == 'palms\/soles')]['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)","08f2699b":"what_to_show = \"\/jpeg\/train\"\nwhat_images = train_df[(train_df['benign_malignant'] == 'benign') & (train_df['anatom_site_general_challenge'] == 'head\/neck')]['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)","48c31c15":"what_to_show = \"\/jpeg\/train\"\nwhat_images = train_df[(train_df['benign_malignant'] == 'malignant') & (train_df['anatom_site_general_challenge'] == 'head\/neck')]['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)","931e69f0":"what_to_show = \"\/jpeg\/train\"\nwhat_images = train_df[(train_df['benign_malignant'] == 'benign') & (train_df['anatom_site_general_challenge'] == 'upper extremity')]['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)","1db76536":"what_to_show = \"\/jpeg\/train\"\nwhat_images = train_df[(train_df['benign_malignant'] == 'malignant') & (train_df['anatom_site_general_challenge'] == 'upper extremity')]['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)","1ad1a7aa":"what_to_show = \"\/jpeg\/train\"\nwhat_images = train_df[(train_df['benign_malignant'] == 'benign') & (train_df['anatom_site_general_challenge'] == 'lower extremity')]['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)","c1e4ffce":"what_to_show = \"\/jpeg\/train\"\nwhat_images = train_df[(train_df['benign_malignant'] == 'malignant') & (train_df['anatom_site_general_challenge'] == 'lower extremity')]['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)","2fd946b0":"what_to_show = \"\/jpeg\/train\"\nwhat_images = train_df[(train_df['benign_malignant'] == 'benign') & (train_df['anatom_site_general_challenge'] == 'torso')]['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)","1892468a":"what_to_show = \"\/jpeg\/train\"\nwhat_images = train_df[(train_df['benign_malignant'] == 'malignant') & (train_df['anatom_site_general_challenge'] == 'torso')]['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)","dbf10f1e":"train_df.head()","30d74843":"malignant_images = train_df[train_df['benign_malignant'] == 'malignant']","4ee311c5":"what_to_show = \"\/jpeg\/train\"\nwhat_images = malignant_images['image_name'].values\nshow_images(what_images, base_data_folder, what_to_show)\n\n","fa7a05fd":"# import numpy \n# from matplotlib import pyplot as plt\n\n# def gaussian_kernel(size, size_y=None):\n#     size = int(size)\n#     if not size_y:\n#         size_y = size\n#     else:\n#         size_y = int(size_y)\n#     x, y = numpy.mgrid[-size:size+1, -size_y:size_y+1]\n#     g = numpy.exp(-(x**2\/float(size)+y**2\/float(size_y)))\n#     return g \/ g.sum()","30d1ff0e":"# malignant_images.groupby(['sex','age_approx'])['target'].value_counts()\n\nfile_path = \"..\/input\/siim-isic-melanoma-classification\/\/jpeg\/train\/ISIC_0080817.jpg\"\nimg = cv2.imread(file_path,cv2.IMREAD_COLOR)\n\nkernel = np.ones((3,3), np.float32) \/ 9\nfilt_2D = cv2.filter2D(img, -1, kernel)\nblur = cv2.blur(img,(3,3))\ngaussian_blur = cv2.GaussianBlur(img, (3,3),0)\nmedian_blur = cv2.medianBlur(img, 3)\nbilateral_blur = cv2.bilateralFilter(img, 9, 75, 75)\n\nn_row, n_col = 2,3\n\n_, axs = plt.subplots(n_row, n_col, figsize=(11, 5))\naxs = axs.flatten()\n    \naxs[0].imshow(img)\naxs[1].imshow(filt_2D)\naxs[2].imshow(blur)\naxs[3].imshow(gaussian_blur)\naxs[4].imshow(median_blur)\naxs[5].imshow(bilateral_blur)\n\n\n\n","d50fe3cf":"# malignant_images.groupby(['sex','age_approx'])['target'].value_counts()\n\nimg = cv2.imread(file_path,cv2.IMREAD_COLOR)\nimg_edges = cv2.Canny(img, 75, 75)\n\n\nn_row, n_col = 1,2\n\n_, axs = plt.subplots(n_row, n_col, figsize=(11, 5))\naxs = axs.flatten()\n    \naxs[0].imshow(img)\naxs[1].imshow(img_edges)\n\n\n\n","7cfb4176":"# **Which gender is highly impacted?**","bdbb84c1":"# **Lets see if we have any noise on the image we process**","5e9400a1":"# **How Malignant Mole and skin tone looks like**","b5f71b33":"# **Work in progress**","ffde20bf":"# **What features impact the target variable. **","b6c226ad":"# **How Benign skin tone and the mole looks like**","bc8797ac":"# **How Melanoma looks when it affects by gender (Benign - female)**","c87de295":"# **Removing Noise from Malignant Melanomas\n# in what segments milanoma categorized\n# **","f8f4800b":"# **How Melanoma looks when it affects by gender (malignant - female)**","2bee6456":"# **Lets see how the edge looks like**","67e064b2":"# **How many images in each directory?**","d3ee140c":"> **Train Dataset** : Has Missing values on Sex, age_approx, anatom_site_general_challenge\n\n\n> **Test Dataset** : Has missing values on anatom_site_general_challenge\n> ","2bd9defa":"# **Where infection grows by gender**","45ea26c1":"# **Lets see typically where skin issue develops across patients**","e8f1b493":"# **Which age people are highly impacted?**","448aa8af":"# **How it looks when the impact happens on torso (Benign vs Malignant)**","f98db21d":"# **So whats the missing values all about?**","4d53b359":"# # **Initial Intuitions**\n\n\n> how benign vs malignant mole looks like? \n\n> how mole varies between locations and how it looks in real world?\n\n> how similar it is between gender?\n","fc616781":"# **How it looks when the impact happens on upper extremity (Benign vs Malignant)**","7ca583bc":"# **How Melanoma looks when it affects by gender (malignant - male)**","1057883b":"# **Goal of this competition:**\n> > \n> > Currently, dermatologists evaluate every one of a patient's moles to identify outlier lesions or \u201cugly ducklings\u201d that are most likely to be melanoma. Existing AI approaches have not adequately considered this clinical frame of reference. Dermatologists could enhance their diagnostic accuracy if detection algorithms take into account \u201ccontextual\u201d images within the same patient to determine which images represent a melanoma. If successful, classifiers would be more accurate and could better support dermatological clinic work.\n> > \n> > \n> > In this competition, you\u2019ll identify melanoma in images of skin lesions. In particular, you\u2019ll use images within the same patient and determine which are likely to represent a melanoma. Using patient-level contextual information may help the development of image analysis tools, which could better support clinical dermatologists.\n> > \n> > Melanoma is a deadly disease, but if caught early, most melanomas can be cured with minor surgery. Image analysis tools that automate the diagnosis of melanoma will improve dermatologists' diagnostic accuracy. Better detection of melanoma has the opportunity to positively impact millions of people.\n> > \n> ","8cf68a52":"> So the images in the directory and the train and test dataframes are matching. Good to go","f842264e":"# **Evaluation Metric: Area under the ROC Curve: **# \n\nhow much model is capable of distinguishing between classes. \n\nROC curves typically feature true positive rate on the Y axis, and false positive rate on the X axis. This means that the top left corner of the plot is the \u201cideal\u201d point - a false positive rate of zero, and a true positive rate of one. This is not very realistic, but it does mean that a larger area under the curve (AUC) is usually better.\n\n![image.png](attachment:image.png)\n\n","9a42a0f8":"# **How it looks when the impact happens on oral\/genital (Benign vs Malignant)**","afa9da04":"# **What Is Melanoma Skin Cancer? : Overview**\n\n> > Melanoma, the most serious type of skin cancer, develops in the cells (melanocytes) that produce melanin \u2014 the pigment that gives your skin its color. \n> \n> > Melanoma can also form in your eyes and, rarely, inside your body, such as in your nose or throat.\n> > \n> > Cancer starts when cells in the body begin to grow out of control. Cells in nearly any part of the body can become cancer, and can then spread to other areas of the body.\n> \n\n\n\n# **Exact Cause:**\n\n> The exact cause of all melanomas isn't clear, but exposure to ultraviolet (UV) radiation from sunlight or tanning lamps and beds increases your risk of developing melanoma. \n> \n> Limiting your exposure to UV radiation can help reduce your risk of melanoma.\n\n\n# **Who are impacted:**\n\n> The risk of melanoma seems to be increasing in **people under 40, especially women**. Knowing the warning signs of skin cancer can help ensure that cancerous changes are detected and treated before the cancer has spread. \n> \n> Melanoma can be treated successfully if it is detected early.\n> \n\n# **Symptoms:**\n\nThe first melanoma signs and symptoms often are:\n\n1. A change in an existing mole\n2. The development of a new pigmented or unusual-looking growth on your skin\n\n\n# **How Melanoma looks : **\n\nThe first sign of melanoma is often a mole that changes size, shape or color. This melanoma shows color variations and an irregular border, both of which are melanoma warning signs.\n\n![rsz_ds00190_-ds00439_im01723_r7_skincthu_jpg.jpg](attachment:rsz_ds00190_-ds00439_im01723_r7_skincthu_jpg.jpg)\n\n\n\n# **Are all skin tomours are Melanoma? Benign skin tumors**\n\n**Many types of benign (non-cancerous) tumors can develop from different types of skin cells.**\n\nBenign tumors that start in melanocytes\n\nA mole (nevus) is a benign skin tumor that develops from melanocytes. Almost everyone has some moles. Nearly all moles (nevi) are harmless, but having some types can raise your risk of melanoma. \n\n# **Benign vs Malignant comparision:**\n![image.png](attachment:image.png)\n\nSource:\n\nhttps:\/\/www.thepediablog.com\/2019\/12\/05\/preventing-melanoma\/\n\nhttps:\/\/www.cancer.org\/cancer\/melanoma-skin-cancer\/about\/what-is-melanoma.html\n\nhttps:\/\/www.mayoclinic.org\/diseases-conditions\/melanoma\/symptoms-causes\/syc-20374884","a29db621":"# **How does Train and test set looks like?**","47291ed4":"\n# **Sex and age_approx **\n\n** all the missing values belong to three patients : IP_5205991, IP_0550106, IP_9835712 **\n","a8ffa358":"# **Basic Data Exploration**","cd33d946":"# **anatom_site_general_challenge**\n\nAround 500+ patients dont have location captured\n","fe9cf67c":"# **Data**# \n\n**1. Images in DICOM format**\n\n> Digital Imaging and Communications in Medicine (DICOM) is the standard for the communication and management of medical imaging information and related data. \n> \n> DICOM is most commonly used for storing and transmitting medical images enabling the integration of medical imaging devices such as scanners, servers, workstations, printers, network hardware, and picture archiving and communication systems (PACS) from multiple manufacturers. \n> \n> It has been widely adopted by hospitals and is making inroads into smaller applications like dentists' and doctors' offices. (Source : Wiki)\n\n**2. Images are provided in JPEG and TFRecord format:**\n\n> TFRecord helps us storing large datasets in binary format. Takes up less space and training time can be improved \n> \n**3. Target : **\n\n> The value 0 denotes benign, and 1 indicates malignant.\n> \n\n**4. Features:**\n\n> image_name - unique identifier, points to filename of related DICOM image\n\n> patient_id - unique patient identifier\n\n> sex - the sex of the patient (when unknown, will be blank)\n\n> age_approx - approximate patient age at time of imaging\n\n> anatom_site_general_challenge - location of imaged site\n\n> diagnosis - detailed diagnosis information (train only)\n\n> benign_malignant - indicator of malignancy of imaged lesion\n\n> target - binarized version of the target variable\n\n","8a43cc0b":"# **How Melanoma looks when it affects by gender (Benign - male)**","0a91c3e9":"# **How it looks when the impact happens on palms\/soles  (Benign vs Malignant)**","a70a8ace":"# **How it looks when the impact happens on lower extremity (Benign vs Malignant)**","85c194fc":"# **How it looks when the impact happens on head\/neck  (Benign vs Malignant)**"}}