{"cell_type":{"3438205f":"code","9ff410fc":"code","65d1b863":"code","292cbef9":"code","c5f962b0":"code","a096a8b6":"code","a4fff340":"code","1191472a":"code","61e1933f":"code","be40718d":"code","450111bb":"code","5cc8f7ab":"code","df41771f":"code","82864afe":"code","60412d6b":"code","e4c75ad4":"code","e1111b32":"code","5be58a1c":"code","5e3ba4a2":"code","e57e1492":"code","5c56bcf2":"code","7944da82":"code","51e0fe23":"code","66e4cf9f":"code","6f40c54f":"code","d868b01e":"code","e2a3cb69":"code","ac6cc41d":"code","84e041f4":"code","e922044b":"code","ace2bbba":"code","d919adb9":"code","a18a932e":"code","0b13cdcd":"code","3ad2f8cc":"code","86e91d60":"code","40778e3a":"code","4ab09f97":"code","a15a9633":"code","a72b238a":"code","1362e679":"code","96df1d60":"code","46316a95":"code","cc3bd9c5":"markdown","b2e922d2":"markdown","570f530d":"markdown","bad7d6b1":"markdown","f1af302a":"markdown","617356a9":"markdown","9112f97c":"markdown","5dec1c3f":"markdown","ed9ceb4f":"markdown","1ea60b0f":"markdown","89a5cd6e":"markdown","1ba70033":"markdown","2bdcb789":"markdown","da8a876d":"markdown","9329644a":"markdown","1eab9867":"markdown","13900b5d":"markdown","419ffd20":"markdown","c9b2ebd2":"markdown","66d57ff5":"markdown","3910fecd":"markdown","0c233fb1":"markdown"},"source":{"3438205f":"import pandas as pd\nimport statsmodels.api as sm\nimport statsmodels.formula.api as smf\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.cluster import KMeans\ncolor = sns.color_palette()\nfrom IPython.core.display import display, HTML\ndisplay(HTML(\"<style>.container { width:100% !important; }<\/style>\"))\n%matplotlib inline\nfrom plotnine import *\n","9ff410fc":"#Import data\nattendance_valuation_elo_df = pd.read_csv(\"..\/input\/nba_2017_att_val_elo.csv\")\nsalary_df = pd.read_csv(\"..\/input\/nba_2017_salary.csv\")\npie_df = pd.read_csv(\"..\/input\/nba_2017_pie.csv\")\nplus_minus_df = pd.read_csv(\"..\/input\/nba_2017_real_plus_minus.csv\")\nbr_stats_df = pd.read_csv(\"..\/input\/nba_2017_br.csv\")\n","65d1b863":"#Convert player names into the same format\nplus_minus_df.rename(columns={\"NAME\":\"PLAYER\", \"WINS\": \"WINS_RPM\"}, inplace=True)\nplayers = []\nfor player in plus_minus_df[\"PLAYER\"]:\n    plyr, _ = player.split(\",\")\n    players.append(plyr)\nplus_minus_df.drop([\"PLAYER\"], inplace=True, axis=1)\nplus_minus_df[\"PLAYER\"] = players\nplus_minus_df.head()","292cbef9":"\nnba_players_df = br_stats_df.copy()\nnba_players_df.rename(columns={'Player': 'PLAYER','Pos':'POSITION', 'Tm': \"TEAM\", 'Age': 'AGE', \"PS\/G\": \"POINTS\"}, inplace=True)\nnba_players_df.drop([\"G\", \"GS\", \"TEAM\"], inplace=True, axis=1)\nnba_players_df = nba_players_df.merge(plus_minus_df, how=\"inner\", on=\"PLAYER\")\npie_df_subset = pie_df[[\"PLAYER\", \"PIE\", \"PACE\", \"W\"]].copy()\nnba_players_df = nba_players_df.merge(pie_df_subset, how=\"inner\", on=\"PLAYER\")\nsalary_df.rename(columns={'NAME': 'PLAYER'}, inplace=True)\nsalary_df[\"SALARY_MILLIONS\"] = round(salary_df[\"SALARY\"]\/1000000, 2)\nsalary_df.drop([\"POSITION\",\"TEAM\", \"SALARY\"], inplace=True, axis=1)\nnba_players_with_salary_df = nba_players_df.merge(salary_df)\nnba_players_with_salary_df.head()","c5f962b0":"#Correlation matrix heat map\nplt.subplots(figsize=(20,15))\nax = plt.axes()\nax.set_title(\"NBA Player Correlation Heatmap:  2016-2017 Season (STATS & SALARY)\")\ncorr = nba_players_with_salary_df.corr()\nsns.heatmap(corr, \n            xticklabels=corr.columns.values,\n            yticklabels=corr.columns.values,\n           cmap=\"Greens\",\n           annot =True)","a096a8b6":"#Plot the distribution of salary\nsns.kdeplot(nba_players_with_salary_df[\"SALARY_MILLIONS\"], color=\"lightcoral\", shade=True)","a4fff340":"#Position vs. Salary\nplt.subplots(figsize= (10, 5))\nsns.countplot(x= \"POSITION\", data =nba_players_with_salary_df)\n","1191472a":"fig = plt.subplots(figsize= (10, 5))\nax = sns.boxplot(y= \"SALARY_MILLIONS\" , x=\"POSITION\", data = nba_players_with_salary_df, orient=\"Vertical\", width= 0.9)","61e1933f":"mean_team_salary_df = nba_players_with_salary_df[[\"TEAM\", \"SALARY_MILLIONS\"]].groupby(\"TEAM\").mean().sort_values(by=\"SALARY_MILLIONS\", ascending=False) \nmean_team_salary_df","be40718d":"plt.subplots(figsize=(15,15))\ndf = nba_players_with_salary_df\nsns.boxplot( x=df[\"SALARY_MILLIONS\"], y=df[\"TEAM\"] )","450111bb":"#See whether team valuation and conference play a role in average team salary\nnew_salary_df = pd.read_csv(\"..\/input\/nba_2017_salary.csv\")\nmean_salary_df = new_salary_df.groupby([\"TEAM\"], as_index= False).mean().merge(attendance_valuation_elo_df, how=\"inner\", on=\"TEAM\")\nax = sns.lmplot(x= \"VALUE_MILLIONS\", y= \"SALARY\", data= mean_salary_df, hue= \"CONF\", size = 10)\nax.set(xlabel='Mean Salary of a Team', ylabel='Team Valuation', title=\"Mean Salary vs Team Valuation:  2016-2017 Season\")","5cc8f7ab":"# See the range of age\nprint(set(nba_players_with_salary_df[\"AGE\"]))","df41771f":"sal_One = nba_players_with_salary_df.loc[nba_players_with_salary_df.AGE<=25,\"SALARY_MILLIONS\"]\nsal_Two = nba_players_with_salary_df.loc[(nba_players_with_salary_df.AGE>25) & (nba_players_with_salary_df.AGE <=30), \"SALARY_MILLIONS\"]\nsal_Three = nba_players_with_salary_df.loc[(nba_players_with_salary_df.AGE>30) & (nba_players_with_salary_df.AGE <=35), \"SALARY_MILLIONS\"]\nsal_Four = nba_players_with_salary_df.loc[(nba_players_with_salary_df.AGE>35) & (nba_players_with_salary_df.AGE <=40 ), \"SALARY_MILLIONS\"]\n  ","82864afe":"plt.figure(figsize=(15,8))\nsns.kdeplot(sal_One, color=\"darkturquoise\", shade=False)\nsns.kdeplot(sal_Two, color=\"lightcoral\", shade=False)\nsns.kdeplot(sal_Three, color=\"forestgreen\", shade=False)\nsns.kdeplot(sal_Four, color=\"dimgray\", shade=False)\nplt.legend(['One', 'Two', 'Three', 'Four'])\nplt.title('Density Plot of Salary by Age Group')\nplt.show()","60412d6b":"# Classify age into 4 age groups\ndef age_group(x):   \n    if x <= 25:\n        ag = \"One\"\n    elif (x > 25) & (x <= 30):\n        ag = \"Two\"\n    elif (x > 30) & (x <= 35):\n        ag = \"Three\"\n    else:\n        ag = \"Four\"\n    return ag  \nnba_players_with_salary_df['Age Group'] = nba_players_with_salary_df.AGE.apply(age_group)\nnba_players_with_salary_df.head()\n","e4c75ad4":"fig = plt.subplots(figsize= (10, 5))\nax = sns.boxplot(y= \"SALARY_MILLIONS\" , x=\"Age Group\", data = nba_players_with_salary_df, orient=\"Vertical\", width= 0.9)","e1111b32":"sns.swarmplot(x=\"AGE\", y=\"SALARY_MILLIONS\", hue=\"Age Group\" ,data=nba_players_with_salary_df)","5be58a1c":"\nsns.pairplot(nba_players_with_salary_df, x_vars=['WINS_RPM','POINTS','MP',\"FG%\", \"2P%\", \"3P%\", \"FT%\", \"eFG%\"], y_vars='SALARY_MILLIONS', size=7, aspect=0.8,kind = 'reg')\nplt.savefig(\"pairplot.jpg\")\n","5e3ba4a2":"# Classify salary into 4 age groups\ndef salary_group(x):   \n    if x <= 10:\n        sg = \"Low\"\n    elif (x > 10) & (x <= 20):\n        sg = \"Medium\"\n    elif (x > 20) & (x <= 30):\n        sg = \"High\"\n    else:\n        sg = \"Extreme High\"\n    return sg  \nnba_players_with_salary_df['Salary Group'] = nba_players_with_salary_df.SALARY_MILLIONS.apply(salary_group)\nnba_players_with_salary_df.head()","e57e1492":"mean_performance_df = nba_players_with_salary_df[[\"FG%\", \"2P%\", \"3P%\", \"eFG%\",\"Salary Group\"]].groupby(\"Salary Group\").mean()\nmean_performance_df.head()","5c56bcf2":"sns.pairplot(nba_players_with_salary_df, x_vars=['FG','2P','3P','FT'], y_vars=['FG%','2P%','3P%','FT%','MP'], size=7, aspect=0.8,kind = 'reg')\nplt.savefig(\"pairplot.jpg\")\n","7944da82":"results = smf.ols('SALARY_MILLIONS ~POINTS+WINS_RPM+MP', data=nba_players_with_salary_df).fit()\n","51e0fe23":"print(results.summary())\n","66e4cf9f":"wiki_df = pd.read_csv(\"..\/input\/nba_2017_player_wikipedia.csv\");wiki_df.head()\n","6f40c54f":"wiki_df.rename(columns={'names': 'PLAYER', \"pageviews\": \"PAGEVIEWS\"}, inplace=True)\n","d868b01e":"median_wiki_df = wiki_df.groupby(\"PLAYER\").median()\nmedian_wiki_df.head()","e2a3cb69":"\nmedian_wiki_df_small = median_wiki_df[[\"PAGEVIEWS\"]]\nmedian_wiki_df_small.head()","ac6cc41d":"median_wiki_df_small = median_wiki_df_small.reset_index()\nmedian_wiki_df_small.head()","84e041f4":"nba_players_with_salary_wiki_df = nba_players_with_salary_df.merge(median_wiki_df_small)\nnba_players_with_salary_wiki_df.head()","e922044b":"twitter_df = pd.read_csv(\"..\/input\/nba_2017_twitter_players.csv\");twitter_df.head()\n","ace2bbba":"nba_players_with_salary_wiki_twitter_df = nba_players_with_salary_wiki_df.merge(twitter_df)\n","d919adb9":"nba_players_with_salary_wiki_twitter_df.head()","a18a932e":"\nplt.subplots(figsize=(20,15))\nax = plt.axes()\nax.set_title(\"NBA Player Correlation Heatmap:  2016-2017 Season (STATS & SALARY & TWITTER & WIKIPEDIA)\")\ncorr = nba_players_with_salary_wiki_twitter_df.corr()\nsns.heatmap(corr, \n            xticklabels=corr.columns.values,\n            yticklabels=corr.columns.values,\n           annot =True)","0b13cdcd":"sns.pairplot(nba_players_with_salary_wiki_twitter_df, x_vars=['FG%','2P%','3P%'], y_vars=['PAGEVIEWS', 'TWITTER_FAVORITE_COUNT'], size=7, aspect=0.8,kind = 'reg')\nplt.savefig(\"pairplot.jpg\")","3ad2f8cc":"plt.scatter(nba_players_with_salary_wiki_twitter_df['SALARY_MILLIONS'], nba_players_with_salary_wiki_twitter_df['PAGEVIEWS'], color=\"blue\", label=\"Pageviews vs. Salary\")","86e91d60":"plt.scatter(nba_players_with_salary_wiki_twitter_df['SALARY_MILLIONS'], nba_players_with_salary_wiki_twitter_df['TWITTER_FAVORITE_COUNT'], color=\"orange\", label=\"Twitter vs. Salary\")","40778e3a":"results = smf.ols('SALARY_MILLIONS ~PAGEVIEWS', data=nba_players_with_salary_wiki_twitter_df).fit()\nprint(results.summary())","4ab09f97":"results = smf.ols('SALARY_MILLIONS ~TWITTER_FAVORITE_COUNT', data=nba_players_with_salary_wiki_twitter_df).fit()\nprint(results.summary())","a15a9633":"mean_nba_players_with_salary_wiki_twitter_df = nba_players_with_salary_wiki_twitter_df[[\"TEAM\", \"SALARY_MILLIONS\",\"PAGEVIEWS\", \"TWITTER_FAVORITE_COUNT\"]].groupby(\"TEAM\").mean().sort_values(by=\"SALARY_MILLIONS\", ascending=False) \nmean_nba_players_with_salary_wiki_twitter_df","a72b238a":"plt.scatter(mean_nba_players_with_salary_wiki_twitter_df['SALARY_MILLIONS'], mean_nba_players_with_salary_wiki_twitter_df['PAGEVIEWS'], color=\"green\", label=\"Pageviews vs. Team Salary\")","1362e679":"plt.scatter(mean_nba_players_with_salary_wiki_twitter_df['SALARY_MILLIONS'], mean_nba_players_with_salary_wiki_twitter_df['TWITTER_FAVORITE_COUNT'], color=\"red\", label=\"Twitter vs. Team Salary\")","96df1d60":"#Regression: Average Team Salary vs. Average Team Twitter Favorites\nresults = smf.ols('SALARY_MILLIONS ~TWITTER_FAVORITE_COUNT', data=mean_nba_players_with_salary_wiki_twitter_df).fit()\nprint(results.summary())","46316a95":"#Regression: Average Team Salary vs. Average Team Wiki Pageviews\nresults = smf.ols('SALARY_MILLIONS ~PAGEVIEWS', data=mean_nba_players_with_salary_wiki_twitter_df).fit()\nprint(results.summary())","cc3bd9c5":"For Western Conference, team valuation has a strong positive relationship with average team salary while for Eastern Conference, it seems team valuation has no effect on average team salary. ","b2e922d2":"## Salary Distribution","570f530d":"We can see that players in Extreme High salary have significantly higher scores than other salary groups and players in Low salary group have apparently lower scores. But the difference between High and Medium groups is not that much. And Medium salary group even performs better in FG% and eFG%. So this makes the correlations of these variables with salary are close to 0. This can also be validated by the scatter plots. Scatters of High and Medium salary groups cluster.","bad7d6b1":"Except PF-C, no significant difference among other positions in terms of salary. Also, since the number of PF-C is so small, they seem more like outliers and the number accuracy is suspicious. So overall, position doesn't have a strong relationship with salary.","f1af302a":"Wiki pageview counts and Twitter favorite counts also have waekrelationship with performance indicators such as FG%, 2P%, 3P% and eFG%. In fact, no variable is highly related with palyers' media influence.","617356a9":"## Age vs. Salary","9112f97c":"## Team vs. Salary","5dec1c3f":"For age under 25, normally players have lower salary compared with other age groups. For other age groups, no much difference. ","ed9ceb4f":"## Media Influence vs. Salary","1ea60b0f":"## Performance vs. Salary","89a5cd6e":"We can see that performance variables such as FG%, 2P% , 3P% and FT% have weak relationship with FG, 2P, 3P and FT respectively, meaning performance don't change much in terms of times players succeed since more goals means more attempts. But FG, 2P, 3P and FT are lighly correlated with MG, which makes sense. Because the longer time players are in game, the more goals they are able to make. ","1ba70033":"## Average Team Media Influence vs. Average Team Salary","2bdcb789":"## Correlation Matrix Heat Map","da8a876d":"Salary is right skewed. Most players get salary between 0 to 10M USD. A very small number of palyers earn more than 30M USD.","9329644a":"## Media Influence vs. Performance","1eab9867":"Regression results are consistent with scatterplots. In terms of team, media influence has a positive relationship with salary.","13900b5d":"Exploration of why some players get higher salary and whether performance is a better indicator to media influence than to salary","419ffd20":"## Position vs. Salary","c9b2ebd2":"Both the scatterplots and regression results show weak relationship bwtween players' media influence and salaries.","66d57ff5":"Most players have similar media influence. The outliers with huge influence often only hame average performance.","3910fecd":"There is significant difference among teams in terms on salary. Cleveland Cavaliers, Houston Rockets and Golden State Warriors are top three teams with highest average salaries while Miami Heat, Denver Nuggets and Minnesota Timberwolves have the lowest salaries. And the range of average salary by team is from 4.32M USD to 17.10M USD, quite a large gap. So it is worthwhile to take a further look at teams.","0c233fb1":"Average team Wiki pageviews and team Twitter favorites seem to be positively related with average team salary."}}