{"cell_type":{"e4673aba":"code","27c7e37a":"code","e1ceb23b":"code","fe23fd2a":"code","caf79ee5":"code","9355c14c":"code","9462e420":"code","215e1d58":"code","96353110":"code","6b22c18d":"code","cdc13e69":"code","4c1d675c":"code","e17a2610":"code","b7bee90e":"code","b53de1fc":"code","b9b0666c":"code","c5baaff8":"code","719244ef":"code","40fe1420":"code","1fd4b507":"markdown","7232c550":"markdown","4ae4dc58":"markdown","25ab5b71":"markdown","abeafc53":"markdown","cd173692":"markdown","b73c425c":"markdown","a642bd08":"markdown"},"source":{"e4673aba":"import pandas as pd\n!pip install --quiet pycountry_convert\nfrom pycountry_convert import country_alpha2_to_country_name, country_name_to_country_alpha3, country_alpha3_to_country_alpha2\nimport warnings\nwarnings.filterwarnings('ignore')\nimport plotly\nimport plotly.express as px\nimport plotly.graph_objects as go\nimport numpy as np\nimport os\nimport plotly.offline as pyo\npyo.init_notebook_mode()","27c7e37a":"users = pd.read_csv('..\/input\/bookcrossing-dataset\/Book reviews\/BX-Users.csv', sep=';', encoding='latin-1', low_memory=False)\nbooks_r = pd.read_csv('..\/input\/bookcrossing-dataset\/Book reviews\/BX-Book-Ratings.csv', sep=';', encoding='latin-1', low_memory=False)\nb_cols = ['ISBN', 'book_title' ,'book_author','year_of_publication', 'publisher', 'img_s', 'img_m', 'img_l']\nbooks = pd.read_csv('..\/input\/bookcrossing-dataset\/Book reviews\/BX-Books.csv', sep=';', names=b_cols, encoding='latin-1',low_memory=False)","e1ceb23b":"users[:5]","fe23fd2a":"books_r[:5]","caf79ee5":"books[:5]","9355c14c":"def get_alpha3(col):\n    try:\n        iso_3 =  country_name_to_country_alpha3(col, cn_name_format=\"lower\")\n    except:\n        iso_3 = 'Unknown'\n    return iso_3\n\ndef get_name(col):\n    try:\n        name =  country_alpha2_to_country_name(country_alpha3_to_country_alpha2(col))\n    except:\n        name = 'Unknown'\n    return name","9462e420":"users['country'] = [x.split(', ')[-1] for x in users.Location]\nusers['alpha_3'] = users['country'].apply(lambda x: get_alpha3(x))\nusers['alpha_3'].loc[users.country == 'usa'] = 'USA'\nusers['country'] = users['alpha_3'].apply(lambda x: get_name(x))\nusers[:5]","215e1d58":"books.drop(['img_s', 'img_m', 'img_l'], axis=1, inplace=True)\nbooks.drop(books.index[0], inplace=True)","96353110":"data = pd.merge(users, books_r, on='User-ID')\ndata = pd.merge(data, books, on='ISBN')\ndata[:5]","6b22c18d":"users_map = users.groupby(['country', 'alpha_3'])['alpha_3'].agg(Users='count').reset_index()\nusers_map['Users(log)'] = np.log10(users_map[\"Users\"])\n\nfig = px.choropleth(users_map, locations=\"alpha_3\",\n                    color='Users(log)',\n                    hover_name=\"country\",\n                    hover_data=[\"Users\"],\n                    color_continuous_scale='Cividis')\nfig.update_layout(title_text=\"Unique Users\")\nfig.update_layout(coloraxis_colorbar=dict(title='Users', tickprefix='1.e'))\nfig.show()","cdc13e69":"data_map = data.groupby(['country', 'alpha_3'])['alpha_3'].agg(Users_activity='count').reset_index()\ndata_map['Users_activity(log)'] = np.log10(data_map[\"Users_activity\"])\n\nfig = px.choropleth(data_map, locations=\"alpha_3\",\n                    color='Users_activity(log)',\n                    hover_name=\"country\",\n                    hover_data=[\"Users_activity\"],\n                    color_continuous_scale='Cividis')\nfig.update_layout(title_text=\"Users activity\")\nfig.update_layout(coloraxis_colorbar=dict(title='Users activity', tickprefix='1.e'))\nfig.show()","4c1d675c":"data_bar = pd.merge(users_map, data_map, on='country')\n\nx = ['Unique Users', 'Users_activity']\ny = [data_bar.Users.sum(), data_bar.Users_activity.sum()]\n\nfig = go.Figure(data=[go.Bar(\n            x=x, y=y,\n            text=y,\n            textposition='auto',\n        )])\nfig.update_layout(title_text='Users\/Users activity')\nfig.show()","e17a2610":"data_bar = data_bar[data_bar.country != 'Unknown']\ndata_bar = data_bar.sort_values(by = 'Users',ascending = False)[:15]\n\nfig = go.Figure(data=[\n    go.Bar(name='Users', x=data_bar.country, y=data_bar.Users),\n    go.Bar(name='Users activity', x=data_bar.country, y=data_bar.Users_activity)\n])\n\nfig.update_layout(barmode='group', title_text='Users\/Users activity per country (top 15)')\nfig.show()","b7bee90e":"data['Age'].loc[data.Age >= 100] = np.NaN\n\nfig = px.histogram(data, x=\"Age\", nbins=10, title='Histogram of Age')\nfig.show()","b53de1fc":"fig = px.histogram(data, x=\"Book-Rating\", nbins=10, title='Histogram of Rating')\nfig.show()","b9b0666c":"data_barh = data.book_title.value_counts().reset_index()[:10]\n\nfig = go.Figure(go.Bar(\n            x=data_barh.book_title,\n            y=data_barh['index'],\n            orientation='h'))\nfig.update_layout(yaxis=dict(autorange=\"reversed\"), title='Most voted books (top 10)')\n\nfig.show()","c5baaff8":"print('Most voted books per country (top 15)')\ndata[data.country.isin(data_bar.country)].groupby(['country'])['book_title'].agg(lambda x:x.value_counts().index[0]).reset_index()","719244ef":"data_barh = data.book_author.value_counts().reset_index()[:10]\n\nfig = go.Figure(go.Bar(\n            x=data_barh.book_author,\n            y=data_barh['index'],\n            orientation='h'))\nfig.update_layout(yaxis=dict(autorange=\"reversed\"), title='Most voted authors (top 10)')\n\nfig.show()","40fe1420":"print('Most voted authors per country (top 15)')\ndata[data.country.isin(data_bar.country)].groupby(['country'])['book_author'].agg(lambda x:x.value_counts().index[0]).reset_index()","1fd4b507":"Merge","7232c550":"Load data","4ae4dc58":"Get country from users location","25ab5b71":"**Clean\/merge data**","abeafc53":"# **Data visualization**","cd173692":"Load packages","b73c425c":"# **Data preparation**","a642bd08":"Drop imgs columns and 1-st row from books"}}