{"cell_type":{"0269c5c9":"code","625f707e":"code","490605a1":"code","82df9c0f":"code","0499af39":"code","1801f751":"code","220bcbd7":"code","9a047b48":"code","cb31cba0":"code","7478af99":"code","7def2569":"code","93e31a9b":"code","01fe3289":"code","6f1b1e6e":"code","f0b2efdc":"code","581f9b94":"code","40bf9b59":"code","757bad2e":"code","61e2a0a8":"code","71ae59ae":"code","005163cf":"markdown","6e585ed5":"markdown","ff3dcfcd":"markdown","25bb1bcb":"markdown","fd68ee92":"markdown","5fc3eb08":"markdown","ead14b82":"markdown","971fe470":"markdown","16fd0553":"markdown"},"source":{"0269c5c9":"import gc\nfrom tqdm import tqdm\nimport numpy as np\nimport pandas as pd\nfrom pylab import rcParams\nimport matplotlib.pyplot as plt\nfrom sklearn.metrics import mean_squared_error\nfrom scipy.stats import probplot\n\nimport datetime as dt\nfrom datetime import date\nfrom datetime import timedelta\nfrom fbprophet import Prophet\n\n%matplotlib inline\nimport os\nimport warnings\nwarnings.filterwarnings(\"ignore\")","625f707e":"data0=pd.read_csv('..\/input\/earthquake-in-japan\/japan-20190101_20211203_query.csv')\ndata0[1:2]","490605a1":"data0=data0.fillna('N')\ndata1=data0[['time','latitude','longitude','depth','mag',]]\ndata1[0:5]","82df9c0f":"data2=pd.DataFrame(columns=data1.columns.tolist())\nfor i,item in enumerate(data1['time']):\n    data2=pd.concat([data2,data1.loc[i:i]])\ndata2=data2.sort_values(['time']).reset_index(drop=True)    ","0499af39":"from datetime import datetime as dt\ndata2a=data2.copy()\ndate=[]\nfor item in data2['time']:\n    date+=[dt.strptime(item[0:-5],'%Y-%m-%dT%H:%M:%S')]\ndata2a['date']=date\ndata2a","1801f751":"data4=data2a[data2a['longitude']>130][data2a['longitude']<137][data2a['latitude']>31][data2a['latitude']<34]\ndata4=data4.reset_index(drop=True)\ndata4","220bcbd7":"import plotly.express as px\nfig=px.scatter(x=data4['date'],y=data4['mag'])\nfig=px.scatter(data4, x=\"date\", y=\"mag\")\nfig.update_layout(title='Magnituide of earthquake around Nankai in 2019-2021')\nfig.show()","9a047b48":"data4['date2']=data4['date'].apply(lambda x: dt.strptime(str(x)[0:10],'%Y-%m-%d') )\ndata4","cb31cba0":"data5=data4[['date2','mag']][data4['mag']>4.1]\ndata5","7478af99":"item1=data5\n\nitem1.columns = ['ds','y']\nitem1.y = item1.y.astype('float')\nitem1.ds = item1.ds.astype('datetime64')\n\nrcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y)","7def2569":"ph = Prophet()\nph.fit(item1)\nforecast1=ph.predict(item1)\nfigure = ph.plot(forecast1)\nfigure.show()","93e31a9b":"from datetime import timedelta\nstart0 = dt.strptime('2021-01-01', '%Y-%m-%d').date()\nend0   = dt.strptime('2023-12-31', '%Y-%m-%d').date()\nprint((end0-start0).days)","01fe3289":"def daterange(start,end):\n    for i in range((end-start).days):\n        return start+timedelta(i)  ","6f1b1e6e":"dates0=[]\nfor i in range((end0-start0).days):\n    dates0+=[(start0+timedelta(i)).strftime('%Y-%m-%d') ]\nprint(dates0[0:30])","f0b2efdc":"dates0_df=pd.DataFrame(dates0)\ndates0_df.columns=['ds']\ndates0_df","581f9b94":"ph = Prophet()\nph.fit(item1)\nforecast3=ph.predict(dates0_df)\nfigure = ph.plot(forecast3)\nfigure.show()","40bf9b59":"forecast3[['ds','yhat','yhat_lower','yhat_upper']][365:385]#['yhat'].max()","757bad2e":"forecast4=forecast3[['ds','yhat','yhat_lower','yhat_upper']][365:365*2]\nforecast4.to_csv('mag_forcast.csv')","61e2a0a8":"mag0=forecast3[365:365*2]['yhat'].max()\nprint(mag0)","71ae59ae":"forecast3[forecast3['yhat']==mag0]","005163cf":"#### The former prediciton (2021\/10\/09)\n#### Magnitude of Earthquake on 2022-10-13 is predicted as 5.6.","6e585ed5":"* https:\/\/www.kaggle.com\/stpeteishii\/earthquake-in-nankai-area","ff3dcfcd":"### Predict its location\n* https:\/\/www.kaggle.com\/stpeteishii\/earthquake-location-predict-in-nankai-by-prophet","25bb1bcb":"# Predict MAX Magnitude of Earthquakes in 2022","fd68ee92":"<img src=\"https:\/\/upload.wikimedia.org\/wikipedia\/commons\/thumb\/d\/d8\/RuptureAreasNankaiMegathrust.png\/1920px-RuptureAreasNankaiMegathrust.png\" width=\"100%\">","5fc3eb08":"# The latest prediciton (2021\/12\/03)\n## Magnitude of Earthquake on 2022-03-24 is predicted as 5.5.","ead14b82":"# **Nankai Megathrust Earthquake in Japan**\n* Nankai megathrust earthquakes are great megathrust earthquakes that occur along the Nankai megathrust \u2013 the fault under the Nankai Trough \u2013 which forms the plate interface between the subducting Philippine Sea Plate and the overriding Amurian Plate, which dips beneath southwestern Honshu, Japan. [(Wikipedia)](https:\/\/en.wikipedia.org\/wiki\/Nankai_megathrust_earthquakes)","971fe470":"# fit past and predict past+future","16fd0553":"# fit past and predict past"}}