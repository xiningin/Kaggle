{"cell_type":{"edba29e0":"code","9c9b6256":"code","bd1f3bf3":"code","2faab697":"code","2482331b":"code","bfb9095d":"code","9d101be5":"code","eecfedbd":"code","535d3c72":"code","b871230b":"code","f82c65ac":"code","b237fdf5":"code","c8ac7b81":"code","4e892a3f":"code","31cbc29c":"code","bd35c5c3":"code","8d2122ff":"code","608d4fe7":"code","7491c6da":"code","3de29d2d":"code","530a643b":"code","6291dc1a":"code","f4986a4f":"code","acb0b999":"code","487c2cb1":"markdown"},"source":{"edba29e0":"from fastai.tabular.all import *\nfrom sklearn.metrics import mean_squared_log_error","9c9b6256":"path = Path('..\/input\/store-sales-time-series-forecasting')\nPath.BASE_PATH = path\npath.ls()","bd1f3bf3":"train_df = pd.read_csv(path\/'train.csv')\ntransaction_df = pd.read_csv(path\/'transactions.csv')\ntest_df = pd.read_csv(path\/'test.csv')\nsub_df = pd.read_csv(path\/'sample_submission.csv')\noil_df = pd.read_csv(\"..\/input\/store-sales-time-series-forecasting\/oil.csv\")\nstores_df = pd.read_csv(\"..\/input\/store-sales-time-series-forecasting\/stores.csv\")\n\ntrain_df.shape, transaction_df.shape, test_df.shape, sub_df.shape","2faab697":"train_df = train_df.merge(oil_df, on = 'date', how='left')\ntrain_df = train_df.merge(stores_df, on = 'store_nbr', how='left')\n# train_df = train_df.merge(df_trans, on = ['date', 'store_nbr'], how='left')\n\ntest_df = test_df.merge(oil_df, on = 'date', how='left')\ntest_df = test_df.merge(stores_df, on = 'store_nbr', how='left')","2482331b":"train_df.type.unique()","bfb9095d":"train_df.state.unique()","9d101be5":"train_df.cluster.unique()","eecfedbd":"train_df.city.unique()","535d3c72":"len(train_df.sales.unique())","b871230b":"train_df.head(5)","f82c65ac":"train_df.columns","b237fdf5":"splits = RandomSplitter(valid_pct=0.2)(range_of(train_df))","c8ac7b81":"tab_pd = TabularPandas(train_df, \n                       procs = [Categorify, FillMissing, Normalize],\n                       cat_names=['store_nbr', 'family','city','type'],\n                       cont_names =['onpromotion'],\n                       y_names = 'sales',\n                       splits = splits)","4e892a3f":"dls = tab_pd.dataloaders(bs=512)","31cbc29c":"len(dls.train), len(dls.valid)","bd35c5c3":"dls.show_batch()","8d2122ff":"train_df.sales.max()","608d4fe7":"def rmsle(inp, targ):\n    inp = inp.detach().cpu().numpy()\n    targ = targ.detach().cpu().numpy()\n    return np.sqrt(mean_squared_log_error(targ, inp))","7491c6da":"learner = tabular_learner(dls, metrics=rmsle, y_range=(0, 125000))","3de29d2d":"learner.fit_one_cycle(1)","530a643b":"dl = learner.dls.test_dl(test_df)","6291dc1a":"preds = learner.get_preds(dl=dl)\npreds[0].shape","f4986a4f":"sub_df.sales = preds[0].detach().cpu().numpy()\nsub_df.head(3)","acb0b999":"sub_df.to_csv('submission.csv', index=False)","487c2cb1":"I've not really played around with Tabular data before, so many things are missing and this is largely a regurgitation of the official fastai docs (https:\/\/docs.fast.ai\/tutorial.tabular.html). \n\nNeed to add some things such as incorporaing the dates (next up), transcation\/oil\/holiday data needs to be added as well, but V0 confirms pipeline can be used and output submitted to leaderboard\n\nThis can be run on a CPU, but if you invoke the GPU, it will be certainly be faster per epoch"}}