{"cell_type":{"ddf08ae1":"code","6ccd978c":"code","9dfc360c":"code","b2d8ac48":"code","fbb1ff18":"code","1bb3f7d0":"code","71f32c32":"code","4e78d3c9":"code","0a8938d1":"code","7d0fc5bc":"code","4713d6cd":"code","3ce76e3c":"code","ca6aaa4a":"code","07826565":"code","08310bd4":"code","5ae5863c":"code","bc5b654f":"code","087699dd":"code","540a247d":"code","2cee438b":"code","7a910479":"code","3c7ed418":"code","ecf5505b":"code","6a5dbdcb":"code","9b883d3e":"code","2246a5d7":"code","eebb2d78":"code","2cd0a945":"code","acc70955":"code","ba3c7cb9":"code","e80f56fc":"code","2e348e49":"code","baf7b871":"code","87067ece":"code","999f600c":"code","1f390adf":"code","1ac38d4f":"code","8f10758a":"code","a6175790":"code","599a2912":"code","fb28e554":"code","34246fee":"code","7ef5523c":"code","15620883":"code","097c3916":"code","7d2f1019":"code","a3b399a3":"code","17c0a1f3":"code","bdf94539":"code","6ebe088a":"code","aedb82d4":"code","44e77e60":"code","a186da8a":"markdown","5ad725df":"markdown","e27c5c7e":"markdown","97b036db":"markdown","b89595b3":"markdown","d17d67be":"markdown","0b31024f":"markdown","7c3e2503":"markdown","ef436e6c":"markdown","62fb9e19":"markdown","f26f3a8a":"markdown","d33dc7fe":"markdown","effe253c":"markdown","f125be0b":"markdown","a4413b2c":"markdown","947ffab3":"markdown","b13826e7":"markdown","cff35290":"markdown","88468e21":"markdown"},"source":{"ddf08ae1":"#################################\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set()\nimport pandas_profiling as pdp\nimport gc\ngc.enable()\nfrom sklearn import metrics\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.impute import SimpleImputer\nfrom sklearn.impute import KNNImputer\nfrom sklearn.experimental import enable_iterative_imputer\nfrom sklearn.impute import IterativeImputer\nfrom sklearn import preprocessing\nfrom sklearn.model_selection import train_test_split\nfrom imblearn.over_sampling import SMOTE\nfrom imblearn.under_sampling import RandomUnderSampler\nfrom imblearn.pipeline import Pipeline\nimport scikitplot as skplt\nfrom xgboost import XGBClassifier\nfrom sklearn.neural_network import MLPClassifier\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.metrics import accuracy_score","6ccd978c":"data = pd.read_csv(\"..\/input\/stroke-prediction-dataset\/healthcare-dataset-stroke-data.csv\")","9dfc360c":"data.head()","b2d8ac48":"data.describe().T","fbb1ff18":"data.isna().sum()","1bb3f7d0":"data.info()","71f32c32":"fig, axes = plt.subplots(nrows=3, ncols=2, figsize=(18, 14))\nsns.histplot(data=data, x=\"age\", kde=True,ax=axes[0][0])\nsns.histplot(data=data, x=\"hypertension\", kde=True,ax=axes[0][1])\nsns.histplot(data=data, x=\"heart_disease\", kde=True,ax=axes[1][0])\nsns.histplot(data=data, x=\"avg_glucose_level\", kde=True,ax=axes[1][1])\nsns.histplot(data=data, x=\"bmi\", kde=True,ax=axes[2][0])\nsns.histplot(data=data, x=\"stroke\", kde=True,ax=axes[2][1])","4e78d3c9":"fig, axes = plt.subplots(nrows=3, ncols=2, figsize=(18, 14))\nsns.countplot(data=data,palette=\"Set3\", x=\"gender\",ax=axes[0][0])\nsns.countplot(data=data,palette=\"Set3\", x=\"ever_married\",ax=axes[0][1])\nsns.countplot(data=data,palette=\"Set3\", x=\"work_type\",ax=axes[1][0])\nsns.countplot(data=data,palette=\"Set3\", x=\"Residence_type\",ax=axes[1][1])\nsns.countplot(data=data,palette=\"Set3\", x=\"smoking_status\",ax=axes[2][0])\nsns.histplot(data=data, x=\"stroke\",hue=\"gender\", kde=True,ax=axes[2][1])","0a8938d1":"report = pdp.ProfileReport(data, title=\"Stroke Report\",minimal=True)\nreport","7d0fc5bc":"labels =data['stroke'].value_counts(sort = True).index\nsizes = data['stroke'].value_counts(sort = True)\ncolors = [\"lightblue\",\"pink\"]\nplt.figure(figsize=(7,7))\nplt.pie(sizes,labels=labels, colors=colors, autopct='%1.1f%%', startangle=90,)\nplt.title('Stroke pie')\nplt.show()","4713d6cd":"g = sns.pairplot(data, diag_kind=\"kde\",hue=\"stroke\")\ng.map_lower(sns.kdeplot, levels=4, color=\".2\")","3ce76e3c":"data.info()","ca6aaa4a":"plt.figure(figsize=(16,8))\nsns.heatmap(data.corr(),annot=True, cmap=\"YlGnBu\")","07826565":"for i in range(data.shape[1]):\n    print(i,len(pd.unique(data.iloc[:,i])))","08310bd4":"for i in range(data.shape[1]):\n    num=len(pd.unique(data.iloc[:,i]))\n    porcentaje=float(num)\/data.shape[0]*100\n    print(\"%d, %d, %.1f%%\"%(i,num,porcentaje))","5ae5863c":"duplicado = data.duplicated()\nprint(duplicado.any())\nprint(data[duplicado])","bc5b654f":"data.isnull().sum()","087699dd":"data1 = data.copy()","540a247d":"X= data1[[\"bmi\",\"avg_glucose_level\"]]\ny=data1[\"stroke\"]\nX.head()","2cee438b":"tree = DecisionTreeRegressor()\nresultado = []\ntipos = ['mean', 'median', 'most_frequent', 'constant']\n\nfor t in tipos:\n    imputer=SimpleImputer(strategy=t)\n    imputer.fit(X)\n    X_trans= imputer.transform(X)\n    tree = DecisionTreeRegressor(max_depth=10,random_state=42)\n    tree.fit(X_trans,y)\n    y_pred = tree.predict(X_trans)\n    r2 = metrics.r2_score(y, y_pred)\n    RMSE=np.sqrt(mean_squared_error(y,y_pred))\n    resultado.append(r2)\n    print(\"La estrategia utilizada--->\",t)\n    print(\"RMSE segun el tipo de estrategia:\",RMSE)\n    print(\"----------------------------------------\")","7a910479":"vecinos = [1,3,6,9,12]\nfor v in vecinos:\n    KNN_imputer=KNNImputer(n_neighbors=v)\n    KNN_imputer.fit(X)\n    X_knn= KNN_imputer.transform(X)\n    tree = DecisionTreeRegressor(max_depth=10,random_state=42)\n    tree.fit(X_knn,y)\n    y_pred = tree.predict(X_knn)\n    r2 = metrics.r2_score(y, y_pred)\n    RMSE=np.sqrt(mean_squared_error(y,y_pred))\n    resultado.append(r2)\n    print(\"La cantidad de vecinos utilizados--->\",v)\n    print(\"RMSE segun el tipo de estrategia:\",RMSE)\n    print(\"----------------------------------------\")","3c7ed418":"tipos2 = ['ascending', 'descending', 'roman', 'arabic', 'random']\nfor t in tipos2:\n    iter_imputer=IterativeImputer(imputation_order=t)\n    iter_imputer.fit(X)\n    X_iter= iter_imputer.transform(X)\n    tree = DecisionTreeRegressor(max_depth=10,random_state=42)\n    tree.fit(X_iter,y)\n    y_pred = tree.predict(X_iter)\n    r2 = metrics.r2_score(y, y_pred)\n    RMSE=np.sqrt(mean_squared_error(y,y_pred))\n    resultado.append(r2)\n    print(\"El metodo utilizado es--->\",t)\n    print(\"RMSE segun el tipo de estrategia:\",RMSE)\n    print(\"----------------------------------------\")","ecf5505b":"imputer=SimpleImputer(strategy=\"most_frequent\")\nimputer=imputer.fit(data.iloc[:,9:10])\ndata.iloc[:,9:10]=imputer.transform(data.iloc[:,9:10])","6a5dbdcb":"data.isnull().sum()","9b883d3e":"plt.figure(figsize=(8,4))\nsns.boxplot(data=data,x=data[\"age\"],color='lightblue')","2246a5d7":"plt.figure(figsize=(8,4))\nsns.boxplot(data=data,x=data[\"bmi\"],color='lightblue')","eebb2d78":"plt.figure(figsize=(8,4))\nsns.boxplot(data=data,x=data[\"avg_glucose_level\"],color='lightblue')","2cd0a945":"from scipy import stats\ndata=data[(np.abs(stats.zscore(data[\"age\"])) < 3)]\ndata=data[(np.abs(stats.zscore(data[\"bmi\"])) < 3)]\ndata=data[(np.abs(stats.zscore(data[\"avg_glucose_level\"])) < 3)]","acc70955":"plt.figure(figsize=(8,4))\nsns.boxplot(data=data,x=data[\"age\"],color='lightblue')","ba3c7cb9":"plt.figure(figsize=(8,4))\nsns.boxplot(data=data,x=data[\"bmi\"],color='lightblue')","e80f56fc":"plt.figure(figsize=(8,4))\nsns.boxplot(data=data,x=data[\"avg_glucose_level\"],color='lightblue')","2e348e49":"data[\"gender\"] = data[\"gender\"].apply(lambda x: 1 if x==\"Male\" else 0)\ndata[\"ever_married\"] = data[\"ever_married\"].apply(lambda x: 1 if x==\"Yes\" else 0)\ndata[\"Residence_type\"] = data[\"Residence_type\"].apply(lambda x: 1 if x==\"Urban\" else 0)\ndata = pd.get_dummies(data=data, columns=['smoking_status'])\ndata = pd.get_dummies(data=data, columns=['work_type'])","baf7b871":"plt.figure(figsize=(16,8))\nsns.heatmap(data.corr(),annot=True, cmap=\"YlGnBu\")","87067ece":"robust_sc = preprocessing.RobustScaler()\nstandard_sc = preprocessing.StandardScaler() \nminmax_sc = preprocessing.MinMaxScaler() ","999f600c":"X = data.drop([\"stroke\",\"id\"],axis=1)\ny = data[\"stroke\"]","1f390adf":"for x in [robust_sc,standard_sc,minmax_sc]:\n    scaler = x.fit(X)\n    X_new = x.transform(X)\n    tree = DecisionTreeRegressor(max_depth=10,random_state=42)\n    tree.fit(X_new,y)\n    y_pred = tree.predict(X_new)\n    r2 = metrics.r2_score(y, y_pred)\n    RMSE=np.sqrt(mean_squared_error(y,y_pred))\n    resultado.append(r2)\n    print(\"El escalado Utilizado--->\",x)\n    print(\"RMSE segun el tipo de estrategia:\",RMSE)\n    print(\"----------------------------------------\")","1ac38d4f":"over = SMOTE(sampling_strategy=0.1)\nunder = RandomUnderSampler(sampling_strategy=0.5)\nsteps = [('o', over), ('u', under)]\npipeline = Pipeline(steps=steps)","8f10758a":"X, y = pipeline.fit_resample(X, y)","a6175790":"X_train,X_test,y_train,y_test= train_test_split(X,y,test_size=0.3,random_state=42,stratify=y)","599a2912":"X_train=standard_sc.fit_transform(X_train)\nX_test=standard_sc.transform(X_test)","fb28e554":"gbm = XGBClassifier(verbosity=1)\nparams_xgb = {\n        \"n_estimators\":[500,1000,1500],\n        \"learning_rate\":[0.1,0.3,0.6],\n        'gpu_id': [0],\n        \"predictor\":[\"gpu_predictor\"],\n        'tree_method': ['gpu_hist'],\n        \"updater\":[\"grow_gpu_hist\"],\n        \"sampling_method\":[\"gradient_based\"],\n        \"updater\":[\"grow_gpu_hist\"]\n}","34246fee":"model_xgb = GridSearchCV(gbm,param_grid=params_xgb, cv=3,n_jobs=-1)\nmodel_xgb.fit(X_train,y_train)","7ef5523c":"print(\"Best params: \"+str(model_xgb.best_params_))\nprint(\"Best Score: \"+str(model_xgb.best_score_)+'\\n')","15620883":"scores = pd.DataFrame(model_xgb.cv_results_)\nscores.sort_values(by=\"rank_test_score\")","097c3916":"y_train_pred_xgb = model_xgb.predict(X_train)\ny_test_pred_xgb = model_xgb.predict(X_test)\n\nrmse_train_xgb = np.sqrt(mean_squared_error(y_train, y_train_pred_xgb))\nrmse_test_xgb = np.sqrt(mean_squared_error(y_test, y_test_pred_xgb))\n\nprint(\"RMSE en Train es:\",rmse_train_xgb)\nprint(\"RMSE en Test es:\",rmse_test_xgb)","7d2f1019":"print(\"Accuracy train XGB: \", accuracy_score(y_train, y_train_pred_xgb))\nprint(\"Accuracy test XGB: \", accuracy_score(y_test, y_test_pred_xgb))","a3b399a3":"clf = MLPClassifier(random_state=42)\nparams_MLP = {\n        \"hidden_layer_sizes\":[64,128,256],\n        \"activation\":[\"identity\", \"logistic\", \"tanh\", \"relu\"],\n        'solver': [\"lbfgs\", \"sgd\", \"adam\"],\n        \"learning_rate\":[\"constant\", \"invscaling\", \"adaptive\"],\n        'max_iter': [100,200],\n        \"warm_start\":[True]\n}","17c0a1f3":"model_MLP = GridSearchCV(clf,param_grid=params_MLP, cv=3,n_jobs=-1)\nmodel_MLP.fit(X_train,y_train)","bdf94539":"print(\"Best params: \"+str(model_MLP.best_params_))\nprint(\"Best Score: \"+str(model_MLP.best_score_)+'\\n')","6ebe088a":"scores = pd.DataFrame(model_MLP.cv_results_)\nscores.sort_values(by=\"rank_test_score\")","aedb82d4":"y_train_pred_MLP = model_MLP.predict(X_train)\ny_test_pred_MLP = model_MLP.predict(X_test)\n\nrmse_train_MLP = np.sqrt(mean_squared_error(y_train, y_train_pred_MLP))\nrmse_test_MLP = np.sqrt(mean_squared_error(y_test, y_test_pred_MLP))\n\nprint(\"RMSE en Train es:\",rmse_train_MLP)\nprint(\"RMSE en Test es:\",rmse_test_MLP)","44e77e60":"print(\"Accuracy train MLP: \", accuracy_score(y_train, y_train_pred_MLP))\nprint(\"Accuracy test MLP: \", accuracy_score(y_test, y_test_pred_MLP))","a186da8a":"### column identification with a single value.","5ad725df":"### theory of statistical imputation with strategy= \"most_frequent\".","e27c5c7e":"### identification of columns with few values.","97b036db":"### Theory of iterative imputation.","b89595b3":"### Encoding.","d17d67be":"### XGB classifier","0b31024f":"# Machine Learning","7c3e2503":"# Preprocessing","ef436e6c":"## Pandas profiling","62fb9e19":"### MLP Classifier","f26f3a8a":"### theory of statistical imputation.","d33dc7fe":"### Scaling.","effe253c":"### duplicate detection.","f125be0b":"### Theory of imputation with KNN.","a4413b2c":"# EDA","947ffab3":"## Visualization","b13826e7":"### Imputation of Missing Values.","cff35290":"### Outliers","88468e21":"### Oversampling"}}