{"cell_type":{"1bfe9b31":"code","75213520":"code","095d626e":"code","6930f9ba":"code","4c535265":"code","b57bd2ef":"code","24bd3785":"code","d5e55096":"markdown","e2aa17b2":"markdown","577a56cc":"markdown"},"source":{"1bfe9b31":"from numba import jit \nimport numpy as np\nfrom sklearn.metrics import cohen_kappa_score, confusion_matrix\nimport warnings\nwarnings.filterwarnings(\"ignore\")","75213520":"a = np.array([3, 1, 2, 0, 1, 1, 2, 1])\np = np.array([0, 2, 1, 0, 0, 0, 1, 1])","095d626e":"def quadKappa(act,pred,n=4,hist_range=(0,3)):\n    \n    O = confusion_matrix(act,pred)\n    O = np.divide(O,np.sum(O))\n    \n    W = np.zeros((n,n))\n    for i in range(n):\n        for j in range(n):\n            W[i][j] = ((i-j)**2)\/((n-1)**2)\n            \n    act_hist = np.histogram(act,bins=n,range=hist_range)[0]\n    prd_hist = np.histogram(pred,bins=n,range=hist_range)[0]\n    \n    E = np.outer(act_hist,prd_hist)\n    E = np.divide(E,np.sum(E))\n    \n    num = np.sum(np.multiply(W,O))\n    den = np.sum(np.multiply(W,E))\n        \n    return 1-np.divide(num,den)","6930f9ba":"%time \nquadKappa(a,p)","4c535265":"@jit\ndef qwk3(a1, a2, max_rat=3):\n    assert(len(a1) == len(a2))\n    a1 = np.asarray(a1, dtype=int)\n    a2 = np.asarray(a2, dtype=int)\n\n    hist1 = np.zeros((max_rat + 1, ))\n    hist2 = np.zeros((max_rat + 1, ))\n\n    o = 0\n    for k in range(a1.shape[0]):\n        i, j = a1[k], a2[k]\n        hist1[i] += 1\n        hist2[j] += 1\n        o +=  (i - j) * (i - j)\n\n    e = 0\n    for i in range(max_rat + 1):\n        for j in range(max_rat + 1):\n            e += hist1[i] * hist2[j] * (i - j) * (i - j)\n\n    e = e \/ a1.shape[0]\n\n    return 1 - o \/ e","b57bd2ef":"%time\nqwk3(a,p)","24bd3785":"%time\ncohen_kappa_score(a, p, weights=\"quadratic\")","d5e55096":"## Sklearn Method","e2aa17b2":"## CPMP Method\nhttps:\/\/www.kaggle.com\/c\/data-science-bowl-2019\/discussion\/114133#latest-657027","577a56cc":"## @afajohn Method\nhttps:\/\/www.kaggle.com\/afajohn\/quadratic-weighted-kappa-with-numpy-flavor"}}