{"cell_type":{"61ac382f":"code","ad821aad":"code","6aa3cb47":"code","55827f5e":"code","1dfcf226":"code","b5b10073":"markdown"},"source":{"61ac382f":"import pandas as pd\nimport numpy as np\nfrom sklearn import preprocessing\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import roc_auc_score\nfrom xgboost import XGBRegressor","ad821aad":"df = pd.read_csv(\"..\/input\/songpopularity-folds\/train_folds.csv\")\ndf_test = pd.read_csv(\"..\/input\/song-popularity-prediction\/test.csv\")\nsample_submission = pd.read_csv(\"..\/input\/song-popularity-prediction\/sample_submission.csv\")","6aa3cb47":"useful_features = [c for c in df.columns if c not in (\"id\", \"song_popularity\", \"kfold\")]\ndf_test = df_test[useful_features]","55827f5e":"final_predictions = []\nscores = []\nfor fold in range(5):\n    xtrain =  df[df.kfold != fold].reset_index(drop=True)\n    xvalid = df[df.kfold == fold].reset_index(drop=True)\n    xtest = df_test.copy()\n\n    ytrain = xtrain.song_popularity\n    yvalid = xvalid.song_popularity\n    \n    xtrain = xtrain[useful_features]\n    xvalid = xvalid[useful_features]\n    \n    params = {'learning_rate': 0.05577304223933331, 'reg_lambda': 0.0007658947840445432, 'reg_alpha': 17.623636851981196, 'subsample': 0.33999208057433844, 'colsample_bytree': 0.505891850281641, 'max_depth': 3, 'early_stopping_rounds': 160, 'n_estimators': 15000, 'tree_method': 'exact', 'booster': 'gbtree', 'gamma': 2.7086327216154665e-05, 'grow_policy': 'depthwise'}\n    \n    model = XGBRegressor(\n        random_state=69,\n        **params\n    )\n    model.fit(xtrain, ytrain, early_stopping_rounds=300, eval_set=[(xvalid, yvalid)], verbose=1000)\n    preds_valid = model.predict(xvalid)\n    test_preds = model.predict(xtest)\n    final_predictions.append(test_preds)\n    auc = roc_auc_score(yvalid, preds_valid)\n    print(fold, auc)\n    scores.append(auc)\n\nprint(np.mean(scores), np.std(scores))","1dfcf226":"preds = np.mean(np.column_stack(final_predictions), axis=1)\nsample_submission.song_popularity = preds\nsample_submission.to_csv(\"submission.csv\", index=False)","b5b10073":"<div class=\"alert alert-warning\">\n<strong>The 5-Folds Training Notebook: https:\/\/www.kaggle.com\/rishirajacharya\/song-popularity-create-folds.<br>\n    The 5-Folds Training Dataset: https:\/\/www.kaggle.com\/rishirajacharya\/songpopularity-folds.<br>\n    Feel free to use this code and enjoy! I really appreciate if you upvote this notebook. Thank you!<\/strong>\n<\/div>"}}