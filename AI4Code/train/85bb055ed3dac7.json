{"cell_type":{"7e982233":"code","b76dd962":"code","19d20d58":"code","0b3c6374":"code","839a176e":"code","5cad8f18":"code","1575788b":"code","fd056a96":"code","5f255562":"code","c03f6ad8":"code","f41c7a48":"code","91331ab1":"code","666fd70c":"markdown","62ddee41":"markdown","60c2ae02":"markdown","957af385":"markdown","a0c2824e":"markdown"},"source":{"7e982233":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport warnings\nfrom functools import reduce\nwarnings.filterwarnings(\"ignore\")\n%matplotlib inline","b76dd962":"user_data = pd.read_csv(\"..\/input\/userdata\/user_data.csv\")\nitem_data = pd.read_csv(\"..\/input\/wwwkagglecomkangwenyi\/item.csv\")","19d20d58":"len(user_data[user_data[\"behavior_type\"] == 4])\/len(user_data)","0b3c6374":"# \u8f6c\u6362\u65f6\u95f4\u7c7b\u578b\nuser_data[\"time\"] = pd.to_datetime(user_data[\"time\"], format=\"%Y%m%d %H\")\nuser_data[\"date\"] = user_data[\"time\"].dt.date\nuser_data[\"hour\"] = user_data[\"time\"].dt.hour","839a176e":"item_list = item_data[\"item_id\"].unique().tolist()","5cad8f18":"# \u5546\u54c1\u6bcf\u5929\u7684\u8d2d\u4e70\u60c5\u51b5 in_itemlist\u8868\u793a\u662f\u5426\u7279\u6307\u5f85\u9884\u6d4b\u5546\u54c1\u5b50\u96c6\u7684\u5546\u54c1\ndef erveryday_buy_counts(in_itemlist=False):\n    if in_itemlist == True:\n        condition = user_data[\"item_id\"].isin(item_list)\n    else:\n        condition = True\n    item_day_buy_count = user_data[(user_data[\"behavior_type\"] == 4)&(condition)][[\"user_id\", \"item_id\", \"date\"]].drop_duplicates()\n    item_day_buy_count[\"buy_count\"] = 1\n    item_day_buy_count[\"date\"] = item_day_buy_count[\"date\"].apply(lambda x : str(x)[5:]) # \u65e5\u671f\u53ea\u663e\u793a\u6708\u65e5\n    item_day_buy_count = item_day_buy_count[[\"date\", \"buy_count\"]].groupby(\"date\", as_index=False).count().sort_values(by=\"date\")\n    # \u7ed8\u5236\u67f1\u72b6\u56fe\n    f, ax = plt.subplots(figsize=(20, 5))\n    fig = sns.barplot(x=item_day_buy_count[\"date\"], y=item_day_buy_count[\"buy_count\"])","1575788b":"# \u5546\u54c1\u5168\u96c6\u6bcf\u5929\u7684\u8d2d\u4e70\u60c5\u51b5\nerveryday_buy_counts(in_itemlist=False)","fd056a96":"# \u5546\u54c1\u5b50\u96c6\u6bcf\u5929\u7684\u8d2d\u4e70\u60c5\u51b5\nerveryday_buy_counts(in_itemlist=True)","5f255562":"# \u7528\u6237\u76f8\u5173\u7279\u5f81\u63d0\u53d6\u51fd\u6570\n# \u7528\u6237\u6267\u884c\u5404\u9879type\u64cd\u4f5c\u7684\u603b\u6b21\u6570\ndef user_action_total_counts(data):\n    data[\"user_action_total_counts\"] = 1\n    feature = data[[\"user_id\", \"user_action_total_counts\"]].groupby([\"user_id\"], as_index=False).count()\n    return feature\n# \u7528\u6237\u6267\u884ctype\u64cd\u4f5c\u7684\u6b21\u6570  data:\u6570\u636e type:\u64cd\u4f5c\u7c7b\u578b name:\u65b0\u589e\u5217\u540d\u79f0\ndef user_type_counts(data, type, name):\n    data[name] = 1\n    feature = data[data[\"behavior_type\"] == type][[\"user_id\", name]].groupby([\"user_id\"], as_index=False).count()\n    return feature\n\n# \u5546\u54c1\u76f8\u5173\u7279\u5f81\u63d0\u53d6\u51fd\u6570\n# \u5546\u54c1\u88ab\u6267\u884c\u5404\u9879type\u64cd\u4f5c\u7684\u603b\u6b21\u6570\ndef item_action_total_counts(data):\n    data[\"item_action_total_counts\"] = 1\n    feature = data[[\"item_id\", \"item_action_total_counts\"]].groupby([\"item_id\"], as_index=False).count()\n    return feature\n# \u5bf9\u5546\u54c1\u6267\u884c\u5404\u9879type\u64cd\u4f5c\u7684\u7528\u6237\u603b\u6570\ndef item_total_user_counts(data):\n    data = data[[\"user_id\", \"item_id\"]].drop_duplicates()\n    data[\"item_total_user_counts\"] = 1\n    feature = data[[\"item_id\", \"item_total_user_counts\"]].groupby([\"item_id\"], as_index=False).count()\n    return feature\n# \u5546\u54c1\u88ab\u6267\u884ctype\u64cd\u4f5c\u7684\u6b21\u6570\ndef item_type_counts(data, type, name):\n    data[name] = 1\n    feature = data[data[\"behavior_type\"] == type][[\"item_id\", name]].groupby([\"item_id\"], as_index=False).count()\n    return feature\n\n# \u5546\u54c1\u7c7b\u578b\u76f8\u5173\u7279\u5f81\u63d0\u53d6\u51fd\u6570\n# \u6b64\u7c7b\u578b\u5546\u54c1\u88ab\u6267\u884c\u5404\u9879type\u64cd\u4f5c\u7684\u603b\u6b21\u6570\ndef category_action_total_counts(data):\n    data[\"category_action_total_counts\"] = 1\n    feature = data[[\"item_category\", \"category_action_total_counts\"]].groupby([\"item_category\"], as_index=False).count()\n    return feature\n# \u5bf9\u6b64\u7c7b\u578b\u5546\u54c1\u6267\u884c\u5404\u9879type\u64cd\u4f5c\u7684\u7528\u6237\u603b\u6570\ndef category_total_user_counts(data):\n    data = data[[\"user_id\", \"item_category\"]].drop_duplicates()\n    data[\"category_total_user_counts\"] = 1\n    feature = data[[\"item_category\", \"category_total_user_counts\"]].groupby([\"item_category\"], as_index=False).count()\n    return feature\n# \u6b64\u7c7b\u578b\u5546\u54c1\u88ab\u6267\u884ctype\u64cd\u4f5c\u7684\u6b21\u6570\ndef category_type_counts(data, type, name):\n    data[name] = 1\n    feature = data[data[\"behavior_type\"] == type][[\"item_category\", name]].groupby([\"item_category\"], as_index=False).count()\n    return feature\n\n# \u7528\u6237-\u5546\u54c1\u76f8\u5173\u7279\u5f81\u63d0\u53d6\u51fd\u6570\n# \u7528\u6237\u5bf9\u5546\u54c1\u6267\u884c\u5404\u9879type\u64cd\u4f5c\u7684\u603b\u6b21\u6570\ndef user_item_action_total_counts(data):\n    data[\"user_item_action_total_counts\"] = 1\n    feature = data[[\"user_id\", \"item_id\", \"user_item_action_total_counts\"]].groupby([\"user_id\", \"item_id\"], as_index=False).count()\n    return feature\n# \u7528\u6237\u5bf9\u5546\u54c1\u6267\u884ctype\u64cd\u4f5c\u7684\u6b21\u6570\ndef user_item_type_counts(data, type, name):\n    data[name] = 1\n    feature = data[data[\"behavior_type\"] == type][[\"user_id\", \"item_id\", name]].groupby([\"user_id\", \"item_id\"], as_index=False).count()\n    return feature\n# \u7528\u6237\u5bf9\u5546\u54c1\u6267\u884ctype\u64cd\u4f5c\u7684\u6700\u540e\u65f6\u95f4 \ndef user_item_last_type_time(data, type, name):\n    feature = data[data[\"behavior_type\"] == type][[\"user_id\", \"item_id\", \"time\"]].groupby([\"user_id\", \"item_id\"], as_index=False).max()\n    feature.rename(columns={\"time\": name}, inplace=True)\n    return feature\n\n# \u7528\u6237\u7b2c\u4e00\u6b21\u8d2d\u4e70\u7279\u5b9a\u5546\u54c1\u4ece\u6d4f\u89c8\u5230\u8d2d\u4e70\u7684\u65f6\u95f4\u95f4\u9694\u3001\u8fc7\u7a0b\u4e2d\u7684\u6d4f\u89c8\u6b21\u6570\u548c\u52a0\u5165\u8d2d\u7269\u8f66\u5230\u8d2d\u4e70\u7684\u65f6\u95f4\u95f4\u9694\ndef user_item_look_to_buy(data):\n    # \u7528\u6237\u8d2d\u4e70\u8fc7\u7684\u7528\u6237-\u5546\u54c1\u7ec4\u5408\n    buy_user_item = data[data[\"behavior_type\"] == 4][[\"user_id\", \"item_id\"]].drop_duplicates()\n    # \u7528\u6237-\u5546\u54c1\u7ec4\u5408\u7684\u6570\u636e\n    data = pd.merge(buy_user_item, data, how=\"left\", on=[\"user_id\", \"item_id\"])[[\"user_id\", \"item_id\", \"behavior_type\", \"time\"]]\n    # \u7b2c\u4e00\u6b21\u6d4f\u89c8\u5546\u54c1\u7684\u65f6\u95f4\n    earliest_look = data[data[\"behavior_type\"] == 1].groupby([\"user_id\", \"item_id\"], as_index=False).min()\n    earliest_look.rename(columns={\"time\": \"earliest_look_time\"}, inplace=True)\n    # \u7b2c\u4e00\u6b21\u8d2d\u4e70\u5546\u54c1\u7684\u65f6\u95f4\n    earliest_buy = data[data[\"behavior_type\"] == 4].groupby([\"user_id\", \"item_id\"], as_index=False).min()\n    earliest_buy.rename(columns={\"time\": \"earliest_buy_time\"}, inplace=True)\n    # \u7b2c\u4e00\u6b21\u5c06\u5546\u54c1\u52a0\u5165\u8d2d\u7269\u8f66\u7684\u65f6\u95f4\n    earliest_add = data[data[\"behavior_type\"] == 3].groupby([\"user_id\", \"item_id\"], as_index=False).min()\n    earliest_add.rename(columns={\"time\": \"earliest_add_time\"}, inplace=True)\n    # \u7b2c\u4e00\u6b21\u8d2d\u4e70\u5546\u54c1\u4e2d\u6d4f\u89c8\u5230\u8d2d\u4e70\u7684\u65f6\u95f4\u95f4\u9694(\u5355\u4f4d\uff1a\u5c0f\u65f6)\n    feature = pd.merge(earliest_buy, earliest_look, how=\"left\", on=[\"user_id\", \"item_id\"])\n    feature[\"earliest_user_item_timedelta_look_to_buy\"] = (feature[\"earliest_buy_time\"] - feature[\"earliest_look_time\"]).dt.total_seconds()\/360000\n    feature = feature[feature[\"earliest_user_item_timedelta_look_to_buy\"] >= 0]\n    feature = feature[[\"user_id\", \"item_id\", \"earliest_look_time\", \"earliest_buy_time\", \"earliest_user_item_timedelta_look_to_buy\"]]\n    # \u7b2c\u4e00\u6b21\u8d2d\u4e70\u5546\u54c1\u8fc7\u7a0b\u4e2d\u7684\u6d4f\u89c8\u6b21\u6570\n    data = pd.merge(feature, data, how=\"left\", on=[\"user_id\", \"item_id\"])\n    data = data[(data[\"behavior_type\"] == 1)&(data[\"time\"] <= data[\"earliest_buy_time\"])]\n    data[\"item_look_counts_before_buy\"] = 1\n    item_look_counts_before_buy = data[[\"user_id\", \"item_id\", \"item_look_counts_before_buy\"]].groupby([\"user_id\", \"item_id\"], as_index=False).count()\n    feature = pd.merge(feature, item_look_counts_before_buy, how=\"left\", on=[\"user_id\", \"item_id\"])\n    # \u8fd4\u56de\u7ed3\u679c\n    return feature[[\"user_id\", \"item_id\", \"item_look_counts_before_buy\", \"earliest_user_item_timedelta_look_to_buy\"]]\n\n# \u7528\u6237-\u5546\u54c1\u7c7b\u578b\u76f8\u5173\u7279\u5f81\u63d0\u53d6\u51fd\u6570\n# \u7528\u6237\u5bf9\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u6267\u884c\u5404\u9879type\u64cd\u4f5c\u7684\u603b\u6b21\u6570\ndef user_category_action_total_counts(data):\n    data[\"user_category_action_total_counts\"] = 1\n    feature = data[[\"user_id\", \"item_category\", \"user_category_action_total_counts\"]].groupby([\"user_id\", \"item_category\"], as_index=False).count()\n    return feature\n# \u7528\u6237\u5bf9\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u6267\u884ctype\u64cd\u4f5c\u7684\u6b21\u6570\ndef user_category_type_counts(data, type, name):\n    data[name] = 1\n    feature = data[data[\"behavior_type\"] == type][[\"user_id\", \"item_category\", name]].groupby([\"user_id\", \"item_category\"], as_index=False).count()\n    return feature\n# \u7528\u6237\u5bf9\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u6267\u884ctype\u64cd\u4f5c\u7684\u6700\u540e\u65f6\u95f4\ndef user_category_last_type_time(data, type, name):\n    feature = data[data[\"behavior_type\"] == type][[\"user_id\", \"item_category\", \"time\"]].groupby([\"user_id\", \"item_category\"], as_index=False).max()\n    feature.rename(columns={\"time\": name}, inplace=True)\n    return feature\n# \u7528\u6237\u7b2c\u4e00\u6b21\u8d2d\u4e70\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u4ece\u6d4f\u89c8\u5230\u8d2d\u4e70\u7684\u65f6\u95f4\u95f4\u9694\u548c\u8fc7\u7a0b\u4e2d\u7684\u6d4f\u89c8\u6b21\u6570\ndef user_category_look_to_buy(data):\n    # \u7528\u6237\u8d2d\u4e70\u8fc7\u7684\u7528\u6237-\u5546\u54c1\u7c7b\u578b\u7ec4\u5408\n    buy_user_item = data[data[\"behavior_type\"] == 4][[\"user_id\", \"item_category\"]].drop_duplicates()\n    # \u7528\u6237-\u5546\u54c1\u7c7b\u578b\u7ec4\u5408\u7684\u6570\u636e\n    data = pd.merge(buy_user_item, data, how=\"left\", on=[\"user_id\", \"item_category\"])[[\"user_id\", \"item_category\", \"behavior_type\", \"time\"]]\n    # \u7b2c\u4e00\u6b21\u6d4f\u89c8\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u7684\u65f6\u95f4\n    earliest_look = data[data[\"behavior_type\"] == 1].groupby([\"user_id\", \"item_category\"], as_index=False).min()\n    earliest_look.rename(columns={\"time\": \"earliest_look_time\"}, inplace=True)\n    # \u7b2c\u4e00\u6b21\u8d2d\u4e70\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u7684\u65f6\u95f4\n    earliest_buy = data[data[\"behavior_type\"] == 4].groupby([\"user_id\", \"item_category\"], as_index=False).min()\n    earliest_buy.rename(columns={\"time\": \"earliest_buy_time\"}, inplace=True)\n    # \u7b2c\u4e00\u6b21\u5c06\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u52a0\u5165\u8d2d\u7269\u8f66\u7684\u65f6\u95f4\n    earliest_add = data[data[\"behavior_type\"] == 3].groupby([\"user_id\", \"item_category\"], as_index=False).min()\n    earliest_add.rename(columns={\"time\": \"earliest_add_time\"}, inplace=True)\n    # \u7b2c\u4e00\u6b21\u8d2d\u4e70\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u4e2d\u6d4f\u89c8\u5230\u8d2d\u4e70\u7684\u65f6\u95f4\u95f4\u9694(\u5355\u4f4d\uff1a\u5c0f\u65f6)\n    feature = pd.merge(earliest_buy, earliest_look, how=\"left\", on=[\"user_id\", \"item_category\"])\n    feature[\"earliest_user_category_timedelta_look_to_buy\"] = (feature[\"earliest_buy_time\"] - feature[\"earliest_look_time\"]).dt.total_seconds()\/3600\n    feature = feature[feature[\"earliest_user_category_timedelta_look_to_buy\"] >= 0]\n    feature = feature[[\"user_id\", \"item_category\", \"earliest_look_time\", \"earliest_buy_time\", \"earliest_user_category_timedelta_look_to_buy\"]]\n    # \u7b2c\u4e00\u6b21\u8d2d\u4e70\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u8fc7\u7a0b\u4e2d\u7684\u6d4f\u89c8\u6b21\u6570\n    data = pd.merge(feature, data, how=\"left\", on=[\"user_id\", \"item_category\"])\n    data = data[(data[\"behavior_type\"] == 1)&(data[\"time\"] <= data[\"earliest_buy_time\"])]\n    data[\"category_look_counts_before_buy\"] = 1\n    category_look_counts_before_buy = data[[\"user_id\", \"item_category\", \"category_look_counts_before_buy\"]].groupby([\"user_id\", \"item_category\"], as_index=False).count()\n    feature = pd.merge(feature, category_look_counts_before_buy, how=\"left\", on=[\"user_id\", \"item_category\"])\n    # \u8fd4\u56de\u7ed3\u679c\n    return feature[[\"user_id\", \"item_category\", \"category_look_counts_before_buy\", \"earliest_user_category_timedelta_look_to_buy\"]]\n\n ","c03f6ad8":"def merge_user(data1, data2):\n    data = pd.merge(data1, data2, how=\"left\", on=\"user_id\")\n    return data\ndef merge_item(data1, data2):\n    data = pd.merge(data1, data2, how=\"left\", on=\"item_id\")\n    return data\ndef merge_category(data1, data2):\n    data = pd.merge(data1, data2, how=\"left\", on=\"item_category\")\n    return data\ndef merge_user_item(data1, data2):\n    data = pd.merge(data1, data2, how=\"left\", on=[\"user_id\", \"item_id\"])\n    return data\ndef merge_user_category(data1, data2):\n    data = pd.merge(data1, data2, how=\"left\", on=[\"user_id\", \"item_category\"])\n    return data\n","f41c7a48":"# \u6784\u9020\u7279\u5f81\u51fd\u6570 predict_date:\u9884\u6d4b\u65e5\u671f\ndef get_feature(predict_date):\n    train_data = user_data[user_data[\"time\"] < predict_date]\n    # \u7528\u6237\u76f8\u5173\u7279\u5f81\n    # u1:\u7528\u6237\u6267\u884c\u5404\u9879type\u64cd\u4f5c\u7684\u603b\u6b21\u6570\n#     u1 = user_action_total_counts(train_data)\n#     # u2:\u7528\u6237\u6d4f\u89c8\u5546\u54c1\u7684\u6b21\u6570\n#     u2 = user_type_counts(train_data, 1, \"user_look_counts\")\n#     # u3:\u7528\u6237\u6536\u85cf\u5546\u54c1\u7684\u6b21\u6570\n#     u3 = user_type_counts(train_data, 2, \"user_like_counts\")\n#     # u4:\u7528\u6237\u52a0\u5165\u8d2d\u7269\u8f66\u7684\u6b21\u6570\n#     u4 = user_type_counts(train_data, 3, \"user_add_counts\")\n#     # u5:\u7528\u6237\u8d2d\u4e70\u5546\u54c1\u7684\u6b21\u6570\n#     u5 = user_type_counts(train_data, 4, \"user_buy_counts\")\n    \n#     # \u5546\u54c1\u76f8\u5173\u7279\u5f81\n#     # i1:\u5546\u54c1\u88ab\u6267\u884c\u5404\u9879type\u64cd\u4f5c\u7684\u603b\u6b21\u6570\n#     i1 = item_action_total_counts(train_data)\n#     # i2:\u5bf9\u5546\u54c1\u6267\u884c\u5404\u9879type\u64cd\u4f5c\u7684\u7528\u6237\u603b\u6570\n#     i2 = item_total_user_counts(train_data)\n#     # i3:\u5546\u54c1\u88ab\u6d4f\u89c8\u7684\u6b21\u6570\n#     i3 = item_type_counts(train_data, 1, \"item_look_counts\")\n#     # i4:\u5546\u54c1\u88ab\u6536\u85cf\u7684\u6b21\u6570\n#     i4 = item_type_counts(train_data, 2, \"item_like_counts\")\n#     # i5:\u5546\u54c1\u88ab\u52a0\u5165\u8d2d\u7269\u8f66\u7684\u6b21\u6570\n#     i5 = item_type_counts(train_data, 3, \"item_add_counts\")\n#     # i6:\u5546\u54c1\u88ab\u8d2d\u4e70\u7684\u6b21\u6570\n#     i6 = item_type_counts(train_data, 4, \"item_buy_counts\")\n    \n#     # \u5546\u54c1\u7c7b\u578b\u7279\u5f81\n#     # c1:\u5546\u54c1\u88ab\u6267\u884c\u5404\u9879type\u64cd\u4f5c\u7684\u603b\u6b21\u6570\n#     c1 = category_action_total_counts(train_data)\n#     # c2:\u5bf9\u5546\u54c1\u6267\u884c\u5404\u9879type\u64cd\u4f5c\u7684\u7528\u6237\u603b\u6570\n#     c2 = category_total_user_counts(train_data)\n#     # c3:\u6b64\u7c7b\u578b\u5546\u54c1\u88ab\u6d4f\u89c8\u7684\u6b21\u6570\n#     c3 = category_type_counts(train_data, 1, \"category_look_counts\")\n#     # c4:\u6b64\u7c7b\u578b\u5546\u54c1\u88ab\u6536\u85cf\u7684\u6b21\u6570\n#     c4 = category_type_counts(train_data, 2, \"category_like_counts\")\n#     # c5:\u6b64\u7c7b\u578b\u5546\u54c1\u88ab\u52a0\u5165\u8d2d\u7269\u8f66\u7684\u6b21\u6570\n#     c5 = category_type_counts(train_data, 3, \"category_add_counts\")\n#     # c6:\u6b64\u7c7b\u578b\u5546\u54c1\u88ab\u8d2d\u4e70\u7684\u6b21\u6570\n#     c6 = category_type_counts(train_data, 4, \"category_buy_counts\")\n    \n   # \u7528\u6237-\u5546\u54c1\u76f8\u5173\u7279\u5f81\n    # ui1:\u7528\u6237\u5bf9\u5546\u54c1\u6267\u884c\u5404\u9879type\u64cd\u4f5c\u7684\u603b\u6b21\u6570\n#     ui1 = user_item_action_total_counts(train_data)\n    # ui2:\u7528\u6237\u6d4f\u89c8\u7279\u5b9a\u5546\u54c1\u7684\u6b21\u6570\n    ui2 = user_item_type_counts(train_data, 1, \"user_item_look_counts\")\n#     # ui3:\u7528\u6237\u6536\u85cf\u7279\u5b9a\u5546\u54c1\u7684\u6b21\u6570\n#     ui3 = user_item_type_counts(train_data, 2, \"user_item_like_counts\")\n#     # ui4:\u7528\u6237\u5c06\u7279\u5b9a\u5546\u54c1\u52a0\u5165\u8d2d\u7269\u8f66\u7684\u6b21\u6570\n#     ui4 = user_item_type_counts(train_data, 3, \"user_item_add_counts\")\n    # ui5:\u7528\u6237\u8d2d\u4e70\u7279\u5b9a\u5546\u54c1\u7684\u6b21\u6570\n    ui5 = user_item_type_counts(train_data, 4, \"user_item_buy_counts\")\n    # ui6:\u7528\u6237\u6d4f\u89c8\u7279\u5b9a\u5546\u54c1\u7684\u6700\u540e\u65f6\u95f4\n    ui6 = user_item_last_type_time(train_data, 1, \"user_item_last_look_time\")\n    # ui7:\u7528\u6237\u6536\u85cf\u7279\u5b9a\u5546\u54c1\u7684\u6700\u540e\u65f6\u95f4\n    ui7 = user_item_last_type_time(train_data, 2, \"user_item_last_like_time\")\n    # ui8:\u7528\u6237\u5c06\u7279\u5b9a\u5546\u54c1\u52a0\u5165\u8d2d\u7269\u8f66\u7684\u6700\u540e\u65f6\u95f4\n    ui8 = user_item_last_type_time(train_data, 3, \"user_item_last_add_time\")\n    # ui9:\u7528\u6237\u8d2d\u4e70\u7279\u5b9a\u5546\u54c1\u7684\u6700\u540e\u65f6\u95f4\n    ui9 = user_item_last_type_time(train_data, 4, \"user_item_last_buy_time\")\n    # ui10:\u7528\u6237\u7b2c\u4e00\u6b21\u8d2d\u4e70\u7279\u5b9a\u5546\u54c1\u4ece\u6d4f\u89c8\u5230\u8d2d\u4e70\u7684\u65f6\u95f4\u95f4\u9694\u548c\u8fc7\u7a0b\u4e2d\u7684\u6d4f\u89c8\u6b21\u6570\n    ui10 = user_item_look_to_buy(train_data)\n    \n    # \u7528\u6237-\u5546\u54c1\u7c7b\u578b\u76f8\u5173\u7279\u5f81\n    # uc1:\u7528\u6237\u5bf9\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u6267\u884c\u5404\u9879type\u64cd\u4f5c\u7684\u603b\u6b21\u6570\n#     uc1 = user_category_action_total_counts(train_data)\n#     # uc2:\u7528\u6237\u6d4f\u89c8\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u7684\u6b21\u6570\n    uc2 = user_category_type_counts(train_data, 1, \"user_category_look_counts\")\n#     # uc3:\u7528\u6237\u6536\u85cf\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u7684\u6b21\u6570\n#     uc3 = user_category_type_counts(train_data, 2, \"user_category_like_counts\")\n#     # uc4:\u7528\u6237\u5c06\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u52a0\u5165\u8d2d\u7269\u8f66\u7684\u6b21\u6570\n#     uc4 = user_category_type_counts(train_data, 3, \"user_category_add_counts\")\n    # uc5:\u7528\u6237\u8d2d\u4e70\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u7684\u6b21\u6570\n    uc5 = user_category_type_counts(train_data, 4, \"user_category_buy_counts\")\n    # uc6:\u7528\u6237\u6d4f\u89c8\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u7684\u6700\u540e\u65f6\u95f4\n    uc6 = user_category_last_type_time(train_data, 1, \"user_category_last_look_time\")\n    # uc7:\u7528\u6237\u6536\u85cf\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u7684\u6700\u540e\u65f6\u95f4\n    uc7 = user_category_last_type_time(train_data, 2, \"user_category_last_like_time\")\n    # uc8:\u7528\u6237\u5c06\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u52a0\u5165\u8d2d\u7269\u8f66\u7684\u6700\u540e\u65f6\u95f4\n    uc8 = user_category_last_type_time(train_data, 3, \"user_category_last_add_time\")\n    # uc9:\u7528\u6237\u8d2d\u4e70\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u7684\u6700\u540e\u65f6\u95f4\n    uc9 = user_category_last_type_time(train_data, 4, \"user_category_last_buy_time\")\n    # uc10:\u7528\u6237\u7b2c\u4e00\u6b21\u8d2d\u4e70\u540c\u79cd\u7c7b\u578b\u5546\u54c1\u4ece\u6d4f\u89c8\u5230\u8d2d\u4e70\u7684\u65f6\u95f4\u95f4\u9694\u548c\u8fc7\u7a0b\u4e2d\u7684\u6d4f\u89c8\u6b21\u6570\n    uc10 = user_category_look_to_buy(train_data)\n    # \u8054\u7ed3\u8868\n    train_data = train_data[[\"user_id\", \"item_id\", \"item_category\"]].drop_duplicates()\n#     train_data = reduce(merge_user, [train_data, u1, u2, u3, u4, u5])\n#     train_data = reduce(merge_item, [train_data, i1, i2, i3, i4, i5, i6])\n#     train_data = reduce(merge_category, [train_data, c1, c2, c3, c4, c5, c6])\n#     train_data = reduce(merge_user_item, [train_data, ui1, ui2, ui3, ui4, ui5, ui6, ui7, ui8, ui9, ui10])\n#     train_data = reduce(merge_user_category, [train_data, uc1, uc2, uc3, uc4, uc5, uc6, uc7, uc8, uc9, uc10])\n    train_data = reduce(merge_user_item, [train_data, ui2, ui5, ui6, ui7, ui8, ui9, ui10])\n    train_data = reduce(merge_user_category, [train_data, uc2, uc5, uc6, uc7, uc8, uc9, uc10])\n    # \u8ddd\u9884\u6d4b\u65e5\u671f\u7684\u65f6\u95f4\u95f4\u9694 \u5355\u4f4d\uff1a\u5c0f\u65f6\n    train_data[\"user_item_last_look_to_now\"] = (pd.to_datetime(predict_date) - train_data[\"user_item_last_look_time\"]).dt.total_seconds()\/3600\n    train_data[\"user_item_last_like_to_now\"] = (pd.to_datetime(predict_date) - train_data[\"user_item_last_like_time\"]).dt.total_seconds()\/3600\n    train_data[\"user_item_last_add_to_now\"] = (pd.to_datetime(predict_date) - train_data[\"user_item_last_add_time\"]).dt.total_seconds()\/3600\n    train_data[\"user_item_last_buy_to_now\"] = (pd.to_datetime(predict_date) - train_data[\"user_item_last_buy_time\"]).dt.total_seconds()\/3600\n    train_data[\"user_category_last_look_to_now\"] = (pd.to_datetime(predict_date) - train_data[\"user_category_last_look_time\"]).dt.total_seconds()\/3600\n    train_data[\"user_category_last_like_to_now\"] = (pd.to_datetime(predict_date) - train_data[\"user_category_last_like_time\"]).dt.total_seconds()\/3600\n    train_data[\"user_category_last_add_to_now\"] = (pd.to_datetime(predict_date) - train_data[\"user_category_last_add_time\"]).dt.total_seconds()\/3600\n    train_data[\"user_category_last_buy_to_now\"] = (pd.to_datetime(predict_date) - train_data[\"user_category_last_buy_time\"]).dt.total_seconds()\/3600\n    # \u5220\u9664\u65e0\u7528\u7279\u5f81\n    drop_columns = [\"user_item_last_look_time\", \"user_item_last_like_time\", \"user_item_last_add_time\", \"user_item_last_buy_time\"]\n    drop_columns += [\"user_category_last_look_time\", \"user_category_last_like_time\", \"user_category_last_add_time\", \"user_category_last_buy_time\"]\n    train_data = train_data.drop(drop_columns, axis=1)\n    # \u5904\u7406\u7f3a\u5931\u503c\n#     fill_columns = [\"user_look_counts\", \"user_like_counts\", \"user_add_counts\", \"user_buy_counts\"]\n#     fill_columns += [\"item_look_counts\", \"item_like_counts\", \"item_add_counts\", \"item_buy_counts\"]\n#     fill_columns += [\"category_look_counts\", \"category_like_counts\", \"category_add_counts\", \"category_buy_counts\"]\n    fill_columns = [\"user_item_look_counts\", \"user_item_buy_counts\"]\n    fill_columns += [\"user_category_look_counts\", \"user_category_buy_counts\"]\n    train_data[fill_columns] = train_data[fill_columns].fillna(0)\n    return train_data\n","91331ab1":"data_train = get_feature(\"2014-12-17\")\ndata_eval = get_feature(\"2014-12-18\")\ndata_test = get_feature(\"2014-12-19\")\ndata_train.to_csv(\"data_train.csv\", index=False)\ndata_eval.to_csv(\"data_eval.csv\", index=False)\ndata_test.to_csv(\"data_test.csv\", index=False)\nuser_data.to_csv(\"user_data_new.csv\", index=False)\nitem_data.to_csv(\"item_data_new.csv\", index=False)","666fd70c":"\u878d\u5408\u5404\u7279\u5f81\u5217","62ddee41":"\u8bad\u7ec3\u96c6\uff1a12.17\u4ee5\u524d\u7684\u6570\u636e\uff1b\u9a8c\u8bc1\u96c6\uff1a12.18\u4ee5\u524d\u7684\u6570\u636e\uff1b\u6d4b\u8bd5\u96c6\uff1a12.19\u4ee5\u524d\u7684\u6570\u636e","60c2ae02":"\u6b63\u8d1f\u6837\u672c\u6bd4\u53ca\u5176\u4e0d\u5747\u8861","957af385":"\u5148\u53d6\u5168\u90e8\u7279\u5f81\uff0c\u5f85\u5230\u4e4b\u540e\u7684\u7279\u5f81\u91cd\u8981\u6027\u9009\u62e9\u51fa\u4e00\u90e8\u5206\u8f83\u4e3a\u91cd\u8981\u7684\u7279\u5f81\u4f5c\u4e3a\u6700\u540e\u7279\u5f81","a0c2824e":"\u67e5\u770b\u6b63\u8d1f\u6837\u672c\u6bd4\u4f8b"}}