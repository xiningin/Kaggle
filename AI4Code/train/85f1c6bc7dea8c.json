{"cell_type":{"0e8c5da2":"code","077be9ed":"code","db315b9e":"code","484c602a":"code","ec1242bf":"code","71266d2e":"code","49817d4c":"code","5aa88416":"code","e9980ac1":"code","0ee78893":"code","13c2f6ec":"code","ec0f468a":"code","cad63682":"code","7984883a":"code","be7dbc92":"code","8f7a5834":"code","3774354f":"code","54ae105d":"code","d275cc9c":"code","3fa36732":"code","75e24963":"code","6634983e":"code","447b9b99":"code","409edfd8":"code","3c94084f":"code","7af3531b":"code","576879a5":"code","f945d2f3":"code","742d83d4":"code","86b4d401":"code","38d4532b":"code","43ade8c6":"code","f2a329ce":"code","0315c033":"code","68934677":"code","a4f78fc6":"code","e1c45b9d":"code","6151e205":"markdown","ed1cb928":"markdown","e6f610b4":"markdown","7255500b":"markdown","27d3fe56":"markdown","dee7cd8b":"markdown","89b59ad6":"markdown","837647bd":"markdown","52eb3fa9":"markdown","54efe1d9":"markdown","f1f88ba9":"markdown","2cc7acb1":"markdown","4e2731b9":"markdown","bdba1a37":"markdown","9d2e62a5":"markdown","2a4d793c":"markdown","db270be0":"markdown","e853f818":"markdown","5b9929dd":"markdown","699d8011":"markdown","4908f837":"markdown","861beb2c":"markdown","2153d546":"markdown","34dd384a":"markdown","2f3c9cf3":"markdown","05192327":"markdown","c1e8717e":"markdown","06d2cdf4":"markdown","ee30d065":"markdown","61747704":"markdown","e1b9f6c0":"markdown","bd5c1546":"markdown","4a14c577":"markdown","8cd74848":"markdown","a219570f":"markdown","57dd9dbb":"markdown","24ee9fe8":"markdown","b8e6999a":"markdown","7ab8f6b3":"markdown","72a8e402":"markdown","bf6e3c25":"markdown","fd9d01dd":"markdown","e497854c":"markdown","8b280b2f":"markdown","5afe0d3f":"markdown","3b815b35":"markdown","5253df4f":"markdown","c027cc1b":"markdown"},"source":{"0e8c5da2":"\n\nimport numpy as np \nimport pandas as pd \n\n\nimport os\nprint(os.listdir(\"..\/input\"))\nfrom pylab import plot,show\nfrom numpy import vstack,array\nfrom numpy.random import rand\nfrom scipy.cluster.vq import kmeans,vq\nfrom sklearn import datasets\nimport pandas as pd\nfrom sklearn.decomposition import PCA\nfrom sklearn.cluster import KMeans\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport numpy as np\nfrom scipy.stats import norm\nfrom sklearn.preprocessing import StandardScaler\nfrom scipy import stats\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.metrics import roc_auc_score\n\n\n","077be9ed":"Cancer = pd.read_csv(\"..\/input\/kag_risk_factors_cervical_cancer.csv\")","db315b9e":"Cancer.info()","484c602a":"Cancer['Biopsy'].value_counts()","ec1242bf":"Cancerna = Cancer.replace('?', np.nan) ","71266d2e":"Cancerna.isnull().sum() ","49817d4c":"Cancer = Cancerna","5aa88416":"Cancer.drop(Cancer.columns[[26,27,32,33,34]], axis=1, inplace=True)","e9980ac1":"Cancer.isnull().sum()","0ee78893":"Cancer = Cancer.convert_objects(convert_numeric=True) ","13c2f6ec":"Cancer['Number of sexual partners'] = Cancer['Number of sexual partners'].fillna(Cancer['Number of sexual partners'].mean())\nCancer['First sexual intercourse'] = Cancer['First sexual intercourse'].fillna(Cancer['First sexual intercourse'].mean())\nCancer['Num of pregnancies'] = Cancer['Num of pregnancies'].fillna(Cancer['Num of pregnancies'].median())\nCancer['Smokes'] = Cancer['Smokes'].fillna(Cancer['Smokes'].median())\nCancer['Smokes (years)'] = Cancer['Smokes (years)'].fillna(Cancer['Smokes (years)'].mean())\nCancer['Smokes (packs\/year)'] = Cancer['Smokes (packs\/year)'].fillna(Cancer['Smokes (packs\/year)'].mean())\nCancer['Hormonal Contraceptives'] = Cancer['Hormonal Contraceptives'].fillna(Cancer['Hormonal Contraceptives'].median())\nCancer['Hormonal Contraceptives (years)'] = Cancer['Hormonal Contraceptives (years)'].fillna(Cancer['Hormonal Contraceptives (years)'].mean())\nCancer['IUD'] = Cancer['IUD'].fillna(Cancer['IUD'].median()) \nCancer['IUD (years)'] = Cancer['IUD (years)'].fillna(Cancer['IUD (years)'].mean())\nCancer['STDs'] = Cancer['STDs'].fillna(Cancer['STDs'].median())\nCancer['STDs (number)'] = Cancer['STDs (number)'].fillna(Cancer['STDs (number)'].median())\nCancer['STDs:condylomatosis'] = Cancer['STDs:condylomatosis'].fillna(Cancer['STDs:condylomatosis'].median())\nCancer['STDs:cervical condylomatosis'] = Cancer['STDs:cervical condylomatosis'].fillna(Cancer['STDs:cervical condylomatosis'].median())\nCancer['STDs:vaginal condylomatosis'] = Cancer['STDs:vaginal condylomatosis'].fillna(Cancer['STDs:vaginal condylomatosis'].median())\nCancer['STDs:vulvo-perineal condylomatosis'] = Cancer['STDs:vulvo-perineal condylomatosis'].fillna(Cancer['STDs:vulvo-perineal condylomatosis'].median())\nCancer['STDs:syphilis'] = Cancer['STDs:syphilis'].fillna(Cancer['STDs:syphilis'].median())\nCancer['STDs:pelvic inflammatory disease'] = Cancer['STDs:pelvic inflammatory disease'].fillna(Cancer['STDs:pelvic inflammatory disease'].median())\nCancer['STDs:genital herpes'] = Cancer['STDs:genital herpes'].fillna(Cancer['STDs:genital herpes'].median())\nCancer['STDs:molluscum contagiosum'] = Cancer['STDs:molluscum contagiosum'].fillna(Cancer['STDs:molluscum contagiosum'].median())\nCancer['STDs:AIDS'] = Cancer['STDs:AIDS'].fillna(Cancer['STDs:AIDS'].median())\nCancer['STDs:HIV'] = Cancer['STDs:HIV'].fillna(Cancer['STDs:HIV'].median())\nCancer['STDs:Hepatitis B'] = Cancer['STDs:Hepatitis B'].fillna(Cancer['STDs:Hepatitis B'].median())\nCancer['STDs:HPV'] = Cancer['STDs:HPV'].fillna(Cancer['STDs:HPV'].median())","ec0f468a":"Cancer.isnull().sum()","cad63682":"Cancer.describe()","7984883a":"correlationMap = Cancer.corr()\n\nplt.figure(figsize=(40,40))\n\nsns.set(font_scale=3)\nhm = sns.heatmap(correlationMap,cmap = 'Set1', cbar=True, annot=True,vmin=0,vmax =1,center=True, square=True, fmt='.2f', annot_kws={'size': 25},\n             yticklabels = Cancer.columns, xticklabels = Cancer.columns)\nplt.show()","be7dbc92":"correlationMap = Cancer.corr()\nk = 16\ncorrelations = correlationMap.nlargest(k, 'Biopsy')['Biopsy'].index\n\n\n\nM = Cancer[correlations].corr()\n\nplt.figure(figsize=(10,10))\n\nsns.set(font_scale=1)\nH = sns.heatmap(M, cbar=True, cmap='rainbow' ,annot=True,vmin=0,vmax =1, square=True, fmt='.2f', annot_kws={'size': 12},\n                 yticklabels = correlations.values, xticklabels = correlations.values)\nplt.show()","8f7a5834":"new_col= Cancer.groupby('Biopsy').mean()\nprint(new_col.head().T)\n\ncols = ['Age', 'Number of sexual partners',\n        'First sexual intercourse', 'Smokes (packs\/year)',\n         'Hormonal Contraceptives (years)','IUD (years)', 'Smokes (years)']\n\nsns.pairplot(Cancer,\n             x_vars = cols,\n             y_vars = cols,\n             hue = 'Biopsy',)","3774354f":"Cancer['YRSS'] = Cancer['Age'] - Cancer['First sexual intercourse']\nCancer['NSPP'] = Cancer['Number of sexual partners'] \/ Cancer['YRSS']\nCancer['HPA'] = Cancer['Hormonal Contraceptives (years)'] \/ Cancer['Age']\nCancer['TPS'] = Cancer['Smokes (packs\/year)'] * Cancer['Smokes (years)']\nCancer['NPA'] = Cancer['Num of pregnancies'] \/ Cancer['Age']\nCancer['NSA'] = Cancer['Number of sexual partners'] \/ Cancer['Age']\nCancer['NYHC'] = Cancer['Age'] - Cancer['Hormonal Contraceptives (years)']\nCancer['APP'] = Cancer['Num of pregnancies'] \/ Cancer['Number of sexual partners']\nCancer['NHCP'] = Cancer['Hormonal Contraceptives (years)'] \/ Cancer['YRSS']","54ae105d":"X = Cancer.drop('Biopsy', axis =1)\nY = Cancer[\"Biopsy\"]","d275cc9c":"x = X.replace([np.inf], 0)","3fa36732":"x.isnull().sum()","75e24963":"x['NHCP'] = x['NHCP'].fillna(x['NHCP'].mean())","6634983e":"x.isnull().sum()","447b9b99":"%timeit","409edfd8":"model = RandomForestRegressor(max_features = 7, n_estimators = 100, n_jobs = -1, oob_score = True, random_state = 42)","3c94084f":"model.fit(x,Y)","7af3531b":"model.oob_score_\n","576879a5":"Y_oob = model.oob_prediction_","f945d2f3":"print(\"C-Stat: \", roc_auc_score(Y, Y_oob))","742d83d4":"Y_oob","86b4d401":"categorical_variables = [\"Smokes\", \"Hormonal Contraceptives\", \"IUD\", \"STDs\", \"STDs:condylomatosis\",                    \n\"STDs:cervical condylomatosis\", \"STDs:vaginal condylomatosis\", \"STDs:vulvo-perineal condylomatosis\", \"STDs:syphilis\", \n\"STDs:pelvic inflammatory disease\", \"STDs:genital herpes\", \"STDs:molluscum contagiosum\", \"STDs:AIDS\", \"STDs:HIV\",                              \n \"STDs:Hepatitis B\", \"STDs:HPV\", \"Dx:Cancer\", \"Dx:CIN\", \"Dx:HPV\", \"Dx\"]\nfor variable in categorical_variables :\n    dummies= pd.get_dummies(x[variable], prefix=variable)\n    x=pd.concat([x, dummies], axis=1)\n    x.drop([variable], axis=1, inplace=True)\n    ","38d4532b":"model = RandomForestRegressor(max_features = 8, n_estimators = 100, n_jobs = -1, oob_score = True, random_state = 42)\nmodel.fit(x,Y)","43ade8c6":"print(\"C-stat : \", roc_auc_score(Y, model.oob_prediction_))","f2a329ce":"feature_importances= pd.Series(model.feature_importances_, index=x.columns)\nfeature_importances.plot(kind=\"bar\", figsize=(20,20));","0315c033":"results=[]\nn_estimator_values=[10,20,30,40,50,60,70,80,90,100,110,120,130,140,150,200]\nfor trees in n_estimator_values:\n    model=RandomForestRegressor(trees, oob_score=True, n_jobs=-1,random_state=42)\n    model.fit(x, Y)\n    print(trees, \"trees\")\n    roc_score=roc_auc_score(Y, model.oob_prediction_)\n    print(\"C-stat : \", roc_score)\n    results.append(roc_score)\n    print(\" \")\npd.Series(results, n_estimator_values).plot();","68934677":"results=[]\nmax_features_values=[\"auto\", \"sqrt\", \"log2\", None, 0.2, 0.9]\nfor max_features in max_features_values:\n    model=RandomForestRegressor(n_estimators=140, oob_score=True, n_jobs=-1,random_state=42, \n                                max_features=max_features)\n    model.fit(x, Y)\n    print(max_features, \"option\")\n    roc_score=roc_auc_score(Y, model.oob_prediction_)\n    print(\"C-stat : \", roc_score)\n    results.append(roc_score)\n    print(\" \")\npd.Series(results, max_features_values).plot(kind=\"barh\", xlim=(0.10, 0.8));","a4f78fc6":"results=[]\nmin_sample_leaf_values=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,100,140,200]\nfor min_sample in min_sample_leaf_values:\n    model=RandomForestRegressor(n_estimators=140, oob_score=True, n_jobs=-1,random_state=42, \n                                max_features=\"log2\", min_samples_leaf=min_sample)\n    model.fit(x, Y)\n    print(min_sample, \"min sample\")\n    roc_score=roc_auc_score(Y, model.oob_prediction_)\n    print(\"C-stat : \", roc_score)\n    results.append(roc_score)\n    print(\" \")\npd.Series(results, min_sample_leaf_values).plot();","e1c45b9d":"model=RandomForestRegressor(n_estimators=140, oob_score=True, n_jobs=-1,random_state=42,\n                            max_features=\"log2\", min_samples_leaf=1)\nmodel.fit(x, Y)\nroc_score=roc_auc_score(Y, model.oob_prediction_)\nprint(\"C-stat : \", roc_score)","6151e205":"# Final Optimised Model","ed1cb928":"# Find Column Totals of Missing Values","e6f610b4":"# Fill Missing Values with 'NaN'","7255500b":"# Random Forest Regressor\n","27d3fe56":"# Finding Optimal Min_Samples_Leaf For RF","dee7cd8b":"# Finding Optimal Number Of Trees For RF","89b59ad6":"^ 140 trees gives us the highest c-stat, i.e. 0.6798.","837647bd":"Random forest is an ensemble algorithm that takes observations and variables and then creates decision trees. It is useful as it builds multiple decision trees then takes an average for an enhanced accuracey as compared to decision trees.","52eb3fa9":"# Now we are ready to run RF algorithm.","54efe1d9":"# Plot And Sort Features Importance","f1f88ba9":"# Finding Optimal Max_Features For RF","2cc7acb1":"^ It is difficult to see which attributes are correlated, hence it would be more practical to plot heatmaps for one attribute at a time. Also the above correlations can be deduced intuitively. such as; STDs(number) correlated with STDs and IUD correlated with IUD(years) and so on. It may seem obvious, but a noteworthy correaltion to mention is; Age and number of pregnancies at 0.58 correlation.","4e2731b9":"# Check Data Type","bdba1a37":"^ Re-define Cancerna as Cancer.","9d2e62a5":"^ We have achieved the desired 0.70 mark, this means our model has just passed the threshold of a good model fit.","2a4d793c":"max_features: This is the maximum number of variables RF is allowed to test in each node. An increase in variables to be tested at each node generally improves performance, the downside is diversity of each node is reduced which is the unique selling point of RF. For our classification problem, I will use sqaure root of count of variables, which in our case is 6.24 but rounded to 7.\n\nn_estimators: This is the number of trees that are built before average is taken, ideal to have high number of trees, downside is code runs slower.\n\nn_jobs: This code tells engine how many processors to use, \"1\" for one processor and \"-1\" for unrestricted.\n\nrandom_state: Thise code allows solution to be easily replicated.\n\noob_score: This is a RF cross-validation method.\n\nWe have out of bag score, the trailing underscore after \"score\" means R^2 is available after model has been trained. We have a R^2 = 0.00317, this is very low.","db270be0":"min_samples_leaf: This is the minimum number of samples required to be at each node. The optimal for our model is; 1.","e853f818":"We will calculate a C-stat. The C-statistic also called concordance statistic gives a measure of goodness of fit for binary outcomes in a logistic regression model. It will give us the probability a randomly selected patient who has experienced cervical cancer risks has a higher risk score than a patient who has not experienced the risks. It is equal to the area under the Receiver Operating Characteristic (ROC) curve.","5b9929dd":"We check to see that all columns are full for RF algorithm to run.","699d8011":"# Count Of Biopsy Positive\/Negative.","4908f837":"^ We have a C-stat of 0.6645, This will be our benchmark and I will try to improve this C-stat value, also C-stat ranges from 0.5 to 1, usually values from and above 0.70 are considered good model fit.\n\nY_oob = Y out of bag, this gives the prediction for every single observation. We can see that a lot of observations have 0 predictions and the remaining have low predictions.","861beb2c":"# Import Data Set Using Pandas.","2153d546":"# ^ Multiple Pairwise Bivariate Distributions","34dd384a":"# Improving Model","2f3c9cf3":"Due to the division of columns above, there will be instances of division by zero; giving 'infinity', hence the need to replace 'infinity' with 0.","05192327":"^ We Can See that 2 features above have to be omitted as they are missing significant portions.","c1e8717e":"# Check How Many Columns Are Empty","06d2cdf4":"# Fill Columns with Mean\/Median.","ee30d065":"^ We can see that Hormonal Contraceptives and Age, IUD and Age have an effect on Biopsy","61747704":"^ There are 24 columns with missing values and hence they have to be filled in som way.","e1b9f6c0":"Observing graph of 'First sexual intercourse' by 'Age', it is visible that < 20 years for 'first sexual intercourse' and < 40 for 'Age' has an increased occurence of positive reading in Biopsy. Also 'First sexual intercourse' by 'Number of sexual partners' has positive readings concentrated around < 20 years for 'First sexual intercourse' and < 10 for 'Number of sexual partners'.","bd5c1546":"^ Column 'NHCP' is missing 16 values, we fill with its mean.","4a14c577":"^ after introducing dummy variables for all the categorical variables, we get a slight improvement of the model. This is a 3.4% improvement which is not enough to reach our mark of 0.7.","8cd74848":"^ max_features, as a recap is; the maximum number of variables RF is allowed to test in each node. The optimal for our model is log2.","a219570f":"^ We have defined X and Y.","57dd9dbb":"^ The Most important features are by a large margin, the columns created from existing attributes, namely; (1) YRSS = Years passed since patient had first sexual intercourse (2) NSA = Number of sexual partners\/age. (3) NHCP = number of years patient took Hormonal Contraceptives after first sexual intercourse as a percentage\n(4) NYHC = number of years patient did not take Hormonal Contraceptives\n\nThese Features are somewhat correlated with a positive reading on a Biopsy screening method, it is a very weak correlation.","24ee9fe8":"# Comparison Of Biopsy Result For Attributes","b8e6999a":"^ Above, I have decided to create new columns that might better explain a positive reading of cervical cancer.","7ab8f6b3":"I will introduce dummy variables for all categorical variables in my data set. This is done to capture directionality of the categorical variables, also dummy variables allow us to use one regression equation to represent many groups. K-1, where k is the number of levels for a variable determines how many dummy variables to use.","72a8e402":"# Convert Objects into Numeric For Data Preprocessing","bf6e3c25":"# Creation of New columns From Existing Attributes for RF.","fd9d01dd":"# Deletion of 5 Attributes.","e497854c":"# Heatmap for Attribute Correlation.","8b280b2f":"# Check All columns have been filled\/Summary statistics.","5afe0d3f":"^ There are 5 columns that have to be deleted, 3 target variables and 2 features. 1) STDs: Time since first diagnosis 2) STDs: Time since last diagnosis 3) Hinselmann 4) Schiller 5) Citology\n\nAlso object data type has to be converted to numeric or integer for preprocessing.","3b815b35":"YRSS:Years passed since patient had first sexual intercourse NSPP:Number of sexual partners since first time as a percentage. HPA: Hormonal Contraceptives\/age TPS:Total packets of cigarettes smoked NPA:Number of pregnancies\/age NSA:Number of sexual partners\/age NYHC:number of years patient did not take Hormonal Contraceptives APP:number of pregnancy\/number of sexual partner NHCP:number of years patient took Hormonal Contraceptives after first sexual intercourse as a percentage","5253df4f":"^ Above we have a 31 by 3 matrix. First Row of 'Biopsy' is divided into its two categories, that is 0 and 1, 0 = negative and 1 = positive for onset of cervical cancer. The following rows are all the remaining 30 features. The average is calculated for each feature, this average is for all values corresponding to 0 and 1 for biopsy-method. We can see that there are 8 features completely free from a positive reading of cervcal cancer.\n\n1) STDs:cervical condylomatosis 2) STDs:vaginal condylomatosis 3) STDs:syphilis 4) STDs:pelvic inflammatory disease 5) STDs:molluscum contagiosum 6) STDs:HPV 7) STDs:AIDS\n8) STDs:Hepatitis B\n\nHuman papilloma virus (HPV) is given to be the prime causer of cervical cancer [5]. In our investiagtion above, it seems not to be detected at all by biopsy screening method, suggesting it has no effect on cervical cancer or that screening method is very inaccurate.\n\nFor positive readings of cervical cancer by Biopsy method, there is an increase for its column-average in each feature. Except for the following features, there is a decrease.\n\n1) number of sexual partners 2) Hormonal contraceptives 3) STDs:pelvic inflammatory disease","c027cc1b":"^ Fill continuous Variables with column mean and discrete\/boolean variables with column median. There are 24 columns remaining in my final data set that have missing values. there are 6 columns that are continuous, such as; measurement in years. The remaining are all filled with the column-median."}}