{"cell_type":{"fc871824":"code","5167874c":"code","3851f6bf":"code","0c0392fd":"code","642a87c5":"code","b958d647":"code","e9ff2eea":"code","13f3e140":"code","fa35d4d6":"code","f0f45252":"markdown","cf399239":"markdown","db907ed8":"markdown","8ad0052e":"markdown","42dbba62":"markdown","47517469":"markdown","8991625e":"markdown","d691578d":"markdown","f00cc2fe":"markdown","9ffd74c4":"markdown","10cdb02d":"markdown"},"source":{"fc871824":"import pandas as pd\nimport schedule\nimport time\nimport xlsxwriter \nimport openpyxl\nimport datetime\nfrom openpyxl import Workbook\nfrom openpyxl import load_workbook","5167874c":"data_df = pd.read_json('https:\/\/finans.truncgil.com\/today.json')","3851f6bf":"data_df = data_df.reindex([\"T\u00fcr\", \"Al\u0131\u015f\", \"Sat\u0131\u015f\"])","0c0392fd":"data_df","642a87c5":"data_df.to_excel('sch.xlsx', header=True)","b958d647":"def job():\n    book = load_workbook('sch.xlsx')\n    writer = pd.ExcelWriter('sch.xlsx', engine='openpyxl')\n    writer.book = book\n    writer.sheets = {ws.title: ws for ws in book.worksheets}\n    data_df1 = pd.read_json('https:\/\/finans.truncgil.com\/today.json')\n    data_df1 = data_df1.drop('T\u00fcr', axis=0)\n    for sheetname in writer.sheets:\n        data_df1.to_excel(writer, sheet_name=sheetname, startrow=writer.sheets[sheetname].max_row, header= False)\n    print('Last Run:', datetime.datetime.now())    \n    writer.save() \n","e9ff2eea":"schedule.every(15).minutes.do(job)","13f3e140":"while True:\n    schedule.run_pending()\n    time.sleep(1)","fa35d4d6":"lastdf = pd.read_excel('sch.xlsx')\nlastdf","f0f45252":"Sort the rows with index name. we need the row named \"T\u00fcr\" once. ","cf399239":"We have read the data, defined it as a dataframe and now it's time to export it as Excel.","db907ed8":"### __Getting Json Data to Excel and Refresh Data on a Schedule__","8ad0052e":"#### Import Libraries","42dbba62":"In this Json file, exchange and gold rates are given in Turkish Lira. This file is updated every 15 minutes.\n<br>Convert the Json page to dataframe with pandas module 'read_json' and dataframe is ready. \n<br>There are 3 rows and many columns.\n<br>First row is 'Al\u0131\u015f' is mean 'Buying'\n<br>Second row is 'Sat\u0131\u015f' is mean 'Sales'\n<br>Last row is 'T\u00fcr' is mean 'Kind' (D\u00f6viz(Exchange), Alt\u0131n(Gold))\n<br>First column is 'G\u00fcncelleme Tarihi' is mean 'Time of update' \n<br>Other columns are names of exchange and gold types. ","47517469":"#### Data","8991625e":"I added the data that i had previously run on the server for 8 days and uploaded it to the input folder as \"sch_server.xlsx\". ","d691578d":"* __pandas:__ library for data manipulation and analysis\n* __schedule:__ an in process scheduler for periodic jobs that uses the builder pattern for configuration. \n<br>You have to install it on console (pip install schedule)\n* __time:__ handle time-related tasks\n* __xlsxwriter:__ for writing files in the Excel\n* __openpyxl:__ to read\/write Excel xlsx\/xlsm\/xltx\/xltm files\n* __datetime:__ encapsulation of date\/time values\n* __Workbook:__ there is no need to create a file on the filesystem to get started with openpyxl if you import workbook\n* __load_workbook:__ loading from a file","f00cc2fe":"and we scheduled to do this job every 15 minutes.","9ffd74c4":"Let's look at the last version of our data after the job stops. ","10cdb02d":"We want to update the data every 15 minutes after exporting the first data. \n<br>In order to repeat this process, we first define the job.\n<br>In job;\n<br> we load the workbook in which we export the first data.\n<br> we read the json data again and we define it again without last row.\n<br>then we export it without header on the last line of the Excel we loaded. \n<br> use datetime and print it to see when the job is running."}}