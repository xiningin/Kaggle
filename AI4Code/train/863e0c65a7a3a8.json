{"cell_type":{"aaa0e33c":"code","e7a765b8":"code","651f9eee":"code","d55453a0":"code","7059985d":"code","4d7708a5":"code","b8cd1500":"code","b078c313":"code","b4120fb6":"code","bca468fd":"code","98170e75":"code","10f53b21":"code","bcaaa4eb":"code","8cb370dd":"code","da876ac2":"code","e3ed0444":"code","50008b5c":"code","968711c7":"code","68e70e2e":"code","7b7bb5f7":"markdown","bcea7006":"markdown","07315a29":"markdown","a3850d21":"markdown","fa712a89":"markdown","f833e942":"markdown","aaa8c05d":"markdown","177e5716":"markdown","5e3727e7":"markdown","94ee22e2":"markdown","28c8630f":"markdown","805c8844":"markdown"},"source":{"aaa0e33c":"import pandas as pd","e7a765b8":"# Load train dataset\ntrain_data = pd.read_csv(\"https:\/\/raw.githubusercontent.com\/dphi-official\/Datasets\/master\/travel_insurance\/Training_set_label.csv\")","651f9eee":"# Load test dataset\ntest_data = pd.read_csv('https:\/\/raw.githubusercontent.com\/dphi-official\/Datasets\/master\/travel_insurance\/Testing_set_label.csv')","d55453a0":"# Train data looks like:\ntrain_data.head()","7059985d":"# Test data looks like:\ntest_data.head()","4d7708a5":"# Drop the column 'Destination' from both train and test set, and drop the target variable 'Claim' from the train dataset\ntrain_data.drop(['Destination', 'Claim'], axis=1, inplace=True)\ntest_data.drop('Destination', axis=1, inplace=True)","b8cd1500":"# Select the categorical columns\ncat_train = train_data.select_dtypes('object')\ncat_test = test_data.select_dtypes('object')","b078c313":"cat_train.nunique()","b4120fb6":"cat_test.nunique()","bca468fd":"train = pd.get_dummies(cat_train)\ntest = pd.get_dummies(cat_test)","98170e75":"# checking the number of features in train and test set\nprint(\"There are {} features in train set\".format(len(train.columns)))\nprint(\"There are {} features in test set\".format(len(test.columns)))","10f53b21":"# Getting the missing feature\nmissing_feature = list(set(train.columns) - set(test.columns))[0]\nprint(missing_feature)","bcaaa4eb":"# Adding the missing feature to the test data\ntest[missing_feature] = 0","8cb370dd":"# Check the number of feature in test set\nlen(test.columns)","da876ac2":"from sklearn.preprocessing import OneHotEncoder","e3ed0444":"cat_train.dropna(inplace=True)\ncat_test.dropna(inplace=True)","50008b5c":"ohe = OneHotEncoder(handle_unknown = 'ignore')\nencoded_train = ohe.fit_transform(cat_train).toarray()\ntrain = pd.DataFrame(encoded_train, columns=ohe.get_feature_names(cat_train.columns))","968711c7":"encoded_test = ohe.transform(cat_test).toarray()\ntest = pd.DataFrame(encoded_test, columns=ohe.get_feature_names(cat_test.columns))","68e70e2e":"# checking the number of features in train and test set\nprint(\"There are {} features in train set\".format(len(train.columns)))\nprint(\"There are {} features in test set\".format(len(test.columns)))","7b7bb5f7":"# Introduction\n\nOften we encounter some categories in train dataset which are not present in the test dataset or vice-versa which becomes problematic when doing one hot encoding. After one-hot encoding we face the issue that there are more features in train set than the test set or the vice-versa. And, we all know that if a model is trained on x number of features, to make prediction out of it we need to pass test set with x number of features.\n\nIn this tutorial, we will discuss two different ways of dealing with it.\n\n### About the Data\nThe dataset we will use here is related to travel insurance. The objective for this dataset is to find out if the insurance buyer will claim the insurance in near future or not.\n\nThere are 11 variables in the dataset including the target variable.\n\n#### Data Description\n*  Duration: Travel duration\n*  Destination: Travel destination\n*  Agency: Agency Name\n*  Commission: Commission on the insurance\n*  Age: Age of the insurance buyer\n*  Gender: Gender of the insurance buyer\n*  Agency Type: What is the agency type?\n*  Distribution Channel: offline\/online\n*  Product Name: Name of the insurance plan\n*  Net Sales: Net sales\n*  Claim: If the insurance is claimed or not (the target variable), 0 = not claimed, 1 = claimed\n\nThis dataset is available at the official GitHub page of DPhi: https:\/\/github.com\/dphi-official\/Datasets\/tree\/master\/travel_insurance\n\nTo load the train dataset run the below command in your notebook:\n```\nimport pandas as pd\ntrain_data = pd.read_csv(\"https:\/\/raw.githubusercontent.com\/dphi-official\/Datasets\/master\/travel_insurance\/Training_set_label.csv\")\n```\n\nTo load the test_dataset run the below command in your notebook:\n```\ntest_data = pd.read_csv('https:\/\/raw.githubusercontent.com\/dphi-official\/Datasets\/master\/travel_insurance\/Testing_set_label.csv')\n```\n\n\n\n\n\n","bcea7006":"Now, there are 48 features in train set and 47 features in test set. If you train a model using the train set, the model will ask you for 48 features while testing also. So in this case, we can find out the one feature in train that is not present in test and add that column in the test set with all values as 0.","07315a29":"Now, both train and test set have equal number of features.\n\n# Conclusion\nIn the second method we don't need to add or remove any features manually but in case of the first method, we either need to remove or add the unknown categories in train or test set.","a3850d21":"We can observe above that there are 26 categories in 'Product Name' column of train data while only 25 categories in 'Product Name' column of test data","fa712a89":"### The problem with this approach\n1. If there are more missing features from test, it might become little difficult to add all those many columns to test set.\n2. What if there are some categories (or say features after one-hot encoding) which are present in test but not in train? In this case you need to manually add or remove all those categories that are present in test but not in train to the train data as we did above.","f833e942":"# Method 1: One hot Encoding using pd.get_dummies()","aaa8c05d":"# Method 2: Using OneHotEncoder() from sklearn.preprocessing","177e5716":"The OneHotEncoder() class from sklearn has an attribute named 'handle_unknown'. By default this attribute's value is 'error' which throws an error whenever it sees the unknown category. In order to handle the unknown category, we can pass this attribute's value as 'ignore'\n\nFrom [sklearn documentation](https:\/\/scikit-learn.org\/stable\/modules\/generated\/sklearn.preprocessing.OneHotEncoder.html):\n\n**handle_unknown{\u2018error\u2019, \u2018ignore\u2019}, default=\u2019error\u2019**\n\nWhether to raise an error or ignore if an unknown categorical feature is present during transform (default is to raise). When this parameter is set to \u2018ignore\u2019 and an unknown category is encountered during transform, the resulting one-hot encoded columns for this feature will be all zeros. In the inverse transform, an unknown category will be denoted as None.","5e3727e7":"Before using OneHotEncoder, make sure the data doesn't contain any null values otherwise it will throw an error","94ee22e2":"Now do one hot encoding on test data. But on test data we will use only 'transform' method instead of fit_transform.","28c8630f":"Now, there are 48 features in test set also.","805c8844":"### Checking the number of unique values in all the categorical columns in both train and test set"}}