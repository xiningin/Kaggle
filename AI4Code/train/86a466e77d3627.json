{"cell_type":{"ea6c7eec":"code","4bb97f7a":"code","96e8a852":"code","74c1406f":"code","77495625":"code","371730bb":"code","fb4dcca4":"code","e0ad1c8d":"code","e86b943e":"code","f9e6f5c5":"code","37639bfc":"code","8877a275":"code","30563d37":"code","4ed5f71f":"markdown","ea50db77":"markdown","6f3db5f0":"markdown","bb7bcf66":"markdown","3b125bdb":"markdown","0f78ef85":"markdown"},"source":{"ea6c7eec":"import pandas as pd\nimport numpy as np\nimport pylab as plt\nfrom sklearn.cluster import KMeans","4bb97f7a":"def RGB(img, length):\n    img = plt.imread(img)\n    length = length\n    list1 = []\n    a = 0\n    b = 0\n    a1 = img.shape[0] \/\/ length\n    b1 = img.shape[1] \/\/ length\n            \n    for i in range(length):\n        for j in range(length):\n            for k in range(3):\n                if i != length - 1:\n                    if j != length - 1:\n                        img1 = img[a:a+a1,b:b+b1,k]\n                        c = np.sum(img1.reshape(img1.shape[0]*img1.shape[1],)) \/ (img1.shape[0]*img1.shape[1])\n                        \n                    else:\n                        img1 = img[a:a+a1,b:,k]\n                        c = np.sum(img1.reshape(img1.shape[0]*img1.shape[1],)) \/ (img1.shape[0]*img1.shape[1])\n                        \n                else:\n                    if j != length - 1:\n                        img1 = img[a:,b:b+b1,k]\n                        c = np.sum(img1.reshape(img1.shape[0]*img1.shape[1],)) \/ (img1.shape[0]*img1.shape[1])\n                        \n                    else:\n                        img1 = img[a:,b:,k]\n                        c = np.sum(img1.reshape(img1.shape[0]*img1.shape[1],)) \/ (img1.shape[0]*img1.shape[1])\n                        \n                list1.append(int(c))\n            b += b1\n        b = 0\n        a += a1\n        \n    return list1","96e8a852":"df = pd.read_csv('..\/input\/shopee-product-matching\/train.csv')\ndf['image_path'] = '0'\nfor i in range(df.shape[0]):\n    df.iloc[i,5] = '..\/input\/shopee-product-matching\/train_images\/' + df.iloc[i,1]","74c1406f":"df[df['label_group'] == df.loc[47,'label_group']]","77495625":"img = plt.imread(df.loc[47,'image_path'])\nplt.imshow(img)","371730bb":"img_size = 5\nimg = np.array(RGB(df.loc[47,'image_path'], img_size)).reshape(img_size,img_size,3)\nplt.imshow(img)","fb4dcca4":"img = plt.imread(df.loc[15067,'image_path'])\nplt.imshow(img)","e0ad1c8d":"img_size = 5\nimg = np.array(RGB(df.loc[15067,'image_path'], img_size)).reshape(img_size,img_size,3)\nplt.imshow(img)","e86b943e":"train = pd.read_csv('..\/input\/df-5-5\/df5.csv')\ntrain = train \/ 255\n\nX = np.array(train)\nkmeans = KMeans(n_clusters=20000, random_state=0).fit(X)","f9e6f5c5":"\ndf['kmeans'] = kmeans.labels_\ndf['f1'] = 0\ndf['TP-1'] = 0\ndf['FP'] = 0\nfor i in range(df.shape[0]):\n#for i in range(3):\n    a = df[df['label_group'] == df.loc[i,'label_group']] \n    b = df[df['kmeans'] == df.loc[i,'kmeans']]\n    df.loc[i, 'f1'] = 2 * len(set(a.index) & set(b.index)) \/ (a.shape[0] + b.shape[0])\n    df.loc[i, 'TP-1'] = len(set(a.index) & set(b.index)) - 1\n    df.loc[i, 'FP'] = len(set(b.index) - (set(a.index) & set(b.index)) )\nprint(df['f1'].mean())\nprint()\nprint(df['TP-1'].sum())\nprint(df['FP'].sum())\nprint()\nprint(df['TP-1'].mean())\nprint(df['FP'].mean())","37639bfc":"df[df['FP'] > 7]","8877a275":"for i in range(75):\n    df[f'{i}'] = train[f'{i}']\n\na = 21000\nfor i in range(20000):\n    if df[df['kmeans'] == i].shape[0] > 7:\n        list1 = df[df['kmeans'] == i].index.copy()\n        for j in list1:\n            df.loc[j, 'kmeans'] = a\n            a += 1\n\ndf1 = df[df['kmeans'] > 20999]\n\nlist1 = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9',\n       '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21',\n       '22', '23', '24', '25', '26', '27', '28', '29', '30', '31', '32', '33',\n       '34', '35', '36', '37', '38', '39', '40', '41', '42', '43', '44', '45',\n       '46', '47', '48', '49', '50', '51', '52', '53', '54', '55', '56', '57',\n       '58', '59', '60', '61', '62', '63', '64', '65', '66', '67', '68', '69',\n       '70', '71', '72', '73', '74']\n\nX = np.array(df1[list1])\nkmeans = KMeans(n_clusters=2250, random_state=0).fit(X)\n\ndf1['kmeans'] = kmeans.labels_\n\ndf1['kmeans'] = df1['kmeans'] + 21000\n\ndf = df[df['kmeans'] < 20999]\ndf = df.append(df1).reset_index(drop=True)\n","30563d37":"for i in range(df.shape[0]):\n#for i in range(3):\n    a = df[df['label_group'] == df.loc[i,'label_group']] \n    b = df[df['kmeans'] == df.loc[i,'kmeans']]\n    df.loc[i, 'f1'] = 2 * len(set(a.index) & set(b.index)) \/ (a.shape[0] + b.shape[0])\n    df.loc[i, 'TP-1'] = len(set(a.index) & set(b.index)) - 1\n    df.loc[i, 'FP'] = len(set(b.index) - (set(a.index) & set(b.index)) )\nprint(df['f1'].mean())\nprint()\nprint(df['TP-1'].sum())\nprint(df['FP'].sum())\nprint()\nprint(df['TP-1'].mean())\nprint(df['FP'].mean())","4ed5f71f":"# **k-means**","ea50db77":"# **Second k-means**","6f3db5f0":"# **F1-score**","bb7bcf66":"# **Displaying images**","3b125bdb":"# **F1-score**","0f78ef85":"# **Avg pooling function**"}}