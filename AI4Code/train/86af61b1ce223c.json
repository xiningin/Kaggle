{"cell_type":{"73a71e0c":"code","ab369b9c":"code","c3b67931":"code","948709c9":"code","4bc580b5":"code","bc0a7ba5":"code","cf69a24d":"code","18c72a2a":"code","bdeca0ff":"code","e62b4789":"code","afe2c8fd":"code","53ee485d":"code","1f7d1323":"code","fdd5a975":"code","4afc5c8f":"code","81fd480c":"code","17a3ced4":"code","2b10d07b":"code","8018b9f2":"code","cab74a70":"code","9f948237":"code","60de5932":"code","6938205f":"code","6b068e34":"code","e679b40c":"code","d8038a4b":"code","17550d60":"code","a70248ff":"code","e7faecc0":"code","43ae821a":"code","d553c7b6":"code","ca9783f4":"code","18b7bb52":"code","41ed50c9":"code","bab92c2c":"code","64b774d5":"code","448f7cff":"code","d2b6fd67":"code","ee505b87":"code","83a6733c":"code","b3681854":"code","3548b5f6":"code","f34538dd":"code","76d2d87f":"code","e3af8121":"code","b6277caf":"markdown","1909fe7f":"markdown","ad5ea7bc":"markdown","741105b5":"markdown","b45984a1":"markdown","5651aeac":"markdown","8819b588":"markdown","720be75e":"markdown","5f671f1f":"markdown","b27c8390":"markdown","765167de":"markdown","b5ce1a10":"markdown","8597c01f":"markdown","baa80377":"markdown","e2226310":"markdown","826b07c8":"markdown","8820d6be":"markdown"},"source":{"73a71e0c":"!pip install pycountry_convert","ab369b9c":"!pip install GoogleMaps","c3b67931":"import plotly\nimport plotly_express as px\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots\nimport numpy as np\nimport pandas as pd\nimport warnings\nwarnings.filterwarnings(\"ignore\")\nimport googlemaps\nimport re \nimport pycountry\nimport pycountry_convert as pc\nimport requests\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nplt.style.use('fivethirtyeight')","948709c9":"class country_utils():\n    def __init__(self):\n        self.d = {}\n    \n    def get_dic(self):\n        return self.d\n    \n    def get_country_details(self,country):\n        \"\"\"Returns country code(alpha_3) and continent\"\"\"\n        try:\n            country_obj = pycountry.countries.get(name=country)\n            if country_obj is None:\n                c = pycountry.countries.search_fuzzy(country)\n                country_obj = c[0]\n            continent_code = pc.country_alpha2_to_continent_code(country_obj.alpha_2)\n            continent = pc.convert_continent_code_to_continent_name(continent_code)\n            return country_obj.alpha_3, continent\n        except:\n            if 'Congo' in country:\n                country = 'Congo'\n            if country == 'Mainland China':\n                country = 'China'\n            elif country == 'Diamond Princess' or country == 'Laos' or country == 'MS Zaandam'\\\n            or country == 'Holy See' or country == 'Timor-Leste':\n                return country, country\n            elif country == 'Korea, South' or country == 'South Korea':\n                country = 'Korea, Republic of'\n            elif country == 'Taiwan*':\n                country = 'Taiwan'\n            elif country == 'Burma':\n                country = 'Myanmar'\n            elif country == 'West Bank and Gaza':\n                country = 'Gaza'\n            else:\n                return country, country\n            country_obj = pycountry.countries.search_fuzzy(country)\n            continent_code = pc.country_alpha2_to_continent_code(country_obj[0].alpha_2)\n            continent = pc.convert_continent_code_to_continent_name(continent_code)\n            return country_obj[0].alpha_3, continent\n    \n    def get_iso3(self, country):\n        return self.d[country]['code']\n    \n    def get_continent(self,country):\n        return self.d[country]['continent']\n    \n    def add_values(self,country):\n        self.d[country] = {}\n        self.d[country]['code'],self.d[country]['continent'] = self.get_country_details(country)\n    \n    def fetch_iso3(self,country):\n        if country in self.d.keys():\n            return self.get_iso3(country)\n        else:\n            self.add_values(country)\n            return self.get_iso3(country)\n        \n    def fetch_continent(self,country):\n        if country in self.d.keys():\n            return self.get_continent(country)\n        else:\n            self.add_values(country)\n            return self.get_continent(country)","4bc580b5":"df_world = pd.read_csv('\/kaggle\/input\/novel-corona-virus-2019-dataset\/covid_19_data.csv')\ndf_world.ObservationDate = pd.to_datetime(df_world.ObservationDate, format='%m\/%d\/%Y')\nmax_date = df_world.ObservationDate.max()\ndf_world = df_world[df_world.ObservationDate==max_date]\ndf_world.rename(columns={'Country\/Region':'Country'},inplace=True)\ndf_cont = df_world.copy()\ndf_world = df_world.groupby(['Country'],as_index=False)['Confirmed','Deaths','Recovered'].sum()\ndf_world['rank_c'] = df_world['Confirmed'].rank(ascending=False)\ndf_world['rank_d'] = df_world['Deaths'].rank(ascending=False)\ndf_world['rank_r'] = df_world['Recovered'].rank(ascending=False)\nworld_stat = (df_world.loc[df_world['Country']=='India'])\nworld_stat.set_index('Country',inplace=True)\nworld_stat = world_stat.astype(int)","bc0a7ba5":"obj = country_utils()\ndf_cont['continent'] = df_cont.apply(lambda x: obj.fetch_continent(x['Country']), axis=1)\ndf_cont = df_cont.groupby(['continent','Country'],as_index=False)['Confirmed','Deaths','Recovered'].sum()\ndf_cont = df_cont[df_cont['continent']=='Asia']\ndf_cont['rank_c'] = df_cont['Confirmed'].rank(ascending=False)\ndf_cont['rank_d'] = df_cont['Deaths'].rank(ascending=False)\ndf_cont['rank_r'] = df_cont['Recovered'].rank(ascending=False)\ncont_stat = (df_cont.loc[df_cont['Country']=='India'])\ncont_stat.set_index('Country',inplace=True)\ncont_stat.drop('continent',inplace=True,axis=1)\ncont_stat = cont_stat.astype(int)","cf69a24d":"def make_538(fig,title=None,xtext=None,ytext=None,hovermode='x',width=700,height=400,margin=dict(t=50,b=10,l=10,r=10),legend=None,annotations=None):\n    fig.update_layout(\n        template='simple_white',\n        title=title,\n        hovermode=hovermode,\n        xaxis=dict(title=xtext,showline=False,showgrid=True,ticks='',gridcolor=colors['grid']),\n        yaxis=dict(title=ytext,showline=False,showgrid=True,ticks='',gridcolor=colors['grid']),\n        paper_bgcolor=colors['bg'],\n        plot_bgcolor=colors['bg'],\n        width=width,\n        height=height,\n        margin=margin,\n        legend=legend,\n        annotations=annotations\n    )\n    return fig","18c72a2a":"colors = dict(bg='#f0f0f0',\n              grid='#d7d7d7',\n              cases='#30a2da',\n              deaths='#fc4f30',\n              recoveries='#6d904f',\n              shape='#8b8b8b')","bdeca0ff":"import plotly.graph_objects as go\n\nvalues = [['Figures','World Ranking','Asia Ranking'],\n          [world_stat.Confirmed['India'],world_stat.rank_c['India'],cont_stat.rank_c['India']],\n          [world_stat.Deaths['India'],world_stat.rank_d['India'],cont_stat.rank_d['India']],\n          [world_stat.Recovered['India'],world_stat.rank_r['India'],cont_stat.rank_r['India']]]\n\n\nfig = go.Figure(data=[go.Table(\n  columnorder = [1,2,3,4],\n  columnwidth = [300,400],\n  header = dict(\n    values = [['<b>STATISTICS<\/b><br>as of '+str(max_date.day)+' '+ max_date.month_name()],\n              ['<b>CASES<\/b>'],['<b>DEATHS<\/b>'],['<b>RECOVERIES<\/b>']],\n    line_color=colors['grid'],\n    fill_color=colors['cases'],\n    align=['left','center'],\n    font=dict(color='white', size=12),\n    height=40\n  ),\n  cells=dict(\n    values=values,\n    line_color=colors['grid'],\n    fill=dict(color=[colors['shape'], 'white']),\n    align=['left', 'center'],\n    font_size=12,\n    height=30)\n    )\n])\nfig = make_538(fig,height=250,title=dict(text='<b>Report from Ground Zero<\/b>',font=dict(family='Helvetica')))\nfig.show()","e62b4789":"df = pd.read_csv('\/kaggle\/input\/covid19-in-india\/covid_19_india.csv')\ndf['Date'] = pd.to_datetime(df['Date'],format='%d\/%m\/%y')\ndf['Date'] = df['Date'].dt.date\ndf.rename(columns={'Date':'date','State\/UnionTerritory':'state','ConfirmedIndianNational':'confirmed_in',\\\n                   'ConfirmedForeignNational':'confirmed_fr'}, inplace=True)\ndf.drop(['Sno','Time'],axis=1,inplace=True)\ndf['state'] = df.apply(lambda x: 'Nagaland' if x['state']=='Nagaland#' else 'Jharkhand' if x['state']=='Jharkhand#' else x['state'], axis=1)\ndf = df[df['state']!='Unassigned']\ndf.reset_index(inplace=True)","afe2c8fd":"from kaggle_secrets import UserSecretsClient\nuser_secrets = UserSecretsClient()\nsecret_value_0 = user_secrets.get_secret(\"gmaps\")\nsecret_value_1 = user_secrets.get_secret(\"mapboxtoken\")\ngmaps = googlemaps.Client(key=secret_value_0)","53ee485d":"def add_daily_measures(df):\n    has_state=False\n    if 'state' in df.columns:\n        states = []\n        has_state = True\n    df.loc[0,'Daily Cases'] = df.loc[0,'Confirmed']\n    df.loc[0,'Daily Deaths'] = df.loc[0,'Deaths']\n    df.loc[0,'Daily Cured'] = df.loc[0,'Cured']\n    for i in range(1,len(df)):\n        if has_state:\n            if df.loc[i,'state'] in states:\n                df.loc[i,'Daily Cases'] = df.loc[i,'Confirmed'] - df.loc[i-1,'Confirmed']\n                df.loc[i,'Daily Deaths'] = df.loc[i,'Deaths'] - df.loc[i-1,'Deaths'] \n                df.loc[i,'Daily Cured'] = df.loc[i,'Cured'] - df.loc[i-1,'Cured']\n            else:\n                states.append(df.loc[i,'state'])\n                df.loc[i,'Daily Cases'] = df.loc[i,'Confirmed']\n                df.loc[i,'Daily Deaths'] = df.loc[i,'Deaths']\n                df.loc[i,'Daily Cured'] = df.loc[i,'Cured']\n        else:\n            df.loc[i,'Daily Cases'] = df.loc[i,'Confirmed'] - df.loc[i-1,'Confirmed']\n            df.loc[i,'Daily Deaths'] = df.loc[i,'Deaths'] - df.loc[i-1,'Deaths'] \n            df.loc[i,'Daily Cured'] = df.loc[i,'Cured'] - df.loc[i-1,'Cured']\n    #Make the first row as 0 because we don't know the previous value\n    df.loc[0,'Daily Cases'] = 0\n    df.loc[0,'Daily Deaths'] = 0\n    df.loc[0,'Daily Cured'] = 0\n    return df","1f7d1323":"df.loc[1428,'state'] = 'Madhya Pradesh'\ndf.loc[1428,'Deaths'] = '119'\ndf.fillna(0,inplace=True)\ndf.loc[df.Deaths=='0#','Deaths'] = 0\ndf.Deaths = df.Deaths.astype(np.int16)","fdd5a975":"imp_dates = [dict(date='2020-03-23',event=\"Lockdown Phase 1<br><b>23<sup>rd<\/sup> March<\/b>\"),\n             dict(date='2020-04-15',event=\"Lockdown Phase 2<br><b>15<sup>th<\/sup> April<\/b>\"),\n             dict(date='2020-05-04',event=\"Lockdown Phase 3<br><b>4<sup>th<\/sup> May<\/b>\"),\n             dict(date='2020-05-18',event=\"Lockdown Phase 4<br><b>18<sup>th<\/sup> May<\/b>\"),\n             dict(date='2020-06-01',event=\"Unlock 1.0<br><b>1<sup>st<\/sup> June<\/b>\"),\n             dict(date='2020-07-01',event=\"Unlock 2.0<br><b>1<sup>st<\/sup> July<\/b>\"),\n             dict(date='2020-08-01',event=\"Unlock 3.0<br><b>1<sup>st<\/sup> August<\/b>\")]","4afc5c8f":"df_ind = df.copy()\ndf_ind = df_ind.groupby('date',as_index=False)['Cured','Deaths','Confirmed'].sum()\ndf_ind = add_daily_measures(df_ind)\nfig = go.Figure(data=[\n    go.Scatter(name='Cases', x=df_ind['date'], y=df_ind['Daily Cases'],mode='lines',\n               line=dict(color=colors['cases'],width=5)),\n    go.Scatter(name='Recoveries', x=df_ind['date'], y=df_ind['Daily Cured'],mode='lines',\n               line=dict(color=colors['recoveries'],width=5)),\n    go.Scatter(name='Deaths', x=df_ind['date'], y=df_ind['Daily Deaths'],mode='lines',\n               line=dict(color=colors['deaths'],width=5)),\n])\n\nannotations = []\n\nfor date in imp_dates:\n    fig.add_shape(type='line',xref='x',yref='y',layer='below',\n                  x0=date['date'] ,y0=0,x1=date['date'],y1=100000,\n                  line=dict(dash='dot',color=colors['shape'],width=3))\n    annotations.append(dict(x=date['date'], y=80000, xref=\"x\", yref=\"y\",textangle=-45, \n                            text=date['event'], font=dict(size=10), showarrow=False))\nannotations[-1]['y'] = 15000\nlegend=dict(orientation='h',x=0.5,y=1.1,bgcolor=colors['bg'])\nfig = make_538(fig,title='Daily Cases, Deaths & Recoveries',legend=legend,annotations=annotations)\nfig.show()","81fd480c":"%%HTML\n<div class=\"flourish-embed flourish-bar-chart-race\" data-src=\"visualisation\/2061549\" data-url=\"https:\/\/flo.uri.sh\/visualisation\/2061549\/embed\" aria-label=\"\"><script src=\"https:\/\/public.flourish.studio\/resources\/embed.js\"><\/script><\/div>","17a3ced4":"#Code to get the dataset for Bar chart race\ndf_br = df.copy()\ndf_br = df_br.pivot(index='state',columns='date',values='Confirmed')\ndf_br.fillna(0,inplace=True)\ndf_br.reset_index(level=0, inplace=True)\ndf_br.columns.name = ''\ndf_br.to_csv(r'confirmed_cases_india.csv',index=False)","2b10d07b":"def doubling_rate_india(x):\n    dr = np.log(2)\/np.log(x['Confirmed']\/x['Confirmed_prev'])\n    return np.round(dr,2)\n\ndf_ind['Confirmed_prev'] = df_ind['Confirmed'].shift(1)\ndf_ind['Doubling rate'] = df_ind.apply(lambda x: doubling_rate_india(x),axis=1)\nfig = go.Figure()\nfig.add_trace(go.Scatter(x=df_ind['date'],y=df_ind['Doubling rate'],mode='lines',\n                         line=dict(color=colors['cases'],width=5)))\nfig = make_538(fig,ytext='Days',title=\"India's Daily Doubling rate variation\")\nfig.show()","8018b9f2":"doubling_rate = 0\nstate = df.state.unique().tolist()[0]\ndef calc_doubling_rate(x):\n    global growth_rate\n    global state\n    if x['state']!=state:\n        doubling_rate=0\n        state = x['state']\n    try:\n        dr = np.log(2)\/np.log(x['Confirmed']\/x['Confirmed_prev'])\n    except ZeroDivisionError:\n        dr = 0\n    return np.round(dr,2)\n\ndf_dr = df.copy()\ndf_dr.sort_values(['state','date'],inplace=True)\ndf_dr.reset_index(drop=True,inplace=True)\ndf_dr['Confirmed_prev'] = df_dr.groupby('state')['Confirmed'].transform(lambda x: x.shift(1))\ndf_dr['Doubling rate'] = df_dr.apply(lambda x: calc_doubling_rate(x),axis=1)\ndf_curr_dr = df_dr[df_dr['date']==df_dr.date.max()]\ndf_curr_dr.sort_values('Confirmed',ascending=False,inplace=True)\ndf_curr_dr=df_curr_dr[['state','Confirmed','Doubling rate']]\ndf_curr_dr=df_curr_dr.nlargest(15,'Confirmed')\ndf_curr_dr.reset_index(drop=True,inplace=True)\n\n# Set CSS properties for th elements in dataframe\nth_props = [\n  ('font-size', '11px'),\n  ('text-align', 'center'),\n  ('font-weight', 'bold'),\n  ('color', '#6d6d6d'),\n  ('background-color', '#f7f7f9')\n  ]\n\n# Set CSS properties for td elements in dataframe\ntd_props = [\n  ('font-size', '11px')\n  ]\n\n# Set table styles\nstyles = [\n  dict(selector=\"th\", props=th_props),\n  dict(selector=\"td\", props=td_props)\n  ]\n\n(df_curr_dr.style\n .background_gradient(cmap='Reds_r',subset='Doubling rate')\n .background_gradient(cmap='Blues',subset='Confirmed')\n .set_caption('Doubling Rates of 15 Indian States with most cases')\n .set_table_styles(styles))","cab74a70":"df_dr = df_dr.merge(df_curr_dr['state'],how='inner',on='state')\nrows=5\ncols=3\nstates = df_curr_dr.state.tolist()\nfig = make_subplots(rows,cols,shared_xaxes=True,subplot_titles=states)\nfor r in range(rows):\n    for c in range(0,cols):\n        ind = r*cols + c\n        df_s = df_dr[df_dr['state']==states[ind]]\n        fig.add_trace(go.Scatter(x=df_s['date'],y=np.abs(df_s['Doubling rate'])),r+1,c+1)\n        fig.update_xaxes(showline=False,ticks='',showgrid=True,gridcolor=colors['grid'],row=r+1,col=c+1)\n        fig.update_yaxes(showline=False,ticks='',showgrid=True,gridcolor=colors['grid'],tickfont=dict(size=8),row=r+1,col=c+1)\nfig.update_layout(template='simple_white',showlegend=False,margin=dict(t=100),\n                 title='<b>State-wise Doubling Rate variation<\/b><br>Top 15 States in terms of Total Confirmed Cases',\n                 width=700,paper_bgcolor=colors['bg'],plot_bgcolor=colors['bg'])\nfig.show()","9f948237":"d = {}\nstates = df.state.unique().tolist()\nfor state in states:\n    if state!='Cases being reassigned to states':\n        data = gmaps.geocode(state)\n        if data:\n            d[state] = data[0]['geometry']['location']\n\ndef get_coords(state):\n    if state!='Cases being reassigned to states':\n        lat = d[state]['lat']\n        lng = d[state]['lng']\n    else:\n        return (np.float('nan'),np.float('nan'))\n    return (lat,lng)","60de5932":"df_map = df.copy()\ndf_map['latitude'] = df_map.apply(lambda x: get_coords(x['state'])[0],axis=1)\ndf_map['longitude'] = df_map.apply(lambda x: get_coords(x['state'])[1],axis=1)\npx.set_mapbox_access_token(secret_value_1)\ndf_map['date'] = df_map['date'].astype('str')\nfig = px.scatter_mapbox(df_map,\n                        lat=\"latitude\",\n                        lon=\"longitude\",\n                        size=\"Confirmed\",\n                        color='Confirmed',\n                        mapbox_style='streets',\n                        color_continuous_scale=px.colors.cyclical.IceFire,\n                        range_color=(0, df_map['Confirmed'].max()),\n                        animation_frame='date',\n                        hover_name='state',\n                        hover_data=['Deaths','Cured'],\n                        zoom=2.5,\n                        size_max=50,\n                        title= 'India:Spread of COVID19')\nfig.show()","6938205f":"def change_state_name(state):\n    if state == 'Odisha':\n        return 'Orissa'\n    elif state == 'Telengana':\n        return 'Telangana'\n    elif state == 'Andaman and Nicobar Islands':\n        return 'Andaman and Nicobar'\n    return state\nr = requests.get(url='https:\/\/raw.githubusercontent.com\/geohacker\/india\/master\/state\/india_telengana.geojson')\ngeojson = r.json()\ndf_map['state'] = df_map.apply(lambda x: change_state_name(x['state']), axis=1)\nlast_date = df_map.date.max()\ndf_map = df_map[df_map['date']==last_date]\nfig = px.choropleth_mapbox(df_map, geojson=geojson, color=\"Confirmed\",\n                    locations=\"state\", featureidkey=\"properties.NAME_1\",\n                    hover_name='state',\n                    hover_data=['Cured','Deaths'],\n                    center={\"lat\": 20.5937, \"lon\": 78.9629},\n                    mapbox_style=\"carto-positron\",\n                    zoom=2.75,\n                    color_continuous_scale=px.colors.qualitative.Vivid,\n                    title='Total Cases per State'\n                   )\nfig.update_geos(fitbounds=\"locations\", visible=True)\nfig.update_geos(projection_type=\"orthographic\")\nfig.show()","6b068e34":"df_ind_det = pd.read_csv('\/kaggle\/input\/covid19-in-india\/IndividualDetails.csv')\nr = requests.get(url='https:\/\/raw.githubusercontent.com\/geohacker\/india\/master\/district\/india_district.geojson')\ngeojson = r.json()\ndf_dist = df_ind_det.groupby('detected_district',as_index=False)['id'].count()\ndf_dist.rename(columns={'detected_district':'District','id':'Cases Reported'},inplace=True)\nfig = px.choropleth_mapbox(df_dist, geojson=geojson, color=\"Cases Reported\",\n                    locations=\"District\", featureidkey=\"properties.NAME_2\",\n                    hover_name='District',\n                    center={\"lat\": 20.5937, \"lon\": 78.9629},\n                    mapbox_style=\"carto-positron\",\n                    zoom=2.75,\n                    color_continuous_scale=px.colors.qualitative.Vivid,\n                    title='Total Cases per District'\n                   )\nfig.update_geos(fitbounds=\"locations\", visible=True)\nfig.update_geos(projection_type=\"orthographic\")\nfig = make_538(fig,title='Total Cases per District')\nfig.show()","e679b40c":"df_zone = pd.read_csv('\/kaggle\/input\/covid19indiazones\/India-District-Zones.csv')\ndf_zone = df_zone.groupby(['State','Zone'],as_index=False)['District'].count()\ndf_zone.sort_values('District',inplace=True)\nfig = go.Figure()\ndf_g = df_zone[df_zone['Zone']=='Green Zone']\nfig.add_trace(go.Bar(name='Green zone',x=df_g['State'],y=df_g['District'], marker_color='Green',\n                    marker_line_color='black',marker_line_width=1.5))\ndf_o = df_zone[df_zone['Zone']=='Orange Zone']\nfig.add_trace(go.Bar(name='Orange zone',x=df_o['State'],y=df_o['District'], marker_color='Orange',\n                    marker_line_color='black',marker_line_width=1.5))\ndf_r = df_zone[df_zone['Zone']=='Red Zone']\nfig.add_trace(go.Bar(name='Red zone',x=df_r['State'],y=df_r['District'], marker_color='Red',\n                    marker_line_color='black',marker_line_width=1.5))\nfig.update_layout(barmode='stack')\nfig = make_538(fig,title='<b>Number of Zones per State from 4th May<\/b><br>Specific to Lockdown 3.0',\n               margin=dict(l=0,r=0,t=50,b=170))\nfig.show()","d8038a4b":"df_lab = pd.read_csv('\/kaggle\/input\/icmrtestinglabs\/ICMRTestingLabsWithCoords.csv')\nfig = px.scatter_mapbox(df_lab,\n                        lat=\"latitude\",\n                        lon=\"longitude\",\n                        mapbox_style='streets',\n                        hover_name='lab',\n                        hover_data=['city','state','pincode'],\n                        zoom=2.5,\n                        size_max=15,\n                        title= 'COVID19 Testing Labs in India')\nfig.show()","17550d60":"def add_text(ax,fontsize=12):\n    for p in ax.patches:\n        x=p.get_bbox().get_points()[:,0]\n        y=p.get_bbox().get_points()[1,1]\n        ax.annotate('{}'.format(int(y)), (x.mean(), y), ha='center', va='bottom',size=fontsize)\n        \nplt.figure(figsize=(16,6))\nax = sns.countplot(data=df_lab,x='state',color='salmon',order = df_lab['state'].value_counts().index)\nadd_text(ax)\nax.set_xticklabels(ax.get_xticklabels(), rotation=40, ha=\"right\",size=10)\nax.set_xlabel('')\nax.set_ylabel('')\nax.set_title('Number of COVID19 testing labs per State\/Union Territory')\nplt.tight_layout()\nplt.show()","a70248ff":"df_tes_st = pd.read_csv('\/kaggle\/input\/covid19-in-india\/StatewiseTestingDetails.csv')\nfig = go.Figure()\nfor state in df_tes_st.State.unique():\n    df_s = df_tes_st[df_tes_st['State']==state]\n    fig.add_trace(go.Scatter(x=df_s['Date'],y=df_s['TotalSamples'],mode='lines',name=state))\n    #fig.add_trace(go.Bar(x=df_s['Date'],y=df_s['Positive']))\nfig = make_538(fig,height=500,title='State-wise number of tests')\nfig.show()","e7faecc0":"df_pop = pd.read_csv('\/kaggle\/input\/covid19-in-india\/population_india_census2011.csv')\ndf_bed = pd.read_csv('\/kaggle\/input\/covid19-in-india\/HospitalBedsIndia.csv')\ndf_test = pd.read_csv('\/kaggle\/input\/covid19-in-india\/StatewiseTestingDetails.csv',parse_dates=True)\ndf_bed['Total beds'] = df_bed.NumPublicBeds_HMIS + df_bed.NumRuralBeds_NHP18 + df_bed.NumUrbanBeds_NHP18","43ae821a":"def get_area(s):\n    if pd.isnull(s):\n        return s\n    temp = re.findall(r'\\d+.?\\d+', s)\n    temp = [x.replace(',','') for x in temp]\n    res = list(map(int, temp))\n    return res\n\ndef get_density(s):\n    if pd.isnull(s):\n        return s\n    temp = re.findall(r'\\d+[.\\.]?\\d+', s)\n    temp = [x.replace(',','') for x in temp]\n    res = list(map(float, temp))\n    return res","d553c7b6":"df_latest = df[df['date']==df.date.max()]\ndf_latest = df_latest.merge(df_pop,how='left',left_on='state',right_on='State \/ Union Territory')\ndf_latest = df_latest.merge(df_bed,how='left',left_on='state',right_on='State\/UT')\ndf_latest = df_latest[['state','Cured','Deaths','Confirmed','Population','Rural population','Area','Density','Gender Ratio','Total beds','TotalPublicHealthFacilities_HMIS']]\ndf_latest = df_latest[df_latest['state']!='Cases being reassigned to states']\ndf_latest.drop([7,30],inplace=True)\ndf_latest['Area(sq km)'] = df_latest.apply(lambda x:get_area(x['Area'])[0],axis=1)\ndf_latest['Area(sq miles)'] = df_latest.apply(lambda x:get_area(x['Area'])[1],axis=1)\ndf_latest['Density(sq km)'] = df_latest.apply(lambda x:get_density(x['Density'])[0],axis=1)\ndf_latest['Density(sq miles)'] = df_latest.apply(lambda x:get_density(x['Density'])[1],axis=1)\ndf_latest.drop(['Area','Density'],axis=1,inplace=True)\ndf_latest.rename(columns={'state':'State'},inplace=True)\ndf_latest['Cases\/million'] = round((df_latest.Confirmed\/df_latest.Population)*1000000).astype(int)\ndf_latest.fillna(0,inplace=True)\ndf_latest['Beds\/million'] = round((df_latest['Total beds']\/df_latest.Population)*1000000).astype(int)\ndf_latest['Health Facilities\/100sq.km'] = round((df_latest['TotalPublicHealthFacilities_HMIS']\/df_latest['Area(sq km)'])*1000).astype(int)\ndf_latest['Mortality Rate %'] = np.round((df_latest.Deaths\/df_latest.Confirmed)*100,2)\ndf_latest['Recovery Rate %'] = np.round((df_latest.Cured\/df_latest.Confirmed)*100,2)\ndf_latest.sort_values('Confirmed',ascending=False,inplace=True)\ndf_latest.reset_index(inplace=True,drop=True)\n\ndf_table = df_latest[['State','Cured','Deaths','Confirmed','Mortality Rate %','Recovery Rate %','Cases\/million','Beds\/million','Health Facilities\/100sq.km']]\n(df_table.style\n .background_gradient(cmap='Blues',subset=['Confirmed','Cases\/million','Beds\/million','Health Facilities\/100sq.km'])\n .background_gradient(cmap='Greens', subset=['Cured','Recovery Rate %'])\n .background_gradient(cmap='Reds', subset=['Deaths','Mortality Rate %'])\n .set_caption('COVID19: Statistics about India')\n .set_table_styles(styles))","ca9783f4":"rows = 1\ncols = 3\nfig = make_subplots(rows=rows,cols=cols,shared_yaxes=True,horizontal_spacing=0.03,\n                    subplot_titles=['Cases','Deaths','Recoveries'])\nd_cols = {1:'Confirmed',2:'Deaths',3:'Cured'}\ncolors = plotly.colors.DEFAULT_PLOTLY_COLORS\nfor c in range(1,4):\n    for i,state in enumerate(df_latest.State.unique().tolist()):\n        group = df_latest[df_latest['State']==state]\n        fig.append_trace(go.Scatter(\n            name = state,\n            x = group[d_cols[c]],\n            y = group['Density(sq km)'],\n            mode = 'markers',\n            marker = dict(\n                color = colors[i%len(colors)],\n                size = group['Population']\/(5*10**6)\n            ),\n            legendgroup = state,\n            showlegend = True if c==1 else False,\n            text= '<b>'+state.upper()+'<\/b><br>'+\n                  '<b>Population: <\/b>'+ group['Population'].astype(str) +'<br>'+\n                  '<b>'+d_cols[c]+': <\/b>'+ group[d_cols[c]].astype(str) +'<br>'+\n                  '<b>Pop. Density: <\/b>'+ group['Density(sq km)'].astype(str) +'<br>',\n            hoverinfo = 'text',\n        ),1,c)\n        fig.update_xaxes(tickfont=dict(size=8),row=1,col=c)\nfig.update_yaxes(title_text='Population Density(per sq km)',row=1,col=1)\nfig.update_layout(width=700,height=400,title=\"States' Population Density Analysis\",\n                 margin=dict(t=70,b=0,r=10,l=0), \n                 legend=dict(title='State\/Union Territory',font=dict(size=8))) \nfig.show()","18b7bb52":"df_states = df.copy()\ndef add_days(df,new_col,basis):\n    states = {}\n    df[new_col] = 0\n    for i in range(len(df_states)):\n        if df_states.loc[i,'state'] in states:\n            df_states.loc[i,new_col] = (df_states.loc[i,'date'] - states[df_states.loc[i,'state']]).days\n        else:\n            if df_states.loc[i,basis] > 0:\n                states[df_states.loc[i,'state']] = df_states.loc[i,'date']\n    return df\ndf_states = add_days(df_states,'day_since_inf','Confirmed')\ndf_states = add_days(df_states,'day_since_death','Deaths')\ndf_states = add_days(df_states,'day_since_cure','Cured')","41ed50c9":"rows = 1\ncols = 3\nfig = make_subplots(rows=rows,cols=cols,\n                    subplot_titles=['Cases','Deaths','Recoveries'])\nd_cols = {1:'Confirmed',2:'Deaths',3:'Cured'}\ncolors = plotly.colors.DEFAULT_PLOTLY_COLORS\nfor c in range(1,4):\n    for i,state in enumerate(df_states.state.unique().tolist()):\n        group = df_states[df_states['state']==state]\n        fig.append_trace(go.Scatter(\n            name = state,\n            y = group[d_cols[c]],\n            x = group['day_since_inf'],\n            mode = 'lines',\n            line = dict(\n                color = colors[i%len(colors)],\n            ),\n            legendgroup = state,\n            showlegend = True if c==1 else False,\n            text= '<b>'+state.upper()+'<\/b><br>'+\n                   '<b>Day: <\/b>'+ group['day_since_inf'].astype(str) +'<br>'+\n                   '<b>'+d_cols[c]+': <\/b>'+ group[d_cols[c]].astype(str) +'<br>',\n            hoverinfo = 'text',\n        ),1,c)\n        fig.update_xaxes(tickfont=dict(size=8),row=1,col=c)\n        fig.update_yaxes(tickfont=dict(size=8),row=1,col=c)\nfig.update_yaxes(title_text='Confirmed Numbers',row=1,col=1)\nfig.update_xaxes(title_text='Days since first infection was reported',row=1,col=2)\nfig.update_layout(width=700,height=400,\n                title=\"<b>States' Trend Analysis<\/b><br>Cumulative Statistics over time\",\n                 margin=dict(t=100,b=0,r=10,l=0), \n                 legend=dict(title='State\/Union Territory',font=dict(size=8))) \nfig.show()","bab92c2c":"df_states.sort_values(by=['state','date'],inplace=True)\ndf_states.reset_index(inplace=True,drop=True)\ndf_states_daily = add_daily_measures(df_states)\ndf_states_daily.fillna(0,inplace=True)","64b774d5":"states = df_states_daily['state'].unique().tolist()\ndf_roll = pd.DataFrame()\nfor state in states:\n    df_state = df_states_daily[df_states_daily['state']==state]\n    df_state['roll_avg_c'] = np.round(df_state['Daily Cases'].rolling(7).mean())\n    df_state['roll_avg_d'] = np.round(df_state['Daily Deaths'].rolling(7).mean())\n    df_state['roll_avg_r'] = np.round(df_state['Daily Cured'].rolling(7).mean())\n    df_roll = df_roll.append(df_state,ignore_index=True)","448f7cff":"rows = 1\ncols = 3\nfig = make_subplots(rows=rows,cols=cols,\n                    subplot_titles=['Cases','Deaths','Recoveries'])\nd_cols = {1:'roll_avg_c',2:'roll_avg_d',3:'roll_avg_c'}\ncolors = plotly.colors.DEFAULT_PLOTLY_COLORS\nfor c in range(1,4):\n    for i,state in enumerate(df_roll.state.unique().tolist()):\n        group = df_roll[df_roll['state']==state]\n        fig.append_trace(go.Scatter(\n            name = state,\n            y = group[d_cols[c]],\n            x = group['day_since_inf'],\n            mode = 'lines',\n            line = dict(\n                color = colors[i%len(colors)],\n            ),\n            legendgroup = state,\n            showlegend = True if c==1 else False,\n            text= '<b>'+state.upper()+'<\/b><br>'+\n                   '<b>Day: <\/b>'+ group['day_since_inf'].astype(str) +'<br>'+\n                   '<b>'+d_cols[c]+': <\/b>'+ group[d_cols[c]].astype(str) +'<br>',\n            hoverinfo = 'text',\n        ),1,c)\n        fig.update_xaxes(tickfont=dict(size=8),row=1,col=c)\n        fig.update_yaxes(tickfont=dict(size=8),row=1,col=c)\nfig.update_yaxes(title_text='Confirmed Numbers(7-Day Rolling average)',\n                 title_font_size=10,row=1,col=1)\nfig.update_xaxes(title_text='Days since first infection was reported',row=1,col=2)\nfig.update_layout(width=700,height=400,\n                title=\"<b>States' Trend Analysis<\/b><br>7-Day Rolling average Statistics\",\n                 margin=dict(t=100,b=0,r=10,l=0), \n                 legend=dict(title='State\/Union Territory',font=dict(size=8))) \nfig.show()","d2b6fd67":"rows = 1\ncols = 3\nfig = make_subplots(rows=rows,cols=cols,shared_yaxes=True,horizontal_spacing=0.03,\n                    subplot_titles=['Cases','Deaths','Recoveries'])\nd_cols = {1:'Daily Cases',2:'Daily Deaths',3:'Daily Cured'}\ncolors = [px.colors.sequential.Blues,\n         px.colors.sequential.Reds,\n         px.colors.sequential.Greens]\nfor c in range(1,4):\n    for i,state in enumerate(df_roll.state.unique().tolist()):\n        group = df_roll[df_roll['state']==state]\n        fig.append_trace(go.Heatmap(\n            z=df_states_daily[d_cols[c]],\n            x=df_states_daily.date,\n            y=df_states_daily.state,\n            colorscale=colors[c-1],\n            showscale=False\n        ),1,c)\n        fig.update_yaxes(tickfont=dict(size=8),nticks=50,row=1,col=c)\nfig.update_layout(width=700,height=600,template='plotly_white',\n                title=\"<b>States' Trend Analysis<\/b><br>Heatmaps Showcasing Daily Statistics\",\n                 margin=dict(t=100,b=0,r=10,l=0), \n                 legend=dict(title='State\/Union Territory',font=dict(size=8))) \nfig.show()","ee505b87":"n = 5\ndf_curr = df_states[df_states['date']==df_states.date.max()]\nstates = df_curr.nlargest(n,'Confirmed')['state'].values.tolist()","83a6733c":"def plot_state(state=state):\n    df_state = df_states[df_states['state']==state]\n    df_state['roll_avg_c'] = df_state['Daily Cases'].rolling(7).mean()\n    df_state['roll_avg_d'] = df_state['Daily Deaths'].rolling(7).mean()\n    df_state['roll_avg_r'] = df_state['Daily Cured'].rolling(7).mean()\n    fig = go.Figure()\n    fig.add_trace(go.Bar(name='Cases',x=df_state['date'],y=df_state['Daily Cases'],marker_color='royalblue',yaxis='y'))\n    fig.add_trace(go.Scatter(name='7-day rolling avg',x=df_state['date'],y=df_state['roll_avg_c'],marker_color='black',yaxis='y'))\n    fig.add_trace(go.Bar(name='Deaths',x=df_state['date'],y=df_state['Daily Deaths'],marker_color='crimson',yaxis='y2'))\n    fig.add_trace(go.Scatter(name='7-day rolling avg',x=df_state['date'],y=df_state['roll_avg_d'],marker_color='black',yaxis='y2'))\n    fig.add_trace(go.Bar(name='Recoveries',x=df_state['date'],y=df_state['Daily Cured'],marker_color='limegreen',yaxis='y3'))\n    fig.add_trace(go.Scatter(name='7-day rolling avg',x=df_state['date'],y=df_state['roll_avg_r'],marker_color='black',yaxis='y3'))\n    # Update axes\n    fig.update_layout(\n        xaxis=dict(\n        autorange=True,\n        rangeslider=dict(\n            autorange=True,\n        ),\n        type=\"date\"\n    ),\n    yaxis=dict(\n        anchor=\"x\",\n        autorange=True,\n        domain=[0, 0.3],\n        linecolor=\"royalblue\",\n        mirror=True,\n        showline=True,\n        side=\"right\",\n        tickfont={\"color\": \"royalblue\"},\n        tickmode=\"auto\",\n        ticks=\"\",\n        title='Cases',\n        titlefont={\"color\": \"royalblue\",\"size\":10},\n        type=\"linear\",\n        zeroline=False\n    ),\n    yaxis2=dict(\n        anchor=\"x\",\n        autorange=True,\n        domain=[0.35, 0.65],\n        linecolor=\"crimson\",\n        mirror=True,\n        showline=True,\n        side=\"right\",\n        tickfont={\"color\": \"crimson\"},\n        tickmode=\"auto\",\n        ticks=\"\",\n        title = 'Deaths',\n        titlefont={\"color\": \"crimson\",\"size\":10},\n        type=\"linear\",\n        zeroline=False\n    ),\n    yaxis3=dict(\n        anchor=\"x\",\n        autorange=True,\n        domain=[0.7, 1],\n        linecolor=\"limegreen\",\n        mirror=True,\n        showline=True,\n        side=\"right\",\n        tickfont={\"color\": \"limegreen\"},\n        tickmode=\"auto\",\n        ticks=\"\",\n        title=\"Recoveries\",\n        titlefont={\"color\": \"limegreen\",\"size\":10},\n        type=\"linear\",\n        zeroline=False\n    )\n    )\n    fig.update_layout(title=state,showlegend=False,template='plotly_white')\n    fig.show()","b3681854":"plot_state(states[0])","3548b5f6":"plot_state(states[1])","f34538dd":"plot_state(states[2])","76d2d87f":"plot_state(states[3])","e3af8121":"plot_state(states[4])","b6277caf":"# <a id='state'>5. Statewise Analysis<\/a>","1909fe7f":"> **NOTE: ** The the Doubling rate that I have calculated is in days. The lesser the doubling rate, the more the spread of virus.","ad5ea7bc":"So, from the above plots, It's pretty evident that out of all states only **Kerala** has been able to faltten the curve. While **Maharashtra, Gujarat, Delhi and Madhya Pradesh** are still fighting hard to curb the spread of infection. The positive is that the recoveries have started to pick up pace in all the states whiles death rate is slowing down.","741105b5":"# <a id='heat'>8. Heatmaps to showcase daily trends<\/a>","b45984a1":"The above Bar chart race is an attempt to show the progression of total cases in India.\n> Please note that this plot is created using [this service](https:\/\/app.flourish.studio\/@flourish\/bar-chart-race\/11) and has to be manually updated.","5651aeac":"The plot below shows the total cases, deaths and recoveries reported on a daily basis. The worrying point is that even after almost 2 nation-wide lockdowns the case are increasing.","8819b588":"Uttar Pradesh with highest population density has not reported as many cases as Maharashtra or Gujarat have. Although, there population density is not even less than half of that of Uttar Pradesh's. So, there seems to be so concrete releation.","720be75e":"# <a id='dr'>2. Studying Doubling rates<\/a>\nThe doubling time is time it takes for a population to double in size\/value. When the relative growth rate (not the absolute growth rate) is constant, the quantity undergoes exponential growth and has a constant doubling time or period, which can be calculated directly from the growth rate.This time can be calculated by dividing the natural logarithm of 2 by the exponent of growth, or approximated by dividing 70 by the percentage growth rate (more roughly but roundly, dividing 72).\n\nFor a constant growth rate of r% within time t, the formula for the doubling time Td is given by\n![](https:\/\/wikimedia.org\/api\/rest_v1\/media\/math\/render\/svg\/44fa9e83cc6807214d065fe22aa46c041e45482e)\n\nGiven two measurements of a growing quantity, q1 at time t1 and q2 at time t2, and assuming a constant growth rate, you can calculate the doubling time as\n![](https:\/\/wikimedia.org\/api\/rest_v1\/media\/math\/render\/svg\/137261413a0a52ccba07032f1abc0d6338e906ff)\n\n>In this section I'll be studying the doubling rates of COVID19 across whole india and its states respectively.","5f671f1f":"# Analysing India's fight against COVID19\n<img src='https:\/\/media.giphy.com\/media\/kgsBIWtPd5Q5Pw11Rq\/giphy.gif' height=400 width=300>\n<br>\n<div class=\"list-group\" id=\"list-tab\" role=\"tablist\">\n  <h3 class=\"list-group-item list-group-item-action active\" data-toggle=\"list\"  role=\"tab\" aria-controls=\"home\">Table of Contents<\/h3>\n  <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#in\" role=\"tab\" aria-controls=\"profile\">Where India stands currently?<span class=\"badge badge-primary badge-pill\">1<\/span><\/a>\n  <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#dr\" role=\"tab\" aria-controls=\"messages\">Studying Doubling rates<span class=\"badge badge-primary badge-pill\">2<\/span><\/a>\n  <a class=\"list-group-item list-group-item-action\"  data-toggle=\"list\" href=\"#geo\" role=\"tab\" aria-controls=\"settings\">Geospatial Analysis<span class=\"badge badge-primary badge-pill\">3<\/span><\/a>\n  <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#test\" role=\"tab\" aria-controls=\"settings\">Testing in India<span class=\"badge badge-primary badge-pill\">4<\/span><\/a> \n  <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#state\" role=\"tab\" aria-controls=\"settings\">Statewise Analysis<span class=\"badge badge-primary badge-pill\">5<\/span><\/a>\n    <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#pop\" role=\"tab\" aria-controls=\"settings\">Does Population Density has to do anything with the spread?<span class=\"badge badge-primary badge-pill\">6<\/span><\/a>\n    <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#trend\" role=\"tab\" aria-controls=\"settings\"> Studying the trend<span class=\"badge badge-primary badge-pill\">7<\/span><\/a>\n    <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#heat\" role=\"tab\" aria-controls=\"settings\">Heatmaps to showcase daily trends<span class=\"badge badge-primary badge-pill\">8<\/span><\/a>\n    <a class=\"list-group-item list-group-item-action\" data-toggle=\"list\" href=\"#top\" role=\"tab\" aria-controls=\"settings\">Top 5 worst affected states<span class=\"badge badge-primary badge-pill\">9<\/span><\/a> ","b27c8390":"# <a id='top'>9. Top 5 worst affected states<\/a>\nIn this section, I'll take a look at the top 5 worst affected states in India. I'm going to plot daily cases, deaths and recoveries along with their rolling average go get a sense of the trend: increasing or decreasing.","765167de":"# <a id='in'>1. Where India stands currently? <\/a>\nCOVID19 outbreak has started a bit late in India as compared to other countries. But, it has started to pick up pace. With limited testing and not a well funded healthcare system, India is surely up for a challenge. Still the fight is on after 2 lockdowns and the virus shows no signs of slowing down. ","b5ce1a10":"# <a id='pop'> 6. Does Population Density has to do anything with the spread?<\/a>\nHere, I will be studing the impact of population density(per km square) on the total confirmed cases, deaths and recoveries. I'll be using a scatter plot with Total Cases, Deaths or Recoveries on the X-asis, population density on the Y-axis and population representing the size of the bubble.","8597c01f":"# <a id='trend'>7. Studying the trend<\/a>\nFor the first three plots, I'm plotting the cumulative cases, deaths and recoveries reported against the day it's first instance was reported.","baa80377":"# <a id='test'>4. Testing in India<\/a>","e2226310":"In the below three plots, I'm plotting the 7-day rolling mean of daily cases, deaths and recoveries reported against the day it's first instance was reported.","826b07c8":"The table below shows the current figures and ranking for India in the World and in Asia.","8820d6be":"# <a id='geo'>3. Geospatial Analysis<\/a>\nIn this section I have used a time slider on a map to show the progression of cases in India."}}