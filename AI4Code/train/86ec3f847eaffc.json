{"cell_type":{"4707d94d":"code","398dccea":"code","6ae029fd":"code","47512425":"code","cae0ad4f":"code","6df2d75d":"code","c54d1c05":"code","8fe4bed9":"code","22d8e47b":"code","f71e57f5":"code","d937d4e6":"code","7e08d54b":"code","592c9e56":"code","a782ce95":"code","b225b5e3":"code","4a8c4a5a":"code","c29ca2c4":"code","5982a564":"code","43f9448d":"code","b210ec93":"code","8ff54498":"code","43a1ff36":"code","1d22283f":"code","d5a1f5fc":"code","dabdf66a":"code","c1a0dbb2":"code","849eecdb":"code","ccf3e8d6":"code","220a505a":"code","fff1708f":"code","b751128a":"code","a95521c5":"code","b2d47af4":"code","5fb84342":"code","1507f132":"code","a82ec7cf":"code","2b025993":"code","3c1775ca":"code","4ec7ab97":"code","7613fc8e":"code","da76f2dd":"code","e372eba7":"code","99c3d4af":"code","01fd4227":"code","fc5bad4f":"code","eccd1ed6":"code","f065d57f":"code","6162dafd":"code","14efe6ee":"code","44826d79":"code","23d395c0":"code","a64d421e":"code","96defdc6":"code","6ac73526":"code","3e0796ec":"code","93f40fbc":"code","9b3dc6ce":"code","52fcb8f8":"code","7c5bd985":"code","f0ba3038":"code","1572b727":"code","33f8a357":"code","f6085e36":"code","d1876dc2":"code","bfe94e0d":"code","361b8e45":"code","4ed62012":"code","3e481178":"code","80549d78":"code","fbe14e9a":"code","8312d366":"code","3421a924":"code","22c71a6f":"code","27fd19b5":"code","3c6e4c55":"code","cbb3af5a":"code","d44941e7":"markdown","d58e0d87":"markdown","821561dc":"markdown","8eeb91b7":"markdown","5f8348de":"markdown","a61c9c70":"markdown","e3e8ed8d":"markdown","aeeaa401":"markdown","2c55b9f5":"markdown","e92e2dd0":"markdown","d2f341f0":"markdown","6bb06134":"markdown","cbe8b4ea":"markdown","5abfdb9b":"markdown","c5d97bdc":"markdown","14b0dd74":"markdown","d3c52eab":"markdown","cd793982":"markdown"},"source":{"4707d94d":"\nimport numpy as np \nimport pandas as pd \n\n\nimport os\nprint(os.listdir(\"..\/input\"))\n","398dccea":"import matplotlib.pyplot as plt\nimport seaborn as sns","6ae029fd":"#Combining a few tables to get a clean look at the details of plays that resulted in concussions\n\nvideo_review = pd.read_csv('..\/input\/NFL-Punt-Analytics-Competition\/video_review.csv')","47512425":"video_review.head()","cae0ad4f":"position = pd.read_csv('..\/input\/NFL-Punt-Analytics-Competition\/play_player_role_data.csv')","6df2d75d":"position.head()","c54d1c05":"concussion_play_data = pd.merge(video_review,position)","8fe4bed9":"concussion_play_data.head()","22d8e47b":"concussion_play_data.Role.value_counts()","f71e57f5":"concussion_play_data.groupby('Player_Activity_Derived').Role.value_counts()","d937d4e6":"team = {'GL':'Punting','PLT':'Punting','PLG':'Punting','PLS':'Punting','PRG':'Punting','PRT':'Punting','GR':'Punting','PLW':'Punting','PRW':'Punting','PC':'Punting','PPR':'Punting','P':'Punting','VRo':\"Receiving\",'VRi':\"Receiving\",'PDR1':\"Receiving\",'PDR2':\"Receiving\",'PDR3':\"Receiving\",'PDL3':\"Receiving\",'PDL2':\"Receiving\",'PDL1':\"Receiving\",'PLR':\"Receiving\",'PLM':\"Receiving\",'PLL':\"Receiving\",'PFB':\"Receiving\",'PR':\"Receiving\",'PDL4':\"Receiving\",'VLo':\"Receiving\",'VR':'Receiving'}\n\nconcussion_play_data['Team']=concussion_play_data.Role.replace(team)","7e08d54b":"concussion_play_data.Team.value_counts()","592c9e56":"concussion_play_data.groupby('Team')['Player_Activity_Derived'].value_counts()","a782ce95":"sns.countplot(x='Player_Activity_Derived', data=concussion_play_data, hue='Team')","b225b5e3":"concussion_play_data['Turnover_Related'].value_counts()","4a8c4a5a":"concussion_play_data.groupby('Team').Role.value_counts()","c29ca2c4":"sns.countplot(x='Role', hue='Team', data = concussion_play_data)","5982a564":"concussion_play_data['Primary_Impact_Type'].value_counts()","43f9448d":"sns.countplot(x='Primary_Impact_Type', data=concussion_play_data)","b210ec93":"#Create a unique identifier for each game by combining GameKey and PlayID\n\nconcussion_play_data['GameKey_PlayID'] = concussion_play_data['GameKey'].map(str) + concussion_play_data['PlayID'].map(str)","8ff54498":"concussion_play_data.head()","43a1ff36":"#Assign True value for all concussions in this data set\nconcussion_play_data['Concussion'] = 'True'","1d22283f":"#Read in remaining play data (including concussion punts)\n\nall_plays = pd.read_csv('..\/input\/play-informationcsv\/play_information.csv')","d5a1f5fc":"all_plays.info()","dabdf66a":"#A little offline manipulation for time's sake. \n#Here Territory = 0 for a punt from the punting team's side of the field; Territory = 1 for a punt from the receiving team's side of the field\n\nall_plays.head()","c1a0dbb2":"#To merge tables, check that PlayID is unique\n\nall_plays.PlayID.value_counts()","849eecdb":"# PlayID is not unique! So we create a unique identifier to merge the tables by combining GameKey and PlayID and removing the lone duplicate\nall_plays['GameKey_PlayID'] = all_plays['GameKey'].map(str) + all_plays['PlayID'].map(str)\nall_plays['GameKey_PlayID'].value_counts()","ccf3e8d6":"#Visualize the only duplicate from our unique identifier\n\nall_plays[all_plays['GameKey_PlayID']=='613849']","220a505a":"#Remove duplicate by adding a and b\n\nall_plays.iloc[697, all_plays.columns.get_loc('GameKey_PlayID')] = '613849a'\nall_plays.iloc[6124, all_plays.columns.get_loc('GameKey_PlayID')] = '613849b'","fff1708f":"#Assigns True to 'fair_catch' if the 'PlayDescription' contains the phrase 'fair catch'\n\nall_plays['fair_catch'] = all_plays['PlayDescription'].str.contains('fair catch')","b751128a":"#Assigns True to 'Touchback' if the 'PlayDescription' contains the phrase 'Touchback'\n\nall_plays['Touchback'] = all_plays['PlayDescription'].str.contains('Touchback')","a95521c5":"#Assigns True to 'out_of_bounds' if the 'PlayDescription' contains the phrase 'out_of_bounds'\n\nall_plays['out_of_bounds'] = all_plays['PlayDescription'].str.contains('out of bounds')","b2d47af4":"#Assigns True to 'out_of_bounds' if the 'PlayDescription' contains the phrase 'out_of_bounds'\n\nall_plays['downed'] = all_plays['PlayDescription'].str.contains('downed')","5fb84342":"#Manipulate the string for 'PlayDescription' to capture the distance of the punt\n\nnew = all_plays['PlayDescription'].str.split(pat='punts',n=1, expand=True)\nall_plays['split1'] = new[0]\nall_plays['split2'] = new[1]\nall_plays['distance'] = all_plays['split2'].str.extract('(\\d+)')\nall_plays.drop(columns=[\"split1\",\"split2\"], inplace=True)","1507f132":"all_plays['distance']=all_plays['distance'].fillna(0)\nall_plays['distance'] = all_plays['distance'].map(int)","a82ec7cf":"#Great, let's merge tables to get the full universe of all punt plays from the 16-17 seasons with our new variables\nfull_data = pd.merge(all_plays, concussion_play_data, on='GameKey_PlayID', how='left')\nfull_data.info()","2b025993":"full_data[full_data['Concussion'] == \"True\"]","3c1775ca":"# 'Concussion' will be our target, so we fill the concussion column with False for NA\n\nfull_data['Concussion']=full_data['Concussion'].fillna('False')","4ec7ab97":"full_data.info()","7613fc8e":"#Because the 'YardLine' field reports numbers on the 0-50-0 scale of a football field, I did a little manipulation to be able to show where the play orinigated on one axis\n\nfull_data['starting_yard'] = full_data['YardLine'].str.extract('(\\d+)')\nfull_data['starting_yard'] = full_data['starting_yard'].map(int)","da76f2dd":"def yardline (row):\n    if row['Territory'] == 0:\n        return row['starting_yard']\n    if row['Territory'] == 1:\n        return 100-row['starting_yard']\n\nfull_data['100yd'] = full_data.apply (lambda row: yardline (row), axis=1)\nfull_data.head()","e372eba7":"full_data.drop(columns='starting_yard')","99c3d4af":"full_data.sort_values('100yd', ascending=False)","01fd4227":"#It would also be helpful to encode a variable for whether or not the play resulted in a return, because it sure seems like returns are dangerous\n\ndef returned (row):\n    if row['fair_catch'] == 1:\n        return False\n    if row['Touchback'] == 1:\n        return False\n    if row['out_of_bounds'] == 1:\n        return False\n    if row['downed'] == 1:\n        return False\n    if row['distance'] == 0:\n        return False\n    return True\n\nfull_data['returned'] = full_data.apply (lambda row: returned (row),axis=1)        ","fc5bad4f":"full_data.head()","eccd1ed6":"full_data.info()","f065d57f":"from sklearn.tree import DecisionTreeClassifier","6162dafd":"target_name = 'Concussion'\nfeats = ['Territory','fair_catch','Touchback','out_of_bounds','downed']\nX = full_data[feats]\ny = full_data[target_name]","14efe6ee":"import graphviz \nfrom sklearn.tree import export_graphviz\n\ntreeclf = DecisionTreeClassifier()\n\ntreeclf.fit(X, y)\ndot_data = export_graphviz(treeclf, out_file=None, feature_names=feats)\n\ngraph = graphviz.Source(dot_data)  \ngraph","44826d79":"treeclf_light = DecisionTreeClassifier(min_samples_split=100, min_samples_leaf=100, max_depth = 7)\n\ntreeclf_light.fit(X, y)\ndot_data = export_graphviz(treeclf_light, out_file=None, feature_names=feats)\n\ngraph = graphviz.Source(dot_data)  \ngraph","23d395c0":"#What was the deal with that punt of 0 yards? It wasn't a punt at all. The concussion occurred on a fake.\n\nfull_data['PlayDescription'].loc[2749]","a64d421e":"#Going from the more simplistic classification based on the side of the field to look more closely at where the play originated by yardline\n\ntarget_name = 'Concussion'\nfeats = ['100yd','fair_catch','Touchback','out_of_bounds','downed']\nX = full_data[feats]\ny = full_data[target_name]\n\ntreeclf_light = DecisionTreeClassifier(min_samples_split=100, min_samples_leaf=100, max_depth = 4)\n\ntreeclf_light.fit(X, y)\ndot_data = export_graphviz(treeclf_light, out_file=None, feature_names=feats)\n\ngraph = graphviz.Source(dot_data)  \ngraph","96defdc6":"#Adding a static variable for graphing purposes\nfull_data['punt'] = \"Punt\"","6ac73526":"g = sns.catplot(x='100yd', y='Concussion', data=full_data,orient='h', height= 7, aspect = 2)","3e0796ec":"#One bar\ng = sns.catplot(x='100yd', y='punt', data=full_data, hue='returned',orient='h', height= 7, aspect = 2, palette = 'Greys', alpha=1)","93f40fbc":"#Two bars (just for different visualization types)\n\ng = sns.catplot(x='100yd', y='returned', data=full_data,orient='h',height= 7, aspect = 2, palette='Blues')","9b3dc6ce":"g = sns.catplot(x='100yd', y='punt', data=full_data,orient='h', hue='fair_catch',height= 7, aspect = 2, palette='Blues', alpha=.8)","52fcb8f8":"#Two bars (just for different visualization types)\n\ng = sns.catplot(x='100yd', y='fair_catch', data=full_data,orient='h',height= 7, aspect = 2, palette='Blues')","7c5bd985":"full_data['downed'].value_counts()","f0ba3038":"full_data['fair_catch'].value_counts()","1572b727":"full_data[full_data['100yd']<31].fair_catch.value_counts()","33f8a357":"full_data[full_data['100yd']<31].downed.value_counts()","f6085e36":"full_data[(full_data['100yd']<31) & (full_data['fair_catch']==True)]","d1876dc2":"full_data[full_data['100yd']<31].distance.mean()","bfe94e0d":"full_data[full_data['100yd']<31].returned.value_counts()","361b8e45":"full_data.returned.value_counts()","4ed62012":"full_data.groupby('returned')['100yd'].mean()","3e481178":"full_data.groupby('returned')['100yd'].median()","80549d78":"full_data.groupby('fair_catch')['100yd'].mean()","fbe14e9a":"full_data.groupby('fair_catch')['100yd'].median()","8312d366":"g = sns.catplot(x='100yd', y='punt', data=full_data, hue='out_of_bounds',orient='h', height= 7, aspect = 2,palette = 'Greens')","3421a924":"g = sns.catplot(x='100yd', y='out_of_bounds', data=full_data,orient='h',height= 7, aspect = 2, palette='Greens')","22c71a6f":"g = sns.catplot(x='100yd', y='punt', data=full_data, hue='downed',orient='h', height= 7, aspect = 2,palette = 'Reds')","27fd19b5":"g = sns.catplot(x='100yd', y='downed', data=full_data,orient='h',height= 7, aspect = 2, palette='Reds')","3c6e4c55":"g = sns.catplot(x='100yd', y='punt', data=full_data, hue='Touchback',orient='h', height= 7, aspect = 2,palette = 'Purples')","cbb3af5a":"g = sns.catplot(x='100yd', y='Touchback', data=full_data,orient='h',height= 7, aspect = 2, palette='Purples')","d44941e7":"26 of the 37 concussions originated inside of the 30 yard line because the incentives greatly favor teams taking a shot at returning the punt","d58e0d87":"Let's start to explore. Are there activities or positions that are more likely to sustain concussions?","821561dc":"Very interesting! Players from the punting team sustained concussions at a rate of nearly 3:1 over the receiving team!","8eeb91b7":"Finally, some breakdowns to aid with the potential impact of any rule changes","5f8348de":"# Conclusion\n\nSeveral things are clear:\n\n - Returns are dangerous\n - More punts are returned when the punt starts inside the 30\n - Fair catches are a safer outcome on the play and fewer fair catches happen on punts inside the 30\n - The rule change has to decrease the number of live returns and incentivize fair catches could be a good way to do that\n \n ## Proposed rule changes are included in the attached slide deck","a61c9c70":"### Much Better\n\n#### Now we can clearly see, of the 36 concussions on punt plays in those two seasons (the 37th concussion was on a fake punt - - see below):\n\n - There were **0 concussions** on punts out of bounds\n - There were **0 concussions** on punts that went for a touchback\n - Only **2 concussions** were on plays involving a fair catch\n - Only ** 3 concussions** were on plays where the punt was downed without a return\n\n### And shorter distance punts were far more dangerous than longer distances.\n\n#### Punt distance between:\n - 0 and 47 yards: 18 concussions\n\n - 47 and 57 yards: 10 concussions\n\n - 57 and 61 yards: 5 concussions\n\n - 61+ yards: 1 concussion","e3e8ed8d":"We now have a universe of **6,681 punt plays** from the 16-17 seasons that resulted in **37 concussions**.\n\nLet's visualize once again the 37 plays that resulted in a concussion.","aeeaa401":"Much of the interesting details about the plays are contained in the long string called 'PlayDescription', so let's play with that and encode some more variables before merging tables","2c55b9f5":"This provides some insights (*there were only two concussions on any plays that ended in a fair catch*), but the tree is overfit and difficult to read.\n\nLet's put some constraints on the model to control for overfitting.","e92e2dd0":"It seems like there might be something here, but we don't have a clear view of which team is more impacted. Let's map the positions to the punting or receiving team based on the position charts provided in the dataset.","d2f341f0":"Now that we have the full set of play data, we're going to use Machine Learning to create a decision tree to parse this large dataset and help us visualize which types of punts result in Concussions and how we can try to influence safer outcomes from punt plays.","6bb06134":"Not really. Helmet-to-helmet hits have been a focus of the league and will continue to be so, but occurred at the same rate as helmet-to-body contact, which would be nearly impossible to prohibit.\n\nHow do these plays compare to the remaining punt plays that did not result in a concussion?","cbe8b4ea":"No concussions were the result of a turnover","5abfdb9b":"We would fully expect that Punt Returners (PR) would be at risk of concussion. It also stands to reason that players on the outside of the punting formation would be at risk as they are most often involved in tackling.\n\nAre there types of impacts that are riskier?","c5d97bdc":"Which variables should we focus on? I'm not going to include variables that we couldn't (or nearly couldn't) influence. \n\nFor instance, should we include the type of game? To what end? Are we going to ban punting in the postseason or tell teams not to practice it in the preseaon? That doesn't seem feasible or safe.\n\nScore? Temperature? Playing surface? Quarter of the game? How could we possible use those to generate better outcomes without fundamentally altering the game?\n\nSo, instead, let's focus on aspects of gameplay that could reasonably be changed by the scope of this exercise, the rules of the game.","14b0dd74":"With this variable, I can create all of the below graphs that show us the frequency of these outcomes by where the punt play starts on the field.\n\nThe x-axis is the yard line (where 60 is the opponent's 40, 70 is the opponent's 30, etc.)","d3c52eab":"Tackles are dangerous! \n\nClearly, a good outcome of the proposed rule changes will be reducing the number of collisions on punt plays.\n\nAre there any additional areas that we can focus on? The chaos from a turnover? Gunners launching themselves on a tackle?","cd793982":"In 2016, the Niners punted from the Bears 31? That seems...ill-advised. \n\nBut cool, the funciton worked and now we can graph the punts and outcomes."}}