{"cell_type":{"553864cb":"code","d10535ce":"code","a923c149":"code","dd5b9dfb":"code","ce360ec9":"code","fa72ec4c":"code","9975346f":"code","94bc2154":"code","2aa04fe6":"code","3e46f385":"code","4d43204a":"code","d50e31bf":"code","74976f89":"code","ec4789b6":"code","40dc34cf":"code","7a25eda9":"code","68eb5d27":"code","99ccbc2c":"code","b95ace05":"code","c8ccfdb2":"code","d310f1d8":"code","9eb4f211":"code","8db76826":"code","09d042e4":"code","09bfbdac":"code","d39bad0a":"code","3ed62b3d":"code","d85048ec":"code","0c744bb3":"code","0085ce29":"code","1f4461c4":"code","a2da2ff6":"code","2287887c":"code","5866678c":"markdown","26c7eba7":"markdown","e972e86e":"markdown","e7b61185":"markdown","ef211d3c":"markdown","1a024f92":"markdown","15b296bd":"markdown","f16fe98f":"markdown","9f141d6c":"markdown","43bb2a7d":"markdown","857b6082":"markdown","ca4d1759":"markdown","1931d2e7":"markdown","f2981956":"markdown","981f7fa2":"markdown","48a7eedd":"markdown","35c66e43":"markdown","228f623e":"markdown"},"source":{"553864cb":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\nplt.style.use('fivethirtyeight')\n\n%matplotlib inline","d10535ce":"wine = pd.read_csv('..\/input\/wine-quality\/winequalityN.csv')\n\nwine.head()","a923c149":"print('Number of rows in the dataset: {}.'.format(wine.shape[0]))\nprint('Number of columns in the dataset: {}.'.format(wine.shape[1]))","dd5b9dfb":"wine.info()","ce360ec9":"missing = pd.DataFrame(wine.isnull().sum(), columns=['Total'])\nmissing['%'] = (missing['Total']\/wine.shape[0])*100\nmissing.sort_values(by='%', ascending=False)","fa72ec4c":"wine = wine.dropna()\n\nprint('Number of rows in the dataset after the rows with missing values were removed: {}.\\n{} rows were removed.'\n      .format(wine.shape[0], 6497-wine.shape[0]))","9975346f":"wine.describe().T","94bc2154":"wine['quality'] = pd.cut(wine['quality'], bins = [0, 5.5, 7.5, 10], labels = [0, 1, 2]).astype('int')","2aa04fe6":"wine['quality'].dtype","3e46f385":"wine['type'] = wine['type'].str.replace('red', '0').str.replace('white', '1').astype('int')\n\nwine['type'].dtype","4d43204a":"plt.figure(figsize=(20,15))\nsns.boxplot(data=wine)\nplt.yticks(range(0,460,30))\nplt.xticks(size=15, rotation=55)\nplt.title('Data Distribution', size=20, y=1.02)\nplt.show()","d50e31bf":"cols = ['residual sugar', 'free sulfur dioxide', 'total sulfur dioxide']\n\nfor c in cols:\n    upper_level = wine[c].mean() + 3*wine[c].std()\n    lower_level = wine[c].mean() - 3*wine[c].std()\n    wine = wine[(wine[c] > lower_level) & (wine[c] < upper_level)]","74976f89":"print('Number of rows in the dataset after the rows with missing values were removed: {}.\\n{} rows were removed.'\n      .format(wine.shape[0], 6463-wine.shape[0]))","ec4789b6":"plt.figure(figsize=(20,15))\nsns.boxplot(data=wine)\nplt.yticks(range(0,300,20))\nplt.xticks(size=15, rotation=55)\nplt.title('Data Distribution after outliers clean up', size=20, y=1.02)\nplt.show()","40dc34cf":"(wine['type'].value_counts(normalize=True)*100).plot.bar(color=('white', 'red'), edgecolor='black', figsize=(10,8))\nplt.xlabel('Type')\nplt.ylabel('Percent')\nplt.xticks(rotation=0)\nplt.title('Wines per Type', size=15, y=1.02)\nplt.show()","7a25eda9":"rw = round(wine[wine['type'] == 0].describe().T, 2)\nww = round(wine[wine['type'] == 1].describe().T, 2)\ndf = pd.concat([ww, rw], axis=1, keys=['White Wines', 'Red Wines']).drop('type', axis=0)\n\ndf","68eb5d27":"plt.figure(figsize=(10, 7))\nsns.countplot(data=wine, x='quality', hue='type', palette = {0: 'red', 1: 'white'}, edgecolor='black')\nplt.title('Quality Count per Type', size=17, y=1.02)\nplt.yticks(range(0,3200, 200))\nplt.show()","99ccbc2c":"cols = ['fixed acidity', 'volatile acidity', 'citric acid',\n       'residual sugar', 'chlorides', 'free sulfur dioxide',\n       'total sulfur dioxide', 'density', 'pH', 'sulphates', 'alcohol']\n\nfor c in cols:\n    plt.figure(figsize=(10,7))\n    sns.barplot(y=c, x='quality', data=wine, hue='type', palette = {0: 'red', 1: 'white'}, edgecolor='black', ci=None)\n    plt.title('{} per quality'.format(c))\n    plt.show()","b95ace05":"plt.figure(figsize=(10, 8))\nsns.heatmap(wine.corr(), annot=True, cmap='Reds')\nplt.title('Attributes Correlation', y=1.03)\nplt.show()","c8ccfdb2":"from pycaret.classification import *\nexp_name = setup(data = wine,  target = 'quality')","d310f1d8":"best_model = compare_models()","9eb4f211":"et = create_model('et')","8db76826":"print(et)","09d042e4":"plot_model(et, plot = 'confusion_matrix')","09bfbdac":"plot_model(et, plot = 'class_report')","d39bad0a":"plot_model(et, plot = 'error')","3ed62b3d":"predict_model(et)","d85048ec":"rf = create_model('rf')","0c744bb3":"print(rf)","0085ce29":"plot_model(rf, plot = 'confusion_matrix')","1f4461c4":"plot_model(rf, plot = 'class_report')","a2da2ff6":"plot_model(rf, plot = 'error')","2287887c":"predict_model(rf)","5866678c":"Above we see that the number of white wines in the dataset is much higher than the number of red wines.\n\nAdditionally, we see that the majority of both types of wines have received a medium quality mark. Very few wines have received high quality mark. This inbalance needs to be addressed when training our models.\n\nNow, let's try to visualize how the different wine attributes affect the quality mark the wine has received.","26c7eba7":"## Visualize the ET Model","e972e86e":"## Make ET Predictions on the Test Set \n\nIt is now time to make predictions on the test set which was created in the set up step.","e7b61185":"The only column not in numeric format is the `type` column. This will be handled in a short while.","ef211d3c":"## Visualize the ET Model","1a024f92":"It looks like the **Extra Trees Classifier** model yeilds best results with the dataset, achieveing 80% accuracy. The **Random Forest Classifier** and the **CatBoost Classifier** are not dar behind.\n\n## Building an Extra Trees Classifier Model","15b296bd":"The `quality` of the wine has the strongest possitive correlation with the `alcohol` attribute and the strongest negative correlation with the `density` attribute.\n\n## Choose and Train a Model\n\nNow it's time to create a model which will be trained on the dataset and afterwards will predict the quality of the wine based on its attributes.\n\nThe PyCaret library will be used on order to find the best classification model for our dataset.","f16fe98f":"## White vs Red Wine: Different not just in Color","9f141d6c":"The model achieved 78% accuracy on the test set which is not far behind the 80% achieved on the trainig set.\n\nNow, let's see if the **Random Forest Classifier Model** could beat that result.\n\n## Building a Random Forest Classifier Model","43bb2a7d":"A few quick observations:\n\n- The higher the quality mark, the higher the fixed acidity in red wines.\n- The lower the volatile acidity, the higher the quality mark for red wines.\n- The higher the citric acid, the better quality mark for red wines.\n- The higher the residual sugar, the lower the quality for white wines.\n- The lower the chlorides, the better the quality mark regardless of type of wine.\n- The lower the free sulfur dioxide, the better the quality mark for red wines.\n- The lower the total sulfur dioxide, the better the quality mark regardless of type of wine.\n- The density and pH are pretty much consistant for all qualities and types of wine.\n- The higher the sulphates in red wine, the better the quality mark.\n- The higher the alcohol, the better the quality mark regardless of type of wine.","857b6082":"## Handling columns\n\nNow let's focus on the `quality` and `type` columns.\n\nFor the `quality` column we will:\n\n- reduce the categories to three:\n    - 0-5.5 or low quality will be labeled with `0`;\n    - 5.6-7.5 or medium quality will be labeled with `1`;\n    - 7.6 <: or high quality will be labeled with `2`\n\n\nFor the `type` column, we will represent `red` as `0` and `white` as `1`.","ca4d1759":"Above we see the total missing values per column as well as what percent of the total values in each column is missing. Since the missing values are not that many, let's just drop the rows with missing values.","1931d2e7":"We see that there are some serious outliers in the `residual sugar`, `free sulfur dioxide` and `total sulfur dioxide` columns. Let's remove anything that is above three standard deviations from the mean of the column.","f2981956":"The **Random Forest** Model achieved a 79% accuracy on the test set which is the same as the accuracy achieved on the train set.\n\n# Conclusion\n\nIn this project, we worked with a dataset covering the different attributes of the Vinho Verde wine. After cleaning up the missing values and the outliers in the data, we first trained an **Extra Trees Classifier** model using the PyCaret library to predict the quality of the wine. The model achieved a **78%** accuracy on the test dataset. Afterwards, we trained a **Random Forest** model which achieved a slightly better accuracy of **79%** on the test dataset.","981f7fa2":"## Make RF Predictions on the Test Set \n\nIt is now time to make predictions on the test set which was created in the set up step.","48a7eedd":"Above we see a side by side descriptive comparison of White wines vs Red wines.\n\nIt can be concluded that on average:\n\n- red wines are more acidic, denser and have a higher pH than white wines;\n- white wines contain more sugar and more sulfurs;\n- it seems like alcohol content is not that different in both types of wines.\n\nAdditionally, white wines are better represented in the dataset - 75% of all wines in the dataset are white. Let's visualize that:","35c66e43":"## Looking for outliers\n\nLet's now visualize some of the attrinutes the wine has and look for outliers. ","228f623e":"![e97c0e0d59cc19e7982b6282b6c1a8c1_5.jpg](attachment:e97c0e0d59cc19e7982b6282b6c1a8c1_5.jpg)\n\n# Wine Quality\n\nIn this project, we will work with a dataset downloaded from [Kaggle](https:\/\/www.kaggle.com\/rajyellow46\/wine-quality). It is related to red and white variants of the Portuguese [Vinho Verde](https:\/\/en.wikipedia.org\/wiki\/Vinho_Verde) wine. \n\nWe will explore and visualise the differences between the two types of wine - white and red. Afterwards, we will use the dataset to train our models to predict the qulity of the wine based on the attributes.\n\nBefore we begin, let's spend some time exploring the different attributes and what information they give us:\n\n- `Fixed acidity` - the predominant fixed acids found in wines are tartaric, malic, citric, and succinic.  Their respective levels found in wine can vary greatly but in general one would expect to see 1,000 to 4,000 mg\/L tartaric acid, 0 to 8,000 mg\/L malic acid, 0 to 500 mg\/L citric acid, and 500 to 2,000 mg\/L succinic acid. (Source: [Waterhouse Lab](https:\/\/waterhouse.ucdavis.edu\/whats-in-wine\/fixed-acidity#:~:text=The%20predominant%20fixed%20acids%20found,2%2C000%20mg%2FL%20succinic%20acid))\n- `Volatile acidity`  - a measure of the wine's gaseous acids that contributes to the smell and taste of vinegar in wine. (Source: [PennState Extension](https:\/\/extension.psu.edu\/volatile-acidity-in-wine))\n- `Citric acid` - often added to wines to increase acidity, complement a specific flavor or prevent ferric hazes. It can be added to finished wines to increase acidity and give a \u201cfresh\u201d flavor. (Source: [Waterhouse Lab](https:\/\/wineserver.ucdavis.edu\/industry-info\/enology\/methods-and-techniques\/common-chemical-reagents\/citric-acid))\n- `Residual sugar` - natural grape sugars leftover in a wine after the alcoholic fermentation finishes. It\u2019s measured in grams per liter. (Source: [WineFolly](https:\/\/winefolly.com\/deep-dive\/what-is-residual-sugar-in-wine\/))\n- `Chlorides` - the amount of salt in the wine.\n- `Free sulfur dioxide` - a measure of the amount of SO2 that is not bound to other molecules, and is used to calculate molecular SO2. Sulfur Dioxide is used throughout all stages of the winemaking process to prevent oxidation and microbial growth. (Source: [Laboratoire Obst](https:\/\/www.laboratoire-obst.com\/so2-libre-en.html#:~:text=Free%20sulfur%20dioxide%20is%20a,prevent%20oxidation%20and%20microbial%20growth.))\n- `Total sulfur dioxide` - the portion of SO2 that is free in the wine plus the portion that is bound to other chemicals in the wine such as aldehydes, pigments, or sugars. (Source: [Midwest Grape and Wine Industry Institute](https:\/\/www.extension.iastate.edu\/wine\/total-sulfur-dioxide-why-it-matters-too#:~:text=Simply%20put%2C%20Total%20Sulfur%20Dioxide,aldehydes%2C%20pigments%2C%20or%20sugars.))\n- `Density` - the typical density or specific gravity of wine is generally between 1.080 and 1.090. This essentially means  wine is 8-9% more dense than water. (Source: [Creative Connoisseur](http:\/\/www.creativeconnoisseur.com\/newsletter\/files\/497deafe6be1b2efc87df8ac6071e459-162.html#:~:text=The%20typical%20density%20or%20specific,9%25%20more%20dense%20than%20water.))\n- `pH` - winemakers use pH as a way to measure ripeness in relation to acidity. Low pH wines will taste tart and crisp, while higher pH wines are more susceptible to bacterial growth. Most wine pH's fall around 3 or 4; about 3.0 to 3.4 is desirable for white wines, while about 3.3 to 3.6 is best for reds. (Source: [Wine Spectator](https:\/\/www.winespectator.com\/articles\/what-do-ph-and-ta-numbers-mean-to-a-wine-5035#:~:text=Winemakers%20use%20pH%20as%20a,3.6%20is%20best%20for%20reds.))\n- `Sulphates` - prevent oxidation and help keep wines fresh. (Source: [Bon appetit](https:\/\/www.bonappetit.com\/drinks\/wine\/article\/sulfite-free-wine#:~:text=Added%20sulfites%20preserve%20freshness%20and,vinegar%20rather%20than%20a%20treasure.))\n- `Alcohol` - alcohol content in wine varies between 5% and 21%. (Source: [WineFolly](https:\/\/winefolly.com\/tips\/alcohol-content-in-wine\/))\n\nOutput variable (based on sensory data):\n- `Quality` - score between 0 and 10\n\nLet's start by opening up the dataset and doing some basic exploration."}}