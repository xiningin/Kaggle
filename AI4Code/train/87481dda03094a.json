{"cell_type":{"b3c76a48":"code","b4e1c787":"code","d79491eb":"code","bf452f52":"code","61bf8b47":"code","39abcd32":"code","1479fddb":"code","9eb319b4":"code","120d9a9e":"code","9944a1af":"code","3c3ab1db":"code","9cff0983":"code","97ab0d82":"code","1e3e5ec5":"code","4a6752b5":"code","2362a0bc":"code","45d58f17":"code","b27c8ca3":"code","80f4d86d":"code","cc718c0d":"code","c353c584":"code","a8a4768f":"code","724e5e57":"code","3689b82c":"code","7d6f5b7b":"code","facd3a8a":"code","aa703122":"code","56f0be22":"code","00b1c19f":"code","354dec28":"code","757a0f32":"code","0eb12e28":"code","5af60347":"markdown","14d5cdde":"markdown","03d7d657":"markdown","49da39b1":"markdown","927a48ed":"markdown","dcc95c48":"markdown","a43cdc1d":"markdown","855c0421":"markdown","730fd406":"markdown","7fa504d8":"markdown","859ed619":"markdown","10a8583f":"markdown"},"source":{"b3c76a48":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport seaborn as sns","b4e1c787":"# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","d79491eb":"data_p1_link = '\/kaggle\/input\/risk-management-uiim\/train_part1.pkl'\ndata_p2_link = '\/kaggle\/input\/risk-management-uiim\/train_part2.pkl'\ndata_test_link = '\/kaggle\/input\/risk-management-uiim\/test_data.pkl'\nsubmission_link = '\/kaggle\/input\/risk-management-uiim\/submission.csv'","bf452f52":"data_p1 = pd.read_pickle(data_p1_link)","61bf8b47":"data_p1.shape","39abcd32":"color_palette = sns.color_palette(\"bright\")\ncolors = (color_palette[3], color_palette[0], color_palette[-1], color_palette[2], color_palette[4])","1479fddb":"def drop_constant_column(dataframe):\n    \"\"\"\n    Drops constant value columns of pandas dataframe.\n    \"\"\"\n    return dataframe.loc[:, (dataframe != dataframe.iloc[0]).any()]","9eb319b4":"data_p1 = drop_constant_column(data_p1)","120d9a9e":"cols_to_leave = data_p1.columns[data_p1.isna().sum() \/ data_p1.shape[0] < 0.9]\ndata_p1 = data_p1[cols_to_leave]","9944a1af":"[(i, data_p1[i].dtype) for i in data_p1.columns if data_p1[i].dtype == '<M8[ns]']","3c3ab1db":"data_p1[['REPORT_DT', 'x_9']].head()","9cff0983":"data_p1['loan_duration'] = pd.to_numeric(data_p1['REPORT_DT'] - data_p1['x_9']) \/ 8.64e+13","97ab0d82":"plt.figure(figsize=(10, 5))\nsns.kdeplot(data=data_p1, x='loan_duration', hue='TARGET', multiple='stack')\nplt.show()","1e3e5ec5":"data_p1_nodefault = data_p1[data_p1['TARGET'] == 1]\ndata_p1_default = data_p1[data_p1['TARGET'] == 0]","4a6752b5":"fig, ax = plt.subplots(ncols=2, figsize=(12, 5), dpi=150)\nsns.histplot(data_p1_default['loan_duration'], ax=ax[0], kde=True,  color=color_palette[2])\nsns.histplot(data_p1_nodefault['loan_duration'], ax=ax[1], kde=True, color='r')\nax[0].set_title('Loan Duration no default')\nax[1].set_title('Loan Duration with default')\nplt.show()","2362a0bc":"obj_cols = [i for i in data_p1.columns if data_p1[i].dtype == 'O']\nint_cols = [i for i in data_p1.columns if data_p1[i].dtype == int]\nflaot_cols = [i for i in data_p1.columns if data_p1[i].dtype == float]","45d58f17":"data_p1[obj_cols].head()","b27c8ca3":"data_p1[\"x_21\"].value_counts()","80f4d86d":"defalt_to_goals = data_p1.groupby('x_21')[\"TARGET\"].mean() * 100\n\ndefalt_to_goals  = defalt_to_goals.sort_values(ascending =False)","cc718c0d":"defalt_to_goals","c353c584":"plt.figure(figsize=(10, 4), dpi=150)\nplt.bar(x=defalt_to_goals.index,\n        height=defalt_to_goals.values,\n        color=colors,\n        width = .9)\nplt.xticks(rotation=25, ha='right', fontsize=10)\nplt.grid(alpha=.4)\nplt.title('Default percent by category of loan')\nplt.show()","a8a4768f":"plt.figure(figsize=(5,5), dpi=150)\nplt.pie(defalt_to_goals, labels = defalt_to_goals.index, colors = colors, autopct='%.0f%%')\nplt.title('Categories of default loans')\nplt.show()","724e5e57":"data_p1[\"x_615\"].value_counts()","3689b82c":"defalt_to_sex = data_p1.groupby('x_615')[\"TARGET\"].mean() * 100","7d6f5b7b":"plt.figure(figsize=(3,3), dpi=150)\nplt.pie(defalt_to_sex,\n        labels = defalt_to_sex.index, colors=sns.color_palette(\"bright\")[2:], autopct='%.0f%%')\nplt.title('Default rate by gender')\nplt.show()","facd3a8a":"data_p1[\"x_628\"].value_counts()","aa703122":"defalt_to_carthold = data_p1.groupby('x_628')[\"TARGET\"].mean() * 100\ndefalt_to_carthold  = defalt_to_carthold.sort_values(ascending =False)\nprint(defalt_to_carthold)","56f0be22":"plt.figure(figsize=(10, 4), dpi=150)\nplt.bar(x=defalt_to_carthold.index,\n        height=defalt_to_carthold.values,\n        color=colors,\n        width = .9)\nplt.xticks(rotation=25, ha='right', fontsize=10)\nplt.grid(alpha=.4)\nplt.title('Default percent by category card')\nplt.show()","00b1c19f":"plt.figure(figsize=(3,3), dpi=150)\nplt.pie(defalt_to_carthold,\n        labels = defalt_to_carthold.index, colors=colors, autopct='%.0f%%')\nplt.title('Default rate by type of card', fontsize=8)\nplt.show()","354dec28":"data_p1[\"x_625\"].value_counts()","757a0f32":"defalt_to_housing = data_p1.groupby('x_625')[\"TARGET\"].mean() * 100\ndefalt_to_housing  = defalt_to_housing.sort_values(ascending =False)\nprint(defalt_to_housing)","0eb12e28":"plt.figure(figsize=(3,3), dpi=150)\nplt.pie(defalt_to_housing,\n        labels = defalt_to_housing.index, colors=colors, autopct='%.0f%%')\nplt.title('Default rate by type of housing', fontsize=8)\nplt.show()","5af60347":"## Drop Constand Columns","14d5cdde":"#### 1.2.1 `x_21` - loan goal feature","03d7d657":"### 1.2 Investigating categorical features","49da39b1":"---","927a48ed":"# EDA conclusion\nAs we may see from the presented data exploration, several categorical features may significantly affect in default rate. The most important ones are:\n\n`x21` - which demonstrates the goal of the particular loan in this case category of 'Individual building' is the riskiest, with a huge default rate of 8.6% compared to ~4.5% of the mean default rate.\n\n`x_628`- which shows which type of card the borrower has. In this case, the riskiest category is people who a not a cardholder of Sber with a default rate ~5% and obviously the least risky category is Sber employees.\n\n`x_625` - which shows whether the borrower leave in the city also shows a quite significant difference of 4.94% for borrowers who live somewhere else compare to 3.63% for borrowers living in the city.\n\n","dcc95c48":"### 1.2.2 `x_615` - gender, most probably","a43cdc1d":"---","855c0421":"### 1.2.4 `x_625` - shows whether the borrower lives in the city or outside the city","730fd406":"# 1. General EDA","7fa504d8":"## Drop columns with more than 90% of missing values","859ed619":"### 1.2.3 `x_628` - \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442, \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043b\u0438 \u0437\u0430\u0435\u043c\u0449\u0438\u043a:\n1. \u0414\u0435\u0440\u0436\u0430\u0442\u0435\u043b\u0435\u043c \u043a\u0430\u0440\u0442\u044b \u0421\u0431\u0435\u0440\u0430 (\u0437\u0430\u0440\u043f\u043b\u0430\u0442\u043d\u044b\u0439 \u043f\u0440\u043e\u0435\u043a\u0442)\n2. \u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u043e\u043c \u0441\u0431\u0435\u0440\u0430\n3. \u041d\u0435 \u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u0440\u0442\u043e\u0439 \u0441\u0431\u0435\u0440\u0430","10a8583f":"### 1.1 Adding Timedepndent Feature `loand duration(days)`.\nSuppose that more days lead to higher risk."}}