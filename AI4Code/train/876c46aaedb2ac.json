{"cell_type":{"962ce379":"code","d2ba5d63":"code","c7c3b21d":"code","732a9137":"code","f5ad61fa":"code","19a25f74":"code","a5cf25b1":"code","613c4903":"code","bce43394":"code","f04769ff":"code","a98eb529":"code","451a1774":"code","b0929788":"code","8bfd0bd9":"markdown","238fefb6":"markdown","c6b5d5c6":"markdown","fb3a76d0":"markdown","6d257bd1":"markdown","43abebca":"markdown","06ecb124":"markdown","f07de1ed":"markdown","eca3ad02":"markdown","c89400ba":"markdown","dc9227a4":"markdown"},"source":{"962ce379":"!pip install --upgrade pip\n!pip install fastai==0.7.0 ## Based on Fast.ai ML course","d2ba5d63":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nfrom IPython.display import display\nfrom fastai.imports import *\nfrom fastai.structured import *\nfrom pandas_summary import DataFrameSummary\nfrom sklearn.ensemble import RandomForestClassifier, RandomForestRegressor\nfrom sklearn.model_selection import train_test_split\nimport os\nprint(os.listdir(\"..\/input\/\"))","c7c3b21d":"train = pd.read_csv(\"..\/input\/santander-customer-transaction-prediction\/train.csv\")\ntest = pd.read_csv(\"..\/input\/santander-customer-transaction-prediction\/test.csv\")","732a9137":"train.describe(include='all')","f5ad61fa":"from imblearn.over_sampling import RandomOverSampler\nros = RandomOverSampler()\ndf_resampled, y_resampled = ros.fit_sample(train, train['target'])\ndf_resampled = pd.DataFrame(df_resampled, columns = train.columns)\ntrain['target'].mean(), df_resampled['target'].mean()\n","19a25f74":"train_cats(df_resampled)\napply_cats(test, df_resampled)","a5cf25b1":"df_trn, y_trn, nas = proc_df(df_resampled, 'target')\ndf_test, _, _ = proc_df(test, na_dict=nas)","613c4903":"X_train, X_valid, y_train, y_valid = train_test_split(df_trn, y_trn, test_size=0.33, random_state=42)","bce43394":"from sklearn.metrics import roc_auc_score\n\ndef print_score(m):\n    res = [roc_auc_score(m.predict(X_train), y_train), roc_auc_score(m.predict(X_valid), y_valid)]\n    print(res)","f04769ff":"set_rf_samples(100000)  ## To train faster, we can train on a smaller subset\nm = RandomForestClassifier(n_jobs=-1, n_estimators = 80, max_depth = 10, min_samples_leaf = 10, min_samples_split = 10)\n%time m.fit(X_train, y_train)","a98eb529":"%time print_score(m)","451a1774":"pred = m.predict(df_test)","b0929788":"submission = pd.read_csv('..\/input\/santander-customer-transaction-prediction\/sample_submission.csv')\nsubmission['target'] = pred\nsubmission.to_csv('rf_submission_iter3.csv', index=False)","8bfd0bd9":"## Defining function to calculate the evaluation metric","238fefb6":"## Training vs Validation ROC","c6b5d5c6":"## Processing the training and test data ","fb3a76d0":"## Converting categorical data, if any, to factors","6d257bd1":"## Splitting into training and validation set","43abebca":"## Create submission file","06ecb124":"## Reading in the datasets","f07de1ed":"## Make predictions","eca3ad02":"## Let's resample first to avoid imbalance","c89400ba":"## Importing libraries\nInstalling fastai library, used in their [free MOOC](http:\/\/course18.fast.ai\/ml.html).","dc9227a4":"## Train the random forest model"}}