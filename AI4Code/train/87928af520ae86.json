{"cell_type":{"7cd26327":"code","035bde0f":"code","bdefa29c":"code","2f5fb008":"code","63587cb6":"markdown"},"source":{"7cd26327":"from keras.models import load_model\nimport os, shutil\nfrom PIL import Image\nimport numpy as np","035bde0f":"def grayscale(picture):\n    res= Image.new(picture.mode, picture.size)\n    width, height = picture.size\n    for i in range(0, width):\n        for j in range(0, height):\n            pixel=picture.getpixel((i,j))\n            avg=(pixel[0]+pixel[1]+pixel[2])\/3\n            res.putpixel((i,j),(int(avg),int(avg),int(avg)))\n    res.show()\n    return res\n\n\ndef normalize(picture):\n    width, height = picture.size\n    normalized_array = []\n    for j in range(0, height):\n        for i in range(0, width):\n            pixel = picture.getpixel((i,j))\n            normalized_array.append( pixel[0] \/ 255.0 )\n    return np.array(normalized_array)","bdefa29c":"# model from here: https:\/\/github.com\/ashislaha\/CarDetection-Keras\nmodel = load_model('\/kaggle\/input\/car-detection-model\/car_detection_keras_CNN_model.h5')","2f5fb008":"checked_num = 0\nadd_num = 0\nfor i in range(0,2):\n    dir_from = f'\/kaggle\/input\/autoru\/{i}\/'\n    dir_to = f'{i}\/'\n    files = os.listdir(dir_from)\n    for file in files:\n        checked_num += 1\n        img = Image.open(dir_from+file)\n        row,column = 100,100\n        img = img.resize((row,column),Image.ANTIALIAS)\n        try:\n            gray_image = grayscale(img)\n        except:\n            print(f\"{file} cannot be checked\")\n            continue\n        gray_image = grayscale(img)\n        X_test = normalize(gray_image)\n        X_test = X_test.reshape(1, row, column, 1)\n        classes = model.predict(X_test)\n        maxVal = classes[0].max()\n        indexVal = np.where(classes[0]==maxVal)\n        if (indexVal[0] == 0):\n            # print(f\"{file} is a Car\")\n            if not os.path.exists(dir_to):\n                os.makedirs(dir_to)\n            shutil.copyfile(dir_from+file, dir_to+f'output_{file}')\n            add_num += 1\n        else:\n            pass\n            # print(f\"{file} is not a Car\")\n        if checked_num % 10000  == 0:\n            print(f'{checked_num} files were checked')\n        # \u041a \u043e\u0433\u0440\u043e\u043c\u043d\u043e\u043c\u0443 \u0441\u043e\u0436\u0435\u043b\u0430\u043d\u0438\u044e \u043d\u0435 \u0445\u0432\u0430\u0442\u0430\u0435\u0442 \u043a\u0432\u043e\u0442\u044b \u0432 10 \u0447\u0430\u0441\u043e\u0432 GPU, \u0447\u0442\u043e\u0431\u044b \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0432\u0441\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f\n        # \u0411\u0443\u0434\u0443 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0438\u0432\u0430\u0442\u044c \u043a\u043b\u0430\u0441\u0441\u044b \u0432 10000 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439\n        # if (i == 0) & (add_num == 8500):\n        #     break\n        # if (i == 1) & (add_num == 16700):\n        #     break\nprint(f'{add_num} files were added')","63587cb6":"<h1>CarDetection for 0-1 classes<\/h1>\nThis model detects images with cars. Dataset of images is from auto.ru"}}