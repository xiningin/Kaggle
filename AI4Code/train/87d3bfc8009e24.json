{"cell_type":{"1b6d1f72":"code","0019468b":"code","10c8f727":"code","93742a9c":"code","d7b9a652":"code","2110f75e":"code","0c3d5dbc":"code","d0dba0b1":"code","5ada979d":"code","6b8cc288":"code","5f5ec76b":"code","07e75bd2":"code","c9bc1d0a":"code","ceb90540":"code","53d96e31":"code","2ce1c3bc":"code","34f6757a":"code","9edfe1f0":"code","f2fdd1f6":"code","4e845d21":"markdown","c36db0e2":"markdown","d7abbe24":"markdown","ec454a8f":"markdown","e5d59db8":"markdown","1992c96b":"markdown","f4cf98ba":"markdown"},"source":{"1b6d1f72":"# Import linraries\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\nfrom sklearn.metrics import confusion_matrix\nfrom fastai import *\nfrom fastai.vision import *","0019468b":"# define image data directory path\nDATA_DIR='..\/input\/data'","10c8f727":"# The directory under the path is the label name.\nos.listdir(f'{DATA_DIR}')","93742a9c":"# Check if GPU is available\ntorch.cuda.is_available()","d7b9a652":"# create image data bunch\ndata = ImageDataBunch.from_folder(DATA_DIR, \n                                  train=\".\", \n                                  valid_pct=0.2,\n                                  ds_tfms=get_transforms(flip_vert=True, max_warp=0),\n                                  size=224,\n                                  bs=64, \n                                  num_workers=0).normalize(imagenet_stats)","2110f75e":"# check classes\nprint(f'Classes: \\n {data.classes}')","0c3d5dbc":"# show some sample images\n\ndata.show_batch(rows=3, figsize=(7,6))","d0dba0b1":"# build model (use resnet34)\nlearn = create_cnn(data, models.resnet34, metrics=accuracy, model_dir=\"\/tmp\/model\/\")","5ada979d":"# search appropriate learning rate\nlearn.lr_find()\nlearn.recorder.plot()","6b8cc288":"learn.fit_one_cycle(6,1e-2)","5f5ec76b":"# save stage\nlearn.save('stage-1')","07e75bd2":"learn.unfreeze()","c9bc1d0a":"# search appropriate learning rate\nlearn.lr_find()\nlearn.recorder.plot()","ceb90540":"learn.fit_one_cycle(4, max_lr=slice(1e-6,1e-5 ))","53d96e31":"learn.fit_one_cycle(4, max_lr=slice(1e-6,1e-5 ))","2ce1c3bc":"# save stage\nlearn.save('stage-2')","34f6757a":"learn.recorder.plot_losses()","9edfe1f0":"interp = ClassificationInterpretation.from_learner(learn)\ninterp.plot_top_losses(9, figsize=(15,11))","f2fdd1f6":"interp.plot_confusion_matrix(figsize=(8,8), dpi=60)","4e845d21":"# Check Result","c36db0e2":"# Learning","d7abbe24":"# Model Build","ec454a8f":"# Importing Libraries","e5d59db8":"<img src=\"http:\/\/okeya-life.com\/wp-content\/uploads\/2017\/01\/1846x1230xmanwomanlife3.pagespeed.ic_.o9vxJgwptY.jpg\" width=\"700px\">","1992c96b":"# Men\/Women Classification","f4cf98ba":"# Create ImageDataBunch"}}