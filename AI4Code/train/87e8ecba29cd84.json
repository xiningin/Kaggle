{"cell_type":{"77f91dfb":"code","94b2bc20":"code","6df62218":"code","84c6ce58":"code","7e065d03":"code","1fa76d25":"code","2d478e56":"code","b08c55c2":"code","677ec51c":"code","b2455d60":"code","9d7a59c1":"code","85ac9a7a":"code","0e3c145b":"code","e1836f11":"code","e891037c":"code","a3d2adb2":"code","e21e041e":"code","1a603c4a":"code","62d95591":"code","6ce479ba":"code","948c3344":"code","a45a8fc5":"code","3acf6388":"code","3659859c":"code","ab73d5b3":"code","85f4b5fa":"code","2cea51a6":"code","4df7217f":"code","963e705d":"code","d1beda4f":"code","cdcd3fda":"code","e129f5d0":"code","ea405491":"code","bed4b65d":"code","7b106ce6":"code","e9ae1217":"code","c22730fe":"code","2999593c":"code","f74dab3b":"code","64e1d1c4":"code","eb4b44f6":"code","adeeb610":"code","2fc1ac1e":"code","057b90cd":"code","5e23260e":"code","080531b5":"code","8e141c88":"code","e0b0e188":"code","73281922":"code","87e06c90":"code","46ad7c5a":"code","4d0d75b3":"code","a61d66e7":"code","39082e56":"code","4f0cf430":"code","3cc85070":"code","fd80e9e3":"code","83ecd4bd":"code","857a4af9":"code","54e7a02b":"code","2a7c7c17":"code","f9fa3940":"code","4e0e968e":"code","25f075b1":"code","dccc7ff5":"code","9d4b4770":"code","442ba632":"code","f635b8b9":"code","017ace27":"code","e93785af":"code","eb08cfe3":"code","e7b615b3":"code","eb5f38bf":"markdown","9d403eb0":"markdown","cd1a22d8":"markdown","575d337a":"markdown","f2a69aa2":"markdown","75c75220":"markdown","38ef0e36":"markdown","5a1985a7":"markdown","2498438d":"markdown","e290316f":"markdown","e12abed1":"markdown","a4f5f5d3":"markdown","b01f7a3e":"markdown","2971cc35":"markdown","52a2e075":"markdown","9f2faaec":"markdown","d00e2d6a":"markdown","b87521bb":"markdown","fda7284d":"markdown","13aa806a":"markdown","a82bcb66":"markdown","ec39d341":"markdown","d99b6d4c":"markdown","4f17d826":"markdown","07f5ee35":"markdown","3ecef7ff":"markdown","5adeb4a9":"markdown","60cbe7f1":"markdown","24b49de0":"markdown","eaf789b7":"markdown","f27118ae":"markdown","99dfcc99":"markdown","fab8c790":"markdown","fc19c62c":"markdown"},"source":{"77f91dfb":"!pip install seaborn==0.11.0","94b2bc20":"import numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport matplotlib.gridspec as gridspec\nimport plotly.express as px\nimport plotly.graph_objs as go\nfrom sklearn.cluster import KMeans\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.model_selection import train_test_split","6df62218":"df = pd.read_csv('..\/input\/ibm-hr-analytics-attrition-dataset\/WA_Fn-UseC_-HR-Employee-Attrition.csv')","84c6ce58":"print(\"A first aproach to our dataset \\n\")\ndisplay(df.head(2), df.describe().transpose(), df.columns)\n","7e065d03":"fig, axis=plt.subplots(3,2,figsize=(17,15))\nplt.suptitle('Attrition and Job position - Education',size=15)\n\nsns.histplot(x=df.Department, hue=df.Attrition, ax=axis[0,0],palette=\"Pastel1\")\naxis[0,0].set_title('Employees and Atrittion per Department', size=10)\nsns.histplot(df, x=df.Department, hue=df.Attrition, ax=axis[0,1],palette=\"Pastel1\", stat=\"probability\", multiple=\"fill\", shrink=.8)\n\nsns.histplot(x=df.Education, hue=df.Attrition, ax=axis[1,0],bins=5,palette=\"Pastel1\")\naxis[1,0].set_title('Employees and Attrition per Education Level', size=10)\nsns.histplot(df, x=df.Education, hue=df.Attrition, ax=axis[1,1],bins=5,palette=\"Pastel1\", stat=\"probability\", multiple=\"fill\", shrink=.8)\n\nsns.histplot(x=df.EducationField, hue=df.Attrition, ax=axis[2,0],palette=\"Pastel1\")\naxis[2,0].set_title('Employees and Attrition per Education Field', size=10)\naxis[2,0].set_xticklabels(labels=list(df.EducationField.unique()),rotation=30)\nsns.histplot(df, x=df.EducationField, hue=df.Attrition, ax=axis[2,1],palette=\"Pastel1\", stat=\"probability\", multiple=\"fill\", shrink=.8)\naxis[2,1].set_xticklabels(labels=list(df.EducationField.unique()),rotation=30)\n;\n","1fa76d25":"fig, axis=plt.subplots(5,2,figsize=(17,15))\nplt.suptitle('Attrition and Temporal Features',fontsize=20)\nsns.histplot(x=df.TotalWorkingYears, hue=df.Attrition, ax=axis[0,0],palette='Pastel1',multiple=\"stack\")\naxis[0,0].set_title('Total Working Years', size=10)\nsns.histplot(df, x=df.TotalWorkingYears, hue=df.Attrition, ax=axis[0,1],palette=\"Pastel1\", stat=\"probability\", multiple=\"fill\", shrink=.8)\n\nsns.histplot(x=df.YearsAtCompany, hue=df.Attrition, ax=axis[1,0],palette='Pastel1',multiple=\"stack\")\naxis[1,0].set_title('Years at Company', size=10)\nsns.histplot(df, x=df.YearsAtCompany, hue=df.Attrition, ax=axis[1,1],palette=\"Pastel1\", stat=\"probability\", multiple=\"fill\", shrink=.8)\n\nsns.histplot(x=df.YearsInCurrentRole, hue=df.Attrition, ax=axis[2,0],palette='Pastel1',multiple=\"stack\")\naxis[2,0].set_title('Years in Current Role', size=10)\nsns.histplot(df, x=df.YearsInCurrentRole, hue=df.Attrition, ax=axis[2,1],palette=\"Pastel1\", stat=\"probability\", multiple=\"fill\", shrink=.8, bins=19)\n\nsns.histplot(x=df.YearsSinceLastPromotion, hue=df.Attrition, ax=axis[3,0],palette='Pastel1',multiple=\"stack\")\naxis[3,0].set_title('Years since last promotion', size=10)\nsns.histplot(df, x=df.YearsSinceLastPromotion, hue=df.Attrition, ax=axis[3,1],palette=\"Pastel1\", stat=\"probability\", multiple=\"fill\", shrink=.8,bins=16)\n\nsns.histplot(x=df.YearsWithCurrManager, hue=df.Attrition, ax=axis[4,0],palette='Pastel1',multiple=\"stack\")\naxis[4,0].set_title('Years with current manager', size=10)\nsns.histplot(df, x=df.YearsWithCurrManager, hue=df.Attrition, ax=axis[4,1],palette=\"Pastel1\", stat=\"probability\", multiple=\"fill\", shrink=.8,bins=18)\n\nplt.subplots_adjust(hspace=1)","2d478e56":"# We will build a new feature, which classifies the age in the main \"Generations\" accepted by theory.\ndf['Generation'] = df.Age.apply(lambda x: 'Millenials' if (x>=17) and (x<36) else('Generation X' if (x>=36) and (x<52) else ('Baby Boomers' if (x>=52) and (x<71) else ('Silent Generation' if (x>=71) and (x<89) else x))))","b08c55c2":"fig = plt.figure(1)\nplt.suptitle('What About Generations?',fontsize=20)\n# set up subplot grid\ngridspec.GridSpec(3,3)\n\n# large subplot\nplt.subplot2grid((3,3), (0,0), colspan=1, rowspan=3)\nplt.locator_params(axis='x', nbins=5)\nplt.locator_params(axis='y', nbins=5)\nplt.title('Generations by Job Position')\nplt.xlabel('Number of People')\nplt.ylabel('Generation')\nsns.histplot(y=df.JobRole, hue=df.Generation, palette='Pastel1',multiple=\"stack\")\n\n# small subplot 1\nplt.subplot2grid((3,3), (0,1),colspan=2)\nplt.locator_params(axis='x', nbins=5)\nplt.locator_params(axis='y', nbins=5)\nplt.title('Generations Inside the Company')\nplt.xlabel('Age')\nplt.ylabel('Employees')\nsns.histplot(x=df.Age, hue=df.Generation,palette='Pastel1')\n\n# small subplot 2\nplt.subplot2grid((3,3), (1,1),colspan=2)\nplt.locator_params(axis='x', nbins=5)\nplt.locator_params(axis='y', nbins=5)\nplt.title('Years in company per Generation')\nplt.xlabel('Years in Company')\nplt.ylabel('Employees')\nsns.histplot(x=df.YearsAtCompany, hue=df.Generation, palette='Pastel1',multiple=\"stack\")\n\n# small subplot 3\nplt.subplot2grid((3,3), (2,1),colspan=2)\nplt.locator_params(axis='x', nbins=5)\nplt.locator_params(axis='y', nbins=5)\nplt.title('Generations and Monthly income')\nplt.xlabel('Generations')\nplt.ylabel('Income')\nsns.boxplot(x=df.Generation, y=df.MonthlyIncome, hue=df.Attrition,palette='Pastel1')\n\n# fit subplots and save fig\n\nfig.set_size_inches(w=20,h=10)\nplt.subplots_adjust(hspace=.5)\nplt.show()","677ec51c":"fig = plt.figure(1)\nplt.suptitle('Gender Analysis',fontsize=30,x = .5)\n# set up subplot grid\ngridspec.GridSpec(3,3)\n\n# large subplot\nplt.subplot2grid((3,3), (0,0), colspan=1, rowspan=3)\nplt.title('Gender by Job Position')\nplt.xlabel('Number of People')\nplt.ylabel('Gender')\nsns.histplot(y=df.JobRole, hue=df.Gender, palette='Pastel1',multiple=\"stack\")\n\nplt.subplot2grid((3,3), (0,1),colspan=1)\nplt.title('Gender Distribution')\nlabels = list(df.groupby(\"Gender\")[\"EmployeeCount\"].sum().keys())\nplt.pie(x=df.groupby(\"Gender\")[\"EmployeeCount\"].sum(), \n        autopct=\"%.1f%%\",  labels=labels,explode=[0.05]*2, shadow=True)\n\nplt.subplot2grid((3,3), (0,2),colspan=1)\nplt.title('Attrition By Gender')\nlabels = list(df.loc[df['Attrition']=='Yes'].groupby(\"Gender\")[\"EmployeeCount\"].sum().keys())\nplt.pie(x=df.loc[df['Attrition']=='Yes'].groupby(\"Gender\")[\"EmployeeCount\"].sum(), \n        autopct=\"%.1f%%\",  labels=labels, radius=1,pctdistance=0.5, explode=[0.05]*2, shadow=True)\n\nplt.subplot2grid((3,3), (2,1),colspan=1)\nplt.title('Monthly Income By Gender')\nsns.boxplot(data=df,x='Gender', y='MonthlyIncome', palette='Pastel1')\n\nplt.subplot2grid((3,3),(1,1),colspan=1)\nplt.title('Years since last promotion')\nsns.histplot(x=df.YearsSinceLastPromotion,hue=df.Gender, palette='Pastel1', multiple='stack',bins=16)\n\nplt.subplot2grid((3,3), (1,2), colspan=1)\nplt.title('WorkLife Balance')\nsns.histplot(x=df.WorkLifeBalance,hue=df.Gender, palette='Pastel1', bins=4,multiple='stack')\n\nplt.subplot2grid((3,3),(2,2),colspan=1)\nplt.title('Marital Status')\nsns.histplot(x=df.MaritalStatus, hue=df.Gender, palette='Pastel1',multiple='stack')\n\nfig.set_size_inches(w=20,h=15)\nplt.subplots_adjust(hspace=.2)\nplt.show()","b2455d60":"fig = plt.figure(1)\nplt.suptitle('Job Analysis',fontsize=30,x = .5)\n# set up subplot grid\ngridspec.GridSpec(3,3)\n\n# large subplot\nplt.subplot2grid((3,3), (0,0), colspan=1)\nplt.title('Attrition and Salary')\nplt.xlabel('Attrition')\nplt.ylabel('MonthlyIncome')\nsns.boxenplot(y=df.MonthlyIncome,x=df.Attrition, palette='Pastel1')\n\nplt.subplot2grid((3,3), (0,1), colspan=2)\nplt.title('Attrition and Job Level')\nplt.xlabel('Job Level')\nplt.ylabel('People')\nsns.countplot(data=df, x='JobLevel', hue='Attrition',palette='Pastel1')\n\nplt.subplot2grid((3,3), (1,0), colspan=1)\nplt.title('Attrition , Overtime and Monthly Income')\nplt.xlabel('Overtime')\nplt.ylabel('People')\nsns.boxenplot(data=df, x='OverTime',y='MonthlyIncome', hue='Attrition',palette='Pastel1')\n\nplt.subplot2grid((3,3), (1,1),colspan=1)\nplt.title('Attrition in OverTime Yes')\nlabels = list(df.loc[df['OverTime']=='Yes'].groupby(\"Attrition\")[\"EmployeeCount\"].sum().keys())\nplt.pie(x=df.loc[df['OverTime']=='Yes'].groupby(\"Attrition\")[\"EmployeeCount\"].sum(), \n        autopct=\"%.1f%%\",  labels=labels, radius=1,pctdistance=0.5, explode=[0.05]*2, shadow=True)\n\nplt.subplot2grid((3,3), (1,2),colspan=1)\nplt.title('Attrition in OverTime No')\nlabels = list(df.loc[df['OverTime']=='No'].groupby(\"Attrition\")[\"EmployeeCount\"].sum().keys())\nplt.pie(x=df.loc[df['OverTime']=='No'].groupby(\"Attrition\")[\"EmployeeCount\"].sum(), \n        autopct=\"%.1f%%\",  labels=labels, radius=1,pctdistance=0.5, explode=[0.05]*2, shadow=True)\n\nplt.subplot2grid((3,3), (2,0), colspan=1)\nplt.title('Attrition and Job Satisfaction')\nplt.xlabel('Job Satisfaction')\nplt.ylabel('People')\nsns.countplot(data=df, x='JobSatisfaction', hue='Attrition',palette='Pastel1')\n\nplt.subplot2grid((3,3), (2,1), colspan=2)\nplt.title('Attrition and EnvironmentSatisfaction')\nplt.xlabel('EnvironmentSatisfaction')\nplt.ylabel('People')\nsns.countplot(data=df, x='EnvironmentSatisfaction', hue='Attrition',palette='Pastel1')\n\n\n\nfig.set_size_inches(w=20,h=15)\nplt.subplots_adjust(hspace=.2)\nplt.show()","9d7a59c1":"df['LastPromotion_ratio']=  (df['YearsSinceLastPromotion'] \/ df['YearsAtCompany']).round(2)\n       ","85ac9a7a":"df=df.fillna(value=0)","0e3c145b":"X_cluster=df[['MonthlyIncome','Age','LastPromotion_ratio']]\n#Because we work with distances, at the very beginning we have to standarize the features.\nscaler=StandardScaler()\nX_cluster_scaled=scaler.fit_transform(X_cluster);\n","e1836f11":"sq_distances=[]\nk_values=range(2,10);\n\nfor k in k_values:\n    kmeans=KMeans(n_clusters=k,n_init=10,random_state=0) # Numero de repeticiones=10\n    kmeans.fit(X_cluster_scaled)\n    sq_distances.append(kmeans.inertia_)\n\nsns.lineplot(x=k_values,y=sq_distances,marker='o',size=30,legend=False);\nplt.ylabel('Sum quadratic distance');plt.xlabel('Number of clusters');    ","e891037c":"from sklearn.metrics import silhouette_score,silhouette_samples\n\nsil=[]\nk_values=range(2,10);\n\nfor k in k_values:\n    kmeans=KMeans(n_clusters=k,n_init=10,random_state=0) # Numero de repeticiones=10\n    kmeans.fit(X_cluster_scaled)\n    score=silhouette_score(X_cluster_scaled,kmeans.labels_)\n    sil.append(score)\n\nsns.lineplot(x=k_values,y=sil,marker='o',size=30,legend=False);\nplt.ylabel('Silhouette score',fontsize=15);plt.xlabel('Number of clusters',fontsize=15);","a3d2adb2":"kmeans=KMeans(n_clusters=3,n_init=10,random_state=0) # Number of rep=10\nkmeans.fit(X_cluster_scaled)","e21e041e":"labels=kmeans.labels_","1a603c4a":"fig = go.Figure(data=[go.Scatter3d(x=X_cluster_scaled[:,0],y=X_cluster_scaled[:,2],z=X_cluster_scaled[:,1],mode='markers',\n                                   marker = dict( size = 7, \n                                                 color = labels, \n                                               colorscale ='Viridis', \n                                               opacity = 0.6\n                                                ))])\nfig.update_layout(title=dict(text=\"Cluster Analysis\", x=0.5,y=.98),\n                   scene = dict(\n                    xaxis = dict(\n                         backgroundcolor=\"rgb(200, 200, 230)\",\n                         gridcolor=\"white\",\n                         showbackground=True,\n                         zerolinecolor=\"white\",\n                         title='MonthlyIncome',),\n                    yaxis = dict(\n                        backgroundcolor=\"rgb(230, 200,230)\",\n                        gridcolor=\"white\",\n                        showbackground=True,\n                        zerolinecolor=\"white\",\n                        title='Last Promotion Ratio',),\n                    zaxis = dict(\n                        backgroundcolor=\"rgb(230, 230,200)\",\n                        gridcolor=\"white\",\n                        showbackground=True,\n                        zerolinecolor=\"white\",\n                        title='Age',),),\n                    width=600,\n                    height=600,\n                    margin=dict(\n                    r=0, l=0,\n                    b=10, t=30)\n                  )\nfig.show()","62d95591":"### We will create a copy of our main DF, just in case\ndf_model = df.copy()","6ce479ba":"# We drop the features less important for our analysis\ndf_model = df_model.drop(['EmployeeNumber','HourlyRate',\n                          'MonthlyRate','DailyRate','Over18','StandardHours',\n                          'Generation','EmployeeCount'], axis=1)","948c3344":"# We convert the feature attrition to our target.\ndf_model['Attrition'] = df_model.Attrition.apply(lambda x: 0 if x=='No' else 1)","a45a8fc5":"df_model = pd.get_dummies(df_model, drop_first=True)","3acf6388":"# A quick look to our new variables\ndf_model.columns","3659859c":"# We create the array of target, and our dataset of features\nX_model= df_model.drop(['Attrition'], axis=1)\ny_model= df_model.Attrition","ab73d5b3":"X_train, X_test, y_train, y_test = train_test_split(X_model, y_model, test_size=0.30, random_state=42, stratify=y_model)","85f4b5fa":"from sklearn.ensemble import AdaBoostClassifier, GradientBoostingClassifier","2cea51a6":"from sklearn.model_selection import cross_val_score, StratifiedKFold\ncv = StratifiedKFold(n_splits=5, random_state=41, shuffle=True)","4df7217f":"# we create a function to evaluate our model\ndef model_performance(model, name, X, y, cv):\n    s = cross_val_score(model, X, y, cv=cv, n_jobs=-1)\n    print(\"Performance of {}:\\t{:0.3} \u00b1 {:0.3}\".format( \\\n        name, s.mean().round(3), s.std().round(3)))","963e705d":"#Importing the base model\nfrom sklearn.tree import DecisionTreeClassifier\ndt = DecisionTreeClassifier(random_state=1)\n\nmodel_performance(dt,\"Tree base\", X_train, y_train, cv)","d1beda4f":"ab = AdaBoostClassifier(base_estimator=dt, n_estimators=500,random_state=1)\nmodel_performance(ab, \"AdaBoostClassifier\",  X_train, y_train, cv)","cdcd3fda":"gb = GradientBoostingClassifier()\nmodel_performance(gb, \"GradientBoostingClassifier\", X_train, y_train, cv)","e129f5d0":"from sklearn.model_selection import GridSearchCV\n\nparams_ab = {\"n_estimators\": [500,1000],\n          \"learning_rate\":[0.01, 0.1],\n        \"base_estimator__max_depth\": [1, 2, 3]}\n\ngrid_ab = GridSearchCV(AdaBoostClassifier(base_estimator=dt,random_state=1), \n                       param_grid=params_ab, cv=cv, verbose=1, n_jobs=3)\n","ea405491":"grid_ab.fit(X_train, y_train)","bed4b65d":"model_performance(grid_ab.best_estimator_,  \"AdaBoostClassifier + GS\", X_train, y_train, cv)","7b106ce6":"params_gb = {'n_estimators':[500, 1000] , \n             'learning_rate':[0.001, 0.001, 0.1],\n            'max_depth' : [1, 2, 3, 4]}\n\ngrid_gb = GridSearchCV(gb, param_grid=params_gb, cv=cv, verbose=1, n_jobs=3)","e9ae1217":"grid_gb.fit(X_train, y_train)","c22730fe":"model_performance(grid_gb.best_estimator_,  \"AdaBoostClassifier + GS\", X_train, y_train, cv)","2999593c":"from sklearn.metrics import roc_auc_score\n","f74dab3b":"from scikitplot.metrics import plot_roc\nplot_roc(y_test,grid_gb.predict_proba(X_test))","64e1d1c4":"plot_roc(y_test,grid_ab.predict_proba(X_test))","eb4b44f6":"xgb_auc = roc_auc_score(y_test,grid_gb.predict(X_test))\nprint(\"AUC Value is: \", xgb_auc)","adeeb610":"xab_auc = roc_auc_score(y_test,grid_ab.predict(X_test))\nprint(\"AUC Value for Xab is: \", xab_auc)","2fc1ac1e":"model = grid_gb.best_estimator_\nmodel","057b90cd":"importances = model.feature_importances_\nimportances","5e23260e":"index = np.argsort(importances)[::-1]\nnames = X_model.columns[index]\n\nplt.figure(figsize=(15,10))\n\nplt.title(\"Feature Importance\")\n\n\nplt.bar(range(X_model.shape[1]), importances[index],color='rrrggggggggggggggggggggggggggggggggggggggg')\n\nplt.xticks(range(X_model.shape[1]), names, rotation=90)\n\n# Show plot\nplt.show()","080531b5":"import lightgbm as lgb\nmodel_lgb = lgb.LGBMClassifier()","8e141c88":"from sklearn.model_selection import GridSearchCV\nparams = {  \n    \"n_estimators\": [50,100,500],      # Number of boosted trees to fit.\n    \"max_depth\": [1,2,3,4],            # Maximum tree depth for base learners.\n    \"learning_rate\": [0.01, 0.1],      # Boosting learning rate (xgb\u2019s \u201ceta\u201d)\n}","e0b0e188":"grid_lgb = GridSearchCV(model_lgb, param_grid=params, cv=cv, verbose=1, n_jobs=-1)","73281922":"grid_lgb.fit(X_train,y_train)","87e06c90":"model_performance(grid_lgb.best_estimator_,\"Light GBM\", X_train, y_train, cv)\n","46ad7c5a":"lgbm_auc = roc_auc_score(y_test,grid_lgb.predict(X_test))\nprint(\"AUC value is: \", lgbm_auc)","4d0d75b3":"plot_roc(y_test,grid_lgb.predict_proba(X_test), plot_micro = False, plot_macro= False);","a61d66e7":"lgb.plot_importance(grid_lgb.best_estimator_, max_num_features=5);","39082e56":"modelgb = grid_gb.best_estimator_","4f0cf430":"y_pred_gb=modelgb.predict(X_test)","3cc85070":"from sklearn.metrics import confusion_matrix\nconf_mat = confusion_matrix(y_test, y_pred_gb)\nsns.heatmap(conf_mat, annot=True, cmap='rocket_r')\nplt.title(label='Confusion Matrix GB Model')","fd80e9e3":"modelab = grid_ab.best_estimator_","83ecd4bd":"y_pred_ab=modelab.predict(X_test)","857a4af9":"conf_mat = confusion_matrix(y_test, y_pred_ab)\nsns.heatmap(conf_mat, annot=True, cmap='rocket_r')\nplt.title(label='Confusion Matrix AB Model')","54e7a02b":"from imblearn.over_sampling import RandomOverSampler\n\noversampler=RandomOverSampler(sampling_strategy='minority');\n\nX_train_os,y_train_os=oversampler.fit_resample(X_train,y_train);\n\nprint('training set:')\nprint(y_train_os.value_counts())\n\nprint('\\ntest set:')\nprint(y_test.value_counts())","2a7c7c17":"gb_os = GradientBoostingClassifier()\nmodel_performance(gb_os, \"GradientBoostingClassifier\", X_train_os, y_train_os, cv)","f9fa3940":"params_gb_os = {'n_estimators':[500, 1000] , \n             'learning_rate':[0.001, 0.001, 0.1],\n            'max_depth' : [1, 2, 3, 4]}\n\ngrid_gb_os = GridSearchCV(gb_os, param_grid=params_gb_os, cv=cv, verbose=1, n_jobs=3)","4e0e968e":"grid_gb_os.fit(X_train, y_train)","25f075b1":"model_performance(grid_gb_os.best_estimator_, \"GradientBoostingClassifier\", X_train_os, y_train_os, cv)","dccc7ff5":"plot_roc(y_test,grid_gb_os.predict_proba(X_test))","9d4b4770":"model_os = grid_gb_os.best_estimator_\nmodel_os","442ba632":"importances_os = model_os.feature_importances_\nimportances_os","f635b8b9":"\n\n# index variable\nindices = np.argsort(importances_os)[::-1]\n\n# fancy indexing.\nnames = X_model.columns[indices]\n\n# Plot\nplt.figure(figsize=(15,10))\n\n# Title\nplt.title(\"Feature Importance\")\n\n# Bars\nplt.bar(range(X_model.shape[1]), importances_os[indices],color='rrrggggggggggggggggggggggggggggggggggggggg')\n\n# Feature Names\nplt.xticks(range(X_model.shape[1]), names, rotation=90)\n\n# Show plot\nplt.show()","017ace27":"y_pred_gb_os = grid_gb_os.best_estimator_.predict(X_test)","e93785af":"conf_mat = confusion_matrix(y_test, y_pred_gb_os)\nconf_mat","eb08cfe3":"from sklearn.metrics import classification_report","e7b615b3":"print(classification_report(y_test, y_pred_gb_os))","eb5f38bf":"### 2.3 What about generations? <a class=\"anchor\" id=\"generations\"><\/a>","9d403eb0":"### 2.1 Attrition, Job Position and Education <a class=\"anchor\" id=\"education\"><\/a>","cd1a22d8":"## 1.0 Preliminar Work <a class=\"anchor\" id=\"Preliminar\"><\/a>\n------------------------------------------------\n","575d337a":"*An analysis based on IBM HR Dataset - Provided by kaggle.com*","f2a69aa2":"I will like to think that genre is not an important feature while we are studying the labor force (since all of us are equal). But the reality is we still having a long road to walk in the route of equality, so is important to compare an analyse some features between genres, to find inequities and develop plans to solve it.\nSome questions that I thought:\n\n\u00bfHow is the labor force distributed?\n\n\u00bfHow is the distribution of income and job positions?\n\n\u00bfAre there differences between men and women related with attrition?","75c75220":"## ROC Curve","38ef0e36":"## 3.0 Cluster Analysis<a class=\"anchor\" id=\"cluster\"><\/a>\n--------","5a1985a7":"# To be continued","2498438d":"## Content Table\n* [1.0 Preliminar Work](#Preliminar)\n    * [1.1 Importing Libraries](#Libraries)\n    * [1.2 Loading Dataset](#load)\n* [2.0 First Look at the Data](#first_look)\n    * [2.1 Attrition, Job Position and Education](#education)\n    * [2.2 Attrition and Temporal Features](#time)\n    * [2.3 What about generations?](#generations)\n    * [2.4 Gender Analysis](#gender)\n    * [2.5 Attrition and Job Features](#job)\n* [3.0 Cluster Analysis](#cluster)\n* [4.0 Predictive Model](#model)\n* [5.0 Oversampling](#oversampling)","e290316f":"Which Generation are You?\n\n\n|Generation Name | Births Start | Births End\t| Youngest Age | Oldest Age |\n| :-: | :-: | :-: | :-: | :-: |\n|The Silent Generation | 1928 | 1945 | 71 | 88 |\n|Baby Boomer | 1946 | 1964 | 52 | 70 |\n|Generation X | 1965 | 1980 | 36 | 51 |\n|Millenials | 1981 | 1999 | 17 | 35 |\n|Gen Z | 2000 | 2020 | 0 | 16 |\n\n(*age if still alive on 2016, year when the data was taken)","e12abed1":"### 2.2 Attrition and temporal features <a class=\"anchor\" id=\"time\"><\/a>","a4f5f5d3":"As we can see in the first subplots, in our dataset we have more people related with the **Research and Development Area**, with mid-high levels of educations, and they are from fields related with **Life Sciences and Medicine**.\nBut when we analyze the proportion of attrition in each category, we discover that the education level is not so important as the Education field or the Area. More people working in Sales or Human Resouces showed attrition, for example.\nBut as we know that we have less observations in the categories with high proportion of attrition, <mark style=\"background-color: lightblue\">we are not going to take fast conclussions<\/mark>.","b01f7a3e":"Comparing the attrition with temporal features, we could notice:\n\n**Total Working Years**: as we can imagine, we have 100% of attrition at the level of 40 total working years, maybe beacuse at that time, people start to retire.\nBut, we can also notice an intersting number of people who quit between the 0 and 5 total working years. Maybe we are talking about young proffesionals, who wants to adquire experience in different companies.","2971cc35":"After the analysis, we didn't see diferences between gender if we talk about income, job posittions or attrition. Instead of that, we see more men in positions like Laboratory, Sales, Human Resources and Research.\n\nSomething to take note, is that the proportion of women is less than men, in the total of employees. We don't have more information to make conclussions about that.","52a2e075":"## Predictive Model <a class=\"anchor\" id=\"model\"><\/a>\n-----------","9f2faaec":"### 2.5 Attrition and Job features <a class=\"anchor\" id=\"job\"><\/a>","d00e2d6a":"<img src='https:\/\/www.pointillist.com\/wp-content\/uploads\/2017\/11\/Running-4-the-Exit-2-844x422-800x400.png'>","b87521bb":"After the analysis with Silhouette Score and Square Distances, we decided to choose 3 clusters as the optimum to train our KMeans Model.","fda7284d":"Organizations are maded of people. Inside the company, we can find individuals with different backgrounds, experiences and  with different objetives. \nSometimes, what the individual wants for him or her career, is aligned with the organization objetives. In that case, the individual is able to pursuit his personal objetive, while following the organization one.\nIn other times, the organizational objetive is not aligned with the individual one, so he or she may enter in an internal conflict.\n\nSince organizations are **people** working following a main objetive, is not crazy to affirm that they are the **most valuable** asset. People working in different possitions, add value while working, and sometimes they are the visible face of the bussiness.\n\nWhen someone enter in a company, is needed to spend time in a good onboarding, trainings, and development of him or her skills. It's a big investment, and sometimes is not seen as that. Because of that, when an employee decide to **quit**, it's a **double loss**: social and economical... so it is really important to understand the main causes, and think in solutions to avoid lose our best employees.\n\nThe **new paradigm** in organizations, include people from different ages and way of thinking working side by side, new knowledge and technology, new ways of work (presential, remote, etc), and a fast enviroment never seen before.\nIf you want, I invite you to follow me in this trip, triying to get the first insights about **\"Why people left their jobs?\"**, and think in ways to don't lose our main value.","13aa806a":"### 1.2 Loading the Dataset <a class=\"anchor\" id=\"load\"><\/a>\n","a82bcb66":"#### Generation of Dummies Variables","ec39d341":"With the objetive of getting more insights about our staff, we are going to develop a no supervized ML Model, with Kmeans.\nWe want to analyze if there are common patters between employees and Age, Income, and Career.\nBefore to train the model, we created a new feature related with the time since last promotion, as a ratio of total years at company.","d99b6d4c":"## Confussion Matrix","4f17d826":"### 2.4 Gender Analysis <a class=\"anchor\" id=\"gender\"><\/a>","07f5ee35":"## 5.0 Oversampling <a class=\"anchor\" id=\"oversampling\"><\/a>\n----------------------------------------------","3ecef7ff":"## LightGBM Model","5adeb4a9":"As we can see in the graph, we have three different clusters, represented by:\n\n\n|Cluster|Color|Meaning|\n| :-: | :-: | :-: |\n|Cluster 1| Purple| People from different ages, with low monthly income and a low promotion ratio*.|\n|Cluster 2| Green | People from different ages, with low montlhy income and high promotion ratio.|\n|Cluster 3| Yellow| People with higher age, good income and different promotion ratios.|\n\n<mark style=\"background-color: lightblue\">Cluster 1<\/mark>, could be related with people who is building their careers. So, they have benn promoted recently, but they still having low income. With that cluster, we may focus in the satisfaction with the new rol, and with the new knowledge.\n\n<mark style=\"background-color: lightblue\">Cluster 2<\/mark>, keeps people with low income and with a high promotion ratio, what it means that they hadn't been promoted since a long time. We must pay attention here, and take notes about their feelings related with the enviroment, company, etc. because they may be unmotivated or not happy with their situation.\n\n<mark style=\"background-color: lightblue\">Cluster 3<\/mark>, with people from higher ages and good salary. They could be managers or directors, with a lot of expertice and knowledge about the bussines. The risk here, is to keep them motivated with new challanges, because if they left we may lost a lot of gained knowledge.\n\n*A low promotion ratio implies that someone has been promoted recently.","60cbe7f1":"As we could see, our dataset has <mark style=\"background-color: lightblue\"> 1470 <\/mark>rows , <mark style=\"background-color: lightblue\">35 <\/mark>columns, and <mark style=\"background-color: lightblue\">0<\/mark> null values","24b49de0":"Before to develop our model, we a\nre going to make a **descriptive analysis** trying to get insights about the main causes of attrition in our personal","eaf789b7":"### 1.1 Importing Libraries <a class=\"anchor\" id=\"Libraries\"><\/a>\n","f27118ae":"## 2.0 First look at the Data <a class=\"anchor\" id=\"first_look\"><\/a>\n-------------------------------------------","99dfcc99":"Split the dataset between train and test","fab8c790":"# What about the Attrition?","fc19c62c":"## Feature Importance"}}