{"cell_type":{"fcf6f109":"code","917cc7dd":"code","861d493a":"code","7d3cedbc":"code","980e2354":"code","12839c63":"code","690c4a9c":"code","ecfca519":"code","377b72a9":"code","e7608f34":"code","82d3eadf":"code","8cbce613":"code","b32338f0":"code","55ba947b":"code","3187068e":"markdown","d04e850b":"markdown","b6498976":"markdown","28912e56":"markdown","45e496b9":"markdown","0c42260c":"markdown","783ca667":"markdown","de1e50b3":"markdown","301676b7":"markdown","fd602fe4":"markdown"},"source":{"fcf6f109":"!pip install torch torchvision feather-format kornia pyarrow --upgrade   > \/dev\/null\n!pip install git+https:\/\/github.com\/fastai\/fastai_dev             > \/dev\/null","917cc7dd":"from fastai2.basics import *\nfrom fastai2.medical.imaging import *","861d493a":"path = Path('..\/input\/rsna-intracranial-hemorrhage-detection\/')","7d3cedbc":"path_trn = path\/'stage_1_train_images'\nfns_trn = path_trn.ls()\nfns_trn[:5].attrgot('name')","980e2354":"path_tst = path\/'stage_1_test_images'\nfns_tst = path_tst.ls()\nlen(fns_trn),len(fns_tst)","12839c63":"fn = fns_trn[0]\ndcm = fn.dcmread()\ndcm","690c4a9c":"def save_lbls():\n    path_lbls = path\/'stage_1_train.csv'\n    lbls = pd.read_csv(path_lbls)\n    lbls[[\"ID\",\"htype\"]] = lbls.ID.str.rsplit(\"_\", n=1, expand=True)\n    lbls.drop_duplicates(['ID','htype'], inplace=True)\n    pvt = lbls.pivot('ID', 'htype', 'Label')\n    pvt.reset_index(inplace=True)    \n    pvt.to_feather('labels.fth')","ecfca519":"save_lbls()","377b72a9":"df_lbls = pd.read_feather('labels.fth').set_index('ID')\ndf_lbls.head(8)","e7608f34":"df_lbls.mean()","82d3eadf":"del(df_lbls)\nimport gc; gc.collect();","8cbce613":"%time df_tst = pd.DataFrame.from_dicoms(fns_tst, px_summ=True)\ndf_tst.to_feather('df_tst.fth')\ndf_tst.head()","b32338f0":"del(df_tst)\ngc.collect();","55ba947b":"%time df_trn = pd.DataFrame.from_dicoms(fns_trn, px_summ=True)\ndf_trn.to_feather('df_trn.fth')","3187068e":"There is one corrupted DICOM in the competition data, so the command above prints out the information about this file. Despite the error message show above, the command completes successfully, and the data from the corrupted file is not included in the output DataFrame.","d04e850b":"It's really handy to have all the DICOM info available in a single DataFrame, so let's create that! In this notebook, we'll just create the DICOM DataFrames. To see how to use them to analyze the competition data, see [this followup notebook](https:\/\/www.kaggle.com\/jhoward\/some-dicom-gotchas-to-be-aware-of-fastai).\n\nFirst, we'll install the latest versions of pytorch and fastai v2 (not officially released yet) so we can use the fastai medical imaging module.","b6498976":"# Labels","28912e56":"Let's take a look at what files we have in the dataset.","45e496b9":"To turn the DICOM file metadata into a DataFrame we can use the `from_dicoms` function that fastai v2 adds. By passing `px_summ=True` summary statistics of the image pixels (mean\/min\/max\/std) will be added to the DataFrame as well (although it takes much longer if you include this, since the image data has to be uncompressed).","0c42260c":"Before we pull the metadata out of the DIMCOM files, let's process the labels into a convenient format and save it for later. We'll use *feather* format because it's lightning fast!","783ca667":"Most lists in fastai v2, including that returned by `Path.ls`, are returned as a [fastai.core.L](http:\/\/dev.fast.ai\/core.html#L), which has lots of handy methods, such as `attrgot` used here to grab file names.","de1e50b3":"There's not much RAM on these kaggle kernel instances, so we'll clean up as we go.","301676b7":"# DICOM Meta","fd602fe4":"We can grab a file and take a look inside using the `dcmread` method that fastai v2 adds."}}