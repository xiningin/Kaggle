{"cell_type":{"77f95aae":"code","e4ee2351":"code","346743e8":"code","12be27d7":"code","fd0013fc":"code","b4578ece":"code","d0a6fa17":"code","1d693b2e":"code","5e9b7024":"code","a04a44a7":"code","40aafc10":"code","044ff2f9":"code","ba1f1223":"code","d4455620":"code","2a83f2d5":"code","5ee9028d":"code","7a4164c9":"code","0153b2f2":"code","9b507836":"code","37845ef9":"code","fc90eb3d":"code","61d3a852":"code","66f9e0bb":"code","7badb702":"code","7892f8d4":"markdown","00d26e27":"markdown","1906f389":"markdown","749b4bcd":"markdown","abf75ab4":"markdown","cb66a575":"markdown","02e54444":"markdown","a110d53f":"markdown","7cb5e7b1":"markdown","bda1cff4":"markdown","a6525189":"markdown","cf2529ff":"markdown","c6c96a69":"markdown","4c228b8e":"markdown","62ed3708":"markdown","408d6a59":"markdown"},"source":{"77f95aae":"import pandas as pd \nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport scipy ","e4ee2351":"dados = pd.read_csv('..\/input\/ab-testing\/ab_data.csv')\ndados.head()","346743e8":"dados.shape","12be27d7":"dados.info()","fd0013fc":"#separando os usu\u00e1rios de cada grupo que viu cada p\u00e1gina.\ndados.groupby(['group', 'landing_page']).count()","b4578ece":"#Filtrando somente os usu\u00e1rios que est\u00e3o de acordo para nossa an\u00e1lise\ndados_1 = dados.loc[(dados.group == 'control') & (dados.landing_page == 'old_page')\n                   | (dados.group == 'treatment') & (dados.landing_page == 'new_page')]","d0a6fa17":"#verificando \ndados_1.groupby(['group','landing_page']).count()","1d693b2e":"dados_1.shape[0] == dados_1.user_id.nunique()  #False indica que h\u00e1 valores repetidos. Quantos?","5e9b7024":"dados_1.shape[0] - dados_1.user_id.nunique()\n#significa que h\u00e1 usu\u00e1rios acessaram mais de uma vez.","a04a44a7":"# Encontrando o valor duplicado\ndados_1[dados_1.duplicated(['user_id'], keep=False)]['user_id']","40aafc10":"#buscando o usu\u00e1rio\ndados_1[dados.user_id == 773192]","044ff2f9":"dados_1 = dados.drop_duplicates(subset='user_id',keep='first')","ba1f1223":"grupos = dados_1.groupby(['group','landing_page','converted']).size()\ngrupos","d4455620":"plt.figure(figsize=(10,8))\ngrupos.plot.bar(color='grey')\n\n","2a83f2d5":"#verificando se a propor\u00e7\u00e3o em cada grupo \u00e9 similar, isto \u00e9, se a amostra est\u00e1 balanceada. \n#Amostras desbalanceadas podem levar a enviesamento dos dados, por isso \u00e9 importante ter uma representividade semelhante.\ndados_1['landing_page'].value_counts().plot(kind='pie', colors=['grey','silver'])","5ee9028d":"#taxa de convers\u00e3o\nconversao = pd.DataFrame(dados.converted.value_counts()\/dados.shape[0] *100)\nconversao","7a4164c9":"plt.figure(figsize=(10,8))\n\nplt.rcParams['font.sans-serif'] = 'Arial'\nplt.rcParams['font.family'] = 'sans-serif'\nplt.rcParams['text.color'] = 'b'\nplt.rcParams['font.size']=20\n\ncores = [ 'silver','gray']\n\npercentages = list(conversao.converted)\nexplode=(0.1,0)\nlabels = ['N\u00e3o comprou','Comprou']\nplt.pie(percentages, explode=explode, \n       labels=labels,\n       colors = cores,\n       autopct='%1.0f%%',\n       shadow=True, startangle=0,   \n       pctdistance=0.5,labeldistance=1.1)\nplt.title(\"Taxa de convers\u00e3o\", fontsize=20, pad=20)\n","0153b2f2":"conversao_control = pd.DataFrame(dados_1[dados_1.group == 'control']['converted'].value_counts())\nconversao_control['percentual'] = conversao_control.converted\/ (conversao_control.converted.sum()) *100\nconversao_control","9b507836":"conversao_treat = pd.DataFrame(dados_1[dados_1.group == 'treatment']['converted'].value_counts())\nconversao_treat['percentual'] = conversao_treat.converted\/ (conversao_treat.converted.sum()) *100\nconversao_treat","37845ef9":"fig, (axis1, axis2, axis3) = plt.subplots(1,3, figsize=(30,8))\n\nplt.figure(figsize=(10,8))\nax = sns.barplot(x=conversao_control.index, y=\"percentual\", data=conversao_control, ax=axis1, palette = 'Blues_r')\nax.set_title(\"Convers\u00e3o do Grupo de Controle\", fontsize=25,pad=20)\nax.set_xlabel('Status', fontsize=15)\nax.set_ylabel('%', fontsize=15)\nax.set_xticklabels(labels=['N\u00e3o Comprou', 'Comprou'])\nplt.tight_layout()\n\nplt.figure(figsize=(10,8))\nax = sns.barplot(x=conversao_treat.index, y=\"percentual\", data=conversao_treat, ax=axis2, palette = 'Greens_r')\nax.set_title(\"Convers\u00e3o do Grupo de Experimento\", fontsize=25,pad=20)\nax.set_xlabel('Status', fontsize=15)\nax.set_ylabel('%', fontsize=15)\nax.set_xticklabels(labels=['N\u00e3o Comprou', 'Comprou'])\nplt.tight_layout()\n\nplt.figure(figsize=(10,8))\nax = sns.barplot(x=conversao.index, y=\"converted\", data=conversao, ax=axis3, palette = 'Oranges')\nax.set_title(\"Convers\u00e3o Geral\", fontsize=25,pad=20)\nax.set_xlabel('Status', fontsize=15)\nax.set_ylabel('%', fontsize=15)\nax.set_xticklabels(labels=['N\u00e3o Comprou', 'Comprou'])\nplt.tight_layout()\n","fc90eb3d":"dados_1","61d3a852":"tabela_chi = pd.crosstab(dados_1.landing_page,\n                           dados.converted, normalize=False)\n\ntabela_chi\n\n#podemos usar tando a landing_page como o grupo j\u00e1 que eles est\u00e3o relacionados ao grupo de controle e ao experimento.","66f9e0bb":"from scipy.stats import chi2_contingency\n","7badb702":"chi_2, p_value, gol,frequencia = scipy.stats.chi2_contingency(tabela_chi,correction=False)\n\n# selecionando o n\u00edvel de signific\u00e3ncia que por conven\u00e7\u00e3o \u00e9 0,05\nalfa = 0.05\n# Aceita ou rejeita H0?\nprint('signific\u00e2ncia=%.2f, p_value=%.2f, chi_2=%.2f' % (alfa, p_value,chi_2))\nif p_value >= alfa:\n    print('N\u00e3o h\u00e1 diferen\u00e7as entre as p\u00e1ginas,as vari\u00e1veis s\u00e3o homog\u00eaneas. (aceitamos H0)')\nelse:\n    print('H\u00e1 ind\u00edcios de que a convers\u00e3o nas p\u00e1ginas \u00e9 diferente, as vari\u00e1veis s\u00e3o heterog\u00eaneas\"  (rejeitamos H0 e aceitamos H1)')","7892f8d4":"## Tratamento dos dados\n\n \n \n","00d26e27":"## Teste Chi-Quadrado\n\nA fun\u00e7\u00e3o chi_contingence da biblioteca retorna 4 valores: chi_2, p_value, graus de liberdade e frequ\u00eancia esperada.\n\n[Biblioteca](https:\/\/docs.scipy.org\/doc\/scipy\/reference\/generated\/scipy.stats.chi2_contingency.html)","1906f389":"## a) Verificando se usu\u00e1rios do grupo de controle viram a nova p\u00e1gina e vice versa\n\nNo Teste A|B \u00e9 importante a independ\u00eancia e n\u00e3o interfer\u00eancia entre os grupos, por isso, removeremos os dados dos usu\u00e1rios do grupo de controle que entraram na nova p\u00e1gina e vice-versa.","749b4bcd":"O dataset possui 5 colunas e 294478 linhas.\nNenhum valor nulo. \nA vari\u00e1vel Id \u00e9 num\u00e9rica, mas \u00e9 s\u00f3 de identifica\u00e7\u00e3o e precisa ser verificada se h\u00e1 valores repetidos.\nA vari\u00e1vel converted \u00e9 bin\u00e1ria e significa se o usu\u00e1rio realizou a a\u00e7\u00e3o (1) ou n\u00e3o (0).\nO teste \u00e9 realizado ecom 2 grupos: control e treatment em duas p\u00e1ginas(landing-page)- a nova e a antiga.","abf75ab4":"# Explorando e conhecendo os dados","cb66a575":"## Rearranjando os dados em uma tabela 2x2 para aplicarmos o Chi-Quadrado.","02e54444":"Tal resultado significa que n\u00e3o h\u00e1 diferen\u00e7as estat\u00edsticas nas convers\u00f5es da pagina antiga e a p\u00e1gina nova. ","a110d53f":"### Taxa de convers\u00e3o geral","7cb5e7b1":"## b) Dados repetidos\nVerificaremos de h\u00e1 usu\u00e1rios repetidos pelo Id, \u00e9 comum usu\u00e1rios retornar a p\u00e1gina mais de uma vez antes de realizar uma compra, por exemplo, ele pode pesquisar em dispositivos diferentes, mostrar para algu\u00e9m para aprova\u00e7\u00e3o, comparar valores em outros sites e tomar a decis\u00e3o de compra em outro momento.","bda1cff4":"# Teste A|B, A|B Testing, Split Testing\nTeste A|B \u00e9 um teste  que divide o acesso a uma p\u00e1gina online ou produto em duas vers\u00f5es diferentes, A(controle) e B(experimento), e depois mede-se a taxa de convers\u00e3o que podem ser  vendas, clicks, prefer\u00eancia, compartilhamentos entre outras. As diferen\u00e7as nas p\u00e1ginas\/produtos podem ser em cores, bot\u00f5es, chamadas para a\u00e7\u00e3o ou serem totalmente diferentes mas com o mesmo objetivo. \n\nSuas aplica\u00e7\u00f5es s\u00e3o comuns em e-commerce e an\u00fancios como Google Ads, Redes Sociais, email marketing e landing pages. Tamb\u00e9m \u00e9 usado na ind\u00fastria para lan\u00e7amento de vers\u00f5es produtos para avaliar cores, tamanho e forma.. Mesmo com apar\u00eancia simples n\u00e3o \u00e9 f\u00e1cil encontrar vari\u00e1veis estat\u00edsticamente relevantes  para o experimento, isto \u00e9, \u00e9 necess\u00e1rio grande quantidade de dados e tempo para rodar o teste, neste artigo melhor detalhado o uso dos Testes A|B:[O que \u00e9 Teste A|B.](https:\/\/resultadosdigitais.com.br\/blog\/o-que-e-teste-ab\/)\n\nEmbora possa parecer simples deve ser cuidadosamente projetado para obter resultados conclusivos e evitar enviesamento como descrito nest artigo em ingl\u00eas [7 A\/B Testing Questions and Answers in Data Science Interviews](http:\/\/https:\/\/towardsdatascience.com\/7-a-b-testing-questions-and-answers-in-data-science-interviews-eee6428a8b63), que faz um apanhado da teoria do Teste A|B como quest\u00f5es de entrevista de emprego.\n\n\n- Para aprofundar no assunto super recomendo o podcast hipsters tech com o time da NetShoes e o material da p\u00e1gina. Voc\u00ea pode acessar [aqui.](https:\/\/hipsters.tech\/testes-ab-hipsters-59\/).\n\n- [Experiments at Airbnb](https:\/\/medium.com\/airbnb-engineering\/experiments-at-airbnb-e2db3abf39e7) - Um estudo de caso do Airbnb que mostra as armadilhas do Teste A|B e como evitar.\n- [What is A|B Testing?](https:\/\/www.momentcrm.com\/blog\/what-is-ab-testing\/)\n- [5 Common Threats to Your A\/B Test\u2019s Validity](https:\/\/instapage.com\/blog\/validating-ab-tests)\n- [A\/B Testing Statistics: An Easy-to-Understand Guide](https:\/\/cxl.com\/blog\/ab-testing-statistics\/)","a6525189":"O usu\u00e1rio do grupo de controle entrou duas vezes e n\u00e3o comprou em nenhuma delas. Para simplificar manteremos somente o primeiro registro.\nNote que nossa decis\u00e3o seria diferente no caso do usu\u00e1rio tivesse comprado.","cf2529ff":"# Explorando os dados - EDA","c6c96a69":"# Taxa de Convers\u00e3o","4c228b8e":"Visualmente n\u00e3o d\u00e1 para notar muitas diferen\u00e7as nos grupos, parecem que se comportam do mesmo modo. E estat\u00edsticamente?\nSe voc\u00ea leu os artigos recomendados anteriormente, perceber\u00e1s que esse tipo de situa\u00e7\u00e3o \u00e9 mais comum do que se imagina por isso o Teste A|B \u00e9 t\u00e3o importante.","62ed3708":"### Taxa de convers\u00e3o dos grupos\nCompareremos a taxa de convers\u00e3o dos grupos em gr\u00e1fico de barras.","408d6a59":"# Teste A|B com Chi-quadrado\n\nChi-Quadrado, tamb\u00e9m conhecido como coeficiente de Pearson \u00e9 um teste estat\u00edstico para comparar duas vari\u00e1veis categ\u00f3ricas, independentes entre com pelo menos 5 observa\u00e7\u00f5es. O teste verifica se as vari\u00e1veis s\u00e3o homog\u00eaneas entre si.\n\nA interpreta\u00e7\u00e3o \u00e9 realizada por meio de compara\u00e7\u00e3o com o p-value que , por conven\u00e7\u00e3o,abaixo de 0,05 h\u00e1 evid\u00eancias de diferen\u00e7as entre os grupos e acima disso n\u00e3o h\u00e1 diferen\u00e7as significativas.\n\n0. *H0* ou Hip\u00f3tese nula - n\u00e3o h\u00e1 fiferen\u00e7a estatistica entre as vari\u00e1veis, p > 0,05.\n1. *H1* ou Hip\u00f3tese Alternativa - H\u00e1 diferen\u00e7a esstat\u00edstica entre as vari\u00e1veis, p < 0,05.\n\nAbaixo deixo 1 artigo em portugu\u00eas e 3 em ingl\u00eas para melhor compreens\u00e3o do assunto. Vale a pena a leitura!\n\n[Teste Chi Quadrado de Pearson: um guia completo](https:\/\/sosestatistica.com.br\/teste-chi-quadrado-pearson\/#:~:text=O%20teste%20Chi%20Quadrado%20de,%C3%972%20(ou%20maiores).)\n\n[Chi-Squared Test for Feature Selection with implementation in Python](https:\/\/towardsdatascience.com\/chi-squared-test-for-feature-selection-with-implementation-in-python-65b4ae7696db)\n\n\n[The Chi-Squared Test Statistic is a Must For Every Data Scientist: A Case Study in Customer Churn](https:\/\/towardsdatascience.com\/the-chi-squared-test-statistic-is-a-must-for-every-data-scientist-a-case-study-in-customer-churn-bcdb17bbafb7)\n\n[Ace the Interview: Chi-Squared Test](https:\/\/towardsdatascience.com\/ace-the-interview-the-chi-squared-test-e6d37f681ea4)\n\n"}}