{"cell_type":{"fbc79bf6":"code","6e026053":"code","15e5a9ea":"code","ba76320c":"code","70f3e150":"code","5182623a":"code","0a9af811":"code","ccb27184":"code","e036793a":"code","38ca0697":"code","b4a787a7":"code","bad8ddc5":"code","72f63e31":"code","41354ccc":"code","2befde2e":"code","dab34800":"code","e100e305":"code","072978e6":"code","53d83ba3":"code","39eeaed7":"code","f77e8e2f":"code","08e5d2ed":"code","806be0af":"code","e200e622":"markdown","c8989ca7":"markdown","6a72d13c":"markdown"},"source":{"fbc79bf6":"!ls ..\/input\n!ls ..\/input\/*","6e026053":"#importing libraries\nfrom PIL import Image\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.preprocessing import RobustScaler\nfrom sklearn.ensemble import RandomForestRegressor","15e5a9ea":"image = Image.open(\"..\/input\/kingcountyimage\/Screen Shot 2019-10-18 at 1.36.04 PM.png\")\n#Just a screenshot from Google maps\nimage = np.array(image)","ba76320c":"df = pd.read_csv(\"..\/input\/housesalesprediction\/kc_house_data.csv\")\nprint(\"Dataset length: \" + str(len(df)))\ndf.head()","70f3e150":"df.describe()","5182623a":"print(df.columns.values)\nlow = df[\"price\"] < 500000\nhigh = df[\"price\"] > 500000\nlong = df[\"long\"][high].mean()\nlat = df[\"lat\"][high].mean()","0a9af811":"ids = df[\"id\"]\ndf.drop(columns=[\"id\"],inplace=True)","ccb27184":"f,axs = plt.subplots(1,2,figsize=(24,7))\ntomato = \"#FF6347\"\naxs[0].scatter(df[\"long\"],df[\"lat\"],alpha=0.05,c=low,cmap=\"flag\")\naxs[0].set_title(\"Dataset Distribution\")\naxs[0].scatter([[long]],[lat],c=\"y\",s=200)\naxs[1].imshow(image)\naxs[1].set_title(\"Map\")\nplt.show()\n#red is high value (above averge) houses","e036793a":"%timeit df[\"dis\"] = np.sqrt((df[\"long\"] - long) ** 2 + (df[\"lat\"] - lat) ** 2)\n#cheaper houses are further from the center\ndf[high][\"dis\"].mean(), df[low][\"dis\"].mean()","38ca0697":"%timeit df[\"date\"] = pd.to_datetime(df[\"date\"],format=\"%Y%m%dT000000\")\nprint(\"Min Date: {}\\nMax Date: {}\".format(df[\"date\"].min(),df[\"date\"].max()))","b4a787a7":"plt.scatter(df[\"dis\"],df[\"price\"],alpha=0.3,color=tomato)\nplt.show()","bad8ddc5":"df[[\"sqft_lot\",\"sqft_living\",\"sqft_lot15\",\"sqft_above\",\"sqft_basement\"]].describe()","72f63e31":"f,axs = plt.subplots(1,2,figsize=(20,8))\naxs[0].hist(df[\"sqft_lot\"],color=tomato,bins=50)\naxs[0].set_title(\"sqft_lot\")\naxs[1].hist(df[\"sqft_lot15\"],color=tomato,bins=50)\naxs[1].set_title(\"sqft_lot15\")\nplt.show() #(they are definitely not the same thing though)","41354ccc":"corr_mat = df.corr()\nabs(corr_mat[\"price\"]).sort_values(ascending=False)","2befde2e":"plt.figure(figsize=(20,8))\nsns.boxplot(df[\"condition\"],df[\"price\"])\nplt.title(\"Condition\")\nplt.figure(figsize=(20,8))\nsns.boxplot(df[\"floors\"],df[\"price\"])\nplt.title(\"Floors\")\nplt.show()","dab34800":"time = df.sort_values(by=\"date\")\nplt.figure(figsize=(30,12))\nplt.plot(time[\"date\"],time[\"price\"],color=tomato)\nplt.show()","e100e305":"#the \"dis\" feature has a stronger correlation with \"price\" than longitude or latitude\ndf = df.sort_values(by=\"date\")\ndf_c = df.copy()\ndf.drop(columns=[\"long\",\"lat\",\"zipcode\",\"yr_built\",\"sqft_lot\",\"sqft_lot15\",\"date\"],inplace=True)","072978e6":"df.nunique().sort_values(ascending=False)","53d83ba3":"y = df[\"price\"].copy()\ndf.drop(columns=[\"price\"],inplace=True)\nX = df.copy()","39eeaed7":"scaler = RobustScaler()\nX = scaler.fit_transform(X)","f77e8e2f":"train_X,test_X = X[:-2000],X[-2000:]\ntrain_y,test_y = y[:-2000],y[-2000:]\nprint(\"Train size: {}\\nTest size : {}\".format(train_X.shape,test_X.shape))","08e5d2ed":"forest = RandomForestRegressor(min_samples_leaf=3,random_state=42)\nforest.fit(train_X,train_y)","806be0af":"from sklearn.metrics import mean_absolute_error,mean_squared_error\npreds = forest.predict(test_X)\npreds_train = forest.predict(train_X)\n#This is not a bad result, since the other kernels I looked at only achieved 150000 RMSE\n#I did not fine tune the model but I imagine the score will be better after fine tuning\nprint(\"Test:\\nMSE : {:.5f}\\nRMSE: {:.5f}\\nMAE : {:.5f}\\n\".format(mean_squared_error(test_y,preds),mean_absolute_error(test_y,preds),np.sqrt(mean_squared_error(test_y,preds))))\nprint(\"Train:\\nMSE : {:.5f}\\nRMSE: {:.5f}\\nMAE : {:.5f}\".format(mean_squared_error(train_y,preds_train),mean_absolute_error(train_y,preds_train),np.sqrt(mean_squared_error(train_y,preds_train))))","e200e622":"<h5>There doesn't seem to be any direct correlation<\/h5>","c8989ca7":"<h5>Most high value housing are centered around the Redmond region (centered around the yellow point)<\/h5>","6a72d13c":"<h5>Final Score: 106907 (RMSE)<\/h5>"}}