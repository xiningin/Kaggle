{"cell_type":{"f2881370":"code","fa0f1619":"code","4c60315b":"code","9e4f2e20":"code","5e2c140f":"code","efaabb27":"code","e72090fa":"code","7b18a2f0":"code","c061f07f":"code","32635cdc":"code","2e001826":"code","d0dcaa4c":"code","2c854cea":"code","33b62e1a":"code","fa934ca5":"code","4b027e11":"markdown","bda5accf":"markdown","ab4ca838":"markdown","34035d9a":"markdown","a12b1965":"markdown","14bef8dd":"markdown","f8a371f8":"markdown","d1e3a22b":"markdown","62566f85":"markdown","d22af1cd":"markdown","8de8c6fc":"markdown","2f11f2d9":"markdown","c1d55473":"markdown"},"source":{"f2881370":"!pip install -U lightautoml","fa0f1619":"# Standard python libraries\nimport logging\nimport os\nimport time\nimport requests\nlogging.basicConfig(format='[%(asctime)s] (%(levelname)s): %(message)s', level=logging.INFO)\n\n# Installed libraries\nimport numpy as np\nimport pandas as pd\nfrom sklearn.metrics import mean_absolute_error\nfrom sklearn.model_selection import train_test_split\nimport torch\n\n# Imports from our package\nfrom lightautoml.automl.presets.tabular_presets import TabularAutoML, TabularUtilizedAutoML\nfrom lightautoml.tasks import Task","4c60315b":"N_THREADS = 4 # threads cnt for lgbm and linear models\nN_FOLDS = 5 # folds cnt for AutoML\nRANDOM_STATE = 42 # fixed random state for various reasons\nTEST_SIZE = 0.2 # Test size for metric check\nTIMEOUT = 3600 # Time in seconds for automl run - UPDATED VALUE FOR UTILIZATION\nTARGET_NAME = 'final_price' # Target column name","9e4f2e20":"%%time\n\ntrain_data = pd.read_csv('..\/input\/lightautomlcourse-hw1\/train_data.csv')\ntrain_data.head()","5e2c140f":"test_data = pd.read_csv('..\/input\/lightautomlcourse-hw1\/test_data.csv')\ntest_data.head()","efaabb27":"submission = pd.read_csv('..\/input\/lightautomlcourse-hw1\/sample_submission.csv')\nsubmission.head()","e72090fa":"%%time\n\ndef create_expert_feats(data):\n    pass\n\ncreate_expert_feats(train_data)\ncreate_expert_feats(test_data)","7b18a2f0":"train_data.head()","c061f07f":"%%time\n# COMPETITION METRIC IS MAE SO WE SET IT FOR OUR TASK\ntask = Task('reg', loss='mae', metric='mae')","32635cdc":"%%time\n\nroles = {'target': TARGET_NAME,\n         'drop': ['row_ID']\n         }","2e001826":"%%time \n# CHANGED TabularAutoML to TabularUtilizedAutoML for timeout utilization\nautoml = TabularUtilizedAutoML(task = task, \n                       timeout = TIMEOUT,\n                       cpu_limit = N_THREADS,\n                       general_params = {'use_algos': [['linear_l2', 'lgb', 'lgb_tuned']]},\n                       reader_params = {'n_jobs': N_THREADS, 'cv': N_FOLDS, 'random_state': RANDOM_STATE},\n                      )\noof_pred = automl.fit_predict(train_data, roles = roles)\nlogging.info('oof_pred:\\n{}\\nShape = {}'.format(oof_pred, oof_pred.shape))","d0dcaa4c":"%%time\n\n# Fast feature importances calculation\nfast_fi = automl.get_feature_scores('fast')\nfast_fi.set_index('Feature')['Importance'].plot.bar(figsize = (20, 10), grid = True)","2c854cea":"%%time\n\ntest_pred = automl.predict(test_data)\nlogging.info('Prediction for test data:\\n{}\\nShape = {}'\n              .format(test_pred, test_pred.shape))\n\nlogging.info('Check scores...')\nlogging.info('OOF score: {}'.format(mean_absolute_error(train_data[TARGET_NAME].values, oof_pred.data[:, 0])))","33b62e1a":"submission[TARGET_NAME] = test_pred.data[:, 0]\nsubmission.head()","fa934ca5":"submission.to_csv('lightautoml_better_baseline.csv', index = False)","4b027e11":"## Step 3. Create AutoML from preset","bda5accf":"Still not creative :)","ab4ca838":"# Step 0.4. Some user feature preparation ","34035d9a":"# Step 0.0. Install LightAutoML","a12b1965":"# Step 0.1. Import necessary libraries ","14bef8dd":"To create AutoML model here we use `TabularAutoML` preset, which looks like:\n\n![TabularAutoML preset pipeline](https:\/\/github.com\/sberbank-ai-lab\/LightAutoML\/raw\/master\/imgs\/tutorial_2_pipeline.png)\n\nAll params we set above can be send inside preset to change its configuration:","f8a371f8":"## Step 5. Generate submission","d1e3a22b":"Roles setup here set target column and base date, which is used to calculate date differences:","62566f85":"## Step 4. Predict to test data and check scores","d22af1cd":"# ========= AutoML preset usage =========\n\n\n## Step 1. Create Task","8de8c6fc":"# Step 0.2. Parameters ","2f11f2d9":"# Step 0.3. Data load ","c1d55473":"## Step 2. Setup columns roles"}}