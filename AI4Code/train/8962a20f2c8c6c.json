{"cell_type":{"e4562d50":"code","9904c970":"code","d13f38a1":"code","2495c5cd":"code","59081416":"code","99269886":"code","fbea3019":"code","94e348a9":"code","be27595f":"code","8b76589d":"code","98b65358":"code","7b78e8f4":"code","8004ca4e":"code","d177c14b":"code","abafa8e0":"code","48f3aaa7":"code","d6b98697":"code","ed661dcb":"code","c5430e33":"markdown","389cb5c4":"markdown","2dabce82":"markdown","981b7595":"markdown","d604419f":"markdown","93486e11":"markdown","eb8d357e":"markdown","34246552":"markdown","a957677a":"markdown","37ed07ae":"markdown","89724008":"markdown","1da5236b":"markdown"},"source":{"e4562d50":"import warnings\nwarnings.filterwarnings('ignore')\n\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set_style('whitegrid')\n\nfrom fbprophet import Prophet\nfrom fbprophet.plot import add_changepoints_to_plot\n\nfrom dask.distributed import Client\nfrom fbprophet.diagnostics import cross_validation\n\nfrom fbprophet.diagnostics import performance_metrics\nfrom fbprophet.plot import plot_cross_validation_metric","9904c970":"ticket =pd.read_csv('..\/input\/cinema-ticket\/cinemaTicket_Ref.csv', usecols = ['total_sales', 'date'])\nticket['date'] = pd.to_datetime(ticket['date'], errors='coerce')\nticket","d13f38a1":"ticket.info()","2495c5cd":"ticket.describe(include = 'all')","59081416":"total_sales = ticket.copy()\ntotal_sales.columns = ['y', 'ds']\ntotal_sales","99269886":"plt.figure(figsize = (18,6))\nsns.lineplot(data=total_sales, x=\"ds\", y=\"y\")\nplt.title('Total Sales')\nplt.show()","fbea3019":"m1 = Prophet()\nm1.fit(total_sales)","94e348a9":"future1 = m1.make_future_dataframe(periods=150,freq='D')\nforecast1 = m1.predict(future1)\nforecast1[['ds', 'yhat_lower', 'yhat_upper', 'yhat']]","be27595f":"fig_fcast1 = m1.plot(forecast1)","8b76589d":"m2 = Prophet(seasonality_mode='multiplicative')\nm2.fit(total_sales)","98b65358":"future2 = m2.make_future_dataframe(periods=150,freq='D')\nforecast2 = m2.predict(future2)\nforecast2[['ds', 'yhat_lower', 'yhat_upper', 'yhat']]","7b78e8f4":"fig_fcast2 = m2.plot(forecast2)","8004ca4e":"fig_trend1 = m1.plot(forecast1)\na = add_changepoints_to_plot(fig_trend1.gca(),m1,forecast1)","d177c14b":"fig_trend2 = m2.plot(forecast2)\na = add_changepoints_to_plot(fig_trend2.gca(),m2,forecast2)","abafa8e0":"client = Client()\ndf_cv = cross_validation(m2, horizon='60 days', parallel=\"dask\")","48f3aaa7":"df_p = performance_metrics(df_cv)\ndf_p","d6b98697":"fig_cv = plot_cross_validation_metric(df_cv, metric='mape')","ed661dcb":"forecast2 = m2.predict(future2)\nfig_model2 = m2.plot_components(forecast2)","c5430e33":"## 1st Model\nBy default Prophet fits additive seasonalities, meaning the effect of the seasonality is added to the trend to get the forecast. ","389cb5c4":"## 2nd Model","2dabce82":"The seasonality effect increases over time with a multiplicative model.","981b7595":"# Trend Change Points\nBy default, Prophet specifies 25 potential changepoints which are uniformly placed in the first 80% of the time series.","d604419f":"# Data\nI do a forecast for total_sales data using Facebook Prophet. Prophet expects that the format of the dataframe to be specific. The model expects a \u2018ds\u2019 column that contains the datetime field and and a \u2018y\u2019 column that contains the value.","93486e11":"Based on the CV process, the score looks good, which means the model runs well enough too.","eb8d357e":"If you find something interested, leave comment below. I hope it will be usefull. Thank you.","34246552":"Visually based on 2 plots, it appears that the general trend is correct but it is being under-fitted. To adjust the trend change, you can set the parameter changepoint_prior_scale.","a957677a":"# Plot Model Components","37ed07ae":"Based on model components, the highest total sales always happen on Friday, then decrease on the next day. There is also a slight increase on Tuesday.","89724008":"# Cross Validation Using Dask\nPerform cross validation to measure forecast error. ","1da5236b":"I see that an additive model is not suitable; the predicted fluctuation due to seasonality is constant throughout the months. Next step, I will add seasonality_mode as multiplicative to the model and re-predict."}}