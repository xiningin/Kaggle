{"cell_type":{"fe06b6b1":"code","cf150df0":"code","2ff14e46":"code","06f89e08":"code","c2412ae3":"code","43cbcb18":"code","71fe0182":"code","03a28fca":"code","637a641e":"code","17d4f535":"code","35b9a69f":"code","70075d56":"code","b8bf7984":"code","9bb2be45":"code","a74aedfa":"code","0f77df50":"code","79a5899e":"code","a3cde9cd":"code","be6a6f13":"code","cec6e11d":"code","25de9fbb":"code","ee5a4af3":"code","ba62f10e":"code","2b5e629f":"code","40ea1675":"markdown","4f671d0f":"markdown","688217ce":"markdown"},"source":{"fe06b6b1":"import os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","cf150df0":"!pip install openpyxl ","2ff14e46":"# loading libraries\nimport pandas as pd\nfrom sklearn.preprocessing import MinMaxScaler","06f89e08":"pd.set_option('display.max_columns', 10)\npd.set_option('display.max_rows', 10)\npd.set_option('display.float_format', lambda x: '%.2f' % x)","c2412ae3":"df_ = pd.read_excel('..\/input\/online-retail-ii-data-set-from-ml-repository\/online_retail_II.xlsx' , sheet_name = 'Year 2010-2011')","43cbcb18":"df = df_.copy()\ndf.head()","71fe0182":"df.groupby('Description').agg({'Quantity': 'sum'}).sort_values('Quantity' , ascending = False).head()","03a28fca":"#null variables \ndf.isna().sum()","637a641e":"df.dropna(inplace=True)\ndf.isna().sum()","17d4f535":"df.describe().T","35b9a69f":"df = df[~df[\"Invoice\"].str.contains(\"C\", na=False)] # removing canceled orders\ndf = df[(df['Quantity'] > 0)]\ndf = df[(df['Price'] > 0)]","70075d56":"df[\"TotalPrice\"] = df[\"Quantity\"] * df[\"Price\"] #Calculating total price\ndf.head()","b8bf7984":"df_cltv = df.groupby('Customer ID').agg({'Invoice': lambda num: num.nunique(),\n                                        'Quantity': lambda num: num.sum(),\n                                        'TotalPrice': lambda num: num.sum()})","9bb2be45":"df_cltv.columns = ['total_transaction', 'total_unit', 'total_price']\n\ndf_cltv.head()","a74aedfa":"# Average Order Value (average_order_value = total_price \/ total_transaction)\ndf_cltv['avg_order_value'] = df_cltv['total_price'] \/ df_cltv['total_transaction']","0f77df50":"# Purchase Frequency (total_transaction \/ total_number_of_customers)\ndf_cltv[\"purchase_frequency\"] = df_cltv['total_transaction'] \/ df_cltv.shape[0]","79a5899e":"# Repeat Rate\nrepeat_rate = df_cltv[df_cltv.total_transaction > 1].shape[0] \/ df_cltv.shape[0]\n","a3cde9cd":"#Churn Rate\nchurn_rate = 1 - repeat_rate","be6a6f13":"# Profit Margin =  total_price * 0.10\ndf_cltv['profit_margin'] = df_cltv['total_price'] * 0.10","cec6e11d":"# Customer value = average_order_value * purchase_frequency\ndf_cltv['customer_value'] = (df_cltv['avg_order_value'] * df_cltv[\"purchase_frequency\"]) \/ churn_rate","25de9fbb":"#  Customer Lifetime Value (CLTV) = (customer_value \/ churn_rate) x profit_margin\ndf_cltv['cltv'] = df_cltv['customer_value'] * df_cltv['profit_margin']\n\ndf_cltv.head()","ee5a4af3":"# let's standardize the data to better observe\nscaler = MinMaxScaler(feature_range=(0, 5))\nscaler.fit(df_cltv[[\"cltv\"]])\ndf_cltv[\"scaled_CLV\"] = scaler.transform(df_cltv[[\"cltv\"]])\n\ndf_cltv.sort_values(by=\"scaled_CLV\", ascending=False).head(10)\n","ba62f10e":"# segmentation\ndf_cltv[\"SEGMENT\"] = pd.qcut(df_cltv[\"scaled_CLV\"], 3, labels=[\"C\", \"B\", \"A\"])\ndf_cltv.head(10)","2b5e629f":"df_cltv.groupby(\"SEGMENT\")[[\"total_transaction\", \"total_unit\", \"total_price\", \"cltv\", \"scaled_CLV\"]].agg(\n    {\"count\", \"mean\", \"sum\"})","40ea1675":"# Data Preprocessing","4f671d0f":"<p><img style=\"float: left;margin:20px 10px 5px 1px; max-width:380px\" src=\"https:\/\/www.bayleafdigital.com\/wp-content\/uploads\/2019\/09\/CLTV.jpg\"><\/p>\n\n# Context\n* A real online retail transaction data set of two years.\n# Content\n* This Online Retail II data set contains all the transactions occurring for a UK-based and registered, non-store online retail between 01\/12\/2009 and 09\/12\/2011.The company mainly sells unique all-occasion gift-ware. Many customers of the company are wholesalers.\n","688217ce":"# Column Descriptors\n* InvoiceNo: Invoice number. Nominal. A 6-digit integral number uniquely assigned to each transaction. If this code starts with the letter 'c', it indicates a cancellation.\n* StockCode: Product (item) code. Nominal. A 5-digit integral number uniquely assigned to each distinct product.\n* Description: Product (item) name. Nominal.\n* Quantity: The quantities of each product (item) per transaction. Numeric.\n* InvoiceDate: Invice date and time. Numeric. The day and time when a transaction was generated.\n* UnitPrice: Unit price. Numeric. Product price per unit in sterling (\u00c2\u00a3).\n* CustomerID: Customer number. Nominal. A 5-digit integral number uniquely assigned to each customer.\n* Country: Country name. Nominal. The name of the country where a customer resides."}}