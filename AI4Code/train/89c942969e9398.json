{"cell_type":{"9114d338":"code","6a52737d":"code","6d5b83b1":"code","ccb86ecb":"markdown","d7f0c202":"markdown"},"source":{"9114d338":"import numpy as np\nimport pydicom\nfrom pydicom.pixel_data_handlers.util import apply_voi_lut\n\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\n\ndef read_xray(path, voi_lut = True, fix_monochrome = True):\n    dicom = pydicom.read_file(path)\n    \n    # VOI LUT (if available by DICOM device) is used to transform raw DICOM data to \"human-friendly\" view\n    if voi_lut:\n        data = apply_voi_lut(dicom.pixel_array, dicom)\n    else:\n        data = dicom.pixel_array\n               \n    # depending on this value, X-ray may look inverted - fix that:\n    if fix_monochrome and dicom.PhotometricInterpretation == \"MONOCHROME1\":\n        data = np.amax(data) - data\n        \n    data = data - np.min(data)\n    data = data \/ np.max(data)\n    data = (data * 255).astype(np.uint8)\n        \n    return data","6a52737d":"img = read_xray('..\/input\/vinbigdata-chest-xray-abnormalities-detection\/train\/0108949daa13dc94634a7d650a05c0bb.dicom')\nplt.figure(figsize = (12,12))\nplt.imshow(img, 'gray')","6d5b83b1":"img = read_xray('..\/input\/vinbigdata-chest-xray-abnormalities-detection\/train\/0108949daa13dc94634a7d650a05c0bb.dicom', fix_monochrome = False)\nplt.figure(figsize = (12,12))\nplt.imshow(img, 'gray')","ccb86ecb":"What if hadn't fixed MONOCHROME issue:","d7f0c202":"Converting dicom data to png\/jpg may look straightforward and there is going to be many notebooks doing it simple way - just rescaling it.\n\nHowever, you must consider, that raw dicom data is not actually linearly convertable to \"human-friendly\" png\/jpg. \nIn fact, most of DICOM's store pixel values in exponential scale, which is resolved by standard standard DICOM viewers.\n\nSo in order to get jpg\/png as radiologists would initially see in their workspace, you need to apply some transformations. \nDICOM metadata stores information how to make such \"human-friendly\" transformations.\n\nAn example code I use daily can be found below:"}}