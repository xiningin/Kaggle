{"cell_type":{"63341912":"code","2adb9303":"code","f4732bac":"code","cc67771a":"code","55899fbb":"code","46d21583":"code","6c9afae2":"code","363c1682":"code","b99b6ea2":"markdown"},"source":{"63341912":"!pip install moviepy --quiet\nimport os\nimport json\nfrom glob import glob\nimport numpy as np\nfrom skimage.io import imsave\nfrom skimage.transform import resize\nfrom tqdm import tqdm_notebook\nfrom moviepy.editor import VideoFileClip\nfrom concurrent.futures import ProcessPoolExecutor\nimport warnings\nwarnings.filterwarnings(\"ignore\", category=FutureWarning)","2adb9303":"INPUT_DIR = '\/kaggle\/input\/deepfake-detection-challenge'\nEXTRACT_EVERY = 5 # will save every 5th frame\nPROCESSED_DATA_DIR = '\/kaggle\/working\/processed_data'\nH, W = 224, 224","f4732bac":"if not os.path.exists(PROCESSED_DATA_DIR):\n    os.mkdir(PROCESSED_DATA_DIR)\n    os.mkdir(os.path.join(PROCESSED_DATA_DIR, 'real'))\n    os.mkdir(os.path.join(PROCESSED_DATA_DIR, 'fake'))\n\nwith open(INPUT_DIR + '\/train_sample_videos\/metadata.json', 'r') as f:\n    metadata = json.load(f)","cc67771a":"def process_video_file(video_filepath):\n    with VideoFileClip(filename=video_filepath, audio=False) as clip:\n        fname = video_filepath.split('\/')[-1]\n        label = metadata[fname]['label'].lower()\n        output_dir = os.path.join(PROCESSED_DATA_DIR, label, fname.split('.')[0])\n        os.mkdir(output_dir)\n        for i, frame in enumerate(clip.iter_frames()):\n            if (i+1) % EXTRACT_EVERY == 0:\n                output_path = os.path.join(output_dir, '{}.jpeg'.format(i+1))\n                resized_frame = np.uint8(resize(frame, [H, W]) * 255)\n                imsave(output_path, resized_frame, check_contrast=False)","55899fbb":"video_paths = glob(INPUT_DIR + '\/train_sample_videos\/*.mp4')[:5]\nwith ProcessPoolExecutor(max_workers=4) as ex:\n    processed = 0\n    for _ in tqdm_notebook(ex.map(process_video_file, video_paths), total=len(video_paths)):\n        print('Done processing {} videos'.format(processed))\n        processed += 1","46d21583":"glob(\"\/kaggle\/working\/processed_data\/real\/*\/\")","6c9afae2":"glob(\"\/kaggle\/working\/processed_data\/fake\/*\/\")","363c1682":"glob(\"\/kaggle\/working\/processed_data\/fake\/*\/*\")[:20]","b99b6ea2":"> #### Processing 5 sample videos"}}