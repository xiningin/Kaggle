{"cell_type":{"71f58241":"code","7fb8ebed":"code","986734c8":"code","9902e80a":"code","47ddcda2":"code","4ff5cc67":"code","b3f1fc5e":"code","f3b3075a":"code","e74c22f6":"code","76d3441c":"code","f918563f":"code","0184453f":"code","93365833":"code","a897f94e":"code","34a06b05":"code","90940e26":"code","6d2f647c":"code","d0cc5e6f":"code","f70bb596":"code","889f57ae":"code","a167b27f":"code","0994ac9c":"code","8c0c1d01":"code","b8f8663a":"markdown","fae6b929":"markdown","4c2c48e2":"markdown","983790c8":"markdown"},"source":{"71f58241":"#import libraries\nimport numpy as np \nimport pandas as pd \nimport matplotlib.pyplot as plt\nimport seaborn as sns","7fb8ebed":"#load data\ndata = pd.read_csv('..\/input\/avocado-prices\/avocado.csv', parse_dates=['Date'])","986734c8":"data.head()","9902e80a":"#plot average prices of conventional vs. organic avocadoes over time \nsns.set_style('darkgrid')\nsns.set_context('notebook')\nsns.relplot(x='Date', y='AveragePrice', data=data, kind='line', hue='type', height=6, aspect=2);","47ddcda2":"#drill down deeper into the price and volume deltas between conventional and organic avocadoes across the years\ndisplay(sns.catplot(x='year', y='AveragePrice', data=data, col='type', kind='bar'));\ndisplay(sns.catplot(x='year', y='Total Volume', col='type', kind='bar', data=data, sharey=False));","4ff5cc67":"#transform data to discover seasonality trend\ndata['month']=data.Date.dt.strftime('%b')\nmonths = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \n          \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"]\ndata.month = pd.Categorical(values=data.month, categories=months, ordered=True)\nseasonal = data.groupby(['month','type'], as_index=False)['AveragePrice'].mean().sort_values('month')","b3f1fc5e":"#plot seasonal trend of avocado prices\ng =sns.relplot(x='month', y='AveragePrice', data=data, kind='line', row='type', ci=None, height=3, aspect=3, facet_kws={'sharey':False, 'sharex':False});","f3b3075a":"#plot seasonal trend of avocado retail volume\ng =sns.relplot(x='month', y='Total Volume', data=data, kind='line', row='type', ci=None, height=3, aspect=3, facet_kws={'sharey':False, 'sharex':False});","e74c22f6":"#transform data for geographical analysis, excluding aggregated regions\ndf = data.groupby(['region', 'year'], as_index=False)['AveragePrice','Total Volume'].mean()\nlist_to_exclude = ['TotalUS', 'West', 'SouthCentral','Northeast','Southeast','GreatLakes','Midsouth','Plains']\ndf1 = df[~df.region.isin(list_to_exclude)].sort_values('AveragePrice', ascending=False)","76d3441c":"#plot the range of average prices per city\nsns.catplot(x='AveragePrice', y='region', data=df1, height=10, aspect=1, kind='box');","f918563f":"#install library\nfrom fbprophet import Prophet","0184453f":"#create data subset of Total US conventional avocado prices as the forecast target \nsubset = data[(data.region == 'TotalUS') & (data.type == 'conventional')]\nsubset = subset[['Date', 'AveragePrice']]\nsubset = subset.set_index('Date').sort_index()","93365833":"#split the data into train and test, with the split being all data before\/after Jun 30 2017 \nsplit_date = '01-Aug-2017'\ntrain = subset.loc[subset.index <= split_date].copy()\ntest = subset.loc[subset.index > split_date].copy()","a897f94e":"#plot train and test together for visualization of total data sets\ntest \\\n    .rename(columns={'AveragePrice': 'Test Set'}) \\\n    .join(train.rename(columns={'AveragePrice': 'Training Set'}),\n          how='outer') \\\n    .plot(figsize=(15,5), title='Conventional Avocado Prices')\n\nplt.show();","34a06b05":"#format columns for prophet model using ds and y\ntrain = train.reset_index()\ntrain.columns = [\"ds\", \"y\"]","90940e26":"#create the model and fit the data\nm1 = Prophet()\nm1.fit(train)","6d2f647c":"#tell prophet to predict out 1 year\nfuture1 = m1.make_future_dataframe(periods=365*2)","d0cc5e6f":"future1.tail()","f70bb596":"#make the forecast\nforecast1 = m1.predict(future1)","889f57ae":"#examine the forecasted values yhat and its lower & upper range\nforecast1[['ds', 'yhat', 'yhat_lower', 'yhat_upper']].head()","a167b27f":"#plot a pretty graph \nm1.plot(forecast1);","0994ac9c":"#plot the forecast with the actuals\nf, ax = plt.subplots(1)\nf.set_figheight(5)\nf.set_figwidth(10)\nax.scatter(test.index, test['AveragePrice'], color='r', alpha=0.4)\n\nfig = m1.plot(forecast1, ax=ax);","8c0c1d01":"#plot various components of the model too \nm1.plot_components(forecast1);","b8f8663a":"Here are some findings:\n* Conventional avocados are expected to continue rising in prices\n* The prices dip at the start of the year and are most expensive a few months post summer \n* This is in line with the opposite trend in volume - highest at the start and lowest post summer \n* There was a price spike in 2017, probably due to high demand and a flat supply (esp for conventional avocadoes, whose volume remained the same as 2016) \n* Unsurprisingly organic avocados are more expensive than conventional avocados \n* They're most expensive in more affulent cities like San Francisco and New York \n* FB Prophet managed to predict the general trend, but not the granular points - potentially more data is required \n\nFuture ideas: \n* Examine other predictive algorithms (XGBoost) \n* Try other data sets including stocks","fae6b929":"# Part 1: Exploratory Data Analysis","4c2c48e2":"# Part 2: Forecasting\n\nWith reference to the guide in this very helpful [article](https:\/\/pbpython.com\/prophet-overview.html) as an example to use fbprophet","983790c8":"All About Avocadoes \n\nMy attempt to dissect a data set of one of my favourite foods and experiment with different seaborn plotting methods and fbprophet forecasting library - this will be an ongoing project as I continue to explore and learn as much as I can. \n\n1) Exploratory Data Analysis using **seaborn** \n2) Simple Forecasting using **fbprophet** "}}