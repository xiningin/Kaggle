{"cell_type":{"9ab57829":"code","a16f7db8":"code","74ab6896":"code","eb6af0de":"code","aa3975a7":"code","7035f59b":"code","c1f0fc0c":"code","7ff39faa":"code","19dd1e39":"code","126cae91":"code","dd4fddfd":"code","0453c66d":"code","ae9f8317":"code","5e920b01":"code","c6e54425":"code","f065c373":"code","a3512e7d":"code","81b5ff21":"code","dff2d9e5":"code","6de76c44":"code","48f7c957":"code","fe3d4c72":"code","3b604c83":"code","63e58669":"code","9e7a2e23":"code","2fe1f1c7":"code","9ec16372":"code","0aa2086b":"code","4add90e2":"code","483ab66f":"code","439c205f":"code","265f36c6":"code","ade1d3db":"code","3a26c69a":"code","37581703":"code","5f12ba56":"code","36060e6b":"code","5bd5136e":"markdown","d89ebc6a":"markdown","f2749d53":"markdown","349744a1":"markdown","c7acb21a":"markdown","9744696a":"markdown","e0704506":"markdown","a5f5cfe5":"markdown","6382111e":"markdown","a7168352":"markdown","77535e51":"markdown","23ae0121":"markdown","6a421b42":"markdown","557a4ca5":"markdown","b713bc2e":"markdown","101defbf":"markdown","355e7741":"markdown","0aa1ac94":"markdown","44a534ad":"markdown","260f7f91":"markdown","a6b0c364":"markdown","0754f6ad":"markdown","d7acad9c":"markdown","ca6f1a58":"markdown","f738bb49":"markdown","5fee1a05":"markdown","69dbdc83":"markdown","0bfbada1":"markdown","76248346":"markdown","d2b1fb97":"markdown","f7f71321":"markdown","b0cd54c0":"markdown","5bc6b6e3":"markdown","4fb6684d":"markdown","083d13ef":"markdown","c051e10f":"markdown","ea3a0a99":"markdown","0d8669df":"markdown","311afe1f":"markdown","59d83b5d":"markdown","02c59082":"markdown","8a22f039":"markdown","7496af65":"markdown","a6fd7e61":"markdown"},"source":{"9ab57829":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline\nfrom surprise import SVD, Reader, Dataset \nfrom surprise.model_selection import cross_validate","a16f7db8":"column_names=['userId','productId','rating','timestamp']\ndf=pd.read_csv('..\/input\/amazon-product-reviews\/ratings_Electronics (1).csv',names=column_names)","74ab6896":"df.head()","eb6af0de":"df.shape","aa3975a7":"df.info()","7035f59b":"df.isnull().sum()","c1f0fc0c":"plt.figure(figsize=(10,6))\nsns.countplot(x='rating', data=df, palette='winter')\nplt.xlabel('Rating', fontsize=12)\nplt.ylabel('Count', fontsize=12)\nplt.title('Number of Each Rating', fontsize=15)\nplt.show()","7ff39faa":"df_rating=pd.DataFrame({'Number of Rating':df.groupby('productId').count()['rating'], 'Mean Rating':df.groupby('productId').mean()['rating']})","19dd1e39":"df_rating.head()","126cae91":"plt.figure(figsize=(18,6))\n\nplt.subplot(1,2,1)\nplt.hist(x='Number of Rating',data=df_rating,bins=30,color='teal')\nplt.title('Distribution of Number of Rating', fontsize=15)\nplt.xlabel('Number of Rating', fontsize=12)\nplt.ylabel('Frequency', fontsize=12)\n\nplt.subplot(1,2,2)\nplt.hist(x='Mean Rating',data=df_rating,bins=30, color='slateblue')\nplt.title('Distribution of Mean Rating', fontsize=15)\nplt.xlabel('Mean Rating', fontsize=12)\nplt.yticks([])\nplt.show()","dd4fddfd":"plt.figure(figsize=(8,6))\nsns.jointplot(x='Number of Rating', y='Mean Rating',data=df_rating,color='g', height=7)\nplt.suptitle('Mean Rating Versus Number of Rating', fontsize=15, y=0.92)\n\nplt.show()","0453c66d":"df_rating['Mean Rating'].mean()","ae9f8317":"df_rating['Number of Rating'].quantile(q=0.9)","5e920b01":"df_filtered=df_rating[df_rating['Number of Rating']>df_rating['Number of Rating'].quantile(q=0.9)]","c6e54425":"df_filtered.shape","f065c373":"def product_score(x):\n    v=x['Number of Rating']\n    m=df_rating['Number of Rating'].quantile(q=0.9)\n    R=x['Mean Rating']\n    C=df_rating['Mean Rating'].mean()\n    return ((R*v)\/(v+m))+((C*m)\/(v+m))","a3512e7d":"df_filtered['score']=df_filtered.apply(product_score, axis=1)","81b5ff21":"df_filtered.head()","dff2d9e5":"df_highscore=df_filtered.sort_values(by='score', ascending=False).head(10)","6de76c44":"df_highscore","48f7c957":"df_highscore.index","fe3d4c72":"svd = SVD()","3b604c83":"reader = Reader()","63e58669":"data = Dataset.load_from_df(df[['userId', 'productId', 'rating']], reader)","9e7a2e23":"cross_validate(svd, data, measures=['RMSE', 'MAE'], cv=5, verbose=True)","2fe1f1c7":"trainset = data.build_full_trainset()","9ec16372":"svd.fit(trainset)","0aa2086b":"df[df['userId'] == 'AKM1MP6P0OYPR']","4add90e2":"svd.predict(uid='A17HMM1M7T9PJ1', iid='0970407998', r_ui=None)","483ab66f":"svd.predict(uid='A17HMM1M7T9PJ1', iid='0970407998', r_ui=None).est","439c205f":"df_users=df.groupby('userId').filter(lambda x: x['rating'].count()>=50)","265f36c6":"df_users.head()","ade1d3db":"df_users.shape","3a26c69a":"matrix=pd.pivot_table(data=df_users, values='rating', index='userId',columns='productId')","37581703":"matrix.head()","5f12ba56":"# Function that takes in productId and useId as input and outputs up to 5 most similar products.\ndef hybrid_recommendations(userId, productId):\n    \n    # Get the Id of the top five products that are correlated with the ProductId chosen by the user.\n    top_five=matrix.corrwith(matrix[productId]).sort_values(ascending=False).head(5)\n    \n    # Predict the ratings the user might give to these top 5 most correlated products.\n    est_rating=[]\n    for x in list(top_five.index):\n        if str(top_five[x])!='nan':\n            est_rating.append(svd.predict(userId, iid=x, r_ui=None).est)\n           \n    return pd.DataFrame({'productId':list(top_five.index)[:len(est_rating)], 'estimated_rating':est_rating}).sort_values(by='estimated_rating', ascending=False).reset_index(drop=True)","36060e6b":"hybrid_recommendations('A2NYK9KWFMJV4Y', 'B00LI4ZZO8')","5bd5136e":"### Collaborative Recommender","d89ebc6a":"The below code will give an error:\nmatrix=pd.pivot_table(data=df, values='rating', index='userId',columns='productId')","f2749d53":"As an example, we use the algorithm to predict the score that might be given to the productId of '0970407998' by this specific userId.","349744a1":"We get a mean Root Mean Sqaure Error of 1.29 approx which is good enough for our case. Let us now train on our dataset and arrive at predictions.","c7acb21a":"## Importing Libraries","9744696a":"# <center> Recommendation Systems for Amazon Electronic Products <center>","e0704506":"Now, we calculate score for each qualified product. To do this, we define a function, weighted_rating(), and apply this function to the DataFrame of qualified products.","a5f5cfe5":"We study the distribuition of number of ratings and mean ratings recorded for each product.","6382111e":"We can see that most of users rated 5 for the products.","a7168352":"We built three different recommendation systems based on different algorithms. They are as follows:\n\n-   **Popularity-Based Recommender:** This system used the overall Number of Rating and VMean Rating to find the top 10 productIds. The IMDB Weighted Rating System was used to calculate scores on which the sorting was finally performed.\n\n\n\n-   **Collaborative Filtering:** We used the powerful Surprise Library to build a collaborative filter based on single value decomposition. The RMSE obtained was about 1.29 and the engine predicted estimated ratings for a given user and product.\n\n\n-   **Hybrid Engine:** We combined corrwith() method which computed the Pearson correlation coefficients with collaborative filtering. Our hybrid recommender took useId and productId as input and suggested up to 5 products that were similar to the input productId based on the estimated ratings that was internally calculated for the input userId. This Hybrid System took advantage of both Pearson method and Collaborative filtering and therefore made reliable predictions.","77535e51":"We see that there are 46553 products which qualify to be in this list.","23ae0121":"Our model predicts that userId of 'A17HMM1M7T9PJ1' will give 3.89 as the rating for productId of '0970407998'.","6a421b42":"Finally, we sort the dataframe based on the score feature, and we output the the top 10 popular products.","557a4ca5":"We create a scatter plot to observe the relationship between Number of Rating and Mean Rating.","b713bc2e":"## Exploratory Data Analysis ","101defbf":"As an example, we use this hybrid function to recommend similar products and predict the scores that might be given by a specific user to these similar products. It should be noted that this function was defined bassed on df_users dataframe that only includes the users who have rated 50 times or more. Now, we check the performance of this hybrid recommender for some of the userIds included in df_users dataframe.","355e7741":"## Loading Datasets","0aa1ac94":"We train the algorithm on the trainset.","44a534ad":"### Popularity-Based Recommender ","260f7f91":"Our popularity-based recommender engine suffers from some severe limitations. It is not really personal and does not capture the personal tastes and biases of a user. Anyone querying our engine for recommendations based on a product will receive the same recommendations for that product, regardless of who she\/he is.\n\nTherefore, in this section, we will use a technique called Collaborative Filtering to make better recommendations to Amazon customers.\n\nCollaborative Filtering matches persons with similar interests and provides recommendations based on this matching. It is based on the idea that users similar to me can be used to predict how much I will like a particular product or service those users have used\/experienced but I have not. \n\nSurprise library is a Python scikit for building and analyzing recommender systems that deal with explicit rating data. Here we use the Surprise library that uses extremely powerful algorithms like Singular Value Decomposition (SVD) to minimise Root Mean Square Error (RMSE) that is measured by Kfold Cross Validation and give great recommendations.","a6b0c364":"Now we load the df dataset.","0754f6ad":"Then we create a pivot table.","d7acad9c":"### Hybrid Recommender","ca6f1a58":"The implementation of Popularity-Based Filtering is straighforward. All we have to do is sort our products based on ratings, and display the top products of our list. Therefore, we should;\n\n- Create a metric to score or rate the products.\n- Calculate the score for every product.\n- Sort the scores and recommend the best rated product to the users.\n\nWe can use the average ratings of the products as the score but using this will not be fair enough since a product with 5average rating and only43 votes cannot be considered better than the product with 4 as average rating but 40 votes. So, we use IMDB's weighted rating formula to score the products, as follows:\n\nWeighted Rating (WR) = $(\\frac{v}{v + m} . R) + (\\frac{m}{v + m} . C)$ \n\n- v: the number of votes for the product\n\n- m: the minimum votes required to be listed in the chart\n\n- R: the average rating of the product\n\n- C: the mean vote across the whole report","f738bb49":"From these histograms we can see that most of the number of ratings are between 0 and 1825, and most of the products have a mean rating of 5.","5fee1a05":"## Conclusion","69dbdc83":"Based on the df_rating dataframe created above, we already have v or the Number of Rating, and R or Mean Rating for each product. So we calculate C.","0bfbada1":"Let us pick the user with userId of 'AKM1MP6P0OYPR' and check the ratings she\/he has given so far to different products.","76248346":"Now, we filter the products that qualify for the chart and put them in a new dataframe called df_filtered.","d2b1fb97":"## Introduction","f7f71321":"In this section, we try to build a hybrid recommender that combines corrwith() method which computes the Pearson correlation coefficients with collaborative filtering. This is how it works:\n\n-  Input: User ID and Product ID\n\n-  Output: Similar products sorted on the basis of expected ratings by a particular user.\n\nFirst, we create a pivot table which contains userIds as rows and productIds as columns. However, if we use the whole datafram (df) in the below code, there will be an error because the input data has more than 7 million rows.","b0cd54c0":"Finally we define a function that takes in productId and useId as input and outputs up to 5 most similar products. For this purpose, we use corrwith() method to compute pairwise correlation between columns of dataFrame and calculate Pearson correlation coefficients.","5bc6b6e3":"Here we will use the famous SVD algorithm.","4fb6684d":"# ![5.png](attachment:5.png)","083d13ef":"The mean rating for all the products (C) is approximately 3.9 on a scale of 5.\n\nThe next step is to determine an appropriate value for m, the minimum number of votes required for a product to be listed in the chart. We use 90th percentile as our cutoff. In other words, for a product to feature in the charts, the number of its votes should be higher than that of 90% of the products in the list.","c051e10f":"Then we run 5-fold cross-validation and print the results.","ea3a0a99":"First we analyze the number of recorded ratings.","0d8669df":"Online E-commerce websites like Amazon, Filpkart uses different recommendation models to provide different suggestions to different users. Amazon currently uses item-to-item collaborative filtering, which scales to massive data sets and produces high-quality recommendations in real time. This type of filtering matches each of the user's purchased and rated items to similar items, then combines those similar items into a recommendation list for the user. In this project we are going to build recommendation model for the electronics products of Amazon.\n\n\nThe main types of recommendations systems include:\n\n\n-  **Popularity-Based Recommender**\n   - It offers generalized recommendations to every user, based on product popularity. This system recommends same products to all users and it does not give personalized recommendations to users.\n\n\n-  **Content-Based Recommender**\n   - It builds an engine that computes similarity between products based on certain metrics such as description, and suggests products that are most similar to a particular product that a user liked. The general idea behind these recommender systems is that if a person liked a particular item, he or she will also like an item that is similar to it.\n\n\n-  **Collaborative Recommender**\n   - This system matches persons with similar interests and provides recommendations based on this matching. Collaborative filtering is based on the idea that users similar to a particular user can be used to predict how much that particular user will like a particular product or service those users have used\/experienced but that particular user has not.\n\n\n-  **Hybrid Recommender**\n   - This system builds an ensemble of Collaborative, Content-Based or Popularity-Based models to come up with a comprehensive Hybrid Recommendation System.\n   \n\nAmazon Reviews data source has several datasets. For this case study, we are using the Electronics dataset which includes:\n-  userId : Every user identified with a unique id\n-  productId : Every product identified with a unique id\n-  Rating : Rating of the corresponding product by the corresponding user\n-  timestamp : Time of the rating ( ignore this column for this exercise)\n\n\nOur objective is to build a recommendation system to recommend products to customers based on the their previous ratings for other products. For this purpose, first we will perform exploratory data analysis and then implement three recommendation algorithms including Popularity-Based, Collaborative, and Hybrid Recommenders.","311afe1f":"#### SVD: Matrix Factorization Based Algorithm","59d83b5d":"<h1>Table of Contents<span class=\"tocSkip\"><\/span><\/h1>\n<div class=\"toc\"><ul class=\"toc-item\"><li><span><a href=\"#Introduction\" data-toc-modified-id=\"Introduction-1\"><span class=\"toc-item-num\">1&nbsp;&nbsp;<\/span>Introduction<\/a><\/span><\/li><li><span><a href=\"#Importing-Libraries\" data-toc-modified-id=\"Importing-Libraries-2\"><span class=\"toc-item-num\">2&nbsp;&nbsp;<\/span>Importing Libraries<\/a><\/span><\/li><li><span><a href=\"#Loading-Datasets\" data-toc-modified-id=\"Loading-Datasets-3\"><span class=\"toc-item-num\">3&nbsp;&nbsp;<\/span>Loading Datasets<\/a><\/span><\/li><li><span><a href=\"#Exploratory-Data-Analysis\" data-toc-modified-id=\"Exploratory-Data-Analysis-4\"><span class=\"toc-item-num\">4&nbsp;&nbsp;<\/span>Exploratory Data Analysis<\/a><\/span><\/li><li><span><a href=\"#Recommender-Systems\" data-toc-modified-id=\"Recommender-Systems-5\"><span class=\"toc-item-num\">5&nbsp;&nbsp;<\/span>Recommender Systems<\/a><\/span><ul class=\"toc-item\"><li><span><a href=\"#Popularity-Based-Recommender\" data-toc-modified-id=\"Popularity-Based-Recommender-5.1\"><span class=\"toc-item-num\">5.1&nbsp;&nbsp;<\/span>Popularity-Based Recommender<\/a><\/span><\/li><li><span><a href=\"#Collaborative-Recommender\" data-toc-modified-id=\"Collaborative-Recommender-5.2\"><span class=\"toc-item-num\">5.2&nbsp;&nbsp;<\/span>Collaborative Recommender<\/a><\/span><ul class=\"toc-item\"><li><span><a href=\"#SVD:-Matrix-Factorization-Based-Algorithm\" data-toc-modified-id=\"SVD:-Matrix-Factorization-Based-Algorithm-5.2.1\"><span class=\"toc-item-num\">5.2.1&nbsp;&nbsp;<\/span>SVD: Matrix Factorization Based Algorithm<\/a><\/span><\/li><\/ul><\/li><li><span><a href=\"#Hybrid-Recommender\" data-toc-modified-id=\"Hybrid-Recommender-5.3\"><span class=\"toc-item-num\">5.3&nbsp;&nbsp;<\/span>Hybrid Recommender<\/a><\/span><\/li><\/ul><\/li><li><span><a href=\"#Conclusion\" data-toc-modified-id=\"Conclusion-6\"><span class=\"toc-item-num\">6&nbsp;&nbsp;<\/span>Conclusion<\/a><\/span><\/li><\/ul><\/div>","02c59082":"To avoid processing difficulties, we filter data which only contains the customers who have given ratings more than 50 times and put them into a dataframe. Since we are providing the recommendation of the products to the customers, it is better to remove data based on the userId rather than productId.","8a22f039":"## Recommender Systems","7496af65":"So the top 10 popular products that this model will recommend to users include 'B0043WJRRS', 'B00CG70K78', 'B007SZ0E1K', 'B003FVVMS0', 'B0033PRWSW','B008VGCT9K', 'B0029N3U8K', 'B0041OYTJE', 'B00GMRCAC6' and 'B007R5YGO2'.\n\nWe should keep in mind that this popularity-based recommender provides a general chart of recommended products to all the users, regardless of the user's personal taste. It is not sensitive to the interests and tastes of a particular user, and it does not give personalized recommendations based on the users.","a6fd7e61":"We can see that there is no missing data and the data is clean."}}