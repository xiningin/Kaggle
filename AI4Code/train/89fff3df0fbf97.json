{"cell_type":{"6eb4da53":"code","fd9742f7":"code","a67cb706":"code","bd9b146e":"code","781d16f5":"code","d43a2962":"code","9c93a417":"code","430fdc20":"code","de7a0f44":"code","f4bfd329":"code","6e236d01":"code","ba91534c":"code","9ba5673c":"code","e2bb50e9":"code","85b1884d":"code","bbab9fec":"code","88e21062":"code","8595a58f":"code","a33e8395":"code","699826fd":"code","a21f2f8c":"code","08cd0a89":"code","c78e0933":"code","92da2841":"code","ab5d3cc0":"code","34f2a445":"code","83b007fe":"code","b8d34496":"code","b38dead0":"code","0b0489a1":"markdown","b14e194e":"markdown","4ced0478":"markdown","7c02ede7":"markdown","c201e545":"markdown"},"source":{"6eb4da53":"!pip install multi-prophet","fd9742f7":"import gc\nfrom tqdm import tqdm\nimport numpy as np\nimport pandas as pd\nfrom pylab import rcParams\nimport matplotlib.pyplot as plt\nfrom sklearn.metrics import mean_squared_error\nfrom scipy.stats import probplot\n\nimport datetime as dt\nfrom datetime import date\nfrom datetime import timedelta\nfrom fbprophet import Prophet\nfrom multi_prophet import MultiProphet\nimport folium\nfrom folium import plugins\n\n%matplotlib inline\nimport os\nimport warnings\nwarnings.filterwarnings(\"ignore\")","a67cb706":"data0=pd.read_csv('..\/input\/earthquake-in-japan\/japan-20190101_20211203_query.csv')\ndata0[1:2]","bd9b146e":"data0=data0.fillna('N')\ndata1=data0[['time','latitude','longitude','depth','mag',]]\ndata1[0:5]","781d16f5":"data2=pd.DataFrame(columns=data1.columns.tolist())\nfor i,item in enumerate(data1['time']):\n    data2=pd.concat([data2,data1.loc[i:i]])\ndata2=data2.sort_values(['time']).reset_index(drop=True)    ","d43a2962":"from datetime import datetime as dt\ndata2a=data2.copy()\ndate=[]\nfor item in data2['time']:\n    date+=[dt.strptime(item[0:-5],'%Y-%m-%dT%H:%M:%S')]\ndata2a['date']=date\ndata2a","9c93a417":"data4=data2a[data2a['longitude']>130][data2a['longitude']<137][data2a['latitude']>31][data2a['latitude']<34]\ndata4=data4.reset_index(drop=True)\ndata4","430fdc20":"import plotly.express as px\nfig=px.scatter(x=data4['date'],y=data4['mag'])\nfig=px.scatter(data4, x=\"date\", y=\"mag\")\nfig.update_layout(title='Magnituide of earthquake around Nankai area in 2019-2021')\nfig.show()","de7a0f44":"data4['date2']=data4['date'].apply(lambda x: dt.strptime(str(x)[0:10],'%Y-%m-%d') )\ndata4","f4bfd329":"data4.columns","6e236d01":"data5=data4[['date2','mag','depth','latitude','longitude']][data4['mag']>4.1]\ndata5","ba91534c":"item1=data5\nitem1.columns = ['ds','y1','y2','y3','y4']\nitem1.y1 = item1.y1.astype('float')\nitem1.y2 = item1.y2.astype('float')\nitem1.y3 = item1.y3.astype('float')\nitem1.y4 = item1.y4.astype('float')\nitem1.ds = item1.ds.astype('datetime64')","9ba5673c":"# magnitude\nrcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y1)","e2bb50e9":"# depth\nrcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y2)","85b1884d":"# latitude\nrcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y3)","bbab9fec":"# longitude\nrcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y4)","88e21062":"mph = MultiProphet(columns=['y1','y2','y3','y4'])\nmph.fit(item1)\nforecast = mph.predict(item1)\nmph.plot(forecast)","8595a58f":"from datetime import timedelta\nstart0 = dt.strptime('2021-01-01','%Y-%m-%d').date()\nend0   = dt.strptime('2023-12-31','%Y-%m-%d').date()\nprint((end0-start0).days)","a33e8395":"def daterange(start,end):\n    for i in range((end-start).days):\n        return start+timedelta(i)  ","699826fd":"dates0=[]\nfor i in range((end0-start0).days):\n    dates0+=[(start0+timedelta(i)).strftime('%Y-%m-%d') ]\nprint(dates0[0:30])","a21f2f8c":"dates0_df=pd.DataFrame(dates0)\ndates0_df.columns=['ds']\ndates0_df","08cd0a89":"mph","c78e0933":"#mph = MultiProphet(columns=[\"y1\",\"y2\"])\n#mph.fit(item1)\nforecast3 = mph.predict(dates0_df)\nfigure=mph.plot(forecast3)\nprint(figure)","92da2841":"forecast3['y1'][['ds','yhat','yhat_lower','yhat_upper']][365:385]\n#forecast3['y2'][['ds','yhat','yhat_lower','yhat_upper']][365:385]\n#forecast3['y3'][['ds','yhat','yhat_lower','yhat_upper']][365:385]\n#forecast3['y4'][['ds','yhat','yhat_lower','yhat_upper']][365:385]","ab5d3cc0":"forecast4a=forecast3['y1'][['ds','yhat','yhat_lower','yhat_upper']][365:365*2]\nforecast4b=forecast3['y2'][['ds','yhat','yhat_lower','yhat_upper']][365:365*2]\nforecast4c=forecast3['y3'][['ds','yhat','yhat_lower','yhat_upper']][365:365*2]\nforecast4d=forecast3['y4'][['ds','yhat','yhat_lower','yhat_upper']][365:365*2]","34f2a445":"mag0=forecast4a['yhat'].max()\ndate0=forecast4a[forecast4a['yhat']==mag0]['ds'].tolist()[0]\ndepth0=forecast4b[forecast4b['ds']==date0]['yhat'].tolist()[0]\nlat0=forecast4c[forecast4c['ds']==date0]['yhat'].tolist()[0]\nlong0=forecast4d[forecast4d['ds']==date0]['yhat'].tolist()[0]\n\nprint('Date:',date0)\nprint('Magnitude:',mag0)\nprint('Depth:',depth0)\nprint('Latitude:',lat0)\nprint('Longitude:',long0)","83b007fe":"forecastall=forecast4a[['ds','yhat']]\nforecastall2=pd.concat([forecastall,forecast4b['yhat'],forecast4c['yhat'],forecast4d['yhat']],axis=1)\nforecastall2.columns=['date','mag','depth','lat','long']\nforecastall2","b8d34496":"data5=forecastall2[['lat','long']][forecastall2['mag']>5.1]\ndata5","b38dead0":"eq_map = folium.Map(location=[34,134],tiles='Stamen Terrain',zoom_start=7.0,min_zoom=2.0)\neq_map.add_child(plugins.HeatMap(data5))\neq_map","0b0489a1":"# fit past and predict past+future","b14e194e":"# fit past and predict past","4ced0478":"# **Nankai Megathrust Earthquake in Japan**\n* Nankai megathrust earthquakes are great megathrust earthquakes that occur along the Nankai megathrust \u2013 the fault under the Nankai Trough \u2013 which forms the plate interface between the subducting Philippine Sea Plate and the overriding Amurian Plate, which dips beneath southwestern Honshu, Japan. [(Wikipedia)](https:\/\/en.wikipedia.org\/wiki\/Nankai_megathrust_earthquakes)","7c02ede7":"# Predict MAX Magnitude of Earthquakes in 2022","c201e545":"## Earthquake prediction by Multi Prophet\n\nIt is strongly required to predict possible future earthquakes from past earthquake data and take countermeasures in advance. I am not an expert on earthquake, but I can get data on past earthquakes. What we want to know is that when, where, at what depth, and how much magnitude of an earthquake will occur in the future. Target items to be predicted are many. But, we can predict them at the same time by using Multi Prophet. These two notebooks were done using it.<br\/>\nhttps:\/\/github.com\/vonum\/multi-prophet"}}