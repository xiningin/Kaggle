{"cell_type":{"2e04cb37":"code","03e2130b":"code","1921d3e2":"code","1111712c":"code","35c9b41f":"code","72e8a717":"markdown","38992ba5":"markdown"},"source":{"2e04cb37":"!pip install kaggle-environments --upgrade -q","03e2130b":"%%writefile agent1.py\n\n\nimport math, random\n\n\nhistory = {\n    \"turn\": 0,\n    \"cnts\": [0] * 100,\n    \"ocnts\": [0] * 100,\n    \"hits\": [0] * 100,\n    \"la\": -1,\n}\n\ndef agent1(observation, configuration):\n    global history\n\n    N = 100\n    p = [63.9413, 0.000533149]\n    ti = observation[\"step\"]\n    if ti == 0:\n        pass\n    else:\n        la = history[\"la\"]\n        ola = sum(observation['lastActions']) - la\n        if sum(history[\"hits\"]) < observation['reward']:\n            history[\"hits\"][la] += 1 \/ pow(0.97, history[\"cnts\"][la] + history[\"ocnts\"][la])\n        history[\"cnts\"][la] += 1\n        history[\"ocnts\"][ola] += 1\n\n    tau = p[0] \/ (ti + 1) + p[1]\n    ea = [0] * N\n    hits = history[\"hits\"]\n    cnts = history[\"cnts\"]\n    ocnts = history[\"ocnts\"]\n    for i in range(N):\n        if cnts[i] == 0:\n            ea[i] = math.exp(0.99 * pow(0.97, ocnts[i]) \/ tau)\n        else:\n            ea[i] = math.exp(hits[i] \/ cnts[i] * pow(0.97, cnts[i] + ocnts[i]) \/ tau)\n\n    se = sum(ea)\n    r = random.random() * se\n    t = 0\n    la = 99\n    for i in range(N):\n        t += ea[i]\n        if t >= r:\n            la = i\n            break\n\n    history[\"la\"] = la\n    return la\n","1921d3e2":"%%writefile agent2.py\n\nimport math, random\n\n\nhistory = {\n    \"turn\": 0,\n    \"cnts\": [0] * 100,\n    \"ocnts\": [0] * 100,\n    \"hits\": [0] * 100,\n    \"osteps\": [0] * 100,\n    \"la\": -1,\n}\n\ndef agent2(observation, configuration):\n    global history\n\n    N = 100\n    p = [4.60575, 0.000629018, 1.82229]\n    ti = observation[\"step\"]\n    if ti == 0:\n        pass\n    else:\n        la = history[\"la\"]\n        ola = sum(observation['lastActions']) - la\n        history[\"osteps\"][ola] = ti\n        if sum(history[\"hits\"]) < observation['reward']:\n            history[\"hits\"][la] += 1 \/ pow(0.97, history[\"cnts\"][la] + history[\"ocnts\"][la])\n        history[\"cnts\"][la] += 1\n        history[\"ocnts\"][ola] += 1\n\n    tau = p[0] \/ (ti + 1) + p[1]\n    ea = [0] * N\n    hits = history[\"hits\"]\n    cnts = history[\"cnts\"]\n    ocnts = history[\"ocnts\"]\n    osteps = history[\"osteps\"]\n\n    tv = sorted([(-ocnts[i], osteps[i], i) for i in range(N)])\n    ot = [0] * N\n    for i in range(N):\n        ot[tv[i][2]] = 99 - i\n\n    for i in range(N):\n        if cnts[i] == 0:\n            if ocnts[i] > 1:\n                ea[i] = math.exp(ot[i] \/ 100 * pow(0.97, ocnts[i]) \/ tau)\n            else:\n                ea[i] = math.exp(0.99 * pow(0.97, ocnts[i]) \/ tau)\n        else:\n            w = pow(cnts[i], p[2])\n            wo = ocnts[i]\n            if ocnts[i] < 2:\n                wo = 0\n            r = hits[i] \/ cnts[i]\n            ro = ot[i] \/ 100\n            ea[i] = math.exp((r * w + ro * wo) \/ (w + wo) * pow(0.97, cnts[i] + ocnts[i]) \/ tau)\n\n    se = sum(ea)\n    r = random.random() * se\n    t = 0\n    la = 99\n    for i in range(N):\n        t += ea[i]\n        if t >= r:\n            la = i\n            break\n\n    history[\"la\"] = la\n    return la\n","1111712c":"%%writefile agent3.py\n\nimport math, random\n\n\nhistory = {\n    \"turn\": 0,\n    \"cnts\": [0] * 100,\n    \"ocnts\": [0] * 100,\n    \"hits\": [0] * 100,\n    \"osteps\": [0] * 100,\n    \"la\": -1,\n}\n\ndef agent3(observation, configuration):\n    global history\n\n    N = 100\n    p = [0.39918, 0.000138129, 1.23946]\n    ti = observation[\"step\"]\n    if ti == 0:\n        pass\n    else:\n        la = history[\"la\"]\n        ola = sum(observation['lastActions']) - la\n        history[\"osteps\"][ola] = ti\n        if sum(history[\"hits\"]) < observation['reward']:\n            history[\"hits\"][la] += 1 \/ pow(0.97, history[\"cnts\"][la] + history[\"ocnts\"][la])\n        history[\"cnts\"][la] += 1\n        history[\"ocnts\"][ola] += 1\n\n    tau = p[0] \/ (ti + 1) + p[1]\n    ea = [0] * N\n    hits = history[\"hits\"]\n    cnts = history[\"cnts\"]\n    ocnts = history[\"ocnts\"]\n    osteps = history[\"osteps\"]\n\n    tv = sorted([(-ocnts[i], osteps[i], i) for i in range(N)])\n    ot = [0] * N\n    for i in range(N):\n        ot[tv[i][2]] = 99 - i\n\n    for i in range(N):\n        if cnts[i] == 0:\n            if ocnts[i] > 1:\n                ea[i] = math.exp(min(500, ot[i] \/ 100 * pow(0.97, ocnts[i]) \/ tau))\n            else:\n                ea[i] = math.exp(min(500, 0.99 * pow(0.97, ocnts[i]) \/ tau))\n        else:\n            w = pow(cnts[i], p[2])\n            wo = ocnts[i]\n            if ocnts[i] < 2:\n                wo = 0\n            r = hits[i] \/ cnts[i]\n            ro = ot[i] \/ 100\n            ea[i] = math.exp(min(500, (r * w + ro * wo) \/ (w + wo) * pow(0.97, cnts[i] + ocnts[i]) \/ tau))\n\n    se = sum(ea)\n    r = random.random() * se\n    t = 0\n    la = 99\n    for i in range(N):\n        t += ea[i]\n        if t >= r:\n            la = i\n            break\n\n    history[\"la\"] = la\n    return la\n","35c9b41f":"from kaggle_environments import make, evaluate\n\nagents = [\"random\", \"agent1.py\", \"agent2.py\", \"agent3.py\"]\nrun_count = 100\n\nfor i in range(4):\n    for j in range(i+1, 4):\n        ak = [0] * 2\n        aw = [0] * 2\n\n        for _ in range(run_count):\n            env = make(\"mab\")\n\n            steps = env.run([agents[i], agents[j]])\n\n            k = [0, 0]\n            for s in steps[1:]:\n                la = s[0]['observation']['lastActions']\n                t = s[0]['observation']['thresholds']\n                try:\n                    k[0] += t[la[0]] \/ 97\n                    k[1] += t[la[1]] \/ 97\n                except Exception as e:\n                    print(e)\n                    print(s)\n\n            ak[0] += k[0]\n            ak[1] += k[1]\n            if k[0] >= k[1]:\n                aw[0] += 1\n            else:\n                aw[1] += 1\n\n        print(f\"{agents[i]} win: {aw[0]} avg: {ak[0] \/ run_count} vs {agents[j]} win: {aw[1]} avg: {ak[1] \/ run_count}\")\n","72e8a717":"\u3042\u308b\u7a0b\u5ea6\u4e0a\u4f4d\u306b\u306f\u5165\u308c\u3066\u3001\u3053\u308c\u4ee5\u4e0a\u306f\u3082\u3046\u826f\u3044\u3060\u308d\u3046\u3068\u3044\u3046\u6c17\u6301\u3061\u306b\u306a\u3063\u305f\u306e\u3067\u65b9\u91dd\u3092\u66f8\u304d\u307e\u3059\n\n* \u63d0\u51fa\u306f\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u5c11\u3057\u5909\u3048\u30665\u3064\u3057\u3066\u307e\u3059\n* agent1(\u521d\u65e5, 650\u304f\u3089\u3044)\n  * \u7d42\u4e86\u3059\u308b\u30bf\u30a4\u30df\u30f3\u30b0\u304c\u308f\u304b\u3063\u3066\u3044\u308b\u591a\u8155\u30d0\u30f3\u30c7\u30a3\u30c3\u30c8\u306f\u3001UCB\u3088\u308aSoftmax Action Selection(?\u540d\u79f0\u304c\u3088\u304f\u308f\u304b\u3063\u3066\u306a\u3044)\u306e\u65b9\u304c\u3088\u304b\u3063\u305f\u8a18\u61b6\u304c\u3042\u308b\u306e\u3067\u3001\u5358\u7d14\u306b\u5b9f\u88c5\n  * \u81ea\u5206\u306e\u884c\u52d5\u3092\u8a18\u9332\u3057\u3066\u304a\u3051\u3070\u3001\u76f8\u624b\u306e\u884c\u52d5\u306f\u3000sum(lastActions) - \u81ea\u5206\u306e\u884c\u52d5 \u3067\u308f\u304b\u308b\n    * \u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3057\u3066\u5fc5\u8981\u306a\u304f\u306a\u3063\u305f\u3063\u307d\u3044\u304c\n  * hits \/ cnts \u3067\u6e1b\u8870\u3057\u3066\u3044\u306a\u3044\u5024\u3092\u5f97\u305f\u304b\u3063\u305f\u306e\u3067\u3001hits\u306b+\u3059\u308b\u3068\u304d\u306b\u5272\u3063\u3066\u308b\n* agent2(\u4e8c\u65e5\u76ee, 900\u5f31?)\n  * \u76f8\u624b\u306e\u884c\u52d5\u3092\u8003\u616e\u3059\u308b\u3088\u3046\u306b\u3057\u305f\n  * \u76f8\u624b\u304c\u8a8d\u8b58\u3057\u3066\u3044\u308b\u512a\u5148\u9806\u4f4d\u3092\u56de\u6570\u3068\u9806\u5e8f\u3067\u63a8\u5b9a\u3001\u512a\u5148\u9806\u4f4d\u9806\u306b99-0\u3092\u5272\u308a\u5f53\u3066\u308b\n  * \u4e0d\u78ba\u5b9f\u306a\u76f8\u624b\u306e\u7d50\u679c\u3088\u308a\u81ea\u5206\u306e\u7d50\u679c\u306e\u65b9\u3092\u512a\u5148\u3057\u305f\u3044\u306e\u3067\u91cd\u307f\u4ed8\u3051\u3092\u5165\u308c\u305f\n* agent3(\u4e09\u65e5\u76ee, 9\u9023\u52dd\u3057\u30661000\u3092\u8d85\u3048\u3066\u308b\u306e\u3082\u3042\u308b)\n  * \u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u8abf\u6574\u304c\u4e0d\u5341\u5206\u3060\u3063\u305f\u3053\u3068\u304c\u308f\u304b\u3063\u305f\u306e\u3067\u8abf\u6574\u3057\u305f","38992ba5":"\u305d\u306e\u4ed6\n\n* \u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u8abf\u6574\u306fC++\u3067\u30b7\u30e5\u30df\u30ec\u30fc\u30b7\u30e7\u30f3\u3059\u308b\u3068\u901f\u3044\n* \u8a55\u4fa1\u306freward\u3088\u308a\u78ba\u7387\u306e\u5408\u8a08\u306e\u65b9\u304c\u6b63\u78ba(\u306a\u306f\u305a)\n* \u3053\u306e\u30b3\u30f3\u30c6\u30b9\u30c8\u3067\u3088\u308a\u4e0a\u4f4d\u306b\u5165\u308b\u305f\u3081\u306b\u3053\u308c\u304b\u3089\u3059\u3079\u304d\u3053\u3068\n  * \u6bce\u65e55\u3064\u63d0\u51fa\u3057\u7d9a\u3051\u308b\n  * \u3059\u3079\u3066\u306e\u63d0\u51fa\u7269\u3092\u8a55\u4fa1\u5bfe\u8c61\u306b\u3057\u3066\u308b\u7406\u7531\u304c\u308f\u304b\u3089\u3093"}}