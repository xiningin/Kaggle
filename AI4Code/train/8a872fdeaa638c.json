{"cell_type":{"90b7906a":"code","bd75c380":"code","6d4b1f26":"code","5c0e1698":"code","e1d89088":"code","4bb96675":"code","b2509631":"code","2067306f":"code","31d694f8":"code","bcf13178":"code","afe7052d":"markdown","1a8c8ef3":"markdown","47da15ad":"markdown","683f08cb":"markdown","d5e12023":"markdown","f594508d":"markdown","025a92f0":"markdown","e28415bc":"markdown","5a9f2437":"markdown","5c894f79":"markdown","a00469e6":"markdown"},"source":{"90b7906a":"import pandas as pd\nimport geopandas as gpd\n\nimport folium\nfrom folium import Choropleth\nfrom folium.plugins import HeatMap\n\nfrom learntools.core import binder\nbinder.bind(globals())\nfrom learntools.geospatial.ex3 import *","bd75c380":"def embed_map(m, file_name):\n    from IPython.display import IFrame\n    m.save(file_name)\n    return IFrame(file_name, width='100%', height='500px')","6d4b1f26":"plate_boundaries = gpd.read_file(\"..\/input\/geospatial-learn-course-data\/Plate_Boundaries\/Plate_Boundaries\/Plate_Boundaries.shp\")\nplate_boundaries['coordinates'] = plate_boundaries.apply(lambda x: [(b,a) for (a,b) in list(x.geometry.coords)], axis='columns')\nplate_boundaries.drop('geometry', axis=1, inplace=True)\n\nplate_boundaries.head()","5c0e1698":"earthquakes = pd.read_csv(\"..\/input\/geospatial-learn-course-data\/earthquakes1970-2014.csv\", parse_dates=[\"DateTime\"])\nearthquakes.head()","e1d89088":"m_1 = folium.Map(location=[35,136], tiles='cartodbpositron', zoom_start=5)\nfor i in range(len(plate_boundaries)):\n    folium.PolyLine(locations=plate_boundaries.coordinates.iloc[i], weight=2, color='black').add_to(m_1)\n\nHeatMap(data=earthquakes[['Latitude', 'Longitude']], radius=10).add_to(m_1)\nembed_map(m_1, 'q_1.html')","4bb96675":"from folium import Choropleth, Circle, Marker\n\nm_2 = folium.Map(location=[35,136], tiles='cartodbpositron', zoom_start=5)\nfor i in range(len(plate_boundaries)):\n    folium.PolyLine(locations=plate_boundaries.coordinates.iloc[i], weight=2, color='black').add_to(m_2)\n\ndef color_producer(val):\n    if val < 50:\n        return 'forestgreen'\n    elif val < 100:\n        return 'darkorange'\n    else:\n        return 'darkred'\n    \nfor i in range(0,len(plate_boundaries)):\n    folium.Circle(\n        location=[earthquakes.iloc[i]['Latitude'], earthquakes.iloc[i]['Longitude']],\n        radius=2000,\n        color=color_producer(earthquakes.iloc[i]['Depth'])).add_to(m_2)\nembed_map(m_2, 'q_2.html')","b2509631":"# GeoDataFrame with prefecture boundaries\nprefectures = gpd.read_file(\"..\/input\/geospatial-learn-course-data\/japan-prefecture-boundaries\/japan-prefecture-boundaries\/japan-prefecture-boundaries.shp\")\nprefectures.set_index('prefecture', inplace=True)\nprefectures.head()","2067306f":"# DataFrame containing population of each prefecture\npopulation = pd.read_csv(\"..\/input\/geospatial-learn-course-data\/japan-prefecture-population.csv\")\npopulation.set_index('prefecture', inplace=True)\n\n# Calculate area (in square kilometers) of each prefecture\narea_sqkm = pd.Series(prefectures.geometry.to_crs(epsg=32654).area \/ 10**6, name='area_sqkm')\nstats = population.join(area_sqkm)\n\n# Add density (per square kilometer) of each prefecture\nstats['density'] = stats[\"population\"] \/ stats[\"area_sqkm\"]\nstats.head()","31d694f8":"m_3 = folium.Map(location=[35,136], tiles='cartodbpositron', zoom_start=5)\n\n\nChoropleth(geo_data=prefectures['geometry'], data=stats['density'], key_on=\"feature.id\", fill_color='YlGnBu', \n           legend_name='Population Density').add_to(m_3)\n\nembed_map(m_3, 'q_3.html')","bcf13178":"m_4 = folium.Map(location=[35,136], tiles='cartodbpositron', zoom_start=5)\n\ndef color_producer(magnitude):\n    if magnitude > 6.5:\n        return 'red'\n    else:\n        return 'green'\n\nChoropleth(\n    geo_data=prefectures['geometry'].__geo_interface__,\n    data=stats['density'],\n    key_on=\"feature.id\",\n    fill_color='BuPu',\n    legend_name='Population density (per square kilometer)').add_to(m_4)\n\nfor i in range(0,len(earthquakes)):\n    folium.Circle(\n        location=[earthquakes.iloc[i]['Latitude'], earthquakes.iloc[i]['Longitude']],\n        popup=(\"{} ({})\").format(\n            earthquakes.iloc[i]['Magnitude'],\n            earthquakes.iloc[i]['DateTime'].year),\n        radius=earthquakes.iloc[i]['Magnitude']**5.5,\n        color=color_producer(earthquakes.iloc[i]['Magnitude'])).add_to(m_4)\nembed_map(m_4, 'q_4.html')","afe7052d":"This function ensures that the maps are visible [in all web browsers](https:\/\/github.com\/python-visualization\/folium\/issues\/812).","1a8c8ef3":"### 2) Relationship between earthquake depth and proximity to a plate boundary in Japan?\n\nYou recently read that the depth of earthquakes tells us [important information](https:\/\/www.usgs.gov\/faqs\/what-depth-do-earthquakes-occur-what-significance-depth?qt-news_science_products=0#qt-news_science_products) about the structure of the earth.  You're interested to see if there are any intereresting global patterns, and you'd also like to understand how depth varies in Japan.\n\n","47da15ad":"### 4) Which high-density prefecture is prone to high-magnitude earthquakes?\n\nCreate a map to suggest one prefecture that might benefit from earthquake reinforcement.  Your map should visualize both density and earthquake magnitude.","683f08cb":"Which three prefectures have relatively higher density than the others?  Are they spread throughout the country, or all located in roughly the same geographical region?  (*If you're unfamiliar with Japanese geography, you might find [this map](https:\/\/en.wikipedia.org\/wiki\/Prefectures_of_Japan) useful to answer the questions.)*\n\nTokyo, Kanagawa, and Osaka have the highest population density. All of these prefectures are located in central Japan, and Tokyo and Kanagawa are adjacent.\n\n\n\n\n\n\n","d5e12023":"### 1) Do earthquakes coincide with plate boundaries?","f594508d":"The next code cell creates a DataFrame `stats` containing the population, area (in square kilometers), and population density (per square kilometer) for each Japanese prefecture.  Run the code cell without changes.","025a92f0":"### 3) Which prefectures have high population density?\n\nRun the next code cell (without changes) to create a GeoDataFrame `prefectures` that contains the geographical boundaries of Japanese prefectures.","e28415bc":"Which prefecture do you recommend for extra earthquake reinforcement?\n\nWhile there's no clear, single answer to this question, there are a few reasonable options. Tokyo is by far the most densely populated prefecture and has also experienced a number of earthquakes. Osaka is relatively less densely populated, but experienced an earthquake that was relatively stronger than those near Tokyo. And, the long coast of Kanagawa (in addition to its high density and the historical proximity of strong earthquakes) might lead us to worry about the added potential tsunami risk.","5a9f2437":"Can you detect a relationship between proximity to a plate boundary and earthquake depth?  Does this pattern hold globally?  In Japan?\n\nIn the northern half of Japan, it does appear that earthquakes closer to plate boundaries tend to be shallower (and earthquakes farther from plate boundaries are deeper). This pattern is repeated in other locations, such as the western coast of South America. But, it does not hold everywhere (for instance, in China, Mongolia, and Russia).","5c894f79":"The code cell below visualizes the plate boundaries on a map.  Use all of the earthquake data to add a heatmap to the same map, to determine whether earthquakes coincide with plate boundaries.  ","a00469e6":"## Earthquakes concides with plate boundaries as obvious from the heatmap"}}