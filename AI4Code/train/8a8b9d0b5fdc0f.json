{"cell_type":{"9f777f3e":"code","bb85b37a":"code","3ec06787":"markdown","218e8336":"markdown","85f0a35f":"markdown"},"source":{"9f777f3e":"import numpy as np \nimport pandas as pd \nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n# for the fitting\nfrom scipy.optimize import curve_fit\nfrom scipy.stats import levy_stable\n\n# install and use the yfinance package, written by Ran Aroussi\n# https:\/\/github.com\/ranaroussi\/yfinance\n!pip -q install yfinance\nimport yfinance as yf\n\n# the S&P 500 ticker symbol is GSPC\nSP500 = yf.Ticker(\"^GSPC\")\n \nSP500_values = SP500.history(start=\"1957-03-04\")\n\n# https:\/\/pandas.pydata.org\/pandas-docs\/stable\/reference\/api\/pandas.DataFrame.pct_change.html\nSP500_values['pct_change'] = SP500_values.Close.pct_change(periods = 1)\n\n# now produce the plot\nplt.figure(figsize = (15,8))\nax = sns.histplot(SP500_values['pct_change'], binwidth=0.0005)\nvalues = np.array([rec.get_height() for rec in ax.patches])\nnorm = plt.Normalize(values.min(), values.max())\ncolors = plt.cm.jet_r(norm(values))\nfor rec, col in zip(ax.patches, colors):\n    rec.set_color(col)\nplt.title(\"Histogram of the daily returns for the S&P 500 (since 1957)\", size=16)\nplt.xlabel(\"Daily change in close (%)\", fontsize=16)\nplt.ylabel(\"Frequency\", fontsize=16)\nplt.xlim(-0.05, 0.05);","bb85b37a":"# define a Gaussian function\ndef Gaussian(x,mu,sigma,A):\n    return A*np.exp(-0.5 * ((x-mu)\/sigma)**2)\n# define a Lorentzian function\ndef Lorentzian(x, x0, gamma, A):\n    return A * gamma**2\/(gamma**2+( x - x0 )**2)\n\nn_values = values.shape[0]\nxmin = SP500_values['pct_change'].min()\nxmax = SP500_values['pct_change'].max()\ndelta = xmax-xmin\nx = np.arange(xmin, xmax, (delta\/n_values))\ny = values\n\n# seed guess\ninitial_guess=(0, 0.005, 300)\n\n# the Gaussian fit\nG_parameters,G_covariance=curve_fit(Gaussian,x,y,initial_guess)\nG_sigma=np.sqrt(np.diag(G_covariance))\n\n# the Lorentzian fit\nL_parameters,L_covariance=curve_fit(Lorentzian,x,y,initial_guess)\nL_sigma=np.sqrt(np.diag(L_covariance))\n\n# and plot\nplt.figure(figsize = (15,8))\nax = sns.histplot(SP500_values['pct_change'], binwidth=0.0005, color='orange')\nax = plt.plot(x,Gaussian(x,*G_parameters),  color='red', lw=3,label='Normal fit', alpha=0.8)\nax = plt.plot(x,Lorentzian(x,*L_parameters),color='blue',lw=3,label='Cauchy fit', alpha=0.8)\nax = plt.plot(x, levy_stable.pdf(x, 1.2, 0, 0, 1\/200)*8,color='green',lw=3,label='L\u00e9vy alpha-stable (\u03b1=1.2)', alpha=0.8)\nplt.title(\"Normal and Cauchy distribution fits\", size=16)\nplt.legend(loc=\"upper left\", fontsize=16)\nplt.xlabel(\"Daily change in close (%)\", fontsize=16)\nplt.ylabel(\"Frequency\", fontsize=16)\nplt.xlim(-0.05, 0.05);","3ec06787":"and now with the [Normal](https:\/\/en.wikipedia.org\/wiki\/Normal_distribution) and [Cauchy distribution](https:\/\/en.wikipedia.org\/wiki\/Cauchy_distribution) fits, along with a [L\u00e9vy alpha-stable distribution](https:\/\/en.wikipedia.org\/wiki\/Stable_distribution).","218e8336":"We can see that the actual distribution of returns lies somewhere in between the Normal and the Cauchy distributions.","85f0a35f":"# S&P 500 daily returns: Normal and Cauchy distribution fits\nWe shall take a look at the [S&P 500](https:\/\/en.wikipedia.org\/wiki\/S%26P_500) stock market daily returns, using data from 1957 to date (*i.e.* over 16 thousand days of data).\n\nHere we define the daily return as being the percentage change in the closing prices between consecutive trading days."}}