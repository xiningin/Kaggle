{"cell_type":{"79536be8":"code","1ee337cf":"code","5fdc8f74":"code","8b71aac2":"code","b41214b1":"code","2add7d7c":"code","4727a1fc":"code","9a248474":"code","0b73a832":"code","6492642e":"code","58cebb9a":"code","539d95ef":"code","1c3acfec":"code","5a2d9273":"code","7f6230f6":"code","f67bcbd1":"code","9c0f2a84":"markdown","96a82a7d":"markdown","4a753648":"markdown","696d6bfd":"markdown"},"source":{"79536be8":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport warnings\nwarnings.filterwarnings('ignore')\n\nimport os","1ee337cf":"brand_shoptype = pd.read_csv('\/kaggle\/input\/ptr-rd1\/Extra_material_2.csv')\ntransaction = pd.read_csv('\/kaggle\/input\/ptr-rd1\/Extra_material_3.csv', parse_dates=['date_id'])\n\nprint('brand_shoptype shape:', brand_shoptype.shape)\nprint('transaction shape:', transaction.shape)","5fdc8f74":"all_brands = np.sort(brand_shoptype.brand.unique())","8b71aac2":"# filter only official shop\nbrand_shoptype = brand_shoptype[brand_shoptype['shop_type'] == 'Official Shop']\n\nbrand_shoptype['shop_id'] = brand_shoptype['shop_id'].astype(int)","b41214b1":"# filter only transaction from 10th May to 31st May\nstart_date = '2019-5-10'\nend_date = '2019-5-31'\n\nmask = (transaction['date_id'] >= start_date) & (transaction['date_id'] <= end_date)\n\ntransaction = transaction.loc[mask]","2add7d7c":"# drop duplicates row\ntransaction.drop_duplicates(inplace=True)\nbrand_shoptype.drop_duplicates(inplace=True)","4727a1fc":"error_idx = brand_shoptype[brand_shoptype['brand'] == 'Anessa, Senka, Za, Tsubaki, Ma Cherie'].index\n\nbrand_shoptype.drop(error_idx, inplace=True)","9a248474":"# filter only shop_id which is exist in transaction\nbrand_shoptype = brand_shoptype[brand_shoptype['shop_id'].isin(transaction['shopid'])]","0b73a832":"brand_shoptype.head()","6492642e":"transaction.head()","58cebb9a":"# there are 4 shop_id that have 2 brands\nbrand_shoptype.groupby('shop_id')['brand'].nunique().sort_values(ascending=False)[:5]","539d95ef":"transaction.rename(columns={'shopid': 'shop_id'}, inplace=True)\n\nfinal_df = brand_shoptype.merge(transaction, on='shop_id', how='left')\n\nfinal_df.head()","1c3acfec":"final_df['gross_sales_revenue'] = final_df['amount'].values * final_df['item_price_usd'].values","5a2d9273":"final_df.sample(5)","7f6230f6":"for_submission = pd.DataFrame({})\n\nfor_submission['Index'] = range(1, len(all_brands) + 1)\nfor_submission['Answers'] = ''\n\nfor idx, brand in enumerate(all_brands):\n    result = final_df[final_df['brand'] == brand].groupby('itemid')['gross_sales_revenue'].sum().rename('gross_sales').sort_values(ascending=False)[:3].reset_index()\n    if len(result['itemid']) > 0:\n        for_submission.at[idx, 'Answers'] += (str(brand) + ', ')\n        for itemid in result['itemid']:\n            for_submission.at[idx, 'Answers'] += (str(itemid) + ', ')\n    else:\n        for_submission.at[idx, 'Answers'] += (str(brand) + ', N.A,,')\n        \nfor_submission['Answers'] = for_submission['Answers'].apply(lambda x: x[:-2])","f67bcbd1":"for_submission.to_csv('submission1.csv', index=False)","9c0f2a84":"## Task (look again for better understanding)\n\nWrite a function(s) that takes in a brand as an input and answer the following question:\n\n> ### The Top 3 itemids (in a list) from the \u2018Official Shop\u2019 of that particular brand that generated the highest Gross Sales Revenue from 10th May to 31st May 2019.\n\nNote: Not all brands will have 3 itemids, in cases where there are none output should return N.A","96a82a7d":"## Result:\n\n* This submission only get 0.88888 in Public Score\n* But got 0.97119 in Private Score","4a753648":"## Task\n\nWrite a function(s) that takes in a brand as an input and answer the following question:\n\n> ### The Top 3 itemids (in a list) from the \u2018Official Shop\u2019 of that particular brand that generated the highest Gross Sales Revenue from 10th May to 31st May 2019.\n\nNote: Not all brands will have 3 itemids, in cases where there are none output should return N.A","696d6bfd":"* If you check, you'll found 'Anessa, Senka, Za, Tsubaki, Ma Cherie' in brand unique values\n* I decided to drop this so that every shop_id only have 1 brand, not mix"}}