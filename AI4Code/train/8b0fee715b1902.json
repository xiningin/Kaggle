{"cell_type":{"92619ffb":"code","d7f26fac":"code","28192bd5":"code","a4d2be01":"code","74bafa8d":"code","adc6e0cd":"code","07bcd0be":"code","31fa2273":"code","aa1edba2":"code","4b2d5188":"code","6d8672ca":"code","e21eb18c":"code","49598e84":"code","b64884ec":"code","dc7006e2":"code","70c38d4d":"code","edb134ff":"code","98c34c14":"code","bc0edff7":"code","74da3442":"code","87b0f162":"markdown","573f99ae":"markdown","f35d819c":"markdown","fef8f4f7":"markdown","3818b66d":"markdown","0de1f2bb":"markdown","daa0d9d1":"markdown","ed1e1a1f":"markdown","b54bf814":"markdown","cad70e4b":"markdown","15f7bc82":"markdown","a5f0387f":"markdown","e601edc8":"markdown","4351170c":"markdown","16d5ab65":"markdown","c8a35a72":"markdown","6a041ed4":"markdown","564253c9":"markdown","97765123":"markdown","b0752436":"markdown","8678c296":"markdown","015dc008":"markdown","434451d7":"markdown","73263b94":"markdown","94b72597":"markdown","3cca6017":"markdown","46187190":"markdown","228bacb1":"markdown","bfbcde0e":"markdown"},"source":{"92619ffb":"import pandas as pd \nfrom datetime import datetime\nimport numpy as np \nfrom sklearn.linear_model import LinearRegression\nimport matplotlib.pyplot as plt","d7f26fac":"SPY_data = pd.read_csv(\"..\/input\/data-science-project-lifecycle\/SPY_2015.csv\")\n \n# Change the Date column from object to datetime object \nSPY_data[\"Date\"] = pd.to_datetime(SPY_data[\"Date\"])\n \n# Preview the data\nSPY_data.head(10)","28192bd5":"# Set Date as index\nSPY_data.set_index('Date',inplace=True)\n \n# Reverse the order of the dataframe in order to have oldest values at top\nSPY_data.sort_values('Date',ascending=True)","a4d2be01":"# Take the name of the columns of the SPY_data to see if null values exists\nvariables = SPY_data.columns \nSPY_data.isnull().sum().loc[variables]","74bafa8d":"jet= plt.get_cmap('jet')\ncolors = iter(jet(np.linspace(0,1,10)))\n \ndef correlation(df,variables, n_rows, n_cols):\n    fig = plt.figure(figsize=(8,6))\n    #fig = plt.figure(figsize=(14,9))\n    for i, var in enumerate(variables):\n        ax = fig.add_subplot(n_rows,n_cols,i+1)\n        asset = df.loc[:,var]\n        ax.scatter(df[\"Adj Close\"], asset, c = next(colors))\n        ax.set_xlabel(\"Adj Close\")\n        ax.set_ylabel(\"{}\".format(var))\n        ax.set_title(var +\" vs price\")\n    fig.tight_layout() \n    plt.show()","adc6e0cd":"# Is there any correlation between Volume and Adj Close price?\nvariables =SPY_data.columns[-1:] # read last column name\ncorrelation(SPY_data,variables,1,1)","07bcd0be":"# Is there any correlation between Adj Close price vs. Open, High, Low, Close?\nvariables =SPY_data.columns#[0:6]   \ncorrelation(SPY_data,variables,3,3)","31fa2273":"SPY_data.corr()['Adj Close'].loc[variables]","aa1edba2":"SPY_data['High-Low_pct'] = (SPY_data['High'] - SPY_data['Low']).pct_change()\nSPY_data['ewm_5'] = SPY_data[\"Close\"].ewm(span=5).mean().shift(periods=1)\nSPY_data['price_std_5'] = SPY_data[\"Close\"].rolling(center=False,window= 30).std().shift(periods=1)\n \nSPY_data['volume Change'] = SPY_data['Volume'].pct_change()\nSPY_data['volume_avg_5'] = SPY_data[\"Volume\"].rolling(center=False,window=5).mean().shift(periods=1)\nSPY_data['volume Close'] = SPY_data[\"Volume\"].rolling(center=False,window=5).std().shift(periods=1)","4b2d5188":"jet= plt.get_cmap('jet')\ncolors = iter(jet(np.linspace(0,1,10)))\n\n# Take the name of the last 6 columns of the SPY_data which are the model features\nvariables = SPY_data.columns[-6:]  \n \ncorrelation(SPY_data,variables,3,3)","6d8672ca":"SPY_data.corr()['Adj Close'].loc[variables]","e21eb18c":"SPY_data.head(5)","49598e84":"SPY_data.isnull().sum().loc[variables]","b64884ec":"# To train a model, it is necessary to drop missing values.\nSPY_data = SPY_data.dropna(axis=0)","dc7006e2":"# Generate the train and test sets\ntrain = SPY_data[SPY_data.index < datetime(year=2015, month=1, day=1)]\n\ntest = SPY_data[SPY_data.index >= datetime(year=2015, month=1, day=1)]\ndates = test.index","70c38d4d":"lr = LinearRegression()\nX_train = train[[\"High-Low_pct\",\"ewm_5\",\"price_std_5\",\"volume_avg_5\",\"volume Change\",\"volume Close\"]]\n \nY_train = train[\"Adj Close\"]\n \nlr.fit(X_train,Y_train) ","edb134ff":"# Create the test features dataset (X_test) which will be used to make the predictions.\nX_test = test[[\"High-Low_pct\",\"ewm_5\",\"price_std_5\",\"volume_avg_5\",\"volume Change\",\"volume Close\"]].values \n\n# The labels of the model\nY_test = test[\"Adj Close\"].values # will be used for comparison","98c34c14":"close_predictions = lr.predict(X_test) ","bc0edff7":"mae = sum(abs(close_predictions - test[\"Adj Close\"].values)) \/ test.shape[0]\nprint(mae)","74da3442":"# Create a dataframe that output the Date, the Actual and the predicted values\ndf = pd.DataFrame({'Date':dates,'Actual': Y_test, 'Predicted': close_predictions})\ndf1 = df.tail(25)\n \n# set the date with string format for plotting\ndf1['Date'] = df1['Date'].dt.strftime('%Y-%m-%d')\n \ndf1.set_index('Date',inplace=True)\n \nerror = df1['Actual'] - df1['Predicted']\n \n# Plot the error term between the actual and predicted values for the last 25 days\n \nerror.plot(kind='bar',figsize=(8,6))\nplt.grid(which='major', linestyle='-', linewidth='0.5', color='green')\nplt.grid(which='minor', linestyle=':', linewidth='0.5', color='black')\nplt.xticks(rotation=45)\nplt.show()","87b0f162":"# Check Null Values","573f99ae":"# **Drop\/Remove NA records**","f35d819c":"# **Building Regression Model**","fef8f4f7":"# **Correlation**","3818b66d":"# Correlation with New features","0de1f2bb":"# **Step 3: Data Cleansing and Transformation**","daa0d9d1":"**Import Libraries**","ed1e1a1f":"# **Problem Statement: Prediction of Yahoo Stock Market**","b54bf814":"**Indexing and Sorting**","cad70e4b":"# **Test Dataset**","15f7bc82":"**Mean Absolute Error (MAE):**","a5f0387f":"# **Is there any correlation between Adj Close price vs. Open, High, Low, Close ?**","e601edc8":"In statistics, mean absolute error (MAE) is a measure of errors between paired observations expressing the same phenomenon. Examples of Y versus X include comparisons of predicted versus observed, subsequent time versus initial time, and one technique of measurement versus an alternative technique of measurement. MAE is calculated as:\n![..\/input\/data-science-project-lifecycle\/mae_eq.PNG](http:\/\/)\nThe mean absolute error is a common measure of forecast error in time series analysis.","4351170c":"**Read Dataset**","16d5ab65":"The MAE value is approx. 18.","c8a35a72":"# **Error Graph for last 25 days**","6a041ed4":"# **Prediction**","564253c9":"The problem we are facing is what will be the value of Yahoo's assets in the near future? At this stage some additional questions also need to be reviewed to get a better and more useful data set. For example, what are the factors that can be overlooked in asset prices? Isn't the price dependent on the depreciation of competing companies? Do foreign policies affect asset value? Is inflation not the reason for the rise in asset prices? Etc etc\n","97765123":"# **Step 6: Build Predictive Model**","b0752436":"# **Step 1: Busines Understanding**","8678c296":"# **Step 4: Exploratory Data Analysis**","015dc008":"***Check Null values***","434451d7":"# **Train & Test Dataset Distribution**","73263b94":"# **Step 5: Featuer Engineering**","94b72597":"# Is there any correlation between Volume and Adj Close price?","3cca6017":"# **Data Set: Yahoo Stock Price**","46187190":"Simple error (Actual - Predicted) computered and ploted for last 25 days.","228bacb1":"# **Model Evaluation**","bfbcde0e":"# **Step 2: Data Exploration**"}}