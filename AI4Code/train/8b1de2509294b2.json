{"cell_type":{"f383f370":"code","e9afd604":"code","474afc0f":"code","eaf2056e":"code","529c9b8a":"code","58d8b847":"code","9a5b55d8":"code","1f0e48e4":"code","9d1ca3eb":"code","8aeee220":"code","e5c04a76":"code","6cd8e4f3":"code","04cd97f4":"code","c1f9630a":"code","1771b506":"code","5b1f3c7b":"code","e4420b04":"code","e36325a2":"code","2e0c7613":"code","680e7cf5":"code","64006f7a":"code","6ecf2da2":"code","93b46229":"code","225fff5a":"markdown","9f0f91db":"markdown","593f7363":"markdown","a3f0afd9":"markdown","903c0b3f":"markdown"},"source":{"f383f370":"!pip install \"torch==1.4\" \"torchvision==0.5.0\"","e9afd604":"import numpy as np\nimport pandas as pd","474afc0f":"from fastai.vision import *\nfrom fastai.metrics import error_rate","eaf2056e":"%reload_ext autoreload\n%autoreload 2\n%matplotlib inline","529c9b8a":"from shutil import copyfile\ncopyfile(src = \"..\/input\/cutmix\/shared\/0_image_data_augmentation\/exp\/nb_new_data_augmentation.py\" , \n         dst = \"..\/working\/nb_new_data_augmentation.py\")","58d8b847":"from nb_new_data_augmentation import *","9a5b55d8":"path = Path('..\/input\/shopee-round-2-product-detection-challenge')\npath","1f0e48e4":"# change filename and category name\n# i chose 1000 data for each group\nN = 1000 #number of data in each category\ndf = pd.read_csv('\/content\/train.csv')\ndf = df.groupby('category').apply(lambda x: x[:N]).reset_index(drop=True)\ndf['filename'] = 'train\/' + df['category'].apply(lambda x: '{0:0>2}'.format(x)).apply(str)+'\/'+df['filename']\n\ndf['category'] = df['category'].replace({0: '00 Dress',1: '01 Sarung',2: '02 Shirt(Top)',3: '03 Long Sleeves\/Hoodie',4: '04 Jeans(Female)',5: '05 Ring',6: '06 Ear Rings',7: '07 Cap',8: '08 Purse\/Wallet',9: '09 Bags',10: '10 Phone Cover',11: '11 Phone',12: '12 Clock',13: '13 Plastic Baby Bottles',14: '14 Rice Cooker',15: '15 Coffee',16: '16 Shoe',17: '17 High Heels',18: '18 Aircon',19: '19 Pendrive',20: '20 Chair',21: '21 Racket',22: '22 Helmet',23: '23 Gloves',24: '24 Watch',25: '25 Belt',26: '26 Headphones\/Earpiece',27: '27 Toy Car',28: '28 Suit\/Jacket (Male)',29: '29 Tuxedo Pants (Male)',30: '30 Sport Shoes',31: '31 Biscuit\/ Junk Food',32: '32 Face Mask',33: '33 Sanitizer\/Antiseptic',34: '34 Skin Care(?)',35: '35 Perfume\/Cologne',36: '36 Cleaning Supplies',37: '37 Laptop',38: '38 Bowls',39: '39 Vases?',40: '40 Shower Stuff(Showerhead)',41: '41 Sofa',})\ndf","9d1ca3eb":"# batchsize\nbs = 64","8aeee220":"# Loading data using ImageDataBunch.from_df\nnp.random.seed(0)\ndata = ImageDataBunch.from_df(path, df, folder='\/train\/train',valid_pct=0.2,\n                              test='test\/test\/test',\n                              ds_tfms=get_transforms(), \n                              size=224, bs=bs\n                              ).normalize(imagenet_stats)","e5c04a76":"# checking data\ndata.show_batch(rows=3, figsize=(10, 5))","6cd8e4f3":"# using model resnet50 and applying cutmix in the image\nlearn = cnn_learner(data, models.resnet50, \n                    metrics=[error_rate, accuracy]\n                   ).cutmix().show_multi_img_tfms()","04cd97f4":"learn.model_dir = '\/kaggle\/working\/'","c1f9630a":"learn.lr_find()\nlearn.recorder.plot(suggestion=True)","1771b506":"learn.fit_one_cycle(8, max_lr=2e-3)","5b1f3c7b":"learn.unfreeze()","e4420b04":"learn.lr_find()\nlearn.recorder.plot(suggestion=True)","e36325a2":"learn.fit_one_cycle(8, max_lr=slice(1e-5 , lr\/5))","2e0c7613":"# Predict Using TTA\npreds, y = learn.TTA(ds_type=DatasetType.Test)","680e7cf5":"category = [data.classes[int(x)][:2] for x in np.argmax(preds, 1)]","64006f7a":"filename = []\nnum = len(learn.data.test_ds)\nfor i in range(num):\n    filename.append(str(learn.data.test_ds.items[i]).split('\/')[-1])","6ecf2da2":"test_csv = pd.read_csv('..\/input\/shopee-round-2-product-detection-challenge\/test.csv')\nsubmit = pd.DataFrame({'filename':filename,'category':category})\nsubmit = submit[submit['filename'].isin(test_csv['filename'])]\nsubmit","93b46229":"submit.to_csv('submission.csv', header=True, index=False)","225fff5a":"# Load data \nI have no time to clean the data so if you clean it it probably will be better a lot","9f0f91db":"I never learn machine learning, this is the first time trying. Feel Free to comment on the codes.","593f7363":"# Importing Library ","a3f0afd9":"# Predict Using TTA","903c0b3f":"# Train"}}