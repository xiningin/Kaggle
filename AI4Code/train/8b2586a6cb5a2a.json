{"cell_type":{"c07e767a":"code","2dd89d6a":"code","31534bc7":"code","2fffba28":"code","53db5958":"code","ddac74de":"code","a40b666b":"code","805cb152":"code","af801767":"code","24a8b3df":"code","fc0b1261":"code","75abe247":"code","c3d09e76":"code","0a4379a7":"code","2fd35e93":"code","dba1c38c":"code","3dcd317b":"code","c213897b":"code","67598742":"code","913dd753":"code","975ba0c7":"code","89cc2513":"code","7884c784":"code","6c064caf":"markdown","5cbf1cb4":"markdown","6b6c018f":"markdown","61d98858":"markdown","9a506b04":"markdown","976a6975":"markdown","708011b0":"markdown","06ce2f7b":"markdown","ad8e1323":"markdown","b4908d76":"markdown","b514ca70":"markdown","c11fd49c":"markdown","a0e2554b":"markdown","555a92cd":"markdown"},"source":{"c07e767a":"import pandas as pd\nimport ast\nfrom collections import defaultdict\nfrom plotnine import *","2dd89d6a":"df = pd.read_csv('..\/input\/the-movies-dataset\/credits.csv')\ndf.head()","31534bc7":"count1, count2 = 0, 0\nfor index, row in df.iterrows():\n    cast_list = ast.literal_eval(row['cast'])\n    crew_list = ast.literal_eval(row['crew'])\n    if len(cast_list) == 0:\n        count1 += 1\n    if len(crew_list) == 0:\n        count2 += 1\nprint('Empty cast percentage:', str('{:.2f}'.format(count1\/len(df) * 100))+'%')\nprint('Empty crew percentage:', str('{:.2f}'.format(count2\/len(df) * 100))+'%')","2fffba28":"df = df[(df['cast'] != '[]') & (df['crew'] != '[]')].reset_index(drop=True)\ndf","53db5958":"df_new = pd.DataFrame(columns=[\n    'id', \n    'cast_total_num', \n    'cast_female_num', \n    'cast_male_num', \n    'cast_unknown_num',\n    'crew_total_num', \n    'crew_female_num', \n    'crew_male_num',\n    'crew_unknown_num',\n    'Directing_total', \n    'Directing_female',\n    'Directing_male',\n    'Directing_unknown',\n    'Writing_total',\n    'Writing_female',\n    'Writing_male',\n    'Writing_unknown',\n    'Production_total',\n    'Production_female',\n    'Production_male',\n    'Production_unknown',\n    ])\ndf_new['id'] = df['id']\ndf_new.head()","ddac74de":"overview_info = defaultdict(int)\ncutoff = 20\n\nfor index, row in df[:cutoff].iterrows():\n# for index, row in df.iterrows():\n    cast_info, crew_info, crew_department = defaultdict(int), defaultdict(int), defaultdict(int)\n    cast_list = ast.literal_eval(row['cast'])\n    crew_list = ast.literal_eval(row['crew'])\n\n    # count everything in cast\n    for cast in cast_list:\n        if cast['gender'] == 2:\n            cast_info['male'] += 1\n        elif cast['gender'] == 1:\n            cast_info['female'] += 1\n        elif cast['gender'] == 0:\n            cast_info['unknown'] += 1\n        else:\n            print(f'Oops1 index{index} is unusal: {cast}')\n    df_new.at[index, 'cast_total_num'] = len(cast_list)\n    df_new.at[index, 'cast_female_num'] = cast_info['female']\n    df_new.at[index, 'cast_male_num'] = cast_info['male']\n    df_new.at[index, 'cast_unknown_num'] = cast_info['unknown']\n\n    # count evetything in crew\n    for crew in crew_list:\n        if crew['gender'] == 2:\n            crew_info['male'] += 1\n            crew_department[str(crew['department'])+'_male'] += 1\n            crew_department[str(crew['department'])+'_total'] += 1\n        elif crew['gender'] == 1:\n            crew_info['female'] += 1\n            crew_department[str(crew['department'])+'_female'] += 1\n            crew_department[str(crew['department'])+'_total'] += 1\n        elif crew['gender'] == 0:\n            crew_info['unknown'] += 1\n            crew_department[str(crew['department'])+'_unknown'] += 1\n            crew_department[str(crew['department'])+'_total'] += 1\n        else:\n            print(f'Oops2 index{index} is unusal: {crew}')\n    df_new.at[index, 'crew_total_num'] = len(crew_list)\n    df_new.at[index, 'crew_female_num'] = crew_info['female']\n    df_new.at[index, 'crew_male_num'] = crew_info['male']\n    df_new.at[index, 'crew_unknown_num'] = crew_info['unknown']\n\n    # aggregate all counts to overview data\n    overview_info['cast_total'] += len(cast_list)\n    for cast_gender, count in cast_info.items():\n        overview_info['cast_'+str(cast_gender)] += count\n    overview_info['crew_total'] += len(crew_list)\n    for crew_gender, count in crew_info.items():\n        overview_info['crew_'+str(crew_gender)] += count\n    for department, count in crew_department.items():\n        overview_info[department] += count\n        df_new.at[index, department] = count\n\ndf_new.head()","a40b666b":"df_new = df_new.fillna(0) # replace all the NaN with 0\ndf_new.head()","805cb152":"print('Percentage of unknowns in Cast:', overview_info['cast_unknown']\/overview_info['cast_total'])\nprint('Percentage of unknowns in Crew:', overview_info['crew_unknown']\/overview_info['crew_total'])\nprint('Percentage of unknowns in Directing:', overview_info['Directing_unknown']\/overview_info['Directing_total'])\nprint('Percentage of unknowns in Writing:', overview_info['Writing_unknown']\/overview_info['Writing_total'])\nprint('Percentage of unknowns in Production:', overview_info['Production_unknown']\/overview_info['Production_total'])","af801767":"%pip install gender-guesser","24a8b3df":"import gender_guesser.detector as gender\nd = gender.Detector()","fc0b1261":"# Now let's count again using the gender guesser package\ndf_new = pd.DataFrame(columns=[\n    'id', \n    'cast_total_num', \n    'cast_female_num', \n    'cast_male_num', \n    'cast_unknown_num',\n    'crew_total_num', \n    'crew_female_num', \n    'crew_male_num',\n    'crew_unknown_num',\n    'Directing_total', \n    'Directing_female',\n    'Directing_male',\n    'Directing_unknown',\n    'Writing_total',\n    'Writing_female',\n    'Writing_male',\n    'Writing_unknown',\n    'Production_total',\n    'Production_female',\n    'Production_male',\n    'Production_unknown',\n    ])\ndf_new['id'] = df['id']\n\noverview_info = defaultdict(int)\n\n# for index, row in df[:cutoff].iterrows():\nfor index, row in df.iterrows():\n    cast_info, crew_info, crew_department = defaultdict(int), defaultdict(int), defaultdict(int)\n    cast_list = ast.literal_eval(row['cast'])\n    crew_list = ast.literal_eval(row['crew'])\n\n    # count everything in cast\n    for cast in cast_list:\n        if cast['gender'] == 2: # male\n            cast_info['male'] += 1\n        elif cast['gender'] == 1: # female\n            cast_info['female'] += 1\n        elif cast['gender'] == 0: # unknown gender so we predict from first name\n            first_name = cast['name'].split(' ')[0]\n            predicted_gender = d.get_gender(first_name)\n            if predicted_gender == 'male' or predicted_gender == 'mostly_male':\n                cast_info['male'] += 1\n            elif predicted_gender == 'female' or predicted_gender == 'mostly_female':\n                cast_info['female'] += 1\n            elif predicted_gender == 'unknown' or predicted_gender == 'andy':\n                cast_info['unknown'] += 1\n        else:\n            print(f'Oops1 index{index} is unusal: {cast}')\n    df_new.at[index, 'cast_total_num'] = len(cast_list)\n    df_new.at[index, 'cast_female_num'] = cast_info['female']\n    df_new.at[index, 'cast_male_num'] = cast_info['male']\n    df_new.at[index, 'cast_unknown_num'] = cast_info['unknown']\n\n    # count evetything in crew\n    for crew in crew_list:\n        if crew['gender'] == 2:\n            crew_info['male'] += 1\n            crew_department[str(crew['department'])+'_male'] += 1\n            crew_department[str(crew['department'])+'_total'] += 1\n        elif crew['gender'] == 1:\n            crew_info['female'] += 1\n            crew_department[str(crew['department'])+'_female'] += 1\n            crew_department[str(crew['department'])+'_total'] += 1\n        elif crew['gender'] == 0:\n            first_name = crew['name'].split(' ')[0]\n            predicted_gender = d.get_gender(first_name)\n            if predicted_gender == 'male' or predicted_gender == 'mostly_male':\n                crew_info['male'] += 1\n                crew_department[str(crew['department'])+'_male'] += 1\n            elif predicted_gender == 'female' or predicted_gender == 'mostly_female':\n                crew_info['female'] += 1\n                crew_department[str(crew['department'])+'_female'] += 1\n            elif predicted_gender == 'unknown' or predicted_gender == 'andy':\n                crew_info['unknown'] += 1\n                crew_department[str(crew['department'])+'_unknown'] += 1\n            crew_department[str(crew['department'])+'_total'] += 1\n        else:\n            print(f'Oops2 index{index} is unusal: {crew}')\n    df_new.at[index, 'crew_total_num'] = len(crew_list)\n    df_new.at[index, 'crew_female_num'] = crew_info['female']\n    df_new.at[index, 'crew_male_num'] = crew_info['male']\n    df_new.at[index, 'crew_unknown_num'] = crew_info['unknown']\n\n    # aggregate all counts to overview data\n    overview_info['cast_total'] += len(cast_list)\n    for cast_gender, count in cast_info.items():\n        overview_info['cast_'+str(cast_gender)] += count\n    overview_info['crew_total'] += len(crew_list)\n    for crew_gender, count in crew_info.items():\n        overview_info['crew_'+str(crew_gender)] += count\n    for department, count in crew_department.items():\n        overview_info[department] += count\n        df_new.at[index, department] = count\n\ndf_new.head()","75abe247":"print('Percentage of unknowns in Cast:', overview_info['cast_unknown']\/overview_info['cast_total'])\nprint('Percentage of unknowns in Crew:', overview_info['crew_unknown']\/overview_info['crew_total'])\nprint('Percentage of unknowns in Directing:', overview_info['Directing_unknown']\/overview_info['Directing_total'])\nprint('Percentage of unknowns in Writing:', overview_info['Writing_unknown']\/overview_info['Writing_total'])\nprint('Percentage of unknowns in Production:', overview_info['Production_unknown']\/overview_info['Production_total'])","c3d09e76":"(ggplot(df_new,\n        aes(x=\"cast_female_num\")) + \n    geom_bar()\n)","0a4379a7":"(ggplot(df_new,\n        aes(x=\"crew_female_num\")) + \n    geom_bar()\n)","2fd35e93":"ratio_df = pd.DataFrame()\nratio_df['cast_female_ratio'] = df_new['cast_female_num'] \/ df_new['cast_total_num']\nratio_df['crew_female_ratio'] = df_new['crew_female_num'] \/ df_new['crew_total_num']\nratio_df['directing_female_ratio'] = df_new['Directing_female'] \/ df_new['Directing_total']\nratio_df['writing_female_ratio'] = df_new['Writing_female'] \/ df_new['Writing_total']\nratio_df['production_female_ratio'] = df_new['Production_female'] \/ df_new['Production_total']\nratio_df","dba1c38c":"ratio_df.isna().sum()","3dcd317b":"ratio_df_no_nan = ratio_df.dropna().reset_index(drop=True)\nratio_df_no_nan","c213897b":"ratio_df_no_nan.describe().T","67598742":"(ggplot(ratio_df_no_nan,\n        aes(x=\"cast_female_ratio\")) + \n    geom_histogram() + \n    labs(\n        title = 'Histogram of Female Cast Ratio',\n        x = 'Female Cast Ratio',\n        y = 'Frequency'\n    )\n)","913dd753":"(ggplot(ratio_df_no_nan,\n        aes(x=\"crew_female_ratio\")) + \n    geom_histogram() + \n    labs(\n        title = 'Histogram of Female Crew Ratio',\n        x = 'Female Crew Ratio',\n        y = 'Frequency'\n    )\n)","975ba0c7":"(ggplot(ratio_df_no_nan,\n        aes(x=\"directing_female_ratio\")) + \n    geom_histogram() + \n    labs(\n        title = 'Histogram of Female Directing Ratio',\n        x = 'Female Directing Ratio',\n        y = 'Frequency'\n    )\n)","89cc2513":"(ggplot(ratio_df_no_nan,\n        aes(x=\"writing_female_ratio\")) + \n    geom_histogram() + \n    labs(\n        title = 'Histogram of Female Writing Ratio',\n        x = 'Female Writing Ratio',\n        y = 'Frequency'\n    )\n)","7884c784":"(ggplot(ratio_df_no_nan,\n        aes(x=\"production_female_ratio\")) + \n    geom_histogram() + \n    labs(\n        title = 'Histogram of Female Production Ratio',\n        x = 'Female Production Ratio',\n        y = 'Frequency'\n    )\n)","6c064caf":"## Import Data & Data Cleaning","5cbf1cb4":"I cannot believe we only 1,300+ movies left. This means that the data source is not really giving credits to the crew members properly. ","6b6c018f":"Both are highly positively skewed, but pure numbers do not give us much information. I will proceed to calculate the female ratio. ","61d98858":"You can see that the percentage of unknown gender has decreased significantly.","9a506b04":"There seems to have more female working on movies than I expected, but that is because I have dropped the nan's. ","976a6975":"## Gender Prediction\n\nI am going to predict the gender from first names. \n\nPackage: https:\/\/pypi.org\/project\/gender-guesser\/","708011b0":"### A bit more visualization","06ce2f7b":"### Too many unknowns\n\nWe have counted the genders, but there are way too many unknowns.","ad8e1323":"### Check empty cells\n\nThere are no empty values perse, but some cells only have [], which is empty. ","b4908d76":"There are so many nan's in sub-categories of crew members, probably because a denominator of 0 does not make sense. Let's drop the nan's.","b514ca70":"## Female Ratio","c11fd49c":"### Visualization","a0e2554b":"# Calculating Gender Ratio in Cast and Crew members\n\n","555a92cd":"## Counting\n\nThe info in cast and crew is very disorganized. I only want the gender information, so we need to loop through every cast and crew and count their gender. "}}