{"cell_type":{"ec512ecd":"code","c9a170b4":"code","610f31ab":"code","ec10e309":"code","30f83e28":"code","4db042cc":"code","ccd7329d":"code","d093e1e0":"code","8db3d614":"code","5260bf72":"code","4b9e2455":"code","d209aa09":"code","063b8b34":"code","48a46ec9":"code","5c524c16":"code","9776dc19":"code","13406e1d":"code","e6139f7e":"code","e8b8518a":"code","4b8c6a66":"code","b1d7f12f":"code","9c3f5b4f":"code","f275d0f4":"code","066ced40":"code","19c51ac9":"code","b31ac033":"code","de69ad01":"code","c84849f2":"code","d7f29eae":"code","1e8c48a6":"code","ba75038b":"code","73683317":"code","2575c602":"code","e8a48cfa":"code","79c8d84b":"code","16bab0f8":"code","537ad7e7":"code","420213d0":"code","dbdc9def":"code","b3f9cf88":"code","4b232894":"code","f70cc7d4":"code","7bf136a6":"markdown","5b2647c4":"markdown","244a48ec":"markdown","5c459551":"markdown"},"source":{"ec512ecd":"import os\nfrom math import log2, ceil\nfrom pathlib import Path\n\nimport pandas as pd \nfrom matplotlib import pyplot as plt \nimport numpy as np\nimport cv2\n%matplotlib inline","c9a170b4":"path_dir_project = Path('\/kaggle\/input\/global-wheat-detection')","610f31ab":"df_train = pd.read_csv(path_dir_project\/'train.csv')","ec10e309":"bboxes = np.stack(df_train['bbox'].apply(lambda x: np.fromstring(x[1:-1], sep=','))).astype(int)","30f83e28":"display(bboxes[:5])","4db042cc":"for i, column in enumerate(['x_min', 'y_min', 'width', 'height']):\n    df_train[column] = bboxes[:,i]\n    \ndf_train[\"x_max\"] = df_train.apply(lambda col: col.x_min + col.width, axis=1)\ndf_train[\"y_max\"] = df_train.apply(lambda col: col.y_min + col.height, axis = 1)\ndf_train.drop(columns=['bbox'], inplace=True)","ccd7329d":"df_train[['x_min', 'y_min', 'width', 'height', 'x_max', 'y_max']].head(5)","d093e1e0":"df_train['area'] = df_train['width'] * df_train['height']","8db3d614":"df_train[['x_min', 'y_min', 'width', 'height', 'x_max', 'y_max', 'area']].head(5)","5260bf72":"len(df_train)","4b9e2455":"df_train['area'].describe()","d209aa09":"sr_area = df_train['area'].value_counts()\ndisplay(sr_area)","063b8b34":"fig = plt.figure(figsize=(20, 5))\n\nplt.bar(sr_area.sort_index().index, sr_area.sort_index().values)\n\nplt.title('Bounding-box distribution')\nplt.xlabel('Area [dots]')\nplt.ylabel('counts')\n\nplt.show()\nplt.close()","48a46ec9":"def calc_starges(num_data):\n    return int(np.round(log2(num_data) + 1, 0))","5c524c16":"fig = plt.figure(figsize=(20, 5))\n\nplt.hist(df_train['area'], bins=calc_starges(len(df_train)))\n\nplt.title('Bounding-box distribution')\nplt.xlabel('Area [dots]')\nplt.ylabel('counts')\n\nplt.show()\nplt.close()","9776dc19":"fig = plt.figure(figsize=(20, 5))\n\nplt.hist(df_train['area'], bins=calc_starges(len(df_train)))\n\nplt.title('Bounding-box distribution')\nplt.xlabel('Area [dots]')\nplt.ylabel('counts')\nplt.yscale('log')\n\nplt.show()\nplt.close()","13406e1d":"fig = plt.figure(figsize=(20, 5))\n\nplt.bar(sr_area.sort_index().index, sr_area.sort_index().values)\n\nplt.title('Bounding-box distribution')\nplt.xlabel('Area [dots]')\nplt.ylabel('counts')\nplt.xscale('log')\nplt.yscale('log')\nplt.show()\nplt.close()","e6139f7e":"query_max_area = df_train['area'] == df_train['area'].max()\nimage_id_max_area = df_train[query_max_area]['image_id']\nprint(image_id_max_area)","e8b8518a":"fig_filename = f'{image_id_max_area.values[0]}.jpg'\nfilepath = path_dir_project\/f'train\/{fig_filename}'","4b8c6a66":"image = cv2.imread(str(filepath))","b1d7f12f":"fig = plt.figure(figsize=(8, 8))\n\nplt.imshow(cv2.cvtColor(image, cv2.COLOR_BGR2RGB))\nplt.show()\nplt.close()","9c3f5b4f":"query_target = df_train['image_id'] == image_id_max_area.values[0]\nbboxes_target = df_train[query_target]","f275d0f4":"len(bboxes_target)","066ced40":"bboxes_target.head(5)","19c51ac9":"image_bboxes = image.copy()\nfor idx in range(len(bboxes_target)): \n    bbox = bboxes_target.iloc[idx][['x_min', 'y_min', 'x_max', 'y_max']].values\n    image_bboxes = cv2.rectangle(image_bboxes, (bbox[0], bbox[1]), (bbox[2], bbox[3]), (0, 0, 255), 3)\n    \nfig = plt.figure(figsize=(8, 8))\n\nplt.imshow(cv2.cvtColor(image_bboxes, cv2.COLOR_BGR2RGB))\nplt.show()\nplt.close()","b31ac033":"query_large = df_train['area'] >= 100000 \ndf_train_large = df_train[query_large]\ndisplay(df_train_large)","de69ad01":"len(df_train[query_large]['image_id'].unique())","c84849f2":"image_ids_large_area = df_train[query_large]['image_id'].unique()","d7f29eae":"def draw_bbox(image_id, df_train):\n    fig_filename = f'{image_id}.jpg'\n    filepath = path_dir_project\/f'train\/{fig_filename}'\n\n    image = cv2.imread(str(filepath))\n\n    query_target = df_train['image_id'] == image_id\n    bboxes_target = df_train[query_target][['x_min', 'y_min', 'x_max', 'y_max']]\n\n    for idx in range(len(bboxes_target)): \n        bbox = bboxes_target.iloc[idx].values\n        image = cv2.rectangle(image, (bbox[0], bbox[1]), (bbox[2], bbox[3]), (0, 0, 255), 5)\n        \n    return image\n\ndef plot_images(df_train, image_ids):\n    num_images = len(image_ids)\n    num_row = ceil(num_images \/ 2)\n    if num_images >= 2:\n        fig, axes = plt.subplots(num_row, 2, figsize=(20, 10 * num_row))\n        for idx_img, image_id in enumerate(image_ids):\n            image_bboxes = draw_bbox(image_id, df_train)\n            axes[idx_img \/\/ 2][idx_img % 2].imshow(cv2.cvtColor(image_bboxes, cv2.COLOR_BGR2RGB))\n            axes[idx_img \/\/ 2][idx_img % 2].set_title(image_id)\n            \n    else: \n        image_id = image_ids[0]\n        fig = plt.figure(figsize=(7, 6))\n\n        image_bboxes = draw_bbox(image_id, df_train)\n        plt.imshow(cv2.cvtColor(image_bboxes, cv2.COLOR_BGR2RGB))\n        plt.title(image_id)        \n\n    plt.show()\n    plt.close()    ","1e8c48a6":"plot_images(df_train, image_ids_large_area)","ba75038b":"images_with_anormally_large_bbox = [\n    '41c0123cc', \n    'a1321ca95', \n    '2cc75e9f5', \n    '42e6efaaa', \n    '409a8490c', \n    'd7a02151d', \n    'd067ac2b1',\n    'd60e832a5'\n]","73683317":"query_min = df_train['area'] == df_train['area'].min()\ndf_train_min = df_train[query_min]\ndisplay(df_train_min)\n\nimage_ids_min_area = df_train_min['image_id'].unique()\ndisplay(len(image_ids_min_area))","2575c602":"plot_images(df_train, image_ids_min_area)","e8a48cfa":"query_smaller = df_train['area'] <= 100\ndf_train_smaller = df_train[query_smaller]\ndisplay(df_train_smaller)\n\nimage_ids_smaller_area = df_train_smaller['image_id'].unique()\ndisplay(len(image_ids_smaller_area))","79c8d84b":"plot_images(df_train, image_ids_smaller_area)","16bab0f8":"images_with_anormally_small_bbox = [\n    '809d816dd', \n    '8e1543437', \n    'c3fa071f6', \n    '666e0a853', \n    'b2f2a5dfd', \n    '6284044ed', \n    '0a97d54ae', \n    'ad256655b', \n    '088d3df51', \n    '233cb8750', \n    '6a8522f06', \n    'ca5e51e59', \n    '5e182e37e', \n    'ce3999eb9', \n    'd0912a485', \n    'f24698e88', \n    'bf2027ed3', \n    '4ffeedce2', \n    '229716799'\n]","537ad7e7":"query_small = (df_train['area'] > 100) & (400 >= df_train['area'])\ndf_train_small = df_train[query_small]\ndisplay(df_train_small)\n\nimage_ids_small_area = df_train_small['image_id'].unique()\ndisplay(len(image_ids_small_area))","420213d0":"ids_random = np.random.choice(image_ids_small_area, 10)\nplot_images(df_train, ids_random)","dbdc9def":"query_small_width_height = (df_train['width'] <= 50) & (df_train['height'] <= 50)\ndf_train_query_small_width_height = df_train[query_small_width_height]\ndisplay(df_train_query_small_width_height)\n\nimage_ids_small_width_height = df_train_query_small_width_height['image_id'].unique()\ndisplay(len(image_ids_small_width_height))","b3f9cf88":"ids_random_small_width_height = np.random.choice(image_ids_small_width_height, 10)\nplot_images(df_train, ids_random_small_width_height)","4b232894":"query_small_width_height_or = (df_train['width'] <= 50) | (df_train['height'] <= 50)\ndf_train_query_small_width_height_or = df_train[query_small_width_height_or]\ndisplay(df_train_query_small_width_height_or)\n\nimage_ids_small_width_height_or = df_train_query_small_width_height_or['image_id'].unique()\ndisplay(len(image_ids_small_width_height_or))","f70cc7d4":"ids_random_small_width_height_or = np.random.choice(image_ids_small_width_height_or, 10)\nplot_images(df_train, ids_random_small_width_height_or)","7bf136a6":"...it's difficult to detect with small width and height.\nThus, I detect tiny bboxes by area and my eyes directly now.","5b2647c4":"## Image with max area bbox","244a48ec":"## Import train.csv","5c459551":"## limit to width and height less than 50 dots"}}