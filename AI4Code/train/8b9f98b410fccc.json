{"cell_type":{"8854d4b1":"code","7645496d":"code","aae8ed55":"code","151377d2":"code","38d0e1b0":"code","744a92b2":"code","97f304a0":"code","13e81f4e":"code","5bffcc88":"code","d0634972":"code","0c91b139":"code","4533afb4":"code","94d99c90":"code","51e06617":"code","c1f736cc":"code","84544023":"code","e8a7f0b5":"code","f9dcc789":"markdown","e837762b":"markdown","b0d2c618":"markdown","5caf355e":"markdown"},"source":{"8854d4b1":"import pandas as pd\nfrom fastai.vision.all import *\nimport os\npath = Path('..\/input\/cassava-leaf-disease-classification')","7645496d":"data = pd.read_csv(path\/'train.csv')\ntrain = data[~data['image_id'].isin(['1562043567.jpg', '3551135685.jpg', '2252529694.jpg'])]","aae8ed55":"#path = Path('..\/input\/cassava-leaf-disease-classification')\n\ndef get_x(r):\n    return path\/'train_images'\/r['image_id']\n\ndef get_y(r):\n    return r['label']","151377d2":"def get_data(size=256, bs=64, data_df=train):\n    block = DataBlock(blocks=(ImageBlock, CategoryBlock), \n                      splitter=RandomSplitter(seed=42), \n                      get_x=get_x,\n                      get_y=get_y, \n                      item_tfms = RandomResizedCrop(512),\n                      batch_tfms = [*aug_transforms(size=size),\n                                    Normalize.from_stats(*imagenet_stats)])\n\n    \n    return block.dataloaders(data_df, bs=bs)","38d0e1b0":"dataloader = get_data()","744a92b2":"dataloader.show_batch()","97f304a0":"#learn = cnn_learner(dataloader, resnet50, metrics=accuracy)","13e81f4e":"learn = cnn_learner(dataloader, resnet50, metrics=[error_rate,accuracy], pretrained=True)","5bffcc88":"learn.lr_find()","d0634972":"learn.fine_tune(10, freeze_epochs=2)","0c91b139":"learn.fine_tune(5,2.2908675418875646e-06)","4533afb4":"learn.show_results()","94d99c90":"export = learn.export(Path(\"\/kaggle\/working\/model_v9.pkl\"))","51e06617":"submission_df = pd.read_csv('..\/input\/cassava-leaf-disease-classification\/sample_submission.csv')","c1f736cc":"test_data_path = submission_df['image_id'].apply(lambda x: path\/'test_images'\/x)\ntst_dl = learn.dls.test_dl(test_data_path)\npredictions = learn.tta(dl = tst_dl, n=10)\n\nsubmission_df['label'] = np.argmax(predictions[0],axis=1)\nsubmission_df","84544023":"submission_df.to_csv('submission.csv',index=False)","e8a7f0b5":"model_path = \"..\/input\/notebook0557b79a42\/model_v9.pkl\" ","f9dcc789":"A fun\u00e7\u00e3o *lr_find ()* da biblioteca FastAI para encontrar a melhor Taxa de aprendizagem para o modelo treinar. A fun\u00e7\u00e3o lr_find () basicamente executa o modelo em v\u00e1rias taxas de aprendizado at\u00e9 encontrar aquele LR onde o gradiente da fun\u00e7\u00e3o de perda sofre a maior queda e escolhe sugeri-lo","e837762b":"**Criando Dataloaders**","b0d2c618":"**Ambiente de Configura\u00e7\u00e3o**","5caf355e":"**Removendo a imagens duplicadas de acordo com esta [discuss\u00e3o](https:\/\/www.kaggle.com\/c\/cassava-leaf-disease-classification\/discussion\/198202)**\n\n'1562043567.jpg' e '3551135685.jpg' (r\u00f3tulo incorreto)\n\n'2252529694.jpg' e '911861181.jpg' (duplicado)"}}