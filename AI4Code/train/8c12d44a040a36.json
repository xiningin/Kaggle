{"cell_type":{"ffd06485":"code","fe7d2b4a":"code","f55fa5a1":"code","b368d479":"code","5a9d321f":"code","f802f71b":"code","549a432d":"code","9e34a88f":"code","a0c4091a":"code","c98beb9e":"code","1f8e2d02":"code","dcf83552":"code","9ff19899":"code","1d715008":"code","235b4e20":"code","45d3c130":"code","780ce986":"code","5999f8e5":"code","96281bc7":"code","a5c5d788":"code","65dd3537":"code","366d640d":"code","961fefc6":"code","005a44cc":"code","480bf28e":"code","38e7490b":"code","b7ac16a9":"code","f45c77bd":"code","dc5e9c2f":"code","51e061c7":"code","1e84465e":"code","94d1fbca":"code","2256d5ff":"code","240b6132":"code","0cff4565":"code","55fbc16e":"code","3216c383":"code","165756ab":"code","76913212":"code","0260fd39":"code","a7622563":"code","27e97047":"code","ae166114":"code","5be7de77":"code","e0bcf1e7":"code","e1b43538":"code","4ca85ec6":"code","717110be":"code","bab885b5":"code","e7ce6698":"code","cead4bb5":"code","255c715a":"code","7b55d3d3":"code","5f85a810":"code","4cb2b958":"code","2aa73bc5":"code","956ea9c7":"code","3944017d":"code","6e3aa29f":"code","c80f2721":"code","87ec9267":"code","44740a70":"code","6fe3039b":"code","5d25b528":"code","cb9fcafd":"code","86f4b334":"code","d040a8a3":"code","bd743b56":"code","49e3f8a7":"code","e50ff3ba":"code","ad3a6b2b":"code","8aa91d27":"code","309a26d7":"code","d5cc7919":"code","c00ce8e5":"code","e11a73fa":"code","c1f6c67b":"code","7c799338":"code","0ce30574":"code","356b9da1":"code","eeabe453":"code","6067c772":"code","a8b0a401":"code","b63e5686":"markdown","9e28bf57":"markdown","0b68f42a":"markdown","69d138d4":"markdown","9858fdbe":"markdown","8d1e0d77":"markdown","9f1be02d":"markdown","96ce4370":"markdown","cd9aa3f3":"markdown","cc7bef87":"markdown","a11fe681":"markdown","28b03201":"markdown","697fb9d6":"markdown","f76a7351":"markdown","400d9620":"markdown","6b2f8e4a":"markdown","ba91ea0c":"markdown"},"source":{"ffd06485":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly.express as px\nimport scipy.stats as st\nimport sklearn\n!pip install bs4\n!pip install openpyxl\nfrom bs4 import BeautifulSoup\nimport requests\nfrom geopy.geocoders import Nominatim\n%matplotlib inline","fe7d2b4a":"df = pd.read_csv('..\/input\/boston-crime-incident-report-2018\/crime-incident-reports-2018.csv')","f55fa5a1":"df_raw = df.copy() #Just in case","b368d479":"df.head()","5a9d321f":"df.columns","f802f71b":"len(df.columns) \n\n# Total 17 columns","549a432d":"df.info()\n\n# Our dataframe has 11 categorical features and 6 quantitative features and has around 1lakh entries.","9e34a88f":"from sklearn.compose import make_column_selector","a0c4091a":"selector = make_column_selector(dtype_include='object')","c98beb9e":"categorical_data = selector(df)","1f8e2d02":"categorical_data","dcf83552":"len(categorical_data)","9ff19899":"df[categorical_data].head()","1d715008":"df.describe()","235b4e20":"df.head()","45d3c130":"df.isnull().sum()","780ce986":"df[(df.DISTRICT.isnull() | df.STREET.isnull()) & df.Lat.isnull()]","5999f8e5":"df.drop(index= df[(df.DISTRICT.isnull() | df.STREET.isnull()) & df.Lat.isnull()].index,inplace=True)","96281bc7":"df.drop(index= df[df.DISTRICT.isnull() & df.STREET.isnull() & df.Lat.isnull()].index,inplace=True)","a5c5d788":"df[(df.DISTRICT.isnull() | df.STREET.isnull()) & df.Lat.notnull()]\n\n# Here we don't have either the district or street values but we have coordinates of the place from where we can get \n# above values but we see that some coordinates have -1,-1 values which is not good, let's go deeper!","65dd3537":"df[(df.DISTRICT.isnull() | df.STREET.isnull()) & df.Lat.notnull()].Lat.value_counts().head(10)\n\n# Here we see we have -1 values for 277 records but we don't know yet that corresponding district and street values are \n# there or not","366d640d":"df[(df.DISTRICT.isnull() | df.STREET.isnull()) & df.Lat.notnull() & (df.Lat<0)].shape\n\n# Dropping all these rows as we don't have any way to fetch the details of location based on coordinate points","961fefc6":"df.drop(df[(df.DISTRICT.isnull() | df.STREET.isnull()) & df.Lat.notnull() & (df.Lat<0)].index,inplace=True)","005a44cc":"# Now we should not have any rows with all the info lost\ndf[df.Lat < 0].shape\n\n# Here we have both district and street, so no reason to drop it.","480bf28e":"df.isnull().sum()","38e7490b":"df[df.STREET.isnull() & df.Lat.isnull() & df.Lat<0] ","b7ac16a9":"df[df.DISTRICT.isnull() & df.Lat.isnull() & df.Lat<0] ","f45c77bd":"df[df.Lat.isnull()].shape\n\n# These are all the values where we have both district and street values but not coordinates, dealing with it later.","dc5e9c2f":"df[df.UCR_PART.isnull()]\n\n# Since these are all home invasion, we will assign the ucr to part two","51e061c7":"df.UCR_PART.replace(np.nan, 'Part Two',inplace=True)","1e84465e":"df.UCR_PART.isnull().sum()","94d1fbca":"df.isnull().sum()","2256d5ff":"round((df.SHOOTING.notnull().sum()\/df.SHOOTING.isnull().sum())*100,2)","240b6132":"df.drop('SHOOTING',axis=1,inplace=True)","0cff4565":"# We know that this data is dated to 2018, so there is no point in keeping 'YEAR' column\n\ndf.drop('YEAR',axis=1,inplace=True)","55fbc16e":"# dropping incident number as it does not provide any useful information and is only used for internal categorization.\n\ndf.drop('INCIDENT_NUMBER',axis=1,inplace=True)","3216c383":"# Since offense code also does not provide any information, so it will be dropped.\n\ndf.drop('OFFENSE_CODE',axis=1,inplace=True)","165756ab":"df.Location.head()\n\n# This column is formed by joining lat and long columns and converted to strings for usability. Dropping it!","76913212":"df.drop('Location',axis=1,inplace=True)","0260fd39":"df.isnull().sum()","a7622563":"df.info()","27e97047":"# If we could have a nice dictionary. It would help us better understand our dataset\ndictionary = pd.read_excel(io = 'https:\/\/data.boston.gov\/dataset\/6220d948-eae2-4e4b-8723-2dc8e67722a3\/resource\/9c30453a-fefa-4fe0-b51a-5fc09b0f4655\/download\/rmscrimeincidentfieldexplanation.xlsx')","ae166114":"dictionary","5be7de77":"dist_map = {'B2': 'Roxbury', 'C11':'Dorchester','D4':'South End','B3':'Mattapan','A1':'Downtown','C6':'South Boston',\n           'D14':'Brighton','E18':'Hyde Park','E13':'Jamaica Plain','E5':'West Roxbury','A7':'East Boston',\n           'A15':'Charlestown'}","e0bcf1e7":"df.DISTRICT = df.DISTRICT.map(dist_map)","e1b43538":"df.head()","4ca85ec6":"df.REPORTING_AREA.value_counts().head()\n\n# Also, some information is lost here, better to drop it ","717110be":"df.drop('REPORTING_AREA',axis=1, inplace=True)","bab885b5":"df.head()","e7ce6698":"def latlong(lat,long):\n    return str(lat) + ', ' + str(long)","cead4bb5":"# Joining and converting coordinates in usable string format\n\ndf['LatLong'] = df[['Lat','Long']].apply(lambda df : latlong(round(df.Lat,6),round(df.Long,6)),axis=1)","255c715a":"df.LatLong[0]","7b55d3d3":"# Let's check how the null values appear\ndf[df.LatLong.str.startswith('n')].head()","5f85a810":"df.drop(columns=['Lat','Long'],axis=1,inplace=True)","4cb2b958":"df.OCCURRED_ON_DATE.isna().sum()","2aa73bc5":"df.OCCURRED_ON_DATE[0] \n\n# We have hour of the day, we have month of the year, we have day of the week but we do not have date of the month!\n# Let's extract it out and drop this column","956ea9c7":"df['dAY_OF_MONTH'] = df.OCCURRED_ON_DATE.map(lambda x : x.split(' ')[0].split('-')[2])","3944017d":"df.insert(3,'DAY_OF_MONTH',df.dAY_OF_MONTH)\ndf.drop('dAY_OF_MONTH',axis=1,inplace=True)","6e3aa29f":"df.head()","c80f2721":"locator = Nominatim(user_agent='mygeocoder')","87ec9267":"list(locator.reverse(df.LatLong[0]).raw['address'].values())","44740a70":"list(loc1['address'].values())[4]","6fe3039b":"def county_mapper(coor):\n    return list(locator.reverse(coor).raw['address'].values())[4]","5d25b528":"for i in list(df.LatLong):\n    print(i)","cb9fcafd":"county_mapper(coor = df.LatLong[0])","86f4b334":"df['COUNTY'] = df['LatLong'].map(lambda x : county_mapper(str(x)))","d040a8a3":"# We can fetch county details of the incidents where it happened that will help us more understand the \n# jurisdiction it comes under\n\nlist(loc1['address'].values())[4]","bd743b56":"locator.reverse(df.LatLong[1]).raw","49e3f8a7":"locator.reverse(df.LatLong[2]).raw['address']","e50ff3ba":"locator.reverse(df.LatLong[3]).raw['address']","ad3a6b2b":"locator.reverse(df.LatLong[4]).raw","8aa91d27":"df.DISTRICT","309a26d7":"locator.reverse(df.LatLong[3]).raw","d5cc7919":"fig = plt.figure(figsize=(9,9),dpi=200,facecolor= '#ffe6b8')\nax = fig.add_axes([0,0,1,1])\nax.barh(np.arange(len(df.OFFENSE_CODE_GROUP.value_counts()))[:50]\n                  ,df.OFFENSE_CODE_GROUP.value_counts().sort_values(ascending=False).values[:50]\n                  ,align='center', color= '#ffc291',edgecolor= 'black',linewidth=1.2)\nax.set_yticks(np.arange(len(df.OFFENSE_CODE_GROUP.value_counts()))[:50])\nax.set_yticklabels(df.OFFENSE_CODE_GROUP.value_counts().index[:50])\nax.invert_yaxis()\nax.set_title('Number of crimes in different offense groups',fontdict={'fontsize':20,'fontweight':14},loc='left',pad=20)\nax.set_xlabel('Total Incidents',fontdict={'fontsize':12,'fontweight':20},labelpad=20)\nax.set_ylabel('Category of Incidents',fontdict={'fontsize':12,'fontweight':20},labelpad=20)\nplt.show()","c00ce8e5":"df[df.OFFENSE_CODE_GROUP == 'Motor Vehicle Accident Response'].head()","e11a73fa":"counts_mv = df[df.OFFENSE_CODE_GROUP == 'Motor Vehicle Accident Response'].groupby(df.OFFENSE_DESCRIPTION).count()","c1f6c67b":"counts_mv","7c799338":"mean_mv = df[df.OFFENSE_CODE_GROUP == 'Motor Vehicle Accident Response'].groupby(df.OFFENSE_DESCRIPTION).mean()","0ce30574":"mean_mv","356b9da1":"plt.figure(figsize=(10,8))\nplt.title('Inside \"Other\" Incidents')\ndf[df.OFFENSE_CODE_GROUP == 'Other'].OFFENSE_DESCRIPTION.value_counts().sort_values().plot(kind='barh')","eeabe453":"plt.figure(figsize=(10,8))\nplt.title('Inside \"Motor Vehicle Accident Response\" Incidents')\ndf[df.OFFENSE_CODE_GROUP == 'Motor Vehicle Accident Response'].OFFENSE_DESCRIPTION.value_counts().sort_values().plot(kind='barh')","6067c772":"plt.figure(figsize=(10,8))\nplt.title('Inside \"Medical Assistance\" Incidents')\ndf[df.OFFENSE_CODE_GROUP == 'Medical Assistance'].OFFENSE_DESCRIPTION.value_counts().sort_values().plot(kind='barh')","a8b0a401":"plt.figure(figsize=(10,8))\nplt.title('Inside \"Larceny\" Incidents')\ndf[df.OFFENSE_CODE_GROUP == 'Larceny'].OFFENSE_DESCRIPTION.value_counts().sort_values().plot(kind='barh')","b63e5686":"##### Let's check what all we can get from coordinates","9e28bf57":"# Initial inspection of the dataset","0b68f42a":"#### Let's prettify district values","69d138d4":"### We see here that, Motor Vehicle Accidents share the highest percentage in incidents followed by Medical assistance and Larceny! Also we have that 'Other' dude showing a high response, we need to further check it out!","9858fdbe":"#### Time to drop Shooting column as it is disastorously empty. ","8d1e0d77":"# Once upon a time, when Gotham was rife with demonic fireflies, it caused mayhem during an intense battle of 24 hours. Our one and only cape crusader, *Batman*, decided to setup a crime analysis unit in his cave. Naturally, Alfred took over the charge of predictive analytics of the upcoming incidents to better reinfrorce Batman with information. He was smart, he understood the value of data, its capabilities and it's loyalty. ","9f1be02d":"### We see that there are various other crimes inside the 'Other' tag and Threat to bodily harm has been registered in the complaint most often ","96ce4370":"####  All 331 district values can be fetched from coordinate values ","cd9aa3f3":"![batman](https:\/\/3.bp.blogspot.com\/-XarXIDJXjxg\/VY_mrEZfgnI\/AAAAAAAAVz0\/MQaHmALgGI0\/w1200-h630-p-k-no-nu\/Batman-Arkham-Knight_Firefly.jpg)","cc7bef87":"## Following his footsteps and with increasing crime rate in Boston, Massachussets. We have been tasked to setup a similar unit to help BPD tackle this rampant issue. Today we are gonna deal with the data provided to us by BPD of crime analysis in 2018. We have a big responsibility to provide key insights and predictive analysis to the stakeholders. Let's find a good spot, turn on the machine and dive deeper into it. ","a11fe681":"# Importing libraries and packages along with dataset","28b03201":"![batman with alfred](https:\/\/c4.wallpaperflare.com\/wallpaper\/380\/923\/812\/batman-batman-a-telltale-game-series-alfred-pennyworth-bruce-wayne-wallpaper-preview.jpg)","697fb9d6":"#### What is reporting area?  I searched on google, I couldn't find much information on that.","f76a7351":"#### So, all 634 street values above can be fetched from coordinate values","400d9620":"#### We have some columns with missing values. Looking at the size of the dataset, these values are very less so we will probably drop them. Let's check the rows where atleast two of these values are simultaenously null.","6b2f8e4a":"#### Let's check 'OCCURED_ON_DATE' column, if we can clean it up a bit","ba91ea0c":"#### Now is the time to recover district and street values from coordinates"}}