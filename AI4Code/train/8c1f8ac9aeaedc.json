{"cell_type":{"6542bea6":"code","e4ce021d":"code","fe2d1643":"code","4f334c59":"code","a6efbf07":"code","31637738":"code","09f3ec39":"code","dc924dba":"code","5c4f5e1d":"code","2918f650":"code","e9f4ff61":"code","8b2d4471":"code","22ceaecf":"code","c12d3d0d":"code","f968d4e8":"code","132098a4":"code","76367669":"code","c0db4173":"code","6f35f45c":"code","38b34369":"code","436c1b60":"code","ac1d1e1f":"markdown","782af217":"markdown","9765d42e":"markdown"},"source":{"6542bea6":"import pandas as pd\nimport datetime","e4ce021d":"import os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n","fe2d1643":"train_transaction = pd.read_csv('..\/input\/ieee-fraud-detection\/train_transaction.csv')\ntest_transaction = pd.read_csv('..\/input\/ieee-fraud-detection\/test_transaction.csv')","4f334c59":"submit = pd.read_csv(\"..\/input\/ieee-gb-2-make-amount-useful-again\/submission.csv\")","a6efbf07":"def make_day(df):\n    def fillna(x):\n        if \"nan\" in x:\n            return np.nan\n        else:\n            return x\n    START_DATE = datetime.datetime.strptime('2017-11-30', '%Y-%m-%d')\n    df['Date'] = df['TransactionDT'].apply(lambda x: (START_DATE + datetime.timedelta(seconds=x)))\n    df['Day'] = (df[\"Date\"].dt.year - 2017) * 365 + df[\"Date\"].dt.dayofyear\n    df[\"ID1\"] = df[\"card1\"].astype(str)+df[\"card2\"].astype(str)+df[\"card3\"].astype(str)+df[\"card4\"].astype(str)+\\\n                df[\"card5\"].astype(str)+df[\"card6\"].astype(str)\n    df[\"ID_D1\"] = fillna(df[\"ID1\"].astype(str) + (df[\"Day\"] - df[\"D1\"]).astype(str))\n    df[\"ID_D1D10\"] = fillna(df[\"ID_D1\"].astype(str) + (df[\"Day\"] - df[\"D10\"]).astype(str))\n    df[\"ID_D1D12\"] = fillna(df[\"ID_D1\"].astype(str) + (df[\"Day\"] - df[\"D12\"]).astype(str))\n    return df","31637738":"train_transaction = make_day(train_transaction)\ntest_transaction = make_day(test_transaction)","09f3ec39":"q_id1 = train_transaction[[\"ID_D1D10\", \"isFraud\"]].groupby(\"ID_D1D10\").agg({\"isFraud\": [\"count\", \"mean\"]}).reset_index()\nq_id1.columns = [\"ID_D1D10\", \"isFraud_countD1D10\", \"isFraud_meanD1D10\"]\nq_id2 = train_transaction[[\"ID_D1D10\", \"isFraud\"]].groupby(\"ID_D1D10\").agg({\"isFraud\": [\"count\", \"mean\"]}).reset_index() # I found this bug after competition finished...\nq_id2.columns = [\"ID_D1D12\", \"isFraud_countD1D12\", \"isFraud_meanD1D12\"]","dc924dba":"test_transaction = pd.merge(test_transaction, q_id1, how=\"left\", on=\"ID_D1D10\")\ntest_transaction = pd.merge(test_transaction, q_id2, how=\"left\", on=\"ID_D1D12\")","5c4f5e1d":"submit = pd.merge(submit, test_transaction, how=\"left\", on=\"TransactionID\")","2918f650":"q = \"isFraud_countD1D10 > 1 and isFraud_meanD1D10 > 0.7 and ProductCD != 'C'\"","e9f4ff61":"submit.query(q)[\"isFraud\"].describe()","8b2d4471":"submit[\"isFraud\"][submit.query(q).index] = 1","22ceaecf":"submit.query(q)[\"isFraud\"].describe()","c12d3d0d":"q = \"isFraud_countD1D12 > 1 and isFraud_meanD1D12 == 1 and ProductCD == 'C'\"","f968d4e8":"submit.query(q)[\"isFraud\"].describe()","132098a4":"submit[\"isFraud\"][submit.query(q).index] = 1\nsubmit.query(q)[\"isFraud\"].describe()","76367669":"q = \"isFraud_countD1D10 > 5 and isFraud_meanD1D10 == 0\"","c0db4173":"submit.query(q)[\"isFraud\"].describe()","6f35f45c":"submit[\"isFraud\"][submit.query(q).index] = 0","38b34369":"submit.query(q)[\"isFraud\"].describe()","436c1b60":"submit[[\"TransactionID\", \"isFraud\"]].to_csv(\"postprocessed.csv\", index=False)","ac1d1e1f":"# fix submittion file to isFraud=0","782af217":"# fix submittion file to isFraud=1","9765d42e":"# 19th place solution (postprocess)\nboost our score +0.0007 in Public and +0.0004 in Private.<br>\nThis notebook use this great notebook's submittion. <br>\n(I study a lot from this notebook and other @Konstantin Yakovlev's notebooks. thanks a lot!<br>\nand congratuation!!) <br> \nhttps:\/\/www.kaggle.com\/kyakovlev\/ieee-gb-2-make-amount-useful-again <br>\nboost this notebook's score +0.0042 in Public and +0.0032 in Private <br>"}}