{"cell_type":{"ccc418bc":"code","738002ca":"code","20141c1d":"code","6fc5280e":"code","ac6847ac":"code","78dd258d":"code","35f1a890":"code","bc9db91e":"code","16fe0bd6":"code","d7c599d8":"code","cf07a019":"code","4a893f60":"code","e16c2eda":"code","1a6a52ec":"code","b3dc17a7":"code","38d2ad2c":"code","eb2936fb":"code","53d69d8e":"code","f4bf37b5":"code","9afacc44":"code","d1f0c5e6":"code","60005780":"code","bb621da8":"code","62e5c6f3":"code","78864fcf":"code","89b9d4fe":"code","16aa2eaa":"code","41e6d102":"code","ed4d3f0b":"code","a5b922ab":"code","2da69b2e":"code","ab8afa48":"code","ee533e00":"code","7f99fbe1":"code","e4eeddba":"code","29c68d20":"code","620b0fb0":"code","b298acec":"code","83b1087c":"code","b0994ede":"code","ddf1d704":"code","9d595b9d":"code","16eb5a53":"code","a048fc49":"code","ba1d714b":"code","bfa4b40a":"code","aeb1618a":"code","1870c9a2":"markdown","20a5cce0":"markdown","6b5ce314":"markdown","a525be9b":"markdown","ecd2275d":"markdown","22c209be":"markdown","14693fc5":"markdown","cb64ed27":"markdown","cf3feed9":"markdown","3d9be7cf":"markdown","beb8fcb9":"markdown","419b4baa":"markdown","c8eda79e":"markdown","7a216ed0":"markdown","2102416a":"markdown","9c46030e":"markdown"},"source":{"ccc418bc":"# importamos las librer\u00edas necesarias para empezar\nimport pandas as pd \nimport numpy as np \n\nimport matplotlib.pylab as plt \nimport seaborn as sns \n\nplt.style.use('ggplot')","738002ca":"df_products = pd.read_csv('data\/products_df.csv', sep=',', index_col=[0])\ndf_commercial_activity = pd.read_csv('data\/commercial_activity_df.csv', sep=',', index_col=[0])\ndf_sociodemographic = pd.read_csv('data\/sociodemographic_df.csv', sep=',', index_col=[0])","20141c1d":"df_products.shape","6fc5280e":"df_products.head()","ac6847ac":"df_products.info()","78dd258d":"df_products['payroll'].value_counts(dropna=False)","35f1a890":"df_products['pension_plan'].value_counts(dropna=False)","bc9db91e":"df_products.describe().T","16fe0bd6":"df_products.describe(exclude=np.number).T","d7c599d8":"df_products.isnull().sum()","cf07a019":"df_products[df_products.duplicated(keep=False)]","4a893f60":"atributos = ['short_term_deposit','loans','mortgage','funds','securities','long_term_deposit','em_account_pp','credit_card','payroll','pension_plan','payroll_account','emc_account','debit_card','em_account_p','em_acount']\n\nmean_list = []\nfor i in atributos:\n    products_mean = df_products[i].mean()\n    mean_list.append(products_mean)\n\ndf_mean_products = pd.DataFrame(data=mean_list, index=atributos)\ndf_mean_products.rename(columns={0:'Mean_purchase'}, inplace=True)\n\ndf_mean_products['Product'] = df_mean_products.index\ndf_mean_products.reset_index(drop=True)\n\ndf_mean_products = df_mean_products.reindex(['Product','Mean_purchase'],axis=1).reset_index(drop=True)\ndf_mean_products['Percentage_mean'] = df_mean_products['Mean_purchase']*100\n\ndf_mean_products.sort_values(by='Mean_purchase', ascending=False).reset_index(drop=True)[['Product','Mean_purchase','Percentage_mean']].style.background_gradient(cmap='Reds')","e16c2eda":"# Preparamos los datos \ncolumnas = df_products.columns.to_list()\ndf_products_cust = df_products[columnas].groupby('pk_partition').mean()\ndf_products_cust.drop('pk_cid', axis=1, inplace=True)\ndf_products_cust.index = pd.to_datetime(df_products_cust.index)\n\n# Realizaci\u00f3n de los gr\u00e1ficos \nfig, axs = plt.subplots(3, 5, sharex=False, sharey=False, figsize=(60,40))\n\ncount_row = 0\ncount_columns = 0\nfor i in df_products_cust.columns:    \n    \n    Bar_Plot = df_products_cust[i].plot(ax = axs[count_row][count_columns], label=i)\n    plt.ylabel(i)\n   \n    count_columns +=1\n    \n    if count_columns == 5:\n        count_row+=1\n        count_columns=0\n\nplt.subplots_adjust(top=0.88)\nfig.suptitle('Distribuci\u00f3n de las compras en funci\u00f3n de la fecha', y=0.9, fontsize=30, color='maroon')\nplt.show()","1a6a52ec":"def diff_generator(dataframe, column): \n    dataframe_sorted = dataframe.sort_values(by=['pk_cid', 'pk_partition'])\n    dataframe_sorted[f'{column}_previous_month'] = dataframe_sorted.groupby('pk_cid')[column].shift(1)\n    dataframe_sorted[f'dif_{column}'] = dataframe_sorted[column] - dataframe_sorted[f'{column}_previous_month']\n    \n    #pivot_df = dataframe_sorted[dataframe_sorted[f'dif_{column}'] == -1].pivot_table(index='pk_partition', values=f'dif_{column}', aggfunc=[len])\n    #pivot_df[f'nrows'] = dataframe['pk_partition'].value_counts()\n    #pivot_df[f'pct_{column}'] = dataframe['pk_partition'].value_counts(normalize=True)\n\n  \n    return dataframe_sorted","b3dc17a7":"dataframe_sorted = df_products.sort_values(by=['pk_cid', 'pk_partition'])","38d2ad2c":"dataframe_sorted.head()","eb2936fb":"df_products_sorted = diff_generator(df_products,'debit_card')","53d69d8e":"pivot_df","f4bf37b5":"atributos = ['short_term_deposit','loans','mortgage','funds','securities','long_term_deposit','em_account_pp','credit_card','payroll','pension_plan','payroll_account','emc_account','debit_card','em_account_p','em_acount']\n\nfor column in atributos: \n    df_products_sorted = diff_generator(df_products, column)","9afacc44":"df_products_sorted.head(2).T","d1f0c5e6":"df_commercial_activity.head()","60005780":"df_commercial_activity.info()","bb621da8":"df_sociodemographic.head()","62e5c6f3":"df_country = df_sociodemographic.groupby(by='country_id')[['country_id','region_code','pk_cid']]","78864fcf":"df_sociodemographic[df_sociodemographic['country_id']=='DE']","89b9d4fe":"# Los valores nulos de la categor\u00eda de \"region_code\" los vamos a convertir a 0, ya que la columna de region_code es solamente para Espa\u00f1a y no para los dem\u00e1s pa\u00edses. ","16aa2eaa":"df_sociodemographic['region_code'].value_counts()","41e6d102":"df_sociodemographic['country_id'].value_counts()","ed4d3f0b":"df_sociodemographic['deceased'].value_counts() # tener en cuenta si estamos en estudio retrospectivo o prospectivo","a5b922ab":"df_pivot = df_sociodemographic.pivot_table(index='pk_cid', values= 'salary', aggfunc=[np.mean])\ntop_salary = df_pivot.sort_values(by=('mean','salary'), ascending=False).head(20)\nbottom_salary = df_pivot.sort_values(by=('mean','salary'), ascending=True).head(20)\n","2da69b2e":"bottom_salary.style.background_gradient(cmap='Blues')","ab8afa48":"top_salary.style.background_gradient(cmap='Reds')","ee533e00":"df_sociodemographic[df_sociodemographic['pk_cid']== 1371668]","7f99fbe1":"SACAR LA FECHA DE ANIVERSARIO DE LOS CLIENTES ","e4eeddba":"sns.countplot(data=df_sociodemographic, x='gender')","29c68d20":"sns.histplot(data=df_sociodemographic, x='age')","620b0fb0":"df_sociodemographic.hist(column='age')","b298acec":"mapa_global1 = folium.Map(location=[39.00, -3.703790], zoom_start=5)\n\nfor lat, lon, confirmados_pais, nombre_pais in zip(data_ultima_fecha['Lat'], data_ultima_fecha['Long'], data_ultima_fecha['Confirmed'], data_ultima_fecha['Pais']):\n        folium.CircleMarker([lat, lon],\n                        radius=5,\n                        popup = ('<strong>Country<\/strong>: ' + str(nombre_pais).capitalize() + '<br>'\n                                '<strong>Confirmed Cases<\/strong>: ' + str(confirmados_pais) + '<br>'),\n                        color='red',\n                        fill_color='red',\n                        fill_opacity=0.7 ).add_to(mapa_global1)\n\nmapa_global1\n","83b1087c":"df_products.describe().T","b0994ede":"df_commercial_activity.describe()","ddf1d704":"df_sociodemographic.describe()","9d595b9d":"# Observamos los valores nulos del dataset (PRODUCTS)","16eb5a53":"# Pasamos a formato fecha la columna \"pk_partition\"\ndf_products = pd.to_datetime(df_products['pk_partition'])","a048fc49":"df_products[df_products['payroll']==0]","ba1d714b":"# Miramos los valores predominantes que hay en la columna \"payroll\" que presenta 61 valores nulos \ndf_products[\"payrol\"].sum()","bfa4b40a":"import matplotlib.pyplot as plt\nimport seaborn as sns\nimport math ","aeb1618a":"df_products['payroll'].mode()[0]","1870c9a2":"`APUNTE_4`: Nos damos cuenta que la mayor\u00eda del tiempo se mantiene el n\u00famero de personas que se dan de baja de este producto de EasyMoney, como es la `targeta de d\u00e9bito`.","20a5cce0":"`APUNTE_2`: Hay dos columnas con valores nulos, m\u00e1s tarde deberemos imputarlos, ya que para lanzar el modelo, este no acepta valores nulos. Adem\u00e1s, no se observan valores duplicados en el dataset. ","6b5ce314":"### 1.1. Importaci\u00f3n de los datasets ","a525be9b":"`ASPECTO_7`: Podemos ver como hay 1075 personas fallecidas que contin\u00faan con nuestros productos. Estos clientes deber\u00edan ser limpiados del dataset, puesto que ya no nos van a comprar nada. ","ecd2275d":"## 1. Obtenci\u00f3n de las bases de datos","22c209be":"#### 1.2. Obtenci\u00f3n de la base de datos de \"COMMERCIAL_ACTIVITY\"","14693fc5":"# Easy money. TFM\n-------","cb64ed27":"### 2. Estructura de los datos","cf3feed9":"`APUNTE_1`:Estas dos variables anteriores ('payroll', 'pension_plan') las deberemos pasar a `INT`. La variable 'pk_partition' es actualmente una variable objeto, por lo que se deber\u00e1 convertir a `datetime`.","3d9be7cf":"`APUNTE_3`: Como podemos observar, el producto que tiene m\u00e1s \u00e9xito o que m\u00e1s gente tiene, es la cuenta de EasyMoney. Tampoco nos tiene que sorprender, puesto que es lo m\u00ednimo que debes tener para poder estar dentro de la financiera. Sin embargo, el producto de la cuenta de EasyMoney PP no la tiene nadie, as\u00ed que la descartaremos de nuestro de dataset. ","beb8fcb9":"`ASPECTO_6`: La distribuci\u00f3n de edad de nuestros clientes sigue una distribuci\u00f3n skewed hacia la derecha. La mayor\u00eda de nuestros clientes tienen una edad entre 20 - 30 a\u00f1os.  ","419b4baa":"En la siguiente imagen podemos observar la organizaci\u00f3n de los datasets presentes en nuestro modelo. Nosotros vamos a partir de 3 datasets distintos subministrados por la CEO de l'empresa, EasyMoney. \n\nPodemos observar la estructura a detalle de los datasets a continuaci\u00f3n. \n\n![Data Model](scheme.jpg)","c8eda79e":"It seems that there's a variable that have a great amount of percentatge of purchase, so it could be interesting study this variable. Even though, each variable follows the same motiv across the time. From june to july there was a decrease in purchase","7a216ed0":"`ASPECTO_5`: Podemos observar c\u00f3mo el dataset es muy parecido respecto a hombres y mujeres. ","2102416a":"### 1.1. `PRODUCTOS`. Data Understanding","9c46030e":"#### 1.3. Obtenci\u00f3n de la base de datos de \"SOCIODEMOGRAPHIC\""}}