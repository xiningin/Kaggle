{"cell_type":{"c03840f3":"code","affd080e":"code","610e84ee":"code","be2c11af":"code","75491767":"code","e37a7a37":"code","6eb39b26":"code","594e0ae6":"code","24d1675a":"code","25fa2f8d":"code","912bfc54":"code","bde7cf97":"code","738424c1":"code","164f57e0":"code","24134a2f":"code","8a906280":"code","e3728191":"code","da19edae":"code","51c28b92":"code","307fea5b":"code","df10a414":"code","f152b096":"code","8c57c716":"code","0c05dd48":"code","4ae80399":"code","b9ba8913":"code","be2cece7":"code","d4295c18":"code","1e1499a2":"code","87e595f7":"code","a6b9e818":"code","c027a765":"code","b7b12e40":"markdown","c908d361":"markdown","16f6b24f":"markdown","180e385e":"markdown","603d3d06":"markdown","1f60656c":"markdown","3f869ba6":"markdown","15b23891":"markdown","5f1466a5":"markdown","0d6eabb7":"markdown","2fd9679d":"markdown","8020e709":"markdown","c31b4e36":"markdown","c25c05a0":"markdown","0dee251d":"markdown","9d52348c":"markdown","f6e199ef":"markdown","8ba5cabc":"markdown","8e03f2ba":"markdown","dd0263bb":"markdown","76a079e5":"markdown","d2883595":"markdown","c18527e6":"markdown","79b392bf":"markdown","3cbced22":"markdown","1dced0f6":"markdown","e3921e54":"markdown","1e333b45":"markdown"},"source":{"c03840f3":"import pandas as pd\nimport numpy as np\nfrom pathlib import Path\nimport random\nimport tqdm\n\nfrom argparse import Namespace\nimport random\nimport os\nimport gc\nimport seaborn as sns\nfrom matplotlib import pyplot as plt\n\n# setting up options\nimport warnings\npd.set_option('display.max_rows', None)\npd.set_option('display.max_columns', None)\nwarnings.filterwarnings('ignore')\nfrom cycler import cycler","affd080e":"args = Namespace(\n    seed=21,\n    folds=5,\n    workers=4,\n    samples=2500000,\n    data_path=Path(\"..\/input\/ubiquant-parquet\/\"),\n)\n\n\ndef reduce_mem_usage(df):\n    \"\"\" iterate through all the columns of a dataframe and modify the data type\n        to reduce memory usage.        \n    \"\"\"\n    start_mem = df.memory_usage().sum() \/ 1024**2\n    print('Memory usage of dataframe is {:.2f} MB'.format(start_mem))\n    \n    for col in df.columns:\n        col_type = df[col].dtype\n        \n        if col_type != object:\n            c_min = df[col].min()\n            c_max = df[col].max()\n            if str(col_type)[:3] == 'int':\n                if c_min > np.iinfo(np.int8).min and c_max < np.iinfo(np.int8).max:\n                    df[col] = df[col].astype(np.int8)\n                elif c_min > np.iinfo(np.int16).min and c_max < np.iinfo(np.int16).max:\n                    df[col] = df[col].astype(np.int16)\n                elif c_min > np.iinfo(np.int32).min and c_max < np.iinfo(np.int32).max:\n                    df[col] = df[col].astype(np.int32)\n                elif c_min > np.iinfo(np.int64).min and c_max < np.iinfo(np.int64).max:\n                    df[col] = df[col].astype(np.int64)  \n            else:\n                if c_min > np.finfo(np.float16).min and c_max < np.finfo(np.float16).max:\n                    df[col] = df[col].astype(np.float16)\n                elif c_min > np.finfo(np.float32).min and c_max < np.finfo(np.float32).max:\n                    df[col] = df[col].astype(np.float32)\n                else:\n                    df[col] = df[col].astype(np.float64)\n        else:\n            df[col] = df[col].astype('category')\n\n    end_mem = df.memory_usage().sum() \/ 1024**2\n    print('Memory usage after optimization is: {:.2f} MB'.format(end_mem))\n    print('Decreased by {:.1f}%'.format(100 * (start_mem - end_mem) \/ start_mem))\n    \n    return df\n\n#train = reduce_mem_usage(train)\n\n#def seed_everything(seed: int = 42) -> None:\n#    random.seed(seed)\n#    np.random.seed(seed)\n#    os.environ[\"PYTHONHASHSEED\"] = str(seed)\n    \n#seed_everything(args.seed)\n#train = reduce_mem_usage(pd.read_parquet(args.data_path.joinpath(\"train_low_mem.parquet\")))\ntrain = pd.read_parquet(args.data_path.joinpath(\"train_low_mem.parquet\"))\n\n#references: https:\/\/www.kaggle.com\/valleyzw\/ubiquant-lgbm-baseline\n\nFEATURES = [col for col in train.columns if col not in ['target', 'row_id']]\nNUM_FEATURES = [col for col in train.columns if col not in ['target', 'row_id', 'investment_id', 'time_id']]\nCAT_FEATURES = [feature for feature in FEATURES if feature not in NUM_FEATURES]\n\ninv_ids = random.choices(train['investment_id'].unique(), k=3)\n","610e84ee":"train.head()","be2c11af":"train.info()","75491767":"print('Rows and Columns in train dataset:', train.shape)\n#print('Rows and Columns in test dataset:', test.shape)","e37a7a37":"print('Missing values in train dataset:', sum(train.isnull().sum()))\n#print('Missing values in test dataset:', sum(test_df.isnull().sum()))","6eb39b26":"train.head(5)","594e0ae6":"train.describe()","24d1675a":"plt.rcParams['figure.dpi'] = 600\nfig = plt.figure(figsize=(10, 10), facecolor='#f6f5f5')\ngs = fig.add_gridspec(5, 5)\ngs.update(wspace=0.3, hspace=0.3)\nbackground_color = '#f6f5f5'\nrun_no = 0\n\ncolormap = ['#1DBA94','#1C5ED2', '#FFC300', '#C70039']\nplt.rc('axes', prop_cycle=(cycler('color', colormap)))\n\nfor row in range(0, 5):\n    for col in range(0, 5):\n        locals()[\"ax\"+str(run_no)] = fig.add_subplot(gs[row, col])\n        locals()[\"ax\"+str(run_no)].set_facecolor(background_color)\n        for s in [\"top\",\"right\"]:\n            locals()[\"ax\"+str(run_no)].spines[s].set_visible(False)\n        run_no += 1  \n\n\nfeatures = list(train.columns[4:29])\n\nrun_no = 0\nfor col in features:\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[col], zorder=2, alpha=1, linewidth=1, color='#ffd514')\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[train['investment_id'].isin(inv_ids)][col], hue=train[train['investment_id'].isin(inv_ids)]['investment_id'],zorder=2, alpha=1, fill=True, color=colormap, linewidth=0.5, legend=False,palette=colormap[:3], hue_order=inv_ids.sort(reverse=True))\n    \n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='x', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='y', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].set_ylabel('')\n    locals()[\"ax\"+str(run_no)].set_xlabel(col, fontsize=4, fontweight='bold')\n    locals()[\"ax\"+str(run_no)].tick_params(labelsize=4, width=0.5)\n    locals()[\"ax\"+str(run_no)].xaxis.offsetText.set_fontsize(4)\n    locals()[\"ax\"+str(run_no)].yaxis.offsetText.set_fontsize(4)\n    #locals()[\"ax\"+str(run_no)].get_legend().remove()\n    \n    run_no += 1\n\nplt.show()","25fa2f8d":"plt.rcParams['figure.dpi'] = 600\nfig = plt.figure(figsize=(10, 10), facecolor='#f6f5f5')\ngs = fig.add_gridspec(5, 5)\ngs.update(wspace=0.3, hspace=0.3)\nbackground_color = '#f6f5f5'\nrun_no = 0\n\ncolormap = ['#1DBA94','#1C5ED2', '#FFC300', '#C70039']\nplt.rc('axes', prop_cycle=(cycler('color', colormap)))\n\nfor row in range(0, 5):\n    for col in range(0, 5):\n        locals()[\"ax\"+str(run_no)] = fig.add_subplot(gs[row, col])\n        locals()[\"ax\"+str(run_no)].set_facecolor(background_color)\n        for s in [\"top\",\"right\"]:\n            locals()[\"ax\"+str(run_no)].spines[s].set_visible(False)\n        run_no += 1  \n\n\nfeatures = list(train.columns[29:54])\n\nrun_no = 0\nfor col in features:\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[col], zorder=2, alpha=1, linewidth=1, color='#ffd514')\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[train['investment_id'].isin(inv_ids)][col], hue=train[train['investment_id'].isin(inv_ids)]['investment_id'],zorder=2, alpha=1, fill=True, color=colormap, linewidth=0.5, legend=False,palette=colormap[:3], hue_order=inv_ids.sort(reverse=True))\n    \n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='x', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='y', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].set_ylabel('')\n    locals()[\"ax\"+str(run_no)].set_xlabel(col, fontsize=4, fontweight='bold')\n    locals()[\"ax\"+str(run_no)].tick_params(labelsize=4, width=0.5)\n    locals()[\"ax\"+str(run_no)].xaxis.offsetText.set_fontsize(4)\n    locals()[\"ax\"+str(run_no)].yaxis.offsetText.set_fontsize(4)\n    #locals()[\"ax\"+str(run_no)].get_legend().remove()\n    \n    run_no += 1\n\nplt.show()","912bfc54":"plt.rcParams['figure.dpi'] = 600\nfig = plt.figure(figsize=(10, 10), facecolor='#f6f5f5')\ngs = fig.add_gridspec(5, 5)\ngs.update(wspace=0.3, hspace=0.3)\nbackground_color = '#f6f5f5'\nrun_no = 0\n\ncolormap = ['#1DBA94','#1C5ED2', '#FFC300', '#C70039']\nplt.rc('axes', prop_cycle=(cycler('color', colormap)))\n\nfor row in range(0, 5):\n    for col in range(0, 5):\n        locals()[\"ax\"+str(run_no)] = fig.add_subplot(gs[row, col])\n        locals()[\"ax\"+str(run_no)].set_facecolor(background_color)\n        for s in [\"top\",\"right\"]:\n            locals()[\"ax\"+str(run_no)].spines[s].set_visible(False)\n        run_no += 1  \n\n\nfeatures = list(train.columns[54:79])\n\nrun_no = 0\nfor col in features:\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[col], zorder=2, alpha=1, linewidth=1, color='#ffd514')\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[train['investment_id'].isin(inv_ids)][col], hue=train[train['investment_id'].isin(inv_ids)]['investment_id'],zorder=2, alpha=1, fill=True, color=colormap, linewidth=0.5, legend=False,palette=colormap[:3], hue_order=inv_ids.sort(reverse=True))\n    \n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='x', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='y', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].set_ylabel('')\n    locals()[\"ax\"+str(run_no)].set_xlabel(col, fontsize=4, fontweight='bold')\n    locals()[\"ax\"+str(run_no)].tick_params(labelsize=4, width=0.5)\n    locals()[\"ax\"+str(run_no)].xaxis.offsetText.set_fontsize(4)\n    locals()[\"ax\"+str(run_no)].yaxis.offsetText.set_fontsize(4)\n    #locals()[\"ax\"+str(run_no)].get_legend().remove()\n    \n    run_no += 1\n\nplt.show()","bde7cf97":"plt.rcParams['figure.dpi'] = 600\nfig = plt.figure(figsize=(10, 10), facecolor='#f6f5f5')\ngs = fig.add_gridspec(5, 5)\ngs.update(wspace=0.3, hspace=0.3)\nbackground_color = '#f6f5f5'\nrun_no = 0\n\ncolormap = ['#1DBA94','#1C5ED2', '#FFC300', '#C70039']\nplt.rc('axes', prop_cycle=(cycler('color', colormap)))\n\nfor row in range(0, 5):\n    for col in range(0, 5):\n        locals()[\"ax\"+str(run_no)] = fig.add_subplot(gs[row, col])\n        locals()[\"ax\"+str(run_no)].set_facecolor(background_color)\n        for s in [\"top\",\"right\"]:\n            locals()[\"ax\"+str(run_no)].spines[s].set_visible(False)\n        run_no += 1  \n\n\nfeatures = list(train.columns[79:104])\n\nrun_no = 0\nfor col in features:\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[col], zorder=2, alpha=1, linewidth=1, color='#ffd514')\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[train['investment_id'].isin(inv_ids)][col], hue=train[train['investment_id'].isin(inv_ids)]['investment_id'],zorder=2, alpha=1, fill=True, color=colormap, linewidth=0.5, legend=False,palette=colormap[:3], hue_order=inv_ids.sort(reverse=True))\n    \n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='x', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='y', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].set_ylabel('')\n    locals()[\"ax\"+str(run_no)].set_xlabel(col, fontsize=4, fontweight='bold')\n    locals()[\"ax\"+str(run_no)].tick_params(labelsize=4, width=0.5)\n    locals()[\"ax\"+str(run_no)].xaxis.offsetText.set_fontsize(4)\n    locals()[\"ax\"+str(run_no)].yaxis.offsetText.set_fontsize(4)\n    #locals()[\"ax\"+str(run_no)].get_legend().remove()\n    \n    run_no += 1\n\nplt.show()","738424c1":"plt.rcParams['figure.dpi'] = 600\nfig = plt.figure(figsize=(10, 10), facecolor='#f6f5f5')\ngs = fig.add_gridspec(5, 5)\ngs.update(wspace=0.3, hspace=0.3)\nbackground_color = '#f6f5f5'\nrun_no = 0\n\ncolormap = ['#1DBA94','#1C5ED2', '#FFC300', '#C70039']\nplt.rc('axes', prop_cycle=(cycler('color', colormap)))\n\nfor row in range(0, 5):\n    for col in range(0, 5):\n        locals()[\"ax\"+str(run_no)] = fig.add_subplot(gs[row, col])\n        locals()[\"ax\"+str(run_no)].set_facecolor(background_color)\n        for s in [\"top\",\"right\"]:\n            locals()[\"ax\"+str(run_no)].spines[s].set_visible(False)\n        run_no += 1  \n\n\nfeatures = list(train.columns[104:129])\n\nrun_no = 0\nfor col in features:\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[col], zorder=2, alpha=1, linewidth=1, color='#ffd514')\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[train['investment_id'].isin(inv_ids)][col], hue=train[train['investment_id'].isin(inv_ids)]['investment_id'],zorder=2, alpha=1, fill=True, color=colormap, linewidth=0.5, legend=False,palette=colormap[:3], hue_order=inv_ids.sort(reverse=True))\n    \n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='x', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='y', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].set_ylabel('')\n    locals()[\"ax\"+str(run_no)].set_xlabel(col, fontsize=4, fontweight='bold')\n    locals()[\"ax\"+str(run_no)].tick_params(labelsize=4, width=0.5)\n    locals()[\"ax\"+str(run_no)].xaxis.offsetText.set_fontsize(4)\n    locals()[\"ax\"+str(run_no)].yaxis.offsetText.set_fontsize(4)\n    #locals()[\"ax\"+str(run_no)].get_legend().remove()\n    \n    run_no += 1\n\nplt.show()","164f57e0":"plt.rcParams['figure.dpi'] = 600\nfig = plt.figure(figsize=(10, 10), facecolor='#f6f5f5')\ngs = fig.add_gridspec(5, 5)\ngs.update(wspace=0.3, hspace=0.3)\nbackground_color = '#f6f5f5'\nrun_no = 0\n\ncolormap = ['#1DBA94','#1C5ED2', '#FFC300', '#C70039']\nplt.rc('axes', prop_cycle=(cycler('color', colormap)))\n\nfor row in range(0, 5):\n    for col in range(0, 5):\n        locals()[\"ax\"+str(run_no)] = fig.add_subplot(gs[row, col])\n        locals()[\"ax\"+str(run_no)].set_facecolor(background_color)\n        for s in [\"top\",\"right\"]:\n            locals()[\"ax\"+str(run_no)].spines[s].set_visible(False)\n        run_no += 1  \n\n\nfeatures = list(train.columns[129:154])\n\nrun_no = 0\nfor col in features:\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[col], zorder=2, alpha=1, linewidth=1, color='#ffd514')\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[train['investment_id'].isin(inv_ids)][col], hue=train[train['investment_id'].isin(inv_ids)]['investment_id'],zorder=2, alpha=1, fill=True, color=colormap, linewidth=0.5, legend=False,palette=colormap[:3], hue_order=inv_ids.sort(reverse=True))\n    \n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='x', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='y', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].set_ylabel('')\n    locals()[\"ax\"+str(run_no)].set_xlabel(col, fontsize=4, fontweight='bold')\n    locals()[\"ax\"+str(run_no)].tick_params(labelsize=4, width=0.5)\n    locals()[\"ax\"+str(run_no)].xaxis.offsetText.set_fontsize(4)\n    locals()[\"ax\"+str(run_no)].yaxis.offsetText.set_fontsize(4)\n    #locals()[\"ax\"+str(run_no)].get_legend().remove()\n    \n    run_no += 1\n\nplt.show()","24134a2f":"plt.rcParams['figure.dpi'] = 600\nfig = plt.figure(figsize=(10, 10), facecolor='#f6f5f5')\ngs = fig.add_gridspec(5, 5)\ngs.update(wspace=0.3, hspace=0.3)\nbackground_color = '#f6f5f5'\nrun_no = 0\n\ncolormap = ['#1DBA94','#1C5ED2', '#FFC300', '#C70039']\nplt.rc('axes', prop_cycle=(cycler('color', colormap)))\n\nfor row in range(0, 5):\n    for col in range(0, 5):\n        locals()[\"ax\"+str(run_no)] = fig.add_subplot(gs[row, col])\n        locals()[\"ax\"+str(run_no)].set_facecolor(background_color)\n        for s in [\"top\",\"right\"]:\n            locals()[\"ax\"+str(run_no)].spines[s].set_visible(False)\n        run_no += 1  \n\n\nfeatures = list(train.columns[154:179])\n\nrun_no = 0\nfor col in features:\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[col], zorder=2, alpha=1, linewidth=1, color='#ffd514')\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[train['investment_id'].isin(inv_ids)][col], hue=train[train['investment_id'].isin(inv_ids)]['investment_id'],zorder=2, alpha=1, fill=True, color=colormap, linewidth=0.5, legend=False,palette=colormap[:3], hue_order=inv_ids.sort(reverse=True))\n    \n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='x', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='y', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].set_ylabel('')\n    locals()[\"ax\"+str(run_no)].set_xlabel(col, fontsize=4, fontweight='bold')\n    locals()[\"ax\"+str(run_no)].tick_params(labelsize=4, width=0.5)\n    locals()[\"ax\"+str(run_no)].xaxis.offsetText.set_fontsize(4)\n    locals()[\"ax\"+str(run_no)].yaxis.offsetText.set_fontsize(4)\n    #locals()[\"ax\"+str(run_no)].get_legend().remove()\n    \n    run_no += 1\n\nplt.show()","8a906280":"plt.rcParams['figure.dpi'] = 600\nfig = plt.figure(figsize=(10, 10), facecolor='#f6f5f5')\ngs = fig.add_gridspec(5, 5)\ngs.update(wspace=0.3, hspace=0.3)\nbackground_color = '#f6f5f5'\nrun_no = 0\n\ncolormap = ['#1DBA94','#1C5ED2', '#FFC300', '#C70039']\nplt.rc('axes', prop_cycle=(cycler('color', colormap)))\n\nfor row in range(0, 5):\n    for col in range(0, 5):\n        locals()[\"ax\"+str(run_no)] = fig.add_subplot(gs[row, col])\n        locals()[\"ax\"+str(run_no)].set_facecolor(background_color)\n        for s in [\"top\",\"right\"]:\n            locals()[\"ax\"+str(run_no)].spines[s].set_visible(False)\n        run_no += 1  \n\n\nfeatures = list(train.columns[179:204])\n\nrun_no = 0\nfor col in features:\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[col], zorder=2, alpha=1, linewidth=1, color='#ffd514')\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[train['investment_id'].isin(inv_ids)][col], hue=train[train['investment_id'].isin(inv_ids)]['investment_id'],zorder=2, alpha=1, fill=True, color=colormap, linewidth=0.5, legend=False,palette=colormap[:3], hue_order=inv_ids.sort(reverse=True))\n    \n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='x', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='y', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].set_ylabel('')\n    locals()[\"ax\"+str(run_no)].set_xlabel(col, fontsize=4, fontweight='bold')\n    locals()[\"ax\"+str(run_no)].tick_params(labelsize=4, width=0.5)\n    locals()[\"ax\"+str(run_no)].xaxis.offsetText.set_fontsize(4)\n    locals()[\"ax\"+str(run_no)].yaxis.offsetText.set_fontsize(4)\n    #locals()[\"ax\"+str(run_no)].get_legend().remove()\n    \n    run_no += 1\n\nplt.show()","e3728191":"plt.rcParams['figure.dpi'] = 600\nfig = plt.figure(figsize=(10, 10), facecolor='#f6f5f5')\ngs = fig.add_gridspec(5, 5)\ngs.update(wspace=0.3, hspace=0.3)\nbackground_color = '#f6f5f5'\nrun_no = 0\n\ncolormap = ['#1DBA94','#1C5ED2', '#FFC300', '#C70039']\nplt.rc('axes', prop_cycle=(cycler('color', colormap)))\n\nfor row in range(0, 5):\n    for col in range(0, 5):\n        locals()[\"ax\"+str(run_no)] = fig.add_subplot(gs[row, col])\n        locals()[\"ax\"+str(run_no)].set_facecolor(background_color)\n        for s in [\"top\",\"right\"]:\n            locals()[\"ax\"+str(run_no)].spines[s].set_visible(False)\n        run_no += 1  \n\n\nfeatures = list(train.columns[204:229])\n\nrun_no = 0\nfor col in features:\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[col], zorder=2, alpha=1, linewidth=1, color='#ffd514')\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[train['investment_id'].isin(inv_ids)][col], hue=train[train['investment_id'].isin(inv_ids)]['investment_id'],zorder=2, alpha=1, fill=True, color=colormap, linewidth=0.5, legend=False,palette=colormap[:3], hue_order=inv_ids.sort(reverse=True))\n    \n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='x', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='y', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].set_ylabel('')\n    locals()[\"ax\"+str(run_no)].set_xlabel(col, fontsize=4, fontweight='bold')\n    locals()[\"ax\"+str(run_no)].tick_params(labelsize=4, width=0.5)\n    locals()[\"ax\"+str(run_no)].xaxis.offsetText.set_fontsize(4)\n    locals()[\"ax\"+str(run_no)].yaxis.offsetText.set_fontsize(4)\n    #locals()[\"ax\"+str(run_no)].get_legend().remove()\n    \n    run_no += 1\n\nplt.show()","da19edae":"plt.rcParams['figure.dpi'] = 600\nfig = plt.figure(figsize=(10, 10), facecolor='#f6f5f5')\ngs = fig.add_gridspec(5, 5)\ngs.update(wspace=0.3, hspace=0.3)\nbackground_color = '#f6f5f5'\nrun_no = 0\n\ncolormap = ['#1DBA94','#1C5ED2', '#FFC300', '#C70039']\nplt.rc('axes', prop_cycle=(cycler('color', colormap)))\n\nfor row in range(0, 5):\n    for col in range(0, 5):\n        locals()[\"ax\"+str(run_no)] = fig.add_subplot(gs[row, col])\n        locals()[\"ax\"+str(run_no)].set_facecolor(background_color)\n        for s in [\"top\",\"right\"]:\n            locals()[\"ax\"+str(run_no)].spines[s].set_visible(False)\n        run_no += 1  \n\n\nfeatures = list(train.columns[229:254])\n\nrun_no = 0\nfor col in features:\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[col], zorder=2, alpha=1, linewidth=1, color='#ffd514')\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[train['investment_id'].isin(inv_ids)][col], hue=train[train['investment_id'].isin(inv_ids)]['investment_id'],zorder=2, alpha=1, fill=True, color=colormap, linewidth=0.5, legend=False,palette=colormap[:3], hue_order=inv_ids.sort(reverse=True))\n    \n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='x', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='y', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].set_ylabel('')\n    locals()[\"ax\"+str(run_no)].set_xlabel(col, fontsize=4, fontweight='bold')\n    locals()[\"ax\"+str(run_no)].tick_params(labelsize=4, width=0.5)\n    locals()[\"ax\"+str(run_no)].xaxis.offsetText.set_fontsize(4)\n    locals()[\"ax\"+str(run_no)].yaxis.offsetText.set_fontsize(4)\n    #locals()[\"ax\"+str(run_no)].get_legend().remove()\n    \n    run_no += 1\n\nplt.show()","51c28b92":"plt.rcParams['figure.dpi'] = 600\nfig = plt.figure(figsize=(10, 10), facecolor='#f6f5f5')\ngs = fig.add_gridspec(5, 5)\ngs.update(wspace=0.3, hspace=0.3)\nbackground_color = '#f6f5f5'\nrun_no = 0\n\ncolormap = ['#1DBA94','#1C5ED2', '#FFC300', '#C70039']\nplt.rc('axes', prop_cycle=(cycler('color', colormap)))\n\nfor row in range(0, 5):\n    for col in range(0, 5):\n        locals()[\"ax\"+str(run_no)] = fig.add_subplot(gs[row, col])\n        locals()[\"ax\"+str(run_no)].set_facecolor(background_color)\n        for s in [\"top\",\"right\"]:\n            locals()[\"ax\"+str(run_no)].spines[s].set_visible(False)\n        run_no += 1  \n\n\nfeatures = list(train.columns[254:279])\n\nrun_no = 0\nfor col in features:\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[col], zorder=2, alpha=1, linewidth=1, color='#ffd514')\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[train['investment_id'].isin(inv_ids)][col], hue=train[train['investment_id'].isin(inv_ids)]['investment_id'],zorder=2, alpha=1, fill=True, color=colormap, linewidth=0.5, legend=False,palette=colormap[:3], hue_order=inv_ids.sort(reverse=True))\n    \n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='x', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='y', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].set_ylabel('')\n    locals()[\"ax\"+str(run_no)].set_xlabel(col, fontsize=4, fontweight='bold')\n    locals()[\"ax\"+str(run_no)].tick_params(labelsize=4, width=0.5)\n    locals()[\"ax\"+str(run_no)].xaxis.offsetText.set_fontsize(4)\n    locals()[\"ax\"+str(run_no)].yaxis.offsetText.set_fontsize(4)\n    #locals()[\"ax\"+str(run_no)].get_legend().remove()\n    \n    run_no += 1\n\nplt.show()","307fea5b":"plt.rcParams['figure.dpi'] = 600\nfig = plt.figure(figsize=(10, 10), facecolor='#f6f5f5')\ngs = fig.add_gridspec(5, 5)\ngs.update(wspace=0.3, hspace=0.3)\nbackground_color = '#f6f5f5'\nrun_no = 0\n\ncolormap = ['#1DBA94','#1C5ED2', '#FFC300', '#C70039']\nplt.rc('axes', prop_cycle=(cycler('color', colormap)))\n\nfor row in range(0, 5):\n    for col in range(0, 5):\n        locals()[\"ax\"+str(run_no)] = fig.add_subplot(gs[row, col])\n        locals()[\"ax\"+str(run_no)].set_facecolor(background_color)\n        for s in [\"top\",\"right\"]:\n            locals()[\"ax\"+str(run_no)].spines[s].set_visible(False)\n        run_no += 1  \n\n\nfeatures = list(train.columns[279:304])\n\nrun_no = 0\nfor col in features:\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[col], zorder=2, alpha=1, linewidth=1, color='#ffd514')\n    sns.kdeplot(ax=locals()[\"ax\"+str(run_no)], x=train[train['investment_id'].isin(inv_ids)][col], hue=train[train['investment_id'].isin(inv_ids)]['investment_id'],zorder=2, alpha=1, fill=True, color=colormap, linewidth=0.5, legend=False,palette=colormap[:3], hue_order=inv_ids.sort(reverse=True))\n    \n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='x', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='y', zorder=0, color='#EEEEEE', linewidth=0.4)\n    locals()[\"ax\"+str(run_no)].set_ylabel('')\n    locals()[\"ax\"+str(run_no)].set_xlabel(col, fontsize=4, fontweight='bold')\n    locals()[\"ax\"+str(run_no)].tick_params(labelsize=4, width=0.5)\n    locals()[\"ax\"+str(run_no)].xaxis.offsetText.set_fontsize(4)\n    locals()[\"ax\"+str(run_no)].yaxis.offsetText.set_fontsize(4)\n    #locals()[\"ax\"+str(run_no)].get_legend().remove()\n    \n    run_no += 1\n\nplt.show()","df10a414":"targets = ['target', 'investment_id', 'time_id']\n\nplt.rcParams['figure.dpi'] = 600\nfig = plt.figure(figsize=(5, 1), facecolor='#f6f5f5')\ngs = fig.add_gridspec(1, 3)\ngs.update(wspace=0.2, hspace=0.5)\n\nbackground_color = \"#f6f5f5\"\n\nrun_no = 0\nfor row in range(0, 1):\n    for col in range(0, 3):\n        locals()[\"ax\"+str(run_no)] = fig.add_subplot(gs[row, col])\n        locals()[\"ax\"+str(run_no)].set_facecolor(background_color)\n        locals()[\"ax\"+str(run_no)].tick_params(axis='y', which=u'both',length=0)\n        locals()[\"ax\"+str(run_no)].set_yticklabels([])\n        for s in [\"top\",\"right\"]:\n            locals()[\"ax\"+str(run_no)].spines[s].set_visible(False)\n        run_no += 1\n\nrun_no = 0\nfor col in targets:\n    sns.kdeplot(train[col], ax=locals()[\"ax\"+str(run_no)], shade=True, color='#fcd12a', alpha=0.95, linewidth=0, zorder=2)\n    locals()[\"ax\"+str(run_no)].set_ylabel('')\n    locals()[\"ax\"+str(run_no)].set_xlabel(col, fontsize=5, fontweight='bold')\n    locals()[\"ax\"+str(run_no)].tick_params(labelsize=5, width=0.5, length=1.5)\n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='x', zorder=0, color='#EEEEEE', linewidth=0.7)\n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='y', zorder=0, color='#EEEEEE', linewidth=0.7)\n    run_no += 1\n    \n#ax0.text(-1.2, 0.44, 'Target Distribution', fontsize=8, fontweight='bold')\n#ax0.text(-1.2, 0.40, 'Target variables are showing a lognormal distribution', fontsize=5)\n\nplt.show()","f152b096":"corr_coef = [np.corrcoef(train['target'], train[col])[0][1] for col in train.columns if col not in ['row_id', 'target', 'investment_id']]\ncorr_name = [col for col in train.columns if col not in ['row_id', 'target', 'investment_id']]\n\ncorr = pd.DataFrame(corr_coef, index=corr_name, columns=['corr'])\ncorr = np.abs(corr).sort_values(by='corr', ascending=False)\n\ncorr.tail(10)","8c57c716":"corr.head(10)","0c05dd48":"# reference https:\/\/www.kaggle.com\/hasanbasriakcay\/ubiquan-market-prediction-eda-ignore-cols\nfrom scipy.stats import pearsonr\n\np_values_list = []\nfor c in NUM_FEATURES:\n    p = round(pearsonr(train.loc[:,'target'], train.loc[:,c])[1], 4)\n    p_values_list.append(p)\n\np_values_df = pd.DataFrame(p_values_list, columns=['target'], index=NUM_FEATURES)\ndef p_value_warning_background(cell_value):\n    highlight = 'background-color: #ffd514;'\n    default = ''\n    if cell_value > 0.05:\n            return highlight\n    return default\n\np_values_df = p_values_df[p_values_df['target'] > 0.03]\np_values_df.style.applymap(p_value_warning_background)","4ae80399":"targets = ['target', 'investment_id', 'time_id']\n\nplt.rcParams['figure.dpi'] = 600\nfig = plt.figure(figsize=(13, 10), facecolor='#f6f5f5')\ngs = fig.add_gridspec(2, 5)\ngs.update(wspace=0.2, hspace=0.5)\n\nbackground_color = \"#f6f5f5\"\n\nrun_no = 0\nfor row in range(0, 2):\n    for col in range(0, 5):\n        locals()[\"ax\"+str(run_no)] = fig.add_subplot(gs[row, col])\n        locals()[\"ax\"+str(run_no)].set_facecolor(background_color)\n        locals()[\"ax\"+str(run_no)].tick_params(axis='y', which=u'both',length=0)\n        locals()[\"ax\"+str(run_no)].set_yticklabels([])\n        for s in [\"top\",\"right\"]:\n            locals()[\"ax\"+str(run_no)].spines[s].set_visible(False)\n        run_no += 1\n\nrun_no = 0\nfor col in corr.tail(10).index:\n    sns.scatterplot(x=train[col], y=train['target'],ax=locals()[\"ax\"+str(run_no)], color='#fcd12a', zorder=2)\n    locals()[\"ax\"+str(run_no)].set_ylabel('target')\n    locals()[\"ax\"+str(run_no)].set_xlabel(col, fontsize=5, fontweight='bold')\n    locals()[\"ax\"+str(run_no)].tick_params(labelsize=5, width=0.5, length=1.5)\n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='x', zorder=0, color='#EEEEEE', linewidth=0.7)\n    locals()[\"ax\"+str(run_no)].grid(which='major', axis='y', zorder=0, color='#EEEEEE', linewidth=0.7)\n    run_no += 1\n    \n#ax0.text(-1.2, 0.44, 'Target Distribution', fontsize=8, fontweight='bold')\n#ax0.text(-1.2, 0.40, 'Target variables are showing a lognormal distribution', fontsize=5)\n\nplt.show();","b9ba8913":"%%time\n# reference https:\/\/www.kaggle.com\/igorkf\/ubiquant-simple-linear-regression-baseline\/notebook\ntrain.sample(int(len(train) * 0.001), random_state=1)[FEATURES].corr().style.background_gradient(cmap='autumn',axis=None, vmin=-0.3, vmax=0.3, low=0.8, high=0.6) ","be2cece7":"#If you get some error, probably you take in reduce memory at your dataset. Algorithm have used linalg cant compute values with float16, which reduce memory using to be optimal.\nfrom statsmodels.stats.outliers_influence import variance_inflation_factor\n\ndef calc_vif(X):\n\n    # Calculating VIF\n    vif = pd.DataFrame()\n    vif[\"variables\"] = X.columns\n    vif[\"VIF\"] = [variance_inflation_factor(X.values, i) for i in range(X.shape[1])]\n\n    return(vif)\n\nvif_val = calc_vif(train[train['investment_id'].isin(inv_ids)][FEATURES])\nvif_val.style.background_gradient(cmap='autumn',axis=0, vmin=2, vmax=10, low=0.8, high=0.6) ","d4295c18":"multicorrel_val = vif_val[vif_val['VIF'] > 10]['variables'].to_list()\n\nprint(f'Features which multocollinear:')\nprint(multicorrel_val)","1e1499a2":"print(f'{len(train.investment_id.unique())} investment identifiers are unique')\nprint(f'{len(train.time_id.unique())} time identifiers are unique')\nprint(f'{len(train.target.unique())} target are unique')","87e595f7":"color_real = '#1DBA94'\ncolor_outliers = '#FFC300'\n\nplt.rcParams['figure.dpi'] = 600\nfig = plt.figure(figsize=(13, 10), facecolor='#f6f5f5')\n\ninvestment_idx = random.choices(train.investment_id, k=9)\n\ngs = fig.add_gridspec(3, 1)\ngs.update(wspace=0.2, hspace=0.35)\n\nbackground_color = \"#f6f5f5\"\n\nrun_no = 0\n\nfor col in range(0, 3):\n    locals()[\"ax\"+str(run_no)] = fig.add_subplot(gs[col, 0])\n    locals()[\"ax\"+str(run_no)].set_facecolor(background_color)\n    locals()[\"ax\"+str(run_no)].tick_params(axis='y', which=u'both',length=0)\n    locals()[\"ax\"+str(run_no)].set_yticklabels([])\n    for s in [\"top\",\"right\"]:\n        locals()[\"ax\"+str(run_no)].spines[s].set_visible(False)\n    run_no += 1\n        \n        \nsns.lineplot(y=train.groupby(['time_id'])['investment_id'].count(), x=train.groupby(['time_id'])['investment_id'].count().index, ax=ax0, color=color_outliers)\nsns.lineplot(y=train.groupby(['time_id'])['target'].mean(), x=train.groupby(['time_id'])['target'].count().index, ax=ax1, color=color_real)\nsns.histplot(x=train.groupby(['investment_id'])['target'].count(), ax=ax2, bins=50, color=color_outliers)\n\nplt.plot();","a6b9e818":"\n\nthreshold_right = train['target'].quantile(0.95)\nthreshold_left = train['target'].quantile(0.05)\n#['#1DBA94','#1C5ED2', '#FFC300', '#C70039']\ncolor_real = '#1DBA94'\ncolor_outliers = '#FFC300'\n\nprint(f'==================   Statistics of target   ==================')\nprint(f'Max: {train[\"target\"].max()}')\nprint(f'Mean: {train[\"target\"].mean()}')\nprint(f'Median: {train[\"target\"].median()}')\nprint(f'Min: {train[\"target\"].min()}')\nprint(f'Std: {train[\"target\"].std()}')\nprint(f'Skew: {train[\"target\"].skew()}')  \nprint(f'Kurtosis: {train[\"target\"].kurtosis()}')\nprint('===========================================================')\n\nfig = plt.figure(figsize=(25, 8), facecolor='#f6f5f5')\ngs = fig.add_gridspec(2, 2)\nbackground_color = '#f6f5f5'\ngs.update(wspace=0.2, hspace=0.5)\nrun_no = 0\nfor row in range(0, 2):\n    for col in range(0, 2):\n        locals()[\"ax\"+str(run_no)] = fig.add_subplot(gs[row, col])\n        locals()[\"ax\"+str(run_no)].set_facecolor(background_color)\n        for s in [\"top\",\"right\"]:\n            locals()[\"ax\"+str(run_no)].spines[s].set_visible(False)\n        run_no += 1  \n\nax0.set_title(f'Distribution of target')                     \nsns.histplot(train['target'], color=color_real, bins=50, ax=ax0)\nax1.set_title(f'Distribution of target outside quantiles')                     \nsns.histplot(train[(train['target'] < threshold_left) | (train['target'] > threshold_right)]['target'], color=color_outliers, bins=50, ax=ax1)\ntime2target_mean_threshold = train[(train['target'] > threshold_left) & (train['target'] < threshold_right)].groupby('time_id')['target'].mean()\ntime2target_std_threshold = train[(train['target'] > threshold_left) & (train['target'] < threshold_right)].groupby('time_id')['target'].std()\ntime2target_mean = train.groupby('time_id')['target'].mean()\ntime2target_std = train.groupby('time_id')['target'].std()\n\n\nax2.set_title(f'Mean and Std changing by time, include quantiles')\nax2.fill_between(\n        time2target_mean_threshold.index,\n        time2target_mean_threshold - time2target_std_threshold,\n        time2target_mean_threshold + time2target_std_threshold,\n        alpha=0.2,\n        color=color_outliers,\n        label='inside quantile std')\nax2.fill_between(\n        time2target_mean.index,\n        time2target_mean - time2target_std,\n        time2target_mean + time2target_std,\n        alpha=0.2,\n        color=color_real,\n        label='real std')\nax2.plot(time2target_mean_threshold.index, time2target_mean_threshold, color=color_outliers, label='inside quantile mean')\nax2.plot(time2target_mean.index, time2target_mean, color=color_real, label='original mean')\nax2.legend(ncol=4, facecolor=background_color, edgecolor=background_color, loc='lower center')\nax3.remove()\nplt.plot();\n","c027a765":"#references: https:\/\/www.kaggle.com\/lucamassaron\/eda-target-analysis\n#column = 'f_1'\n\nfor column in ['f_0', 'f_1', 'f_2', 'f_3', 'f_4']:\n    threshold_right = train['target'].quantile(0.95)\n    threshold_left = train['target'].quantile(0.05)\n    #['#1DBA94','#1C5ED2', '#FFC300', '#C70039']\n    color_real = '#1DBA94'\n    color_outliers = '#FFC300'\n\n    print(f'==================   Statistics of {column}   ==================')\n    print(f'Max: {train[column].max()}')\n    print(f'Mean: {train[column].mean()}')\n    print(f'Median: {train[column].median()}')\n    print(f'Min: {train[column].min()}')\n    print(f'Std: {train[column].std()}')\n    print(f'Skew: {train[column].skew()}')  \n    print(f'Kurtosis: {train[column].kurtosis()}')\n    print('===========================================================')\n\n    fig = plt.figure(figsize=(30, 10), facecolor='#f6f5f5')\n    gs = fig.add_gridspec(3, 2)\n    background_color = '#f6f5f5'\n    gs.update(wspace=0.2, hspace=0.5)\n    run_no = 0\n    for row in range(0, 3):\n        for col in range(0, 2):\n            locals()[\"ax\"+str(run_no)] = fig.add_subplot(gs[row, col])\n            locals()[\"ax\"+str(run_no)].set_facecolor(background_color)\n            for s in [\"top\",\"right\"]:\n                locals()[\"ax\"+str(run_no)].spines[s].set_visible(False)\n            run_no += 1  \n\n    ax0.set_title(f'Distribution of {column}')\n    sns.histplot(train[column], bins=50, color=color_real, ax=ax0)\n\n    ax1.set_title(f'Distribution of {column} outside quantiles')\n    sns.histplot(train[(train['target'] < threshold_left) | (train['target'] > threshold_right)][column], color=color_outliers, ax=ax1, bins=50)\n\n    ax2.set_title(f'Outliers of target by plot column-time_id')\n    sns.scatterplot(y=train[column], x=train['time_id'], color=color_real, ax=ax2, edgecolor=None, label='origin')\n    sns.scatterplot(y=train[(train['target'] < threshold_left) | (train['target'] > threshold_right)][column],x=train['time_id'], color=color_outliers, ax=ax2, edgecolor=None, label='outside quantile')\n    ax2.legend(ncol=2, facecolor=background_color, edgecolor=background_color, loc='lower center')\n\n    ax3.set_title(f'Outliers of target by plot column-investment_id')\n    sns.scatterplot(y=train[column], x=train['investment_id'], color=color_real, ax=ax3, edgecolor=None, label='origin')\n    sns.scatterplot(y=train[(train['target'] < threshold_left) | (train['target'] > threshold_right)][column],x=train['investment_id'], color=color_outliers, ax=ax3, edgecolor=None, label='outside quantile')\n    ax3.legend(ncol=2, facecolor=background_color, edgecolor=background_color, loc='lower center')\n    \n    ax4.set_title(f'Outliers of target by scatter target-column')\n    sns.scatterplot(y=train['target'], x=train[column], color=color_real, ax=ax4, edgecolor=None, label='origin')\n    sns.scatterplot(y=train[(train['target'] < threshold_left) | (train['target'] > threshold_right)]['target'],x=train[column], color=color_outliers, ax=ax4, edgecolor=None, label='outside quantile')\n    ax4.legend(ncol=2, facecolor=background_color, edgecolor=background_color, loc='lower center')\n\n    time2column_mean_threshold = train[(train['target'] > threshold_left) & (train['target'] < threshold_right)].groupby('time_id')[column].mean()\n    time2column_std_threshold = train[(train['target'] > threshold_left) & (train['target'] < threshold_right)].groupby('time_id')[column].std()\n    time2column_mean = train.groupby('time_id')[column].mean()\n    time2column_std = train.groupby('time_id')[column].std()\n\n\n    ax5.set_title(f'Mean and Std changing by time, include quantiles')\n    ax5.fill_between(\n            time2column_mean_threshold.index,\n            time2column_mean_threshold - time2column_std_threshold,\n            time2column_mean_threshold + time2column_std_threshold,\n            alpha=0.2,\n            color=color_outliers,\n            label='inside quantile std')\n    ax5.fill_between(\n            time2column_mean.index,\n            time2column_mean - time2column_std,\n            time2column_mean + time2column_std,\n            alpha=0.2,\n            color=color_real,\n            label='original std')\n    ax5.plot(time2column_mean_threshold.index, time2column_mean_threshold, color=color_outliers, label='inside quantile mean')\n    ax5.plot(time2column_mean.index, time2column_mean, color=color_real, label='original mean')\n    ax5.legend(ncol=4, facecolor=background_color, edgecolor=background_color, loc='lower center')\n\n    plt.plot();","b7b12e40":"[back to top](#table-of-contents)\n<a id=\"6.3\"><\/a>\n## <span style=\"color:#FFC300;\">6.3 Scatterplot between low correlation features and target<\/span>","c908d361":"[back to top](#table-of-contents)\n<a id=\"4.9\"><\/a>\n## <span style=\"color:#FFC300;\">4.9. f_200 - f_224<\/span>","16f6b24f":"[back to top](#table-of-contents)\n<a id=\"4\"><\/a>\n# <span style=\"color:#FFC300;\"> 4. Features <\/span>\n**Features distribution** \n<a id=\"4.1\"><\/a>\n## <span style=\"color:#FFC300;\">4.1. f_0 - f_24<\/span>\n\n**Probably qualitative features** - f_9, f_14, f_18, f_22?, f_27, f_34, f_41, f_48, f_58, f_60?, f_66, f_73?, f_75?, f_81, f_107, f_124, f_120?, f_132, f_138, f_143, f_148, f_152, f_154, f_156, f_163, f_166, f_168, f_170, f_174, f_176, f_177, f_182, f_187, f_227, f_229, f_238, f_246, f_263, f_272, f_263\n\n**Note** - f_111, f_112 are mirror\n","180e385e":"[back to top](#table-of-contents)\n<a id=\"6.4\"><\/a>\n## <span style=\"color:#FFC300;\">6.4 Features Correlation Matrix<\/span>\n**reference**  https:\/\/www.kaggle.com\/igorkf\/ubiquant-simple-linear-regression-baseline\/notebook","603d3d06":"[back to top](#table-of-contents)\n<a id=\"7\"><\/a>\n# <span style=\"color:#FFC300;\">7. Counts of cat features<\/span>\nIn risk theory, such a value as VAR is used. This value means that the tails of the distributions are riskier than those closer to the middle.  \nAlso disbalance of classes - big problem of this data. In my opinion, the good models: who remember about past and include stratifited classes.   \nAs we can see, that large scatter of data place at ~400 value of time.  \nAlso if you train catboost baseline, residual of this model will be make mistakes more at 400 value of time too.  \n*Let me know if you have ideas how to fix this, in my opinion bayesian models can predict this better then all, but a good features cleaning and features engineering can do more.*","1f60656c":"[back to top](#table-of-contents)\n<a id=\"5\"><\/a>\n# <span style=\"color:#FFC300;\">5. Target<\/span>\nDistribution of target and labeled features","3f869ba6":"Highest values:","15b23891":"[back to top](#table-of-contents)\n<a id=\"4.4\"><\/a>\n## <span style=\"color:#FFC300;\"> 4.4. f_75 - f_99<\/span>","5f1466a5":"[back to top](#table-of-contents)\n<a id=\"4.8\"><\/a>\n## <span style=\"color:#FFC300;\">4.8. f_175 - f_199<\/span>","0d6eabb7":"[back to top](#table-of-contents)\n<a id=\"4.3\"><\/a>\n## <span style=\"color:#FFC300;\">4.3. f_50 - f_74<\/span>","2fd9679d":"[back to top](#table-of-contents)\n<a id=\"4.11\"><\/a>\n## <span style=\"color:#FFC300;\">4.11. f_250 - f_274<\/span>","8020e709":"[back to top](#table-of-contents)\n<a id=\"4.10\"><\/a>\n## <span style=\"color:#FFC300;\">4.10. f_225 - f_249<\/span>","c31b4e36":"[back to top](#table-of-contents)\n<a id=\"2\"><\/a>\n# <span style=\"color:#FFC300;\">2. Preparations<\/span>\nPreparing packages and data that will be used in the analysis process. Packages that will be loaded are mainly for data manipulation and data visualization. We are dealing with high-dimensional data, so for use we will use parquet to read data. \n\nIf you gonna compute something I recomend to use dask package.\nhttps:\/\/dask.org\n\nI really appreciate [@valleyzw](https:\/\/www.kaggle.com\/valleyzw) to share code.  \n**Reference:**  https:\/\/www.kaggle.com\/valleyzw\/ubiquant-lgbm-baseline\n","c25c05a0":"### Features","0dee251d":"### Target","9d52348c":"[back to top](#table-of-contents)\n<a id=\"4.7\"><\/a>\n## <span style=\"color:#FFC300;\">4.7. f_150 - f_174<\/span>","f6e199ef":"[back to top](#table-of-contents)\n<a id=\"4.12\"><\/a>\n## <span style=\"color:#FFC300;\">4.12. f_275 - f_300<\/span>","8ba5cabc":"[back to top](#table-of-contents)\n<a id=\"8\"><\/a>\n## <span style=\"color:#FFC300;\">8. Quantile is all you need to analisys<\/span>\nif you have analysis residual of you model, you can saw that he badly approximate outside ~ 5 and 95 quantile.  \nIn addition some work clarified, that it is problem related to disbalance investmend_ids on time_ids.   \nIf you run a regular catboost baseline, you will probably run into this problem.   \nLet's see what features depend on outside 5 and 95 quantiles.  \n\n**references:**\nhttps:\/\/www.kaggle.com\/lucamassaron\/eda-target-analysis","8e03f2ba":"[back to top](#table-of-contents)\n<a id=\"1\"><\/a>\n# **<span style=\"color:#FFC300;\">1. Introduction<\/span>**\nIn this competition, you\u2019ll build a model that forecasts an investment's return rate. Train and test your algorithm on historical prices. Top entries will solve this real-world data science problem with as much accuracy as possible.\n\nSubmissions are evaluated on the mean of the Pearson correlation coefficient for each time ID.\n\n**Files**\n\n`train.csv`\n\n`row_id -` A unique identifier for the row.\n\n`time_id -` The ID code for the time the data was gathered. The time IDs are in order, but the real time between the time IDs is not constant and will likely be shorter for the final private test set than in the training set.\n\n`investment_id`- The ID code for an investment. Not all investment have data in all time IDs.\n\n`target -` The target.\n\n`[f_0:f_299] -` Anonymized features generated from market data.\n\n`example_test.csv` - Random data provided to demonstrate what shape and format of data the API will deliver to your notebook when you submit.\n\n`example_sample_submission.csv` - An example submission file provided so the publicly accessible copy of the API provides the correct data shape and format.\n\n`ubiquant\/` - The image delivery API that will serve the test set. You may need Python 3.7 and a Linux environment to run the example test set through the API offline without errors.\n","dd0263bb":"[back to top](#table-of-contents)\n<a id=\"4.5\"><\/a>\n## <span style=\"color:#FFC300;\">4.5. f_100 - f_124<\/span>","76a079e5":"# <span style=\"color:#FFC300;\">***Ubiquant Market Prediction Explore Data Analisys***<span>\n_**<span style=\"color:#C70039;\">I can\u2019t thank you enough, if you upvote this notebook.<\/span>**_  \ud83d\udd25\ud83d\udc9b\ud83d\udd25\n## <span style=\"color:#FFC300;\">*Table of content*<span>\n<a id=\"table-of-contents\"><\/a>\n- [1. Introduction](#1)\n- [2. Preparations](#2)\n- [3. Dataset Overview](#3) \n- [4. Features](#4) \n    - [4.1. f_0 - f_24](#4.1)\n    - [4.2. f_25 - f_49](#4.2)\n    - [4.3. f_50 - f_74](#4.3)\n    - [4.4. f_75 - f_99](#4.4)\n    - [4.5. f_100 - f_124](#4.5)\n    - [4.6. f_125 - f_149](#4.6)\n    - [4.7. f_150 - f_174](#4.7)\n    - [4.8. f_175 - f_199](#4.8)\n    - [4.9. f_200 - f_224](#4.9)\n    - [4.10. f_225 - f_249](#4.10)\n    - [4.11. f_250 - f_274](#4.11)\n    - [4.12. f_275 - f_299](#4.12)\n- [5. Target](#5) \n- [6. Correlation](#6)\n    - [6.1. Correlation between features and target](#6.1)\n    - [6.2. P-value between features and target](#6.2)\n    - [6.3. Scatterplot between low correlation features and target](#6.3)\n    - [6.4. Features Correlation Matrix](#6.4)\n    - [6.5. Features VIF](#6.5)\n- [7. Investment_id](#7)\n- [8. Quantile is all you need to analisys](#8)","d2883595":"[back to top](#table-of-contents)\n<a id=\"3\"><\/a>\n# <span style=\"color:#FFC300;\">3. Dataset Overview<\/span>\n\nThe intent of the overview is to get a feel of the data and its structure train file. An overview on train datasets will include a quick analysis on missing values and basic statistics.\n\nWe are dealing with many different distributions, probably encoded financial factors. Some if their have outliers, others look like qualitative variables. You need to work with this data using risk theory, this is the basis of investment.\n","c18527e6":"[back to top](#table-of-contents)\n<a id=\"6.2\"><\/a>\n## <span style=\"color:#FFC300;\">6.2 P-value between features and target<\/span>\n**reference**   https:\/\/www.kaggle.com\/hasanbasriakcay\/ubiquan-market-prediction-eda-ignore-cols","79b392bf":"[back to top](#table-of-contents)\n<a id=\"6.5\"><\/a>\n## <span style=\"color:#FFC300;\">6.5 Features VIF<\/span>","3cbced22":"[back to top](#table-of-contents)\n<a id=\"4.6\"><\/a>\n## <span style=\"color:#FFC300;\">4.6. f_125 - f_149<\/span>","1dced0f6":"## **IN PROCESS**\nI update analytics frequently\n\nreferences:\n\nhttps:\/\/www.kaggle.com\/igorkf\/ubiquant-simple-linear-regression-baseline\/notebook  \nhttps:\/\/www.kaggle.com\/lucamassaron\/eda-target-analysis  \nhttps:\/\/www.kaggle.com\/valleyzw\/ubiquant-lgbm-baseline  \nhttps:\/\/www.kaggle.com\/usharengaraju\/tensorflow-probability-probabilisticbnn","e3921e54":"[back to top](#table-of-contents)\n<a id=\"6\"><\/a>\n# <span style=\"color:#FFC300;\">6. Correlation<\/span>\n<a id=\"6.1\"><\/a>\n## <span style=\"color:#FFC300;\">6.1 Correlation between features and target<\/span>\nLowest values:","1e333b45":"[back to top](#table-of-contents)\n<a id=\"4.2\"><\/a>\n## <span style=\"color:#FFC300;\">4.2. f_25 - f_49<\/span>"}}