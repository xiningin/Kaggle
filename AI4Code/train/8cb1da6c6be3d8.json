{"cell_type":{"9f7a9269":"code","81d824d3":"code","bfc5e5ce":"code","c276f32c":"code","40c26f92":"code","3036566e":"code","bffe6146":"code","f85d1640":"code","3a5b52f0":"code","512ea112":"code","a8c34672":"code","eb545f97":"code","27641fc3":"code","1118ebcb":"code","d8ecfb32":"code","06df36ce":"code","aa69dc0a":"code","fe87d7ff":"code","956e3d5e":"code","d44473ec":"code","3570bae7":"code","2f83962c":"code","b033f20c":"code","1a7cb160":"code","fa370763":"code","54d505b3":"code","4975c140":"code","d2c4607b":"code","11ad0fbf":"markdown","86eaa64b":"markdown","5a326d43":"markdown","6677e3c8":"markdown","c1bcd2e3":"markdown","ae0bd7c7":"markdown","0f0e8a37":"markdown","650ec417":"markdown","a2790c83":"markdown","f89ca784":"markdown","42ab9b1b":"markdown","b42221bc":"markdown","2b29ee8c":"markdown","304bb5fa":"markdown","974ce944":"markdown","26b50992":"markdown","4a32727e":"markdown","9158bb49":"markdown","8a432f1b":"markdown","da087e9f":"markdown"},"source":{"9f7a9269":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd# data processing, CSV file I\/O (e.g. pd.read_csv)\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport matplotlib.patches as mpatches\nplt.style.use('fivethirtyeight')\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\npd.options.mode.chained_assignment = None\n\n# Any results you write to the current directory are saved as output.","81d824d3":"import pandas as pd\ndata = pd.read_csv(\"..\/input\/nfl-data-up-to-week-12\/Week12NFLData.csv\")","bfc5e5ce":"data = data.loc[(data.play_type.isin(['pass','run', 'no_play'])) &\n               data.epa.isna()==False]","c276f32c":"data[data['play_type'] =='no_play']","40c26f92":"data.loc[data.desc.str.contains('left end|left tackle|left guard|up the middle|right guard|right tackle|right end|rushes'),\n'play_type'] = 'run'\n\ndata.loc[data.desc.str.contains('scrambles|sacked|pass'), 'play_type'] = 'pass'\ndata.reset_index(drop = True, inplace = True)","3036566e":"#Create a smaller dataframe with plays where rusher_player_name is null\nrusher_nan = data.loc[(data['play_type'] == 'run') &\n         (data['rusher_player_name'].isnull())]\n         \n#Create a list of the indexes\/indices for the plays where rusher_player_name is null\nrusher_nan_indices = list(rusher_nan.index)\n\nfor i in rusher_nan_indices:\n    #Split the description on the blank spaces, isolating each word\n    desc = data['desc'].iloc[i].split()\n    #For each word in the play description\n    for j in range(0,len(desc)):\n        #If a word is right, up, or left\n        if desc[j] == 'right' or desc[j] == 'up' or desc[j] == 'left':\n            #Set rusher_player_name for that play to the word just before the direction\n            data['rusher_player_name'].iloc[i] = desc[j-1]     \n        else:\n            pass\n#Create a smaller dataframe with plays where passer_player_name is null\npasser_nan = data.loc[(data['play_type'] == 'pass') &\n         (data['passer_player_name'].isnull())]\n#Create a list of the indexes\/indices for the plays where passer_player_name is null\npasser_nan_indices = list(passer_nan.index)\n\nfor i in passer_nan_indices:\n    #Split the description on the blank spaces, isolating each word\n    desc = data['desc'].iloc[i].split()\n    #For each word in the play description\n    for j in range(0,len(desc)):\n        #If a word is pass\n        if desc[j] == 'pass':\n            data['passer_player_name'].iloc[i] = desc[j-1]            \n        else:\n            pass\n#Change any backwards passes that incorrectly labeled passer_player_name as Backward\ndata.loc[data['passer_player_name'] == 'Backward', 'passer_player_name'] == float('NaN')\n\nreceiver_nan = data.loc[(data['play_type'] == 'pass') & \n                        (data['receiver_player_name'].isnull()) &\n                        (data['desc'].str.contains('scrambles|sacked|incomplete')==False)]\n\nreceiver_nan_indices = list(receiver_nan.index)\n\nfor i in receiver_nan_indices:\n    desc = data['desc'].iloc[i].split()\n\n    for j in range(0,len(desc)):\n        if (desc[j]=='left' or desc[j]=='right' or desc[j]=='middle') and (desc[j] != desc[-1]):\n            if desc[j+1]=='to':\n                data['receiver_player_name'].iloc[i] = desc[j+2]\n        else:\n            pass","bffe6146":"data.loc[data['epa'] > 0, 'success'] = 1","f85d1640":"bears_stats = data.loc[data['posteam'] == 'CHI']\nbears_stats","3a5b52f0":"plt.figure(1, figsize = (10,6))\nplt.hist(bears_stats['epa'].loc[bears_stats['play_type'] == 'pass'], bins = 50, label = 'Pass', color = 'orange')\nplt.hist(bears_stats['epa'].loc[bears_stats['play_type'] == 'run'], bins = 50, label = 'Run', alpha = .7, color = 'darkblue')\nplt.xlabel('Expected Points Added')\nplt.ylabel('Number of plays')\nplt.title('EPA Distribution Based on Play Type - Bears 2019')\nplt.text(6,50,'Data from nflscrapR', fontsize=10, alpha=.7)\n#Will show the colors and labels of each histogram\nplt.legend()\nplt.show()","512ea112":"sns.lmplot(data = bears_stats, x = 'yardline_100', y = 'epa', \n                  fit_reg = False, hue = 'play_type',\n                    height = 8, \n                  scatter_kws = {'s':200})\nplt.show()","a8c34672":"selected_column = ['pass_length', 'pass_location', 'run_location', 'run_gap', 'play_type']\nfor c in selected_column:\n    print(bears_stats[c].value_counts(normalize=True).to_frame(), '\\n')","eb545f97":"plt.figure(figsize=(16,9))\nsns.swarmplot(x= bears_stats['qtr'],\n              y = bears_stats['yards_gained'],\n              hue = bears_stats['play_type'])\nplt.legend(loc='upper right')\nplt.show()","27641fc3":"nfcnorth = data.loc[(data['posteam']== 'CHI') | (data['posteam']== 'DET') | \n                   (data['posteam']== 'GB') | (data['posteam']== 'MIN')]","1118ebcb":"sns.barplot( x = 'posteam', y = 'epa', data = nfcnorth)","d8ecfb32":"nfl_wrs = data.loc[(data['play_type']=='pass') & (data['down']<=4)].groupby(by='receiver_player_name')[['epa','success','yards_gained', 'td_prob', 'air_yards', 'yardline_100','qtr', 'yac_epa']].mean()","06df36ce":"bears_wrs = data.loc[(data['posteam']=='CHI') & (data['play_type']=='pass') & (data['down']<=4)].groupby(by='receiver_player_name')[['epa','success','yards_gained', 'td_prob', 'air_yards', 'yardline_100','qtr', 'yac_epa']].mean()","aa69dc0a":"#Add new column\nnfl_wrs['attempts'] = data.loc[(data['play_type']=='pass') & \n                        (data['down']<=4)].groupby(by='receiver_player_name')['epa'].count()\n\n#Sort by mean epa\nnfl_wrs.sort_values('epa', ascending=False, inplace=True)\n\n#Filter by attempts\nnfl_wrs = nfl_wrs.loc[nfl_wrs['attempts'] > 10] \n\n#\nbears_wrs['attempts'] = data.loc[(data['posteam']=='CHI') & (data['play_type']=='pass') & \n                        (data['down']<=4)].groupby(by='receiver_player_name')['epa'].count()\n\n#Sort by mean epa\nbears_wrs.sort_values('epa', ascending=False, inplace=True)\n\n#Filter by attempts\nbears_wrs = bears_wrs.loc[bears_wrs['attempts'] > 10] \n","fe87d7ff":"bears_wrs","956e3d5e":"plt.figure(figsize=(16,9))\nplt.title('Receiver Usage for the Bears')\nsns.countplot(bears_stats['receiver_player_name'])","d44473ec":"plt.figure(figsize=(16,9))\nplt.title('RunningBack Usage for the Bears')\nsns.countplot(bears_stats['rusher_player_name'])","3570bae7":"wr_table = pd.pivot_table(bears_stats, index = ['receiver_player_name'],\n               columns = ['defteam'],\n               values = ['epa'], aggfunc = [np.mean], fill_value = 0)        \nwr_table","2f83962c":"plt.figure(figsize=(16,9))\nplt.rcParams['font.size'] = 10\nbg_color = (0.88,0.85,0.95)\nplt.rcParams['figure.facecolor'] = bg_color\nplt.rcParams['axes.facecolor'] = bg_color\nfig, ax = plt.subplots(1)\np = sns.heatmap(wr_table,\n                cmap='coolwarm',\n                annot=True,\n                fmt=\".1f\",\n                annot_kws={'size':16},\n                ax=ax)\nplt.xlabel('Vs Defense')\nplt.ylabel('Receiver')\nax.set_ylim((0,15))\nplt.text(3,13.3, \"Bears WRs Heat Map\", fontsize = 20, color='Black', fontstyle='italic')\nplt.show()","b033f20c":"bears_rbs_pivot = pd.pivot_table(bears_stats,\n            index = ['rusher_player_name'],\n            columns = ['run_location'],\n            values = ['epa'], \n            aggfunc = [np.mean],\n            fill_value = 0)","1a7cb160":"plt.figure(figsize=(16,9))\nplt.rcParams['font.size'] = 10\nbg_color = (0.88,0.85,0.95)\nplt.rcParams['figure.facecolor'] = bg_color\nplt.rcParams['axes.facecolor'] = bg_color\nfig, ax = plt.subplots(1)\np = sns.heatmap(bears_rbs_pivot,\n                cmap='Blues',\n                annot=True,\n                fmt=\".1f\",\n                annot_kws={'size':18},\n                ax=ax)\nplt.xlabel('Run Direction')\nplt.ylabel('Receiver')\nax.set_ylim((0,15))\nplt.text(1,10, \"Bears RBs Heat Map\", fontsize = 20, color='Black', fontstyle='italic')\nplt.show()","fa370763":"sns.set(style=\"white\", context=\"talk\")\nplt.figure(figsize=(20,9))\nsns.violinplot(data = data[data.posteam =='CHI'],\n                   x ='receiver_player_name', y = 'epa')\nplt.show()","54d505b3":"bears_wrs.epa.mean()","4975c140":"nfl_wrs.epa.mean()","d2c4607b":"plt.figure(figsize=(16,9))\nsns.set(style=\"white\", context=\"talk\")\nsns.catplot(x=\"qtr\", y='epa', hue=\"receiver_player_name\", kind=\"swarm\", data=bears_stats);\nplt.show()","11ad0fbf":"Bears WRs are performing below the NFL average at EPA. Biggest indicator of this is dropped passes which the Bears lead the NFL in. ","86eaa64b":"![61g9IpO3TJL._SL1024_.jpg](attachment:61g9IpO3TJL._SL1024_.jpg)\n","5a326d43":"Counting the amount of attempts aka 'passing plays involved' the Bears receiving core had. Allen Robinson and Tarik Cohen are by far the Bears highest usage players. While Taylor Gabriel has had injuries this season holding his attempts down and 2nd year Anthony Miller is still figuring out the offense so isnt being used as frequently. The Tight Ends has been a troubled position all season with Burton, Holtz, Horsted, Braunecker and Shaheen all rotating. Shaheen and Burton were put on IR this week so the others should get a boost in attempts in coming weeks. ","6677e3c8":"Heat map of who was playing well vs the Bears opponents this season. A few standout games from Montgomery, Miller, Wims and Braunecker. With Robinson and Gabriel having consistently positive EPA and Miller showing flashes but remains rocky with his production. But even these players are producing average EPA, for the offense to play better they have to make more plays. ","c1bcd2e3":"The rushing attack is not good with most players means being around 0. But from this set Montgomery is consistently solid running and Tarik is slightly hurting the rushing attack. QB Trubisky is positive rushing to his left. While using WRs for \"trick\" plays has generally been unsuccessful when ran with Anthony Miller but running with Gabriel and Patterson to the left has shown a slight uptick in EPA. ","ae0bd7c7":"Conclusions: The Bears offense looks to be stalling in 2019 for multiple reasons. \n\nThe plays being called are skewed heavily towards pass, which can make it easier for the opposing team to defend. But when runs are called they are largely unsuccessful and not adding to the net EPA. \n\nThis hinderance can be further explained by looking at the production from the Bears skill positions specifically the receiving core. Except for Allen Robinson none are performing close to the league average and it appears by having several receivers with middling attemps the coaching staff is unsure of who they can get production out of.\n\nThe QB was ignored in this report due to the dozens of analysis on him already available, examining the players and play calls around him seemed prudent given the teams record. ","0f0e8a37":"Specifically looking at the NFL and Bears WRs epa","650ec417":"The Bears offense in the first half has been abysmal this season, setting several records for longest time without touchdowns and points scored this season. But they gain more yards in the 3rd quarter through the ground and the air.","a2790c83":"Searching the \"description\" column in the data to find plays that contain a position or \"scramble\" or \"sacked\" to included in runs and passes respectively. ","f89ca784":"Creating a dataframe with Run, Pass and NoPlays (that are penalties). ","42ab9b1b":"Looking at play distribution by where the Bears are on the field. Typically the closer to 0 (opposing teams goalline) teams should have high EPA rushing plays since that is the easiest way to score. But the Bears have a wide range of passing results and average rushing results. ","b42221bc":"Loading only the Chicago Bears Data","2b29ee8c":"Comparing the Bears EPA to their divisional rivals.","304bb5fa":"In the Preseason the Chicago Bears were heralded as playoff favorites and Super Bowl Contenders. 12 Weeks into the season the Bears are 5-7, technically in the hunt but ESPN predicts them to have a 1% chance of making it in. Throughout the Offseason, fans heard that the offense was taking steps into the '202' progression of plays and most expected a big jump from 2018 considering they were average in almost every statistical category. This report investigates the inner workings of the Chicago Bears offense. \n\nExpected Points Added is used to add more value to the limited nature of yards gained by adding field position and down & distance. \n\nGaining three yards on  2nd down and 10, and gaining three yards on 4th down and 3, will both register as +3 in yards gained. But, the three yards gained with three yards to go is more valuable than the three yards gained with 10 yards to go, because it creates a first down and keeps the chains moving. The same principle applies with field position. Taking a sack in general is bad but taking one in your own terriotory vs taking one in field goal range are different and should be reflected in statistics. A loss of 10 on your 35 is graded differently than a loss of 10 on your opponents 35 using EPA. \n\nCalculating EPA is used from next points scored for total plays. As the points are added up for and against the offensive team, the differential point advantage can be found for any down and distance.\n![](http:\/\/)\n\nDatafiles are provided by NflscrapR. ","974ce944":"Chart with all of the Bears WRs going over the epa, success (whether epa is greater than 0 or not), yards gained, probability of scoring a touchdown on that play, air yards gained, distance to opposing teams endzone, quarter, yards after catch epa.","26b50992":"![](http:\/\/https:\/\/www.chicagobears.com\/)","4a32727e":"Looking at all the Bears WRs EPA by Game this season. ","9158bb49":"The Bears are a predominantly short passing team, preferring checkdowns over coverage beaters. Most passes going to the Quarterback's right which is similar to all NFL QB's since most are right handed. The Bears also are a horizontal rushing team, running to the Right and Left at similar clips but avoiding the middle. Passing calls of nearly ~50% is high, most NFL Coordinators prefer a 50\/50 game and the league average currently is 60\/40.","8a432f1b":"Looking at the running backs rookie Montgomery is the clear #1 back with Cohen filling in for a change of pace. FA signee Davis barely got used through 12 weeks.  Along with the Bears using WRs on occasion for trick run plays. ","da087e9f":"Distribution of EPA on Runs vs Pass plays. As we can see the Bears have more runs than passes and they seem to be more spread and slightly more successful. Running the ball has been a struggle for the Bears all season, injuries on the Offensive Line and regression from older players appear to be the biggest factors. According the Pro-Football Reference the Bears rank 20th in passing and 26th in rushing. "}}