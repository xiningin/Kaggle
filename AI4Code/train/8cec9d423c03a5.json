{"cell_type":{"031d5162":"code","a3497aa6":"code","3257fc92":"code","9321921e":"code","7861c470":"code","a05ca2b1":"code","02d1dfd6":"code","aa0bb4df":"code","0035236f":"code","e1726b52":"code","fdca8835":"code","cdd8e979":"code","4aebe173":"code","dbebece3":"code","f50aec8b":"code","a26139da":"code","fb83a60f":"code","772d8ce2":"code","37ff1aae":"code","ed259c76":"code","be807233":"code","e34d135e":"code","08bfba8b":"code","9f4d5f36":"code","09ee684a":"code","99b8a14a":"code","1dfc0c88":"code","7330ee4d":"code","dc444d10":"code","f619c72c":"code","cbe25ec0":"code","2197fae0":"code","936b6072":"code","52a9dcaf":"code","8871437f":"code","bb56fa64":"code","eb11c8ee":"code","3ea96654":"code","702992f1":"code","dc28538e":"code","2e960174":"code","51cc5cb4":"code","875617a5":"code","a71383bb":"code","035f20dd":"code","ab6b9ab8":"code","cf87e235":"code","ac965550":"code","3e885372":"code","889d01c0":"code","55ce0299":"code","f45f3966":"code","43cc4823":"code","8cad8dc4":"code","7a2aa9e2":"code","eff9427e":"code","9e62aa6d":"code","e646bf32":"code","52b48dd6":"code","52529fdc":"code","1d106b7d":"code","20006251":"code","a1d2780f":"code","de1d89b7":"code","1d65feab":"markdown","99c79dd7":"markdown","86b4ff03":"markdown","d953d407":"markdown","865d6cca":"markdown","3c896efc":"markdown","77606896":"markdown","28c17299":"markdown","f8babad8":"markdown","12bd8668":"markdown","e9092304":"markdown","5f6f8797":"markdown","5f4fc8f6":"markdown","3a9dd882":"markdown","4be2f89a":"markdown","e7add3fd":"markdown","7dd0bdbc":"markdown","4615d15e":"markdown","a3eb761a":"markdown","72f91f12":"markdown","4fd85b42":"markdown","27b0311f":"markdown","58206565":"markdown","9fb3d875":"markdown","31114cc6":"markdown","52146aaf":"markdown","1f3a36b3":"markdown","4a64dc4d":"markdown","697303fa":"markdown","1ca47684":"markdown","9087ab46":"markdown","b5a68bbd":"markdown","dec22f82":"markdown","37ddde43":"markdown","21cd1795":"markdown","06385c11":"markdown","27de17a8":"markdown","04889d0c":"markdown","671142cf":"markdown","4e4eaa8c":"markdown","6d240c6e":"markdown","7aeb18ca":"markdown","81ffe2d7":"markdown","fe666d45":"markdown","739799b5":"markdown","6a1a86a8":"markdown","1f25b764":"markdown"},"source":{"031d5162":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport matplotlib.style\nimport matplotlib as mpl\nmpl.style.use('ggplot')\nsns.set_style('whitegrid')\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn import preprocessing\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.base import TransformerMixin\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import MinMaxScaler\nfrom sklearn import metrics\nfrom sklearn.feature_selection import RFE\nfrom sklearn.linear_model import LinearRegression\nfrom statsmodels.stats.outliers_influence import variance_inflation_factor\nfrom sklearn.metrics import r2_score","a3497aa6":"df = pd.read_csv('\/kaggle\/input\/car-price-prediction\/CarPrice_Assignment.csv')","3257fc92":"df.head()","9321921e":"df.info()","7861c470":"pd.DataFrame(df.isnull().sum())","a05ca2b1":"df = df.drop('car_ID', axis =1)","02d1dfd6":"df.head()","aa0bb4df":"df.describe()","0035236f":"plt.hist(df['price'] , bins = 20 ,color = 'blue')\nplt.xlabel('price')\nplt.ylabel('no. of cars')\nplt.title('Histogram')","e1726b52":"df.dtypes","fdca8835":"df['CarName'] = df['CarName'].str.split(' ',expand=True)","cdd8e979":"df['CarName'].unique()","4aebe173":"\ndf['CarName'] = df['CarName'].replace({'maxda': 'mazda', 'nissan': 'Nissan', 'porcshce': 'porsche', 'toyouta': 'toyota', \n                            'vokswagen': 'volkswagen', 'vw': 'volkswagen'})","dbebece3":" df['symboling'] = df['symboling'].astype(str)","f50aec8b":"df.loc[df.duplicated()]","a26139da":"categorical = df.select_dtypes(include=['object']).columns\nnumerical = df.select_dtypes(exclude=['object']).columns\ndf_categorical = df[categorical]\ndf_numerical = df[numerical]","fb83a60f":"df_numerical.head()","772d8ce2":"df.corr()['price'].sort_values()","37ff1aae":"df_categorical.head()","ed259c76":"plt.figure(figsize=(20, 15))\nplt.subplot(3,3,1)\nsns.boxplot(x = 'doornumber', y = 'price', data = df)\nplt.subplot(3,3,2)\nsns.boxplot(x = 'fueltype', y = 'price', data = df)\nplt.subplot(3,3,3)\nsns.boxplot(x = 'aspiration', y = 'price', data = df)\nplt.subplot(3,3,4)\nsns.boxplot(x = 'carbody', y = 'price', data = df)\nplt.subplot(3,3,5)\nsns.boxplot(x = 'enginelocation', y = 'price', data = df)\nplt.subplot(3,3,6)\nsns.boxplot(x = 'drivewheel', y = 'price', data = df)\nplt.subplot(3,3,7)\nsns.boxplot(x = 'enginetype', y = 'price', data = df)\nplt.subplot(3,3,8)\nsns.boxplot(x = 'cylindernumber', y = 'price', data = df)\nplt.subplot(3,3,9)\nsns.boxplot(x = 'fuelsystem', y = 'price', data = df)\nplt.show()","be807233":"drop_variables = ['symboling' , 'aspiration' ,'doornumber' ,'carbody' ,'fuelsystem' , 'wheelbase' , 'carheight' ,'boreratio' ,'stroke' , 'compressionratio' , 'peakrpm'  ]","e34d135e":"df.drop( drop_variables , axis = 1, inplace = True)\ndf.shape","08bfba8b":"df.head()","9f4d5f36":"cat = [ 'CarName' , 'fueltype' , 'enginelocation' , 'enginetype' , 'cylindernumber' , 'drivewheel' ]","09ee684a":"dummy_variables = pd.get_dummies(df[cat])\ndummy_variables.shape","99b8a14a":"dummy_variables = pd.get_dummies(df[cat], drop_first = True)\ndummy_variables.shape","1dfc0c88":"df = pd.concat([df, dummy_variables], axis = 1)","7330ee4d":"df.head()","dc444d10":"df.drop( cat, axis = 1, inplace = True)\ndf.shape","f619c72c":"df.head()","cbe25ec0":"np.random.seed(0)\ntrain, test = train_test_split(df, train_size = 0.7, test_size = 0.3, random_state = 100)","2197fae0":"train.shape","936b6072":"test.shape","52a9dcaf":"train.head()","8871437f":"sc = StandardScaler()","bb56fa64":"num = ['carlength','carwidth','curbweight','enginesize','horsepower','citympg','highwaympg','price']","eb11c8ee":"import warnings\nwarnings.filterwarnings(\"ignore\")\ntrain[num] = sc.fit_transform(train[num])","3ea96654":"train.head()","702992f1":"plt.figure(figsize = (20, 20))\nsns.heatmap(train.corr(), cmap=\"Blues\")\nplt.show()","dc28538e":"y_train = train.pop('price')\nX_train = train","2e960174":"X_train.shape","51cc5cb4":"model=LinearRegression()","875617a5":"lr_1 =model.fit(X_train,y_train)","a71383bb":"print(model.intercept_)","035f20dd":"print(model.coef_)","ab6b9ab8":"lm = LinearRegression()\nlm.fit(X_train, y_train)\n\nrfe = RFE(lm, 15)             \nrfe = rfe.fit(X_train, y_train)","cf87e235":"list(zip(X_train.columns,rfe.support_,rfe.ranking_))","ac965550":"# Selecting the variables which are in support\n\ncol_sup = X_train.columns[rfe.support_]\ncol_sup","3e885372":"# Creating X_train dataframe with RFE selected variables\n\nX_train_rfe = X_train[col_sup]","889d01c0":"# Adding a constant variable and Build a first fitted model\nimport statsmodels.api as sm  \nX_train_rfec = sm.add_constant(X_train_rfe)\nlm_rfe = sm.OLS(y_train,X_train_rfec).fit()\n\n#Summary of linear model\nprint(lm_rfe.summary())","55ce0299":"X_train_rfe1 = X_train_rfe.drop('enginetype_rotor', 1,)\n\n# Adding a constant variable and Build a second fitted model\n\nX_train_rfe1c = sm.add_constant(X_train_rfe1)\nlm_rfe1 = sm.OLS(y_train, X_train_rfe1c).fit()\n\n#Summary of linear model\nprint(lm_rfe1.summary())","f45f3966":"# Dropping highly correlated variables and insignificant variables\n\nX_train_rfe2 = X_train_rfe1.drop('enginelocation_rear', 1,)\n\n# Adding a constant variable and Build a third fitted model\n\nX_train_rfe2c = sm.add_constant(X_train_rfe2)\nlm_rfe2 = sm.OLS(y_train, X_train_rfe2c).fit()\n\n#Summary of linear model\nprint(lm_rfe2.summary())","43cc4823":"# Create a dataframe that will contain the names of all the feature variables and their respective VIFs\nvif = pd.DataFrame()\nvif['Features'] = X_train_rfe2.columns\nvif['VIF'] = [variance_inflation_factor(X_train_rfe2.values, i) for i in range(X_train_rfe2.shape[1])]\nvif['VIF'] = round(vif['VIF'], 2)\nvif = vif.sort_values(by = \"VIF\", ascending = False)\nvif","8cad8dc4":"# Dropping highly correlated variables and insignificant variables\n\nX_train_rfe3 = X_train_rfe2.drop('fueltype_gas', 1,)\n\n# Adding a constant variable and Build a fourth fitted model\n\nX_train_rfe3c = sm.add_constant(X_train_rfe3)\nlm_rfe3 = sm.OLS(y_train, X_train_rfe3c).fit()\n\n#Summary of linear model\nprint(lm_rfe3.summary())","7a2aa9e2":"# Dropping highly correlated variables and insignificant variables\n\nX_train_rfe4 = X_train_rfe3.drop('cylindernumber_six', 1,)\n\n# Adding a constant variable and Build a fifth fitted model\n\nX_train_rfe4c = sm.add_constant(X_train_rfe4)\nlm_rfe4 = sm.OLS(y_train, X_train_rfe4c).fit()\n\n#Summary of linear model\nprint(lm_rfe4.summary())","eff9427e":"# Dropping highly correlated variables and insignificant variables\n\nX_train_rfe5 = X_train_rfe4.drop('cylindernumber_five', 1,)\n\n# Adding a constant variable and Build a sixth fitted model\n\nX_train_rfe5c = sm.add_constant(X_train_rfe5)\nlm_rfe5 = sm.OLS(y_train, X_train_rfe5c).fit()\n\n#Summary of linear model\nprint(lm_rfe5.summary())","9e62aa6d":"# Dropping highly correlated variables and insignificant variables\n\nX_train_rfe6 = X_train_rfe5.drop('cylindernumber_four', 1,)\n\n# Adding a constant variable and Build a seventh fitted model\n\nX_train_rfe6c = sm.add_constant(X_train_rfe6)\nlm_rfe6 = sm.OLS(y_train, X_train_rfe6c).fit()\n\n#Summary of linear model\nprint(lm_rfe6.summary())","e646bf32":"# Create a dataframe that will contain the names of all the feature variables and their respective VIFs\nvif = pd.DataFrame()\nvif['Features'] = X_train_rfe6.columns\nvif['VIF'] = [variance_inflation_factor(X_train_rfe6.values, i) for i in range(X_train_rfe6.shape[1])]\nvif['VIF'] = round(vif['VIF'], 2)\nvif = vif.sort_values(by = \"VIF\", ascending = False)\nvif","52b48dd6":"import warnings\nwarnings.filterwarnings(\"ignore\")\n\ntest[num] = sc.transform(test[num])\ntest.shape","52529fdc":"y_test = test.pop('price')\nX_test = test","1d106b7d":"# Adding constant\nX_test_1 = sm.add_constant(X_test)\n\nX_test1 = X_test_1[X_train_rfe6c.columns]","20006251":"y_predictions = lm_rfe6.predict(X_test1)","a1d2780f":"# Plotting y_test and y_pred.\nfig = plt.figure()\nplt.scatter(y_test,y_predictions)\nfig.suptitle('y_test vs y_predions', fontsize=20)   \nplt.xlabel('y_test ', fontsize=18)                       \nplt.ylabel('y_predictions', fontsize=16)    ","de1d89b7":"r2_score(y_test, y_predictions)","1d65feab":"## 2. Check out the data","99c79dd7":"First we will look at the distribution of the price which is our dependent variable.","86b4ff03":"## 4. Visualization of data","d953d407":"Let's apply standardization except to dummy variables.","865d6cca":"### In this kernel we will try to predict the price of cars. ","3c896efc":"* Dropping cylindernumber_five  beacuse its p-value is 0.495 and we want p-value less than 0.05.","77606896":"Running RFE with the output number of the variable equals to 15.","28c17299":"## 5. Data Preparation","f8babad8":"Check for the duplicates.","12bd8668":"### Problem Statement\nA Chinese automobile company Geely Auto aspires to enter the US market by setting up their manufacturing unit there and producing cars locally to give competition to their US and European counterparts.\n\nThey have contracted an automobile consulting company to understand the factors on which the pricing of cars depends. Specifically, they want to understand the factors affecting the pricing of cars in the American market, since those may be very different from the Chinese market. The company wants to know:\n\nWhich variables are significant in predicting the price of a car\nHow well those variables describe the price of a car\nBased on various market surveys, the consulting firm has gathered a large data set of different types of cars across the America market.\n\n### Business Goal\nWe are required to model the price of cars with the available independent variables. It will be used by the management to understand how exactly the prices vary with the independent variables. They can accordingly manipulate the design of the cars, the business strategy etc. to meet certain price levels. Further, the model will be a good way for management to understand the pricing dynamics of a new market.\n","e9092304":"So from both of the analysis of numerical and categorical variables I decided to use the below varibales to fit the multiple linear regression model.\n* price , carwidth , carlength, curbweight ,enginesize ,horsepower ,citympg , highwaympg , CarName , fueltype , enginelocation , enginetype , cylindernumber , drivewheel","5f6f8797":"## Thank you !! ","5f4fc8f6":"## 1. Import libraries","3a9dd882":"Now we have the dummy variables created for the categirical variables. We can drop the original cateorical variables from the dataset.","4be2f89a":"### Let's begin!","e7add3fd":"## 6. Multiple linear regression model","7dd0bdbc":"Now the VIFs and p-values both are within an acceptable range. Variables are statistically significant.","4615d15e":"First I'm going to drop the variables which are not going to be used for the model.","a3eb761a":"## I hope this kernal is helpful for you. Your UPVOTE means alot to me!!","72f91f12":"Now let's change the datatype of symboling as it is categorical variable as per dictionary file","4fd85b42":"*Price = -0.2346 + 0.557 x horsepower + 0.5820 x Carname_audi + 1.5135 x Carname_bmw + 2.0651 x Carname_buick + 1.8828 X Carname_jaguar + 1.1414 x Carname_porsche + 0.7072 x Carname_volvo - 1.1521 x enginetype_dohcv - 0.9373 x cylindernumber_twelve *","27b0311f":"We generally want a VIF that is less than 5. So let's drop some variables.","58206565":"* carlength           0.682920\n* carwidth            0.759325\n* horsepower          0.808139\n* curbweight          0.835305\n* enginesize          0.874145\n* highwaympg         -0.697599\n* citympg            -0.685751\n* carwidth , carlength, curbweight ,enginesize ,horsepower seems to have a poitive correlation with price.\n* citympg , highwaympg seem to have a significant negative correlation with price.","9fb3d875":"## 3. Cleaning of data","31114cc6":"R squared value is 0.884","52146aaf":"* The cars with fueltype as diesel are comparatively expensive than the cars with fueltype as gas.\n* The cars with engine location as rear in very expensive than cars with front engine location.\n* The cars with ohcv enginetype seems to be expensive and have a higher range of prices.\n* The price of the car vary with the no. of cylinders.\n* Expensive cars seem to have rwd drivewheel.\n* No. of doors do not influence the price of the car.\n","1f3a36b3":"Then we will add the dummy variables to the original dataframe.","4a64dc4d":"We are good to go! We don't have any duplicate rows.","697303fa":"I'm going to drop car_ID column from the dataset","1ca47684":"Now lets use RFE to select the independent variables which accurately predict the dependent variable price.\n\n## RFE - Recursive feature elimination \nLet's use Recursive feature elimination since we have too many independent variables.","9087ab46":"* Dropping enginetype_rotor beacuse its p-value is 0.264 and we want p-value less than 0.05.","b5a68bbd":"Next I'm going to check the correlation of price with other variables. Then I'll use the variables with highest correlation to fit our multiple regression model.","dec22f82":"* Dropping cylindernumber_four  beacuse its p-value is 0.349 and we want p-value less than 0.05.","37ddde43":"* Dropping enginelocation_rear beacuse its p-value is 0.154 and we want p-value less than 0.05.","21cd1795":"The R squared value of training set is 0.884 and test set is 0.87.","06385c11":"Let's rebuild the model.","27de17a8":"The above will be used to predict the price of cars.","04889d0c":"There are typing mistakes in Car company names. Let's rename them.","671142cf":"* Dropping cylindernumber_six  beacuse its p-value is 0.684 and we want p-value less than 0.05.","4e4eaa8c":"## 7. Predictions","6d240c6e":"First we'll seperate numerical and categorical variables.","7aeb18ca":"First we need to convert the levels of the categorical variables to numeric values. For this we have to use dummy variables.","81ffe2d7":"Let's rebuild the model.","fe666d45":"Multiple linear regression model is,","739799b5":"According to distribution pf price mean price is around 13276.71. Minimum price of a car is 5118 while maximum price is 45400.","6a1a86a8":"## Thank you for opening this notebook!!","1f25b764":"Let's draw boxplots for all the categorical variables."}}