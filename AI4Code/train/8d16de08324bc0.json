{"cell_type":{"38af0657":"code","c0857e95":"code","c902078a":"code","11f4afe9":"code","2c2f5c14":"code","a88dec3a":"code","d3aa8648":"code","f0f977e9":"code","bab55170":"code","b4c361ed":"code","2cfa4f4a":"code","9080fb63":"code","c5646fca":"code","6e4fff64":"code","057b6db6":"code","49fe6f1a":"code","61a3fda3":"code","02cd2c55":"code","e955c11a":"code","35de7408":"code","2ab44012":"code","d6822d43":"code","13c96463":"code","76ac0490":"code","20a8b1b2":"code","eeaad5a4":"code","eea13734":"code","6520fa03":"code","4e09147b":"code","d0009066":"markdown","0f452112":"markdown","fd169476":"markdown","cca739fb":"markdown","0269cc5d":"markdown","5acba51e":"markdown","85bab0c7":"markdown","daeb1ec0":"markdown","9f34305c":"markdown","ddfebba0":"markdown","b00aa63b":"markdown","d678437d":"markdown","2bda50a8":"markdown","9bba6bca":"markdown","dcbaf96e":"markdown","38099384":"markdown","97eeabae":"markdown","d3dc7cbf":"markdown","d5c41760":"markdown","7e70b715":"markdown"},"source":{"38af0657":"from IPython.core.display import display, HTML\nimport pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom sklearn.decomposition import PCA\nfrom scipy.stats import boxcox, probplot, norm, shapiro\nfrom sklearn.preprocessing import PowerTransformer, MinMaxScaler\nfrom sklearn.cluster import KMeans\nimport os\nimport warnings\nwarnings.filterwarnings('ignore')","c0857e95":"#Main function for plot. Usefull for other case of clustering.\n\ndef comprueba_normalidad(df, return_type='axes', title='Normalization'):\n    '''\n    '''\n    fig_tot = (len(df.columns))\n    fig_por_fila = 3.\n    tamanio_fig = 4.\n    num_filas = int( np.ceil(fig_tot\/fig_por_fila) )    \n    plt.figure( figsize=( fig_por_fila*tamanio_fig+5, num_filas*tamanio_fig+2 ) )\n    c = 0 \n    shapiro_test = {}\n    lambdas = {}\n    for i, col in enumerate(df.columns):\n        ax = plt.subplot(num_filas, fig_por_fila, i+1)\n        probplot(x = df[df.columns[i]], dist=norm, plot=ax)\n        plt.title(df.columns[i])\n        shapiro_test[df.columns[i]] = shapiro(df[df.columns[i]])\n    plt.suptitle(title)\n    plt.show()\n    shapiro_test = pd.DataFrame(shapiro_test, index=['Test Statistic', 'p-value']).transpose()\n    return shapiro_test","c902078a":"os.listdir()","11f4afe9":"XY = pd.read_csv('..\/input\/customerbehaviour\/q3a-product-user.csv')","2c2f5c14":"XY.head(2)","a88dec3a":"XY.describe()","d3aa8648":"XY.info()","f0f977e9":"plt.figure(1 , figsize = (15 , 5))\nsns.countplot(x = 'STATE' , data = XY)\nplt.show()","bab55170":"XY_cuants = XY[['AGE', 'EDU', 'YEARS_EMPLOYED', 'INCOME', \n       'CARD_DEBT', 'OTHER_DEBT',  'DEBT_INCOME_RATIO']].copy()","b4c361ed":"XY_normalizado = (XY_cuants-XY_cuants.mean())\/XY_cuants.std()\n# This function shows more ordered graph. \n ","2cfa4f4a":"plt.figure(figsize=(14,6))\nax = sns.boxplot(data=XY_normalizado)\nax.set_xticklabels(ax.get_xticklabels(),rotation=90)\nplt.title(u'Representation of (Normarlized) Product User Information ')\nplt.ylabel('The Normalized Value ')\n_ = plt.xlabel('Product User Information')","9080fb63":"## Representation of the distributions of the variables using histograms.","c5646fca":"plt.figure(figsize=(20,20))\nn = 0\nfor i, column in enumerate(XY_cuants.columns):\n    n+=1\n    plt.subplot(5, 5, n)\n    sns.distplot(XY_cuants[column], bins=30)\n    plt.title('Distribution of Product User Info'.format(column))\nplt.show()","6e4fff64":"matrix_corr = XY_cuants.corr(method='pearson')\nn_ticks = len(XY_cuants.columns)\nplt.figure( figsize=(15, 10) )\nplt.xticks(range(n_ticks), XY.columns, rotation='vertical')\nplt.yticks(range(n_ticks), XY.columns)\nplt.colorbar(plt.imshow(matrix_corr, interpolation='nearest', \n                            vmin=-1., vmax=1., \n                            cmap=plt.get_cmap('Blues')))","057b6db6":"plt.rcParams['figure.figsize'] = (15, 8)\nsns.heatmap(XY_cuants.corr(), cmap = 'Wistia', annot = True)\nplt.title('Heatmap for the Data', fontsize = 20)\nplt.show()","49fe6f1a":"shapiro_test = comprueba_normalidad(XY_cuants, title='Variable Normalization')","61a3fda3":"shapiro_test","02cd2c55":"scaler = MinMaxScaler(feature_range=(0, 1))\nX_escalado = scaler.fit_transform(XY_cuants)","e955c11a":"shapiro_test","35de7408":"# Now, with the next code, we are looking for the best number of cluster for our dataset.","2ab44012":"cluster_range = range(1,20)\ncluster_wss=[] \nfor cluster in cluster_range:\n    model = KMeans(cluster)\n    model.fit(X_escalado)\n    cluster_wss.append(model.inertia_)","d6822d43":"plt.figure(figsize=[10,6])\nplt.title('WSS curve to find the optimal value of clusters ')\nplt.xlabel('# groups')\nplt.ylabel('WSS')\nplt.plot(list(cluster_range),cluster_wss,marker='o')\nplt.show()","13c96463":"model = KMeans(n_clusters=6,random_state=0)\nmodel.fit(X_escalado)","76ac0490":"#Original Dataset with the predictions\ndf_total = XY_cuants.copy()\ndf_total['cluster']=model.predict(X_escalado)\ndf_total[:2]","20a8b1b2":"df_total.cluster.value_counts().plot(kind='bar', figsize=(10,4))\nplt.title('Count of users per group')\nplt.xlabel('Group')\n_ = plt.ylabel('Counting')","eeaad5a4":"#Here, we coud see our clients inside of a cluster","eea13734":"descriptivos_grupos = df_total.groupby(['cluster'],as_index=False).mean()\ndescriptivos_grupos","6520fa03":"df_total.groupby('cluster').mean().plot(kind='bar', figsize=(15,7))\nplt.xlabel(u'Cluster Number')\n_ = plt.ylabel('Customer Characteristics')\nplt.title('Customer Characteristics based on Income')","4e09147b":"df_total[:2]","d0009066":"<h1><center> Representation of the correlation Matrix.","0f452112":"The following graphs represent the <a href='https:\/\/es.wikipedia.org\/wiki\/Gr%C3%A1fico_Q-Q'>Q-Q Plot<\/a>, which is a graph that compares between two distributions. In this case, each of the variables with a normal distribution. If they follow the same distribution, the points fall close to the red line.","fd169476":"<h1><center> First Step <\/center><\/h1>","cca739fb":"I also get a dataframe with the means of the variables in each group. This would represent each of the groups.\n\nThis is very necessary since the actions that the objective of this problem would be to do actions to each of the groups separately. For this, it is very important to know what each group is like, in order to act differently.","0269cc5d":"# Now, we have to obtain the characteristic of each group to find the hiden information inside our DF and give value to our analysis.","5acba51e":"<h1><center> Data Transformation to find the hypothesis.","85bab0c7":"\n### I predict and get customers with your prediction","daeb1ec0":"\n## Pre-scaling the data:","9f34305c":"Variable normalization is the process in which a variable is transformed to follow a normal or Gaussian distribution.\n\nIn general, we will only want to normalize the data if we are going to use a machine learning algorithm or a statistical technique that assumes that the data is distributed in a Gaussian or normal way. For example, student's t tests, ANOVAs, linear regressions, logistic regressions, linear discriminant analysis (LDA), k-means, etc.\n\nAmong the ways to transform a variable to normal are methods such as the Box-Cox transformation or the Yeo-Johnson method.","ddfebba0":"\nThe graph assumes the optimal point when the curve creates a bend. In this case it would be about 4-6 groups.","b00aa63b":"<h1><center> GRAPHICS <\/center><\/h1>","d678437d":"We will choose the number of groups at 6, but what is usually done is to try several and see if the final results make sense from a business point of view, as I will comment later.","2bda50a8":"All variables are statistically significantly not distributed as a normal.\n\n** Shapiro-Wilk test: ** If the p-value is less than a significance level , it is concluded that the distribution does not come from a normal one.","9bba6bca":"I create a dataframe with all the variables and a new one that is the prediction of the assigned cluster:","dcbaf96e":"# I explain the groups using the means of each variable per group: \u00b6\n\nI distingusih the group by the income ","38099384":"I save in a XY_cuants ** with  the non-missing and numerical features ","97eeabae":"# Data normalization:","d3dc7cbf":"Finally, for each of the groups, I obtain their user behaviors or characteristics based on different income level\n","d5c41760":"___\n<h1><center>  Clustering<\/center><\/h1>\n\n___\n\n## Customer Segmentation of   Product company\n\n###Q3a Description :\n\nThe objective of the problem is to analyze the user buying behavior based on their historical data.\n\n","7e70b715":"<h1><center> Segmentation using K-means clustering:"}}