{"cell_type":{"76614514":"code","256a590b":"code","60257c69":"code","85a66c54":"code","46fd0c8a":"code","0550195e":"code","dd720999":"code","9caff1c4":"code","efb4c7d7":"code","8791f304":"code","1f44e449":"code","a58bbf5c":"code","e1081956":"code","633d4f94":"markdown","65fadd2d":"markdown","6c07de0b":"markdown","86496323":"markdown","1e7c94de":"markdown","4a2ad8ff":"markdown","56f499b3":"markdown","261ebc80":"markdown","a95ad87f":"markdown","6b8e0edb":"markdown","320944e6":"markdown","1e5aac33":"markdown","f7a05856":"markdown","713ccedf":"markdown"},"source":{"76614514":"GCP_PROJECT_ID = 'YOUR_PROJECT_ID'","256a590b":"import sys\nif \"kaggle_secrets\" in sys.modules:\n    from kaggle_secrets import UserSecretsClient\n    UserSecretsClient().set_gcloud_credentials(project=GCP_PROJECT_ID)","60257c69":"import sys\nif \"google.colab\" in sys.modules:\n    from google.colab import auth\n    auth.authenticate_user()","85a66c54":"!gcloud beta billing accounts list","46fd0c8a":"BILLING_ACCOUNT_ID = 'YOUR_BILLING_ACCOUNT_ID'\n!gcloud beta billing projects link $GCP_PROJECT_ID --billing-account $BILLING_ACCOUNT_ID","0550195e":"!gcloud services --project $GCP_PROJECT_ID enable ml.googleapis.com cloudbuild.googleapis.com","dd720999":"BUCKET_NAME = 'YOUR_BUCKET_NAME'\nGCS_BUCKET = f'gs:\/\/{BUCKET_NAME}'\n!gsutil mb -p $GCP_PROJECT_ID $GCS_BUCKET","9caff1c4":"SERVICE_ACCOUNT_NAME ='YOUR_SERVICE_ACCOUNT_NAME'\nSERVICE_ACCOUNT_EMAIL = f'{SERVICE_ACCOUNT_NAME}@{GCP_PROJECT_ID}.iam.gserviceaccount.com'\n\n!gcloud iam --project $GCP_PROJECT_ID service-accounts create $SERVICE_ACCOUNT_NAME","efb4c7d7":"!gcloud projects describe $GCP_PROJECT_ID |grep projectNumber","8791f304":"PROJECT_NUMBER = 'YOUR_PROJECT_NUMBER'\nDEFAULT_AI_PLATFORM_SERVICE_ACCOUNT = f'service-{PROJECT_NUMBER}@cloud-ml.google.com.iam.gserviceaccount.com'","1f44e449":"!gcloud iam --project $GCP_PROJECT_ID service-accounts add-iam-policy-binding \\\n--role=roles\/iam.serviceAccountAdmin \\\n--member=serviceAccount:$DEFAULT_AI_PLATFORM_SERVICE_ACCOUNT \\\n$SERVICE_ACCOUNT_EMAIL","a58bbf5c":"Finally run the following to allow the service account to impersonate your your users account.","e1081956":"!gcloud iam service-accounts --project $GCP_PROJECT_ID add-iam-policy-binding \\\n    $SERVICE_ACCOUNT_EMAIL \\\n    --member=\"user:YOUR_EMAIL_ADDRESS@gmail.com\" \\\n    --role=\"roles\/iam.serviceAccountUser\"","633d4f94":"### 2.1 Setup Auth for a Kaggle Notebook\n\nIf you are using a Kaggle notebook you will need to repeat this step for any new notebook that you use with this project. In your notebook click on Add-ons -> Google Cloud SDK and follow the instructions on the prompt. Then run the following command to add your auth credentials to this notebook.","65fadd2d":"Use your Billing Account_ID from above and run the following to link your billing account with your project.","6c07de0b":"## Congratulations !\nYou are now ready to run tensorflow-cloud. Note that these steps only need to be run one time. Once you have your project setup you can reuse the same project and bucket configuration for future runs. For any new notebooks you will need to repeat the step two to add your Google Cloud auth credentials. ","86496323":"Grant the [`default AI Platform service account`](https:\/\/cloud.google.com\/ai-platform\/training\/docs\/custom-service-account#default) admin role (roles\/iam.serviceAccountAdmin) on your new service account.","1e7c94de":"# Overview\nThis guide is to help first time users set up a Google Cloud Platform account specifically with the intention to use [tensorflow_cloud](https:\/\/github.com\/tensorflow\/cloud) to easily run training at scale on Google Cloud AI Platform. [tensorflow_cloud](https:\/\/github.com\/tensorflow\/cloud) provides APIs that allow users to easily go from debugging, training, tuning Keras and TensorFlow code in a local or kaggle environment to distributed training\/tuning on Cloud.\n\n<table align=\"left\">\n    <td>\n        <a href=\"https:\/\/colab.research.google.com\/github\/tensorflow\/cloud\/blob\/master\/examples\/google_cloud_project_setup_instructions.ipynb\">\n            <img width=\"50\" src=\"https:\/\/cloud.google.com\/ml-engine\/images\/colab-logo-32px.png\" alt=\"Colab logo\">Run in Colab\n        <\/a>\n    <\/td>\n    <td>\n        <a href=\"https:\/\/github.com\/tensorflow\/cloud\/blob\/master\/examples\/google_cloud_project_setup_instructions.ipynb\">\n            <img src=\"https:\/\/cloud.google.com\/ml-engine\/images\/github-logo-32px.png\" alt=\"GitHub logo\">View on GitHub\n        <\/a>\n     <\/td>\n    <td>\n        <a href=\"https:\/\/www.kaggle.com\/nitric\/google-cloud-project-setup-instructions\">\n            <img width=\"90\" src=\"https:\/\/www.kaggle.com\/static\/images\/site-logo.png\" alt=\"Kaggle logo\">Run in Kaggle\n        <\/a>\n     <\/td>\n<\/table>\n","4a2ad8ff":"## 3. Link your billing account to your project\nNext step is to [set up  the billing account](https:\/\/cloud.google.com\/billing\/docs\/how-to\/modify-project) for this project. Google Cloud Creates a project for you by default which is called \u201cMy First Project\u201d. We will use this default project. Use your Project ID (from step 1) to run the following commands. This will show you your Billing Account_ID, make a note of this for the next step.","56f499b3":"The [`default AI Platform service account`](https:\/\/cloud.google.com\/ai-platform\/training\/docs\/custom-service-account#default) is identified by an email address with the format `service-PROJECT_NUMBER@cloud-ml.google.com.iam.gserviceaccount.com`. Run the following command to get your PROJECT_NUMBER.","261ebc80":"## 5. Create a Google Cloud Storage bucket\n\nWe will use this storage bucket for temporary assets as well as to save the model checkpoints. Make a note of the name of the bucket for future reference. Note bucket names are unique globally.","a95ad87f":"Use the project number above to construct the service account email.","6b8e0edb":"## 4. Enable Required APIs for tensorflow-cloud in your project\nFor tensorflow_cloud we use two specific APIs: [AI Platform Training Jobs API](https:\/\/console.cloud.google.com\/marketplace\/product\/google\/ml.googleapis.com) and [Cloud builder API]( https:\/\/console.developers.google.com\/apis\/api\/cloudbuild.googleapis.com\/overview). Note that this is a one time setup for this project, you do not need to rerun this command for every notebook.\n","320944e6":"### 2.2 Setup Auth for a Colab Notebook\nIf you are using a Colab notebook you will need to repeat this step for any new notebook that you use with this project. Run the following command to add your auth credentials to this notebook.","1e5aac33":"## 1. Sign up for Google Cloud Platform\n\nTo start go to https:\/\/cloud.google.com\/ and click on \u201cGet Started For Free\". This is a two step sign up process where you will need to provide your name, address and a credit card. The starter account is free and it comes with $300 credit that you can use. For this step you will need to provide a Google Account ( i.e. your Gmail account) to sign in.\n\nAfter completing the sign up process you will be redirected to [Google Cloud Platform welcome page](https:\/\/console.cloud.google.com\/home\/dashboard). click on the \"Home\" tab and make a note of your Project ID.","f7a05856":"## 2.Enable Google Cloud SDK and Authenticate your notebook\nNow that you have set up your project we can continue with the rest of the configuration steps directly from this notebook. There Three types of notebook, this step (step #2) is slightly different for each notebook, the rest of the steps (step #3 to #6) are the same for all notebooks.\n\n* 2.1. Auth for Kaggle notebooks\n* 2.2. Auth for Colab notebook\n* 2.3. Auth for Cloud AI Notebooks - No action needed move to step 3.","713ccedf":"## Create a service account for HP Tuning jobs\nThis step is required to use HP Tuning on Google Cloud using CloudTuner.\nTo [create a service account](https:\/\/cloud.google.com\/iam\/docs\/creating-managing-service-accounts#iam-service-accounts-create-gcloud) run the following command and make a note of your service account name."}}