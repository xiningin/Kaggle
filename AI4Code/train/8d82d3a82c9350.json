{"cell_type":{"6913fb9d":"code","c83c4017":"code","35398948":"code","2070b7e8":"code","aae68150":"code","85316cbd":"code","c968055d":"code","def89037":"code","883ccbec":"code","708267e1":"code","b80806e2":"code","fb59443e":"code","9aa17183":"code","05b1d247":"code","dd1ca39c":"code","3a6bab6b":"code","fb4e6355":"code","a0f10c0e":"code","c842f4d4":"code","87bc8d66":"code","a20b3a9f":"code","38b89786":"code","8cb2df92":"code","7917e003":"markdown","bf9677c3":"markdown","72e4e3d8":"markdown","b3967774":"markdown"},"source":{"6913fb9d":"import numpy as np\nimport pandas as pd\nfrom matplotlib import pyplot as plt\nimport seaborn\nfrom sklearn.metrics import f1_score, precision_score, recall_score, confusion_matrix\n\nfrom fastai import *\nfrom fastai.vision import *\n\n%reload_ext autoreload\n%autoreload 2\n%matplotlib inline","c83c4017":"df = pd.read_csv(\"..\/input\/flower-goggle-tpu-classification\/flowers_idx.csv\")\nlabel = pd.read_csv(\"..\/input\/flower-goggle-tpu-classification\/flowers_label.csv\")","35398948":"df.head()","2070b7e8":"label.head()","aae68150":"path = Path('\/kaggle\/input\/flower-goggle-tpu-classification\/flower_tpu\/flower_tpu\/flowers_google\/')\npath_test = Path('\/kaggle\/input\/flower-goggle-tpu-classification\/flower_tpu\/flower_tpu\/test\/test\/')","85316cbd":"tfms = get_transforms(do_flip=True,max_rotate=0.1,max_lighting=0.15)\ntest = (ImageList.from_folder(path_test,extensions='.jpeg'))\n\ndata = (ImageList.from_df(df,path,folder='flowers_google',suffix='.jpeg',cols='id')\n                .split_by_rand_pct(0.15)\n                .label_from_df(cols='flower_cls')\n                .transform(tfms)\n                .add_test(test)\n                .databunch(bs=32)\n                .normalize(imagenet_stats))","c968055d":"data.show_batch(rows=4)","def89037":"arch = models.resnet50\nlearn = cnn_learner(data, arch, metrics=accuracy, model_dir='\/kaggle\/working')","883ccbec":"learn.lr_find()\nlearn.recorder.plot()","708267e1":"learn.summary()","b80806e2":"lr = 1e-2","fb59443e":"learn.fit_one_cycle(6,lr,moms=(0.9,0.8))","9aa17183":"interp = ClassificationInterpretation.from_learner(learn)","05b1d247":"interp.plot_top_losses(12,figsize=(20,8))","dd1ca39c":"interp.most_confused(min_val=3)","3a6bab6b":"img = open_image('\/kaggle\/input\/flower-goggle-tpu-classification\/flower_tpu\/flower_tpu\/test\/test\/d9cb87ad0.jpeg')\nprint(learn.predict(img)[0])\nimg","fb4e6355":"samp = pd.read_csv('\/kaggle\/input\/flower-classification-with-tpus\/sample_submission.csv')\nn = samp.shape[0]\npath_alltest = '\/kaggle\/input\/flower-goggle-tpu-classification\/flower_tpu\/flower_tpu\/test\/test\/'","a0f10c0e":"for i in range(n):\n    idc = samp.iloc[i][0]\n    k = path_alltest + idc + '.jpeg'\n    k = open_image(k)\n    ans = learn.predict(k)[0]\n    samp.loc[[i],1:] = str(ans)","c842f4d4":"samp.head(10)","87bc8d66":"lab = {}\nfor i in range(label.shape[0]):\n  sha = label.iloc[i]\n  lab[sha[1]]=int(sha[0])","a20b3a9f":"samp.label.replace(lab,inplace=True)","38b89786":"samp.head()","8cb2df92":"samp.to_csv('submission.csv',index=False)","7917e003":"# Train","bf9677c3":"# Prediction and submission","72e4e3d8":"# Interpretation","b3967774":"# Load data\n\nThis [dataset](https:\/\/www.kaggle.com\/ianmoone0617\/flower-goggle-tpu-classification) contains an already processed tfrecords data as csv and jpegs. Will be using it in this notebook."}}