{"cell_type":{"6b526dcc":"code","31f9351b":"code","2ec41ffc":"code","7810b964":"code","2a2ddd51":"code","549aa64f":"code","d0c6197c":"code","64c4abf1":"code","2d4f2a1a":"code","2dd1eee3":"code","0161b66f":"code","22f505e1":"code","7969eee8":"code","e7dd76b1":"code","6fd84209":"code","d35bf238":"code","67211f38":"code","3195d5c1":"code","19682ed7":"code","a95e5065":"code","c54d6f61":"code","500b42c1":"code","c403c319":"code","5ef73dd4":"code","ad5c27a4":"code","a7c43eb4":"code","0cf0beed":"code","be872725":"code","e13992d0":"code","ef682534":"code","b852e0e8":"code","3324c5ed":"code","548f8879":"code","c5741351":"code","8bc49641":"code","5eb85841":"code","ab0d985b":"code","270e20a8":"code","136f7fa3":"code","38d11dbd":"code","4b39897f":"code","2533608f":"code","95cab3b7":"code","7ec0c512":"code","bc11d92d":"code","49214167":"code","707a8892":"code","423426a6":"code","1ce97398":"code","82692ac0":"code","47e906eb":"code","594dd464":"code","3d451dc8":"code","8c831c04":"code","3b569b03":"code","31cdc493":"code","a73ffee0":"code","9b907b71":"code","f0d25d39":"code","1bfc95eb":"code","c6540023":"code","d9eb261f":"code","6c0121e5":"code","b9e7e22b":"code","b48282de":"code","0a626d15":"code","8784f1a3":"code","ab97ffd7":"code","38b3e23c":"code","f9a72580":"code","5eae624f":"code","b9fdd52a":"code","d7d24534":"code","7569bd98":"code","cc775ed5":"code","ebb9631b":"code","ef60d3e2":"code","e587ce5f":"code","79613eea":"code","c9099a82":"code","21438d7c":"code","d931f6b8":"code","d8354c68":"code","1d2fd5d5":"code","5d563591":"code","734e9bf0":"code","34071c60":"code","f2058923":"code","3e34a2b4":"code","0ddccef0":"code","3dd9f216":"code","54d2cbf3":"code","5c526d51":"code","5d5e4d66":"code","20654baa":"code","6ba0a681":"code","6e608853":"code","4f8ea73b":"code","b10830d5":"code","3235a911":"code","19e8ddc1":"code","52dfc76b":"code","890c5801":"code","195af50b":"code","f8e23b53":"code","a01260fd":"code","c2dd8bc1":"code","1cd817cb":"code","85410861":"code","b93268d4":"code","9980012e":"code","fd68eaa9":"code","c2d55265":"code","8c689d1a":"code","5ef5eb8f":"code","7f90f83c":"code","5b55592d":"code","311effe9":"code","05766328":"code","f65c4b22":"code","426baa04":"code","4e575304":"code","b34e04ef":"code","d5b52829":"code","ccf22ba3":"code","b56dff2e":"code","8b88b1e0":"code","fcd168cb":"code","9abb025b":"code","b9e98d7d":"code","44b81df3":"code","d0945bc6":"code","7299d691":"code","6a0e6e9e":"code","9ca9b3d2":"code","1f79fa0d":"code","f7d9391a":"code","74fe1137":"code","7139fb41":"code","9843d525":"code","94becf4c":"code","24375a2c":"code","d17569fc":"code","072f968c":"code","3fdb33de":"code","3eb2fe17":"code","3f68f524":"code","a8713c71":"code","b8c070e1":"code","2fbd5962":"code","b37b5ba5":"code","e183ae7b":"code","703e1098":"code","f9aa8280":"code","b3adcae9":"code","51100a37":"code","48fafaba":"code","3aeef1fd":"code","64695ea8":"code","ff1cf40f":"code","35d5de0f":"code","5be250f6":"code","96c13820":"code","bfed3b6d":"code","63abcb7d":"code","a8d77dd4":"code","43b370f7":"code","ba1421d2":"code","bbdd7f7b":"code","cf4aa3b7":"code","dded204a":"code","e6f4897b":"code","d2e8a814":"code","fd23a783":"code","12c466eb":"code","1f0b3d8d":"code","3878ef73":"code","fc88d013":"code","a93e9ae1":"code","841ecb49":"code","56e759dd":"code","f39732f8":"code","45a725f2":"code","377231a6":"code","9899dafb":"code","8a93d34d":"code","a6251708":"markdown","9ac9c24f":"markdown","83369cee":"markdown","06ab3208":"markdown","0d0d399d":"markdown","85f99b9a":"markdown","414ff84e":"markdown","c2959450":"markdown","04c9f7cd":"markdown","c538963d":"markdown","6e2845d5":"markdown","6d5551e4":"markdown","2e08c7f1":"markdown","de82a7d1":"markdown","a65244e8":"markdown","92209eaa":"markdown","98c0fac4":"markdown","735e1b79":"markdown","88e9f86c":"markdown","31a2755e":"markdown","45e3661f":"markdown","0f12a99f":"markdown","8efef59f":"markdown","759b63ad":"markdown","59668751":"markdown","f49608e2":"markdown","bfbcbbca":"markdown","d679e58f":"markdown","ad45e763":"markdown","e7a26f67":"markdown","b84e2d56":"markdown","b3515ab1":"markdown","bdbf2647":"markdown","e689f540":"markdown","bce31704":"markdown","e3d7080b":"markdown","ba9dbb25":"markdown","7c9db078":"markdown","e3992a27":"markdown","142deef9":"markdown","05869c76":"markdown","ce4dd112":"markdown","2f5f3f6e":"markdown","a379374d":"markdown","f1b7390a":"markdown","b7345015":"markdown","db147c74":"markdown","a2d0cccf":"markdown","ca764ae0":"markdown","76bcf425":"markdown","3230f991":"markdown","c70ff2f6":"markdown","54cca69e":"markdown","7bb3ce7e":"markdown","d6727c7d":"markdown","079d793c":"markdown","75bc332a":"markdown","fd2b633c":"markdown","d4c88d99":"markdown","99630ae5":"markdown","45bffba3":"markdown","a0134db2":"markdown","61eca4fd":"markdown","088f91c5":"markdown","d6de93cc":"markdown","0088c131":"markdown","fda0eca1":"markdown","4c49d46b":"markdown","b740bcb6":"markdown","4868fea0":"markdown","26a9f499":"markdown","b9ba6ff3":"markdown","a15cfa28":"markdown","e2183935":"markdown","2cc49073":"markdown","4c0b4353":"markdown","2b60e0e9":"markdown","c204b72a":"markdown","331867ee":"markdown","2314488f":"markdown","428ee498":"markdown","e9a12d40":"markdown","347aa7ca":"markdown","e781438e":"markdown","4bd18b9f":"markdown","5aaaf947":"markdown","56572b2b":"markdown","b7a7cd58":"markdown","e82afb83":"markdown","d7aa8dea":"markdown","ae8846ba":"markdown","119db4ee":"markdown","c42b06cc":"markdown","b70d5592":"markdown","e4c7d770":"markdown","a23b8c8e":"markdown","3c84fd0d":"markdown","c673720c":"markdown","e2297f16":"markdown","b8edb443":"markdown","45ff18d8":"markdown","dc728947":"markdown","321ea5a2":"markdown","6503641b":"markdown","4c8f87e8":"markdown","2d2d29ad":"markdown","ef6790ee":"markdown","202c6e0e":"markdown","f51d4a65":"markdown","5368d018":"markdown","b1ccf381":"markdown","99465bba":"markdown","03aa4687":"markdown","48ed84a4":"markdown","45023122":"markdown","9939cc1c":"markdown","8ecd4d33":"markdown"},"source":{"6b526dcc":"import numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n%matplotlib inline\nsns.set()\npd.set_option('display.max_columns', None)\npd.set_option('display.max_rows', None)\nfrom scipy import stats\nfrom scipy.stats import norm, skew","31f9351b":"train_df=pd.read_csv('..\/input\/house-prices-advanced-regression-techniques\/train.csv')\ntrain_df.head()","2ec41ffc":"train_df.columns.shape","7810b964":"train_df.columns","2a2ddd51":"target=pd.DataFrame(train_df.iloc[:,-1],columns=['SalePrice'])\ntarget.head()","549aa64f":"train_df.drop('Id',axis=1,inplace=True)","d0c6197c":"train_df.isna().any()","64c4abf1":"missing=pd.DataFrame(train_df.isna().sum().sort_values(ascending=False)[0:19],columns=['Missing values'])\nmissing.reset_index(inplace=True)\nmissing.rename(columns={'index':'Feature name'},inplace=True)\n","2d4f2a1a":"missing","2dd1eee3":"plt.figure(figsize=(10,8))\nsns.barplot('Feature name','Missing values',data=missing)\nplt.xticks(rotation=45)","0161b66f":"plt.figure(figsize=(10,8))\nsns.distplot(target['SalePrice'],fit=norm);\n(mu, dev) = norm.fit(target['SalePrice'])\nplt.xticks(rotation=45)\nmu=np.round(target['SalePrice'].mean(),2)\ndev=np.round(target['SalePrice'].std(),2)\nplt.title('Target variable distribution')\nplt.ylabel('Frequency')\nplt.legend(['Normal dist. ($\\mu=$ {} and $\\sigma=$ {} )'.format(mu, dev)])","22f505e1":"fig = plt.figure()\nres = stats.probplot(target['SalePrice'], plot=plt)\nplt.show()","7969eee8":"from sklearn.preprocessing import power_transform","e7dd76b1":"target['SalePrice'].describe()","6fd84209":"target['Box-cox']=power_transform(target['SalePrice'].values.reshape(-1,1),method='box-cox',standardize=False)","d35bf238":"sns.distplot(target['Box-cox'],fit=norm,color='indianred')\n(mu, dev) = norm.fit(target['Box-cox'])\nplt.legend(['Normal dist. ($\\mu=$ {:.2f} and $\\sigma=$ {:.2f} )'.format(mu, dev)])\nplt.ylabel('Frequency')","67211f38":"fig = plt.figure()\nres = stats.probplot(target['Box-cox'], plot=plt)\nplt.show()","3195d5c1":"target['Log prices']=np.log(target['SalePrice'])","19682ed7":"sns.distplot(target['Log prices'],fit=norm,color='green')\n(mu, dev) = norm.fit(target['Log prices'])\nplt.legend(['Normal dist. ($\\mu=$ {:.2f} and $\\sigma=$ {:.2f} )'.format(mu, dev)])\nplt.ylabel('Frequency')","a95e5065":"fig = plt.figure()\nres = stats.probplot(target['Log prices'], plot=plt)\nplt.show()","c54d6f61":"from sklearn.preprocessing import MinMaxScaler","500b42c1":"scaler=MinMaxScaler()\ntarget['Min-max']=scaler.fit_transform(target['SalePrice'].values.reshape(-1,1))","c403c319":"sns.distplot(target['Min-max'],fit=norm)","5ef73dd4":"fig = plt.figure()\nres = stats.probplot(target['Min-max'], plot=plt)\nplt.show()","ad5c27a4":"from sklearn.preprocessing import RobustScaler","a7c43eb4":"rob=RobustScaler()\ntarget['Robust scaler']=rob.fit_transform(target['SalePrice'].values.reshape(-1,1))","0cf0beed":"sns.distplot(target['Robust scaler'],fit=norm)","be872725":"fig = plt.figure()\nres = stats.probplot(target['Robust scaler'], plot=plt)\nplt.show()","e13992d0":"plt.figure(figsize=(10,8))\nsns.regplot(train_df['GrLivArea'],target['SalePrice'],line_kws={\"color\": \"red\"})\nplt.xlabel('Living area')\nplt.ylabel('Sale price')\nplt.title('Sale price vs Living Area')","ef682534":"sns.boxplot(target['SalePrice'],orient='v')","b852e0e8":"target['SalePrice'].median()","3324c5ed":"train_df = train_df.drop(train_df[(train_df['GrLivArea']>4500) & (train_df['SalePrice']<350000)].index)","548f8879":"plt.figure(figsize=(10,8))\nsns.regplot(train_df['GrLivArea'],train_df['SalePrice'],line_kws={\"color\": \"red\"})\nplt.xlabel('Living area')\nplt.ylabel('Sale price')\nplt.title('Sale price vs Living Area without outliers')","c5741351":"plt.figure(figsize=(10,8))\nsns.regplot(train_df['TotalBsmtSF'],train_df['SalePrice'],line_kws={'color':'green'})","8bc49641":"plt.figure(figsize=(10,8))\nsns.boxplot('YrSold','SalePrice',data=train_df)","5eb85841":"plt.figure(figsize=(10,8))\nsns.boxplot('OverallQual','SalePrice',data=train_df)\nplt.title('Overall quality Vs Sale prices')","ab0d985b":"plt.figure(figsize=(10,8))\nsns.regplot('GarageArea','SalePrice',data=train_df,line_kws={'color':'red'})\nplt.title('Gara area vs Sale price')","270e20a8":"train_df=train_df.drop(train_df[(train_df['GarageArea']>1200)&(train_df['SalePrice']<300000)].index)","136f7fa3":"train_df=train_df.drop(train_df[(train_df['GarageArea']>600)&(train_df['GarageArea']<1000)&(train_df['SalePrice']>550000)].index)","38d11dbd":"plt.figure(figsize=(10,8))\nsns.regplot('GarageArea','SalePrice',data=train_df,line_kws={'color':'red'})\nplt.title('Gara area vs Sale price')\nplt.ylim(0,700000)","4b39897f":"plt.figure(figsize=(10,8))\nsns.boxplot('TotRmsAbvGrd','SalePrice',data=train_df)\nplt.title('Total rooms above ground Vs Sale Price')","2533608f":"plt.figure(figsize=(20,8))\nsns.boxplot('YearBuilt','SalePrice',data=train_df)\nplt.xticks(rotation=90)","95cab3b7":"corr=train_df.corr()\nplt.figure(figsize=(20,20))\nsns.heatmap(corr,annot=True)","7ec0c512":"k=10\ncols=corr.nlargest(k,'SalePrice')['SalePrice'].index\ncols","bc11d92d":"corr_highest=train_df[cols].corr()\nplt.figure(figsize=(10,8))\nsns.heatmap(corr_highest,annot=True,fmt='g')","49214167":"plt.figure(figsize=(10,8))\nsns.boxplot(train_df['FullBath'],train_df['SalePrice'])\nplt.title('SalePrice Vs Full bath')","707a8892":"plt.figure(figsize=(20,8))\nsns.boxplot(train_df['YearRemodAdd'],train_df['SalePrice'])\nplt.title('Year remodelled Vs Sale Price')\nplt.xticks(rotation=45)","423426a6":"train_df.head()","1ce97398":"train_df.isna().any()","82692ac0":"train_df['LotFrontage'].describe()","47e906eb":"sns.boxplot(train_df['LotFrontage'],orient='v')","594dd464":"train_df['LotFrontage'].fillna(train_df['LotFrontage'].median(),inplace=True)","3d451dc8":"train_df['Alley'].isna().value_counts()","8c831c04":"train_df['Alley'].fillna('None',inplace=True)","3b569b03":"train_df['MasVnrType'].isna().value_counts()","31cdc493":"train_df['MasVnrType'].value_counts()","a73ffee0":"train_df['MasVnrType'].fillna(train_df['MasVnrType'].mode()[0],inplace=True)","9b907b71":"train_df['MasVnrArea'].isna().value_counts()","f0d25d39":"train_df['MasVnrArea'].fillna(train_df['MasVnrArea'].median(),inplace=True)","1bfc95eb":"basement_features=['BsmtQual' ,'BsmtCond', 'BsmtExposure', 'BsmtFinType1', 'BsmtFinType2']\n\nfor feature in basement_features:\n    train_df[feature]=train_df[feature].fillna('None')","c6540023":"train_df['BsmtQual'].isna().value_counts()","d9eb261f":"train_df['BsmtQual'].value_counts()","6c0121e5":"train_df['Electrical'].isna().value_counts()","b9e7e22b":"train_df['Electrical'].fillna(train_df['Electrical'].mode()[0],inplace=True)","b48282de":"misc_features=['FireplaceQu', 'GarageType', 'GarageYrBlt','GarageFinish' ,\n               'GarageQual','GarageCond' ,'PoolQC','Fence','MiscFeature' ]","0a626d15":"for misc in misc_features:\n    train_df[misc].fillna('None',inplace=True)","8784f1a3":"train_df.isna().any()","ab97ffd7":"from sklearn.preprocessing import OrdinalEncoder\noe=OrdinalEncoder()","38b3e23c":"cat_features=['FireplaceQu', 'BsmtQual', 'BsmtCond','GarageQual', 'GarageCond', \n        'ExterQual', 'ExterCond','HeatingQC', 'PoolQC', 'KitchenQual', 'BsmtFinType1', \n        'BsmtFinType2', 'Functional', 'Fence', 'BsmtExposure', 'GarageFinish', 'LandSlope',\n        'LotShape', 'PavedDrive', 'Street', 'Alley', 'CentralAir', 'MSSubClass', 'OverallCond', \n        'YrSold', 'MoSold']","f9a72580":"for cat in cat_features:\n    train_df[cat]=oe.fit_transform(train_df[cat].values.reshape(-1,1))\n    ","5eae624f":"train_df.head()","b9fdd52a":"train_df.drop('GarageYrBlt',axis=1,inplace=True)","d7d24534":"train_df=pd.get_dummies(train_df)","7569bd98":"train_df.dtypes","cc775ed5":"target_df=pd.DataFrame(train_df['SalePrice'],columns=['SalePrice'])\ntarget_df.head()","ebb9631b":"train_df.drop('SalePrice',axis=1,inplace=True)","ef60d3e2":"train_df.head()","e587ce5f":"from sklearn.preprocessing import StandardScaler","79613eea":"scaler=StandardScaler()\nX_scaled_input=scaler.fit_transform(train_df)","c9099a82":"target_df['LogSalePrice']=np.log(target_df['SalePrice'])\ntarget_df.head()","21438d7c":"from sklearn.linear_model import LinearRegression,Lasso,Ridge\nfrom sklearn.metrics.regression import r2_score,explained_variance_score\nfrom sklearn.model_selection import train_test_split","d931f6b8":"reg_lin=LinearRegression()","d8354c68":"X=train_df\ny=target_df['SalePrice'].values.astype(float)","1d2fd5d5":"X_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.3,random_state=0)","5d563591":"reg_lin.fit(X_train,y_train)","734e9bf0":"y_pred=reg_lin.predict(X_test)","34071c60":"reg_lin.score(X_train,y_train)","f2058923":"reg_lin.score(X_test,y_test)","3e34a2b4":"lin_pred_df=pd.DataFrame(columns=['Actual values','Predicted values'])","0ddccef0":"lin_pred_df['Actual values']=y_test\nlin_pred_df['Predicted values']=y_pred\nlin_pred_df['Absolute difference']=abs(lin_pred_df['Actual values']-lin_pred_df['Predicted values'])\nlin_pred_df['Residual']=lin_pred_df['Actual values']-lin_pred_df['Predicted values']\nlin_pred_df.head()","3dd9f216":"lin_pred_df['Residual'].describe()","54d2cbf3":"plt.scatter(lin_pred_df['Actual values'],lin_pred_df['Predicted values'])","5c526d51":"sns.distplot(lin_pred_df['Residual'])","5d5e4d66":"X=X_scaled_input\ny=target_df['LogSalePrice'].values.astype(float)\nX_train,X_test,y_train,y_test=train_test_split(X,y,random_state=0)\nreg_las=Lasso(alpha =0.0005, random_state=1,normalize=True)","20654baa":"reg_las.fit(X_train,y_train)","6ba0a681":"y_pred=reg_las.predict(X_test)","6e608853":"reg_las.score(X_test,y_test)","4f8ea73b":"reg_las.score(X_train,y_train)","b10830d5":"las_pred_df=pd.DataFrame(columns=['Actual values','Predicted values','Absolute difference'])\nlas_pred_df['Actual values']=np.exp(y_test)\nlas_pred_df['Predicted values']=np.exp(y_pred)\nlas_pred_df['Absolute difference']=abs(las_pred_df['Actual values']-las_pred_df['Predicted values'])\nlas_pred_df['Residual']=las_pred_df['Actual values']-las_pred_df['Predicted values']\nlas_pred_df['Difference %']=100*las_pred_df['Residual']\/las_pred_df['Actual values']\nlas_pred_df","3235a911":"las_pred_df['Absolute difference'].describe()","19e8ddc1":"\nsns.distplot(las_pred_df['Residual'])\nplt.title('Residual PDF',size=20)","52dfc76b":"sns.regplot(las_pred_df['Actual values'],las_pred_df['Predicted values'],line_kws={'color':'red'})","890c5801":"bias=np.exp(reg_las.intercept_)\nbias","195af50b":"reg_rid=Ridge()","f8e23b53":"reg_rid.fit(X_train,y_train)","a01260fd":"y_pred=reg_rid.predict(X_test)","c2dd8bc1":"reg_rid.score(X_train,y_train)","1cd817cb":"reg_rid.score(X_test,y_test)","85410861":"r2_score(y_pred,y_test)","b93268d4":"explained_variance_score(y_pred,y_test)","9980012e":"rid_df=pd.DataFrame(columns=['Actual values','Predicted values','Absolute difference'])\nrid_df['Actual values']=np.exp(y_test)\nrid_df['Predicted values']=np.exp(y_pred)\nrid_df['Absolute difference']=abs(rid_df['Actual values']-rid_df['Predicted values'])\nrid_df['Residual']=rid_df['Actual values']-rid_df['Predicted values']\nrid_df['Difference %']=100*rid_df['Residual']\/rid_df['Actual values']\nrid_df.head()","fd68eaa9":"sns.distplot(rid_df['Residual'])\nplt.title('Residual PDF',size=20)","c2d55265":"sns.regplot(rid_df['Actual values'],rid_df['Predicted values'],line_kws={'color':'red'})","8c689d1a":"from sklearn.ensemble import RandomForestRegressor","5ef5eb8f":"X=train_df\ny=target_df['SalePrice']\nX_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,shuffle=True,random_state=0)","7f90f83c":"rfr=RandomForestRegressor()","5b55592d":"rfr.fit(X_train,y_train)","311effe9":"y_pred=rfr.predict(X_test)","05766328":"rfr.score(X_train,y_train)","f65c4b22":"rfr.score(X_test,y_test)","426baa04":"rfr_df=pd.DataFrame(columns=['Actual values','Predicted values','Absolute difference'])\nrfr_df['Actual values']=y_test\nrfr_df['Predicted values']=y_pred\nrfr_df['Absolute difference']=abs(rfr_df['Actual values']-rfr_df['Predicted values'])\nrfr_df['Residual']=rfr_df['Actual values']-rfr_df['Predicted values']\nrfr_df['Difference %']=100*rfr_df['Residual']\/rfr_df['Actual values']\nrfr_df.head()","4e575304":"sns.distplot(rfr_df['Residual'])\nplt.title('Residual PDF',size=20)","b34e04ef":"sns.regplot(rfr_df['Actual values'],rfr_df['Predicted values'],line_kws={'color':'green'})","d5b52829":"from sklearn.ensemble import GradientBoostingRegressor","ccf22ba3":"gbdt=GradientBoostingRegressor()","b56dff2e":"gbdt.fit(X_train,y_train)","8b88b1e0":"y_pred=gbdt.predict(X_test)","fcd168cb":"gbdt.score(X_train,y_train)","9abb025b":"gbdt.score(X_test,y_test)","b9e98d7d":"gbdt_df=pd.DataFrame(columns=['Actual values','Predicted values','Absolute difference'])\ngbdt_df['Actual values']=y_test\ngbdt_df['Predicted values']=y_pred\ngbdt_df['Absolute difference']=abs(gbdt_df['Actual values']-gbdt_df['Predicted values'])\ngbdt_df['Residual']=gbdt_df['Actual values']-gbdt_df['Predicted values']\ngbdt_df['Difference %']=100*gbdt_df['Residual']\/gbdt_df['Actual values']\ngbdt_df.head()","44b81df3":"sns.distplot(gbdt_df['Residual'])","d0945bc6":"sns.regplot(gbdt_df['Actual values'],gbdt_df['Predicted values'],line_kws={'color':'red'})","7299d691":"import xgboost as xgb","6a0e6e9e":"xgb_reg=xgb.XGBRegressor(colsample_bytree=0.4603, gamma=0.0468, \n                             learning_rate=0.05, max_depth=3, \n                             min_child_weight=1.7817, n_estimators=2200,\n                             reg_alpha=0.4640, reg_lambda=0.8571,\n                             subsample=0.5213, silent=1,\n                             random_state =7, nthread = -1)","9ca9b3d2":"xgb_reg.fit(X_train,y_train)","1f79fa0d":"xgb_reg.score(X_train,y_train)","f7d9391a":"xgb_reg.score(X_test,y_test)","74fe1137":"y_pred=xgb_reg.predict(X_test)","7139fb41":"xgb_df=pd.DataFrame(columns=['Actual values','Predicted values','Absolute difference'])\nxgb_df['Actual values']=y_test\nxgb_df['Predicted values']=y_pred\nxgb_df['Absolute difference']=abs(xgb_df['Actual values']-xgb_df['Predicted values'])\nxgb_df['Residual']=xgb_df['Actual values']-xgb_df['Predicted values']\nxgb_df['Difference %']=100*xgb_df['Residual']\/xgb_df['Actual values']\nxgb_df.head()","9843d525":"sns.distplot(xgb_df['Residual'])","94becf4c":"sns.regplot(xgb_df['Actual values'],xgb_df['Predicted values'],line_kws={'color':'green'})\nplt.title('Prediction chart',size=20)","24375a2c":"from lightgbm import LGBMRegressor","d17569fc":"lgb=LGBMRegressor(objective='regression',num_leaves=5,\n                              learning_rate=0.05, n_estimators=720,\n                              max_bin = 55, bagging_fraction = 0.8,\n                              bagging_freq = 5, feature_fraction = 0.2319,\n                              feature_fraction_seed=9, bagging_seed=9,\n                              min_data_in_leaf =6, min_sum_hessian_in_leaf = 11)","072f968c":"X=train_df\ny=target_df['SalePrice'].values.astype(float)\nX_train,X_test,y_train,y_test=train_test_split(X,y,random_state=0)","3fdb33de":"lgb.fit(X_train,y_train)","3eb2fe17":"lgb.score(X_train,y_train)","3f68f524":"lgb.score(X_test,y_test)","a8713c71":"y_pred=lgb.predict(X_test)","b8c070e1":"lgb_df=pd.DataFrame(columns=['Actual values','Predicted values','Absolute difference'])\nlgb_df['Actual values']=y_test\nlgb_df['Predicted values']=y_pred\nlgb_df['Absolute difference']=abs(lgb_df['Actual values']-lgb_df['Predicted values'])\nlgb_df['Residual']=lgb_df['Actual values']-lgb_df['Predicted values']\nlgb_df['Difference %']=100*lgb_df['Residual']\/lgb_df['Actual values']\nlgb_df.head()","2fbd5962":"sns.distplot(lgb_df['Residual'])\nplt.title('Residual PDF',size=20)","b37b5ba5":"sns.regplot(lgb_df['Actual values'],lgb_df['Predicted values'],line_kws={'color':'red'})\nplt.title('Prediction chart',size=20)","e183ae7b":"test_df=pd.read_csv('..\/input\/house-prices-advanced-regression-techniques\/test.csv')","703e1098":"test_df.head()","f9aa8280":"train_df.head()","b3adcae9":"test_id=pd.DataFrame(test_df.iloc[:,0],columns=['Id'])\ntest_id.head()","51100a37":"test_df.isna().any()","48fafaba":"missing_test=pd.DataFrame(test_df.isna().sum().sort_values(ascending=False)[0:33],columns=['Missing values'])\nmissing_test.reset_index(inplace=True)\nmissing_test.rename(columns={'index':'Feature name'},inplace=True)\nmissing_test","3aeef1fd":"plt.figure(figsize=(10,8))\nsns.barplot('Feature name','Missing values',data=missing_test)\nplt.xticks(rotation=90)","64695ea8":"test_df['LotFrontage'].fillna(test_df['LotFrontage'].median(),inplace=True)\ntest_df['Alley'].fillna('None',inplace=True)\ntest_df['MasVnrType'].fillna(test_df['MasVnrType'].mode()[0],inplace=True)\ntest_df['MasVnrArea'].fillna(test_df['MasVnrArea'].median(),inplace=True)\nbasement_features=['BsmtQual' ,'BsmtCond', 'BsmtExposure', 'BsmtFinType1', 'BsmtFinType2']\n\nfor feature in basement_features:\n    test_df[feature]=test_df[feature].fillna('None')\n    \ntest_df['Electrical'].fillna(test_df['Electrical'].mode()[0],inplace=True)\n\n\nmisc_features=['FireplaceQu', 'GarageType', 'GarageYrBlt','GarageFinish' ,\n               'GarageQual','GarageCond' ,'PoolQC','Fence','MiscFeature' ]\n\nfor misc in misc_features:\n    test_df[misc].fillna('None',inplace=True)\n\ntest_df['MSZoning'].fillna(test_df['MSZoning'].mode()[0],inplace=True)\ntest_df['Utilities'].fillna(test_df['Utilities'].mode()[0],inplace=True)\ntest_df['Exterior1st'].fillna(test_df['Exterior1st'].mode()[0],inplace=True)\ntest_df['Exterior2nd'].fillna(test_df['Exterior2nd'].mode()[0],inplace=True)\ntest_df['BsmtFinSF1'].fillna(test_df['BsmtFinSF1'].median(),inplace=True)\ntest_df['BsmtFinSF2'].fillna(test_df['BsmtFinSF2'].median(),inplace=True)\ntest_df['BsmtUnfSF'].fillna(test_df['BsmtUnfSF'].median(),inplace=True)\ntest_df['TotalBsmtSF'].fillna(test_df['TotalBsmtSF'].median(),inplace=True)\ntest_df['KitchenQual'].fillna(test_df['KitchenQual'].mode()[0],inplace=True)\n\n\nbaths=['BsmtFullBath','BsmtHalfBath']\nfor types in baths:\n    test_df[types].fillna(test_df[types].mode()[0],inplace=True)\n    \ntest_df['Functional'].fillna(test_df['Functional'].mode()[0],inplace=True)\ntest_df['GarageCars'].fillna(test_df['GarageCars'].mode()[0],inplace=True)\ntest_df['GarageArea'].fillna(test_df['GarageArea'].median(),inplace=True)\ntest_df['SaleType'].fillna(test_df['SaleType'].mode()[0],inplace=True)","ff1cf40f":"test_df.isna().any()","35d5de0f":"for cat in cat_features:\n    test_df[cat]=oe.fit_transform(test_df[cat].values.reshape(-1,1))\n    ","5be250f6":"test_df.drop('GarageYrBlt',axis=1,inplace=True)","96c13820":"test_df.drop('Id',axis=1,inplace=True)","bfed3b6d":"test_df=pd.get_dummies(test_df)","63abcb7d":"test_df.dtypes","a8d77dd4":"missing_cols=['Condition2_RRAe', 'Utilities_NoSeWa', 'RoofMatl_Metal', \n              'Condition2_RRAn', 'Exterior2nd_Other', 'MiscFeature_TenC', \n              'RoofMatl_Roll', 'Electrical_Mix', 'RoofMatl_Membran', \n              'Exterior1st_ImStucc', 'Condition2_RRNn', 'Heating_Floor', \n              'Heating_OthW','HouseStyle_2.5Fin', 'Exterior1st_Stone']","43b370f7":"for cols in missing_cols:\n    test_df[cols]=0","ba1421d2":"test_df=test_df[train_df.columns]","bbdd7f7b":"train_df.head()","cf4aa3b7":"test_df.head()","dded204a":"X_test=test_df\nX_scaled_test=scaler.fit_transform(X_test)","e6f4897b":"y_pred=reg_lin.predict(X_test)","d2e8a814":"linear_reg_final=pd.DataFrame(columns=['Id','SalePrice'])\nlinear_reg_final['Id']=test_id['Id']\nlinear_reg_final['SalePrice']=y_pred\nlinear_reg_final.head()","fd23a783":"y_pred=reg_las.predict(X_scaled_test)","12c466eb":"lasso_final=pd.DataFrame(columns=['Id','SalePrice'])\nlasso_final['Id']=test_id['Id']\nlasso_final['SalePrice']=np.exp(y_pred)\nlasso_final.head()","1f0b3d8d":"y_pred=reg_rid.predict(X_scaled_test)","3878ef73":"ridge_final=pd.DataFrame(columns=['Id','SalePrice'])\nridge_final['Id']=test_id['Id']\nridge_final['SalePrice']=np.exp(y_pred)\nridge_final.head()","fc88d013":"y_pred=rfr.predict(X_test)","a93e9ae1":"rf_final=pd.DataFrame(columns=['Id','SalePrice'])\nrf_final['Id']=test_id['Id']\nrf_final['SalePrice']=y_pred\nrf_final.head()","841ecb49":"y_pred=xgb_reg.predict(X_test)","56e759dd":"xgb_final=pd.DataFrame(columns=['Id','SalePrice'])\nxgb_final['Id']=test_id['Id']\nxgb_final['SalePrice']=y_pred\nxgb_final.head()","f39732f8":"y_pred=gbdt.predict(X_test)","45a725f2":"gbdt_final=pd.DataFrame(columns=['Id','SalePrice'])\ngbdt_final['Id']=test_id['Id']\ngbdt_final['SalePrice']=y_pred\ngbdt_final.head()","377231a6":"y_pred=lgb.predict(X_test)","9899dafb":"lgb_final=pd.DataFrame(columns=['Id','SalePrice'])\nlgb_final['Id']=test_id['Id']\nlgb_final['SalePrice']=y_pred\nlgb_final.head()","8a93d34d":"lgb_final.to_csv('LGBM_Regression.csv',index=False)","a6251708":"From the training dataframe, we are sure that we need to calculate the sale price of the various properties. Let us separate the sale price column.","9ac9c24f":"The above dataframe is now ready for machine learning purpose. However, as we will be utilising a few linear models, it is important for us to use standard scaler in our dataframe. This will help us give equal important to the features.\n\n### Standard scaling the input data","83369cee":"The data looks far cleaner now with slightly lower variance to the linear regression line.","06ab3208":"We can use two different methods here. These are namely:\n\n1. yeo-johnson: works with positive and negative values\n2. box-cox: works with strictly postivie values\n\nLet us check some more information on the SalePrice column","0d0d399d":"### F) TotRmsAbvGrd Vs SalePrice","85f99b9a":"### One hot encoding the remaining categorical data","414ff84e":"Let us check if there is any correlation between total rooms above ground and sale price","c2959450":"Let us now check for any missing values that are present in the various features.","04c9f7cd":"TotatBsmtSF feature tells us about the total basement area in square feet area. Let us check if there is enough correlation amongst saleprice and basement area.","c538963d":"The residuals seem to be normally distributed which is a good sign.","6e2845d5":"## Correlation heat map","6d5551e4":"## Transforming the data into a normal distribution\n\n### 1. Using power_transform","2e08c7f1":"Most values do seem to be approximately correctly predicted by the model. Some are however deviating from the green line.","de82a7d1":"As we can see from the boxplots, median prices of the properties have remained constant for all the years. ","a65244e8":"We store all the IDs as a separate dataframe to preserve the order of our data. This dataframe will be concatenated with the predicted prices later.","92209eaa":"### Ordinal encoding the catergorical features","98c0fac4":"The distribution of the residuals is normally distributed in Ridge regression which is better than what we got in Lasso regression.","735e1b79":"### H) YearRemodAdd Vs SalePrice","88e9f86c":"### 3. Min-Max transformation","31a2755e":"Hence, the features above are the most highly correlated. Let us make a smaller heatmap for the above.","45e3661f":"Let us now check the regplot after removing some of the outliers.","0f12a99f":"Let us drop the garage year built feature since it isn't giving us much information that will help us predict sale price","8efef59f":"### E) Garage area Vs SalePrice","759b63ad":"Residuals seem to be normally distributed with some skew in the positive direction.","59668751":"['Exterior1st_Stone', 'HouseStyle_2.5Fin', 'RoofMatl_Metal', 'Exterior2nd_Other', 'Heating_OthW', 'Condition2_RRNn', 'Utilities_NoSeWa', 'Heating_Floor', 'Condition2_RRAn', 'RoofMatl_Membran', 'Condition2_RRAe', 'Exterior1st_ImStucc', 'RoofMatl_Roll', 'MiscFeature_TenC', 'Electrical_Mix']\n\n\nAs we can see, the above particular columns are present in training dataframe but not in test dataframe. Hence, we will add these features with 0 in the test dataframe to be used in the model.","f49608e2":"### XGboost","bfbcbbca":"Let us also check how is the target variable distributed for us. ","d679e58f":"### G) YearBuilt Vs SalePrice","ad45e763":"For all the basement features, missing values actually means there are no basements. Hence, missing values will be replaced by none.","e7a26f67":"Under best case scenario,our residuals should follow a normal distribution. This case is true. However, we do have a few extremely positive values in the residuals where the model didn't perform too well. This indicates room for model improvement.\n\n\nLet us see the scatter plot of predicted vs actual results to get an idea of how the model is performing.","b84e2d56":"According to the provided data, 1358 properties have missing values. According to the data description, missing values means there is no alley access. Hence, we shall fill the missing values with \"None\" ","b3515ab1":"# 1. Data Wrangling\n## Importing libraries and relevant data","bdbf2647":"### Ridge regression model","e689f540":"As we can see, we have a few outliers here that should take care of. Upon eyeballing at the data, we can see that there are cases where for very large garage area, the price is too low. Similary, we have cases with extremely high prices even with avaerage garage area. Let us drop some of these entries and check the plot again.","bce31704":"All properties should have electrical connections as a mandatory facility. Hence, it is odd to see any empty values in this feature. Let us check how many empty values are there.","e3d7080b":"Let us check if the residuals are normally distributed using the probplot of scipy","ba9dbb25":"### B) Alley","7c9db078":"Some of the important conclusions that could be drawn are:\n\n* Features like GarageCars and GarageArea show the same data. More cars would mean more garage area.\n* GrLivArea and 1stFlrSF should show the same results since 1st, 2nd or any other higher floors can be only as big as the ground floor area.","e3992a27":"Only 8 entries have missing values.","142deef9":"### D) OverQual Vs SalePrice","05869c76":"# 3. Testing phase","ce4dd112":"Moreover, ID column has no use for training purpose. Hence, we can simply drop this column","2f5f3f6e":"The general trend is that as number of rooms increase above ground, median sale prices increase. Most houses have about 3-7 rooms above ground. Data for more than 7 rooms is low and hence, we can find a lot of variance in the data. However, this indicates that there is somewhat of a linear relation between total rooms and sale price.","a379374d":"We have filled all missing values with the most common (or mode) of this feature.","f1b7390a":"Let us drop the entries with outliers here. In our case, we will be dropping all the values that have a living area > 4500 sq feet and a sale price below 350000 will be dropped as this data is generating quite a lot of noise.","b7345015":"### C)  MasVnrType","db147c74":"## Outlier detection for some features","a2d0cccf":"Let us take care of all the missing values in the feature columns.","ca764ae0":"The above dataframe is now preprocessed and can be used for final model prediction.\n\n\n### Linear regression model","76bcf425":"Let us check the various features included in the dataframe.","3230f991":"### A) GrLivArea Vs SalePrice","c70ff2f6":"For all the above features, missing values denotes that this feature is not present in the property. This has been clearly mentioned in the data description. Hence, we replace the empty values as \"None\"","54cca69e":"As we can see, all the given data is now in numerical form. We should now separate the target feature which is the SalePrice from the training dataframe.","7bb3ce7e":"Let us check if the year in which, the house was built has any correlation with sale price.","d6727c7d":"### GBDT regressor","079d793c":"As it can be clearly seen, the min-max transformation failed to normalise the results.","75bc332a":"Other than a few residuals at the higher positive values, rest of the residuals are normally distributed.","fd2b633c":"### Light GBM","d4c88d99":"### Random Forest Regressor","99630ae5":"As we can clearly see, the variation of the red line is much lesser now. This shows that the data has much lesser noise now.","45bffba3":"As was expected, with higher overall quality of the property, median prices of the properties are increasing.","a0134db2":"### XGboost regressor","61eca4fd":"### 4. Robust Scaler","088f91c5":"As we can see, the model is performing well upto the point where the prices are high. It has a tough time predicting correctly at this point.\n\nLet us finally check the bias in our model.","d6de93cc":"Let us check the scatter plots of numerical data with sale prices. We know, traditionally, area of the house is a strong indicator of price. After going through the other data, another few features that could play an important role in price can be shown here.\n\n* GrLivArea\n* TotalBsmtSF\n* YrSold\n* OverQual\n* GarageArea\n* TotRmsAbvGrd\n* YearBuilt\n\n\nSo, let us check their scatter plots and boxplots.","0088c131":"After checking the mean and standard deviation, it is clear that the distribution is normally distributed","fda0eca1":"## Processing the missing values","4c49d46b":"### D) MasVnrArea","b740bcb6":"Let us check if garage area is correlated to sale prices in any way.","4868fea0":"Let us check how does the over all quality of the houses relate to the sale prices. For some background, the numbers given to overquality maybe read as follows:\n\n      10\tVery Excellent\n       9\tExcellent\n       8\tVery Good\n       7\tGood\n       6\tAbove Average\n       5\tAverage\n       4\tBelow Average\n       3\tFair\n       2\tPoor\n       1\tVery Poor","26a9f499":"# 2. Machine Learning\n\n## Linear Regression","b9ba6ff3":"Hence, at the end, we can either select the power_transform or log transformation. Let us go ahead with the log transformation.","a15cfa28":"## Lasso Regression","e2183935":"As we can clearly see, our residuals are following the red line which basically means that they are normally distributed in nature. This is quite advatageous for model training purpose.","2cc49073":"### C) YrSold Vs SalePrice","4c0b4353":"Although the correlation is a little weak, it can be said that houses built 1983 seems to have higher median prices with each passing year.","2b60e0e9":"After dropping all these entries, we can make a regplot to see if the variations have reduced compared to what it was previously.","c204b72a":"### 2. Logarithmic transformation","331867ee":"Let us neglect the case where there are no full baths above ground (i.e. FullBath=0)\n\nFor other cases, it can be seen that the median prices are increasing as number of bathrooms above the ground floor is rising.","2314488f":"Let us visualise the above data with boxplots.","428ee498":"As we can clearly see, there are some particular features which require our attention  due to the presence of empty values. Let us see how many empty entries are present in these features.","e9a12d40":"In any machine learning model, we need to take care of the missing values. Let us check the presence of missing values in the features that we are planning to use in our models.","347aa7ca":"### E) 'BsmtQual' ,'BsmtCond', 'BsmtExposure', 'BsmtFinType1', 'BsmtFinType2'","e781438e":"A scipy probplot generates a probability plot of sample data against the quantiles of a specified theoretical distribution (the normal distribution by default). probplot optionally calculates a best-fit line for the data and plots the results using Matplotlib or a given plot function.\n\nIf the blue and red line are on the same linear path at 45 degrees, we can confirm that our data is normally distributed.","4bd18b9f":"The hyper parameters were taken from a kaggle kernel for which, the link is shared below:\n\nhttps:\/\/www.kaggle.com\/serigne\/stacked-regressions-top-4-on-leaderboard#Modelling","5aaaf947":"### G) FireplaceQu, GarageType, GarageYrBlt,GarageFinish ,GarageQual,GarageCond ,PoolQC,Fence,                         MiscFeature ","56572b2b":"### GBDT regressor","b7a7cd58":"Let us check how the residuals are distributed.","e82afb83":"As we can see, all values here are positive. Hence, we can use any of the power_transform methods here.","d7aa8dea":"As we can see, quite a features have no missing values and hence, requires no intervention. Let us take care of the features that have missing values. Each feature requires different treatment. Let us start.\n\n### A) LotFrontage","ae8846ba":"### Light GBM","119db4ee":"### Log transforming the target data","c42b06cc":"Hyper parameters have been chosen from the same kaggle kernel used for XGBoost.","b70d5592":"Let us see how the year the property was sold in affects the sale price. This would give us an idea if prices are increasing or reducing in recent years. However, this visualisation needs to be taken with a grain of salt as properties with varying feature values such as area will be compared with one another. However, this will give us a preliminary idea of how the sale prices are varying with each passing year.\n\nWe shall compare the  data using boxplots. ","e4c7d770":"After all this is done, we should not expect anymore missing values in the dataframe. Let us check once more to confirm.","a23b8c8e":"### F) Electrical","3c84fd0d":"From the above distplot, it is clearly visible that the data is right skewed and hence, deviates from a normal distribution. Moreover, the data deviates from a linear red line. Hence, we must do some preprocessing to somehow, convert our distribution into a normal distribution. This will also help us use a linear model for the  purpose of regression.\n\n\nThe reason for preprocessing to have a normal distribution is because most regression models perform far superior when it has a normally distributed data. Moreover, regression models such as the OLS linear model make the assumptions that it's residuals (or errors) are nomrally distributed in nature.  \n\nTo understand it better, this link below is helpful.\n\nhttps:\/\/towardsai.net\/p\/data-science\/how-when-and-why-should-you-normalize-standardize-rescale-your-data-3f083def38ff","c673720c":"### Lasso regression model","e2297f16":"In this case, instead of using the sklearn power_transform feature, we manually convert our SalePrices using a numpy transformation as shown below.\n\nGenerally, for a non normal data with high skewdness, a log transformation reduces the skew and makes the data approximately normally distributed.","b8edb443":"Let us visualise the above as barplots for better understanding.","45ff18d8":"### Target variable distribution","dc728947":"As we can clearly see, the outliers are little and hence, noise is not effecting the data much. It will be wise to not drop any data under these conditions. The general trend of the data seems to be linear aswell.","321ea5a2":"## Ensemble models","6503641b":"Due to the presence of outliers, it will be wise to fill the missing values with median value as shown below.","4c8f87e8":"As we can clearly see from the last row of the heatmap, some features are highly correlated while some are not. Infact, we should take care of possible multicollinearity in the data. Some data like Garage cars, Garage area show similar correlations. Hence, we can safely remove these features.\n\nLet us check the top 10 most correlated features with sale price.","2d2d29ad":"Clearly, the robust scaler failed to normalise our data aswell.","ef6790ee":"### Random forest regressor","202c6e0e":"As expected, we have only one single value with an empty value. This could be due to a mistake in entering the data. Hence, we will fill this value with the most common data under this feature.","f51d4a65":"# Data preprocessing and visualisation","5368d018":"As the remodelled year is more recent, median sale prices are increasing. This confirms the well known fact that as the property has been remodelled in the recent past, it's prices will be higher.","b1ccf381":"Upon doing the above operation, we must now have all the data in either int or float form. Let us take a quick look if it is indeed the case.","99465bba":"However, there are extremely high number of features that have to be checked manually. We could reduce all this work using a correlation heat map to check which features may be of particular interest to us.","03aa4687":"Out of all these important correlations, we are yet to visualise how FullBath and YearRemodAdd correlates with SalePrice.\n\nThe full bath feature tells us the number of bathrooms present which are above the ground floor.\n\n### G) FullBath Vs SalePrice","48ed84a4":"As we have seen, we have about 81 different features in the dataframe. Hence, it is extremely important to downsize the number of features for model fitting. More over we need to check how the various features are distributed here.","45023122":"### B) TotalBsmtSF Vs SalePrice","9939cc1c":"## Ridge Regression","8ecd4d33":"As it can be clearly seen, we have extremely high number of missing values that have to be taken care of."}}