{"cell_type":{"2ed0c570":"code","5ac1af0b":"code","8eff9e16":"code","2a02219b":"code","4bb36619":"code","5d0147e1":"code","dc4c50c9":"code","a0440abc":"code","a335612d":"code","a883d3c9":"code","f611d25f":"code","113766f6":"code","23967336":"code","0d517c88":"code","b1ccecb1":"code","607b33d1":"code","5d7034de":"code","8a266ca1":"code","65e26eed":"code","44539f71":"code","15090b8c":"code","95521527":"code","e16a2626":"code","a8dc4f7e":"code","44e27ff4":"code","4f70a841":"code","82aea776":"code","90262426":"code","23ad1f50":"code","4494468b":"code","3cabbbef":"code","ebe9cd2b":"code","82be62b4":"code","83a31574":"code","090cd9f9":"code","6c5d7ca5":"code","16b0bf14":"code","2f905029":"code","f4c63dc6":"code","b0a0161b":"code","0edd1ee6":"code","673f88db":"code","8adb4c44":"code","7ba63ff5":"code","2d45bedd":"code","8bccef44":"code","18c8e28a":"markdown","993fd3c5":"markdown","17688183":"markdown","991570a6":"markdown","caa61041":"markdown","eb9692be":"markdown","c23432cb":"markdown","5dea4903":"markdown","586a1eea":"markdown","9dd66e2d":"markdown","76b3c47f":"markdown","4caa8035":"markdown","edcea093":"markdown","c47634a6":"markdown","ff5fc2d8":"markdown","62c3b7e1":"markdown","462a7d39":"markdown","4cf40eb8":"markdown","d8cc30dd":"markdown","1131b279":"markdown","5f4becca":"markdown","ce755314":"markdown","a7cb125d":"markdown","71910ff3":"markdown"},"source":{"2ed0c570":"import numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport warnings\nwarnings.filterwarnings(\"ignore\")","5ac1af0b":"df = pd.read_csv('..\/input\/avocado-prices\/avocado.csv')\ndf.head()","8eff9e16":"df = df.drop('Unnamed: 0',axis=1)","2a02219b":"df.info()","4bb36619":"df.describe()","5d0147e1":"df['Date'] = pd.to_datetime(df['Date'],errors='coerce')","dc4c50c9":"sns.heatmap(df.isnull(),cbar=False,cmap='Blues',yticklabels=False)","a0440abc":"df.year.value_counts()","a335612d":"round_columns = df[['Total Volume','4046','4225','4770','Total Bags','Small Bags','Large Bags','XLarge Bags']]","a883d3c9":"for i in round_columns.columns:\n    df[i] = df[i].apply(np.round)","f611d25f":"df.head()","113766f6":"df.hist(bins=30,figsize=(12,10),color='skyblue',ec=\"black\")","23967336":"plt.figure(figsize=(10,5))\nplt.title(\"Price Distribution\")\nax = sns.distplot(df[\"AveragePrice\"], color = 'b')","0d517c88":"sns.barplot(x=df['type'],y=df['Total Volume'].value_counts())","b1ccecb1":"df.year.value_counts().sort_index().plot(kind='barh',figsize=(6,4),color='skyblue',ec='black')","607b33d1":"regionsToRemove = ['California', 'GreatLakes', 'Midsouth', 'NewYork', 'Northeast', 'SouthCarolina', 'Plains', 'SouthCentral', 'Southeast', 'TotalUS', 'West']\ndf = df[~df.region.isin(regionsToRemove)]\nlen(df.region.unique())","5d7034de":"plt.figure(figsize=(15,12))\nsns.set(style=\"white\", context=\"talk\")\nplt.title(\"Avg.Price of Avocado by City\")\nsns.barplot(x=\"AveragePrice\",y=\"region\",data= df,palette=\"rocket\")\n\n# As seen avg price of avocado is the most in San Francisco & hartford springfield","8a266ca1":"plt.figure(figsize=(15,12))\nsns.set(style=\"white\", context=\"talk\")\nplt.title(\"Total volume of Avocado sold by City\")\nsns.barplot(x=\"Total Volume\",y=\"region\",data= df,palette=\"deep\")","65e26eed":"plt.figure(figsize=(8,4))\nsns.set(style=\"white\", context=\"talk\")\nplt.title(\"Avg.price of Avocado as per type\")\nsns.boxplot(x=\"AveragePrice\",y=\"type\",data= df,palette=\"vlag\")","44539f71":"# Making a new column 'Month'\ndf['Month'] = pd.DatetimeIndex(df['Date']).month","15090b8c":"df.head(1)","95521527":"axis = df.groupby('Month')[['AveragePrice']].mean().plot(figsize=(10,5),marker='o',color='r')\nplt.figure()\naxis = df.groupby('Month')[['Total Volume']].mean().plot(figsize=(10,5),marker='o',color='g')","e16a2626":"# Making a new column 'Day'.\ndf['Day'] = pd.DatetimeIndex(df['Date']).day","a8dc4f7e":"axis = df.groupby('Day')[['AveragePrice']].mean().plot(figsize=(14,5),marker='o',color='r')\nplt.figure()\naxis = df.groupby('Day')[['Total Volume']].mean().plot(figsize=(14,5),marker='o',color='g')","44e27ff4":"plt.figure(figsize=(18,18))\nsns.set(style=\"white\", context=\"talk\")\nplt.title(\"Avg.Price of Avocado by City\")\nsns.boxplot(x=\"AveragePrice\",y=\"region\",data= df,palette=\"deep\")","4f70a841":"fig,ax = plt.subplots(figsize=(15,6))\ndf.groupby(['Date','type']).mean()['AveragePrice'].unstack().plot(ax=ax)\nplt.title('Avg Price of avocado as per type on avocado over time')","82aea776":"fig,ax = plt.subplots(figsize=(15,6))\ndf.groupby(['Date','type']).mean()['Total Bags'].unstack().plot(ax=ax)\nplt.title('Total volume of avocado sold as per type on avocado over time')","90262426":"avacado_type = df['type']=='organic'\nplt.figure(figsize=(18,18))\nsns.set(style=\"white\", context=\"talk\")\nplt.title(\"Average price of organic Avocado as per City\")\nsns.boxplot(x=\"AveragePrice\",y=\"region\",data= df[avacado_type],palette=\"deep\")","23ad1f50":"avacado_type = df['type']=='conventional'\nplt.figure(figsize=(18,18))\nsns.set(style=\"white\", context=\"talk\")\nplt.title(\"Average Price of conventional Avocado as per City\")\nsns.boxplot(x=\"AveragePrice\",y=\"region\",data= df[avacado_type],palette=\"deep\")","4494468b":"df_corr = df[['AveragePrice','Total Volume','Total Bags','Month']]\ncorrelations = df_corr.corr()\nplt.figure(figsize=(8,5))\nsns.heatmap(correlations,annot=True,cmap=\"YlGnBu\",linewidths=.5)\n# Month has a very good correlation with AvgPrice.","3cabbbef":"df_to_plot = df.drop(['Date','AveragePrice', 'Total Volume', 'Total Bags','type','region','Month','Day'], axis = 1).groupby('year').agg('sum')\ndf_to_plot.head()","ebe9cd2b":"index = ['4046', '4225', '4770', 'Small Bags', 'Large Bags', 'XLarge Bags']\nseries = pd.DataFrame({'2015': df_to_plot.loc[[2015],:].values.tolist()[0],\n                      '2016': df_to_plot.loc[[2016],:].values.tolist()[0],\n                      '2017': df_to_plot.loc[[2017],:].values.tolist()[0],\n                      '2018': df_to_plot.loc[[2018],:].values.tolist()[0]}, index=index)\nseries.plot.pie(y='2015',figsize=(9, 9), autopct='%1.1f%%', colors=['silver', 'pink', 'orange', 'palegreen', 'aqua', 'blue'], fontsize=18, legend=False, title='2015 Volume Distribution').set_ylabel('')\nseries.plot.pie(y='2016',figsize=(9, 9), autopct='%1.1f%%', colors=['silver', 'pink', 'orange', 'palegreen', 'aqua', 'blue'], fontsize=18, legend=False, title='2016 Volume Distribution').set_ylabel('')\nseries.plot.pie(y='2017',figsize=(9, 9), autopct='%1.1f%%', colors=['silver', 'pink', 'orange', 'palegreen', 'aqua', 'blue'], fontsize=18, legend=False, title='2017 Volume Distribution').set_ylabel('')\nseries.plot.pie(y='2018',figsize=(9, 9), autopct='%1.1f%%', colors=['silver', 'pink', 'orange', 'palegreen', 'aqua', 'blue'], fontsize=18, legend=False, title='2018 Volume Distribution').set_ylabel('')","82be62b4":"from fbprophet import Prophet","83a31574":"df_pr = df.copy()","090cd9f9":"df_pr = df_pr[['Date', 'AveragePrice']].rename(columns = {'Date': 'ds', 'AveragePrice':'y'})","6c5d7ca5":"train_data_pr = df_pr.iloc[:len(df)-30]\ntest_data_pr = df_pr.iloc[len(df)-30:]","16b0bf14":"m = Prophet()\nm.fit(train_data_pr)\nfuture = m.make_future_dataframe(periods=30,freq='MS')\nprophet_pred = m.predict(future)","2f905029":"prophet_pred.tail()","f4c63dc6":"prophet_pred = pd.DataFrame({\"Date\" : prophet_pred[-30:]['ds'], \"Pred\" : prophet_pred[-30:][\"yhat\"]})","b0a0161b":"prophet_pred = prophet_pred.set_index(\"Date\")","0edd1ee6":"prophet_pred.index.freq = \"MS\"","673f88db":"test_data_pr[\"Prophet_Predictions\"] = prophet_pred['Pred'].values","8adb4c44":"test_data_pr = test_data_pr.set_index(\"ds\")","7ba63ff5":"test_data_pr.head(10)","2d45bedd":"test_data_pr.tail(10)","8bccef44":"plt.figure(figsize=(16,5))\nax = sns.lineplot(x= test_data_pr.index, y=test_data_pr[\"y\"])\nsns.lineplot(x=test_data_pr.index, y = test_data_pr[\"Prophet_Predictions\"]);","18c8e28a":"### Comparing Prophet's predicions with the original. ","993fd3c5":"### Visualising the comparision between Prophet's prediction with the actual price. Blue is the Prophets prediction and red is the actual price.","17688183":"#### It makes more sense to work with only cities rather then states. So I am going to remove all the states from the region column.","991570a6":"#### Rounding off certain columns as I find it more comfertable to work with rounded off values. This step can actually be skipped.","caa61041":"### Selecting important volume features to draw pie charts to see the volume distribution.","eb9692be":"## Step 2: Feature Engineering.","c23432cb":"## Step 4: Avg avocado price perdiction using Facebook Prophet.","5dea4903":"#### As we can see above Houston clearly has the cheapest avocados but the record cheapest price at one time was recoreded in PhoenixTucson","586a1eea":"## Conclusion.\n\n#### I was able to get some really nice visualizations and comparison graphs. I tried to look through the data left, right and centre. The first 3 steps went smooth. But in the last step I was not able to get very accurate predictions using Facebook Prophet. I will try to come back to my notebook and make changes in last step. Also I would like to try LSTM & ARIMA for my future tasks. It would be nice to compare the results of all 3 then.\n#### As of now I would like to conclude here. \n#### If you have gone through my work and found it good please upvote. Anyone can copy and edit my notebook. It would be amazing to get some suggestions.\n\n#### One can find my more notebooks and work here: https:\/\/www.kaggle.com\/vikasbhadoria\/notebooks\n\n### Thank you","9dd66e2d":"# Avocado prices\n\n### Nature and rationale of the data\n\n> The `data` represents weekly 2018 retail scan data for National retail volume (units) and price. Retail scan data comes directly from retailers\u2019 cash registers based on actual retail sales of Hass avocados. Starting in 2013, the table below reflects an expanded, multi-outlet retail data set. Multi-outlet reporting includes an aggregation of the following channels: grocery, mass, club, drug, dollar and military. The Average Price (of avocados) in the table reflects a per unit (per avocado) cost, even when multiple units (avocados) are sold in bags. The Product Lookup codes (PLU\u2019s) in the table are only for Hass avocados. Other varieties of avocados (e.g. greenskins) are not included in this table.","76b3c47f":"#### From the histogram of the data I see Avg Price has a very nice distribution. Hence I will plot that seprately in the next cell.","4caa8035":"#### Organic surely are more expensive. ","edcea093":"## Step 3: Exploratory Data Analysis","c47634a6":"##### Chage the date column to datetime so this can be used as a time serise data. ","ff5fc2d8":"## In this Notebook I have done the following tasks: \n\n#### Did Feature engineering to round off certain features and created new features like Day & Month.\n\n#### Went in detail to  explore and visualize the data. Some important graphs in notebooks are:\n* Avg.Price of Avocado by City,Total volume of Avocado sold by City.\n* Avg.price of Avocado as per type, AvgPrice of avocado as per days of month, Total volume of avacado sold as per month.\n* Pie graph to visualize volume distribution.\n\n#### Used Facebook Prophet to predict the future average price of Avodaco.\n\n","62c3b7e1":"## Step 1: Import all the libraries, load the dataset and have a first look at the data.","462a7d39":"#### The above visual clearly shows that Avg Price of avocado has an affect on the sales. The sales are high when the Avg price is low and vice versa.","4cf40eb8":"#### Luckily we dont have any null values which makes working with data easier.","d8cc30dd":"#### Avg price of avocado over time as per types.","1131b279":"#### As seen avg price of avocado is the most in San Francisco & hartford springfield","5f4becca":"## Some relevant columns in the dataset:\n\n*  Date - The date of the observation\n*  AveragePrice - the average price of a single avocado\n*  type - conventional or organic\n*  year - the year\n*  Region - the city or region of the observation\n*  Total Volume - Total number of avocados sold\n*  4046 - Total number of avocados with PLU 4046 sold\n*  4225 - Total number of avocados with PLU 4225 sold\n*  4770 - Total number of avocados with PLU 4770 sold","ce755314":"#### Clearly LA is in love with avocados, one reason can be that Avg price of Avocado in LA is not very high.","a7cb125d":"#### Total volume of avocado sold over time as per types.","71910ff3":"#### As seen from above 2 graphs. Houston has the cheapest organic avocados whereas conventional are the cheapest at PhoenixTucson."}}