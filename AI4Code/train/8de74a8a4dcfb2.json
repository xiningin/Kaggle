{"cell_type":{"d6a4c13a":"code","6ddb9077":"code","cc4674c6":"code","e0093f99":"code","48b1f31d":"code","c2f52a4a":"code","55ed3819":"code","e907f7ee":"code","ab65d7f4":"code","e20c0517":"code","48021578":"code","0a75dbba":"code","c4bca615":"code","f51879ad":"code","9714b373":"code","21e1943f":"code","43a4bd2d":"code","f1906952":"code","53bd9860":"code","4c603024":"code","1933ed1f":"code","392b96fa":"code","c41bebce":"code","89be3e51":"code","80b5bd99":"code","4305ff32":"code","1fc7a3c0":"code","263fb005":"code","68a0367f":"code","e9d1e4af":"code","7dd84e80":"code","8395dad9":"code","0585dfee":"code","086f9d4c":"code","ce0e93eb":"code","4b35454a":"code","83c19c8c":"code","47c30f6d":"code","c8a85ed3":"code","2519c21a":"code","405d97ae":"code","9c3e5fa0":"code","b6dcd572":"code","87e2fc5f":"code","aaf5ef75":"code","2145b4a8":"code","3cecbce6":"code","d69ab169":"code","385a1d9a":"code","1996d222":"code","73128f6a":"code","f142c6a9":"code","97bd9dc3":"code","fad0fd41":"code","10598264":"code","1d241d13":"code","368a41c9":"code","e7f4f652":"code","efd1c942":"code","9a8d66e9":"code","5a160af8":"code","99f00919":"code","88450c30":"code","f59503e8":"markdown","b84c4514":"markdown","3cf78be0":"markdown","3fe280cb":"markdown","9d89bb06":"markdown","cb9c2eb0":"markdown","dfceeea8":"markdown","a4763215":"markdown","218b8d94":"markdown","13ddcfa1":"markdown","cb9d6c4b":"markdown","5da5591b":"markdown","741f6ca0":"markdown","0485ea1c":"markdown","eab68acf":"markdown","2b981a0c":"markdown"},"source":{"d6a4c13a":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\nfrom sklearn.cluster import KMeans\nfrom sklearn import preprocessing\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.preprocessing import  LabelEncoder\nimport plotly.express as px","6ddb9077":"df = pd.read_csv('..\/input\/customer-personality-analysis\/marketing_campaign.csv', sep='\\t')\ndf","cc4674c6":"from datetime import date\nyear = date.today().year\nage= year - df['Year_Birth'] \ndf['Age'] = age\n\n\ndf.Dt_Customer = pd.to_datetime(df.Dt_Customer)\n","e0093f99":"df.head()","48b1f31d":"df = df.drop(columns=[\"ID\", \"Year_Birth\", 'NumDealsPurchases',\t'NumWebPurchases',\t'NumCatalogPurchases',\t'NumStorePurchases',\t'NumWebVisitsMonth',\t'AcceptedCmp3',\t'AcceptedCmp4',\t'AcceptedCmp5',\t'AcceptedCmp1',\t'AcceptedCmp2',\t'Complain',\t'Z_CostContact',\t'Z_Revenue',\t'Response']) ","c2f52a4a":"df","55ed3819":"df.isna().sum(axis=0)","e907f7ee":"grafico = px.box(df, y='Income')\ngrafico.show()","ab65d7f4":"df.query(\"Income > 140000\") ","e20c0517":"df = df.drop([164,617,655,687,1300,1653,2132,2233])","48021578":"df.isnull().sum()","0a75dbba":"df['Income'].fillna(df['Income'].mean(), inplace = True)","c4bca615":"sns.heatmap(df.isnull());","f51879ad":"df.describe()","9714b373":"grafico = px.box(df, y='Age')\ngrafico.show()","21e1943f":"df.loc[df['Age'] > 81]","43a4bd2d":"df = df.drop([192,239,339])","f1906952":"correlations = df.corr()\nf, ax = plt.subplots(figsize = (15,15))\nsns.heatmap(correlations, annot=True)\ncorrelations.round(2);","53bd9860":"Plot1 = ['MntWines',\t'MntFruits',\t'MntMeatProducts',\t'MntFishProducts',\t'MntSweetProducts','MntGoldProds','Age']\nsns.pairplot(df[Plot1], hue = 'Age')","4c603024":"Plot2 = ['MntWines',\t'MntFruits',\t'MntMeatProducts',\t'MntFishProducts',\t'MntSweetProducts','MntGoldProds','Income']\n\nsns.pairplot(df[Plot2], hue = 'Income')","1933ed1f":"plt.figure(figsize=(10,6))\nsns.countplot(y=\"Marital_Status\", data=df, order=df[\"Marital_Status\"].value_counts().index)\nplt.title(\"Counts of All Marital Status\");","392b96fa":"mk = LabelEncoder()\ndf['Education'] = mk.fit_transform(df['Education'])\ndf['Marital_Status'] = mk.fit_transform(df['Marital_Status'])\ndf['Dt_Customer'] = mk.fit_transform(df['Dt_Customer'])","c41bebce":"df","89be3e51":"scaler = StandardScaler()                                         \ndf_scaled = scaler.fit_transform(df)","80b5bd99":"type(df_scaled)","4305ff32":"min(df_scaled[0]), max(df_scaled[0]) ","1fc7a3c0":"df_scaled","263fb005":"wcss_1 = []                                     \nrange_values = range(1, 10)                    \nfor i in range_values:                        \n  kmeans = KMeans(n_clusters=i)                 \n  kmeans.fit(df_scaled)            \n  wcss_1.append(kmeans.inertia_)  ","68a0367f":"print(wcss_1) ","e9d1e4af":"plt.figure(figsize=(20,15))\nplt.plot(wcss_1, '-o',)                              \nplt.xlabel('Clusters',)\nplt.ylabel('WCSS');\n\n","7dd84e80":"kmeans = KMeans(n_clusters=5)           \nkmeans.fit(df_scaled)         \nlabels = kmeans.labels_","8395dad9":"labels, len(labels)  ","0585dfee":"np.unique(labels, return_counts=True)","086f9d4c":"cluster_centers = pd.DataFrame(data = kmeans.cluster_centers_, columns = [df.columns])\ncluster_centers","ce0e93eb":"cluster_centers = scaler.inverse_transform(cluster_centers)\ncluster_centers = pd.DataFrame(data = cluster_centers, columns = [df.columns])\ncluster_centers","4b35454a":"labels, len(labels)","83c19c8c":"df_mk_cluster = pd.concat([df, pd.DataFrame({'cluster': labels})], axis = 1) # axis=1 colocarmos os labels numa outra coluna;\ndf_mk_cluster.head()","47c30f6d":"sns.set(rc={'axes.facecolor':'black', 'figure.facecolor':'black', 'axes.grid' : False, 'font.family': 'Ubuntu'})\n\nfor i in df_mk_cluster:\n    g = sns.FacetGrid(df_mk_cluster, col = \"cluster\", hue = \"cluster\", palette = \"Set2\")\n    g.map(plt.hist, i, bins=10, ec=\"k\") \n    g.set_xticklabels(rotation=30, color = 'white')\n    g.set_yticklabels(color = 'white')\n    g.set_xlabels(size=15, color = 'white')\n    g.set_titles(size=15, color = '#FFC300', fontweight=\"bold\")\n    g.fig.set_figheight(5);","c8a85ed3":"cluster_0 = df_mk_cluster.loc[df_mk_cluster['cluster'] ==0]\ncluster_1 = df_mk_cluster.loc[df_mk_cluster['cluster'] ==1]\ncluster_2 = df_mk_cluster.loc[df_mk_cluster['cluster'] ==2]\ncluster_3 = df_mk_cluster.loc[df_mk_cluster['cluster'] ==3]\ncluster_4 = df_mk_cluster.loc[df_mk_cluster['cluster'] ==4]","2519c21a":"print('Renda cluster 0: ', cluster_0['Income'].max())\nprint('Renda cluster 1: ', cluster_1['Income'].max())\nprint('Renda cluster 2: ', cluster_2['Income'].max())\nprint('Renda cluster 3: ', cluster_3['Income'].max())\nprint('Renda cluster 4: ', cluster_4['Income'].max())","405d97ae":"print('income cluster 0: ', cluster_0['Income'].max())\nprint('income cluster 1: ', cluster_1['Income'].max())\nprint('income cluster 2: ', cluster_2['Income'].max())\nprint('income cluster 3: ', cluster_3['Income'].max())\nprint('income cluster 4: ', cluster_4['Income'].max())","9c3e5fa0":"import matplotlib as mpl\n","b6dcd572":"#a Results\nclusters_count = df_mk_cluster['cluster'].value_counts()                        # Counting wins-losses-draws\nclusters_count = clusters_count.to_frame().reset_index()                      # Convert series to dataframe\nclusters_count.columns = ['clusters', 'count']                                # Rename column names\nclusters_count = clusters_count.sort_values('clusters', ascending = True)     # Sorting data\n\nlabels = [\n        \"B\", \n        \"A\", \n        \"D\", \n        \"E\",\n        \"C\"\n        ]\n\n# Visualization\nplt.figure(figsize=(12,8))\n\nmpl.rcParams['font.size'] = 17\ncolors = sns.color_palette('Set2')[0:5]\n\nplt.pie(clusters_count['count'], \n        explode=(0.05, 0.05, 0.05, 0.05, 0.05), \n        labels = labels,\n        colors= colors,\n        autopct='%1.1f%%',\n        textprops = dict(color =\"white\", fontsize=19),\n        counterclock = False,\n        startangle=180,\n        wedgeprops={\"edgecolor\":\"gray\",'linewidth':1}\n        )\n\nplt.axis('equal')\n\n# Title \nplt.text(-0.8, 1.2, \"Clusters\", size=30, color=\"#FFC300\", fontweight=\"bold\")\nplt.text(-0.12, 1.2, \"Distribution\", size=30, color=\"white\")\n\n# Author\nplt.text(1.1, -1.25, \"@miguelfzzz\", fontsize=12, ha=\"right\", color='lightgray', fontweight=\"bold\")\n\nplt.show();","87e2fc5f":"plt.figure(figsize=(12,6))\n\n_ = sns.scatterplot(y ='Income',x = 'Age', data = df_mk_cluster, hue= 'cluster')","aaf5ef75":"!pip install fbprophet","2145b4a8":"from fbprophet import Prophet","3cecbce6":"df2 = pd.read_csv('..\/input\/customer-personality-analysis\/marketing_campaign.csv', sep='\\t')","d69ab169":"df2.head(2)","385a1d9a":"df2 = df2.drop(df2.columns[[0, 1, 2, 3, 4, 5, 6, 9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]], axis=1)","1996d222":"df2 ","73128f6a":"df2.describe()","f142c6a9":"df2.hist();","97bd9dc3":"df2 = df2.sort_values(by = 'Dt_Customer')\ndf2","fad0fd41":"df2= df2[['Dt_Customer', 'Recency']].rename(columns = {'Dt_Customer': 'ds', 'Recency': 'y'})\ndf2","10598264":"model = Prophet()\nmodel.fit(df2)","1d241d13":"future = model.make_future_dataframe(periods=90)  \nforecast = model.predict(future)","368a41c9":"forecast.head()","e7f4f652":"forecast.tail() ","efd1c942":"model.plot(forecast, xlabel = 'Date', ylabel = 'Visit');","9a8d66e9":"model.plot_components(forecast);","5a160af8":"from fbprophet.plot import plot_plotly, plot_components_plotly","99f00919":"plot_plotly(model, forecast)","88450c30":"plot_components_plotly(model, forecast)","f59503e8":"\n# **Introdu\u00e7\u00e3o**\n\nEm meus casos de estudo mantenho a escrita no idioma ingl\u00eas por ser o utilizado no Kaggle e os mantenho tamb\u00e9m em portugu\u00eas devido ao fato da minha l\u00edngua nativa ser o portugu\u00eas brasileiro, assim podemos compartilhar mais conhecimento e experi\u00eancias no Kaggle com nossos colegas brasileiros.\n\nObigado!!\n\n\nAConforme dataset a an\u00e1lise da personalidade do cliente ajuda a empresa a adequaer o seu produto com base em seus clientes de diferentes tipos de segmentos de clientes. Por exemplo, em vez de gastar dinheiro para comercializar um novo produto para cada cliente no banco de dados da empresa, uma empresa pode analisar qual segmento de cliente tem maior probabilidade de comprar o produto e, em seguida, comercializar o produto apenas naquele segmento espec\u00edfico.\n\nO caso em em estudo possui um dataset bem amplo, mas n\u00f3s iremos dividi-lo em tr\u00eas partes, faremos tr\u00eas estudos indepedentes, pois h\u00e1 tr\u00eas caracateristicas bem distintas entre os tr\u00eas, uma classe de atributos poder\u00e1 influ\u00eanciar com seus dados na outra, o que poder\u00e1 comprometer a o algoritimo.\n\nEm uma eventual campanha de marketing poder\u00e1 a empresa se utilizar dos resultados dos tr\u00eas juntamente para direcionar tipo de produto, campanha e oferecer a melhor forma de compra a ele cada cliente.\n\nIremos um pouco mais al\u00e9m utilizando o Prophet para fazermos previs\u00f5es das vendas;\n\nN\u00f3s teremos como base os atributos pessoais dos clientes que se relacionar\u00e1 com os outras tr\u00eas classes:\n\n                    Parte 1 - clusters e Prophet;\n                    Parte 2 -  Em quais campanhas de publicidade o cliente respondeu, ou n\u00e3o?\n                    Parte 3 -  Formas utilizada para compras.","b84c4514":"# **S\u00e9ries Temporais \/ Facebook Prophet**\n\nOusando um pouco mais nesse dataset vamos fazer algumas previs\u00f5es de vendas, com base no acesso dos clientes ao estabelecimento e sua data de cadastro.\n\n\n\nDaring a little more in this dataset, let's make some sales forecasts, based on customer access to the establishment and their registration date.\n\n","3cf78be0":"# **Atributos**\n\n# **People**\n\n\nID: Customer's unique identifier\n\nYear_Birth: Customer's birth year\n\nEducation: Customer's education level\n\nMarital_Status: Customer's marital status\n\nIncome: Customer's yearly household income\n\nKidhome: Number of children in customer's household\n\nTeenhome: Number of teenagers in customer's household\n\nDt_Customer: Date of customer's enrollment with the company\n\nRecency: Number of days since customer's last purchase\n\nComplain: 1 if customer complained in the last 2 years, 0 otherwise\n\n\n# **Products => Part 1**\nMntWines: Amount spent on wine in last 2 years\n\nMntFruits: Amount spent on fruits in last 2 years\n\nMntMeatProducts: Amount spent on meat in last 2 years\n\nMntFishProducts: Amount spent on fish in last 2 years\n\nMntSweetProducts: Amount spent on sweets in last 2 years\n\nMntGoldProds: Amount spent on gold in last 2 years\n\n\n# **Promotion => Part 2**\n\nNumDealsPurchases: Number of purchases made with a discount\n\nAcceptedCmp1: 1 if customer accepted the offer in the 1st campaign, 0 otherwise\n\nAcceptedCmp2: 1 if customer accepted the offer in the 2nd campaign, 0 otherwise\n\nAcceptedCmp3: 1 if customer accepted the offer in the 3rd campaign, 0 otherwise\n\nAcceptedCmp4: 1 if customer accepted the offer in the 4th campaign, 0 otherwise\n\nAcceptedCmp5: 1 if customer accepted the offer in the 5th campaign, 0 otherwise\n\nResponse: 1 if customer accepted the offer in the last campaign, 0 otherwise\n\n# Place => Part 3\n\nNumWebPurchases: Number of purchases made through the company\u2019s web site\n\nNumCatalogPurchases: Number of purchases made using a catalogue\n\nNumStorePurchases: Number of purchases made directly in stores\n\nNumWebVisitsMonth: Number of visits to company\u2019s web site in the last month Target","3fe280cb":"Cluster 0 = C\n\nCluster 1 = E\n\nCluster 2 = D\n\nCluster 3 = B\n\nCluster 4 = A","9d89bb06":"Vamos manter apenas os atributos que podem fazer rela\u00e7\u00e3o direta entre consumidor e produtos.\n\nWe will only keep the attributes that can make a direct relationship between consumers and products.","cb9c2eb0":"Agora possuimos apenas 14 atributos que es\u00e3o voltados ao perfil dos clientes e o consumo dos produtos.\n\n\nWe now have only 14 attributes that are geared towards customer profile and product consumption","dfceeea8":"# **Introduction**\n\nIn my case studies I keep writing in English because it is used in Kaggle and I also keep them in Portuguese because my native language is Brazilian Portuguese, so we can share more knowledge and experiences in Kaggle with our Brazilian colleagues.\n\nThank you!!\n\n\nAccording to dataset, customer personality analysis helps the company to tailor its product based on its customers from different types of customer segments. For example, instead of spending money to market a new product to each customer in the company's database, a company can analyze which customer segment is most likely to buy the product and then market the product only in that specific segment. .\n\nThe case under study has a very broad dataset, but we will divide it into three parts, we will do three independent studies, as there are three very distinct characteristics among the three, one attribute class may influence with its data on the other, which may compromise the algorithm.\n\nIn an eventual marketing campaign, the company may use the results of the three together to target the type of product, campaign and offer each customer the best way to purchase.\n\nWe'll go a little further using Prophet to forecast sales;\n\nWe will be based on the personal attributes of the customers that will relate to the other three classes:\n\n                    Part 1 - clusters and Prophet;\n                    Part 2 - Which advertising campaigns did the customer respond to, or not?\n                    Part 3 - Forms used for shopping.","a4763215":"# **Analisando e Tratando os Dados**\n\n\n# **Analyzing and Handling Data**","218b8d94":"Vamos transforma a data de nascimento dos nossos clientes em idade em outra coluna e vamos excluir a coluna 'Year_Birth'.\n\nVamos tramb\u00e9m transformar a da de registro dos consumirores de objeto para date time 64;\n\n\nLet's turn our clients' birthdate by age into another column and let's delete the 'Year_Birth' column.\n\nLet's also transform the registration data of the object consumers to date time 64;","13ddcfa1":"# **Analise dos dados em gr\u00e1ficos**\n\n\n# **Analysis of data in graphs**","cb9d6c4b":"# **`Primeira Parte  Clientes x Produtos`**\n\n\n# **First Party Customers x Products**","5da5591b":"Com j\u00e1 tinhamos observado no gr\u00e1fico de correla\u00e7\u00e3o, a renda \u00e9 um fator determinante no consumo dos produtos, sendo ela o par\u00e3metro para classificarmos nosssos clusters.\n\nAs we have already seen in the correlation graph, income is a determining factor in the consumption of products, as it is the parameter for classifying our clusters.","741f6ca0":"# Nos gr\u00e1ficos acima identificamos uma pequena queda nos neg\u00f3cios de 51 para 47 pontos, sendo os finais de semana o per\u00edodo de maior movimento e quedas em meados de janeiro.\n\n\n## In the charts above we identify a small drop in trades from 51 to 47 points, with the weekends being the period of busiest movement and falls in mid-January.","0485ea1c":"Verificamos uma oscila\u00e7\u00e3o nas vendas em formato de ondas, mas essas ondas est\u00e3o com a tend\u00eancia de queda nas vendas.\n\nWe see a waveform oscillation in sales, but these waves are trending down in sales.","eab68acf":"Em nosso gr\u00e1fico de correla\u00e7\u00e3o podemos observa que a renda influ\u00eancia muito no tipo de produto de consumo, n\u00e3o tendo uma correla\u00e7ao forte com filhos, idade e visitas no local.\n\n\nIn our correlation graph we can observe that income influences a lot on the type of consumer product, not having a strong correlation with children, age and visits to the place.","2b981a0c":"# **Pr\u00e9 Processamento**\n\n\n# **Pre-Processing**"}}