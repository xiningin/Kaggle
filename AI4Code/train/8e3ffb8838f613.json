{"cell_type":{"f700ef37":"code","7fa58182":"code","28ed4022":"code","fa6cceac":"code","5c66e04c":"code","b9321919":"code","75647d55":"code","87d231f9":"code","116745f1":"code","78d9e375":"code","b0bd604f":"code","71aea9ff":"code","e798dea1":"code","ee5ee8c9":"code","7a434d2b":"code","9a8456de":"code","09517d31":"code","778b2b85":"markdown","ca331987":"markdown","4730d8ff":"markdown","7ce1e92a":"markdown","80b9758f":"markdown","a351cb3c":"markdown","f3ba6493":"markdown","9ff7b067":"markdown","8d75bd2b":"markdown","ec48287a":"markdown","0b5b7566":"markdown","6a75198e":"markdown","9f35199c":"markdown","a961ffbd":"markdown","3849534d":"markdown","ccb8fcae":"markdown","3d48dee0":"markdown","b63a286d":"markdown","cf23a366":"markdown"},"source":{"f700ef37":"import matplotlib.pyplot as plt # plotting\nimport numpy as np # linear algebra\nimport os # accessing directory structure\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport seaborn as sns # plotting","7fa58182":"print(os.listdir('..\/input'))","28ed4022":"df = pd.read_csv('..\/input\/hourly_irish_weather.csv', parse_dates=['date'])\ndf.drop('Unnamed: 0', axis=1, inplace=True)\nnRow, nCol = df.shape\nprint(f'There are {nRow} rows and {nCol} columns')","fa6cceac":"df.head(5)","5c66e04c":"df.info()","b9321919":"df_objects = df.select_dtypes(include='object')\nobject_memory_usage = df_objects.memory_usage(deep=True).sum()\/ 1024**2\nprint(f\"Total memory usage for Objects is {object_memory_usage :3.2f}mb's\")\n\ntotal_memory_usage = df.memory_usage(deep=True).sum() \/ 1024 ** 2\nprint(f\"Total memory usage is {total_memory_usage :3.2f}mb's\")","75647d55":"df_category = df_objects.astype('category')\n\ncategory_memory_usage = df_category.memory_usage(deep=True).sum()\/ 1024**2\nprint(f\"Total memory usage for Categories is {category_memory_usage:3.2f}mb's\")","87d231f9":"object_columns = df.select_dtypes(include='object').columns\n\ndf[object_columns] = df[object_columns].astype('category')","116745f1":"df.isna().mean()","78d9e375":"def heatmap(df):\n    sns.set(rc={'figure.figsize':(20,20)})\n    sns.set_context('talk')\n    sns.heatmap(df.round(2), cbar=None, annot=True, linewidth=.5, cmap='YlGnBu')","b0bd604f":"station_na_dict = {}\nfor station in df.station.cat.categories:\n    station_na_dict[station] = df[df.station == station].isna().mean()\n\nstation_na_df = pd.DataFrame(station_na_dict)\n\nheatmap(station_na_df)\nplt.title('Proportion of missing values by Weather Station')","71aea9ff":"yearly_na_dict = {}\n\nfor year in df.date.dt.year.unique():\n    yearly_na_dict[year] = df[df.date.dt.year == year].isna().mean()\n\nyearly_na_df = pd.DataFrame(yearly_na_dict)\n\nheatmap(yearly_na_df)\nplt.title('Proportion of missing values by Year')","e798dea1":"sun_year_station = df.groupby([df.date.dt.year, 'station']).count()['sun'].reset_index()\nsun_pivoted = sun_year_station.pivot_table(values='sun', index='station', columns='date', fill_value=0)\n\nheatmap(sun_pivoted\/1000)\nplt.yticks(rotation=0)\nplt.title('Sun data Points by year and station (1000\\'s) ')","ee5ee8c9":"def aggerate_data(grouper):\n    # Drop Lat, Long, w and ww columns\n    agg_df = df.drop(['latitude', 'longitude', 'w', 'ww'], axis=1).groupby(grouper).agg([np.min, np.max, np.mean, np.std])\n    agg_df.columns = ['_'.join(val) for val in agg_df.columns.values]\n    return agg_df\n\nmonth_year_agg_df = aggerate_data([df.date.dt.year, df.date.dt.month])\n\n# Rename and reset index\nmonth_year_agg_df.index.rename(['year', 'month'], inplace = True)\nmonth_year_agg_df.reset_index(inplace=True)\n\n# Combine year and Month\nmonth_year_agg_df['day'] = 15\nmonth_year_agg_df['date'] = pd.to_datetime(month_year_agg_df[['day','month', 'year']])\nmonth_year_agg_df.drop(['day', 'month', 'year'], axis=1, inplace=True)\n\n#create new date index\nmonth_year_agg_df.index = month_year_agg_df.date\nmonth_year_agg_df.drop('date', axis=1, inplace=True)\n\nmonth_year_agg_df.head()","7a434d2b":"def plot_aggerated_data_timeseries(df, variable, title='Monthly'):\n    fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(30, 20))\n    fig.suptitle(f'{title} Average - {variable.capitalize()}')\n    \n    ax1.plot(df.index, df[f'{variable}_mean'])\n    upper_sd = df[f'{variable}_mean'] + df[f'{variable}_std']\n    lower_sd = df[f'{variable}_mean'] - df[f'{variable}_std']\n    ax1.fill_between(df.index, y1=upper_sd, y2=lower_sd, alpha=.2)\n    ax1.set_title(f'{variable.capitalize()} - Average and Standard Deviation')\n   \n    ax2.plot(df.index, df[f'{variable}_mean'])\n    ax2.fill_between(df.index, df[f'{variable}_amin'], df[f'{variable}_amax'], alpha=.2)\n    ax2.set_title(f'{variable.capitalize()} - Average, Min, Max')\n    plt.show()","9a8456de":"cols = set(c[0] for c in month_year_agg_df.columns.str.split('_'))\n\nfor col in cols:\n    plot_aggerated_data_timeseries(month_year_agg_df, col, title='Month, Year')","09517d31":"monthly_df = aggerate_data(df.date.dt.month)\n\nfor col in cols:\n    plot_aggerated_data_timeseries(monthly_df, col, title='Monthly')","778b2b85":"Over the years the quantity of missing values for the 6 variables has increased! Are Belmullet, Malin Head and Valentia no longer reporting these variables? As the missing proportions are consistent for each variable I will look at the sun variable by year and station.","ca331987":"Let's take a quick look at what the data looks like:","4730d8ff":"The heatmap shows that over two thirds of the stations do not collect data for 6 variables. Belmullet, Malin Head and Valentia are all missing consitent proportions of these variables. Have they gained access to equipment at different times?","7ce1e92a":"There is 1 csv file in the current version of the dataset:\n","80b9758f":"### Plots\n\nLoop through each variable and produce plots","a351cb3c":"## Seasonality\n\nAggerate by month to assess seasonality","f3ba6493":"### Note's on Plots\n\n* 'clamt' - Cloud Ammount (Okta's)- 2 Values largert than the consisent max of 8. Value of 9 Okta's (Sky obstructed from view) is possible\n* 'clht' - Cloud Ceiling Height - Value of 999 is no cloud. Is value of 0 = fog??\n* 'dewpt' - Dew Point - Suspicious Low point in 2007, needs more investigating. Seasonal\n* 'msl' - Mean Sea Level Pressure (hPa) - Big Outlier around 2010\n* 'rain' - Rain (mm) - no outliers\n* 'rhum' - Relative Humidity (%) - Zero values similar to outliers in vappr outliers??\n* 'sun' - Sun (hours) - big outlier, 5 hours of sun in 1 hour???\n* 'temp' - Temperature (\u00b0C) - No Apparent outliers, seasonal\n* 'vappr' - Vapour Pressure (hPa) - Outlier min values between 1996 and 1998?, Seasonal\n* 'vis' - Visability (m) - no outliers, seasonal\n* 'wddir' - Predominant Hourly Wind Direction (degrees) - No Outliers all between 0 and \n* 'wdsp' - Mean Hourly Wind Speed (kt) - Max value is lower than highest recorded in ireland\n* 'wetb' - Wet Bulb Air Temperature (\u00b0C) - Some very low outliers, needs more investigating. Seasonal","9ff7b067":"Fnction to plot the aggerated data in a timeseries. The function will produce two plots. The first one will be the mean and standard deviation for the variable. The second one will be the mean and min and max values. \n\nNB. Some variables like rain will produce a negative standard deviation, please ignore!","8d75bd2b":"There are 2 object columns, lets explore them.","ec48287a":"Over 50% of ww, w, sun, vis, clht and clamt are missing. More exploration is required.\n\nIs this because not all stations have the equipment to gather this data?","0b5b7566":"### Read in the data","6a75198e":"The 2 object columns are using nearly half the memory. Can changing them to categorical help!","9f35199c":"## Introduction\nExploring the Irish Weather Dataset","a961ffbd":"### Aggerating the data\n","3849534d":"## Exploratory Analysis\nImport required libraries","ccb8fcae":"Converting object types to categories will save nearly 500mb memory.","3d48dee0":"## Checking for Missing values","b63a286d":"## More to follow . . .","cf23a366":"Belmullet, Malin Head and Valentia stopped reporting these data between 2009 and 2012! Knock Airport is reporting these data since 1996. \n\nThis [link](https:\/\/www.met.ie\/climate\/what-we-measure#collapsemannedweatherstations) states that the 4 airpot stations and the Casement station are manned, with the rest being automatic, which is why they have the extra variables. Bulmullet, Malin head and Valentia must have been manned previously."}}