{"cell_type":{"22ae1b26":"code","4ea3e175":"code","6c105ab0":"code","25f5c0fe":"code","6065973b":"code","cfa7f6ce":"code","bf0aea3c":"code","789d69a9":"code","85743587":"code","4704b23f":"code","0ade590f":"code","399e27ae":"code","8fd10978":"code","4d96ed8e":"code","25ee1a10":"code","7e0d9e55":"code","ac68aa0d":"code","098c851d":"code","cb1d68eb":"code","a31182fa":"code","a39b4805":"code","b15d9c49":"code","83b472bd":"code","2f9115cc":"code","80715f39":"markdown","4cc2ffdb":"markdown"},"source":{"22ae1b26":"# Check Versions\nimport tensorflow as tf\nimport keras as k\n\nprint(tf.__version__)\nprint(k.__version__)","4ea3e175":"from keras.layers import Input, Lambda, Dense, Flatten\nfrom keras.models import Model\nfrom keras.applications.vgg16 import VGG16, preprocess_input\nfrom keras.preprocessing import image\nfrom keras.preprocessing.image import ImageDataGenerator\nfrom keras.models import Sequential\nimport numpy as np\nimport pandas as pd\nfrom glob import glob \nimport matplotlib.pyplot as plt","6c105ab0":"IMAGE_SIZE = [224, 224]","25f5c0fe":"train_directory = '..\/input\/100-bird-species\/birds\/train'\ntest_directory = '..\/input\/100-bird-species\/birds\/test'\nvalid_directory = '..\/input\/100-bird-species\/birds\/valid'","6065973b":"# Add PreProcessing layers to the front of VGG\nvgg = VGG16(\n    input_shape = IMAGE_SIZE + [3], \n    weights = 'imagenet',\n    include_top = False\n)\n\n# dont train existing weights\nfor layer in vgg.layers:\n    layer.trainable = False","cfa7f6ce":"# useful for getting number of classes\nfolders = glob('..\/input\/100-bird-species\/birds\/train\/*')\nlen(folders)","bf0aea3c":"folders[:3]","789d69a9":"# custom layer(s)\nx = Flatten()(vgg.output)\n# x = Dense(1000, activation = 'relu')(x)\npred_layer = Dense(len(folders), activation = 'softmax')(x)","85743587":"# Create a model object\nmodel = Model(inputs = vgg.input, outputs = pred_layer)","4704b23f":"# View Summary of structure of the Model\nmodel.summary()","0ade590f":"model.compile(\n    loss = 'categorical_crossentropy',\n    optimizer= 'adam',\n    metrics = ['accuracy']\n)","399e27ae":"train_datagen = ImageDataGenerator(\n    rescale = 1.\/255,\n    shear_range = 0.2,\n    zoom_range = 0.2,\n    horizontal_flip = True\n)\n\ntest_datagen = ImageDataGenerator(\n    rescale = 1.\/255\n)\n","8fd10978":"training_set = train_datagen.flow_from_directory(\n    directory = train_directory,\n    target_size = (224, 224),\n    batch_size = 32,\n    class_mode = 'categorical'\n)\n\ntest_set = test_datagen.flow_from_directory(\n    directory = test_directory,\n    target_size = (224, 224),\n    batch_size = 32,\n    class_mode = 'categorical'\n)","4d96ed8e":"len(training_set), len(test_set)","25ee1a10":"# r = model.fit_generator(\n#     training_set,\n#     validation_data = test_set,\n#     epochs = 5,\n#     steps_per_epoch = len(training_set),\n#     validation_steps = len(test_set)\n# )\n\nr = model.fit(\n    training_set,\n    validation_data = test_set,\n    epochs = 5,\n    steps_per_epoch = len(training_set),\n    validation_steps = len(test_set)\n)","7e0d9e55":"model.save(\"birds_classification_vgg.h5\")","ac68aa0d":"from keras.models import load_model\nfrom keras.preprocessing.image import load_img, img_to_array\n\nloaded_model = load_model('birds_classification_vgg.h5', compile = False)","098c851d":"labels = training_set.class_indices","cb1d68eb":"labels","a31182fa":"# Swap to map reverse\nlabels_reverse = {k:v for v,k in labels.items()}","a39b4805":"labels_reverse","b15d9c49":"def output(location):\n    img = load_img(location, target_size = (224, 224, 3))\n    img = img_to_array(img)\n    img = img \/ 255\n    img = np.expand_dims(img, [0])\n    answer = loaded_model.predict(img)\n    y_class = answer.argmax(axis = -1)\n    y = \" \".join(str(x) for x in y_class)\n    y = int(y)\n    res = labels_reverse[y]\n    return res","83b472bd":"img = '..\/input\/100-bird-species\/birds\/valid\/BALD EAGLE\/2.jpg'\npic = load_img(img, target_size = (224, 224, 3))\nplt.imshow(pic)\noutput(img)","2f9115cc":"img = '..\/input\/100-bird-species\/birds\/valid\/ALBATROSS\/4.jpg'\npic = load_img(img, target_size = (224, 224, 3))\nplt.imshow(pic)\noutput(img)","80715f39":"# Import Required Library","4cc2ffdb":"`Model.fit_generator` is deprecated and will be removed in a future version. Please use `Model.fit`, which supports generators."}}