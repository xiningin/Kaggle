{"cell_type":{"e559ef6d":"code","c6d6a7fe":"code","3d7640ba":"code","3e640a8b":"code","e3959e15":"code","6a7d6e79":"code","d8045873":"code","92c3f48e":"code","64d3c1ba":"code","61b449e3":"code","98af02ab":"code","c0a29220":"code","47c92549":"code","872580d0":"code","1e2b4ccc":"code","88301e67":"markdown","d16a39e4":"markdown","d0bcb46e":"markdown","7109cecd":"markdown","a02c07fd":"markdown"},"source":{"e559ef6d":"import numpy as np\nimport pandas as pd\nfrom PIL import Image, ImageFilter\nimport matplotlib.pyplot as plt\nfrom pathlib import Path\nimport skimage.measure\nfrom sklearn.metrics import accuracy_score\nfrom tqdm.notebook import tqdm\nPath.ls = lambda p: list(p.iterdir())","c6d6a7fe":"train = Path(\"..\/input\/fingers\/train\")\ntest = Path(\"..\/input\/fingers\/test\")","3d7640ba":"train.ls()\n","3e640a8b":"fist = np.array(Image.open(train\/\"d4b08243-4cd3-493a-8616-e83c5ea23b7a_0R.png\"))","e3959e15":"fist_mask = fist > 80","6a7d6e79":"plt.imshow(fist_mask)","d8045873":"for i in range(5):\n    new_fist_mask = fist_mask.copy()\n    for x in range(128):\n        for y in range(128):\n            for dx in range(-1, 2):\n                for dy in range(-1, 2):\n                    x_ = x + dx\n                    y_ = y + dy\n                    if 0 <= x_ < 128 and 0 <= y_ < 128:\n                        if fist_mask[y_][x_]:\n                            new_fist_mask[y][x] = True\n    fist_mask = new_fist_mask","92c3f48e":"plt.imshow(fist_mask)","64d3c1ba":"fist_mask[80:, ] = True","61b449e3":"plt.imshow(fist_mask)","98af02ab":"im = np.array(Image.open(train.ls()[140]))\n\nfingers = im * (1-fist_mask) > 85\nfingers = skimage.measure.label(fingers)","c0a29220":"plt.imshow(fingers)","47c92549":"print(fingers.max(), \"fingers\")","872580d0":"test_y = []\ntest_pred = []\n    \nfor fn in tqdm(test.ls()):\n    im = Image.open(fn)\n    test_y.append(int(fn.name[-6:-5]))\n    fingers = im * (1-fist_mask) > 85\n    fingers = skimage.measure.label(fingers)\n    pred = fingers.max()\n    test_pred.append(pred)","1e2b4ccc":"accuracy_score(test_y, test_pred)","88301e67":"We will predict number of fingers (not left\/right hand)\n\nThe first mask I tried got 97% accuracy, then I lost that so I had to spend a while finding a mask which achieved the same test accuracy.","d16a39e4":"# Use mask to leave only fingers","d0bcb46e":"Fill in holes","7109cecd":"# Create fist mask","a02c07fd":"# Make test predictions"}}