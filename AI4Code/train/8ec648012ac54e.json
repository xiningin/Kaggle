{"cell_type":{"e0b4ff11":"code","82768183":"code","bcea3e6b":"code","bdcef361":"code","e2791ccf":"code","219b3b2d":"code","0532a7a9":"code","7ac934da":"code","49f913cc":"code","0dcc4bb0":"code","f1d1c156":"code","b9140f72":"code","ec8d5b47":"code","9344e985":"code","b3d8a783":"code","f68eeb43":"code","fc9c188c":"code","bd2ad0f1":"code","a6b1ae5e":"code","892d39a2":"code","55c5b335":"code","fc2ced5f":"code","eca52b80":"code","a0bdbb42":"code","813d47a4":"code","57fa018f":"code","01d8fa7b":"code","7e8a2ab6":"code","907575c7":"code","593e268d":"code","1be62179":"code","42a06c16":"code","52b66f39":"code","01d4ca10":"code","e4be9d8b":"code","2c7b1302":"code","eea7332a":"code","b90aaa2d":"code","0affacde":"code","1e55df9e":"code","f39fbf45":"code","42f96244":"code","ddf453f4":"code","39d305ff":"code","f0581dca":"code","4e2bf982":"code","2a5fb498":"code","259df4fd":"code","9a7fde2c":"code","d21e33b2":"code","19b29714":"code","fbbd0f5c":"markdown","c6c578b3":"markdown","3c07801b":"markdown","64d3f6f0":"markdown","8365fdd8":"markdown","566aa6f4":"markdown","38dd1f8c":"markdown","27c0b4fe":"markdown","1e235cf0":"markdown","94631d7a":"markdown","c75a12a7":"markdown","ef90169d":"markdown","8ccc8806":"markdown","b7921078":"markdown","536fd710":"markdown","245ced16":"markdown","559f5d39":"markdown","04b23b92":"markdown","93b81546":"markdown","78a9cdce":"markdown","dd06849a":"markdown","4c3605c3":"markdown","731e03a5":"markdown","b0b7e472":"markdown","b60a5c30":"markdown","6c2a273e":"markdown","bd08ffc8":"markdown","a9cee50c":"markdown","6875ca5a":"markdown","031e70c6":"markdown","98d7730d":"markdown","83baa1ef":"markdown","ac797a95":"markdown","b390ab12":"markdown","f27a2503":"markdown","01872e93":"markdown","01e915fb":"markdown","5b5cfed1":"markdown","6e019545":"markdown","fbf8bf04":"markdown","81e3316b":"markdown","19759a19":"markdown","d4dce2ad":"markdown","f5cbd9b3":"markdown","adbe8f8a":"markdown","93f43715":"markdown","953ebe6f":"markdown","65038856":"markdown","676cecd7":"markdown","1e6af7ab":"markdown","b524115f":"markdown","d7b46748":"markdown","d73a4f97":"markdown","96b5e36b":"markdown","e0452480":"markdown","9561ddb9":"markdown","85c26f84":"markdown","4301a2d2":"markdown","4b46da77":"markdown","6cce0d42":"markdown","e87edf56":"markdown","d87f45fe":"markdown","a0ddfefd":"markdown","da708851":"markdown","c44c2ca6":"markdown","fa87095f":"markdown","c0c5a7bf":"markdown","35c5f37b":"markdown","b7867411":"markdown","b422a21a":"markdown","401f61c8":"markdown","e2b98961":"markdown","90cf2a45":"markdown","dd4d9e8e":"markdown","fe9efed7":"markdown","53e9f585":"markdown","40d0db1d":"markdown","d189d402":"markdown","97785083":"markdown","151dd6da":"markdown","2200d547":"markdown","88b56b0e":"markdown","c834c727":"markdown","435f651b":"markdown","1b7c5fe3":"markdown","b07f85cd":"markdown","e9a73ece":"markdown","ff0c43dc":"markdown","7b346bd4":"markdown","e36104b9":"markdown","8d8f4026":"markdown","a0484aa6":"markdown","65df2b7a":"markdown","799a4816":"markdown","53a5eb33":"markdown","cd6871f3":"markdown","a36bacf0":"markdown","2945e38a":"markdown","fed4cb9b":"markdown","fb2aaf07":"markdown","dfdbe51b":"markdown","53d66d2d":"markdown","1975f02d":"markdown","4a412c8c":"markdown","4cdfe5ed":"markdown","95b67505":"markdown","60f7eb5a":"markdown","2bb2d825":"markdown"},"source":{"e0b4ff11":"import os\nimport gc\nimport numpy as np\nimport pandas as pd\nfrom tqdm import tqdm_notebook as tqdm\n\nimport seaborn as sns\nfrom collections import Counter\nimport matplotlib.pyplot as plt\nfrom IPython.display import SVG\n\nimport warnings\nwarnings.filterwarnings('ignore')\n\nimport lightgbm\nimport xgboost\nimport catboost\n\nimport keras\nfrom keras.models import Model\nfrom keras.utils.vis_utils import model_to_dot\nfrom keras.layers import Input, Dense, Dropout, BatchNormalization\nfrom sklearn.preprocessing import MinMaxScaler","82768183":"os.listdir('..\/input\/ieee-fraud-detection')","bcea3e6b":"DATA_PATH = '..\/input\/ieee-fraud-detection\/'\nTRAIN_PATH = DATA_PATH + 'train_transaction.csv'\nTEST_PATH = DATA_PATH + 'test_transaction.csv'","bdcef361":"train_df = pd.read_csv(TRAIN_PATH)\ntest_df = pd.read_csv(TEST_PATH)","e2791ccf":"train_df = train_df.fillna(0.0)\ntrain_df.head()","219b3b2d":"plt.rcParams[\"axes.labelsize\"] = 15\nplt.rcParams[\"xtick.labelsize\"] = 13\nplt.rcParams[\"ytick.labelsize\"] = 13","0532a7a9":"fig, ax = plt.subplots(figsize=(10, 10))\nplot = sns.violinplot(x=\"isFraud\", y=\"TransactionAmt\", data=train_df.query(\"TransactionAmt < 1000\"), palette=[\"limegreen\", \"dodgerblue\"], linewidth=2\n                      , ax=ax).set_title('TransactionAmt', fontsize=16)\nplt.show()","7ac934da":"fig, ax = plt.subplots(figsize=(10, 10))\nplot = sns.boxplot(x=\"isFraud\", y=\"TransactionAmt\", data=train_df.query(\"TransactionAmt < 500\"), palette=[\"limegreen\", \"red\"], ax=ax).set_title('TransactionAmt', fontsize=16)\nplt.show()","49f913cc":"fig, ax = plt.subplots(figsize=(10, 10))\nplot = sns.countplot(y=\"ProductCD\", data=train_df, palette=reversed(['aquamarine', 'mediumaquamarine', 'mediumseagreen', 'seagreen', 'darkgreen'])).set_title('ProductCD', fontsize=16)\nplt.show(plot)","0dcc4bb0":"fig, ax = plt.subplots(figsize=(10, 10))\n\nprops = train_df.query(\"TransactionAmt < 500\")\\\n                .groupby(\"ProductCD\")['isFraud'].value_counts(normalize=True).unstack()\n\nsns.set_palette(['lightgreen', 'green'])\nprops.plot(kind='bar', stacked='True', ax=ax).set_ylabel('Proportion')\nplt.show(plot)","f1d1c156":"fig, ax = plt.subplots(figsize=(15, 15))\n\nplot = sns.violinplot(x=\"ProductCD\", y=\"TransactionAmt\", hue=\"isFraud\",\n                      data=train_df.query('TransactionAmt < 500'), palette=['lightgreen', 'green'],\n                      split=True, ax=ax).set_title('ProductCD vs. TransactionAmt', fontsize=16)\n\nplt.show(plot)","b9140f72":"fig, ax = plt.subplots(figsize=(15, 15))\n\nplot = sns.boxplot(x=\"ProductCD\", y=\"TransactionAmt\", hue=\"isFraud\",\n                   data=train_df.query('TransactionAmt < 500'), palette=['lightgreen', 'green'],\n                   ax=ax).set_title('ProductCD vs. TransactionAmt', fontsize=16)\n\nplt.show(plot)","ec8d5b47":"fig, ax = plt.subplots(figsize=(10, 10))\nplot = sns.countplot(y=\"P_emaildomain\", data=train_df.query(\"P_emaildomain in ['gmail.com', 'yahoo.com', 0.0, 'hotmail.com', 'anonymous.com']\").query(\"TransactionAmt < 500\"),\n                     palette=['navy', 'darkblue', 'blue', 'dodgerblue', 'skyblue']).set_title('P_emaildomain vs. TransactionAmt', fontsize=16)\nplt.show(plot)","9344e985":"fig, ax = plt.subplots(figsize=(10, 10))\n\nprops = train_df.query(\"P_emaildomain in ['gmail.com', 'yahoo.com', 0.0, 'hotmail.com', 'anonymous.com']\").query(\"TransactionAmt < 500\")\\\n                .groupby(\"P_emaildomain\")['isFraud'].value_counts(normalize=True).unstack()\n\nsns.set_palette(['lightblue', 'darkblue'])\nprops.plot(kind='bar', stacked='True', ax=ax).set_ylabel('Proportion')\nplt.show(plot)","b3d8a783":"fig, ax = plt.subplots(figsize=(15, 15))\n\nplot = sns.violinplot(x=\"P_emaildomain\", y=\"TransactionAmt\", hue=\"isFraud\",\n                      data=train_df.query(\"P_emaildomain in ['gmail.com', 'yahoo.com', 0.0, 'hotmail.com', 'anonymous.com']\").query(\"TransactionAmt < 500\"),\n                      palette=['lightblue', 'darkblue'], split=True, ax=ax).set_title('TransactionAmt vs. P_emaildomain', fontsize=16)\n\nplt.show(plot)","f68eeb43":"fig, ax = plt.subplots(figsize=(15, 15))\n\nplot = sns.boxplot(x=\"P_emaildomain\", y=\"TransactionAmt\", hue=\"isFraud\",\n                   data=train_df.query(\"P_emaildomain in ['gmail.com', 'yahoo.com', 0.0, 'hotmail.com', 'anonymous.com']\").query(\"TransactionAmt < 500\"),\n                   palette=['lightblue', 'darkblue'], ax=ax).set_title('TransactionAmt vs. P_emaildomain', fontsize=16)\n\nplt.show(plot)","fc9c188c":"fig, ax = plt.subplots(figsize=(10, 10))\nplot = sns.countplot(y=\"R_emaildomain\", data=train_df.query(\"R_emaildomain in ['gmail.com', 'yahoo.com', 0.0, 'hotmail.com', 'anonymous.com']\").query(\"TransactionAmt < 500\"),\n                     palette=['red', 'crimson', 'mediumvioletred', 'darkmagenta', 'indigo']).set_title('R_emaildomain', fontsize=16)\nplt.show(plot)","bd2ad0f1":"fig, ax = plt.subplots(figsize=(10, 10))\n\nprops = train_df.query(\"R_emaildomain in ['gmail.com', 'yahoo.com', 0.0, 'hotmail.com', 'anonymous.com']\").query(\"TransactionAmt < 500\")\\\n                .groupby(\"R_emaildomain\")['isFraud'].value_counts(normalize=True).unstack()\n\nsns.set_palette(['pink', 'crimson'])\nprops.plot(kind='bar', stacked='True', ax=ax).set_ylabel('Proportion')\nplt.show(plot)","a6b1ae5e":"fig, ax = plt.subplots(figsize=(15, 15))\n\nplot = sns.violinplot(x=\"R_emaildomain\", y=\"TransactionAmt\", hue=\"isFraud\",\n                      data=train_df.query(\"R_emaildomain in ['gmail.com', 'yahoo.com', 0.0, 'hotmail.com', 'anonymous.com']\").query(\"TransactionAmt < 500\"),\n                      palette=['pink', 'crimson'], split=True, ax=ax).set_title('TransactionAmt vs. R_emaildomain', fontsize=16)\n\nplt.show(plot)","892d39a2":"fig, ax = plt.subplots(figsize=(15, 15))\n\nplot = sns.boxplot(x=\"R_emaildomain\", y=\"TransactionAmt\", hue=\"isFraud\",\n                   data=train_df.query(\"R_emaildomain in ['gmail.com', 'yahoo.com', 0.0, 'hotmail.com', 'anonymous.com']\").query(\"TransactionAmt < 500\"),\n                   palette=['pink', 'crimson'], ax=ax).set_title('TransactionAmt vs. R_emaildomain', fontsize=16)\n\nplt.show(plot)","55c5b335":"fig, ax = plt.subplots(figsize=(10, 10))\nplot = sns.countplot(y=\"card4\", data=train_df.query(\"TransactionAmt < 500\"),\n                     palette=reversed(['orangered', 'darkorange', 'orange', 'peachpuff', 'navajowhite'])).set_title('card4', fontsize=16)\nplt.show(plot)","fc2ced5f":"fig, ax = plt.subplots(figsize=(10, 10))\n\nprops = train_df.query(\"TransactionAmt < 500\")\\\n                .groupby(\"card4\")['isFraud'].value_counts(normalize=True).unstack()\n\nsns.set_palette(['peachpuff', 'darkorange'])\nprops.plot(kind='bar', stacked='True', ax=ax).set_ylabel('Proportion')\nplt.show(plot)","eca52b80":"fig, ax = plt.subplots(figsize=(15, 15))\n\nplot = sns.violinplot(x=\"card4\", y=\"TransactionAmt\", hue=\"isFraud\",\n                      data=train_df.query(\"TransactionAmt < 500\"),\n                      palette=['peachpuff', 'darkorange'], split=True, ax=ax).set_title('TransactionAmt vs. card4', fontsize=16)\n\nplt.show(plot)","a0bdbb42":"fig, ax = plt.subplots(figsize=(15, 15))\n\nplot = sns.boxplot(x=\"card4\", y=\"TransactionAmt\", hue=\"isFraud\",\n                   data=train_df.query(\"TransactionAmt < 500\"),\n                   palette=['peachpuff', 'darkorange'], ax=ax).set_title('TransactionAmt vs. card4', fontsize=16)\n\nplt.show(plot)","813d47a4":"fig, ax = plt.subplots(figsize=(10, 10))\nplot = sns.countplot(y=\"card6\", data=train_df.query(\"TransactionAmt < 500\").query(\"card6 == 'credit' or card6 == 'debit'\"),\n                     palette=reversed(['red', 'crimson', 'mediumvioletred', 'darkmagenta', 'indigo'])).set_title('card6', fontsize=16)\nplt.show(plot)","57fa018f":"fig, ax = plt.subplots(figsize=(10, 10))\n\nprops = train_df.query(\"TransactionAmt < 500\").query(\"card6 == 'credit' or card6 == 'debit'\")\\\n                .groupby(\"card6\")['isFraud'].value_counts(normalize=True).unstack()\n\nsns.set_palette(['plum', 'purple'])\nprops.plot(kind='bar', stacked='True', ax=ax).set_ylabel('Proportion')\nplt.show(plot)","01d8fa7b":"fig, ax = plt.subplots(figsize=(15, 15))\n\nplot = sns.violinplot(x=\"card6\", y=\"TransactionAmt\", hue=\"isFraud\",\n                      data=train_df.query(\"TransactionAmt < 500\"),\n                      palette=['plum', 'purple'], split=True, ax=ax).set_title('TransactionAmt vs. card6', fontsize=16)\n\nplt.show(plot)","7e8a2ab6":"fig, ax = plt.subplots(figsize=(15, 15))\n\nplot = sns.boxplot(x=\"card6\", y=\"TransactionAmt\", hue=\"isFraud\",\n                   data=train_df.query(\"TransactionAmt < 500\"),\n                   palette=['plum', 'purple'], ax=ax).set_title('TransactionAmt vs. card6', fontsize=16)\n\nplt.show(plot)","907575c7":"fig, ax = plt.subplots(figsize=(7.5, 7.5))\n\nprops = train_df.query(\"TransactionAmt < 500\")\\\n                .groupby(\"M1\")['isFraud'].value_counts(normalize=True).unstack()\n\nsns.set_palette(['coral', 'orangered'])\nprops.plot(kind='bar', stacked='True', ax=ax).set_ylabel('Proportion')\nplt.show(plot)","593e268d":"fig, ax = plt.subplots(figsize=(7.5, 7.5))\n\nprops = train_df.query(\"TransactionAmt < 500\").query(\"card6 == 'credit' or card6 == 'debit'\")\\\n                .groupby(\"M2\")['isFraud'].value_counts(normalize=True).unstack()\n\nsns.set_palette(['lightsalmon', 'orangered'])\nprops.plot(kind='bar', stacked='True', ax=ax).set_ylabel('Proportion')\nplt.show(plot)","1be62179":"fig, ax = plt.subplots(figsize=(7.5, 7.5))\n\nprops = train_df.query(\"TransactionAmt < 500\").query(\"card6 == 'credit' or card6 == 'debit'\")\\\n                .groupby(\"M3\")['isFraud'].value_counts(normalize=True).unstack()\n\nsns.set_palette(['peachpuff', 'darkorange'])\nprops.plot(kind='bar', stacked='True', ax=ax).set_ylabel('Proportion')\nplt.show(plot)","42a06c16":"fig, ax = plt.subplots(figsize=(7.5, 7.5))\n\nprops = train_df.query(\"TransactionAmt < 500\").query(\"card6 == 'credit' or card6 == 'debit'\")\\\n                .groupby(\"M4\")['isFraud'].value_counts(normalize=True).unstack()\n\nsns.set_palette(['lemonchiffon', 'gold'])\nprops.plot(kind='bar', stacked='True', ax=ax).set_ylabel('Proportion')\nplt.show(plot)","52b66f39":"fig, ax = plt.subplots(figsize=(7.5, 7.5))\n\nprops = train_df.query(\"TransactionAmt < 500\").query(\"card6 == 'credit' or card6 == 'debit'\")\\\n                .groupby(\"M5\")['isFraud'].value_counts(normalize=True).unstack()\n\nsns.set_palette(['lightgreen', 'green'])\nprops.plot(kind='bar', stacked='True', ax=ax).set_ylabel('Proportion')\nplt.show(plot)","01d4ca10":"fig, ax = plt.subplots(figsize=(7.5, 7.5))\n\nprops = train_df.query(\"TransactionAmt < 500\").query(\"card6 == 'credit' or card6 == 'debit'\")\\\n                .groupby(\"M6\")['isFraud'].value_counts(normalize=True).unstack()\n\nsns.set_palette(['lightblue', 'darkblue'])\nprops.plot(kind='bar', stacked='True', ax=ax).set_ylabel('Proportion')\nplt.show(plot)","e4be9d8b":"fig, ax = plt.subplots(figsize=(7.5, 7.5))\n\nprops = train_df.query(\"TransactionAmt < 500\").query(\"card6 == 'credit' or card6 == 'debit'\")\\\n                .groupby(\"M7\")['isFraud'].value_counts(normalize=True).unstack()\n\nsns.set_palette(['mediumslateblue', 'indigo'])\nprops.plot(kind='bar', stacked='True', ax=ax).set_ylabel('Proportion')\nplt.show(plot)","2c7b1302":"fig, ax = plt.subplots(figsize=(7.5, 7.5))\n\nprops = train_df.query(\"TransactionAmt < 500\").query(\"card6 == 'credit' or card6 == 'debit'\")\\\n                .groupby(\"M8\")['isFraud'].value_counts(normalize=True).unstack()\n\nsns.set_palette(['violet', 'darkviolet'])\nprops.plot(kind='bar', stacked='True', ax=ax).set_ylabel('Proportion')\nplt.show(plot)","eea7332a":"fig, ax = plt.subplots(figsize=(7.5, 7.5))\n\nprops = train_df.query(\"TransactionAmt < 500\").query(\"card6 == 'credit' or card6 == 'debit'\")\\\n                .groupby(\"M9\")['isFraud'].value_counts(normalize=True).unstack()\n\nsns.set_palette(['mediumorchid', 'purple'])\nprops.plot(kind='bar', stacked='True', ax=ax).set_ylabel('Proportion')\nplt.show(plot)","b90aaa2d":"cat_cols = ['id_12', 'id_13', 'id_14', 'id_15',\n            'id_16', 'id_17', 'id_18', 'id_19',\n            'id_20', 'id_21','id_22', 'id_23',\n            'id_24', 'id_25', 'id_26', 'id_27',\n            'id_28', 'id_29', 'id_30', 'id_31',\n            'id_32', 'id_33', 'id_34', 'id_35',\n            'id_36', 'id_37', 'id_38',\n            'DeviceType', 'DeviceInfo', 'ProductCD', \n            'card4', 'card6', 'M4', 'P_emaildomain',\n            'R_emaildomain','card1', 'card2', 'card3', 'card5', 'addr1',\n            'addr2', 'M1', 'M2', 'M3', 'M5', 'M6','M7', 'M8', 'M9', \n            'P_emaildomain_1', 'P_emaildomain_2', 'P_emaildomain_3',\n            'R_emaildomain_1', 'R_emaildomain_2', 'R_emaildomain_3']\n\ncat_cols = [col for col in cat_cols if col in train_df.columns]","0affacde":"def prepare_data(df, cat_cols=cat_cols):\n    cat_cols = [col for col in cat_cols if col in df.columns]\n    for col in tqdm(cat_cols):\\\n        df[col] = pd.factorize(df[col])[0]\n    return df","1e55df9e":"train_data = prepare_data(train_df)\ntest_data = prepare_data(test_df)","f39fbf45":"X = train_data.sort_values('TransactionDT').drop(['isFraud', 'TransactionDT', 'TransactionID'], axis=1)\ny = train_data.sort_values('TransactionDT')['isFraud']\ndel train_data","42f96244":"split = np.int32(0.8 * len(X))\nX_train = X[:split]\ny_train = np.int32(y)[:split]\nX_val = X[split:]\ny_val = np.int32(y)[split:]","ddf453f4":"parameters = {\n    'application': 'binary',\n    'objective': 'binary',\n    'metric': 'auc',\n    'is_unbalance': 'true',\n    'boosting': 'gbdt',\n    'num_leaves': 31,\n    'feature_fraction': 0.5,\n    'bagging_fraction': 0.5,\n    'bagging_freq': 20,\n    'learning_rate': 0.05,\n    'verbose': 0\n}\n\ntrain_data = lightgbm.Dataset(X_train, label=y_train, categorical_feature=cat_cols)\nval_data = lightgbm.Dataset(X_val, label=y_val)\n\nmodel = lightgbm.train(parameters,\n                       train_data,\n                       valid_sets=val_data,\n                       num_boost_round=5000,\n                       early_stopping_rounds=100)","39d305ff":"plt.rcParams[\"axes.titlesize\"] = 16\nplt.rcParams[\"axes.labelsize\"] = 15\nplt.rcParams[\"xtick.labelsize\"] = 13\nplt.rcParams[\"ytick.labelsize\"] = 13\n\nplot = lightgbm.plot_importance(model, max_num_features=10, figsize=(20, 20), grid=False, color=sns.color_palette(\"husl\", 20))\nplt.show(plot)","f0581dca":"def get_neural_network():\n    inputs = Input(shape=(X.shape[1],))\n    dense_1 = Dense(10, activation='relu')(inputs)\n    dense_2 = Dense(10, activation='relu')(dense_1)\n    outputs = Dense(1, activation='sigmoid')(dense_2)\n    \n    model = Model(inputs=inputs, outputs=outputs)\n    model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['acc'])\n    return model","4e2bf982":"model = get_neural_network()\nmodel.summary()","2a5fb498":"SVG(model_to_dot(model).create(prog='dot', format='svg'))","259df4fd":"history = model.fit(x=X_train, y=y_train, validation_data=(X_val, y_val), epochs=5, batch_size=128)","9a7fde2c":"fig, ax = plt.subplots(figsize=(7, 7))\nplt.plot(history.history['acc'], color='blue')\nplt.plot(history.history['val_acc'], color='orangered')\nplt.title('Model accuracy')\nplt.ylabel('Accuracy')\nplt.xlabel('Epoch')\nplt.legend(['Train', 'Validation'], loc='upper left')\nplt.show()","d21e33b2":"fig, ax = plt.subplots(figsize=(7, 7))\nplt.plot(history.history['loss'], color='blue')\nplt.plot(history.history['val_loss'], color='orangered')\nplt.title('Model loss')\nplt.ylabel('Loss')\nplt.xlabel('Epoch')\nplt.legend(['Train', 'Validation'], loc='upper left')\nplt.show()","19b29714":"print(\"Thank you!\")","fbbd0f5c":"In the above violin plots, the light purple sections represent the distribution for non-fraudulent cases and the dark purple sections represent the distribution for fraudulent cases. We can see the same trend as before. Both the distributions types have strong positive (leftward) skews. But, the light purple (non-fraudulent) distributions have a greater probability density concentrated around the lower values of transaction amounts, once again, because they have several peaks (unlike the dark purple distributions).\n\nIn the above violin plot, it can be seen that debit cards cards are associated with lower transaction amounts as compared to credit cards because their distributions have stronger positive (leftward) skew. Also, the credit card distributions have higher means.","c6c578b3":"From the above proportion plot, it can be seen that the most fraudulence prone M9 value is 0.0. This is because all the NaN values were converted to 0s in the beginning. Therefore, an undefined M9 value has the highest chance of being fraudulent. Besides this, a sample with an M9 value of F has a much higher chance of being fraudulent than one with an M9 value of T.","3c07801b":"The same trends and patterns can be seen in the box plots above. Both the distributions types have strong positive (leftward) skews. But, the light blue (non-fraudulent) distributions clearly have lower means as compared to the dark blue (fraudulent) distributions.\n\nThe same exceptions to this trend can also be seen in the above visualization. For example, at *anonymous.com*, the fraudulent distribution has a much lower mean than the non-fraudulent one (counterintuitively). Also, the non-fraudulent and fraudulent distributions are very similar for the *hotmail.com* email domain. Both the distributions have similar means, quartiles, minima, and maxima.","64d3f6f0":"I am not sure about the meanings of these features (M1, M2, and so on till M9), but the competition overview states that these are categorical features.","8365fdd8":"From the above plot, we can clearly see that the most common *P_emaildomain* value is *gmail.com*. The next most common email domain (for payment) is *yahoo.com* and the rest are comparatively very rare. ","566aa6f4":"## P_emaildomain","38dd1f8c":"### Frequencies of the different email domains (R)","27c0b4fe":"### M5","1e235cf0":"### TransactionAmt vs. P_emaildomain Box Plot ","94631d7a":"### Check model summary","c75a12a7":"It can be clearly seen from the above plot that the training and validation accuracies are increasing as the training process proceeds.","ef90169d":"From the above proportion plot, it can be seen that the most fraudulence prone M8 value is 0.0. This is because all the NaN values were converted to 0s in the beginning. Therefore, an undefined M8 value has the highest chance of being fraudulent. Besides this, a sample with an M8 value of T has a very similar chance of being fraudulent to one with an M8 value of F.","8ccc8806":"In the above violin plots, the light orange sections represent the distribution for non-fraudulent cases and the dark orange sections represent the distribution for fraudulent cases. We can see the same trend as before. Both the distributions types have strong positive (leftward) skews. But, the light orange (non-fraudulent) distributions have a greater probability density concentrated around the lower values of transaction amounts, once again, because they have several peaks (unlike the dark orange distributions).\n\nThere do not seem to be any exceptions to this trend. The distributions for *american express* and *discover* cards seem to have higher means as compared to the other two card types. Therefore, more expensive transactions tend to take place through *american express* and *discover* cards.","b7921078":"### Fraudulence Proportion Plot","536fd710":"**This trained model can be used to make predictions on the training data using:**\n\n> model.predict(X_test)","245ced16":"### M4","559f5d39":"### TransactionAmt vs. card4 Violin Plot ","04b23b92":"The card4 feature represents the brand of the card through which the transaction was made. The card brands in this dataset are *discover, mastercard, visa,* and *american express*.","93b81546":"### Fraudulence Proportion Plots of \"M\" features","78a9cdce":"This is a simple neural network model that consists of two hidden layers with 10 neurons each. The activation function used is ReLU and the activation function for the last layer is sigmoid because a probability between 0 and 1 needs to given as output.\n\n**Steps:**\n\n* Pass the input vector through a dense layer with 10 neurons\n* Pass the output of that layer through another dense layer with 10 neurons\n* Finally, pass the output of the previous layer through a dense layer with one neuron with a sigmoid activation function (to output a probability between 0 and 1)","dd06849a":"In the box plot above, we can say that, for *mastercard* and *visa* cards, the fraudulent and non-fraudulent distributions are very similar. They have very similar means. It is also clear in this box plot, that *discover* and *american express* cards tend to be associated with higher transaction amounts. This can be inferred from the fact that they have much higher means as compared to the other two card brands.","4c3605c3":"### Frequencies of the different card brands","731e03a5":"### Distribution of transaction amounts for non-fraudelent and fraudulent cases","b0b7e472":"## Transaction Amounts\n\nAs the name suggests, this is the amount of money transferred during the transaction, and this is clearly a continuous variable. I will visualize this feature in relation with the target, *isFraud*.\n\n","b60a5c30":"From the above proportion plot, it can be seen that the most fraudulence prone M5 value is 0.0. This is because all the NaN values were converted to 0s in the beginning. Therefore, an undefined M5 value has the highest chance of being fraudulent. Besides this, a sample with an M5 value of T has a much higher chance of being fraudulent than one with an M5 value of F.","6c2a273e":"## LightGBM","bd08ffc8":"## \"M\" Features","a9cee50c":"The above diagram ranks the features based on importance. The features given the most weightage during prediction are considered more \"important\". The features at the top are the most important and the ones at the bottom are the least important for this LightGBM model.","6875ca5a":"I am not sure what Product CD exactly means, but it seems to be a categorical variable that provides some information regarding the category of a product. **Products in this dataset come under five broad categories: W, H, C, S, and R.** I will visualize this feature in relation with the target, *isFraud*.","031e70c6":"In the box plot above, we can see that credit cards are associated with much higher mean transaction amounts as compared to debit cards. ","98d7730d":"In the above proportion plot, the height of the dark purple bar (at the top) represents the probability of a transaction received through a given card type being fraudulent. We can see that a given *credit* card is more likely involved in a fraudulent transaction as compared to a given *debit card*.","83baa1ef":"### Violin Plot","ac797a95":"### Load the train and test datasets","b390ab12":"### Fraudulence Proportion Plot","f27a2503":"<center><img src=\"https:\/\/i.imgur.com\/K3FE0NA.jpg\" width=\"500px\"><\/center>","01872e93":"## R_emaildomain","01e915fb":"# Modeling","5b5cfed1":"### Convert categorical string data into numerical format","6e019545":"### Box Plot","fbf8bf04":"### M3","81e3316b":"## Neural Networks","19759a19":"### M9","d4dce2ad":"### M6","f5cbd9b3":"### TransactionAmt vs. card6 Violin Plot","adbe8f8a":"## Preparing the training and testing data","93f43715":"### Distributions of transaction amounts for different *ProductCD* values (for non-fraudulent and fraudulent cases)","953ebe6f":"### TransactionAmt vs. R_emaildomain  Violin Plot","65038856":"### Fraudulence Proportion Plot","676cecd7":"In the above proportion plot, the height of the dark blue bar (at the top) represents the probability of a transaction made through a given email domain being fraudulent. We can see that an email domain of *hotmail.com* is associated with the highest probability of a fraudulent transaction. The next most fraudulence-prone email domain is *gmail.com*. And, the least fraudulence-prone email domain is *yahoo.com*.  ","1e6af7ab":"### M2","b524115f":"### Frequencies of the different email domains (P)","d7b46748":"### Define the paths for the train and test data","d73a4f97":"### Define the categorical columns","96b5e36b":"From the above proportion plot, it can be seen that the most fraudulence prone M7 value is 0.0. This is because all the NaN values were converted to 0s in the beginning. Therefore, an undefined M7 value has the highest chance of being fraudulent. Besides this, a sample with an M7 value of F has a very similar chance of being fraudulent to one with an M7 value of T.","e0452480":"### Visualize change in loss","9561ddb9":"In the above violin plots, the light blue sections represent the distribution for non-fraudulent cases and the dark blue sections represent the distribution for fraudulent cases. We can see the same trend as before. Both the distributions types have strong positive (leftward) skews. But, the light blue (non-fraudulent) distributions have a greater probability density concentrated around the lower values of transaction amounts, once again, because there are several peaks (unlike the dark blue distributions).\n\nThere are no real exceptions to this trend except for *hotmail.com*. The distributions for transaction amount (for fraudulent and non-fraudulent cases) are very similar at *hotmail.com*. The other domains, namely, *gmail.com, yahoo.com, and anonymous.com* follow the general trend.\n\nEach email domain's distributions are roughly concentrated around the same mean, but with differing variances. No single email domain has a much greater or lower mean than the other email domains.\n\n**Interestingly, once again, the most fraudulence-prone email domain, namely, *hotmail.com* is also the one that does not follow the trend. This is similar to the *C* product category, which was the most fraudulent category and was also the category that did not follow the trend.** \n \n\nMaybe, one can create a model that changes the weightage of the *TransactionAmt* feature based on the email domain. For example, the weightage of the *TransactionAmt* feature can be reduced for the *hotmail.com* email domain, because the fraudulent and non-fraudulent distributions are very similar for this email domain. ","85c26f84":"## Preparing the ground for analysis","4301a2d2":"In the violin plot above, the green violin is the distribution of transaction amounts for non-fraudulent samples and the red violin is that for fraudulent samples. It can be seen that both distributions have a strong positive (leftward) skew. But, the red violin has greater probability density towards the higher values of *TransactionAmt* as compared to the green distribution. \n\nThe green distribution has a very high probability denisty concentrated around the lower values of *TransactionAmt* and as a result, the probability density around the higher values of *TransactionAmt* is almost negligible. But, the red violin on the other hand, has lesser probability density concentrated around the lower values of *TransactionAmt* and thus, there is a considerable probability density around the higher values of *TransactionAmt*.\n\nThis happens because the green violin has multiple peaks (multimodal characteristic) around the lower values of *TransactionAmt*, whereas the red violin has only one clear peak in this region. This presence of only one peak in the red violin indicates that it has a much milder skew than the green violin. **Therefore, in general, the greater the transaction amount, the more likely it is for the transaction to be fraudulent.**\n\nThis makes intuitive sense, because very expensive transactions have a greater chance of being fraudulent than less expensive transactions.\n\n\n","4b46da77":"From the above proportion plot, it can be seen that the most fraudulence prone M2 value is 0.0. This is because all the NaN values were converted to 0s in the beginning. Therefore, an undefined M2 value has the highest chance of being fraudulent. Besides this, a sample with an M2 value of F has a much higher chance of being fraudulent than one with an M2 value of T.","6cce0d42":"From the above proportion plot, it can be seen that the most fraudulence prone M3 value is 0.0. This is because all the NaN values were converted to 0s in the beginning. Therefore, an undefined M3 value has the highest chance of being fraudulent. Besides this, a sample with an M3 value of F has a much higher chance of being fraudulent than one with an M3 value of T.","e87edf56":"The two most common card types in this dataset are credit and debit (the rest are comparatively negligible). Debit cards are more common than credit cards in this dataset.","d87f45fe":"### Visualize feature importances","a0ddfefd":"## Card type (card6)","da708851":"### M1","c44c2ca6":"### Frequencies of the different card types","fa87095f":"In the above violin plots, the pink sections represent the distribution for non-fraudulent cases and the red sections represent the distribution for fraudulent cases. We can see the same trend as before. Both the distributions types have strong positive (leftward) skews. But, the pink (non-fraudulent) distributions have a greater probability density concentrated around the lower values of transaction amounts, once again, because there are several peaks (unlike the red distributions).\n\nThe exception to this trend is *anonymous.com*. The distributions for transaction amount (at *anonymous.com*) is much more skewed in the fraudulent case as compared to the non-fraudulent case. The other domains, namely, *gmail.com, yahoo.com, and hotmail.com* follow the general trend.\n\nEach email domain's distributions are roughly concentrated around the same mean, but with differing variances. No single email domain has a much greater or lower mean than the other email domains.\n\nMaybe, one can create a model that changes the weightage of the *TransactionAmt* feature based on the email domain. For example, the weightage of the *TransactionAmt* feature can be reduced for the *hotmail.com* email domain, because the fraudulent and non-fraudulent distributions are very similar for this email domain. ","c0c5a7bf":"From the above proportion plot, it can be seen that the most fraudulence prone M1 value is 0.0. This is because all the NaN values were converted to 0s in the beginning. Therefore, an undefined M1 value has the highest chance of being fraudulent. Besides this, a sample with an M1 value of T has a much higher chance of being fraudulent than one with an M1 value of F.","35c5f37b":"### Replace the NaNs with 0s and check the first few rows","b7867411":"### Build and train LightGBM model","b422a21a":"The *R_emaildomain* represents the email domain through which the transaction was **received**. The most common domains are *gmail.com, yahoo.com, hotmail.com, and anonymous.com*. ","401f61c8":"## Introduction\n\nThe aim of this competition is to predict whether a given transaction is fraudelent or not based on the information given regarding the transaction. Information such as the transaction amount, card type, product category, etc is given.\n\nIn this kernel, I will be visualizing and exploring these features in-depth using **seaborn**. I will attempt to make inferences and conlusions based on these graphs and plots.\n\nThen, I will demonstrate how to build models to solve this problem. Specifically, I will be using LightGBM and Neural Network models. I will train these models on the training data, and then finally, I will show how to make predictions on the test data using these trained models.","e2b98961":"The card6 feature represents the btype of the card through which the transaction was made. The major card types in this dataset are *credit* and *debit*.","90cf2a45":"In the above proportion plot, the height of the dark green bar (at the top) represents the probability of a transaction involving a given product category being fraudulent. We can see that a product of category *C* is more likely to be involved in a fraudulent transaction as compared to any other product category. The next most fraudulence-prone product category is category *S*, and so on.\n\n","dd4d9e8e":"The same trends and patterns can be seen in the box plots above. Both the distributions types have strong positive (leftward) skews. But, the light green (non-fraudulent) distributions clearly have lower means as compared to the dark green (fraudulent) distributions.\n\nThe same exceptions to this trend can also be seen in the above visualization. For example, the non-fraudulent and fraudulent distributions are very similar for the *C* product category. Both the distributions have similar means, first quartiles, and third quartiles.","fe9efed7":"### Visualize the model architecture","53e9f585":"### Frequencies of the different product categories ","40d0db1d":"### Check the files available in the dataset","d189d402":"## Card brand (card4)","97785083":"### Visualize change in accuracy","151dd6da":"It can be clearly seen from the above plot that the training and validation losses (binary cross-entropy) are decreasing as the training process proceeds.","2200d547":"From the above proportion plot, it can be seen that a that a sample with an M4 value of M2 has a much higher chance of being fraudulent than one with an M4 value of M0. Also, a sample with an M4 value of M0 has a higher chance of being fraudulent than one with an M4 value of M1. An M4 value of 0.0 (or NaN) has the lowest chance of being fraudulent.","88b56b0e":"In the above proportion plot, the height of the dark red bar (at the top) represents the probability of a transaction received through a given email domain being fraudulent. We can see that an email domain of *gmail.com* is associated with the highest probability of a fraudulent transaction. The next most fraudulence-prone email domain is *hotmail.com*. And, the least fraudulence-prone email domain is *anonymous.com*.","c834c727":"From the above plot, we can clearly see that the most common *ProductCD* value is W. The other four product categories, H, C, S, and R are very rare compared to W. ","435f651b":"## Product CD","1b7c5fe3":"In the above proportion plot, the height of the dark orange bar (at the top) represents the probability of a transaction received through a given card brand being fraudulent. We can see that *discover* cards are associated with the highest probability of a fraudulent transaction. The remaining card brands have a very similar fraudelence proportion.","b07f85cd":"# Ending note","e9a73ece":"In the above violin plots, the light green sections represent the distribution for non-fraudulent cases and the dark green sections represent the distribution for fraudulent cases. We can see the same trend as before. Both the distributions types have strong positive (leftward) skews. But, the light green (non-fraudulent) distributions have a greater probability density concentrated around the lower values of transaction amounts, once again, because there are several peaks (unlike the dark green distributions).\n\nBut, there are a few exceptions to this trend in the above visualization. For example, the non-fraudulent and fraudulent distributions are very similar for the *C* product category. Both the distributions have only one peak and they look very similar in almost every way. Interestingly, the *C* product category also has the highest fraudulence rate, and this is probably the reason why the correlation between the transaction amount and the target is very low for this category.\n\nBut, for the rest of the product categories, the trend is roughly followed.\n\nThe distributions for the *S* product category seem to have the lowest means and the strongest skews. These distributions have a very high concentration of probability density around the lower values of *TransactionAmt*. Transactions of type *S* tend to have low transaction amounts. On the other side of the spectrum, the distributions for the *R* product category seem to have the highest means and the weakest skews. These distributions have a very even spread and almost no skew. Transactions of type *R* tend to have high transaction amounts.\n\nMaybe, one can create a model that changes the weightage of the *TransactionAmt* feature based on the product category. For example, the weightage of the *TransactionAmt* feature can be reduced for the *C* product category, because the fraudulent and non-fraudulent distributions are very similar for this product category. ","ff0c43dc":"### Build Neural Network model","7b346bd4":"This concludes my EDA and modeling kernel. I hope that this kernel was helpful for you to understand the data better. Please post any feedback or comments regarding this kernel below in the comments section.\n\n**Thanks for reading this kernel and please don't forget to upvote if you liked it :)**\n\n","e36104b9":"From the above proportion plot, it can be seen that the most fraudulence prone M6 value is 0.0. This is because all the NaN values were converted to 0s in the beginning. Therefore, an undefined M6 value has the highest chance of being fraudulent. Besides this, a sample with an M6 value of F has a much higher chance of being fraudulent than one with an M6 value of T.","8d8f4026":"The box plot above also suggests that more expensive transactions are more likely to be fraudulent. This can be inferred from the fact that the mean value of the red box is greater than that of the green box. Although the first quartiles of the two distributions are very similar, the third quartile of the red box is significantly greater than that of the green box, providing further evidence that higher transaction amounts are more likely to be fraudulent than not, *i.e.* **the greater the transaction amount, the more likely it is for the transaction to be fraudulent.** ","a0484aa6":"### TransactionAmt vs. P_emaildomain Violin Plot","65df2b7a":"### Create final train and validation arrays","799a4816":"From the above plot, we can clearly see that the most common *R_emaildomain* value is *gmail.com*. The next most common email domain is *hotmail.com*. The least common receiver email domain is *yahoo.com*.","53a5eb33":"The same trends and patterns can be seen in the box plots above. Both the distributions types have strong positive (leftward) skews. But, the light blue (non-fraudulent) distributions clearly have lower means as compared to the dark blue (fraudulent) distributions.\n\nThe same exceptions to this trend can also be seen in the above visualization. For example, the non-fraudulent and fraudulent distributions are very similar for the *hotmail.com* email domain. Both the distributions have similar means and first quartiles. Although the third quartiles for the *anonymous.com* distributions are very similar, their means are very different.","cd6871f3":"### M7","a36bacf0":"### M8","2945e38a":"### Train the Neural Network","fed4cb9b":"<font size=3 color='red'>Please upvote this kernel if you like it :)<\/font>","fb2aaf07":"### Import necessary libraries","dfdbe51b":"The *P_emaildomain* represents the email domain through which the transaction was **payed**. The most common domains are *gmail.com, yahoo.com, hotmail.com, and anonymous.com*.","53d66d2d":"**This trained model can be used to make predictions on the training data using:**\n\n> model.predict(X_test)","1975f02d":"### TransactionAmt vs. card4 Box Plot ","4a412c8c":"### TransactionAmt vs. card6 Box Plot","4cdfe5ed":"### TransactionAmt vs. R_emaildomain  Box Plot","95b67505":"### Fraudulence Proportion Plot","60f7eb5a":"From the above plot, it is clear that the most common card brand used for transactions is *visa*. The second most common card brand is *mastercard*. The remaining two card brands, namely, *discover* and *american express* are very rare (comparatively).","2bb2d825":"# EDA"}}