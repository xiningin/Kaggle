{"cell_type":{"281fa50e":"code","f4ccd15f":"code","bf85865c":"code","580711ab":"code","e4bede06":"code","a018251b":"code","98ba29a2":"code","7ef7806a":"code","3a3c8117":"code","a4a1c1e5":"code","1cfde875":"code","122c8c0e":"code","563913a3":"code","08890178":"code","5f83e7c7":"code","7f3c0b09":"code","43d3db8a":"code","ac2276d9":"code","b35144fc":"code","0d86c484":"code","fc951832":"code","7b4e0cb4":"code","e997219b":"code","294bbb8b":"code","e5b3fd51":"code","91258fac":"code","204aec1c":"code","1062c65e":"code","060a5496":"code","5f487b16":"code","6ee0bc3d":"code","9d7090f4":"code","75c23ad3":"code","5f42fc9e":"code","b0e4ff3b":"code","2c56be61":"code","008a836d":"code","efde06c2":"code","30aba56e":"code","2971dd37":"code","0d3a6f72":"code","4343240a":"code","d60361f8":"code","6f039083":"code","2cb8e6bd":"markdown","aba61dbc":"markdown","28b69e5e":"markdown","a9ead5d5":"markdown","776d51bd":"markdown","4476cbd2":"markdown","1a2d0ae0":"markdown","ec210837":"markdown","ee8a82c4":"markdown","a48207f3":"markdown","44e23c38":"markdown","a13bd7a7":"markdown","626102c2":"markdown","df94f459":"markdown","ad456bb6":"markdown","38f25b6b":"markdown","83297ca4":"markdown","496d802b":"markdown","05625e33":"markdown","ec0b14f9":"markdown","543afd5b":"markdown","5295f84c":"markdown","7ef2d9bd":"markdown","51b7170c":"markdown","73c35cc4":"markdown","e77d652a":"markdown","75014c84":"markdown","21120e46":"markdown","0c2c7509":"markdown","af98662d":"markdown","3ecf8b18":"markdown","0bc8f70e":"markdown","4a98b600":"markdown","0b9e30a7":"markdown","d19db846":"markdown","b501a584":"markdown","8abbc25a":"markdown","35628f03":"markdown","6a2f1b15":"markdown","d4de35d2":"markdown","2715e7af":"markdown","fed69f70":"markdown","974fe3dd":"markdown","9a338c2e":"markdown","63a74095":"markdown","fd156321":"markdown","67510f67":"markdown","ab3360a7":"markdown","f2051203":"markdown","2d820668":"markdown","34c10bee":"markdown","b3808cb2":"markdown","207d332f":"markdown","c66a67db":"markdown","063d5583":"markdown"},"source":{"281fa50e":"import pandas as pd\n\n\n#Dados internacionais\nc=pd.read_csv('..\/input\/cpia-local-de-datahubs-covid19-dataset\/time-series-19-covid-combined.csv')\ndf_sumario_w = c.groupby(['Date','Country\/Region'],as_index = False)['Confirmed','Deaths'].sum().pivot('Date','Country\/Region').fillna(0)\ndf_conf_w = df_sumario_w[\"Confirmed\"]\ndf_deaths_w = df_sumario_w[\"Deaths\"]\n\n#Dados Popula\u00e7\u00e3o Internacionais\npopw = pd.read_excel('..\/input\/cpia-local-de-covid19-ecdc-dataset\/COVID-19-geographic-disbtribution-world.xlsx')\npopw[\"countriesAndTerritories\"] = popw[\"countriesAndTerritories\"].str.replace(\"United_States_of_America\", \"US\", case = False)\npopw['countriesAndTerritories'] = popw['countriesAndTerritories'].str.replace(\"_\",\" \")\npop = popw.groupby('countriesAndTerritories', as_index=False).max()[['countriesAndTerritories','popData2018']]\npop.rename(columns={'countriesAndTerritories':'local', 'popData2018':'pop'}, inplace=True);\n\n# Dados Nacionais\ndf = pd.read_csv('..\/input\/corona-virus-brazil\/brazil_covid19.csv')\ndfe = df.drop(['region'], axis=1) #\ndfe_sumario = dfe.groupby(['date','state'],as_index = False)['cases','deaths'].sum().pivot('date','state').fillna(0)\ndfe_conf = dfe_sumario[\"cases\"]\ndfe_deaths = dfe_sumario[\"deaths\"]","f4ccd15f":"# Por dia\ndef acum2pd(df_conf):\n    \n    df_conf_pd = df_conf.copy()\n\n    for col in df_conf.columns:\n        for i,x in enumerate(df_conf_pd[col]):\n            if i != 0:\n                pdia = df_conf[col][i]-df_conf[col][i-1]\n                if pdia < 0:\n                    df_conf_pd[col][i] = 0\n                    df_conf[col][i] = df_conf[col][i-1]\n                else:\n                    df_conf_pd[col][i] = pdia\n    return df_conf_pd","bf85865c":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nfrom scipy.optimize import curve_fit\n\ndef sigm_predict(y, future_days, boundary):\n    def avg_err(pcov):\n        return np.round(np.sqrt(np.diag(pcov)).mean(), 2)\n    # function to be minimized\n    def f_sigmoid(x, a, b, c):\n        # a = sigmoid midpoint\n        # b = curve steepness (logistic growth)\n        # c = max value\n        return (c \/ (1 + np.exp(-b*(x-a))))\n  \n    x = np.arange(len(y))\n    \n    # fitting the data on the logistic function\n    #boundary = ([-np.inf, -np.inf, -np.inf],[np.inf, np.inf, np.inf])\n    #boundary = ([0., 0.001, y.max()],[90., 2.5, 100*y.max()])\n    popt_sig, pcov_sig = curve_fit(f_sigmoid, x[:-1], y[:-1], method='trf',bounds=boundary)#,sigma = np.linspace(0.5, 0.05, len(y)),absolute_sigma=True)#dogbox, sigma = np.linspace(0.5, 0.05, len(y)),absolute_sigma=False\n    peakday = len(y) + int(popt_sig[0])\n     \n    x_m = np.arange(len(y)+future_days)\n    y_m = f_sigmoid(x_m, *popt_sig)    \n    \n    return x_m, y_m, avg_err(pcov_sig), popt_sig","580711ab":"df_conf_w.tail()","e4bede06":"df_deaths_w.tail()","a018251b":"plt.figure(figsize=(16,8))\nax = plt.subplot(1,2,1)\nax.set_title('Casos Acumulados', fontsize=18, loc='left')\nplt.plot(df_conf_w['Germany'], label='Germany')\nplt.plot(df_conf_w['Italy'], label='Italy')\nplt.plot(df_conf_w['Brazil'], label='Brazil')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"Casos\")\nplt.legend();\nax = plt.subplot(1,2,2)\nax.set_title('\u00d3bitos Acumulados', fontsize=18, loc='left')\nplt.plot(df_deaths_w['Germany'], label='Germany')\nplt.plot(df_deaths_w['Italy'], label='Italy')\nplt.plot(df_deaths_w['Brazil'], label='Brazil')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"\u00d3bitos\")\nplt.legend();","98ba29a2":"df_conf_pd = acum2pd(df_conf_w)\ndf_deaths_pd = acum2pd(df_deaths_w)","7ef7806a":"plt.figure(figsize=(16,8))\nax = plt.subplot(1,2,1)\nax.set_title('Casos por Dia', fontsize=18, loc='left')\nplt.plot(df_conf_pd['Germany'], label='Germany')\nplt.plot(df_conf_pd['Italy'], label='Italy')\nplt.plot(df_conf_pd['Brazil'], label='Brazil')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"Casos\")\nplt.legend();\nax = plt.subplot(1,2,2)\nax.set_title('\u00d3bitos por Dia', fontsize=18, loc='left')\nplt.plot(df_deaths_pd['Germany'], label='Germany')\nplt.plot(df_deaths_pd['Italy'], label='Italy')\nplt.plot(df_deaths_pd['Brazil'], label='Brazil')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"\u00d3bitos\")\nplt.legend();","3a3c8117":"dfe_conf_pd = acum2pd(dfe_conf)\ndfe_deaths_pd = acum2pd(dfe_deaths)","a4a1c1e5":"## Graficos Estados do Brasil\nplt.figure(figsize=(16,8))\nax = plt.subplot(1,2,1)\nax.set_title('Casos por Dia', fontsize=18, loc='left')\nplt.plot(dfe_conf_pd['S\u00e3o Paulo'], label='SP')\nplt.plot(dfe_conf_pd['Amazonas'], label='AM')\nplt.plot(dfe_conf_pd['Santa Catarina'], label='SC')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"Casos\")\nplt.legend();\nax = plt.subplot(1,2,2)\nax.set_title('\u00d3bitos por Dia', fontsize=18, loc='left')\nplt.plot(dfe_deaths_pd['S\u00e3o Paulo'], label='SP')\nplt.plot(dfe_deaths_pd['Amazonas'], label='AM')\nplt.plot(dfe_deaths_pd['Santa Catarina'], label='SC')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"\u00d3bitos\")\nplt.legend();","1cfde875":"br = dfe_conf['Amazonas'][:75]\nbr1 = br.copy()\nbr1[-1] = br1[-2] + br1[-2] - br1[-3]","122c8c0e":"plt.figure(figsize=(16,8))\nax = plt.subplot(1,2,1)\nax.set_title('Casos Acumulados', fontsize=18, loc='left')\nplt.plot(br, 'b', label='AM')\nplt.plot(br1, 'r', label='Prev')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"Casos\")\nplt.legend();\nax = plt.subplot(1,2,2)\nax.set_title('Casos por Dia', fontsize=18, loc='left')\nplt.plot(np.diff(br), 'b', label='AM')\nplt.plot(np.diff(br1), 'r', label='Prev')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"Casos\")\nplt.legend();","563913a3":"#Lib scikit-learn\nfrom sklearn.linear_model import LinearRegression\nimport numpy as np\n\n#A partir do 100o caso\ncasos_br = df_conf_pd['Brazil'][df_conf_pd[df_conf_pd['Brazil'] > 100].index[0]:].values\n#Dividindo os dados do passado e os a serem previstos\ncasos_br_treino = casos_br[:-5]\ncasos_br_teste = casos_br[-5:]\n#Instanciando o modelo\nmodel = LinearRegression()\n#Botando no formato do fit\nX = np.expand_dims(np.linspace(0,len(casos_br_treino), len(casos_br_treino)), axis=1)\ny = np.expand_dims(casos_br_treino, axis=1)\n#Fazendo o treino\nmodel.fit(X,y)\n#Prevendo com dias \u00e0 frente\ncasos_br_prev = model.predict(np.expand_dims(np.linspace(0, len(casos_br_treino)+5,len(casos_br)), axis=1))","08890178":"plt.figure(figsize=(12,8))\nplt.plot(np.linspace(0,len(casos_br_treino), len(casos_br_treino)), casos_br_treino, 'b', label='Passado')\nplt.plot(np.linspace(len(casos_br_treino), len(casos_br_treino)+5, 5), casos_br_teste, 'g', label = 'Futuro')\nplt.plot(np.linspace(0, len(casos_br_prev), len(casos_br_prev)), casos_br_prev, 'r', label = 'Previs\u00e3o')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"Casos\")\nplt.legend();","5f83e7c7":"from sklearn.preprocessing import PolynomialFeatures \n\n# Instanciando Modelo  \npoly = PolynomialFeatures(degree = 4) \nX_poly = poly.fit_transform(X) \n# Treino  \npoly.fit(X_poly, y) \nlin2 = LinearRegression() \nlin2.fit(X_poly, y)\n# Predi\u00e7\u00e3o\ncasos_br_prev_poli = lin2.predict(poly.fit_transform(np.expand_dims(np.linspace(0, len(casos_br_treino)+5,len(casos_br)), axis=1)))","7f3c0b09":"plt.figure(figsize=(12,8))\nplt.plot(np.linspace(0,len(casos_br_treino), len(casos_br_treino)), casos_br_treino, 'b', label='Passado')\nplt.plot(np.linspace(len(casos_br_treino), len(casos_br_treino)+5, 5), casos_br_teste, 'g', label = 'Futuro')\nplt.plot(np.linspace(0, len(casos_br_prev), len(casos_br_prev)), casos_br_prev_poli, 'r', label = 'Previs\u00e3o')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"Casos\")\nplt.legend();","43d3db8a":"from pandas.plotting import autocorrelation_plot\n\nax = plt.figure(figsize=(12,6))\nax.suptitle(\"Autocorrela\u00e7\u00e3o\")\nautocorrelation_plot(casos_br_treino)\nax=ax","ac2276d9":"from statsmodels.tsa.seasonal import seasonal_decompose\nfrom pylab import rcParams\n\nrcParams['figure.figsize'] = 11, 9\n\ndec = seasonal_decompose(casos_br_treino, freq=7)\ndec.plot();\n","b35144fc":"!pip install pmdarima","0d86c484":"from pmdarima import auto_arima\n\n# Instancia modelo j\u00e1 com os melhores par\u00e2metros buscados automaticamente\nm_sarima = auto_arima(casos_br_treino,\n                     start_p=0, start_q=0, max_p=10, max_q=10,\n                     d=1, m=7, seasonal = True,\n                     D=1, start_Q=1, start_P=1, max_P=4, max_Q=4,\n                     trace=True,\n                     error_action='ignore', suppress_warnings=True,\n                     stepwise=False)","fc951832":"#Treino\nm_sarima.fit(casos_br_treino)\n#Predi\u00e7\u00e3o\nfitted = m_sarima.predict_in_sample(start=1, end=len(casos_br_treino))\ncasos_br_prev_sarima = m_sarima.predict(n_periods=len(casos_br_teste))","7b4e0cb4":"plt.figure(figsize=(12,8))\nplt.plot(np.linspace(0,len(casos_br_treino), len(casos_br_treino)), casos_br_treino, 'b', label='Passado')\nplt.plot(np.linspace(0,len(casos_br_treino), len(casos_br_treino)), fitted, 'r')\nplt.plot(np.linspace(len(casos_br_treino), len(casos_br_treino)+5, 5), casos_br_teste, 'g', label='Futuro')\nplt.plot(np.linspace(len(casos_br_treino), len(casos_br_treino)+5, 5), casos_br_prev_sarima, 'r', label='Previs\u00e3o')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"Casos\")\nplt.legend()","e997219b":"#A partir do 10o caso\ncasos_al = df_conf_pd['Germany'][df_conf_pd[df_conf_pd['Germany'] > 10].index[0]:].values\nplt.plot(casos_al);","294bbb8b":"#Dividindo os dados do passado e os a serem previstos\ncasos_al_treino = casos_al[:25]\ncasos_al_teste = casos_al[25:]\n\nnum_proj = 10\n# Regress\u00e3o Linear\nmodel = LinearRegression()\nX = np.expand_dims(np.linspace(0,len(casos_al_treino), len(casos_al_treino)), axis=1)\ny = np.expand_dims(casos_al_treino, axis=1)\nmodel.fit(X,y)\ncasos_al_prev = model.predict(np.expand_dims(np.linspace(0,len(casos_al_treino)+num_proj,len(casos_al_treino)+num_proj), axis=1))\n\n#Regress\u00e3o Polinimial\npoly = PolynomialFeatures(degree = 3) \nX_poly = poly.fit_transform(X) \npoly.fit(X_poly, y) \nlin2 = LinearRegression() \nlin2.fit(X_poly, y)\ncasos_al_prev_poli = lin2.predict(poly.fit_transform(np.expand_dims(np.linspace(0, len(casos_al_treino)+num_proj,len(casos_al_treino)+num_proj), axis=1)))\n\n#SARIMA\nm_sarima = auto_arima(casos_al_treino,\n                     start_p=0, start_q=0, max_p=10, max_q=10,\n                     d=1, m=7, seasonal = True,\n                     D=1, start_Q=1, start_P=1, max_P=4, max_Q=4,\n                     trace=True,\n                     error_action='ignore', suppress_warnings=True,\n                     stepwise=False)\nsafit = m_sarima.fit(casos_al_treino)\nfitted = m_sarima.predict_in_sample(start=1, end=len(casos_al_treino))\ncasos_al_prev_sarima = m_sarima.predict(n_periods=num_proj)","e5b3fd51":"plt.figure(figsize=(10,4))\n#plt.plot(np.linspace(0,len(casos_al), len(casos_al)), casos_al, 'b', label='Real')\nplt.plot(np.linspace(0,len(casos_al_treino), len(casos_al_treino)), casos_al_treino, 'b', label='Passado')\nplt.plot(np.linspace(len(casos_al_treino), len(casos_al), len(casos_al)-len(casos_al_treino)), casos_al[len(casos_al_treino):], 'g', label='Futuro')\nplt.plot(np.linspace(0,len(casos_al_treino)+num_proj, len(casos_al_treino)+num_proj), casos_al_prev, 'r', label='Linear')\nplt.plot(np.linspace(0,len(casos_al_treino)+num_proj, len(casos_al_treino)+num_proj), casos_al_prev_poli, 'y', label='Poli')\nplt.plot(np.linspace(len(casos_al_treino), len(casos_al_treino)+num_proj, num_proj), casos_al_prev_sarima[:], 'c', label='SARIMA')\nplt.plot(np.linspace(0,len(casos_al_treino), len(casos_al_treino)), fitted, 'c')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"Casos\")\nplt.legend();","91258fac":"#Dividindo os dados do passado e os a serem previstos\ncasos_al_treino = casos_al[:30]\ncasos_al_teste = casos_al[30:]\n\nnum_proj = 10\n# Regress\u00e3o Linear\nmodel = LinearRegression()\nX = np.expand_dims(np.linspace(0,len(casos_al_treino), len(casos_al_treino)), axis=1)\ny = np.expand_dims(casos_al_treino, axis=1)\nmodel.fit(X,y)\ncasos_al_prev = model.predict(np.expand_dims(np.linspace(0,len(casos_al_treino)+num_proj,len(casos_al_treino)+num_proj), axis=1))\n\n#Regress\u00e3o Polinimial\npoly = PolynomialFeatures(degree = 3) \nX_poly = poly.fit_transform(X) \npoly.fit(X_poly, y) \nlin2 = LinearRegression() \nlin2.fit(X_poly, y)\ncasos_al_prev_poli = lin2.predict(poly.fit_transform(np.expand_dims(np.linspace(0, len(casos_al_treino)+num_proj,len(casos_al_treino)+num_proj), axis=1)))\n\n#SARIMA\nm_sarima = auto_arima(casos_al_treino,\n                     start_p=0, start_q=0, max_p=10, max_q=10,\n                     d=1, m=7, seasonal = True,\n                     D=1, start_Q=1, start_P=1, max_P=4, max_Q=4,\n                     trace=True,\n                     error_action='ignore', suppress_warnings=True,\n                     stepwise=False)\nsafit = m_sarima.fit(casos_al_treino)\nfitted = m_sarima.predict_in_sample(start=1, end=len(casos_al_treino))\ncasos_al_prev_sarima = m_sarima.predict(n_periods=num_proj)","204aec1c":"plt.figure(figsize=(10,4))\n#plt.plot(np.linspace(0,len(casos_al), len(casos_al)), casos_al, 'b', label='Real')\nplt.plot(np.linspace(0,len(casos_al_treino), len(casos_al_treino)), casos_al_treino, 'b', label='Passado')\nplt.plot(np.linspace(len(casos_al_treino), len(casos_al), len(casos_al)-len(casos_al_treino)), casos_al[len(casos_al_treino):], 'g', label='Futuro')\nplt.plot(np.linspace(0,len(casos_al_treino)+num_proj, len(casos_al_treino)+num_proj), casos_al_prev, 'r', label='Linear')\nplt.plot(np.linspace(0,len(casos_al_treino)+num_proj, len(casos_al_treino)+num_proj), casos_al_prev_poli, 'y', label='Poli')\nplt.plot(np.linspace(len(casos_al_treino), len(casos_al_treino)+num_proj, num_proj), casos_al_prev_sarima[:], 'c', label='SARIMA')\nplt.plot(np.linspace(0,len(casos_al_treino), len(casos_al_treino)), fitted, 'c')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"Casos\")\nplt.legend()","1062c65e":"from IPython.display import Image\nfrom IPython.core.display import HTML \nImage(url= \"https:\/\/statsland.files.wordpress.com\/2012\/08\/extrapolating.jpg\")","060a5496":"plt.figure(figsize=(16,8))\nax = plt.subplot(1,2,1)\nax.set_title('Casos Acumulados', fontsize=18, loc='left')\nplt.plot(df_conf_w['Germany'], label='Germany')\nplt.plot(df_conf_w['Italy'], label='Italy')\nplt.plot(df_conf_w['China'], label='China')\nplt.plot(df_conf_w['Brazil'], label='Brazil')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"Casos\")\nplt.legend();\nax = plt.subplot(1,2,2)\nax.set_title('Casos por Dia', fontsize=18, loc='left')\nplt.plot(df_conf_pd['Germany'], label='Germany')\nplt.plot(df_conf_pd['Italy'], label='Italy')\nplt.plot(df_conf_pd['China'], label='China')\nplt.plot(df_conf_pd['Brazil'], label='Brazil')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"Casos\")\nplt.legend();","5f487b16":"acum_al = df_conf_w['Germany'][df_conf_pd[df_conf_pd['Germany'] > 10].index[0]:].values\nacum_al_treino = acum_al[:30]\nacum_al_teste = acum_al[30:]","6ee0bc3d":"# Aqui coloquei que o espa\u00e7o de busca \u00e9 pelo menos o q tivemos vezes, dois, pois vemos que n\u00e3o estamos no pico\nboundaries = ([0., 0.05, acum_al_treino.max()*2],[90., 1.0, 100*acum_al_treino.max()])\nxal, yal, erral, popt_sigal = sigm_predict(acum_al_treino, 30, boundaries)","9d7090f4":"#plt.plot(np.linspace(0,len(acum_al),len(acum_al)), acum_al, 'y', label='Real')\nplt.plot(np.linspace(0,len(acum_al_treino),len(acum_al_treino)), acum_al_treino, 'b', label='Passado')\nplt.plot(np.linspace(len(acum_al_treino),len(acum_al_treino)+30, 30), acum_al_teste[:30], 'g', label='Futuro')\nplt.plot(np.linspace(0, len(acum_al_treino)+30,len(acum_al_treino)+30), yal, 'r', label = 'Pred. Al')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"Casos\")\nplt.legend();","75c23ad3":"pd_al_real = df_conf_pd['Germany'][df_conf_pd[df_conf_pd['Germany'] > 10].index[0]:].values\npd_al_prev = np.diff(yal)","5f42fc9e":"plt.plot(pd_al_real, label='Real')\nplt.plot(pd_al_prev, label='Prev Sigmoid')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"Casos\")\nplt.legend();","b0e4ff3b":"eixo_dias = np.linspace(0,df_conf_w.shape[0], len(df_conf_w))\nplt.plot(eixo_dias, df_conf_w['Italy']*1000000\/pop[pop['local'] == 'Italy']['pop'].values, label = 'Italy')\nplt.plot(eixo_dias, df_conf_w['France']*1000000\/pop[pop['local'] == 'France']['pop'].values, label = 'France')\nplt.plot(eixo_dias, df_conf_w['Switzerland']*1000000\/pop[pop['local'] == 'Switzerland']['pop'].values, label = 'Spain')\nplt.plot(eixo_dias, df_conf_w['Norway']*1000000\/pop[pop['local'] == 'Norway']['pop'].values, label = 'Norway')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"Casos Acumulados\")\nplt.legend();","2c56be61":"#Dados por 1M, a partir de >10 casos\nacum_al_1m = df_conf_w['Germany'][df_conf_pd[df_conf_pd['Germany'] > 10].index[0]:]*1000000\/pop[pop['local'] == 'Germany']['pop'].values\nacum_al_treino_1m = acum_al_1m[:30]\nacum_al_teste_1m = acum_al_1m[30:]","008a836d":"# Aqui o limite m\u00e1ximo ser\u00e1 algum valor entre pr\u00f3ximo de 1500 (Norway)\nboundaries = ([0., 0.05, 1500],[90., 1.0, 2000])\nxal, yal_1m_min, erral, popt_sigal = sigm_predict(acum_al_treino_1m, 30, boundaries)\nprint(popt_sigal[0])\n# Um valor pr\u00f3ximo do maior da It\u00e1lia 3500\nboundaries = ([0., 0.05, 3500],[90., 1.0, 4000])\nxal, yal_1m_max, erral, popt_sigal = sigm_predict(acum_al_treino_1m, 30, boundaries)\nprint(popt_sigal[0])","efde06c2":"#plt.plot(np.linspace(0,len(acum_al_1m),len(acum_al_1m)), acum_al_1m, 'y', label='Real')\nplt.plot(np.linspace(0,len(acum_al_treino_1m),len(acum_al_treino_1m)), acum_al_treino_1m, 'b', label='Passado')\nplt.plot(np.linspace(len(acum_al_treino_1m),len(acum_al_treino_1m)+30, 30), acum_al_teste_1m[:30], 'g', label='Futuro')\nplt.plot(np.linspace(0, len(acum_al_treino_1m)+30,len(acum_al_treino_1m)+30), yal_1m_min, 'r', label = 'Pred. Min')\nplt.plot(np.linspace(0, len(acum_al_treino_1m)+30,len(acum_al_treino_1m)+30), yal_1m_max, 'r', label = 'Pred. Max')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"Casos\")\nplt.legend();","30aba56e":"fator = 1000000\/pop[pop['local'] == 'Germany']['pop'].values[0]","2971dd37":"# Valores calculados por 1M, agora vontando aos absolutos\npd_al_prev_min = np.diff(yal_1m_min\/fator)\npd_al_prev_max = np.diff(yal_1m_max\/fator)","0d3a6f72":"plt.plot(pd_al_real, label='Real')\nplt.plot(pd_al_prev_min, 'r', label='Prev Min')\nplt.plot(pd_al_prev_max, 'r', label='Prev Max')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"Casos por dia\")\nplt.legend();","4343240a":"# Precisa estar num dataframe com data\ndf_al = df_conf_w['Germany'][df_conf_pd[df_conf_pd['Germany'] > 10].index[0]:].copy()\ndf_al = df_al.reset_index()\ndf_al.rename(columns={'Date':'ds', 'Germany':'y'}, inplace=True)\ndf_al_treino = df_al[:30]\ndf_al_teste = df_al[30:]","d60361f8":"from fbprophet import Prophet\n\nprophet = Prophet(growth='logistic',\n                  changepoint_range=0.95,\n                  yearly_seasonality=False,\n                  weekly_seasonality=True,\n                  daily_seasonality=False,\n                  #seasonality_prior_scale=10,\n                  changepoint_prior_scale=.5)#.01\n#Vamos estabelecer os limites como anteriormente\ncap = 2000\/fator#10*df_al_treino['y'].max()\nfloor = 0#2*df_al_treino['y'].max()\ndf_al_treino['cap'] = cap\ndf_al_treino['floor'] = floor\nproffit = prophet.fit(df_al_treino)\n\n#fitted = m_sarima.predict_in_sample(start=1, end=len(casos_al_treino))\nfuturo = prophet.make_future_dataframe(periods=30, freq='D')\nfuturo['cap'] = cap\nfuturo['floor'] = floor\ncasos_al_prev_prof = prophet.predict(futuro)\nfig = prophet.plot(casos_al_prev_prof)\n#a = add_changepoints_to_plot(fig.gca(), prophet, forecast)\nplt.plot(futuro['ds'][30:], df_al_teste['y'][:30], 'g', label = 'Futuro')\nplt.show()\n#fig2 = prophet.plot_components(forecast)\n#plt.show()","6f039083":"#Por dia\nplt.figure(figsize=(10,4))\n#plt.plot(np.linspace(0,len(casos_al), len(casos_al)), casos_al, 'b', label='Real')\nplt.plot(np.linspace(0,len(casos_al_treino), len(casos_al_treino)), casos_al_treino, 'b', label='Passado')\nplt.plot(np.linspace(len(casos_al_treino), len(casos_al), len(casos_al)-len(casos_al_treino)), casos_al[len(casos_al_treino):], 'g', label='Futuro')\nplt.plot(np.linspace(0,len(casos_al_treino)+30, len(casos_al_treino)+30), casos_al_prev_prof['yhat'].diff().values, 'r', label='Prophet')\n#plt.plot(np.linspace(0,len(casos_al_treino), len(casos_al_treino)), fitted, 'c')\nplt.xlabel(\"Dia\")\nplt.ylabel(\"Casos\")\nplt.legend()","2cb8e6bd":"Vixiiii! A regress\u00e3o linear descolou e continua subindo. A polinomial, ent\u00e3o, foi-se embora! O modelo SARIMA ainda tentou representar a sazonalidade, mas manteve a tend\u00eancia de subida. Por que? Porque aprenderam pelos dados de passado que tinha a tend\u00eancia de crescimento, e os dados seguintes mostraram a invers\u00e3o da mesma.\n\nOu seja, esses modelos s\u00f3 servem para **representar futuros pr\u00f3ximos**, sem mudan\u00e7as de tend\u00eancias. E o modelo da epidemia tem que inverter a tend\u00eancia, pois a popula\u00e7\u00e3o n\u00e3o \u00e9 infinita. Uma hora, quando muitos estiverem contaminados, teremos menos pessoas a contaminar. O n\u00famero de casos por dia tem que subir, chegar no pico e descer.\n\nLembra de alguma coisa? Huff explicou em 1954: \n\n**N\u00e3o extrapole nas extrapola\u00e7\u00f5es!**\n","aba61dbc":"## Abordagens de Previs\u00f5es Autoregressivas","28b69e5e":"### Revendo para Proje\u00e7\u00f5es Pr\u00f3xima ao Pico","a9ead5d5":"\"... \nResponda quem puder\nO que ir\u00e1 me acontecer?\nO meu destino ser\u00e1\nComo Deus quiser\nComo ser\u00e1?\" (Jo\u00e3o S\u00e9rgio, GRES Uni\u00e3o da Ilha do Gov).","776d51bd":"Bom, temos que ter um pouco de conhecimento de dom\u00ednio para saber que uma epidemia n\u00e3o evolui eternamente. Ela tem uma fase de expans\u00e3o agressiva, similar a exponencial, depois come\u00e7a a estabilizar, conforme a popula\u00e7\u00e3o vai ficando imune, e ent\u00e3o come\u00e7a a decrescer at\u00e9 esvair-se. A popula\u00e7\u00e3o n\u00e3o \u00e9 infinita, logo a epidemia tem que ter um limite de crescimento.\n\nEpidemias costumam ser modeladas por fun\u00e7\u00f5es sigmoids, quando olhamos casos acumulados, que expressam exatamente esse comportamento. Se olharmos por dia, a fun\u00e7\u00e3o sigmoid se assemelha a um sino.\n\nVejamos alguns exemplos. Aqui plotamos os casos acumulados da Alemanha, It\u00e1lia, China e Brasil. Vemos que todas as curvas acumuladas aprensentam o comportamento sigmoid. Mas n\u00e3o \u00e9 \u00e0 toa. Modelos cient\u00edficos de epidemias, como o modelo SIR, s\u00e3o baseados nessa curva.\n\nNo caso do Brasil, vemos que ainda n\u00e3o chegamos na mudan\u00e7a de tend\u00eancia, ou seja, na amortiza\u00e7\u00e3o dos casos acumulados. De outra forma, n\u00e3o vemos o pico.\n\n**Mas onde esse trem t\u00e1????**","4476cbd2":"Ent\u00e3o vamos fazer o seguinte: como melhor modelo de previs\u00e3o, vamos fazer um fit de uma fun\u00e7\u00e3o log\u00edstica (sigmoid) nos dados, at\u00e9 ent\u00e3o, e ver se a proje\u00e7\u00e3o dos casos futuros reflete melhor a realidade e, com isso, encontramos uma melhor estimativa para o pico. Vamos fazer isso para os dados da Alemanha, pois como est\u00e1 num momento mais avan\u00e7ado da epidemia, podemos imaginar que estamos em um momento anterior ao pico e ver se poder\u00edamos estimar o que aconteceria nos momentos posteriores. Ou seja, o exemplo a ser mostrado \u00e9 uma suposi\u00e7\u00e3o que estamos olhando a Alemanha num momento anterior do tempo, sem saber como seria no futuro. Mas vamos comparar com os dados que j\u00e1 sabemos.","1a2d0ae0":"O interessante da vis\u00e3o di\u00e1ria \u00e9 que podemos observar que a evolu\u00e7\u00e3o dos dados n\u00e3o \u00e9 t\u00e3o bem comportada, apresentando varia\u00e7\u00f5es devido a ru\u00eddos, tais como a pr\u00f3pria natureza estoc\u00e1stica de casos e mortes, limita\u00e7\u00f5es em testes ou no reporte deles etc. Ainda \u00e9 interessante ver em casos de pa\u00edses em est\u00e1gios mais avan\u00e7ados da epidemia, que o a evolu\u00e7\u00e3o se d\u00e1 com um crescimento do n\u00famero de casos por dia, chega num pico (o famoso pico) e depois come\u00e7a a decrescer. As taxas de crescimento e descrescimento podem ser devidas a evolu\u00e7\u00e3o natural de uma epidemia, cujos modelos oficiais mostram que a mesma segue um formato da fun\u00e7\u00e3o sigmoid (ou log\u00edstica) quando acumulados, que correspondem a um sino quando por dia (ver curvas da Alemanha), ou ainda a fatores como a\u00e7\u00f5es de isolamento social etc.\n\nNo caso da Alemanha, observa-se nitidamente de que h\u00e1 ind\u00edcios de que um pico de casos ocorreu 02\/04 e o de \u00f3bitos em 15\/04. (No momento desse estudo, n\u00e3o \u00e9 poss\u00edvel afirmar ainda se ele \u00e9 devido ao ciclo natural da epidemia ou se \u00e9 um controle realizado com medidas de conten\u00e7\u00e3o. Se for devido ao \u00faltimo fator, sua curva deve apresentar calda longa ou novas ondas).\nNo caso do Brazil, vemos que o mesmo come\u00e7ou mais atrasado na pandemia, e n\u00e3o h\u00e1 sinais de pico nos gr\u00e1ficos (curva acumulada ainda n\u00e3o se parece uma sigmoid e casos por dia com tend\u00eancia de crescimento).\n\nJ\u00e1 olhando os estados brasileiros, vemos que como o pa\u00eds \u00e9 continental, temos tamb\u00e9m muitas diferen\u00e7as entre eles. Ou est\u00e3o em diferentes momentos da epidemia, ou fatores regionais e socio-culturais podem ajudar um estado a conter melhor a epidemia (n\u00e3o vamos entrar nessas quest\u00f5es aqui).\n\nObservar o pico de uma epidemia \u00e9 um aspecto importante, pois nos possibilita enxergar quando come\u00e7aremos a regredir no n\u00famero de casos e \u00f3bitos e quando esta deve cessar.\n\nEnt\u00e3o a quest\u00e3o \u00e9:\n\n**Como estimar o pico?**\n\nVamos chegar l\u00e1. Mas vamos ver algumas coisinhas primeiro.\n","ec210837":"# Entendendo os dados","ee8a82c4":"#### Decomposi\u00e7\u00e3o","a48207f3":"Pra facilitar, e considerando que meu objetivo \u00e9 somente did\u00e1tico, vamos fazer isso: olhar dados de pa\u00edses pr\u00f3ximos como se estivessem mais avan\u00e7ados no tempo, em rela\u00e7\u00e3o \u00e0 Alemanha (obs. sabemos q eles come\u00e7aram bem pr\u00f3ximos na epidemia, poderia usar os dados asi\u00e1ticos, mas eles s\u00e3o bem diferentes do resto do mundo por motivos que pode ser alvo de outra an\u00e1lise). No caso, \u00e9 justo normalizar os dados pelo tamanho da popula\u00e7\u00e3o de cada pa\u00eds, uma vez que s\u00e3o bem diferentes, ent\u00e3o vamos fazer o n\u00famero de casos por 1 milh\u00e3o de habitantes. ","44e23c38":"Se observamos tend\u00eancia e sazonalidade, um modelo melhor de previs\u00e3o de s\u00e9ries temporais \u00e9 o SARIMA, que considera a composi\u00e7\u00e3o de uma modelo Sazonal (S), Autoregressivo (AR), Integral (I) e de m\u00e9dia m\u00f3vel(MA). \n\nPara a parametriza\u00e7\u00e3o, vamos logo apelar para as possibilidades de par\u00e2metros de modelagem fazendo um busca com o **Auto ARIMA**.","a13bd7a7":"Melhor plotar alguns pa\u00edses pra ver melhor.","626102c2":"### Facebook's Prophet","df94f459":"Uma s\u00e9rie temporal \u00e9 uma sequ\u00eancia de realiza\u00e7\u00f5es (observa\u00e7\u00f5es) de uma vari\u00e1vel ao longo do tempo (WOOLDRIDGE, Jeffrey M. Introductory Econometrics: a Modern Approach. 2000, South-Western College Publishing, a division of Thomson Learning). Os dados de n\u00famero de casos e \u00f3bitos, divulgados de forma oficial e diariamente, s\u00e3o exemplos de s\u00e9ries temporais.\n\nUma caracter\u00edstica muito importante deste tipo de dado \u00e9 que as observa\u00e7\u00f5es vizinhas s\u00e3o dependentes, ou seja, dados passados se relacionam com os pr\u00f3ximos, e o interesse em analisar e modelar essa depend\u00eancia pode nos ajudar a entender seu comportamento hist\u00f3rico, identificando seus padr\u00f5es e, com isso, estimar melhor o futuro. Por isso, muitas vezes encontramos o termo Previs\u00e3o de S\u00e9ries Temporais. E dessa forma, o estudo de s\u00e9ries temporais \u00e9 importante em diferentes \u00e1reas do conhecimento, tais como  estat\u00edstica, econometria, matem\u00e1tica aplicada e processamento de sinais.\n\nPara saber mais:\n\n\n*   Veja nossos cursos gratuitos no [Samsung Ocean](www.oceanbrasil.com.br).\n*   [Conceitos de s\u00e9ries temporais](https:\/\/pt.wikipedia.org\/wiki\/S%C3%A9rie_temporal).\n*   Robert H. Shumway. Time series analysis and its applications. Springer, 2000.\n*   Aileen Nielsen. Practical Time Series Analysis. O\u2019Reilly, 2019.\n\n\nNesse estudo, demonstraremos aspectos pr\u00e1ticos com Python na cria\u00e7\u00e3o de modelos de s\u00e9ries temporais e usaremos as seguintes bibliotecas:\n\n\n*  Regress\u00e3o Linear e Polinomial:  [Scikit-learn](https:\/\/scikit-learn.org\/stable\/).\n*  SARIMA: [statsmodel](https:\/\/www.statsmodels.org\/) e [auto-arima](https:\/\/www.alkaline-ml.com\/pmdarima).\n*  [Facebooks Prophet](https:\/\/facebook.github.io\/prophet\/).\n\n","ad456bb6":"### Regress\u00e3o Linear Simples","38f25b6b":"Uma abordagem comum, quando temos dados hist\u00f3ricos de algum fen\u00f4meno e queremos prever o futuro, e olhar o padr\u00e3o contido nesses dados e tentar projet\u00e1-lo para a frente.\n\nA abordagem mais simples \u00e9 a **Regress\u00e3o Linear Simples**, que visa encontrar uma reta que melhor representa os dados. Ent\u00e3o, de posse dessa reta, podemos projetar novos pontos.\n\nNo caso do Brasil, vamos usar os dados iniciais, excluindo os 5 dias finais, e ver se poder\u00edamos t\u00ea-los estimado adequadamente. ","83297ca4":"Prever o futuro pr\u00f3ximo \u00e9 vi\u00e1vel!\n\nPrever o futuro mais distante \u00e9 dif\u00edcil!\n\nObservar tend\u00eancias e sazonalidades podem nos fazer enxergar certos padr\u00f5es nos dados. Com esses padr\u00f5es, podemos estimar melhor as possibilidades futuras.\n\nConhecimento de dom\u00ednio \u00e9 importante para estimar melhor.\n\nMas isso n\u00e3o \u00e9 futurologia! Sempre interprete os resultados com cautela e considere as condi\u00e7\u00f5es de contorno.","496d802b":"Que interessante. Os modelos anteriores seguiam a tend\u00eancia observada anteriormente, logo, para pontos futuros, divergiam muito da realidade quando da mudan\u00e7a natural de tend\u00eancia epid\u00eamica. J\u00e1 assumindo que sabemos que ela decair\u00e1, mesmo com muita diferen\u00e7a para o real, ela \u00e9 menor do que os anteriores. Isso mostra como o conhecimento de dom\u00ednio \u00e9 importante.\n\nBom, nesse caso, t\u00ednhamos pego dados pr\u00f3ximos do pico para projetar pontos posteriores, o fit da sigmoid logo projetou a mudan\u00e7a de tend\u00eancia, nos ajudando no exemplo. Se peg\u00e1ssemos intervados bem anteriores ao pico para proje\u00e7\u00e3o, o fit da sigmoid come\u00e7aria errar para bem menos. \n\nIsso se deve a uma instabilidade observada no modelo sigmoid quando temos varia\u00e7\u00f5es de dados em sua fase de crescimento (intervalo de crescimento logo ap\u00f3s o in\u00edcio exponencial). Ou seja, muitas possibilidades de curva sigmoid podem se aproximar aos dados de hist\u00f3rico em rela\u00e7\u00e3o ao crescimento exponencial inicial e \u00e0 acelera\u00e7\u00e3o observada, bastando mudar apenas o m\u00e1ximo de estabiliza\u00e7\u00e3o previsto. No exemplo demonstrado, colocamos um espa\u00e7o muito grande de varia\u00e7\u00e3o desse m\u00e1ximo (2x o valor m\u00e1ximo atual a 100x ele).\n\nPara melhor estabeler esses m\u00e1ximos de estabiliza\u00e7\u00e3o, novamente \u00e9 necess\u00e1rio conhecimento de dom\u00ednio. Por exemplo, qual \u00e9 o alcance do fen\u00f4meno? \u00c9 o tamanho da popula\u00e7\u00e3o?\n\nNo caso de epidemias, sabemos que n\u00e3o h\u00e1 necessidade de atingir toda a popula\u00e7\u00e3o para haver imuniza\u00e7\u00e3o de rebanho. Ent\u00e3o, podemos observar o compartamento de epidemias similares anteriores, ou ainda, casos de pa\u00edses em est\u00e1gios epid\u00eamicos mais avan\u00e7ados. Ambas as alternativas podem ajustar melhor o modelo \u00e0 realidade, do que simplesmente olhar dados anteriores e projetar o futuro. Se olharmos exemplos representativos de n\u00fameros de casos de outros pa\u00edses, podemos ter aproxima\u00e7\u00f5es melhores. Ainda, eles j\u00e1 podem considerar estat\u00edsticas embutidas da amostragem que ocorre em na quantidade de testes pelo tamanho da popula\u00e7\u00e3o.\n","05625e33":"Ent\u00e3o, nesse estudo, vamos considerar um desafio um pouco maior, a possibilidade de prever mais dias \u00e0 frente. Do ponto de vista did\u00e1tico, podemos observar melhor quest\u00f5es como tend\u00eancia e sazonalidade que podem ocorrer nos dados. E considere, inclusive, que prever mais dias \u00e0 frente seria mais \u00fatil para cientistas e gestores, pois poderiam ter tempo de tomar algumas medidas de contorno, tais como preparar leitos ou rem\u00e9dios.","ec0b14f9":"Da mesma forma, para alguns estados do Brasil.","543afd5b":"## Coleta de Dados","5295f84c":"Na se\u00e7\u00e3o de Coleta e Prepara\u00e7\u00e3o de dados, abrimos o dataset e fizemos algumas minipula\u00e7\u00f5es para resum\u00ed-los dessa forma: Cada pa\u00eds a quantidade de casos acumulados por dia (df_conf_w) e mortes por dia (df_deaths_w).","7ef2d9bd":"Quando analisamos dados do Covid, como neste dataset e nos complementos aqui utilizados, temos acessos a dados gerais de divulga\u00e7\u00e3o, como quantidade de casos acumulados, quantidade de \u00f3bitos acumulados, nos diferentes pa\u00edses e em uma periodicidade di\u00e1ria. \u00c9 um n\u00eddido exemplo de uma s\u00e9rie temporal. \n\nO objetivo desses dados \u00e9 mostrar a evolu\u00e7\u00e3o da pandemia em um determinado local. Assim, as pessoas podem entender os est\u00e1gio de evolu\u00e7\u00e3o da mesma, se a mesma est\u00e1 crescendo ou n\u00e3o, se as medidas de isolamento social est\u00e3o surtindo efeito etc.\n\nAbaixo exemplos comparativos de alguns pa\u00edses e de alguns estados brasileiros.","51b7170c":"Parece que capturou melhor tend\u00eancia e sazonalidade.\nMas ent\u00e3o, podemos seguir assim, per\u00edodo ap\u00f3s per\u00edodo, e chegar at\u00e9 o fim da epidemia?\n\nN\u00e3o, n\u00e3o, pequeno Padawan. E se a tend\u00eancia mudar? Veja bem, estamos olhando o passado para prever o futuro. Ent\u00e3o o passado mostra uma tend\u00eancia que pode mudar, logo, previs\u00f5es ap\u00f3s essas mudan\u00e7as divergiriam da realidade.\n\nComo exemplo, vamos pegar novamente os dados da Alemanha, antes do pico, e observar como seriam as projetos dos modelos estimados.","73c35cc4":"**Resumo:**\n\nO estudo aqui apresentado tem o objetivo de apresentar conceitos de s\u00e9ries temporais, ferramentas \u00fateis que podem ser usadas no dia-a-dia de pessoas interessadas em ci\u00eancia de dados, e apontar cuidados que novos desenvolvedores devem ter quando iniciam o aprendizado neste tema. Isso \u00e9 feito considerando dados relacionados ao Covid-19, tema importante no contexto atual, e que tem mobilizado muita for\u00e7a de trabalho de desenvolvedores e cientistas no mundo todo.\n\n**N\u00e3o \u00e9 objetivo nosso desenvolver e otimizar modelos de predi\u00e7\u00e3o**. Os modelos aqui mostrados e parametrizados adotam abordagens de simples entendimento para novos estudantes.\n\n---\n\n**Autores:**\n\n*   [Carlos Maur\u00edcio Ser\u00f3dio Figueiredo](https:\/\/www.linkedin.com\/in\/cmsfigueiredo\/): \u00c9 professor adjunto da Escola Superior de Tecnologia da Universidade do Estado do Amazonas (EST\/UEA) e professor colaborador do Programa de P\u00f3s-gradua\u00e7\u00e3o em Inform\u00e1tica da Universidade Federal do Amazonas, \u00e9 co-fundador do Lab. de Sistemas Inteligentes da UEA e pesquisador no Samsung Ocean Manaus.\n*   [Alice Adativa Ferreira Menezes](https:\/\/www.linkedin.com\/in\/alice-adativa\/): \u00c9 doutoranda na Universidade Federal do Amazonas (UFAM) e  pesquisadora no Samsung Ocean.\n\n---\n\n**Ressalvas:** \n\nChamamos a aten\u00e7\u00e3o para que, embora modelos e resultados sejam confrontados com a realidade, por vezes de forma bem aproximada, as an\u00e1lises dos dados apresentam um alto grau de incerteza devido a v\u00e1rios fatores:\n\n\n*   Natureza imprecisa dos dados utilizados, podendo esses serem incompletos ou conterem erros;\n\n*   Natureza imprecisa das metodologias de coleta de casos e \u00f3bitos por Covid-19, sabidamente contendo subnotifica\u00e7\u00f5es e testes imprecisos;\n\n*   Diferentes pa\u00edses, estados e cidades apresentam diferen\u00e7as em infra-estrutura e socio-culturais enormes, adotando diferentes abordagens perante a pandemia do Covid-19 e, consequentemente, apresentando desempenhos muito vari\u00e1veis;\n\n*   A pandemia do Covid-19 supreendeu toda a comunidade cient\u00edfica internacional pelas suas caracter\u00edsticas distintas das demais, levando a uma situa\u00e7\u00e3o totalmente nova, e cuja realidade s\u00f3 ser\u00e1 entendida com maior precis\u00e3o depois que a mesma acabar, com posse de muitos dados e estudos.\n\n---\n\n**Aten\u00e7\u00e3o!!!!**\n\nPrevis\u00e3o em Ci\u00eancia de Dados n\u00e3o \u00e9 saber o que vai acontecer amanh\u00e3. Previs\u00e3o em Ci\u00eancia de Dados \u00e9 analisar padr\u00f5es temporais e, com isso, estimar melhor as possibilidades de ocorr\u00eancias futuras.\n\nA resposta de modelos preditivos n\u00e3o \u00e9 \"no dia tal, o n\u00famero de mortes ser\u00e1 tanto\", e sim \"considerando que o hist\u00f3rico observado \u00e9 representativo, que o compartamento se manter\u00e1, estimamos que no dia tal o n\u00famero de mortes pode chagar a tanto\".\n\n**\"Essencialmente, todos os modelos est\u00e3o errados, mas alguns s\u00e3o \u00fateis\" (George Box).**\n\n\nObrigado por olhar nosso trabalho. Por favor, n\u00e3o hesite em deixar contribui\u00e7\u00f5es nos coment\u00e1rios.\n\n**Observa\u00e7\u00f5es realizadas com base nos dados at\u00e9 18\/05\/2020.**\n\n\n\n\n\n","e77d652a":"#### Autocorrela\u00e7\u00e3o","75014c84":"# A Fazer","21120e46":"### An\u00e1lise Temporal\n\nPara tentar visualizar sazonalidade, vamos primeiro fazer uma an\u00e1lise de autocorrela\u00e7\u00e3o.","0c2c7509":"# Apresenta\u00e7\u00e3o","af98662d":"# Como ser\u00e1 o amanh\u00e3?","3ecf8b18":"### Fit numa sigmoid","0bc8f70e":"### Proje\u00e7\u00f5es na fase de crescimento","4a98b600":"# Introdu\u00e7\u00e3o","0b9e30a7":"Dados da Alemanha, por dia, a partir do 10o caso, podemos observar que o pico est\u00e1 por volta do dia 30. Vamos projetar 5 dias a partir do dia 25 e verificar se os modelos capturam a caracter\u00edstica da epidemia.","d19db846":"Bem, vemos valores bem diferentes. Isso tem muito a ver com fatores de cada pa\u00eds, como medidas de quarentena, amplitude da testagem, etc. Como vamos saber se a Alemanha vai desempenhar melhor ou pior que eles? N\u00e3o d\u00e1, mas, estatisticamente, usar um intervalo mais fact\u00edvel para busca das proje\u00e7\u00f5es, pode nos dar uma ideia melhor de limites a estimar. Ent\u00e3o vamos fazer uma proje\u00e7\u00e3o pra Alemanha considerando como limites o maior e o menor valores observados.","b501a584":"### Regress\u00e3o de uma fun\u00e7\u00e3o Polinomial","8abbc25a":"Como podemos observar, essa op\u00e7\u00e3o n\u00e3o \u00e9 boa, pois nitidamente o comportamento da evolu\u00e7\u00e3o dos casos n\u00e3o \u00e9 uma reta. Nesse caso, um obsevador mais cuidadoso poderia imaginar que outra fun\u00e7\u00e3o seria mais apropriada. Por exemplo, fazer um fit de uma fun\u00e7\u00e3o **exponencial**, como parece o trecho do gr\u00e1fico, ou uma fun\u00e7\u00e3o **polinomial** que poderia se adequar melhor ao padr\u00e3o.\n\nNesse caso, vamos tentar uma regress\u00e3o de uma fun\u00e7\u00e3o polinomial que \u00e9 capaz de adequar uma variedade grande de curvas.","35628f03":"Hummmm. Se distanciou muito, n\u00e9? Veja que o fit foi feito buscando valores de m\u00e1ximo da fun\u00e7\u00e3o sigmoid duas ordens de grandeza maiores que o valor at\u00e9 ent\u00e3o, o que d\u00e1 um espa\u00e7o muito amplo de busca. \n\nDe qualquer forma, se observarmos como seria a curva no crescimento di\u00e1rio, ao inv\u00e9s do acumulado, vemos que h\u00e1 uma aproxima\u00e7\u00e3o que faz mais sentido do que as proje\u00e7\u00f5es anteriores (Linear, polinomial e sarima). Isso \u00e9 porque fizemos o fit numa fun\u00e7\u00e3o que sabemos que ter\u00e1 decaimento, como nas epidemias, enquanto que as demais seguem a tend\u00eancia anterior at\u00e9 que hajam dados suficientes de sua mudan\u00e7a, o que na pr\u00e1tica significa que o pico j\u00e1 passou.","6a2f1b15":"Parece muito melhor. E a regress\u00e3o de uma fun\u00e7\u00e3o polinomial de 4a ordem modelou o comportamento exponencial da curva de crescimento de casos. No intervalo mostrado, a tend\u00eancia est\u00e1 muito bem representada.\n\nMas ser\u00e1 que n\u00e3o poder\u00edamos melhorar a previs\u00e3o com uso de modelos mais completos, que capturam mais caracter\u00edsticas da s\u00e9rie temporal? Por exemplo, a curva apresenta algumas oscila\u00e7\u00f5es que parecem ter uma sazonalidade.\n\nPara isso, vamos analisar caracter\u00edsticas temporais dos dados. Uma forma cl\u00e1ssica de an\u00e1lise de s\u00e9ries temporais \u00e9 decomp\u00f4-la em tend\u00eancia, sazonalidade e ru\u00eddos. Para tentar visualizar sazonalidade, vamos primeiro fazer uma an\u00e1lise de autocorrela\u00e7\u00e3o.","d4de35d2":"Olha que interessante!!! O modelo linear ficou com previs\u00f5es aqu\u00e9m da realidade, pois foi muito afetado pelo aprendizado de uma fase mais suave da curva. O modelo polinomial conseguiu capturar melhor a tend\u00eancia. E o SARIMA refletiu muito bem os dados futuros, inclusive com a sazonalidade embutida!\n\n**Problema resolvido?**\n\nVamos ver para valores mais pr\u00f3ximos do pico. Dessa vez, vamos assumir que j\u00e1 estamos no dia 30.","2715e7af":"Um modelo muito interessante de previs\u00e3o de s\u00e9ries temporais, \u00e9 o modelo Prophet desenvolvido pelo Facebook (https:\/\/facebook.github.io\/prophet\/docs\/installation.html#python). Ele \u00e9 muito pr\u00e1tico por j\u00e1 considerar a composi\u00e7\u00e3o de diferentes possibilidades de tend\u00eancias (como a log\u00edstica) e diferentes componentes sazonais, como di\u00e1ria, mensal, de feriados etc. Ou seja, \u00e9 um modelo que permite a introdu\u00e7\u00e3o mais f\u00e1cil de conhecimento de dom\u00ednio.\n\nMas ele precisa da defini\u00e7\u00e3o dos limites da curva, assim como mostrado anteriormente. Vamos usar o valor m\u00e1ximo no meio entre Noruega e It\u00e1lia (2500), novamente, assumindo conhecimento de dom\u00ednio. \n\nO objetivo dessa experi\u00eancia aqui \u00e9 mostrar que a mesma ideia do conhecimento de dom\u00ednio \u00e9 v\u00e1lida para qualquer modelo de previs\u00e3o de s\u00e9ries temporais, bastando fazer a correta parametriza\u00e7\u00e3o. Nesse caso, vemos inclusive que o modelo tenta capturar a sazonalidade semanal dos dados, al\u00e9m da tend\u00eancia. Coisa que a proje\u00e7\u00e3o anterior n\u00e3o faz. O resultado da sazonalidade n\u00e3o \u00e9 t\u00e3o bom com o passar do tempo de previs\u00e3o, talvez o modelo possa ser melhor parametrizado, mas acertar 100% nem M\u00e3e Din\u00e1!","fed69f70":"# Conclus\u00f5es","974fe3dd":"Resumindo, muita gente prev\u00ea os pr\u00f3ximos dias com esses modelos, o que \u00e9 \u00fatil em fases bem comportadas da curva, ou seja, sem grandes mudan\u00e7as de tend\u00eancia.\n\nMas como nota-se, eles n\u00e3o ser\u00e3o razo\u00e1veis para descobrir o pico nem modelar a pandemia como um todo.\n\nE agora, Jos\u00e9? Uma pergunta comum em tempos de pandemia \u00e9: \n\n**Quando ser\u00e1 o pico?**\n\nO motivo \u00e9 o desejo de saber se a situa\u00e7\u00e3o ainda vai piorar ou vai come\u00e7ar a melhorar. Responder essa pergunta \u00e9 o esfo\u00e7o de muitos cientistas ao redor do mundo.","9a338c2e":"\n\n*   Avaliar modelos com m\u00e9tricas de erro\n*   Projetar curvas do Brasil\n*   Incluir modelos LSTM e DeepAR\n\n","63a74095":"### Modelo SARIMA","fd156321":"# Coleta e Prepara\u00e7\u00e3o","67510f67":"Vamos, ent\u00e3o, decompor os dados considerando uma frequ\u00eancia de 7 dias.\n\nAssim, podemos observar nitidamente que h\u00e1 uma forte tend\u00eancia exponencial (Trend) e um padr\u00e3o sazonal de 7 dias nos dados, al\u00e9m de alguns ru\u00eddos espalhados pelo universo de dados.","ab3360a7":"### sigm_predict","f2051203":"Como podemos observar, parece haver uma sazonalidade forte nos dados considerando um lag pouco menor que 10 amostras dos dados, ou seja, 10 dias. Se observarmos bem os dados de casos por dia, podemos ver que eles costumam ter uma redu\u00e7\u00e3o em fins de semana. A sazonalidade \u00e9 de 7 dias, e fica evidente no gr\u00e1fico de autocorrela\u00e7\u00e3o.","2d820668":"Bom, os intervalos calculados projetam valores de casos por dia bem diferentes. Nos picos, \u00e9 um pouco mais que o dobro quando usamos os comportamentos de Noruega e It\u00e1lia como exemplo. Ent\u00e3o o que mostramos \u00e9 como seria a tend\u00eancia da Alemanha se ela se comportasse como um pa\u00eds ou outro. No caso, vemos que ela est\u00e1 um pouco pior do que o primeiro, mas muito melhor que o \u00faltimo. O conhecimento de dom\u00ednio poderia ajudar a estimar melhor, se considerarmos, por exemplo, que a Alemanha se assemelha muito mais em caracter\u00edsticas com a Noruega.\n\nDe qualquer forma, mesmo pegando o caso extremo da It\u00e1lia como refer\u00eancia, **podemos projetar um pico de pior caso, que os modelos de regress\u00e3o linear, polinimial e Sarima n\u00e3o seriam capazes de fazer.**\n\nSe o objetivo \u00e9 descobrir onde est\u00e1 o pico, temos um intervalo bem melhor para planejamento e tomada de decis\u00e3o. No caso, a diferen\u00e7a entre os projetados \u00e9 de 7 dias.\n\n","34c10bee":"## Fun\u00e7\u00f5es \u00dateis","b3808cb2":"#### acum2pd","207d332f":"Uma forma alternativa de visualizar a evolu\u00e7\u00e3o dos casos, \u00e9 na vis\u00e3o por dia, que tamb\u00e9m preparamos em df_conf_pd e df_deaths_pd. Essa vis\u00e3o \u00e9 mais pr\u00f3xima das pessoas, porque logo enxergam quantos est\u00e3o sendo contaminados ou vindo a \u00f3bito por dia.","c66a67db":"## Conhecimento de Dom\u00ednio\n","063d5583":"No caso em estudo, monitorando os casos acumulados do v\u00edrus, prever o amanh\u00e3 \u00e9 interessante mas de pouco impacto. Do ponto de vista pr\u00e1tico, espera-se que uma epidemia n\u00e3o mude de tend\u00eancia t\u00e3o bruscamente de um dia para outro. Ent\u00e3o qualquer previs\u00e3o inocente, como ver a diferen\u00e7a dos dias anteriores e acrescentar ao \u00faltimo dia, pode dar resultados pr\u00f3ximos. E se errar, ser\u00e1 por pouco, se comparado proporcionalmente ao n\u00famero acumulado de casos. \n\nVamos pegar um exemplo bem r\u00e1pido, para o Brasil, vamos plotar as duas curvas. Quase n\u00e3o notamos a diferen\u00e7a nos casos acumulados, embora ela seja mais evidente quando olhamos por dia."}}