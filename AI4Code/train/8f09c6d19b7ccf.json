{"cell_type":{"f5c542b4":"code","4b34ef0a":"code","052f650a":"code","af4df591":"code","3bf9ec55":"markdown","b7225dd6":"markdown"},"source":{"f5c542b4":"import numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns","4b34ef0a":"np.random.seed(42)\n\ncm = np.random.randint(0, 50, size=(4, 4))\ncm","052f650a":"class JointConfusionMatrix:\n    \"\"\"\n    Ref. https:\/\/github.com\/mwaskom\/seaborn\/blob\/master\/seaborn\/axisgrid.py#L1551\n    \"\"\"\n    def __init__(self, cm, height=6, ratio=5, space=.2,\n                 dropna=True, xlim=None, ylim=None, size=None):\n        \n        # Set up the subplot grid\n        f = plt.figure(figsize=(height, height))\n        gs = plt.GridSpec(ratio + 1, ratio + 1)\n\n        ax_joint = f.add_subplot(gs[1:, :-1])\n        ax_marg_x = f.add_subplot(gs[0, :-1], sharex=ax_joint)\n        ax_marg_y = f.add_subplot(gs[1:, -1], sharey=ax_joint)\n\n        self.fig = f\n        self.ax_joint = ax_joint\n        self.ax_marg_x = ax_marg_x\n        self.ax_marg_y = ax_marg_y\n        self.cm = cm\n\n        # Turn off tick visibility for the measure axis on the marginal plots\n        plt.setp(ax_marg_x.get_xticklabels(), visible=False)\n        plt.setp(ax_marg_y.get_yticklabels(), visible=False)\n\n        # Turn off the ticks on the density axis for the marginal plots\n        plt.setp(ax_marg_x.yaxis.get_majorticklines(), visible=False)\n        plt.setp(ax_marg_x.yaxis.get_minorticklines(), visible=False)\n        plt.setp(ax_marg_y.xaxis.get_majorticklines(), visible=False)\n        plt.setp(ax_marg_y.xaxis.get_minorticklines(), visible=False)\n        plt.setp(ax_marg_x.get_yticklabels(), visible=False)\n        plt.setp(ax_marg_y.get_xticklabels(), visible=False)\n        \n        ax_marg_x.yaxis.grid(False)\n        ax_marg_y.xaxis.grid(False)\n\n        if xlim is not None:\n            ax_joint.set_xlim(xlim)\n        if ylim is not None:\n            ax_joint.set_ylim(ylim)\n\n        # Make the grid look nice\n        sns.utils.despine(f)\n        sns.utils.despine(ax=ax_marg_x, left=True)\n        sns.utils.despine(ax=ax_marg_y, bottom=True)\n        f.tight_layout()\n        f.subplots_adjust(hspace=space, wspace=space)\n        \n        \n    def make_annotation(self, cm, cm_norm, normalize=True):\n        annot = []\n        nrows, ncols = cm.shape\n        base = '{}\\n({:.2f})'\n        for ir in range(nrows):\n            annot.append([])\n            for ic in range(ncols):\n                annot[ir].append(base.format(cm[ir, ic], cm_norm[ir, ic]))\n       \n        return np.array(annot)\n            \n    def plot(self, labels, normalize=True):\n        true_dist = cm.sum(axis=1)\n        pred_dist = cm.sum(axis=0)\n        pos = np.arange(cm.shape[0]) + 0.5\n        \n        cm_norm = cm \/ true_dist.reshape(-1, 1)\n        annot = self.make_annotation(cm, cm_norm)\n        \n        FONTSIZE = 20\n        \n        # plot confusion matrix as heatmap\n        sns.heatmap(cm_norm, cmap='Blues', vmin=0, vmax=1,\n                    annot=annot, fmt='s', annot_kws={'fontsize': FONTSIZE},\n                    linewidths=0.2, cbar=False, square=True, ax=self.ax_joint)\n        self.ax_joint.set_xlabel('Predicted label', fontsize=FONTSIZE)\n        self.ax_joint.set_xticklabels(labels, fontsize=FONTSIZE)\n        \n        self.ax_joint.set_ylabel('True label', fontsize=FONTSIZE)\n        self.ax_joint.set_yticklabels(labels, fontsize=FONTSIZE)\n        \n        props = {'align': 'center'}\n        \n        # plot predicted label distribution\n        self.ax_marg_x.bar(pos, pred_dist \/ pred_dist.sum(), **props)\n        self.ax_marg_x.set_title('Predicted label distribution', fontsize=FONTSIZE)\n        \n        # plot true label distribution\n        self.ax_marg_y.barh(pos, true_dist \/ true_dist.sum(), **props)\n        self.ax_marg_y.text(0.5, 1.5, 'True label distribution',\n                            rotation=270, fontsize=FONTSIZE)","af4df591":"g = JointConfusionMatrix(cm, height=10)\ng.plot(labels=['a', 'b', 'c', 'd'])","3bf9ec55":"This might be overkill...","b7225dd6":"# This kernel is based on [Confusion Matrix](https:\/\/www.kaggle.com\/onodera\/confusion-matrix) by ONODERA."}}