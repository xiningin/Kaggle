{"cell_type":{"50dbb950":"code","6a15187b":"code","6af7e5a9":"code","5e680cfc":"code","07237b3a":"code","176595a3":"code","2db738c4":"code","c4cd6c99":"code","792edc49":"code","efd404ed":"code","262627f9":"code","3e0b7139":"code","604c3920":"code","9df61fce":"code","d92cfd5d":"code","4c826d95":"code","8a820e57":"code","51bdc3b9":"code","bc32fcf3":"code","ce80315f":"code","a3adeeb6":"code","b2ddcaa4":"code","11a27659":"code","4ca0911f":"code","f28bd76d":"code","cec607d6":"code","9a198831":"code","557e43dd":"markdown","f4dc864e":"markdown","a01632b9":"markdown","afc325eb":"markdown","fb3e9b36":"markdown","96f5461d":"markdown","eec087b3":"markdown","6d814d05":"markdown","77382844":"markdown","783e6368":"markdown","9c33ea2c":"markdown","492b3257":"markdown","29de1939":"markdown","53ac20ff":"markdown","94e9aab4":"markdown","e9cfac10":"markdown","e814b44b":"markdown","9cb8741c":"markdown"},"source":{"50dbb950":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport ipywidgets as wg\nfrom IPython.core.display import HTML\nimport matplotlib.animation as anim\nimport matplotlib.pyplot as plt\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","6a15187b":"plays_df = pd.read_csv('\/kaggle\/input\/nfl-big-data-bowl-2022\/plays.csv')\nprint(plays_df.shape)\nplays_df.head()","6af7e5a9":"plays_df['specialTeamsPlayType'].value_counts().plot.barh(figsize=(8,4), title=\"Special teams plays by type\")","5e680cfc":"kickoffs_df = plays_df.loc[plays_df['specialTeamsPlayType'] == 'Kickoff']\nkickoffs_df.head()","07237b3a":"kickoffs_df['specialTeamsResult'].value_counts().plot.barh(figsize=(9,4), title=\"Kickoffs by result\")","176595a3":"kickoff_returns_df = kickoffs_df.loc[kickoffs_df['specialTeamsResult'] == 'Return']\nkickoff_returns_df.head()","2db738c4":"kickoff_returns_df[['kickReturnYardage']].plot.hist(figsize=(14,6), title=\"Kickoff Return Yards Frequency\")","c4cd6c99":"ax = kickoff_returns_df[['possessionTeam', 'kickReturnYardage']].boxplot(by='possessionTeam', figsize=(14,10), vert=False)\nax.set_xlabel(None)\nax.set_title(None)","792edc49":"long_returns = kickoff_returns_df.loc[kickoff_returns_df['kickReturnYardage'] >= 50.0]\nlong_returns","efd404ed":"ax = long_returns.groupby('possessionTeam').size().plot.barh(figsize=(14,6), title=\"Kickoff returns Greater than 50 yds by kicking team\")\nax.set_ylabel('Kicking Team')","262627f9":"# Load one of the tracking data files so we have the details for the animation\ntracking_df = pd.read_csv('\/kaggle\/input\/nfl-big-data-bowl-2022\/tracking2018.csv')","3e0b7139":"def getPlayAnimation(df, playId=2956, gameId=2018090903, color_dict={'home': 'red', 'away': 'blue', 'football': 'brown'}):\n    # function to draw one frame\n    def plotFrame(i):\n        one_frame = one_play[ one_play['frameId'] == i+1 ]\n        ax.cla()\n\n        plt.xticks(range(0, 121, 10), fontsize=15)\n        ax.set_xticklabels([None, 'G', '10', '20', '30', '40', '50', '40', '30', '20', '10', 'G', None])\n        ax.tick_params(axis='x', colors='white')\n        \n        # Constants from frame to frame\n        ax.set_xlim([0, 120])\n        ax.set_ylim([0, 53.3])\n        for yardline in range(10, 111, 10):\n            ax.plot([yardline, yardline], [0, 53.3], c='white')\n        \n        # What changes\n        ax.scatter(one_frame['x'], one_frame['y'], c=one_frame['team'].transform(lambda x: color_dict[x]), s=64)\n        ax.set_title('Frame: {}'.format(i+1), fontsize=15, c='white')\n    \n    # Get df of tracking data for one play\n    one_play = df[(df['playId'] == playId) & (df['gameId'] == gameId)]\n    \n    fig, ax = plt.subplots(figsize=(12,6))\n    \n    # Don't show y-axis ticks or tick labels\n    ax.axes.get_yaxis().set_visible(False)\n    \n    # Set background colors\n    fig.patch.set_facecolor('xkcd:leaf green')\n    ax.set_facecolor('xkcd:leaf green')\n    \n    # Set the field border color and line width\n    for spine in ax.spines.values():\n        spine.set_edgecolor('white')\n        spine.set_linewidth(2.5)\n    \n    play_anim = anim.FuncAnimation(fig, plotFrame, frames=one_play['frameId'].max()-1, interval=100)\n    html = play_anim.to_html5_video()\n    plt.close(fig)\n    return HTML(html)","604c3920":"play_desc = long_returns.loc[139]['playDescription']\nplay_desc","9df61fce":"team_colors = {'home': 'xkcd:light turquoise',\n               'away': 'xkcd:cobalt',\n               'football': 'xkcd:mud'}\ngetPlayAnimation(tracking_df, playId=3300, gameId=2018090903, color_dict=team_colors)","d92cfd5d":"scouting_df = pd.read_csv('\/kaggle\/input\/nfl-big-data-bowl-2022\/PFFScoutingData.csv')\nscouting_df.head()","4c826d95":"# Keep the columns that are related to kickoffs\nkickoff_cols = ['gameId', 'playId', 'hangTime', 'kickType', 'kickDirectionIntended', 'kickDirectionActual', 'missedTackler',\n                'returnDirectionIntended', 'returnDirectionActual', 'kickoffReturnFormation', 'specialTeamsSafeties']\nkickoff_scouting_df = scouting_df[kickoff_cols]\nkickoff_scouting_df.head()","8a820e57":"# Merge the scouting data with the kickoffs that were returned.\nkickoff_returns_df = kickoff_returns_df.merge(kickoff_scouting_df, how='left', on=['gameId', 'playId'])\nkickoff_returns_df.head()","51bdc3b9":"kickoff_returns_df['kickType'].value_counts()","bc32fcf3":"ax = kickoff_returns_df[['kickType', 'kickReturnYardage']].boxplot(by='kickType', figsize=(14,6), vert=False)\nax.set_xlabel(None)\nax.set_title(None)","ce80315f":"kickoff_returns_df['kickoffReturnFormation'].value_counts()","a3adeeb6":"ax = kickoff_returns_df[['kickoffReturnFormation', 'kickReturnYardage']].boxplot(by='kickoffReturnFormation', figsize=(14,8), vert=False)\nax.set_xlabel(None)\nax.set_title(None)","b2ddcaa4":"kickoff_returns_df['hangTime'].plot.kde(figsize=(14, 3), title=\"Distribution of Kickoff Hang Times (s)\")","11a27659":"kickoff_returns_df.plot.scatter(x='hangTime', y='kickReturnYardage', figsize=(14,6), title=\"Kickoff Return Yards vs. Kick Hang Time (s)\")","4ca0911f":"kickoff_returns_df['kickDirectionIntended'].value_counts().plot.barh(figsize=(9,3), title=\"Intended Kick Direction\")","f28bd76d":"kickoff_returns_df['kickDirectionActual'].value_counts().plot.barh(figsize=(9,3), title=\"Actual Kick Direction\")","cec607d6":"(kickoff_returns_df['kickDirectionIntended'] == kickoff_returns_df['kickDirectionActual']).sum() \/ len(kickoff_returns_df)","9a198831":"missed_direction = kickoff_returns_df[kickoff_returns_df['kickDirectionIntended'] != kickoff_returns_df['kickDirectionActual']]\nmissed_direction['kickReturnYardage'].plot.kde(figsize=(14,3), title=\"Distribution of Return Yards on Missed Directional Kicks\")","557e43dd":"From both the histogram and the boxplot, we can see that most kickoff returns were concentrated around 20 yards, but there were several kickoffs that were returned for more than 100 yards. Those must have been for touchdowns, so let's look at that subset to see if there's anything in the description that indicates a TD. We can use that to get all kickoffs that were returned for a touchdown.","f4dc864e":"### Load plays data and see how many plays were kickoffs","a01632b9":"98.9% accuracy at anything is pretty impressive, but let's take a closer look at just those plays where the kick direction doesn't match the intended direction.","afc325eb":"Let's look at the first kickoff return for a touchdown in our data set, which has TEN kicking to MIA.","fb3e9b36":"Not surprisingly, most of the long returns were when the return team was in the most popular formation.\n\n### Is hang time related to return yardage?\n\nLet's look at the distribution of hang times of kicks and how it relates to return yards.","96f5461d":"Out of 19,979 total special teams plays in the dataset, nearly 8,000 were kickoffs, the most frequent type of special teams play.","eec087b3":"Again, there doesn't appear to be much relationship here. Since the vast majority of kickoffs have a hang time between 3.5 and 4.5 seconds, it makes sense that all of long returns would be on this type of kick.","6d814d05":"### What are the most common kick types and kickoff return formations?","77382844":"### How many kickoffs were returned?","783e6368":"### Visualize a Kickoff Return\n\nCredit to [Joseph Mohr](https:\/\/www.kaggle.com\/josephvm) for the following animation. I took the `getPlayAnimation` from his [NFL BDB 2022 - Play Animation & Tracking EDA](https:\/\/www.kaggle.com\/josephvm\/nfl-bdb-2022-play-animation-tracking-eda) notebook and modified it to look slightly more like a football field.","9c33ea2c":"So we can see that only 62 out of 2,921 kickoff returns resulted in a gains > 50 yds. About 2%. ","492b3257":"Well over half (4,773) of all kickoffs (7,843) went for a touchback. Only 2,921, or 37% were returned.","29de1939":"It makes sense that most kicks would be straight up the middle, since it's harder to kick the ball out of bounds that way, and easier to kick it through the end zone, which is what most teams are trying to do most of the time. Let's look at how often the intended kick direction doesn't match the actual direction.","53ac20ff":"Since the deep kick is the most common, it's also the kick type with the most returns for long yardage.\n\nThe kickoff formation is a 3-digit code indicating the number of players in the Front Wall, Mid Wall, and Back Wall during the kick. Let's look at which formations are most popular, then at the distribution of return yards for each formation.","94e9aab4":"### Which teams gave up the most kickoff returns for a touchdown?","e9cfac10":"### What's the average and maximum return yardage given up by each team?\n\nLet's start by looking at the distribution of return yards overall, then look at a boxplot for each team.","e814b44b":"### Kick type, direction, hang-time, and return formation\n\nLet's look at more attributes of the play by merging in the scouting data with the data on kickoffs that were returned.","9cb8741c":"### Is kick direction related to return yards?"}}