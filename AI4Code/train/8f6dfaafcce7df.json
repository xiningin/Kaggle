{"cell_type":{"37f1ecf9":"code","f6c2971f":"code","8c00fa1b":"code","c58e14c1":"code","3e1219a7":"code","7e8ad937":"code","4899f2ec":"code","9d094d6c":"code","503149f5":"code","e0c4c112":"code","5e4e3566":"code","0c56f5d2":"code","f805dd18":"code","58803ddf":"code","236ff508":"code","12273121":"code","68d5cf71":"code","13cecb02":"code","e9b30aa8":"code","e3540e96":"code","74985be8":"code","2db457c0":"code","d7bd5793":"code","df58b3f6":"code","2b63fb50":"code","d1fe6853":"code","046d258e":"code","d34effc1":"code","b97337fc":"code","3e182cb4":"markdown","f903469d":"markdown","2a8f8be2":"markdown","bd6210ec":"markdown","1d5a341d":"markdown","fb8ff837":"markdown","7af17521":"markdown","3e9fc403":"markdown","add80da4":"markdown","b1b9cb5a":"markdown","87c91e30":"markdown","5047a2e1":"markdown","0dc13326":"markdown","0141a660":"markdown","cb7d63c9":"markdown","5141faf8":"markdown","02e75ed0":"markdown","e5d29818":"markdown"},"source":{"37f1ecf9":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport matplotlib.image as mpimg\n%matplotlib inline\nimport seaborn as sns","f6c2971f":"airbnb=pd.read_csv(\"..\/input\/airbnb-rio\/Rio_listings.csv\")\nairbnb.head(10)","8c00fa1b":"#Quantas linhas?\nlen(airbnb)","c58e14c1":"#Quais os tipos de cada coluna?\nairbnb.dtypes","3e1219a7":"#Verificar se h\u00e1 dados que precisam ser removidos do dataset\nairbnb.isnull().sum()","7e8ad937":"# Excluindo as colunas:\nairbnb.drop(['id','host_name','last_review','neighbourhood_group','reviews_per_month'], axis=1, inplace=True)\n# Verificando como ficou:\nairbnb.head(5)","4899f2ec":"#examinando os valores \u00fanicos da vizinhan\u00e7a:\nairbnb.neighbourhood.unique()","9d094d6c":"#Quais s\u00e3o os tipos de Acomoda\u00e7\u00e3o?\nairbnb.room_type.unique()","503149f5":"#Come\u00e7aremos com host_id, descobrindo quantos hosts \u00fanicos temos, depois mostrar qual os maiores hosts.\ntop_host=airbnb.host_id.value_counts().head(10)\ntop_host","e0c4c112":"#S\u00f3 para confirmar nosso Top Host:\ntop_host_check=airbnb.calculated_host_listings_count.max()\ntop_host_check","5e4e3566":"#Tamanho da imagem\nsns.set(rc={'figure.figsize':(10,8)})","0c56f5d2":"viz_1=top_host.plot(kind='bar')\nviz_1.set_title('Host com maior n\u00famero de Neg\u00f3cios realizados')\nviz_1.set_ylabel('Neg\u00f3cios realizados')\nviz_1.set_xlabel('Host IDs')\nviz_1.set_xticklabels(viz_1.get_xticklabels(), rotation=45)","f805dd18":"#Vamos descobrir mais sobre as regi\u00f5es: 'Copacabana', 'Ipanema', 'Barra da Tijuca', 'Flamengo', 'Leblon'\n\n#Copacabana\nsub_1=airbnb.loc[airbnb['neighbourhood'] == 'Copacabana']\nprice_sub1=sub_1[['price']]\n#Ipanema\nsub_2=airbnb.loc[airbnb['neighbourhood'] == 'Ipanema']\nprice_sub2=sub_2[['price']]\n#Barra da Tijuca\nsub_3=airbnb.loc[airbnb['neighbourhood'] == 'Barra da Tijuca']\nprice_sub3=sub_3[['price']]\n#Flamengo\nsub_4=airbnb.loc[airbnb['neighbourhood'] == 'Flamengo']\nprice_sub4=sub_4[['price']]\n#Leblon\nsub_5=airbnb.loc[airbnb['neighbourhood'] == 'Leblon']\nprice_sub5=sub_5[['price']]\n#putting all the prices' dfs in the list\nprice_list_by_n=[price_sub1, price_sub2, price_sub3, price_sub4, price_sub5]","58803ddf":"#Criando uma lista vazia para ser preenchida:\np_l_b_n_2=[]\n#Criando uma lista para nosso objeto de estudo\nnei_list=['Copacabana', 'Ipanema', 'Barra da Tijuca', 'Flamengo', 'Leblon']\n#Colocando o range de pre\u00e7os na nossa lista\nfor x in price_list_by_n:\n    i=x.describe(percentiles=[.25, .50, .75])\n    i=i.iloc[3:]\n    i.reset_index(inplace=True)\n    i.rename(columns={'index':'Stats'}, inplace=True)\n    p_l_b_n_2.append(i)\n#Trocando o nome da coluna de pre\u00e7o para o nome da \u00e1rea, para ficar mais f\u00e1cil de ler:\np_l_b_n_2[0].rename(columns={'price':nei_list[0]}, inplace=True)\np_l_b_n_2[1].rename(columns={'price':nei_list[1]}, inplace=True)\np_l_b_n_2[2].rename(columns={'price':nei_list[2]}, inplace=True)\np_l_b_n_2[3].rename(columns={'price':nei_list[3]}, inplace=True)\np_l_b_n_2[4].rename(columns={'price':nei_list[4]}, inplace=True)\n#Finalizando o dataframe:   \nstat_df=p_l_b_n_2\nstat_df=[df.set_index('Stats') for df in stat_df]\nstat_df=stat_df[0].join(stat_df[1:])\nstat_df","236ff508":"sub_6=airbnb.loc[airbnb['neighbourhood'].isin(['Copacabana','Barra da Tijuca','Ipanema','Leblon','Flamengo'])]","12273121":"#Criando um dataframe com os 5 bairros estudados:\ntop_5= sub_6\n#using violinplot to showcase density and distribtuion of prices \nviz_2=sns.violinplot(data=top_5, x='neighbourhood', y='price')\nviz_2.set_title('Density and distribution of prices for each neighberhood')","68d5cf71":"#Descobrindo os top 10:\nairbnb.neighbourhood.value_counts().head(10)","13cecb02":"#Fazendo um data frame para os 10 maiores bairros:\nsub_7=airbnb.loc[airbnb['neighbourhood'].isin(['Copacabana','Barra da Tijuca','Ipanema','Jacarepagu\u00e1',\n                 'Botafogo ','Recreio dos Bandeirantes','Leblon','Santa Teresa','Centro','Flamengo'])]\n#Mostrando os diferentes tipos de acomoda\u00e7\u00e3o nos top 10:\nviz_3=sns.catplot(x='neighbourhood', hue='neighbourhood', col='room_type', data=sub_7, kind='count')\nviz_3.set_xticklabels(rotation=90)","e9b30aa8":"#Realizando um Scatterplot utilizando os dados de latitude e longitude. Estamos utilizando os 5 bairros estudados.\nviz_4=sub_6.plot(kind='scatter', x='longitude', y='latitude', label='availability_365', c='price',\n                  cmap=plt.get_cmap('jet'), colorbar=True, alpha=0.4, figsize=(10,8))\nviz_4.legend()","e3540e96":"#print(airbnb['latitude'].min)\n#print(airbnb['longitude'].min)\n#print(airbnb['latitude'].max)\n#print(airbnb['longitude'].max)","74985be8":"import folium\nfrom folium.plugins import HeatMap\nm=folium.Map([-22.96592,-43.17896],zoom_start=11)\nHeatMap(airbnb[['latitude','longitude']].dropna(),radius=8,gradient={0.2:'blue',0.4:'purple',0.6:'orange',1.0:'red'}).add_to(m)\ndisplay(m)","2db457c0":"#Vamos analisar a coluna Names:\n#Onde vamos colocar nossas strings:\n_names_=[]\n#Pegando a Name e colocando ela na lista:\nfor name in airbnb.name:\n    _names_.append(name)\n#Splitando a String \ndef split_name(name):\n    spl=str(name).split()\n    return spl\n#Criando a coluna em que vamos contar quanto a string aparece:\n_names_for_count_=[]\n#getting name string from our list and using split function, later appending to list above\n#Pegando a _name_ da nossa lista nova e usando a fun\u00e7\u00e3o de split para contar as palavras.\nfor x in _names_:\n    for word in split_name(x):\n        word=word.lower()\n        _names_for_count_.append(word)","d7bd5793":"#Usando a fun\u00e7\u00e3o Counter:\nfrom collections import Counter\n#Identificando as 25 palavras mais usadas:\n_top_25_w=Counter(_names_for_count_).most_common()\n_top_25_w=_top_25_w[0:25]","df58b3f6":"#Criando um dataframe para plotar nossas novas informa\u00e7\u00f5es:\nsub_w=pd.DataFrame(_top_25_w)\nsub_w.rename(columns={0:'Words', 1:'Count'}, inplace=True)","2b63fb50":"#Plotando, usando Barplot:\nviz_5=sns.barplot(x='Words', y='Count', data=sub_w)\nviz_5.set_title('Counts of the top 25 used words for listing names')\nviz_5.set_ylabel('Count of words')\nviz_5.set_xlabel('Words')\nviz_5.set_xticklabels(viz_5.get_xticklabels(), rotation=80)","d1fe6853":"#Vamos ver os top10 Reviews:\ntop_reviewed_listings=airbnb.nlargest(10,'number_of_reviews')\ntop_reviewed_listings","046d258e":"price_avrg=top_reviewed_listings.price.mean()\nprint('Average price per night: {}'.format(price_avrg))","d34effc1":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nplt.style.use('fivethirtyeight')\nmatplotlib.rcParams['font.family'] = \"Arial\"\nfrom plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot\nimport plotly as py\nimport plotly.graph_objs as go\nfrom plotly.subplots import make_subplots\nimport collections\nimport itertools\nimport scipy.stats as stats\nfrom scipy.stats import norm\nfrom scipy.special import boxcox1p\nimport statsmodels\nimport statsmodels.api as sm\nfrom sklearn.preprocessing import scale, StandardScaler, RobustScaler, OneHotEncoder\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.compose import ColumnTransformer\nfrom sklearn.model_selection import train_test_split, cross_val_score, GridSearchCV, KFold, StratifiedKFold, RandomizedSearchCV\nfrom sklearn.linear_model import Ridge, RidgeCV, Lasso, LassoCV, LinearRegression, ElasticNet,  HuberRegressor\nfrom sklearn.metrics import mean_squared_error, r2_score\nfrom xgboost import XGBRegressor\nfrom sklearn.gaussian_process import GaussianProcessRegressor\nfrom sklearn.ensemble import RandomForestRegressor, GradientBoostingRegressor\nfrom sklearn.svm import SVR\nfrom sklearn.kernel_ridge import KernelRidge\nfrom sklearn.utils import resample\nfrom xgboost import XGBRegressor\n#Model interpretation modules\nimport eli5\nimport lime\nimport lime.lime_tabular\nimport shap\nshap.initjs()\nimport warnings\nwarnings.filterwarnings(\"ignore\", category=FutureWarning)","b97337fc":"fig, axes = plt.subplots(1,3, figsize=(21,6))\nsns.distplot(airbnb['price'], ax=axes[0])\nsns.distplot(np.log1p(airbnb['price']), ax=axes[1])\naxes[1].set_xlabel('log(1+price)')\nsm.qqplot(np.log1p(airbnb['price']), stats.norm, fit=True, line='45', ax=axes[2])","3e182cb4":"Top reviews possui **372** reviews.\n\nPre\u00e7o m\u00e9dio das acomoda\u00e7\u00f5es por noite: **214,7**\n\n**9\/10** S\u00e3o casas inteiras,** 1\/10** s\u00e3o \"Private Room\"","f903469d":"Neste momento, \u00e9 necess\u00e1rio tomar a decis\u00e3o se \u00e9 necess\u00e1rio ou n\u00e3o manter algumas categorias.\nTiramos estas vari\u00e1veis:\n'id','host_name','last_review','neighbourhood_group','reviews_per_month'\n\nID e Host_name - Por quest\u00f5es de \u00e9tica, n\u00e3o s\u00e3o necess\u00e1rias nesse modelo, mesmo que poder\u00edamos tra\u00e7ar um perfil e desenvolver um algoritmo para prever a chance da pessoa utilizar o aplicativo. N\u00e3o \u00e9 o nosso intuito.\n\nLast_review, neighbourhood_group e reviews_per_month - Irrelev\u00e2ncia no modelo.\n \nEmbora informa\u00e7\u00f5es sobre qual categoria da vizinhan\u00e7a poderiam ser relevantes no modelo, em nosso dataset estes dados est\u00e3o vazios.","2a8f8be2":"Palavras-chave em ingl\u00eas podem significar a procura por turismo internacional, principalmente nas praias.","bd6210ec":"##### Aqui conseguimos observar que os maiores valores est\u00e3o na categoria de \"Entire home\/apt\" e \"Private room\", quase sem espa\u00e7o para Shared room e Hotel room.","1d5a341d":"### Adquirindo os dados:\n##### Importando as bibliotecas necess\u00e1rias:","fb8ff837":"#### Com o mapa devidamente plotado, podemos verificar a alta densidade no Leste do rio de janeiro, at\u00e9 antes de niter\u00f3i.","7af17521":"### Conclus\u00e3o da An\u00e1lise Explorat\u00f3ria dos Dados:\n\nEm andamento","3e9fc403":"### An\u00e1lise Explorat\u00f3ria dos Dados\n \n##### Disponibilizados pelo AirBnb: http:\/\/insideairbnb.com\/get-the-data.html","add80da4":"Boa distribui\u00e7\u00e3o, o maior Host possui mais de 200 acomoda\u00e7\u00f5es.","b1b9cb5a":"##### Vamos tentar utilizar o pacote Folium para representa\u00e7\u00e3o no mapa, para isso, utilizamos as informa\u00e7\u00f5es de longitude e latitute disponibilizado nos dados,","87c91e30":"##### Tentar entender isso:\n\nO gr\u00e1fico est\u00e1 muito distorcido devido a presen\u00e7a de outliers, vamos identificar uma forma de limpar para facilitar a visualiza\u00e7\u00e3o.","5047a2e1":"Valores impac","0dc13326":"### Parte 2 - Criando os modelos de previs\u00e3o","0141a660":"##### Neste momento, \u00e9 necess\u00e1rio limpar estes dados.","cb7d63c9":"### Explorando de fato os dados\nVamos entender qual \u00e9 o High User, e demonstrar seu local na distribui\u00e7\u00e3o, al\u00e9m de entender cada uma das colunas e como elas podem nos ajudar na constru\u00e7\u00e3o do modelo de previs\u00e3o.","5141faf8":"Vamos testar os seguintes modelos:\n\nRegress\u00e3o Linear e Random Forest:","02e75ed0":"##### Overview do notebook:\n\nEste dataset possui em torno de 33.715 observa\u00e7\u00f5es com 16 colunas, as categorias est\u00e3o misturadas em textos e valores num\u00e9ricos.","e5d29818":"Em um primeiro momento, irei realizar uma an\u00e1lise destes dados, para depois avan\u00e7ar na cria\u00e7\u00e3o de um Modelo de previs\u00e3o de pre\u00e7os de im\u00f3veis do AirBnb no Rio, de maneira semelhante como ja \u00e9 feito na sugest\u00e3o dos pre\u00e7os no pr\u00f3prio aplicativo, tentarei replicar esse algoritmo de uma forma diferente."}}