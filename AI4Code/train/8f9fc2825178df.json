{"cell_type":{"5b19f0bb":"code","a6289ca9":"code","d893e357":"code","3a45c805":"code","acd132cc":"code","20a75f90":"code","1a8145d5":"code","98a7169f":"code","33b7a9d5":"code","2b990bb3":"code","4525f65d":"code","6af0023f":"code","d0b9a926":"code","fc4125f8":"code","5bd2e0ea":"code","3a3bdf90":"markdown","82fa2cde":"markdown"},"source":{"5b19f0bb":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nfrom sklearn.preprocessing import LabelEncoder\nimport sklearn\nfrom tqdm.notebook import tqdm\n\ny_label = pd.read_csv('\/kaggle\/input\/lish-moa\/train_targets_scored.csv')\nX_train = pd.read_csv('\/kaggle\/input\/lish-moa\/train_features.csv')\nX_test = pd.read_csv('\/kaggle\/input\/lish-moa\/test_features.csv')\nsumple_submission = pd.read_csv('\/kaggle\/input\/lish-moa\/sample_submission.csv')","a6289ca9":"train = pd.merge(X_train,y_label,on=\"sig_id\")\nX_train = X_train.drop(\"sig_id\",axis=1)\ny_label = y_label.drop(\"sig_id\",axis=1)","d893e357":"cp_time = {24: 1,48: 2, 72:3}\ncp_dose = {'D1': 1,'D2': 2}\ncp_type = {'trt_cp':1, 'ctl_vehicle':0 }\n\n\nX_train['cp_time'] = X_train['cp_time'].map(cp_time)\nX_train['cp_dose'] = X_train['cp_dose'].map(cp_dose)\nX_train['cp_type'] = X_train['cp_type'].map(cp_type)\n\nX_test['cp_time'] = X_test['cp_time'].map(cp_time)\nX_test['cp_dose'] = X_test['cp_dose'].map(cp_dose)\nX_test['cp_type'] = X_test['cp_type'].map(cp_type)","3a45c805":"col = np.array(y_label.columns)\nX = np.empty(shape=X_train.shape)\nY = []\ntemp = y_label.values\nfor i,v in tqdm(enumerate(X_train.values)):\n    index = [k for k, i in enumerate(temp[i]) if i == 1] #checks if label contains 1\n    X[i] = v\n    if index:\n        Y.append(\":\".join(col[index]))\n    else:\n        Y.append(\"no\")\nprint(len(set(Y)))\nX[:3,:5],Y[0]","acd132cc":"target = dict(zip(list(set(Y)),range(len(set(Y)))))\nrev = dict(range(len(set(Y))),zip(list(set(Y))))\nlen(target)","20a75f90":"def get_target(value):\n    if \":\" in value:\n        out = np.zeros(col.shape)\n        for v in value.split(\":\"):\n            out[np.where(col==v)[0]] = 1.0\n        return out\n    elif value == \"no\":\n        return np.zeros(col.shape)\n    else:\n        out = np.zeros(col.shape)\n        out[np.where(col==value)[0]]=1.0\n        return out","1a8145d5":"y = pd.Series(Y).replace(target)\nX.shape,y.shape","98a7169f":"del y_label,X_train,X_test,train\nimport gc\ngc.collect()","33b7a9d5":"# BaggingClassifier(base_estimator=SVC(),n_estimators=10, random_state=0)","2b990bb3":"from sklearn.svm import SVC\nfrom sklearn.model_selection import StratifiedKFold\nfrom sklearn.metrics import accuracy_score\nimport tensorflow as tf\nkf = StratifiedKFold(n_splits=50)\nlog_loss = []\nfor train_index, test_index in kf.split(X,y):\n    #print(\"TRAIN:\", train_index, \"TEST:\", test_index)\n    X_train, X_test = X[train_index], X[test_index]\n    y_train, y_test = y[train_index], y[test_index]\n    model = SVC()\n    model.fit(X_train,y_train)\n    pred = model.predict(X_test)\n    y_p = np.empty((y_test.shape[0],206))\n    y_t = np.empty((y_test.shape[0],206))\n    y_test = y_test.reset_index(drop=True)\n    print(accuracy_score(y_test,pred))\n    #print(log_loss(y_test,pred))\n    for i,v in y_test.iteritems():\n        y_t[i] = get_target(rev[v])\n        y_p[i] = get_target(rev[pred[i]])\n    loss = tf.keras.losses.binary_crossentropy(y_t, y_p).numpy().mean()\n    print(loss)\n    log_loss.append(loss)\nnp.mean(log_loss)","4525f65d":"# from sklearn.svm import SVC\n# from sklearn.ensemble import RandomForestClassifier,AdaBoostClassifier,ExtraTreesClassifier,GradientBoostingClassifier,StackingClassifier,BaggingClassifier\n# estimators = [('rf', RandomForestClassifier(n_estimators=10, random_state=42)),(\"svc\",SVC())]\n# clf = StackingClassifier(estimators=estimators, final_estimator=RandomForestClassifier())","6af0023f":"# clf.fit(X,y)   ","d0b9a926":"import pickle\nfilename = 'finalized_model.pkl'\npickle.dump(model, open(filename, 'wb'))","fc4125f8":"#model.predit(X)","5bd2e0ea":"#pred.to_csv('submission.csv', index = False)","3a3bdf90":"# **The below code transformes the mutilabel problem into multiclass**","82fa2cde":"Pay attention on the last column which is the multiclass label"}}