{"cell_type":{"10961eac":"code","1cd68ca2":"code","403940ca":"code","64157880":"code","a421aa36":"code","3d7592de":"code","58a6d0d1":"code","82eef5de":"code","fae8be0e":"code","9b0018e1":"code","c4363cd9":"code","f3cf9f76":"code","a1b36986":"code","7412faf6":"code","9238e819":"code","25a4297c":"code","604de5a8":"code","6012febb":"code","1712a61e":"code","853b984a":"code","fcda7486":"code","5be39849":"code","ef38c150":"code","2f746275":"code","67367e6e":"code","f492ee3a":"code","a63fb0da":"code","859ba8c6":"code","aff2f6f1":"code","50a453fe":"code","ab56e6f3":"markdown","e082575e":"markdown","bd57dce1":"markdown","8b519e5b":"markdown","3a029632":"markdown","cfd41eba":"markdown","7ce5523d":"markdown","eb991608":"markdown","96a2e47d":"markdown","f1d7653f":"markdown","192bf748":"markdown","cdf7f8d3":"markdown"},"source":{"10961eac":"from IPython.display import YouTubeVideo\nYouTubeVideo('QdwuHKwOLRU', width=800, height=300)\n","1cd68ca2":"!pip install tensorflow_io","403940ca":"import pandas as pd \nimport os\nimport matplotlib.pyplot as plt \nimport numpy as np \nimport tensorflow as tf\nimport tensorflow_io as tfio \nimport matplotlib.image as mpimg\nimport seaborn as sns \nimport pydicom\nsns.set_palette(\"bright\")","64157880":"df=pd.read_csv(\"..\/input\/osic-pulmonary-fibrosis-progression\/train.csv\")","a421aa36":"(sns.countplot(df.Sex)).figure.savefig(\"output1.png\")\n","3d7592de":"fig, axs = plt.subplots(ncols=3)\nfig.set_size_inches(19,6)\nsns.countplot(df['SmokingStatus'],ax=axs[0])\nsns.countplot(df['SmokingStatus'][df['Sex']==\"Male\"],ax=axs[1])\nsns.countplot(df['SmokingStatus'][df['Sex']==\"Female\"],ax=axs[2])\nfig.savefig(\"output2.jpeg\")","58a6d0d1":"fig, ax = plt.subplots()\nfig.set_size_inches(11.7, 8.27)\nsns.distplot(df.Age,kde=False,bins=80,color=\"k\")\nfig.savefig(\"output3.jpeg\")","82eef5de":"def create_last_scan_df():\n    last_test=pd.DataFrame()    \n    for i in df.Patient.unique():\n        last_test=last_test.append((df[df['Patient']==\"{}\".format(i)][-1:]))\n    last_test=last_test.drop(\"Patient\",axis=1)\n    last_test=last_test.drop(\"Weeks\",axis=1)\n    return last_test\ndd=create_last_scan_df()\ndd=dd.reset_index(drop=True)\ndd.head()","fae8be0e":"def create_baseline():\n    first_scan=pd.DataFrame()    \n    for i in df.Patient.unique():\n        first_scan=first_scan.append((df[df['Patient']==\"{}\".format(i)][:1]))\n    first_scan=first_scan.drop(\"Patient\",axis=1)\n    first_scan=first_scan.drop(\"Weeks\",axis=1)\n    return first_scan\nfc=create_baseline()\nfc=fc.reset_index(drop=True)\nfc.head()","9b0018e1":"(sns.pairplot(df,hue=\"SmokingStatus\",height=4)).savefig(\"output4.jpeg\")\n","c4363cd9":"sns.pairplot(fc,hue=\"SmokingStatus\",height=4).savefig(\"output5.jpeg\")","f3cf9f76":"(sns.pairplot(dd,hue=\"Sex\",height=4)).savefig(\"output6.jpeg\")","a1b36986":"(sns.pairplot(dd,hue=\"SmokingStatus\",height=4)).savefig(\"output7.jpeg\")\n","7412faf6":"(sns.pairplot(fc,hue=\"Sex\",height=4)).savefig(\"output8.jpeg\")\n","9238e819":"ex_smoker_male=df.loc[df['Patient']=='{}'.format((df.loc[(df[\"Sex\"]==\"Male\") & (df[\"SmokingStatus\"]==\"Ex-smoker\"),'Patient'][:1].values[0]))]\nex_smoker_female=df.loc[df['Patient']=='{}'.format((df.loc[(df[\"Sex\"]==\"Female\") & (df[\"SmokingStatus\"]==\"Ex-smoker\"),'Patient'][:1].values[0]))]\nnon_smoker_male=df.loc[df['Patient']=='{}'.format((df.loc[(df[\"Sex\"]==\"Male\") & (df[\"SmokingStatus\"]==\"Never smoked\"),'Patient'][:1].values[0]))]\nnon_smoker_female=df.loc[df['Patient']=='{}'.format((df.loc[(df[\"Sex\"]==\"Female\") & (df[\"SmokingStatus\"]==\"Never smoked\"),'Patient'][:1].values[0]))]\ncurrent_smoker_male=df.loc[df['Patient']=='{}'.format((df.loc[(df[\"Sex\"]==\"Male\") & (df[\"SmokingStatus\"]==\"Currently smokes\"),'Patient'][:1].values[0]))]\ncurrent_smoker_female=df.loc[df['Patient']=='{}'.format((df.loc[(df[\"Sex\"]==\"Female\") & (df[\"SmokingStatus\"]==\"Currently smokes\"),'Patient'][:1].values[0]))]","25a4297c":"fig, ax = plt.subplots(nrows=2)\nfig.set_size_inches(22, 8.27)\nsns.lineplot(x='Weeks',y='Percent',data=df,ax=ax[0])\nsns.lineplot(x='Weeks',y='FVC',data=df,ax=ax[1])\nfig.savefig(\"weeksvsfvc.jpeg\")\n","604de5a8":"males=df[df[\"Sex\"]==\"Male\"]\nfemales=df[df[\"Sex\"]==\"Female\"]","6012febb":"fig, ax = plt.subplots(nrows=4)\nfig.set_size_inches(22, 22)\nsns.lineplot(x='Weeks',y='FVC',data=males,ax=ax[0]).set_title(\"MALES FVC TREND\")\nsns.lineplot(x='Weeks',y='FVC',data=females,ax=ax[1]).set_title(\"FEMALE FVC TREND\")\nsns.lineplot(x='Weeks',y='Percent',data=males,ax=ax[2]).set_title(\"MALES PERCENT TREND\")\nsns.lineplot(x='Weeks',y='Percent',data=females,ax=ax[3]).set_title(\"FEMALE PERCENT TREND\")\nfig.savefig(\"mvffvctrend.jpeg\")\n","1712a61e":"smoker=df[df[\"SmokingStatus\"]==\"Ex-smoker\"]\nnever_smoked=df[df[\"SmokingStatus\"]==\"Never smoked\"]\ncurrent_smoker=df[df[\"SmokingStatus\"]==\"Currently smokes\"]","853b984a":"fig, ax = plt.subplots(nrows=6)\nfig.set_size_inches(22, 35)\nsns.lineplot(x='Weeks',y='FVC',data=smoker,ax=ax[0]).set_title(\"EX SMOKER FVC TREND\")\nsns.lineplot(x='Weeks',y='FVC',data=never_smoked,ax=ax[1]).set_title(\"NON SMOKER FVC TREND\")\nsns.lineplot(x='Weeks',y='FVC',data=current_smoker,ax=ax[2]).set_title(\"SMOKER FVC TREND\")\nsns.lineplot(x='Weeks',y='Percent',data=smoker,ax=ax[3]).set_title(\"EX SMOKER PERCENT  TREND\")\nsns.lineplot(x='Weeks',y='Percent',data=never_smoked,ax=ax[4]).set_title(\"NON SMOKER PERCENT TREND\")\nsns.lineplot(x='Weeks',y='Percent',data=current_smoker,ax=ax[5]).set_title(\"SMOKER PERCENT TREND\")\nfig.savefig(\"weeksvpercent.jpeg\")\n","fcda7486":"fig, ax = plt.subplots()\nfig.set_size_inches(22,5)\nsns.lineplot(x=ex_smoker_male[\"Weeks\"], y=ex_smoker_male[\"FVC\"],label='ex_smoker_male')\nsns.lineplot(x=ex_smoker_female[\"Weeks\"], y=ex_smoker_female[\"FVC\"],label='ex_smoker_female')\nsns.lineplot(x=non_smoker_male[\"Weeks\"], y=non_smoker_male[\"FVC\"],label='non_smoker_male')\nsns.lineplot(x=non_smoker_female[\"Weeks\"], y=non_smoker_female[\"FVC\"],label='non_smoker_female')\nsns.lineplot(x=current_smoker_male[\"Weeks\"], y=current_smoker_male[\"FVC\"],label='current_smoker_male')\nsns.lineplot(x=current_smoker_female[\"Weeks\"], y=current_smoker_female[\"FVC\"],label='current_smoker_female')\nfig.savefig(\"smoker_current_fvc.jpeg\")\n","5be39849":"fig, ax = plt.subplots()\nfig.set_size_inches(22,5)\nsns.lineplot(x=ex_smoker_male[\"Weeks\"], y=ex_smoker_male[\"Percent\"],label='ex_smoker_male')\nsns.lineplot(x=ex_smoker_female[\"Weeks\"], y=ex_smoker_female[\"Percent\"],label='ex_smoker_female')\nsns.lineplot(x=non_smoker_male[\"Weeks\"], y=non_smoker_male[\"Percent\"],label='non_smoker_male')\nsns.lineplot(x=non_smoker_female[\"Weeks\"], y=non_smoker_female[\"Percent\"],label='non_smoker_female')\nsns.lineplot(x=current_smoker_male[\"Weeks\"], y=current_smoker_male[\"Percent\"],label='current_smoker_male')\nsns.lineplot(x=current_smoker_female[\"Weeks\"], y=current_smoker_female[\"Percent\"],label='current_smoker_female')\nfig.savefig(\"sdad.jpeg\")\n","ef38c150":"files=[]\nfor dirname, _, filenames in os.walk('..\/input\/osic-pulmonary-fibrosis-progression\/train'):\n    for filename in filenames:\n        files.append(os.path.join(dirname, filename))","2f746275":"def decode_image(image_path):\n    image_bytes = tf.io.read_file(image_path)\n    image = tfio.image.decode_dicom_image(image_bytes, dtype=tf.uint16)\n    image=np.squeeze(image.numpy())\n    return image ","67367e6e":"def show_scan(image):\n    img = decode_image(image)\n    patient_name=str(image).split('\/')[1]\n    fig, ax = plt.subplots()\n    im=ax.imshow(img,cmap='twilight_r')\n    plt.axis('off')\n    plt.title(\"Baseline CT Scan of Patient {}\".format(patient_name))\n    fig.set_size_inches(9,9)\n    plt.show()","f492ee3a":"show_scan(files[3])","a63fb0da":"def choose_patient(ID):\n    images_x=[]\n    for i in files:\n        name=str(i)\n        if str(ID) in name:\n            images_x.append(i)\n    return sorted(images_x)\n\ndef generate_images(images):\n    for x,i in enumerate(images):\n        image=decode_image(i)   \n        fname=str(x)+\".png\"\n        plt.imsave(fname,image,cmap='twilight_shifted')    \n        \ndef make_progressive_video():\n    os.system(\"ffmpeg  -r 30 -i %d.png -vcodec mpeg4 -y -vb 400M patient_ct_scan_progression.mp4\")","859ba8c6":"patient_x=choose_patient(df['Patient'][288])\ngenerate_images(patient_x)\nmake_progressive_video()","aff2f6f1":"!rm -r *.png","50a453fe":"!ffmpeg -i patient_ct_scan_progression.mp4 out.gif","ab56e6f3":"## Baseline Data ","e082575e":"## Last Recorded Values","bd57dce1":"# FVC And Percent Tread Of All Patients Smoker Vs Non-Smoker\n","8b519e5b":"# FVC And Percent Trend Male Vs Female","3a029632":"## What is Forced Vital Capacity and how does Lung Function change with age, gender and smoking habbits.\n\nForced vital capacity (FVC) is the amount of air that can be forcibly exhaled from your lungs after taking the deepest breath possible, as measured by spirometry.\n\nForced expiratory volume is the most important measurement of lung function. It is used to:\n\n    1) Diagnose obstructive lung diseases such as asthma and chronic obstructive pulmonary disease (COPD).\n    \n    2) See how well medicines used to improve breathing are working.\n  \n    3) Check if lung disease is getting worse. Decreases in the FEV1 value may mean the lung disease is getting worse.\n    \n### Lung function can be divided into three categories: spirometry to assess the dynamic flow rates: forced expiratory volume in one second (FEV1), forced vital capacity (FVC), and FEV-1\/FVC ratio.\n\n\n## Change in Lung Function with Age [Non Smokers]\n\n\n![agevlf.jpg](attachment:agevlf.jpg)\n\nAge-related decline in forced expiratory volume in one second (FEV1)% predicted plotted as % of maximal at age 20 years against age.\n\nsource: https:\/\/www.ncbi.nlm.nih.gov\/pmc\/articles\/PMC2695176\n\nEffect of aging on respiratory system physiology and immunology\nGulshan Sharma1 and James Goodwin2\n\nClin Interv Aging. 2006 Sep; 1(3): 253\u2013260. Published online 2006 Sep. doi: 10.2147\/ciia.2006.1.3.253\n\n## Change in Lung Function with Age [Smokers vs Non Smokers]\n\n\n![smvage.gif](attachment:smvage.gif)\n\nThe natural history of lung function decline. Smokers who are susceptible to lung injury experience an increase in the rate of age-related loss in FEV1 compared with nonsmokers (red, green, and blue lines). After lung function declines to threshold levels, clinical symptoms develop (black dotted lines). When a smoker stops smoking, the rate of FEV1 loss again approximates to that of a nonsmoker (blue dotted line). (FEV1 = forced expiratory volume in one second.)\n\nsource: https:\/\/www.aafp.org\/afp\/2006\/0215\/p669.html\n\n\n## Change in Lung Function with Age [Males Vs Females]\n\n<img align=\"center\" width=\"900\"  src=\"https:\/\/github.com\/tkrsh\/osic-pulmonary-fibrosis-progression\/blob\/master\/files\/ssd.png?raw=true\"> \n  \n### The most conspicuous group differences at baseline for women were also mainly related to smoking, and the presence of respiratory symptoms: smokers had a greater risk of being in the \u2018accelerating decline\u2019\n\n\n\nsource: https:\/\/journals.plos.org\/plosone\/article?id=10.1371\/journal.pone.0197250\n\n    ","cfd41eba":"# Demographic analysis\n ","7ce5523d":"# Understanding Pulmonary Fibrosis Progression    \n\n  Pulmonary fibrosis is a progressive disease that naturally gets worse over time. This worsening is related to the amount of fibrosis (scarring) in the lungs. As this occurs, a person's breathing becomes more difficult, eventually resulting in   shortness of breath, even at rest.\n\n  Patients with pulmonary fibrosis experience disease progression at different rates. Some patients progress slowly and live with PF for many years, while others decline more quickly.\n\n  There is no cure for pulmonary fibrosis, but treatments can slow the progression of the disease in some people. \n  \n","eb991608":"![Gif](.\/out.gif)","96a2e47d":"# FVC and Percent Trend For All Patients","f1d7653f":"# Visualising Dicom Files ","192bf748":"### Using tensorflow_io to decode Dicom files","cdf7f8d3":"# FVC And Percent Trend Of Random Patients Of All Categories"}}