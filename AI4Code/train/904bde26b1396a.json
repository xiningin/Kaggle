{"cell_type":{"da1da2c3":"code","515858bc":"code","af0dad64":"code","477f1f02":"code","5c343c8c":"code","02508ecd":"code","bd154ddf":"code","b4aef063":"code","5b801088":"code","52ac4477":"code","d3b45886":"code","f3249762":"code","7744067a":"code","1d42e818":"code","3ecba86d":"code","e4b85403":"code","788efc30":"code","98c579e6":"code","27017b36":"code","8fb4cb76":"code","a5022a41":"code","f37cafdd":"code","14f5a654":"code","e0dc1630":"code","2d5e367d":"code","cccb38ba":"code","a98f5bac":"code","a00f95fa":"code","8fc1c3a4":"code","6f71c422":"code","d5abf2ae":"code","f4ac1446":"code","ceb2c615":"code","a2e9448c":"code","89e8ff2b":"code","7b285b33":"code","d0bd3bd6":"code","ae005935":"code","29166e26":"code","152dbed1":"code","22d80af6":"code","4b51aaed":"code","a555c4b9":"code","8edeb48f":"code","eb39f1b4":"code","6667dfa3":"code","63fd300c":"code","d881498c":"markdown","6d131bf8":"markdown","f90a6ba5":"markdown","46d6b0ee":"markdown","ddbe4f2f":"markdown","402c618d":"markdown","eafd567f":"markdown","12bcbfb9":"markdown","eee2de4c":"markdown","cbe21ed9":"markdown","5e095e55":"markdown","794e46ee":"markdown","f7bb9dd0":"markdown","f850e6d8":"markdown","180a8d61":"markdown","5846d71f":"markdown","03c543a2":"markdown","bf20b86c":"markdown","e02fea74":"markdown","35baf830":"markdown","b3874497":"markdown","dba4cbc6":"markdown","ee2cc3b7":"markdown","0588470d":"markdown","8694280b":"markdown","1bd107de":"markdown","e21b41c2":"markdown","ba427c89":"markdown"},"source":{"da1da2c3":"import numpy as np \nimport pandas as pd \nimport json\nimport os\nimport time\nimport random\n\nimport xgboost as xgb\nfrom sklearn.ensemble import RandomForestClassifier, AdaBoostClassifier\nfrom sklearn.model_selection import train_test_split, cross_val_score, GridSearchCV\nfrom sklearn.metrics import accuracy_score, cohen_kappa_score\n","515858bc":"train_df = pd.read_csv('..\/input\/train\/train.csv')\ntest_df = pd.read_csv('..\/input\/test\/test.csv')\n\nbreed_labels = pd.read_csv('..\/input\/breed_labels.csv')\ncolor_labels = pd.read_csv('..\/input\/color_labels.csv')\nstate_labels = pd.read_csv('..\/input\/state_labels.csv')\n\ntrain_sen = os.listdir('..\/input\/train_sentiment\/')\ntrain_meta = os.listdir('..\/input\/train_metadata\/')\n\ntest_sen = os.listdir('..\/input\/test_sentiment\/')\ntest_meta = os.listdir('..\/input\/test_metadata\/')\n\ntrain = 'train'\ntest = 'test'\n\nprint(train_df.shape)\nprint(test_df.shape)\nprint(len(train_sen))\nprint(len(test_sen))\nprint(len(train_meta))\nprint(len(test_meta))\n","af0dad64":"train_df.head()","477f1f02":"breed_labels.head()","5c343c8c":"state_labels.head()","02508ecd":"color_labels.head()","bd154ddf":"train_df['Type'].value_counts().plot.bar()","b4aef063":" def sen_score(df, sen_source, test_train ):   \n    sen = []\n    for i in df['PetID']:\n        a = i+'.json'\n        if a in sen_source:\n            x = '..\/input\/%s_sentiment\/%s' % (test_train, a)\n            with open(x, 'r') as f:\n                    sentiment = json.load(f)\n\n            y = sentiment['documentSentiment']['score']\n        else:\n            y = 0\n\n        sen.append(y)\n    return sen\n    \ntrain_df['sen_score'] = sen_score(train_df, train_sen, train)\ntest_df['sen_score'] = sen_score(test_df, test_sen, test)","5b801088":" def sen_mag(df, sen_source, test_train ):   \n    sen = []\n    for i in df['PetID']:\n        a = i+'.json'\n        if a in sen_source:\n            x = '..\/input\/%s_sentiment\/%s' % (test_train, a)\n            with open(x, 'r') as f:\n                    sentiment = json.load(f)\n\n            y = sentiment['documentSentiment']['magnitude']\n        else:\n            y = 0\n\n        sen.append(y)\n    return sen\n    \ntrain_df['sen_mag'] = sen_mag(train_df, train_sen, train)\ntest_df['sen_mag'] = sen_mag(test_df, test_sen, test)","52ac4477":"train_df['sen_score'].plot.hist()\n","d3b45886":"train_df['sen_mag'].plot.hist()","f3249762":"train_df['PhotoAmt'].value_counts().plot.bar()","7744067a":"def meta_red(df, meta_source, train_test = 'train_test'):    \n    meta = []\n    for i in df['PetID']:\n        a = i+'-1.json'\n        if a in meta_source:\n                x = '..\/input\/%s_metadata\/%s' % (train_test, a)\n                with open(x, 'r') as f:\n                    meta_r = json.load(f)\n                    y = meta_r['imagePropertiesAnnotation']['dominantColors']['colors'][0]['color']['red']\n        else:\n            y = 0\n\n        meta.append(y)\n    return meta\n \ntrain_df['meta_red'] = meta_red(train_df, train_meta, train)\ntest_df['meta_red'] = meta_red(test_df, test_meta, test)\n\n","1d42e818":"def meta_green(df, meta_source, train_test = 'train_test'):    \n    meta = []\n    for i in df['PetID']:\n        a = i+'-1.json'\n        if a in meta_source:\n                x = '..\/input\/%s_metadata\/%s' % (train_test, a)\n                with open(x, 'r') as f:\n                    meta_r = json.load(f)\n                    y = meta_r['imagePropertiesAnnotation']['dominantColors']['colors'][0]['color']['green']\n        else:\n            y = 0\n\n        meta.append(y)\n    return meta\n\ntrain_df['meta_green'] = meta_green(train_df, train_meta, train)\ntest_df['meta_green'] = meta_green(test_df, test_meta, test)","3ecba86d":"def meta_blue(df, meta_source, train_test = 'train_test'):    \n    meta = []\n    for i in df['PetID']:\n        a = i+'-1.json'\n        if a in meta_source:\n                x = '..\/input\/%s_metadata\/%s' % (train_test, a)\n                with open(x, 'r') as f:\n                    meta_r = json.load(f)\n                    y = meta_r['imagePropertiesAnnotation']['dominantColors']['colors'][0]['color']['blue']\n        else:\n            y = 0\n\n        meta.append(y)\n    return meta\n\ntrain_df['meta_blue'] = meta_blue(train_df, train_meta, train)\ntest_df['meta_blue'] = meta_blue(test_df, test_meta, test)","e4b85403":"def meta_score(df, meta_source, train_test = 'train_test'):    \n    meta = []\n    for i in df['PetID']:\n        a = i+'-1.json'\n        if a in meta_source:\n                x = '..\/input\/%s_metadata\/%s' % (train_test, a)\n                with open(x, 'r') as f:\n                    meta_r = json.load(f)\n                    y = meta_r['imagePropertiesAnnotation']['dominantColors']['colors'][0]['score']\n        else:\n            y = 0\n\n        meta.append(y)\n    return meta\n\ntrain_df['meta_score'] = meta_score(train_df, train_meta, train)\ntest_df['meta_score'] = meta_score(test_df, test_meta, test)","788efc30":"def meta_pixelfraction(df, meta_source, train_test = 'train_test'):    \n    meta = []\n    for i in df['PetID']:\n        a = i+'-1.json'\n        if a in meta_source:\n                x = '..\/input\/%s_metadata\/%s' % (train_test, a)\n                with open(x, 'r') as f:\n                    meta_r = json.load(f)\n                    y = meta_r['imagePropertiesAnnotation']['dominantColors']['colors'][0]['pixelFraction']\n        else:\n            y = 0\n\n        meta.append(y)\n    return meta\n\ntrain_df['meta_pixelfraction'] = meta_pixelfraction(train_df, train_meta, train)\ntest_df['meta_pixelfraction'] = meta_pixelfraction(test_df, test_meta, test)","98c579e6":"def meta_ver_x(df, meta_source, train_test = 'train_test'):    \n    meta = []\n    for i in df['PetID']:\n        a = i+'-1.json'\n        if a in meta_source:\n                x = '..\/input\/%s_metadata\/%s' % (train_test, a)\n                with open(x, 'r') as f:\n                    meta_r = json.load(f)\n                    y = meta_r['cropHintsAnnotation']['cropHints'][0]['boundingPoly']['vertices'][1]['x']\n        else:\n            y = 0\n\n        meta.append(y)\n    return meta\n\ntrain_df['meta_ver_x'] = meta_ver_x(train_df, train_meta, train)\ntest_df['meta_ver_x'] = meta_ver_x(test_df, test_meta, test)","27017b36":"def meta_ver_y(df, meta_source, train_test = 'train_test'):    \n    meta = []\n    for i in df['PetID']:\n        a = i+'-1.json'\n        if a in meta_source:\n                x = '..\/input\/%s_metadata\/%s' % (train_test, a)\n                with open(x, 'r') as f:\n                    meta_r = json.load(f)\n                    y = meta_r['cropHintsAnnotation']['cropHints'][0]['boundingPoly']['vertices'][3]['y']\n        else:\n            y = 0\n\n        meta.append(y)\n    return meta\n\ntrain_df['meta_ver_y'] = meta_ver_y(train_df, train_meta, train)\ntest_df['meta_ver_y'] = meta_ver_y(test_df, test_meta, test)","8fb4cb76":"def meta_conf(df, meta_source, train_test = 'train_test'):    \n    meta = []\n    for i in df['PetID']:\n        a = i+'-1.json'\n        if a in meta_source:\n                x = '..\/input\/%s_metadata\/%s' % (train_test, a)\n                with open(x, 'r') as f:\n                    meta_r = json.load(f)\n                    y = meta_r['cropHintsAnnotation']['cropHints'][0]['confidence']\n        else:\n            y = 0\n\n        meta.append(y)\n    return meta\n\ntrain_df['meta_conf'] = meta_conf(train_df, train_meta, train)\ntest_df['meta_conf'] = meta_conf(test_df, test_meta, test)","a5022a41":"train_df.head()","f37cafdd":"train_df['Age_in_yrs'] = [i\/\/12 for i in train_df['Age'] ]\ntrain_df['Age_in_yrs'].value_counts().plot.bar()","14f5a654":"test_df['Age_in_yrs'] = [i\/\/12 for i in test_df['Age']]\ntest_df['Age_in_yrs'].value_counts().plot.bar()","e0dc1630":"train_df.head()","2d5e367d":"def Cross(df):\n    cross = [1 if df['Breed1'][i] and df['Breed2'][i] != 0 else 0 for i in range(len(df['Breed1']))]\n    df['Cross_Y\/N'] = cross\n    return df\ntrain_df = Cross(train_df)\ntest_df  = Cross(test_df)\n\n ","cccb38ba":"def cross(df):    \n    cross = []\n    a = 0\n    for i in df['Breed1']:\n        cross.append(i*(df['Breed2'][a]+1))\n        a += 1\n    return cross\n\ntrain_df['Cross_BreedScore'] = cross(train_df)\ntest_df['Cross_BreedScore']  = cross(test_df)","a98f5bac":"train_df.head()","a00f95fa":"train_df.isnull().sum().plot.bar()","8fc1c3a4":"drop = ['Name', 'Age', 'Breed1','Breed2', 'RescuerID', 'PetID', 'Description']\ntrain = train_df.drop(drop, axis = 1)\ntest  = test_df.drop(drop, axis = 1)\n\nX = train.drop(['AdoptionSpeed'], axis = 1)\ny = train.AdoptionSpeed","6f71c422":"y.value_counts().plot.bar()","d5abf2ae":"test.head()","f4ac1446":"train.head()","ceb2c615":"def train_model(clf,X, y, val_x, val_y):\n    model = clf\n    #t1 = time()\n    model.fit(X, y)\n    #t2 = round((t1-time()), 3)\n    #t3 = time()\n    pred = model.predict(val_x)\n    #t4 = round((t3-time()), 3)\n    score = accuracy_score(pred, val_y)\n    ck_score = cohen_kappa_score(pred, val_y)\n    cross_score = cross_val_score(clf, X, y, scoring='accuracy', cv = 10)\n    \n    print(\"Model : %s\" % clf)\n    #print(\"Training Time : %d\" % t2)\n    #print(\"Prediction Time : %d\" % t4)\n    print(\"Accuracy : %s\" % score)\n    print(\"Cohem_Kappa : %s\" % ck_score)\n    print(\"Cross_Val_Score : %s\" % cross_score.mean())\n    ","a2e9448c":"#Train-Test Split\n\ntrain_X , val_X, train_y, val_y = train_test_split(X, y, random_state = 2, test_size = 0.2)\n","89e8ff2b":"clf1 = RandomForestClassifier()\nclf2 = AdaBoostClassifier()\nclf3 = xgb.XGBClassifier()","7b285b33":"train_model(clf1, train_X, train_y, val_X, val_y)\n","d0bd3bd6":"train_model(clf2, train_X, train_y, val_X, val_y)","ae005935":"train_model(clf3, train_X, train_y, val_X, val_y)","29166e26":"# You can try different combinations and check each scores until you are satisfied.\nmodel = xgb.XGBClassifier(base_score=0.5, booster='gbtree', colsample_bylevel=1,    \n       colsample_bytree=1, gamma=0.2, learning_rate=0.1\n                          , max_delta_step=0,\n       max_depth=5, min_child_weight=1, missing=None, n_estimators=140,\n       n_jobs=1, nthread=4, objective='multi:softprob', random_state=42,\n       reg_alpha=0.001, reg_lambda=1, scale_pos_weight=1, seed=27,\n       silent=True, subsample=1)                                                  ","152dbed1":"model.fit(train_X, train_y)","22d80af6":"pred = model.predict(val_X)\nscore = cohen_kappa_score(pred, val_y)\nacc = accuracy_score(pred, val_y) \n\nprint(\"Cohen Kappa : %s\" % score) # 0.2175871739419205\nprint(\"Accuracy : %s\" % acc) # 0.4171390463487829","4b51aaed":"n = random.randint(0, 100) # just for checking how my model works\nprint(list(val_y)[n])\nprint(list(pred)[n])","a555c4b9":"cross_val_score(model, X, y, scoring = 'accuracy', cv= 10).mean() #0.39845585964987384","8edeb48f":"model.fit(X, y)","eb39f1b4":"result = model.predict(test)\nresult","6667dfa3":"submission = pd.DataFrame({'PetID' : test_df.PetID, 'AdoptionSpeed' : result })\nsubmission.to_csv('submission.csv', index=False)","63fd300c":"submission['AdoptionSpeed'].value_counts().plot.bar()","d881498c":"# Missing values\n\nOkay now lets check are there any null values in our df. ","6d131bf8":"# Introduction\n\nIn this competition you will predict the speed at which a pet is adopted, based on the pet\u2019s listing on PetFinder. Sometimes a profile represents a group of pets. In this case, the speed of adoption is determined by the speed at which all of the pets are adopted. The data included text, tabular, and image data. See below for details. \nThis is a Kernels-only competition. At the end of the competition, test data will be replaced in their entirety with new data of approximately the same size, and your kernels will be rerun on the new data.","f90a6ba5":"# Model Bulding","46d6b0ee":"Checking our preprocessed df.","ddbe4f2f":"The same as name RescuerID and PetID are no important Features rather they could affect our model in a bad way.\nAs we have created synthetic features for Age, Breed1 & Breed2 we can count them out too.","402c618d":"# AdoptionSpeed\n\nContestants are required to predict this value. The value is determined by how quickly, if at all, a pet is adopted. The values are determined in the following way: \n* 0 - Pet was adopted on the same day as it was listed. \n* 1 - Pet was adopted between 1 and 7 days (1st week) after being listed. \n* 2 - Pet was adopted between 8 and 30 days (1st month) after being listed. \n* 3 - Pet was adopted between 31 and 90 days (2nd & 3rd month) after being listed. \n* 4 - No adoption after 100 days of being listed. (There are no pets in this dataset that waited between 90 and 100 days).","eafd567f":"I am a newbie so if there are any corrections please give them in the comments so that I can improve. And Iif you like the kernel please upvote it ;)","12bcbfb9":"### Our New Dataset","eee2de4c":"I will run my current data through three models and evaluate the best one and will tune it for my final model. The models that I will use are\n\n* RandomForestClassifier\n* AdaBoostClassifier\n* XGBClassifier","cbe21ed9":"Now from the metadata I've extracted the following features(*for the beginerrs sake I've only used the first image from all the images of a pet*)\n\n   * Red\n   * Green\n   * Blue\n   * Score\n   * PixelFraction\n   *  Vertex X\n   * Vertex Y\n   * Confidence\n   \n  Then made each column for them in both training and testing data.","5e095e55":"After the evaluation XGBClassifier outperforms the other two classifiers.So I'll go with XGB","794e46ee":"Seems like every df has atleast 1 image so we are good to go.","f7bb9dd0":"# Submission\n\nAhh... We have trained a model and sucessfully obtained predictions from it and it's time to submit them.","f850e6d8":"## Age\n\nAge of pet are listed  in months so we need to convert them to years.","180a8d61":"# File descriptions\n\n* train.csv - Tabular\/text data for the training set\n* test.csv - Tabular\/text data for the test set\n* sample_submission.csv - A sample submission file in the correct format\n* breed_labels.csv - Contains Type, and BreedName for each BreedID. Type 1 is dog, 2 is cat.\n* color_labels.csv - Contains ColorName for each ColorID\n* state_labels.csv - Contains StateName for each StateID","5846d71f":"# Final Model\n\nAfter satisfied with your tuning results you can use that model to fit the entire dataset and predict the result.","03c543a2":"From thegraph above is clearly understood that Name and Description column are having some Null values. As Name is not an important feature we can Drop it and From the sentiment analysis we took all the important features from Description also.So we can drop'em both. ","bf20b86c":"Splitting our data into training and testing data","e02fea74":"# Data Fields\n\n* PetID - Unique hash ID of pet profile\n* AdoptionSpeed - Categorical speed of adoption. Lower is faster. This is the value to predict. See below section for more info.\n* Type - Type of animal (1 = Dog, 2 = Cat)\n* Name - Name of pet (Empty if not named)\n* Age - Age of pet when listed, in months\n* Breed1 - Primary breed of pet (Refer to BreedLabels dictionary)\n* Breed2 - Secondary breed of pet, if pet is of mixed breed (Refer to BreedLabels dictionary)\n* Gender - Gender of pet (1 = Male, 2 = Female, 3 = Mixed, if profile represents group of pets)\n* Color1 - Color 1 of pet (Refer to ColorLabels dictionary)\n* Color2 - Color 2 of pet (Refer to ColorLabels dictionary)\n* Color3 - Color 3 of pet (Refer to ColorLabels dictionary)\n* MaturitySize - Size at maturity (1 = Small, 2 = Medium, 3 = Large, 4 = Extra Large, 0 = Not Specified)\n* FurLength - Fur length (1 = Short, 2 = Medium, 3 = Long, 0 = Not Specified)\n* Vaccinated - Pet has been vaccinated (1 = Yes, 2 = No, 3 = Not Sure)\n* Dewormed - Pet has been dewormed (1 = Yes, 2 = No, 3 = Not Sure)\n* Sterilized - Pet has been spayed \/ neutered (1 = Yes, 2 = No, 3 = Not Sure)\n* Health - Health Condition (1 = Healthy, 2 = Minor Injury, 3 = Serious Injury, 0 = Not Specified)\n* Quantity - Number of pets represented in profile\n* Fee - Adoption fee (0 = Free)\n* State - State location in Malaysia (Refer to StateLabels dictionary)\n* RescuerID - Unique hash ID of rescuer\n* VideoAmt - Total uploaded videos for this pet\n* PhotoAmt - Total uploaded photos for this pet\n* Description - Profile write-up for this pet. The primary language used is English, with some in Malay or Chinese.","35baf830":"Now lets take a look at how many types of animals are listed at the adoption centre ","b3874497":"Done... Let's check out our new df.","dba4cbc6":"So 1 & 2 (If we check the DataFields we will understand that* 1 --> Dogs* and *2--> Cats* )","ee2cc3b7":"# Sentiment Data\nThey have run each pet profile's description through Google's Natural Language API, providing analysis on sentiment and key entities. You may optionally utilize this supplementary information for your pet description analysis. There are some descriptions that the API could not analyze. As such, there are fewer sentiment files than there are rows in the dataset.\n\nFile name format is PetID.json.\n\nGoogle Natural Language API reference: https:\/\/cloud.google.com\/natural-language\/docs\/basics\n\nI'm extracting two features from the **Sentiment Data** .\n\n   * Sentiment Scoring\n   * Sentiment Magnitude'\n\nAfter Extracting these features I'm making two new rows(sen_score,  sen_mag) on both test and train data.\n   ","0588470d":"# Tuning model\n\nYou can tune the parameters for a better model.I've done a small example below for how to tuning them. You can save more time and get a much accurate model if you use any CV methods like  GridSearchCV.If you want a better tutorial on that please let me know in the comments.","8694280b":"# Image Metadata\n\nThey have run the images through Google's Vision API, providing analysis on Face Annotation, Label Annotation, Text Annotation and Image Properties. You may optionally utilize this supplementary information for your image analysis.\n\nFile name format is **PetID-ImageNumber.json**.\n\nSome properties will not exist in JSON file if not present, i.e. Face Annotation. Text Annotation has been simplified to just 1 entry of the entire text description (instead of the detailed JSON result broken down by individual characters and words). Phone numbers and emails are already anonymized in Text Annotation.\n\nGoogle Vision API reference: https:\/\/cloud.google.com\/vision\/docs\/reference\/rest\/v1\/images\/annotate\n\nAs listed above the file-name is in the format PETID - Image number so we should check how many df are having zero images.","1bd107de":"Our new df","e21b41c2":"# New Features","ba427c89":"## Cross Breed\n\nMmh...Everything seems fine.Can we get much more insights. Okay let's see we have two features called Breed1 and Breed2 .Okay lets create a new feature to check wheather the given pet is a cross breed or not."}}