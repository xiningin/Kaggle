{"cell_type":{"590ce564":"code","cd7d1008":"code","2153f7f0":"code","c44cf2fa":"code","2bbc27ef":"code","08ee70d8":"code","74d4a89c":"code","7b607faa":"code","9d1e010c":"code","705667e2":"code","4909a0f0":"code","44161046":"code","7a28a22d":"code","84bf7233":"code","ea102707":"code","4f132751":"code","6c8f0e1b":"code","953c340e":"code","d6f55c83":"code","dbf7261a":"code","d39f3e71":"code","3566f528":"code","4c59c6d7":"code","20131ad0":"code","95bf772e":"code","35e06665":"code","438422aa":"code","3a3a52a4":"code","35400e12":"code","f201294c":"code","0a8f20b0":"markdown","3134f02f":"markdown","9c5b68ec":"markdown","323de15f":"markdown","3002106c":"markdown","cbcc5da1":"markdown","468a5ec7":"markdown","a59c1c6b":"markdown","0eba4585":"markdown","e0a5132a":"markdown","f4b177f1":"markdown","065cf277":"markdown","90ece3dc":"markdown","f5b36a3f":"markdown","9e06ab28":"markdown","b8e80425":"markdown","10ce2ae0":"markdown","6f95b8ab":"markdown","909e910c":"markdown","deddc64e":"markdown","76d6c709":"markdown","14e0d2cc":"markdown"},"source":{"590ce564":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport os\nimport rasterio as rio\nimport folium\nimport tifffile as tiff ","cd7d1008":"from kaggle_secrets import UserSecretsClient\nfrom google.oauth2.credentials import Credentials\nimport ee","2153f7f0":"def overlay_image_on_puerto_rico(file_name,band_layer,lat,lon,zoom):\n    band = rio.open(file_name).read(band_layer)\n    m = folium.Map([lat, lon], zoom_start=zoom)\n    folium.raster_layers.ImageOverlay(\n        image=band,\n        bounds = [[18.6,-67.3,],[17.9,-65.2]],\n        colormap=lambda x: (1, 0, 0, x),\n    ).add_to(m)\n    return m","c44cf2fa":"gfs_img = tiff.imread(\"\/kaggle\/input\/ds4g-environmental-insights-explorer\/eie_data\/gfs\/gfs_2018070100.tif\")\ngldas_img = tiff.imread(\"\/kaggle\/input\/ds4g-environmental-insights-explorer\/eie_data\/gldas\/gldas_20180702_0600.tif\")\ns5p_no2_img = tiff.imread(\"\/kaggle\/input\/ds4g-environmental-insights-explorer\/eie_data\/s5p_no2\/s5p_no2_20180701T161259_20180707T175356.tif\")","2bbc27ef":"print(\"gfs shape: \", gfs_img.shape)\nprint(\"gldas shape: \", gldas_img.shape)\nprint(\"s5p_no2 shape: \", s5p_no2_img.shape)","08ee70d8":"NO2_Bands = pd.read_csv(\"..\/input\/ds4gbands-explanation\/Sentinel-5P_OFFL _NO2_Bands.csv\")","74d4a89c":"band1 = s5p_no2_img[:,:,0].reshape([70300,])\nband2 = s5p_no2_img[:,:,1].reshape([70300,])\nband3 = s5p_no2_img[:,:,2].reshape([70300,])\nband4 = s5p_no2_img[:,:,3].reshape([70300,])\nband5 = s5p_no2_img[:,:,4].reshape([70300,])\nband6 = s5p_no2_img[:,:,5].reshape([70300,])\nband7= s5p_no2_img[:,:,6].reshape([70300,])\nband8 = s5p_no2_img[:,:,7].reshape([70300,])\nband9 = s5p_no2_img[:,:,8].reshape([70300,])\nband10 = s5p_no2_img[:,:,9].reshape([70300,])\nband11 = s5p_no2_img[:,:,10].reshape([70300,])\nband12 = s5p_no2_img[:,:,11].reshape([70300,])\nbands = [band1, band2, band3, band4, band5, band6, band7, band8, band9, band10, band11, band12]","7b607faa":"NO2_Bands","9d1e010c":"for i, band in enumerate(bands):\n    print(\"band: \", i+1)\n    print(\"max: \", max(band))\n    print(\"min: \", min(band))","705667e2":"image = '\/kaggle\/input\/ds4g-environmental-insights-explorer\/eie_data\/s5p_no2\/s5p_no2_20180701T161259_20180707T175356.tif'\nlatitude=18.1429005246921; longitude=-65.4440010699994\noverlay_image_on_puerto_rico(image,band_layer=1,lat=latitude,lon=longitude,zoom=8)","4909a0f0":"GFS_Bands = pd.read_csv(\"..\/input\/ds4gbands-explanation\/GFS-Global_Forecast_System_384-Hour_Predicted_Atmosphere_Data_Bands.csv\")","44161046":"band1 = gfs_img[:,:,0].reshape([70300,])\nband2 = gfs_img[:,:,1].reshape([70300,])\nband3 = gfs_img[:,:,2].reshape([70300,])\nband4 = gfs_img[:,:,3].reshape([70300,])\nband5 = gfs_img[:,:,4].reshape([70300,])\nband6 = gfs_img[:,:,5].reshape([70300,])\nbands = [band1, band2, band3, band4, band5, band6]","7a28a22d":"GFS_Bands","84bf7233":"for i, band in enumerate(bands):\n    print(\"band: \", i+1)\n    print(\"max: \", max(band))\n    print(\"min: \", min(band))","ea102707":"GLDAS_Bands = pd.read_csv(\"..\/input\/ds4gbands-explanation\/GLDAS-2_1- Global_Land_Data_Assimilation_System_Bands.csv\")","4f132751":"band1 = gldas_img[:,:,0].reshape([70300,])\nband2 = gldas_img[:,:,1].reshape([70300,])\nband3 = gldas_img[:,:,2].reshape([70300,])\nband4 = gldas_img[:,:,3].reshape([70300,])\nband5 = gldas_img[:,:,4].reshape([70300,])\nband6 = gldas_img[:,:,5].reshape([70300,])\nband7= gldas_img[:,:,6].reshape([70300,])\nband8 = gldas_img[:,:,7].reshape([70300,])\nband9 = gldas_img[:,:,8].reshape([70300,])\nband10 = gldas_img[:,:,9].reshape([70300,])\nband11 = gldas_img[:,:,10].reshape([70300,])\nband12 = gldas_img[:,:,11].reshape([70300,])\nbands = [band1, band2, band3, band4, band5, band6, band7, band8, band9, band10, band11, band12]","6c8f0e1b":"GLDAS_Bands","953c340e":"for i, band in enumerate(bands):\n    print(\"band: \", i+1)\n    print(\"max: \", np.nanmax(band))\n    print(\"min: \", np.nanmin(band))","d6f55c83":"user_secret = \"earth_engine\" # Your user secret, defined in the add-on menu of the notebook editor\nrefresh_token = UserSecretsClient().get_secret(user_secret)\ncredentials = Credentials(\n        None,\n        refresh_token=refresh_token,\n        token_uri=ee.oauth.TOKEN_URI,\n        client_id=ee.oauth.CLIENT_ID,\n        client_secret=ee.oauth.CLIENT_SECRET,\n        scopes=ee.oauth.SCOPES)\nee.Initialize(credentials=credentials)","dbf7261a":"def add_ee_layer(self, ee_image_object, vis_params, name):\n  # https:\/\/github.com\/google\/earthengine-api\/blob\/master\/python\/examples\/ipynb\/ee-api-colab-setup.ipynb\n  map_id_dict = ee.Image(ee_image_object).getMapId(vis_params)\n  folium.raster_layers.TileLayer(\n    tiles = map_id_dict['tile_fetcher'].url_format,\n    attr = 'Map Data &copy; <a href=\"https:\/\/earthengine.google.com\/\">Google Earth Engine<\/a>',\n    name = name,\n    overlay = True,\n    control = True\n  ).add_to(self)\n\ndef plot_ee_data_on_map(dataset,column,begin_date,end_date,minimum_value,maximum_value,latitude,longitude,zoom):\n    # https:\/\/github.com\/google\/earthengine-api\/blob\/master\/python\/examples\/ipynb\/ee-api-colab-setup.ipynb\n    folium.Map.add_ee_layer = add_ee_layer\n    vis_params = {\n      'min': minimum_value,\n      'max': maximum_value,\n      'palette': ['006633', 'E5FFCC', '662A00', 'D8D8D8', 'F5F5F5']}\n    my_map = folium.Map(location=[latitude,longitude], zoom_start=zoom, height=500)\n    s5p = ee.ImageCollection(dataset).filterDate(\n        begin_date, end_date)\n    my_map.add_ee_layer(s5p.first().select(column), vis_params, 'Color')\n    my_map.add_child(folium.LayerControl())\n    display(my_map)","d39f3e71":"dataset = \"COPERNICUS\/S5P\/NRTI\/L3_NO2\"\ncolumn = 'NO2_column_number_density'\nbegin_date = '2018-07-08'\nend_date = '2018-07-14'\nminimum_value = -0.00051\nmaximum_value = 0.0192\nlatitude = 60.17\nlongitude = 25.94\nzoom = 5\nplot_ee_data_on_map(dataset,column,begin_date,end_date,minimum_value,maximum_value,latitude,longitude,zoom)","3566f528":"dataset_name = \"COPERNICUS\/S5P\/NRTI\/L3_NO2\"\ncolumn = 'NO2_column_number_density'\nbegin_date = '2017-03-07'\nend_date = '2018-12-31'\nminimum_value = -0.00051\nmaximum_value = 0.0192\nzoom = 2","4c59c6d7":"r = 1\nregion = [longitude-r,latitude-r,longitude+r,latitude+r]\nregion=ee.Geometry.Rectangle(region);","20131ad0":"L3_NO2 = ee.ImageCollection(dataset_name);\ndataset = L3_NO2.filterBounds(region).filterDate('2017-03-07','2018-12-31')\nprint(dataset)","95bf772e":"image = dataset.median()","35e06665":"print(image)","438422aa":"image.getInfo()","3a3a52a4":"def add_ee_layer_median(self, ee_image_object,vis_params,name):\n  map_id_dict = ee.Image(ee_image_object).getMapId(vis_params)\n  folium.raster_layers.TileLayer(\n    tiles = map_id_dict['tile_fetcher'].url_format,\n    attr = 'Map Data &copy; <a href=\"https:\/\/earthengine.google.com\/\">Google Earth Engine<\/a>',\n    name = name,\n    overlay = True,\n    control = True,\n  ).add_to(self)","35400e12":"def plot_ee_data_on_map_median(image,minimum_value,maximum_value,latitude,longitude,zoom):\n    folium.Map.add_ee_layer = add_ee_layer_median\n    vis_params = {\n      'min': minimum_value,\n      'max': maximum_value,\n      'bands': ['NO2_column_number_density'],\n      'palette': ['006633', 'E5FFCC', '662A00', 'D8D8D8', 'F5F5F5']\n    }\n\n    my_map = folium.Map(location=[latitude,longitude], zoom_start=zoom, height=500)\n    my_map.add_ee_layer(image, vis_params, 'NO2')\n    my_map.add_child(folium.LayerControl())\n    display(my_map)","f201294c":"plot_ee_data_on_map_median(image,minimum_value,maximum_value,latitude,longitude,zoom)","0a8f20b0":"## Note\n\nI created this kernel at immediately after the start of this competition.\n\nLater Paul Mooney released the following kernel for the explanation of band of dataset.  \n\nhttps:\/\/www.kaggle.com\/paultimothymooney\/explore-image-metadata-s5p-gfs-gldas\n\nSo please take this kernel as one example of dataset EDA.","3134f02f":"According to \"Global Forecast System 384-Hour Predicted Atmosphere Data\" (below URL), there are 9 Bands in this data.\n\nhttps:\/\/developers.google.com\/earth-engine\/datasets\/catalog\/NOAA_GFS0P25","9c5b68ec":"In this dataset, bands seems be shaked.\n\nWhen using band information, we may need to choose carefully.","323de15f":"## Snippets for visualize data","3002106c":"This dataset has different bands from website.\n\nWe can find that the bands seems same order order of Dataset web site, except for the last one.\n\nI can't understand what the last band corresponded to...","cbcc5da1":"## **Sentinel-5P OFFL NO2: Offline Nitrogen Dioxide**","468a5ec7":"# Future work","a59c1c6b":"According to \"Sentinel 5P OFFL NO2 Dataset\" (below URL), there are 12 Bands in this data.\n\nhttps:\/\/developers.google.com\/earth-engine\/datasets\/catalog\/COPERNICUS_S5P_OFFL_L3_NO2","0eba4585":"While referring to the great kernels, I'll get 'NO2_column_number_density' data of \"COPERNICUS\/S5P\/NRTI\/L3_NO2\" dataset.\n\nYou have to setup for using Google Earth Engin API:\nhttps:\/\/www.kaggle.com\/paultimothymooney\/how-to-get-started-with-the-earth-engine-data\n\nIf you use User Secrets first, ferer:\nhttps:\/\/www.kaggle.com\/product-feedback\/114053","e0a5132a":"I'll get ImageCollection of NO2_column_number_density cut out by time rangetime series. And I'll reduces the ImageCollection by calculating the median of all values at each pixel. Finally, I'll try to visualize the result. \n\nWe can refer Google Earth Engin API here!\n\nhttps:\/\/developers.google.com\/earth-engine\/api_docs","f4b177f1":"## Load Required Library","065cf277":"According to \"GLDAS-2.1: Global Land Data Assimilation System\" (below URL), there are 36 Bands in this data.\n\nhttps:\/\/developers.google.com\/earth-engine\/datasets\/catalog\/NASA_GLDAS_V021_NOAH_G025_T3H","90ece3dc":"We can find that the bands seems same order order of Dataset web site.\n\nWhen we want to retrieve information of NO2, it would be nice to get information on bands 1 to 4.","f5b36a3f":"# About This Kernel\nI'll summarize how to understand sample tiffiles in terms of it's bands.\n\nFirst, I try to check which band in the tifffiles corresponds to which band on the Dataset bands.\n\nSecond, I'll get data by Google Earth Engin API with specific band.\n\nI am glad to help you understand data!","9e06ab28":"# Check Bands of sample tiff ","b8e80425":"Thak you for reading!","10ce2ae0":"## **Global Land Data Assimilation System**","6f95b8ab":"## Checking Shape of tif files","909e910c":"# Get data by Google Earth Engin API","deddc64e":"# Challenge the application of Google Earth Engin API ","76d6c709":"It looks like I have successfully plotted the results on the map. But it is too wide! \ud83d\ude22\n\nNext, I'll try to control Google Earth Engine API and folium.","14e0d2cc":"## **GFS: Global Forecast System 384-Hour Predicted Atmosphere Data**"}}