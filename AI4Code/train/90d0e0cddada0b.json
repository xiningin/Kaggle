{"cell_type":{"165784ab":"code","189f397e":"code","32e4cc60":"code","f0279995":"code","58b87edd":"code","91ee2569":"code","a828c665":"code","57784c1b":"code","f9459873":"code","402a4ec2":"code","a7634b53":"code","a732f76a":"code","8011cfdf":"code","8e5af0a8":"code","ea8bd6e9":"code","aed481ac":"code","1f200cce":"code","49654bf3":"code","6c4bd1e8":"code","2304443a":"code","b088666e":"code","a898defb":"code","daeb06bc":"code","80490c65":"code","8021fd60":"code","eb70071f":"code","aa6d585b":"code","eac21844":"code","cc25e785":"code","9f151e64":"code","e6ab0c31":"code","a1b87800":"code","f3aed689":"code","7aea9600":"code","716afdc9":"code","81336cb1":"code","4ba6f9a8":"code","94aa5ebb":"markdown","2ec70996":"markdown","f483f966":"markdown","0d5e57c2":"markdown","52c3dafe":"markdown","492b6358":"markdown","b09a990e":"markdown","9dfb7a07":"markdown","a6ac88cf":"markdown"},"source":{"165784ab":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","189f397e":"DATA_DIR = '..\/input\/data-preprocessing-tomato-cultivators'","32e4cc60":"import numpy as np; import pandas as pd; import os","f0279995":"import seaborn as sns; import matplotlib.pyplot as plt","58b87edd":"import sys; import time; import copy;","91ee2569":"import torch; import torch.nn as nn; import torch.nn.functional as F; import torch.optim as optim; from torch.optim import lr_scheduler; \nimport torchvision; import torchvision.transforms as transforms; from torchvision import models","a828c665":"def get_device():\n    if torch.cuda.is_available():\n        device = 'cuda:0'\n    else:\n        device = 'cpu'\n    return device","57784c1b":"device = get_device()","f9459873":"tfms = transforms.Compose([\n    transforms.Resize((224, 224)),\n    transforms.ToTensor(),\n    transforms.Normalize((0.5,0.5,0.5), (0.5,0.5,0.5))\n])\n\ntrainset = torchvision.datasets.ImageFolder(root = DATA_DIR, transform = tfms)\ntrainloader = torch.utils.data.DataLoader(trainset, batch_size = 64, shuffle = True)","402a4ec2":"Classes = list(trainset.class_to_idx.keys())","a7634b53":"Classes","a732f76a":"trainset","8011cfdf":"b = next(iter(trainloader))","8e5af0a8":"b[0].shape","ea8bd6e9":"epochs = 25","aed481ac":"class CNN(nn.Module):\n    def __init__(self):\n        super(CNN, self).__init__()\n        self.conv1 = nn.Conv2d(3, 16, 3)\n        self.pool = nn.MaxPool2d(2,2)   \n        self.conv2 = nn.Conv2d(16, 32, 3)    \n        self.fc1 = nn.Linear(32 * 54*54, 1024)    \n        self.fc2 = nn.Linear(1024, 512)\n        self.fc3 = nn.Linear(512, len(Classes))\n        \n    def forward(self, x):\n        #print(x.shape)\n        x = self.pool(F.relu(self.conv1(x)))# 224x224 -> 222x222 -> 111x111\n        #print(x.shape)\n        x = self.pool(F.relu(self.conv2(x))) # 111x111 -> 54x54\n        #print(x.shape)\n        x = x.view( - 1 , 32*54*54)\n        #print(x.shape) # 93312\n        x = F.relu(self.fc1(x))\n        #print(x.shape) # 1024\n        x = F.relu(self.fc2(x))\n        #print(x.shape)\n        x = self.fc3(x)\n        return x\n    \n","1f200cce":"model = CNN()","49654bf3":"model","6c4bd1e8":"model.to(device)","2304443a":"criterion = nn.CrossEntropyLoss()\noptimizer = optim.SGD(model.parameters(), lr = 0.01, momentum = 0.9)","b088666e":"for epoch in range(epochs):\n    running_loss = 0\n    correct = 0\n    total = 0\n    \n    for i, data in enumerate(trainloader,0):\n        \n        images, labels = data\n        images = images.to(device)\n        \n        labels = labels.to(device)\n        #print(images.shape)\n        optimizer.zero_grad()\n        \n        outputs = model(images)\n        loss = criterion(outputs, labels)\n        #print(outputs.shape)\n        \n        loss.backward()\n        optimizer.step()\n        \n        _, preds = torch.max(outputs, 1)\n        correct += torch.sum(preds == labels.data)\n        total += labels.size(0)\n        # print Running Loss\n        running_loss += loss.item()\n        \n        if i % 20 == 0:\n            print('[%d, %5d] loss: %.3f' % (epoch + 1, i + 1, running_loss \/ 100))\n            running_loss = 0.0\n        \n    print('Epoch: {} '.format(epoch + 1))\n    print(\"Accuracy for this epoch -> : {}%\".format(100 * correct \/ total))\n    print('-'*100)     ","a898defb":"urls = ['https:\/\/upload.wikimedia.org\/wikipedia\/commons\/4\/40\/Kumato_04.jpg',  #01\n                'https:\/\/www.superfoodly.com\/wp-content\/uploads\/2018\/05\/kumato-750x500.jpg',\n                'https:\/\/i.etsystatic.com\/7207315\/r\/il\/4704ca\/1591057391\/il_794xN.1591057391_tjr9.jpg',\n                \n               # 'https:\/\/www.slickgarden.com\/wp-content\/uploads\/2019\/11\/Untitled-design-13-1024x576.png',   #02\n                'https:\/\/www.ozfarmer.com\/image\/cache\/catalog\/seed\/tomato-rouge-de-marmande-seed-packet-organically-certified-872x535.jpg',\n                'https:\/\/s3.amazonaws.com\/cdn.gurneys.com\/images\/800\/67965A.jpg' ,\n                'https:\/\/cdn.shopify.com\/s\/files\/1\/2918\/4630\/products\/image_3_c9a27eae-0a72-4bb2-9687-4034cc857d10_1200x1200.jpg?v=1570202383',\n                \n                'https:\/\/www.premierseedsdirect.com\/wp-content\/uploads\/2017\/02\/41582481-3.jpg',  #03\n               # 'https:\/\/www.slickgarden.com\/wp-content\/uploads\/2019\/11\/Untitled-design-13-1024x576.png', \n            'https:\/\/images-na.ssl-images-amazon.com\/images\/I\/41qp6sYIu%2BL._AC_.jpg',\n                'https:\/\/www.plantsofdistinction.co.uk\/stock\/mweb\/img001414.jpg', \n                \n                'https:\/\/upload.wikimedia.org\/wikipedia\/commons\/thumb\/5\/52\/TomateTrossRomanaTyp.jpg\/1200px-TomateTrossRomanaTyp.jpg', #04\n               # 'https:\/\/specialtyproduce.com\/sppics\/203.png', \n                #'https:\/\/nanasbloomers.com\/wp-content\/uploads\/2019\/01\/Tomato-Roma-4.jpg',\n                #'https:\/\/s3.amazonaws.com\/cdn.gurneys.com\/images\/800\/15062A.jpg',\n               # 'https:\/\/gardeningfever.com\/wp-content\/uploads\/2020\/01\/roma-tomatoes-in-a-bowl.jpg',\n                #'https:\/\/nanasbloomers.com\/wp-content\/uploads\/2019\/01\/Tomato-Roma-4.jpg',\n                'https:\/\/www.premierseedsdirect.com\/wp-content\/uploads\/2017\/02\/TOMATO-CHERRY-ROMA.jpg',\n                'https:\/\/parkseed.com\/images\/xxl\/05931-pk-p1.jpg?v=101221716621-1', \n                \n                'https:\/\/jakeseed.com\/wp-content\/uploads\/2019\/01\/Japanese-Black-Trifele-1.jpg', #05\n                'https:\/\/i.pinimg.com\/originals\/e6\/f8\/e8\/e6f8e8921afd366a81d27f875edf87b0.jpg',\n                'https:\/\/i.pinimg.com\/originals\/e0\/70\/35\/e0703513a9abb7383cfc287cfda250d4.jpg', \n                \n                'https:\/\/s3.amazonaws.com\/cdn.totallytomato.com\/images\/popup\/00510.jpg', #15\n                'https:\/\/www.simplyseed.co.uk\/user\/products\/Tomato%20SuperSweet%20100.jpg', \n                #'https:\/\/i.pinimg.com\/originals\/ab\/c4\/6e\/abc46e17b20c8a27c6b90cc7847f3089.jpg', \n                \n                #'https:\/\/i.pinimg.com\/474x\/2e\/24\/ec\/2e24ecb2a1a5f5b27cbdef5d6158c970--tomato-seeds-cherry-tomatoes.jpg', #14\n                'https:\/\/viridishortus.co.uk\/WebRoot\/Store10\/Shops\/70aa2b8f-78d4-4174-8951-a251ae9a4f33\/5C95\/CBD2\/B06C\/7DA2\/C336\/0A48\/3521\/5141\/Tomato_Floridity_F1-5.jpg',\n                'https:\/\/viridishortus.co.uk\/WebRoot\/Store10\/Shops\/70aa2b8f-78d4-4174-8951-a251ae9a4f33\/5C95\/CBD2\/B06C\/7DA2\/C336\/0A48\/3521\/5141\/Tomato_Floridity_F1.jpg',\n                \n                #'https:\/\/www.gardeningknowhow.com\/wp-content\/uploads\/2018\/06\/yellow-pear-tomatoes.jpg', #06\n                'https:\/\/cdn.shopify.com\/s\/files\/1\/0876\/0904\/products\/yellow_pear_cherry_tomato_grande.jpg?v=1475408521', \n                'https:\/\/www.redlandsdailyfacts.com\/wp-content\/uploads\/migration\/2016\/201602\/NEWS_160219716_AR_0_VLNUODOBUNPW.jpg',\n                \n                'https:\/\/ucanr.edu\/blogs\/MBMG\/blogfiles\/44692.jpg', #07\n               # 'https:\/\/www.veseys.com\/media\/catalog\/product\/cache\/image\/700x700\/e9c3970ab036de70892d86c6d221abfe\/s\/u\/sungoldtomato-sungoldtomato-image-19070-sungold.jpg', \n               # 'https:\/\/www.sierravistagrowers.net\/sites\/default\/files\/Sungold_Tomato_Seeds.jpg',\n              #  'https:\/\/specialtyproduce.com\/sppics\/5349.png', \n                'https:\/\/previews.123rf.com\/images\/rfoxfoto\/rfoxfoto1501\/rfoxfoto150100110\/35320350-oregon-grown-sungold-cherry-tomatoes-at-a-farmers-market.jpg',\n                'https:\/\/i.etsystatic.com\/10286820\/r\/il\/d51111\/740336759\/il_570xN.740336759_bv74.jpg',\n                \n                'https:\/\/www.rareseeds.com\/media\/catalog\/product\/cache\/4f71e30e38ffe1b90b59b74efe76a4b8\/t\/o\/tomato-green-zebra-tg103-img_5224_1.jpg',#08\n                'https:\/\/cdn.shopify.com\/s\/files\/1\/0038\/9405\/0868\/products\/Tomato_GreenZebra_1024x1024.jpg?v=1553203517',\n               # 'https:\/\/uprisingorganics.com\/media\/catalog\/product\/cache\/1\/image\/9df78eab33525d08d6e5fb8d27136e95\/z\/e\/zebra1.jpg',\n                \n                'https:\/\/cdn3.volusion.com\/ph9xz.o9ecs\/v\/vspfiles\/photos\/TF-0039-2.jpg?v-cache=1432576464', #13\n                'https:\/\/www.terrepromise.ca\/wp-content\/uploads\/2016\/02\/mieux-e1478291532335.jpg',\n                'https:\/\/i.pinimg.com\/originals\/9e\/a0\/0f\/9ea00fc95dffd695c78ed4d677a98cc2.jpg', \n                \n                'https:\/\/imagesvc.meredithcorp.io\/v3\/mm\/image?url=https%3A%2F%2Fstatic.onecms.io%2Fwp-content%2Fuploads%2Fsites%2F34%2F2020%2F02%2Fsan-marzano-tomatoes-getty-0220-2000.jpg', \n                'https:\/\/sodelish.ca\/wp-content\/uploads\/2019\/05\/7827.png',                #12\n                'https:\/\/cdn.shopify.com\/s\/files\/1\/1698\/1675\/products\/Tomato_San_Marzano.jpg?v=1537069256', \n                \n                'https:\/\/images-na.ssl-images-amazon.com\/images\/I\/71NrL0OtdjL._AC_SX450_.jpg' , # 11\n               # 'https:\/\/www.nybg.org\/blogs\/plant-talk\/wp-content\/uploads\/2015\/01\/Indigo-rose.jpg' ,\n                'https:\/\/croatianseeds-store.com\/images\/stories\/virtuemart\/product\/BlueBerries33.jpg',\n               # 'https:\/\/www.nybg.org\/blogs\/plant-talk\/wp-content\/uploads\/2015\/01\/Indigo-Dancing-with-Smurfs.png', \n                'https:\/\/i.ebayimg.com\/images\/g\/PbQAAOSw7FRWal5~\/s-l300.jpg',\n                \n               # 'https:\/\/www.edenbrothers.com\/store\/media\/Seeds-Vegetables\/SVTOM148-1.jpg', # 10\n                'https:\/\/2.bp.blogspot.com\/-GKM7z75_hcM\/U7Hbr7U7w9I\/AAAAAAAALgs\/B3HkBTNzgrI\/s1600\/Oxheart-30.06-2014.JPG',\n                'https:\/\/i.ebayimg.com\/images\/g\/HqwAAOSwO7haB0PQ\/s-l300.jpg',                 \n                'https:\/\/www.renaissancefarms.org\/wp-content\/uploads\/2017\/11\/Upstate-Oxheart-Tomatoes-2.jpg', \n                \n                'https:\/\/images-na.ssl-images-amazon.com\/images\/I\/51s-VvinLXL.jpg', #09\n                'https:\/\/www.seedsavers.org\/site\/img\/seo-images\/0253-cherokee-purple-tomato-organic.jpg',                 \n                'https:\/\/plantswithapurpose.net\/wp-content\/uploads\/2017\/06\/Cherokee-Purple-Tomato.jpg']","daeb06bc":"labels = ['01','01','01','02','02','02', '03','03','03', '04','04','04', '05','05','05', '15', '15', '14', '14','06','06', '07','07','07','08','08', '13','13','13', '12','12','12', '11','11','11', '10','10','10', '09','09','09']\nimg_data = []","80490c65":"len(urls)","8021fd60":"len(labels)","eb70071f":"from urlimage_helper import url_to_image\nimport numpy as np\nfrom torch.utils.data import Dataset, DataLoader\nfrom torchvision import transforms","aa6d585b":"transform = transforms.Compose([\n    transforms.Resize((224,224)), \n    transforms.ToTensor()\n])","eac21844":"class TomatoUrlData(Dataset):\n    def __init__(self, urls, labels, transforms = None):\n        self.urls = urls\n        #print(len(self.urls))\n        \n        # Error here\n        #print('Input Labels ->', labels)\n        self.labels = [int(i) for i in labels]\n        #print(self.labels)\n        \n        \n        self.transforms = transforms\n        self.img_data = []\n        for i, url in enumerate(self.urls):\n            \n            try:\n                img = url_to_image(url, to_numpy = True)\n                    #img = img\/255.0\n                self.img_data.append(img)\n                print(url, 'done')\n            except:\n                print(url, 'invalid')\n        #self.img_data = np.array(self.img_data)\n        #self.labels = np.array(self.labels, dtype = int)       \n                \n    def __getitem__(self, index):\n        if self.transforms:\n            image_data = self.transforms(self.img_data[index])\n            #print(image_data)\n            #print('-'*10)\n            #print('Index ->', index)\n            #print('-'*10)\n            #print('Label ->', self.labels[index])\n            return image_data.squeeze(1), self.labels[index]\n        \n        return self.img_data[index], self.labels[index]\n                 \n                    \n            \n    def __len__(self):\n        \n        return len(self.img_data)\n\n\nvalset = TomatoUrlData(urls, labels, transform)\nval_dataloader = DataLoader(valset, batch_size = 1)","cc25e785":"len(val_dataloader.dataset)","9f151e64":"#a[0].shape","e6ab0c31":"#a[1]","a1b87800":"#a = next(iter(val_dataloader))","f3aed689":"#a[0].shape","7aea9600":"#a[1].shape","716afdc9":"import torch\ndevice = torch.device('cuda' if torch.cuda.is_available() else 'cpu'\n                     )\ndevice","81336cb1":"for a, b in val_dataloader:\n    print(a.shape)\n    print(b.shape)","4ba6f9a8":"model.eval()\ntotal_loss = 0\ni = 1\nwith torch.no_grad():\n    for images, labels in val_dataloader:\n        images = images.to(device)\n        labels = labels.to(device)\n        print(f'Predicting on image sample {i}')\n        \n        outputs = model(images)\n    \n        _, predicted = torch.max(outputs.detach(), 1)\n        total += labels.size(0)\n        correct += (predicted == labels).sum().item()\n        total_loss += loss.item()\n        \n        #accuracy = correct\/total\n        print(f'Predicted on image sample {i}\\n\\n')\n        i += 1\n        \n    print(f'Val Accuracy of the model: {100 * correct \/ total}')      \n    ","94aa5ebb":"### Working with the Dataset","2ec70996":"### Hyper-parameters","f483f966":" ## Necessary Imports","0d5e57c2":"### Defining the Model Architecure","52c3dafe":"# 95.46 % Validation Accuracy of the Model","492b6358":"Training the CNN Model","b09a990e":"Define the Loss func & the optimizer","9dfb7a07":"### Model Instantiation","a6ac88cf":"## Inference on Real World Images"}}