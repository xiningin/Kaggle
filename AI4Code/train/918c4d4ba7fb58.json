{"cell_type":{"4e9350eb":"code","166bea56":"code","b2b07b15":"code","85f74307":"code","82f6ea3c":"code","baed6c16":"code","14deec63":"code","80f8221c":"code","21ea3bd1":"code","3f8d4b6f":"code","39f462b4":"code","693a9ebf":"code","fd61b95d":"code","2bfc4749":"code","c4a58c29":"code","4c0c7f46":"markdown","fa8cee26":"markdown","5e1d3cb4":"markdown","e1adb5dc":"markdown","5d2b4ba2":"markdown","da5c4eaa":"markdown","f551c626":"markdown","26bbf66e":"markdown","28c427f2":"markdown","f74ece10":"markdown"},"source":{"4e9350eb":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","166bea56":"# Keras Imports\nfrom keras.models import Sequential\nfrom keras.layers import Conv2D, MaxPooling2D, Flatten, Dense, Dropout, BatchNormalization\nfrom keras.preprocessing.image import ImageDataGenerator\nfrom keras.optimizers import Adam\nfrom keras.losses import binary_crossentropy\n\n\n# Sci-kit learn imports\nfrom sklearn.metrics import roc_auc_score\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.utils import shuffle\n\n# Other imports\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport glob\nimport cv2","b2b07b15":"# Path array of infected cell images\ninfected_cells=glob.glob(\"..\/input\/cell_images\/cell_images\/Parasitized\/*.png\")\nuninfected_cells=glob.glob(\"..\/input\/cell_images\/cell_images\/Uninfected\/*.png\")","85f74307":"plt.figure(figsize=(15,15))\nfor i in range(1,6):\n    plt.subplot(1,5,i)\n    ran=np.random.randint(100)\n    plt.imshow(cv2.imread(infected_cells[ran]))\n    plt.title('Infected cell')","82f6ea3c":"plt.figure(figsize=(15,15))\nfor i in range(1,6):\n    plt.subplot(1,5,i)\n    ran=np.random.randint(100)\n    plt.imshow(cv2.imread(uninfected_cells[ran]))\n    plt.title('Uninfected cell')","baed6c16":"# Create feature and response matrix for the image data\nimage_arr=list()\nlabel=list()\n\nfor i in infected_cells:\n    img=cv2.imread(i)\n    img_res=cv2.resize(img,(64,64))\n    image_arr.append(img_res)\n    label.append(1)\n\nfor j in uninfected_cells:\n    img=cv2.imread(j)\n    img_res=cv2.resize(img,(64,64))\n    image_arr.append(img_res)\n    label.append(0)","14deec63":"# List to Array Conversion and lengths\nimage_arr=np.array(image_arr)\nlabel=np.array(label)\nimage_arr.shape, label.shape","80f8221c":"# Shuffling of data since all 1s' and 0s' have been appended together\n\nimage_arr, label = shuffle(image_arr, label, random_state=0)\n\n# Train-Test split\n\nX_train, X_test, y_train, y_test=train_test_split(image_arr,label,test_size=0.2, random_state=0)","21ea3bd1":"# Image Augementation\n\n## Generic Image Data Generator \ntrain_generator=ImageDataGenerator(rotation_range=20,width_shift_range=0.25,height_shift_range=0.25,shear_range=0.2,zoom_range=0.3,horizontal_flip=True,vertical_flip=True,rescale=1\/255.)\ntest_generator=ImageDataGenerator(rescale=1\/255.)\n\n# Applying generators to training and testing images with additional parameters\ntrain_gen=train_generator.flow(X_train,y_train,batch_size=32,shuffle=False)\ntest_gen=test_generator.flow(X_test,y_test,batch_size=1,shuffle=False)\n","3f8d4b6f":"# Function to build a neural network\n\ndef CNN_neural():\n    # Indicates that our model is built using Sequential layers\n    model=Sequential()\n    \n    # First, we add multiples convolution layers to find patterns\n    model.add(Conv2D(filters=32,kernel_size=(3,3),strides=1,activation='relu',input_shape=(64,64,3)))\n    # Next, we add Pooling layer to reduce the size and find the occurence of feature in the convolution set\n    model.add(MaxPooling2D(pool_size=(2,2)))\n    # Scales the outputs of previous layers\n    model.add(BatchNormalization(axis=-1))\n    \n    # We repeat the same to create a slightly complex model\n    model.add(Conv2D(filters=32,kernel_size=(3,3),strides=1,activation='relu'))\n    model.add(MaxPooling2D(pool_size=(2,2)))\n    model.add(BatchNormalization(axis=-1))\n    \n    model.add(Conv2D(filters=32,kernel_size=(3,3),strides=1,activation='relu'))\n    model.add(MaxPooling2D(pool_size=(2,2)))\n    model.add(BatchNormalization(axis=-1))\n    \n    # To prevent overfitting\n    model.add(Dropout(0.25))\n    \n    # Now we begin the construction of ANN with the above network output as input\n    model.add(Flatten())\n    model.add(Dense(256,activation='relu'))\n    model.add(BatchNormalization(axis=-1))\n    model.add(Dropout(0.25))\n    model.add(Dense(1,activation='sigmoid'))\n    \n    return model\n    ","39f462b4":"model=CNN_neural()\nmodel.compile(loss=binary_crossentropy,\n              optimizer=Adam(lr=0.001, beta_1=0.9, beta_2=0.999, epsilon=None, decay=0.0, amsgrad=False),\n              metrics=['accuracy'])\nmodel.summary()","693a9ebf":"# Fitting a model to the data\n\nhist=model.fit_generator(train_gen,steps_per_epoch=len(X_train)\/32,epochs=25)","fd61b95d":"# Diagnostics\n\nN=25\nplt.plot(np.arange(0,N),hist.history['loss'],label='Training_loss')\nplt.plot(np.arange(0,N),hist.history['acc'],label='Accuracy')\nplt.title('Training loss and accuracy')\nplt.xlabel('Epochs')\nplt.legend(loc='right')","2bfc4749":"test_err=model.evaluate_generator(test_gen,steps=len(y_test))","c4a58c29":"# Test Accuracy\n\nprint('Loss: ',test_err[0])\nprint('Accuracy: ',test_err[1])\n","4c0c7f46":"\nWe must perform image augmentation on the existing images to make the neural network more versatile. In common words, we apply several transformation techniques like scaling, shearing, rotation etc. to the existing images. This causes the model to be trained in such a way that it can detect even the most uncommon of occurences.","fa8cee26":"From the above images, we can clearly distinguish that the cells with red(or pink) color blobs are being categorized as infected cells. Let us divide the data into training and testing data\n","5e1d3cb4":"The below cell imports all the necessary classes required in building the model and analysis","e1adb5dc":"Now, we compile the above model with appropriate optimizers and metrics to build a final model","5d2b4ba2":"Next, we evaluate the test error associated with this model.","da5c4eaa":"\nLet us create our neural network. A neural network in general consists of Convolution, Pooling, Flatten and Dense layers. The function of each of the mentioned layers can be understood by going through the theory involved in building a CNN.","f551c626":"Since the data is in raw format, we convert it into rgb array and reshape it in the form of feature vector. Then depending on the image, we add an appropriate label to its correspnding index.","26bbf66e":"Since we have developed the model, let us have a look at how it performed over the epochs timeline.","28c427f2":"We are done with preliminary steps and are now ready to fit the model to the augmented data.","f74ece10":"First, let us visualize the images of infected and uninfected cells."}}