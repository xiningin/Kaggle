{"cell_type":{"91df9418":"code","c5acac9b":"code","581c0cef":"code","891c1316":"code","c2204ef0":"code","54cd52c7":"code","45044672":"code","c3fd9209":"code","170bd7d9":"code","f1024463":"code","9ff5019d":"code","4b3da876":"code","728b4a04":"code","b396a278":"code","c6bdbeb5":"markdown","b4c1bb8b":"markdown","abe242bb":"markdown"},"source":{"91df9418":"import numpy as np\nimport pandas as pd\nimport bcolz\nimport random\nfrom tqdm import tqdm\nfrom glob import glob\nfrom keras.preprocessing.image import load_img\nfrom keras.preprocessing.image import img_to_array\nimport matplotlib.pyplot as plt","c5acac9b":"df_train = pd.read_csv('..\/input\/dog-breed-identification\/labels.csv')\ndf_test = pd.read_csv('..\/input\/dog-breed-identification\/sample_submission.csv')\ntrain_files = glob('..\/input\/dog-breed-identification\/train\/*.jpg')\ntest_files = glob('..\/input\/dog-breed-identification\/test\/*.jpg')","581c0cef":"targets_series = pd.Series(df_train['breed'])\ntargets_names = df_train['breed'].tolist()\none_hot = pd.get_dummies(targets_series, sparse = True)\none_hot_labels = np.asarray(one_hot)\nprint(targets_names[0:5])","891c1316":"im_size = 300\nx_train_raw = bcolz.zeros((0,im_size,im_size,3),np.float32)\nx_val_raw = bcolz.zeros((0,im_size,im_size,3),np.float32)\ny_train = []\ny_val = []\ny_train_name = []\ny_val_name = []","c2204ef0":"x_train_raw1 = bcolz.zeros((1,4,2,3),np.float32)\nprint(x_train_raw1)","54cd52c7":"i = 0 \nfor f in tqdm(train_files):\n    image = load_img(train_files[i].format(f), target_size=(im_size, im_size))\n    image = img_to_array(image)\n    label = one_hot_labels[i]\n    names = targets_names[i]\n    if random.randint(1,101) < 80: \n        x_train_raw.append(image)\n        y_train.append(label)\n        y_train_name.append(names)\n    else:\n        x_val_raw.append(image)\n        y_val.append(label)\n        y_val_name.append(names)\n    i += 1","45044672":"print(x_train_raw.shape, x_val_raw.shape)\nprint(len(y_val),len(y_val), len(y_val_name))\nplt.imshow(x_train_raw[2]\/255)","c3fd9209":"# dummy data for testing\ndummyX = x_train_raw[0:16]\ndummyY = y_train[0:16]\ndummyN = y_train_name[0:16]\nprint(dummyN)","170bd7d9":"def img_trans(img_data):\n    im_size = img_data.shape\n    nd1 = int(np.floor(im_size[0]*0.8))\n    nd2 = int(np.floor(im_size[0]*0.8))\n    cnd1 = int(np.floor((im_size[0]-nd1)*0.5))\n    cnd2 = int(np.floor((im_size[1]-nd2)*0.5))\n    k = random.randint(0,4)\n    if k == 0:\n        new_image = img_data\n        new_image[0:cnd1*2] = [0,0,0]\n        new_image[:,0:cnd2*2] = [0,0,0]\n    if k == 1:\n        new_image = img_data[im_size[0]-nd1:im_size[0],0:nd2]\n    if k == 2:\n        new_image = img_data[0:nd1,im_size[1]-nd2:im_size[1]]\n    if k == 3:\n        new_image = img_data[im_size[0]-nd1:im_size[0],im_size[1]-nd2:im_size[1]]\n    if k == 4:\n        new_image = img_data[cnd1:im_size[0]-cnd1,cnd2:im_size[1]-cnd2]\n    hflip = random.randint(1,101)\n    if hflip > 50:\n        new_image = np.flip(new_image,1)\n    vflip = random.randint(1,101)\n    if vflip > 50:\n        new_image = np.flip(new_image,0)\n    \n    return new_image","f1024463":"def data_augmentation(image_data, image_labels, image_names):\n    x_aug = bcolz.zeros((0,im_size,im_size,3),np.float32)\n    y_aug = []\n    yN_aug = []\n    count = len(image_labels)\n    i=0\n    for i in range(count):\n        x_aug.append(image_data[i]\/255.)\n        y_aug.append(image_labels[i])\n        yN_aug.append(image_names[i])\n        x_aug.append(img_trans(image_data[i]\/255.))\n        y_aug.append(image_labels[i])\n        yN_aug.append(image_names[i])\n    return x_aug, y_aug, yN_aug","9ff5019d":"dumX_aug, dumY_aug, dumN_aug = data_augmentation(dummyX, dummyY, dummyN)","4b3da876":"def display_augdata(image_data, image_names, batch_size):\n    image_data1 = image_data[0:batch_size*2]\n    image_names1 = image_names[0:batch_size*2]\n    fig, axes = plt.subplots(batch_size, batch_size, figsize=(20,20))\n    axes = axes.flatten()\n    i=0\n    for img, ax in zip(image_data1, axes):\n        ax.set_title(image_names1[i], fontsize=36)\n        ax.imshow(img)\n        ax.set_xticks(())\n        ax.set_yticks(())\n        i=i+1\n    plt.tight_layout()\ndisplay_augdata(dumX_aug, dumN_aug, 2)","728b4a04":"def DataGen(train_data_X, train_data_Y, train_data_N, im_size, batch_size, shuffle=True, data_aug = True, test = False):\n    nobs = len(train_data_N)\n    iter_times = nobs\/batch_size\n    train_data_X.list_IDs = np.arange(0,data.shape[0])\n    if shuffle=True:\n        ","b396a278":"# Parameters\nparams_trn = {\n          'im_size': im_size,\n          'batch_size': batch_size,\n          'shuffle': True,\n          'data_augment' : True,\n          'test' : False\n         }\nparams_val = {\n          'im_size': im_size,\n          'batch_size': batch_size,\n          'shuffle': True,\n          'data_augment' : False,\n          'test' : False\n         }\n\n# Generators\ntraining_generator = DataGenerator(x_train_raw, y_train_raw, **params_trn)\nvalidation_generator = DataGenerator(x_val_raw, y_val_raw, **params_val)","c6bdbeb5":"#### defining fucntion img_trans","b4c1bb8b":"#### display augmented data - only for first 2 pairs of images","abe242bb":"#### function for New data generation and augmentation"}}