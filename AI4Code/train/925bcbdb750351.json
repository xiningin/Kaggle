{"cell_type":{"aee98818":"code","c6b8383e":"code","3822e788":"code","a6947007":"code","940518e5":"code","1eb9ad3a":"code","c87d9724":"code","fa26e701":"code","5de60e0e":"code","c9bec038":"code","f18a3d0a":"code","a8007d02":"code","5563cba1":"code","03557b1e":"code","071a7ffe":"code","092b7c5f":"code","60f5123f":"code","404c9b88":"code","f5cf4eb4":"code","10e681c7":"code","6ce912e2":"code","be684160":"code","efcd58a7":"code","89819e19":"code","5239eaec":"code","c61f790d":"code","48b5dcb9":"code","0036443f":"code","f0519139":"code","3d948dbd":"code","0a0f51a9":"code","63e46dbb":"code","a16e91ea":"code","0d130897":"code","b8325df2":"code","aa942ba9":"code","83d43ade":"code","cd58560c":"code","f6fa1205":"code","600dc963":"code","4af44297":"code","496e6f99":"code","22f75778":"code","d99ce2f6":"code","5f675668":"code","a539699b":"code","e0695271":"code","4dad13a0":"code","d15abe49":"markdown","8d5651dd":"markdown"},"source":{"aee98818":"import os\nimport time\nimport math\nimport warnings\nimport numpy as np\nimport pandas as pd\nimport tensorflow as tf\nimport matplotlib.pyplot as plt\n\nimport random\nimport glob\n\nprint(tf.__version__)\n","c6b8383e":"DEBUG = True\n\n\nIMG_SZ_256 = 256\nIMG_SZ_273 = 273\nIMG_SZ_546 = 546\nIMG_SZ_1638 = 1638\nIMG_DIM = (IMG_SZ_256, IMG_SZ_546)\n\n#Model does not support IMG_TYPE 0 or 1\n#IMG_TYPE = 0  #(6, IMG_SZ_273, IMG_SZ_256) <- original IMG\n#IMG_TYPE = 1  #(IMG_SZ_256, IMG_SZ_1638)   <- [A0,B,A1,C,A2,D]\n\n#Model support IMG_TYPE 2 or 3\n#IMG_TYPE = 2  #(IMG_SZ_256, IMG_SZ_546, 3) <- [A0_B,A1_C,A2_D]\nIMG_TYPE = 3  #(IMG_SZ_256, IMG_SZ_273, 3, 2) <- [[A0,A1,A2],ch1], [[B,C,D],ch2]\n\nCLASSES_NUM = 1\nBATCH_SIZE = 32\nEPOCHS = 10\n\nif DEBUG:\n    BATCH_SIZE = 4 \n    EPOCHS = 10","3822e788":"MAIN_DIR = '..\/input\/seti-breakthrough-listen'\nTRAIN_DIR = '..\/input\/seti-breakthrough-listen\/train'\nSUB_DIR = '..\/input\/seti-breakthrough-listen\/test'","a6947007":"train_df = pd.read_csv(os.path.join(MAIN_DIR, 'train_labels.csv'))\ntest_df = pd.read_csv(os.path.join(MAIN_DIR, 'sample_submission.csv'))","940518e5":"train_df.shape,test_df.shape","1eb9ad3a":"def plot_img(Xt, yt=None, img_type=IMG_TYPE):\n    \n    if (img_type == 0):\n        min_rows = len(Xt)    \n        fig, ax = plt.subplots(nrows = min_rows, figsize=(16, 10))\n        a_strt  = 5\n        a_y     = 100\n        stars = ['A0','B','A1','C','A2','D']\n        for j in range(min_rows): \n            ax[j].imshow(Xt[j],aspect='auto')                #(6, 273, 256)\n            ax[j].text(a_strt, a_y, stars[j],  bbox={'facecolor': 'white'})        \n            ax[j].set_ylabel('time ')\n            ax[j].set_xlabel('freq (bins)')\n    \n    elif(img_type == 1): \n        stars = ['A0','B','A1','C','A2','D']\n        a_strt  = 5\n        a_y     = 100\n        min_rows = len(Xt) \n        fig = plt.subplots(figsize=(16, 5))\n        plt.imshow(Xt,aspect='auto')                          #(256,1638)\n        for j in range(6): \n            plt.text(a_strt+j*IMG_SZ_273, a_y, stars[j],  bbox={'facecolor': 'white'})   \n\n        plt.xlabel('time ')\n        plt.ylabel('freq (bins)')\n            \n    elif(img_type == 2):    \n        print(f'test X: {Xt.shape}')                          #train X: (4, 256, 546, 3)\n        if len(np.shape(Xt)) == 3:                            #(256,546,3)\n            Xt = np.expand_dims(Xt,axis=0)                    #(1,256,546,3)\n            min_rows = 1\n            fig, ax = plt.subplots(nrows = 2, figsize=(24, 8))\n        else:\n            print(f'test y: {yt.shape}')                      #target y: (4,1)\n            min_rows = min(4,len(Xt))                         #(batch,256,546,3)\n            fig, ax = plt.subplots(nrows = min_rows, figsize=(24, 22))\n\n        a_strt  = 5\n        b_strt  = a_strt+int(Xt.shape[2]\/2)\n        a_y     = 100\n\n        for j in range(min_rows):\n            ax[j].imshow(Xt[j],aspect='auto')     #Xt[j]=[A0:B], Xt[j]=[A1:C], Xt[j]=[A2:D]\n            #ovelay A0,A1,A2 in color RGB\n            ax[j].text(a_strt, a_y, 'A2',  bbox={'facecolor': 'white'})        #A2 = green\n            ax[j].text(a_strt+8, a_y+8, 'A1',  bbox={'facecolor': 'white'})    #A1 = blue\n            ax[j].text(a_strt+16, a_y+16, 'A0',  bbox={'facecolor': 'white'})  #A0 = red\n            #ovelay B,C,D in color RGB \n            ax[j].text(b_strt, a_y, 'D',  bbox={'facecolor': 'white'})         #D = green\n            ax[j].text(b_strt+8, a_y+8, 'C',  bbox={'facecolor': 'white'})     #C = blue\n            ax[j].text(b_strt+16, a_y+16, 'B',  bbox={'facecolor': 'white'})   #B = red\n            ax[j].set_xlabel('time ')\n            ax[j].set_ylabel('freq (bins)')\n            if min_rows==4:\n                ax[j].set_title(f'Label= {yt[j,]}')\n\n        plt.show()\n\n    elif(img_type == 3):    \n        print(f'test X: {Xt.shape}')         #train X: (batch, 256, 273, 3, 2)\n\n        if len(np.shape(Xt)) == 4:                #(256,273,3,2)\n            Xt = np.expand_dims(Xt,axis=0)        #(1,256,273,3,2)\n            min_rows = 1\n            fig, ax = plt.subplots(nrows =2, ncols =2, figsize=(24, 8))\n        else:\n            print(f'test y: {yt.shape}')         #target y: (4,1)\n            min_rows = min(4,len(Xt))            #(batch,256,273,3,2)\n            fig, ax = plt.subplots(nrows=min_rows, ncols =2, figsize=(24, 22))\n\n        a_strt  = 5\n        a_y     = 100\n\n        for j in range(min_rows):\n            ch0=Xt[j,:,:,:,0]\n            ch1=Xt[j,:,:,:,1]\n            ax[j,0].imshow(ch0,aspect='auto')     #Xt[j]=[A0:B], Xt[j]=[A1:C], Xt[j]=[A2:D]\n            ax[j,1].imshow(ch1,aspect='auto')     #Xt[j]=[A0:B], Xt[j]=[A1:C], Xt[j]=[A2:D]\n            #ovelay A0,A1,A2 in color RGB\n            ax[j,0].text(a_strt, a_y, 'A2',  bbox={'facecolor': 'white'})        #A2 = green\n            ax[j,0].text(a_strt+8, a_y+8, 'A1',  bbox={'facecolor': 'white'})    #A1 = blue\n            ax[j,0].text(a_strt+16, a_y+16, 'A0',  bbox={'facecolor': 'white'})  #A0 = red\n            ax[j,0].set_xlabel('time ')\n            ax[j,0].set_ylabel('freq (bins)')\n            #ovelay B,C,D in color RGB \n            ax[j,1].text(a_strt, a_y, 'D',  bbox={'facecolor': 'white'})         #D = green\n            ax[j,1].text(a_strt+6, a_y+6, 'C',  bbox={'facecolor': 'white'})     #C = blue\n            ax[j,1].text(a_strt+12, a_y+12, 'B',  bbox={'facecolor': 'white'})   #B = red\n            ax[j,1].set_xlabel('time ')\n            ax[j,1].set_ylabel('freq (bins)')\n            if min_rows==4:\n                ax[j,0].set_title(f'Label= {yt[j,]}')\n\n        plt.show()        \n        \n    return     ","c87d9724":"def aug_img(arr):\n    filtered_spectrogram = np.zeros((6, IMG_SZ_273, IMG_SZ_256), dtype = np.float32)  #6, 273, 256\n\n    #type_aug = random.choice(('none', 'norm', 'row_median', 'col_median', 'all'))\n    xtimes = random.uniform(1.0, 3.)  #keep the pixels which are xtimes times higher that column or\/and row median\n    print(xtimes)\n    scale = 1\n\n    for i in range(6):\n        image = arr[i,:,:]          #273x256\n        norm_s = (image -image.min())\/(image.max()-image.min()) \n        col_medians = np.median(norm_s, axis=0)\n        row_medians = np.median(norm_s, axis=1)\n        total_pwr = np.product(norm_s.shape)\n        sig_pwr = np.sum(norm_s)        #signal power\n        col_sum = np.sum(col_medians)   #mean column power\n        row_sum = np.sum(row_medians)   #mean row power\n        pwr_ratio= total_pwr\/sig_pwr\n        print('total_pwr=',total_pwr,'pwr_ratio=',pwr_ratio,'sig_pwr=',sig_pwr,'col_mean=',col_sum, 'row_mean=',row_sum)\n        filtered_spectrogram[i,:,:] = np.greater(norm_s, col_medians*xtimes)*scale & np.greater(norm_s.T, row_medians*xtimes).T*scale\n\n    return filtered_spectrogram  ","fa26e701":"def get_img(arr, img_type=0, aug=False):\n    c,h,w = arr.shape                                          #arr = 6x273x256\n    if aug:\n        arr = aug_img(arr)                                     #arr = 6x273x256   \n    image = np.vstack(arr).transpose((1, 0))                   #image = 256x1638\n    \n    if (img_type ==0):\n        return arr                                             #arr = 6x273x256\n    \n    elif(img_type ==1): #\n        return image                                           #image = 256x1638\n        \n    elif(img_type ==2): #\n        x = np.zeros(shape = (w, 2*h,3))                       #256, 2x273, 3 \n        x[:, :, 0] = image[:,:x.shape[1]]  #\n        x[:, :, 1] = image[:,x.shape[1]:2*x.shape[1]]  #\n        x[:, :, 2] = image[:,2*x.shape[1]:3*x.shape[1]]  #\n        return x                                               #256x546x3\n\n    elif(img_type==3): #IMG_3D:\n        x = np.zeros(shape = (w, h, 3, 2))                     #256, 273, 3 ,2\n        #ch0, RGB overlay\n        x[:, :, 0, 0] = image[:,:x.shape[1]]                #A0 \n        x[:, :, 1, 0] = image[:,2*x.shape[1]:3*x.shape[1]]  #A1\n        x[:, :, 2, 0] = image[:,4*x.shape[1]:5*x.shape[1]]  #A2    \n        #ch1, RGB overlay\n        x[:, :, 0, 1] = image[:,x.shape[1]:2*x.shape[1]]    #B \n        x[:, :, 1, 1] = image[:,3*x.shape[1]:4*x.shape[1]]  #C\n        x[:, :, 2, 1] = image[:,5*x.shape[1]:6*x.shape[1]]  #D\n        return x \n    \n    return image    ","5de60e0e":"#Target = 0\n#arr = np.load('..\/input\/seti-breakthrough-listen\/train\/f\/f081cea12a6c.npy').astype(np.float32) \n#arr = np.load('..\/input\/seti-breakthrough-listen\/train\/b\/b07ed42630f8.npy').astype(np.float32)\n#arr = np.load('..\/input\/seti-breakthrough-listen\/train\/1\/11a02b9f7c59.npy').astype(np.float32)\n#arr = np.load('..\/input\/seti-breakthrough-listen\/train\/3\/331b2635e487.npy').astype(np.float32)\n#Target = 1\n#arr = np.load('..\/input\/seti-breakthrough-listen\/train\/0\/0f6dda0952ea.npy').astype(np.float32)\n#arr = np.load('..\/input\/seti-breakthrough-listen\/train\/5\/54e340be921d.npy').astype(np.float32)\n#arr = np.load('..\/input\/seti-breakthrough-listen\/train\/f\/f419ae83312b.npy').astype(np.float32)\n#arr = np.load('..\/input\/seti-breakthrough-listen\/train\/b\/b29e945c82e4.npy').astype(np.float32)\n#arr = np.load('..\/input\/seti-breakthrough-listen\/train\/2\/20b6bba77e00.npy').astype(np.float32)\narr = np.load('..\/input\/seti-breakthrough-listen\/train\/8\/87cca65ea82e.npy').astype(np.float32)\n","c9bec038":"plot_img(arr, img_type=0)    #original img, img_type0, (6x273x256)","f18a3d0a":"arr0 = get_img(arr, img_type=0, aug=True)  #input = original img  = img_type0 (6x273x256), output = img_type0\nplot_img(arr0, img_type=0)","a8007d02":"arr0 = get_img(arr, img_type=0, aug=True)  #input = original img  = img_type0 (6x273x256), output = img_type0\nplot_img(arr0, img_type=0)","5563cba1":"arr1 = get_img(arr, img_type=1, aug=True)  #input = original img = img_type0 (6x273x256), output = img_type1,(256x1638)\nplot_img(arr1, img_type=1)                 # 256x1638","03557b1e":"arr2 = get_img(arr, img_type=2, aug=True)  #input = original img(6x273x256),  output = img_type2, (256,546,3)\nplot_img(arr2, img_type=2)                 #(256,546,3)","071a7ffe":"arr3 = get_img(arr, img_type=3, aug=True)  #input = original img(6x273x256),  output = img_type3 (256,273,3,2)\nplot_img(arr3, img_type=3)","092b7c5f":"def return_filpath(name, folder=TRAIN_DIR):\n    path = os.path.join(folder, name[0], f'{name}.npy')\n    return path","60f5123f":"train_df['image_path'] = train_df['id'].apply(lambda x: return_filpath(x))\ntest_df['image_path'] = test_df['id'].apply(lambda x: return_filpath(x, folder=SUB_DIR))","404c9b88":"if DEBUG: \n    label_counts = train_df['target'].value_counts()\n    min_label_counts = min(label_counts[0], label_counts[1])\n    un_balance_ratio = max(label_counts[0], label_counts[1]) \/\/ min_label_counts\n\n    df_0     = train_df[train_df['target']==0].sample(min_label_counts,random_state=42)\n    df_1     = train_df[train_df['target']==1].sample(min_label_counts,random_state=42)\n    train_df = pd.concat([df_0,df_1])\n    train_df = train_df.reset_index()\n    test_df = test_df[:31].reset_index(drop=True)    \n\nelse:    \n    df_0     = train_df[train_df['target']==0]\n    df_1     = train_df[train_df['target']==1]\n    df_1_balance  = pd.concat([df_1,df_1,df_1,df_1,df_1,df_1,df_1,df_1,df_1])\n    train_df = pd.concat([df_0,df_1_balance])\n    train_df = train_df.reset_index()","f5cf4eb4":"#train_df = train_df.sample(100,random_state=42, replace=True).reset_index(drop=True)  #debug\n#test_df = test_df[:31].reset_index(drop=True)    #debug","10e681c7":"train_df.tail()","6ce912e2":"test_df.tail()","be684160":"np.shape(train_df), np.shape(test_df)","efcd58a7":"sample_df = train_df.sample(frac=1).reset_index(drop=True)\n#percent_split = int( 0.07 * sample_df.shape[0] )  #train=29, valid=2, \npercent_split = int( 0.2 * sample_df.shape[0] )  #train=25, valid=6, \n\nX_train = sample_df[:-percent_split]\nX_valid = sample_df[-percent_split:]\n\nnp.shape(X_train), np.shape(X_valid)","89819e19":"lable_value_counts =  train_df['target'].value_counts()\nclass_weights = {i: max(lable_value_counts)\/v for i, v in lable_value_counts.items()}\n\nlable_value_counts, class_weights","5239eaec":"STEPS_PER_EPOCH = X_train.shape[0] \/\/ BATCH_SIZE\nVALIDATION_STEPS = X_valid.shape[0] \/\/ BATCH_SIZE   \n\nBATCH_SIZE, STEPS_PER_EPOCH, VALIDATION_STEPS","c61f790d":"class Preprocess_data(tf.keras.utils.Sequence):\n    def __init__(self,df,batch_size=16, mode='fit', shuffle = False, aug = None, n_classes=CLASSES_NUM):\n        self.df = df            # data frame with the id, target, image_path\n        self.batch_size = batch_size\n        self.mode = mode\n        self.shuffle = shuffle\n        self.aug = aug\n        self.n_classes = n_classes\n        \n        self.on_epoch_end()\n        \n    def __len__(self):\n        return math.ceil(len(self.df) \/ self.batch_size)\n        #return len(self.df) \/\/ self.batch_size   #drop remainder\n    \n    def on_epoch_end(self):\n        if self.shuffle:\n            self.df = self.df.sample(frac=1).reset_index(drop=True)\n            \n    def __getitem__(self, index):\n                \n        batch_Idx_start = index*self.batch_size\n        batch_Idx_end = batch_Idx_start+self.batch_size  # ..,24+4, 28+4\n        \n        if( len(self.df) < batch_Idx_end):  # 29 < 32\n            len_batch_current = len(self.df)%self.batch_size  #1\n            batch_Idx_end = batch_Idx_start + len_batch_current  #28+1\n            \n        img_batch = self.df.image_path[batch_Idx_start : batch_Idx_end]\n        \n        #IMG_TYPE = 0  #(6, IMG_SZ_256, IMG_SZ_273)\n        #IMG_TYPE = 1  #(IMG_SZ_256, IMG_SZ_1638)   <- [A0,B,A1,C,A2,D]\n        #IMG_TYPE = 2  #(IMG_SZ_256, IMG_SZ_546, 3) <- [A0_B,A1_C,A2_D]\n        #IMG_TYPE = 3  #(IMG_SZ_256, IMG_SZ_273, 3, 2) <- [[A0,A1,A2],ch1], [[B,C,D],ch2]\n        \n        if(IMG_TYPE == 0): \n            X = np.zeros((len(img_batch), IMG_SZ_256, IMG_SZ_273), dtype = np.float32)  #(6, IMG_SZ_256, IMG_SZ_273) \n        elif(IMG_TYPE == 1):    \n            X = np.zeros((len(img_batch), IMG_SZ_256, IMG_SZ_1638, 1), dtype = np.float32)  #256, 1638, 1 \n        elif(IMG_TYPE == 2): \n            X = np.zeros((len(img_batch), IMG_SZ_256, IMG_SZ_546, 3), dtype = np.float32)  #256, 2x273, 3 \n        elif(IMG_TYPE == 3): #3D\n            X = np.zeros((len(img_batch), IMG_SZ_256, IMG_SZ_273, 3, 2), dtype = np.float32)  #[[A0,A1,A2],ch1], [[B,C,D],ch2]\n        \n        for i,fn in enumerate(img_batch):\n            img   = np.load(fn)                           #6x273x256\n            img   = get_img(img, IMG_TYPE, self.aug)      #MODEL does not support IMG_TYPE 0 or 1 yet.\n            X[i,] = img        #(batch,256,2x273,3) or 3D<-(batch,256,273,3,2) \n            \n        if self.mode in ['fit', 'validate']:\n            y = np.zeros(len(img_batch), dtype = np.float32)\n            # target list                  \n            lbls_batch = self.df[batch_Idx_start: batch_Idx_end]['target'].values\n            \n            if False:  #DEBUG:\n                if( len(img_batch) < self.batch_size):\n                    print(' ')\n                    print(f'len_img={len(img_batch)}, mode={self.mode}')\n                    print(f'start batch Idx={batch_Idx_start},end Idx={batch_Idx_end},length df={len(self.df)}')  #\n                    #print(f'batch index exceeded the length df={len(self.df)}') \n\n                    #print(' ')\n                    #print(f'df_batch= ')\n                    #print(f'{self.df.id}')\n\n                    #print(' ')\n                    #print(f'img_batch= ')\n                    #print(f'{img_batch}')\n\n                    #print(' ')\n                    #print(f'lenx={np.shape(X)}, leny={np.shape(lbls_batch)}')\n\n                    #print(' ')\n                    #print('target=', lbls_batch)\n                \n            y = lbls_batch\n            return X, y\n        \n        elif self.mode == 'predict':\n            return X\n        else:\n            raise AttributeError('mode parameter error')    ","48b5dcb9":"train_gen = Preprocess_data(\n                        df = X_train, \n                        batch_size = BATCH_SIZE,\n                        mode = 'fit',\n                        shuffle = True,\n                        aug = False,  #True, \n                        n_classes = CLASSES_NUM)\n\nval_gen = Preprocess_data(\n                        df = X_valid,  \n                        batch_size = BATCH_SIZE,\n                        mode = 'validate',\n                        shuffle = False,\n                        aug = False,\n                        n_classes = CLASSES_NUM)","0036443f":"X_train.tail(5)","f0519139":"len(X_train), X_train[-BATCH_SIZE:]","3d948dbd":"len(X_valid), X_valid[-BATCH_SIZE:]","0a0f51a9":"Xt, yt = train_gen.__getitem__(0)    #idx*batch_size < len(df)  \nplot_img(Xt, yt , img_type=IMG_TYPE)","63e46dbb":"trn_idx = len(X_train)\/\/BATCH_SIZE\ntrn_idx","a16e91ea":"Xt, yt = train_gen.__getitem__(trn_idx)    #idx*batch_size < len(df)  \nprint(f'train X: {Xt.shape}')              #train X: (4, 256, 546, 3)\nprint(f'train y: {yt.shape}')              #target y: (4,1)","0d130897":"val_idx = len(X_valid)\/\/BATCH_SIZE\nval_idx","b8325df2":"Xv, yv = val_gen.__getitem__(val_idx)      #idx*batch_size < len(df)  \nprint(f'valid X: {Xv.shape}')              #Valid X: (4, 256, 546, 3)\nprint(f'valid y: {yv.shape}')              #target y: (4,1)","aa942ba9":"def make_model(output_bias = None, metrics = None):\n      \n    #base_model = tf.keras.applications.EfficientNetB7(input_shape=(*IMG_DIM, 3),include_top=False,weights='imagenet')                                                                                                \n    #base_model = tf.keras.applications.DenseNet201(input_shape=[*IMG_DIM, 3], include_top=False, weights='imagenet')\n    #base_model = tf.keras.applications.Xception(input_shape=[*IMG_DIM, 3], include_top=False, weights='imagenet')\n    base_model = tf.keras.applications.VGG16(input_shape=(IMG_SZ_256, IMG_SZ_546, 3), include_top=False, weights='imagenet')\n\n    for i in base_model.layers[:-2]:   #vgg\n        print(i.name)\n        i.trainable = True   #arguments=dict(batch_norm_momentum=0.997) #False \n\n    base_model.trainable = False\n    \n    model = tf.keras.Sequential([\n        base_model,        \n        tf.keras.layers.GlobalAveragePooling2D(),\n        tf.keras.layers.Dense(32, activation='relu'),\n        tf.keras.layers.Dense(CLASSES_NUM, activation='sigmoid'),\n    ])\n    \n\n    model.compile(optimizer=tf.keras.optimizers.Adam(learning_rate=0.001),\n                  loss='binary_crossentropy',\n                  metrics=[tf.keras.metrics.AUC()],\n                  )\n    \n    return model    ","83d43ade":"def make_model_3D():\n    input_shape =(BATCH_SIZE, IMG_SZ_256, IMG_SZ_273, 3, 2)     #2 channels <- data_format=\"channels_last\"\n    \n    model = tf.keras.Sequential([\n            tf.keras.layers.Conv3D(16, (3,3,1), activation='relu', input_shape=(IMG_SZ_256, IMG_SZ_273, 3, 2)),\n            tf.keras.layers.MaxPooling3D((6,6,1)),\n            tf.keras.layers.BatchNormalization(),\n            tf.keras.layers.Conv3D(8, (3,3,1), activation='relu'),\n            tf.keras.layers.MaxPooling3D((2,2,1)),\n            #tf.keras.layers.Dropout(0.2),\n            tf.keras.layers.Flatten(),\n            tf.keras.layers.BatchNormalization(),\n            tf.keras.layers.Dense(32, activation='relu'),\n            tf.keras.layers.Dense(CLASSES_NUM, activation='sigmoid') \n        ])\n    \n    model.compile(optimizer='adam',\n                  loss='binary_crossentropy',\n                  metrics=[tf.keras.metrics.AUC()],\n                  )\n    \n    return model ","cd58560c":"if(IMG_TYPE == 3): #3D\n    model = make_model_3D()\nelse:\n    model = make_model()","f6fa1205":"model.summary()","600dc963":"\n\nhist = model.fit(\n        train_gen,\n        validation_data = val_gen,\n        class_weight = class_weights,\n        epochs = EPOCHS,\n        #steps_per_epoch=STEPS_PER_EPOCH,\n        #validation_steps= VALIDATION_STEPS,  \n        verbose = 1\n        )","4af44297":"hist.history.keys()","496e6f99":"#hist.history","22f75778":"fig = plt.figure(figsize=(12,4))\nplt.subplot(1,2,1)\nplt.plot(hist.history['loss'],marker=\"o\",c=\"red\",label=f\"Training {'loss'}\")\nplt.plot(hist.history['val_loss'],marker=\"x\",c=\"green\",label=f\"Validation {'val_loss'}\")\nplt.legend()\nplt.grid(False)\n    \nplt.subplot(1,2,2)\nplt.plot(hist.history['auc'],marker=\"o\",c=\"red\",label=f\"Training {'auc'}\")\nplt.plot(hist.history['val_auc'],marker=\"x\",c=\"green\",label=f\"Validation {'val_auc'}\")\nplt.legend()\nplt.grid(False)\n    \nplt.tight_layout()\nplt.show()","d99ce2f6":"sub_gen = Preprocess_data(\n                        df = test_df,  \n                        batch_size = 1,\n                        mode = 'predict',\n                        shuffle = False,\n                        aug = False,\n                        n_classes = CLASSES_NUM)","5f675668":"y_pred = model.predict(sub_gen,\n                       #use_multiprocessing=True, workers=4,\n                       verbose=1\n                       ) ","a539699b":"sub_df = pd.read_csv(\"..\/input\/seti-breakthrough-listen\/sample_submission.csv\")","e0695271":"if not DEBUG:\n    sub_df[\"target\"] = y_pred","4dad13a0":"sub_df.to_csv('submission.csv', index = False)\n\nprint('submission saved')\nsub_df.head()    ","d15abe49":"Submission","8d5651dd":" Predict results"}}