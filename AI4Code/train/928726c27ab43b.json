{"cell_type":{"4e96f6f8":"code","018eb061":"code","ba4c8196":"code","2066d00b":"code","838ea461":"code","ad56f9c8":"code","e89fb74d":"code","be9c8739":"code","85f45f29":"code","2a4a1a67":"code","77f77129":"code","4cac49a7":"code","7ad1cca9":"code","5b479b3e":"code","8e732e8d":"code","58250acf":"code","9cb22ce2":"code","ea462641":"code","3eb395fc":"code","92832e7d":"code","2b432e66":"code","2bc96e37":"code","07d49163":"code","fa1e4347":"code","5474d8a7":"code","6c38ccd1":"code","8a4db2bf":"code","3ed975c8":"code","ddd119a0":"code","94710d93":"code","784947f5":"code","5f47428f":"code","1332d4a1":"code","3991af3f":"code","6e5dbed5":"code","5235eaa4":"code","dfad555e":"code","fa0c86fb":"markdown","bd43d870":"markdown","12fe6506":"markdown","1fef8fa2":"markdown","d674ddf2":"markdown","d4ca15b0":"markdown","a69ca74c":"markdown","bac2515a":"markdown","25fe9633":"markdown","3bfb510a":"markdown","b5601584":"markdown","85319a5c":"markdown","2bf6f672":"markdown","297249a4":"markdown","3ad57cf4":"markdown","bf5408a5":"markdown","58645818":"markdown","5ccae10f":"markdown","042f9657":"markdown"},"source":{"4e96f6f8":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","018eb061":"import matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly.express as px\n%matplotlib inline","ba4c8196":"df = pd.read_csv('..\/input\/heart-failure-prediction\/heart.csv')\ndf.head()","2066d00b":"df.info()","838ea461":"df_age= df.loc[:,[\"Sex\",\"HeartDisease\"]]\nfig,ax= plt.subplots(1,3,figsize=(15,4))\nsns.countplot(x=df_age.Sex,palette=sns.color_palette(\"pastel\"),edgecolor=sns.color_palette(\"dark\", 3),ax=ax[0])\nsns.despine()\nsns.countplot(x=df_age.HeartDisease,palette=sns.color_palette(\"pastel\"),edgecolor=sns.color_palette(\"dark\", 3),ax=ax[1])\nsns.despine()\nsns.countplot(data=df,x=\"Sex\",hue=\"HeartDisease\",palette=sns.color_palette(\"pastel\"),edgecolor=sns.color_palette(\"dark\", 3),ax=ax[2])\nsns.despine()","ad56f9c8":"plt.figure(figsize=(10,5))\nsns.histplot(x=df.Age,palette=sns.color_palette(\"pastel\"),edgecolor=sns.color_palette(\"dark\", 3),kde=True)\nsns.despine()","e89fb74d":"#Minors, young people, middle-aged people, middle-aged and old people, old people\u2014\u2014\u2014\u2014Five levels\ndfage = df.assign(box_age=pd.cut(df[\"Age\"],\n                         bins=[0,18,30,45,55,100])).loc[:,[\"box_age\",\"HeartDisease\"]].assign(count_pointer=1).groupby([\"box_age\",\"HeartDisease\"]).agg(count_num=(\"count_pointer\",\"count\"))\ndfage = dfage.reset_index()\ndfage","be9c8739":"plt.figure(figsize=(10,6))\nfig =sns.barplot(x=dfage[\"box_age\"],y=dfage[\"count_num\"],hue=dfage[\"HeartDisease\"],palette=sns.color_palette(\"pastel\"),edgecolor=sns.color_palette(\"dark\", 3))\nsns.despine()\n","85f45f29":"df[\"ChestPainType\"].value_counts()","2a4a1a67":"dfchest = df.assign(chest=1).loc[:,[\"ChestPainType\",\"HeartDisease\",\"chest\"]].groupby([\"ChestPainType\",\"HeartDisease\"]).agg(count_num=(\"chest\",\"sum\")).reset_index()\ndfchest","77f77129":"plt.figure(figsize=(10,6))\nfig =sns.barplot(x=dfchest[\"ChestPainType\"],y=dfchest[\"count_num\"],hue=dfchest[\"HeartDisease\"],palette=sns.color_palette(\"pastel\"),edgecolor=sns.color_palette(\"dark\", 3))\nsns.despine()","4cac49a7":"plt.figure(figsize=(10,6))\nsns.histplot(data=df,x=\"RestingBP\",kde=True,hue=\"HeartDisease\",color=\"r\")","7ad1cca9":"plt.figure(figsize=(10,6))\nsns.boxplot(data=df,y=\"RestingBP\",palette=sns.color_palette(\"pastel\"))\nsns.despine()","5b479b3e":"plt.figure(figsize=(10,6))\nsns.histplot(data=df,x=\"Cholesterol\",kde=True,hue=\"HeartDisease\")\nsns.despine()","8e732e8d":"plt.figure(figsize=(10,6))\nsns.boxplot(data=df,y=\"Cholesterol\",palette=sns.color_palette(\"pastel\"))\nsns.despine()","58250acf":"dfbs = df.assign(count_num=1).loc[:,[\"FastingBS\",\"HeartDisease\",\"count_num\"]].groupby([\"FastingBS\",\"HeartDisease\"]).agg(counts=(\"count_num\",\"sum\")).reset_index()\ndfbs","9cb22ce2":"plt.figure(figsize=(10,6))\nsns.barplot(data=dfbs,x=\"HeartDisease\",y=\"counts\",hue=\"FastingBS\",palette=sns.color_palette(\"pastel\"),edgecolor=sns.color_palette(\"dark\", 3))\nsns.despine()","ea462641":"dfecg = df.assign(count_num=1).loc[:,[\"RestingECG\",\"HeartDisease\",\"count_num\"]].groupby([\"RestingECG\",\"HeartDisease\"]).agg(counts=(\"count_num\",\"sum\")).reset_index()\ndfecg","3eb395fc":"plt.figure(figsize=(10,6))\nsns.barplot(data=dfecg,x=\"HeartDisease\",y=\"counts\",hue=\"RestingECG\",palette=sns.color_palette(\"pastel\"),edgecolor=sns.color_palette(\"dark\", 3))\nsns.despine()","92832e7d":"plt.figure(figsize=(10,6))\nsns.histplot(data=df,x=\"MaxHR\",kde=True,hue=\"HeartDisease\")\nsns.despine()","2b432e66":"dfex = df.assign(count_num=1).loc[:,[\"ExerciseAngina\",\"HeartDisease\",\"count_num\"]].groupby([\"ExerciseAngina\",\"HeartDisease\"]).agg(counts=(\"count_num\",\"sum\")).reset_index()\ndfex","2bc96e37":"plt.figure(figsize=(10,6))\nsns.barplot(data=dfex,x=\"HeartDisease\",y=\"counts\",hue=\"ExerciseAngina\",palette=sns.color_palette(\"pastel\"),edgecolor=sns.color_palette(\"dark\", 3))\nsns.despine()","07d49163":"plt.figure(figsize=(10,6))\nsns.histplot(data=df,x=\"Oldpeak\",hue=\"HeartDisease\")\nsns.despine()","fa1e4347":"dfst = df.assign(count_num=1).loc[:,[\"ST_Slope\",\"HeartDisease\",\"count_num\"]].groupby([\"ST_Slope\",\"HeartDisease\"]).agg(counts=(\"count_num\",\"sum\")).reset_index()\ndfst","5474d8a7":"plt.figure(figsize=(10,6))\nwith sns.axes_style({'axes.edgecolor': '#6b778d','ytick.color': \"#6b778d\",'text.color': '#6b778d','axes.labelcolor': '#6b778d','xtick.color': '#6b778d'}):\n    with sns.plotting_context({'ytick.labelsize':10,'legend.fontsize': 10,'axes.labelsize': 12}):\n        sns.barplot(data=dfst,x=\"ST_Slope\",y=\"counts\",hue=\"HeartDisease\",palette=sns.color_palette(\"pastel\"),edgecolor=sns.color_palette(\"dark\", 3))\n        plt.title(\"ST_slope and HeartDisease\",color=\"#17223b\")\n        sns.despine(bottom=True)","6c38ccd1":"from sklearn.neural_network import MLPClassifier\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.model_selection import train_test_split,GridSearchCV\nfrom sklearn.metrics import recall_score,roc_curve,roc_auc_score,plot_confusion_matrix","8a4db2bf":"#cat_data\ncat_list = df.select_dtypes(include=\"object\").columns.tolist()\nfor cat in cat_list:\n    df[cat] = df[cat].apply(lambda x:cat+\"_\"+x)\n    a = pd.get_dummies(df[cat])\n    df = pd.concat([df,a],axis=1)\n    df.drop(columns=cat,inplace=True)\ndf.head()","3ed975c8":"#num_cat\nnum_list= [\"Age\",\"RestingBP\",\"Cholesterol\",\"FastingBS\",\"MaxHR\",\"Oldpeak\"]\nfor i in num_list:\n    mean = df[i].mean()\n    std = df[i].std()\n    df[i] = df[i].map(lambda x:(x-mean)\/std)\ndf.head()","ddd119a0":"Y = df[\"HeartDisease\"]\nX = df.drop(columns=[\"HeartDisease\"])\nxtrain,xtest,ytrain,ytest = train_test_split(X,Y,test_size=0.25,random_state=123)","94710d93":"mlp = MLPClassifier(hidden_layer_sizes=(100,50,10),solver=\"lbfgs\")\nmlp.fit(xtrain,ytrain)\ny_pre = mlp.predict(xtest)\nrecall_mlp = round(recall_score(ytest,y_pre),2)\nmlp_prob = mlp.predict_proba(xtest)[:,1]\nmlp_auc = round(roc_auc_score(ytest,mlp_prob),2)\nmlp_score = round(mlp.score(xtest,ytest),2)\nmlp_dic = {\"recall_score\":recall_mlp,\"score\":mlp_score,\"auc\":mlp_auc}\nprint('')\nprint('--------------------------------')\nprint(\"score:\",mlp_score)\nprint(\"recall_call:{}.\".format(recall_mlp))\nprint(\"auc_score:\",mlp_auc)\nprint('')\nprint('-------------------------------')\nplot_confusion_matrix(mlp,xtest,ytest)\nplt.show()","784947f5":"fpr,tpr,thres = roc_curve(ytest,mlp_prob)\nplt.figure(figsize=(10,6))\nwith sns.axes_style({'axes.edgecolor': '#6b778d','ytick.color': \"#6b778d\",'text.color': '#6b778d','axes.labelcolor': '#6b778d','xtick.color': '#6b778d'}):\n    with sns.plotting_context({'ytick.labelsize':10,'legend.fontsize': 10,'axes.labelsize': 12}):\n        sns.lineplot(x=fpr,y=tpr,palette=sns.color_palette(\"pastel\"))\n        plt.title(\"ROC Curve visualization given the probabilities of scores of a classifier.\",color=\"#17223b\")\n        plt.xlabel(\"FPR\")\n        plt.ylabel(\"TPR\")\n        sns.despine()","5f47428f":"logist = LogisticRegression(random_state=123)\nparam_grid = {\n    \"C\":[0.01,0.03,0.05,0.04,1]\n}\ngrid = GridSearchCV(estimator=logist,param_grid=param_grid)\ngrid.fit(xtrain,ytrain)\ngrid.best_estimator_","1332d4a1":"logs = LogisticRegression(C=0.05,random_state=123)\nlogs.fit(xtrain,ytrain)\ny_pre_log = logs.predict(xtest)\nrecall_log = round(recall_score(ytest,y_pre_log),2)\nlog_prob = logs.predict_proba(xtest)[:,1]\nlog_auc = round(roc_auc_score(ytest,log_prob),2)\nlog_score = round(logs.score(xtest,ytest),2)\nlog_dic = {\"recall_score\":recall_log,\"score\":log_score,\"auc\":log_auc}\nprint('')\nprint('--------------------------------')\nprint(\"score:\",log_score)\nprint(\"recall_call:{}.\".format(recall_log))\nprint(\"auc_score:\",log_auc)\nprint('')\nprint('-------------------------------')\nplot_confusion_matrix(logs,xtest,ytest)\nplt.show()","3991af3f":"fp,tp,ths = roc_curve(ytest,log_prob)\nplt.figure(figsize=(10,6))\nwith sns.axes_style({'axes.edgecolor': '#6b778d','ytick.color': \"#6b778d\",'text.color': '#6b778d','axes.labelcolor': '#6b778d','xtick.color': '#6b778d'}):\n    with sns.plotting_context({'ytick.labelsize':10,'legend.fontsize': 10,'axes.labelsize': 12}):\n        sns.lineplot(x=fp,y=tp,palette=sns.color_palette(\"pastel\"))\n        plt.title(\"ROC Curve visualization given the probabilities of scores of a classifier--logisticregression.\",color=\"#17223b\")\n        plt.xlabel(\"FPR\")\n        plt.ylabel(\"TPR\")\n        sns.despine()","6e5dbed5":"ml = pd.Series(mlp_dic,name=\"mlp\")\nprint(ml)\nprint(\"\")\nprint(\"----------------\")\nlog_r = pd.Series(log_dic,name=\"logistic\")\nprint(log_r)","5235eaa4":"con = pd.concat([ml,log_r],axis=1).reset_index().rename({\"index\":\"score_type\"},axis=1)\nmel = pd.melt(con,id_vars=\"score_type\",value_vars=[\"mlp\",\"logistic\"],var_name=[\"model\"],value_name=\"values\")\nmel","dfad555e":"fig2 = px.bar(mel,x=\"score_type\",y=\"values\",color=\"model\",text=\"values\",title=\"MLP and Logistic --score(recall\/score\/auc)\")\nfig2.update_layout(barmode=\"group\")\nfig2.show()","fa0c86fb":"> Abnormal values of serum cholesterol","bd43d870":"> 1. The maximum heart rate of people with heart disease is basically below 135\n> 2. The maximum heart rate is very high, it may be because you like to exercise, resulting in a higher maximum heart rate, so the possibility of suffering from heart disease is lower.","12fe6506":"# **EDA**","1fef8fa2":"> 1. Higher rates of heart disease and exercise-induced angina pectoris\n> 2. Even people with angina but no heart disease","d674ddf2":"> 1. The above data shows that it is in line with our common sense of life. With age, the incidence of heart disease will increase, and there is a larger proportion when the age is over 55. \n> 2. According to the previous exploratory analysis of gender, older men may have a greater incidence of heart disease.","d4ca15b0":"> If the value of measuring depression exceeds 1, the more people suffer from heart disease, which may indicate that depression every day is bad for the heart.","a69ca74c":"> Whether the fasting blood glucose exceeds 120 mg\/dl, there is the possibility of heart disease, and the gap is not very large.","bac2515a":"> Abnormal resting blood pressure","25fe9633":"# **Build a machine learning model**","3bfb510a":"> 1. In this data set, men have more heart disease than women.\n> 2. No one under the age of 30 suffers from heart disease, but over the age of 30, the rate of heart disease increases.\n> 3. The maximum heart rate exceeds 140, and there is almost no heart disease","b5601584":" > The proportion of men in the data set is more than half, the proportion of heart disease is more balanced, and the proportion of men suffering from heart disease exceeds that of women.","85319a5c":" > 1. We can see that heart disease does not seem to have much to do with the type of chest pain. Even with asymptomatic chest pain, many people still suffer from heart disease.","2bf6f672":"> * Hi everyone, I am a beginner, and I am heading towards a data scientist.\nAs a beginner, I first conduct data exploratory analysis, then process category and numerical data, and then establish two models, such as logistic regression and MLP classification, and finally find that the values of logistic regression are higher than MLP.\nThrough exploratory analysis, I also found that these data seem not quite right, but it does not prevent us from practicing.\n> * I very much hope to make a friend with everyone here.","297249a4":"> The ST segment of exercise with heart disease has a relatively flat slope and a higher proportion","3ad57cf4":"* **(1)Processing category data and numerical data**\n* **(2)One-hot encoding for category data. Numerical data uses standardized processing**\n","bf5408a5":"# **Main results of data exploration**","58645818":"> 1. The age in the data set seems to be normally distributed, mainly between 45-65 years old.\n> 2. The age is divided into boxes to observe the proportion of different age groups suffering from heart disease.","5ccae10f":"> 1. The normal range of venous blood pressure is 130-85 mmHg. It can be seen that even if the venous blood pressure is within the normal range, there is still the possibility of heart disease.\n> 2. Venous blood pressure, seems to have abnormal values?","042f9657":"> The proportion of resting patients with heart disease is also high"}}