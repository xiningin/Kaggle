{"cell_type":{"2d4c1f5c":"code","1f9b2e74":"code","26d570e4":"code","e5a64873":"code","54b4a1b2":"code","be8ff5e6":"code","e650a7cd":"code","d94d17ed":"code","ec0435e7":"code","2d435861":"code","8231c22b":"code","f09ae51d":"code","a46b442c":"markdown","42e3220f":"markdown","a1a4f79c":"markdown","02802343":"markdown","83ee7b10":"markdown","19316dc9":"markdown"},"source":{"2d4c1f5c":"\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport glob\nimport json\nimport re\nimport scipy as sc\nimport warnings\n\nimport matplotlib.pyplot as plt\nimport os\n\n","1f9b2e74":"root_path = '\/kaggle\/input\/CORD-19-research-challenge\/'\nmetadata_path = f'{root_path}\/metadata.csv'\nmeta_df = pd.read_csv(metadata_path, dtype={\n    'pubmed_id': str,\n    'Microsoft Academic Paper ID': str, \n    'doi': str\n})\nmeta_df.head()\nmeta_df.info()","26d570e4":"meta_df.head()\n","e5a64873":"df=pd.read_csv('..\/input\/covid19prepareddata\/Prepared_data.csv')\ndf.head()\ndf.info()","54b4a1b2":"task1=\"\"\"Specifically, we want to know what the literature reports about:Specifically, we want to know what the literature reports about:\n\nWhat is the best method to combat the hypercoagulable state seen in COVID-19?\nWhat is the efficacy of novel therapeutics being tested currently?\"\"\"","be8ff5e6":"task=[task1]\nquery=[]\nfor i in range(len(task)):\n    task[i]=task[i].split(\"\\n\")\n    query.append(task[i][2:])\nprint(query)","e650a7cd":"!pip install -U sentence-transformers","d94d17ed":"from sklearn.metrics.pairwise import cosine_similarity\nfrom sentence_transformers import SentenceTransformer\n\nwarnings.filterwarnings(\"ignore\")\nmodel = SentenceTransformer('bert-base-nli-mean-tokens')\n    ","ec0435e7":"query_embeddings=[]\nfor i in range(len(query)):\n    query_embeddings.append(model.encode(query[i]))","2d435861":"df.reset_index(drop = True, inplace = True)\ndf['abstract_summary']\nabstract_summary_embeddings = model.encode(df['abstract_summary'])\n","8231c22b":"def getfile_insensitive(path):\n    directory, filename = os.path.split(path)\n    directory, filename = (directory or '.'), filename.lower()\n    for f in os.listdir(directory):\n        newpath = os.path.join(directory, f)\n        if os.path.isfile(newpath) and f.lower() == filename:\n            return newpath\n\ndef isfile_insensitive(path):\n    return getfile_insensitive(path) is not None\n\nsample_document='7_therapeutics_interventions_and_clinical_studies'\n","f09ae51d":"scores=[]\ndef formatting(_topdf):\n    _topdf.rename(columns={'journal':'Journal'},inplace=True)\n    _topdf.rename(columns={'url':'Study Link'},inplace=True)\n    _topdf.rename(columns={'publish_time':'Date'},inplace=True)\n    _topdf.rename(columns={'title':'Study'},inplace=True)\n    \n    return _topdf\nfor tsk in range(len(task)):\n    \n    for prob, query_embedding in zip(query[tsk], query_embeddings[tsk]):\n        dis = sc.spatial.distance.cdist([query_embedding], abstract_summary_embeddings, \"cosine\")[0]\n        #print(dis)\n        results = zip(range(len(dis)), dis)\n        results = sorted(results, key=lambda x: x[1])\n        #print(\"Query:\", prob)\n        #print(\"Answer:\" )\n        scores.append(1-results[0][1])\n        #print(df['abstract'][results[0][0]].strip(), \"\\n(Score: %.4f)\" % (1-results[0][1]),\"\\n\")\n        k=50\n        #print(results[:k])\n        topk=results[:k]\n        id,id_v=zip(*topk)\n        topData=df.iloc[1]\n        _topdf = df.iloc[list(id), :]\n        _topdf = formatting(_topdf)\n        csv_str=prob.replace('?','_')+'.csv'\n        #print(csv_str)\n        path1 = f'{root_path}Kaggle\/target_tables\/{sample_document}\/'+csv_str\n        path1 = f'{path1}'\n        print(path1)\n        if (isfile_insensitive(path1)):\n            path1=getfile_insensitive(path1)\n            q_df = pd.read_csv(path1)\n            print(\"exist!\")\n        else:      \n            path1 = f'{root_path}Kaggle\/target_tables\/{sample_document}\/'\n            path1 = os.path.join(path1,os.listdir(path1)[-1])\n            q_df = pd.read_csv(path1)\n            q_df.drop(q_df.index,inplace=True)\n        #print(path1)\n        q_df.head()\n        q_df\n        #print(len(q_df))\n        #print(len(_topdf))\n        #print(q_df.columns)\n        res_df = pd.merge(q_df, _topdf, how='outer', on=['Study','Study Link','Date','Journal'])[q_df.columns[1:]]\n        #print(len(res_df))\n        res_df.info()\n        res_csv=r'\/kaggle\/output\/'+ csv_str\n        print(res_csv)\n        res_df.to_csv( csv_str, index = True)","a46b442c":"Specifically, we want to know what the literature reports about:\n\n- What is the best method to **combat the hypercoagulable state** seen in COVID-19?\n- What is the **efficacy** of **novel therapeutics** being tested currently?","42e3220f":"@inproceedings{Population studies that related to COVID-19, author = {Hang, Wu}, title = {Population studies that related to COVID-19}, year = {2020}, month = {June}, url = {\\url{https:\/\/www.kaggle.com\/nike0good\/population-studies-that-related-to-covid-19} } }","a1a4f79c":"# Prepare data","02802343":"# Get data from Prepared data. This data is created in another notebook in kaggle I made.\n\nCite:\nhttps:\/\/www.kaggle.com\/nike0good\/population-studies-that-related-to-covid-19","83ee7b10":"# This is a notebook that address therapeutics, interventions, and clinical studies.","19316dc9":"# Check the keywords of the problems."}}