{"cell_type":{"02df229c":"code","9e30282f":"code","3ae3e5ea":"code","6ef83f5f":"code","360fc129":"code","ce05868e":"code","6bc91cae":"code","22496400":"code","c7e87386":"code","462a42a3":"code","7ca7209c":"code","01470099":"code","fcead1b5":"code","157cacb4":"code","1cf0bae8":"code","dd7e3a6c":"code","235b0a4c":"code","d16e9993":"code","e9191669":"code","15139a8b":"code","fb04fad2":"code","cca6035b":"code","439b2bda":"code","bffdcc61":"code","e0ae454d":"code","057cfae5":"code","35fc94f3":"code","d3966173":"code","754da6b5":"markdown","475b0db2":"markdown","910ee1c3":"markdown","0f597da0":"markdown","6361c5bb":"markdown","8474bdbd":"markdown","1f05a1bb":"markdown","1e0f8e8f":"markdown","c6647fe4":"markdown"},"source":{"02df229c":"import numpy as np\nimport pandas as pd \n\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import RobustScaler\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.calibration import CalibratedClassifierCV\nfrom sklearn.metrics import roc_auc_score\nfrom sklearn.calibration import calibration_curve\n\n%matplotlib inline\nimport matplotlib.pyplot as plt\nimport matplotlib.lines as mlines\nimport matplotlib.transforms as mtransforms","9e30282f":"train = pd.read_csv('..\/input\/tabular-playground-series-nov-2021\/train.csv')","3ae3e5ea":"test = pd.read_csv('..\/input\/tabular-playground-series-nov-2021\/test.csv')","6ef83f5f":"train.set_index('id', inplace=True)","360fc129":"Xy_frac = train.sample(frac=0.2520, weights = 1.\/train.groupby('target')['target'].transform('count'), random_state=3)","ce05868e":"y = Xy_frac[\"target\"].copy()\nX = Xy_frac.drop(columns=[\"target\"]).copy()\ntest_df = test.drop(columns=[\"id\"]).copy()","6bc91cae":"X_train, X_test, y_train, y_test = train_test_split(X, y, stratify=y,  test_size=.2520, random_state=1)","22496400":"X_train.shape, X_test.shape, y_train.shape, y_test.shape","c7e87386":"rsc=RobustScaler()","462a42a3":"X_train = pd.DataFrame(data=rsc.fit_transform(X_train), columns=X_train.columns)","7ca7209c":"X_test = pd.DataFrame(data=rsc.transform(X_test), columns=X_test.columns)","01470099":"model_forest = RandomForestClassifier(n_estimators = 1500, criterion = 'entropy', random_state = 0)","fcead1b5":"model_forest.fit(X_train, y_train)","157cacb4":"y_pred = model_forest.predict_proba(X_test)\nscores = roc_auc_score(y_test, y_pred[:, 1])","1cf0bae8":"print(scores)","dd7e3a6c":"crfc= RandomForestClassifier(n_estimators = 1500, criterion = 'entropy', random_state = 0)","235b0a4c":"clf_isotonic = CalibratedClassifierCV(crfc, method='isotonic',cv=3)","d16e9993":"clf_isotonic.fit(X_train, y_train)","e9191669":"predictions_isotonic = clf_isotonic.predict_proba(X_test)\nscore_d = roc_auc_score(y_test, predictions_isotonic[:, 1])","15139a8b":"print(score_d)","fb04fad2":"rfc_y, rfc_x = calibration_curve(y_test, y_pred[:,1], n_bins=10)","cca6035b":"crfc_y, crfc_x = calibration_curve(y_test, predictions_isotonic[:,1], n_bins=10)","439b2bda":"fig, ax = plt.subplots()\n# only these two lines are calibration curves\nplt.plot(rfc_x,rfc_y, marker='o', linewidth=1, label='RandomForestClassifier')\nplt.plot(crfc_x, crfc_y, marker='o', linewidth=1, label='CalibratedClassifierCV')\n\n# reference line, legends, and axis labels\nline = mlines.Line2D([0, 1], [0, 1], color='black')\ntransform = ax.transAxes\nline.set_transform(transform)\nax.add_line(line)\nfig.suptitle('Calibration plot')\nax.set_xlabel('Predicted probability')\nax.set_ylabel('True probability in each bin')\nplt.legend()\nplt.show()","bffdcc61":"rosc=RobustScaler()","e0ae454d":"test_df = pd.DataFrame(data=rosc.fit_transform(test_df), columns=test_df.columns)","057cfae5":"prends=clf_isotonic.predict_proba(test_df)[:,1]","35fc94f3":"sub_df = pd.read_csv('..\/input\/tabular-playground-series-nov-2021\/sample_submission.csv')\nsub_duff=sub_df.copy()","d3966173":"sub_duff[\"target\"] = prends\nsub_duff.to_csv(\"submission_shared.csv\", index=False)\n\nsub_duff.head()","754da6b5":"<h3><font color=red> Gen\u00b7er\u00b7ate representative sample","475b0db2":"<h3><font color=red> CalibratedClassifierCV","910ee1c3":"<h3><font color=red>sub\u00b7mis\u00b7sion","0f597da0":"<h3><font color=red> Data Split","6361c5bb":"<h3><font color=red> Data ","8474bdbd":"<h3><font color=red>RandomForestClassifier","1f05a1bb":"<h3><font color=red>Calibration Curve","1e0f8e8f":"<h3><font color=red>Robust Scaler","c6647fe4":"<h3><font color=red>Calibration plot"}}