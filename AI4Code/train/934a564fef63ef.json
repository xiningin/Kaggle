{"cell_type":{"4e70f881":"code","f4c6cd55":"code","dd10449d":"code","13f3cb5a":"code","dd96e08c":"code","45926ae5":"code","8237b09c":"code","fe67a771":"code","0b08a76d":"code","780bf731":"code","ebe1f6d8":"code","e6404cb9":"code","efacef08":"code","10502978":"code","075eb397":"code","5f252207":"code","f1235003":"code","23445cbb":"code","b95e6bfb":"code","92ad912d":"code","31f1e851":"code","82472c75":"code","8d262431":"code","32c816f1":"code","55e5899d":"code","e80ff6f3":"code","fee387f7":"code","d6ca3b92":"code","dac5342b":"code","be532b6d":"code","126e7553":"markdown"},"source":{"4e70f881":"%run ..\/input\/python-recipes\/dhtml.py\ndhtml('Code Modules & Settings','#aa33ff',f2,fs8)","f4c6cd55":"import warnings,time\nwarnings.filterwarnings('ignore')\nimport sklearn.datasets as sds\nimport sklearn.cluster as scl\nimport sklearn.metrics as sme\nimport sklearn.manifold as sma\nimport numpy as np,pandas as pd,pylab as pl\nfrom IPython.core.magic import register_line_magic\nfrom scipy.spatial.distance import pdist,squareform\nfrom scipy.cluster.hierarchy import linkage,dendrogram","dd10449d":"dhtml('Data','#aa33ff',f2,fs8)","13f3cb5a":"N=1000; n_clusters=7\nX,y=sds.make_blobs(n_samples=N,n_features=2, \n                   centers=n_clusters,cluster_std=.7, \n                   shuffle=True,random_state=0)\npl.scatter(X[:,0],X[:,1],\n           c='white',marker='v',\n           edgecolor='#aa33ff',s=30)\npl.grid(); pl.tight_layout();","dd96e08c":"variables=['a','b','c']\nlabels=['id'+str(i) for i in range(1,10)]\nX2=np.random.random_sample([9,3])*10\ndf=pd.DataFrame(X2,columns=variables,index=labels)\ndf.plot(kind='barh',cmap='cool');","45926ae5":"X3,y3=sds.make_moons(n_samples=500,noise=.1,\n                     random_state=0)\npl.scatter(X3[:,0],X3[:,1],\n           c='white',marker='v',\n           edgecolor='#aa33ff',s=30)\npl.tight_layout(); pl.grid(); pl.show()","8237b09c":"digits=sds.load_digits()\nX4,y4=digits.data,digits.target\nX4.shape,y4.shape","fe67a771":"n=10; img=np.zeros((10*n,10*n))\nfor i in range(n): \n    for j in range(n): \n        img[(10*i+1):(10*i+9),\n            (10*j+1):(10*j+9)]=X4[i*n+j]\\\n        .reshape((8,8))\npl.figure(figsize=(5,5))\npl.imshow(img,cmap=pl.cm.cool)\npl.title('8x8 pixel images of digits')\npl.xticks([]); pl.yticks([]);","0b08a76d":"dhtml('Clustering','#aa33ff',f2,fs8)","780bf731":"km,y_km=[],[]\n@register_line_magic\ndef kmeans_clusters(c):\n    n_clusters=int(c)\n    global km,y_km\n    km=scl.KMeans(n_clusters=n_clusters,\n                  init='k-means++',n_init=10,\n                  max_iter=500,tol=1e-04,\n                  random_state=0)\n    y_km=km.fit_predict(X)","ebe1f6d8":"%kmeans_clusters 7","e6404cb9":"for i in range(n_clusters):\n    color=pl.cm.hsv(float(i)\/n_clusters)\n    pl.scatter(X[y_km==i,0],X[y_km==i,1],\n               s=30,color=color,marker='v',\n               edgecolor='#aa33ff',\n               label='cluster %d'%i)\npl.scatter(km.cluster_centers_[:,0],\n           km.cluster_centers_[:,1],\n           s=100, marker='*',c='black',\n           edgecolor='#aa33ff',label='centroids')\npl.legend(scatterpoints=1); pl.tight_layout();","efacef08":"iner=[]\nfor i in range(1,12):\n    km=scl.KMeans(n_clusters=i,init='k-means++',\n                  n_init=10,max_iter=500, \n                  random_state=0)\n    km.fit(X);iner.append(km.inertia_)\npl.plot(range(1,12),iner,marker='v',c='#aa33ff')\npl.xlabel('number of clusters')\npl.axvline(7,color='purple',linestyle=':')\npl.ylabel('inertia')\npl.tight_layout(); pl.grid()","10502978":"@register_line_magic\ndef silhouette_plots(n):\n    n_clusters=int(n); labels=np.unique(y_km)\n    svalues=sme.\\\n    silhouette_samples(X,y_km,metric='euclidean')\n    y_ax_lower,y_ax_upper=0,0; yticks=[]\n    for i,c in enumerate(labels):\n        c_svalues=svalues[y_km==c]\n        c_svalues.sort()\n        y_ax_upper+=len(c_svalues)\n        color=pl.cm.cool(float(i)\/n_clusters)\n        pl.barh(range(y_ax_lower,y_ax_upper),\n                c_svalues,height=1., \n                edgecolor='none',color=color)\n        yticks.append((y_ax_lower+y_ax_upper)\/2.)\n        y_ax_lower+=len(c_svalues)\n    savg=np.mean(svalues)\n    pl.axvline(savg, color=\"red\",linestyle=\"--\") \n    pl.yticks(yticks,labels+1)\n    pl.ylabel('clusters')\n    pl.xlabel('silhouette coefficients')\n    pl.tight_layout(); pl.show()","075eb397":"#well-fitted cluster amount\n%kmeans_clusters 7\n%silhouette_plots 7","5f252207":"#bad-fitted cluster amount\n%kmeans_clusters 4\n%silhouette_plots 4","f1235003":"dhtml('Clusters as a Hierarchical Tree','#aa33ff',f2,fs8)","23445cbb":"ac=scl.AgglomerativeClustering(n_clusters=3, \n                               affinity='euclidean', \n                               linkage='complete')\nac_labels=ac.fit_predict(X2)\nprint('Cluster labels: %s'%ac_labels)","b95e6bfb":"@register_line_magic\ndef dist_clusters(method):\n    row_dist=pdist(df,metric='euclidean')\n    if method=='False':\n        row_dist=squareform(row_dist)\n    row_clusters=linkage(row_dist,\n                         method='complete',\n                         metric='euclidean')\n    c=row_clusters.shape[0]\n    rc=pd.DataFrame(row_clusters,\n                    columns=['row label 1','row label 2',\n                             'distance','n_items'],\n                    index=['cl%d'%(i+1) \n                           for i in range(c)])\n    display(rc)\n    fig=pl.figure(figsize=(8,8))\n    axd=fig.add_axes([.1,.1,.31,.6])\n    d=dendrogram(row_clusters,orientation='left',\n                 labels=labels)\n    df_cl=df.iloc[d['leaves'][::-1]]\n    axd.set_xticks([]); axd.set_yticks([])\n    for i in axd.spines.values():\n        i.set_visible(False)\n    axm=fig.add_axes([.2,.1,.6,.6])\n    cax=axm.matshow(df_cl,interpolation='nearest',\n                    cmap='cool')\n    fig.colorbar(cax)\n    ac=[str(ac_labels[int(el[2])-1])+'-'+el \n        for el in list(df_cl.index)]\n    axm.set_xticklabels(['']+list(df_cl.columns))\n    axm.set_yticklabels(['']+ac)\n    if method=='False': pl.title('incorrect')\n    else: pl.title('correct')\n    pl.show()","92ad912d":"%dist_clusters False","31f1e851":"%dist_clusters True","82472c75":"dhtml('DBSCAN, OPTICS, & Others','#aa33ff',f2,fs8)","8d262431":"n_clusters=2\nkm=scl.KMeans(n_clusters=n_clusters,random_state=0)\ny3_km=km.fit_predict(X3)\nac=scl.AgglomerativeClustering(n_clusters=n_clusters,\n                               affinity='euclidean',\n                               linkage='complete')\ny3_ac=ac.fit_predict(X3)\nsp=scl.SpectralClustering(n_clusters=n_clusters)\ny3_sp=sp.fit_predict(X3)\ndb=scl.DBSCAN(eps=.2,min_samples=15,\n              metric='euclidean')\ny3_db=db.fit_predict(X3)\nop=scl.OPTICS(eps=.2,min_samples=30)\ny3_op=op.fit_predict(X3)\ncl=['KMeans','Agglomerative','Spectral',\n    'DBSCAN','OPTICS']\npy3=[y3_km,y3_ac,y3_sp,y3_db,y3_op]","32c816f1":"f,ax=pl.subplots(5,1,figsize=(6,18))\nfor c in range(5):\n    for i in np.unique(py3[c]):\n        color=pl.cm.cool(.4*(i+1))\n        ax[c].scatter(X3[py3[c]==i,0],\n                      X3[py3[c]==i,1],\n               s=30,color=color,marker='v',\n               edgecolor='#aa33ff',\n               label='cluster %d'%i)\n    ax[c].legend(scatterpoints=1)\n    ax[c].set_xticks([]); ax[c].set_yticks([])\n    ax[c].set_title(cl[c]); ","55e5899d":"dhtml('TSNE & Clustering','#aa33ff',f2,fs8)","e80ff6f3":"t0=time.time()\nX4_emb=sma.TSNE(n_components=2,learning_rate=700.)\\\n.fit_transform(X4)\nx_min,x_max=np.min(X4_emb,0),np.max(X4_emb,0)\nX4_emb=(X4_emb-x_min)\/(x_max-x_min)\nf,ax=pl.subplots(1,figsize=(7,7))\npl.axis(\"off\")\nfor i in range(X4_emb.shape[0]):\n    pl.text(X4_emb[i,0],X4_emb[i,1],str(y4[i]),\n            color=pl.cm.hsv(y4[i]\/10.))\npl.title(\"t-SNE embedding %f s\"%(time.time()-t0))\npl.tight_layout();","fee387f7":"n_clusters=10\nkm=scl.KMeans(n_clusters=n_clusters,\n              init='k-means++',n_init=10,\n              max_iter=500,tol=1e-05,\n              random_state=0)\ny4_km=km.fit_predict(X4_emb)\nlabs=[int(np.median(y4[np.where([y4_km==i])[1]]))\n      for i in range(10)]\nrd=dict(zip(list(range(10)),labs))\ncl=np.array([rd.get(x,x) for x in y4_km],\n                dtype='int8')","d6ca3b92":"f,ax=pl.subplots(1,figsize=(7,7))\nfor i in range(n_clusters):\n    color=pl.cm.hsv(float(i)\/n_clusters)\n    pl.scatter(X4_emb[cl==i,0],\n               X4_emb[cl==i,1],\n               s=30,color=color,\n               marker='$%d$'%i,\n               label='cluster %d'%i)\npl.scatter(km.cluster_centers_[:,0],\n           km.cluster_centers_[:,1],\n           s=100, marker='*',c='black',\n           edgecolor='#aa33ff',label='centroids')\npl.legend(scatterpoints=1); pl.tight_layout();","dac5342b":"dhtml('Interactive Experiments','#aa33ff',f2,fs8)","be532b6d":"%%html\n<div id='smcell' style=\"border:10px double white; \n     width:680px; height:850px; overflow:auto; \n     padding:10px; background-color:ghostwhite\">\n<iframe id='if1' \nsrc=\"https:\/\/olgabelitskaya.gitlab.io\/kaggle\/kaggle_smc04.html\" \nwidth=\"630\" height=\"800\"\/><\/div>","126e7553":"[Reading classics - Python Machine Learning](https:\/\/github.com\/rasbt\/python-machine-learning-book-3rd-edition\/blob\/master\/ch11\/ch11.ipynb)"}}