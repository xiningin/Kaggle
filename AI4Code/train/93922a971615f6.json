{"cell_type":{"713031b7":"code","a56d81ef":"code","b6df81ea":"code","7738f85b":"code","5dae45d1":"code","a03d0c11":"code","ab51cd2a":"code","abe54bba":"code","c902c3c6":"code","b72a792f":"code","e76930bc":"code","c2317039":"code","85e29090":"code","a7e047ce":"code","001835e3":"code","b8d64c8d":"code","106a0749":"code","b74d4399":"code","a3fc9d2d":"code","a1d43a3a":"code","e47332aa":"code","9d317458":"code","626909d0":"code","eabe43da":"code","4b762cbb":"code","4e24f21f":"code","36a30474":"code","4359cba1":"code","ecb6c222":"code","3b18a6f5":"code","fc19a757":"code","d08d16f5":"code","d5e42b98":"code","1a2d6602":"code","1add2f08":"code","b922c7c7":"code","01065ef4":"code","fd8f60f4":"code","488f2cbf":"code","5b724c5f":"code","b25ee0d6":"code","ee2686d0":"markdown","25fccc72":"markdown","3b461c3e":"markdown","e18aa6a6":"markdown","4dca2a7f":"markdown","e86d5fa0":"markdown","dd1a8a6e":"markdown","a675ac32":"markdown","84a94d3d":"markdown","2b5fe2fc":"markdown"},"source":{"713031b7":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport warnings\nwarnings.filterwarnings('ignore')\nimport seaborn as sns\nimport matplotlib\nmatplotlib.rcParams['axes.unicode_minus']=False\nmatplotlib.rcParams['font.family']=\"Hancom Gothic\"\nplt.style.use('ggplot')\nfrom sklearn.preprocessing import scale,minmax_scale\nimport os\nimport xgboost as xgb\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.cluster import KMeans","a56d81ef":"train_lab = pd.read_csv('..\/input\/bigcontest2019\/train_label.csv')\ntrain_act = pd.read_csv('..\/input\/bigcontest2019\/train_activity.csv')\ntrain_com = pd.read_csv('..\/input\/bigcontest2019\/train_combat.csv')\ntrain_ple = pd.read_csv('..\/input\/bigcontest2019\/train_pledge.csv')\ntrain_tra = pd.read_csv('..\/input\/bigcontest2019\/train_trade.csv')\ntrain_pay = pd.read_csv('..\/input\/bigcontest2019\/train_payment.csv')\nprint('train_label.shape :',train_lab.shape)\nprint('train_activity.shape :',train_act.shape)\nprint('train_combat.shape :',train_com.shape)\nprint('train_pledge.shape :',train_ple.shape)\nprint('train_trade.shape :',train_tra.shape)\nprint('train_payment.shape :',train_pay.shape)","b6df81ea":"train_valid = pd.read_csv('..\/input\/bigcontest2019\/train_valid_user_id.csv')\nprint('train_vaild.shape :',train_valid.shape)","7738f85b":"train_act['playtime'][(train_act['playtime']==0)&(train_act['fishing']!=0)] = train_act['fishing'][(train_act['playtime']==0)&(train_act['fishing']!=0)]\ntrain_act[(train_act['playtime']==0)]","5dae45d1":"train_act.head()","a03d0c11":"train_com.head()","ab51cd2a":"train_ple.head()","abe54bba":"train_tra.head()","c902c3c6":"train_pay.head()","b72a792f":"train = pd.DataFrame({'acc_id':train_act['acc_id'].unique()})\nprint(train.shape)\ntrain.head()","e76930bc":"train_act.columns","c2317039":"train_act['game_money_change'] = np.abs(train_act['game_money_change'])","85e29090":"day_playtime = train_act.groupby(['acc_id','day'])['playtime'].sum().unstack()\nday_playtime = day_playtime.fillna(0)\nday_playtime.columns = ['playtime_day{}'.format(i+1) for i in range(28)]\nday_playtime = day_playtime.reset_index()\nprint(day_playtime.shape)\ntrain = pd.merge(train, day_playtime, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","a7e047ce":"day_npc_kill = train_act.groupby(['acc_id','day'])['npc_kill'].sum().unstack()\nday_npc_kill = day_npc_kill.fillna(0)\nday_npc_kill.columns = ['npc_kill_day{}'.format(i+1) for i in range(28)]\nday_npc_kill = day_npc_kill.reset_index()\nprint(day_npc_kill.shape)\ntrain = pd.merge(train, day_npc_kill, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","001835e3":"day_solo_exp = train_act.groupby(['acc_id','day'])['solo_exp'].sum().unstack()\nday_solo_exp = day_solo_exp.fillna(0)\nday_solo_exp.columns = ['solo_exp_day{}'.format(i+1) for i in range(28)]\nday_solo_exp = day_solo_exp.reset_index()\nprint(day_solo_exp.shape)\ntrain = pd.merge(train, day_solo_exp, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","b8d64c8d":"day_party_exp = train_act.groupby(['acc_id','day'])['party_exp'].sum().unstack()\nday_party_exp = day_party_exp.fillna(0)\nday_party_exp.columns = ['party_exp_day{}'.format(i+1) for i in range(28)]\nday_party_exp = day_party_exp.reset_index()\nprint(day_party_exp.shape)\ntrain = pd.merge(train, day_party_exp, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","106a0749":"day_quest_exp = train_act.groupby(['acc_id','day'])['quest_exp'].sum().unstack()\nday_quest_exp = day_quest_exp.fillna(0)\nday_quest_exp.columns = ['quest_exp_day{}'.format(i+1) for i in range(28)]\nday_quest_exp = day_quest_exp.reset_index()\nprint(day_quest_exp.shape)\ntrain = pd.merge(train, day_quest_exp, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","b74d4399":"day_rich_monster = train_act.groupby(['acc_id','day'])['rich_monster'].sum().unstack()\nday_rich_monster = day_rich_monster.fillna(0)\nday_rich_monster.columns = ['rich_monster_day{}'.format(i+1) for i in range(28)]\nday_rich_monster = day_rich_monster.reset_index()\nprint(day_rich_monster.shape)\ntrain = pd.merge(train, day_rich_monster, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","a3fc9d2d":"day_death = train_act.groupby(['acc_id','day'])['death'].sum().unstack()\nday_death = day_death.fillna(0)\nday_death.columns = ['death_day{}'.format(i+1) for i in range(28)]\nday_death = day_death.reset_index()\nprint(day_death.shape)\ntrain = pd.merge(train, day_death, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","a1d43a3a":"day_revive = train_act.groupby(['acc_id','day'])['revive'].sum().unstack()\nday_revive = day_revive.fillna(0)\nday_revive.columns = ['revive_day{}'.format(i+1) for i in range(28)]\nday_revive = day_revive.reset_index()\nprint(day_revive.shape)\ntrain = pd.merge(train, day_revive, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","e47332aa":"day_exp_recovery = train_act.groupby(['acc_id','day'])['exp_recovery'].sum().unstack()\nday_exp_recovery = day_exp_recovery.fillna(0)\nday_exp_recovery.columns = ['exp_recovery_day{}'.format(i+1) for i in range(28)]\nday_exp_recovery = day_exp_recovery.reset_index()\nprint(day_exp_recovery.shape)\ntrain = pd.merge(train, day_exp_recovery, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","9d317458":"day_game_money = train_act.groupby(['acc_id','day'])['game_money_change'].sum().unstack()\nday_game_money = day_game_money.fillna(0)\nday_game_money.columns = ['game_money_change_day{}'.format(i+1) for i in range(28)]\nday_game_money = day_game_money.reset_index()\nprint(day_game_money.shape)\ntrain = pd.merge(train, day_game_money, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","626909d0":"day_fishing = train_act.groupby(['acc_id','day'])['fishing'].sum().unstack()\nday_fishing = day_fishing.fillna(0)\nday_fishing.columns = ['fishing_day{}'.format(i+1) for i in range(28)]\nday_fishing = day_fishing.reset_index()\nprint(day_fishing.shape)\ntrain = pd.merge(train, day_fishing, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","eabe43da":"day_private_shop = train_act.groupby(['acc_id','day'])['private_shop'].sum().unstack()\nday_private_shop = day_private_shop.fillna(0)\nday_private_shop.columns = ['private_shop_day{}'.format(i+1) for i in range(28)]\nday_private_shop = day_private_shop.reset_index()\nprint(day_private_shop.shape)\ntrain = pd.merge(train, day_private_shop, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","4b762cbb":"day_enchant_count = train_act.groupby(['acc_id','day'])['enchant_count'].sum().unstack()\nday_enchant_count = day_enchant_count.fillna(0)\nday_enchant_count.columns = ['enchant_count_day{}'.format(i+1) for i in range(28)]\nday_enchant_count = day_enchant_count.reset_index()\nprint(day_enchant_count.shape)\ntrain = pd.merge(train, day_enchant_count, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","4e24f21f":"train_com.columns","36a30474":"day_level = train_com.groupby(['acc_id','day'])['level'].sum().unstack()\nday_level = day_level.fillna(0)\nday_level.columns = ['level_day{}'.format(i+1) for i in range(28)]\nday_level = day_level.reset_index()\nprint(day_level.shape)\ntrain = pd.merge(train, day_level, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","4359cba1":"day_pledge_cnt = train_com.groupby(['acc_id','day'])['pledge_cnt'].sum().unstack()\nday_pledge_cnt = day_pledge_cnt.fillna(0)\nday_pledge_cnt.columns = ['pledge_cnt_day{}'.format(i+1) for i in range(28)]\nday_pledge_cnt = day_pledge_cnt.reset_index()\nprint(day_pledge_cnt.shape)\ntrain = pd.merge(train, day_pledge_cnt, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","ecb6c222":"day_random_attacker_cnt = train_com.groupby(['acc_id','day'])['random_attacker_cnt'].sum().unstack()\nday_random_attacker_cnt = day_random_attacker_cnt.fillna(0)\nday_random_attacker_cnt.columns = ['random_attacker_cnt_day{}'.format(i+1) for i in range(28)]\nday_random_attacker_cnt = day_random_attacker_cnt.reset_index()\nprint(day_random_attacker_cnt.shape)\ntrain = pd.merge(train, day_random_attacker_cnt, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","3b18a6f5":"day_random_defender_cnt = train_com.groupby(['acc_id','day'])['random_defender_cnt'].sum().unstack()\nday_random_defender_cnt = day_random_defender_cnt.fillna(0)\nday_random_defender_cnt.columns = ['random_defender_cnt_day{}'.format(i+1) for i in range(28)]\nday_random_defender_cnt = day_random_defender_cnt.reset_index()\nprint(day_random_defender_cnt.shape)\ntrain = pd.merge(train, day_random_defender_cnt, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","fc19a757":"day_temp_cnt = train_com.groupby(['acc_id','day'])['temp_cnt'].sum().unstack()\nday_temp_cnt = day_temp_cnt.fillna(0)\nday_temp_cnt.columns = ['temp_cnt_day{}'.format(i+1) for i in range(28)]\nday_temp_cnt = day_temp_cnt.reset_index()\nprint(day_temp_cnt.shape)\ntrain = pd.merge(train, day_temp_cnt, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","d08d16f5":"day_same_pledge_cnt = train_com.groupby(['acc_id','day'])['same_pledge_cnt'].sum().unstack()\nday_same_pledge_cnt = day_same_pledge_cnt.fillna(0)\nday_same_pledge_cnt.columns = ['same_pledge_cnt_day{}'.format(i+1) for i in range(28)]\nday_same_pledge_cnt = day_same_pledge_cnt.reset_index()\nprint(day_same_pledge_cnt.shape)\ntrain = pd.merge(train, day_same_pledge_cnt, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","d5e42b98":"day_etc_cnt = train_com.groupby(['acc_id','day'])['etc_cnt'].sum().unstack()\nday_etc_cnt = day_etc_cnt.fillna(0)\nday_etc_cnt.columns = ['etc_cnt_day{}'.format(i+1) for i in range(28)]\nday_etc_cnt = day_etc_cnt.reset_index()\nprint(day_etc_cnt.shape)\ntrain = pd.merge(train, day_etc_cnt, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","1a2d6602":"day_num_opponent = train_com.groupby(['acc_id','day'])['num_opponent'].sum().unstack()\nday_num_opponent = day_num_opponent.fillna(0)\nday_num_opponent.columns = ['num_opponent_day{}'.format(i+1) for i in range(28)]\nday_num_opponent = day_num_opponent.reset_index()\nprint(day_num_opponent.shape)\ntrain = pd.merge(train, day_num_opponent, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","1add2f08":"train_sell = train_tra.drop(['target_acc_id','target_char_id'],axis=1)  # \ud310\ub9e4 \ub370\uc774\ud130\ntrain_buy = train_tra.drop(['source_acc_id','source_char_id'],axis=1)   # \uad6c\ub9e4 \ub370\uc774\ud130\n\ntest1_sell = test1_tra.drop(['target_acc_id','target_char_id'],axis=1)  # \ud310\ub9e4 \ub370\uc774\ud130\ntest1_buy = test1_tra.drop(['source_acc_id','source_char_id'],axis=1)   # \uad6c\ub9e4 \ub370\uc774\ud130\n\ntest2_sell = test2_tra.drop(['target_acc_id','target_char_id'],axis=1)  # \ud310\ub9e4 \ub370\uc774\ud130\ntest2_buy = test2_tra.drop(['source_acc_id','source_char_id'],axis=1)   # \uad6c\ub9e4 \ub370\uc774\ud130\n\ntrain_sell = train_sell.rename(columns = {'source_acc_id':'acc_id',\n                                          'source_char_id':'char_id',\n                                          'item_type':'sell_item_type',\n                                          'item_amount':'sell_item_amount',\n                                          'item_price':'sell_item_price',\n                                          'time':'sell_time',\n                                          'type':'sell_type'})\ntrain_buy = train_buy.rename(columns = {'target_acc_id':'acc_id',\n                                         'target_char_id':'char_id',\n                                         'item_type':'buy_item_type',\n                                         'item_amount':'buy_item_amount',\n                                         'item_price':'buy_item_price',\n                                         'time':'buy_time',\n                                         'type':'buy_type'})\ntest1_sell = test1_sell.rename(columns = {'source_acc_id':'acc_id',\n                                          'source_char_id':'char_id',\n                                          'item_type':'sell_item_type',\n                                          'item_amount':'sell_item_amount',\n                                          'item_price':'sell_item_price',\n                                          'time':'sell_time',\n                                          'type':'sell_type'})\ntest1_buy = test1_buy.rename(columns = {'target_acc_id':'acc_id',\n                                        'target_char_id':'char_id',\n                                        'item_type':'buy_item_type',\n                                        'item_amount':'buy_item_amount',\n                                        'item_price':'buy_item_price',\n                                        'time':'buy_time',\n                                        'type':'buy_type'})\ntest2_sell = test2_sell.rename(columns = {'source_acc_id':'acc_id',\n                                          'source_char_id':'char_id',\n                                          'item_type':'sell_item_type',\n                                          'item_amount':'sell_item_amount',\n                                          'item_price':'sell_item_price',\n                                          'time':'sell_time',\n                                          'type':'sell_type'})\ntest2_buy = test2_buy.rename(columns = {'target_acc_id':'acc_id',\n                                        'target_char_id':'char_id',\n                                        'item_type':'buy_item_type',\n                                        'item_amount':'buy_item_amount',\n                                        'item_price':'buy_item_price',\n                                        'time':'buy_time',\n                                        'type':'buy_type'})\n\nuniq_acc_id0 = train_lab['acc_id'].values\nuniq_acc_id1 = test1_act['acc_id'].unique()\nuniq_acc_id2 = test2_act['acc_id'].unique()\n\ntrain_sell = train_sell[train_sell['acc_id'].isin(uniq_acc_id0)]\ntrain_buy = train_buy[train_buy['acc_id'].isin(uniq_acc_id0)]\n\ntest1_sell = test1_sell[test1_sell['acc_id'].isin(uniq_acc_id1)]\ntest1_buy = test1_buy[test1_buy['acc_id'].isin(uniq_acc_id1)]\n\ntest2_sell = test2_sell[test2_sell['acc_id'].isin(uniq_acc_id2)]\ntest2_buy = test2_buy[test2_buy['acc_id'].isin(uniq_acc_id2)]","b922c7c7":"train_pay.columns","01065ef4":"day_amount_spent = train_pay.groupby(['acc_id','day'])['amount_spent'].sum().unstack()\nday_amount_spent = day_amount_spent.fillna(0)\nday_amount_spent.columns = ['amount_spent_day{}'.format(i+1) for i in range(28)]\nday_amount_spent = day_amount_spent.reset_index()\nprint(day_amount_spent.shape)\ntrain = pd.merge(train, day_amount_spent, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","fd8f60f4":"day_day = train_pay.groupby(['acc_id','day'])['day'].count().unstack()\nday_day = day_day.fillna(0)\nday_day.columns = ['payment_cnt_day{}'.format(i+1) for i in range(28)]\nday_day = day_day.reset_index()\nprint(day_day.shape)\ntrain = pd.merge(train, day_day, on='acc_id', how='left')\n\nprint('train.shape :',train.shape)\ntrain.head()","488f2cbf":"train = train.fillna(0)","5b724c5f":"train = pd.merge(train, train_lab, on='acc_id', how='left')\nprint('train.shape :',train.shape)","b25ee0d6":"train.to_csv('day_train.csv', index=False)","ee2686d0":"# \ud06c\ud760","25fccc72":"- 1\uc8fc\ucc28 -> 2\uc8fc\ucc28 -> 3\uc8fc\ucc28 -> 4\uc8fc\ucc28?\n- \uc2dc\uac04\uc774 \uac08 \uc218\ub85d \ubcc0\ud654\ud558\ub294 \uc591\n- \uc77c\ubcc4\ub85c \ubcc0\ud654\ub7c9\uc744 \ubcf4\ub294\uac8c \ub098\uc744\uc9c0 \uc8fc\ucc28\ubcc4\ub85c \ubcf4\ub294\uac8c \ub098\uc744\uc9c0\ub294 \uc544\uc9c1 \ubaa8\ub978\ub2e4\n- 4\uc8fc\ucc28\uc5d0 \uc774\ud0c8 \uc9d5\ud6c4\uac00 \ub098\ud0c0\ub0a0 \uac83\uc774\ub77c\ub294 \uc0dd\uac01\n- \uadf8\ub807\ub2e4\uba74 4\uc8fc\ucc28\uc5d0\ub9cc \ub370\uc774\ud130\uac00 \uc788\ub294 \uc720\uc800\ub4e4\ub3c4 \uc788\uae30 \ub54c\ubb38\uc5d0 \uc2e0\uc0dd\uc720\uc800\ub97c \ub098\ud0c0\ub0b4\ub294 \ubcc0\uc218\ub97c \ub9cc\ub4e4\uc5b4 \uc918\uc57c\ud560 \ub4ef\n- \uadf8\ub7f0\ub370 \ubcc0\ud654\ub7c9 \ubcc0\uc218\uac00 \uc911\uc694\ud560\uae4c?\n- \uc544\ub2c8\uba74 \uadf8\ub0e5 \uc8fc\ucc28\ubcc4 \ub370\uc774\ud130\ub9cc \ub530\ub85c \ub9cc\ub4e4\uba74 \ub420\uae4c?\n- \uc77c\ub2e8 \ubcc0\ud654\ub7c9 \ubcc0\uc218\ub294 \ub9cc\ub4e4\uc9c0 \uc54a\uace0 \uc8fc\ucc28\ubcc4 \uc720\uc800\ubcc4 \ubcc0\uc218\ub9cc \ub9cc\ub4e4\uc5b4\uc11c \ud655\uc778\ud574\ubcf4\uaca0\ub2e4\n- \uc544\ub2c8\ub2e4 \uc77c\ub2e8 day\ub85c \uac00\ubcf4\uaca0\ub2e4","3b461c3e":"## payment","e18aa6a6":"- \uc774\ud0c8 \uc9d5\ud6c4\uc5d0\ub294 \ubb50\uac00 \uc788\uc744\uae4c?\n- \ub1cc\ud53c\uc15c\ub85c\ub294 \uc77c\ub2e8 \ud15c\uc815\ub9ac, \ub3c8\ubcc0\ud654\ub7c9\uc774 \ud06c\uac8c \ub9c8\uc774\ub108\uc2a4, \ub9c9\ud53c\uc5b4\ud0dd\ud69f\uc218 \uae09\uc99d, \uacb0\uc81c\uae08\uc561\uac10\uc18c? \ub4f1\n- \uc77c\ub2e8 \ub1cc\ud53c\uc15c\uc758 \ubcc0\uc218\ub4e4\ub85c \uc608\uce21\ud574\ubcf4\uaca0\ub2e4\n\n\n- \uadf8\ub9ac\uace0 \uacb0\uc81c\uae08\uc561\uc5d0 \uc601\ud5a5\uc744 \ubbf8\uce58\ub294 \ubcc0\uc218\ub294 \ubb50\uac00 \uc788\uc744\uae4c??\n- eda\ub97c \ud1b5\ud574 \uc54c\uc544\ub0b4\uace0 \uc2f6\uc9c0\ub9cc \uc798 \ubaa8\ub974\uaca0\ub2e4","4dca2a7f":"## day\ubcc4 \ubcc0\uc218 \ub9cc\ub4e4\uae30","e86d5fa0":"## combat","dd1a8a6e":"## trade","a675ac32":"# Data load","84a94d3d":"## activity","2b5fe2fc":"# gochal"}}