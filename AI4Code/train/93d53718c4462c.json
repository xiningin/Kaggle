{"cell_type":{"973061ef":"code","0d26fbbe":"code","c5edfb82":"code","1f828bf4":"code","41e09ae1":"code","214449b2":"code","a572696e":"code","d375cf04":"code","f185d018":"code","4a10de58":"code","b34b6f6b":"code","bc408684":"code","119c24ab":"code","0e5ff544":"markdown","11853583":"markdown","62158b01":"markdown"},"source":{"973061ef":"import requests\nimport json\nimport pandas as pd\nimport datetime","0d26fbbe":"CDC_BASE_URL = 'https:\/\/clinicaltrials.gov\/api\/query\/study_fields?expr=COVID-19&max_rnk=1000&fmt=json'","c5edfb82":"cdc_extract_fields = [\n    'BriefTitle',\n    'DesignAllocation',\n    'DesignMasking',\n    'DesignMaskingDescription',\n    'InterventionName',\n    'InterventionType',\n    'LastKnownStatus',\n    'OfficialTitle',\n    'OutcomeAnalysisStatisticalMethod',\n    'OutcomeMeasureTimeFrame',\n    'SecondaryOutcomeMeasure',\n    'StartDate',\n    'StudyFirstPostDate',\n    'StudyFirstPostDateType',\n    'StudyFirstSubmitDate',\n    'StudyFirstSubmitQCDate',\n    'StudyPopulation',\n    'StudyType',\n    'WhyStopped'\n]","1f828bf4":"query_url = f'{CDC_BASE_URL}&fields={\",\".join(cdc_extract_fields)}'\nprint(query_url)","41e09ae1":"r = requests.get(query_url)","214449b2":"# Check we have a successful extract with code 200\nr.status_code","a572696e":"# Load the JSON data to a dictionary\nj = json.loads(r.content)","d375cf04":"# This is quite a flat JSON structure, so can be loaded into a DataFrame\ndf = pd.DataFrame(j['StudyFieldsResponse']['StudyFields'])","f185d018":"# Some of the fields are single-item lists which can be cleaned\ndef de_list(input_field):\n    if isinstance(input_field, list):\n        if len(input_field) == 0:\n            return None\n        elif len(input_field) == 1:\n            return input_field[0]\n        else:\n            return '; '.join(input_field)\n    else:\n        return input_field","4a10de58":"for c in df.columns:\n    df[c] = df[c].apply(de_list)","b34b6f6b":"df['StudyFirstPostDate'] = pd.to_datetime(df.StudyFirstPostDate)\ndf = df.sort_values(by='StudyFirstPostDate', ascending=False)","bc408684":"df[df.StudyType == 'Interventional'].head(100)","119c24ab":"timestamp = datetime.datetime.now().date().isoformat()\n\n# Write all results\ndf.to_csv(f'covid19_clinical_trials_{timestamp}.csv', index=False)\n\n# Write just interventional trials\ndf[df.StudyType ==\n   'Interventional'].to_csv(f'covid19_interventional_clinical_trials_{timestamp}.csv',\n                                            index=False)","0e5ff544":"Print out all the interventions being tested","11853583":"To use the `study_fields` endpoint we need to pick some fields to extract from this list: https:\/\/clinicaltrials.gov\/api\/info\/study_fields_list","62158b01":"# Covid-19 Clinical Trials API\n\nYou can import this into your own Notebooks using this utility script: https:\/\/www.kaggle.com\/ajrwhite\/cdc-clinical-trials-api\n\n**Please _upvote_ if you find useful, and _acknowledge_ if you re-use it in your own pipeline!**\n\nAutomating the extraction of clinical trial interventions from the CDC's Clinical Trials database.\n\nSee: https:\/\/clinicaltrials.gov\/api\/gui\/ref\/api_urls"}}