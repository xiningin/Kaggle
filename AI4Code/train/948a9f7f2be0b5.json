{"cell_type":{"edb667c5":"code","4d10a24c":"code","997dadbf":"code","74c9d238":"code","ca13c9b1":"code","80cd28ce":"code","f36bfc18":"code","7f87ca75":"code","39df7d7b":"code","096df1d9":"code","065986e2":"code","409e6f14":"code","b1f74f35":"code","e75f0a85":"code","b9c584bc":"code","24bebbeb":"markdown","5936c9dd":"markdown","001ba62c":"markdown","35c8550f":"markdown","c7ec0993":"markdown"},"source":{"edb667c5":"from numbers import Real\nimport pandas as pd\nimport numpy as np\n\nfrom sklearn import ensemble\nfrom sklearn import metrics\nfrom sklearn import model_selection\nfrom sklearn import decomposition\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn import pipeline\nfrom functools import partial\nfrom skopt import space\nfrom skopt import gp_minimize \nfrom xgboost import XGBClassifier\n\n\nimport optuna\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","4d10a24c":"df_train = pd.read_csv('..\/input\/tabular-playground-series-nov-2021\/train.csv')\nX_test = pd.read_csv('..\/input\/tabular-playground-series-nov-2021\/test.csv')\nsample_submission = pd.read_csv('..\/input\/tabular-playground-series-nov-2021\/sample_submission.csv')","997dadbf":"df_train.head()","74c9d238":"print(df_train.shape)\nprint(X_test.shape)","ca13c9b1":"df_train.target.hist()","80cd28ce":"print(df_train.isnull().sum().sum())\nprint(X_test.isnull().sum().sum())","f36bfc18":"y = df_train['target']\ndf_train.pop('target')\ndf_train.pop('id')\nX_test.pop('id')\nX=df_train\n\ndel df_train","7f87ca75":"st_scaler = StandardScaler()\nX = st_scaler.fit_transform(X)\nX_test = st_scaler.fit_transform(X_test)","39df7d7b":"print(X.shape)\nprint(X_test.shape)","096df1d9":"\n\"\"\"def optimize(params, param_names, x, y):\n\n    # convert params to dictionary\n    params = dict(zip(param_names, params))\n    \n    model = XGBClassifier(**params, random_state  = 42, \n                          use_label_encoder=False, \n                         tree_method = 'gpu_hist',\n                         gpu_id = 0,\n                         predictor = 'gpu_predictor')\n    \n    kf = model_selection.StratifiedKFold(n_splits=5)\n    accuracies = []\n    count=0\n    for idx in kf.split(X=x, y = y):\n        train_idx, test_idx = idx[0], idx[1]\n        \n        #xtrain, xtest = x.iloc[train_idx], x.iloc[test_idx]\n        #ytrain, ytest = y.iloc[train_idx], y.iloc[test_idx]\n        xtrain, xtest = x[train_idx], x[test_idx]\n        ytrain, ytest = y[train_idx], y[test_idx]\n\n        model.fit(xtrain, ytrain, \n                  eval_set = [(xtrain, ytrain), (xtest, ytest)],\n              early_stopping_rounds = 100,\n              eval_metric = 'auc',\n             verbose = False)\n        preds = model.predict_proba(xtest)[:,1]\n        fold_acc = metrics.roc_auc_score(ytest, preds)\n        accuracies.append(fold_acc)\n\n    return -1.0*np.mean(accuracies)\"\"\"","065986e2":"\"\"\"param_space = [space.Real(0.01, 0.1, name = \"eta\"),\n               space.Integer(3,25, name = \"max_depth\"),\n               space.Integer(1, 7, name = \"min_child_weight\"),\n               space.Real(0.6, 1.0, name = \"subsample\"),\n               space.Real(0.6, 1.0, name= \"colsample_bytree\"),\n               space.Real(0.01, 1.0, name = \"alpha\")]\n\nparam_names = [\"eta\", \"max_depth\", \"min_child_weight\", \"subsample\", \n                \"colsample_bytree\", \"alpha\"]\n\noptimization_function = partial(optimize, param_names = param_names, x = X, y = y)\nresult = gp_minimize(optimization_function, dimensions = param_space, n_calls = 15, \n                    n_random_starts = 10, verbose = 10)\n\nbest_params = dict(zip(param_names, result.x))\nprint(best_params)\"\"\"\n","409e6f14":"#optimized_params = best_params\noptimized_params = {'eta': 0.04515703133340612, 'max_depth': 10, \n                    'min_child_weight': 1, 'subsample': 0.8166775634490886, \n                    'colsample_bytree': 0.7418578862489605, \n                    'alpha': 0.6287561392899984}","b1f74f35":"folds = model_selection.StratifiedKFold(n_splits = 5, random_state = 42, shuffle = True)\ny_pred = np.zeros(len(X_test))\nscores = []\nfor fold, (trn_idx, val_idx) in enumerate(folds.split(X, y)):\n    \n    X_train, X_val = X[trn_idx], X[val_idx]\n    y_train, y_val = y[trn_idx], y[val_idx]\n\n    model =  XGBClassifier(**optimized_params, random_state  = 42, \n                          use_label_encoder=False, \n                         tree_method = 'gpu_hist',\n                         gpu_id = 0,\n                         eval_metric = 'auc',\n                         predictor = 'gpu_predictor')\n   \n    model.fit(X_train, y_train, eval_set = [(X_train, y_train), (X_val, y_val)], \n              verbose = False, early_stopping_rounds = 100)\n    final_preds = model.predict_proba(X_val)[:,1]\n    fold_score = metrics.roc_auc_score(y_val, final_preds)\n    scores.append(fold_score)\n    y_pred += model.predict_proba(X_test)[:,1] \/ folds.n_splits \n\nprint(scores)","e75f0a85":"sample_submission.head()","b9c584bc":"sample_submission['target'] = y_pred\nsample_submission.to_csv('Submission.csv',index = False)","24bebbeb":"### Dividing dependent and independent variables and adding new features\nIt can be seen that columns like \"Id\" are unique, hence wont contribute for our predictions. Therefore, these must be removed from both training and testing datasets.","5936c9dd":"From the above histogram of the target, it is known that the it is a classification problem","001ba62c":"### Bayesian optimization with gaussian process\n#### Important note\nThe following cell can be uncommented to run the hyperparameter tuning process which uses optuna method","35c8550f":"## Best Parameters\n{'eta': 0.04515703133340612, 'max_depth': 10, 'min_child_weight': 1, 'subsample': 0.8166775634490886, 'colsample_bytree': 0.7418578862489605, 'alpha': 0.6287561392899984}","c7ec0993":"It is also known that there no null values in the training and test data and from the data there seems no categorical values"}}