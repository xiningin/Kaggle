{"cell_type":{"d3db5c54":"code","f5fd6626":"markdown","2c64101c":"markdown","c52ffd56":"markdown","8049aefe":"markdown","19a9ce8c":"markdown","82e14ad0":"markdown","0e987ceb":"markdown","e56472a1":"markdown","beb96a9b":"markdown","34f2b9c5":"markdown"},"source":{"d3db5c54":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","f5fd6626":"# Key Findings\n\n* I have created a neural network model that can accurately predict defensive coverages with zero feature engineering\n* The top pass defenses in the league or more consistent and take less risks.  While this approach limits their downside, it also limits their upside.\n* Cover 2 Zone is the most volitle\/risky coverage type, but also has the greatest potential upsde.  Cover 4 Zone is the most conservative coverage\n* The top pass defenses exhibit a significant edge when it comes to their their execution of Cover 0 Man and Cover 2 Man\n* There is near parity in the how well the best pass defenses execute Cover 2 Zone and Cover 1 Man vs the rest of the league\n* There is almost no difference between the percentage of time the top pass defenses deploy each coverage compared to the rest of the league","2c64101c":"# What Do The Best Defenses Do Differently?\n\n![image.png](attachment:image.png)\n\nWhen it comes to classifying who the best defenses are, I really felt that EPA and WPA were accurate enough measures.  Holding the defense to a low EPA might be important, or it might not depending on the context of the situation within the game.\n\nSo instead I decided to use the Defense-Adjusted Variance Over Average (DVOA) metrics from Football Outisders.  I took their pass defenesive stats (which could more accurately be defined as Offense-Adjusted, but that is for another time).  I took the top 25% (8 teams) in Pass Defense DVOA and compared them to the rest of the league and found some interesting findings:\n\n* The top pass defenses are much better (at both consistency and results) at Cover 0 Man than the rest of the league\n* There is also a meaningful difference to how those top defenses execute on Cover 2 Man coverage\n\nWhile I didn't have the time to dig deeper in this area, the obvious next step would be to determine if you could determine what factors contribute to those findings.  Is it the skill or athletic ability of the players on the field?  Is it how well they execute the coverages?  I think the results would be very eye opening.\n\n","c52ffd56":"![image.png](attachment:image.png)","8049aefe":"# Future Work\n\nMan, I have so much left to do.  With all of the work I've done over the past few months, here are some of the things that I wish that I would have had time to accomplish:\n* Idenetifying how well each pass coverage does against various receiver formations.  I was able to classify each formation using the on-field tracking data, but was left without enough time to analayze\n* Looking at what makes the best pass offenses in the league outperform everyone else and then to further extend that to the QB\n","19a9ce8c":"# Summary\n\nObviously I would have liked to have had more time to analyze the data once my model was complete.  I feel like the application of Game Theory and proabilities could have a significant an meaningful impact on the passing game in NFL.  Not that I believe that the NFL will every truly leave a highly exploitative approach to the passing game, I feel the edge situations that could call for one of two different coverages, the math could provide a nudge one way or another.\n\nDoug Polk often uses a random number generator to determine what he should do on a specific hand.  I don't see defensive coordinators getting there in my lifetime, but I think it would be fascinating to nudge the game in that direction over time to see how much it could improve.\n\nAnd I honestly hopes that someone reading this sees the work and agrees that I should be a part of the team ;)","82e14ad0":"![image.png](attachment:image.png)","0e987ceb":"# Coverage Risk vs. Reward\n\n![image.png](attachment:image.png)\n\nOnce I was able to classify each pass coverage, I was able to start to analyze how well each performed.  Unfortunately I used up most of my time on creating the model and had very little time to analyze the data.\n\nThe above box chart shows the performance of each given pass coverage, for every team over the course of the 2018 season.\n\n* While I don't using EPA as a defensive metric (there are so many other factors to a defensive performance), I didn't have the cycles to engineer new features and I felt that it should be directional\/relational enough to provide meaningful insights.\n* I use the quartiles of the box-plot as an indicator of both consistency (the size of the box: smaller is more consistent) and volatilty\/risk (the length of the whiskers)\n* Consistancy from highest->lowest: Cover 4 Zone, Cover 2 Zone, Cover 0 Man, Cover 6 Zone, Cover 1 Man, Cover 2 Man\n* Volatilty from lowest->highest: Cover 2 Man, Cover 1 Man, Cover 6 Zone, Cover 0 Man, Cover 2 Zone, Cover 4 Zone\n\n\nWhy are these metrics important?\n\nI think it is important to know how much risk is associated with a specific play so that teams that are managing a tight lead might want to make a different call than those who need to take some risks in an effort to get their defenses back on the field.","e56472a1":"# How NFL Pass Defenses Can Learn From Poker Players\n\nYes, Poker.  Hang with me.\n\nThe passing game in the NFL is based upon a set of constantly evolving, highly exploitative strategies.  Coaches, players and staff spend a significant amount of time reviewing game film looking for opportunities that could influence the results of the game.  Each week becomes an evolving game-plan of tactics to take advantages of any real or preceived weaknesses in the their opponents games while also leaning on their own strengths while attempting to disguise their intentions.\n\nAs a life-long NFL fan, but someone who is never been involved in any formalized football, I spent well over 100 hours watching videos of players and coaches reviewing game film and discussing what did and didn't work, what were the reasoning behind the strategies.  While it makes perfect sense, the film review process had been completely opaque to me, so I was surprised to hear things like:\n* \"I know from years of experience of having him defend me, when he jams me at the line with his left hand, he's planning on using his inside leverage to drive me to the sideline in man coverage, and we had a plan for just such an occassion.\"\n* \"Almost every team has a similar pattern that they run from this formation, so I knew that if I keyed in on if the running back either was blocking or releasing, I could make a play on the ball.\"\n* \"Since they were in one-high coverage, I knew that as soon as the safety committed to one of the receivers that entered into that zone, the other would be open.  He bit on the first, so I threw the long ball on the corner and it worked.\"\n\nAs I watched this, I began to worry that any analytics that I applied to these problems would be inheritenly wrong, as I had zero visibility into the why each team did what they did.\n\nAt about the same time as this was going on, there was also a high-stakes poker match going on between Daniel Negranu and Doug Polk.  Daniel is an old-school poker player who has made tens of millions of dollars in his career by being really good and reading people and exploting weaknesses in other player games.  He's probably best known for his uncanny ability to know the exact two cards his texas holdem opponent is holding.  \n\nDoug on the other hand grew up in the era of online poker.  He was one of the early pioneers of what has become known as GTO or Game Theory Optimal Poker.  Doug realized that no matter what cards his opponents has, he has a higher long term \"expected value\" from understanding the math behind every possible hand and scenario and making the correct call (bet, raise, fold) soley on the math.  \n\nThese two are both considered near the top of their respective niches of poker and they both really don't like each other.  So it surprised the poker community when Daniel accepted Doug's offer for a $200\/$400 online heads-up challenge consisting of 25,000 hands.  \n\nAs I took a break from watching film and waited for machine learning models to train, I would occassionaly check in on the progress of their match.  As of this submission, they are through slightly more than half of the pre-determined hands, and Doug (the math guy) is up $748,000. Most of the matches haven't even been close.\n\nSo it made me think: **What if there is an opportunity to take the math concepts that have revolutionalized the game of poker and apply them to pass defense?**  This submission is the result of that process.","beb96a9b":"# A Novel Method For Classifying Pass Defenses at 97% Accuracy\n\nI'm not going to lie, this was a singificant struggle.  I tried for over two months to find a classifer that could get a reasonable level of accuracy with absolutely no-luck.  It didn't seem to matter which model-type that I used, which features I engineered or how much I tuned the hyper-paramters, I could not get anything over 70%.  I eventually abandoned all of these\n* Random Forrest\n* Class Balanced Random Forrest\n* Bootstrapped Random Forrest\n* Easy Ensemble\n* GaussianNB\n* K-Nearest Neigbors\n* Support Vector Machine\n\nBut one day I was looking the the play animations that several people had in their notebooks and it gave me an idea to try a Convolutional Neural Network and to convert the player tracking data to \"images\".  With a CNN I was able to pass 80% accuracy, but I was then stuck.  I tried:\n* One image per frame\n* One single image per play (with every frame composited)\n* As a \"movie\", where I would use a ConvLTSM network\n\nI was able to gain some meaningful improvements in accuracy by injecting different tracking data into what would traditional be the pixel colors (RGB).  I eventually landed on using the team of the player, the 'o' orientation variable and the 'dir' direction variable.\n\nI was then struck by the idea of doing what I call \"time laps images\".  The idea is that I would use each frame as an image, but I would composite all the previous frames \"under it\".  With this approach I was able to get to an ~85% accuracy.\n\nThe next big came when I moved from a CNN that I had created and was tuning to a publicly available one (ResNet50).  While the loss values always started really high( it's a really deep network), I was able to get to 94% accuracy.\n\nThe final piece came from tuning which frames were included in the composted images.  Frames 14-52 determined the optimal frames.","34f2b9c5":"I was unable to submit this with my code in the appendix as the runtime was too long.  I deleted it from here, but it can be found here:\n\n* All Generated Files: https:\/\/drive.google.com\/drive\/folders\/1ohAFAl0VMi7IVAT9l9oKZv3uoqukrvFR?usp=sharing\n* Pre-Processing and Feature Engineering: https:\/\/colab.research.google.com\/drive\/1xTa1S8qDrxngApJDOSCq782A6QbNctBY?usp=sharing\n* Building The Neural Network: https:\/\/colab.research.google.com\/drive\/1t3XPUJg6i_P-9knb9TcbHeNNKV74iczT?usp=sharing\n* Classifying Defensive Coverages: https:\/\/colab.research.google.com\/drive\/1toGpAHib61mtq4vIhj3z28XzK8sBk5ja?usp=sharing\n* Best Defense\/DVOA: https:\/\/colab.research.google.com\/drive\/1ZD9O_YtwIsPuxlW_a-Aac5f8rP5slwOG?usp=sharing\n* Identifying Formations with Player Tracking: https:\/\/colab.research.google.com\/drive\/1aSIWzxdAZldGBO-m_jHPHp14yXLDV9FE?usp=sharing\n"}}