{"cell_type":{"f5a61afb":"code","e6b10430":"code","1bf2b6d4":"code","ea09d523":"code","85d46dda":"code","29f70cd4":"code","5a0f9ea3":"code","8284fdc7":"code","e8cdb887":"code","5ab4a2ef":"code","f8a61c0e":"code","b60e24d8":"code","b28279c0":"code","06a8da46":"code","19df13e4":"code","582aee4f":"code","56042a68":"code","a1eace3d":"code","724c09e1":"code","120a3bc9":"code","447f8e5c":"code","4752585c":"code","db472bb0":"code","26ecf4b1":"code","9a68d690":"code","d33bc536":"code","9ebe8c3a":"code","9d62b572":"code","8767a712":"code","1913d035":"code","4661d63c":"code","48833faa":"code","cdd0c8d4":"code","28a43e8f":"code","3924ee74":"code","702a31b5":"code","d040caab":"code","2312e166":"code","df9187ef":"code","d3c87c80":"code","a81cb187":"code","2be9b396":"code","7118b4ee":"code","7ba6dc71":"code","23417b53":"code","6aedcf79":"code","e4adf627":"code","dddedbaa":"code","e5244dcf":"code","70a741ec":"code","040fd29b":"code","2904386c":"code","804e81cd":"code","6e039810":"code","edac6ce7":"code","879699ba":"code","12e06ffb":"code","ed2f0b63":"code","8ee0094e":"code","d9538039":"code","1f2693e3":"code","6a3c0f51":"code","7ad79c7a":"code","87c26515":"code","c41ed0c4":"code","41feb237":"code","6dbb5fff":"code","4a70019d":"code","9d05a41b":"code","e6918e2e":"code","c57a707f":"code","d54ca075":"code","04003838":"code","49da8ce5":"code","553023a5":"markdown","497865a5":"markdown","1dc9789d":"markdown","d503b08e":"markdown","d9494862":"markdown","c3dbc08b":"markdown","7510cb7e":"markdown","c7475fa0":"markdown","ad4f225d":"markdown","ac9df6bd":"markdown","03f82cd1":"markdown","c1581de0":"markdown","56c2333a":"markdown","fffde563":"markdown","41c61544":"markdown","b7cd5f4d":"markdown","d343d142":"markdown","4edcb711":"markdown","fa32671b":"markdown","d400c631":"markdown","2092f598":"markdown","70f2b054":"markdown","5aa9d7a2":"markdown","dfde1d86":"markdown","68474b19":"markdown","6283c1d3":"markdown","5fbc08ef":"markdown","088cef9e":"markdown","4c605b79":"markdown","a149ba6e":"markdown","521925da":"markdown","784a83c7":"markdown","d10e76ff":"markdown","c5dfa1be":"markdown","d8db974b":"markdown","bc7dd075":"markdown","6b9ac539":"markdown","761ba94a":"markdown","5d5bbb23":"markdown","6cf53286":"markdown","733dee67":"markdown","ab331af0":"markdown","a02c8c51":"markdown","c357dca8":"markdown","5d9f6b9f":"markdown","0ce3b8bc":"markdown","3a85455e":"markdown","a79183b9":"markdown","017859a1":"markdown","e85a2df5":"markdown","26fa24fa":"markdown","8a6f026e":"markdown","bc0e3a35":"markdown","6d863879":"markdown","26764a23":"markdown","9ad9505c":"markdown","ff2c62dc":"markdown","5075d38f":"markdown","a0c8493e":"markdown","fe691ecd":"markdown","33c6e922":"markdown","d300a8dc":"markdown","213eb371":"markdown","c20bde32":"markdown","103e0e05":"markdown","2129c88b":"markdown"},"source":{"f5a61afb":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns","e6b10430":"# df = pd.read_csv('churn_modelling.csv')\n\ndf =  pd.read_csv('..\/input\/predicting-churn-for-bank-customers\/Churn_Modelling.csv')","1bf2b6d4":"df.info()","ea09d523":"df.head(3)","85d46dda":"df['RowNumber'].value_counts().value_counts()","29f70cd4":"df.drop(['RowNumber', 'Surname'], axis=1, inplace=True)","5a0f9ea3":"df.to_csv('churn_cleaned.csv', index=None)","8284fdc7":"df.head()","e8cdb887":"df = df.sort_values('CustomerId')","5ab4a2ef":"df.head()","f8a61c0e":"df['CustomerId'].is_monotonic_increasing","b60e24d8":"custid = df['CustomerId']\ndf = df.drop('CustomerId', axis=1)","b28279c0":"df['Exited'].value_counts()","06a8da46":"plt.figure(figsize=(6,6))\n(df['Gender'].value_counts() * 100 \/ df['Gender'].value_counts().sum()).plot(kind='bar')","19df13e4":"plt.rcParams['figure.figsize'] = (6,6)","582aee4f":"(df.groupby('Gender')['Exited'].mean()*100).plot(kind='bar')\nplt.ylabel('Churn Percentage')\n# plt.legend('Ch')","56042a68":"sns.catplot(x = 'Exited', hue= 'Gender', data= df, kind='count')\nplt.xticks(range(2), ['NO', 'YES'])\nplt.ylabel('Number of Customers');","a1eace3d":"df['Gender'].value_counts()\n# dataset is balanced in terms of gender","724c09e1":"df.groupby('Exited')['CreditScore'].mean()","120a3bc9":"plt.figure(figsize=(6,8))\nsns.boxplot(x='Exited', y='CreditScore', data=df)","447f8e5c":"sns.displot(x='CreditScore', hue='Exited', data=df)","4752585c":"df['Score'] = pd.cut(df['CreditScore'],\n                    bins=[0,550,700,900],\n                    labels=['Poor', 'Average', 'Good'])","db472bb0":"sns.countplot(x=df['Score'])","26ecf4b1":"sns.countplot(x='Exited', hue='Score', data=df)","9a68d690":"# let us first look at the overall distribution of Geography\n\nplt.figure(figsize = (6,6))\n(df['Geography'].value_counts()\/df['Geography'].value_counts().sum()*100).plot(kind='bar')\nplt.ylabel('Percentage out of total samples')\nplt.xlabel('Geography')\nplt.title('Geographical share within exited customers');","d33bc536":"ct = pd.crosstab( df['Exited'], df['Geography'])\nct","9ebe8c3a":"plt.figure(figsize=(6,6))\n(ct.loc[1] * 100.0 \/ ct.sum()).plot(x=ct.index, y=ct.values, kind='bar')\nplt.ylabel('Churn percentage within geographical group')\nplt.title('Churn by geography')","9d62b572":"df.groupby('Exited')['EstimatedSalary'].mean()","8767a712":"plt.figure(figsize=(6,8))\nsns.boxplot(x='Exited', y='EstimatedSalary', data=df)","1913d035":"plt.figure(figsize=(6,6))\nsns.boxplot(x='Exited', y='Age', data=df)","4661d63c":"df['Age'].min(), df['Age'].max()","48833faa":"df['AgeCat'] = pd.cut(df['Age'],\n                     bins=[17,35,50,65,93],\n                     labels=['Young', 'Middle-aged', 'Senior', 'Very-old'])","cdd0c8d4":"df['AgeCat'].value_counts()","28a43e8f":"sns.countplot(x='AgeCat', data=df)","3924ee74":"pd.crosstab(df['AgeCat'], df['Exited']).plot(kind='bar', stacked=True, figsize=(6,6))","702a31b5":"df['HasCrCard'].value_counts()","d040caab":"df.groupby('Exited')['HasCrCard'].mean()","2312e166":"df['Exited'] = df['Exited'].astype('uint8')","df9187ef":"df.groupby('HasCrCard')['Exited'].mean()","d3c87c80":"plt.figure(figsize=(6,6))\nsns.countplot(x='HasCrCard', hue='Exited', data=df)\nplt.title('CREDIT CARD HOLDER vs CHURN');","a81cb187":"df.groupby('HasCrCard')['CreditScore'].mean()","2be9b396":"plt.figure(figsize=(6,6))\nsns.boxplot(y='CreditScore',x='HasCrCard', data=df)\nplt.title('CREDIT SCORE vs CREDIT CARD HOLDING')","7118b4ee":"plt.figure(figsize=(10,6))\nsns.catplot(x='Exited', hue='HasCrCard', col='Geography', data=df, kind='count')","7ba6dc71":"sns.catplot(x='Geography', hue='Exited', col='HasCrCard', data=df, kind='count')\n# plt.title('Churn trend by credit card adoption and geography')","23417b53":"sns.displot(x='Balance', data=df)\nplt.title('Distribution of balance');","6aedcf79":"df['Balance'].describe()","e4adf627":"(df['Balance'] == 0).sum()","dddedbaa":"df.groupby('Exited')['Balance'].mean()","e5244dcf":"plt.figure(figsize=(6,7))\nsns.boxplot(x='Exited', y='Balance', data=df)\nplt.title('CHURN vs BALANCE')","70a741ec":"bal_non_zero = df.loc[df['Balance']>0]","040fd29b":"(df['Balance'] < 0).sum() # checking for possibility of negative balances. No such rows.","2904386c":"sns.displot(x='Balance', hue='Exited', data=bal_non_zero)\nplt.title('Non-zero balances');","804e81cd":"bal_non_zero.groupby('Exited')['Balance'].mean()","6e039810":"plt.figure(figsize=(6,7))\nsns.boxplot(x='Exited', y='Balance', data=bal_non_zero)\nplt.title('NON-ZERO BALANCES vs CHURN')","edac6ce7":"plt.figure(figsize=(6,6))\nsns.barplot(x='Exited', y='Balance', hue='HasCrCard', data=df)\nplt.legend(title = 'Has credit card', loc=0)","879699ba":"sns.jointplot(x='Balance', y='CreditScore', data=df, hue='Exited')","12e06ffb":"sns.jointplot(x='EstimatedSalary', y='Balance', data=bal_non_zero, hue='Exited')","ed2f0b63":"sns.jointplot(x='CreditScore', y='EstimatedSalary', data=df, hue='Gender')","8ee0094e":"plt.figure(figsize=(6,7))\nsns.boxplot(x='Geography', y='EstimatedSalary', data=df)","d9538039":"plt.figure(figsize=(6,6))\nsns.boxplot(x='Gender', y='EstimatedSalary', data=df)","1f2693e3":"c = pd.crosstab(df['Gender'], df['HasCrCard'])\nc","6a3c0f51":"(df.groupby('Gender')['HasCrCard'].mean() * 100).plot(kind='bar')","7ad79c7a":"sns.countplot(x=df['Tenure'])","87c26515":"sns.countplot(x='Tenure', data=df, hue='Exited')","c41ed0c4":"c = pd.crosstab(df['Exited'], df['Tenure'])","41feb237":"c.loc['Percent_1'] =  c.loc[1] * 100 \/ c.sum()\nc.loc['Percent_0'] = c.loc[0] * 100 \/ c.sum()\nc","6dbb5fff":"c.loc[[0,1]].T.plot(kind='bar', stacked=True, figsize=(7,5))","4a70019d":"df.columns","9d05a41b":"sns.pairplot(df[['CreditScore', 'Age', 'Tenure', 'Balance',\n                 'NumOfProducts', 'EstimatedSalary']])","e6918e2e":"c = pd.crosstab(df['IsActiveMember'], df['Exited'])\nc","c57a707f":"c.plot(kind='bar', stacked=True, figsize=(6,7))\nplt.title('CHURN vs IS_ACTIVE_MEMBER')\nplt.ylabel('Number of custmers')","d54ca075":"df['NumOfProducts'].value_counts()","04003838":"df['NumOfProducts'] = df['NumOfProducts'].astype('category')","49da8ce5":"plt.figure(figsize=(6,6))\nsns.countplot(x='NumOfProducts', hue='Exited', data=df)\nplt.title('CHURN vs NUMBER OF PRODUCTS TAKEN')","553023a5":"### Does geography determine credit card adoption ?","497865a5":"###  Does length of the relationship with the bank play a role in churn ?","1dc9789d":"- The same trend is maintained in churned as well as retained customers.","d503b08e":"### We have answered most of the important questions that we had about the dataset in the beginning. As EDA is a continuous process, we may carry on further anlaysis on various other combination of features.\n## --END--","d9494862":"### Let us see the count of target variable (0 or 1).","c3dbc08b":"###  How does churn ratio vary by gender ?","7510cb7e":"##  Exploratory Data Analysis and Visualization on Bank Churn Modelling Dataset","c7475fa0":"### 36% of the customers have zero balance. This may be due to inactive\/frozen accounts, abandoned accounts, etc.","ad4f225d":"####  Young people are more likely to avail multiple products from the bank compared to older people.\n#### Customers with multiple products generally have a higher credit score.","ac9df6bd":"#### Exited customers clearly seem to have a greater balance on average, compared to retained customers. \n#### Let us see the distribution in customers having non-zero balance.","03f82cd1":"- No significant difference seems to exist in the estimated salaries of both groups.","c1581de0":"### Which geographies are more common in exited customers ?","56c2333a":"###  Do balance and  credit score have a relationship ?","fffde563":"#### About 55% customers in the dataset are male. We will check if this ratio is maintained across other features.","41c61544":"####  Interestingly, customers who have taken 2 products have a much lower churn ratio compared to customers who have taken 1, 3 or 4 products. The detailed analysis of what type of products customers have taken may provide more insights, but that data is not available in the dataset.","b7cd5f4d":"###  Salary vs credit score?","d343d142":"####  As we can see, the inactive members are leaving more. This is as expected in a real business scenario.","4edcb711":"- The credit scores of both churned and retained customers follows a normal-like distribution. \n- As deduced in the previous plot, some of the lowest credit scores in the dataset are those of churned customers.","fa32671b":"####  The values are practically the same.","d400c631":"### There are no null values.","2092f598":"### Do males and females have a different median salary ?","70f2b054":"####  Males and females have equal credit card adoption ratio.","5aa9d7a2":"### The target variable is distributed in almost 80:20 ratio. Hence, the dataset is somewhat imbalanced, but not heavily imbalanced.","dfde1d86":"#### No relationship seems to exist.","68474b19":"### There seems to be huge variability in the distribution of Balance.","6283c1d3":"- Spain has the lowest count of exited customers. The counts of France and Germany are practically equal.","5fbc08ef":"### What is the average credit score of credit card holders, that of not having credit card ?","088cef9e":"#### The overall ratio of credit card holders of 70% is maintained in churned as well as retained customers.","4c605b79":"####  Overall, there is no clear trend in the relationship length of customers with the bank.","a149ba6e":"### Does holding a credit card play a role in churn ?","521925da":"### Customers of what age are more likely to leave ?","784a83c7":"###  Let us plot numerical columns together.","d10e76ff":"### We will drop the customer ID column befolre EDA, as this column just represents a unique identifier for each customer in our dataset.","c5dfa1be":"####  It seems middle-aged and senior customers have a higher tendency of leaving.","d8db974b":"- The median credit scores of churned and retained customers is almost the same. \n- Exited customers seem to have the lower minimum credit score.","bc7dd075":"#### No significant relationship seems to be visible between balance and credit score.","6b9ac539":"###  Credit card adoption by gender ?","761ba94a":"- Most customers in the dataset have an average score.","5d5bbb23":"#### In this case, the balances are similar.","6cf53286":"Questions to ask\n\n- What is the average credit score of exited customers and retained customers ?\n- Which geographies are more common in exited customers ?\n- DO exited customers have a higher or lower salary compared to retained customers ?\n- What is the ratio of credit card holder in each category ?\n- How is credit score distributed for the credit-card holders in each category ?\n- What is the average balance of each category ?\n- What is the average balance of credit-card holders and non-holders, overall ? How is it distributed across combination of credit card category and churn category ?\n- Customers of which geography are more likely to avail credit card ?\n- Do credit card holders have a higher or lower salary than non-holders ?\n- How is average salary distributed across geographies ?\n- How is the ratio of exited customers distribued by gender ?\n- Average salary distribution by gender ?\n- Is gender a factor in availing credit card ?\n- Distribution of gender-exited-salary?\n- age vs churn ? how is the variability in the age of exited vs retained ? (std())\n- distribution of 'Exited' by NumberOfProducts ?\n- 'Exited'vs IsActiveMember\n- Exited vs estimated_salary\n- salary vs gender?\n- Important -> Salary vs balance and Salary vs CreditScore","733dee67":"- Let us divide the credit score into 3 categories as follows:\n1. Poor = Upto score 550\n2. Average = 550 < Score <= 700\n3. Good = Score > 700","ab331af0":"####  Again, no clear trend is visible. The distribution seems to be completely random.","a02c8c51":"#### Both categories of customers have a very similar credit average score. \n#### Lets see the distribution.","c357dca8":"####  Males in the dataset seem to have a slightly lower salary compared to females. This difference does not seem to be significant.","5d9f6b9f":"### Reading and cleaning the data","0ce3b8bc":"#### Let us bin 'Age' into 4 categories","3a85455e":"##  Questions to ask to explore the data :","a79183b9":"### What is the average balance for each category ?","017859a1":"#### A balance between 100000 and 130000 seems to be most common.","e85a2df5":"###  Do exited customers avail less number of products of the bank ?","26fa24fa":"- About 50% of the customers are from France. \n- Germany and Spain have an almost equal share of 25%.","8a6f026e":"### How does balance vary for credit card holders by retained and exited customers ?","bc0e3a35":"### What is the churn behavour by Geography and CreditCard adoption ?","6d863879":"### Overall, females have a higher churn ratio compared to males.","26764a23":"### What is the average credit score of exited customers and retained customers ?","9ad9505c":"### In retained customers, the number of males is more.","ff2c62dc":"- Having a credit card does not seem to affect credit score.","5075d38f":"###  How does estimated salary vary for different geographies ?","a0c8493e":"### Is there a difference in the estimated salaries of exited and retained customers ?","fe691ecd":"- German customers have the highest churn ratio. That of French and Spanish customers seems to be equal.","33c6e922":"### All values in 'RowNumber' column appear only once. Hence, we may drop this column as we already have an index. Also, surname will not play any role in analysis. We can drop that too.","d300a8dc":"### Balance vs estimated salary ?","213eb371":"#### Among customers with non-zero balances, the low-balance customers are more widely present in retained customers.","c20bde32":"###  Do active members leave less often than inactive members ?","103e0e05":"#### About 70% of all customers in the dataset have credit cards.","2129c88b":"####  We see a clear trend here. Customers in the age group of 40-50 years are most likely to leave. Younger customers in the age-group of 30-40 years are more likely to stay."}}