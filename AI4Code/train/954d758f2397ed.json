{"cell_type":{"4116d13f":"code","b81121a0":"code","42b0d935":"code","8de2c3cf":"code","b20efd74":"code","5942dcd6":"code","13a7bd55":"code","1bb97095":"code","8b091571":"code","f00c9cdb":"code","4cf36614":"code","ddc945c1":"code","e092ddf2":"code","bcc2c1e3":"code","0276f264":"code","83cddfe5":"code","084ba469":"code","99d2c0bc":"code","5e41cde6":"code","300b5dc9":"code","0bcb17bb":"code","b903c01a":"code","e8251667":"code","73620593":"code","5a236a82":"code","b97ba49a":"code","ab327840":"code","c8c63f57":"code","3d700e72":"code","80edb1d4":"code","12cef210":"code","a4a513f5":"code","b5b22d35":"markdown","89c02f63":"markdown","a70eea18":"markdown","0377992a":"markdown","efbe4766":"markdown","1db3605c":"markdown","d0e9e786":"markdown","b5d1969b":"markdown","a4233f92":"markdown","06d39824":"markdown","a3fe30a8":"markdown","a35f299f":"markdown","37e6b35f":"markdown","a0976dc7":"markdown","7dc35406":"markdown","8e148719":"markdown","99a97e84":"markdown","60f23677":"markdown","b963b6cd":"markdown","b48fcc12":"markdown","10067a84":"markdown","c6c75616":"markdown","bc5a92eb":"markdown","1230053a":"markdown","05ac31d4":"markdown","e4156a8e":"markdown","d47c6d16":"markdown","51a63c4f":"markdown","f6603141":"markdown","538d81dc":"markdown","78738ccd":"markdown","b1910a3d":"markdown","879ca863":"markdown","f50a5bb3":"markdown","06e6e672":"markdown","a2bee798":"markdown"},"source":{"4116d13f":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nfrom matplotlib_venn import venn2\nimport seaborn as sns\nfrom ast import literal_eval\n\n%matplotlib inline","b81121a0":"veg_meat = [\"#454d66\", \"#b7e778\", \"#1fab89\"]\nsns.set_palette(veg_meat)","42b0d935":"recipes = pd.read_csv('\/kaggle\/input\/food-com-recipes-and-user-interactions\/RAW_recipes.csv')\ninteractions = pd.read_csv('\/kaggle\/input\/food-com-recipes-and-user-interactions\/RAW_interactions.csv')","8de2c3cf":"recipes.head()","b20efd74":"print(recipes.info())\nrecipes.describe()","5942dcd6":"recipes[['minutes', 'n_steps', 'n_ingredients']].hist()","13a7bd55":"interactions.head()","1bb97095":"print(interactions.info())\ninteractions.describe()","8b091571":"interactions['rating'].hist()","f00c9cdb":"from_year, to_year = '2008-01-01','2017-12-31'\n\nrecipes['submitted'] = pd.to_datetime(recipes['submitted'])\nrecipes['submitted'] = recipes['submitted'].apply(lambda x: x.tz_localize(None))\nrecipes_l0y = recipes.loc[recipes['submitted'].between(from_year, to_year, inclusive=False)]\n\ninteractions['date'] = pd.to_datetime(interactions['date'])\ninteractions['date'] = interactions['date'].apply(lambda x: x.tz_localize(None))\ninteractions_l0y = interactions.loc[interactions['date'].between(from_year, to_year, inclusive=False)]\n\nprint(recipes_l0y.shape)\nprint(interactions_l0y.shape)","4cf36614":"sns.boxplot(x=recipes_l0y[\"minutes\"])","ddc945c1":"# calculate the first quartile, third quartile and the interquartile range\nQ1 = recipes_l0y['minutes'].quantile(0.25)\nQ3 = recipes_l0y['minutes'].quantile(0.75)\nIQR = Q3 - Q1\n\n# calculate the maximum value and minimum values according to the Tukey rule\nmax_value = Q3 + 1.5 * IQR\nmin_value = Q1 - 1.5 * IQR\n\n# filter the data for values that are greater than max_value or less than min_value\nminutes_outliers = recipes_l0y[(recipes_l0y['minutes'] > max_value) | (recipes_l0y['minutes'] < min_value)]\nminutes_outliers.sort_values('minutes')","e092ddf2":"# filter out recipes that take longer than 730 days as outliers\nrecipes_l0y = recipes_l0y.query('minutes < 1051200')","bcc2c1e3":"recipes_l0y['year'] = recipes_l0y['submitted'].dt.year\ninteractions_l0y['year'] = interactions_l0y['date'].dt.year","0276f264":"ratings_by_recipe = interactions_l0y.groupby(['recipe_id', 'year']).agg(\n    rating_cnt = ('rating', 'count'),\n    rating_avg = ('rating', 'mean'),\n)\nratings_by_recipe.head()","83cddfe5":"recipes_and_ratings = recipes_l0y.merge(ratings_by_recipe, left_on='id', right_on='recipe_id')\nrecipes_and_ratings.head(2)","084ba469":"# convert the tags column to list format\nrecipes_and_ratings['tags'] = recipes_and_ratings['tags'].apply(lambda x: literal_eval(str(x)))","99d2c0bc":"# add vegetarian and vegan boolean columns\nrecipes_and_ratings['vegetarian'] = ['vegetarian' in tag for tag in recipes_and_ratings['tags']]\nrecipes_and_ratings['vegan'] = ['vegan' in tag for tag in recipes_and_ratings['tags']]\nrecipes_and_ratings = recipes_and_ratings.drop(columns=['name', 'tags', 'nutrition', 'steps', 'description', 'ingredients'])\nrecipes_and_ratings.head(2)","5e41cde6":"#plot a venn diagram of vegetarian and vegan recipe counts\nvegetarian_cnt = len(recipes_and_ratings.query('vegetarian == True'))\nvegan_cnt = len(recipes_and_ratings.query('vegan == True'))\nintersect_cnt = len(recipes_and_ratings.query('vegetarian == True and vegan == True'))\n\nvenn2(subsets = (vegetarian_cnt, vegan_cnt-intersect_cnt, intersect_cnt), set_labels = ('Vegetarian', 'Vegan'), set_colors=('#b7e778', '#031c16', '#031c16'), alpha = 1)","300b5dc9":"df = recipes_and_ratings.groupby(['year', 'vegetarian']).agg(\n    recipe_cnt = ('id', 'count')\n).reset_index()\n\nplt.figure(figsize=(12,6))\n\nax = sns.lineplot(data=df, x='year', y='recipe_cnt', hue='vegetarian', linewidth=2.5)\nax.set(ylim=(0, None))\nax.set_title('Number of new recipes by year')\nax","0bcb17bb":"df = recipes_and_ratings.groupby(['year']).agg(\n    total_cnt = ('id', 'count'),\n    vegetarian_cnt = ('vegetarian', 'sum'),\n    vegan_cnt = ('vegan', 'sum'),\n).reset_index()\n\ndf['vegetarian_pct'] = df['vegetarian_cnt'] \/ df['total_cnt'] * 100\ndf['vegan_pct'] = df['vegan_cnt'] \/ df['total_cnt'] * 100\n\nplt.figure(figsize=(12,6))\n\nax = sns.lineplot(data=pd.melt(df[['year', 'vegetarian_pct', 'vegan_pct']], ['year']), x='year', y='value', palette=veg_meat[1:], hue='variable', linewidth=2.5)\nax.set(ylim=(0, 100))\nax.set_title('Percent of vegetarian recipes by year')\nax","b903c01a":"ratings_by_recipe = interactions_l0y.groupby(['recipe_id', 'year']).agg(\n    rating_cnt = ('rating', 'count'),\n    rating_avg = ('rating', 'mean'),\n).reset_index()\nratings_by_recipe = ratings_by_recipe.merge(recipes_and_ratings[['id', 'vegetarian', 'vegan']], left_on='recipe_id', right_on='id')\n\ndf = ratings_by_recipe.groupby(['year', 'vegetarian']).agg(\n    rating_cnt = ('rating_cnt', 'sum'),\n    rating_avg = ('rating_avg', 'mean'),\n).reset_index()\n\nplt.figure(figsize=(12,6))\n\nax = sns.lineplot(data=df, x='year', y='rating_cnt', hue='vegetarian', linewidth=2.5)\nax.set_title('Recipe ratings by year')\nax","e8251667":"interactions_by_recipe_and_year = interactions_l0y.reset_index().groupby(['recipe_id', 'year']).agg(\n    rating_cnt = ('index', 'count'),\n    rating_avg = ('rating', 'mean'),\n).reset_index()\n\ninteractions_and_recipes = interactions_by_recipe_and_year[['recipe_id', 'year', 'rating_cnt', 'rating_avg']].merge(recipes_and_ratings[['id', 'vegetarian', 'vegan']], left_on='recipe_id', right_on='id')\n\ninteractions_and_recipes['vegetarian_rating_cnt'] = np.where(interactions_and_recipes['vegetarian'] == True, interactions_and_recipes['rating_cnt'], 0)\ninteractions_and_recipes['vegan_rating_cnt'] = np.where(interactions_and_recipes['vegan'] == True, interactions_and_recipes['rating_cnt'], 0)\n\ndf = interactions_and_recipes.groupby(['year']).agg(\n    total_cnt = ('rating_cnt', 'sum'),\n    vegetarian_cnt = ('vegetarian_rating_cnt', 'sum'),\n    vegan_cnt = ('vegan_rating_cnt', 'sum'),\n).reset_index()\n\ndf['vegetarian_pct'] = df['vegetarian_cnt'] \/ df['total_cnt'] * 100\ndf['vegan_pct'] = df['vegan_cnt'] \/ df['total_cnt'] * 100\n\nplt.figure(figsize=(12,6))\n\nax = sns.lineplot(data=pd.melt(df[['year', 'vegetarian_pct', 'vegan_pct']], ['year']), x='year', y='value', palette=veg_meat[1:], hue='variable', linewidth=2.5)\nax.set(ylim=(0, 100))\nax.set_title('Percent of votes on vegetarian recipes by year')\nax","73620593":"df = ratings_by_recipe.groupby(['year', 'vegetarian']).agg(\n    rating_avg = ('rating_avg', 'mean')\n).reset_index()\n\nplt.figure(figsize=(12,6))\n\nax = sns.lineplot(data=df, x='year', y='rating_avg', hue='vegetarian', linewidth=2.5)\nax.set(ylim=(0, 5))\nax.set_title('Average recipe rating by year')\nax","5a236a82":"recipes_and_cohorts = recipes_and_ratings.copy()\nrecipes_and_cohorts['submitted_year'] = recipes_and_cohorts['submitted'].apply(lambda x: x.strftime('%Y'))","b97ba49a":"# add cohort column \u2014 the year of the user's first recipe submission\nrecipes_and_cohorts.set_index('contributor_id', inplace=True)\nrecipes_and_cohorts['contributor_cohort'] = recipes_and_cohorts.groupby(level=0)['submitted'].min().apply(lambda x: x.strftime('%Y'))\nrecipes_and_cohorts.reset_index(inplace=True)\nrecipes_and_cohorts.head()","ab327840":"def add_cohort_periods(df):\n    \"\"\"\n    Creates a `cohort_period` column, which is the Nth period based on the contributor's first recipe.\n    \"\"\"\n    df['cohort_period'] = np.arange(len(df)) + 1\n    return df\n\ndef group_into_cohorts(df):\n    \"\"\"\n    Aggregates contributor count, recipe count and cohort period by contributor cohort and year of submission.\n    \"\"\"\n    df = df.groupby(['contributor_cohort', 'submitted_year']).agg(\n        contributor_cnt = ('contributor_id', 'nunique'),\n        recipe_cnt = ('id', 'nunique'),\n    )\n    df = df.groupby('contributor_cohort').apply(add_cohort_periods)\n    return df\n\n# non-vegetarian cohorts\ncohorts_nonveg = group_into_cohorts(recipes_and_cohorts[recipes_and_cohorts['vegetarian'] == False])\n\n# vegetarian cohorts\ncohorts_veg = group_into_cohorts(recipes_and_cohorts[recipes_and_cohorts['vegetarian'] == True])\ncohorts_veg.head()","c8c63f57":"def calculate_cohort_sizes(df):\n    \"\"\"\n    Calculates cohort sizes.\n    \"\"\"\n    df.reset_index(inplace=True)\n    df.set_index(['contributor_cohort', 'cohort_period'], inplace=True)\n    return df['contributor_cnt'].groupby('contributor_cohort').first()\n\n# calculate cohort sizes\ncohort_sizes_nonveg = calculate_cohort_sizes(cohorts_nonveg)\ncohort_sizes_veg = calculate_cohort_sizes(cohorts_veg)\ncohort_sizes_veg.head()","3d700e72":"def convert_cohort_counts_to_pct(df, cohort_sizes):\n    \"\"\"\n   Converts cohort period contributor counts to percentages.\n    \"\"\"\n    df = df.unstack(0).divide(cohort_sizes, axis=1)\n    df.reset_index(inplace=True)\n    return df\n\n# convert cohort period contributor counts to percentages\ncontributor_retention_nonveg = convert_cohort_counts_to_pct(cohorts_nonveg['contributor_cnt'], cohort_sizes_nonveg)\ncontributor_retention_veg = convert_cohort_counts_to_pct(cohorts_veg['contributor_cnt'], cohort_sizes_veg)\ncontributor_retention_veg","80edb1d4":"def plot_retention_curves(df, cohorts, title, position):\n    \"\"\"\n   Plots retention curves for cohorts.\n    \"\"\"\n    plot = sns.lineplot(\n        data=pd.melt(contributor_retention_nonveg[['cohort_period'] + cohorts], ['cohort_period']),\n        x='cohort_period',\n        y='value',\n        palette='rocket_r',\n        hue='contributor_cohort',\n        linewidth=2.5,\n        ax=ax[position])\n    plot.set(xlim=(0, 8))\n    plot.set(ylim=(0, 1))\n    plot.set(xlabel='Cohort period')\n    plot.set(ylabel='Active contributors')\n    plot.set_title('Contributor retention by cohort: ' + title)\n    return\n\n# plot contributor retention curves\nfig, ax = plt.subplots(1, 2, figsize=(12,6))\n\ncohorts_to_display = ['2008', '2009', '2010', '2011']\n\nplot_retention_curves(contributor_retention_nonveg, cohorts_to_display, 'Non-vegetarian', 0)\nplot_retention_curves(contributor_retention_veg, cohorts_to_display, 'Vegetarian', 1)\n\nfig.show()","12cef210":"# get first recipe by contributor\ndf = recipes_and_cohorts.groupby('contributor_id').agg(\n    vegetarian = ('vegetarian', 'mean'),\n    contributor_cohort = ('contributor_cohort', 'min'),\n)\n# counting contributors with >50% of vegetarian contibutions as vegetarians\ndf.reset_index(inplace=True)\ndf = df.round(0)\n\n# get first recipe by contributor\ndf = df.groupby(['contributor_cohort', 'vegetarian']).agg(\n    contributor_cnt = ('contributor_id', 'count'),\n)\n# counting contributors with >50% of vegetarian contibutions as vegetarians\ndf.reset_index(inplace=True)\ndf['vegetarian'] = df['vegetarian'].astype(bool)\n\nplt.figure(figsize=(12,6))\n\nax = sns.lineplot(data=df, x='contributor_cohort', y='contributor_cnt', palette=veg_meat[:2], hue='vegetarian', linewidth=2.5)\nax.set(xlabel='New contributors')\nax.set(ylabel='Year')\nax.set_title('New contributors by year')","a4a513f5":"plt.figure(figsize=(12,6))\n\nax = sns.lineplot(data=df, x='contributor_cohort', y='contributor_cnt', palette=veg_meat[:2], hue='vegetarian', linewidth=2.5)\nax.set(yscale=\"log\")\nax.set(xlabel='New contributors')\nax.set(ylabel='Year')\nax.set_title('New contributors by year (log)')","b5b22d35":"The share of ratings posted on vegetarian and vegan recipes has remained flat through the 10-year period. This time, we don't even see a decline in the period between 2014 and 2017.\n\nThis may suggest that although the number of vegetarian contributors has declined at a faster rate than that of non-vegetarian authors, the reader composition remained roughly the same.","89c02f63":"## Imports","a70eea18":"### Tags to lists","0377992a":"### Ratings by year","efbe4766":"### New recipes by year","1db3605c":"## Questions\n1. Is there a positive trend in the number of vegetarian recipes posted on food.com between 2008 and 2017?\n2. Is there a positive trend in the number of interactions with vegetarian recipes on Food.com between 2008 and 2017?\n2. Is there a difference in the ratings vegetarian recipes received compared to non-vegetarian recipes between 2008 and 2017?","d0e9e786":"2,147,484,000 minutes sounds like a very long time to cook a recipe. Let's take a closer look at the `minutes` column later on.","b5d1969b":"## Contributor acquisition\nThe alternative explanation for the drop in the share of new vegetarian recipes is that food.com acquires non-vegetarian contributors at a faster rate than vegetarian authors.","a4233f92":"### Rating count and average by recipe and year","06d39824":"## Conclusion\n**Is there a positive trend in the number of vegetarian recipes posted on food.com between 2008 and 2017?**\n\nThere is no positive trand. Between 2008 and 2013, the number of new vegetarian recipes has fallen year-over-year at the same rate as the number of new non-vegetarian recipes. It then started to fall at an even faster rate than for non-vegetarian recipes between 2014 and 2017.\n\n**Is there a positive trend in the number of interactions with vegetarian recipes on Food.com between 2008 and 2017?**\n\nThere is no positive trand. The share of reviews posted on vegetarian and non-vegetarian recipes hsa remained unchanged over the 10-year period.\n\n**Is there a difference in the ratings vegetarian recipes received compared to non-vegetarian recipes between 2008 and 2017?**\n\nYes, there is a slight positive trend. Vegetarian recipes were rated the same between 2008 and 2013, but started to attract higher ratings from there on. As of 2018, vegetarian recipe average ratings are 0.2 points higher than those of non-vegetarian recipes. \n\n### Business implications\nWe can conclude that the growing vegetarian trend has had no positive impact on food.com, and might have even had a negative impact on our contributor acqusition.","a3fe30a8":"Let's start by filtering the dataset down to our chosen 10-year interval.","a35f299f":"Indeed, we can see that from 2014 to 2017, the number of vegetarian contributors has dropped at a faster rate than that of non-vegetarian contributors.","37e6b35f":"### Remove outliers","a0976dc7":"## Data wrangling","7dc35406":"### Exclude How to Preserve a Husband recipe","8e148719":"## Palettes","99a97e84":"We can see that there has been a rapid decline in the number of new recipes posted on food.com over the past decade.\n\nAssuming that the data set is not missing information for some of the more recent years,this decline is somewhat perplexing, as food.com is the second largest recipe website, and internet usage overall has [increased by 10 percentage points](https:\/\/www.pewresearch.org\/fact-tank\/2018\/09\/28\/internet-social-media-use-and-device-ownership-in-u-s-have-plateaued-after-years-of-growth\/) in the last decade.\n\nNevertheless, there could be a number of explanations, which we unfortunately won't have the opportunity to answer in this study:\n* There is a saturation of recipes on the website. Everything there is to cook is already covered.\n* Related to the preciding point, Food.com might have stopped investing in attracting new contributors.\n* Users have shifted their recipe consumption to mobile apps, made by other providers.\n* Most prolific recipe authors launched their own recipe blogs, or moved to social media.\n\nWhatever the reason for the decline, let's see whether it has had an equal impact on vegetarian and non-vegetarian recipes.","60f23677":"## Exploration","b963b6cd":"We can see that there has been a similar decline in the number of interactions (reviews) on the recipes.\n\nThe decline started one year later, which could probably be explained by a lag between new recipe postings and ratings. That is, the spike in new recipe postings in 2008 would only convert into interactions in the following year.\n\nAgain, let's see whether the decline has had an equal impact on vegetarian and non-vegetarian recipes.","b48fcc12":"## Cohort analysis\nI will next conduct a cohort retention analysis to confirm that the number of vegetarian contributors has indeed declined at a faster rate than that of non-vegetarian authors.\n\nSome of the code below was taken from: http:\/\/www.gregreda.com\/2015\/08\/23\/cohort-analysis-with-python\/","10067a84":"Let's try the same with a logarithmic yscale.","c6c75616":"As expected, we can se that the `vegetarian` tag is a superset of the `vegan` category, so we don't need to preprocess the tags any further.\n\nGiven the very high likelyhood of users forgetting to tag vegan recipes as vegetarian, we can assume that the tags were automatically generated by the system.","bc5a92eb":"There is clearly at least one extreme outlier in the data set. 694 days is too long of a preparation time for even the tastiest of recipes!","1230053a":"### Divide users into cohorts","05ac31d4":"### Add submission year column","e4156a8e":"### Add vegan and vegetarian columns, check overlap","d47c6d16":"## Data import & summary","51a63c4f":"# Vegetarian trends at food.com\nThe interest in vegetarian and vegan food has grown steadily over the past two decades.\n\nThe number of searches for 'veganism' in the UK has increased 900% from 2009 to 2019.[1]\n\nAnd although in 2015, just 3.4% of all Americans said they were vegetarian, fully a quarter of 25- to 34-year-olds identified as such.[2]\n\nBelow, I will explore whether this vegetarian trend extends to the users of [food.com](https:\/\/www.food.com\/), one of the leading online recipe websites.\n\n[1] [Veganism: Why are vegan diets on the rise?](https:\/\/www.bbc.com\/news\/business-44488051)\n\n[2] [The year of the vegan, The Economist](https:\/\/worldin2019.economist.com\/theyearofthevegan)","f6603141":"### User retention by cohort group","538d81dc":"The average rating for vegetarian recipes was roughly the same until 2013, but has since grown to ~0.2 points above that of non-vegetarian recipes.","78738ccd":"Users tend to rate recipes very highly.\n\nThis is unlikely to mean that they are universally satisfied with recipes on food.com. More likely, users who don't like the results of a recipe either don't bother to rate, or blame their own cooking skills, giving the recipe author a benefit of the doubt.","b1910a3d":"### Merge recipes and ratings","879ca863":"We can see that contributor retention at food.com has deteriorated significantly over the years.\n\nThe difference between the churn of vegetarian and non-vegetarian contributors appears very mild, however, suggesting that higher atrition rate is not the reason for the decline in the proportion of new vegetarian recipes on the site.","f50a5bb3":"## Dataset\nI will be using the [food.com dataset](https:\/\/www.kaggle.com\/shuyangli94\/food-com-recipes-and-user-interactions) by Bodhisattwa Prasad Majumder, Shuyang Li, Jianmo Ni, and Julian McAuley.\n\nThe dataset consists of 180K+ recipes and 700K+ recipe reviews covering 18 years of user interactions and uploads on Food.com (formerly GeniusKitchen).\n\nFor the purpose of this exploration study, I will look at data between 2008 and 2017.","06e6e672":"The vegetarian category has declined at the same rate as the non-vegetarian portion of food.com, and did even worse between 2014\u20132017.","a2bee798":"As we can see above, the Tukey method filters out many reasonable recipes as outliers. Some recipes, such as pickles, extracts and liqueurs can take many days to prepare, and should not be excluded.\n\nThe one extreme outlier at 1051200 minutes is the [How to Preserve a Husband](https:\/\/www.food.com\/recipe\/how-to-preserve-a-husband-447963) recipe. Although it is no doubt very valuable, I will exclude it from the rest of this exploration."}}