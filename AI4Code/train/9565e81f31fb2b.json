{"cell_type":{"9fa511e4":"code","fb0edac6":"code","e6b73a54":"code","116b33c4":"code","e90a4c4f":"code","384d7b5a":"code","65004b39":"code","7b75a1f4":"code","e8d8e127":"code","bb0c5660":"code","40ee2762":"code","835a8aaa":"code","da6993a0":"code","93259521":"code","94affdbf":"code","13da4be1":"code","581a250c":"code","e933c671":"code","f6864cbb":"code","48be8050":"code","af515c08":"code","acfbeed0":"code","9e0ca2ad":"code","6253212a":"code","0fe88d5a":"code","7608f395":"code","98345763":"code","4c8920f8":"code","0c0f111e":"code","b3e74337":"code","8e927e99":"code","b87dc088":"code","5deb5df9":"code","2dea1581":"code","f65e1fbe":"code","64865b5d":"code","0c24b62c":"code","bf0bb115":"code","8bb324b8":"code","64c2eec3":"code","93211584":"code","2e908b46":"code","2042dfbb":"code","6d9424a9":"code","82a14421":"code","aea9fa8a":"code","5909ec0e":"code","e8cd7415":"code","c112faa4":"code","5c8946c7":"code","4db1ccf1":"code","c15ddbe1":"code","59b8f14f":"code","af5b6421":"code","3dea91b9":"code","91d40e2c":"code","1be5e29e":"code","f2286b1b":"code","cc0b17ce":"code","36c976bf":"code","5b264ee4":"code","6854c7dd":"code","e1a0a082":"code","e13aadad":"code","fea55ffb":"code","6ca5c873":"code","08b975d8":"code","219a5a1b":"code","73ee19aa":"code","804654be":"code","1fd6d58f":"code","b9b7d413":"code","a24de549":"code","731f5716":"code","b3d77e81":"code","4ab00880":"code","be6ababb":"code","832ae5ac":"code","6ca0611e":"code","683c2633":"code","945446f1":"code","f172350e":"code","11d1cf2d":"code","eb539f7d":"code","c2fcfbae":"code","f3b65fee":"code","bea97713":"code","6db10be8":"code","83b0afd5":"code","d0dccca8":"code","0cca0d66":"code","d744d4a7":"code","43d0c290":"code","e9930ad1":"code","656e619c":"code","1e199618":"code","577e5141":"code","599eb234":"code","cf038660":"code","06e6ac9c":"code","92cacabc":"code","ffc18f23":"code","b22e9403":"code","cf6933c2":"code","e2c3a178":"code","850b50ea":"code","1526be4a":"code","6950f92c":"code","4cb8a5b3":"code","997e2d1c":"code","77c74799":"code","190514bd":"code","8a6dc136":"code","cfae2077":"code","85993e3a":"code","96d0ecef":"code","3dfe7727":"code","73ec03da":"code","52656cdd":"code","626de697":"code","6abe68bd":"code","2359d065":"code","8b45002b":"code","bd05f0ab":"code","6489d0c7":"code","44ad9f0c":"code","43f6b560":"code","3a826574":"code","571dd65e":"code","4eeb0cd2":"code","b4d8224c":"code","12459d79":"code","0d8a6364":"code","06aa5475":"code","0f67ee12":"code","5c3afafa":"code","c9fc9e21":"code","507bfdc8":"code","00ad55fb":"code","302b9d5b":"code","56ce0ce9":"code","1f6d687d":"code","2ea7ac43":"code","78d27549":"code","f907e3ff":"code","e0ef3f26":"code","1344cc52":"code","4ac5891a":"code","5e99a21d":"code","d15c1350":"code","a754e5dd":"code","4d6aa0aa":"code","c6ed184a":"code","e4e7bd51":"code","0db11a58":"code","a678f523":"code","97ef6b49":"code","ada56f3c":"code","f33f989c":"code","3107bdbb":"code","2583bcab":"code","1a89c483":"code","eb3aa4c3":"code","7ffbbee1":"code","6cac8b50":"code","199846ca":"code","5590c98e":"code","6e069973":"code","bf1572fd":"code","8145196a":"code","57271a8f":"code","50c69e90":"code","d9c91b94":"code","84114405":"code","480a2ac8":"code","017b2c8b":"code","3c02d3bb":"code","7b65c362":"code","a04725dc":"code","a7838557":"code","4c93e523":"code","a85c02bc":"code","5dfc8dca":"code","5d08a755":"code","c82b9620":"code","ae7d200b":"code","f15b1bc4":"code","dfca146d":"code","86ee8048":"code","cb91d652":"code","23cca646":"code","ed66964d":"code","c27dccbb":"code","3f2876e0":"code","a2f4e568":"code","4f3b47bb":"code","fd054042":"code","c4f15023":"code","11d0b6ae":"code","94a7b1c6":"code","877c7a4d":"code","8f52b4ed":"code","24b8600a":"code","4ad614af":"code","8da9fa74":"code","ab836d14":"code","e0ef76c7":"code","d1b8029b":"code","9755485b":"code","5f47c9ee":"code","e34e44dc":"code","ce27e0dd":"markdown","53cfe766":"markdown","89a933d0":"markdown","94915262":"markdown","9f4b572e":"markdown","e253d5e7":"markdown","813de530":"markdown","b174d6fc":"markdown","ddc386ed":"markdown","37d1476c":"markdown","fc6755b8":"markdown","da80fa4f":"markdown","d3e5aeb1":"markdown","57b6a960":"markdown","c6cf02e7":"markdown","e69baf6a":"markdown","8977d6b2":"markdown","9ebd4d14":"markdown","c752221e":"markdown","ae82fa8d":"markdown","3d7001cd":"markdown","bd3a7276":"markdown","88b87c7e":"markdown","75e1a25f":"markdown","45e862a4":"markdown","36edac61":"markdown","aa5d860f":"markdown","89ef98a3":"markdown","3ea1d20a":"markdown","d55016ef":"markdown","dd2a3acc":"markdown","ccc0a3d3":"markdown","4cb7ca73":"markdown","9e837edd":"markdown","99115ec2":"markdown","c41db3f7":"markdown","bc9bb09a":"markdown","939e2e32":"markdown","d65c0103":"markdown","f6db906d":"markdown","94b6e5d1":"markdown","ffa097a1":"markdown","0c0188c9":"markdown","b458d114":"markdown","a71e9268":"markdown","717eca85":"markdown","9bca6db3":"markdown","b3394878":"markdown","97e39a27":"markdown","e527892d":"markdown","db6cb15f":"markdown","8385ab9b":"markdown","e19ea61f":"markdown","4ee7ef11":"markdown","0ab61d44":"markdown","df8282aa":"markdown","a9cffa83":"markdown","c87701cb":"markdown","a8bb4250":"markdown","ecac0bec":"markdown","16b7d02b":"markdown","aef8787a":"markdown","73d3c67d":"markdown","37d33066":"markdown","c1a9996b":"markdown","433d68d8":"markdown","e9f070f5":"markdown","0c1b5ab8":"markdown","45784894":"markdown","2c0026dd":"markdown","bce08d9e":"markdown","e09ce116":"markdown","e37cebd4":"markdown","33973a94":"markdown","eeece6ef":"markdown","aca31051":"markdown","d4cf2a1e":"markdown","0642a9e2":"markdown","f9e60957":"markdown","2754afee":"markdown","076f6e54":"markdown","d7a9784b":"markdown","0af3027c":"markdown","43f58efc":"markdown","f59cb7b4":"markdown","3eb5141e":"markdown","74b7fb03":"markdown","cbe4e494":"markdown","063537a9":"markdown","3aa0f397":"markdown","978c0c82":"markdown","ed61b859":"markdown","9605a5c8":"markdown","97e435b8":"markdown","f120824e":"markdown","a8434ec2":"markdown","186b6472":"markdown","53fdd349":"markdown","ac26e373":"markdown","e03746a3":"markdown","59f68b64":"markdown","ec86b35b":"markdown","db53858b":"markdown","b2d57b46":"markdown","88e665cb":"markdown","889c5696":"markdown","85659c60":"markdown","723dad70":"markdown","9931d5cc":"markdown","1d0957ec":"markdown","cfa1540f":"markdown","6d65e1eb":"markdown","185f5ef7":"markdown","618859cd":"markdown","76cec770":"markdown","c0118711":"markdown","d6f88a26":"markdown","ede1b788":"markdown","f23ac131":"markdown","fe120547":"markdown","b67797dc":"markdown","02388188":"markdown","7cf1fe12":"markdown","aceff5b9":"markdown","c792b202":"markdown","c844db90":"markdown","54076c2b":"markdown","a7e1661f":"markdown","0655d10c":"markdown","bf60f06d":"markdown","04f1e692":"markdown","75b0fe6c":"markdown","02fd5c45":"markdown","63c5854c":"markdown","bd77403b":"markdown","7c09f47f":"markdown","600f9dbb":"markdown","f5800e96":"markdown","cda34786":"markdown","89877b05":"markdown","44d3b5d3":"markdown","cb0c7ee6":"markdown"},"source":{"9fa511e4":"from IPython.display import Image\nImage(\"..\/input\/pandas-logo\/pandas_logo.png\")","fb0edac6":"import pandas as pd","e6b73a54":"houses_2009 = pd.read_csv('..\/input\/appraisal-data\/2009SINGLEFAMILYSF.txt')","116b33c4":"houses_2009.head(n=10)","e90a4c4f":"houses_2009.tail()","384d7b5a":"houses_2009.shape","65004b39":"houses_2009.info()","7b75a1f4":"houses_2009.columns","e8d8e127":"houses_2009[\"2009 TOTAL APPR\"]","bb0c5660":"houses_2009.columns = ['APN', 'DistrictCode', 'CouncilDistrict', 'AddressFullAddress',\n       'AddressCity', 'AddressPostalCode', 'LAND', 'IMPR', 'TOTALAPPR',\n       'TOTALASSD', 'FinishedArea']\nhouses_2009.columns","40ee2762":"houses_2009.TOTALAPPR","835a8aaa":"# Your code here","da6993a0":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_003.py","93259521":"houses_2009.AddressCity.unique()","94affdbf":"houses_2009.AddressCity.nunique()","13da4be1":"houses_2009.AddressCity.value_counts()","581a250c":"# Your Code Here","e933c671":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_101.py","f6864cbb":"houses_2009.AddressFullAddress.value_counts() > 1","48be8050":"(houses_2009.AddressFullAddress.value_counts() > 1).sum()","af515c08":"houses_2009.AddressCity == 'BRENTWOOD'","acfbeed0":"houses_2009.loc[houses_2009.AddressCity == 'BRENTWOOD']","9e0ca2ad":"# Your Code Here","6253212a":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_102.py","0fe88d5a":"# Your Code Here","7608f395":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_103.py","98345763":"houses_2009.AddressCity.str.lower()","4c8920f8":"# Your Code Here","0c0f111e":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_104.py","b3e74337":"houses_2009 = houses_2009.drop_duplicates('AddressFullAddress')\nhouses_2013 = houses_2013.drop_duplicates('AddressFullAddress')\nhouses_2017 = houses_2017.drop_duplicates('AddressFullAddress')","8e927e99":"houses_2009.loc[100:105,['AddressFullAddress', 'AddressCity']]","b87dc088":"houses_2009.loc[[1000, 2000, 3000], 'CouncilDistrict']","5deb5df9":"# Your Code Here","2dea1581":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_105.py","f65e1fbe":"import matplotlib.pyplot as plt\n%matplotlib inline","64865b5d":"houses_2009.CouncilDistrict.value_counts().plot.bar();","0c24b62c":"fig = houses_2009.CouncilDistrict.value_counts().plot.bar(figsize = (14,6), width = 0.75,\n                                                         rot = 0, color = 'plum')\nfig.set_xlabel('District')\nfig.set_title('Number of Single-Family Homes by District, 2009', fontweight = 'bold');","bf0bb115":"houses_2009.CouncilDistrict.value_counts().loc[range(1,36)]","8bb324b8":"fig = houses_2009.CouncilDistrict.value_counts().loc[list(range(1,36))].plot.bar(figsize = (14,6), width = 0.75,\n                                                         rot = 0, color = 'plum')\nfig.set_xlabel('District')\nfig.set_title('Number of Single-Family Homes by District, 2009', fontweight = 'bold');","64c2eec3":"# Your Code Here","93211584":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_106.py","2e908b46":"fig = houses_2009.FinishedArea.plot.hist(figsize = (10,4))\nfig.set_title('Distribution of Homes by Square Footage', fontweight = 'bold');","2042dfbb":"# Your Code Here","6d9424a9":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_107.py","82a14421":"houses_2009.loc[houses_2009.FinishedArea < 10000].FinishedArea.plot.hist(figsize = (10,4), bins = 50)\nplt.title('Distribution of Homes by Square Footage', fontweight = 'bold');","aea9fa8a":"houses_2009.TOTALAPPR.plot.hist();","5909ec0e":"houses_2009.TOTALAPPR.describe()","e8cd7415":"houses_2009.loc[houses_2009.TOTALAPPR <= 750000].TOTALAPPR.plot.hist(bins = 50);","c112faa4":"fig = houses_2009.loc[houses_2009.TOTALAPPR <= 750000].TOTALAPPR.plot.hist(bins = 50, alpha = 0.6, density = True, label = '2009', figsize = (10,5))\nhouses_2017.loc[houses_2017.TOTALAPPR <= 750000].TOTALAPPR.plot.hist(bins = 50, alpha = 0.6, density = True, label = '2017');\nfig.axes.get_yaxis().set_visible(False)\nfig.set_title('Distribution of Appraisal Values, 2009 vs 2017')\nfig.legend();","5c8946c7":"# Your Code Here","4db1ccf1":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_108.py","c15ddbe1":"# Your Code Here","59b8f14f":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_109.py","af5b6421":"houses_2009.groupby('CouncilDistrict').count()","3dea91b9":"houses_2009.groupby('CouncilDistrict').APN.count()","91d40e2c":"houses_2009.groupby('CouncilDistrict').TOTALAPPR.mean()","1be5e29e":"houses_2009.groupby('CouncilDistrict').TOTALAPPR.agg(['mean', 'median'])","f2286b1b":"houses_2009.groupby('CouncilDistrict').agg({'TOTALAPPR':['mean', 'median'], 'FinishedArea': ['mean', 'median']})","cc0b17ce":"agg_df = houses_2009.groupby('CouncilDistrict').agg({'TOTALAPPR':['mean', 'median'], 'FinishedArea': ['mean', 'median']})\nagg_df.columns","36c976bf":"agg_df = houses_2009.groupby(['CouncilDistrict', 'AddressPostalCode']).TOTALAPPR.median()\nagg_df","5b264ee4":"agg_df.loc[25]","6854c7dd":"agg_df.loc[(25, 37205)]","e1a0a082":"# Your Code Here","e13aadad":"# Or Load the Solution\n%load ..\/input\/exercisesolutions\/soln_110.py","fea55ffb":"fig, ax = plt.subplots(figsize = (12,5))\nax2 = ax.twinx()\n\nwidth = 0.4\n\nhouses_2009.groupby('CouncilDistrict').TOTALAPPR.mean().plot.bar(color='olive', ax=ax, width=width, position=1, edgecolor = 'black', rot = 0)\nhouses_2009.groupby('CouncilDistrict').FinishedArea.mean().plot.bar(color='lightcoral', ax=ax2, width=width, position=0, edgecolor= 'black')\n\nax.set_ylabel('Median Appraisal Value', color = 'olive', fontweight = 'bold')\nax2.set_ylabel('Average Square Footage', color = 'lightcoral', fontweight = 'bold')\n\nplt.xlim(-1,35)\nplt.title('Housing Snapshot by District, 2009', fontweight = 'bold');","6ca5c873":"ACS = pd.read_csv('..\/input\/census\/ACS.csv')\nACS = ACS.set_index('district')\nACS.head()","08b975d8":"# Your Code Here","219a5a1b":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_111.py","73ee19aa":"fig, ax = plt.subplots(figsize = (10,6))\nplt.scatter(x = ACS.loc[ACS.year == 2017].median_income, \n         y = houses_2017.groupby('CouncilDistrict').TOTALAPPR.median(),\n           alpha = 0.75)\nplt.xlabel('Median Income')\nplt.ylabel('Median Household Appraisal Value');","804654be":"fig, ax = plt.subplots(figsize = (10,6))\nplt.scatter(x = ACS.loc[ACS.year == 2017].median_income, \n         y = houses_2017.groupby('CouncilDistrict').TOTALAPPR.median(),\n           alpha = 0.75)\nplt.xlabel('Median Income')\nplt.ylabel('Median Household Appraisal Value')\nfor i in range(1,36):\n    plt.annotate(xy = (ACS.loc[ACS.year == 2017].median_income.loc[i], houses_2017.groupby('CouncilDistrict').TOTALAPPR.median().loc[i]),\n                s = str(i));","1fd6d58f":"import geopandas as gpd","b9b7d413":"council_districts = gpd.read_file('..\/input\/shapefiles\/Council_District_Outlines.geojson')","a24de549":"council_districts.head()","731f5716":"council_districts.plot();","b3d77e81":"fig, ax = plt.subplots(figsize = (10,10))\ncouncil_districts.plot(ax = ax);","4ab00880":"council_districts['coords'] = council_districts.geometry.map(lambda x: x.representative_point().coords[:][0])\n","be6ababb":"council_districts.head()","832ae5ac":"rows = council_districts.iterrows()","6ca0611e":"next(rows)","683c2633":"idx, row = next(rows)\nprint(idx)\nprint(row)","945446f1":"row['district']","f172350e":"for idx, row in rows:\n    print(row['district'])","11d1cf2d":"#Your Code Here","eb539f7d":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_203.py","c2fcfbae":"def shift_coord(district, amount, direction):\n    old_coord = council_districts.loc[council_districts.district == district, 'coords'].values[0]\n    if direction == 'up':\n        new_coord = (old_coord[0], old_coord[1] + amount)\n    if direction == 'down':\n        new_coord = (old_coord[0], old_coord[1] - amount)\n    if direction == 'left':\n        new_coord = (old_coord[0] - amount, old_coord[1])\n    if direction == 'right':\n        new_coord = (old_coord[0] + amount, old_coord[1])\n    council_districts.loc[council_districts.district == district, 'lng'] = new_coord[0]\n    council_districts.loc[council_districts.district == district, 'lat'] = new_coord[1]\n\n    council_districts.loc[council_districts.district == district, 'coords'] = council_districts.loc[council_districts.district == district, ['lng', 'lat']].apply(tuple, axis = 1) ","f3b65fee":"shift_coord(district='15', amount = 0.005, direction = 'left')\nshift_coord(district='9', amount = 0.005, direction = 'down')\nshift_coord(district='15', amount = 0.02, direction = 'down')\nshift_coord(district='28', amount = 0.003, direction = 'down')\nshift_coord(district='6', amount = 0.005, direction = 'down')\nshift_coord(district='27', amount = 0.004, direction = 'left')\nshift_coord(district='27', amount = 0.005, direction = 'down')\nshift_coord(district='11', amount = 0.01, direction = 'down')\nshift_coord(district='18', amount = 0.005, direction = 'down')\nshift_coord(district='22', amount = 0.01, direction = 'down')\nshift_coord(district='25', amount = 0.006, direction = 'down')\nshift_coord(district='21', amount = 0.005, direction = 'right')\nshift_coord(district='24', amount = 0.005, direction = 'right')\nshift_coord(district='3', amount = 0.01, direction = 'down')\nshift_coord(district='3', amount = 0.005, direction = 'left')\nshift_coord(district='7', amount = 0.015, direction = 'down')","bea97713":"fig, ax = plt.subplots(figsize = (10,10))\ncouncil_districts.plot(ax = ax)\nfor idx, row in council_districts.iterrows():\n    plt.annotate(s=row['district'], xy=row['coords'],\n                 horizontalalignment='center', fontweight = 'bold')","6db10be8":"homes_per_district = houses_2009.CouncilDistrict.value_counts()\nhomes_per_district","83b0afd5":"type(homes_per_district)","d0dccca8":"homes_per_district = homes_per_district.reset_index()\nhomes_per_district.head(5)","0cca0d66":"homes_per_district.columns = ['district', 'num_homes_2009']\nhomes_per_district.head(2)","d744d4a7":"pd.merge(left = council_districts, right = homes_per_district)","43d0c290":"council_districts.district = council_districts.district.astype(int)","e9930ad1":"council_districts = pd.merge(left = council_districts, right = homes_per_district)","656e619c":"type(council_districts)","1e199618":"fig, ax = plt.subplots(figsize = (10,10))\ncouncil_districts.plot(ax = ax, column = 'num_homes_2009')\nfor idx, row in council_districts.iterrows():\n    plt.annotate(s=row['district'], xy=row['coords'],\n                 horizontalalignment='center', fontweight = 'bold');","577e5141":"fig, ax = plt.subplots(figsize = (10,10))\ncouncil_districts.plot(ax = ax, column = 'num_homes_2009', legend = True)\nfor idx, row in council_districts.iterrows():\n    plt.annotate(s=row['district'], xy=row['coords'],\n                 horizontalalignment='center', fontweight = 'bold')","599eb234":"fig, ax = plt.subplots(figsize = (10,10))\ncouncil_districts.plot(ax = ax, column = 'num_homes_2009', legend = True, cmap = 'YlOrRd',edgecolor = 'grey')\nfor idx, row in council_districts.iterrows():\n    plt.annotate(s=row['district'], xy=row['coords'],\n                 horizontalalignment='center', fontweight = 'bold')","cf038660":"from matplotlib import cm\nfrom matplotlib.colors import Normalize\nfrom mpl_toolkits.axes_grid1 import make_axes_locatable","06e6ac9c":"fig, ax = plt.subplots(figsize = (10,10))\n\ncouncil_districts.plot(ax = ax, column = 'num_homes_2009', cmap = 'YlOrRd', edgecolor = 'grey')\n\nfor idx, row in council_districts.iterrows():\n    plt.annotate(s=row['district'], xy=row['coords'],\n                 horizontalalignment='center', fontweight = 'bold', color = 'black')\n\ndivider = make_axes_locatable(ax)\ncax = divider.append_axes(\"right\", size=\"5%\", pad=0.1)\n\ncmap = cm.ScalarMappable(\n      norm = Normalize(council_districts.num_homes_2009.min(), council_districts.num_homes_2009.max()), \n      cmap = 'YlOrRd')\ncmap.set_array([])    \nfig.colorbar(mappable=cmap, cax = cax);","92cacabc":"# Your Code Here","ffc18f23":"# Or load the solution \n%load ..\/input\/exercisesolutions\/soln_202.py","b22e9403":"fig, ax = plt.subplots(figsize = (10,10))\n\ncouncil_districts.plot(ax = ax, column = 'num_homes_2009', cmap = 'YlOrRd', edgecolor = 'grey')\n\nfor idx, row in council_districts.iterrows():\n    plt.annotate(s=row['district'], xy=row['coords'],\n                 horizontalalignment='center', fontweight = 'bold', color = choose_color(row['num_homes_2009']))\n\nplt.title('Number of Single-Family Homes by Council District, 2009', fontweight = 'bold', fontsize = 14)\nplt.axis('off')\n\ndivider = make_axes_locatable(ax)\ncax = divider.append_axes(\"right\", size=\"5%\", pad=0.1)\n\ncmap = cm.ScalarMappable(\n      norm = Normalize(council_districts.num_homes_2009.min(), council_districts.num_homes_2009.max()), \n      cmap = 'YlOrRd')\ncmap.set_array([])    \nfig.colorbar(mappable=cmap, cax = cax);","cf6933c2":"interstates = gpd.read_file('..\/input\/shapefiles\/tl_2016_us_primaryroads.shp')","e2c3a178":"interstates.head()","850b50ea":"interstates.plot()","1526be4a":"print(interstates.crs)\nprint(council_districts.crs)","6950f92c":"interstates = interstates.to_crs(council_districts.crs)","4cb8a5b3":"interstates = gpd.sjoin(interstates, council_districts, how=\"inner\", op='intersects')","997e2d1c":"fig, ax = plt.subplots(figsize = (10,10))\ncouncil_districts.plot(ax = ax)\nfor idx, row in council_districts.iterrows():\n    plt.annotate(s=row['district'], xy=row['coords'],\n                 horizontalalignment='center', fontweight = 'bold')\ninterstates.plot(color = 'black', ax = ax);","77c74799":"fig, ax = plt.subplots(figsize = (10,10))\ncouncil_districts.plot(ax = ax)\nxlims = plt.xlim()\nylims = plt.ylim()\nfor idx, row in council_districts.iterrows():\n    plt.annotate(s=row['district'], xy=row['coords'],\n                 horizontalalignment='center', fontweight = 'bold')\ninterstates.plot(color = 'black', ax = ax)\nplt.xlim(xlims)\nplt.ylim(ylims);","190514bd":"fig, ax = plt.subplots(figsize = (10,10))\n\ncouncil_districts.plot(ax = ax, column = 'num_homes_2009', cmap = 'YlOrRd', edgecolor = 'grey')\n\nxlims = plt.xlim()\nylims = plt.ylim()\n\ninterstates.plot(color = 'black', ax = ax)\nplt.xlim(xlims)\nplt.ylim(ylims)\n\n\nfor idx, row in council_districts.iterrows():\n    plt.annotate(s=row['district'], xy=row['coords'],\n                 horizontalalignment='center', fontweight = 'bold', color = choose_color(row['num_homes_2009']))\n\nplt.title('Number of Single-Family Homes by Council District, 2009', fontweight = 'bold', fontsize = 14)\nplt.axis('off')\n\ndivider = make_axes_locatable(ax)\ncax = divider.append_axes(\"right\", size=\"5%\", pad=0.1)\n\ncmap = cm.ScalarMappable(\n      norm = Normalize(council_districts.num_homes_2009.min(), council_districts.num_homes_2009.max()), \n      cmap = 'YlOrRd')\ncmap.set_array([])    \nfig.colorbar(mappable=cmap, cax = cax); ","8a6dc136":"#Your Code Here","cfae2077":"# Or load the solution \n%load ..\/input\/exercisesolutions\/soln_204.py","85993e3a":"homes_per_district_2013 = pd.DataFrame(houses_2013.CouncilDistrict.value_counts().sort_values()).reset_index()\nhomes_per_district_2013.columns = ['district', 'num_homes_2013']\n\nhomes_per_district_2017 = pd.DataFrame(houses_2017.CouncilDistrict.value_counts().sort_values()).reset_index()\nhomes_per_district_2017.columns = ['district', 'num_homes_2017']","96d0ecef":"council_districts = pd.merge(left = pd.merge(left = council_districts, right = homes_per_district_2013), right = homes_per_district_2017)\n","3dfe7727":"#Your Code Here","73ec03da":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_302.py","52656cdd":"generate_map(2013)","626de697":"from ipywidgets import interact","6abe68bd":"@interact(x=5)\ndef square(x):\n    return x**2","2359d065":"@interact(x = 5, y = 5)\ndef sum_squares(x,y):\n    return x**2 + y**2","8b45002b":"@interact(k = [1\/4, 1\/3, 1\/2, 1, 2, 3, 4])\ndef plot_power_function(k):\n    xs = range(50)\n    dynamic_ys = [x ** k for x in xs]\n    plt.plot(xs, dynamic_ys)","bd05f0ab":"# Your Code Here","6489d0c7":"# Or load the solution \n%load ..\/input\/exercisesolutions\/soln_303.py","44ad9f0c":"def choose_color_scaled(num_homes, vmin, vmax):\n    if num_homes < (vmin + vmax) \/ 2: return \"black\"\n    return \"white\"","43f6b560":"vmin = council_districts[['num_homes_2009', 'num_homes_2013', 'num_homes_2017']].values.min()\nvmax = council_districts[['num_homes_2009', 'num_homes_2013', 'num_homes_2017']].values.max()\n\n@interact(year = ['2009', '2013', '2017'])\ndef generate_map(year):\n    fig, ax = plt.subplots(figsize = (10,10))\n    column = 'num_homes_' + year\n    \n\n    council_districts.plot(ax = ax, column = column, cmap = 'YlOrRd', edgecolor = 'grey', vmin = vmin, vmax = vmax)\n\n    xlims = plt.xlim()\n    ylims = plt.ylim()\n    interstates.plot(color = 'black', ax = ax)\n    plt.xlim(xlims)\n    plt.ylim(ylims)\n    \n    for idx, row in council_districts.iterrows():\n        plt.annotate(s=row['district'], xy=row['coords'],\n                     horizontalalignment='center', fontweight = 'bold', color = choose_color_scaled(row[column], vmin, vmax))\n\n    plt.title(f'Number of Single-Family Homes by Council District, {year}', fontweight = 'bold', fontsize = 14)\n    plt.axis('off')\n\n    divider = make_axes_locatable(ax)\n    cax = divider.append_axes(\"right\", size=\"5%\", pad=0.1)\n\n    cmap = cm.ScalarMappable(\n          norm = Normalize(vmin, vmax), \n          cmap = 'YlOrRd')\n    cmap.set_array([])    \n    fig.colorbar(mappable=cmap, cax = cax);   ","3a826574":"#Your Code Here","571dd65e":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_304.py","4eeb0cd2":"council_districts[['district', 'absolute_change']].sort_values('absolute_change').head()","b4d8224c":"council_districts[['district', 'absolute_change']].sort_values('absolute_change', ascending = False).head()","12459d79":"council_districts[['district', 'relative_change']].sort_values('relative_change', ascending = False).head()","0d8a6364":"#Your Code Here","06aa5475":"# Or load the solution \n%load ..\/input\/exercisesolutions\/soln_305.py","0f67ee12":"houses_2017.TOTALAPPR.describe()","5c3afafa":"houses_2017.nlargest(n=5, columns='TOTALAPPR')","c9fc9e21":"def find_mortgage_payment(TOTALAPPR,years = 30, rate = 4, down_payment = 20):\n    P = TOTALAPPR * (1 - (down_payment \/ 100))\n    n = 12 * years\n    r = rate \/ (100 * 12)\n    M = P * (r * (1 + r)**n) \/ ((1 + r)**n - 1)\n    return M","507bfdc8":"houses_2009['est_mortgage_cost'] = houses_2009.TOTALAPPR.apply(lambda x: 12*find_mortgage_payment(x))\nhouses_2013['est_mortgage_cost'] = houses_2013.TOTALAPPR.apply(lambda x: 12*find_mortgage_payment(x))\nhouses_2017['est_mortgage_cost'] = houses_2017.TOTALAPPR.apply(lambda x: 12*find_mortgage_payment(x))\n","00ad55fb":"tax_rates = {'USD' : 3.155\/100,\n            'GSD' : 2.755\/100,\n             'GO' : 3.503 \/ 100,\n             'FH' : 2.755\/100,\n             'OH' : 2.755\/100,\n             'BM' : 3.012\/100,\n             'BH' : 2.755\/100,\n            'CBID' : 3.2844 \/ 100,\n            'GBID': 3.2631 \/ 100,\n            'RT' : 3.437\/100,\n            'LW' : 2.755\/100}","302b9d5b":"def calculate_property_taxes(row):\n    return row.TOTALASSD * tax_rates[row.DistrictCode]","56ce0ce9":"houses_2009['est_property_tax'] = houses_2009.apply(calculate_property_taxes, axis = 1)","1f6d687d":"houses_2009.DistrictCode = houses_2009.DistrictCode.str.strip()\nhouses_2013.DistrictCode = houses_2013.DistrictCode.str.strip()\nhouses_2017.DistrictCode = houses_2017.DistrictCode.str.strip()","2ea7ac43":"houses_2009['est_property_tax'] = houses_2009.apply(calculate_property_taxes, axis = 1)\nhouses_2013['est_property_tax'] = houses_2013.apply(calculate_property_taxes, axis = 1)\nhouses_2017['est_property_tax'] = houses_2017.apply(calculate_property_taxes, axis = 1)","78d27549":"houses_2009['est_yearly_cost'] = houses_2009.est_mortgage_cost + houses_2009.est_property_tax + 720\nhouses_2013['est_yearly_cost'] = houses_2013.est_mortgage_cost + houses_2013.est_property_tax + 720\nhouses_2017['est_yearly_cost'] = houses_2017.est_mortgage_cost + houses_2017.est_property_tax + 720","f907e3ff":"def classify_house(value, AMI):\n    if value <= 0.3 * 0.3*AMI:\n        return 'AFF_1'\n    elif value <= 0.3 * 0.6 * AMI:\n        return 'AFF_2'\n    elif value <= 0.3* 0.9 * AMI:\n        return 'WF_1'\n    elif value <= 0.3 * 1.2*AMI:\n        return 'WF_2'\n    else:\n        return 'AWF'","e0ef3f26":"houses_2009['category'] = houses_2009.est_yearly_cost.apply(lambda x: classify_house(x, 64900))\nhouses_2013['category'] = houses_2013.est_yearly_cost.apply(lambda x: classify_house(x, 62300))\nhouses_2017['category'] = houses_2017.est_yearly_cost.apply(lambda x: classify_house(x, 68000))","1344cc52":"plt.figure(figsize = (10,6))\nhouses_2017.category.value_counts()[['AFF_1', 'AFF_2', 'WF_1', 'WF_2', 'AWF']].plot.bar(rot = 0)\nplt.title('Number of Single-Family Homes by Category, 2017');","4ac5891a":"chess_players = pd.DataFrame({'player': ['Magnus Carlsen', 'Fabiano Caruana', 'Ding Liren'],\n                       'wins': [962, 793,414],\n                        'draws': [930,821,575],\n                       'losses': [334,459,186]})\nchess_players= chess_players.set_index('player')\nchess_players","5e99a21d":"fig, ax = plt.subplots(figsize = (7,5))\nchess_players.plot.bar(ax = ax, edgecolor = 'black', lw = 1.5, rot = 0, width = 0.8)\nplt.title('Top 3 Chess Players by ELO', fontweight = 'bold')\nplt.xlabel('')\nax.legend(bbox_to_anchor=(1, 0.6));","d15c1350":"houses_2009['year'] = 2009\nhouses_2013['year'] = 2013\nhouses_2017['year'] = 2017","a754e5dd":"houses = pd.concat([houses_2009, houses_2013, houses_2017])","4d6aa0aa":"houses.head()","c6ed184a":"#Your Code Here","e4e7bd51":"# Or load the soution \n%load ..\/input\/exercisesolutions\/soln_402.py","0db11a58":"melted_chess = chess_players.reset_index().melt(id_vars=['player'], var_name = 'outcome')\nmelted_chess","a678f523":"melted_chess.pivot(index='player', columns='outcome', values='value')","97ef6b49":"#Your Code Here","ada56f3c":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_403.py","f33f989c":"pivot_df = pivot_df.loc[['AFF_1', 'AFF_2', 'WF_1', 'WF_2', 'AWF']]\npivot_df","3107bdbb":"# Your Code Here","2583bcab":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_404.py","1a89c483":"chess_players","eb3aa4c3":"fig, ax = plt.subplots(figsize = (8,6))\nchess_players.plot.bar(stacked=True, edgecolor = 'black', lw = 1.5, \n                       rot = 0, ax = ax, width = 0.75,title = 'Top 3 Chess Players by ELO')\nplt.xlabel('')\nhandles, labels = ax.get_legend_handles_labels()\nax.legend(handles[::-1], labels[::-1], bbox_to_anchor=(1, 0.6));","7ffbbee1":"import numpy as np","6cac8b50":"fig, ax = plt.subplots(figsize = (8,6))\nchess_players.plot.bar(stacked=True, edgecolor = 'black', lw = 1.5, \n                       rot = 0, ax = ax, width = 0.75,title = 'Top 3 Chess Players by ELO')\nplt.xlabel('')\nhandles, labels = ax.get_legend_handles_labels()\nax.legend(handles[::-1], labels[::-1], bbox_to_anchor=(1, 0.6))\n\nrows = chess_players.iterrows()\nfor i in range(3):\n    values = next(rows)[1]\n    heights = np.array([0] + list(values.cumsum()[:-1])) + values\/2\n    for height, value in zip(heights,values):\n        plt.text(x = i, y = height, s = f'{value:,}', color = 'white', ha = 'center', va = 'center', fontweight = 'bold');","199846ca":"#Your Code Here","5590c98e":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_405.py","6e069973":"#Your Code Here","bf1572fd":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_406.py","8145196a":"#Your Code Here","57271a8f":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_407.py","50c69e90":"overall_pct_change = 100*(houses.loc[houses.year == 2017].TOTALAPPR.median() - houses.loc[houses.year==2013].TOTALAPPR.median()) \/ houses.loc[houses.year == 2013].TOTALAPPR.median()\noverall_pct_change","d9c91b94":"#Your Code Here","84114405":"# Or load the solution\n%load ..\/input\/exercisesolutions\/soln_408.py","480a2ac8":"median_appr = median_appr.pivot(index = 'CouncilDistrict', columns='year', values='TOTALAPPR')\nmedian_appr.head()","017b2c8b":"median_appr.columns","3c02d3bb":"median_appr['pct_change'] = 100*(median_appr[2017] - median_appr[2013]) \/ median_appr[2013]","7b65c362":"median_appr.head()","a04725dc":"median_appr = median_appr.reset_index()\nmedian_appr.head()","a7838557":"fig, ax = plt.subplots()\nmedian_appr.plot.scatter(x = 'CouncilDistrict', y = 'pct_change', figsize = (14,6), ax = ax, s=75)\nax.set_xticks(list(range(1,36)))\nax.set_ylim(0,140)\nplt.grid(axis = 'both', linestyle = '--', alpha = 0.5, lw = 2)\n\nplt.title('Percent Change in Median Appraisal Value, 2013 - 2017', fontweight = 'bold', fontsize = 14)\nplt.xlabel('Council District', fontsize = 14)\nplt.ylabel('Percent Change (%)', fontsize = 14)\nplt.xticks(fontsize = 12, fontweight = 'bold')\nplt.yticks(fontsize = 14);","4c93e523":"fig, ax = plt.subplots()\nmedian_appr.plot.scatter(x = 'CouncilDistrict', y = 'pct_change', figsize = (14,6), ax = ax, s=75)\nax.set_xticks(list(range(1,36)))\nax.set_ylim(0,140)\nplt.grid(axis = 'both', linestyle = '--', alpha = 0.5, lw = 2)\nplt.axhline(y=overall_pct_change, color='r', lw = 1)\n\n\nplt.title('Percent Change in Median Appraisal Value, 2013 - 2017', fontweight = 'bold', fontsize = 14)\nplt.xlabel('Council District', fontsize = 14)\nplt.ylabel('Percent Change (%)', fontsize = 14)\nplt.xticks(fontsize = 12, fontweight = 'bold')\nplt.yticks(fontsize = 14);","a85c02bc":"from matplotlib import collections  as mc","5dfc8dca":"for x in zip([1,2,3], ['a', 'b', 'c']):\n    print(x)","5d08a755":"lines = [[(x,y),(x,overall_pct_change)] for x,y in zip(range(1,36), median_appr['pct_change'])]\n\nfig, ax = plt.subplots()\nmedian_appr.plot.scatter(x = 'CouncilDistrict', y = 'pct_change', figsize = (14,6), ax = ax, s=75)\nax.set_xticks(list(range(1,36)))\nax.set_ylim(0,140)\nplt.grid(axis = 'both', linestyle = '--', alpha = 0.5, lw = 2)\nplt.axhline(y=overall_pct_change, color='r', lw = 1)\nlc = mc.LineCollection(lines, linewidths=2)\nax.add_collection(lc)\n\nplt.title('Percent Change in Median Appraisal Value, 2013 - 2017', fontweight = 'bold', fontsize = 14)\nplt.xlabel('Council District', fontsize = 14)\nplt.ylabel('Percent Change (%)', fontsize = 14)\nplt.xticks(fontsize = 12, fontweight = 'bold')\nplt.yticks(fontsize = 14);","c82b9620":"lines = [[(x,y),(x,overall_pct_change)] for x,y in zip(range(1,36), median_appr['pct_change'])]\n\nfig, ax = plt.subplots()\nmedian_appr.plot.scatter(x = 'CouncilDistrict', y = 'pct_change', figsize = (14,6), ax = ax, s=75)\nax.set_xticks(list(range(1,36)))\nax.set_ylim(0,140)\nplt.grid(axis = 'both', linestyle = '--', alpha = 0.5, lw = 2)\nplt.axhline(y=overall_pct_change, color='r', lw = 1)\nlc = mc.LineCollection(lines, linewidths=2)\nax.add_collection(lc)\n\nplt.title('Percent Change in Median Appraisal Value, 2013 - 2017', fontweight = 'bold', fontsize = 14)\nplt.xlabel('Council District', fontsize = 14)\nplt.ylabel('Percent Change (%)', fontsize = 14)\nplt.xticks(fontsize = 12, fontweight = 'bold')\nplt.yticks(fontsize = 14)\n\nax.annotate(\"Percent Change for\\nDavidson County\\n(\" + \"{:.1f}\".format(overall_pct_change)+ \"%)\", xy=(36, overall_pct_change), \n            xytext=(33, 90), fontsize = 12, ha = 'center', va = 'center', color = 'red', fontweight = \"bold\",\n            arrowprops=dict(arrowstyle=\"->\", lw = 2))\nax.annotate(\"District 5\\n(\" + \"{:.1f}\".format(median_appr['pct_change'].max())+ \"%)\", xy=(5.5, median_appr['pct_change'].max()-1), \n            xytext=(9, 120), fontsize = 12, ha = 'center', va = 'center', color = 'red', fontweight = \"bold\",\n            arrowprops=dict(arrowstyle=\"->\", lw = 2));","ae7d200b":"#Your Code Here","f15b1bc4":"%load ..\/input\/exercisesolutions\/soln_409.py","dfca146d":"import seaborn as sns","86ee8048":"fig = plt.figure(figsize = (10,6))\nsns.boxplot(data = houses_2017.loc[houses_2017.CouncilDistrict.isin([1,2,3,4])], \n            x = 'CouncilDistrict', \n            y = 'TOTALAPPR')\nplt.title('Home Appriasal Values, 2017')\nplt.ylim(0, 1000000);","cb91d652":"fig = plt.figure(figsize = (10,6))\nsns.violinplot(data = houses_2017.loc[houses_2017.CouncilDistrict.isin([1,2,3,4])], x = 'CouncilDistrict', \n               y = 'TOTALAPPR')\nplt.title('Home Appraisal Values, 2017')\nplt.ylim(0, 1000000);","23cca646":"fig = plt.figure(figsize = (10,6))\nsns.boxplot(data = houses, x = 'year', y = 'TOTALAPPR')\nplt.title('Home Appraisal Values')\nplt.ylim(0, 1000000);","ed66964d":"fig = plt.figure(figsize = (10,6))\nsns.violinplot(data = houses, x = 'year', y = 'TOTALAPPR')\nplt.title('Home Appraisal Values')\nplt.ylim(0, 1000000);","c27dccbb":"np.percentile(houses.loc[houses.CouncilDistrict == 34, 'TOTALAPPR'], 90)","3f2876e0":"@interact(district = range(1,36), plot_type = ['box', 'violin'])\ndef plot_dist(district, plot_type):\n    fig = plt.figure(figsize = (10,6))\n    if plot_type == 'box':\n        sns.boxplot(data = houses.loc[houses.CouncilDistrict == district], x = 'year', y = 'TOTALAPPR')\n    if plot_type == 'violin':\n        sns.violinplot(data = houses.loc[houses.CouncilDistrict == district], x = 'year', y = 'TOTALAPPR')\n    ymax = np.percentile(houses.loc[(houses.CouncilDistrict == district) & (houses.year == 2017), 'TOTALAPPR'], 99.9)\n    plt.ylim(0, ymax)\n    plt.title('Total Appraised Value, District ' + str(district));","a2f4e568":"cd = council_districts[['district', 'geometry']]","4f3b47bb":"import warnings\nwarnings.filterwarnings('ignore')","fd054042":"@interact(district = range(1,36), plot_type = ['box', 'violin'])\ndef plot_dist(district, plot_type):\n    fig = plt.figure(figsize = (10,6))\n    if plot_type == 'box':\n        sns.boxplot(data = houses.loc[houses.CouncilDistrict == district], x = 'year', y = 'TOTALAPPR')\n    if plot_type == 'violin':\n        sns.violinplot(data = houses.loc[houses.CouncilDistrict == district], x = 'year', y = 'TOTALAPPR')\n    ymax = np.percentile(houses.loc[(houses.CouncilDistrict == district) & (houses.year == 2017), 'TOTALAPPR'], 99.9)\n    plt.ylim(0, ymax)\n    plt.title('Total Appraised Value, District ' + str(district))\n    \n    cd['chosen_district'] = 0\n    cd.loc[cd.district == district, 'chosen_district'] = 1\n    \n    mini_map = plt.axes([.85, .3, .4, .4]) #[left, bottom, width, height]\n    cd.plot(column = 'chosen_district', ax = mini_map, legend = False, edgecolor = 'black', cmap = 'binary')\n    plt.axis('off')\n    plt.title('District ' + str(district));","c4f15023":"df = houses.loc[houses.CouncilDistrict == 20]\n\ntarget_0 = df.loc[df.year == 2009]\ntarget_1 = df.loc[df.year == 2013]\ntarget_2 = df.loc[df.year == 2017]\n\nsns.distplot(target_0[['TOTALAPPR']], hist=False, label = '2009')\nsns.distplot(target_1[['TOTALAPPR']], hist=False, label = '2013')\ng = sns.distplot(target_2[['TOTALAPPR']], hist=False, label = '2017')\n\ng.set(xlim=(0, 500000));","11d0b6ae":"df = houses.loc[houses.CouncilDistrict == 20]\n\ntarget_0 = df.loc[df.year == 2009]\ntarget_1 = df.loc[df.year == 2013]\ntarget_2 = df.loc[df.year == 2017]\n\nsns.distplot(target_0[['TOTALAPPR']], hist=True, label = '2009')\nsns.distplot(target_1[['TOTALAPPR']], hist=True, label = '2013')\ng = sns.distplot(target_2[['TOTALAPPR']], hist=True, label = '2017')\n\ng.set(xlim=(0, 500000));","94a7b1c6":"@interact(district = range(1,36))\ndef make_dist_plot(district):\n    plt.figure(figsize = (10,6))\n    \n    df = houses.loc[houses.CouncilDistrict == district]\n\n    target_0 = df.loc[df.year == 2009]\n    target_1 = df.loc[df.year == 2013]\n    target_2 = df.loc[df.year == 2017]\n\n    sns.distplot(target_0[['TOTALAPPR']], hist=False, label = '2009', kde_kws={'lw': 2.5})\n    sns.distplot(target_1[['TOTALAPPR']], hist=False, label = '2013', kde_kws={'lw': 2.5})\n    g = sns.distplot(target_2[['TOTALAPPR']], hist=False, label = '2017', kde_kws={'lw': 2.5}, color = 'purple')\n\n    xmax = np.percentile(houses.loc[(houses.CouncilDistrict == district) & (houses.year == 2017), 'TOTALAPPR'], 95)\n\n    g.set(xlim=(0, xmax))\n    g.set(yticks = [])\n    g.set(title=\"Distribution of Appraisal Values, District \" + str(district));","877c7a4d":"import plotly.express as px","8f52b4ed":"chess_players","24b8600a":"melted_chess = chess_players.reset_index().melt(id_vars=['player'], var_name = 'outcome')\nmelted_chess","4ad614af":"fig = px.bar(melted_chess, x='player', y='value', color = 'outcome', \n             width = 800, height = 500,\n            category_orders = {'outcome' : ['wins', 'losses', 'draws']})\nfig.update_layout(title_text = 'Top Rated Chess Players', title_font_size = 24)\nfig.update_yaxes(title_text = 'Number of Games', title_font_size = 20, tickfont_size = 14,)\nfig.update_xaxes(title_text = '', tickfont_size = 18)\nfig.update_layout(legend_traceorder = 'reversed')\nfig.show()","8da9fa74":"category_count.head()","ab836d14":"category_count.year = category_count.year.astype('category')","e0ef76c7":"@interact(district = range(1, 36))\ndef make_plot(district):\n    df = houses.loc[houses.CouncilDistrict == district].groupby(['category', 'year']).APN.count().reset_index().rename(columns = {'APN' : 'count'})\n    #df.year = df.year.astype('category')\n    fig = px.bar(df, x='year', y='count', color = 'category', width = 800, height = 500,\n                category_orders = {'category' : ['AFF_1', 'AFF_2', 'WF_1', 'WF_2', 'AWF']})\n    fig.update_yaxes(title_text = 'Number of Homes', title_font_size = 18)\n    fig.update_xaxes(title_text = '', tick0=2009, dtick=4, tickfont_size = 18)\n    fig.update_layout(title_text = 'Affordable Housing Profile, District ' + str(district), title_font_size = 20)\n    fig.update_layout(legend_traceorder = 'reversed')\n    fig.show()","d1b8029b":"district_counts = houses.groupby(['year', 'CouncilDistrict', 'category']).APN.count().reset_index().rename(columns = {'APN' : 'num_homes'})\ndistrict_counts = district_counts.loc[district_counts.CouncilDistrict.isin(list(range(1,36)))]","9755485b":"@interact(year = [2009, 2013, 2017])\ndef make_plot(year):\n    df = district_counts.loc[district_counts.year == year]\n    fig = px.bar(df, x='CouncilDistrict', y='num_homes', color = 'category', width = 900, height = 500,\n                category_orders = {'category' : ['AFF_1', 'AFF_2', 'WF_1', 'WF_2', 'AWF']})\n    fig.update_yaxes(title_text = 'Number of Homes', title_font_size = 18, range = [0,8300])\n    fig.update_xaxes(title_text = 'District', tick0=1, dtick=1, tickfont_size = 14, tickangle = 0)\n    fig.update_layout(title_text = 'Davidson County Affordable Housing Profile by District, ' + str(year), title_font_size = 20)\n    fig.update_layout(legend_traceorder = 'reversed')\n    fig.show()","5f47c9ee":"@interact(district = range(1,36))\ndef make_plotly(district):\n    df = houses.loc[houses.CouncilDistrict == district]\n    ymax = np.percentile(df.TOTALAPPR, 99.9)\n    \n    fig = px.box(df, x=\"year\", y=\"TOTALAPPR\", width = 800, height = 500)\n    fig.update_yaxes(range=[0,ymax], title_text = 'Appraised Value', title_font_size = 18)\n    fig.update_xaxes(title_text = '', tickfont_size = 18)\n    fig.update_layout(title_text = 'Appraised Values, District ' + str(district), title_font_size = 20)\n\n    fig.show()","e34e44dc":"@interact(district = range(1,36))\ndef make_plotly(district):\n    df = houses.loc[houses.CouncilDistrict == district]\n    ymax = np.percentile(df.TOTALAPPR, 99.9)\n    \n    fig = px.violin(df, x=\"year\", y=\"TOTALAPPR\", width = 800, height = 500, box = True)\n    fig.update_yaxes(range=[0,ymax], title_text = 'Appraised Value', title_font_size = 18)\n    fig.update_xaxes(title_text = '', tickfont_size = 18)\n    fig.update_layout(title_text = 'Appraised Values, District ' + str(district), title_font_size = 20)\n\n    fig.show()","ce27e0dd":"**Exercise:** Create a chart similar to the one above showing median appraisal value per square foot of finished area.","53cfe766":"Notice how the column labels look different now. That is because when doing multiple aggregations the resulting DataFrame will now have a _MultiIndex_. It is also possible to have a row MultiIndex.","89a933d0":"**Exercise:** Create a bar chart showing the number of single-family homes by zip code for 2009.","94915262":"We need to load in a shape file that includes the boundaries for the council districts. We will be using a geojson file obtained from https:\/\/data.nashville.gov\/General-Government\/Council-District-Outlines-GIS-\/m4q4-q7tc","9f4b572e":"Notice that our column index consists of integers.","e253d5e7":"Next, let's add line segments from each point to the median value to emphasize the difference from the overall value. To do this, we need to use the matplotlib `collections` module.","813de530":"If we want to see the different entries for a column, we can use the `.unique()` method:","b174d6fc":"**Exercise:** Create a function named `generate_map` which takes as input a year and produces a plot of number of homes per district for that year.","ddc386ed":"**Exercise:** the ACS.csv file contains the number of households and the median household income by council district, obtained from the US Census Bureau's American Community Survey. Create a side-by-side bar plot comparing median income by district to median home price in 2017.","37d1476c":"To create our first DataFrame, we need to point pandas to the csv file we want to import and use the `read_csv` method:","fc6755b8":"**Goal:** Create a stacked bar chart showing the number of homes by category with year on the horizontal axis.\n\n**What we need:** a DataFrame with 3 rows (years) and 5 columns (categories).\n\n**Exercise:** By pivoting the `category_count` DataFrame, create one called `pivot_df_stack` which meets the above requirements. ","da80fa4f":"This colormap is not necessarily the best. We can specify a different one using the cmap argument. \n\nSee https:\/\/matplotlib.org\/tutorials\/colors\/colormaps.html to see the colormap options. \n\nIf you don't like any of those, it is also possible to create you own (but it takes some work to do so).","d3e5aeb1":"We can also create interactive widgets for functions with more than one argument:","57b6a960":"Link to more detailed map: http:\/\/maps.nashville.gov\/webimages\/MapGallery\/PDFMaps\/2018%20Council%20Members.pdf","c6cf02e7":"Plotly express requires our data to be \"tidy\". This means only one \"observation\" per row. Currently, our `chess_players` DataFrame is not tidy, because we should have only one type of observation per row. To tidy it, we can use the `.melt()` method.","e69baf6a":"We can also iterate through all of the rows using a `for` loop:","8977d6b2":"Seaborn is a visualization library built on top of matplotlib.","9ebd4d14":"What if we want to dynamically change the maximum value based on the district? We can use the numpy library to help us. Specifically, the numpy `percentile` function can be used to set a maximum value.\n\nFor example, to find the appraisal value for which 90% of homes are appraised below, use `np.percentile` and specify 90 as the percentile we wish to find.","c752221e":"What if we want to see how this changes over time?","ae82fa8d":"This is pretty good, but notice how the colorscale changes across years. To make it easier to compare, it would be useful to have a fixed colorscale. To accomplish this, we can add the vmin and vmax arguments. Also, we need to redefine our choose_color function to accomodate the expanded colorscale.","3d7001cd":"Let's explore a couple of types of plots we can use to display our findings. First, let's look at a side-by-side bar chart. Here is an example DataFrame to demonstrate the pieces we need.","bd3a7276":"# Affordable Housing in Nashville\/Davidson County","88b87c7e":"Now we can narrow our interstates GeoDataFrame down to just those that intersect the council districts, using a spatial join. We'll keep only those highway segments that intersect the council districts.","75e1a25f":"**Harder Exercise:** How many homes in our 2009 dataset have house number 0?  \nHint: To use string methods on columns of DataFrames which are strings, access that column and then use .str. For example, try `houses_2009.AddressCity.str.lower()`","45e862a4":"    After the merge, `council_districts` remains a GeoDataFrame.","36edac61":"We can find the districts which had the largest and smallest change in housing supply by using the `sort_values()` method.","aa5d860f":"We can plot the council districts by calling `.plot()` on the GeoDataFrame.","89ef98a3":"We don't just have to return values - we can also create plots:","3ea1d20a":"# Bonus Material","d55016ef":"Let's adjust the column names. It is a lot easier to work with columns that do not have spaces or start with a number. This will make using tab-completion easier, and will allow us to access a particular column using `houses_2009.<column_name>`.","dd2a3acc":"Need: A DataFrame with 5 rows (categories) and 3 columns (years).\n\n**Exercise:** Group the `houses` DataFrame by category and by year and then count the number of homes per group. Save the result as a DataFrame called `category_count`.","ccc0a3d3":"## Adding Interstates","4cb7ca73":"## `groupby` to Aggregate by Category\n\npandas makes it easy to calculate statistics by category. First, we need to specify the column or columns we want to group by and then we specify how we cant to calculate our summary statistics.","9e837edd":"To access entries, we can pass tuples.","99115ec2":"The plots we create are highly customizable. For a (partial) list of stylistic options, see https:\/\/pandas.pydata.org\/pandas-docs\/version\/0.22\/generated\/pandas.DataFrame.plot.html.","c41db3f7":"Seaborn also provides distplots, which can do histograms or kernel density estimates, which are essentially smoothed histograms.","bc9bb09a":"We can also put two histograms on the same plot in order to compare two distributions. Let's say we want to compare the distribution of appraisal values from 2009 to 2017.","939e2e32":"We can see that 75% of homes are appraised at \\$220,000 or less.","d65c0103":"We can merge the counts with our council districts DataFrame. To make this easier, we can rename the columns so that the columns containing the district numbers match.","f6db906d":"What do we need to pull this off? A dataframe, indexed by the category with a column per year containing the count for that year.","94b6e5d1":"We also need to factor in property taxes, which are determined by a houses's district code. The rates can be found at http:\/\/www.padctn.org\/services\/tax-rates-and-calculator\/. These rates are applied to the houses's assessed value, which is contained in the `TOTALASSD` column.\n","ffa097a1":"Having a function to generate the map is great, but what if we didn't want to change the input parameter and rerun the cell each time we want to view a different year. Also, wouldn't it be nice to only be able to choose years for which we have data? We can accomplish this by using the `ipywidgets` library to create interactive plots.","0c0188c9":"To make it more readable, let's create another helper function that will adjust the color of the district label based on its background.\n\n**Exercise:** Write a function called `choose_color` which returns 'black' if its input is less than 5000 and returns 'white' otherwise. Then adjust the above code to use your function to set the label colors.","b458d114":"When we call .plot() on a GeoDataFrame, we can create a choropleth by specifying `column = <column_name>`. Here, we will color by number of homes.","a71e9268":"The `.plot` method orders the bars in the order they apper in the given DataFrame. If we want to change the order, say in order by district number, we can reorder the rows of our DataFrame by using `.loc`.","717eca85":"**Exercise:** Create an interactive plot showing absolute and relative change in the number of single-family homes by district.","9bca6db3":"Oops! We get an error. It seems that some of the values in the DistrictCode have some extra white space. The string method `.strip()` removes any white space at the beginning or end of a sting. We can apply this to our DistrictCode column to correct the problem.","b3394878":"Then, use `.loc`.","97e39a27":"Let's narrow down the dataset we use in order to get a more informative histogram. Notice too that we can adjust the number of bins to further improve the histogram.","e527892d":"## Changes by District\n\nLet's look at how much appraisal values increased from 2013 to 2017. First, let's calculate the percent change in median house value overall.","db6cb15f":"Side-by-side bar charts are one option. An different way to display this data is to use a stacked bar chart.","8385ab9b":"Just using the `.value_counts()` method returns a pandas Series. We can turn in into a DataFrame by using `.reset_index()` on it.","e19ea61f":"**Exercise:** Read in the 2013 and 2017 files and change the column names in the same way as for the 2009 file.","4ee7ef11":"We can now view the first few rows using the `.head()` method. We can also inspect the last few rows using `.tail()`.","0ab61d44":"`plotly` is another visualization library which allows for more dynamic, interactive graphics. The `plotly express` module makes it easy to work with pandas dataframes to quickly produce dynamic, interactive plots.","df8282aa":"The pandas library will be our Swiss Army knife for data analysis. We will be using pandas DataFrames, which are useful for manipulating tabular, nonhomogenous data.\n\nFirst, import the pandas library with the alias pd:","a9cffa83":"**Exercise:** Use `.iterrows()` along with `plt.annotate` to add district makers to our plot.","c87701cb":"It is not clear what is going on with these duplicated addresses, but we need to decide what to do with our duplicate addresses. One option is to drop all duplicates, which can be accomplished using the `.drop_dupliates()` method and specifying that we want to drop based on the `AddressFullAddress` column.\n\n**Warning:** For the most part, pandas methods don't have side effects, meaning that they won't affect the original DataFrame when we use them. Thus, when we use a method and want the changes to persist, we must save the result back to the DataFrame.","a8bb4250":"First, we should combine our three DataFrames into one, using the pandas `concat` function. Start by adding a column to each DataFrame to record the year.","ecac0bec":"We can also apply multiple aggregate functions by using the `.agg` method after applying `.groupby`.","16b7d02b":"To adjust the size of our plot, we can call `plt.subplots()` and specify the figsize. The matplotlib `subplots` function creates a matplotlib figure and axis. We need to specify that we want to create our plot on the axis that we created.","aef8787a":"Just a few more adjustments. We can add a title using `plt.title`. Within this function, we can also specify the font size and make the text bold.  \n\nSecond, since they are not really all that informative in this case, we might as well remove the axes by using `plt.axis('off')`.","73d3c67d":"Now we can pivot this DataFrame to make the years into columns.","37d33066":"We get some extreme square footages - let's investigate.","c1a9996b":"Seaborn gives us options to compare home appraisal values across districts or across years. For example, we can use a box plot.","433d68d8":"We can also aggregate multiple columns by passing a _dictionary_ to `.agg()`.\n\nA python dictionary consists of key-value pairs. We can create a dictionary by enclosing the key-value pairs in squiggly brackets { }.\n\nTo aggregate on multiple columns, we pass a dictionary whose keys are the columns we wish to aggregate and whose values are the aggregation functions we want to use.","e9f070f5":"To concatenate, we pass a list containing the DataFrames we want to combine to the function `pd.concat()`. The default (which is what we need) is to stack the DataFrames vertically, but we can also combine them horizontally by specifying `axis = 1`. ","0c1b5ab8":"**Exercise:** Create a bar chart showing the number of single-family homes by affordability category for 2009, 2013, and 2017.","45784894":"So far, we have seen geometric objects in the form of (multi)polygons and points, but there are also lines.  \n\nWe can make our map a little easier to read by adding interstates. We will be using a shapefile of major roads obtained from https:\/\/catalog.data.gov\/dataset\/tiger-line-shapefile-2016-nation-u-s-primary-roads-national-shapefile\/resource\/94e763bb-78a9-48bb-8759-2c5c98508636.","2c0026dd":"We also need to factor in insurance cost. We'll use \\$60\/month, or \\$720\/year as our estimate for homeowner's insurance.","bce08d9e":"How many addresses are duplicated? To answer this, we can use an inequality to return a Boolean series:","e09ce116":"**Exercise:** Use `value_counts()` to get a tally of homes by their full address for 2009.","e37cebd4":"Now, let's look by council district.\n\n**Exercise:** Create a DataFrame `median_appr` which contains the median appraisal value by district and by year.","33973a94":"### Part 4: Adding Interactivity with ipywidgets","eeece6ef":"Area Median Income for Davidson County: \n\n    2009: $64,900  \n    \n    2013: $62,300  \n    \n    2017: $68,000  ","aca31051":"**Harder Exercise:** Show only homes with appraisal values less than $1,000,000.\nHint: To slice a DataFrame with `.loc` using multiple boolean series, separate the series with & for AND or | for OR. For example, to find all homes in Antioch that are at least 4,000 square feet, you can use `houses_2009.loc[(houses_2009.AddressCity == \"ANTIOCH\") & (houses_2009.FinishedArea >= 4000)]`","d4cf2a1e":"Now, we can combine this with our previous plot.","0642a9e2":"To see how each district compares to the county overall, we can add a horizontal line by using matplotlib's `axhline` function.","f9e60957":"Notice how the two GeoDataFrames we are using have different coordinate reference systems. We need to fix this by converting using the `to_crs()` method.","2754afee":"Now we can use the pandas merge function. We need to specify the two DataFrames we with to merge using the `left` and `right` arguments. If we don't tell it otherwise, it will attempt to merge on all columns that appear in both dataframes (in our case, the `district` column).","076f6e54":"**Exercise:** Use `.loc` to determine how many times O EDMONDSON PIKE appears in the 2013 and 2017 datasets.","d7a9784b":"What if we want to label these districts? To do this, we'll need coordinates for the center of each district. The shapely library provides a `representative_point()` method which will, given a (multi)polygon, return a point within that polygon. We can use this method on the geometry column of our DataFrame and save the result as a new column.","0af3027c":"Let's create a map of these districts so we can get a better idea of where the supply of single-family homes is located.  \n\nWe will be using the geopandas library, which provides tools for working with geospatial data.","43f58efc":"**Exercise:** Make the generate_map function interactive, allowing the user to select the year they want to plot.","f59cb7b4":"GeoDataFrames come equipped with a coordinate reference system, or crs. These have to do with the particular projection used to create the geometries.","3eb5141e":"Another option is to use a violin plot, which includes a density estimation.","74b7fb03":"**Exercise:** Create a boolean array that indicates whether the address in a particular row is equal to 0 Edmondson Pike. Then use this to slice the `houses_2009` DataFrame.","cbe4e494":"**Exercise:** Create a histograms showing distributions of appraisal values for homes in Madison and for homes in Brentwood in 2009. Plot both on the same figure.","063537a9":"Where are the 5 most expensive houses? To answer this, we can use the `.nlargest()` method.","3aa0f397":"The method `.info()` gives us more information about each column.","978c0c82":"Now, we need to add a label onto our map for each row in the dataset.\n\nOne way to access the rows in a dataframe one at a time is by using the `.iterrows()`, method, which produces a generator object. This is an object that we can iterate through. We can call `next()` on a generator object in order to iterate through its contents.","ed61b859":"To get `melted_chess` back to the correct form, we can use the `.pivot()` method. To use this method, we have to specify which column will become our index, which column we want to split into our new columns, and which column will be used to assign values.","9605a5c8":"Python lets us do arithmetic with Booleans. True = 1 and False = 0:","97e435b8":"Let's investigate the most common address, 0 Edmondson Pike. \n\nOne way to filter a pandas DataFrame is to slice it using `.loc`. The syntax will look like `houses_2009.loc[<boolean array>]` where the boolean array has the same length as our DataFrame. This will result in a DataFrame containing the rows corresponding to the Trues from the array.\n\nFor example, let's find all homes in Brentwood. Start by creating a boolean array.","f120824e":"We can reorder our DataFrame using `.loc`:","a8434ec2":"With two histograms, we should set the alpha values lower to increase the transparency. It is also probably a good idea to normalize our histograms so they they are showing densities rather than counts.","186b6472":"**Exercise:** Create a plot showing the median appraisal value by district for 2009.","53fdd349":"In order to determine a good cutoff, we can use the `.describe()` method which gives summary statistics on our DataFrame.","ac26e373":"Notice how it returns a count for each column. We can instead choose a single column.","e03746a3":"### Part 8: Plotly","59f68b64":"Now, let's look at the column names:","ec86b35b":"Now that we have an estimated yearly cost, we can put each house into a category. We'll use 5 categories:\n * __AFF_1:__ not cost-burdening to those making 30% of AMI\n * __AFF_2:__ not cost-burdening to those making 60% of AMI\n * __WF_1:__ not cost-burdening to those making 90% of AMI\n * __WF_2:__ not cost-burdening to those making 120% of AMI\n * __AWF:__ Requires more than 120% of AMI","db53858b":"**Exercise:** Use `.loc` to find the appraised value and the finished area of the house in row 50000.","b2d57b46":"**Exercise:** Create an interactive plot allowing the user to see the affordable housing profile for a chosen district.","88e665cb":"**Exercise:** Use `.pivot` to get `category_count` into the right form to create a bar plot. Save the result back to `pivot_df`.","889c5696":"### Part 2: Slicing, Counting, and Basic Plots","85659c60":"To make this chart easier to read, we can add annotations to each block.\n\nTo do this, we need to calculate the cumulative sum (height) for each chess player. The numpy method `.cumsum` does this for us.","723dad70":"**Exercise:** Determine the number of homes in the `houses_2009` DataFrame that have finished area of at least 15,000 sqft. Which district contains the most number of these homes?","9931d5cc":"Some of these labels are in a less than ideal location. Look at, for example, District 11 on the northeast part of town.  \nTo correct these, we can write a helper function to nudge those points into a slightly better location.","1d0957ec":"## Analyzing changes in single-family housing supply","cfa1540f":"Finally, let's add some annotations to let the reader know that the horizontal line corresponds to the overall percent change and the emphasize the largest value. If we use the `arrowstyle` argument to the `annotate` function, then we can add arrows to our plot along with text.","6d65e1eb":"We can access a column by using `houses_2009[\"<column name>\"]`.","185f5ef7":"### Part 7: Seaborn","618859cd":"We can add a legend explaining the meaning of the colors by specifying `legend = True`.","76cec770":"We can also get a MultiIndex by grouping by multiple columns:","c0118711":"If we have two metrics we want to compare on the same plot, we can use the `twinx()` method to have two different vertical scales.","d6f88a26":"This is close to what we need except that here all of the years are contained in one column; whereas, we need to have one column per year.\n\nTo show how we can accomplish this, let's first get our chess players DataFrame in the same format as our category_count DataFrame.","ede1b788":"A few more words on `.loc`. We can slice our DataFrame using `.loc` and a boolean series, as before, but we can also use `.loc` to slice by passing which index values we want (row, column, or both). This looks like `df.loc[<rows>,<columns>]`","f23ac131":"Let's classify these according to whether they are affordable to someone making 30%, 60%, 90%, or 120% of AMI. We will need to estimate the total yearly cost of each house. We can make this estimate based on its appraised value.","fe120547":"## Part 1: Data Wrangling Basics with pandas","b67797dc":"Our plot would be a lot more useful if we knew which district corresponded to each point. \n\nTo add our labels, we can use the matplotlib `annotate` function. We need to specify the text that we want (using the `s` parameter) and where we want to place the text (using the `xy` parameter).","02388188":"If we want to display the distribution of a variable, we can use a histogram. For example, let's say we want to look at the distribution of square footages.","7cf1fe12":"We end up with an oddly-sized colormap. To modify it, we can use a couple of helper tools; namely, `make_axes_locatable` and `cm`.","aceff5b9":"If we just care about how many unique elements there are, we can use `.nunique()` instead.","c792b202":"When we call `next` we get a tuple which gives the index of the row and its values. We can unpack this tuple to extract what we want:","c844db90":"HUD declares a household to be **cost-burdened** if they are spending more than 30% of their income on housing costs.\n\n**Affordable Housing:** Won't cost-burden households making less than 60% of AMI.\n    \n**Workforce Housing:** Won't cost-burden households making between 60% and 120% of AMI.","54076c2b":"Oops - we get an error. Pandas won't let us merge columns with different types. We can change the data type of the district column using the `astype` method. This will then allow us to merge the two dataframes.","a7e1661f":"### `interact` as a decorator:\n\nWe will use `interact` as a **decorator**, which means that we will add it above our function definition with the @ symbol. That is, we need to add `@interact()` the line above `def`. Inside of `interact`, we need to specify the arguments to our function and what values they can take. `interact` is usually pretty good at figuring out a good default range, but you can also completely specify by using widgets.\n\nFor example, let's create an interactive widget using the squaring function. First, we need to define our function:","0655d10c":"Now, we need to combine this data frame with the number of homes per district.","bf60f06d":"### Part 3: Introduction to GeoPandas","04f1e692":"Time for some plots! Let's look at the number of single family homes assessed in each district. \n\nPlotting can be done using pandas DataFrame methods. Behind the scenes, this is done using the matplotlib library. In order to get our plots to display in our notebook, we can use the ipython magic command `%matplotlib inline`.","75b0fe6c":"**Exercise:** Create a choropleth showing the average square footage per district in 2009.  ","02fd5c45":"Notice how the segment of I-40 extends further east than we need. We can fix this by specifying the x and y limits. The matplotlib functions `.xlim` and `.ylim` will either return the current values for the x and y range or can be used to specify new limits. Here, we will use them twice: once to get the limits before we plot the interstates and then again to reset the limits after plotting them.","63c5854c":"Let's start with a basic plot showing the percent change per district.","bd77403b":"We will be creating a `LineCollection` object for our line segments. We need to pass this a list of lists, one for each segment containing the coordinates for the start and endpoints of the segment. We can do this using a list comprehension and by zipping a list.\n\n`zip` takes two iterables (eg. lists) and returns an iterable containg tuples (a,b), where a comes from teh first iterable and b comes from the second.","7c09f47f":"**Exercise:** Create two new columns in the council_districts DataFrame, calculating the absolute and relative change in number of single-family homes from 2009 to 2017. Call these columns `absolute_change` and `relative_change`.","600f9dbb":"### Part 6: Appraisal Values","f5800e96":"We can check the dimensions of our DataFrame using `.shape`. This returns a tuple (number of rows, number of columns).","cda34786":"Now, let's try to see what the supply of affordable housing looks like. To do this, we will adopt HUD's definitions of \"affordable\" and \"workforce\" housing, which is based on the Area Median Income. See https:\/\/www.hud.gov\/program_offices\/comm_planning\/affordablehousing\/ ","89877b05":"A bar plot is not necessarily the best way to display this data. Perhaps a scatter plot might be easier to read.","44d3b5d3":"The `.value_counts()` method will give a tally of the entries in a particular column, sorted in descending order by default. For example, let's say we want to get a tally of homes by city.","cb0c7ee6":"**Exercise:** Create a stacked bar chart showing the number of homes by category with year on the x-axis, including annotations."}}