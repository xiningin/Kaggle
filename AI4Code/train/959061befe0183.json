{"cell_type":{"b83dbfad":"code","1c0b6847":"code","bb3a0370":"code","6f5152bf":"code","d562e01c":"code","a68b99fd":"code","8ce824a8":"code","f224e58c":"code","617d02ce":"code","39560e60":"code","7c14389e":"markdown","569d30e7":"markdown","73eaf219":"markdown","9ef34546":"markdown","fbd47981":"markdown","2085957c":"markdown","f04cedcf":"markdown","1b55350a":"markdown","ec7bb314":"markdown","f7b7d9d4":"markdown","3da10600":"markdown","027adaeb":"markdown","bac31403":"markdown","e82e7448":"markdown"},"source":{"b83dbfad":"import numpy as np\nimport pandas as pd\nimport geopandas as gpd\nimport matplotlib.animation as animation\nimport matplotlib.pyplot as plt\nfrom IPython.display import HTML\nfrom datetime import datetime\nimport PIL\nimport io\n\nimport warnings\nwarnings.filterwarnings('ignore')\n\nworld=gpd.read_file('..\/input\/shpfile\/World_Map.shp')\nconfirmed=pd.read_csv('..\/input\/novel-corona-virus-2019-dataset\/time_series_covid_19_confirmed.csv')\nrecovered=pd.read_csv('..\/input\/novel-corona-virus-2019-dataset\/time_series_covid_19_recovered.csv')\ndeath=pd.read_csv('..\/input\/novel-corona-virus-2019-dataset\/time_series_covid_19_deaths.csv')","1c0b6847":"confirmed=confirmed.groupby('Country\/Region').sum()\nconfirmed.drop(['Lat','Long'], axis=1, inplace=True)\nconfirmed_stack=(confirmed.stack()).reset_index().rename(columns={\"level_1\": 'Date','Country\/Region':'Country',0:'Confirmed'})\n\nrecovered=recovered.groupby('Country\/Region').sum()\nrecovered.drop(['Lat','Long'], axis=1, inplace=True)\nrecovered_stack=(recovered.stack()).reset_index().rename(columns={\"level_1\": 'Date','Country\/Region':'Country',0:'Recovered'})\n\ndeath=death.groupby('Country\/Region').sum()\ndeath.drop(['Lat','Long'], axis=1, inplace=True)\ndeath_stack=(death.stack()).reset_index().rename(columns={\"level_1\": 'Date','Country\/Region':'Country',0:'Death'})\n\nactive=confirmed_stack.merge(recovered_stack, on=['Date','Country'], how='left')\nactive=active.merge(death_stack, on=['Date','Country'], how='left')\nactive['Active Cases']=active['Confirmed']-active['Recovered']-active['Death']\n\nactive_cases=active[['Date','Country','Active Cases']]\nactive_cases=active_cases.pivot_table(index='Country', columns='Date')\nactive_cases.columns=active_cases.columns.droplevel(0)\nactive_cases=active_cases.rename_axis(None, axis=1).reset_index().set_index('Country')\nactive_cases.head()","bb3a0370":"for index, row in active_cases.iterrows():\n    if index not in world['NAME'].to_list():\n        print(index + ': is not in list')\n    else:\n        pass","6f5152bf":"world.replace('United States','US', inplace=True)\nworld.replace('South Korea','Korea, South', inplace=True)\nworld.replace('Iran (Islamic Republic of)','Iran', inplace=True)\nworld.replace('Taiwan','Taiwan*', inplace=True)\nworld.replace('Viet Nam','Vietnam*', inplace=True)\n\nmerge=world.join(active_cases, on='NAME', how='left')\nmerge.head()","d562e01c":"plt.rcParams.update({'figure.max_open_warning': 0}) #supresses the number of images opened warning during runtime\n\ndates_list=merge.columns.to_list()[2:]\ndates_list.sort(key=lambda date: datetime.strptime(date, \"%m\/%d\/%y\")) #to sort the dates in the list","a68b99fd":"img_frames=[]\n\nfor dates in dates_list[-30:]:\n    ax=merge.plot(column=dates, cmap='Blues', figsize=(10,10), legend=True, edgecolor='black', linewidth=0.4, scheme='user_defined',\n                 classification_kwds={'bins':[500,1000,5000,10000,50000,100000,500000,1000000]})\n\n    ax.set_title('Active Coronavirus Cases: '+ dates, fontdict={'fontsize':20}, pad=12.5)\n    ax.set_axis_off()\n    ax.get_legend().set_bbox_to_anchor((0.20,0.6)) #To move the legend to a desired location. You can play with it as you wish\n    img=ax.get_figure()\n    \n    f=io.BytesIO()  #Pillow is useful for saving the images generated in each loop and then appending it to make it a gif\n    img.savefig(f, format='png', bbox_inches='tight')\n    f.seek(0)\n    img_frames.append(PIL.Image.open(f))\n    \nimg_frames[0].save('Active COVID-19 Map.gif', format='GIF', append_images=img_frames[1:], save_all=True, duration=200, loop=0)\n\nf.close()","8ce824a8":"df_raw=pd.read_csv('..\/input\/novel-corona-virus-2019-dataset\/time_series_covid_19_deaths.csv')\n\ndf=df_raw.copy()\n\ndf=((df.groupby('Country\/Region').sum())\\\n    .drop(['Lat','Long'], axis=1))\\\n    .stack()\\\n    .reset_index()\\\n    .rename(columns={'Country\/Region':'Country','level_1': 'Date', 0:'Total'})","f224e58c":"color=['#264653', '#2a9d8f', '#e9c46a', '#f4a261','#e76f51','#f4acb7','#9f6976','#52796f','#f8ffe5','#ef476f']\n \ndf_dump=(df_raw.copy())\\\n    .drop(['Lat','Long'], axis=1)\n\ndf_dump['Total']=df_dump.sum(axis=1)\n\ndff=(df_dump[['Country\/Region','Total']])\\\n    .sort_values('Total',ascending=False)\n\nrepeat=int(len(dff)\/len(color)+1)\n\ndff = (dff.join(pd.DataFrame(color * repeat, columns=['Color'])))[['Country\/Region','Color']]\n\ncolor_dict=dict(zip(dff['Country\/Region'],dff['Color']))","617d02ce":"dates=(df['Date'].drop_duplicates()).to_list()\n\nplt.style.use('seaborn-whitegrid')\nplt.rcParams[\"font.family\"] = \"Verdana\"\nfig, ax=plt.subplots(figsize=(10,8))\n\ndef animate(date):\n        data=(df.loc[df.Date==date,['Country','Total']]).nlargest(10,['Total'])[::-1] #selecting the top 10 countries and sorting it high to low\n        ax.clear()\n        ax.barh(data['Country'], data['Total'], color=[color_dict[x] for x in data['Country']])\n        for i, v in enumerate(data['Total']):\n            ax.text(v, i, f'{v:,.0f}')\n\n        ax.text(0.95, 0.5, date, transform=ax.transAxes, color='#777777', size=20, ha='right', weight=1000)\n        ax.set_title('Number of Deaths due to COVID-19', fontsize=20)\n        ax.set_facecolor('w')\n        plt.show()\n\n#Lets pass a single date to see how it looks.\n        \nanimate(dates[100])","39560e60":"animator = animation.FuncAnimation(fig, animate, frames=dates[40:], interval=500)\nHTML(animator.to_jshtml()) ","7c14389e":"![Active%20COVID-19%20Map-min.gif](attachment:Active%20COVID-19%20Map-min.gif)","569d30e7":"Below output is what I am trying to achieve in this first part.\n\nCredits for this notebook: https:\/\/youtu.be\/vLEA8dCfusQ\n\n![Confirmed-min.gif](attachment:Confirmed-min.gif)","73eaf219":"  Python offers plenty of libraries to create interactive charts and animation. But as a beginner, the first tool that I would learn for visualization is matplotlib. In this notebook, lets create 2 charts.\n\n            1. World map of Active coronavirus cases as a timelapse GIF.\n            2. Bar race chart for the number of deaths per country as animation.\n\nBoth using only matplotlib for charting\n\nPlease upvote if you find this notebook useful. Comments are always welcome.","9ef34546":"## 1. World map of Active coronavirus cases as a timelapse GIF","fbd47981":"For this, first we need a shapefile. A shapefile (shp) is basically a map with coordinates. The best way to work with shp file in python is geopandas. The syntax of geopandas is somewhat similar to pandas library and we are not going to use it too much (except for reading the shp file).\n\nBelow is the link for the shp file for world map that I will be using in the notebook.\n\nhttps:\/\/drive.google.com\/drive\/folders\/1cnQHqHBuLHnEcqYq8mWc95WJNK54LPL7\n\n\nInstalling geopandas is the only complicated thing in this notebook. The straightforward way is to use Anaconda distribution and use the commmand  'conda install -c conda-forge geopandas'.  If it is not working, then this stackoverflow post will help you. \n\nhttps:\/\/stackoverflow.com\/questions\/34427788\/how-to-successfully-install-pyproj-and-geopandas.\n\nOk let's get started\n","2085957c":"## Objective of the notebook","f04cedcf":"I do not want a single color to represent all the bars in a matplotlib bar chart which will make it difficult to track a particular country. These are just my choice of colors.\n\nI have chosen 10 colors, and I have more than 100 countries in the list.\n\nSo I have sorted the countries in the order of highest to lowest total deaths and assigned this colors by repeating the color series, hoping that my chart do not have the same color dominating the chart which will destroy the purpose of doing this.","1b55350a":"We have three datasets each containing the total number of confirmed, recovered, and deaths per day per country. To calculate the number of active cases per day, I have subtracted the recovered and deaths from the confirmed cases.\n\nThe latitude and longitude provided in this dataset is not useful to us, since we are going to get those from the shp file that we have imported.\n\nSince this is a broader dataset (number of columns is more), it will be difficult (atleast for me) to perform operations on them, so I stacked them, so I get a narrow dataset.","ec7bb314":"The animation.FuncAnimation takes a figure parameter and a function parameter which is callable.\n\nThe 'frames' parameter will then pass the range of values specified (in our case, I have taken from the 40th date till the end in our date list) and generates the plot.\n\nThe interval parameter displays a particular plot for the mentioned milliseconds.\n\nPlease press the play button to see how the animation works.","f7b7d9d4":"## 2. Bar race chart for the number of deaths per country.","3da10600":"Now we got 2 dataframes to work with.\n1. World: Contains the coordinates of a country.\n2. active_cases: Containes the number of active cases per country per day.\n\nThere are some differences between how the countries are represented in both the countries. For example, \"US\" in one dataframse and \"United States of America\" in the other. So to make everything uniform, we will check for discrepancies and then join the datasets. ","027adaeb":"Matplotlib provides this animation tool which will iterate over the given values on a function and displays it as an animation.\n\nYou can create this only with a few lines of code. I find it very helpful since I am familiar with matplotlib and do not need to learn other libraries for creating this visualization.","bac31403":"Please note I have not executed the previous cell, but this is how your generated GIF will look like.","e82e7448":"a. Taking only the last 30 days to reduce execution time. You can remove that to make the gif from the starting date\n\nb. classification_kwds (list of buckets) will require mapclassify. Kindly use !pip install mapclassify\n\nc. img_frames[0] will save the first image and we are appending starting from 1 to the last image generated using our function.\n\nd. The duration is in milliseconds (number of milliseconds an image will appear in a gif).\n\ne. The loop=0 makes it an infinite loop. If you want, you can set it to something like loop=3, so that it will loop only 3 times and stops."}}