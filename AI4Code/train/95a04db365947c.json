{"cell_type":{"87753e82":"code","cc800b76":"code","134a30fb":"code","f71a1430":"code","65a80fa8":"code","0eaf6d85":"code","4186f0a3":"code","3e42f34d":"code","93d10139":"code","e76aa53d":"markdown","81bcff59":"markdown","b304fa63":"markdown","ff37a9bf":"markdown","a40a1187":"markdown","c9fe5aa3":"markdown"},"source":{"87753e82":"import numpy as np\nimport pandas as pd\nimport datetime\nfrom sklearn.preprocessing import MinMaxScaler\nfrom tensorflow import keras\nfrom tensorflow.keras.layers import Dense, LSTM, Dropout,Flatten\nfrom tensorflow.keras import Sequential\n#from keras.preprocessing.sequence import TimeseriesGenerator\nimport matplotlib.pyplot as plt","cc800b76":"ds = pd.read_csv(\"\/kaggle\/input\/bitcoin-historical-data\/bitstampUSD_1-min_data_2012-01-01_to_2021-03-31.csv\")","134a30fb":"ds[\"Date\"] = pd.to_datetime(ds[\"Timestamp\"],unit=\"s\").dt.date\ndata=ds.groupby(\"Date\").mean()\ndata.head()","f71a1430":"price_by_date=data[\"Weighted_Price\"].rename(\"Price\")\nprice_by_date.plot()","65a80fa8":"######## Prepare timesteps groups ########\ntime_window = 15 # Time series are of (time_window - time_ahead) size\ntime_ahead = 1 # Short forecast\nscaler=MinMaxScaler()\nlength = len(price_by_date)\nprice_scaled=scaler.fit_transform(pd.DataFrame(price_by_date))[:,-1]\nprice_groups = []\nfor i in range(0,length-time_window):\n    price_groups.append(price_scaled[i:i+time_window])\n\nprice_groups = np.array(price_groups)\nprice_groups=price_groups[...,np.newaxis]","0eaf6d85":"######## Split Xs, and Ys########\nsplit_rate = 0.95\nlength = len(price_groups)\nX_train = price_groups[:int(length*(split_rate)), :-time_ahead]\nX_test =  price_groups[int(length*(split_rate)):, :-time_ahead]\ny_train = price_groups[:int(length*(split_rate)),  -time_ahead:]\ny_test =  price_groups[int(length*(split_rate)):,  -time_ahead:]\nprint(X_train.shape,y_train.shape)\nprint(X_test.shape,y_test.shape)","4186f0a3":"######## Model ########\nmodel = keras.models.Sequential([\n     keras.layers.LSTM(128,activation='relu', return_sequences=True, input_shape=(None,1)),\n     keras.layers.LSTM(128,activation='relu'),\n     keras.layers.Dense(time_ahead)\n])\n\nmodel.compile(loss='mse', optimizer=\"adam\", metrics=['mse'])\nhistory = model.fit(X_train, y_train, epochs=40, verbose=1,  validation_data=(X_test, y_test))","3e42f34d":"y_pred = model.predict(X_test)[:, 0][..., np.newaxis]\ny_last = price_scaled.flatten()[-time_window:]\ny_pred30future=[]\nfor _ in range(30):\n    newX = np.reshape(y_last[-time_window:],(1,time_window,1))\n    y_pred30future.append(model.predict(newX)[0,0])\n    y_last=np.append(y_last,np.array(y_pred30future)[-1])\n","93d10139":"######## Make scaled numbers normal again ########\ny_pred_inv = scaler.inverse_transform(y_pred)\ny_pred30future_inv = scaler.inverse_transform(np.reshape(y_pred30future,(len(y_pred30future),1))) \ny_test_inv = scaler.inverse_transform(y_test[:,-1])\n\n######## Plot Real, Prediction, and 30 Days after ########\nplt.plot(range(len(y_test)),y_test_inv,\"r-\", label=\"Real\")\nplt.plot(range(len(y_pred_inv)), y_pred_inv, \"b-\",label=\"Prediction\")\nplt.plot(range(len(y_pred_inv),len(y_pred_inv)+len(y_pred30future_inv)), y_pred30future_inv, \"g-\",label=\"30 Days Future\")\nplt.legend(fontsize=12)\nplt.show()","e76aa53d":"# Predictions","81bcff59":"# Timesteps Preparation","b304fa63":"# Imports","ff37a9bf":"### Splitting the groups into X and Y goes something like this:\n![](https:\/\/i.ibb.co\/54CgsMH\/XY.jpg)","a40a1187":"# Compile and Fit Model","c9fe5aa3":"Seems my model doesn't like Bitcoin's future a lot. Then again, as far as unpredictable intangible assets go, Bitcoin is definitively up there."}}