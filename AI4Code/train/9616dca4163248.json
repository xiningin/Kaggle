{"cell_type":{"604287f1":"code","a3ea6a8e":"code","ba3921fe":"code","aa4b639f":"code","36ddabb0":"code","511d9a08":"code","2b52dc88":"code","4c10427a":"code","05dff2f1":"code","c1082aad":"code","4d2f9453":"code","007e6de5":"code","59424bb0":"code","d4ada964":"code","1c99980f":"code","69b438e2":"code","05f3c975":"code","ed579719":"code","5fa4d8ce":"code","d63cc8d6":"code","7bce68aa":"code","8c76c0ef":"code","8216001a":"code","e38bd6cd":"markdown","3bc326f4":"markdown","441360e3":"markdown","3a8d4617":"markdown","82fa9251":"markdown","b034879c":"markdown"},"source":{"604287f1":"import os\nimport numpy as np\nimport pandas as pd\nfrom fastai.text import * ","a3ea6a8e":"#Setting path for learner\npath = Path(os.path.abspath(os.curdir))","ba3921fe":"#reading into pandas and renaming columns for easier api access\nfilepath = Path('..\/input')\ndf = pd.read_csv(filepath\/'Tweets.csv')\ndf.rename(columns={'airline_sentiment':'label'},inplace=True)\n\ndf = df[['label','text']]\ndf.head(2)","aa4b639f":"# 99-1 split into train\/validation set.\ntrain = df[:int(len(df)*.99)]\nvalid = df[int(len(df)*.99):]","36ddabb0":"# Language model data\ndata_lm = TextLMDataBunch.from_df(path, train, valid)\ndata_lm.save('data_lm_export.pkl')\ndata_lm = load_data(path, 'data_lm_export.pkl')","511d9a08":"#Training a language model, i.e. to predict the next few words\nlearn = language_model_learner(data_lm, AWD_LSTM, drop_mult=1.5)","2b52dc88":"learn.lr_find()\nlearn.recorder.plot()","4c10427a":"learn.fit_one_cycle(4, 1e-2)\n#learn.save('fit_head'); learn.load('fit_head')","05dff2f1":"learn.unfreeze()\nlearn.lr_find(); learn.recorder.plot()","c1082aad":"learn.fit_one_cycle(8, 1e-3)\nlearn.save_encoder('ft_enc')","4d2f9453":"learn.predict(\"I booked a ticket\", n_words=10)","007e6de5":"# 80-20 split into train\/validation set.\ntrain = df[:int(len(df)*.80)]\nvalid = df[int(len(df)*.80):]","59424bb0":"# Classifier model data\ndata_clas = TextClasDataBunch.from_df(path, train, valid, vocab=data_lm.train_ds.vocab, bs=32)\ndata_clas.save('data_clas_export.pkl') ; data_clas = load_data(path, 'data_clas_export.pkl', bs=16)","d4ada964":"learn = text_classifier_learner(data_clas, AWD_LSTM, drop_mult=.3, metrics=[accuracy,Precision(average='weighted'),Recall(average='weighted')])\nlearn.load_encoder('ft_enc')","1c99980f":"data_clas.show_batch()","69b438e2":"learn.lr_find()\nlearn.recorder.plot()","05f3c975":"learn.fit_one_cycle(4, 1e-2)\n#learn.save('clas_head'); learn.load('clas_head')","ed579719":"learn.freeze_to(-2)\nlearn.fit_one_cycle(4, slice(1e-3\/(2.6**4), 1e-3))\n#learn.save('second'); learn.load('second')","5fa4d8ce":"learn.freeze_to(-3)\nlearn.fit_one_cycle(4, slice(1e-4\/(2.6**4), 1e-4))\n#learn.save('third') ; learn.load('third')","d63cc8d6":"learn.unfreeze()\nlearn.fit_one_cycle(4, slice(1e-5\/(2.6**4),1e-5))\nlearn.save('final')","7bce68aa":"learn.predict(\"JetBlue gave me bad service. My media console was spoilt\")","8c76c0ef":"learn.predict(\"JetBlue was okay, nothing special\")","8216001a":"learn.predict(\"Missed my flight but JetBlue gave me a great hotel voucher and food claims.Thanks!\")","e38bd6cd":"## References\n[1] Stephen Merity, Nitish Shirish Keskar, and Richard Socher. 2017. Regularizing and optimizing lstm language models.","3bc326f4":"## AWD-LSTM","441360e3":"### Fine tuning AWD-LSTM classifier\n","3a8d4617":"# Tweet Classification using AWD-LSTM\nGiven the relatively small dataset (140k rows), would be interesting to see if a neural net can still do well and not overfit.\n\nImplementing AWD-LSTM [1] with fastai.\n\n","82fa9251":"## Intializing libraries and dataset","b034879c":"### Loading pre-trained language model and fine-tuning\nFor training the language model, using as much data as I can given the limited dataset."}}