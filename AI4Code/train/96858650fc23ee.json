{"cell_type":{"a486e2bb":"code","f325b2a9":"code","03ed62cd":"code","afa3c157":"code","2b691927":"code","fe67feaa":"code","c3a5e33d":"code","690a5733":"code","49ca7ee9":"code","5a253e58":"code","bb51e333":"code","a8c2ebe7":"code","845c4462":"code","0d6f9d27":"code","12458179":"code","584bd06a":"code","2f182b9b":"code","42135805":"code","26e76f00":"code","76ff3e7f":"code","76e8f212":"code","d125cbdb":"code","890f2996":"code","33cfec5e":"code","e1f28416":"code","84e27caa":"code","002d2a9e":"code","3e68f33b":"code","5e3cb301":"code","262f5457":"code","e772ef31":"code","5ff946b7":"code","5911c3e3":"code","684b2393":"code","8cd3acae":"code","36fd92eb":"code","878b87a0":"code","3e741bed":"code","0e21049a":"code","37f3e525":"code","117646f9":"code","5c3b792c":"code","30c5eddb":"code","b3981a28":"markdown","012f6c54":"markdown","b48e8fb3":"markdown","2bad9154":"markdown","b8e2e7f9":"markdown","163a87fd":"markdown","7ad16319":"markdown","5f6c331b":"markdown","b90598c8":"markdown","edfdc55e":"markdown","ecccb432":"markdown","b0db6123":"markdown","aa56220f":"markdown","253c0d24":"markdown","3645421b":"markdown","e16a50f8":"markdown","9166cbd4":"markdown","d8da8bf3":"markdown","67377513":"markdown","09f5e2a4":"markdown","9f12d181":"markdown","1d9466bf":"markdown","57afad78":"markdown","1532ef68":"markdown","e2fb238e":"markdown","b430b471":"markdown","5cd40846":"markdown","5bcc198a":"markdown","1014de70":"markdown","e6b33bc3":"markdown"},"source":{"a486e2bb":"import os\nimport re\nimport numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom datetime import datetime\nimport warnings \nwarnings.simplefilter(\"ignore\")","f325b2a9":"data_df = pd.read_csv(\"\/kaggle\/input\/public-tenders-romania-20072016\/contracts.csv\", low_memory=False)","03ed62cd":"pattern = re.compile(r'^HEXI')\ncompany_list = list(data_df.Winner.unique())\nmatches = [x for x in company_list if pattern.match(x)]\nprint(f\"Matching Winner names: {matches}\")","afa3c157":"hexi_df = data_df.loc[data_df.Winner.isin(matches)]\nprint(f\"Hexi Pharma appears for {hexi_df.shape[0]} times in the data.\")","2b691927":"def plot_count(feature, title, df, size=1, rotation=False, order=True):\n    f, ax = plt.subplots(1,1, figsize=(4*size,4))\n    total = float(len(df))\n    if order:\n        g = sns.countplot(df[feature], order = df[feature].value_counts().index[:31], palette='Set3')\n    else:\n        g = sns.countplot(df[feature],  palette='Set3')\n    g.set_title(\"Number and percentage of {}\".format(title))\n    if rotation:\n        plt.xticks(rotation=90, size=8)\n    for p in ax.patches:\n        height = p.get_height()\n        ax.text(p.get_x()+p.get_width()\/2.,\n                height + 0.2,\n                '{:1.2f}%'.format(100*height\/total),\n                ha=\"center\") \n    plt.show()    ","fe67feaa":"plot_count(\"Winner\", \"aparition of Hexi Pharma (with different names)\", hexi_df, size=2, rotation=True)","c3a5e33d":"plot_count(\"Type\", \"- (Award) Type\", hexi_df, size=2)","690a5733":"plot_count(\"Contract_Type\", \"contracts - grouped by Contract type\", hexi_df, size=1)","49ca7ee9":"plot_count(\"Procedure_Type\", \"Procedure type\", hexi_df, size=2, rotation=True)","5a253e58":"plot_count(\"Contracting_Authority\", \"Contracting Authority (top 30)\", hexi_df, size=4, rotation=True)","bb51e333":"plot_count(\"Contracting_Authority_Type\", \"Contracting Authority Type (first 30)\", hexi_df, size=4, rotation=True)","a8c2ebe7":"plot_count(\"Contracting_Authority_Activity_Type\", \"Contracting Authority Activity Type\", hexi_df, size=3, rotation=True)","845c4462":"\nhexi_df[\"Award_Announcement_Date\"] = hexi_df[\"Award_Announcement_Date\"].apply(lambda x: datetime.strptime(x[0:10], '%Y-%m-%d'))\nhexi_df[\"Award_Announcement_Year\"] = hexi_df[\"Award_Announcement_Date\"].dt.year\nhexi_df[\"Award_Announcement_Month\"] = hexi_df[\"Award_Announcement_Date\"].dt.month","0d6f9d27":"plot_count(\"Award_Announcement_Year\", \" contracts grouped by Year\", hexi_df, size=2, order=False)","12458179":"plot_count(\"Award_Announcement_Month\", \" contracts grouped by Month\", hexi_df, size=2, order=False)","584bd06a":"plot_count(\"Currency\", \" contracts grouped by Currency\", hexi_df, size=1)","2f182b9b":"plot_count(\"Offers_Number\", \" contracts grouped by Offers Number (first 30)\", hexi_df, size=4)","42135805":"plot_count(\"Financing_Type\", \" contracts grouped by Financing Type (first 30)\", hexi_df, size=2)","26e76f00":"plot_count(\"Financing_Method\", \" contracts grouped by Financing Method (first 30)\", hexi_df, size=4, rotation=True)","76ff3e7f":"from wordcloud import WordCloud, STOPWORDS\nstopwords = set(STOPWORDS)\n\ndef show_wordcloud(data, title = None):\n    wordcloud = WordCloud(\n        background_color='white',\n        stopwords=stopwords,\n        max_words=50,\n        max_font_size=40, \n        scale=5,\n        random_state=1\n    ).generate(str(data))\n\n    fig = plt.figure(1, figsize=(10,10))\n    plt.axis('off')\n    if title: \n        fig.suptitle(title, fontsize=20)\n        fig.subplots_adjust(top=2.3)\n\n    plt.imshow(wordcloud)\n    plt.show()","76e8f212":"show_wordcloud(hexi_df[\"Contract_Title\"], \"Prevalent words in the contract\")","d125cbdb":"hexi_df[[\"Contracting_Authority\", \"Award_Announcement_Year\", \"Value\"]].sort_values(by=[\"Value\"], ascending=False).head(10)","890f2996":"hexi_df.loc[(hexi_df.Contracting_Authority==\"SPITAL CLINIC JUDETEAN DE URGENTA ORADEA\")&(hexi_df.Award_Announcement_Year==2015)][[\"Contract_Title\", \"Procedure_Type\", \"Value\", \"Award_Announcement_Month\"]]","33cfec5e":"hexi_df[[\"Contract_Title\"]].value_counts()[:10]","e1f28416":"agg_data = hexi_df.groupby([\"Winner\", \"Winner_Country\", \"Award_Announcement_Year\", \"Contracting_Authority\", \"Contracting_Authority_Activity_Type\"])[\"Value_RON\"].agg([\"sum\", \"count\"])","84e27caa":"agg_data_df = pd.DataFrame(agg_data).reset_index()\nagg_data_df.columns = [\"Winner\", \"Winner Country\", \"Year\", \"Contracting Authority\",\"Activity Type\", \"Total\", \"Count\"]","002d2a9e":"agg_data_df.sort_values(by=[\"Total\"], ascending=False).head(10)","3e68f33b":"agg_data_df.sort_values(by=[\"Count\"], ascending=False).head(10)","5e3cb301":"import plotly.express as px\nfig = px.scatter(agg_data_df, x='Total', y='Count', color='Contracting Authority', size='Total', size_max = 50,\n                hover_name='Contracting Authority', animation_frame='Year',\n                 title=\"Winner contract numbers vs. total amount grouped by Activity Type, per year\",\n                 animation_group='Activity Type', range_x=[-2000, 30000000], range_y=[-1, 16],\n                width=800, height=800)\nfig.update_layout(legend=dict(orientation=\"h\",  yanchor=\"bottom\", y=-1, xanchor=\"right\", x=1, font=dict(family=\"Courier\", size=12,color=\"black\")))\nfig.show()","262f5457":"agg2_data = hexi_df.groupby([\"Award_Announcement_Year\", \"Contracting_Authority_Activity_Type\"])[\"Value_RON\"].agg([\"sum\", \"count\"])","e772ef31":"agg2_data_df = pd.DataFrame(agg2_data).reset_index()\nagg2_data_df.columns = [\"Year\", \"Activity Type\", \"Total\", \"Count\"]\nagg2_data_df.head()","5ff946b7":"agg2_data_df.sort_values(by=[\"Total\"], ascending=False).head(10)","5911c3e3":"agg2_data_df.sort_values(by=[\"Count\"], ascending=False).head(10)","684b2393":"agg_data_df.loc[agg_data_df.Year==2010].sort_values(by=[\"Count\"], ascending=False).head(10)","8cd3acae":"agg_data_df.loc[agg_data_df.Year==2010].sort_values(by=[\"Total\"], ascending=False).head(10)","36fd92eb":"import plotly.graph_objs as go\nimport plotly.figure_factory as ff\nfrom plotly import tools\nfrom plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot\ninit_notebook_mode(connected=True)","878b87a0":"def plot_time_variation(df, y='Total', hue='Activity Type', size=1, title=\"\"):\n    \n    data = []\n    groups = df[hue].unique()\n    \n    for group in groups:\n        df_ = df[(df[hue]==group)] \n        traceS = go.Bar(\n            x = df_['Year'],y = df_[y],\n            name=group,\n            marker=dict(\n                        line=dict(\n                            color='black',\n                            width=0.75),\n                        opacity=0.7,\n                    ),\n            text=df_[hue],\n        )\n        data.append(traceS)\n    layout = dict(title = title,\n              xaxis = dict(title = 'Year', showticklabels=True), \n              yaxis = dict(title = f'{y}'),\n              hovermode = 'closest',\n              barmode='stack'\n             )\n    fig = dict(data=data, layout=layout)\n    iplot(fig, filename='total-count')","3e741bed":"plot_time_variation(agg2_data_df, 'Total', 'Activity Type', 4, \"Total amount of contracts (2007-2016)\")","0e21049a":"plot_time_variation(agg2_data_df, 'Count', 'Activity Type', 4, \"Number of contracts (2007-2016)\")","37f3e525":"heatmap = agg2_data_df.pivot(\"Year\", \"Activity Type\", 'Total')\nfig, ax = plt.subplots(nrows=1,figsize=(14,8))\nsns.heatmap(heatmap, linewidths=.5)\nplt.title(\"Winner Contracts Total (RON) grouped by Activity Type per Year\")\nplt.xticks(rotation=90, size=8)\n\nplt.show()","117646f9":"heatmap = agg2_data_df.pivot(\"Year\", \"Activity Type\", 'Count')\nfig, ax = plt.subplots(nrows=1,figsize=(14,8))\nsns.heatmap(heatmap, linewidths=.5)\nplt.title(\"Winner Contracts Number grouped by Activity Type per Year\")\nplt.xticks(rotation=90, size=8)\n\nplt.show()","5c3b792c":"filtered_agg_data_df = agg2_data_df.loc[agg2_data_df.Total>1]\nfiltered_agg_data_df.shape","30c5eddb":"import plotly.express as px\nfig = px.scatter(filtered_agg_data_df, x='Total', y='Count', color='Activity Type', size='Total', size_max = 50,\n                hover_name='Activity Type', log_x=True, animation_frame='Year',\n                 title=\"Winner contract numbers vs. total amount grouped by Activity Type, per year\",\n                 animation_group='Activity Type', range_x=[1, 80000000], range_y=[-1, 100],\n                width=800, height=800)\nfig.show()","b3981a28":"Let's look to the titles of the contracts.","012f6c54":"# <a id='2'>Data about Hexi Pharma<\/a>\n\nLet's select the data about Hexi Pharma. We will select the entries in the dataset where the company name is **Hexi Pharma** or variants.  \n\nThis is because the company might have been registered under alternate names when filling for public contracts as well as having misspell their company name.","b48e8fb3":"The top of 2010 in terms of number of contracts is dominated by Slatina Hospital and the hospital of Rahova penitentiary, each with 9 contracts that year.","2bad9154":"Most of the awarder contracts followed an invitation to take part to the competition (42%), followed by open auction (38%) and Negotiation for participation notice (19%). ","b8e2e7f9":"As number of contracts, although the total amount was not very high, the best year in 2010, with a total of 82 wins for health, followed by 2011 an 2012, each with 77 wins, also with Health.\n\nLet's glimpse the wins of Hexi Pharma in 2010.","163a87fd":"With the hospital from Oradea, Hexi Pharma won in September 2015 an open auction for 28 Million RON. This is the largest contract won by Hexi Pharma, 1 month before the fire broke at Colectiv nightclub.\n\nLet's see what are the most frequent contracts titles for Hexi Pharma.","7ad16319":"<center><h1>Story of Hexi Pharma<\/h1><\/center>\n<br>\n<center><img src=\"https:\/\/www.romaniajournal.ro\/wp-content\/uploads\/2017\/03\/61800365-e1488835287550.png\" width=\"500\"><\/center>\n<br>\n\n# <a id='0'>Content<\/a>\n\n- <a href='#1'>Introduction<\/a>  \n- <a href='#2'>Data about Hexi Pharma<\/a>   \n- <a href='#4'>Conclusions<\/a>\n\n# <a id='1'> Introduction<\/a>\n\n\nFrom the public tenders data between 2007 and 2016, we will select the **Hexi Pharma** data, to follow this company evolution in time.\n\nFollowing [Collective nightclub case](https:\/\/en.wikipedia.org\/wiki\/Colectiv_nightclub_fire) and subsequent [nosocomial infections](https:\/\/en.wikipedia.org\/wiki\/Diluted_disinfectants_crisis_(Romania)) of the victims in Romanian hospitals due to diluted disinfectants distributed by the company for several years, Hexi Pharma came to the public's attention.  \n\nThe immediate impact of Hexi Pharma business conduct was on the main hospitals from Capital Bucharest. Several of the survivors from Colectiv nightclub fire were reported with nosocomial infections. It is clear now that due to these nosocomial infections, at least three (but probably much more of them) died. \n\nStarting from this, the public realised that Hexi Pharma had sold diluted disinfectants and other under-standard medical supplies to hospitals in all parts of the country.  Consequently their actions would have most probably caused in time another hundreds or maybe up to tens of thousands of deaths due to supra-infections of patients of hospitals around the country.\n\nOnly after the nosocomial infections of patients from Colectiv nightclub fire the larger public in Romania understood the dimmension of this phenomena: nosocomial infections in hospitals. In parallel, the public understood also that the phenomena was hidden from the public by systematic under-reporting by hospital authorities.\n\nNow I will analyze in detail the contracts of Hexi Pharma with the various public hospitals around the country, to assess the dimmension of their impact on public health and patients wellbeing for the entire period when they were in business (and for which we have data, i.e. from 2007 to 2016).\n\n","5f6c331b":"The company appears with 4 different names (incomplete or wrongly spelled name).","b90598c8":"#  <a id='3'>Conclusions<\/a>\n\nHexi Pharma activity was mostly about providing disinfectants for hospitals and became infamous after it was found that the company provided low quality (diluted) disinfectants resulting in persistence of nosocomial infections in large hospitals in Romania, after Colectiv nightclub fire in Bucharest in 2015. In the same time, one month before Colectiv, Hexi Pharma won his largest contract with an hospital in Oradea, Romania, 3 times larger than any other contract, to provide medicaments. Next year Hexi Pharma went out of business.\n\n","edfdc55e":"A large percent (15%) or a number of over 120 contracts for Hexi Pharma were won when the company was the only participant.","ecccb432":"All contracts for Hexi Pharma were supply contracts.","b0db6123":"Majority of the financing type of contracts are from `budget funds`, followed by `other funds` and `cofunding`. we observe that actually only a part of the bids have this field completed.","aa56220f":"Let's aggregate the data per year.","253c0d24":"The year when Hexi Pharma business thrieved is the year of Colective nightclub fire, 2015. In that year, Hexi Pharma's sales skyroketed, from the 17 Million previous year to 45 Million.","3645421b":"Let's look to top years for the Hexi Pharma companies in terms of total amount.","e16a50f8":"In terms of total amount, the top of 2010 is dominated by Mures county hospital and Slatina county hospital, both with over 1 Million contracts, from 2 and 9 contracts respectively.\n\nSlatina hospital, as well as Rahova penitentiary hospitals are also in top 5 overall as number of contracts.","9166cbd4":"The largest number of contracts was awarded to Hexi Pharma in 2010 & 2012.\n\nWe can show the same with heatmaps.","d8da8bf3":"As we expected, almost 2\/3 of the contracts were in Health, but an aditional ~8% are with Defense and Interior Ministry.\n\nWe also observe that not all the data has this field filled, since the total of calculated percents is less than 80%.","67377513":"We observe that the best years in terms of number of contracts were 2012, followed by 2010 and 2009.","09f5e2a4":"The top 10 is dominated by contracts in Health. A number of 7 contracts with Defense Ministry in 2012 brought this contractor\/year on 10th position. \n\nLet's also look to the top 10 in terms of number of contracts.","9f12d181":"Let's show now an animated plot of yearly evolution of total amounts and number of contracts, gruped by Activity Type.","1d9466bf":"We include all the matching options in the filter. \n\nLet's look to some of the data distributions:\n* the name used by Hexi Pharma in various bids;  \n* the award type;  \n* contract type;  \n* procedure type;  \n\nWe then can look to the most frequent clients of Hexi Pharma as following:\n* contracting authority name;  \n* contracting authority type;  \n","57afad78":"Most of the contracts for Hexi Pharma were closed on August.","1532ef68":"\n\n### Total amount and number of contracts aggregated per year and activity type\n\n\nLet's look now to the aggregated totals and number of contracts per year and activity type.","e2fb238e":"We observe that the contracting authorities are directly hospitals.  On 4th place is the hospital for a penitentiary (Rahova, near Bucharest). In top 10 we see some of the largest hospitals in Bucharest, as number of contracts.","b430b471":"Hexi Pharma won two types of awards:\n* Award notice to the participation notice;  \n* Award notice at the offer request.","5cd40846":"Hospitals in Oradea and Craiova, as well as Bagdasar-Arseni in Bucharest appears twice in the top 10, with the Hospital from Oradea on 1st place, woth an amount of 28 Million RON (more than 3 times more than the next contract, of 8.8 Million, with Hospital from Craiova).  \nLet's see the details for the 1st hospital.","5bcc198a":"Best year in terms of total amount of contracts was 2015, where income exceeded 45 Million RON.","1014de70":"Here we observe that the Financial method should have been cleaned, because there are multiple different writings for the same value, for example for \"Own funds\" are at least 5 different writings.","e6b33bc3":"We see that, besides frequent words for Romanian language specific to such contracts (Acord=\"accord\", Pentru=\"for\", Cadru=\"Frame\") we see the words specific to Hexi Pharma contracts:\n* Antiseptic  \n* Dezinfectia\n* Cutanat\n* Polyiodine  \n* Sapun  \n* Colrhexin  \n* Lichid  \n* Igienica\n* Medicamente   \nHexi Pharma had mostly contracts with hospitals for disinfectants.\n\nLet's see with what hospitals Hexi Pharma had the largest contracts in terms of value."}}