{"cell_type":{"71bd2c43":"code","2e0a196d":"code","b58e7678":"code","813b87be":"code","e2fd2cbb":"code","02435a27":"code","b21ceb9c":"code","16e49f8f":"code","1f0496cf":"code","adebad58":"code","c5638f5f":"code","f5fb2fcf":"code","190deee2":"code","643f52f1":"code","329403a3":"code","a671a016":"code","27488aae":"code","fadeb9fc":"code","6bc2d6b0":"code","31f5ed60":"code","46173982":"code","05c6c2f9":"code","19fc2ccb":"code","0f2c871a":"code","81ea5748":"code","11bd3205":"code","14a529dd":"code","430b5cc8":"code","0d839ad1":"code","402bbfd1":"code","0d614d8e":"code","8cc4bcd6":"code","4f6f135c":"code","1263f551":"code","933f91bb":"code","3f4a9ef9":"code","27803958":"code","716bf63d":"code","dc2461c5":"code","978cd7b9":"code","dde1672e":"code","d215b193":"code","eb13451f":"code","1336a8a9":"code","9fb53d9b":"code","d7d987e4":"code","0b95b5ab":"code","510865a7":"code","5118694f":"code","94c0eda1":"code","e90044fb":"code","d16aa866":"code","acd4220d":"code","2e69e159":"code","ca00c7fc":"code","6d4ccc73":"code","5fd3174a":"code","22981a14":"code","db842651":"code","685b6df7":"code","5012d285":"code","0c1a8e97":"code","a9b6c2c1":"code","84d0fafe":"code","87516ed8":"code","ac01ffe9":"code","c12d9fd6":"code","113c2337":"code","255986df":"code","3cda2628":"code","e8cf403d":"code","5e1a8c13":"code","edb78a30":"code","5581ce29":"code","3d8b8deb":"code","5d27bfdc":"code","e16f453a":"code","7f4bd450":"code","9fa1b54b":"code","fe164919":"code","184522b1":"code","7ff0f981":"code","58187952":"code","a12b63c0":"code","3f6b8a7b":"code","63285731":"code","4e877106":"code","484fb7bc":"code","ac8a8101":"code","2492e735":"code","40171bba":"code","91716ff3":"code","f07b4a2b":"code","72831507":"code","7a251b3e":"code","d7789a6b":"code","02ee81d5":"code","3be8cad3":"code","be1f8f39":"markdown","c6e126c8":"markdown","b46e25fe":"markdown","671bea47":"markdown","6bf94bb7":"markdown","76ffccec":"markdown","c66de6a1":"markdown","0f4f4953":"markdown","fa89adc8":"markdown","0bee11a4":"markdown","f6484818":"markdown","798625ad":"markdown","190a706e":"markdown","11c8e05f":"markdown","9781b0e5":"markdown","0a0a7e32":"markdown","25aa00e7":"markdown","d2767072":"markdown","dc00035c":"markdown","e8be4198":"markdown","4ef74f20":"markdown","ee8ce622":"markdown"},"source":{"71bd2c43":"# Import libraries\nimport pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport urllib.request, json\nimport os\nimport os.path\nimport matplotlib.pyplot as plt\nimport statsmodels.api as sm\nfrom pylab import rcParams\nfrom datetime import datetime\nimport statsmodels.api as sm\n\nimport warnings\nwarnings.filterwarnings(action='ignore')","2e0a196d":"#input data\nroot_dir = '\/kaggle\/input\/wids-texas-datathon-2021\/'\nsample_submission = pd.read_csv(os.path.join(root_dir, \n                    'sampleSubmission.csv'))\n#https:\/\/github.com\/WiDSTexas2021\/datathon-code\/tree\/main\/data\n# Import from Github\nweather_forecast = pd.read_csv(\"https:\/\/raw.githubusercontent.com\/WiDSTexas2021\/datathon-code\/main\/data\/weather_forecast.csv\")\nweather_history = pd.read_csv(\"https:\/\/raw.githubusercontent.com\/WiDSTexas2021\/datathon-code\/main\/data\/weather_history.csv\")\nercot_hourly_load = pd.read_csv(\"https:\/\/raw.githubusercontent.com\/WiDSTexas2021\/datathon-code\/main\/data\/ercot_hourly_load.csv\")\nweather_zone_cities = json.loads(urllib.request.urlopen(\"https:\/\/raw.githubusercontent.com\/WiDSTexas2021\/datathon-code\/main\/data\/weather_zone_cities.json\").read())\nweather_zone_counties = json.loads(urllib.request.urlopen(\"https:\/\/raw.githubusercontent.com\/WiDSTexas2021\/datathon-code\/main\/data\/weather_zone_counties.json\").read())","b58e7678":"weather_forecast.shape","813b87be":"weather_forecast.dtypes","e2fd2cbb":"weather_forecast.head()","02435a27":"print('Weathehr forecast data are avialable from', weather_forecast['date'].min(), 'through', weather_forecast['date'].max())   ","b21ceb9c":"weather_forecast.isna().any().any()","16e49f8f":"weather_forecast.columns","1f0496cf":"select_col = ['date', 'time', 'city', 'tempF', 'windspeedMiles', 'winddirDegree', 'weatherCode', \n              'precipInches','humidity', 'visibilityMiles', 'pressureInches', 'cloudcover','HeatIndexF', \n              'DewPointF', 'WindChillF', 'WindGustMiles','FeelsLikeF', 'uvIndex'] # weatherDesc is not present on weather history","adebad58":"forecast_df =  weather_forecast[select_col]\nforecast_df.head()","c5638f5f":"# transform city to region to make consistent with Ercot data\ncity_region = {'Wichita Falls':'North',\n               'Tyler':'East',\n               'Corpus Christi':'South',\n               'Brownsville':'South',\n               'Dallas':'North Central',\n               'Austin':'South Central',\n               'Midland':'Far West',\n               'San Antonio':'South Central',\n               'Houston':'Coast',\n               'Abilene':'West'}","f5fb2fcf":"forecast_df['region'] = forecast_df.city.replace(city_region)","190deee2":"#forecast_df = forecast_df.drop(['city'], axis = 1)","643f52f1":"forecast_df.head()","329403a3":"forecast_dt_df = forecast_df.copy()","a671a016":"forecast_dt_df['time'] =forecast_dt_df['time'].apply(lambda x: str(x).zfill(4))","27488aae":"forecast_dt_df['date_time'] = forecast_dt_df['date']+ ' ' +forecast_dt_df['time']","fadeb9fc":"forecast_dt_df['date_time'] = forecast_dt_df['date_time'].apply(lambda x: datetime.strptime(str(x), \"%Y-%m-%d %H%M\"))","6bc2d6b0":"forecast_dt_df = forecast_dt_df.drop(['date', 'time'], axis = 1)","31f5ed60":"forecast_dt_df['date_time'] = forecast_dt_df['date_time'].apply(lambda x: datetime.fromtimestamp(x.timestamp()))","46173982":"forecast_dt_df = forecast_dt_df.set_index(['date_time'])","05c6c2f9":"#forecast_dt_df = forecast_dt_df.resample('1H').mean().ffill() #upsampling ","19fc2ccb":"forecast_dt_df.head()","0f2c871a":"wforecast_df = forecast_dt_df.copy()","81ea5748":"wforecast_df = wforecast_df.reset_index()","11bd3205":"wforecast_df['region'] = forecast_df['region']","14a529dd":"wforecast_df.head()","430b5cc8":"wforecast_df = wforecast_df.set_index('date_time')","0d839ad1":"wforecast_df.head()","402bbfd1":"wforecast_df.to_csv('wforecast_df.csv', index=True) # download dataset as csv file","0d614d8e":"wforecast_df_west = wforecast_df[wforecast_df['region'] =='West']","8cc4bcd6":"plt.plot(wforecast_df_west['tempF'])\nplt.gcf().autofmt_xdate()\nplt.title('Weather Forecast')\nplt.xlabel('Time')\nplt.ylabel('Temperature(F)')\nplt.show()","4f6f135c":"weather_history.shape","1263f551":"weather_history.dtypes","933f91bb":"weather_history.head()","3f4a9ef9":"print('Weathehr history data are avialable from', weather_history['date'].min(), 'through', weather_history['date'].max()) ","27803958":"weather_history.columns","716bf63d":"print('Extra_features on weather_forecast:',list(set(weather_forecast.columns).difference(weather_history.columns)))","dc2461c5":"weather_history.isna().any().any()","978cd7b9":"history_df = weather_history[select_col]\nhistory_df.head()","dde1672e":"history_df['city'].nunique()","d215b193":"history_df['city'].unique()","eb13451f":"history_df['region'] = history_df.city.replace(city_region)","1336a8a9":"#history_df = history_df.drop(['city'], axis = 1)","9fb53d9b":"history_df['time'].unique()","d7d987e4":"history_df.head()","0b95b5ab":"history_dt_df= history_df.copy()","510865a7":"history_dt_df['time'] = history_dt_df['time'].apply(lambda x: str(x).zfill(4))","5118694f":"history_dt_df['date_time'] = history_dt_df['date']+ ' ' +history_dt_df['time']","94c0eda1":"history_dt_df['date_time'] = history_dt_df['date_time'].apply(lambda x: datetime.strptime(str(x), \"%Y-%m-%d %H%M\"))","e90044fb":"history_dt_df = history_dt_df.drop(['date', 'time'], axis = 1)","d16aa866":"history_dt_df['date_time'] = history_dt_df['date_time'].apply(lambda x: datetime.fromtimestamp(x.timestamp()))","acd4220d":"history_dt_df = history_dt_df.set_index(['date_time'])","2e69e159":"#history_dt_df = history_dt_df.resample('1H').mean().ffill() #upsampling ","ca00c7fc":"whistory_df= history_dt_df.copy()","6d4ccc73":"whistory_df = whistory_df.reset_index()","5fd3174a":"whistory_df['region'] = history_df['region']","22981a14":"whistory_df = whistory_df.set_index('date_time')","db842651":"whistory_df.head()","685b6df7":"whistory_df.to_csv('whistory_df.csv', index=True) # download dataset as csv file","5012d285":"whistory_df_west = whistory_df[whistory_df['region'] =='West']","0c1a8e97":"\nfig, axs = plt.subplots(8, figsize=(25,20))\nfig.suptitle('Weathehr History - West region')\naxs[0].plot(whistory_df_west.index,whistory_df_west['tempF'], color = 'b')\naxs[0].set_title(\"tempF\")\naxs[1].plot(whistory_df_west.index,whistory_df_west['windspeedMiles'], color = 'm')\naxs[1].set_title(\"windspeedMiles\")\naxs[2].plot(whistory_df_west.index,whistory_df_west['humidity'], color = 'y')\naxs[2].set_title(\"humidity\")\naxs[3].plot(whistory_df_west.index,whistory_df_west['visibilityMiles'], color = 'r')\naxs[3].set_title(\"visibilityMiles\")\naxs[4].plot(whistory_df_west.index,whistory_df_west['cloudcover'], color = 'peru')\naxs[4].set_title(\"cloudcover\")\naxs[5].plot(whistory_df_west.index,whistory_df_west['HeatIndexF'], color = 'sienna')\naxs[5].set_title(\"HeatIndexF\")\naxs[6].plot(whistory_df_west.index,whistory_df_west['DewPointF'], color = 'coral')\naxs[6].set_title(\"DewPointF\")\naxs[7].plot(whistory_df_west.index,whistory_df_west['FeelsLikeF'], color = 'tomato')\naxs[7].set_title(\"FeelsLikeF\");","a9b6c2c1":"ercot_hourly_load.shape","84d0fafe":"ercot_hourly_load.head()","87516ed8":"ercot_hourly_load.dtypes","ac01ffe9":"print('ERCOT hourly load data are available from',\n      ercot_hourly_load['Hour_Ending'].min() ,'to',ercot_hourly_load['Hour_Ending'].max())","c12d9fd6":"ercot_hourly_load.isna().sum()","113c2337":"ercot_hourly_load[ercot_hourly_load.isna().any(axis=1)]","255986df":"ercot_hourly_load = ercot_hourly_load.fillna(method='ffill')","3cda2628":"ercot_hourly_load['No_offset_Hour_Ending'] = ercot_hourly_load['Hour_Ending']. \\\n                  apply(lambda x: datetime.fromtimestamp(datetime.strptime(str(x),'%Y-%m-%d %H:%M:%S%z').timestamp()))","e8cf403d":"ercot_hourly_load = ercot_hourly_load.drop(['Hour_Ending'],axis=1)","5e1a8c13":"ercot_hourly_load.head()","edb78a30":"ercot_hourly_load = ercot_hourly_load.set_index('No_offset_Hour_Ending')","5581ce29":"ercot_hourly_load.head()","3d8b8deb":"Ercot_before_df = ercot_hourly_load[pd.Timestamp(ercot_hourly_load.index[0]): pd.Timestamp('2008-06-30 23:00:00')]\nErcot_before_df.head()","5d27bfdc":"Ercot_after_df = ercot_hourly_load[pd.Timestamp('2008-07-01 00:00:00'):pd.Timestamp(ercot_hourly_load.index[-1])]\nErcot_after_df.head()","e16f453a":"Ercot_before_df.to_csv('Ercot_before_load.csv', index=True) # download dataset as csv file","7f4bd450":"Ercot_after_df.to_csv('Ercot_after_load.csv', index=True) # download dataset as csv file","9fa1b54b":"Ercot_before_df.plot(figsize=(25,20), subplots=True);","fe164919":"Ercot_after_df.plot(figsize=(25,20), subplots=True);","184522b1":"Ercot_after_df.loc['2019-06-01':'2020-06-01'].plot(figsize=(25,20), subplots=True);","7ff0f981":"Ercot_after_df.loc['2020-06-01':'2021-06-01'].plot(figsize=(25,20), subplots=True);","58187952":"Ercot_after_df.loc['2021-01-01':'2021-02-01'].plot(figsize=(30,12), subplots=True);","a12b63c0":"Ercot_after_df.loc['2021-02-01':'2021-03-01'].plot(figsize=(25,12), subplots=True);","3f6b8a7b":"Ercot_after_df.loc['2021-01-14':'2021-01-21'].plot(figsize=(25,12), subplots=True);","63285731":"Ercot_after_df.loc['2021-02-14':'2021-02-21'].plot(figsize=(25,12), subplots=True);","4e877106":"Ercot_after_df.loc['2021-02-14':'2021-02-14'].plot(figsize=(25,12), subplots=True);","484fb7bc":"Ercot_after_df.Coast.plot(figsize=(25,12), color='m',subplots=True);","ac8a8101":"Ercot_after_df.Coast.loc['2008-01-01':'2009-01-01'].plot(figsize=(25,12), subplots=True);","2492e735":"Ercot_after_df['Far West'].plot(figsize=(25,12), color = 'g',subplots=True);","40171bba":"def decomp(data):\n    decomp = sm.tsa.seasonal_decompose(data,period = 365*24)\n    \n    trend = decomp.trend\n    seasonal = decomp.seasonal\n    residual = decomp.resid\n    \n   # Visualize decomposition\n    plt.figure(figsize=(8,6))\n    plt.subplot(411)\n    plt.plot(data, label='Original')\n    plt.legend(loc='best')\n    plt.subplot(412)\n    plt.plot(trend, label='Trend')\n    plt.legend(loc='best')\n    plt.subplot(413)\n    plt.plot(seasonal,label='Seasonality')\n    plt.legend(loc='best')\n    plt.subplot(414)\n    plt.plot(residual, label='Residuals')\n    plt.legend(loc='best')\n    plt.tight_layout()","91716ff3":"decomp(Ercot_after_df.Coast)","f07b4a2b":"decomp(Ercot_after_df['Far West'])","72831507":"decomp(Ercot_after_df.North)","7a251b3e":"decomp(Ercot_after_df['North Central'])","d7789a6b":"decomp(Ercot_after_df.South)","02ee81d5":"decomp(Ercot_after_df['South Central'])","3be8cad3":"decomp(Ercot_after_df.West)","be1f8f39":"There is trend and seasonality in data.","c6e126c8":"### Let's choose US system of measurement.","b46e25fe":"One row with missing values for all zones. Let's fill these with common method of filling time series data with last known value.","671bea47":"### From 2008 July 1 00:00:00 through present.","6bf94bb7":"![Weather_Zones.png](https:\/\/raw.githubusercontent.com\/WiDSTexas2021\/datathon-code\/main\/data\/ercotWeatherZoneMap.png)","76ffccec":"# <span style='color:purple'> Input Data <\/span>","c66de6a1":"# Series Decomposition","0f4f4953":"## Week","fa89adc8":"### Let's choose US system of measurement.","0bee11a4":"# Data Exploration","f6484818":"# ERCOT Hourly Power Load\nHourly power load in the eight ERCOT weather zones","798625ad":"### Change timezone-offset to offset-naive timezone","190a706e":"### Now let's explore weather history","11c8e05f":"# Visulization of Ercot Electricity load data ","9781b0e5":"# <span style='color:purple'> Import Libraries <\/span>","0a0a7e32":"### From 2005 through 2008 June 30 23:00:00.","25aa00e7":"One missing value in all columns. Let's check the row.","d2767072":"# Day","dc00035c":"### Let's explore Weather Forecast!","e8be4198":"# <span style='color:purple'> Electrical Load Forecasting in Texas  <\/span>\n\n<div style=\"text-align: justify;\n             font-size:18px\">\n    \nObjective of <span style='color:purple'> WiDS Texas Datathon 2021  <\/span> is to develop time-series models to forecast hourly electrical load in 8 given weather zones in Texas for short term (next 7 days). There are 168 hours to forecast from June 13 00:00 CDT to June 20 00:00 CDT. \n<\/div>","4ef74f20":"## Month","ee8ce622":"# Year"}}