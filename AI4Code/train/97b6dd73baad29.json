{"cell_type":{"1373dff7":"code","7602f682":"code","8bcdae12":"code","d9d429c1":"code","f76dc739":"code","6aa56bec":"code","71115e2e":"code","495dafa6":"code","27bbdca0":"code","814cb252":"code","1291fea5":"code","3d5d4707":"code","e5d94717":"code","a9a6a71e":"code","851426ff":"code","f993b344":"code","0e6aa76c":"code","a12d0268":"code","c4b7ac3d":"code","0906701b":"code","ec443b8b":"code","83bde7da":"code","f678ba91":"markdown","1ac7f671":"markdown","d12f52bb":"markdown"},"source":{"1373dff7":"!pip install watermark\n!pip install nicaviz","7602f682":"%reload_ext autoreload\n%autoreload 2","8bcdae12":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport nicaviz\nimport seaborn as sns\nimport time\nimport matplotlib.pyplot as plt\nimport itertools\nimport glob\nimport re\nimport math\n\nsns.set_style(\"whitegrid\")\n\n%load_ext watermark\n%watermark \n\nimport warnings\nwarnings.filterwarnings(\"ignore\", category=DeprecationWarning) \nwarnings.simplefilter(action='ignore', category=FutureWarning)\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session\n\nnotebookstart = time.time()\n%watermark --iversions","d9d429c1":"# Helpers\nregex = r\"[-+]?[.]?[\\d]+(?:,\\d\\d\\d)*[\\.]?\\d*(?:[eE][-+]?\\d+)?\"\ndef extract_fractions(value):\n    if isinstance(value, str) == False:\n        return [0,0]\n    try:\n        compile_regex = re.compile(regex)\n        processed = compile_regex.findall(value)\n        return processed \n    except Exception as e:\n        print(f'Error: {value}, {e}')\n        return [0,0] ","f76dc739":"districts_info = pd.read_csv(\"..\/input\/learnplatform-covid19-impact-on-digital-learning\/districts_info.csv\")\n\nratio_cols = [\n    'pct_black\/hispanic',\n    'pct_free\/reduced',\n    'county_connections_ratio',\n    'pp_total_raw']\n\nfor ratio_col in ratio_cols:\n    districts_info[ratio_col] = districts_info[ratio_col].apply(extract_fractions)\n    tmp = pd.DataFrame(districts_info[ratio_col].values.tolist(), columns = [f'{ratio_col}_{i}' for i in [1,2]])\n    districts_info = pd.concat([districts_info, tmp], axis = 1)\n    districts_info[ratio_col] = districts_info[ratio_col].astype(str)\n \ndisplay(districts_info.head())\ndisplay(districts_info.nica.categorical_describe())","6aa56bec":"categoricals = [\n    'state',\n    'locale',\n    'pct_black\/hispanic',\n    'pct_free\/reduced',\n    'county_connections_ratio',\n    'pp_total_raw']\ncontinuous = []\n\ndistricts_info.nica.mass_plot(\n    plt_set = categoricals,\n    columns = 2,\n    plottype = \"countplot\")","71115e2e":"products_info = pd.read_csv(\"..\/input\/learnplatform-covid19-impact-on-digital-learning\/products_info.csv\")\\\n    .rename(columns = {'LP ID': \"lp_id\"})\n\ndisplay(products_info.head())\ndisplay(products_info.nica.categorical_describe())","495dafa6":"categoricals = [\n    'Provider\/Company Name',\n    'Sector(s)',\n    'Primary Essential Function'\n]\ncontinuous = []\n\nproducts_info.nica.mass_plot(\n    plt_set = categoricals,\n    columns = 1,\n    figsize = [15,12],\n    plottype = \"countplot\")","27bbdca0":"# yoink https:\/\/www.kaggle.com\/ruchi798\/covid-19-impact-on-digital-learning-eda-w-b\npath = '..\/input\/learnplatform-covid19-impact-on-digital-learning\/engagement_data' \nall_files = glob.glob(path + \"\/*.csv\")\n\nli = []\n\nfor filename in all_files:\n    df = pd.read_csv(filename, index_col=None, header=0)\n    district_id = filename.split(\"\/\")[4].split(\".\")[0]\n    df[\"district_id\"] = district_id\n    li.append(df)\n    \nengagement_df = pd.concat(li)\nengagement_df = engagement_df.reset_index(drop=True)\nengagement_df['district_id'] = engagement_df['district_id'].astype(int)","814cb252":"engagement_df.head()","1291fea5":"with nicaviz.timer(\"Join\"):\n    df = pd.merge(engagement_df, districts_info, on='district_id', how='left')\n    df = pd.merge(df, products_info, on=\"lp_id\", how=\"left\")\n    df['time'] = pd.to_datetime(df['time'])\n\n# with nicaviz.timer(\"Reduce Memory\"):\n#     df, na_list = nicaviz.reduce_mem_usage(df, nan_fill=0)\n    \n# del engagement_df; del districts_info","3d5d4707":"display(df.head())\ndisplay(df.nica.categorical_describe())","e5d94717":"categoricals = [\n    'Provider\/Company Name',\n    'Sector(s)',\n    \"locale\",\n    'Primary Essential Function',\n    \"pct_black\/hispanic\",\n    \"pct_free\/reduced\",\n    \"county_connections_ratio\",\n    \"pp_total_raw\"\n]\ncontinuous = ['pct_access', 'engagement_index']\n\ntimevars = ['time']","a9a6a71e":"# clip continuous vars\nfor col in ['pct_access', 'engagement_index']:\n    df[col] = df[col].clip(0, df[col].quantile(.95))","851426ff":"with nicaviz.timer(\"Timeserie Resample Plot\"):\n    df.nica.mass_plot(\n        plt_set= [\"time\"],\n        plottype = \"ts_resample\",\n        resample=True,\n        resample_interval=\"1W\"\n    )","f993b344":"with nicaviz.timer(\"Timeserie Rolling Plot\"):\n    df.sample(50000).nica.mass_plot(\n        plt_set= continuous,\n        plottype = \"ts_rolling\",\n        x_var=\"time\",\n        rolling=True,\n        r=30\n    )","0e6aa76c":"with nicaviz.timer(\"Boxplots\"):\n    df.nica.mass_plot(\n        plt_set= continuous,\n        plottype = \"boxplot\")","a12d0268":"categoricals = [\n    'Sector(s)',\n    \"locale\",\n    \"pct_black\/hispanic\",\n    \"pct_free\/reduced\",\n    \"county_connections_ratio\",\n    \"pp_total_raw\"\n]\n\nwith nicaviz.timer(\"Small Hue Boxplots\"):\n    for hue_col in categoricals:\n        df.nica.mass_plot(\n            plt_set= continuous,\n            hue = hue_col,\n            columns = 2,\n            plottype = \"boxplot\")","c4b7ac3d":"with nicaviz.timer(\"Primary Essential Function Hue Boxplots\"):\n    df.nica.mass_plot(\n        plt_set= continuous,\n        hue = \"Primary Essential Function\",\n        columns = 1,\n        figsize = [14,18],\n        plottype = \"boxplot\")","0906701b":"with nicaviz.timer(\"Provider\/Company Name Hue Boxplots\"):\n    df.nica.mass_plot(\n        plt_set= continuous,\n        hue = \"Provider\/Company Name\",\n        columns = 1,\n        figsize = [14,80],\n        plottype = \"boxplot\")","ec443b8b":"categoricals = [\n    'Sector(s)',\n    \"locale\",\n    \"pct_black\/hispanic\",\n    \"pct_free\/reduced\",\n    \"county_connections_ratio\",\n    \"pp_total_raw\"\n]\n\nwith nicaviz.timer(\"Pivot Heatmap Plot\"):\n    for cont_col in continuous:\n        df.nica.pivot_plots(\n            categoricalcols = categoricals,\n            valuecol = cont_col,\n            aggfunc = np.mean,\n            figsize = [15,35],\n            columns = 2)","83bde7da":"print(\"Notebook Runtime: %0.2f Minutes\"%((time.time() - notebookstart)\/60))","f678ba91":"## Continuous Variables","1ac7f671":"## TimeSeries","d12f52bb":"# Covid Digital Learning Data Exploration\n_By Nick Brooks, September 2021_"}}