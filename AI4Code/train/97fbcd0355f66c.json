{"cell_type":{"6b53460d":"code","08b913ae":"code","0e977d29":"code","60dc634b":"code","3cb7e545":"code","a3609658":"code","a83d2d64":"code","9249592d":"code","c392f3ac":"code","c5899fce":"code","467d7f76":"code","ec839334":"code","74f46b31":"markdown"},"source":{"6b53460d":"import numpy as np\nimport pandas as pd\nimport keras\nimport keras.backend as K\nfrom keras.optimizers import Adam\nfrom keras.models import Sequential\nfrom keras.utils import Sequence\nfrom keras.layers import *\nimport matplotlib.pyplot as plt\nfrom sklearn.model_selection import train_test_split","08b913ae":"path = '..\/input\/sudoku\/sudoku.csv'\ndata = pd.read_csv(path)\ntry:\n    data = pd.DataFrame({\"quizzes\":data[\"puzzle\"],\"solutions\":data[\"solution\"]})\nexcept:\n    pass\ndata.head()","0e977d29":"data.info()","60dc634b":"print(\"Quiz:\\n\",np.array(list(map(int,list(data['quizzes'][0])))).reshape(9,9))","3cb7e545":"print(\"Solution:\\n\",np.array(list(map(int,list(data['solutions'][0])))).reshape(9,9))","a3609658":"class DataGenerator(Sequence):\n    def __init__(self, df, batch_size=16, subset=\"train\"):\n        super().__init__()\n        self.df = df\n        self.batch_size = batch_size\n        self.subset = subset\n        self.on_epoch_end()\n        \n    def __len__(self):\n        return int(np.floor(len(self.df)\/self.batch_size))\n    \n    def on_epoch_end(self):\n        self.indexes = np.arange(len(self.df))\n        np.random.shuffle(self.indexes)\n            \n    def __getitem__(self,index):\n        \n        X = np.empty((self.batch_size, 9,9,1))\n        y = np.empty((self.batch_size,81,1))\n        \n        indexes = self.indexes[index*self.batch_size:(index+1)*self.batch_size]\n        \n        for i,f in enumerate(self.df['quizzes'].iloc[indexes]):\n            X[i,] = (np.array(list(map(int,list(f)))).reshape((9,9,1))\/9)\n            \n        for i,f in enumerate(self.df['solutions'].iloc[indexes]):\n            y[i,] = np.array(list(map(int,list(f)))).reshape((81,1))-1\n            \n        return X, y","a83d2d64":"train_idx = int(len(data)*0.95)\ndata = data.sample(frac=1).reset_index(drop=True)\ntraining_generator = DataGenerator(data.iloc[:train_idx], batch_size=640)\nvalidation_generator = DataGenerator(data.iloc[train_idx:], batch_size=640)","9249592d":"model = Sequential([\n    Conv2D(64, kernel_size=(3,3), activation='relu', input_shape=(9,9,1)),\n    Flatten(),\n    Dense(81*9*3, activation='relu'),    \n    Dropout(.2),\n    Dense(81*9*2, activation='relu'),\n    Dropout(.2),\n    Dense(81*9, activation='relu'),\n    Reshape((-1, 9)),\n    Activation('softmax'),\n])\n\nmodel.compile(loss='sparse_categorical_crossentropy', optimizer='adam', metrics=['accuracy'])\n\nmodel.summary()","c392f3ac":"history = model.fit(training_generator, validation_data=validation_generator, epochs=3, verbose=1)","c5899fce":"def plot_loss(history):\n    plt.plot(history.history['loss'], label='loss')\n    plt.plot(history.history['val_loss'], label='val_loss')\n    plt.xlabel('\u00c9pocas')\n    plt.ylabel('Erro')\n    plt.legend()\n    plt.grid(True)\n\n\ndef plot_acc(history):\n    plt.plot(history.history['accuracy'], label='acc')\n    plt.plot(history.history['val_accuracy'], label='val_acc')\n    plt.xlabel('\u00c9pocas')\n    plt.ylabel('Acur\u00e1cia')\n    plt.legend()\n    plt.grid(True)","467d7f76":"plot_loss(history)","ec839334":"plot_acc(history)","74f46b31":"# Deep Sudoku "}}