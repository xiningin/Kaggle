{"cell_type":{"112a9e4b":"code","7f0d391b":"code","7629c521":"code","f82a1999":"code","b1bcfa7b":"code","5177b7fb":"code","bd78351a":"code","4f35d7e6":"code","b20bbd02":"code","838b12ec":"code","93a0c4ef":"code","dae542ba":"code","c5be1b6b":"code","bc9ef2f3":"code","3eec6e28":"code","613c34a7":"code","2ea8f27f":"code","e815c07d":"code","d60ec09c":"code","7ab915c4":"code","1f4c502f":"code","0c41315c":"code","08c4ba7c":"code","5dfd5e1c":"code","b98769a3":"code","aab0524f":"code","d9056115":"code","d201d6e1":"markdown","fa2ffd07":"markdown","ee48fd22":"markdown","79fd3b9f":"markdown","abf53c75":"markdown","6c6d1687":"markdown","585b79b0":"markdown","eb7dc2bf":"markdown","c5a28080":"markdown","2de0e70e":"markdown","9364233c":"markdown","49ae8240":"markdown","18cdc8f6":"markdown","7b07d69c":"markdown","131dcaf8":"markdown","841f71a5":"markdown","a3677abf":"markdown","c71969a9":"markdown","809980c6":"markdown","c705f5e8":"markdown","65369845":"markdown","8fe39694":"markdown","2a15054b":"markdown","336020fc":"markdown","cafeaa53":"markdown"},"source":{"112a9e4b":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport re\n\n# SKLEARN Modules\nfrom sklearn import metrics\nfrom sklearn.neighbors import KNeighborsClassifier as knn \nfrom sklearn.model_selection import train_test_split as tts\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.decomposition import PCA\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.linear_model import LinearRegression\n\n# Plotting Libraries\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly.express as px\nimport plotly.graph_objects as go\n\n# Setting Graph styles to seaborn\nplt.style.use(\"seaborn\")\n%matplotlib inline\n\n# OS Module\nimport os","7f0d391b":"# Random Color Generator (length) => (list of colors randomly generated)\ndef random_colors(length=1):\n    hexnum = \"0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f\".split(\",\")\n    codes = []\n    for i in range(length):\n        code = []\n        for i in range(6):\n            code.append(hexnum[np.random.randint(0,15)])\n        code = \"\".join(code)\n        codes.append(\"#\" + code)\n    return codes","7629c521":"df = pd.read_csv(\"..\/input\/red-wine-quality-cortez-et-al-2009\/winequality-red.csv\") # Load the Dataset\ndf.columns = [re.sub(\"\\s+\",\"_\",x) for x in list(df.columns)] # Remove Spaces from the columns\nfeatures = list(df.columns)[:-1] # 'features' is list of all features \nprint(\"Total Number of NULL VALUES:\",df.isnull().sum().sum()) # Check for Null Values\ndf.info() # General Info about the Dataset","f82a1999":"# Adding a 'labels' feature that denotes quality of wine\ndf[\"labels\"] = df[\"quality\"].copy()\ndf[\"labels\"].replace({3:\"low\",4:\"low\",5:\"avg\",6:\"avg\",7:\"high\",8:\"high\"},inplace=True)\nhigh = df.where(df[\"labels\"] == \"high\").dropna().reset_index(drop=True)\navg = df.where(df[\"labels\"] == \"avg\").dropna().reset_index(drop=True)\nlow = df.where(df[\"labels\"] == \"low\").dropna().reset_index(drop=True)\ndf.head()","b1bcfa7b":"codes = {\n    \"fixed_acidity\":\"fa\",\n    \"volatile_acidity\": \"va\",\n    \"citric_acid\":\"ca\",\n    \"residual_sugar\":\"rs\",\n    \"chlorides\":\"chl\",\n    \"free_sulfur_dioxide\":\"fsd\",\n    \"total_sulfur_dioxide\":\"tsd\",\n    \"density\":\"sg\",\n    \"pH\":\"pH\",\n    \"sulphates\":\"sul\",\n    \"alcohol\":\"alch\",\n    \"quality\":\"q\"\n}\ncodes_inv = dict(map(reversed, codes.items()))\ndesc = pd.DataFrame()\nfor dat,name in zip([df,high,low,avg],[\"all\",\"high\",\"low\",\"avg\"]):\n    tmp = dat.describe()\n    tmp.columns = [codes[x] +\"_\" + name for x in list(tmp.columns)]\n    tmp = tmp.transpose().drop([\"count\"],axis=1).round(2)\n    desc = desc.append(tmp)","5177b7fb":"def plot_ct(i):\n    plt.figure(figsize=(30,10))\n    n = 0\n    for j in [\"mean\",\"std\",\"min\",\"max\"]:\n        n+=1\n        plt.subplot(2,2,n)\n        plt.subplots_adjust(hspace=0.4)\n        ax = sns.barplot(data=desc.loc[[i+\"_all\",i+\"_high\",i+\"_low\",i+\"_avg\"]],x=[\"fa_all\",\"fa_high\",\"fa_low\",\"fa_avg\"],y=j)\n        plt.title(codes_inv[i] +\" \"+ j,fontdict={'fontsize': 24},)\n        ax.tick_params(labelsize=14)\n    plt.show()","bd78351a":"plot_ct(\"fa\")","4f35d7e6":"plot_ct(\"va\")","b20bbd02":"plot_ct(\"ca\")","838b12ec":"plot_ct(\"rs\")","93a0c4ef":"plot_ct(\"chl\")","dae542ba":"plot_ct(\"fsd\")","c5be1b6b":"plot_ct(\"sul\")","bc9ef2f3":"plot_ct(\"alch\")","3eec6e28":"# Checking Data Distribution\nfig = px.pie(df, values='quality',names='quality',hover_data=['quality'])\nfig.show()\nprint(\"\\033[1m THE CLASSES [3,4,7,8] ARE UNDER-SAMPLED \\033[0m \\n\")\nplt.figure(figsize=(25,6))\nsns.countplot(data=df,x=\"labels\")\nplt.show()","613c34a7":"fig = go.Figure()\ncolors = random_colors(11)\nfor i,color in zip(features,colors):\n    fig.add_trace(go.Box(\n        y = df[i],\n        x = df[\"labels\"],\n        name=i,\n        marker_color= color\n    ))\nfig.update_layout(\n    xaxis=dict(title='Box-Plot', zeroline=False),\n    boxmode='group'\n)\nfig.show()","2ea8f27f":"g = sns.pairplot(df.where(df[\"labels\"] != \"avg\").dropna().drop([\"quality\"],axis=1),\n                 hue=\"labels\",\n                 diag_kind=\"kde\",\n                 palette='Dark2',\n                 markers=[\"o\",\"s\"])\ng.map_lower(sns.kdeplot,levels=2,color=\".2\")\nplt.show()","e815c07d":"plt.figure(figsize=(16,10))\nmask = np.triu(np.ones_like(df.corr(), dtype=np.bool))\nsns.heatmap(df.corr(),cmap='BrBG',annot=True,vmin=-1, vmax=1,mask=mask)\nplt.show()","d60ec09c":"set1 = [\"citric_acid\",\"density\",\"pH\",\"citric_acid\",\"citric_acid\",\"free_sulfur_dioxide\",\"density\"]\nset2 = [\"fixed_acidity\",\"fixed_acidity\",\"fixed_acidity\",\"volatile_acidity\",\"pH\",\"total_sulfur_dioxide\",\"alcohol\"]","7ab915c4":"sns.jointplot(data=df, x=set1[0], y=set2[0], kind=\"hist\",hue=\"labels\")\nplt.show()","1f4c502f":"ax = sns.jointplot(data=df, x=set1[1], y=set2[1], kind=\"hist\",hue=\"labels\")\nplt.show()\nprint(\"\"\"\nIf the density of the wine is higher, the fixed acidity must be increased propotionally.\nA plot of only high quality wines to find propotionality constant.\n\"\"\")\nlr = LinearRegression()\nlr.fit(high[\"fixed_acidity\"].values.reshape(-1,1),high[\"density\"].values.reshape(-1,1))\nprint(f\"Fixed Acidity = {lr.coef_[0][0]:.6f}*Density + {lr.intercept_[0]:.3f} this equation is true for High Quality Wines\")","0c41315c":"# A Function to evaluate the results\ndef evaluate(model,X_test,y_test):\n    y_pred = model.predict(X_test)\n    y_proba = model.predict_proba(X_test)\n    print(f\"Accuracy Score: {metrics.accuracy_score(y_test,y_pred)}\")\n    print(metrics.classification_report(y_test,y_pred,zero_division=1))\n    print(f\"ROC AUC SCORE: {metrics.roc_auc_score(y_test,y_proba, multi_class='ovr')}\")","08c4ba7c":"X = df.iloc[:,:-1]\ny = df.iloc[:,-1]\nX_train,X_test,y_train,y_test = tts(X,y,test_size = 0.33,random_state = 0)\n\n# Create Pipeline \npipe = Pipeline([\n        ('scale', StandardScaler()),\n        ('reduce_dims',PCA()),\n        ('model', knn())])\n\nparam_grid = dict(model__n_neighbors=range(10),reduce_dims__n_components=[2,4,5,6])\n\n# Grid Search\ngrid = GridSearchCV(pipe, param_grid=param_grid, cv=3, n_jobs=3,scoring='accuracy')\ngrid.fit(X_train,y_train)\nprint(f\"Best Score : {grid.best_score_}\")\nprint(f\"Best Parameters : {grid.best_params_}\")","5dfd5e1c":"evaluate(grid,X_test,y_test) # This is pure test data, UNTOUCHED","b98769a3":"plt.figure(figsize=(25,10))\nfor i in [\"split0_test_score\",\"split1_test_score\",\"split2_test_score\"]:\n    line = plt.plot(grid.cv_results_[i],\"ro\")\n    plt.legend()\nplt.plot(grid.cv_results_[\"mean_test_score\"])\nplt.show()","aab0524f":"plt.figure(figsize=(20,8))\npx.scatter(df,y=\"alcohol\",x=\"volatile_acidity\",color=\"quality\")","d9056115":"X = df.drop([\"labels\"],axis=1).iloc[:,:-1]\ny = df.drop([\"labels\"],axis=1).iloc[:,-1]\nX_train,X_test,y_train,y_test = tts(X,y,test_size = 0.33,random_state = 0)\n\n# Linear Regression\nclf = LinearRegression()\nclf.fit(X_train,y_train)\nprint(f\"Mean Squared Error of Linear Regression model = {metrics.mean_squared_error(clf.predict(X_test),y_test)}\")","d201d6e1":"Linear Regression will give us better results, when compared to classification using KNN","fa2ffd07":"> Wine Makers can choose to either add or avoid Citric Acid, so minimum values are zero.\n\n    Citric acid is generally found in very small quantities in wine grapes.\n    It acts as a preservative and is added to wines to increase acidity, complement a specific flavor or prevent ferric hazes.\n    It can be added to finished wines to increase acidity and give a \u201cfresh\u201d flavor. Excess addition, however, can ruin the taste.\n\n> Explains why most Low Quality wines don't have added citric acid, and high quality wines have a lower maximum citric acid value compared to the others.\n  This is because too much ruins the taste, High quality wines have the perfect amount of citric acid in them.\n\n> Mathematically, note that the Coefficient of Variance will be higher for Low Quality Wines, (std\/mean)\n  indicating that they are very randomly varying, between 0 to 1.\n  Either being too low or too high both cases being bad for the wine.\n\n> High Quality wines have a very low value of Coefficient of Variance, indicating higher consistency, of around 0.35 to 0.65","ee48fd22":"# If you like the notebook, please do leave an upvote","79fd3b9f":"# [Streamlit App](https:\/\/github.com\/saai-sudarsanan-d\/Red-Wine-Quality-App)","abf53c75":"# Introduction","6c6d1687":"    Sulfates are salts of sulfuric acid. They aren\u2019t involved in wine production, but some beer makers use calcium sulfate\u200a\u2014\u200aalso known as brewers\u2019 gypsum\u200a\u2014\u200ato correct mineral deficiencies in water during the brewing process. It also adds a bit of a \u201csharp\u201d taste.\n \n> The sharp taste cause due to higher levels of CaSO4 in the range of 0.4 to 1, gives it a sharp taste, enhancing the feel.","585b79b0":"**There is not a lot of decisive factors in fixed acidity**\n* It looks like Low Quality wines have slightly lower levels of fixed acidity.","eb7dc2bf":"# Linear Regression","c5a28080":"> Average Wines, have higher levels of Free Sulphur Dioxide, Low Quality Ones have the lower levels. High Quality wines however, have this is in the right propotions, in the range of 3 to 55.","2de0e70e":"    Residual Sugar, or RS for short, refers to any natural grape sugars that are leftover after fermentation ceases (whether on purpose or not).\n    The juice of wine grapes starts out intensely sweet, and fermentation uses up that sugar as the yeasts feast upon it.\n    During winemaking, yeast typically converts all the sugar into alcohol making a dry wine. However, sometimes not all the sugar is fermented by the yeast,\n    leaving some sweetness leftover.\n    To make a wine that tastes good, the key is to have a perfect balance between the sweetness and the sourness in the drink.\n\n> The Data on close analysis shows that the Low Quality Wines might be oversweet, due to excess Residual Sugars.\n    All central tendancies are higher than other for Low Quality wines.\n\n> A Residual Sugar quantity range of 1.2 to 9 will help attain the balance if sweetness and sourness in the wine, making it High Quality.","9364233c":"# DATA","49ae8240":"*There are no null values in the dataset, all the features are of type 'float' while the target \"quality\" is of type 'int'*","18cdc8f6":"* If Quality >= 7       **High Quality**\n* If Quality in [5,6]   **Average Quality**\n* If Quality <= 4       **Low Quality**","7b07d69c":"# Import Libraries","131dcaf8":"![](https:\/\/assets.entrepreneur.com\/content\/3x2\/2000\/20190212131344-wine-541922.jpeg)","841f71a5":"> If Both Citric Acid and Fixed Acidity levels are low, then the wine is rated low quality\n\n> If Both of these are high, the quality is mostly either Average or High.\n\n    High if these levels are neither too high nor too low\n\n    In order to produce good quality wine, citric acid levels must be 0.1+\n\n    In order to produce high quality wine, it must follow the above criterion and additionally have fixed acid levels in range of 5 to 11, \n    as long as the citric acid level is in range of 0.3 to 0.7","a3677abf":"# Model","c71969a9":"> Chlorides look like, they worsen the taste or add unpleasant elements to the wine.\n\n> Low Quality Wines have higher levels of Chlorides.\n\n    The amount of chlorides present in a wine is usually an indicator of its \u201csaltiness.\u201d This is usually influenced by the territory where the wine grapes grew, cultivation methods, and also the grape type. Too much saltiness is considered undesirable. The right proportion can make the wine more savory.\n\n> High Quality Wines have chloride levels in the range of 0.01 to 0.35, unlike the low quality ones that have excessive amounts. ","809980c6":"# ANALYSIS","c705f5e8":"## Data Analysis","65369845":"* **Fixed Acidity** : Measurement of the total concentration of titratable acids and free hydrogen ions present in your wine.\n\n* **Volatile Acidity** : Volatile acidity could be an indicator of spoilage, or errors in the manufacturing processes\u200a\u2014\u200acaused by things like damaged grapes, wine exposed to air, and so on.\n\n* **Citric Acid** : Citric acid is generally found in very small quantities in wine grapes. It acts as a preservative and is added to wines to increase acidity, complement a specific flavor or prevent ferric hazes. Excess addition, however, can ruin the taste.\n\n* **Residual Sugar** : Any natural grape sugars that are leftover after fermentation ceases (whether on purpose or not). \n\n* **Chlorides** : The amount of chlorides present in a wine is usually an indicator of its \u201csaltiness.\u201dToo much saltiness is considered undesirable. The right proportion can make the wine more savory. \n\n* **Sulfur-Di-Oxide**: Sulfur dioxide exists in wine in free and bound forms, and the combinations are referred to as total SO2. It\u2019s the most common preservative used, usually added by wine makers to protect the wine from negative effects of exposure to air and oxygen. It acts as a sanitizing agent\u200a\u2014\u200aadding it usually kills unwanted bacteria or yeast that might enter the wine and spoil its taste and aroma.\n\n* **Density** : Used to measure the alcohol concentration in wines. Sweeter wines generally have higher densities.\n\n* **pH** : pH stands for power of hydrogen, which is a measurement of the hydrogen ion concentration in the solution. Sulfates are salts of sulfuric acid.\n\n* **Sulphates** : They aren\u2019t involved in wine production, but some beer maker\u2014to correct mineral deficiencies in water during the brewing process. It also adds a bit of a \u201csharp\u201d taste.\n\n* **Alcohol** : Drinking it in small amounts gives you warm fuzzy feelings inside, and makes you more sociable. Of-course, higher doses can also make you pass out.","8fe39694":"> It is clear here that Low Quality Wines have high levels of volatile acidity, this is only natural .\n\n    Volatile acidity could be an indicator of spoilage, or errors in the manufacturing processes\u200a\u2014\u200acaused by things like damaged grapes, wine exposed to air, and so on. \n    This causes acetic acid bacteria to enter and thrive, and give rise to unpleasant tastes and smells.\n\n> High Quality Wines have low levels of Volatile Acidity.\n\n> Volatile Acidity Levels are inversely propotional to the quality","2a15054b":"> High Quality wines seem to have higher levels of alcohol, though not extremely high.","336020fc":"***The dataset contains a total of 1599 wine [feature,quality] pairs, out of these though, many are of average quality, some are of high quality, and very few are of low quality, the dataset is imbalanced.***","cafeaa53":"*'Red is a type of wine made from dark-colored grape varieties. The actual color of the wine can range from intense violet, typical of young wines, through to brick red for mature wines and brown for older red wines. The juice from most purple grapes is greenish-white, the red color coming from anthocyan pigments (also called anthocyanins) present in the skin of the grape; exceptions are the relatively uncommon teinturier varieties, which produce a red-colored juice. Much of the red-wine production process therefore involves extraction of color and flavor components from the grape skin. It is a delicacy around the world.*"}}