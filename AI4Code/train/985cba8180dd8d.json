{"cell_type":{"6debc279":"code","75c1e9b4":"code","b95d7438":"code","f79fc4b5":"code","50c893e5":"code","be74eee4":"code","2da586fd":"code","5a7c7975":"code","5ff6bcde":"code","a7a0e0cf":"code","935ac5d2":"code","a989efea":"code","0d7999a8":"code","a76fedbd":"code","35bebcb8":"code","adfa53c7":"code","99646828":"code","d3503c40":"code","6f0d723c":"code","84f92071":"markdown","c97da1f5":"markdown","ca3e0a3d":"markdown","8d3b73b9":"markdown","a517d0cc":"markdown","592e3236":"markdown","585e1dc4":"markdown","fdd11221":"markdown","8ac4d25f":"markdown","47fe0264":"markdown","6c04448e":"markdown","b1226ce3":"markdown","adeb14ad":"markdown","cbd002c0":"markdown"},"source":{"6debc279":"import pandas as pd \nimport numpy as np \nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport datetime as dt\nimport time\nfrom statsmodels.tsa.holtwinters import Holt\nfrom statsmodels.tsa.arima_model import ARIMA\n# Simple Exponential Smoothing\nfrom statsmodels.tsa.holtwinters import ExponentialSmoothing\nfrom sklearn import metrics\n#pd.set_option('display.max_columns',None)\n#pd.set_option('display.max_rows',None)","75c1e9b4":"#Frankfurt stock exchange\ndf=pd.read_csv('\/kaggle\/input\/frankfurt-stock-exchange\/frankfurt_stock_exchange.csv',parse_dates=['Date'])#,index_col='Date')\nprint(df.info())\ndf.head()","b95d7438":"df.drop(columns=['Change','Last Price of the Day','Daily Traded Units','Daily Turnover','Turnover','Traded Volume'],inplace=True)\ndf.head()","f79fc4b5":"data = df.interpolate(method='linear')\ndata","50c893e5":"data = data[169:]\ndata['year'] = pd.DatetimeIndex(data['Date']).year\ndata['month'] = [d.strftime('%b') for d in data.Date]\ndata['day'] = pd.DatetimeIndex(data['Date']).dayofweek\ndata.set_index('Date',inplace=True)","be74eee4":"data","2da586fd":"# Draw Plot\nfig, axes = plt.subplots(3, 1, figsize=(20,15), dpi= 80)\nsns.boxplot(x='year', y='Close', data=data, ax=axes[0])\nsns.boxplot(x='month', y='Close', data=data,ax = axes[1])\nsns.boxplot(x='day', y='Close', data=data,ax = axes[2])\n\n# Set Title\naxes[0].set_title('Year-wise Box Plot\\n(The Trend)', fontsize=18); \n\naxes[1].set_title('Month-wise Box Plot\\n(The Seasonality)', fontsize=18)\n\naxes[2].set_title('Day-wise Box Plot\\n(The Seasonality)', fontsize=18)\nplt.show()","5a7c7975":"plt.plot(data['Close'])","5ff6bcde":"from statsmodels.tsa.seasonal import seasonal_decompose\nfrom dateutil.parser import parse\n\n# Import Data\n# Multiplicative Decomposition \n#result_mul = seasonal_decompose(data['Total_Sunspots'], model='multiplicative', extrapolate_trend='freq')\n\n# Additive Decomposition\nresult_add = seasonal_decompose(data['Close'], model='add', extrapolate_trend='freq',freq=5)\n\n# Plot\nplt.rcParams.update({'figure.figsize': (5,5)})\n#result_mul.plot().suptitle('Multiplicative Decompose', fontsize=22)\nresult_add.plot().suptitle('Additive Decompose', fontsize=22)\nplt.show()","a7a0e0cf":"data['rolling_mean'] = data['Close'].rolling(12).mean()\ndata['Detrend'] = data['Close'] - data['rolling_mean']\nplt.plot(data['rolling_mean'])\nplt.title('Trend',fontsize=16)","935ac5d2":"from statsmodels.tsa.seasonal import seasonal_decompose\nresult_add = seasonal_decompose(data['Close'], model='mul', extrapolate_trend='freq',freq=96)\ndeseasonalized = data.Close.values -result_add.seasonal\nplt.plot(deseasonalized)\nplt.title('Drug Sales deseasonalized by subtracting the seasonal component', fontsize=16)","a989efea":"from pandas.plotting import autocorrelation_plot\n\n\n# Draw Plot\nplt.rcParams.update({'figure.figsize':(9,5), 'figure.dpi':120})\nautocorrelation_plot(data['Close'].tolist())","0d7999a8":"from statsmodels.tsa.stattools import acf, pacf\nfrom statsmodels.graphics.tsaplots import plot_acf, plot_pacf\n\n# Calculate ACF and PACF upto 50 lags\n# acf_50 = acf(df.value, nlags=50)\n# pacf_50 = pacf(df.value, nlags=50)\n\n# Draw Plot\nfig, axes = plt.subplots(1,2,figsize=(16,3), dpi= 100)\nplot_acf(data['Close'].tolist(), lags=200, ax=axes[0])\nplot_pacf(data['Close'].tolist(), lags=50, ax=axes[1])","a76fedbd":"count = int(data.shape[0]*0.8)\nTrain = data[:count]\nTest = data[count:]\n\ny_hat_avg = Test.copy()\nfit1 = Holt(np.asarray(Train['Close'])).fit()\ny_hat_avg['Holt_Winter'] = fit1.predict(start=count+1,end=data.shape[0])\nplt.figure(figsize=(16,8))\nplt.plot(Train.index, Train['Close'], label='Train')\nplt.plot(Test.index,Test['Close'], label='Test')\nplt.plot(y_hat_avg.index,y_hat_avg['Holt_Winter'], label='Holt_Winter')\nplt.legend(loc='best')","35bebcb8":"new = data[['Close']]","adfa53c7":"Train, Test = new.iloc[:count,0], new.iloc[count:,0]\nhistory = [x for x in Train]","99646828":"predictions = []\nlower_list = []\nupper_list = []\nfor t in range(len(Test)):\n    model = ARIMA(history, order=(2,1,0))\n    model_fit = model.fit(disp=0)\n    output = model_fit.forecast()\n    yhat = output[0]\n    lower = output[2][0][0]\n    upper = output[2][0][1]\n    predictions.append(yhat)\n    lower_list.append(lower)\n    upper_list.append(upper)\n    obs = Test[t]\n    history.append(obs)\n    print('predicted=%f, expected=%f' % (yhat, obs))","d3503c40":"error = metrics.mean_squared_error(Test, predictions)\nprint('Test MSE: %.3f' % error)","6f0d723c":"# plot\nplt.plot(Test.values,color='black')\nplt.plot(lower_list,color='red')\nplt.plot(upper_list,color='green')\nplt.plot(predictions)\nplt.show()","84f92071":"Detrending the data manually.","c97da1f5":"Pandas autocorrelation plot helps to find the dependency of current value on previous values. As there are no patterns in the below plot we cannot get any intuition.","ca3e0a3d":"Let's check the plot of closing price","8d3b73b9":"## Holt Winter's\n\nHalt Winters model doesn't work well on the data. It basically predicts according the the trend. ","a517d0cc":"Filling null values by interpolation method","592e3236":"Below is the plot for orginal test data values, predicted values and confidance interval.","585e1dc4":"## ARIMA model","fdd11221":"Performing seasonal decompose. You can see the trend in the data. It is trying to find out seasonality but since there is no seasonality in the data, it is filled with blue color. Also notice that there is no pattern in the residue.","8ac4d25f":"Dropping uneccessary columns","47fe0264":"We make a list for training data and we will be predicting next day's closing price with this data. Later the predicted value is appended to training data and next day's value is predicted again. This is repeated for all the test data.\n\n\nARIMA's forecast function gives 4 outputs.\n\npredicted value\n\nstandard error\n\nlower and upper confidance values which are very important when predicting on time series data.\n","6c04448e":"Below plots of autocorrelation and partial autocorrelation play important role in determing the p and q values for ARIMA.","b1226ce3":"If we see the trend and seasonality plots, there is some trend in the data but there is no seasonality\n either in weekdays or in months.","adeb14ad":"Creating separate columns for year,month and day. This helps us to check trend and seasonality in the data.","cbd002c0":"Deseasonalizing the data with seasonal decompose. Since it doesn't have any seasonality, plot doesn't change much."}}