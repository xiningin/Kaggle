{"cell_type":{"fb6e224d":"code","b678e3b8":"code","e66b2a05":"code","e0667bde":"code","7f41d4c8":"code","d30612d8":"code","1b177bcd":"code","a27e4f72":"code","a4e9e2ae":"code","3067e178":"code","0006946f":"code","ed03f9c1":"code","f7553245":"code","ba8c6067":"code","2456ffcb":"code","5efa20cb":"code","06aa789d":"code","b99fcbef":"markdown"},"source":{"fb6e224d":"from fastai.tabular.all import *\nfrom sklearn.metrics import mean_squared_log_error","b678e3b8":"path = Path('..\/input\/store-sales-time-series-forecasting')\nPath.BASE_PATH = path\npath.ls()","e66b2a05":"train_df = pd.read_csv(path\/'train.csv')\ntransaction_df = pd.read_csv(path\/'transactions.csv')\ntest_df = pd.read_csv(path\/'test.csv')\nsub_df = pd.read_csv(path\/'sample_submission.csv')\ntrain_df.shape, transaction_df.shape, test_df.shape, sub_df.shape","e0667bde":"train_df.head(3)","7f41d4c8":"splits = RandomSplitter(valid_pct=0.2)(range_of(train_df))","d30612d8":"tab_pd = TabularPandas(train_df, \n                       procs = [Categorify, FillMissing, Normalize],\n                       cat_names=['store_nbr', 'family'],\n                       cont_names =['onpromotion'],\n                       y_names = 'sales',\n                       splits = splits)","1b177bcd":"dls = tab_pd.dataloaders(bs=512)","a27e4f72":"len(dls.train), len(dls.valid)","a4e9e2ae":"dls.show_batch()","3067e178":"train_df.sales.max()","0006946f":"def rmsle(inp, targ):\n    inp = inp.detach().cpu().numpy()\n    targ = targ.detach().cpu().numpy()\n    return np.sqrt(mean_squared_log_error(targ, inp))","ed03f9c1":"learner = tabular_learner(dls, metrics=rmsle, y_range=(0, 125000))","f7553245":"learner.fit_one_cycle(1)","ba8c6067":"dl = learner.dls.test_dl(test_df)","2456ffcb":"preds = learner.get_preds(dl=dl)\npreds[0].shape","5efa20cb":"sub_df.sales = preds[0].detach().cpu().numpy()\nsub_df.head(3)","06aa789d":"sub_df.to_csv('submission.csv', index=False)","b99fcbef":"I've not really played around with Tabular data before, so many things are missing and this is largely a regurgitation of the official fastai docs (https:\/\/docs.fast.ai\/tutorial.tabular.html). \n\nNeed to add some things such as incorporaing the dates (next up), transcation\/oil\/holiday data needs to be added as well, but V0 confirms pipeline can be used and output submitted to leaderboard\n\nThis can be run on a CPU, but if you invoke the GPU, it will be certainly be faster per epoch"}}