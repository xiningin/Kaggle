{"cell_type":{"bc43a19e":"code","a288e709":"code","7c14e76f":"code","49531656":"code","6df9f1d4":"code","2dddc175":"code","eac6ba9a":"code","ddac33c9":"code","11d5b5a1":"code","d3702920":"code","15e5cd76":"code","7bf7a9ac":"code","000f21ad":"code","cc21de08":"code","6b286b06":"markdown","7b252eeb":"markdown"},"source":{"bc43a19e":"import pandas as pd\nimport os\nimport gc\nfrom tqdm import tqdm\n\nimport mlb\nenv = mlb.make_env() # initialize the environment\niter_test = env.iter_test() # iterator which loops over each date in test set","a288e709":"ROOT_DIR = \"..\/input\/mlb-player-digital-engagement-forecasting\"","7c14e76f":"# Read train.csv\ntr = pd.read_csv(f\"{ROOT_DIR}\/train.csv\")\nprint(tr.shape)\ngc.collect()","49531656":"tr.head()","6df9f1d4":"# Create list from nextDayPlayerEngagement column\nN_DATES = tr.shape[0]\nd = []\nfor idx in tqdm(range(N_DATES)):\n    u = eval(tr.iloc[idx, 1])\n    d += u\n#================","2dddc175":"# Create DataFrame from list\ntgt_df = pd.DataFrame(d)\nprint(tgt_df.shape)","eac6ba9a":"# Add year column\ntgt_df['year'] = pd.DatetimeIndex(tgt_df['engagementMetricsDate']).year\ntgt_df['month'] = pd.DatetimeIndex(tgt_df['engagementMetricsDate']).month","ddac33c9":"tgt_df","11d5b5a1":"# Select only 2021\nnew_df = tgt_df[tgt_df['year'] == 2021]\nnew_df = new_df[new_df['month'] >= 4]\nnew_df","d3702920":"### group by playerId setting median\nplayer_mean = new_df.groupby([\"playerId\"])[[\"target1\",\"target2\",\"target3\",\"target4\"]].median().reset_index()\ngc.collect()\nprint(player_mean.shape)","15e5cd76":"player_mean.head()","7bf7a9ac":"def process_pred(df):\n    df[\"playerId\"] = df[\"date_playerId\"].apply(lambda x: int( x.split(\"_\")[1] ) )\n    df.drop([\"target1\",\"target2\",\"target3\",\"target4\"], axis=1, inplace=True)\n    df = df.merge(player_mean, on=\"playerId\", how=\"left\")\n    df.drop(\"playerId\", axis=1, inplace=True)\n    df = df.fillna(0.)\n    return df\n#===================","000f21ad":"for (test_df, sample_prediction_df) in iter_test:\n    sample_prediction_df = process_pred(sample_prediction_df)  # Create prediction\n    env.predict(sample_prediction_df)                          # Submit","cc21de08":"sample_prediction_df.head()","6b286b06":"Hello. This is my first competition.\n\nCredit to @ulrich07 and @mlconsult - I simply took their notebook and filtered out all but 2021 May and Apr player targets and then medianed for each player.\n\nHere is their noteboook that I forked.\n\nhttps:\/\/www.kaggle.com\/ulrich07\/baseline-model-player-mean-or-median\nhttps:\/\/www.kaggle.com\/mlconsult\/baseline-average-1-47","7b252eeb":"## COMPUTING PLAYER MEAN"}}