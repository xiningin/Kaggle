{"cell_type":{"2836dac2":"code","1b80300d":"code","af3442a9":"code","4022e737":"code","ce7c2098":"code","cb1a6f6a":"code","587dfb70":"code","42571aef":"code","189bb77d":"code","2cc10c5b":"code","92ef85ed":"code","84fcb752":"code","0a591bf4":"code","68955c61":"code","c8ff7987":"code","bce337fa":"code","c1098386":"code","1be6eeef":"code","c2781bad":"code","11d22aa3":"code","78b96ea3":"code","3acd29bb":"code","bd3152d5":"code","d82400ca":"code","bcd737e3":"code","c78d2c9c":"code","f422dd92":"code","2d9e8308":"code","753ddf89":"code","f217f8d3":"code","1431a516":"code","52c27f02":"code","9463946a":"code","a3fc479b":"code","d938c756":"markdown","0c53afb8":"markdown","5f31fe09":"markdown","e18800ac":"markdown","a1574f0e":"markdown","bd318963":"markdown","41bd2711":"markdown","3cac6d00":"markdown","8b95a224":"markdown","2684bc24":"markdown","d83becf0":"markdown","6863ccf3":"markdown","25d73a5a":"markdown","ea2a41eb":"markdown","e90c6c49":"markdown","3f895d7e":"markdown","75302309":"markdown","6a8b096d":"markdown","1c4aaa68":"markdown","1e70426f":"markdown","3c4d4dbb":"markdown","f3549c10":"markdown","70674a40":"markdown","b275ca37":"markdown","cbed0328":"markdown"},"source":{"2836dac2":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport warnings\nwarnings.filterwarnings('ignore')","1b80300d":"\ndf_store = pd.read_csv(\"\/kaggle\/input\/retaildataset\/stores data-set.csv\")\ndf_feature = pd.read_csv(\"\/kaggle\/input\/retaildataset\/Features data set.csv\",parse_dates=[\"Date\"])\ndf_sales = pd.read_csv(\"\/kaggle\/input\/retaildataset\/sales data-set.csv\",parse_dates=[\"Date\"])","af3442a9":"print(df_store.info())\nprint(df_store.head())","4022e737":"print(df_feature.info())\nprint(df_feature.head())","ce7c2098":"print(df_sales.info())\nprint(df_sales.head())","cb1a6f6a":"data_date = df_feature.groupby(\"Date\").agg({\"Temperature\":\"mean\"\n                                            ,\"Fuel_Price\":\"mean\"\n                                            ,\"IsHoliday\":\"sum\"\n                                            ,\"CPI\":\"mean\"\n                                           ,\"Unemployment\":\"mean\"})\ndata_date = data_date.sort_index()\ntemp_date_data = data_date[:'2012-12-10']\n\ndata_sales_date = df_sales.groupby(\"Date\").agg({\"Weekly_Sales\":\"sum\"})\ndata_sales_date.sort_index(inplace=True)\ndata_sales_date.Weekly_Sales = data_sales_date.Weekly_Sales\/1000000\ndata_sales_date.Weekly_Sales = data_sales_date.Weekly_Sales.apply(int)\ndata = pd.merge(data_sales_date, temp_date_data, left_index=True,right_index=True, how='left')\ndata[\"IsHoliday\"] = data[\"IsHoliday\"].apply(lambda x: True if x == 45.0 else False )\n","587dfb70":"print(data.describe())","42571aef":"plt.style.use('fivethirtyeight')\n#plt.figure(figsize=(15,4))\nfig, ax = plt.subplots(5,1,figsize=(15,10),sharex=True) \ndata[\"Weekly_Sales\"].plot(ax=ax[0],title=\"Weekly Sales\/sales on Holiday\")\ndata[data.IsHoliday==True][\"Weekly_Sales\"].plot(marker=\"D\",ax=ax[0],legend=\"Holiday Week sale\")\ndata[\"Temperature\"].plot(ax=ax[1], title=\"Temperature\")\ndata[\"Fuel_Price\"].plot(ax=ax[2],title=\"Fuel_Price\")\ndata[\"CPI\"].plot(ax=ax[3],title=\"CPI\")\ndata[\"Unemployment\"].plot(ax=ax[4],title=\"Unemployment\")\n","189bb77d":"sns.heatmap(data.corr(),annot=True)","2cc10c5b":"data_sales_month = data.groupby(data.index.month).agg({\"Weekly_Sales\":\"sum\"})\nplt.figure(figsize=(10, 5))\nsns.barplot(x=data_sales_month.index,y=data_sales_month.Weekly_Sales)\nplt.title(\"Month wise Sales\")\nplt.xlabel(\"Month\")\nplt.ylabel(\"Sales\")","92ef85ed":"data_sales_year = data.groupby(data.index.year).agg({\"Weekly_Sales\":\"sum\"})\n\nsns.barplot(x=data_sales_year.index,y=data_sales_year.Weekly_Sales)\nplt.title(\"Year wise Sales\")\nplt.xlabel(\"Year\")\nplt.ylabel(\"Sales\")\n","84fcb752":"from statsmodels.tsa.seasonal import seasonal_decompose\ndecomposition = seasonal_decompose(data[\"Weekly_Sales\"], period=45) ","0a591bf4":"plt.figure(figsize=(15, 7))\nplt.plot(decomposition.trend)\nplt.plot(decomposition.seasonal)\nplt.plot(decomposition.resid)\nplt.legend([\"Trend\", \"Seasonal\",\"Resid\"], loc =\"upper right\") ","68955c61":"data_Store = df_feature.groupby(\"Store\").agg({\"Temperature\":\"mean\",\"Fuel_Price\":\"mean\",\"IsHoliday\":\"sum\"})\n\ntemp_store = df_sales.groupby(\"Store\").agg({\"Weekly_Sales\":\"sum\"})\ntemp_store.Weekly_Sales = temp_store.Weekly_Sales\/1000000\ntemp_store.Weekly_Sales = temp_store.Weekly_Sales.apply(int)\ndata_Store.set_index(np.arange(0,45),inplace=True)\ndf_store[\"temp\"] = data_Store.Temperature\ndf_store[\"Fuel_Price\"] = data_Store.Fuel_Price\ndf_store[\"holiday\"] = data_Store.IsHoliday\ndf_store[\"Weekly_Sales\"] = temp_store.Weekly_Sales","c8ff7987":"df_store.describe()","bce337fa":"fig,ax = plt.subplots(1,3,figsize=(15, 4))\nsns.countplot(df_store.Type,ax=ax[0])\nsns.swarmplot(data = df_store,y=\"Size\",x=\"Type\",ax=ax[1])\n\nsns.boxplot(data = df_store,y=\"Weekly_Sales\",x=\"Type\",ax=ax[2])\n\n","c1098386":"len(df_sales[\"Dept\"].unique())","1be6eeef":"data_Dept = df_sales.groupby(\"Dept\").agg({\"Weekly_Sales\":\"sum\"})\ndata_Dept.Weekly_Sales = data_Dept.Weekly_Sales\/10000\ndata_Dept.Weekly_Sales = data_Dept.Weekly_Sales.apply(int)\ndata_Dept.sort_values(by=\"Weekly_Sales\")","c2781bad":"fig1, ax1 = plt.subplots(figsize=(15, 4))\n#ordered_df = data_Dept.sort_values(by='Weekly_Sales')\nplt.vlines(x=data_Dept.index, ymin=0, ymax=data_Dept['Weekly_Sales'], color='skyblue')\nplt.plot(data_Dept.index,data_Dept['Weekly_Sales'], \"o\")\nplt.title(\"Departmentwise Sales\")\nplt.ylabel(\"Sales\")\nplt.xlabel(\"Department\")","11d22aa3":"sales_date_store = df_sales.groupby([\"Date\",\"Store\"]).agg({\"Weekly_Sales\":\"sum\"})\nsales_date_store.sort_index(inplace=True)\nsales_date_store.Weekly_Sales = sales_date_store.Weekly_Sales\/10000\nsales_date_store.Weekly_Sales = sales_date_store.Weekly_Sales.apply(int)\ndata_table = pd.merge(df_feature,sales_date_store ,  how='left', on=[\"Date\",\"Store\"])\ndata_table = pd.merge(data_table,df_store[[\"Store\",\"Type\"]] ,  how='left', on=[\"Store\"])\ndata_table.head(20)\ndata_train = data_table[data_table.Weekly_Sales.notnull()]\ndata_test = data_table[data_table.Weekly_Sales.isnull()]","78b96ea3":"plt.figure(figsize=(15, 5))\nsns.barplot(x=data_train.Date.dt.year, y=data_train.Weekly_Sales,hue=data_train.Type)","3acd29bb":"plt.figure(figsize=(15, 7))\nsns.barplot(x=data_train.Date.dt.month, y=data_train.Weekly_Sales,hue=data_train.Type)","bd3152d5":"plt.figure(figsize=(15,4))\ntrain_markdown = data_table[data_table.MarkDown2.notnull()]\ntrain_markdown = train_markdown.groupby(\"Date\").agg({\"MarkDown1\":\"mean\",\"MarkDown2\":\"mean\",\"MarkDown3\":\"mean\",\"MarkDown4\":\"mean\",\"MarkDown5\":\"mean\"})\n\n\nplt.plot(train_markdown.index,train_markdown.MarkDown1)\nplt.plot(train_markdown.index,train_markdown.MarkDown2)\nplt.plot(train_markdown.index,train_markdown.MarkDown3)\nplt.plot(train_markdown.index,train_markdown.MarkDown4)\nplt.plot(train_markdown.index,train_markdown.MarkDown5)\nplt.title(\"Timeline Markdown\")\nplt.ylabel(\"Markdown\")\nplt.xlabel(\"Date\")","d82400ca":"train_markdown.hist(figsize=(10,8),bins=6,color='Y')\n\nplt.tight_layout()\nplt.show()","bcd737e3":"train_markdown_month = train_markdown.groupby(train_markdown.index.month).agg({\"MarkDown1\":\"mean\",\"MarkDown2\":\"mean\",\"MarkDown3\":\"mean\",\"MarkDown4\":\"mean\",\"MarkDown5\":\"mean\"})\n\ntrain_markdown_month.plot(kind='bar', stacked=True,figsize=(15,6))\nplt.title(\"Stacked Monthwise Morkdown\")\nplt.ylabel(\"Markdown\")","c78d2c9c":"train_markdown_1 = data_table[data_table.MarkDown2.notnull()]\ntrain_markdown_type = train_markdown_1.groupby(\"Type\").agg({\"MarkDown1\":\"mean\",\"MarkDown2\":\"mean\",\"MarkDown3\":\"mean\",\"MarkDown4\":\"mean\",\"MarkDown5\":\"mean\"})\n\ntrain_markdown_type.plot(kind='bar', stacked=True,figsize=(10,4))\nplt.title(\"Stacked StoreType Wise\")\nplt.ylabel(\"Markdown\")","f422dd92":"\nfrom fancyimpute import IterativeImputer\nfrom sklearn.metrics import mean_squared_error\n\nfrom sklearn.svm import SVR, LinearSVR, NuSVR\nfrom sklearn.linear_model import ElasticNet, Lasso, RidgeCV,LinearRegression\nfrom sklearn.kernel_ridge import KernelRidge\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.ensemble import GradientBoostingRegressor,AdaBoostRegressor,RandomForestRegressor\nimport xgboost as xgb\nimport lightgbm as lgb","2d9e8308":"def createdummies(data,cols):\n    for col in cols:\n        one_hot = pd.get_dummies(data[col],prefix=col)\n        data = data.join(one_hot)\n        data.drop(col,axis = 1,inplace=True)\n    \n    return data\n        ","753ddf89":"\n# imputing the missing value\nitt = IterativeImputer()\ndf = itt.fit_transform(data_table[[\"MarkDown1\",\"MarkDown2\",\"MarkDown3\",\"MarkDown4\",\"MarkDown5\"]]) \ndata_table.MarkDown1 = df[:,0]\ndata_table.MarkDown2 = df[:,1]\ndata_table.MarkDown3 = df[:,2]\ndata_table.MarkDown4 = df[:,3]\ndata_table.MarkDown5 = df[:,4]\n\ndata_table['CPI'].fillna((data_table['CPI'].mean()), inplace=True)\ndata_table['Unemployment'].fillna((data_table['Unemployment'].mean()), inplace=True)\ndata_table['IsHoliday'] = data_table['IsHoliday'].map({True:0,False:1})\n\n#create new column\ndata_table[\"Month\"] = data_table.Date.dt.month\ndata_table[\"Year\"] = data_table.Date.dt.year\ndata_table[\"WeekofYear\"] = data_table.Date.dt.weekofyear\ndata_table.drop(['Date'],axis=1,inplace=True)\n\n#create dummies out of categorical column\ndata_table = createdummies(data_table,[\"Type\",\"Month\",\"Year\",\"WeekofYear\"])\n\n","f217f8d3":"data_table.columns","1431a516":"data_train = data_table[data_table.Weekly_Sales.notnull()]\ndata_test = data_table[data_table.Weekly_Sales.isnull()]\nX = data_train.drop('Weekly_Sales', axis=1)\ny = data_train['Weekly_Sales']\nfrom sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2)","52c27f02":"\n\n\nclassifiers = [\n    LinearRegression(),\n    ElasticNet(),\n    RidgeCV(alphas=[1e-3, 1e-2, 1e-1, 1]),\n    KernelRidge(alpha=0.6, kernel='polynomial', degree=3, coef0=2.5),\n    Lasso(alpha =16, random_state=100),\n    ElasticNet(alpha=0.8),\n    DecisionTreeRegressor(),\n    RandomForestRegressor(),\n    GradientBoostingRegressor(),\n    AdaBoostRegressor(),\n    SVR(), \n    LinearSVR(), \n    NuSVR(),\n    xgb.XGBRegressor(),\n    lgb.LGBMRegressor()\n    ]\n\nname = []\nscore = []\nmodels = []\nrmse = []\ni = 0\nfor classifier in classifiers:\n    classifier.fit(X_train, y_train)   \n    name.append(type(classifier).__name__)\n    score.append(classifier.score(X_test, y_test))\n    models.append(classifier)\n    rmse.append(np.sqrt(mean_squared_error(classifier.predict(X_test), y_test)))\n","9463946a":"df_score = pd.DataFrame(list(zip(name,rmse, score, models)),columns=['name','rmse','score',\"model\"])\ndf_score.set_index('name',inplace=True)\ndf_score.sort_values(by=['score'],inplace=True)\ndf_score","a3fc479b":"model = df_score.loc[\"XGBRegressor\",\"model\"]\ndata_test.drop(['Weekly_Sales'],axis=1,inplace=True)\npredict = model.predict(data_test)\npredict","d938c756":"<a id=\"5\"><\/a> <br>\n# Analysis Store Type and Year\/Month Wise ","0c53afb8":"**Comparing Model Performance**","5f31fe09":"* It could be as Enough buying during offer and holidays (Black friday Sales,Chrismas,New year) and later sales go down and then again gaining momentum in some months.\n* In Nov also people show less buying can be waiting period for upcoming sales.\n* whole data for Dec-2013 I guess is not available so even after spike in Dec the sales are not gone very high.","e18800ac":"![Retail](https:\/\/www.xpandretail.com\/wp-content\/uploads\/2018\/11\/Screen-Shot-2018-11-26-at-2.10.07-PM.png)","a1574f0e":"<br>Content:\n* [Sneak Peek into the Data](#1)\n* [Analysis Datewise](#2)\n* [Analysis Storewise](#3)\n* [Analysis Departmentwise](#4)\n* [Analysis Store Type and Year\/Month Wise](#5) \n* [Analysis of MarkDown](#6)\n* [Prediction on Date and Store](#7)","bd318963":"# Work In Progress\n\n**Thank you for Reading, Please Upvote ,Comment and Follow for motivating me for more such work**","41bd2711":"* Store Type A & B has shown slight decrease year on basis in sales.\n* Store C has shown a slight increase in sales.","3cac6d00":"![Thanks](https:\/\/www.access2interpreters.com\/wp-content\/uploads\/2016\/01\/thank-you.jpg)","8b95a224":"**Basic Model Creation**","2684bc24":"* It shows a sideway trend","d83becf0":"* Store Count is in the order of A, B and least is C \n* Size wise A store as most no of Item followed by B and than C\n* Even After less Count of Store and lesser Size B has more Weekly Sales than A and C at the least.","6863ccf3":"<a id=\"2\"><\/a> <br>\n# **Analysis Datewise**\n\nlet explore data based on the timeline\n\n* lets Merge Feature tables and sales tables based on the date \n* we will convert WeeklySales in Millions\n* we will modify column as the day is holiday or not","25d73a5a":"<a id=\"3\"><\/a> <br>\n# **Analysis Storewise**\n\nlets explore the pattern in store for weekly sales data","ea2a41eb":"<a id=\"1\"><\/a> <br>\n# Sneak Peek into the Data\n\nLets see how the tables look and get some basic information. i.e \n* Data types\n* No of Data (rows and column)\n* Null Data\n* few rows to understand the data","e90c6c49":"looking into the data I come to the conclusion that we can group data based on the time,store,department.\nAlso we can check how holiday,Temperature,Fuel Price,CPI,Unemployment,Type of Store affecting sales.","3f895d7e":"**Prediction**","75302309":"<a id=\"4\"><\/a> <br>\n# **Analysis Departmentwise**\n\nA little Invesigation on Department","6a8b096d":"* Weekly sales doesnot show any high correlation with any other parameters.\n* CPI and Unemployment  shows negative correlation on other hand Fuel Price show positive correlation\n* Unemployment and Fuel price are also negatively correlated","1c4aaa68":"* Nov- Dec shows spike in Weekly Sales.but over the year it is not increased. \n* weeks nearby holiday shows peak\n* Fuel Price and Consumer Price Index shown growth over the year.\n* Unemployment decreased year after year.\n* Temperature is showing a random walk\n","1e70426f":"* Type A & B store show spike in Nov Dec mostly due to holiday whereas jan has shown decrease in sale.\n* Type C is consistent over every month and doesnot show much deviation.\n   ","3c4d4dbb":"**Clean up and preprocessing**","f3549c10":"* Here  we can see department 1-15 as well as 90-95 has shown  higher weekly sales.\n* some department as 38,40,72 has shown higher weekly sales.","70674a40":"**Data Split**","b275ca37":"<a id=\"6\"><\/a> <br>\n# Analysis of MarkDown","cbed0328":"<a id=\"7\"><\/a> <br>\n# **Prediction on Date and Store**"}}