{"cell_type":{"8bf78118":"code","d6f47d36":"code","370faf6b":"code","d1fca36f":"code","22992980":"code","76da3eea":"code","d979f5ff":"code","7cdb9a97":"code","4f93e40f":"code","fe297654":"code","4723dcc1":"code","86182ba4":"code","8f1b26f8":"code","12961d8c":"code","2349282e":"code","9ce6f268":"code","dc382dd5":"code","ca6298bd":"code","24d04fcb":"code","c40fa73f":"code","fcb98cf2":"code","6ece2d7b":"code","d0f4fa51":"code","4424e1ba":"code","f8a2f378":"code","162ed4ce":"code","fb93885c":"code","88ece71c":"code","c2c881ae":"code","26faf21c":"code","ec41bc31":"code","43a01278":"code","ef15f688":"code","02b3f1ee":"code","15bb1d8b":"code","5973af3e":"code","9b449c79":"code","717133dd":"code","286a707b":"code","fc1db74b":"code","80858d8d":"code","5556f84d":"code","6f23fae1":"code","f0e10dde":"code","3891c0c8":"code","2807478b":"code","70c65e45":"markdown","83e9e34f":"markdown","23f9b9cb":"markdown","6646cb34":"markdown","88a432f5":"markdown"},"source":{"8bf78118":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns #for plotting\nfrom sklearn.ensemble import RandomForestClassifier #for the model\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.tree import export_graphviz #plot tree\nfrom sklearn.metrics import roc_curve, auc #for model evaluation\nfrom sklearn.metrics import classification_report #for model evaluation\nfrom sklearn.metrics import confusion_matrix #for model evaluation\nfrom sklearn.model_selection import train_test_split #for data splitting\nimport eli5 #for purmutation importance\nfrom eli5.sklearn import PermutationImportance\nimport shap #for SHAP values\nfrom pdpbox import pdp, info_plots #for partial plots\nnp.random.seed(123) #ensure reproducibility\n\npd.options.mode.chained_assignment = None  #hide any pandas warnings","d6f47d36":"data = pd.read_csv('..\/input\/heart-disease-uci\/heart.csv')","370faf6b":"df = pd.read_csv('..\/input\/heart-disease-uci\/heart.csv')\ndf.head()","d1fca36f":"data.head()","22992980":"data.columns = ['age', 'sex', 'chest_pain_type', 'resting_blood_pressure', 'cholesterol', 'fasting_blood_sugar', 'rest_ecg', 'max_heart_rate_achieved',\n       'exercise_induced_angina', 'st_depression', 'st_slope', 'num_major_vessels', 'thalassemia', 'target']","76da3eea":"data['sex'][data['sex'] == 0] = 'female'\ndata['sex'][data['sex'] == 1] = 'male'\n\ndata['chest_pain_type'][data['chest_pain_type'] == 1] = 'typical angina'\ndata['chest_pain_type'][data['chest_pain_type'] == 2] = 'atypical angina'\ndata['chest_pain_type'][data['chest_pain_type'] == 3] = 'non-anginal pain'\ndata['chest_pain_type'][data['chest_pain_type'] == 4] = 'asymptomatic'\n\ndata['fasting_blood_sugar'][data['fasting_blood_sugar'] == 0] = 'lower than 120mg\/ml'\ndata['fasting_blood_sugar'][data['fasting_blood_sugar'] == 1] = 'greater than 120mg\/ml'\n\ndata['rest_ecg'][data['rest_ecg'] == 0] = 'normal'\ndata['rest_ecg'][data['rest_ecg'] == 1] = 'ST-T wave abnormality'\ndata['rest_ecg'][data['rest_ecg'] == 2] = 'left ventricular hypertrophy'\n\ndata['exercise_induced_angina'][data['exercise_induced_angina'] == 0] = 'no'\ndata['exercise_induced_angina'][data['exercise_induced_angina'] == 1] = 'yes'\n\ndata['st_slope'][data['st_slope'] == 1] = 'upsloping'\ndata['st_slope'][data['st_slope'] == 2] = 'flat'\ndata['st_slope'][data['st_slope'] == 3] = 'downsloping'\n\ndata['thalassemia'][data['thalassemia'] == 1] = 'normal'\ndata['thalassemia'][data['thalassemia'] == 2] = 'fixed defect'\ndata['thalassemia'][data['thalassemia'] == 3] = 'reversable defect'","d979f5ff":"data.head()","7cdb9a97":"print('The dataset has {} rows and {} columns.'.format(len(data), len(data.columns)))","4f93e40f":"data.dtypes","fe297654":"data['sex'] = data['sex'].astype('object')\ndata['chest_pain_type'] = data['chest_pain_type'].astype('object')\ndata['fasting_blood_sugar'] = data['fasting_blood_sugar'].astype('object')\ndata['rest_ecg'] = data['rest_ecg'].astype('object')\ndata['exercise_induced_angina'] = data['exercise_induced_angina'].astype('object')\ndata['st_slope'] = data['st_slope'].astype('object')\ndata['thalassemia'] = data['thalassemia'].astype('object')","4723dcc1":"data.dtypes","86182ba4":"# Age counts\n\nplt.figure(figsize = (30,8))\nage = plt.subplot(221)\nage = sns.countplot(x=\"age\", data = data,ax=age)\nage.set_title(\"Age Counting\", fontsize=15)\nage.set_xlabel(\"Number of Ages\")\nage.set_ylabel(\"count\")\n\n#print(main_data['age'].value_counts())","8f1b26f8":"# Data to plot for male or female\n\nplt.figure(figsize=(6, 7))\nlabels = 'male', 'female'\nsizes = [215, 130]\ncolors = ['gold', 'yellowgreen']\nexplode = (0.06, 0)  # explode 1st slice\n\n# Plot\nplt.pie(sizes, explode=explode, labels=labels, colors=colors,\nautopct='%1.1f%%', shadow=True, startangle=140)\n\nplt.axis('equal')\nplt.show()","12961d8c":"# Data to plot for chest_pain_type\n\nplt.figure(figsize=(6, 7))\nlabels = 'Typical angina', 'Atypical Angina', 'Non-Anginal pain', 'Asymptomatic'\nsizes = [215, 130, 120, 130]\ncolors = ['lightgray', 'wheat', 'springgreen', 'cyan']\nexplode = (0.06, 0, 0, 0)  # explode 1st slice\n\n# Plot\nplt.pie(sizes, explode=explode, labels=labels, colors=colors,\nautopct='%1.1f%%', shadow=True, startangle=140)\n\nplt.axis('equal')\nplt.show()","2349282e":"data = pd.get_dummies(data, drop_first=True)","9ce6f268":"data.head()","dc382dd5":"X_train, X_test, y_train, y_test = train_test_split(data.drop('target', 1), data['target'], test_size = .2, random_state=10) #split the data","ca6298bd":"from sklearn.svm import SVC\nsvclassifier = SVC(kernel='rbf')\nsvclassifier.fit(X_train, y_train)","24d04fcb":"y_pred = svclassifier.predict(X_test)","c40fa73f":"from sklearn.metrics import classification_report, confusion_matrix\n\nprint(confusion_matrix(y_test, y_pred))\nprint(classification_report(y_test, y_pred))","fcb98cf2":"from sklearn.svm import SVC\nsvclassifier = SVC(kernel='poly', degree=8)\nsvclassifier.fit(X_train, y_train)","6ece2d7b":"y_pred = svclassifier.predict(X_test)","d0f4fa51":"from sklearn.metrics import classification_report, confusion_matrix\n\nprint(confusion_matrix(y_test, y_pred))\nprint(classification_report(y_test, y_pred))","4424e1ba":"model = RandomForestClassifier(max_depth=5)\nmodel.fit(X_train, y_train)","f8a2f378":"estimator = model.estimators_[1]\nfeature_names = [i for i in X_train.columns]\n\ny_train_str = y_train.astype('str')\ny_train_str[y_train_str == '0'] = 'no disease'\ny_train_str[y_train_str == '1'] = 'disease'\ny_train_str = y_train_str.values","162ed4ce":"#code from https:\/\/towardsdatascience.com\/how-to-visualize-a-decision-tree-from-a-random-forest-in-python-using-scikit-learn-38ad2d75f21c\n\nexport_graphviz(estimator, out_file='tree.dot', \n                feature_names = feature_names,\n                class_names = y_train_str,\n                rounded = True, proportion = True, \n                label='root',\n                precision = 2, filled = True)\n\nfrom subprocess import call\ncall(['dot', '-Tpng', 'tree.dot', '-o', 'tree.png', '-Gdpi=600'])","fb93885c":"y_predict = model.predict(X_test)\ny_pred_quant = model.predict_proba(X_test)[:, 1]\ny_pred_bin = model.predict(X_test)","88ece71c":"confusion_matrix = confusion_matrix(y_test, y_pred_bin)\nconfusion_matrix","c2c881ae":"total=sum(sum(confusion_matrix))\n\nsensitivity = confusion_matrix[0,0]\/(confusion_matrix[0,0]+confusion_matrix[1,0])\nprint('Sensitivity : ', sensitivity )\n\nspecificity = confusion_matrix[1,1]\/(confusion_matrix[1,1]+confusion_matrix[0,1])\nprint('Specificity : ', specificity)","26faf21c":"fpr, tpr, thresholds = roc_curve(y_test, y_pred_quant)\n\nfig, ax = plt.subplots()\nax.plot(fpr, tpr)\nax.plot([0, 1], [0, 1], transform=ax.transAxes, ls=\"--\", c=\".3\")\nplt.xlim([0.0, 1.0])\nplt.ylim([0.0, 1.0])\nplt.rcParams['font.size'] = 12\nplt.title('ROC curve for diabetes classifier')\nplt.xlabel('False Positive Rate (1 - Specificity)')\nplt.ylabel('True Positive Rate (Sensitivity)')\nplt.grid(True)","ec41bc31":"auc(fpr, tpr)","43a01278":"X = data.drop('target', axis=1).values # independent features\ny = data['target'].values # dependent feature","ef15f688":"X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.2, random_state=0) #split the data","02b3f1ee":"# importing pytorch libaries\n\nimport torch\nimport torch.nn as nn\nimport torch.nn.functional as F","15bb1d8b":"# creating tensors \n\nX_train = torch.FloatTensor(X_train)\nX_test = torch.FloatTensor(X_test)\ny_train = torch.LongTensor(y_train)\ny_test = torch.LongTensor(y_test)","5973af3e":"data.shape","9b449c79":"#### Creating Modelwith Pytorch\n\nclass ANN_Model(nn.Module):\n    def __init__(self,input_features=19,hidden1=20,hidden2=20,out_features=2):\n        super().__init__()\n        self.f_connected1=nn.Linear(input_features,hidden1)\n        self.f_connected2=nn.Linear(hidden1,hidden2)\n        self.out=nn.Linear(hidden2,out_features)\n    def forward(self,x):\n        x=F.relu(self.f_connected1(x))\n        x=F.relu(self.f_connected2(x))\n        x=self.out(x)\n        return x","717133dd":"# ANN_Model\n\ntorch.manual_seed(20)\nmodel=ANN_Model()","286a707b":"model.parameters","fc1db74b":"# backward Propagation\n\nloss_function=nn.CrossEntropyLoss()\noptimizer=torch.optim.Adam(model.parameters(),lr=0.01)","80858d8d":"epochs=500\nfinal_losses=[]\nfor i in range(epochs):\n    i=i+1\n    y_pred=model.forward(X_train)\n    loss=loss_function(y_pred,y_train)\n    final_losses.append(loss)\n    if i%10==1:\n        print(\"Epoch number: {} and the loss : {}\".format(i,loss.item()))\n    optimizer.zero_grad()\n    loss.backward()\n    optimizer.step()    ","5556f84d":"plt.plot(range(epochs),final_losses)\nplt.ylabel('Loss')\nplt.xlabel('Epoch')","6f23fae1":"# predicting x_test\n\npredictions=[]\nwith torch.no_grad():\n    for i,data in enumerate(X_test):\n        y_pred=model(data)\n        predictions.append(y_pred.argmax().item())\n        print(y_pred.argmax().item())","f0e10dde":"from sklearn.metrics import confusion_matrix\ncm=confusion_matrix(y_test,predictions)\ncm","3891c0c8":"plt.figure(figsize=(10,6))\nsns.heatmap(cm,annot=True)\nplt.xlabel('Actual Values')\nplt.ylabel('Predicted Values')","2807478b":"from sklearn.metrics import accuracy_score\nscore=accuracy_score(y_test,predictions)\nscore","70c65e45":"### RandomForestClassifier","83e9e34f":"### ANN with PyTorch","23f9b9cb":"> 1. age\n> 2. sex\n> 3. chest pain type (4 values)\n> 4. resting blood pressure\n> 5. serum cholestoral in mg\/dl\n> 6. fasting blood sugar > 120 mg\/dl\n> 7. resting electrocardiographic results (values 0,1,2)\n> 8. maximum heart rate achieved\n> 9. exercise induced angina\n> 10. oldpeak = ST depression induced by exercise relative to rest\n> 11. the slope of the peak exercise ST segment\n> 12. number of major vessels (0-3) colored by flourosopy\n> 13. thal: 3 = normal; 6 = fixed defect; 7 = reversable defect","6646cb34":"### Polynomial Kernel","88a432f5":"### Gaussian Kernel"}}