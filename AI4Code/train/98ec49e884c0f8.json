{"cell_type":{"c59da3f5":"code","dde2ad23":"code","7808e6db":"code","959501b8":"code","d159a7ed":"code","b497de41":"code","5c726d1a":"code","9aeba689":"code","41371609":"code","ee561c42":"code","883a3df9":"code","1bd4f400":"code","ed684de2":"code","ee6e50bf":"code","66c0cfc6":"code","20505088":"code","af7cd888":"code","ddf71c76":"code","c10402d3":"code","8655d593":"code","83c8a7bf":"code","823d5cd6":"code","92ff2b65":"code","c7403cbb":"code","b7ba0064":"code","fd7f8534":"code","9424e8be":"code","258ed8a7":"code","98e205b3":"code","c87c5662":"code","466f8cc5":"code","297b2810":"code","f0f99bdb":"code","250ca10f":"code","784e1403":"code","94bc1b12":"code","a04e271a":"code","6f9d91f8":"code","e261d943":"code","eea3410b":"code","64ac6d4e":"code","34188173":"code","00b6d921":"code","a697fbe8":"code","9b5183f7":"code","70f82177":"code","b7da0c8e":"code","8b047b2c":"code","b0fd288e":"code","4e0b3f14":"code","8669f362":"code","46242b83":"code","764afce4":"code","1f3f801c":"code","8f3bbef8":"code","77e3eae9":"code","ab8d52ee":"code","a692db4a":"code","08a1cca6":"code","4925634f":"code","93b81379":"code","66f15ab8":"code","92241f79":"code","b01d9bec":"code","2eeaef17":"code","9a941981":"code","b68281e4":"code","ef0b9e1a":"code","d8ec9f9e":"code","f90eb05e":"code","95b1984f":"code","ba4bfb5e":"code","2b4a4746":"code","60ea0a77":"code","aa1f917b":"code","dddf21f8":"code","d1c3226b":"code","99ebeba7":"code","81454b19":"code","6ded2417":"code","58f8b95d":"code","4648ca62":"code","99a459ca":"code","989099f6":"code","caae3687":"code","b9634a3e":"code","c94c2b2f":"code","e83ab740":"code","1eafb944":"code","8827861e":"code","93e49c07":"code","1239a625":"code","bad5bd9f":"code","eaacb2e4":"code","0a6931e8":"code","4dd66af8":"code","3d5645d4":"code","03f7918d":"code","e51c3fa6":"code","27b93b0b":"code","ec36d49d":"code","5d5ef526":"code","1d4fe1f1":"code","8b5126cd":"code","f6034636":"code","790c7ff7":"code","0b519414":"code","aecf73c6":"code","0f3d9bba":"code","9b81e890":"code","d53e89e1":"code","42487a88":"code","f3baf36a":"code","91cf41a4":"code","69de961c":"code","6ef2ae64":"code","8ad380e5":"code","562d50ff":"code","93b545dc":"code","49fbf27c":"code","630e422e":"code","baf8a132":"code","30fa5e0a":"code","16d30530":"code","72cfac77":"code","2935e7aa":"code","2cd2fe3a":"code","1b2ad026":"code","5225dfa1":"code","cedadc37":"code","27819a56":"code","f2677e17":"markdown","8bc2a5b8":"markdown","6ee82dd3":"markdown","8af960e0":"markdown","11a5c2bb":"markdown","ad7d9eb6":"markdown","7fc75530":"markdown","4248e1e3":"markdown","d741de53":"markdown","91670f2c":"markdown","c7f92384":"markdown","7d9a9931":"markdown","eac12a2a":"markdown","3b697797":"markdown","ff966321":"markdown","406e24cc":"markdown","b74fcdd2":"markdown","3bc2ba83":"markdown","c83e8c10":"markdown","bc205c82":"markdown","6e9f3cc3":"markdown","0cd8c777":"markdown","58a3bf91":"markdown","9f05f4d9":"markdown","7d171409":"markdown","02f634b8":"markdown","aafbede3":"markdown","da7bcf95":"markdown","49ae81a9":"markdown","c77280f1":"markdown","da9aacd3":"markdown","8f5adf2b":"markdown","44124eb7":"markdown","14bf495e":"markdown","0a494445":"markdown","1061dafb":"markdown","736f87c5":"markdown","3c629841":"markdown","bae91312":"markdown","02309c13":"markdown","681d3fc0":"markdown","295c36fa":"markdown","e6f6c446":"markdown","475d04dd":"markdown","9f1eb518":"markdown","133c749f":"markdown","4fe6fd12":"markdown","6a58c777":"markdown","373b39cc":"markdown","8b25e0ba":"markdown","5797eb50":"markdown","0b25762e":"markdown","1a001f5d":"markdown","3db2387d":"markdown","ec25144d":"markdown","f33b09e1":"markdown","f1d4d0ec":"markdown","d2a48321":"markdown","08e174ca":"markdown","48c113c2":"markdown","6b91b6d3":"markdown","9e0e29c4":"markdown","a5de3479":"markdown","a6005d58":"markdown","58f9a8a9":"markdown","06bf4cab":"markdown","9349951b":"markdown","49584e8f":"markdown","e338fa85":"markdown","966946a9":"markdown","1d66faed":"markdown","c3ab3264":"markdown","e7596a67":"markdown","9503b0b7":"markdown","942c36c9":"markdown","443e97f2":"markdown","d83c1345":"markdown","b104974e":"markdown","ee9cb0ad":"markdown","7a6e697a":"markdown","fe0f97ba":"markdown","8ba923c7":"markdown","d2caa694":"markdown","699741cb":"markdown","8f95ea20":"markdown","ee7462ea":"markdown","0670f5a4":"markdown","89fedb71":"markdown","b255a663":"markdown","c9397447":"markdown","cb2839f4":"markdown","65d7101f":"markdown","3904b054":"markdown","288a1369":"markdown","2d1060ee":"markdown","5d3cc7f8":"markdown","7993837e":"markdown","be0d87cd":"markdown","6bca1b66":"markdown","04321085":"markdown","01b77be7":"markdown","eb1e6761":"markdown","fd067f93":"markdown","b7f8ced9":"markdown","5f6dfed8":"markdown","274411a4":"markdown","876aa84b":"markdown","486eb902":"markdown","1d78c29b":"markdown","439ef422":"markdown","a89ff279":"markdown","24145d94":"markdown","237286d4":"markdown","176e7980":"markdown","4d787294":"markdown","65248b99":"markdown","eee16a36":"markdown","f8a80089":"markdown","c73fb1a9":"markdown","a4912592":"markdown","dd13ff92":"markdown","6e38bfa3":"markdown","ac976261":"markdown","897da900":"markdown","be94e07b":"markdown","7e114415":"markdown","2e31c227":"markdown","4e761f1d":"markdown","6c53b67b":"markdown","58033e1f":"markdown","23058f61":"markdown","a923e974":"markdown","a122c1ad":"markdown","ee7bb07d":"markdown","2498aaa7":"markdown","ff882aaf":"markdown","df663c2d":"markdown","4fd56788":"markdown","9ff0cac7":"markdown","fb9d7908":"markdown","62963513":"markdown","8d158094":"markdown","66f9f8ff":"markdown","7ed1a141":"markdown","afde0a0c":"markdown","17f69b0a":"markdown","b26f58ad":"markdown","31a4205c":"markdown","b2775205":"markdown","f4401df1":"markdown","bc933c87":"markdown","d4eeb761":"markdown","1d3dba27":"markdown","c0497700":"markdown","0f2846e1":"markdown","34a8c833":"markdown","b402b156":"markdown","95b91468":"markdown","b7d372bc":"markdown","8c18da24":"markdown","ad132b10":"markdown","84166f3c":"markdown","e3838a8f":"markdown","2902b1e1":"markdown","0f377b9f":"markdown","47cfd6e5":"markdown","4bec69f7":"markdown","81c1d984":"markdown","518a9563":"markdown","2dc8e0d5":"markdown","ea2be34c":"markdown","ff7ef192":"markdown","bdcb0b84":"markdown","2f0c5278":"markdown","6064ab5e":"markdown","0d20911e":"markdown"},"source":{"c59da3f5":"%%capture\n# Paquetes requeridos preprocesado\nimport numpy as np\nimport pandas as pd\n\n# Representaciones basicas\nimport matplotlib.pyplot as plt\n\n# para extraer caracteristicas temporales en fechas\nfrom datetime import datetime\n\n# para los modelos SARIMA\nfrom statsmodels.graphics.tsaplots import plot_acf,plot_pacf\nimport statsmodels.api as sm\n# CH de Dickey-Fuller\nfrom statsmodels.tsa.stattools import adfuller\n\n# plotly para visualizaciones interactivas\nimport plotly.express as px\nimport plotly.graph_objects as go\n\n# para subplots en plotly\nfrom plotly.subplots import make_subplots\n\n# Para estandarizar\nfrom sklearn.preprocessing import StandardScaler\n\n# barchart3d Utility script added\n# https:\/\/github.com\/buran21\/barchart3d-plotly\nfrom barchart3d import barchart3d\n\n# bart_chart_race para barras animadas\ntry:\n    import bar_chart_race as bcr\nexcept ImportError:\n    !pip install bar_chart_race\n    import bar_chart_race as bcr\n    \nfrom sklearn.cluster import KMeans","dde2ad23":"# Identificamos el directorio de Kaggle donde nuestro DataSet\n!ls ..\/input\/","7808e6db":"#Hacemos la lectura de nuestro DataSet\n#df_trucades['Data'] = pd.to_datetime(df_trucades['Data'])\ndf_trucades = pd.read_csv(\"..\/input\/atencion900900120csv\/Atencion900900120.csv\")\n# Se le da el formato correcto a las fechas\ndf_trucades['Data'] = pd.to_datetime(df_trucades['Data'], format='%d\/%m\/%Y')\ndf_trucades.head(5)","959501b8":"df_trucades.shape","d159a7ed":"df_trucades.info()","b497de41":"np.round(df_trucades.isna().sum()\/df_trucades.shape[0],4)*100","5c726d1a":"df_trucades[['Nacionalitat', 'Temps resid\u00e8ncia', 'Situaci\u00f3 legal']].head()","9aeba689":"df_trucades[['Temps resid\u00e8ncia', 'Situaci\u00f3 legal']].isna().sum()","41371609":"df_trucades.drop(columns = ['Detall professional','Nombre fills\/filles A', \n                            'Situaci\u00f3 fills\/filles A','Detall \u00e0mbit', \n                            'Relaci\u00f3 agressor \u00e0mbit laboral', 'Xarxa', \n                            'Xarxa_A','Derivaci\u00f3_A', 'Derivaci\u00f3_B', \n                            'Xarxa_B', 'Derivaci\u00f3_C', 'Xarxa_C',\n                            'Traducci\u00f3', 'Idioma Traducci\u00f3'],\n                             axis=1, inplace=True)","ee561c42":"df_truc_cat = df_trucades.copy()\ndf_truc_cat.drop(columns = ['Llengua', \"Comarca\", \"\u00c0mbit territorial\", \"Provincia\",\n                            \"Prov\u00edncia agrupada\", 'Nombre fills\/filles'],\n                             axis=1, inplace=True)\nnp.round(df_truc_cat.isna().sum()\/df_truc_cat.shape[0],4)*100","883a3df9":"#dateindex = serie_global.index.get_level_values('Data')\n#pd.DatetimeIndex(dateindex)\n#serie_global.index = dateindex\n#serie_global.rename(columns = {\"Data\":\"trucades\"}, inplace = True)\ndf_truc_cat['trucades'] = 1\nserie_global = df_truc_cat.groupby(['Data', 'Any','Mes', 'D\u00eda setmana'], as_index=False).agg({'trucades':'count'})\nserie_global","1bd4f400":"print(f\"A\u00f1os 2013-2020 \\n{serie_global.trucades.describe()}\")","ed684de2":"serie_2013_2019 = serie_global.query(\"Any != 2020\").trucades.describe()\nprint(f\"A\u00f1os 2013-2020 \\n{serie_2013_2019}\")","ee6e50bf":"serie_2020 = serie_global.query(\"Any == 2020\").trucades.describe()\nprint(f\"A\u00f1o 2020 con Covid \\n{serie_2020}\")","66c0cfc6":"# https:\/\/plotly.com\/python\/range-slider\/\n# https:\/\/plotly.com\/python\/time-series\/\n# Create figure\nfig = go.Figure()\n\nfig.add_trace(\n    go.Scatter(x=list(serie_global.Data), y=list(serie_global.trucades)))\n\n# Set title\nfig.update_layout(\n    title_text=\"Imagen 4. 1. 1. Evoluci\u00f3n diaria de llamadas al 900 900 120 a nivel Auton\u00f3mico\"\n)\n\n# Add range slider\nfig.update_layout(\n    xaxis=dict(\n        rangeselector=dict(\n            buttons=list([\n                dict(count=1,\n                     label=\"1 mes\",\n                     step=\"month\",\n                     stepmode=\"backward\"),\n                dict(count=6,\n                     label=\"1 semestre\",\n                     step=\"month\",\n                     stepmode=\"backward\"),\n                dict(count=1,\n                     label=\"1 a\u00f1o\",\n                     step=\"year\",\n                     stepmode=\"backward\"),\n                dict(step=\"all\")\n            ])\n        ),\n        rangeslider=dict(\n            visible=True\n        ),\n        type=\"date\"\n    )\n)\n\nfig.update_xaxes(\n    dtick=\"M3\",\n    #tickformat=\"%b\\n%Y\",\n    ticklabelmode=\"period\")\n\nfig.show()","20505088":"serie_global['day_of_year'] = pd.Series([x.timetuple().tm_yday for x in serie_global['Data']])\nserie_global","af7cd888":"serie_global['day'] = pd.Series([x.day for x in serie_global['Data']])\ndaily_ts = pd.pivot_table(data=serie_global,values='trucades',index='day_of_year',columns='Any').iloc[0:366]\ndaily_ts =  daily_ts.iloc[0:366]\ndaily_ts","ddf71c76":"daily_ts.plot(figsize=(26,10))\nplt.rcParams['xtick.labelsize'] = 18\nplt.rcParams['ytick.labelsize'] = 18\nplt.title('Imagen 4.1.2. Evoluci\u00f3n diaria por a\u00f1os de llamadas al 900 900 120 en Catalu\u00f1a', \n                 fontdict = {'fontsize': 30})\nplt.show()","c10402d3":"# Se construye otra variable indicando el numero de semana\nserie_global['week_of_year'] = pd.Series([x.isocalendar()[1] for x in serie_global['Data']])\n# Filtro por el a\u00f1o deseado\nserie_global_2013 = serie_global.query(\"Any == 2013\")\nweeks_2013 = pd.pivot_table(data=serie_global_2013,values='trucades',index='D\u00eda setmana',columns='week_of_year')\n# Ordeno empezando por Domingo porque se aprecia mejor luego el seasonplot\nweeks_2013 = weeks_2013.reindex(index=['Diumenge','Dilluns','Dimarts','Dimecres','Dijous','Divendres','Dissabte'])\nweeks_2013","8655d593":"# Elimino la leyenda, pues son 52 valores que corrompen la imagen\nweeks_2013.plot(figsize=(26,10), legend=None)\nplt.rcParams['xtick.labelsize'] = 20\nplt.title('Imagen 4.1.3. Car\u00e1cter estacionario de llamadas al 900 900 120 en Catalu\u00f1a en el a\u00f1o 2013 (52 semanas)', \n                 fontdict = {'fontsize': 24})\nplt.show()","83c8a7bf":"days_of_week = ['Dissabte','Diumenge']\nmedia_fin_semana = serie_global_2013.query(\"`D\u00eda setmana` == @days_of_week\").trucades.mean()\nmedia_dias_laborables = serie_global_2013.query(\"`D\u00eda setmana` != @days_of_week\").trucades.mean()\nprint('{:.3f} llamadas diarias de media en fin de semana en 2013 \\n\\\n{:.3f} llamadas diarias de media entre semana en 2013 \\n\\\n{:.3f} llamadas diarias en media de incremento en 2013'\\\n.format(media_fin_semana, media_dias_laborables,media_dias_laborables - media_fin_semana))","823d5cd6":"#2013-2019\nplt.rcParams['xtick.labelsize'] = 15\nplt.rcParams['ytick.labelsize'] = 15\nfig, axes = plt.subplots(nrows=3, ncols=2, sharex=True, figsize=(16,10))\nfig.suptitle('Imagen 4.1.4. Caracter estacionario semanal para los a\u00f1os 2014-2019', size=25)\ntupla_indices = np.ndindex(3,2)\nfor tupla_indice, year in zip(tupla_indices,range(2014,2020)):\n    year = str(year)\n    serie_global_any = serie_global.query(\"Any == \" + year)\n    weeks_any = pd.pivot_table(data=serie_global_any,values='trucades',\n                               index='D\u00eda setmana',columns='week_of_year')\n    weeks_any = weeks_any.reindex(index=['Diumenge','Dilluns','Dimarts','Dimecres','Dijous','Divendres','Dissabte'])\n    axes[ tupla_indice[0],tupla_indice[1] ].plot(weeks_any, linewidth=1)\n    axes[ tupla_indice[0],tupla_indice[1] ].set_title(\"Any \" + str(year),\n                                                        fontdict={'fontsize': 15})\n    axes[ tupla_indice[0],tupla_indice[1] ].set_xlabel(\"D\u00eda setmana\",\n                                                      fontdict={'fontsize': 20})\n    axes[ tupla_indice[0],tupla_indice[1] ].set_ylabel(\"trucades\",\n                                                      fontdict={'fontsize': 20})\n    fig.autofmt_xdate(rotation=20)\nfig.tight_layout()  \nplt.show()","92ff2b65":"# Filtro por el a\u00f1o 2020\nserie_global_2020 = serie_global.query(\"Any == 2020\")\nweeks_2020 = pd.pivot_table(data=serie_global_2020,values='trucades',index='D\u00eda setmana',columns='week_of_year')\n# Ordeno empezando por Domingo porque se aprecia mejor luego el seasonplot\nweeks_2020 = weeks_2020.reindex(index=['Diumenge','Dilluns','Dimarts','Dimecres','Dijous','Divendres','Dissabte'])","c7403cbb":"# Elimino la leyenda, pues son 52 valores que corrompen la imagen\nweeks_2020.plot(figsize=(26,10), legend=None)\nplt.title('Imagen 4.1.5. Car\u00e1cter estacionario por semanas de llamadas al 900 900 120 en Catalu\u00f1a en el a\u00f1o pand\u00e9mico 2020', \n                 fontdict = {'fontsize': 24})\n#plt.pyplot.legend(prop={\"size\":10})\nplt.show()","b7ba0064":"serie_mensual = df_truc_cat.groupby(['Data', 'Any','Mes'], as_index=False).agg({'trucades':'count'}) \nserie_mensual","fd7f8534":"# Filtro por el a\u00f1o deseado\nts_months = pd.pivot_table(data=serie_mensual,values='trucades',index='Mes',columns='Any')\n# Ordeno empezando por Domingo porque se aprecia mejor luego el seasonplot\nts_months = ts_months.reindex(index=['Gener','Febrer','Mar\u00e7','Abril','Maig','Juny','Juliol',\n                                   'Agost','Setembre','Octubre','Novembre','Desembre'])\nts_months","9424e8be":"ts_months.plot(figsize=(26,10))\nplt.title('Imagen 4.1.6. Series mensuales de llamadas al \\\n900 900 120 en Catalu\u00f1a a\u00f1os 2013-2020', fontdict = {'fontsize': 24})\nplt.xticks(np.arange(12), ts_months.index, rotation=17)\nplt.legend(prop={\"size\":15})\nplt.show()","258ed8a7":"# Mi time series\nts = serie_global[['Data','trucades']].iloc[0:2556]\nts.set_index('Data',inplace=True)\nts","98e205b3":"fig = plt.figure(figsize=(12,8))\nax1 = fig.add_subplot(211)\nfig = sm.graphics.tsa.plot_acf(ts['trucades'],lags=40,ax=ax1)\nax2 = fig.add_subplot(212)\nfig = sm.graphics.tsa.plot_pacf(ts['trucades'],lags=40,ax=ax2)","c87c5662":"def adfuller_test(sales):\n    result = adfuller(sales)\n    labels = ['ADF Test Statistic','p-value','#Lags Used','Number of Observations']\n    for value,label in zip(result,labels):\n        print(label+' : '+str(value) )\n\n    # Eval\u00fao el p-valor\n    if result[1] <= 0.05:\n        print(\"Fuerte evidencia en contra de la hip\u00f3tesis nula. Se puede rechazar H_0 y asumir que la serie temporal es estacionaria.\")\n    else:\n        print(\"No hay evidencia en contra de la hip\u00f3tesis nula. Se asume H_0 como cierta y que la serie temporal no es estacionaria. Toca diferenciar una vez m\u00e1s.\")\n\nadfuller_test(ts['trucades'])\n\ntest_result=adfuller(ts['trucades'])","466f8cc5":"ts.index = pd.DatetimeIndex(ts.index.values, freq=\"D\")\nmod = sm.tsa.statespace.SARIMAX(ts['trucades'], order=(1,0,1), seasonal_order=(1,0,1,7))\nfit_res = mod.fit(disp=False)\nprint(fit_res.summary())","297b2810":"ts.index","f0f99bdb":"ts.tail(1)","250ca10f":"res = mod.filter(fit_res.params)\n# One-step-ahead predictions (Predicciones una a una)\npredict = res.get_prediction()\npredict_ci = predict.conf_int()\n# Dynamic predictions (Predicciones a largo plazo)\npredict_dy = res.get_prediction(dynamic='2019-11-30')\npredict_dy_ci = predict_dy.conf_int()","784e1403":"# Creamos el Kanvas\nfig, ax = plt.subplots(figsize=(13,7))\nnpre = 4\nax.set(title='Imagen 4. 1. 6. 1.: Predicciones para los d\u00edas de Diciembre en 2019', \n       xlabel='Date', ylabel='trucades al 900 900 120')\n\n# Plot valores observados\nts.loc['2019-11-15':, 'trucades'].plot(ax=ax, style='o', label='Observed values')\n\n# Predicciones a un d\u00eda\npredict.predicted_mean.loc['2019-11-15':].plot(ax=ax, style='r--', label='One-step-ahead forecast')\nci = predict_ci.loc['2019-11-15':]\nax.fill_between(ci.index, ci.iloc[:,0], ci.iloc[:,1], color='r', alpha=0.1)\n# Predicciones din\u00e1micas (a futuro)\npredict_dy.predicted_mean.loc['2019-11-15':].plot(ax=ax, style='g', label='Dynamic forecast (Diciembre\/2019)')\nci = predict_dy_ci.loc['2019-11-15':]\nax.fill_between(ci.index, ci.iloc[:,0], ci.iloc[:,1], color='g', alpha=0.1)\n\nlegend = ax.legend(loc='lower right')","94bc1b12":"df_perfil = df_truc_cat.copy()\nnp.round(df_truc_cat.isna().sum()\/df_trucades.shape[0],4)*100","a04e271a":"df_perfil['Pateixen maltractament'].value_counts()","6f9d91f8":"df_perfil['Motiu Trucada'].value_counts()","e261d943":"df_perfil['Viol\u00e8ncia psicol\u00f2gica'].value_counts()","eea3410b":"df_perfil.Sexe.value_counts()","64ac6d4e":"df_edat_evol = df_truc_cat.groupby(['Edat','Data'], as_index=False).agg({'trucades':'count'})\ndf_edat_evol.sort_values('Data', ascending=True, inplace=True)\ndf_edat_evol = pd.pivot_table(data=df_edat_evol,values='trucades',index='Data',columns='Edat')\ndf_edat_evol","34188173":"df_edat_evol = df_edat_evol.resample('1M').sum()\ndf_edat_evol","00b6d921":"df_edat_evol['Data'] = df_edat_evol.index\nfig = px.line(df_edat_evol, x=\"Data\", y=df_edat_evol.columns,\n              title='Imagen 4. 2. 1. 1.: Evoluci\u00f3n mensual de llamadas al 900 900 120 seg\u00fan rangos de edad <br> \\\ndurante 2013-2020')\n\n# Add range slider\nfig.update_layout(\n    xaxis=dict(\n        rangeselector=dict(\n            buttons=list([\n                dict(count=1,\n                     label=\"1 mes\",\n                     step=\"month\",\n                     stepmode=\"backward\"),\n                dict(count=6,\n                     label=\"1 semestre\",\n                     step=\"month\",\n                     stepmode=\"backward\"),\n                dict(count=1,\n                     label=\"A\u00f1o 2020\",\n                     step=\"year\",\n                     stepmode=\"backward\"),\n                dict(step=\"all\")\n            ])\n        ),\n        rangeslider=dict(\n            visible=True\n        ),\n        type=\"date\"\n    )\n)\n\nfig.update_xaxes(\n    dtick=\"M3\",\n    tickformat=\"%b\\n%Y\",\n    ticklabelmode=\"period\")\n\nfig.show()","a697fbe8":"df_edat_acum = df_truc_cat.groupby(['Edat'], as_index=False).agg({'trucades':'count'})\ndf_edat_acum.sort_values('trucades', ascending=False, inplace = True)\ndf_edat_acum","9b5183f7":"fig = barchart3d(\n    df_edat_acum.Edat.to_list(), df_edat_acum.trucades.to_list(),\n    'Imagen 4.2.1.2. Frecuencia edades que han utilizado el 900 900 120 durante 2013-2020', 'N\u00ba de llamadas',\n    colorscale='Bluered', opacity=0.6, flatshading=True)\nfig.show()","70f82177":"df_truc_cat['\u00das previ servei'].value_counts()","b7da0c8e":"df_edat_acum_2 = df_truc_cat.query(\"`\u00das previ servei` == 'No'\")\\\n.groupby(['Edat'], as_index=False).agg({'trucades':'count'})\ndf_edat_acum_2.sort_values('trucades', ascending=False, inplace=True)","8b047b2c":"fig = barchart3d(\n    df_edat_acum_2.Edat.to_list(), df_edat_acum_2.trucades.to_list(),\n    'Imagen 4. 2. 1. 3.: Frecuencias edades 900 900 120 durante 2013-2020 sin uso previo <br> del servicio', 'N\u00ba de llamadas',\n    colorscale='Bluered', opacity=0.6, flatshading=True)\nfig.show()","b0fd288e":"df_edad_reincidencias = df_edat_acum.copy()\ndf_edad_reincidencias['llamadas_reincidentes'] = df_edat_acum.trucades - df_edat_acum_2.trucades\ndf_edad_reincidencias.sort_values('llamadas_reincidentes', ascending=False, inplace=True)","4e0b3f14":"df = px.data.tips()\nfig = px.pie(df_edad_reincidencias, values='llamadas_reincidentes', names='Edat', title='Imagen 4. 2. 1. 4.: \\\n% de llamadas reincidentes al 900 900 120 durante 2013-2020 <br> seg\u00fan rango de edad')\nfig.show()","8669f362":"# Identificamos el directorio de Kaggle donde nuestro DataSet\n!ls ..\/input\/","46242b83":"#Hacemos la lectura de los datos del INE\nine_data = pd.read_csv(\"..\/input\/mujerescardinalcataluna\/MujeresCardinalCataluna\")\nine_data.head()","764afce4":"ine_data.drop(columns = ['Comunidades'], axis=1, inplace=True)\nine_data = ine_data.query(\"A\u00f1o == 2020\")\nine_data","1f3f801c":"#https:\/\/regex101.com\/\nine_data['Edad..a\u00f1o.a.a\u00f1o.'] = ine_data['Edad..a\u00f1o.a.a\u00f1o.'].str.replace(r'\\D', '')\nine_data['Edad..a\u00f1o.a.a\u00f1o.'] = pd.to_numeric(ine_data['Edad..a\u00f1o.a.a\u00f1o.'])\nine_data","8f3bbef8":"df_perfil.Edat.value_counts()","77e3eae9":"def rangos_edad(x):\n    if x < 18:\n        return('Menors de 18 anys')\n    elif x < 31:\n        return('Entre 18 i 31 anys')\n    elif x < 41:\n        return('Entre 31 i 40 anys')\n    elif x < 51:\n        return('Entre 41 i 50 anys')\n    elif x < 61:\n        return('Entre 51 i 60 anys')\n    else:\n        return('M\u00e9s de 60 anys')\n    \nine_data['Edat'] = list(map(rangos_edad, ine_data['Edad..a\u00f1o.a.a\u00f1o.']))\nine_data","ab8d52ee":"ine_data['Total'] = ine_data['Total'].astype(str).str.replace('.','').astype(int)\nine_data","a692db4a":"cardinales_poblacionales = ine_data.groupby(['Edat'], as_index=False).agg({'Total':'sum'})\ncardinales_poblacionales","08a1cca6":"cardinales_poblacionales['Total'] = cardinales_poblacionales['Total'].replace('.','')\ncardinales_poblacionales","4925634f":"df_edat_acum_2.head()","93b81379":"datos_relativizados = pd.merge(df_edat_acum_2, cardinales_poblacionales,\n                               how='inner', on=['Edat'])\ndatos_relativizados['porcentaje'] = 100*datos_relativizados['trucades']\/datos_relativizados['Total']\ndatos_relativizados","66f15ab8":"fig = go.Figure(data=[go.Bar(\n            x=datos_relativizados['Edat'], y=datos_relativizados['porcentaje'],\n            text=np.round(datos_relativizados['porcentaje'],2).astype(str) + ' %',\n            textposition='auto',\n        )])\n# Titulo\nfig.update_layout(\n    title_text=\"Imagen 4. 2. 5.: Frecuencias RELATIVIZADAS de edades <br>en el 900 900 120 durante 2013-2020 sin previo servicio\"\n)\nfig.show()","92241f79":"fig = make_subplots(rows=1, cols=2, specs=[[{}, {}]], vertical_spacing=0.001)\n\nfig.append_trace(go.Bar(\n            x=datos_relativizados['Edat'], y=datos_relativizados['trucades'],\n            text=datos_relativizados['trucades'],\n            textposition='auto', name='N\u00ba de llamadas absolutas'\n        ), 1, 1)\nfig.append_trace(go.Bar(\n            x=datos_relativizados['Edat'], y=datos_relativizados['porcentaje'],\n            text=np.round(datos_relativizados['porcentaje'],2).astype(str) + ' %',\n            textposition='auto', name='% de llamadas relativas',\n    orientation='v'), 1, 2)\n# Set title\nfig.update_layout(\n    title_text=\"Imagen 4. 2. 1. 6.: Frecuencias  Absolutas Vs relativas de <br>edades en el 900 900 120 durante 2013-2020 sin previo servicio\"\n)\nfig.show()","b01d9bec":"df_soc_eco = df_perfil.copy().query(\"`\u00das previ servei` == 'No'\")","2eeaef17":"df_soc_eco = df_soc_eco[['Data','Estat Civil', 'Formaci\u00f3', 'Situaci\u00f3 Laboral',\n                         'Detall situaci\u00f3 laboral', 'trucades']]","9a941981":"df_estado_civil = df_soc_eco.groupby(['Data','Estat Civil'], as_index=False).agg({'trucades':'sum'})\ndf_estado_civil","b68281e4":"df_estado_civil_aux = pd.pivot_table(data=df_estado_civil,values='trucades',index='Data',columns='Estat Civil')\ndf_estado_civil_aux\n# Agrupamos por meses\ndf_estado_civil_aux = df_estado_civil_aux.resample('1M').sum()\n# Construimos las gr\u00e1ficas acumuladas\ndf_estado_civil_aux = df_estado_civil_aux.cumsum(axis=0)\ndf_estado_civil_aux","ef0b9e1a":"# https:\/\/pypi.org\/project\/bar-chart-race\/\nbcr.bar_chart_race(df=df_estado_civil_aux, perpendicular_bar_func='median',\n                   title='V\u00eddeo 4.2.2.1.: Acum. llamadas 2013-2020 se\u01f5un Estado Civil', \n                   orientation='v', sort='asc',filename=None)","d8ec9f9e":"df_soc_eco_3140 = df_perfil.copy().query(\"`\u00das previ servei` == 'No' and Edat == 'Entre 31 i 40 anys'\")\ndf_soc_eco_3140 = df_soc_eco_3140[['Data','Estat Civil', 'Formaci\u00f3', 'Situaci\u00f3 Laboral',\n                         'Detall situaci\u00f3 laboral', 'trucades']]\ndf_estado_civil_3140 = df_soc_eco_3140.groupby(['Data','Estat Civil'], as_index=False).agg({'trucades':'sum'})\ndf_estado_civil_3140_aux = pd.pivot_table(data=df_estado_civil_3140,values='trucades',index='Data',columns='Estat Civil')\n# Agrupamos por meses\ndf_estado_civil_3140_aux  = df_estado_civil_3140_aux.resample('1M').sum()\n# Construimos las gr\u00e1ficas acumuladas\ndf_estado_civil_3140_aux = df_estado_civil_3140_aux.cumsum(axis=0)\ndf_estado_civil_3140_aux ","f90eb05e":"bcr.bar_chart_race(df=df_estado_civil_3140_aux, perpendicular_bar_func='median',\n                   title='V\u00eddeo 4.2.2.2.: Acum. llamadas 2013-2020 estado civil 31-40 a\u00f1os', \n                   orientation='v', sort='asc', filename=None)","95b1984f":"df_soc_eco = df_soc_eco[['Data', 'Estat Civil', 'Formaci\u00f3', 'Situaci\u00f3 Laboral',\n                         'Detall situaci\u00f3 laboral', 'trucades']]\ndf_formacion = df_soc_eco.groupby(['Formaci\u00f3'], as_index=False).agg({'trucades':'sum'})\ndf_formacion.sort_values('trucades', ascending=False, inplace=True)\ndf_formacion['% llamadas'] = 100*np.round(df_formacion.trucades\/df_formacion.trucades.sum(),4)\ndf_formacion","ba4bfb5e":"fig = px.funnel(df_formacion, x='Formaci\u00f3', y='% llamadas', \n                title = 'Imagen 4. 2. 2. 1.: % de llamadas al 900 900 120 seg\u00fan formaci\u00f3n',\n                template=\"simple_white\")\nfig.show()","2b4a4746":"df_formacion_3140_Casada = \\\ndf_perfil.query(\"`\u00das previ servei` == 'No'     and\\\n                  Edat == 'Entre 31 i 40 anys' and\\\n                 `Estat Civil` == 'Casada'\")\n\ndf_formacion_3140_Casada =\\\ndf_formacion_3140_Casada[['Data', 'Estat Civil', 'Formaci\u00f3',\n                          'Situaci\u00f3 Laboral','Detall situaci\u00f3 laboral', 'trucades']]\ndf_formacion_3140_Casada = df_formacion_3140_Casada\\\n                           .groupby(['Formaci\u00f3'], as_index=False)\\\n                           .agg({'trucades':'sum'})\n\ndf_formacion_3140_Casada.sort_values('trucades', ascending=False, inplace=True)\ndf_formacion_3140_Casada['% llamadas'] = 100*np.round(df_formacion_3140_Casada.trucades\/df_formacion_3140_Casada.trucades.sum(),4)\ndf_formacion_3140_Casada","60ea0a77":"fig = px.funnel(df_formacion_3140_Casada, x='Formaci\u00f3', y='% llamadas',\n                title = 'Imagen 4. 2. 2. 2.: % Llamadas seg\u00fan formaci\u00f3n, en mujeres casadas de 31-40',\n                template=\"simple_white\")\nfig.show()","aa1f917b":"df_situacion_laboral = df_soc_eco.query(\"`Situaci\u00f3 Laboral` != 'No consta'\")","dddf21f8":"df_situacion_laboral['Situaci\u00f3 Laboral'].value_counts()","d1c3226b":"df_situacion_laboral['Detall situaci\u00f3 laboral'].value_counts()","99ebeba7":"df_situacion_laboral = df_situacion_laboral.groupby(['Situaci\u00f3 Laboral','Detall situaci\u00f3 laboral'], as_index=False).agg({'trucades':'sum'})\ndf_situacion_laboral['suma'] = df_situacion_laboral.groupby('Detall situaci\u00f3 laboral').transform('sum').trucades\ndf_situacion_laboral.sort_values(['Situaci\u00f3 Laboral','suma'], ascending=True, inplace=True)\ndf_situacion_laboral","81454b19":"fig = px.funnel(df_situacion_laboral, \n                x='trucades',\n                y='Detall situaci\u00f3 laboral',\n                color='Situaci\u00f3 Laboral', \n                color_discrete_map={\n                    \"Independent econ\u00f2micament\": \"#017588\", \n                    \"Dependent econ\u00f2micament\": \"#408B53\"\n                },\n                template=\"simple_white\",\n                title='Imagen 4. 2. 2. 3.: Gr\u00e1f. escalera\/embudo situaci\u00f3n laboral')\nfig.show()","6ded2417":"df_situacion_laboral = df_perfil\\\n                       .query(\"`\u00das previ servei` == 'No'       and\\\n                                Edat == 'Entre 31 i 40 anys'   and\\\n                               `Estat Civil` == 'Casada'       and\\\n                                Formaci\u00f3 == 'Estudis primaris' and\\\n                               `Situaci\u00f3 Laboral` != 'No consta'\")\n\ndf_situacion_laboral = df_situacion_laboral\\\n                       .groupby(['Situaci\u00f3 Laboral','Detall situaci\u00f3 laboral'], as_index=False)\\\n                       .agg({'trucades':'sum'})\ndf_situacion_laboral['suma'] = df_situacion_laboral.groupby('Detall situaci\u00f3 laboral').transform('sum').trucades\ndf_situacion_laboral.sort_values(['Situaci\u00f3 Laboral','suma'], ascending=False, inplace=True)\n\nfig = px.funnel(df_situacion_laboral, \n                y='trucades', \n                x='Detall situaci\u00f3 laboral',\n                color='Situaci\u00f3 Laboral', \n                color_discrete_map={\n                    \"Independent econ\u00f2micament\": \"#017588\", \n                    \"Dependent econ\u00f2micament\": \"#408B53\"\n                },\n                template=\"simple_white\",\n                title='Imagen 4. 2. 2. 3. Situaci\u00f3n laboral de Mujeres casadas de 31-40 a\u00f1os <br>\\\n                                con solo la educaci\u00f3n primaria')\nfig.show()","58f8b95d":"df_extranjera = df_perfil.copy().query(\"`\u00das previ servei` == 'No' and\\\n                                         Nacionalitat != 'Espanya'\")","4648ca62":"df_extranjera = df_extranjera.groupby(['Any','Nacionalitat'], as_index=False).agg({'trucades':'sum'})\n# Observacion: Hago una suma acumulada por Nacionalidad\ndf_extranjera['Llamadas acumuladas'] = df_extranjera.groupby('Nacionalitat')['trucades'].transform(pd.Series.cumsum)\ndf_extranjera = df_extranjera.sort_values(['Any','trucades'], ascending=[True, False])\ndf_extranjera.head(15)","99a459ca":"fig = px.bar(df_extranjera, x=\"Nacionalitat\", y=\"Llamadas acumuladas\", color=\"Nacionalitat\",\n              animation_frame=\"Any\", animation_group=\"Nacionalitat\", range_y=[0,11000],\n             title = 'Imagen 4. 2. 3. 1.: Acumulaci\u00f3n de llamadas seg\u00fan nacionalidad <br>\\\n                                 desde 2013 hasta el a\u00f1o marcado')\nfig.show()","989099f6":"ine_data.head()","caae3687":"cardinales_poblacionales = ine_data.groupby(['Espa\u00f1oles.Extranjeros'], as_index=False).agg({'Total':'sum'})\ncardinales_poblacionales['Nacionalidad'] = ['Espa\u00f1ola','Extranjera']\ncardinales_poblacionales.drop(columns = ['Espa\u00f1oles.Extranjeros'],\n                             axis=1, inplace=True)\ncardinales_poblacionales = cardinales_poblacionales[['Nacionalidad','Total']]\ncardinales_poblacionales.rename(columns={'Total':'Poblacion'}, inplace=True)\ncardinales_poblacionales","b9634a3e":"def extranjera(x):\n    if x == 'Espanya':\n        return 'Espa\u00f1ola'\n    else:\n        return 'Extranjera'","c94c2b2f":"df_extranjera = df_perfil.copy().query(\"`\u00das previ servei` == 'No'\")\ndf_extranjera = df_extranjera.groupby(['Any','Nacionalitat'], as_index=False).agg({'trucades':'sum'})\ndf_extranjera.head(6)","e83ab740":"df_extranjera['Nacionalidad'] = list(map(extranjera, df_extranjera['Nacionalitat']))\ndf_extranjera.drop(columns = ['Nacionalitat'],\n                             axis=1, inplace=True)\ndf_nacionalidad = df_extranjera.groupby(['Any','Nacionalidad'], as_index=False)\\\n                             .agg({'trucades':'sum'})\ndf_nacionalidad.head()","1eafb944":"datos_relativizados = pd.merge(df_nacionalidad, cardinales_poblacionales, how='inner', on=['Nacionalidad'])\\\n                                .sort_values(['Any','Nacionalidad'])\ndatos_relativizados['Llamadas acumuladas'] = datos_relativizados.groupby('Nacionalidad')['trucades'].transform(pd.Series.cumsum)\ndatos_relativizados['porcentaje'] = np.round(100*datos_relativizados['Llamadas acumuladas']\/datos_relativizados['Poblacion'],4)\ndatos_relativizados.head(6)","8827861e":"datos_relativizados.tail(2)","93e49c07":"fig = px.bar(\n             datos_relativizados, \n             x=\"Nacionalidad\", \n             y=\"porcentaje\", \n             color=\"Nacionalidad\",\n              animation_frame=\"Any\", \n             animation_group=\"Nacionalidad\", \n             range_y=[0,2.5],\n             title = 'Imagen 4. 2. 3. 2.: Porcentaje de acumulaci\u00f3n de mujeres que han <br>\\\n                                 hecho uso del 900 900 120 seg\u00fan nacionalidad <br>\\\n                                 desde 2013 hasta el a\u00f1o marcado')\nfig.show()","1239a625":"df_extranjera = df_perfil.copy().query(\"`\u00das previ servei` == 'No' and\\\n                                         Nacionalitat != 'Espanya'\")\ndf_extranjera = df_extranjera.groupby(['Temps resid\u00e8ncia'], as_index=False).agg({'trucades':'sum'})\ndf_extranjera = df_extranjera.sort_values('trucades', ascending=False)\ndf_extranjera.value_counts()","bad5bd9f":"df_agresor =  df_perfil.query(\"`\u00das previ servei` == 'No'\")\ndf_agresor =  df_perfil.query(\"`\u00das previ servei` == 'No'\")\\\n                        [['Viol\u00e8ncia f\u00edsica', 'Viol\u00e8ncia psicol\u00f2gica', \n                          'Viol\u00e8ncia sexual', 'Viol\u00e8ncia econ\u00f2mica']]\npd.crosstab(index=df_agresor['Viol\u00e8ncia f\u00edsica'], columns='How many')","eaacb2e4":"pd.crosstab(index=df_agresor['Viol\u00e8ncia psicol\u00f2gica'], columns='How many')","0a6931e8":"pd.crosstab(index=df_agresor['Viol\u00e8ncia sexual'], columns='How many')","4dd66af8":"pd.crosstab(index=df_agresor['Viol\u00e8ncia econ\u00f2mica'], columns='How many')","3d5645d4":"df_relacion =  df_perfil.query(\"`\u00das previ servei` == 'No'\")\ndf_relacion = df_relacion.groupby(['\u00c0mbit viol\u00e8ncia masclista','trucades'], as_index=False)\\\n                         .agg({'trucades':'sum'}).sort_values('trucades', ascending=False)\ndf_relacion","03f7918d":"df_relacion =  df_perfil\\\n                .query(\"`\u00das previ servei` == 'No' and\\\n                        `\u00c0mbit viol\u00e8ncia masclista` == '\u00c0mbit de la parella'\")\n\ndf_relacion = df_relacion\\\n               .groupby(\n                        ['Situaci\u00f3 fills\/filles','Conviu agressor',\n                         'Relaci\u00f3 agressor','Temps de relaci\u00f3','trucades'],\n                        as_index=False\n                        )\\\n               .agg({'trucades':'sum'})\n\ndf_fills = df_relacion.groupby(['Situaci\u00f3 fills\/filles'], as_index=False)\\\n                      .agg({'trucades':'sum'})\\\n                      .sort_values('trucades', ascending=False)\n\ncolors = ['rgb(255, 0, 0)', 'rgb(255, 50, 50)', 'rgb(255, 80, 80)',\n          'rgb(255, 100, 100)','rgb(255, 130, 130)', 'rgb(255, 150, 150)',\n          'rgb(255, 200, 200)']\n\ndata = {'situacion' : df_fills['Situaci\u00f3 fills\/filles'], 'Color' : colors}\ndf = pd.DataFrame(data)\n\nfig = go.Figure(data=[\n    go.Table(\n        header=dict(\n            values=[\"<b>Situaci\u00f3<\/b>\", \"<b>Trucades<\/b>\"],\n            line_color='white', fill_color='white',\n            align='center', font=dict(color='black', size=30)),\n        cells=dict(\n            values=[df_fills['Situaci\u00f3 fills\/filles'], df_fills['trucades']],\n            line_color='white', fill_color=[df.Color],\n            align='center', font=dict(color='white', size=20), height=40)\n    )\n])\n\nfig.show()","e51c3fa6":"df_relacion = df_relacion.groupby(['Conviu agressor'], as_index=False)\\\n           .agg({'trucades':'sum'}).sort_values('trucades', ascending=False)\ndf_relacion['porcentaje'] = 100*df_relacion['trucades']\/df_relacion['trucades'].sum()\ndf_relacion","27b93b0b":"df_perfil.query(\"`\u00das previ servei` == 'No'                            and\\\n                 `\u00c0mbit viol\u00e8ncia masclista` == '\u00c0mbit de la parella' and\\\n                 `Relaci\u00f3 agressor` == 'Exparella'                    and\\\n                 `Conviu agressor` == 'No'\")\\\n           .groupby(['Situaci\u00f3 fills\/filles'], as_index=False)\\\n           .agg({'trucades':'sum'}).sort_values('trucades', ascending=False)","ec36d49d":"df_vinculos =  df_perfil.query(\"`\u00das previ servei` == 'No'\")","5d5ef526":"df_vinculos['Persona que truca'].value_counts()","1d4fe1f1":"df_vinculos['Detall familiar o persona proopera'].value_counts().sum()","8b5126cd":"100*df_vinculos['Persona que truca'].value_counts()\/(df_vinculos['Persona que truca'].value_counts().sum())","f6034636":"porcentajes = 100*df_vinculos['Detall familiar o persona proopera'].value_counts()\\\n\/(df_vinculos['Detall familiar o persona proopera'].value_counts().sum())\nporcentajes","790c7ff7":"#https:\/\/plotly.com\/python\/pie-charts\/\n#https:\/\/www.tutorialspoint.com\/plotly\/plotly_bar_and_pie_chart.htm\ndata = {\n   \"values\": porcentajes.values,\n   \"labels\": porcentajes.index,\n   \"domain\": {\"column\": 0},\n   \"name\": \"v\u00ednculo\",\n   \"hoverinfo\":\"label+percent+name\",\n   \"hole\": .5,\n   \"type\": \"pie\"\n}\ndata = [data]\nlayout = go.Layout(\n   {\n      \"title\":\"Imagen 4. 2. 6. 1.: Porcentajes seg\u00fan v\u00ednculo sobre el total de terceros que llaman\",\n      \"grid\": {\"rows\": 1, \"columns\": 1},\n      \"annotations\": [\n         {\n            \"font\": {\n               \"size\": 10\n            },\n            \"showarrow\": False,\n            \"text\": \"V\u00ednculos\",\n            \"x\": 40,\n            \"y\": 0.5\n         }\n      ]\n   }\n)\nfig = go.Figure(data = data, layout = layout)\nfig.show()","0b519414":"df_perfil = df_truc_cat.copy()\ndf_perfil.query(\"`\u00das previ servei` == 'No'\")\\\n         .groupby(['Edat', 'Estat Civil', 'Situaci\u00f3 familiar', 'Relaci\u00f3 agressor','Situaci\u00f3 fills\/filles', \n                   'Formaci\u00f3', 'Situaci\u00f3 Laboral','\u00c0mbit viol\u00e8ncia masclista'], as_index=False)\\\n         .agg({'trucades':'sum'}).sort_values('trucades', ascending=False).head(6)","aecf73c6":"df_trucades['trucades'] = 1\ndf_trucades['Provincia'].value_counts().head(10)","0f3d9bba":"list_regiones = ['Barcelona', 'Tarragona', 'Girona', 'Lleida']\ndf_regiones = df_trucades.query(\"`\u00das previ servei` == 'No' and\\\n                  Provincia == @list_regiones\")\ndf_regiones['Comarca'].value_counts().head(10)","9b81e890":"df_regiones_any_aux = df_regiones.query(\"Any == 2018\").groupby('Comarca', as_index=False)\\\n                             .agg({'trucades':'sum'})\\\n                             .sort_values('Comarca',ascending=True)\ndf_regiones_any_aux.head(8)","d53e89e1":"!ls ..\/input\/","42487a88":"df_pob_comarcas_2018 = pd.read_csv(\"..\/input\/poblacioncomarcascat2018\/PobComarcasCat2018.csv\", header=2, sep =\";\")\ndf_pob_comarcas_2018.rename(columns = {'Unnamed: 0':'Comarca'}, inplace=True)\ndf_pob_comarcas_2018.drop(columns = ['Superficie km2'],\n                             axis=1, inplace=True)\ndf_pob_comarcas_2018.head(5)","f3baf36a":"df_regiones_any_aux.shape","91cf41a4":"# Se pierde Val d'Aran\ndf_regiones_any = pd.merge(df_regiones_any_aux, df_pob_comarcas_2018, how='inner', on=['Comarca'])\nprint(df_regiones_any.shape)\n# % afectadas alguna vez por violencia machista\ndf_regiones_any['% afectadas'] =  100*df_regiones_any['trucades']\/df_regiones_any['Poblaci\u00f3n']\ndf_regiones_any = df_regiones_any[['Comarca','% afectadas', 'Poblaci\u00f3n']]\ndf_regiones_any.head()","69de961c":"df_pib_comarcas_2018 = pd.read_csv(\"..\/input\/pibcatcsv2018\/PIBCat2018.csv\", sep=\";\")\ndf_pib_comarcas_2018.rename(columns = {'por habitante (miles de euros)':'PIB_h_m_eur'}, inplace=True)\ndf_pib_comarcas_2018 = df_pib_comarcas_2018[['Comarca','PIB_h_m_eur']]\ndf_regiones_any = pd.merge(df_regiones_any, df_pib_comarcas_2018, how='inner', on=['Comarca'])\nprint(df_regiones_any.shape)\ndf_regiones_any.head()","6ef2ae64":"df_paro_HM_2018 = pd.read_csv(\"..\/input\/parohm-comarcas-2018\/paroHM_comarcas_2018.csv\", header=2, sep=\";\")\ndf_paro_HM_2018.rename(columns = {'Unnamed: 0':'Comarca'}, inplace=True)\ndf_regiones_any = pd.merge(df_regiones_any, df_paro_HM_2018, how='inner', on=['Comarca'])\ndf_regiones_any.head()","8ad380e5":"df_regiones_any['%_paro_hombres'] = 100*df_regiones_any['Hombres']\/ df_regiones_any['Poblaci\u00f3n']\ndf_regiones_any['%_paro_mujeres'] = 100*df_regiones_any['Mujeres']\/ df_regiones_any['Poblaci\u00f3n']\ndf_regiones_any.drop(columns = ['Hombres','Mujeres', 'Total'], axis=1, inplace=True)\ndf_regiones_any.head()","562d50ff":"df_indicadores_sociales_2018 = pd.read_csv(\"..\/input\/indicadores-ayuda-social-2018v3\/indicadores_ayuda_social_2018.csv\", sep=\",\")\n# Indicadores en porcentajes\ndf_indicadores_sociales_2018 = df_indicadores_sociales_2018[[\"Literal\",\n                                                             \"Prestacions de desocupaci\u00f3 (3)\",\n                                                             \"Prestacions d'ajut al lloguer\"]]\ndf_indicadores_sociales_2018.rename(columns = {\"Literal\":\"Comarca\",\n                                            \"Prestacions de desocupaci\u00f3 (3)\":'%_prestaciones_desempleo',\n                                            \"Prestacions d'ajut al lloguer\":'%_ayudas_alquiler'}, inplace=True)\ndf_indicadores_sociales_2018.head()","93b545dc":"df_regiones_any = pd.merge(df_regiones_any, df_indicadores_sociales_2018, how='inner', on=['Comarca'])\ndf_regiones_any.drop(columns = ['Poblaci\u00f3n'], axis=1, inplace=True)\nprint(df_regiones_any.shape)\ndf_regiones_any.head()","49fbf27c":"df_regiones_any.index = df_regiones_any['Comarca']\ndf_regiones_any.drop(columns = ['Comarca'], axis=1, inplace=True)\ndf_regiones_any.head()","630e422e":"##### Autor: Jos\u00e9 Antonio Esteban Rodr\u00edguez\n\ndef ACP(X, q=2, print_=False, umbral=0.8): \n    \n    # OBS: X ha de ser un pandas dataframe\n    import numpy as np\n    import pandas as pd\n    from sklearn.preprocessing import StandardScaler\n    \n    subject_names = X.index.values\n    X_array = X.values\n    sc = StandardScaler()\n    X_std = sc.fit_transform(X_array) \n    n = X_std.shape[0]\n    p = X_std.shape[1]\n    \n    # Hallamos S matriz de correlaciones de X o matriz de convarianzas de Z\n    # cov_mat = np.cov(X_std.T)*((n-1)\/n)\n    cov_mat = X.corr(method ='pearson')\n    \n    # Hallamos valores y vectores propios de S\n    eigen_vals, eigen_vecs = np.linalg.eig(cov_mat)\n    eigen_pairs = [(eigen_vals[i], eigen_vecs[:, i]) for i in range(0,len(eigen_vals)) ]\n    eigen_pairs.sort(key=lambda k:k[0], reverse = True)\n    \n    W = eigen_pairs[0][1][:, np.newaxis]\n    for i in range(1,p):\n        W = np.hstack((W, eigen_pairs[i][1][:, np.newaxis]))\n        \n    # SCORES O COMPONENTES PRINCIPALES\n    Y = X_std.dot(W)\n    Y_ret = Y[:,0:q]\n    Y_ret = pd.DataFrame(Y_ret, columns = list(range(1,q+1)) )\n    Y_ret.rename(columns=lambda x: 'Comp ' + str(x), inplace=True)\n    Y_ret.index = subject_names\n    \n    # CALCULO DE VARIANZAS\n    TOTAL = sum(eigen_vals)\n    var_exp = sorted(eigen_vals, reverse = True)\n    VA = np.cumsum(var_exp)\/TOTAL\n    VAR = pd.DataFrame({'var_exp':var_exp\/TOTAL, 'cum_var_exp':VA}, index = range(1,p+1))\n    \n    if (q == 1): \n        L = np.sqrt(var_exp)[0]\n    else:\n        L = np.diag(np.sqrt(var_exp)[0:q])    \n    W = W[:,0:q]\n    R = W[:,0:q].dot(L)\n    df_R = pd.DataFrame(R, columns = list(range(1,q+1)))\n    df_R.index = X.columns.values\n    df_R.rename(columns=lambda x: 'Comp ' + str(x), inplace=True)\n    \n    # CALIDAD DE REPRESENTACION DE LAS VARIABLES\n    R_V = R*R\n    R_V = pd.DataFrame(np.transpose(df_R*df_R.values))\n    R_V = pd.DataFrame(R_V.apply(sum))\n    R_V.columns = ['Variables']\n    # R_V.rename('Quality')\n    \n    # CALIDAD DE REPRESENTACI\u00d3N DE INDIVIDUOS\n    Y = pd.DataFrame(Y, columns = list(range(1,p+1)) )\n    Y.rename(columns=lambda x: 'Comp ' + str(x), inplace=True)\n    Y.index = range(1,n+1)\n    YI = Y*Y\n    YI = pd.DataFrame(np.transpose(YI.values[:,0:q]))\n    num = pd.DataFrame(YI.apply(sum))\n    X_std_I = pd.DataFrame(np.transpose(X_std))\n    XI = pd.DataFrame(X_std_I*X_std_I)\n    denom = pd.DataFrame(XI.apply(sum))\n    ro = np.divide(num,denom)\n    ro = pd.DataFrame(ro)\n    ro.index = subject_names\n    ro.columns = ['IND']\n    \n    ## REPRESENTACIONES EN EL PLANO\n    import matplotlib.pyplot as plt\n    \n    # PLOT VARIANZAS\n    plt.figure(figsize=(16,10))\n    # fig, axes = plt.subplots(figsize=(15,15))\n    plt.subplot(2,2,1)\n    plt.bar(range(1,p+1), var_exp\/TOTAL, alpha = 0.6, align='center', label='Individual explained variance')\n    plt.step(range(1,p+1), VA, where = 'mid', label='Cumulative explained variance (VA)')\n    plt.ylabel('Explained variance ratio')\n    plt.xlabel('Principal component index')\n    plt.legend(loc='best')\n    # Threshold \\mu\n    plt.axhline(y=umbral, color='red')\n    plt.title('Variance')\n    \n    # PLOT INDIVIDUOS\n    types1 = subject_names\n    # print(Y.values)\n    # print(Y.values[:,1])\n    y1_coords = Y.values[:,0]\n    y2_coords = Y.values[:,1]\n    \n    plt.subplot(2,2,2)\n    for i, tipo in enumerate(types1):\n        y1 = y1_coords[i]\n        y2 = y2_coords[i]\n        plt.scatter(y1, y2, marker='x', color='white')\n        plt.text(y1, y2, tipo, fontsize=9, color='blue')\n    plt.axhline(y = 0, color='black', linewidth = 0.1)\n    plt.axvline(x = 0, color='black', linewidth = 0.1)\n    plt.xlabel('Comp. 1')\n    plt.ylabel('Comp. 2')\n    plt.title('INDIVIDUOS')\n    \n    # PLOT VARIABLES\n    plt.subplot(2,2,3)\n    Correlations = df_R.values[:,0:2] \n    types2 = df_R.index.values\n    r1_coords = Correlations[:,0]\n    r2_coords = Correlations[:,1]\n\n    for i, tipo in enumerate(types2):\n        r1 = r1_coords[i]\n        r2 = r2_coords[i]\n        plt.scatter(r1, r2, marker='x', color='white')\n        plt.text(r1, r2, tipo, fontsize=8, color='red')\n    plt.axhline(y=0, color='black', linewidth=0.2)\n    plt.axvline(x=0, color='black', linewidth=0.2)\n    axes = plt.gca()\n    axes.set_xlim([-1.2,1.2])\n    axes.set_ylim([-1.2,1.2])\n    plt.title('VARIABLES')\n    \n    # BIPLOT\n    plt.subplot(2,2,4)\n    for i, tipo in enumerate(types2):\n        r1 = r1_coords[i]\n        r2 = r2_coords[i]\n        plt.scatter(r1, r2, marker='x', color='white')\n        plt.text(r1, r2, tipo, fontsize=8, color='red')\n    plt.axhline(y = 0, color='black', linewidth = 0.2)\n    plt.axvline(x = 0, color='black', linewidth = 0.2)\n\n    for i, tipo in enumerate(types1):\n        y1 = y1_coords[i]\/np.sqrt(var_exp[0])\n        y2 = y2_coords[i]\/np.sqrt(var_exp[1])\n        plt.scatter(y1, y2, marker='x', color='white')\n        plt.text(y1, y2, tipo, fontsize=9, color='blue')\n    plt.axhline(y = 0, color='black', linewidth=0.1)\n    plt.axvline(x = 0, color='black', linewidth=0.1)\n    plt.xlabel('Comp. 1')\n    plt.ylabel('Comp. 2')\n    plt.title('BIPLOT')\n    \n    # PLOT 3D \n    # https:\/\/github.com\/plotly\/plotly.py\/blob\/master\/doc\/python\/text-and-annotations.md\n    if q ==3:\n        import plotly.graph_objects as go\n        Y3D = Y[['Comp 1','Comp 2','Comp 3']].copy()\n        Y3D['name'] = types1\n        Y3D['size'] = 1\n        Y3D['Tipo'] = 'Comarca'\n        Y3D['symbol'] = 'ball'\n        Correlations = pd.DataFrame(df_R.values[:,0:3], columns=['Comp 1','Comp 2','Comp 3'])\n        Correlations['name'] = types2\n        Correlations['size'] = 6\n        Correlations['Tipo'] = 'Variable'\n        Correlations['symbol'] = 'Diamond'\n        DF = pd.concat([Y3D, Correlations], sort=False)\n        import plotly.express as px\n        fig = px.scatter_3d(DF, x='Comp 1', y='Comp 2', z='Comp 3',\n                            text='name', color='Tipo', size='size', symbol='symbol',\n                            range_x = [DF['Comp 1'].min()-1.5, DF['Comp 1'].max()+1.5],\n                            range_y = [DF['Comp 2'].min()-1.5, DF['Comp 2'].max()+1.5],\n                            range_z = [DF['Comp 3'].min()-1.5, DF['Comp 3'].max()+1.5],\n                            title = \"An\u00e1lisis de Componentes Principales con 3 dimensiones\")\n        name = 'Proyecci\u00f3n 3D'\n        # Default parameters which are used when `layout.scene.camera` is not provided\n        camera = dict(\n            eye=dict(x=0.2, y=0.2, z=0.25)\n        )\n\n        fig.update_layout(scene_camera=camera, title=name)\n        fig.show()\n    if print_ == True:\n        print(\"Varianza:\\n\",VAR,\"\\n\")\n        print(\"Correlaciones:\\n\",df_R,\"\\n\")\n        # CRV: Calidad de representaci\u00f3n de variables\n        print(\"CRVs:\\n\", R_V, \"\\n\")\n        # CRI: Calidad de representaci\u00f3n de individuos\n        print(\"CRIs:\\n\", ro)\n        # print(Y_ret)\n    return VAR, df_R, R_V, ro, W, Y_ret","baf8a132":"VAR, df_R, R_V, ro, W, Y_ret = ACP(df_regiones_any, q = 3, umbral = 0.75)","30fa5e0a":"VAR.iloc[0:3,]","16d30530":"# Calidad de representaci\u00f3n de variables\nR_V","72cfac77":"# Calidad representaci\u00f3n individuos inferiores a 0.65\nro.query(\"IND < 0.65\")","2935e7aa":"# Numero de Comarcas no bien representadas en el espacio proyectado\nnp.sum(ro < 0.65).values[0]","2cd2fe3a":"# % de Comarcas no bien representadas\nf'{100*(np.sum(ro < 0.65).values[0]\/ro.shape[0])} %'","1b2ad026":"distortions = []\nsc = StandardScaler()\nX_std = sc.fit_transform(df_regiones_any)\nfor i in range(1, 14):\n    km = KMeans(n_clusters=i, \n                init='k-means++', \n                n_init=10, \n                max_iter=500, \n                random_state=5)\n    km.fit(X_std)\n    distortions.append(km.inertia_)\nplt.plot(range(1, 14), distortions, marker='o')\nplt.xlabel('Number of clusters')\nplt.ylabel('SSE')\nplt.title('Regla del codo con SSE')\nplt.tight_layout()\nplt.show()","5225dfa1":"km = KMeans(n_clusters=3, \n            init = 'k-means++', \n            n_init=50, \n            max_iter=500,\n            tol=1e-04,\n            random_state=5)\n\ny_km = km.fit_predict(X_std)\ndf_y_km = pd.DataFrame(y_km, columns = ['Cluster'])\n# clusters\ndf_y_km.head()","cedadc37":"Y_aux = Y_ret[['Comp 1', 'Comp 2','Comp 3']]\nY_aux['cluster'] = y_km\nL = []\nM = []\nfor i in range(Y_aux.shape[0]):\n    if Y_aux['cluster'].iloc[i] == 0:\n        L.append('green')\n        M.append('o')\n    elif Y_aux['cluster'].iloc[i] == 1:\n        L.append('red')\n        M.append('*')\n    else:\n        L.append('blue')\n        M.append('x')\n\nY_aux['col'] = L\nY_aux['simb'] = M\n\nfig = plt.figure(figsize=(15,10))\naxes = fig.add_axes([0.15, 0.2, 0.75, 0.7])\nfor i in range(Y_aux.shape[0]):\n    y1 = Y_aux['Comp 1'].iloc[i]\n    y2 = Y_aux['Comp 2'].iloc[i]\n    plt.scatter(y1, y2, marker = Y_aux['simb'].iloc[i], c = Y_aux['col'].iloc[i])\n    axes.text(y1*1, y2*1.12, Y_aux.index.values[i], fontsize=12, color = Y_aux['col'].iloc[i])\naxes.set_xlabel('Comp 1')\naxes.set_ylabel('Comp 2')\naxes.axhline(y = 0, color='black', linewidth = 0.2)\naxes.axvline(x = 0, color='black', linewidth = 0.2)\nplt.title('Imagen 5. 2. 1.: CLUSTERS en 2D de las comarcas')\nplt.xlim([-4.2, 5.2])\nplt.ylim([-4, 3])\nplt.show()","27819a56":"Y_aux = Y_ret[['Comp 1','Comp 2','Comp 3']].copy()\nY_aux['Comarca'] = Y_aux.index.values\nY_aux['size'] = 1\nY_aux['Cluster'] = np.array(df_y_km['Cluster'].astype(str))\nY_aux['symbol'] = Y_aux['Cluster']\n\nfig = px.scatter_3d(Y_aux, x='Comp 1', y='Comp 2', z='Comp 3',\n                    text='Comarca', color='Cluster', size='size', symbol='symbol',\n                    range_x = [Y_aux['Comp 1'].min()-1.5, Y_aux['Comp 1'].max()+1.5],\n                    range_y = [Y_aux['Comp 2'].min()-1.5, Y_aux['Comp 2'].max()+1.5],\n                    range_z = [Y_aux['Comp 3'].min()-1.5, Y_aux['Comp 3'].max()+1.5],\n                    title = \"An\u00e1lisis de Componentes Principales con 3 dimensiones\")\nname = 'Imagen 5. 2. 1.: CLUSTERS en 3D de las comarcas'\n# Default parameters which are used when `layout.scene.camera` is not provided\ncamera = dict(\n    eye=dict(x=0.3, y=0.3, z=0.35)\n)\nfig.update_layout(scene_camera=camera, title=name)\nfig.show()","f2677e17":"---","8bc2a5b8":"**Observaci\u00f3n**: el tel\u00e9fono 900 900 120 est\u00e1 a disposici\u00f3n de mujeres. El hecho de que tengamos hombres llamando a ese n\u00famero no es porque denuncien una situaci\u00f3n en la que ellos est\u00e9n involucrados, sino que son unos terceros denunciando una situaci\u00f3n de maltrato hacia una mujer. Por tanto, la columna edad del conjunto de datos en cuesti\u00f3n hace referencia a la edad de la mujer presuntamente afectada por una situaci\u00f3n de maltrato. ","6ee82dd3":"## **Asignatura:** Miner\u00eda de Datos \n\n## **Pr\u00e1ctica 1**: An\u00e1lisis de datos exploratorio\n\n## **Tema**: Llamadas al 900 900 120 en Catalu\u00f1a\n\n### **Autor:** Jos\u00e9 Antonio Esteban Rodr\u00edguez\n\n#### **Profesores:** David Tom\u00e1s Y David Gil\n---\n\n#### NOTA: todas las conclusiones establecidas aqu\u00ed son construidas en base a lo que expresan los datos. En ning\u00fan momento se busca entrar en ning\u00fan tipo de valoraci\u00f3n personal al respecto.\n\n---","8af960e0":"## \u00bfEl tiempo de residencia de una extranjera tiene importancia?","11a5c2bb":"A continuaci\u00f3n calculamos los cardinales de espa\u00f1olas y extranjeras en el a\u00f1o 2020 (recordemos que nos tom\u00e1bamos la licencia de suponer que los cardinales no cambiaban mucho a lo lardo de estos 7 a\u00f1os para facilitarnos las cosas).","ad7d9eb6":"## Determinar el grado de la serie diferencia, escoger $d$.\n\nCuando escoges $d$ lo que est\u00e1s haciendo es transformar la serie $X_t$ a una serie estacionaria  $\\nabla^d X_t$ (sin tendencia, \"ponerla recta\"). Existe alg\u00fan teorema al respecto que afirma que bajo unas determinadas condiciones de regularidad existe un $d$ m\u00ednimo para el que $\\forall d \\geq d_0$ la serie transformaci\u00f3n $\\nabla^d X_t$ es siempre estacionaria. Es decir, escogiendo un $d$ suficientemente grande se consigue convertir la serie a una serie estacionaria, sin embargo, conforme m\u00e1s grande es $d$ m\u00e1s coste computacional y esto no interesa (no recuerdo si incluso se perd\u00eda algo de precisi\u00f3n en las predicciones, tendr\u00eda que comprobarlo). \n\nLa clave es, por tanto, conseguir el menor $d$ que satisfaga que $\\nabla^d X_t$ es estacionaria. \n\nFormas de determinar este par\u00e1metro $d$ (se pueden complementar entre ellas para llegar a una decisi\u00f3n),\n\n   - **1.** Utilizar un **seasonplot** como los que hemos utilizado antes y comprobar si se concentran las gr\u00e1ficas (menos tendencia) como hice anteriormente. \n   \n   - **2.** Representar las funciones de autocorrelaci\u00f3n simple (**la ACF**) (asumo su conocimiento). Si se observa una tendencia decreciente, entonces se necesita una diferenciaci\u00f3n m\u00e1s de la serie. Aqu\u00ed presento una imagen de mi trabajo referenciado:\n   \n   ![Selection_104.png](attachment:Selection_104.png) \n   \n   En este caso se necesita al menos una diferenciaci\u00f3n m\u00e1s. Se har\u00eda y se volver\u00eda a comprobar hasta que cese dicho comportamiento. Es decir, $d \\geq 1$.","7fc75530":"El tiempo de residencia no aporta demasiado. Es trivial que a mayor tiempo de estancia (y, por ende, de relaci\u00f3n) mayor probabilidad de sufrir alg\u00fan tipo de violencia machista si el hombre es machista y la relaci\u00f3n es inestable.","4248e1e3":"El conjunto de datos representa un conjunto de **94490** registros donde cada fila representa una llamada al 900-900-120 en el \u00e1mbito restringi\u00e9ndonos al \u00e1mbito geogr\u00e1fico de Catalu\u00f1a. Para cada llamada tenemos **56** campos. El marco temporal del DataSet abarca el periodo 2013-01-01\/2020-12-31\n\nEl servicio de atenci\u00f3n permanente del 900 900 120 contra la violencia machista es un servicio gratuito y confidencial y funciona todos los d\u00edas del a\u00f1o, 24 horas del d\u00eda.\n\nLa l\u00ednea pone a disposici\u00f3n de la persona que llama el asesoramiento por parte de personas profesionales del \u00e1mbito de la asistencia social, de la abogac\u00eda y de la psicolog\u00eda, y en caso necesario, el contacto con los servicios de emergencia.","d741de53":"# [0. Datos sobre la Pr\u00e1ctica 1](#section0.)","91670f2c":"## PIB por habitante en Catalu\u00f1a 2018\n\nhttps:\/\/www.idescat.cat\/pub\/?id=aec&n=358&lang=es","c7f92384":"### \u00bfHay estacionalidad semanal?\nObs\u00e9rvese las semanas a lo largo de, e.g., el a\u00f1o 2013.","7d9a9931":"El conjunto de datos escogido ha sido el correspondiente al v\u00ednculo de **datos.gob.es** siguiente:\n\nhttps:\/\/datos.gob.es\/es\/catalogo\/a09002970-linea-de-atencion-contra-la-violencia-machista-900-900-120\n\nDicho conjunto de datos ha sido proporcionado por la administraci\u00f3n Auton\u00f3mica de la Generalitat de Catalunya, Institut Catal\u00e0 de les Dones. Es libre y est\u00e1 disponible en varios formatos, de los cuales hemos optado por el CSV.","eac12a2a":"## [4. 1. 5. Posibles problemas que podr\u00edan haber surgido en la serie diaria 900 900 120 y propuestas de resoluci\u00f3n en base a mi experiencia:](#subsection4.1.5.) \n\nA continuaci\u00f3n planteo todas los recursos que conozco en caso de haber tenido la mala suerte de encontrarnos con una serie temporal m\u00e1s compleja que la de este conjunto de datos.\n\n> + Observaciones: en caso de haber existido alg\u00fan problema de:\n   + **1.** Si hubiera habido tendencia la operaci\u00f3n diferencia en el modelo SARIMA lo resuelve. Esto equivale a tomar el menor $d$ en el modelo que estabiliza la serie.\n   + **2.** Si hubiera habido heterocedasticidad:\n       + 2\\. 1\\.  Existen transformaciones de la serie que la canonizan y que pueden complementarse con un modeo SARIMA. \n       + 2\\. 2\\.  En caso de no ser capaces de encontrar dichas transformaciones, se puede recurrir a un modelo GARCH si sus limitaciones lo permiten. \n       + 2\\. 3\\.  Tambi\u00e9n, si se disponen de los regresores oportunos se pueden emplear modelos de \u00e1rboles tipo Random Forest o XgBoost que combinados con alg\u00fan m\u00e9todo identificador de la tendencia general de la serie cubren la torpeza de los \u00e1rboles para inferir las tendencias de una serie. Esta combinaci\u00f3n de modelos pueden resultar eficaces en ocasiones. En un proyecto us\u00e9 una combinaci\u00f3n as\u00ed y result\u00f3 con un 88% de precisi\u00f3n media para cientos de series temporales.\n       + 2\\. 4\\. Redes neuronales con recurrencia.    \n   + **3.** Serie con estacionalidad compleja: \n       + 3\\. 1\\. Fuerte estacionalidad simple anual para una serie diaria. Fuerte problema para un modelo SARIMA, pues tomar $s = 365$ es un desprop\u00f3sito computacionalmente para la resoluci\u00f3n de ecuaciones en diferencia involucradas en las predicciones de un modelo SARIMA. De hecho, en el software R puede darte problemas (ya me ocurri\u00f3) y no trabajan bien. Por eso, para la serie de llamadas diarias al 900 900 120 en Catalu\u00f1a donde la estacionalidad es de $s = 7$, se tiene mucha suerte (no es que sea excesivamente habitual).\n       + 3\\. 2\\. Estacionalidad compleja o mixta: si aparte de la estacionalidad semanal hubiera estado presente a la par otro componente estacional anual, el modelo SARIMA estacional multiplicativo no lo cubre, pues solo trata la estacionalidad simple (ya me ha ocurrido en alg\u00fan proyecto). Aqu\u00ed se puede lidiar con XgBoost combinando con modelos que proporcionen tendencias.\n       + 3\\. 3\\. Estacionalidad irregular: esta sucede mucho con las series diarias de ventas o econ\u00f3micas. Por ejemplo, las fiestas de Semana Santa varian de un a\u00f1o a otro con respecto a su posici\u00f3n en el a\u00f1o lo cual puede generar equ\u00edvocos para un SARIMA obligando a utilizar regresores s\u00ed o s\u00ed.\n       \nExisten otros algoritmos muy buenos del tipo series temporales parecidos a SARIMA que permiten incluso ingresar regresores como \"Prophet\" (proporcionado por Facebook).","3b697797":"KMEANS es un algoritmo propio del \u00e1rea llamado Clustering (Algoritmos de agrupamiento). **Clustering consiste en establecer criterios que te permitan llevar a cabo un aprendizaje no supervisado para clasificar por grupos el conjunto de datos que tenemos}. Por aprendizaje no supervisado se entiende que el m\u00e9todo establece conclusiones sobre el propio conjunto de entrenamiento del algoritmo y no sobre una variable objetivo y un futuro conjunto de datos del que desconocemos algo. Es decir, los individuos del dataset no van acompa\u00f1ados de una target o variable de clasificaci\u00f3n previa que sirve de aprendizaje al algoritmo para clasificar, al contrario y como sucede en aprendizaje supervisado.\n\nEl algoritmo K-means agrupa objetos\/individuos en $k$ grupos bas\u00e1ndose en sus caracter\u00edsticas.\nEl algoritmo consta de $3$ pasos:\n\n+ 1\\. **Inicializaci\u00f3n**: una vez escogido el n\u00famero de grupos, $k$, se establecen $k$ centroides en el espacio de los datos, e.g., escogi\u00e9ndolos aleatoriamente (hay otras formas).\n+ 2\\. **Asignaci\u00f3n de los individuos a sus centroides**: cada individuo de los datos es asignado a su centroide m\u00e1s cercano.\n+ 3\\. **Actualizaci\u00f3n de los centroides**: se actualiza la posici\u00f3n del centroide de cada grupo tomando como nuevo centroide la posici\u00f3n del promedio de los objetos pertenecientes a dicho grupo.\n\n\nSe repiten los pasos $2$ y $3$ hasta que los centroides dejan de moverse, o se mueven por debajo de una distancia umbral en cada paso.\n\nEl algoritmo $k$-means es, de hecho, un problema de optimizaci\u00f3n. Sean $(x_1,\\dots,x_n)$ los n individuos de nuestro conjunto de datos formados por $d$ variables cada uno. El algoritmo $K$-means construye $k$ grupos donde se minimiza la suma de distancias de los objetos dentro de cada grupo $\\mathbf{S} = \\left\\lbrace S_1,S_2,\\dots, S_k \\right\\rbrace$ a su correspondiente centroide (la inercia total):\n\n$$\n\\underset{\\mathbf{\\mu}}{Min} \\; E \\big( \\mathbf{\\mu} \\big) = \\underset{\\mathbf{\\mu}}{Min} \\displaystyle \\sum_{i=1}^{k} \\displaystyle \\sum_{x_j \\in S_i} ||x_j - \\mathbf{\\mu}_i||^2\n$$\n\ndonde $\\mu_i$ es el centroide del grupo $S_i$ para $i=1,\\dots,k$ y donde $\\mathbf{\\mu}$ representa el conjunto de los centroides. \n\nEn cada actualizaci\u00f3n de los centroides, iterando $t$ veces, imponemos la condici\u00f3n de Fermat a la funci\u00f3n objetivo y se llega a que:\n$$\n\\nabla E = \\mathbf{0 }\n\\Longrightarrow \n\\dfrac{\\partial E}{\\partial \\mathbf{\\mu}_i} = 0 \n\\Longrightarrow \n\\mathbf{\\mu}_i^{(t+1)} = \\dfrac{1}{\\left|S_i^{(t)} \\right|} \\displaystyle \\sum_{x_j \\in S_i^{(t)}} x_j\n$$\n\nE aqu\u00ed denota la SSE (suma de errores cuadr\u00e1ticos) tambi\u00e9n llamada Inercia de Grupos.\n\nEs decir, en cada iteraci\u00f3n del problema la soluci\u00f3n es el promedio de los elementos de cada grupo como nuevo centroide y esto corresponde al paso $2$ mencionado antes. El paso 3 consiste en ir asignando cada $x_j$ al vector $\\mu_i^{(t+1)}$ m\u00e1s cercano y repetir el proceso. La reiteraci\u00f3n de estos pasos hasta la estabilizaci\u00f3n es el algoritmo $K$-means.\n\nSi, e.g., los individuos del conjunto de aprendizaje constan \u00fanicamente de dos variables, entonces se pueden representar los $K$ grupos resultantes en el espacio con colores como en la figura que sigue a continuaci\u00f3n:\n\n![IMG2.png](attachment:IMG2.png)\n\n### Elecci\u00f3n adecuada del hiperpar\u00e1metro $k$ (M\u00e9todo Elbow)\nEl **m\u00e9todo elbow** consiste en escoger el n\u00famero $k$ \u00f3ptimo como el menor entero $k$ tq $k+1$ implica que $|I_{k+1}-I_{k}| < \\varepsilon$, es decir, cuando el aumento del n\u00famero de grupos no tenga un impacto significativo sobre la inercia $I$ (la funci\u00f3n objetivo evaluada en el m\u00ednimo considerado, la suma de las inercias de los grupos). Este no es el \u00fanico m\u00e9todo, pues existen otros quiz\u00e1s m\u00e1s sofisticados como el criterio de silueta (silhouette method). \n\n### Criterio para una elecci\u00f3n favorable de centroides semilla: Kmeans ++\n\nKmeans ++  es un algoritmo de inicializaci\u00f3n de Kmeans cuyo objetivo es conseguir una elecci\u00f3n favorable de los centroides semilla y que consiste en:\n\n+ 1. Algoritmo de iniciaci\u00f3n previo para la elecci\u00f3n de centroides semilla\n+ 2. Kmeans cl\u00e1sico\n\nExactamente los pasos son los siguientes:\n\n+ 1. Inicializar un conjunto vac\u00edo M para almacenar los centroides. \n+ 2. Escoger un centro de entre los puntos de datos utilizando una variable aleatoria uniforme (discreta).\n+ 3. Para cada punto $x^{(i)}$ fuera de M, calcular $D(x) := d(x^{(i)}, M)^2$ , que es la distancia entre x y el centro m\u00e1s cercano que ya ha sido seleccionado.\n+ 4. Escoger un nuevo punto  $x^{(j)}$' al azar utilizando una distribuci\u00f3n de probabilidad ponderada de $\\dfrac{d(x^{(j)}, M)^2}{\\sum_i d(x^{(i)}, M)^2}$. El punto de muestra escogido se impone como $x^{(j)} = \\mu^{(p)}$, el nuevo centroide. N\u00f3tese, que en la f\u00f3rmula los puntos dentro de M tienen probabilidad 0 de ser escogidos (naturalmente).\n+ 5. Repetir paso 2 y 3 hasta que se hayan seleccionado k centros.\n+ $\\geq 6$. Ahora que los centros iniciales han sido elegidos, continuar utilizando k-means clustering est\u00e1ndar obviando el paso 1 de inicializaci\u00f3n de centroides. \n\n\nLa clave de Kmeans ++ es el punto 3. La probabilidad convenida en ese punto 3 favorece como candidatos los puntos lejanos, pues si son m\u00e1s lejanos tienen m\u00e1s distancia y, en cuyo caso, son m\u00e1s probables de ser seleccionados.\n\nDe hecho, esta extensi\u00f3n del m\u00e9todo K-means (Kmeans ++) es una opci\u00f3n fijada por defecto dentro de scikit learn.","ff966321":"Un 22.5% de Comarcas no superan un 65% de calidad en sus representaciones proyecci\u00f3n.\n\nPodr\u00eda llamarnos la atenci\u00f3n el caso de Ribera d'Ebre, pero no nos debe importar, est\u00e1 mal representado.\n\nEl caso de Barcelon\u00e8s s\u00ed es llamativo. Tiene un PIB alto, sin embargo, hay muchos casos de violencia machista. En teor\u00eda he relativizado el n\u00famero de casos (llamadas de distintas personas) en funci\u00f3n de la poblaci\u00f3n, pero seguramente se deba a que hay mucha m\u00e1s poblaci\u00f3n en dicha comarca.\n\nTarragon\u00e8s ser\u00eda una comarca donde la situaci\u00f3n es m\u00e1s grave en relaci\u00f3n a la violencia machista.","406e24cc":"Analizaremos un a\u00f1o: por ejemplo, 2018.","b74fcdd2":"## OBS:\n\nRecuerdo que he profundizado en los modelos SARIMA much\u00edsimo y que s\u00e9 realizar ajustes sarima con un grado de especializaci\u00f3n bastante avanzada:\n\nhttps:\/\/www.safecreative.org\/work\/2004293817985-forecasting-ajuste-de-un-modelo-sarima-a-una-serie-real\n\n\u00bfPor qu\u00e9 insisto? porque solo indicar c\u00f3mo establecer el par\u00e1metro $d$ del total de par\u00e1metros. En cuanto al resto de par\u00e1metros $(p, d, q) \\times (P, D, Q)_s$ son m\u00e1s complicados y no voy a profundizar m\u00e1s.\n\nPor \u00faltimo, recordemos que determinar $(p, d, q)$ no es determinar el modelo, sino determinar la complejidad del modelo y su comportamiento, despu\u00e9s de esto resta ajustar los coeficientes polinomiales de los polinomios de retardo. Es decir, escoger $(p, q)$ equivale un poco a  escoger la cantidad de predictores a usar en regresi\u00f3n lineal, pero luego queda estimar los coeficientes del modelo. ","3bc2ba83":"## KMEANS","c83e8c10":"El v\u00eddeo 4.2.2.1. muestra que los 4 estados civiles m\u00e1s frecuentes son:\n   + **1.**  Casada.\n   + **2.** Pareja de hecho.\n   + **3.** Separada. (Casi a la par con pareja de hecho)\n   + **4.** Soltera.\n   \nSeguramente el hecho de estar casada est\u00e1 de alguna forma correlacionada con las responsabilidades de tener hijos y con las dificultades que supone un divorcio. Tiene sentido que sea el estado civil m\u00e1s frecuente.","bc205c82":"Para la elecci\u00f3n del hiperpar\u00e1metro $K$ de los grupos vamos a usar el M\u00e9todo Elbow que hemos explicado antes.","6e9f3cc3":"* [0. Datos sobre la Pr\u00e1ctica 1](#section0.)\n\n\n* [1. Informaci\u00f3n sobre el DataSet](#section1.)\n\n    - [1. 1. Proveedor](#subsection1.1.)\n    - [1. 2. Significado del DataSet](#subsection1.1.)\n    - [1. 3. Descripci\u00f3n de los campos](#subsection1.2.)\n    \n\n* [2. Objetivos del trabajo, t\u00e9cnicas empleadas](#section2.)\n\n\n* [3. Carga, complejidad del DataSet y cuestiones de preprocesado](#section3.)\n    \n    - [3. 1. Carga de los datos](#section3.1.)\n    - [3. 2. Complejidad del dataset](#section3.2.)\n        - [3. 2. 1. Recuento de Missing-Values](#section3.2.1.)\n        - [3. 2. 2. Sobre imputaci\u00f3n de Missing-Values](#section3.2.2.)\n    - [3. 3. Preprocesado](#section3.3.)\n    \n\n* [4. An\u00e1lisis exploratorio en Catalu\u00f1a](#section4.) \n\n     - [4. 1. Descripci\u00f3n de la serie temporal llamadas al 900 900 120 en Catalu\u00f1a](#subsection4.1.)\n     \n         - [4. 1. 1. Conclusiones sobre la serie](#subsection4.1.1.)\n         - [4. 1. 2. Definici\u00f3n de modelo SARIMA](#subsection4.1.2.)\n         - [4. 1. 3. Identificaci\u00f3n del modelo SARIMA v\u00eda an\u00e1lisis de Box-Jenkins](#subsection4.1.3.)\n         - [4. 1. 4. Identificaci\u00f3n del modelo ARIMA v\u00eda optimizaci\u00f3n AIC, BIC, CV, etc.](#subsection4.1.4.)\n         - [4. 1. 5. Posibles problemas que podr\u00edan haber surgido en la serie diaria 900 900 120 y propuestas de resoluci\u00f3n en base a mi experiencia](#subsection4.1.5.)\n         - [4. 1. 6. Construcci\u00f3n de un modelo SARIMA](#subsection4.1.6.)\n         \n     - [4. 2. Perfiles relacionados con el 900 900 120](#subsection4.2.)\n     \n         - [4. 2. 1. Edad m\u00e1s frecuente de la v\u00edctima y grupos de riesgo seg\u00fan edad](#subsection4.2.1.)\n         - [4. 2. 2. Situaci\u00f3n socioecon\u00f3mica de la v\u00edctima](#subsection4.2.2.)\n         - [4. 2. 3. Sobre la mujer extranjera](#subsection4.2.3.)\n         - [4. 2. 4. Perfil m\u00e1s frecuente del presunto agresor](#subsection4.2.4.)\n         - [4. 2. 5. Sobre el tipo de relaci\u00f3n entre v\u00edctima y el presunto agresor](#subsection4.2.5.)\n         - [4. 2. 6. Relaci\u00f3n de la v\u00edctima con el denunciante cuando esta no es la que avisa](#subsection4.2.6.)\n         \n    \n* [5. Asignaci\u00f3n de presupuestos mediante PCA y Clustering comarcal](#section5.)\n\n     - [5. 1. Repaso te\u00f3rico](#section5.1.)\n     - [5. 2. Aplicaci\u00f3n a las Comarcas de Catalu\u00f1a y el 900 900 120](#section5.2.)\n     \n     \n* [6. Conclusion](#section6.)","0cd8c777":"## Los hijos en el \u00e1mbito de la pareja","58a3bf91":"## [5. 2. Aplicaci\u00f3n a las Comarcas de Catalu\u00f1a y el 900 900 120](#section5.2.)","9f05f4d9":"Concluimos que: \n\n   + 1\\. **\u00bfEl perfil de mujer m\u00e1s recurrente en la violencia machista?** Mujer casada de unos 31-40 a\u00f1os con solo la educaci\u00f3n primaria y con hijos conviviendo en el n\u00facleo familiar denunciando una situaci\u00f3n en el \u00e1mbito de la pareja.\n   \n   + 2\\. **\u00bfPerfil del presunto agresor y tipo de relaci\u00f3n?** Hombre cuyo rol se sit\u00faa dentro del \u00e1mbito de la pareja que ejerce presuntamente violencia psicol\u00f3gica en la mayor\u00eda de los casos y violencia f\u00edsica en menor medida pero en porcentajes altos. Casos aislados (hablando en t\u00e9rminos de porcentaje) de violencia sexual y econ\u00f3mica.\n\n   + 3\\. **\u00bfQu\u00e9 d\u00edas se pueden reforzar las l\u00edneas del 900 900 120 disponibles con la finalidad de que ninguna mujer quede desatendida en una situaci\u00f3n de riesgo?.** Se observan menos casos los fines de semana siguiendo un patr\u00f3n estacional. Se aconseja reforzar las l\u00edneas los d\u00edas laborables. Adem\u00e1s, se proporciona un modelo de predicci\u00f3n temporal para servir capacidad de anticipaci\u00f3n log\u00edstica.\n   \n   + 4\\. **\u00bfIdentificar marcadores socioecon\u00f3micos relacionados con el n\u00famero de llamadas y en base a estos segregar de alguna forma las comarcas de Catalu\u00f1a para la asignaci\u00f3n de presupuestos en concepto de lucha contra la violencia machista?.** \n   \n      - 4\\. 1\\. **Marcadores socioecon\u00f3micos**: Algo que cab\u00eda esperar, el \"% afectadas\" (por violencia machista) se sit\u00faa casi en ubicaciones opuestas a las ayudas econ\u00f3micas, i.e., las ayudas econ\u00f3micas alivian el estr\u00e9s social. Por el contrario, los indicadores de paro se sit\u00faan cerca de la variable \"% afectadas\", i.e., a m\u00e1s paro m\u00e1s estr\u00e9s social y m\u00e1s \"% afectadas\". \u00bfCon esto estoy afirmando que la violencia machista est\u00e1 causada por el estr\u00e9s social? Para desactivar las alarmas, simplemente dir\u00e9 que no. Tan solo conjeturo que el estr\u00e9s social puede agravar situaciones y aunque no sea una justificaci\u00f3n, parece ser que s\u00ed propicia este tipo de conducta indebida.\n      - 4\\. 2\\. **Segregaci\u00f3n de grupos**. Se han generado $3$ grupos con grado de gravedad: grave, intermedio, leve en relaci\u00f3n a la violencia machista. Los detalles se proporcionan en la secci\u00f3n anterior.","7d171409":"### [4. 2. 5. Sobre el tipo de relaci\u00f3n entre v\u00edctima y el presunto agresor](#subsection4.2.5.)","02f634b8":"Se pretende realizar un an\u00e1lisis a nivel de toda Catalu\u00f1a, i.e., sin tener en cuenta subregiones de dicho territorio. Por consiguiente, de todas las posibles variables que est\u00e1n presentes en el dataset, se han excluido las siguientes variables irrelevantes para tal fin:\n\n+ **Llengua**: Idioma en qu\u00e8 s\u2019ha efectuat la trucada\n+ **Comarca**: Comarca d\u2019on procedeix la trucada\n+ **\u00c0mbit**: territorial: \u00c0mbit territorial d\u2019on procedeix la trucada\n+ **Provincia**: Prov\u00edncia d\u2019on procedeix la trucada\n+ **Prov\u00edncia agrupada**: Prov\u00edncia des d\u2019on truca la persona agrupada en categories\n+ **Nombre fills\/filles**: Nombre de fills de la persona que truca o sobre qui es fa la consulta\n\nEl hecho de incluirlas las otras en el dataset no significa que se hayan tratado todas y cada una en el presente trabajo, sino que su inclusi\u00f3n se realiza para marcar que tienen un posible inter\u00e9s de cara un an\u00e1lisis a nivel de Catalu\u00f1a. \n\nComo el lector comprender\u00e1: \n+ 1\\. La selecci\u00f3n, a su vez, de variables de este subconjunto depender\u00e1 de la subsecci\u00f3n en la que se encuentre.\n+ 2\\. Este no es un estudio real, tan solo se pretende ser ilustrativo en este trabajo. Por lo tanto, a efectos de resultar pragm\u00e1ticos, y por no exceder las pretensiones de este trabajo, no es seguro que se utilicen todas las variables, sino \u00fanicamente aquellas que se entiendan como determinantes para cada an\u00e1lisis.\n\n#### Posibles an\u00e1lisis a nivel de Catalu\u00f1a: perfil de la persona que llama (nacionalidad, formaci\u00f3n, posici\u00f3n econ\u00f3mica, ...), perfil del presunto agresor, tipos de violencia que ejerce este \u00faltimo, medio de comunicaci\u00f3n m\u00e1s utilizado, etc.\n\nEs por esto que se han definido unos objetivos a priori, pues de lo contrario, se puede perder uno en los posibles an\u00e1lisis. Solo el hecho, de sumar a estos an\u00e1lisis la variable provincia o \u00e1mbito territorial puede complicar demasiado las cosas.","aafbede3":"Se tiene una sorpresa en la imagen 4. 2. 1. 4. y es que pese a que hay m\u00e1s llamadas procedentes de mujeres cuyo rango de edad es de 31 a 40 a\u00f1os, el porcentaje de reincidencia sobre el total de llamadas reincidentes es mayor para el rango de edad 41-50 a\u00f1os (supera ligeramente al rango de edad 31-40).","da7bcf95":"M\u00e1s adelante se ver\u00e1n otros casos donde los missing values est\u00e1n presentes por un motivo justificado. L\u00f3gicamente, en estos casos no tiene sentido la imputaci\u00f3n de missing values.","49ae81a9":"T\u00edtulo de la pr\u00e1ctica 1: An\u00e1lisis de Datos Exploratorio\n\nEn esta primera pr\u00e1ctica aplicar\u00e1s todas las t\u00e9cnicas vistas en el Bloque II (\"An\u00e1lisis de datos exploratorio\") a un conjunto de datos de tu elecci\u00f3n. Deber\u00e1s crear un notebook en Kaggle que contenga todos los datos, c\u00f3digo y documentaci\u00f3n del trabajo que realices.\n\nDetalles de la pr\u00e1ctica:\n\n* 1\\. La pr\u00e1ctica es individual\n+ 2\\. pone un 30% de la nota final de la asignatura\n+ 3\\. Para el estudio deber\u00e1s elegir uno o varios conjuntos de datos abiertos de datos.gob.es o Data.gov\n+ 4\\. Cuando hayas decidido el conjunto de datos, avisa a tu profesor para asegurarnos de que no haya duplicados\n+ 5\\. El trabajo realizado lo publicar\u00e1s como un notebook en Kaggle. Se recomienda que lo hagas de manera p\u00fablica, pero si lo quieres mantener privado invita a tu profesor para que pueda verlo (usuario: dtomas)\n+ 6\\. Tienes de fecha hasta el domingo 21 de marzo a las 23:59h. para la entrega\n+ 7\\. Deber\u00e1s enviar la URL del notebook de Kaggle en la p\u00e1gina de esta misma actividad\n+ 8\\. La puntuaci\u00f3n del ejercicio ser\u00e1 la siguiente:\n\n    + 9\\.1\\. Complejidad del dataset: n\u00famero de instancias, n\u00famero de caracter\u00edsticas, diversidad de tipos de datos (20%)\n    + 9\\.2\\. Preprocesamiento del dataset: limpieza, imputaci\u00f3n, selecci\u00f3n\/extracci\u00f3n de caracter\u00edsticas (10%)\n    + 9\\.3\\. Estad\u00edsticas descriptivas: an\u00e1lisis de tendencia central y dispersi\u00f3n (25%)\n    + 9\\.4\\. Visualizaci\u00f3n: cantidad, variedad y calidad de los diagramas (25%)\n    + 9\\.5\\. Redacci\u00f3n: texto que describa los resultados y conclusiones de las t\u00e9cnicas utilizadas (20%)","c77280f1":"## [5. 1. Repaso te\u00f3rico](#section5.1.)","da9aacd3":"N\u00f3tese tambi\u00e9n que como es de esperar la mayor parte de las llamadas son desde el interior de Catalu\u00f1a. Esto \u00faltimo es lo natural si se llama a un servicio de atenci\u00f3n de Catalu\u00f1a. Seguramente estas llamadas realizadas desde el exterior son realizadas por parte de amigos que viven fuera y denuncian una situaci\u00f3n que sucede en Catalu\u00f1a o son las propias mujeres que se han visto forzadas a desplazarse y realizan la llamada a posteriori.","8f5adf2b":"Casi no resulta necesario comentar la imagen 4.1.3.. La fuerte componente estacional en los fines de semana es clara. El lapso lunes-viernes refleja una componente estacional m\u00e1s d\u00e9bil y con m\u00e1s varianza. \n\n> **`Conclusiones`**:\n+  **Conclusi\u00f3n 1**: por alg\u00fan motivo que se desconoce, el tel\u00e9fono 900 900 120 recibi\u00f3 menos llamadas procedentes de Catalu\u00f1a durante los fines de semana en el a\u00f1o 2013. As\u00ed lo corrobora la imagen 4.1.3. Para el resto de los a\u00f1os, basta cambiar el a\u00f1o en la query y comprobamos que el comportamiento se mantiene incluso para el a\u00f1o 2020 con la pandemia presente, aunque en este \u00faltimo caso con algo m\u00e1s de varianza (se muestra un poco m\u00e1s adelante).\n+ **Conclusi\u00f3n 2**: esta informaci\u00f3n es muy importante, pues suponiendo que todas las llamadas han sido siempre debidamente registradas, manifiesta que  entre semana el n\u00famero de operadores que atienden esta l\u00ednea debe de ser reforzado para que no haya ninguna llamada desatendida y para que la calidad de la atenci\u00f3n durante la llamada sea la necesaria. Adem\u00e1s, la polic\u00eda en Catalu\u00f1a deber\u00eda conocer este comportamiento.\n\nSe comprueba esto \u00faltimo a continuaci\u00f3n:","44124eb7":"A continuaci\u00f3n se expone un gr\u00e1fico temporal seg\u00fan los rangos de edad para visualizar su evoluci\u00f3n durante el periodo 2013-2020. Este permite filtrar tambi\u00e9n grupos haciendo click sobre su nombre en la leyenda.","14bf495e":"## GRUPOS FRECUENTES VS GRUPOS DE RIESGO. \n## Relativizamos el dataset con datos del INE.","0a494445":"+ \u00bf Sobre qu\u00e9 Comarcas podemos establecer conclusiones precisas? Es decir, con la variabilidad capturada, \u00bfqu\u00e9 Comarcas superan un m\u00ednimo de calidad en su proyecci\u00f3n? (Esta es otra pregunta que en todos los sitios se obvia y que es grave no tenerlo en cuenta).\n\nPara esta medida tan solo se toma otro criterio an\u00e1logo para los individuos (tan solo dir\u00e9 que se utiliza \u00e1ngulo entre individuo y proyecci\u00f3n como herramienta). Voy a obviar la expresi\u00f3n matem\u00e1tica para no recargar demasiado el trabajo.","1061dafb":"El a\u00f1o 31 est\u00e1 solapado en dos grupos, pero se asume que el de 18-31 a\u00f1os realmente es 18-30 a\u00f1os.\n\nSe necesita crear una columna nueva y, para ello, se crea una funci\u00f3n para poder pivotar en su creaci\u00f3n con un mapeo.","736f87c5":"**Observaci\u00f3n**: n\u00f3tese que pese a que el \u00e1mbito del dataset se restringe a Catalu\u00f1a se tienen llamadas procedentes del exterior","3c629841":"El m\u00e9todo del An\u00e1lisis de Componentes Principales es el siguiente:\n\nSobre $n$ individuos se han medido $p$ variables. Sea $x_i^j$ el valor de la variable $j$-\u00e9sima, $j \\in \\left\\lbrace 1, \\dots, p \\right\\rbrace $ sobre el individuo $i$-\u00e9simo, $i \\in \\left\\lbrace 1, \\dots, n \\right\\rbrace $. Los datos estructurados forman una matriz que puede ser denotada como $X_{n\\times p} = \\left( x_i^j \\right)_{i = 1,\\dots,n}^{j = 1,\\dots,p}$. \n\nEl m\u00e9todo del An\u00e1lisis de Componentes Principales consiste en proyectar estos individuos $x_i$'s donde:\n$$\nx_i = \\left( \\begin{array}{c}\nx_i^1 \\\\\n\\vdots \\\\\nx_i^p \n\\end{array} \\right)\n\\in \\mathbb{R}^p\n$$\nen un espacio $\\mathbb{R}^p$, con $q\\leq p$ de tal manera que sus proyecciones $Y_{n\\times q} = \\left( y_i^j \\right)_{i = 1,\\dots,n}^{j = 1,\\dots,q} \\in~\\mathbb{R}^q$ retengan el m\u00e1ximo de informaci\u00f3n (la mayor variabilidad posible de las variables originales) contenida en $X_{n\\times p}$.\n\nM\u00e1s formalmente, dadas {$x^1, \\dots, x^p$} cualesquiera, PCA se basa en la resoluci\u00f3n del siguiente problema de optimizaci\u00f3n: \n\n\\begin{equation*}\n\\begin{aligned}\n& \\underset{W}{\\text{Min}}\n& & I_W \\\\\n& \\text{s.a}\n& & W \\in \\; \\Omega\n\\end{aligned}\n\\end{equation*}\n\nDonde $I_W$ es la inercia explicada y su expresi\u00f3n es:\n\n$I_W = \\sum_{i=1}^n p_i d^2(x_i, \\hat{x}_i)$, $x_i = proy_W (x_i)$, $ \\; d^2(x_i, \\hat{x}_i) = ||x_i - \\hat{x}_i||^2 = (x_i - \\hat{x}_i)^tM(x_i - \\hat{x}_i) \\;$ y \n$\\; p_i$ el peso del individuo $i$. \n\n$M$ es la matriz diagonal de estandarizaci\u00f3n de c\u00e1lculos (varianzas inversas):\n\n$$\n\\begin{pmatrix}\n\\dfrac{1}{\\sigma^2_{1}} & \\cdots & 0 \\\\\n\\vdots & \\vdots & \\vdots \\\\\n0 & \\cdots & \\dfrac{1}{\\sigma^2_{p}}\n\\end{pmatrix}\n$$\n\n**OBJETIVO**: **tomar** $q<p$ **para obtener la mejor representaci\u00f3n en un espacio de dimensi\u00f3n inferior**: \n\n$$\nX_c = \n\\begin{pmatrix}\nx_{1}^1 & \\cdots & x_{1}^p \\\\\n\\vdots & \\vdots & \\vdots \\\\\nx_{n}^1 & \\cdots & x_{n}^p\n\\end{pmatrix}\n\\longrightarrow\nY = \n\\begin{pmatrix}\ny_{1}^1 & \\cdots & y_{1}^q \\\\\n\\vdots & \\vdots & \\vdots \\\\\ny_{n}^1 & \\cdots & y_{n}^q\n\\end{pmatrix}\n$$\n\n![PCAcubo.png](attachment:PCAcubo.png)\n\nEl objetivo anal\u00edtico fundamental de este m\u00e9todo, una vez empleado, es obtener de la matriz de proyecciones relaciones ocultas en las variables que a partir de la matriz original pueden pasar inadvertidas. Estas no son las \u00fanicas aplicaciones de PCA, tambi\u00e9n se emplean para reducir dimensiones matriciales en algoritmos y, con ello, simplificar c\u00e1lculos computacionales o, tambi\u00e9n, por ejemplo, para poder representar en $2$ \u00f3 $3$ dimensiones, agrupaciones creadas a partir de K-means donde la naturaleza de los individuos es de una dimensionalidad superior.\n \n![IMG1.jpg](attachment:IMG1.jpg)","bae91312":"En nuestro caso, claramente ese decrecimiento no lo tenemos. As\u00ed lo muestro a continuaci\u00f3n.","02309c13":"Ahora en porcentajes","681d3fc0":"# [3. Carga, complejidad del DataSet y cuestiones de preprocesado](#section3.)","295c36fa":" ## PREDICCIONES","e6f6c446":"Aqu\u00ed se palpa mejor que en dimensiones mayores se tiende a formar grupos m\u00e1s esf\u00e9ricos por la libertad que ofrece un espacio de dimensi\u00f3n superior.","475d04dd":"### [4. 1. 2. Definici\u00f3n de modelo SARIMA](#subsection4.1.2.)\n\nSup\u00f3ngase que dada una serie temporal $\\{X_t: t \\in T\\}$  donde $t$ son los tiempos (normalmente en meses) se ha observado una realizaci\u00f3n de longitud $T$ de la serie. En muchas ocasiones, como ya se ha analizado aqu\u00ed, dichas series temporales vienen afectadas por 3 componentes:\n + 1\\. Varianza (que comprende, en particular, la amplitud de las oscilaciones de la gr\u00e1fica)\n + 2\\. Tendencia (la media general de la serie)\n + 3\\. Estacionalidad (en caso de ser una estacionalidad anual, la relaci\u00f3n existente entre los mismos meses de distintos a\u00f1os)\n \nEstas 3 componentes las recoge el modelo SARIMA cuyas siglas significan \u201cSeasonal Autorregresive Integrated Moving Average\u201d y cuya expresi\u00f3n matem\u00e1tica siguiendo la notaci\u00f3n de Daniel Pe\u00f1a es:\n$$\\Phi_P(B^s)\\phi_p(B)\\nabla_s^D\\nabla^d X_t = c + \\theta_q(B)\\Theta_Q(B^s)Y_t$$\ndonde, \n + 1\\. $X_t$ es la serie temporal sometida a estudio\n + 2\\. $\\Phi_P(B^s)$ y $\\Theta_Q(B^s)$ son los operadores **polinomiales de retardo de la parte estacional**\n + 3\\. $\\phi_p(B)$ son los operadores **polinomiales de retardo de la parte regular**\n + 4\\. $\\nabla_s^D\\nabla^d$ son los operadores diferencia estacional y regular, respectivamente.\n + 5\\. $Y_t$ es un ruido aleatorio con distribuci\u00f3n normal de media $0$ y de varianza $\\sigma^2$\n + 6\\. $c$ es una constante\/intercepto m\u00e1s por estimar.\n \n### [4. 1. 3. Identificaci\u00f3n del modelo SARIMA v\u00eda an\u00e1lisis de Box-Jenkins:](#subsection4.1.3.)\n \n**Para los no tan versados en las matem\u00e1ticas que hay detr\u00e1s de estos modelos estad\u00edsticos de series temporales**, se comunica que el proceso no es otro que el de transformar la serie sometida a estudio a una serie temporal can\u00f3nica (i.e., hacerla m\u00e1s sencilla) y aplicar las t\u00e9cnicas sobre esta. Posteriormente para las predicciones se deshacen las transformaciones realizadas para hallar $X_{t_0+k}$, con $k \\geq 1$ con $t_0$ el tiempo presente en el que se est\u00e1 observando la serie (el presente). \n \n+ 1. Objetivo: identificar un conjunto de modelos compatibles con el gr\u00e1fico de la serie $\\{X_t\\}$ y sus funciones de autocorrelaci\u00f3n simple ACF y parcial PACF. \n+ 2\\. Este objetivo requiere:\n  + 2\\.1\\. Identificar la estructura NO ESTACIONARIA y decidir qu\u00e9 transformaciones aplicar para convertir la serie original en una serie estacionaria:\n    + 2\\.1\\.1\\. Transformaciones para estabilizar la varianza: $\\hat{X}_t = g(X_t)$\n    + 2\\.1\\.2\\. Transformaciones para estabilizar la media: $\\Longrightarrow D, s, d \\Longrightarrow W_t = \\nabla_s^D \\nabla^d \\hat{X}_t$\n  + 2\\.2\\. Determinar un modelo ARMA para la serie estacionaria $\\nabla_s^D \\nabla^d \\hat{X}_t \\Longrightarrow p, q, P, Q$. Aqu\u00ed pueden encajar m\u00e1s de uno seg\u00fan la incertidumbre de las ACF y la PACF. Se estiman los coeficientes polinomiales del modelo y se les somete a competici\u00f3n.\n  \nEn resumen, el m\u00e9todo Box-Jenkins consiste en obtener una serie transformaci\u00f3n estacionaria.\nLa serie $\\left(\\nabla_s^D \\nabla^d \\hat{X}_t\\right)$ es estacionaria. La estacionariedad es la cualidad deseada en una serie temporal,\npues se puede reconocer dentro de un grupo de series conocido como series ARMA (estacional\nmultiplicativo) (estacionales o no). De este grupo de series se tiene un conocimiento extenso de sus\ngr\u00e1ficas ACF y PACF (funci\u00f3n de autocorrelaci\u00f3n parcial) con el que se pueden identificar los par\u00e1metros\n$(p, q) \\times (P, Q)_s$ (identificaci\u00f3n).\n\nEl n\u00famero de par\u00e1metros a determinar son en total $7$, $(p, d, q) \\times (P, D, Q)_s$. Los par\u00e1metros $(P, D, Q)$ son totalmente an\u00e1logos a los $(p, d, q)$ pero ocup\u00e1ndose de la subserie estacional. En cuanto a $s$, es la estacionalidad, y seg\u00fan los an\u00e1lisis previos deber\u00eda resultar $s = 7$ cuando la serie considerada es de granularidad diaria.\n\n### [4. 1. 4. Identificaci\u00f3n del modelo ARIMA v\u00eda optimizaci\u00f3n AIC, BIC, CV, etc.:](#subsection4.1.4.)\n\nEn Python o en cualquier software, cuando la serie temporal no se ve afectada por la estacionalidad, i.e., cuando se asume que el modelo se enmarca en el caso particular (previo an\u00e1lisis como se ha hecho aqu\u00ed con las llamadas al 900 900 120):\n$$\\phi_p(B)\\nabla^d X_t = c + \\theta_q(B)Y_t$$\nse suelen utilizan los famosos m\u00e9todos **\"autoarima\"**, que no son otra cosa que para una regi\u00f3n acotada y razonable del espacio de los par\u00e1metros (p, d, q), se someten a competici\u00f3n todos y cada de los modelos resultantes mediante los m\u00e9todos AIC, BIC, CV, data splitting, etc. Esta \u00faltima v\u00eda act\u00faa un poco a modo de caja negra y pueden proporcionar, en ocasiones, modelos m\u00e1s imprecisos, pues esta v\u00eda est\u00e1 sometidas al control de un analista.\n\nPros y contras Box-Jenkins y Autoarima:\n+ 1\\. Box-Jenkins: tiene la desventaja de ser poco susceptible de automatizaci\u00f3n, i.e., no es viable aplicar esto para muchas series al mismo tiempo. Por ejemplo, en la empresa en la que trabaj\u00e9, contaba con predecir m\u00e1s de 300 series temporales para una importante empresa. Era inviable. Sin embargo, cuando s\u00ed es posible, conviene realizarla para conseguir resultados m\u00e1s precisos.\n+ 2\\. Autoarima: modelos m\u00e1s r\u00edgidos por no explorar el espacio de par\u00e1metros estacionales. Esto se debe a que es muy costoso computacionalmente explorar dicho espacio (se ven involucradas muchas ecuaciones en diferencias de alto orden si el grado estacional $s$ es muy alto). No obstante, son susceptibles de automatizaci\u00f3n, algo que es una gran ventaja. **E.g., el problema de la automatizaci\u00f3n se convierte en una necesidad si se toma todas las series temporales de llamadas al 900 900 120 resultantes de agrupar por comarcas adem\u00e1s de por fecha**.","9f1eb518":"He aqu\u00ed la importancia del an\u00e1lisis de componentes principales, pues nos va a permetir establecer un orden en funci\u00f3n de nuestros intereses (la violencia machista). La clasificaci\u00f3n est\u00e1 clara. \n\nEn la imagen 5. 2. 1. y fij\u00e1ndose en las variables proyectadas en PCA se puede establecer los \u00f3rdenes de gravedad como:\n\n   + 1. El grupo rojo (grupo grave) sufre m\u00e1s violencia machista que otras comarcas y necesita ayudas econ\u00f3micas (m\u00e1s % de ayudas para el alquiler, menos PIB) y con m\u00e1s paro que el grupo verde.\n   + 2. El grupo verde (grupo leve) es el que menos \"% de afectadas\" tiene, el que menos paro de hombres y mujeres tiene y \u00e9l que menos prestaciones por desempleo necesita.\n   + 3. El grupo azul (grupo intermedio) es cierto que sufre m\u00e1s violencia machista que el grupo rojo, pero nuestra ayuda es econ\u00f3mica y consiste en la asignaci\u00f3n de presupuestos a cada comarca. T\u00e9ngase en cuenta que aunque el grupo azul sufra m\u00e1s violencia machista tiene m\u00e1s PIB y necesita menos ayudas seg\u00fan la representaci\u00f3n, por lo que el problema del grupo azul no parece econ\u00f3mico, quiz\u00e1s sea educativo.\n\n### **Importante**: \n\nDependiendo de la semilla (o de si no estandarizamos) podemos ver un poco de superposici\u00f3n entre grupos distintos (alguna vez me ha ocurrido). Pero recordemos que kmeans se ha realizado en el espacio total y que no est\u00e1 toda la informaci\u00f3n recogida en la proyecci\u00f3n sobre el plano. Es decir, esto es normal. Recoremos que la representaci\u00f3n en dos dimensiones no recog\u00eda toda la variabilidad deseable, pero en el espacio de 3 dimensiones si est\u00e1n separados as\u00ed, razones habr\u00e1 para ello. Sin embargo, vemos dentro de lo razonable coherencia en los cl\u00fasters.\n\n**As\u00ed pues, ya disponemos de algo m\u00e1s de criterio para asignar los presupuestos seg\u00fan comarcas de cara a la lucha contra la violencia machista**.\n\nA continuaci\u00f3n muestro los cl\u00fasters tambi\u00e9n en 3D (Aqu\u00ed la superposici\u00f3n ya no es un problema y si pudi\u00e9ramos representar en dimensiones superiores la representaci\u00f3n ser\u00eda m\u00e1s fiel a lo real).","133c749f":"Vamos a cortar en el 1 Diciembre del 2019 (no inclusive) (construcci\u00f3n del modelo hasta con toda la serie hasta el '2019-11-30')  y a hacer una predicci\u00f3n para ver qu\u00e9 tal se comporta en Diciembre del mismo a\u00f1o la predicci\u00f3n.\n\nTenemos dos tipos de predicci\u00f3n:\n\n+ 1\\. **Dynamic forecast** (predicci\u00f3n din\u00e1mica): esto es a largo plazo (utilizando solo la informaci\u00f3n hasta la fecha '2019-11-30'). Ahora comparar\u00e9 estas predicciones con los valores reales (estos no intervienen en la construcci\u00f3n del modelo, es como el train y el test habitual)\n\n+ 2\\. **One-step-ahead forecast** (a un d\u00eda): predicciones al d\u00eda. Es lo natural, si predecimos a futuro vamos incorporando las nuevas observaciones y reconstruyendo\/recalculando el modelo que tenemos con ellas. ","4fe6fd12":"En efecto, vemos que la mujer que m\u00e1s llama al 900 900 120 es una mujer casadas de unos 31-40 a\u00f1os con solo la educaci\u00f3n primaria y con hijos conviniendo en el n\u00facleo familiar denunciando una situaci\u00f3n en el \u00e1mbito de la pareja.","6a58c777":"---","373b39cc":"---","8b25e0ba":"Por alguna raz\u00f3n, kaggle presenta alg\u00fan bug y en la vista compartida del notebook no funcionan los widgets :(. Pero en la propia edici\u00f3n de kaggle o fuera de kaggle funciona el zoom. \n\nEn la vista previa de kaggle, al menos a m\u00ed, ya si quiere aumentar o disminuir el zoom tengo que pulsar la ruleta y arrastrar hacia abajo o hacia arriba haci\u00e9ndolo muy lentamente (es un bug clar\u00edsimamente). Para rotar mantener pulsado shift.\n\nEn cualquier caso, he modificado con la opci\u00f3n \"scene_camera\" para indicarle que el zoom por defecto resulte en una vista agradable con el objetivo de poder distinguir los puntos en el espacio proyectado. Sin embargo, ahora cuesta visualizar las componentes. En cualquier caso, insisto, fuera de la vista compartida la representaci\u00f3n 3D es muy chula. ","5797eb50":"En la Imagen 4. 1. 1. se puede visualizar la evoluci\u00f3n diaria de llamadas al 900 900 120 a nivel Auton\u00f3mico.\n\nLas conclusiones son claras y son las siguientes:\n\n+ **1. No se observan outliers** (Ning\u00fan valor es claramente un outlier). En 2020 se presenta un cambio de comportamiento pero esto no se corresponden con outliers. En series temporales existen m\u00e9todos en el libro de Daniel Pe\u00f1a: \"An\u00e1lisis de Series Tempotales\" para identificar outliers en series temporales (todo es m\u00e1s complicado en series temporales al a\u00f1adir la dimensi\u00f3n tiempo), sin embargo, puesto que aparentemente no se observa ninguno, asumiremos que no los hay. Las t\u00e9cnicas para identificar outliers descritas en el libro de Daniel Pe\u00f1a exceden los objetivos de la asignatura.\n\n+ **2.** La serie temporal es bastante estable, pero tienes unos peque\u00f1os rasgos **no estacionarios** provocados seguramente por la estacionalidad. No obstante seguramente se pueda suponer serie estacionaria. Traduciendo lo \u00faltimo a t\u00e9rminos m\u00e1s formales, si $\\{X_t, t \\in T\\}$ denota la serie temporal y $t$ el d\u00eda, la serie es estacionaria pues ocurre que $E[X_t] = m \\; \\forall \\, t \\in T$. Si no lo fuese, debido a la estabilidad de la serie, con alguna diferenciaci\u00f3n de orden peque\u00f1o quiz\u00e1s se consiga la estacionariedad (esto es muy importante para las predicciones de un modelo SARIMA aplicado, si es que es aplicable, i.e., previa Diagnosis realizada).\n\n+ **3.** La serie temporal es aproximadamente **homoced\u00e1stica**, i.e., no hay cambios de amplitud. Esto es muy importante, pues no son necesarias t\u00e9cnicas de transformaci\u00f3n como la t\u00e9cnica de Box-Cox\n\n+ **4.** Las **conclusiones** son claras: hay una fuerte estabilidad en cuanto al n\u00famero de llamadas que recibe le 900 900 120 (recibe de media 32.34 con desviaci\u00f3n t\u00edpica de 10.7 llamadas). Adem\u00e1s, es perfectamente visible que durante el famoso confinamiento relativo al periodo 15 mar 2020 \u2013 21 jun 2020 se incrementaron el n\u00famero de llamadas al 900 900 120. De hecho, tras el confinamiento, permanece un peque\u00f1o escal\u00f3n de subida provocado seguramente por las medidas de confinamiento territoriales y la consecuente crisis econ\u00f3mica sucedida.\n+ **5.** Para comprobar si hay estacionalidad es mejor realizar un seasonplot, porque aunque se visualicen picos no es posible saber a partir de la imagen 4.1.1. si esos picos se repiten siguiendo un patr\u00f3n o est\u00e1n descentralizados, i.e., no se sabe si se encajan aproximadamente dentro de una subserie $\\{X_{kt}: t \\in T\\} \\subseteq \\{X_{t}: t \\in T\\}$, con $k \\in \\mathbb{N}\\setminus\\{1\\}$\n\n**Observaci\u00f3n**: **no es lo mismo una serie estacionaria que una serie estacional**. Son dos conceptos distintos. Lo primero se refiere al nivel\/tendencia de la serie mientras que lo segundo se refiere a la propiedad de que cualquier observaci\u00f3n presente en el tiempo $t$ tiene un efecto en la observaci\u00f3n $t+s$ (para todo tiempo $t$).  ","0b25762e":"## [1. 1. Proveedor](#subsection1.1.)","1a001f5d":"Obtenemos la serie temporal de llamadas totales al 900 900 120 en Catalu\u00f1a con la finalidad de analizar su evoluci\u00f3n ","3db2387d":"Una gran ventaja de este an\u00e1lisis es que no se ve afectado por los missing-values presentes en el dataset, ya que solo se necesita el n\u00famero de registros por cada d\u00eda y no tiene en cuenta valores faltantes. Se construye la serie agrupando por las fechas en las que se est\u00e9 interesado y se realiza un conteo de los registros.\n\nAlgunos de los conceptos tratados en esta secci\u00f3n han sido adquiridos en la asignatura: \"An\u00e1lisis de Series Temporales\", impartida por el magn\u00edfico profesor Mario Trottini en el cuarto curso del genial Grado en Matem\u00e1ticas, ofrecido en la Universidad de Alicante. Los conceptos te\u00f3ricos est\u00e1n disponibles en el libro de Daniel Pe\u00f1a: \"An\u00e1lisis de Series temporales\".\n\nPor otra parte, dichos conceptos se encuentran aplicados mediante el an\u00e1lisis de Box-Jenkins  en mi trabajo registrado:\n\nhttps:\/\/www.safecreative.org\/work\/2004293817985-forecasting-ajuste-de-un-modelo-sarima-a-una-serie-real\n\nDicha aplicaci\u00f3n se llev\u00f3 a cabo v\u00eda software R por el presente autor de este peque\u00f1o an\u00e1lisis: Jos\u00e9 Antonio Esteban Rodr\u00edguez.\n\nPuesto que los objetivos, en cuanto a forecasting, exceden los objetivos de la presente asignatura, tan solo se har\u00e1 un ligero an\u00e1lisis superficial de la serie temporal a nivel de Catalu\u00f1a de llamadas al 900 900 120.","ec25144d":"Asumo los par\u00e1metros restantes. Usaremos el subm\u00f3dulo SARIMAX. Este es una generalizaci\u00f3n del modelo SARIMA que permite incluir regresores incorporando series de Fourier, aunque nosotros esta extensi\u00f3n la dejamos aparte. Un modelo SARIMAX sin regresores es un SARIMA.","f33b09e1":"## [1. 3. Descripci\u00f3n de los campos](#subsection1.2.)\n\nEs vital que antes de proceder con el conjunto de datos se tengan claro los campos y qu\u00e9 significan cada uno de ellos con exactitud.\n\nTras investigar un poco, se han encontrado la descripci\u00f3n de los datos en el siguiente v\u00ednculo: \n\nhttps:\/\/analisi.transparenciacatalunya.cat\/Societat-benestar\/L-nia-d-atenci-contra-la-viol-ncia-masclista-900-9\/q2sg-894k\n\nDe hecho, en dicho enlace nos informan de que se pueden obtener estos datos v\u00eda API.\n\nA continuaci\u00f3n, describo la descripci\u00f3n de los campos:","f1d4d0ec":"## PCA","d2a48321":"# Paquetes requeridos: ","08e174ca":"**OBSERVACI\u00d3N**: a continuaci\u00f3n muestro una incoherencia reflejada por el conjunto de datos:","48c113c2":"Ahora, notemos que, ya disponemos de un criterio para clusterizar Comarcas gracias a la informaci\u00f3n que nos ha dado PCA. \n\n\u00a1Precauci\u00f3n!, es cierto que el 22.5 % de Comarcas no est\u00e1n bien representadas pero no es un problema esto pues K-means lo vamos a implementar sobre el espacio total, la proyecci\u00f3n tan solo sirve para representar luego los clusters y saber c\u00f3mo ordenar la gravedad de su situaci\u00f3n en relaci\u00f3n a la violencia machista. La calidad de representaci\u00f3n de individuos y variables solo es importante para establecer conclusiones sobre la imagen proyectada o, muy importante, si se va a utilizar la predicci\u00f3n PCR (el regresor PCA) donde se usan las componentes principales directamente.\n\nPor otra parte, aunque en el espacio proyectado no veamos nubes de puntos con forma circular que se amolden bien a la distancia eucl\u00eddea en K-means, pensemos de nuevo que este es el espacio proyectado y K-means se va a realizar en el espacio total. Aqu\u00ed, en el espacio total, las dimensiones ayudan a que tengan un formato \"m\u00e1s esf\u00e9rico\" m\u00e1s cercano a usar la distancia eucl\u00eddea para segregar. De hecho, K-means tiene sentido aplicarlo con el total de la varianza para las pocas dimensiones que tenemos entre manos. ","6b91b6d3":"Obs\u00e9rvese que la imagen 4. 2. 6. 1. es interactiva y se pueden filtrar categor\u00edas.","9e0e29c4":"## [4. 1. 6. Construcci\u00f3n de un modelo SARIMA](#subsection4.1.6.)","a5de3479":"## Ajuste del modelo","a6005d58":"Ahora contrastamos los perfiles de frecuencia con los perfiles de riesgo.","58f9a8a9":"### [4. 2. 1. Edad m\u00e1s frecuente de la v\u00edctima y grupos de riesgo seg\u00fan edad:](#subsection4.2.1.) <a><\/a>","06bf4cab":"La columna suma construida tiene como finalidad ordenar la imagen de embudo imagen 4. 2. 2. 3.:","9349951b":" As\u00ed que con estas cosas hay que tener cuidado. Los missing values a veces est\u00e1n presentes por alg\u00fan motivo y expresan algo.","49584e8f":"---","e338fa85":"# [4. An\u00e1lisis exploratorio en Catalu\u00f1a](#section4.) ","966946a9":"Aqu\u00ed ocurre lo de siempre, no podemos concluir nada m\u00e1s que el tel\u00e9fono 900 900 120 durante estos a\u00f1os ha recibido m\u00e1s llamadas de v\u00edctimas americanas si nos retringimos a la subpoblaci\u00f3n de extranjeras en Catalu\u00f1a.\n\nNo obstante, de los datos del Ine si tenemos la especificaci\u00f3n de extranjeras y aqu\u00ed si podemos relativizar los datos para contrastar:\n\nEspa\u00f1olas Vs Extranjeras","1d66faed":"## Datos del paro por hombres y mujeres\n\nhttps:\/\/www.idescat.cat\/pub\/?id=aec&n=325&lang=es&t=2018\n\nhttps:\/\/www.idescat.cat\/pub\/?id=intpobr&n=8230&by=com&lang=es&t=201800","c3ab3264":"Las conclusiones sobre la imagen 4. 2. 1. 2. son claras y eran algo esperables, pues los $3$ rangos de edad m\u00e1s frecuentes por orden decreciente son:\n   + Entre 31 y 40 a\u00f1os: 35756 llamadas\n   + Entre 41 y 50 a\u00f1os: 26514 llamadas\n   + Entre 18 y 31 a\u00f1os: 14512 llamadas\n\nEsto \u00faltimo tiene sentido, pues los matrimonios\/parejas cuyos rangos de edad se sit\u00faan en 25-40 a\u00f1os ya son relaciones con hijos de duraci\u00f3n m\u00e1s larga y que pueden estar mucho m\u00e1s desgastadas. Adem\u00e1s, probablemente sean matrimonios donde la separaci\u00f3n se vuelve m\u00e1s complicada que para una pareja en la etapa primeriza de noviazgo. \n\nPara los casos con rangos de edad superiores, la l\u00f3gica nos dicta que si no se ha hecho un problema manifiesto antes es porque la relaci\u00f3n es al menos medianamente estable.\n\nObservaci\u00f3n: hay que tener en cuenta que los casos reincidentes pueden inflar las cifras. Esto se puede corregir omitiendo los registros con uso previo del servicio, como se muestra a continuaci\u00f3n:","e7596a67":"Este es un modelo que no decepciona. No obstante, esto no puede quedarse as\u00ed y existen muchos m\u00e9todos al respecto para medir la bondad de ajuste y estimar el error de generalizaci\u00f3n (Validaci\u00f3n cruzada, data-splitting, ...). Adem\u00e1s, un buen analista deber\u00eda realizar una verificaci\u00f3n de diagnosis.\n\nInsisto todo el proceso al detalle se puede visualizar aqu\u00ed.\n\nhttps:\/\/www.safecreative.org\/work\/2004293817985-forecasting-ajuste-de-un-modelo-sarima-a-una-serie-real","9503b0b7":"Se tiene un conjunto de datos de 94490 registros con 56 columnas donde cada fila registra una llamada al 900 900 120 durante el intervalo de tiempo 2013-2020. Adem\u00e1s, el conjunto de datos no es est\u00e1tico, sino temporal. Existen muchos datasets que se puedan derivar de este inicial seg\u00fan los an\u00e1lisis en los que uno est\u00e9 interesado.","942c36c9":"## \u00a1Sorpresa!:\nEl perfil recurrente es el de una mujer espa\u00f1ola. Sin embargo, se puede concluir que **las mujeres extranjeras son un grupo un poco m\u00e1s vulnerable**, ya que\n\n   + 1\\. La probabilidad estimada de utilizar el 900 900 120 por una mujer residente en Catalu\u00f1a condicionada a ser una mujer extranjera (restringi\u00e9ndonos a dicha subpoblaci\u00f3n) es ligeramente superior a la probabilidad estimada de utilizar el 900 900 120 por una mujer residente en catalu\u00f1a condicionada a ser una mujer de nacionalidad espa\u00f1ola. O, dicho de otra manera,\n   + 2\\. Aproximadamente el 2.38 % de las mujeres extranjeras residentes en Catalu\u00f1a han sufrido violencia machista alguna vez. Por el contrario, el 2.38 % de las mujeres extranjeras en Catalu\u00f1a han sufrido violencia machista alguna vez.\n   \nPor tanto, ser extranjera es un factor de riesgo en t\u00e9rminos estrictamente cuantitativos para sufrir alguna experiencia relacionada con el maltrato. No obstante, siendo pragm\u00e1ticos, la diferencia es m\u00ednima. Por consiguiente, podemos concluir que en Catalu\u00f1a la nacionalidad no es un factor del todo determinante a la hora de sufrir alg\u00fan tipo de violencia machista.\n\n\nObservaciones: el censo del Ine sobre mujeres extranjeras no s\u00e9 si computa las mujeres cuya situaci\u00f3n es irregular. En cualquier caso, pudiera ser que dicho porcentaje 2.38 est\u00e9 sobreestimado en relaci\u00f3n a que el denominador puede ser mayor (falten mujeres extranjeras por computar).","443e97f2":"De hecho el ambas columnas presentan el mismo n\u00famero de missing values justificados. Por consiguiente, el conjunto de datos no est\u00e1 mal cuidado. Estos son sin\u00f3nimos de \"No aplica\".","d83c1345":"Utilizamos los cardinales poblacionales para relativizar el n\u00famero de afectadas\n\nhttps:\/\/www.idescat.cat\/pub\/?id=aec&n=249&lang=es&t=2018","b104974e":"\n## Prestaciones econ\u00f3micas\n\nhttps:\/\/www.idescat.cat\/pub\/?id=intpobr&n=8235&lang=es&by=com\n","ee9cb0ad":"Calculamos el porcentaje de missing values de cada columna que presenta el dataset sometido a estudio","7a6e697a":"## \u00bfQu\u00e9 nacionalidad extranjera es la m\u00e1s recurrente?","fe0f97ba":"## \u00bfQu\u00e9 grupo es m\u00e1s vulnerable: Espa\u00f1olas o extranjeras?","8ba923c7":"No todos los dtypes tienen por qu\u00e9 corresponderse (python infiere el dtype object muchas veces), pero teniendo en cuenta las dimensiones del dataset y la cantidad de posibles an\u00e1lisis que se pueden llevar a cabo no tendr\u00eda mucho sentido realizar un preprocesado inicial. Por tanto, se va a optar por reestructurar los datos y sus dtypes conforme los an\u00e1lisis de cada momento generen dicha necesidad.","d2caa694":"Adem\u00e1s, aprovecho para insistir en que $s=7$ seg\u00fan se observa por los retardos cada $7$ tiempos. Puesto que s\u00e9 que la serie es estacional, las gr\u00e1ficas ACF y PACF s\u00e9 que no reflejan bien la informaci\u00f3n y se necesitan calcular seg\u00fan un modelo SARIMA y no ARIMA. El sombreado azul nos informa de que los valores que descansen dentro deben considerarse 0.\n\n   + **3.** Test formal Dickey-Fuller explicado en An\u00e1lisis de Series Temporales (por Daniel Pe\u00f1a p\u00e1ginas 264-271). Este es el m\u00e9todo que voy a emplear aqu\u00ed. Dicho contraste eval\u00faa las hip\u00f3tesis siguientes:\n   \n   $$\n   \\begin{array}{rl}\n   H_0: & X_t \\text{ no es estacionaria } (d = 0) \\\\\n   H_1: & X_t \\text{ es estacionaria } (d \\geq 1)\n   \\end{array}\n   $$\n   \nAplico Dickey-Fuller a mi serie:","699741cb":"## FUNCI\u00d3N ACP","8f95ea20":"## [3. 2. Complejidad del dataset](#section3.2.)","ee7462ea":"Ahora, veamos que ocurre para el perfil de mujer casada de 31-40 a\u00f1os ","0670f5a4":"\u00bfInfluye que haya hijos por medio? Ve\u00e1moslo","89fedb71":"El tipo de violencia que es m\u00e1s denunciada en Catalu\u00f1a por las mujeres suele ser la violencia psicol\u00f3gica, sigui\u00e9ndole la violencia f\u00edsica.","b255a663":"En la imagen 4.1.6. se observa claramente que **no existe una fuerte estacionalidad anual**.","c9397447":"### **CONCLUSIONES** Frecuencias absolutas Vs frecuencias relativas (Imagen 4. 2. 1. 6.):\n   + No se han producido cambios en esta ocasi\u00f3n. Sin embargo, en muchas ocasiones se producen sorpresas. Por ejemplo, en el famoso CSV de Fatal Shootings de abatidos por la polic\u00eda de Estados Unidos ocurre lo siguiente: son abatidos m\u00e1s personas de raza blanca que de raza de negra, sin embargo, en t\u00e9rminos relativos, el porcentaje de abatidos de raza negra (donde el total es el cardinal de la poblaci\u00f3n negra) es mucho mayor que su porcentaje an\u00e1logo para las personas de raza blanca. Esto \u00faltimo concluye que las personas de raza negra, por los motivos que sean, presentan un mayor riesgo de ser abatidas que las personas de raza blanca.\n   \n   + La Imagen 4. 2. 1. 6. nos proporciona las tres siguientes interpretaciones equivalentes. E.g., utilizando el rango 31-40 a\u00f1os:\n        + Una mujer de edad comprendida entre los 31-40 a\u00f1os tiene una probabilidad (estimada) de 0.0626 de sufrir alg\u00fan tipo de violencia machista. La probabilidad es aproximada pues toda mujer que es maltratada no necesariamente usa el tel\u00e9fono. Si en lugar de afirmar \"sufren alg\u00fan tipo de violencia machista\" se usa la afirmaci\u00f3n \"utilizan el tel\u00e9fono contra el maltrato 900 900 120\" entonces la probabilidad es \u1e3fas exacta. Pero he utilizado la segunda probabilidad como sustitua de la primera. \n        + Aproximadamente 6 mujeres de cada 100 mujeres de edad comprendida entre 31 a\u00f1os y 40 a\u00f1os sufen alg\u00fan tipo de violencia machista.\n        + Aproximadamente el 6.26% de la poblaci\u00f3n relativa a las mujeres de edad comprendida entre 31 y 40 a\u00f1os sufren alg\u00fan tipo de violencia machista.\n        \n   + Ahora s\u00ed, se puede concluir que el perfil m\u00e1s afectado o el grupo que se encuentra con mayor riesgo de maltrato son las mujeres cuya edad oscilan entre los 31 y 40 a\u00f1os.\n   \nEn este \u00faltimo caso podemos concluir que los perfiles recurrentes coinciden con los grupos de riesgo. Se debe prestar m\u00e1xima atenci\u00f3n a este \u00faltimo grupo.","cb2839f4":"Aunque no contamos con datos relativizados, s\u00ed que es cierto que se puede afirmar que la mujer que m\u00e1s llama al 900 900 120 restringi\u00e9ndonos a las mujeres cuya relaci\u00f3n ha terminado pareja y que **no** conviven con el presunto agresor es la mujer que tiene hijos en el n\u00facleo familiar.","65d7101f":"El compartamiento del v\u00eddeo 4.2.2.1. se preserva en el v\u00eddeo 4.2.2.2. y consideramos que por ahora el **perfil m\u00e1s recurrente es de una mujer casada cuya edad est\u00e1 comprendida entre los 31 y los 40 a\u00f1os**. \n\nObservaci\u00f3n: aqu\u00ed se est\u00e1 filtrando en un determinado orden. En cualquier caso hay que tener esto en cuenta. Por ejemplo, sup\u00f3ngase que se tienen el siguiente dataframe \"simpl\u00f3n\" donde cada registro denota dos variables relativas a una persona que ha sufrido un infarto y se pretende saber qu\u00e9 perfil es el m\u00e1s frecuente:\n\n$$\n\\begin{array}{|c|c|}\n\\hline\n \\text{Peso} & \\text{Edad} \\\\\n \\hline\n\\text{obesa} & \\text{joven}\\\\\n\\text{obesa}  & \\text{joven}\\\\\n\\text{obesa}  & \\text{anciana}\\\\\n\\text{delgada} & \\text{anciana}\\\\\n\\text{delgada} & \\text{anciana} \\\\\n\\hline\n\\end{array}\n$$\n\nSi se empieza a filtrar por peso se llega a que el perfil m\u00e1s frecuente a la hora de sufrir un infarto es el de una persona obesa joven, sin embargo, si se empieza filtrando por edad se llega a la conclusi\u00f3n de que el perfil m\u00e1s frecuente a la hora de sufrir un infarto es el de una persona anciana delgada.\n\n**Moraleja**: \u00a1hay que contrastar todas las posibilidades! (lo hago despu\u00e9s con un simple group by agrupando por todas las variables y haciendo un simple sort, pero le quita la magia a las visualizaciones si lo hago al principio). De hecho si se pretende ser riguroso y formal, en los casos en los que haya dudas entre grupos similares se podr\u00eda utilizar un an\u00e1lisis (M)ANOVA. No obstante, esto \u00faltimo excede los objetivos de esta asignatura.","3904b054":"Como se puede verificar en el chunk de arriba, existe una clara diferencia entre la media de llamadas diarias de media en fin de semana frente a las llamadas diarias de media entre semana.","288a1369":"---","2d1060ee":"Por desgracia, y como ocurre en la mayor\u00eda de los problemas reales, las cosas no suelen ser ilustrativas y aqu\u00ed no tenemos un codo claro. S\u00ed es cierto que tomando un $K$ suficientemente grande como $K \\geq 7$ minoras bastante la inercia de grupos.\n\nNo obstante, para ser ilustrativos aqu\u00ed tomaremos $K = 3$ desobedeciendo el criterio elbow y atendiendo m\u00e1s a PCA. Mi intenci\u00f3n es clasificar las comarcas con grado de gravedad: grave, medio y leve en relaci\u00f3n a la situaci\u00f3n de violencia machista.\n\nEn la pr\u00e1ctica 2 de la asignatura compruebo con el m\u00e9todo de la silueta que una elecci\u00f3n de $K=3$ es aceptable.","5d3cc7f8":"![logotipo_master.png](attachment:logotipo_master.png)","7993837e":"Ahora ya se han estimado los coeficientes polinomiales de todos los polinomios de retardo y se nos proporcionan las medidas indirectas del error de generalizaci\u00f3n: AIC, BIC, etc, asicomo Log Likelihood, el logaritmo de la funci\u00f3n de verosimilitud del modelo Recordemos es un modelo estad\u00edstico apoyado en unas hip\u00f3tesis por contrastar previa diagnosis para poder ser utilizado (ver mi trabajo).\n\nEn definitiva, dicho modelo de serie temporal aplicado al n\u00famero de llamadas al 900 900 120 en Catalu\u00f1a es:\n\n$$\n(1-B^7)(1-0.948 B) \\nabla_7 \\nabla^1 X_t = (1+0.823 B)(1+0.988B^7)Y_t\n$$\n\n  + 1\\. Notemos que se nos proporciona tambi\u00e9n un intervalo de confianza a un nivel de significaci\u00f3n de $\\alpha = 0.05$, esto significa que tenemos una confianza de del 95%. Es decir, la interpretaci\u00f3n correcta consiste en afirmar que en 95 muestras de cada 100 obtenidas de forma aleatoria el valor verdadero de dicho par\u00e1metro pertenece a dicho intervalo.\n\n  + 2\\. Adem\u00e1s se proporciona el $p$-valor (P > |z|, con z el cuantil $1-\\alpha\/2$ de una normal est\u00e1ndar $N(0,1)$, pues se toman colas iguales) de cada contraste de significaci\u00f3n sobre cada par\u00e1metro para tratar de asumir formalmente que un par\u00e1metro es significativo, es decir, distinto de 0. En nuestro caso, todos son distintos de 0 seg\u00fan los contrastes.","be0d87cd":"**Obs**: tambi\u00e9n se podr\u00eda analizar a qu\u00e9 hora recibe m\u00e1s llamadas el 900 900 120","6bca1b66":"Esto es muy llamativo, se\u01f5un dicta la imagen 4. 2. 2. 1. resulta que **el perfil de mujer maltratada est\u00e1 fuertemente correlacionado con una formaci\u00f3n m\u00e1s b\u00e1sica (perfil recurrente)**. Queda claro que la educaci\u00f3n de una persona es muy importante. \n\nEl hecho de que las mujeres sin estudios solo representen un 3.04 % sobre el total seguramente est\u00e9 relacionado con el hecho de que es poco habitual que una persona no llegue a sacarse la educaci\u00f3n primaria pues es obligatoria en Espa\u00f1a (esto es solo una conjetura)","04321085":"Parece que vamos a tener suerte y no vamos a necesitar identificadores para cruzar por Comarca.","01b77be7":"# [5. PCA y Clustering comarcal con marcadores socio-econ\u00f3micos](#section5.)     ","eb1e6761":"Como se puede verificar arriba existen grandes porcentajes de missing-values. Algunas variables directamente se puede desechar, por ejemplo, las que superan un 90%. No obstante, siempre hay que ser cuidadoso, y antes de eliminar una variable se le ha de prestar atenci\u00f3n, pues puede ser que un 10% sobre el total pueda resultar ser suficientes datos para alg\u00fan an\u00e1lisis individual a nivel de columna.\n\n**\u00a1WARNING!:**: Muchos missing values est\u00e1n justificados:\n\n   + 1\\. E.g., la columna \"Detall familiar o persona proopera\" tiene sentido cuando la persona que realiza la llamada es un tercero y no la mujer directamente involucrada en el problema.\n   + 2\\. E.g., las columnas \"Temps resid\u00e8ncia\" y \"Situaci\u00f3 legal\" no tienen sentido en el caso de que la nacionalidad sea espa\u00f1ola.\n   + 3\\. E.g., el \"Detall situaci\u00f3 laboral\" no tiene sentido que se especifique si su situaci\u00f3n laboral no consta.","fd067f93":"## [4. 2. Perfiles relacionados con el 900 900 120](#subsection4.2.)","b7f8ced9":"### [4. 2. 3. Sobre la mujer extranjera](#subsection4.2.3.)","5f6dfed8":"Recu\u00e9rdese que el n\u00famero de llamadas acumuladas hasta la fecha que no son reincidentes se encontraban en el dataset `df_edat_acum_2` (i.e., las que corresponden a personas distintas).","274411a4":"En la imagen 4. 2. 1. 1. se puede visualizar que la evoluci\u00f3n es bastante estable. No obstante, puede llamar la atenci\u00f3n que durante el confinamiento las mujeres de m\u00e1s de 60 a\u00f1os alcanzaron el nivel de las mujeres de 51-60 a\u00f1os.\n\nLos 3 perfiles m\u00e1s frecuentes a lo largo del tiempo son en orden decreciente: 31-40, 41-50, 18-31 a\u00f1os.","876aa84b":"La situaci\u00f3n es clara. En el \u00e1mbito de la pareja el perfil m\u00e1s recurrente son mujeres que tienen a cargo hijos viviendo en el n\u00facleo familiar.","486eb902":"> **`Conclusiones sobre el a\u00f1o 2020 (imagen 4.1.5.)`**: Se visualiza claramente un fuerte ascenso de media en las llamadas probablemente provocado por los confinamientos recurrentes durante 2020. Estos confinamientos han obligado a la gente a pasar **m\u00e1s tiempo en casa** difuminando la diferencia entre los d\u00edas laborables y los d\u00edas del fin de semana. De hecho, ha aumentado la varianza de las llamadas durante el fin de semana.","1d78c29b":"Esto no tendr\u00eda sentido. No tiene sentido que haya aproximadamente 86921 llamadas con violencia psicol\u00f3gica y que el n\u00famero de llamadas con motivo de violencia machista sean 79081. Una diferencia de 7840. \n\nEsto habr\u00eda que aclararlo con el proveedor de los datos.\n\nEn cualquier caso, a partir de ahora se asumir\u00e1 que si se llama al 900 900 120 (tel\u00e9fono de atenci\u00f3n contra la violencia machista) es por alg\u00fan problema de violencia machista.","439ef422":"Se pretende construir un video al respecto con la librer\u00eda bar_chart_race. \n\nDicha librer\u00eda he tenido la suerte de encontrarla en el enlace siguiente:\n\nhttps:\/\/pypi.org\/project\/bar-chart-race\/\n\nEsta requiere de entrada un dataframe con una determinada estructura y, adem\u00e1s, consume mucha memoria as\u00ed que haremos unos arreglos antes de procesarlo:","a89ff279":"\u00bfCu\u00e1ntas mujeres conviven con el presunto agresor dentro del \u00e1mbito de la pareja?","24145d94":"Si nos fijamos en los 3 ouputs anteriores, se puede notar que ha habido un aumento de aprox. 7 llamadas diarias de media al 900 900 120","237286d4":"Construimos el dataset de acumulaciones para los rangos de edad","176e7980":"### Sin m\u00e9todo elbow. Elijo K = 3 cl\u00fasters. ","4d787294":"### [3. 2. 1. Recuento de Missing-Values](#section3.2.1.)","65248b99":"Ejecutamos la funci\u00f3n bar_chart_race() (en la vista compartida hay un horizontal scroll box)","eee16a36":"En el chunk siguiente obtengo los datos relativizados seg\u00fan poblaci\u00f3n donde el porcentaje indica el porcentaje de subpoblaci\u00f3n afectada hasta la fecha.","f8a80089":"A continuaci\u00f3n, comprobamos si todos lo hecho hasta ahora es coherente","c73fb1a9":"### \u00bfHay estacionalidad anual?\n\n Tambi\u00e9n puede resultar de inter\u00e9s la evoluci\u00f3n mensual de llamadas al 900 900 120 en Catalu\u00f1a","a4912592":"https:\/\/www.idescat.cat\/estad\/?lang=es","dd13ff92":"En la imagen 4.1.2. no se puede deducir correctamente la estacionalidad a causa del aglutinamiento de los datos. Se puede modificar tambi\u00e9n en el c\u00f3digo la parte de \".iloc[0:366]\" para visualizar mejor la imagen a intervalos de x d\u00edas, no obstante, tampoco se ve una estacionalidad clara.\n\nNo obstante, no es raro que en una serie diaria exista una estacionalidad compleja cuya combinaci\u00f3n es la estacionalidad semanal y la estacionalidad anual. Vamos a tratar de identificar si existe alguna de las dos.","6e38bfa3":"### [4. 2. 2. Situaci\u00f3n socioecon\u00f3mica de la v\u00edctima:](#subsection4.2.2.)","ac976261":"## \u00bfEn qu\u00e9 \u00e1mbito se produce m\u00e1s?","897da900":"Ahora veamos si la evoluci\u00f3n y el compartamiento se preserva cuando nos restringimos al grupo de edad de mujeres de 31-40 a\u00f1os.","be94e07b":"---","7e114415":"## Conclusiones:\n\n   + **1.** : restringi\u00e9ndonos a la condici\u00f3n econ\u00f3mica, la mujer que m\u00e1s llama es una mujer dependiente econ\u00f3micamente. A su vez, dentro de este grupo el perfil m\u00e1s recurrente suele ser una mujer trabajadora en el \u00e1mbito dom\u00e9stico. \n   + **2.** : las mujeres trabajadoras tambi\u00e9n representan un gran n\u00famero.\n   \nNo veo una mayor\u00eda clara para tomar una decisi\u00f3n. En cualquier caso, supongo que una mujer dependiente econ\u00f3micamente tendr\u00e1 una situaci\u00f3n m\u00e1s dif\u00edcil que una mujer independiente econ\u00f3micamente. Pero se\u01f5un estos datos no tomar\u00eda la condici\u00f3n econ\u00f3mica como un perfil para identificar el perfil m\u00e1s recurrente. Dado que hay bastante equilibrio, necesitar\u00edamos relativizar los datos en funci\u00f3n de los cardinales poblacionales de cada grupo.","2e31c227":"\nImaginemos que **queremos establecer, e.g, $3$ grupos**: grupo $1$, grupo $2$, grupo $3$, en funci\u00f3n de algunos marcadores socio-econ\u00f3micos, i.e., el grupo $1$ ser\u00eda el m\u00e1s afectado y, por ello, cada una de las Comarcas de este grupo necesitar\u00eda que se le destinase m\u00e1s proporci\u00f3n de los presupuestos para luchar contra la violencia machista que los del grupo $2$ y grupo $3$.\n\n**\u00bfPero cu\u00e1l es el problema?** el problema reside en que **en alg\u00fan umbral hay que establecer las fronteras de dichos grupos**. Es decir, **podr\u00eda ocurrir que existiera una Comarca para la que la situaci\u00f3n estuviera en una situaci\u00f3n fronteriza entre los grupos $1$ y $2$**. Por esto \u00faltimo, conviene que un experto se encarge de imparcializar los criterios de decisi\u00f3n a la hora de asignar dichos presupuestos, con tal de cubrirse las espaldas con futuros reproches por parte de los responsables de las Comarcas. Una buena idea ser\u00eda la de **conseguir unas variables socio-econ\u00f3micas representativas de las Comarcas relativas para establecer clusters**. En nuestro caso, realizaremos el an\u00e1lisis para el a\u00f1o 2018 (el a\u00f1o m\u00e1s reciente a la par que completo que he encontrado en cuanto a marcadores econ\u00f3micos) nosotros utilizaremos unas variables sencillas para ilustrar la situaci\u00f3n, pero sobradamente s\u00e9 que la ingenier\u00eda de variables es una ciencia muy importante y nada sencilla que requiere de mucho tiempo.\n\n**Para formar tales grupos disponemos de muchas t\u00e9cnicas de aprendizaje no supervisado**, como lo son las t\u00e9cnicas de jerarqu\u00edas, $k$-means, DBSCAN, etc. **En nuestro caso utilizaremos $k$-means** con la distancia eucl\u00eddea para ilustrar (no siendo esta la distancia m\u00e1s oportuna en todas las ocasiones), donde $k$ es el n\u00famero de grupos que pretendemos obtener. Cabe destacar, que este $k$ aunque pueda ser forzado como es en nuestro caso, existen m\u00e9todos que permiten vislumbrar cu\u00e1l ser\u00eda el $k$ correcto. Por un lado, disponemos de t\u00e9cnicas visuales como la t\u00e9cnica de escalado multidimensional (MDS) o la t\u00e9cnica de An\u00e1lisis de Componentes Principales (PCA), donde si es posible proyectar en el plano $\\mathbb{R}^2$ seremos capaces de intuir los grupos. Otra t\u00e9cnica para intuir el $k$ adecuado pueden ser la t\u00e9cnica previa de jerarqu\u00edas, que no deja de ser otra t\u00e9cnica de clusterizaci\u00f3n que se puede utilizar conjuntamente con $k$-meansa modo de apoyo. Por \u00faltimo, tambi\u00e9n para intuir el $k$ adecuado se utiliza mucho el m\u00e9todo elbow o tambi\u00e9n la t\u00e9cnica de la silueta (silhouette method). Estas t\u00e9cnicas no son excluyentes, y se pueden apoyar las unas a las otras.\n\nEn nuestro caso, **utilizar\u00e9 PCA previamente** con una funci\u00f3n casera. \u00bfPor qu\u00e9 una funci\u00f3n casera? Sencilla contestaci\u00f3n, los algoritmos que vienen predefinidos en Python no suelen traer consigo medidas de calidad tan importantes como la calidad de las proyecciones de los individuos y la calidad de las variables proyectadas. Mucha gente se dedica a establecer conclusiones en PCA cuando no son conscientes de que si un individuo \"$x$\" o una variable \"y\" no superan un umbral m\u00ednimo de calidad no pueden ser utilizadas para establecer conclusiones y deben permanecer al margen de tus conclusiones. Tambi\u00e9n se puede aumentar la dimensi\u00f3n del espacio sobre el que se proyecta para recoger m\u00e1s variabilidad y con ello conseguir m\u00e1s calidad.\n\nDichos conocimientos de PCA fueron adquiridos en la asignatura \"An\u00e1lisis de Datos I\" por Mar\u00eda Jos\u00e9 Nueda Rold\u00e1n, Coordinadora del grado de Matem\u00e1ticas y que consigui\u00f3 transmitirme unos conceptos profundos sobre PCA. Parte de esta funci\u00f3n fue proporcionada en dicha asignatura y  ha sido posteriormente readaptada y algo m\u00e1s desarrollada por m\u00ed en Python (representaciones en q = 1 y q = 3). \n\n\u00bfPor qu\u00e9 usar PCA+kmeans?\n\n+ 1. **Podr\u00e9 representar en $2$\/$3$ dimensiones mi conjunto de datos** y **pintar los clusters** (Siempre que se conserve en la proyecci\u00f3n al menos un 75 % de variabilidad o informaci\u00f3n del dataset primario).\n+ 2. Las variables resultantes ser\u00e1n incorreladas (independientes si, adem\u00e1s, hay normalidad conjunta).\n+ 3. Podr\u00e9 **descubrir relaciones ocultas entre las variables**.\n\nAunque estamos en el M\u00e1ster de Ciencia de Datos, no dar\u00e9 por sentado estos conocimientos y, por buena praxis, **proporcionar\u00e9 de mi mano una breve introducci\u00f3n te\u00f3rica al respecto**. **Se puede obviar y saltar**.","4e761f1d":"Veamos ahora que ocurre con una mujer casada de 31-40 a\u00f1os con solo la educaci\u00f3n primaria:","6c53b67b":"### Conjunto de datos final preparado","58033e1f":"Conclusiones:\n\n   + **1.**: Si la mujer es trabajadora, el perfil m\u00e1s frecuente es el de mujer independiente econ\u00f3micamente\n   + **2.**: Si la mujer no es trabajadora, el perfil m\u00e1s frecuente es el de mujer dependiente econ\u00f3micamente.\n\nObservaci\u00f3n: aqu\u00ed solo identificamos el perfil m\u00e1s frecuente, no tiene nada que ver con el grupo de riesgo. Para ello, se han de relativizar los datos. Pensemos que si una mujer trabaja es m\u00e1s probable que sea independiente econ\u00f3micamente y, por consiguiente, por una cuesti\u00f3n de n\u00fameros, se recibir\u00e1n m\u00e1s llamadas de mujeres trabajadoras independientes econ\u00f3micamente. Asimismo, si una mujer no trabaja, es m\u00e1s probable que sea dependiente econ\u00f3micamente y, por lo tanto, por cuesti\u00f3n de n\u00fameros, se recibir\u00e1n m\u00e1s llamadas de mujeres no trabajadoras dependientes econ\u00f3micamente.\n\nPor ello, si aqu\u00ed no se relativizan los datos, \u00fanicamente se est\u00e1 identificando a los grupos m\u00e1s recurrentes involucrados en la violencia machista, pero no se est\u00e1n identificando los grupos de riesgo. N\u00f3tese que para el caso de la edad s\u00ed lo hicimos pues ten\u00edamos los datos a mano proporcionados por el INE y me molest\u00e9 en hacerlo. En este \u00faltimo caso vimos que los perfiles recurrente coincid\u00edan con los grupos de riesgo.\n\nNo es una mala estrategia centrarse en los perfiles m\u00e1s recurrentes, pero no es moralmente aceptable dejar abandonados a los grupos de riesgo, pues solo la condici\u00f3n de pertenecer a un grupo de riesgo te dispara las probabilidades de ser v\u00edctima de violencia machista y, estaremos de acuerdo en que una condici\u00f3n socio-econ\u00f3mica, o de cualquier otro tipo, no debe de propiciar este tipo de situaciones.","23058f61":"\u00bfPor qu\u00e9 hablo de perfiles m\u00e1s frecuentes y no m\u00e1s afectados? Sencillo. Que llamen m\u00e1s las mujeres de 31-40 a\u00f1os no significa que necesariamente su rango de edad sea el m\u00e1s afectado (s\u00ed las m\u00e1s frecuentes), pues pudiera coincidir que su poblaci\u00f3n dentro de la poblaci\u00f3n de Catalu\u00f1a sea el m\u00e1s abundante. Por tanto, interesar\u00eda tambi\u00e9n consultar los datos relativizados seg\u00fan el cardinal de cada subpoblaci\u00f3n. \n\nPor consiguiente, para identificar grupos de riesgo se necesita previamente relativizar los datos con los cardinales de las subpoblaciones correspondientes de Catalu\u00f1a.\n\n\nPara ello, se va a obtener los cardinales relativos a cada grupo de mujeres con \"$x$\" a\u00f1os para los a\u00f1os 2013-2020 proporcionados por el INE:\n\nhttps:\/\/www.ine.es\/jaxi\/Tabla.htm?path=\/t20\/e245\/p08\/l0\/&file=02003.px&L=0\n\nSe cargan en Kaggle y los cargamos en el presente notebook. ","a923e974":"A continuaci\u00f3n, se carga el conjunto de los datos indicando de antemano el tipo fecha a la columna Data. En cuanto al resto de Dtypes, se ir\u00e1 cambiando si es necesario conforme surja la necesidad de hacerlo. Asimismo, \u00eddem en cuanto a la estructura de los datos.","a122c1ad":"Mi funci\u00f3n ACP. Se puede obviar y saltar. \u00danicamente la dejo reflejada aqu\u00ed para que quede constancia.","ee7bb07d":"Se pretend\u00eda pintar un diagrama de barras 3D, pero plotly todav\u00eda no lo ha desarrollado en Python (en R s\u00ed), por lo tanto, se trat\u00f3 de\n instalar el siguiente m\u00f3dulo de github:\n \nhttps:\/\/github.com\/buran21\/barchart3d-plotly\n \nSin embargo, el servidor de kaggle se quejaba y se ha optado por importarlo directamente. Se ha subido a mi propio directorio de kaggle sin necesidad de instalarlo y posteriormente se ha importado la funci\u00f3n deseada. Es decir, se ha hecho uso de la opci\u00f3n \"Add utility Script\", cuyas directrices las he adquirido en:\n\nhttps:\/\/www.kaggle.com\/product-feedback\/91185","2498aaa7":"## Elecci\u00f3n hiperpar\u00e1metro $K$ mediante el M\u00e9todo Elbow","ff882aaf":"### [4. 1. 1. Conclusiones sobre la serie diaria 900 900 120](#subsection4.1.1.) \n+ 1. Para la serie temporal: \"N\u00ba de llamadas diarias al 900 900 120 en el territorio Catal\u00e1n durante el peri\u00f3do 2013-2019\" (sin contar la COVID-19, a\u00f1o 2020), se tienen buenas noticias, pues la serie goza de las siguientes caracter\u00edsticas:\n\n    - **1. 1.** Serie muy estable en cuando a tendencia\n    - **1. 2.** Serie homoced\u00e1stica, no heteroced\u00e1stica\n    - **1. 3.** Serie con estacionalidad simple semanal bastante regular.\n\nEstas caracter\u00edsticas convierten a la serie temporal: \"N\u00ba de llamadas diarias al 900 900 120 en el territorio Catal\u00e1n durante 2013-2019\" como una serie candidata para alg\u00fan modelo predictivo SARIMA estacional multiplicativo\/aditivo (mediante el an\u00e1lisis Box-Jenkins).\n\nObservaci\u00f3n: la serie mensual asociada (sin 2020) tambi\u00e9n puede encajar dentro de un modelo SARIMA, pues es un resumen de la diaria, tan solo cambiar\u00eda que no habr\u00eda estacionalidad.\n\nNo obstante, \u00a1Cuidado!, hay un cambio de comportamiento en 2020, y el modelo SARIMA habr\u00eda fallado muy probablemente en las predicciones de 2020 si se contruye con el hist\u00f3rico existente hasta entonces, porque no habr\u00eda aprendido esa parte. Asimismo, esto ocurrir\u00eda con una red neuronal.","df663c2d":"+ \u00bf Sobre qu\u00e9 variables podemos establecer conclusiones precisas? Es decir, con la variabilidad capturada, \u00bfqu\u00e9 variables superan un m\u00ednimo de calidad? (Esta es la pregunta que en todos los sitios se obvia y que es grave no tenerlo en cuenta)\n\nPara contestar a esta pregunta se utilizan una medida espec\u00edfica de calidad. Esta se construye a partir de la matriz de correlaciones entre variables originales y componentes principales.\n\n$$\nR_{XY} := D_{1\/\\sigma}UD_{\\sqrt{\\lambda}} := \\left(r_{x^h,y^k}\\right)_{h = 1,\\dots,p}^{k = 1,\\dots,q}\n$$\n\ndonde $D_{1\/\\sigma}$ denota la matriz diagonal de las desviaciones t\u00edpicas de cada variable original,  $D_{\\sqrt{\\lambda}}$ denota la matriz diagonal con las desviaciones t\u00edpicas de cada componente principal y $U$ denota la matriz de vectores propios soluci\u00f3n del problema de optimizaci\u00f3n secuencial involucrado en el problema de An\u00e1lisis de Componentes Principales.\n\nLa calidad de una variable original capturada por el espacio proyecci\u00f3n se denota como $\\mu_h$ y se calcula como $\\mu_h := \\sum_{k=1}^{q} (r_{x^h,y^k})^2$. Es f\u00e1cil ver que este valor oscila entre 0 y 1.\n\nEn nuestro caso, se puede consultar con R_V (Representacion de variables)","4fd56788":"La Imagen 4. 2. 2. 2. muestra que dentro de la poblaci\u00f3n de mujeres casadas de 31-40 a\u00f1os los porcentajes siguen preserv\u00e1ndose, i.e., las mujeres que s\u00f3lo han adquirido la educaci\u00f3n primaria obligatoria son el perfil m\u00e1s frecuente en la llamada.\n\n**Conclusi\u00f3n**: hasta ahora **el perfil que m\u00e1s recurrente parece ser el de una mujer casada de 31-40 a\u00f1os solo dispone de la educaci\u00f3n primaria obligatoria**.","9ff0cac7":"### [4. 2. 6. Relaci\u00f3n de la v\u00edctima con el denunciante cuando esta no es la que avisa](#subsection4.2.2.)","fb9d7908":"## [3. 1. Carga de los datos](#section3.1.)","62963513":"# [2. Objetivos del trabajo](#section2.)\n  \nSup\u00f3ngase que el Instituto Catal\u00e1n de las Mujeres (Institut Catal\u00e0 de les Dones) pretende:\n\n   + 1\\. Identificar el perfil de mujer m\u00e1s recurrente en la violencia machista\n   + 2\\. Identificar el perfil del presunto agresor. \n   + 3\\. Identificar el tipo de relaci\u00f3n con el presunto agresor.\n   + 4\\. Aumentar las l\u00edneas del 900 900 120 disponibles con la finalidad de que ninguna mujer quede desatendida en una situaci\u00f3n de riesgo.\n   + 5\\. Identificar marcadores socioecon\u00f3micos relacionados con el n\u00famero de llamadas y en base a estos segregar de alguna forma las comarcas de Catalu\u00f1a. Esto facilitar\u00eda la asignaci\u00f3n de presupuestos para luchar contra la violencia machista. Adem\u00e1s imparcializar\u00eda dicha asignaci\u00f3n\/decisi\u00f3n, algo muy \u00fatil para evitar futuros reproches, pues el responsable ser\u00eda un criterior algor\u00edtmico o estad\u00edstico.\n\n$\\,$ Sin embargo, se disponen de recursos limitados y no se pueden reforzar las l\u00edneas todos los d\u00edas de la semana y tampoco saben c\u00f3mo proceder con respecto al resto de apartados, por consiguiente, nos piden ayuda a nosotros, los Cient\u00edficos de Datos y como tales proponemos:\n\n   + 1\\. Estudiar la evoluci\u00f3n general del n\u00famero de llamadas a nivel Catal\u00e1n a efectos de detectar estacionalidades y realizar posibles predicciones que permitan la anticipaci\u00f3n log\u00edstica. No obstante, la covid-19 destrozar\u00eda en el a\u00f1o 2020 cualquier modelo predictivo.\n   + 2\\. Analizar el perfil de mujer con mayor riesgo de violencia machista mediante gr\u00e1ficos descriptivos.\n   + 3\\. Analizar mediante alg\u00fan m\u00e9todo de proyecci\u00f3n dimensional combinado con alg\u00fan m\u00e9todo de aprendizaje no supervisado para jerarquizar, por grupos (si es posible), las comarcas de Catalu\u00f1a en funci\u00f3n de la gravedad de su situaci\u00f3n al respecto.","8d158094":"Las conclusiones sobre la imagen 4. 2. 1. 3. son claras y eran algo esperables. Los $3$ rangos de edad m\u00e1s frecuentes por orden decreciente siguen preserv\u00e1ndose pese a filtrar las reincidencias.","66f9f8ff":"## [4. 1. Descripci\u00f3n de la serie temporal llamadas al 900 900 120 en Catalu\u00f1a](#subsection4.1.)","7ed1a141":"# [1. Informaci\u00f3n sobre el DataSet](#section1.)","afde0a0c":"## \u00bfCu\u00e1l es la formaci\u00f3n del perfil m\u00e1s recurrente?","17f69b0a":"### [4. 2. 4. Tipo de violencia machista m\u00e1s frecuente](#subsection4.2.4.)","b26f58ad":"## [1. 2. Significado del DataSet](#subsection1.1.)","31a4205c":"Se tienen dos tipos de variables aparentemente incompatibles","b2775205":"Y no solo eso, sino que, adem\u00e1s,","f4401df1":"En nuestro caso, todas las variables superan un 75% de calidad. No es lo mejor, pero no est\u00e1 mal para trabajar. Al menos nos podemos quedar tranquilos con las interpretaciones siguientes. \n\nInterpretaci\u00f3n de las componentes principales 1 y 2.\n\n   + Componentes 1: correlacionada positivamente con las prestaciones por desempleo e inversamente con las tasas de paro y el % de afectadas por violencia machista\n   + Componentes 2: correlacionada positivamente con las ayudas de alquiler e inversamente con el PIB y el % de afectadas por violencia machista.\n   \nNo obstante, realmente aqu\u00ed para nuestro an\u00e1lisis nos interesa poco con qu\u00e9 variables originales se identifican las componentes principales. Lo que realmente nos interesa es la posici\u00f3n relativa en el espacio proyectado de la variable \"% afectadas\" (por violencia machista) con respecto a las variables restantes. \n\n\n## Conclusi\u00f3n sobre las variables: \n\nEs evidente aqu\u00ed lo que ocurre no \u00bfNo?. \n\nAlgo que cab\u00eda esperar, el \"% afectadas\" se sit\u00faa casi en ubicaciones opuestas a las ayudas econ\u00f3micas, i.e., las ayudas econ\u00f3micas alivian el estr\u00e9s social.\n\nPor el contrario, los indicadores de paro se sit\u00faan cerca de la variable \"% afectadas\", i.e., a m\u00e1s paro m\u00e1s estr\u00e9s social y m\u00e1s \"% afectadas\". \u00bfCon esto estoy afirmando que la violencia machista est\u00e1 causada por el estr\u00e9s social? Para desactivar las alarmas, simplemente dir\u00e9 que no. Tan solo conjeturo que el estr\u00e9s social puede agravar situaciones y aunque no sea una justificaci\u00f3n, parece ser que s\u00ed propicia este tipo de conducta indebida.","bc933c87":"Tenemos dos problemas:\n   + 1. Los datos no est\u00e1n relativizados seg\u00fan cardinales poblacionales\n   + 2. Con una \u00fanica columna no tienen mucho sentido ni aplicar PCA ni aplicar kmeans\n\nPor lo tanto, tenemos que otear el terreno. He encontrado la fuente siguiente que recolecta por a\u00f1os datos estad\u00edsticos en Catalu\u00f1a:","d4eeb761":"Una situaci\u00f3n muy equilibrada. Es llamativo la cantidad de hombres que pese a estar su relaci\u00f3n terminada y no convivir siguen acosando presuntamente a su expareja.","1d3dba27":"Por otra parte, se **eliminan las columnas siguientes** por ser casi nulas y tener menos inter\u00e9s:\n\n+ **Nombre fills\/filles A**: Nombre de filles\/s de la persona que truca o sobre qui es fa la consulta agrupada en categories. Fa refer\u00e8ncia a una segona situaci\u00f3 en relaci\u00f3 als fills\n+ **Xarxa**: Detalla el recurs espec\u00edfic a on s\u2019ha derivat la trucada\n+ **Derivaci\u00f3_A**: Detalla si s\u2019ha derivat la trucada a algun altre servei\n+ **Xarxa_A**: Detalla el recurs espec\u00edfic a on s\u2019ha derivat la trucada\n+ **Derivaci\u00f3_B**: Detalla si s\u2019ha derivat la trucada a algun altre servei\n+ **Xarxa_B**: Detalla el recurs espec\u00edfic a on s\u2019ha derivat la trucada\n+ **Derivaci\u00f3_C**: Detalla si s\u2019ha derivat la trucada a algun altre servei\n+ **Xarxa_C**: Detalla el recurs espec\u00edfic a on s\u2019ha derivat la trucada","c0497700":"# [6. Conclusiones](#section6.)","0f2846e1":"Recordatorio sobre PCA y Kmeans","34a8c833":"**Conclusiones**: curiosamente, pese a lo importante que debe ser la familia, el porcentaje de progenitores y hermanos (23.4 + 13 = 36.4 %) es muy similar al porcentaje de las intervenciones de las amistades (31.2 %).","b402b156":"Adem\u00e1s se tiene que arreglar un poco el conjunto de datos, ya que los cardinales se han otorgado por a\u00f1os de edad y los necesitamos por unos rangos de edad concretos. ","95b91468":"Usaremos en este caso la interactividad de plotly para visualizar la serie temporal de inter\u00e9s. Se puede hacer zoom tambi\u00e9n pulsando y arrastrando hasta alcanzar la amplitud temporal deseada.","b7d372bc":"## Estado Civil m\u00e1s frecuente de la v\u00edctima","8c18da24":"Como ya vaticinamos con las visualizaciones, la serie diaria de llamadas al 900 900 120 en Catalu\u00f1a era aproximadamente estacionaria. El test de Dickey-Fuller no nos contradice y nos permite escoger c\u00f3modamente $d = 0$.  Es decir, puedo asumir que $X_t$ es estacionaria y no necesito transformarla mediante diferenciaci\u00f3n.","ad132b10":"## Antes de establecer conclusiones:\n\nNosotros hemos escogido $3$ componentes para el espacio de proyecci\u00f3n.\n\n- \u00bfSe recoge varianza suficiente en este espacio proyectado?\n\n   - S\u00ed, vemos que al menos se alcanza un 75 %","84166f3c":"+ **Data**: Data de la trucada. '%d\/%m\/%Y'\n+ **Any**: Any que s\u2019ha realitzat la trucada\n+ **Durada segons**: Int\u00e8rval de la durada de la trucada\n+ **D\u00eda setmana**: Dia de la setmana que s\u2019ha realitzat la trucada\n+ **Mes**: Mes que s\u2019ha realitzat la trucada\n+ **Hora**: Hora de la trucada\n+ **Llengua**: Idioma en qu\u00e8 s\u2019ha efectuat la trucada\n+ **Comarca**: Comarca d\u2019on procedeix la trucada\n+ **\u00c0mbit**: territorial: \u00c0mbit territorial d\u2019on procedeix la trucada\n+ **Provincia**: Prov\u00edncia d\u2019on procedeix la trucada\n+ **Prov\u00edncia agrupada**: Prov\u00edncia des d\u2019on truca la persona agrupada en categories\n+ **Sexe**: Sexe de la persona que truca o sobre qui es fa la consulta\n+ **Edat**: Edat de la persona que truca o sobre qui es fa la consulta agrupada en categories\n+ **Estat Civil**: Detall de la persona professional que truca en relaci\u00f3 a la xarxa de recursos p\u00fablics\n+ **Persona que truca**: Persona que truca i relaci\u00f3 amb la persona usu\u00e0ria\n+ **Detall familiar o persona proopera**: M\u00e9s detalls de la persona que truca, si s\u2019escau\n+ **Detall professional**: Detall de la persona professional que truca\n+ **Situaci\u00f3 familiar**: Situaci\u00f3 familiar de la persona que truca o sobre qui es fa la consulta\n+ **Situaci\u00f3 fills\/filles**: Situaci\u00f3 en relaci\u00f3 a les filles\/s de la persona que truca o sobre qui es fa la consulta\n+ **Nombre fills\/filles**: Nombre de fills de la persona que truca o sobre qui es fa la consulta\n+ **Situaci\u00f3 fills\/filles A**: Situaci\u00f3 en relaci\u00f3 als fills de la persona que truca o sobre qui es fa la consulta Fa refer\u00e8ncia a una segona situaci\u00f3 en relaci\u00f3 als fills\n+ **Nombre fills\/filles A**: Nombre de filles\/s de la persona que truca o sobre qui es fa la consulta agrupada en categories. Fa refer\u00e8ncia a una segona situaci\u00f3 en relaci\u00f3 als fills\n+ **Pateixen maltractament**: Situaci\u00f3 de maltractament de les filles\/s dins del nucli familiar de la persona que truca o sobre qui es fa la consulta\n+ **Nacionalitat**: Nacionalitat de la persona que truca o sobre qui es fa la consulta\n+ **Situaci\u00f3 legal**: Situaci\u00f3 econ\u00f2mica de la persona que truca o sobre qui es fa la consulta\n+ **Temps resid\u00e8ncia**: Anys de resid\u00e8ncia de la persona estrangera que truca o sobre qui es fa la consulta agrupada\n+ **Formaci\u00f3**: Formaci\u00f3 de la persona que truca o sobre qui es fa la consulta\n+ **Situaci\u00f3 Laboral**: Situaci\u00f3 laboral de la persona que truca o de qui es fa la consulta\n+ **Detall situaci\u00f3 laboral**: Detall de la situaci\u00f3 laboral de la persona que truca o sobre qui es fa la consulta\n+ **\u00das previ servei**: \u00das previ del servei de la persona que truca o sobre qui es fa la consulta\n+ **Motiu Trucada**: Motiu de la trucada\n+ **Tipus assessorament**: Tipus d'assessorament de la trucada en el cas que no es tracti de viol\u00e8ncia masclista\n+ **\u00c0mbit viol\u00e8ncia masclista**: M\u00e9s informaci\u00f3 sobre l\u2019\u00e0mbit de la viol\u00e8ncia masclista\n+ **Detall \u00e0mbit**: M\u00e9s informaci\u00f3 sobre l\u2019\u00e0mbit del motiu de la trucada\n+ **Viol\u00e8ncia f\u00edsica**: Detalla si es pateix viol\u00e8ncia f\u00edsica\n+ **Viol\u00e8ncia psicol\u00f2gica**: Detalla si es pateix viol\u00e8ncia psicol\u00f2gica\n+ **Viol\u00e8ncia sexual**: Detalla si es pateix viol\u00e8ncia sexual\n+ **Viol\u00e8ncia econ\u00f2mica**: Detalla si es pateix viol\u00e8ncia econ\u00f2mica\n+ **Conviu agressor**: Detalla si la persona que truca o de qui es fa la consulta conviu amb la persona agressora\n+ **Relaci\u00f3 agressor**: Relaci\u00f3 de la persona amb l'agressor\n+ **Relaci\u00f3 agressor \u00e0mbit laboral**: Relaci\u00f3 de la persona amb l\u2019agressor en l\u2019\u00e0mbit laboral\n+ **Temps de relaci\u00f3**: Temps que fa que dura la relaci\u00f3\n+ **Nacionalitat agressor**: Nacionalitat de la persona agressora\n+ **Derivaci\u00f3**: Detalla si s\u2019ha derivat la trucada a algun altre servei\n+ **Xarxa**: Detalla el recurs espec\u00edfic a on s\u2019ha derivat la trucada\n+ **Derivaci\u00f3_A**: Detalla si s\u2019ha derivat la trucada a algun altre servei\n+ **Xarxa_A**: Detalla el recurs espec\u00edfic a on s\u2019ha derivat la trucada\n+ **Derivaci\u00f3_B**: Detalla si s\u2019ha derivat la trucada a algun altre servei\n+ **Xarxa_B**: Detalla el recurs espec\u00edfic a on s\u2019ha derivat la trucada\n+ **Derivaci\u00f3_C**: Detalla si s\u2019ha derivat la trucada a algun altre servei\n+ **Xarxa_C**: Detalla el recurs espec\u00edfic a on s\u2019ha derivat la trucada\n+ **Traducci\u00f3**: Detalla si ha calgut traducci\u00f3 per atendre la trucada\n+ **Idioma Traducci\u00f3**: Idioma de la traducci\u00f3\n+ **Reclamacions\/Queixes**: Detalla si hi ha hagut reclamacions o queixes\n+ **Emerg\u00e8ncia**: Detalla si es tracta d\u2019una emerg\u00e8ncia\n+ **Connexi\u00f3**: Tipus de connexi\u00f3: 1-Watsapp, 2-Trucades i 3-Correus electr\u00f2n","e3838a8f":"Se obtiene la serie mensual para que la visualizaci\u00f3n no est\u00e9 tan aglutinada","2902b1e1":"Agrupamos por edad y fecha para visualizar la evoluci\u00f3n seg\u00fan los rangos de edad disponibles. \n\n**Observaci\u00f3n**: la imputaci\u00f3n de missing-values en este caso carece de sentido ya que un NaN aqu\u00ed es sin\u00f3nimo de \"0\", e.g., si no ha habido ninguna persona para el d\u00eda 2013-01-02 menor de 18 a\u00f1os que haya llamado al 900 900 120, es que no la hay, y los datos en este caso no pueden ser imputados. De hecho, normalmente en las series temporales se han de tomar los valores 0 como NaN porque de lo contrario corrompen las visualizaciones de las mismas en una gr\u00e1fica. Es una cuesti\u00f3n de estilo.","0f377b9f":"**\u00a1WARNING!**: se tienen que eliminar los puntos en los cardinales para que Python no los entienda como decimales. ","47cfd6e5":"Filtramos por las provincias de inter\u00e9s.","4bec69f7":"Cruzamos los datos por el campo Edat","81c1d984":"Ahora el dataframe ya est\u00e1 listo para que la columna Edat sea agrupada con la funci\u00f3n de agregado suma","518a9563":"## \u00bfCu\u00e1l es su situaci\u00f3n laboral?\n","2dc8e0d5":"Predomina el \u00e1mbito de la pareja.","ea2be34c":"En esta secci\u00f3n realizar\u00e9 PCA y Clustering comarcal complementando el n\u00famero de llamadas acumuladas y realizadas en 2018 por Comarcas con marcadores socio-econ\u00f3micos comarcales cuyas fuentes indico m\u00e1s adelante. ","ff7ef192":"Puesto que se va a estudiar la relativizaci\u00f3n de las llamadas acumuladas desde el 2013 hasta el 2020, se va a considerar que los cardinales poblaciones de los respectivos grupos para cada uno de los a\u00f1os 2013, 2014, 2015, ..., 2019, pueden ser aproximados por sus respectivos en el a\u00f1o 2020. Otro criterio ser\u00eda el de tomar la media de los cardinales entre todos los a\u00f1os. A gusto del consumidor.","bdcb0b84":"Mediante una expresi\u00f3n regular se puede limpiar la columna de la edad. Tan solo se necesita el a\u00f1o.","2f0c5278":"### [3. 2. 2. Sobre imputaci\u00f3n de Missing-Values](#section3.2.2.)\n\nCabe hacer hincapi\u00e9 que al ser un conjunto de datos que depende del tiempo el tipo de imputaci\u00f3n que se ha visto en la asignatura quiz\u00e1s no resulte del todo apropiada. Recu\u00e9rdese que dicha imputaci\u00f3n se ha visto para conjuntos de datos est\u00e1ticos o no dependientes del tiempo. \n\nHasta aqu\u00ed se puede optar por 3 cosas:\n\n+ 1\\. Si la columna presenta un alto porcentaje de missing values, se puede eliminar directamente.\n+ 2\\. Se puede realizar una imputaci\u00f3n por $K$-NN (aunque cualquier otro m\u00e9todo de predicci\u00f3n es v\u00e1lido) para cada tiempo $t$ donde para un registro en el tiempo $t$ que presenta un missing value solo se tienen en cuenta los $K$-vecinos m\u00e1s cercanos para el mismo tiempo $t$. La desventaja de esto es que para cada $t$ se solo se cuentan con unos 20-80 registros aproximadamente con los que comparar.\n+ 3\\. Se puede tener en cuenta el conjunto en su globalidad y sin tener en cuenta el tiempo $t$ se puede realizar imputaci\u00f3n. Esto tiene la ventaja de que contar\u00edamos con todos los registros, sin embargo, no se puede olvidar que los vecinos dependen del tiempo, y que con este m\u00e9todo todos los registros que tengan los mismos missing values imputar\u00e1n con el mismo valor sus valores faltantes. No as\u00ed ocurre con la imputaci\u00f3n por cata tiempo $t$.\n\nT\u00e9ngase en cuenta que todas las variables son del tipo **string**, por lo que $K$-NN emplear\u00e1 la moda.\n\nLos valores num\u00e9ricos en este trabajo son el resultado de agrupar y realizar recuentos de registros.\n\nPuesto que son muchas las posibilidades, se tratar\u00e1 esto si surge la necesidad en funci\u00f3n de cada an\u00e1lisis.","6064ab5e":"**\u00a1Importante!**: recu\u00e9rdese que se ha pedido que busquemos el perfil m\u00e1s frecuente. Por tanto, vamos a ver si el perfil de casada sigue siendo el m\u00e1s frecuente cuando nos restringimos a la subpoblaci\u00f3n de mujeres de edad comprendida entre los 31 y 40 a\u00f1os.","0d20911e":"Hay que fijarse de nuevo en que los missing values de la situaci\u00f3n laboral est\u00e1n justificados aqu\u00ed. Si no hay situaci\u00f3n laboral, no tiene sentido detallar la situaci\u00f3n laboral."}}