{"cell_type":{"71013a63":"code","467a7d25":"code","e9049891":"code","d532d455":"code","914dc28c":"code","0b2f5e5b":"code","55115fa6":"code","2e7a656d":"code","c86d3db4":"code","c5a27f04":"code","0ee99b19":"code","a5dd7100":"code","bd4b4b2a":"code","31cfd234":"code","0a97d9aa":"code","61b20bb9":"code","8b617496":"code","60609b0f":"code","9f4ba7c5":"code","6ac17c4a":"code","db12661c":"code","7a68873f":"code","40e94c65":"code","6e80080a":"code","bec5c815":"code","3c25c54a":"code","bf4131aa":"code","e986fe7a":"code","47a9b0c8":"code","a1a480c5":"code","a22d055c":"markdown","1f896095":"markdown","acf9f7a8":"markdown","570ef83b":"markdown","19577a90":"markdown","5d309997":"markdown","f32d299f":"markdown","895ad304":"markdown","db70896e":"markdown","4d2a1c59":"markdown","794d9313":"markdown","e3f55719":"markdown","c374b3c2":"markdown","87151609":"markdown","5ee9b6a9":"markdown","36695585":"markdown","6438744e":"markdown","921f1021":"markdown"},"source":{"71013a63":"import pandas as pd\nimport matplotlib.pyplot as plt\nimport matplotlib\nimport numpy as np\n\nplt.rcParams[\"figure.figsize\"] = (12,8)\nmatplotlib.style.use('ggplot')\nmatplotlib.rcParams.update({'font.size': 12})","467a7d25":"df=pd.read_csv('..\/input\/sanfranciso-crime-dataset\/Police_Department_Incidents_-_Previous_Year__2016_.csv')\ndf","e9049891":"# These values are in 'Location' column\ndel df['X']\ndel df['Y']","d532d455":"df.duplicated().sum()","914dc28c":"df.isnull().sum()","0b2f5e5b":"df['PdDistrict'] = df['PdDistrict'].fillna('_MISSING_')","55115fa6":"df[df['IncidntNum']==120058272]","2e7a656d":"print(\"Number of incidents, excluding combined: \", len(df['IncidntNum'].drop_duplicates(keep='first')))\nprint(\"Start date: {}, end date: {}\".format(df.Date.min(), df.Date.max()))","c86d3db4":"df.Category.value_counts()","c5a27f04":"def hbar(data, textdist, p=None):\n    \"\"\"\n    Horizontal bar.\n    \n    Parameters:\n    p: percent if p=1 else num\n    \"\"\"\n    ax = data.plot.barh(color='r')\n    \n    xmin, xmax = plt.xlim()\n    plt.xlim(xmin, xmax + 0.05 * (xmax - xmin))\n\n    totals=[]\n    for i in ax.patches:\n        totals.append(i.get_width())\n\n    total = sum(totals)\n\n    # top 15\n    for i in ax.patches[-15:]:\n        if p == 1:\n            ax.text(i.get_width()+textdist, i.get_y(), str(round((i.get_width()\/total)*100, 2))+'%', color='black')\n        else:\n            ax.text(i.get_width()+textdist, i.get_y(), str(int(i.get_width())), color='black')\n                    ","0ee99b19":"hbar(df.Category.value_counts()[::-1], 400, p=1)","a5dd7100":"def bbar(data, textdist, col, p=None):\n\n    ax=data.plot.bar(color=col)\n    \n    ymin, ymax = plt.ylim()\n    plt.ylim(ymin, ymax + 0.05 * (ymax - ymin))\n\n    \n    totals=[]\n    for i in ax.patches:\n        totals.append(i.get_height())\n\n    total = sum(totals)\n    \n    for i in ax.patches:\n        if p==1:\n            ax.text(i.get_x(), i.get_height()+textdist, str(round((i.get_height()\/total)*100, 2))+'%', fontsize=12, color='black')\n        else:\n            ax.text(i.get_x(), i.get_height()+textdist, str(int(i.get_height())), fontsize=12, color='black')","bd4b4b2a":"bbar(df['DayOfWeek'].value_counts(), 400, col = 'lightskyblue', p=1)","31cfd234":"df.Time.value_counts().head(10)","0a97d9aa":"# Time values are strings, we need an hour here:\nprint( df.Time[0], ' -> ', df.Time[0].split(':')[0])","61b20bb9":"def daytime(x):\n    x = x.split(':')[0]\n    \n    if x in ['04', '05', '06', '07']:\n        x = 'Early Morning'\n        \n    elif x in ['08', '09', '10', '11']: \n        x = 'Morning'\n        \n    elif x in ['12', '13', '14', '15', '16']: \n        x = 'Afternoon'\n    \n    elif x in ['17', '18']:\n        x = 'Early Evening'\n    \n    elif x in ['19', '20', '21', '22']: \n        x = 'Evening'\n        \n    elif x in ['23', '00', '01', '02', '03']: \n        x = 'Night'\n    \n    return x","8b617496":"df['Time'] = df['Time'].apply(daytime)","60609b0f":"bbar(df.Time.value_counts(), 400, 'lightskyblue', p=1)","9f4ba7c5":"hbar(df.groupby('Time').get_group('Afternoon')['Category'].value_counts()[::-1], 100)","6ac17c4a":"hbar(df.groupby('Time').get_group('Evening')['Category'].value_counts()[::-1], 100)","db12661c":"hbar(df.groupby('Time').get_group('Night')['Category'].value_counts()[::-1], 100)","7a68873f":"g = df.groupby('DayOfWeek')['Time'].value_counts().unstack(fill_value=0)\ng = g.reindex(index=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],\n             columns=['Early Morning', 'Morning', 'Afternoon','Early Evening','Evening','Night'])\n\nx = np.arange(len(g.columns))\ny = np.arange(len(g.index))\nX, Y = np.meshgrid(x, y)\n\nfig, ax = plt.subplots()\ncs = ax.contourf(X, Y, g.values, cmap='viridis')\nplt.colorbar(cs)\n\nax.set_xticks(x) \nax.set_yticks(y)  \n\nax.set_xticklabels(g.columns.values)  \nax.set_yticklabels(g.index.values)  #\nplt.xticks(rotation=90)\n\nplt.show()","40e94c65":"w=df.groupby('Date').count()\nw[w['IncidntNum']==w['IncidntNum'].max()]","6e80080a":"w[w['IncidntNum']==w['IncidntNum'].min()]","bec5c815":"bbar(df.PdDistrict.value_counts()[:-1], 400, col='indigo', p=1) # plot without \"_missing_\"","3c25c54a":"hbar(df.groupby('PdDistrict').get_group('SOUTHERN')['Category'].value_counts()[::-1], 200)","bf4131aa":"bbar(df.groupby('PdDistrict').get_group('SOUTHERN')['Time'].value_counts(), 200, col='indigo')","e986fe7a":"df.groupby('Category')['PdDistrict'].value_counts().unstack(fill_value=0).head()","47a9b0c8":"dists={}\nfor i in range(0,len(df.groupby('Category')['PdDistrict'].value_counts().unstack(fill_value=0).columns)):\n    dists[i] = df.groupby('Category')['PdDistrict'].value_counts().unstack(fill_value=0).columns[i]\n\n    \ncatdist={}\nfor i in df.Category.unique():\n    catdist[i] = dists[df.groupby('Category')['PdDistrict'].value_counts().unstack(fill_value=0).loc[i].argmax()]\n    \ncatdist","a1a480c5":"import plotly.express as px\n\nfig = px.sunburst(df.groupby(['Category', 'PdDistrict'])['IncidntNum'].count().reset_index(),\n    path = ['Category', 'PdDistrict'],\n    values = 'IncidntNum',\n    height = 700,\n)\nfig.show()","a22d055c":"# Where","1f896095":"**The worst day of week:**","acf9f7a8":"In most cases, the largest number of crimes occurs in the ```Southern``` district. But some types of crime occur more often in other districts: ```arsons``` and ```vehicle thefts``` are more common in ```Bayview``` dist.","570ef83b":"The ```southern``` district has the highest number of incidents.","19577a90":"**Max\/min day**","5d309997":"**Category and its \"favourite\" (or one of them) dist.**","f32d299f":"**Most dangerous districts:**","895ad304":"# What","db70896e":"Perhaps, this is due to the fact that people are more likely to use public transport during the day where larcency and thefts often occur. Shoplifting can also be included into this category.","4d2a1c59":"**Incident types:**","794d9313":"Night is a favorite time of ```burglars```.\n\nAll in all, ```12pm-11pm``` is the time with the most crimes. The results also depend on how the times of day are defined.","e3f55719":"First two rows have the same incident number, but different descriptions.\nTake a look at this incident:","c374b3c2":"# When","87151609":"**Parts of the Day:**\n\n- Morning     4 am to 12 pm (noon)\n\nEarly morning    4 to 7 am\nLate morning     11 am to 12pm\n \n\n- Afternoon     12 pm to 5 pm\n\nEarly afternoon   1 to 3pm\nLate afternoon    4 to 5pm\n \n\n- Evening     5 pm to 11 pm\n\nEarly evening   5 to 7 pm\n\n- Night         11 pm to 4 am","5ee9b6a9":"**Most crimes were committed on January 1, December 25 has the least amount of crimes.**","36695585":"Percentage of ```vehicle thefts``` has significantly increased compared to the afternoon.","6438744e":"**Day of week and daytime:**","921f1021":"```12pm - 5pm``` is the most dangerous time? Let's check the types of crime in this daytime."}}