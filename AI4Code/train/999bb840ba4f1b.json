{"cell_type":{"58df9e0b":"code","bf61f936":"code","75a13712":"code","203c1fa1":"code","46959564":"code","1b85f972":"code","d12910be":"code","cb9ccc4e":"code","d114ce25":"code","71dd6925":"code","f405dff2":"code","19d9deeb":"code","c74a07a6":"code","7d892087":"code","9f65bf72":"code","23b04315":"code","bc4cdca8":"code","fcdc3e0d":"code","c6065b4c":"code","6d936d07":"code","14227ba6":"code","1ffc697f":"code","138905bf":"code","6a18a94e":"code","a7d76304":"code","5cc5c841":"code","6df361b6":"code","2bc06983":"code","d00d3081":"code","8db0adc5":"code","176d0cc6":"code","8a2b316e":"code","c0cb6009":"code","4f169cd5":"code","6e5ab174":"code","bb3c42be":"code","64df0cc7":"code","2e585f40":"markdown","39037582":"markdown"},"source":{"58df9e0b":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","bf61f936":"import pandas as pd","75a13712":"path_in = '\/kaggle\/input\/customer-segmentation-tutorial-in-python\/'\nos.listdir(path_in)","203c1fa1":"mall_data = pd.read_csv(path_in+'Mall_Customers.csv')","46959564":"mall_data.head()","1b85f972":"#Data Exploration\nmall_data.describe()","d12910be":"#Checking for Null Values\nmall_data.isnull().sum()","cb9ccc4e":"#Since No null values, no need to deal with missing Values\n\n#Cheking for Outliers\n\n","d114ce25":"#Method1 :  Using Box Plot\n#As you know box plot will plot the points and hence cannot be used for categorical\nimport seaborn as sns\nsns.boxplot(x = mall_data['Annual Income (k$)'])\n#Only one outlier point at 140K","71dd6925":"sns.boxplot(x = mall_data['Age'])\n","f405dff2":"sns.boxplot(x = mall_data['Spending Score (1-100)'])","19d9deeb":"#Method 2\n#Using the Z Score. If the Z score is greater than 3 or less than -3 then we consider something as an outlier\n\n","c74a07a6":"mall_data.dtypes","7d892087":"#Getting only the numeric data \nmall_data1 = mall_data._get_numeric_data()\nmall_data2 = mall_data.select_dtypes(include=['float64'])","9f65bf72":"from scipy import stats\nimport numpy as np\nz = np.abs(stats.zscore(mall_data1))\n#print(z)\n\nthreshold = 3\nprint(np.where(z > 3))\n\n#No variables which have outliers","23b04315":"#Method 3 Interquartile Range\n#IQR is difference between 75th and 25th percentiles, which is the upper and lower quartiles, Q3-Q1\nQ1 = mall_data1.quantile(0.25)\nQ3 = mall_data1.quantile(0.75)\nIQR = Q3 - Q1\nprint(IQR)","bc4cdca8":"print((mall_data1 < (Q1 - 1.5*IQR)) | (mall_data1 > (Q3 + 1.5*IQR)))","fcdc3e0d":"#Treating the outliers found via IQR\n\nmall_data1_out = mall_data1[~((mall_data1 < (Q1 - 1.5 * IQR)) |(mall_data1 > (Q3 + 1.5 * IQR))).any(axis=1)]\n","c6065b4c":"#result = pd.merge(mall_data1_out, mall_data['CustomerID','Gender'], on=\"CustomerID\", how = \"left\")","6d936d07":"#Data Visualisations\n\n#Distorted Plot\n\nimport matplotlib.pyplot as plt \nimport plotly as py\nimport plotly.graph_objs as go\n\n\n\nplt.figure(1 , figsize = (15 , 6))\nn = 0 \nfor x in ['Age' , 'Annual Income (k$)' , 'Spending Score (1-100)']:\n    n += 1\n    plt.subplot(1 , 3 , n)\n    plt.subplots_adjust(hspace =0.5 , wspace = 0.5)\n    sns.distplot(mall_data1_out[x] , bins = 20)\n    plt.title('Distplot of {}'.format(x))\nplt.show()","14227ba6":"#Categorical Variable Gender's Plot\n\n\nplt.figure(1 , figsize = (15 , 5))\nsns.countplot(y = 'Gender' , data = mall_data)\nplt.show()","1ffc697f":"#Plotting relationship between Ages, Annual Income and Spendign Score\n\n\nplt.figure(1 , figsize = (15 , 7))\nn = 0 \nfor x in ['Age' , 'Annual Income (k$)' , 'Spending Score (1-100)']:\n    for y in ['Age' , 'Annual Income (k$)' , 'Spending Score (1-100)']:\n        n += 1\n        plt.subplot(3 , 3 , n)\n        plt.subplots_adjust(hspace = 0.5 , wspace = 0.5)\n        sns.regplot(x = x , y = y , data = mall_data1_out)\n        plt.ylabel(y.split()[0]+' '+y.split()[1] if len(y.split()) > 1 else y )\nplt.show()","138905bf":"#Age Vs Income relationship Scatter Plot wrt to Gender\n\nplt.figure(1 , figsize = (15 , 6))\nfor gender in ['Male' , 'Female']:\n    plt.scatter(x = 'Age' , y = 'Annual Income (k$)' , data = mall_data[mall_data['Gender'] == gender] ,\n                s = 200 , alpha = 0.5 , label = gender)\nplt.xlabel('Age'), plt.ylabel('Annual Income (k$)') \nplt.title('Age vs Annual Income w.r.t Gender')\nplt.legend()\nplt.show()","6a18a94e":"plt.figure(1 , figsize = (15 , 6))\nfor gender in ['Male' , 'Female']:\n    plt.scatter(x = 'Annual Income (k$)',y = 'Spending Score (1-100)' ,\n                data = mall_data[mall_data['Gender'] == gender] ,s = 200 , alpha = 0.5 , label = gender)\nplt.xlabel('Annual Income (k$)'), plt.ylabel('Spending Score (1-100)') \nplt.title('Annual Income vs Spending Score w.r.t Gender')\nplt.legend()\nplt.show()","a7d76304":"#Distribution of Age, Income according to Spending score\n\nplt.figure(1 , figsize = (15 , 7))\nn = 0 \nfor cols in ['Age' , 'Annual Income (k$)' , 'Spending Score (1-100)']:\n    n += 1 \n    plt.subplot(1 , 3 , n)\n    plt.subplots_adjust(hspace = 0.5 , wspace = 0.5)\n    sns.violinplot(x = cols , y = 'Gender' , data = mall_data , palette = 'vlag')\n    sns.swarmplot(x = cols , y = 'Gender' , data = mall_data)\n    plt.ylabel('Gender' if n == 1 else '')\n    plt.title('Boxplots & Swarmplots' if n == 2 else '')\nplt.show()","5cc5c841":"'''Age and spending Score'''\nfrom sklearn.cluster import KMeans\nX1 = mall_data[['Age' , 'Spending Score (1-100)']].iloc[: , :].values\nX1","6df361b6":"inertia = []\nfor n in range(1 , 11):\n    algorithm = (KMeans(n_clusters = n ,init='k-means++', n_init = 10 ,max_iter=300, \n                        tol=0.0001,  random_state= 111  , algorithm='elkan') )\n    algorithm.fit(X1)\n    inertia.append(algorithm.inertia_)","2bc06983":"#Getting the Inertia for each of the clusters in a plot\n\nplt.figure(1 , figsize = (15 ,6))\nplt.plot(np.arange(1 , 11) , inertia , 'o')\nplt.plot(np.arange(1 , 11) , inertia , '-' , alpha = 0.5)\nplt.xlabel('Number of Clusters') , plt.ylabel('Inertia')\nplt.show()","d00d3081":"#Doint it for only one set of clusyters to check\nalgorithm = (KMeans(n_clusters = 4 ,init='k-means++', n_init = 10 ,max_iter=300, \n                        tol=0.0001,  random_state= 111  , algorithm='elkan') )\nalgorithm.fit(X1)\nlabels1 = algorithm.labels_ #Tells which element belongs to which cluster\ncentroids1 = algorithm.cluster_centers_\n","8db0adc5":"\nh = 0.02\nx_min, x_max = X1[:, 0].min() - 1, X1[:, 0].max() + 1\ny_min, y_max = X1[:, 1].min() - 1, X1[:, 1].max() + 1\nxx, yy = np.meshgrid(np.arange(x_min, x_max, h), np.arange(y_min, y_max, h))\nZ = algorithm.predict(np.c_[xx.ravel(), yy.ravel()]) ","176d0cc6":"#Plotting the custers(Not here we are still just doing correlation or clusters based on Age and Spending scores)\nplt.figure(1 , figsize = (15 , 7) )\nplt.clf()\nZ = Z.reshape(xx.shape)\nplt.imshow(Z , interpolation='nearest', \n           extent=(xx.min(), xx.max(), yy.min(), yy.max()),\n           cmap = plt.cm.Pastel2, aspect = 'auto', origin='lower')\n\nplt.scatter( x = 'Age' ,y = 'Spending Score (1-100)' , data = mall_data , c = labels1 , \n            s = 200 )\nplt.scatter(x = centroids1[: , 0] , y =  centroids1[: , 1] , s = 300 , c = 'red' , alpha = 0.5)\nplt.ylabel('Spending Score (1-100)') , plt.xlabel('Age')\nplt.show()","8a2b316e":"X2 = mall_data[['Annual Income (k$)' , 'Spending Score (1-100)']].iloc[: , :].values\ninertia = []\nfor n in range(1 , 11):\n    algorithm = (KMeans(n_clusters = n ,init='k-means++', n_init = 10 ,max_iter=300, \n                        tol=0.0001,  random_state= 111  , algorithm='elkan') )\n    algorithm.fit(X2)\n    inertia.append(algorithm.inertia_)","c0cb6009":"plt.figure(1 , figsize = (15 ,6))\nplt.plot(np.arange(1 , 11) , inertia , 'o')\nplt.plot(np.arange(1 , 11) , inertia , '-' , alpha = 0.5)\nplt.xlabel('Number of Clusters') , plt.ylabel('Inertia')\nplt.show()\n\n","4f169cd5":"algorithm = (KMeans(n_clusters = 5 ,init='k-means++', n_init = 10 ,max_iter=300, \n                        tol=0.0001,  random_state= 111  , algorithm='elkan') )\nalgorithm.fit(X2)\nlabels2 = algorithm.labels_\ncentroids2 = algorithm.cluster_centers_","6e5ab174":"h = 0.02\nx_min, x_max = X2[:, 0].min() - 1, X2[:, 0].max() + 1\ny_min, y_max = X2[:, 1].min() - 1, X2[:, 1].max() + 1\nxx, yy = np.meshgrid(np.arange(x_min, x_max, h), np.arange(y_min, y_max, h))\nZ2 = algorithm.predict(np.c_[xx.ravel(), yy.ravel()]) ","bb3c42be":"plt.figure(1 , figsize = (15 , 7) )\nplt.clf()\nZ2 = Z2.reshape(xx.shape)\nplt.imshow(Z2 , interpolation='nearest', \n           extent=(xx.min(), xx.max(), yy.min(), yy.max()),\n           cmap = plt.cm.Pastel2, aspect = 'auto', origin='lower')\n\nplt.scatter( x = 'Annual Income (k$)' ,y = 'Spending Score (1-100)' , data = mall_data , c = labels2 , \n            s = 200 )\nplt.scatter(x = centroids2[: , 0] , y =  centroids2[: , 1] , s = 300 , c = 'red' , alpha = 0.5)\nplt.ylabel('Spending Score (1-100)') , plt.xlabel('Annual Income (k$)')\nplt.show()","64df0cc7":"#for Visualtization purpose only here we used 2 variables, when we run the\n#final code use all varibales and it has all these variables on all Axes and \n#then plot the points, those clusters the formed are the cluster of the data set\n\n#pick the cluster with leaset inertia, which is distnace between points and its centroid. This kind of clustering can be used\n#for customer segregation based on their age,spending patterns and annual income","2e585f40":"Segmentation using Annual Income and Spending Score\n","39037582":"plt.figure(1 , figsize = (15 ,6))\nplt.plot(np.arange(1 , 11) , inertia , 'o')\nplt.plot(np.arange(1 , 11) , inertia , '-' , alpha = 0.5)\nplt.xlabel('Number of Clusters') , plt.ylabel('Inertia')\nplt.show()"}}