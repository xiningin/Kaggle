{"cell_type":{"32817597":"code","0b8d9130":"code","20a39d3d":"code","1228f7bb":"code","bb95ffcc":"code","22004d96":"code","d3357f5a":"code","2384c2f9":"code","67a04cf0":"markdown","29d67403":"markdown"},"source":{"32817597":"import datetime\nimport math\nimport warnings\n\nimport pandas as pd\nimport numpy as np\n\nimport matplotlib.pyplot as plt\n\nfrom matplotlib.lines import Line2D\n\nfrom IPython.core.display import display, HTML\n\n%matplotlib inline\n\nwarnings.filterwarnings('ignore')","0b8d9130":"df = pd.read_csv('\/kaggle\/input\/sp-beaches-water-quality\/sp_beaches.csv', parse_dates=['Date'])","20a39d3d":"def closest_sunday(date):\n    weekday = date.weekday()\n\n    if weekday < 3:\n        return date - datetime.timedelta(days=weekday + 1)\n    elif weekday < 6:\n        return date + datetime.timedelta(days=6 - weekday)\n    else: return date","1228f7bb":"df['date_sunday'] = df['Date'].apply(lambda x: closest_sunday(x))","bb95ffcc":"# Create an array with all sundays in the period\nfirst = min(df['date_sunday'])\nlast = max(df['date_sunday'])\n\nsundays = pd.date_range(start=first, end=last, freq='w')","22004d96":"cities = np.unique(df['City'])","d3357f5a":"for city in cities:\n    for beach in np.unique(df[df['City'] == city]['Beach']):\n\n        missing_dates = list(set(sundays) - set(df[(df['City'] == city) & (df['Beach'] == beach)]['date_sunday']))\n\n        df_missing = pd.DataFrame({'City': city, 'Beach': beach, 'Date': np.nan, \n                  'Enterococcus': None, 'date_sunday': missing_dates})\n        \n        df = pd.concat([df, df_missing], ignore_index=True)","2384c2f9":"text_color = 'dimgrey'\nplot_color = 'slategrey'\naxis_color = 'lightgrey'\n\nfor city in cities:\n    \n    display(HTML(f'<H3>{city}<\/H3>'))\n    \n    beaches = np.unique(df[df['City'] == city]['Beach'])\n    \n    rows, cols = (len(beaches) + 2) \/\/ 3, 3\n    fig, ax = plt.subplots(rows, cols, figsize=(14, rows * 2 + (rows - 1) * 0.4), sharex=True, \n                           sharey=True, squeeze=False)\n\n    fig.subplots_adjust(top=0.99, left=0.05, bottom=0.1, hspace=0.3, wspace=0.2)\n    \n    fig.text(0, 1, 'Enterococcus (CFU\/100ml)', rotation=90, color=text_color, size=9, va='top')\n\n    for r in range(rows):\n        for c in range(cols):\n        \n            i = r * cols + c\n            \n            if i < len(beaches):\n\n                beach = beaches[i]\n\n                df_beach = df[(df['Beach'] == beach) & (df['City'] == city)].sort_values(['date_sunday'])\n                \n                ax[r][c].plot(df_beach['date_sunday'], df_beach['Enterococcus'],\n                             color=plot_color)\n                \n                ax[r][c].scatter(df_beach['date_sunday'], df_beach['Enterococcus'],\n                             color=plot_color, marker='.', s=2)\n                                  \n                ax[r][c].set_title(beach, fontsize=9, color=text_color)\n                \n                ax[r][c].spines['top'].set_visible(False)\n                ax[r][c].spines['right'].set_visible(False)\n                ax[r][c].spines['left'].set_visible(False)\n                ax[r][c].spines['bottom'].set_color(axis_color)\n\n                ax[r][c].set_xlim(datetime.date(2012, 1, 1), datetime.date(2021, 1, 1))\n                ax[r][c].set_ylim(0, 1000)\n\n                ax[r][c].tick_params(bottom=False, left=False, labelcolor=text_color)\n\n                ax[r][c].set_xticks(pd.date_range(start='2012-01-01', end='2021-01-01', freq='2AS'))\n                ax[r][c].set_xticklabels(np.arange(2012, 2022, 2), ha='left')\n\n            else:\n                for s in ax[r][c].spines.keys():\n                    ax[r][c].spines[s].set_visible(False)\n\n                ax[r][c].xaxis.set_visible(False)\n                ax[r][c].yaxis.set_visible(False)\n\n    plt.show()\n\n    ","67a04cf0":"# S\u00e3o Paulo Water Quality Charts by Beach \/ Collection Point\n\nCharts of the measures of Enterococcus of every beach\/collection point over time","29d67403":"*_scatter plot where there is missing or not continuous data._"}}