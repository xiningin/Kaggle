{"cell_type":{"925bb8a1":"code","2bfae40c":"code","2c7524d7":"code","fd9ac2f5":"code","5208cd0f":"code","2fdeaca9":"code","f48c07ee":"code","44bdb12e":"code","0ac6ad82":"code","c3309005":"code","d9e46b72":"code","678c818e":"code","312b0662":"code","8c3a9007":"code","6722431a":"code","f6d58940":"code","732b3c07":"code","0d6420ff":"code","2cae2ee0":"code","217579b7":"code","e948ac4c":"code","39d5ce9e":"code","b19ded69":"code","13ad6c8e":"code","4dc18b1c":"code","723f454c":"markdown","6891d9aa":"markdown","cf12d354":"markdown","f460fdb1":"markdown","b24e49bb":"markdown","f4b44acf":"markdown","7234ad5e":"markdown","2db5a477":"markdown","37d52e48":"markdown","9d0e9b61":"markdown","a30c5b1d":"markdown","42b57ce9":"markdown","7a5c2c61":"markdown","937d41af":"markdown","9ece6ec7":"markdown","1403715f":"markdown","4e88c39c":"markdown","4d22dcdd":"markdown","1873d5a4":"markdown"},"source":{"925bb8a1":"import os\nimport numpy as np\nimport pandas as pd\n\nimport matplotlib.pyplot as plt\n\nfrom tensorflow import keras\nfrom keras.preprocessing.image import ImageDataGenerator as Imgen\n\nfrom keras.models import Sequential,load_model\nfrom keras.layers import Conv2D,MaxPooling2D,Flatten,Dense,GlobalAveragePooling2D,Dropout\n\nfrom keras.preprocessing import image\n\nimport cv2\n\nimport pickle","2bfae40c":"labels = pd.read_csv(\"..\/input\/dog-breed-identification\/labels.csv\")\nsample = pd.read_csv('..\/input\/dog-breed-identification\/sample_submission.csv')\nlabels.head()","2c7524d7":"def app_jpg(id):\n    return id+\".jpg\"","fd9ac2f5":"labels['id'] = labels['id'].apply(app_jpg)\nsample['id'] = sample['id'].apply(app_jpg)","5208cd0f":"datagen = Imgen(preprocessing_function=keras.applications.nasnet.preprocess_input,\n                  shear_range=0.2,\n                  zoom_range=0.2,\n                  horizontal_flip=True,\n                  validation_split=0.1\n                 )","2fdeaca9":"train_ds = datagen.flow_from_dataframe(\n    labels,\n    directory = '..\/input\/dog-breed-identification\/train', \n    x_col = 'id',\n    y_col = 'breed',\n    subset=\"training\",\n    color_mode=\"rgb\",\n    target_size = (331,331),\n    class_mode=\"categorical\",\n    batch_size=32,\n    shuffle=True,\n    seed=123,\n)\n\n\nval_ds = datagen.flow_from_dataframe(\n    labels,\n    directory = '..\/input\/dog-breed-identification\/train',\n    x_col = 'id',\n    y_col = 'breed',\n    subset=\"validation\",\n    color_mode=\"rgb\",\n    target_size = (331,331),\n    class_mode=\"categorical\",\n    batch_size=32,\n    shuffle=True,\n    seed=123,\n)","f48c07ee":"a = train_ds.class_indices\nclass_names = list(a.keys())\nclass_names[:10]","44bdb12e":"x,y = next(train_ds)\nx.shape","0ac6ad82":"def plot_images(img,labels):\n    plt.figure(figsize=[15,10])\n    for i in range(25):\n        plt.subplot(5,5,i+1)\n        plt.imshow(img[i])\n        plt.title(class_names[np.argmax(labels[i])])\n        plt.axis('off')","c3309005":"plot_images(x,y)","d9e46b72":"from keras.applications.nasnet import NASNetLarge\nfrom keras.applications.inception_resnet_v2 import InceptionResNetV2","678c818e":"base_model = InceptionResNetV2(include_top=False,\n                     weights='imagenet',\n                     input_shape=(331,331,3)\n                     )\nbase_model.trainable = False","312b0662":"model = Sequential([\n    base_model,\n    \n    GlobalAveragePooling2D(),\n    \n    Dense(256,activation = 'relu'),\n    Dropout(0.5),\n    \n    Dense(120,activation='softmax')\n])\nmodel.summary()","8c3a9007":"model.compile(optimizer='adam',loss='categorical_crossentropy',metrics=['accuracy'])","6722431a":"my_calls = [keras.callbacks.EarlyStopping(monitor='val_accuracy',patience=2),\n            keras.callbacks.ModelCheckpoint(\"Model.h5\",verbose=1,save_best_only=True)]","f6d58940":"hist = model.fit(train_ds,epochs=25,validation_data=val_ds,callbacks=my_calls)","732b3c07":"plt.figure(figsize=(15,6))\n\nplt.subplot(1,2,1)\nplt.plot(hist.epoch,hist.history['accuracy'],label = 'Training')\nplt.plot(hist.epoch,hist.history['val_accuracy'],label = 'validation')\n\nplt.title(\"Accuracy\")\nplt.legend()\n\nplt.subplot(1,2,2)\nplt.plot(hist.epoch,hist.history['loss'],label = 'Training')\nplt.plot(hist.epoch,hist.history['val_loss'],label = 'validation')\n\nplt.title(\"Loss\")\nplt.legend()\nplt.show()\n","0d6420ff":"model = load_model(\".\/Model.h5\")","2cae2ee0":"testgen = Imgen(preprocessing_function=keras.applications.inception_resnet_v2.preprocess_input)","217579b7":"test_ds = testgen.flow_from_dataframe(\n    sample,\n    directory = '..\/input\/dog-breed-identification\/test',\n    x_col = 'id',\n    y_col = None,\n    target_size = (331,331),\n    class_mode= None,\n    batch_size=32,\n    shuffle=False\n)","e948ac4c":"predictions = model.predict(test_ds,verbose=1)","39d5ce9e":"pred  = [np.argmax(i) for i in predictions]","b19ded69":"X = next(test_ds)\nX.shape","13ad6c8e":"def check_images(img):\n    plt.figure(figsize=[25,10])\n    for i in range(25):\n        plt.subplot(5,5,i+1)\n        plt.imshow(img[i])\n        plt.title(class_names[pred[i]])\n        plt.axis('off')","4dc18b1c":"check_images(X)","723f454c":"**Data Generator**","6891d9aa":"### Importing Necessary Libraries","cf12d354":"### Train","f460fdb1":"**Getting class names**","b24e49bb":"- To get the most probable result","f4b44acf":"**Plotting the losses and acuuracies**","7234ad5e":"**Genrating test dataset**","2db5a477":"**Defining callbacks to preserve the best results**","37d52e48":"**Visualizing images against predictions**","9d0e9b61":"**Getting one batch of data to visualize**","a30c5b1d":"**Reading the data and adding the extension to it.**","42b57ce9":"**Making Predictions**","7a5c2c61":"**Loading saved model**","937d41af":"## Prediction","9ece6ec7":"**Getting a Pre-Trained Model**","1403715f":"**Defining our Model**","4e88c39c":"## Model","4d22dcdd":"\n# Dog's Breed Identification\n\n![Dogs](https:\/\/s.wsj.net\/public\/resources\/images\/B3-EU419_201908_GR_20190822110317.jpg)\n\n* Generate dataset\n* Build a model\n* Predict","1873d5a4":"**Function to plot images**"}}