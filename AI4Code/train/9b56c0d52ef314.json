{"cell_type":{"9c846578":"code","447b4d55":"code","e188851a":"code","64abcbc6":"code","1f8eefc9":"code","edec07c5":"code","805e2b26":"code","ee633465":"code","98531668":"code","186a0c25":"code","a4c5862c":"code","3b6dbdf4":"code","122d2431":"code","91f3544f":"code","cb805cd3":"code","6e2ff422":"code","d323c694":"code","28c67cad":"code","b037c305":"code","8562246e":"code","768fe7ef":"code","9f2ea3ed":"code","2e26205d":"code","f75e07ab":"markdown","28b2071c":"markdown","b0534f75":"markdown","ae39f5cd":"markdown","8b69d381":"markdown","06c9231d":"markdown","54c68cba":"markdown","4a6439aa":"markdown","405b41ba":"markdown","0a9a8a58":"markdown","d9e1dcff":"markdown","30cfcdd1":"markdown","5a877d2a":"markdown","2ba8bbdb":"markdown","6f479473":"markdown","062142d3":"markdown","f38f524a":"markdown","be41288f":"markdown","c1af750a":"markdown","dc891755":"markdown","158bbcd4":"markdown","d930f646":"markdown","8de0f2a9":"markdown","11a482ea":"markdown"},"source":{"9c846578":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nfrom xgboost import XGBRegressor\nfrom sklearn.experimental import enable_iterative_imputer \nfrom sklearn.impute import IterativeImputer\nfrom sklearn.preprocessing import MinMaxScaler, LabelEncoder\nimport shap\nimport seaborn as sb\nfrom matplotlib import pyplot as plt\nimport warnings\n\nwarnings.filterwarnings('ignore')\npd.set_option('max_columns', None)\npd.set_option('max_rows', None)\npd.set_option('display.width', 1000)\nnp.random.seed(23)\n\ntrain_df = pd.read_csv('\/kaggle\/input\/house-prices-advanced-regression-techniques\/train.csv')\n\ntrain_df.drop(columns = ['PoolQC', 'MiscFeature', 'Alley', 'Fence'], inplace = True)\n\ncol_types = train_df.columns.to_series().groupby(train_df.dtypes)\ncategorical_columns = []\nnumeric_columns = []\n       \nfor col in col_types:\n    if col[0] == 'object':\n        categorical_columns = col[1].unique().tolist()\n    else:\n        numeric_columns += col[1].unique().tolist()\n\n\nnumeric_columns.remove('Id')\nnumeric_columns.remove('SalePrice')\n\nall_columns = numeric_columns + categorical_columns\n\nfor name in categorical_columns:\n    encoder = LabelEncoder()\n    train_df.loc[train_df[name].isna() == False, name] = encoder.fit_transform(train_df.loc[train_df[name].isna() == False, name])\n    \nimpute = IterativeImputer(random_state = 0)\ntrain_df[all_columns] = impute.fit_transform(train_df[all_columns])\n\n\nshap.initjs()","447b4d55":"model = XGBRegressor()\nmodel.fit(train_df[all_columns], train_df['SalePrice'])\nscore = model.score(train_df[all_columns], train_df['SalePrice'])\nexplainer = shap.TreeExplainer(model)\nprint(\"XGBRegresser Score: %0.4f\" % score)","e188851a":"shap_values = explainer.shap_values(train_df[all_columns], \n                train_df['SalePrice'], approximate=True)\n\nshap.summary_plot(shap_values, train_df[all_columns], plot_type = 'bar', \n                  feature_names = all_columns)","64abcbc6":"shap.summary_plot(shap_values, train_df[all_columns])","1f8eefc9":"shap.dependence_plot('OverallQual', shap_values, train_df[all_columns])","edec07c5":"shap.dependence_plot('GrLivArea', shap_values, train_df[all_columns])","805e2b26":"shap.dependence_plot('TotalBsmtSF', shap_values, train_df[all_columns])","ee633465":"shap.dependence_plot('GarageCars', shap_values, train_df[all_columns], interaction_index=\"GarageArea\")","98531668":"shap.dependence_plot('BsmtFinSF1', shap_values, train_df[all_columns], interaction_index=\"TotalBsmtSF\")","186a0c25":"shap.dependence_plot('LotArea', shap_values, train_df[all_columns], interaction_index=\"LotFrontage\")","a4c5862c":"shap.dependence_plot('1stFlrSF', shap_values, train_df[all_columns], interaction_index=\"GrLivArea\")","3b6dbdf4":"shap.dependence_plot('YearRemodAdd', shap_values, train_df[all_columns], interaction_index=\"OverallCond\")","122d2431":"samples = [0, 15, 100, 240, 500 ]","91f3544f":"train_df.loc[train_df['Id'] == 1, ['OverallQual', 'OverallCond', 'GrLivArea', 'LotArea', '1stFlrSF', 'GarageCars', 'GarageType', 'TotalBsmtSF','BsmtFinSF1', 'BsmtQual', 'YearBuilt', 'YearRemodAdd', 'KitchenQual', 'Fireplaces', 'Neighborhood', 'SalePrice']]","cb805cd3":"sample_df = train_df[all_columns].iloc[samples[0]]\n\nshap_value = explainer.shap_values(sample_df.values.reshape(1, -1))\n\nshap.force_plot(explainer.expected_value, shap_value, sample_df)","6e2ff422":"train_df.loc[train_df['Id'] == 16, ['OverallQual', 'OverallCond', 'GrLivArea', 'LotArea', '1stFlrSF', 'GarageCars', 'GarageType', 'TotalBsmtSF','BsmtFinSF1', 'BsmtQual', 'YearBuilt', 'YearRemodAdd', 'KitchenQual', 'Fireplaces', 'Neighborhood', 'SalePrice']]","d323c694":"sample_df = train_df[all_columns].iloc[samples[1]]\n\nshap_value = explainer.shap_values(sample_df.values.reshape(1, -1))\n\nshap.force_plot(explainer.expected_value, shap_value, sample_df)","28c67cad":"train_df.loc[train_df['Id'] == 101, ['OverallQual', 'OverallCond', 'GrLivArea', 'LotArea', '1stFlrSF', 'GarageCars', 'GarageType', 'TotalBsmtSF','BsmtFinSF1', 'BsmtQual', 'YearBuilt', 'YearRemodAdd', 'KitchenQual', 'Fireplaces', 'Neighborhood', 'SalePrice']]","b037c305":"sample_df = train_df[all_columns].iloc[samples[2]]\n\nshap_value = explainer.shap_values(sample_df.values.reshape(1, -1))\n\nshap.force_plot(explainer.expected_value, shap_value, sample_df)","8562246e":"train_df.loc[train_df['Id'] == 241, ['OverallQual', 'OverallCond', 'GrLivArea', 'LotArea', '1stFlrSF', 'GarageCars', 'GarageType', 'TotalBsmtSF','BsmtFinSF1', 'BsmtQual', 'YearBuilt', 'YearRemodAdd', 'KitchenQual', 'Fireplaces', 'Neighborhood', 'SalePrice']]","768fe7ef":"sample_df = train_df[all_columns].iloc[samples[3]]\n\nshap_value = explainer.shap_values(sample_df.values.reshape(1, -1))\n\nshap.force_plot(explainer.expected_value, shap_value, sample_df)","9f2ea3ed":"train_df.loc[train_df['Id'] == 501, ['OverallQual', 'OverallCond', 'GrLivArea', 'LotArea', '1stFlrSF', 'GarageCars', 'GarageType', 'TotalBsmtSF','BsmtFinSF1', 'BsmtQual', 'YearBuilt', 'YearRemodAdd', 'KitchenQual', 'Fireplaces', 'Neighborhood', 'SalePrice']]","2e26205d":"sample_df = train_df[all_columns].iloc[samples[4]]\n\nshap_value = explainer.shap_values(sample_df.values.reshape(1, -1))\n\nshap.force_plot(explainer.expected_value, shap_value, sample_df)","f75e07ab":"Both BsmtFinSF1 and TotalBsmtSF are of course positively collerated. Houses with no BsmtFinSF1 definitely pushes down the prices regardless of the TotalBsmtSF. As houses with larger BsmtFinSF1 it also have larger TotalBsmtSF and the prices natureally increase.","28b2071c":"Both TotalBsmtSF and OverallQual enjoy positive correlation. Larger basements are often able to demand higher house prices. Low overall qualties do have negative impact, but the downward affect decreases as the size of basements increases.\n\n1. People don't like small basements(< 1000sqf) as shown in the above diagram. Small basements do have negative prices impact.\n2. Houses without basement definitely has negative impact to the house price regardless of overall quality.","b0534f75":"The fourth sample is the best by far. It is a very new house with exceptional qualities. It has a decently size basement. All these positive factors surely drives up the sale price significantly. Although this new house is modestly maintained, it is not nearly enough to overcome the upward price pressure. ","ae39f5cd":"# Summary\n1. OverallQual, GrLivArea and TotalBsmtSF consistently play an important role of the contribution of the regression results. \n2. Houses with OverallQual of 7+ and with more than 1100 sqf of 1stFlrSF tends to have more positive prices momentum.  \n3. Houses with two cars garage is a must. Any less would suffer a downward price pressure. Houses with no garage suffer the worst.\n4. People don't like small basement (<1000 sqf). Any less would have a downward price pressure. Houses with no basement fair the worst.\n5. People don't like small general living area (<1500 sqf). Any less would put a downward pressure to the sale prices.\n6. People also don't like too big general living area (>3000 sqf). Any more would put a downward pressure to the sale prices.\n7. Houses that were built\/remodelled before 1980 tend to have downward price pressure regardless of the overall condition.\n","8b69d381":"## SHAP\nSHAP (SHapley Additive exPlanations) is a game theoretic approach to explain the output of any machine learning model. It connects optimal credit allocation with local explanations using the classic Shapley values from game theory and their related extensions. \n\nThe goal of SHAP is to explain the prediction of an instance x by computing the contribution of each feature to the prediction. The SHAP explanation method computes Shapley values from coalitional game theory. The feature values of a data instance act as players in a coalition. Shapley values tell us how to fairly distribute the \"payout\" (= the prediction) among the features.","06c9231d":"## Fifth Sample","54c68cba":"The third sample has a big general living area and a impressive large basement. It was built back in 1977 with average quality but it appear to be maintain very well over all these years. The big basement and with well maintenance really drive up the sale price.","4a6439aa":"Both LotArea and LotFrontage are again positive collerated. Houses with small LotArea pushes down the prices regardless of the LotFrontage. As both factors increase, so does the house prices. Houses with large LotFrontage but small LotArea fair the worst.","405b41ba":"# Single Sample Analysis","0a9a8a58":"Observations\n1. OverallQual is a categorical feature and it shows in the above diagram. High OverallQual values directly contribute to more expensive SalePrices while low OverallQual values not surprisingly has a negatively impact to SalePrices.\n2. GrLivArea is a continous feature and it have positive correlation with the SalePrice. Naturally bigger the general living area, more expensive the house is. Few samples that have the highest GrLivArea, their GrLivArea impact the house prices even more than their OverallQual.  \n3. Majority of the top features have positive correlation with the SalePrices. Higher values equate to higher prices while lower values equate to lower prices.\n4. There is a single sample with a very large area of BsmtFinSF1 but this feature has the exact opposite effect to the house price. This very large BsmtFinSF1 drags down the price substantially. It is possible this feature may have interacted with other features that causes the extreme downward of price. Further investigation is neccessary.\n5. There is one sample with low LotArea and another sample with high LotArea, but both samples lower the house prices. There are other features that interact with these two sample LotArea(s) that causes the lowering of the prices. Further investigation is neccessary.\n6. There are few samples with very high 2ndFlrSF that drastically strengthing the house prices but it is not a continous trend. These samples may have unfore-seen factors that contribute to the extreme price rises.\n7. There is a single sample with high BsmtUnfSF that negatively impacts the price. It is possible this feature may have interacted with other factors that causes this adverse affect.\n8. There is a single sample with high LogFrontage that negatively impacts the price. It is possible this feature may have interacted with other factors that causes this adverse affect.","d9e1dcff":"## First Sample","30cfcdd1":"The first sample indicates a new house but with above average quality. It has a fairly big living area and decent garage area. Although the small basement and average condition do have negative impacts but it is nowhere enough to overcome the upcoming price driving force.","5a877d2a":"Both GarageCars and GarageArea are of course positive collerated. People expect two cars garage is the standard and anything less would have serious negative price impacts. ","2ba8bbdb":"## Fourth Sample","6f479473":"## Third Sample","062142d3":"Expensive manions with top overall quality usually have large first floors. The above diagram shows both OverallQual and 1stFlrSF are positively correlated. We can easily see the correlation between higher OverallQual and 1stFlrSF contribute sigificantly to higher house prices, and of course lower OverallQual and low 1stFlrSF contribute sigificantly to lower house prices.\n\nThere is a clear dividing line between positive and negative momentum of prices.  \n1. OverallQual value 7 or above, and with 1stFlrSF value higher than 1100 sqf, always has progressive positive impact to the prices.\n2. OverallQual value 6 or below, and with 1stFlrSF value lower than 1100 sqf, always has progressive negative impact to the prices.","f38f524a":"OverallQual and GrLivArea by far the most powerful contributers\/influencers to the SalePrice regression. It followed by minor features TotalBsmtSF, GarageCars, BsmtFinSF1 and LotArea...so on. ","be41288f":"Not surpisingly old houses do not price as well as new building. Houses that were built\/remodelled before 1980 contribute to the downward prices pressure regardless of the overrall conditions. Houses with more recent YearRemodAdd or YearBuilt have more positive price momentum than old houses.","c1af750a":"There is no surpise that small GrLivArea equate to small 1stFlrSF. People generally don't welcome small living spaces and it shows in the diagram. ","dc891755":"# Data Analysis\n![](https:\/\/storage.googleapis.com\/kaggle-competitions\/kaggle\/5407\/media\/housesbanner.png)","158bbcd4":"The last sample is the worst among the five samples. This house has a decently size living area with average quality, but the small garage area and small basement does amplifies the downward price effect of the average quality.","d930f646":"People tend to enjoy large living spaces even if the qualities are not so good and it shows  in this diagram. As GrLivArea increases, the upward push to the house prices also increase despite of any low overall qualities. However samples with GrLivArea above 3000sqf not surprisingly have lesser impacts to the house prices regardless of the overall quality. It would be difficuly and expensive to manage a living area too large.","8de0f2a9":"The second sample is a very old house (built in 1929) but with a good quality & condition. It was also remodelled in 2001. But the house is too small (GrLivArea = 854) and it is the primary downard price driving force. ","11a482ea":"## Second Sample"}}