{"cell_type":{"804f6cf0":"code","11781b77":"code","d1de3420":"code","75dfd540":"code","3ad8b3bd":"code","20934623":"code","38fa17e5":"code","7689f5c5":"code","2dc7a632":"code","fca18d27":"code","e467a0f7":"code","d34b50cf":"code","38c9d5bd":"code","566c6bc6":"code","f12c1331":"code","a0ec4086":"code","3ebedccd":"code","cffbaf17":"code","04afc8f1":"code","c0435e1b":"code","0b3c09fa":"code","0ffd0ae7":"code","8030aeab":"code","5a82772a":"code","c5f7ae30":"code","5a7593f8":"code","e7fa9e97":"code","b35309c7":"code","1855198b":"code","195e2f71":"markdown","4d83a509":"markdown","0ba04b23":"markdown","75ec864e":"markdown","b3571d22":"markdown","a561279e":"markdown","1767463a":"markdown","e83ba611":"markdown","41292fb9":"markdown","a6bbf7e9":"markdown"},"source":{"804f6cf0":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nfrom mlxtend.plotting import plot_confusion_matrix\n\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.svm import SVC\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.ensemble import RandomForestClassifier, GradientBoostingClassifier\nfrom sklearn.naive_bayes import GaussianNB\nfrom sklearn.metrics import accuracy_score,confusion_matrix, f1_score\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","11781b77":"df = pd.read_csv('..\/input\/Tweets.csv')\ndf.head()","d1de3420":"df.shape","75dfd540":"#Check for NaN values in each column\ndf.isna().sum()","3ad8b3bd":"#Percentage of NaN values\n((len(df)-df.count())\/len(df))*100","20934623":"del df['airline_sentiment_gold']\ndel df['negativereason_gold']\ndel df['tweet_coord']","38fa17e5":"df.shape","7689f5c5":"df.head()","2dc7a632":"#Sentiment Count \nsentiment_count = df.airline_sentiment.value_counts()\n#Airline Review Count\nairline_total = df['airline'].value_counts()","fca18d27":"index = [1,2,3]\nplt.figure(1,figsize=(20,10))\nplt.subplot(221)\nplt.bar(index,sentiment_count,color=['red','blue','green'])\nplt.xticks(index,['negative','neutral','positive'],rotation=0)\nplt.xlabel('Sentiment Type')\nplt.ylabel('Sentiment Count')\nplt.title('Count of Type of Sentiment')\nIndex=[1,2,3,4,5,6]\nmy_colors = 'rgbkym'\nplt.subplot(222)\nplt.bar(Index,airline_total,color=my_colors)\nplt.xticks(Index,['United','US Airways','American','Southwest','Delta','Virgin America'],rotation=90)\nplt.xlabel('Airline')\nplt.ylabel('Review Count')\nplt.title('Airline Review Count')","e467a0f7":"airline_count = df.groupby('airline')['airline_sentiment'].value_counts()","d34b50cf":"def plot_sentiment_airline(airline):\n    df_airline = df[df['airline']==airline]\n    count = df_airline['airline_sentiment'].value_counts()\n    index = [1,2,3]\n    plt.bar(index,count,color=['red','blue','green'])\n    plt.xticks(index,['negative','neutral','positive'],rotation=0)\n    plt.xlabel('Sentiment Type')\n    plt.ylabel('Sentiment Count')\n    plt.title('Count of Sentiment Type of '+airline)\nairlines = ['US Airways','Virgin America','United','Delta','American','Southwest']\nfor i in range(len(airlines)):\n    plt.figure(1,figsize=(20,12))\n    temp = 231+i\n    plt.subplot(temp)\n    plot_sentiment_airline(airlines[i])","38c9d5bd":"timezone_count = df['user_timezone'].value_counts()\ntweet = df.groupby(['airline','airline_sentiment'])['user_timezone'].value_counts()","566c6bc6":"# Airlines' Negative Sentiment Count by Date\ndf['tweet_created']=pd.to_datetime(df['tweet_created'])\ndf['tweet_created'] = df['tweet_created'].dt.date\nday = df.groupby(['tweet_created','airline'])['airline_sentiment'].value_counts(sort=True)","f12c1331":"date = day.loc(axis=0)[:,:,'negative']\ndate.groupby(['tweet_created','airline']).sum().unstack().plot(kind='bar',figsize=(15,5))\nplt.xlabel('Date')\nplt.ylabel('Negative Sentiment Count')\nplt.title(\"Airlines' Negative Sentiment Count by Date\")\nplt.show()","a0ec4086":"#Number of Unique Negative Reasons \ndf['negativereason'].nunique()","3ebedccd":"#Negative Reason Count\nnr_count = df['negativereason'].value_counts()\nnr_dict = dict(df['negativereason'].value_counts())","cffbaf17":"nr = [\"Customer Service Issue\",\"Late Flight\",\"Can't Tell\", \"Cancelled Flight\", \"Lost Luggage\", \"Bad Flight\",\"Flight Booking Problems\",         \n\"Flight Attendant Complaints\",\"longlines\",\"Damaged Luggage\"]\n\ndef plot_negativereason_count(reason,reason_count):\n    index=list(range(10))\n    plt.figure(figsize=(15,10))\n    plot_colors = 'rgbykcm'\n    plt.bar(index,reason_count,color=plot_colors)\n    plt.xticks(index,reason,rotation=90)\n    plt.xlabel('Negative Reason Type')\n    plt.ylabel('Reason Count')\n    plt.title('Count of Negative Reasons Type')\nplot_negativereason_count(nr,nr_count)","04afc8f1":"negative_df = df.groupby('airline')['negativereason'].value_counts(ascending=False)","c0435e1b":"#Negative Reason Count for Airlines\nnegative_df.groupby(['airline','negativereason']).sum().unstack().plot(kind='bar',figsize=(20,10))\nplt.xlabel('Airline')\nplt.ylabel('Negative Reason Count')\nplt.title(\"Negative Reason Count for Airlines\")\nplt.show()","0b3c09fa":"import re\nimport nltk\nfrom nltk.corpus import stopwords\nfrom sklearn.model_selection import train_test_split\nfrom mlxtend.plotting import plot_confusion_matrix\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.metrics import accuracy_score,confusion_matrix,classification_report\nfrom sklearn.feature_extraction.text import CountVectorizer","0ffd0ae7":"def text_to_words(tweet):\n    letters = re.sub(\"^a-zA-Z\",\" \",tweet)\n    words = letters.lower().split()\n    stops = set(stopwords.words(\"english\"))\n    meaningful_words = [w for w in words if not w in stops]\n    return( \" \".join(meaningful_words))","8030aeab":"df['sentiment'] = df['airline_sentiment'].apply(lambda x: 0 if x=='negative' else 1)\ndf['text_clean'] = df['text'].apply(lambda x:text_to_words(x))","5a82772a":"#Train-test split\ntrain,test=train_test_split(df,test_size=0.2,random_state=42)","c5f7ae30":"def clean_tweet(tweet_text):\n    res = []\n    for tweet in tweet_text:\n        res.append(tweet)\n    return res\ntrain_clean_text = clean_tweet(train['text_clean'])\ntest_clean_text = clean_tweet(test['text_clean'])","5a7593f8":"counter_vectorizer = CountVectorizer(analyzer = \"word\")\ntrain_features= counter_vectorizer.fit_transform(train_clean_text)\ntest_features=counter_vectorizer.transform(test_clean_text)","e7fa9e97":"#Classifiers\nClassifiers = [\n    SVC(kernel=\"rbf\", C=0.025, gamma = 'scale'),\n    DecisionTreeClassifier(),\n    RandomForestClassifier(n_estimators=200),\n    GradientBoostingClassifier(),GaussianNB()]","b35309c7":"dense_features=train_features.toarray()\ndense_test= test_features.toarray()\nAccuracy=[]\nModel=[]\nfor clf in Classifiers:\n    try:\n        fit = clf.fit(train_features,train['sentiment'])\n        pred = fit.predict(test_features)\n    except Exception:\n        fit = clf.fit(dense_features,train['sentiment'])\n        pred = fit.predict(dense_test)\n    accuracy = accuracy_score(pred,test['sentiment'])\n    Accuracy.append(accuracy)\n    Model.append(clf.__class__.__name__)\n    print('Accuracy of '+clf.__class__.__name__+' is '+str(accuracy)) \n    print(classification_report(pred,test['sentiment']))\n    \n    #Confusion Matrix\n    cm = confusion_matrix(pred,test['sentiment'])\n    plt.figure()\n    plot_confusion_matrix(cm,cmap=plt.cm.Blues)\n    plt.xticks(range(2), ['Negative', 'Positive'],color='black')\n    plt.yticks(range(2), ['Negative', 'Positive'])\n    plt.xlabel('Predicted Label')\n    plt.ylabel('True Label')\n    plt.show()","1855198b":"index=list(range(len(Classifiers)))\nplt.bar(index,Accuracy,color='rgbyk')\nplt.xticks(index,Model,rotation=90)\nplt.ylabel('Accuracy')\nplt.xlabel('Model')\nplt.title('Classifier Accuracies')","195e2f71":"# ****Data Preprocessing****","4d83a509":"* Customer Service Issue is the main reason[](http:\/\/) for a negative sentiment followed by Late Flight.\n* Damaged Luggage is observed to be the least probable reason for which a negative sentiment is observed. ","0ba04b23":"It is observed that **Random Forest Classifier** performs better than the other classifiers for the given dataset. \n**Random Forest Classifier** has the highest accuracy among all the algorithms. ","75ec864e":"## Preprocessing text of the tweets","b3571d22":"*  It's observed that on 23 February 2015 and 24 February 2015, American Airlines had the highest number of negative reviews. A sudden surge in negative reviews was observed. \n* From 2015-02-23 to 2015-02-24, the negative reviews for American airlines reduced to almost half. \n* Delta and Southwest overall have a fairly low amount of negative reviews. \n* A surge in negative reviews for airlines is observed at the end of the week. ","a561279e":"From the plot it is observed that the majority of the sentiments are negative sentiments.  ","1767463a":"*  Negative sentiment of United is higher compared to negative sentiment of other airlines. \n* US Airways, American, Southwest have high number of negative sentiments. \n* Delta and Virgin America's reviews are evenly balanced. ","e83ba611":"**Random Forest Classifier** has the highest accuracy as well as the f-1 score. ","41292fb9":"The dataset is split into training and testing dataset in the 80:20 ratio.","a6bbf7e9":"* It is observed that American, US Airways, and, United have the highest negative reviews for **Customer Service Issue** making this reason the main concern for airlines. \n* The top negative reason for all airlines except Delta is Customer Service Issue. \n* The least popular reason for negative reviews for all airlines except Virgin America is Damaged Luggage. "}}