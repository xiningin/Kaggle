{"cell_type":{"274d2da2":"code","671e9228":"code","4c2252c1":"code","bfbdc8d8":"code","f75d8026":"code","0a857dd6":"code","9f9a46c6":"code","5a0d91ce":"code","fcc1fe3f":"code","f9a5b300":"code","b17cbafb":"code","c8f1d7c0":"code","cd5ded62":"code","a418818c":"code","2c4ef1f8":"code","40ab3d24":"code","aded890c":"code","27fe1f00":"code","6adadd82":"code","6253fc25":"code","f9842aa2":"code","2b28dc31":"code","9cff55e4":"code","b630b766":"code","f6333444":"code","164b8cb3":"code","4e1fca23":"code","36aa28ae":"code","fe24d03a":"code","b58888aa":"markdown"},"source":{"274d2da2":"import os\n\nimport PIL\nfrom PIL import Image\nfrom PIL.ImageDraw import Draw\nimport numpy as np\nimport matplotlib.pyplot as plt\n%matplotlib inline\nfrom keras.models import load_model\nfrom keras.preprocessing import image","671e9228":"ls ..\/input","4c2252c1":"MODEL_BASE = '..\/input\/bbox-model-whale-recognition'\nDATA = '..\/input\/humpback-whale-identification'\nTRAIN_DATA = os.path.join(DATA, 'train')\nTEST_DATA = os.path.join(DATA, 'test')","bfbdc8d8":"model = load_model(os.path.join(MODEL_BASE, 'cropping.model'))","f75d8026":"# # input: (128, 128, 1)\n# model.summary()","0a857dd6":"train_paths = [os.path.join(TRAIN_DATA, img) for img in os.listdir(TRAIN_DATA)]\ntest_paths = [os.path.join(TEST_DATA, img) for img in os.listdir(TEST_DATA)]","9f9a46c6":"train_paths[0]","5a0d91ce":"img = image.load_img(train_paths[10])","fcc1fe3f":"img","f9a5b300":"img_arr = image.img_to_array(img)","b17cbafb":"img_arr.shape","c8f1d7c0":"rimg = img.resize((128, 128), PIL.Image.ANTIALIAS)","cd5ded62":"rimg","a418818c":"rimg_arr = image.img_to_array(rimg)","2c4ef1f8":"rimg_ = rimg.convert('L')","40ab3d24":"rimg_arr_ = image.img_to_array(rimg_)","aded890c":"rimg_arr_.shape","27fe1f00":"bbox = model.predict(np.expand_dims(rimg_arr_, axis=0))","6adadd82":"bbox","6253fc25":"draw = Draw(rimg_)","f9842aa2":"draw.rectangle(bbox, outline='red')","2b28dc31":"rimg_","9cff55e4":"rimg","b630b766":"img_crop = rimg_.crop(tuple(bbox[0]))","f6333444":"img_crop","164b8cb3":"def make_bbox_image(img_path):\n    \"\"\"\n    :param img: path to image\n    \"\"\"\n    main_img = image.load_img(img_path)\n    r_img = main_img.resize((128, 128), PIL.Image.ANTIALIAS)\n    # convert to 1d image\n    rb_img = r_img.convert('L')\n    rb_img_arr = image.img_to_array(rb_img)\n    bbox = model.predict(np.expand_dims(rb_img_arr, axis=0))\n    \n    # draw rectangle\n    # draw = Draw(rimg)\n    # draw.rectangle(bbox, outline='red')\n    \n    img_crop = r_img.crop(tuple(bbox[0]))\n    img_arr = image.img_to_array(img_crop)\n    return img_crop","4e1fca23":"train_paths[10]","36aa28ae":"img = make_bbox_image(train_paths[10])","fe24d03a":"plt.imshow(img)","b58888aa":"Reference\n\n- Awesome Kernel, thanks @martinpiotte : https:\/\/www.kaggle.com\/martinpiotte\/bounding-box-model\n- cropping.model: https:\/\/www.kaggle.com\/martinpiotte\/bounding-box-model\/output\n- Data: https:\/\/www.kaggle.com\/c\/humpback-whale-identification\/data"}}