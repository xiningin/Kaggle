{"cell_type":{"4188741d":"code","2de28a3e":"code","40906543":"code","594d02c5":"code","a3fee7a9":"code","df50c66c":"code","f3566905":"code","8f16f364":"code","b4bc2356":"code","b7fb7c21":"code","6c4640dc":"markdown","c16e7d29":"markdown","73195a4b":"markdown","e17f57c1":"markdown","6281020f":"markdown","e42a5c40":"markdown","92adab89":"markdown","5eff93d3":"markdown","13816532":"markdown","09df1e2f":"markdown","4495a34a":"markdown"},"source":{"4188741d":"import numpy as np \nimport pandas as pd \nimport matplotlib.pyplot as plt\nimport re\nfrom textblob import TextBlob\nfrom wordcloud import WordCloud\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input\/canada-covid19-tweets'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n","2de28a3e":"def clean_tweet(tweet):\n    \"\"\"\n    Removes mentions, hashtags, retweets, hyperlinks, and words that are less than 3 characters from tweets\n    Input: tweet (string) you want cleaned\n    Output: tweet (string) with mentions, hashtags, retweets, hyperlinks, and small words removed\n    \"\"\"\n    tweet= re.sub('@[A-Za-z0-9]+', '', tweet) #remove mentions\n    tweet= re.sub('#', '', tweet) #remove hashtags\n    tweet= re.sub('RT[\\s]+', '', tweet) #remove retweets\n    tweet= re.sub('https?:\\\/\\\/\\S+', '', tweet) #remove hyperlinks\n    tweet= re.sub(r'\\b\\w{1,3}\\b', '', tweet) #remove small words\n    return tweet\n\ndef subj_tweet(tweet):\n    \"\"\"\n    Returns subjectivity of a tweet (whether a tweet is fact- or opinion-based)\n    Input: tweet (string) with all mentions, hashtags, retweets, hyperlinks, and small words removed\n    Output: float between 0 and 1 (0 means tweet is  fact, 1 means tweet is very much an opinion)\n    \"\"\"\n    return TextBlob(tweet).sentiment.subjectivity\n\ndef pol_tweet(tweet):\n    \"\"\"\n    Returns polarity of a tweet (how negative or positive a tweet is)\n    Input: tweet (string) with all mentions, hashtags, retweets, hyperlinks, and small words removed\n    Output: float between -1 and 1 (-1 means tweet is very negative, 1 means tweet is very positive)\n    \"\"\"\n    return TextBlob(tweet).sentiment.polarity\n\ndef pol_percent(polarity):\n    \"\"\"\n    Returns classification label as to whether a tweet is positive or negative\n    Input: polarity (float) of a string\n    Output: string (\"pos\"\/\"neg\"\/\"neutral\") indicating whether the tweet associated with the polarity is positive, negative, or neutral \n    \"\"\"\n    if polarity <0:\n        return \"neg\"\n    elif polarity >0:\n        return \"pos\"\n    else:\n        return \"neutral\"\n\ndef build_cloud(words):\n    \"\"\"\n    Creates word cloud image from a body of text.\n    Input: body of text (string)\n    Output: None (displays word cloud)\n    \"\"\"\n    word_cloud= WordCloud(width= 1000, height= 600, random_state= 444, max_font_size= 110, stopwords=['twitter','this','that','with','have','because','them','their','what','when']).generate(words)\n    plt.figure()\n    plt.imshow(word_cloud)\n    plt.axis('off')\n    return ","40906543":"df= pd.read_csv('..\/input\/canada-covid19-tweets\/canada_tweets_v2.csv')\ndf.head()","594d02c5":"#we only need a few columns to perform our sentiment analysis\n#it also looks like each tweet has been retrieved twice so we'll get rid of duplicates too\ndf_small= df[['text','timestamp','city']].copy()\ndf_small.drop_duplicates(inplace= True)\n","a3fee7a9":"#to make it easier to count the number of tweets published each week, add two more columns of month and day tweet was published\ndf_small['timestamp']= pd.to_datetime(df_small['timestamp'])\n\nmonths= df_small['timestamp'].dt.month\ndays= df_small['timestamp'].dt.day\ndf_small.loc[:,'month published']= months\ndf_small.loc[:,'day published']= days\n\nprint('Tweets retrieved:', np.shape(df_small)[0])","df50c66c":"#now we can clean, get the subjectivity and polarity, and assign a \"pos\"\/\"neg\"\/\"neutral\" label for each of the tweets\ndf_small['text']= df_small['text'].apply(clean_tweet)\ndf_small.loc[:,'subjectivity']= df_small['text'].apply(subj_tweet)\ndf_small.loc[:,'polarity']= df_small['text'].apply(pol_tweet)\ndf_small.loc[:,'pos\/neg\/neutral']= df_small['polarity'].apply(pol_percent)\n\n#view head of final dataframe we're working with\ndf_small.head()","f3566905":"#count the number of tweets published each week\nwk1= df_small[(df_small['month published'] == 3) & (df_small['day published'].between(1,7))]\nwk2= df_small[(df_small['month published'] ==3) & (df_small['day published'].between(8,14))]\nwk3= df_small[(df_small['month published'] ==3) & (df_small['day published'].between(15,21))]\nwk4= df_small[(df_small['month published'] ==3) & (df_small['day published'].between(22,28))]\nwk5= df_small[(df_small['month published'] ==3) & (df_small['day published'].between(29,31))]\nwk5_2= df_small[(df_small['month published'] ==4) & (df_small['day published'].between(1,4))]\nwk6= df_small[(df_small['month published'] ==4) & (df_small['day published'].between(5,11))]\nwk7= df_small[(df_small['month published'] ==4) & (df_small['day published'].between(12,18))]\nwk8= df_small[(df_small['month published'] ==4) & (df_small['day published'].between(19,25))]\nwk9= df_small[(df_small['month published'] ==4) & (df_small['day published'].between(26,30))]\nwk9_2= df_small[(df_small['month published'] ==5) & (df_small['day published'].between(1,2))]\ntweet_counts= np.array([np.shape(wk1)[0], np.shape(wk2)[0], np.shape(wk3)[0], np.shape(wk4)[0], np.shape(wk5)[0]+np.shape(wk5_2)[0],np.shape(wk6)[0], np.shape(wk7)[0], np.shape(wk8)[0], np.shape(wk9)[0]+np.shape(wk9_2)[0]])\n\n#visualize the tweet counts\nx_axis= np.array(['M 1-7', 'M 8-14', 'M 15-21', 'M 22-28', 'M 29-A 4', 'A 5-11', 'A 12-18', 'A 19-25', 'A 26-M 2'])\nplt.figure()\nplt.xlabel('Week')\nplt.ylabel('Number of Tweets')\nplt.bar(x_axis, tweet_counts)\n","8f16f364":"#create word cloud. omit frequently used conjunctions and the word \"twitter\"\nwords= ' '.join([tweet for tweet in df_small['text']])\nbuild_cloud(words)","b4bc2356":"#this may take a moment to run...\nN,d= np.shape(df_small)\nplt.figure()\nplt.grid()\nplt.xlabel('Subjectivity')\nplt.ylabel('Polarity')\nfor i in range(N): #subjectivity is column 6, polarity is column 5\n    plt.scatter(df_small.iloc[i,5], df_small.iloc[i,6], color= 'blue')","b7fb7c21":"all_but8= df_small.drop(df_small[(df_small['month published'] ==4) & (df_small['day published'].between(19,25))].index)\nwords= ' '.join([tweet for tweet in all_but8['text']])\nbuild_cloud(words)","6c4640dc":"**Once again, in this word cloud we see a variety of words, suggesting that the only thing common among the tweets are the search terms themselves.** Both word clouds support that the majority of tweets are positive and based on opinion rather than fact; noticeable words in these word clouds include \"thank\", \"strong\", \"good\", and \"support\".","c16e7d29":"# Data Visualization - Sentiment Analysis and Distributions\nNow that our dataset is all cleaned up, we can visualize how many tweets were published each week starting March 1, 2020, get a word cloud of frequently tweeted words, and get the distribution of positive\/negative\/neutral tweets.","73195a4b":"# Cleaning the Dataset\nThe dataset consists of scraped tweets and their meta-data from across Canada. For each of the tweets, we need to determine the tweet's polarity, subjectivity, and whether the tweet is positive, negative, or neutral. Once we have this, we can start visualizing the distribution of tweets over time and the content of the tweets themselves.\n","e17f57c1":"To perform sentiment analysis, it will be helpful to have functions that clean the tweets, determine the subjectivity and polarity of each tweet as well as determine if a tweet is positive or negative. These functions are defined here as well as a function that creates a word cloud.","6281020f":"# Imports and Useful Functions","e42a5c40":"**Clearly the most tweets were published during the weeks of April 19-25 and April 26-May 2.** For now, we'll use all of the tweets from all of the weeks to create a word cloud and to see if people's tweets regarding covid-19 and\/or cancer are generally positive, negative, or neutral.","92adab89":"# Conclusion\nThe purpose of this notebook was to better understand cancer care in Canada and how it has changed throughout the Covid-19 pandemic using tweets that contain particular words related to Covid-19 and\/or cancer. People in Canada have tweeted the most about Covid-19 and\/or cancer in the weeks of April 19-25 and April 26-May 2 compared to all other weeks since March 1. The majority of tweets about Covid-19 and\/or cancer have been positive and opinion-based. **The Twitter data retrieved for this notebook indicates that there has been little to no change in cancer care in Canada since March 1, 2020; the majority of tweets published during this time do not indicate changes to one's cancer treatment.** This doesn't mean that cancer care hasn't changed since March 1, 2020.\n\nBased on the findings in this notebook and my previous notebook that used Twitter data to determine how cancer care has changed since March 1, 2020, I believe Twitter is an insufficient data resource for quantifying how patterns of care are changing for current cancer patients in Canada.","5eff93d3":"# How the Tweet Data was Retrieved\nTweets were scraped using twitterscraper (https:\/\/github.com\/taspinar\/twitterscraper). twitterscraper was used 702 times (13 search terms x 6 cities x 9 weeks) and a .json file containing the tweets and their meta-data were saved for each run whenever tweets that met the search criteria were available. The tweets from all .json files were combined into one pandas dataframe and this dataframe was saved as a csv and used in this notebook. The following search terms were used: covid19 AND cancer, covid AND cancer, covid19 AND oncology, covid AND oncology, coronavirus AND cancer, coronavirus AND oncology, cancer, surgery, chemo, chemotherapy, tumor, tumour, oncology.","13816532":"The purpose of this notebook and its data is to better understand cancer care in Canada and how it has changed since March 1, 2020. This notebook is a follow-up to my previous notebook \"Cancer Care in the time of Covid-19 - Twitter\" (https:\/\/www.kaggle.com\/valbauman\/cancer-care-in-the-time-of-covid-19-twitter) and is intended to help answer \"How are patterns of care changing for current patients (i.e., cancer patients)?\". This notebook performs sentiment analysis on scraped tweets from across Canada that contain words related to cancer and\/or Covid-19. This notebook helps us understand how the general public's attitude toward cancer care has changed since March 1, 2020.\n\nThe included .csv files contains the scraped tweets (v2 has tweets up until May 2, 2020). Details on how the tweets were obtained are provided at the end of this notebook.","09df1e2f":"**From this word cloud, there is a great variety of tweets regarding Covid-19 and cancer**; the most common words among the retrieved tweets are the search terms that were used to retrieve the tweets. If some of the large words in this word cloud were words like \"cancelled\", \"postponed\", \"rescheduled\", \"unknown\", and \"scared\", this would suggest that many people are tweeting about changes to their cancer treatment plan. However, this doesn't appear to be the case. Instead, we just see a large variety of words, suggesting people are tweeting about many different things with a common theme of Covid-19 and\/or cancer.\n\nFor all of the tweets, let's visualize polarity vs. subjectivity. Recall that a polarity score of -1 means the tweet is very negative and a score of 1 means the tweet is very positive. A subjectivity score of 0 means that the tweet is a fact and a score of 1 means the tweet is very much an opinion.\n\n","4495a34a":"**Based on this plot, the majority of tweets are positive and opinion-based**; the majority of points have a subjectivity score >0.5 and a polarity score >0.0. This suggests that the twitter users publishing these tweets have a positive attitude when it comes to Covid-19 and cancer care. Reading and categorizing the published tweets could verify what exactly people are feeling positive about but this has not been included as part of this notebook.\n\nSince the majority of tweets were published the weeks of April 19-25 and April 26-May 2, let's build a word cloud for the tweets from the seven preceding weeks (March 1 - April 18)."}}