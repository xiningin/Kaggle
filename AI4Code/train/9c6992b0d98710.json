{"cell_type":{"04c4424d":"code","392a8394":"code","e85b772b":"code","e7d3cb65":"code","f6088646":"code","3ee215e6":"code","c749d2b1":"code","d848c017":"code","467b1531":"code","0bb77bd0":"code","05c0ef23":"code","30ccfdb2":"code","8a5e1a9e":"code","ba06b6cd":"code","f9b0a6e7":"code","ddaa5f05":"code","849aa5ac":"code","2884853e":"code","68b6aab9":"code","4bb014a8":"code","b08872ed":"code","18a54d69":"code","77d4b75e":"code","c1e6795e":"code","c30edc4b":"code","411a8fac":"code","579f79cc":"code","e89ef94f":"code","a864c442":"code","a04e2122":"code","079d6ee0":"code","7818618e":"code","27670073":"markdown","45184399":"markdown","10a1400b":"markdown","929201ba":"markdown","f35eab93":"markdown","7f9f9ea7":"markdown","4fe5ca66":"markdown","a2ba620b":"markdown","6fd48246":"markdown","f6ab000d":"markdown","7194df54":"markdown","3838cdb7":"markdown","9775a9a0":"markdown","6a5bc79b":"markdown","90dc4849":"markdown","bb77e4a9":"markdown","55ac557b":"markdown","41f80147":"markdown","26b99b3c":"markdown"},"source":{"04c4424d":"# Basic libraries\nimport numpy as np\nimport pandas as pd\n\n# Directry check\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","392a8394":"# Libraries\nimport datetime\n\n# Visualization\nfrom matplotlib import pyplot as plt\nimport seaborn as sns\nsns.set()\n\n# Data preporcessing\nfrom sklearn.preprocessing import MinMaxScaler\n\n# LSTM\nfrom keras.models import Sequential\nfrom keras.layers import LSTM\nfrom keras.layers.core import Activation\nfrom keras.optimizers import Adam\nfrom keras.layers import Dense\nfrom keras.layers import Dropout","e85b772b":"df_items = pd.read_csv(\"\/kaggle\/input\/competitive-data-science-predict-future-sales\/items.csv\", header=0)\ndf_shops = pd.read_csv(\"\/kaggle\/input\/competitive-data-science-predict-future-sales\/shops.csv\", header=0)\ndf_sales_train = pd.read_csv(\"\/kaggle\/input\/competitive-data-science-predict-future-sales\/sales_train.csv\", header=0)\ndf_test = pd.read_csv(\"\/kaggle\/input\/competitive-data-science-predict-future-sales\/test.csv\", header=0)\ndf_category = pd.read_csv(\"\/kaggle\/input\/competitive-data-science-predict-future-sales\/item_categories.csv\", header=0)","e7d3cb65":"# data size\nprint(\"items_data:\", df_items.shape)\nprint(\"shops_data:\", df_shops.shape)\nprint(\"sales_train_data:\", df_sales_train.shape)\nprint(\"test_data:\", df_test.shape)\nprint(\"category_data:\", df_category.shape)","f6088646":"# Null data count\nprint(\"Null_of_items_data:\\n{}\".format(df_items.isnull().sum()))\nprint(\"-\"*30)\nprint(\"Null_of_shops_data:\\n{}\".format(df_shops.isnull().sum()))\nprint(\"-\"*30)\nprint(\"Null_of_sales_train_data:\\n{}\".format(df_sales_train.isnull().sum()))\nprint(\"-\"*30)\nprint(\"Null_of_test_data:\\n{}\".format(df_test.isnull().sum()))\nprint(\"-\"*30)\nprint(\"Null_of_category_data:\\n{}\".format(df_category.isnull().sum()))","3ee215e6":"# Data information\nprint(\"Info_of_items_data\")\nprint(df_items.info())\nprint(\"-\"*30)\nprint(\"Info_of_shops_data\")\nprint(df_shops.info())\nprint(\"-\"*30)\nprint(\"Info_of_sales_train_data\")\nprint(df_sales_train.info())\nprint(\"-\"*30)\nprint(\"Info_of_test_data\")\nprint(df_test.info())\nprint(\"-\"*30)\nprint(\"Info_of_category_data\")\nprint(df_category.info())","c749d2b1":"# items data\ndf_items.head()","d848c017":"# shop data\ndf_shops.head()","467b1531":"# sales_train_data\nprint(\"unique_shop_id_count:{}\".format(df_sales_train[\"shop_id\"].value_counts().shape[0]))\nprint(\"unique_item_id_count:{}\".format(df_sales_train[\"item_id\"].value_counts().shape[0]))\ndf_sales_train.head()","0bb77bd0":"# test_data\nprint(\"unique_shop_id_count:{}\".format(df_test[\"shop_id\"].value_counts().shape[0]))\nprint(\"unique_item_id_count:{}\".format(df_test[\"item_id\"].value_counts().shape[0]))\ndf_test.head()","05c0ef23":"# category_data\ndf_category.head()","30ccfdb2":"# Time data\ndf_sales_train[\"date_dt\"] = pd.to_datetime(df_sales_train[\"date\"], format='%d.%m.%Y')\n\ndf_sales_train[\"year\"] = df_sales_train[\"date_dt\"].dt.year\ndf_sales_train[\"month\"] = df_sales_train[\"date_dt\"].dt.month\ndf_sales_train[\"day\"] = df_sales_train[\"date_dt\"].dt.day\ndf_sales_train[\"dayofweek\"] = df_sales_train[\"date_dt\"].dt.dayofweek\ndf_sales_train[\"dayofyear\"] = df_sales_train[\"date_dt\"].dt.dayofyear\ndf_sales_train[\"weekofyear\"] = df_sales_train[\"date_dt\"].dt.weekofyear","8a5e1a9e":"df_sales_train[\"item_sales\"] = df_sales_train[\"item_price\"]*df_sales_train[\"item_cnt_day\"]\n\ndf_sales_train.head()","ba06b6cd":"# shop_id distribution in df_train\nplt.figure(figsize=(20,5))\n\nindex = [str(i) for i in df_sales_train[\"shop_id\"].value_counts().index]\nvalue = df_sales_train[\"shop_id\"].value_counts()\nplt.bar(index, value, color=\"blue\", alpha=0.5)\nplt.xlabel(\"shop_id\")\nplt.ylabel(\"count\")\nplt.title(\"shop_id_count from sales_train_data\")","f9b0a6e7":"df_sales_train[\"item_id\"].value_counts()","ddaa5f05":"# Top50 item_id distribution in df_train\nplt.figure(figsize=(20,5))\n\nindex = [str(i) for i in df_sales_train[\"item_id\"].value_counts()[:50].index]\nvalue = df_sales_train[\"item_id\"].value_counts()[:50]\nplt.bar(index, value, color=\"blue\", alpha=0.5)\nplt.xlabel(\"item_id\")\nplt.xticks(rotation=90)\nplt.ylabel(\"count\")\nplt.title(\"Top50 item_id_count from sales_train_data\")","849aa5ac":"# shop_id=31(max_sales) time series data\nshop_31 = df_sales_train.query(\"shop_id==31\").reset_index()\n\n# shop_id=31(2nd_sales) time series data\nshop_25 = df_sales_train.query(\"shop_id==25\").reset_index()\n\n# shop_id=31(3rd_sales) time series data\nshop_54 = df_sales_train.query(\"shop_id==54\").reset_index()\n\n# shop_id=31(4th_sales) time series data\nshop_28 = df_sales_train.query(\"shop_id==28\").reset_index()\n\n# shop_id=31(5th_sales) time series data\nshop_57 = df_sales_train.query(\"shop_id==57\").reset_index()\n\n\n\nshop_31.head()","2884853e":"# Time series of daily sales\nshop_31_monthly = shop_31.groupby([\"year\",\"month\"]).sum()[[\"item_cnt_day\", \"item_sales\"]].reset_index()\nshop_25_monthly = shop_25.groupby([\"year\",\"month\"]).sum()[[\"item_cnt_day\", \"item_sales\"]].reset_index()\nshop_54_monthly = shop_54.groupby([\"year\",\"month\"]).sum()[[\"item_cnt_day\", \"item_sales\"]].reset_index()\nshop_28_monthly = shop_28.groupby([\"year\",\"month\"]).sum()[[\"item_cnt_day\", \"item_sales\"]].reset_index()\nshop_57_monthly = shop_57.groupby([\"year\",\"month\"]).sum()[[\"item_cnt_day\", \"item_sales\"]].reset_index()\n\n# Visualization of monthly time series\nfig, ax = plt.subplots(1,5,figsize=(25,4))\nplt.subplots_adjust(wspace=0.3, hspace=0.3)\n\n# shop_31\nax[0].plot(shop_31_monthly.query(\"year==2013\")[\"month\"], shop_31_monthly.query(\"year==2013\")[\"item_sales\"], color=\"blue\")\nax[0].plot(shop_31_monthly.query(\"year==2014\")[\"month\"], shop_31_monthly.query(\"year==2014\")[\"item_sales\"], color=\"red\")\nax[0].plot(shop_31_monthly.query(\"year==2015\")[\"month\"], shop_31_monthly.query(\"year==2015\")[\"item_sales\"], color=\"green\")\nax[0].set_xlabel(\"month\")\nax[0].set_xlim([0,13])\nax[0].set_xticks(np.arange(1,13,1))\nax[0].set_ylabel(\"sales\")\nax[0].set_title(\"shop_31_sales\")\nax[0].legend(labels=(\"2013\",\"2014\",\"2015\"))\n\n# shop_25\nax[1].plot(shop_25_monthly.query(\"year==2013\")[\"month\"], shop_25_monthly.query(\"year==2013\")[\"item_sales\"], color=\"blue\")\nax[1].plot(shop_25_monthly.query(\"year==2014\")[\"month\"], shop_25_monthly.query(\"year==2014\")[\"item_sales\"], color=\"red\")\nax[1].plot(shop_25_monthly.query(\"year==2015\")[\"month\"], shop_25_monthly.query(\"year==2015\")[\"item_sales\"], color=\"green\")\nax[1].set_xlabel(\"month\")\nax[1].set_xlim([0,13])\nax[1].set_xticks(np.arange(1,13,1))\nax[1].set_ylabel(\"sales\")\nax[1].set_title(\"shop_25_sales\")\nax[1].legend(labels=(\"2013\",\"2014\",\"2015\"))\n\n# shop_54\nax[2].plot(shop_54_monthly.query(\"year==2013\")[\"month\"], shop_54_monthly.query(\"year==2013\")[\"item_sales\"], color=\"blue\")\nax[2].plot(shop_54_monthly.query(\"year==2014\")[\"month\"], shop_54_monthly.query(\"year==2014\")[\"item_sales\"], color=\"red\")\nax[2].plot(shop_54_monthly.query(\"year==2015\")[\"month\"], shop_54_monthly.query(\"year==2015\")[\"item_sales\"], color=\"green\")\nax[2].set_xlabel(\"month\")\nax[2].set_xlim([0,13])\nax[2].set_xticks(np.arange(1,13,1))\nax[2].set_ylabel(\"sales\")\nax[2].set_title(\"shop_54_sales\")\nax[2].legend(labels=(\"2013\",\"2014\",\"2015\"))\n\n# shop_28\nax[3].plot(shop_28_monthly.query(\"year==2013\")[\"month\"], shop_28_monthly.query(\"year==2013\")[\"item_sales\"], color=\"blue\")\nax[3].plot(shop_28_monthly.query(\"year==2014\")[\"month\"], shop_28_monthly.query(\"year==2014\")[\"item_sales\"], color=\"red\")\nax[3].plot(shop_28_monthly.query(\"year==2015\")[\"month\"], shop_28_monthly.query(\"year==2015\")[\"item_sales\"], color=\"green\")\nax[3].set_xlabel(\"month\")\nax[3].set_xlim([0,13])\nax[3].set_xticks(np.arange(1,13,1))\nax[3].set_ylabel(\"sales\")\nax[3].set_title(\"shop_28_sales\")\nax[3].legend(labels=(\"2013\",\"2014\",\"2015\"))\n\n# shop_57\nax[4].plot(shop_57_monthly.query(\"year==2013\")[\"month\"], shop_57_monthly.query(\"year==2013\")[\"item_sales\"], color=\"blue\")\nax[4].plot(shop_57_monthly.query(\"year==2014\")[\"month\"], shop_57_monthly.query(\"year==2014\")[\"item_sales\"], color=\"red\")\nax[4].plot(shop_57_monthly.query(\"year==2015\")[\"month\"], shop_57_monthly.query(\"year==2015\")[\"item_sales\"], color=\"green\")\nax[4].set_xlabel(\"month\")\nax[4].set_xlim([0,13])\nax[4].set_xticks(np.arange(1,13,1))\nax[4].set_ylabel(\"sales\")\nax[4].set_title(\"shop_57_sales\")\nax[4].legend(labels=(\"2013\",\"2014\",\"2015\"))","68b6aab9":"# Visualization of monthly auto correlation \n# define the function\ndef auto_corr(data, k):\n    y_mean = np.mean(data)\n    sum_of_covariance = 0\n    for i in range(k+1, len(data)):\n        covariance = ( data[i] - y_mean )*( data[i-(k+1)] - y_mean )\n        sum_of_covariance += covariance\n    sum_of_denominator = 0\n    for u in range(len(data)):\n        denominator = ( data[u] - y_mean )**2\n        sum_of_denominator += denominator\n    return sum_of_covariance \/ sum_of_denominator\n\n# Visualization of monthly time series\nfig, ax = plt.subplots(1,5,figsize=(25,4))\nplt.subplots_adjust(wspace=0.3, hspace=0.3)\n\n# shop_31\nacorr_data = [1]\nfor i in range(0,12):\n    acorr_data.append(auto_corr(shop_31_monthly[\"item_sales\"], i))\ndelta_month = np.arange(0,13)\n# figure\nax[0].stem(delta_month, acorr_data)\nax[0].set_title(\"Auto_correlation\")\nax[0].set_xlabel(\"delta_month\")\nax[0].set_xlim([-1,13])\nax[0].set_xticks(np.arange(0,13,1))\nax[0].set_ylabel(\"ACF\")\n\n# shop_25\nacorr_data = [1]\nfor i in range(0,12):\n    acorr_data.append(auto_corr(shop_25_monthly[\"item_sales\"], i))\ndelta_month = np.arange(0,13)\n# figure\nax[1].stem(delta_month, acorr_data)\nax[1].set_title(\"Auto_correlation\")\nax[1].set_xlabel(\"delta_month\")\nax[1].set_xlim([-1,13])\nax[1].set_xticks(np.arange(0,13,1))\nax[1].set_ylabel(\"ACF\")\n\n# shop_54\nacorr_data = [1]\nfor i in range(0,12):\n    acorr_data.append(auto_corr(shop_54_monthly[\"item_sales\"], i))\ndelta_month = np.arange(0,13)\n# figure\nax[2].stem(delta_month, acorr_data)\nax[2].set_title(\"Auto_correlation\")\nax[2].set_xlabel(\"delta_month\")\nax[2].set_xlim([-1,13])\nax[2].set_xticks(np.arange(0,13,1))\nax[2].set_ylabel(\"ACF\")\n\n# shop_28\nacorr_data = [1]\nfor i in range(0,12):\n    acorr_data.append(auto_corr(shop_28_monthly[\"item_sales\"], i))\ndelta_month = np.arange(0,13)\n# figure\nax[3].stem(delta_month, acorr_data)\nax[3].set_title(\"Auto_correlation\")\nax[3].set_xlabel(\"delta_month\")\nax[3].set_xlim([-1,13])\nax[3].set_xticks(np.arange(0,13,1))\nax[3].set_ylabel(\"ACF\")\n\n# shop_57\nacorr_data = [1]\nfor i in range(0,12):\n    acorr_data.append(auto_corr(shop_57_monthly[\"item_sales\"], i))\ndelta_month = np.arange(0,13)\n# figure\nax[4].stem(delta_month, acorr_data)\nax[4].set_title(\"Auto_correlation\")\nax[4].set_xlabel(\"delta_month\")\nax[4].set_xlim([-1,13])\nax[4].set_xticks(np.arange(0,13,1))\nax[4].set_ylabel(\"ACF\")","4bb014a8":"# Visualization of monthly time series\nfig, ax = plt.subplots(1,5,figsize=(25,4))\nplt.subplots_adjust(wspace=0.3, hspace=0.3)\n\n# shop_31\nax[0].plot(shop_31_monthly.query(\"year==2013\")[\"month\"], shop_31_monthly.query(\"year==2013\")[\"item_cnt_day\"], color=\"blue\")\nax[0].plot(shop_31_monthly.query(\"year==2014\")[\"month\"], shop_31_monthly.query(\"year==2014\")[\"item_cnt_day\"], color=\"red\")\nax[0].plot(shop_31_monthly.query(\"year==2015\")[\"month\"], shop_31_monthly.query(\"year==2015\")[\"item_cnt_day\"], color=\"green\")\nax[0].set_xlabel(\"month\")\nax[0].set_xlim([0,13])\nax[0].set_xticks(np.arange(1,13,1))\nax[0].set_ylabel(\"sales\")\nax[0].set_title(\"shop_31_sales_volume\")\nax[0].legend(labels=(\"2013\",\"2014\",\"2015\"))\n\n# shop_25\nax[1].plot(shop_25_monthly.query(\"year==2013\")[\"month\"], shop_25_monthly.query(\"year==2013\")[\"item_cnt_day\"], color=\"blue\")\nax[1].plot(shop_25_monthly.query(\"year==2014\")[\"month\"], shop_25_monthly.query(\"year==2014\")[\"item_cnt_day\"], color=\"red\")\nax[1].plot(shop_25_monthly.query(\"year==2015\")[\"month\"], shop_25_monthly.query(\"year==2015\")[\"item_cnt_day\"], color=\"green\")\nax[1].set_xlabel(\"month\")\nax[1].set_xlim([0,13])\nax[1].set_xticks(np.arange(1,13,1))\nax[1].set_ylabel(\"sales\")\nax[1].set_title(\"shop_25_sales_volume\")\nax[1].legend(labels=(\"2013\",\"2014\",\"2015\"))\n\n# shop_54\nax[2].plot(shop_54_monthly.query(\"year==2013\")[\"month\"], shop_54_monthly.query(\"year==2013\")[\"item_cnt_day\"], color=\"blue\")\nax[2].plot(shop_54_monthly.query(\"year==2014\")[\"month\"], shop_54_monthly.query(\"year==2014\")[\"item_cnt_day\"], color=\"red\")\nax[2].plot(shop_54_monthly.query(\"year==2015\")[\"month\"], shop_54_monthly.query(\"year==2015\")[\"item_cnt_day\"], color=\"green\")\nax[2].set_xlabel(\"month\")\nax[2].set_xlim([0,13])\nax[2].set_xticks(np.arange(1,13,1))\nax[2].set_ylabel(\"sales\")\nax[2].set_title(\"shop_54_sales_volume\")\nax[2].legend(labels=(\"2013\",\"2014\",\"2015\"))\n\n# shop_28\nax[3].plot(shop_28_monthly.query(\"year==2013\")[\"month\"], shop_28_monthly.query(\"year==2013\")[\"item_cnt_day\"], color=\"blue\")\nax[3].plot(shop_28_monthly.query(\"year==2014\")[\"month\"], shop_28_monthly.query(\"year==2014\")[\"item_cnt_day\"], color=\"red\")\nax[3].plot(shop_28_monthly.query(\"year==2015\")[\"month\"], shop_28_monthly.query(\"year==2015\")[\"item_cnt_day\"], color=\"green\")\nax[3].set_xlabel(\"month\")\nax[3].set_xlim([0,13])\nax[3].set_xticks(np.arange(1,13,1))\nax[3].set_ylabel(\"sales\")\nax[3].set_title(\"shop_28_sales_volume\")\nax[3].legend(labels=(\"2013\",\"2014\",\"2015\"))\n\n# shop_57\nax[4].plot(shop_57_monthly.query(\"year==2013\")[\"month\"], shop_57_monthly.query(\"year==2013\")[\"item_cnt_day\"], color=\"blue\")\nax[4].plot(shop_57_monthly.query(\"year==2014\")[\"month\"], shop_57_monthly.query(\"year==2014\")[\"item_cnt_day\"], color=\"red\")\nax[4].plot(shop_57_monthly.query(\"year==2015\")[\"month\"], shop_57_monthly.query(\"year==2015\")[\"item_cnt_day\"], color=\"green\")\nax[4].set_xlabel(\"month\")\nax[4].set_xlim([0,13])\nax[4].set_xticks(np.arange(1,13,1))\nax[4].set_ylabel(\"sales\")\nax[4].set_title(\"shop_57_sales_volume\")\nax[4].legend(labels=(\"2013\",\"2014\",\"2015\"))","b08872ed":"# item_id=20949(max_item) time series data\nitem_20949 = df_sales_train.query(\"item_id==20949\").reset_index()\n\n# shop_id=5822(2nd_sales) time series data\nitem_5822 = df_sales_train.query(\"item_id==5822\").reset_index()\n\n# item_id=17717(3rd_sales) time series data\nitem_17717 = df_sales_train.query(\"item_id==17717\").reset_index()\n\n# item_id=2808(4th_sales) time series data\nitem_2808 = df_sales_train.query(\"item_id==2808\").reset_index()\n\n# item_id=4181(5th_sales) time series data\nitem_4181 = df_sales_train.query(\"item_id==4181\").reset_index()\n\n\n\nitem_20949.head()","18a54d69":"# Time series of daily sales\nitem_20949_monthly = item_20949.groupby([\"year\",\"month\"]).sum()[[\"item_sales\"]].reset_index()\nitem_5822_monthly = item_5822.groupby([\"year\",\"month\"]).sum()[[\"item_sales\"]].reset_index()\nitem_17717_monthly = item_17717.groupby([\"year\",\"month\"]).sum()[[\"item_sales\"]].reset_index()\nitem_2808_monthly = item_2808.groupby([\"year\",\"month\"]).sum()[[\"item_sales\"]].reset_index()\nitem_4181_monthly = item_4181.groupby([\"year\",\"month\"]).sum()[[\"item_sales\"]].reset_index()\n\n# Visualization of monthly time series\nfig, ax = plt.subplots(1,5,figsize=(25,4))\nplt.subplots_adjust(wspace=0.3, hspace=0.3)\n\n# item_20949\nax[0].plot(item_20949_monthly.query(\"year==2013\")[\"month\"], item_20949_monthly.query(\"year==2013\")[\"item_sales\"], color=\"blue\")\nax[0].plot(item_20949_monthly.query(\"year==2014\")[\"month\"], item_20949_monthly.query(\"year==2014\")[\"item_sales\"], color=\"red\")\nax[0].plot(item_20949_monthly.query(\"year==2015\")[\"month\"], item_20949_monthly.query(\"year==2015\")[\"item_sales\"], color=\"green\")\nax[0].set_xlabel(\"month\")\nax[0].set_xlim([0,13])\nax[0].set_xticks(np.arange(1,13,1))\nax[0].set_ylabel(\"sales\")\nax[0].set_title(\"item_20949_sales\")\nax[0].legend(labels=(\"2013\",\"2014\",\"2015\"))\n\n# item_5822\nax[1].plot(item_5822_monthly.query(\"year==2013\")[\"month\"], item_5822_monthly.query(\"year==2013\")[\"item_sales\"], color=\"blue\")\nax[1].plot(item_5822_monthly.query(\"year==2014\")[\"month\"], item_5822_monthly.query(\"year==2014\")[\"item_sales\"], color=\"red\")\nax[1].plot(item_5822_monthly.query(\"year==2015\")[\"month\"], item_5822_monthly.query(\"year==2015\")[\"item_sales\"], color=\"green\")\nax[1].set_xlabel(\"month\")\nax[1].set_xlim([0,13])\nax[1].set_xticks(np.arange(1,13,1))\nax[1].set_ylabel(\"sales\")\nax[1].set_title(\"item_5822_sales\")\nax[1].legend(labels=(\"2013\",\"2014\",\"2015\"))\n\n# item_17717\nax[2].plot(item_17717_monthly.query(\"year==2013\")[\"month\"], item_17717_monthly.query(\"year==2013\")[\"item_sales\"], color=\"blue\")\nax[2].plot(item_17717_monthly.query(\"year==2014\")[\"month\"], item_17717_monthly.query(\"year==2014\")[\"item_sales\"], color=\"red\")\nax[2].plot(item_17717_monthly.query(\"year==2015\")[\"month\"], item_17717_monthly.query(\"year==2015\")[\"item_sales\"], color=\"green\")\nax[2].set_xlabel(\"month\")\nax[2].set_xlim([0,13])\nax[2].set_xticks(np.arange(1,13,1))\nax[2].set_ylabel(\"sales\")\nax[2].set_title(\"item_17717_sales\")\nax[2].legend(labels=(\"2013\",\"2014\",\"2015\"))\n\n# item_2808\nax[3].plot(item_2808_monthly.query(\"year==2013\")[\"month\"], item_2808_monthly.query(\"year==2013\")[\"item_sales\"], color=\"blue\")\nax[3].plot(item_2808_monthly.query(\"year==2014\")[\"month\"], item_2808_monthly.query(\"year==2014\")[\"item_sales\"], color=\"red\")\nax[3].plot(item_2808_monthly.query(\"year==2015\")[\"month\"], item_2808_monthly.query(\"year==2015\")[\"item_sales\"], color=\"green\")\nax[3].set_xlabel(\"month\")\nax[3].set_xlim([0,13])\nax[3].set_xticks(np.arange(1,13,1))\nax[3].set_ylabel(\"sales\")\nax[3].set_title(\"item_2808_sales\")\nax[3].legend(labels=(\"2013\",\"2014\",\"2015\"))\n\n# item_4181\nax[4].plot(item_4181_monthly.query(\"year==2013\")[\"month\"], item_4181_monthly.query(\"year==2013\")[\"item_sales\"], color=\"blue\")\nax[4].plot(item_4181_monthly.query(\"year==2014\")[\"month\"], item_4181_monthly.query(\"year==2014\")[\"item_sales\"], color=\"red\")\nax[4].plot(item_4181_monthly.query(\"year==2015\")[\"month\"], item_4181_monthly.query(\"year==2015\")[\"item_sales\"], color=\"green\")\nax[4].set_xlabel(\"month\")\nax[4].set_xlim([0,13])\nax[4].set_xticks(np.arange(1,13,1))\nax[4].set_ylabel(\"sales\")\nax[4].set_title(\"item_4181_sales\")\nax[4].legend(labels=(\"2013\",\"2014\",\"2015\"))","77d4b75e":"# Visualization of monthly time series\nfig, ax = plt.subplots(1,5,figsize=(25,4))\nplt.subplots_adjust(wspace=0.3, hspace=0.3)\n\n# item_20949\nacorr_data = [1]\nfor i in range(0,12):\n    acorr_data.append(auto_corr(item_20949_monthly[\"item_sales\"], i))\ndelta_month = np.arange(0,13)\n# figure\nax[0].stem(delta_month, acorr_data)\nax[0].set_title(\"Auto_correlation\")\nax[0].set_xlabel(\"delta_month\")\nax[0].set_xlim([-1,13])\nax[0].set_xticks(np.arange(0,13,1))\nax[0].set_ylabel(\"ACF\")\n\n# item_5822\nacorr_data = [1]\nfor i in range(0,12):\n    acorr_data.append(auto_corr(item_5822_monthly[\"item_sales\"], i))\ndelta_month = np.arange(0,13)\n# figure\nax[1].stem(delta_month, acorr_data)\nax[1].set_title(\"Auto_correlation\")\nax[1].set_xlabel(\"delta_month\")\nax[1].set_xlim([-1,13])\nax[1].set_xticks(np.arange(0,13,1))\nax[1].set_ylabel(\"ACF\")\n\n# item_17717\nacorr_data = [1]\nfor i in range(0,12):\n    acorr_data.append(auto_corr(item_17717_monthly[\"item_sales\"], i))\ndelta_month = np.arange(0,13)\n# figure\nax[2].stem(delta_month, acorr_data)\nax[2].set_title(\"Auto_correlation\")\nax[2].set_xlabel(\"delta_month\")\nax[2].set_xlim([-1,13])\nax[2].set_xticks(np.arange(0,13,1))\nax[2].set_ylabel(\"ACF\")\n\n# item_2808\nacorr_data = [1]\nfor i in range(0,12):\n    acorr_data.append(auto_corr(item_2808_monthly[\"item_sales\"], i))\ndelta_month = np.arange(0,13)\n# figure\nax[3].stem(delta_month, acorr_data)\nax[3].set_title(\"Auto_correlation\")\nax[3].set_xlabel(\"delta_month\")\nax[3].set_xlim([-1,13])\nax[3].set_xticks(np.arange(0,13,1))\nax[3].set_ylabel(\"ACF\")\n\n# item_4181\nacorr_data = [1]\nfor i in range(0,12):\n    acorr_data.append(auto_corr(item_4181_monthly[\"item_sales\"], i))\ndelta_month = np.arange(0,13)\n# figure\nax[4].stem(delta_month, acorr_data)\nax[4].set_title(\"Auto_correlation\")\nax[4].set_xlabel(\"delta_month\")\nax[4].set_xlim([-1,13])\nax[4].set_xticks(np.arange(0,13,1))\nax[4].set_ylabel(\"ACF\")","c1e6795e":"# train data setting\n# pivot_table\npivot_train = pd.pivot_table(df_sales_train, index=[\"shop_id\", \"item_id\"], columns=\"date_block_num\", values=\"item_cnt_day\", aggfunc=\"sum\", fill_value=0).reset_index()\n\n# Only id of test data & keeping only the needed data..\ndf = pd.merge(df_test, pivot_train, on=[\"item_id\", \"shop_id\"], how=\"left\").fillna(0)\ndf.drop(['ID', 'shop_id','item_id','ID'],inplace = True, axis = 1)\ndata = df.T.values\n\n# Min-Max Scaling\nms = MinMaxScaler()\ndata_norm = pd.DataFrame(ms.fit_transform(data).T)\n\n# data shape\ndata_norm.shape","c30edc4b":"# Training_data\nX_train = data_norm.iloc[:,-30:-12].values\ny_train = data_norm.iloc[:,-12].values\nX_train = np.expand_dims(X_train,axis = 2) # (214200,18)\u21d2(214200,18,1)\n\n# Test_data\nX_test = data_norm.iloc[:,-18:].values\nX_test = np.expand_dims(X_test,axis = 2) # (214200,18)\u21d2(214200,18,1)\n\n# Shape check \nprint(X_train.shape,y_train.shape,X_test.shape)","411a8fac":"# Model construction\nlength = 18\nin_out_neurons = 1\nn_hidden = 300\n\n# Model\nmodel = Sequential()\nmodel.add(LSTM(n_hidden,\n               batch_input_shape=(None, length, in_out_neurons), # (, 18, 1)\n               return_sequences=False)\n         )\nmodel.add(Dropout(0.4))\nmodel.add(Dense(in_out_neurons))\nmodel.add(Activation(\"relu\"))\noptimizer = Adam(lr=0.001)\n\n# Compile\nmodel.compile(loss=\"mean_squared_error\", optimizer=optimizer, metrics = ['mean_squared_error'])\n\nmodel.summary()","579f79cc":"# Fitting model\nmodel.fit(X_train,y_train,batch_size = 1000,epochs = 10)","e89ef94f":"# creating submission file \npred = model.predict(X_test)\n\n# Scaling\nsubmit_data = ms.inverse_transform(pred.T)\nsubmit_data = submit_data.clip(0,20)","a864c442":"# Submitting data\nsubmit = pd.DataFrame({'ID':df_test['ID'],'item_cnt_month':submit_data.reshape(-1,)})","a04e2122":"# Data describe\nsubmit.describe()","079d6ee0":"# Result distribution\nplt.figure(figsize=(10,6))\nsns.distplot(submit[\"item_cnt_month\"], bins=20, kde=False)\nplt.yscale(\"log\")\nplt.ylabel('log(count)')","7818618e":"submit.to_csv('my_submission.csv', index=False)\nprint(\"Your submission was successfully saved!\")","27670073":"Each items can be seen weak seasonaly by comaring \"2014\" and \"2015\". It would be suggest that I take better to use seasonaly from the near year.\nAnd, like item_17717, sales increase only in a limited month and some are not seasonal.","45184399":"# To try prediction future sale","10a1400b":"Each shops sales may have seasonaly factors.<br>\nEspecialy, December's sales is large in every shops.<br>\nBut, some of month can be behaving unexpectedly.","929201ba":"## 4. Preprocessing with LSTM model & Implementation<br>\n\n### Direction\n- Since we know that there is a seasonality and a trend, we learn 12 months of seasonality and 1.5 times 1year with data that reproduces the trend.\n- The test data is assumed to be the latest 18 months, and the training data is assumed to be the data of the past 18 months based on one year ago.","f35eab93":"- There are no dull data.","7f9f9ea7":"## 5. Cinfirming the result","4fe5ca66":"## Task<br>\n### is to forecast the total amount of products sold in every shop for the test set.\n\n## Direction\n### 1. Checking the whole data, EDA.<br>\n### 2. Prediction by time series by LSTM.\n\n## Agenda\n### 1. Data loading and First data checking\n### 2. Data cleaning\n### 3. Exploratory data analysis\n### 4. Preprocessing with LSTM model & Implementation\n### 5. Cinfirming the result\n### 6. Create the submission data","a2ba620b":"### Data loading","6fd48246":"## 3. Exploratory data analysis","f6ab000d":"### Volume","7194df54":"Same as sales volume, each shops sales volume may have seasonaly factors, too.<br>\nAnd, December is strong, too. But, increasing is small compared to sales.<br>\nI think it suggest, December's sales is that specific product with a high unit price was sold.<br>\nIn this way, it is suggest that the feature of sold or not in the month for each product appears.<br>\n\nAnd, Sales volume is decrease year by year. This is another fact to consider.","3838cdb7":"## 1. Data loading and First data checking","9775a9a0":"## 2.Data cleaning & Creating features\n\nI take the date value of df_sales_train change to datetime type.<br>\nAnd making \"year\" & \"month\" & \"day\" & \"dayofweek\" & \"weekofyear\" columns.","6a5bc79b":"## 6. Create the submission data","90dc4849":"### First data checking","bb77e4a9":"With Auto correlation analysis, they have some seasonaly factor.","55ac557b":"### Top5 item \"id=20949, 5822, 17717, 2808, 4181\", EDA","41f80147":"### Sales","26b99b3c":"### Top5 sales shop \"id=31, 25, 54, 28, 57\", EDA"}}