{"cell_type":{"7cf4c917":"code","00cffad8":"code","6fadbea2":"code","17fad9f6":"code","7058fc20":"code","25a5c747":"code","6a72639c":"code","9186054c":"code","a399f558":"code","3321cbd3":"markdown","79cb6d1e":"markdown","80177a6c":"markdown","69aa2166":"markdown","823fa1dd":"markdown","64861e33":"markdown","cfffb73c":"markdown","cec995f4":"markdown"},"source":{"7cf4c917":"import os\nimport random\nimport pandas as pd\nimport numpy as np\nfrom lightgbm import LGBMRegressor","00cffad8":"data = pd.read_csv('..\/input\/g-research-crypto-forecasting\/train.csv')\ndata.head()","6fadbea2":"data.describe()","17fad9f6":"asset_tmp = pd.read_csv('..\/input\/g-research-crypto-forecasting\/asset_details.csv')\nasset = asset_tmp.set_index('Asset_ID').sort_index()\nasset","7058fc20":"# \u5404\u901a\u8ca8\u6bce\u306b\u6b20\u640d\u5024\u3001\u6b20\u640d\u30c7\u30fc\u30bf\u3092\u78ba\u8a8d\nmissing_list = []\nfor asset_id, asset_name in zip(asset.index, asset.loc[:, 'Asset_Name']):\n    asset_df = data[data[\"Asset_ID\"]==asset_id].set_index(\"timestamp\")\n    gap_df = (asset_df.index[1:]-asset_df.index[:-1]).value_counts().reset_index()\n    drop_row = int(((gap_df['index']\/60-1)*gap_df['timestamp']).sum())\n    missing_list.append([asset_name, asset_df.shape[0]] + asset_df.isna().sum().tolist() + [drop_row])\n\nmissing_df = pd.DataFrame(missing_list)\nmissing_df.columns = [\"Asset_Name\", \"TotalRows\", 'Missing_Asset_ID', 'Missing_Count', 'Missing_Open', \n                      'Missing_High', 'Missing_Low', 'Missing_Close', 'Missing_Volume', 'Missing_VWAP', 'Missing_Target', 'Missing_Row']\nmissing_df","25a5c747":"# \u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3088\u308a\n# \u4e0a\u3072\u3052\u3001\u4e0b\u3072\u3052\u3092\u8a08\u7b97\ndef upper_shadow(df):\n    return df['High'] - np.maximum(df['Close'], df['Open'])\n\ndef lower_shadow(df):\n    return np.minimum(df['Close'], df['Open']) - df['Low']\n\ndef data_split_by_asset(df_train, asset_id):\n    df_asset = data[data[\"Asset_ID\"] == asset_id]\n    \n    df_asset['Upper_Shadow'] = upper_shadow(df_asset)\n    df_asset['Lower_Shadow'] = lower_shadow(df_asset)\n    df_asset = df_asset.dropna(how='any')\n    \n    X = df_asset.drop(['timestamp', 'Asset_ID', 'Target'], axis=1)\n    y = df_asset['Target']\n\n    model = LGBMRegressor(n_estimators=10)\n    model.fit(X, y)\n    return X, y, model","6a72639c":"X_dict = {}\ny_dict = {}\nmodel_dict = {}\n\nfor asset_id, asset_name in zip(asset.index, asset['Asset_Name']):\n    print(f\"Training model for {asset_name:<16} (ID={asset_id:<2})\")\n    X, y, model = data_split_by_asset(data, asset_id)    \n    X_dict[asset_id] = X\n    y_dict[asset_id] = y\n    model_dict[asset_id] = model","9186054c":"import gresearch_crypto\n\nenv = gresearch_crypto.make_env()\niter_test = env.iter_test()","a399f558":"df_test_entire = []\n\nfor i, (df_test, sample_prediction_df) in enumerate(iter_test):\n    # Asset_ID\u3067\u30e2\u30c7\u30eb\u3092\u5206\u5272\u3057\u3066\u3044\u308b\u305f\u3081\u30011\u30c7\u30fc\u30bf\u6bce\u3067\u4e88\u6e2c\n    for j, test_row in df_test.iterrows():\n\n        model = model_dict[test_row['Asset_ID']]\n        test_row['Upper_Shadow'] = upper_shadow(test_row)\n        test_row['Lower_Shadow'] = lower_shadow(test_row)\n\n        X_test = test_row.drop(['timestamp', 'Asset_ID', 'row_id']).values.reshape(1, -1)\n        y_pred = model.predict(X_test)\n\n        sample_prediction_df.loc[sample_prediction_df['row_id'] == test_row['row_id'], 'Target'] = y_pred\n\n    df_test_entire.append(df_test)\n\n    # submissions\u63d0\u51fa\n    env.predict(sample_prediction_df)","3321cbd3":"### \u30b3\u30f3\u30da\u6982\u8981\n\n\u76ee\u7684\uff1a\u6697\u53f7\u901a\u8ca8\u306b\u3088\u308b\u30ea\u30bf\u30fc\u30f3\u306e\u4e88\u6e2c<br>\n\u6697\u53f7\u901a\u8ca8\u306b\u95a2\u3059\u308b\u6642\u7cfb\u5217\u306e\u4fa1\u683c\u5c65\u6b74\u3092\u4f7f\u7528\u3057\u3066\u3001\u4fa1\u683c\u304c\u4e0a\u304c\u308b\u304b\u4e0b\u304c\u308b\u304b\u3001\u3069\u308c\u3060\u3051\u306e\u8cc7\u7523\u304c\u30ea\u30bf\u30fc\u30f3\u3059\u308b\u304b\u3092\u4e88\u6e2c\u3057\u307e\u3059\u3002<br>\n\u672c\u30b3\u30f3\u30da\u3067\u306f\u300114\u7a2e\u306e\u6697\u53f7\u901a\u8ca8\u306b\u3064\u3044\u3066\u306e\u30c7\u30fc\u30bf\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u3002<br>\n\n\u30c7\u30fc\u30bf\u306e\u7279\u6027\n- \u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3002\n- \u6697\u53f7\u901a\u8ca8\u306e\u5909\u52d5\u306f\u3001\u4ed6\u306e\u6697\u53f7\u901a\u8ca8\u3084\u6697\u53f7\u901a\u8ca8\u5e02\u5834\u5168\u4f53\u306b\u5bfe\u3057\u3066\u5f71\u97ff\u3057\u3066\u3044\u308b\u3002\n- \u682a\u4fa1\u3068\u540c\u69d8\u306b\u3001\u901a\u8ca8\u306e\u4fa1\u683c\u306f\u30e9\u30f3\u30c0\u30e0\u30a6\u30a9\u30fc\u30af\u30d1\u30bf\u30fc\u30f3\u306b\u5f93\u3063\u3066\u3044\u308b\u3088\u3046\u306b\u3082\u898b\u3048\u308b\u3002\n\n<br>","79cb6d1e":"Asset_ID\u3068\u6697\u53f7\u901a\u8ca8\u306e\u5bfe\u5fdc<br>\nWeight\u306f\u3001\u76ee\u7684\u5909\u6570\u3068\u306a\u3063\u3066\u3044\u308bLogReturn\u3092\u7b97\u51fa\u3059\u308b\u969b\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002","80177a6c":"### \u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u7279\u5fb4\u91cf\u53d6\u5f97\u3001\u4e88\u6e2c\nCrypto\u30b3\u30f3\u30da\u3067\u306f\u3001\u30c7\u30fc\u30bf\u3068\u4e00\u7dd2\u306b\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308bgresearch_crypto Python module\u3092\u4f7f\u7528\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002<br>\n\u3053\u308c\u306f\u3001\u5c06\u6765\u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u3066\u4e88\u6e2c\u3092\u884c\u308f\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3067\u3042\u308b\u3088\u3046\u3067\u3059\u3002<br>\n[API Introduction](https:\/\/www.kaggle.com\/sohier\/detailed-api-introduction)\u306b\u8a18\u8f09\u306e\u901a\u308a\u3001prediction\u3092\u884c\u3044\u307e\u3059\u3002<br>","69aa2166":"# G-Research Crypto forecasting competition","823fa1dd":"### \u30c7\u30fc\u30bf\u6982\u8981\u78ba\u8a8d","64861e33":"### \u5b66\u7fd2\n\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308bupper_shadow\u3068lower_shadow\u3068\u7279\u5fb4\u91cf\u306b\u52a0\u3048\u3066\u307f\u307e\u3059\u3002<br>\n\u901a\u8ca8\u6bce\u3067\u7279\u5fb4\u304c\u7570\u306a\u308b\u306e\u3067\u3001\u5b66\u7fd2\u3082\u901a\u8ca8\u6bce\u306b\u5206\u3051\u3066\u884c\u3044\u307e\u3059\u3002","cfffb73c":"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3092\u53c2\u8003\u306b\u3001submission\u63d0\u51fa\u307e\u3067\u3092\u30b7\u30f3\u30d7\u30eb\u306a\u30e2\u30c7\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002<br>\n\n**\u53c2\u8003**\n- [Tutorial to the G-Research Crypto Competition](https:\/\/www.kaggle.com\/cstein06\/tutorial-to-the-g-research-crypto-competition)\n- [Data Description](https:\/\/www.kaggle.com\/c\/g-research-crypto-forecasting\/data)\n- [Detailed API Introduction](https:\/\/www.kaggle.com\/sohier\/detailed-api-introduction)\n\n\u65e5\u672c\u8a9eEDA\uff1a[\u3010\u65e5\u672c\u8a9e\u3011G-research_Data_Outline](https:\/\/www.kaggle.com\/kitopl\/g-research-data-outline)<br>","cec995f4":"- **timestamp**\uff1a1970-01-01 00:00:00.000 UTC\u304b\u3089\u306e\u7d4c\u904e\u79d2\u6570\u3092\u793a\u3059\u3002\u30c7\u30fc\u30bf\u306f\u5206\u30b9\u30b1\u30fc\u30eb\u306e\u305f\u3081\u300160\u306e\u500d\u6570\u306b\u306a\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n- **Asset_ID**\uff1a\u6697\u53f7\u901a\u8ca8\u3092\u8b58\u5225\u3059\u308bID(\u4f8b\uff1a\u30d3\u30c3\u30c8\u30b3\u30a4\u30f3\u306e\u5834\u5408\u306fAsset_ID = 1)\u3002 Asset_ID\u3068\u6697\u53f7\u901a\u8ca8\u306e\u5bfe\u5fdc\u95a2\u4fc2\u306fasset_details.csv\u3067\u53c2\u7167\u3067\u304d\u307e\u3059\u3002\n- **Count**\uff1a\u6642\u9593\u9593\u9694\uff08\u76f4\u524d\uff09\u306e\u53d6\u5f15\u306e\u7dcf\u6570\u3002\n- **Open**\uff1a\u6307\u5b9a\u6642\u9593\u9593\u9694\u306b\u304a\u3051\u308b\u59cb\u5024(USD)\u3002\n- **High**\uff1a\u6307\u5b9a\u6642\u9593\u9593\u9694\u306b\u304a\u3051\u308b\u6700\u9ad8\u4fa1\u683c(USD)\u3002\n- **Low**\uff1a\u6307\u5b9a\u6642\u9593\u9593\u9694\u306b\u304a\u3051\u308b\u6700\u4f4e\u4fa1\u683c(USD)\u3002\n- **Close**\uff1a\u6307\u5b9a\u6642\u9593\u9593\u9694\u306b\u304a\u3051\u308b\u7d42\u5024(USD)\u3002\n- **Volume**\uff1a\u8cfc\u5165\u307e\u305f\u306f\u8ca9\u58f2\u3055\u308c\u305f\u901a\u8ca8\u306e\u6570\u91cf\u3002\n- **VWAP**\uff1a\u6307\u5b9a\u6642\u9593\u9593\u9694\u306b\u304a\u3051\u308b\u901a\u8ca8\u306e\u91cd\u307f\u3065\u3051\u5e73\u5747\u4fa1\u683c\u3002\n- **Target**\uff1a15\u5206\u9593\u306e\u5bfe\u6570\u53ce\u76ca\u7387\u304b\u3089\u7b97\u51fa\u3002\ntimestamp\u3001Asset_ID\u306e\u8907\u5408\u30ad\u30fc\u304c\u3001\u30c7\u30fc\u30bf\u3092\u8b58\u5225\u3059\u308b\u30a4\u30f3\u30c7\u30c3\u30af\u306b\u306a\u308a\u307e\u3059\u3002"}}