{"cell_type":{"32055450":"code","fa9e9bb1":"code","ce0f621f":"code","d74b682a":"code","04f2e7f7":"code","37835892":"code","f577c5be":"code","bc118412":"markdown","4aa4954c":"markdown","e7bb541b":"markdown","60a5ff57":"markdown","4c393160":"markdown","172807d5":"markdown","446ef441":"markdown","66a789bd":"markdown","37503fe0":"markdown","4fc27442":"markdown"},"source":{"32055450":"from fastai.vision.all import *\n\nseed = 42\nset_seed(seed, reproducible=True)","fa9e9bb1":"path = Path('..\/input\/plant-pathology-2021-fgvc8')\nmodels_path = Path('..\/input\/plant-models')\n\nmodels = [models_path\/f'resnet50_foldx{i}.pkl' for i in range(1)]\nmodels","ce0f621f":"def get_x(x): return str(path\/'test_images') + os.path.sep + x['image']\ndef get_y(y): return y['labels']","d74b682a":"## Data\nsample = pd.read_csv(path\/'sample_submission.csv')\nsample","04f2e7f7":"predictions = 0\nfor m in models:\n    learner = load_learner(m, cpu=False).to_fp32()\n    test_dl = learner.dls.test_dl(sample)\n    preds, _ = learner.tta(dl=test_dl)\n    predictions += preds\n    \npredictions \/= len(models)\npredictions","37835892":"vocab = learner.dls.vocab\npreds_dec = [vocab[i] for i in predictions.argmax(1)]\npreds_dec","f577c5be":"sample['labels'] = preds_dec\nsample.to_csv('submission.csv',index=False)\nsample","bc118412":"Next, we will need to define `get_x` and `get_y`. \n\n**Explanation:** When we export a fastai model, it saves everything (quite literally). Along with the model, the dataloader and its configurations are also saved. There is only one caveat, we cannot pickle functions. Hence, we will have to define them again. ","4aa4954c":"WoooWW! Thank you show much for sticking with me till the end. \n\nI wish you learnt something new. Please consider **upvoting** the notebook. Its will encourage me to write more such kernels. See you around, Bye!","e7bb541b":"We trained a ResNet50 model in the [training notebook](https:\/\/www.kaggle.com\/ankursingh12\/fastai-plant2021-training). In this notebook, we will do the inference part. Are you excited? because I am \ud83d\ude01\n\nLets import fastai & set the seed for reproducibility.","60a5ff57":"It worked as expected! We are not done yet. Lets update our submission file ","4c393160":"### Submission","172807d5":"Lets initialize our path variable","446ef441":"We are all set to make predictions","66a789bd":"## Predictions","37503fe0":"These predictions are not usable. We will have to convert them their corresponding labels. Please check the [competition home page](https:\/\/www.kaggle.com\/c\/plant-pathology-2021-fgvc8\/overview\/evaluation) for details about submission format. ","4fc27442":"time to load the model and assign test set."}}