{"cell_type":{"5d91b104":"code","5d00c7a5":"code","10a3b9f8":"code","b63b611e":"code","7bc0c32c":"code","a6772e9f":"code","4a8bc277":"code","4159c3cd":"code","a4348032":"code","d0649daf":"code","caf5afb4":"code","6ae8ff1e":"code","f9c0dc3b":"code","7cf6071a":"code","ab2d77fb":"code","65be6026":"code","e7dac33b":"code","a9298bc7":"code","71a86cf5":"code","08634239":"code","a8bb8817":"code","3d5b96a6":"code","9c9fe3a9":"code","759cf6f9":"code","046fdb7b":"code","010372d7":"code","ca0de734":"code","c4c03f1d":"markdown","ed641c64":"markdown","ecbbe83a":"markdown","6125f3e7":"markdown","743aaadf":"markdown","aa4bed78":"markdown","e569594d":"markdown","87ab62ac":"markdown","6af366b2":"markdown","ce8cc0dc":"markdown","26f28205":"markdown","fc0e5492":"markdown","f1b28679":"markdown","39c15d3d":"markdown","90a289c4":"markdown","0f08d6b7":"markdown","0eaff6d2":"markdown","a7b0f76a":"markdown","a5963663":"markdown","5482223b":"markdown","80079708":"markdown","d734e808":"markdown","87832ba0":"markdown","72246864":"markdown","e7fb85f9":"markdown"},"source":{"5d91b104":"import json\nimport pandas as pd\nimport plotly.express as px\nimport geopandas as gpd","5d00c7a5":"with open('..\/input\/malaysia-vaccination-progress\/Malaysia.geojson') as file:\n    states = json.load(file)","10a3b9f8":"gpd.read_file('..\/input\/malaysia-vaccination-progress\/Malaysia.geojson').plot()","b63b611e":"registered = pd.read_csv('..\/input\/malaysia-vaccination-progress\/Registered.csv')\npopulation = pd.read_csv('..\/input\/malaysia-vaccination-progress\/Malaysia_Population_18yo.csv')\nvaccinated = pd.read_csv('..\/input\/malaysia-vaccination-progress\/Vaccination.csv')","7bc0c32c":"registered.head()","a6772e9f":"registered=pd.melt(registered,id_vars='date',value_vars=[i for i in list(registered.columns) if i !='date'],\n        var_name='state',value_name='registered').sort_values(by=['date','state']).reset_index(drop=True)","4a8bc277":"registered.head(20)","4159c3cd":"registered=registered.join(population.set_index('state'),on='state')\nregistered['percentage']=registered['registered']\/registered['population']","a4348032":"registered.head()","d0649daf":"vaccinated.head()","caf5afb4":"vaccinated1=vaccinated[[i for i in list(vaccinated.columns) if 'dose1' in i or i=='date']]","6ae8ff1e":"vaccinated1.head()","f9c0dc3b":"state = [i.split('_')[1] for i in vaccinated1.columns[1:]]","7cf6071a":"state","ab2d77fb":"state.insert(0,'date')","65be6026":"vaccinated1.columns=state","e7dac33b":"vaccinated1.head()","a9298bc7":"vaccinated1=pd.melt(vaccinated1,id_vars='date',value_vars=[i for i in list(vaccinated1.columns) if i != 'date'],\n        var_name='state',value_name='dose1').sort_values(by=['date','state']).reset_index(drop=True)","71a86cf5":"vaccinated1.head(20)","08634239":"vaccinated2=vaccinated[[i for i in list(vaccinated.columns) if 'dose2' in i or i=='date']]\nvaccinated2.columns=state\nvaccinated2=pd.melt(vaccinated2,id_vars='date',value_vars=[i for i in list(vaccinated2.columns) if i != 'date'],\n        var_name='state',value_name='dose2').sort_values(by=['date','state']).reset_index(drop=True)","a8bb8817":"vaccinated2.tail(20)","3d5b96a6":"fig = px.choropleth(population, geojson=states, locations='state', \n                    featureidkey=\"properties.short\",\n                    color = 'population',\n                    color_continuous_scale=\"Viridis\",\n                    center = {\"lat\": 6, \"lon\": 100.7129},\n                    title = \"Malaysia Population by State (Aged 18 and above)\")\nfig.update_geos(fitbounds=\"locations\", visible=False)\nfig.show()","9c9fe3a9":"fig = px.choropleth(registered.tail(16), geojson=states, locations='state', \n                    featureidkey=\"properties.short\",\n                    color = 'percentage',\n                    range_color=(0, 0.5),\n                    color_continuous_scale=\"Viridis\",\n                    center = {\"lat\": 6, \"lon\": 100.7129},\n                    title = \"Total Registration on {} (by Percentage)\".format(registered.tail(16).iloc[0]['date']))\nfig.update_geos(fitbounds=\"locations\", visible=False)\nfig.show()","759cf6f9":"fig = px.choropleth(registered.tail(16), geojson=states, locations='state', \n                    featureidkey=\"properties.short\",\n                    color = 'percentage',\n                    range_color=(0, 0.5),\n                    color_continuous_scale=\"Viridis\",\n                    center = {\"lat\": 6, \"lon\": 100.7129},\n                    hover_name=\"state\", \n                    hover_data={\n                        'state': False,\n                        'date': False,\n                        'population': False,\n                        'registered': True,\n                        'percentage': ':.2%'\n                    },\n                    title = \"Total Registration on {} (by Percentage)\".format(registered.tail(16).iloc[0]['date']))\nfig.update_geos(fitbounds=\"locations\", visible=False)\nfig.show()","046fdb7b":"import plotly.express as px\n\nfig = px.choropleth(registered, geojson=states, locations='state', \n                    featureidkey=\"properties.short\",\n                    color='percentage',\n                    animation_frame='date',\n                    color_continuous_scale=\"Viridis\",\n                    center = {\"lat\": 6, \"lon\": 100.7129},\n                    hover_name=\"state\", \n                    hover_data={\n                        'state': False,\n                        'date': False,\n                        'population': False,\n                        'registered': True,\n                        'percentage': ':.2%'\n                    },\n                    title = \"Total Registration by State\")\nfig.update_geos(fitbounds=\"locations\", visible=False)\nfig.show()","010372d7":"import plotly.io as pio\npio.write_html(fig, file='registration.html', auto_open=True,include_plotlyjs=\"cdn\")","ca0de734":"!curl --upload-file .\/registration.html https:\/\/transfer.sh\/registration.html","c4c03f1d":"Now, let's remove the annoying `dose1_` in front of every state name. Let's do so by splitting the string with `split`. Since every column after date is state name, let's repeat them. Let's see how it works.","ed641c64":"As you can observed above, the data is stored by states, which is not good for map plotting. The ideal plotting data should be having columns of `date`, `state` and `number`. Not a big deal, you can do that with `pandas`. Here we use `melt()` function, where it is used to unpivot a DataFrame from wide to long format. Then, we sort the 'melted' DataFrame by date and then by state with `sort_values()`. Lastly, we reset the index and drop the index column with `reset_index()`.","ecbbe83a":"Note:\n1. As you might observed, we pass in `registered.tail(16)` as our data. Because we would like to take the latest data available.\n2. `featureidkey=\"properties.short\"` is used to find the corresponding state polygon area in our GeoJSON file. In out GeoJSON file, there's a aspecial key called `short` in the `properties` field.\n3. `.format()` is used to format a string. `\"String is {}\".format(x)` will inject the variable `x` into the `{}`.\n4. `hover_data` is passed in with a dict. The dict key is the `registered` DataFrame. `True` represents that the data is needed to show in the tooltip, and vice-versa. The `:.2%` is a d3-string formatting, telling that 'showing as percentage with 2 decimal points'.","6125f3e7":"<h1 style=\"background-color: #3CB64B;text-align:center; font-family: 'Poppins'\">Data Visualization<\/h1>","743aaadf":"<h1 style=\"font-weight: 700;font-family: 'Poppins'; text-align: center; font-size: 37px;\">\n    NATIONAL COVID-19 IMMUNISATION PROGRESS\n<\/h1>\n\n<img src=\"https:\/\/c.files.bbci.co.uk\/53A9\/production\/_115371412_gettyimages-1265248637.jpg\" width=\"400px\" \/>\n\n<br \/>\n\n<h1 style=\"\n    font-weight: 700;\n    font-family: 'Poppins';\n    font-size: 23px;\n           text-align: center;\">\n    <span style=\"color: #3CB64B;\">#LINDUNG DIRI, <\/span><span>LINDUNG SEMUA.<\/span>\n<\/h1>\n\n<div style=\"text-align: center; font-size:40px;\"><span>&#183; <\/span><span>&#183; <\/span><span>&#183; <\/span><\/div>","aa4bed78":"### Visualization 3: Visualize Latest Vaccination Data by state!","e569594d":"### Visualization 1: Visualize Population by state!","87ab62ac":"Perfect! Next, we want to have the percentage of population, how do we do that? \n1. We append the population by state to every row. We use `join()` function to join the `registered` DataFrame with `population` DataFrame, on the column of `state`.\n2. We divide the number registered with population. \n","6af366b2":"<p style=\"text-align:center; font-size:18px;\">Bored of looking images below?<\/p>\n\n<div style=\"display:flex;\">\n<img src=\"https:\/\/scontent.fkul8-1.fna.fbcdn.net\/v\/t1.6435-9\/165277391_126509419440613_769630491692162842_n.png?_nc_cat=110&ccb=1-3&_nc_sid=730e14&_nc_ohc=HbtP1RuC9J4AX8uKpBA&_nc_ht=scontent.fkul8-1.fna&oh=3fb79e89c66403e78d229f557fa03609&oe=608C14F2\" width=\"300px\" \/> \n<img src=\"https:\/\/scontent.fkul8-1.fna.fbcdn.net\/v\/t1.6435-9\/165593227_126508386107383_8475892755212741435_n.png?_nc_cat=109&ccb=1-3&_nc_sid=730e14&_nc_ohc=uiRq4H8cSg0AX_F5Umt&_nc_ht=scontent.fkul8-1.fna&oh=c54370e5ff47594b042477365494a57f&oe=608CE878\" width=\"300px\" \/>\n<\/div>\n\n<br \/>\n<p style=\"text-align:center;\">In this notebook, we will be learning to visualize daily vacciation and registered data with Python. Instead of just looking at images posted in JKJAV daily, why not make it yourself in Python!<\/p>\n\n<div style=\"text-align: center; font-size:40px;\"><span>&#183; <\/span><span>&#183; <\/span><span>&#183; <\/span><\/div>","ce8cc0dc":"### Vaccination Data Preparation","26f28205":"### Registration Data Preparation","fc0e5492":"Let's ANIMATE!","f1b28679":"First, let's import all the library we will be using. We will be using `json` to read our GeoJSON file, a file of which outline Malaysia Map, more on that later; `pandas` to read CSV file; `plotly` to plot our interactive maps; and `geopandas` to plot the GeoJSON file.","39c15d3d":"It's huge!! Let's break down into 2 smaller DataFrame, called `vaccinated1` and `vaccinated2` for 1 dose receipients and 2 doses receipients respectively. To do so, let's select columns that has `dose1` in the column name and `dat`, as shown below.","90a289c4":"Let's take a look into our vaccinated DataFrame. ","0f08d6b7":"Let's go!!","0eaff6d2":"<h1 style=\"background-color: #3CB64B;text-align:center; font-family: 'Poppins'\">Preparation & Data Source<\/h1>","a7b0f76a":"Nicely done!, Let's append `date` into the first position of the `state` list, and then rename our DataFrame column name.","a5963663":"Let's repeat for dose 2!","5482223b":"### Visualization 2: Visualize Latest Registered Data by state!","80079708":"Read all three CSV files.\n\n- `registered` is the total registered citizen by states daily.\n- `population` is the population with age 18 and above by states.\n- `vaccinated` is the number of citizen that is vaccinated by state. The dataset contains 1st dose and 2nd dose data.\n\nYou could see the sample of the DataFrame with `head()`.","d734e808":"Let's read the GeoJSON file and load into `states`. The next cell shows that we could read with `geopandas` and plot it out as shown.","87832ba0":"Perfect! Let's melt our DataFrame like before!","72246864":"DIY!","e7fb85f9":"Is there something else we can do? I want to see the number and percentage too! "}}