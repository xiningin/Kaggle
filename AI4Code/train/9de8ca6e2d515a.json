{"cell_type":{"3c557240":"code","791946e8":"code","e0a8d183":"code","5fcbd895":"code","cac35ac9":"code","332040b6":"code","02bda6f2":"code","fc13d079":"code","8d19a8d6":"code","5a838c8a":"code","4374f123":"code","2d4a9f8f":"code","2b96f871":"code","17e6a492":"code","ff107e35":"markdown"},"source":{"3c557240":"import numpy as np \nimport pandas as pd \nimport sys\nimport os\nimport itertools\n\nsys.path.append('\/kaggle\/input\/mod-efficientdet\/')\nsys.path.append('\/kaggle\/input\/eff-torch\/')","791946e8":"cp -r \/kaggle\/input\/cocoapi\/* \/tmp","e0a8d183":"cd \/tmp\/PythonAPI","5fcbd895":"!make","cac35ac9":"from infer_detector import Infer","332040b6":"gtf = Infer()","02bda6f2":"gtf.Model(model_dir=\"\/kaggle\/input\/gwd-starter-efficientdet-train\/trained\/\")","fc13d079":"img_path = \"\/kaggle\/input\/global-wheat-detection\/test\/cc3532ff6.jpg\"\nduration, scores, labels, boxes = gtf.Predict(img_path, ['wheat'], vis_threshold=0.7);","8d19a8d6":"from IPython.display import Image\nImage(filename='output.jpg') ","5a838c8a":"TEST_PATH = '\/kaggle\/input\/global-wheat-detection\/test\/'\ntest_ids = os.listdir(TEST_PATH)","4374f123":"res = []\nfor idx, row in enumerate(test_ids):\n    img_path = TEST_PATH + row\n    duration, scores, labels, boxes = gtf.Predict(img_path, ['wheat'], vis_threshold=0.5)\n    \n    sc = len(scores[scores > 0.5])\n    \n    b = boxes[:sc].cpu().numpy()\n    s = scores[:sc].cpu().numpy()\n    \n    bs = []\n    for i, el in enumerate(b):\n        el = list(map(int, el)) \n        el[2] = el[2] - el[0]\n        el[3] = el[3] - el[1]\n        el.insert(0, s[i])      \n        bs.append(el)        \n\n    \n    rl = list(itertools.chain.from_iterable(bs))\n    rs = ' '.join(str(e) for e in rl)\n    \n    \n    dres = {\n            'image_id': row.split('.')[0],\n            'PredictionString': rs\n            }   \n        \n    res.append(dres)     ","2d4a9f8f":"test_df = pd.DataFrame(res, columns=['image_id', 'PredictionString'])\ntest_df.head()","2b96f871":"cd \/kaggle\/working","17e6a492":"test_df.to_csv('submission.csv', index=False)","ff107e35":"Train kernel: https:\/\/www.kaggle.com\/ateplyuk\/gwd-starter-efficientdet-train"}}