{"cell_type":{"02f49582":"code","a39af0a6":"code","fdaca331":"code","c3224d0d":"code","747f59b2":"code","8ed1d835":"code","b733c9ce":"code","5309baf2":"code","49c1a14c":"code","c1bae1da":"code","89bb8a04":"code","184949d0":"code","48c45f62":"code","0e57bdea":"code","34bcf65e":"code","8bdaacef":"code","2334c7a1":"code","0d4b410c":"code","e93eb0c8":"code","8c55ad3c":"code","d4d751c1":"code","2faba207":"code","5651dcbd":"code","e192b9fd":"code","bd4d2463":"code","9b0dcc68":"code","a9b2e8d1":"code","ba4213f8":"code","27c9ff86":"code","5ec1f217":"code","9d4c72e9":"code","469984dd":"code","8ea0b039":"code","2dac83e4":"code","f72b44e4":"code","5ba0ddfb":"code","5cfdd6c2":"code","6c657438":"code","c90c2f26":"code","1a53ff7f":"code","da351074":"markdown","be3ff426":"markdown","35cd39c9":"markdown","f9d5d86a":"markdown","6966b2ea":"markdown","17bb1e37":"markdown","c5f2854a":"markdown","0da3200f":"markdown","05d4cc26":"markdown","511180d8":"markdown","f395c542":"markdown","5f546c37":"markdown","0168e02a":"markdown","be86057e":"markdown","c05ecd31":"markdown","79cf6c7a":"markdown","af968298":"markdown","a5ed1027":"markdown","4ae8b5a3":"markdown","021259b3":"markdown","328b88fd":"markdown","38ab794d":"markdown","33cc6801":"markdown","fc51fc07":"markdown","dc7c04a3":"markdown","f31302fe":"markdown","881804f1":"markdown","e4085056":"markdown","1b4b56da":"markdown","27318a47":"markdown","879e4ecf":"markdown","d658a0a0":"markdown","3e5aa59b":"markdown","9247c756":"markdown","2a3201f4":"markdown","2d28a31d":"markdown","e9a33cf1":"markdown"},"source":{"02f49582":"import numpy as np \nimport pandas as pd \nimport seaborn as sns\nimport datetime\nimport matplotlib.pyplot as plt\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.linear_model import LinearRegression\nfrom lightgbm import LGBMRegressor","a39af0a6":"data = pd.read_csv('..\/input\/renfe.csv', index_col=0)\ndata.head()","fdaca331":"data.info()","c3224d0d":"data.isnull().sum()","747f59b2":"data['price'].fillna(data['price'].mean(),inplace=True)","8ed1d835":"data.dropna(inplace=True)","b733c9ce":"data.drop('insert_date',axis=1,inplace=True)","5309baf2":"data.isnull().sum()","49c1a14c":"fig,ax = plt.subplots(figsize=(15,5))\nax = sns.countplot(data['origin'])\nplt.show()","c1bae1da":"fig,ax = plt.subplots(figsize=(15,5))\nax = sns.countplot(data['destination'])\nplt.show()","89bb8a04":"fig,ax = plt.subplots(figsize=(15,6))\nax = sns.countplot(data['train_type'])\nplt.show()","184949d0":"fig,ax = plt.subplots(figsize=(15,6))\nax = sns.countplot(data['train_class'])\nplt.show()","48c45f62":"fig,ax = plt.subplots(figsize=(15,6))\nax = sns.countplot(data['fare'])\nplt.show()","0e57bdea":"f,ax = plt.subplots(figsize=(15,6))\nax = sns.distplot(data['price'],rug=True)\nplt.show()","34bcf65e":"f,ax = plt.subplots(figsize=(15,6))\nax = sns.boxplot(x='train_class',y='price',data=data)\nplt.show()","8bdaacef":"f,ax = plt.subplots(figsize=(15,6))\nax = sns.boxplot(x='train_type',y='price',data=data)\nplt.show()","2334c7a1":"data = data.reset_index()","0d4b410c":"datetimeFormat = '%Y-%m-%d %H:%M:%S'\ndef fun(a,b):\n    diff = datetime.datetime.strptime(b, datetimeFormat)- datetime.datetime.strptime(a, datetimeFormat)\n    return(diff.seconds\/3600.0)\n    ","e93eb0c8":"data['travel_time_in_hrs'] = data.apply(lambda x:fun(x['start_date'],x['end_date']),axis=1) ","8c55ad3c":"data.drop(['start_date','end_date'],axis=1,inplace=True)\ndata.head()","d4d751c1":"df1 = data[(data['origin']==\"MADRID\") & (data['destination']==\"SEVILLA\")]\ndf1.head()","2faba207":"f,ax = plt.subplots(figsize=(15,6))\nax = sns.barplot(x=\"train_type\",y=\"travel_time_in_hrs\",data=df1)\nplt.show()","5651dcbd":"f,ax = plt.subplots(figsize=(15,6))\nax = sns.boxplot(x=\"train_type\",y=\"price\",data=df1)\nplt.show()","e192b9fd":"df1 = data[(data['origin']==\"MADRID\") & (data['destination']==\"BARCELONA\")]\ndf1.head()","bd4d2463":"f,ax = plt.subplots(figsize=(15,6))\nax = sns.barplot(x=\"train_type\",y=\"travel_time_in_hrs\",data=df1)\nplt.show()","9b0dcc68":"f,ax = plt.subplots(figsize=(15,6))\nax = sns.boxplot(x=\"train_type\",y=\"price\",data=df1)\nplt.show()","a9b2e8d1":"df1 = data[(data['origin']==\"MADRID\") & (data['destination']==\"VALENCIA\")]\ndf1.head()","ba4213f8":"f,ax = plt.subplots(figsize=(15,6))\nax = sns.barplot(x=\"train_type\",y=\"travel_time_in_hrs\",data=df1)\nplt.show()","27c9ff86":"f,ax = plt.subplots(figsize=(15,6))\nax = sns.boxplot(x=\"train_type\",y=\"price\",data=df1)\nplt.show()","5ec1f217":"df1 = data[(data['origin']==\"MADRID\") & (data['destination']==\"PONFERRADA\")]\ndf1.head()","9d4c72e9":"f,ax = plt.subplots(figsize=(15,6))\nax = sns.barplot(x=\"train_type\",y=\"travel_time_in_hrs\",data=df1)\nplt.show()","469984dd":"f,ax = plt.subplots(figsize=(15,6))\nax = sns.boxplot(x=\"train_type\",y=\"price\",data=df1)\nplt.show()","8ea0b039":"lab_en = LabelEncoder()\ndata.iloc[:,1] = lab_en.fit_transform(data.iloc[:,1])\ndata.iloc[:,2] = lab_en.fit_transform(data.iloc[:,2])\ndata.iloc[:,3] = lab_en.fit_transform(data.iloc[:,3])\ndata.iloc[:,5] = lab_en.fit_transform(data.iloc[:,5])\ndata.iloc[:,6] = lab_en.fit_transform(data.iloc[:,6])","2dac83e4":"data.head()","f72b44e4":"X = data.iloc[:,[1,2,3,5,6,7]].values\nY = data.iloc[:,4].values","5ba0ddfb":"X_train,X_test,Y_train,Y_test = train_test_split(X,Y,test_size=0.2,random_state=5)","5cfdd6c2":"lr = LinearRegression()\nlr.fit(X_train,Y_train)","6c657438":"lr.score(X_test,Y_test)","c90c2f26":"lg = LGBMRegressor(n_estimators=1000)\nlg.fit(X_train,Y_train)","1a53ff7f":"lg.score(X_test,Y_test)","da351074":"# Feature Engineering","be3ff426":"# 2. Bivariate Analysis","35cd39c9":"**\"Turista\"** is the train_class in which people travel in general. ","f9d5d86a":"# Splitting the data into training and test set","6966b2ea":"## Number of people having the following stations as destination","17bb1e37":"# Univariate Analysis","c5f2854a":"# Loading the dataset","0da3200f":"# 4. Travelling from MADRID to PONFERRADA","05d4cc26":"## train_class vs price","511180d8":"## Number of tickets bought from each category ","f395c542":"- The fastest trains on this route are AVE and AVE-TGV as they around 2-3 hours to reach the destination.\n- R.Express takes maximum time i.e. more than 8 hours and it is one of the cheapest one.","5f546c37":"We can see that **\"AVE\"** are runs maximum in number as compared to other train types.","0168e02a":"From the above graph we can visualize that maximum number of the people have **\"Madrid\"** as the station of origin.","be86057e":"## Dropping the rows containing Null values in the attributes train_class and fare","c05ecd31":"# Importing Libraries","79cf6c7a":"- The fastest train between Madrid and SEVILLA is AVE and even the costliest one and it takes approximately 2-2.4 hrs.\n- The cheapest train is MD-LD , even the slowest one and it takes above 7 hours to reach the destination.","af968298":"## 1. Number of people boarding from different stations","a5ed1027":"# Label Encoding","4ae8b5a3":"## Different types of train that runs in Spain ","021259b3":"# Applying Linear Regression","328b88fd":"## Finding the travel time between the place of origin and destination","38ab794d":"# 2. Travelling from MADRID to BARCELONA","33cc6801":"## train_type vs price","fc51fc07":"**\"Cama G. Clase\"** is the train class with the highest ticket price, and the tickets of this class are bought by least number of people.","dc7c04a3":"## Filling the Null values in the price column by taking the mean price of the ticket","f31302fe":"* From the above graph we can visualize that also maximum number of people are coming to **\"Madrid\"** as the most of the people have their destination station as **Madrid**.","881804f1":"# Applying Gradient Boosting","e4085056":"## Dropping irrelevant attributes","1b4b56da":"## Number of train of different class","27318a47":"- It takes minimum 4 hours to travel from MADRID to PONFERRADA\n- AVE-MD , AVE-LD , ALVIA they take almost same time which is the minimum time and also their ticket prices are same\n- There is no point travelling via MD-LD as it takes maximum time and have the most expensive tickets.","879e4ecf":"The average price of the tickets of train_type **AVE and AVE-TGV** are comparatilvely higher as compared to other train types.","d658a0a0":"# Checking for Null values in the dataset","3e5aa59b":"## Removing redundant features","9247c756":"# 1. Travelling from MADRID to SEVILLA","2a3201f4":"- AVE and ALVIA are two train_types which takes least amount of time to reach the destination, while MD-LD  takes maximum amount of time.\n- REGIONAL train have minimum ticket fare.\n- AVE is the best train to travel as it is the fastest train with less ticket pricing.","2d28a31d":"# 3. Travelling from MADRID to VALENCIA","e9a33cf1":"## Distribution of the ticket prices"}}