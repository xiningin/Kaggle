{"cell_type":{"2ff9c6e4":"code","afcf2605":"code","81de2d38":"code","8c1ef4b8":"code","e31250a5":"code","1e6cfff3":"code","53b046b8":"code","7ed9bc9b":"code","7e942ca0":"code","15ca8f0e":"code","e6783400":"code","0c881df4":"code","e529e251":"code","fcb6e953":"code","7df3a191":"code","b0a97561":"code","e8f89170":"code","c6a08f38":"code","bc003a1a":"code","2856b60b":"code","58a13b24":"code","39e5eeda":"code","05092cdd":"code","32a19889":"code","e57e5cb7":"code","bba65b64":"code","3e79f301":"code","43f9e85f":"code","7ba08177":"code","35ca3d5d":"code","0657f805":"code","ebcc32b9":"code","e69fd5a9":"code","acb60c0d":"code","51cb89e6":"code","7b79d7a6":"code","83df5831":"code","a122d87c":"code","1f549375":"code","57129642":"code","35513ee5":"code","20818d60":"code","ec3e1cda":"code","2c0e5a60":"code","f50b4c8b":"code","263dacbf":"code","48551cd1":"code","b1753d76":"code","10de0f66":"code","729c4804":"code","5fad9098":"code","237dd43e":"code","7753f192":"code","b263b1cb":"code","5c8746dc":"code","2aed4f15":"code","f0b8aaab":"code","8f7473d6":"code","2f11cbbd":"code","adf4bd41":"code","27c86549":"code","dc2a31c3":"code","8325467f":"code","3dea6849":"code","16ea1944":"code","62759026":"code","08f25e70":"code","9fb9898d":"code","c19dfd23":"code","387e4fbb":"code","0a2839af":"code","59c3d35e":"code","c8d3a143":"code","58980439":"code","127174cb":"code","e7be5b4a":"code","7f92167c":"code","ee703811":"code","a8964022":"code","2bcb3723":"code","a5ef8242":"code","007bde0a":"code","1d3a2856":"code","2ae551e0":"code","6193b79a":"code","74f8b933":"code","a8dc3436":"code","cc236259":"markdown","22c5870f":"markdown","2a684841":"markdown","55fc78c4":"markdown","89335151":"markdown"},"source":{"2ff9c6e4":"\nimport numpy as np \nimport pandas as pd  \n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","afcf2605":"import warnings\nwarnings.filterwarnings(\"ignore\")\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport missingno as msno\nimport scipy.stats as stats\nimport statsmodels.api as sm\nfrom sklearn.neighbors import LocalOutlierFactor\nfrom sklearn.preprocessing import StandardScaler,MinMaxScaler\nfrom sklearn.model_selection import train_test_split,cross_val_score,cross_val_predict\nfrom sklearn.linear_model import LinearRegression\nimport statsmodels.api as sm\nfrom sklearn.metrics import mean_squared_error,r2_score\nfrom sklearn.model_selection import train_test_split,ShuffleSplit,GridSearchCV,cross_val_score,cross_val_predict\nfrom numpy import log, log1p\nfrom scipy.stats import boxcox\nimport pylab\nfrom sklearn.linear_model import LinearRegression\n#! pip install yellowbrick\nfrom yellowbrick.regressor import residuals_plot,ResidualsPlot,RegressionScoreVisualizer\nfrom scipy.stats import shapiro,boxcox,yeojohnson\nfrom yellowbrick.regressor import prediction_error\n!pip install dython\nfrom dython import nominal\nfrom mlxtend.plotting import plot_linear_regression,plot_learning_curves\nfrom statsmodels.sandbox.regression.predstd import wls_prediction_std\nfrom statsmodels.stats.outliers_influence import variance_inflation_factor\n%matplotlib inline","81de2d38":"data=pd.read_csv(\"\/kaggle\/input\/insurance\/insurance.csv\")\ndf=data.copy()\n\ndf.head()","8c1ef4b8":"print(\"row :\",df.shape[0],\" \",\"column :\",df.shape[1])","e31250a5":"df.describe().T","1e6cfff3":"df.describe(include=[\"object\"]).T","53b046b8":"print(\"Sum of missing values :\",df.isnull().sum().sum())","7ed9bc9b":"df.eq(0).sum()","7e942ca0":"nominal.associations(df,figsize=(20,10),mark_columns=True,cmap=\"rainbow\");","15ca8f0e":"plt.rcParams.update({'font.size': 12})\nplt.figure(figsize=(10,5))\ncorr=df.corr()\nmask=np.zeros_like(corr,dtype=np.bool)\nmask[np.triu_indices_from(mask)]=True\nsns.heatmap(corr.abs(),annot=True,cmap=\"coolwarm\",mask=mask);","e6783400":"plt.figure(figsize=(12,5))\nplt.subplot(121)\nsns.distplot(df.charges,color=\"b\");\nplt.subplot(122)\nsns.distplot(log(df.charges),color=\"b\");\n\n","0c881df4":"sns.pairplot(df,kind=\"reg\",hue=\"smoker\",aspect=2);","e529e251":"sns.pairplot(df,kind=\"reg\",hue=\"sex\",aspect=2);","fcb6e953":"sns.relplot(x=\"bmi\",y=\"charges\",hue=\"smoker\",data=df,kind=\"scatter\",aspect=2);","7df3a191":"sns.relplot(x=\"bmi\",y=\"charges\",hue=\"children\",data=df,kind=\"scatter\",aspect=2,palette='coolwarm');","b0a97561":"sns.catplot(x=\"age\", y=\"charges\", hue=\"smoker\", data=df,aspect=3,kind=\"point\");","e8f89170":"sns.lmplot(x=\"bmi\", y=\"charges\", hue=\"smoker\", data=df,aspect=2);","c6a08f38":"plt.figure(figsize=(12,5));\nsns.jointplot(x=\"bmi\", y=\"charges\" ,data=df, kind=\"reg\");","bc003a1a":"plt.figure(figsize=(12,5));\nsns.jointplot(x=\"age\", y=\"bmi\" ,data=df);","2856b60b":"plt.figure(figsize=(12,5));\nsns.distplot(df.age);","58a13b24":"plt.figure(figsize=(12,5));\nstats.probplot(df.charges, dist=\"norm\", plot=pylab) ;","39e5eeda":"plt.figure(figsize=(12,5));\ndf.groupby(\"smoker\")[\"charges\"].mean().plot.bar(color=\"r\");","05092cdd":"plt.figure(figsize=(12,5));\ndf.groupby(\"children\")[\"charges\"].mean().plot.bar(color=\"g\");","32a19889":"print(sns.FacetGrid(df,hue=\"sex\",height=5,aspect=2).map(sns.kdeplot,\"charges\",shade=True).add_legend());","e57e5cb7":"print(sns.FacetGrid(df,hue=\"region\",height=5,aspect=2).map(sns.kdeplot,\"charges\",shade=False).add_legend());","bba65b64":"print(sns.catplot(x=\"sex\",y=\"charges\",hue=\"smoker\",data=df,kind=\"bar\",aspect=2));","3e79f301":"print(sns.catplot(x=\"sex\",y=\"charges\",hue=\"region\",data=df,kind=\"bar\",aspect=2));","43f9e85f":"sns.catplot(x=\"smoker\",y=\"charges\",data=df,kind=\"box\",aspect=2);","7ba08177":"sns.catplot(x=\"sex\",y=\"charges\",data=df,kind=\"box\",aspect=2);","35ca3d5d":"sns.catplot(x=\"sex\",y=\"charges\",hue=\"smoker\",data=df,kind=\"box\",aspect=2);","0657f805":"sns.catplot(x=\"region\",y=\"charges\",data=df,kind=\"box\",aspect=2);","ebcc32b9":"sns.catplot(x=\"children\",y=\"charges\",data=df,kind=\"box\",aspect=2);","e69fd5a9":"labels=[\"too_weak\",\"normal\",\"heavy\",\"too_heavy\"]\nranges=[0,18.5,24.9,29.9,np.inf]\ndf[\"bmi\"]=pd.cut(df[\"bmi\"],bins=ranges,labels=labels)","acb60c0d":"print(sns.FacetGrid(df,hue=\"bmi\",height=5,aspect=2).map(sns.kdeplot,\"charges\",shade=False).add_legend());","51cb89e6":"print(sns.catplot(x=\"bmi\",y=\"charges\",kind=\"bar\",data=df,aspect=2));","7b79d7a6":"print(sns.catplot(x=\"bmi\",y=\"charges\",hue=\"children\",kind=\"bar\",data=df,aspect=3));","83df5831":"print(sns.catplot(x=\"bmi\",y=\"charges\",hue=\"smoker\",data=df,kind=\"bar\",aspect=2));","a122d87c":"plt.rcParams.update({'font.size': 12})\nplt.figure(figsize=(10,5))\ncorr=df.corr()\nmask=np.zeros_like(corr,dtype=np.bool)\nmask[np.triu_indices_from(mask)]=True\nsns.heatmap(corr.abs(),annot=True,cmap=\"coolwarm\",mask=mask);","1f549375":"plt.figure(figsize=(15,5))\nplt.subplot(121)\nsns.boxplot(df[\"charges\"],color=\"y\");\nplt.subplot(122)\nsns.boxplot(df[\"age\"],color=\"y\");","57129642":"pd.crosstab(df.age,df.children)[:10]","35513ee5":"df[(df[\"age\"]==18)&(df[\"sex\"]==\"female\")&(df[\"children\"]>0)]","20818d60":"df[(df[\"age\"]==18)&(df[\"sex\"]==\"male\")&(df[\"children\"]>0)]","ec3e1cda":"clf=LocalOutlierFactor(n_neighbors=50)\nclf.fit_predict(df[[\"age\",\"children\"]])","2c0e5a60":"clf_scores=clf.negative_outlier_factor_","f50b4c8b":"np.sort(clf_scores)[0:20]","263dacbf":"treshold=np.sort(clf_scores)[20]","48551cd1":"df[clf_scores<treshold]","b1753d76":"df[(df[\"age\"]==18)&(df[\"children\"]>1)]","10de0f66":"df.drop(df[(df[\"age\"]==18)&(df[\"children\"]>0)].index,inplace=True)","729c4804":"df.corr()","5fad9098":"print(sns.catplot(x=\"children\",y=\"charges\",hue=\"smoker\",data=df,kind=\"bar\",aspect=3));","237dd43e":"df.shape","7753f192":"df.head()","b263b1cb":"df_new=df.copy()\ndf_new=pd.get_dummies(data=df,columns=[\"sex\",\"smoker\"],drop_first=True)","5c8746dc":"df_new.head()","2aed4f15":"df_new=pd.get_dummies(data=df_new,columns=[\"region\",\"bmi\"])","f0b8aaab":"df_new.head()","8f7473d6":"df_new.charges=log(df_new.charges)\n\nsc=StandardScaler()\ndf_scaled=pd.DataFrame(sc.fit_transform(df_new),columns=df_new.columns,index=df_new.index)\n\ndf_scaled.head()","2f11cbbd":"X=df_scaled.drop(\"charges\",axis=1)\ny=df_scaled[\"charges\"] ","adf4bd41":"X_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=42)","27c86549":"print(X_train.shape)\nprint(X_test.shape)\nprint(y_train.shape)\nprint(y_test.shape)","dc2a31c3":"lm=sm.OLS(y_train,X_train)\nmodel=lm.fit()\nmodel.summary()","8325467f":"sns.scatterplot(model.fittedvalues, model.resid);","3dea6849":"X=df_scaled.drop([\"charges\",\"region_northwest\"],axis=1)\ny=df_scaled[\"charges\"] \nX_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=42)\nlm=sm.OLS(y_train,X_train)\nmodel=lm.fit()\nmodel.summary()","16ea1944":"sns.scatterplot(model.fittedvalues, model.resid);","62759026":"X=df_scaled.drop([\"charges\",\"region_northwest\",\"bmi_heavy\"],axis=1)\ny=df_scaled[\"charges\"] \nX_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=42)\nlm=sm.OLS(y_train,X_train)\nmodel=lm.fit()\nmodel.summary()","08f25e70":"sns.scatterplot(model.fittedvalues, model.resid);","9fb9898d":"X=df_scaled.drop([\"charges\",\"region_northwest\",\"bmi_heavy\",\"bmi_too_weak\"],axis=1)\ny=df_scaled[\"charges\"] \nX_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=42)\nlm=sm.OLS(y_train,X_train)\nmodel=lm.fit()\nmodel.summary()","c19dfd23":"X=df_scaled.drop([\"charges\",\"region_northwest\",\"bmi_heavy\",\"bmi_too_weak\",\"bmi_normal\"],axis=1)\ny=df_scaled[\"charges\"] \nX_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=42)\nlm=sm.OLS(y_train,X_train)\nmodel=lm.fit()\nmodel.summary()","387e4fbb":"sns.scatterplot(model.fittedvalues, model.resid);","0a2839af":"X=df_scaled.drop([\"charges\",\"region_northwest\",\"bmi_heavy\",\"bmi_too_weak\",\"bmi_normal\",\"region_northeast\"],axis=1)\ny=df_scaled[\"charges\"] \nX_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=42)\nlm=sm.OLS(y_train,X_train)\nmodel=lm.fit()\nmodel.summary()","59c3d35e":"model.conf_int()","c8d3a143":"model.params","58980439":"fig = plt.figure(figsize=(12, 12))\nfig = sm.graphics.plot_partregress_grid(model,fig=fig)\nfig.tight_layout(pad=1.0)","127174cb":"fig = sm.graphics.plot_ccpr(model, \"age\")\nfig.tight_layout(pad=1.0)","e7be5b4a":"fig = plt.figure(figsize=(12, 12))\nfig = sm.graphics.plot_regress_exog(model, \"age\",fig=fig)\nfig.tight_layout(pad=1.0)","7f92167c":"sm.qqplot(model.resid,line=\"45\");","ee703811":"vif_data = pd.DataFrame()\nvif_data[\"feature\"] = X_train.columns\n  \nvif_data[\"VIF\"] = [variance_inflation_factor(X_train.values, i)\n                          for i in range(len(X_train.columns))]\nvif_data","a8964022":"model=LinearRegression()\nlin_mo=model.fit(X_train,y_train)\ny_pred=lin_mo.predict(X_test)","2bcb3723":"lin_mo.score(X_train,y_train)","a5ef8242":"lin_mo.score(X_test,y_test)","007bde0a":"r2_score(y_test,y_pred)","1d3a2856":"plt.figure(figsize=(12,5));\nax1=sns.distplot(y_test,hist=False)\nsns.distplot(y_pred,ax=ax1,hist=False);","2ae551e0":"plt.figure(figsize=(12,8));\nresiduals_plot(model, X_train, y_train, X_test, y_test,line_color=\"red\",qqplot=True,hist=False);","6193b79a":"plt.figure(figsize=(12,8));\nprediction_error(model, X_train, y_train, X_test, y_test);","74f8b933":"model.coef_","a8dc3436":"model.intercept_","cc236259":"# <font color='red'>MEDICAL COST EDA AND OLS REGRESSION<\/font>  ","22c5870f":"# <font color='blue'>Train Test Split <\/font>  ","2a684841":"# <font color='blue'>OLS Regression<\/font>  ","55fc78c4":"Actually, acording to this residual plot, model is not that appropiate for the data","89335151":"# <font color='blue'>Exploratory Data Analysis <\/font>  "}}