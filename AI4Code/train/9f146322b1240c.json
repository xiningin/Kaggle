{"cell_type":{"b082fcef":"code","d7e8707d":"code","5a938a8c":"code","761598ac":"code","bef93505":"code","d3b3bd5a":"code","129a4096":"code","cb15de96":"code","56513fd8":"code","f79fbd00":"code","6240e8b4":"markdown","a68179bd":"markdown","a9113d6a":"markdown","b038bd81":"markdown","6caf3222":"markdown","29c9497a":"markdown","0881ae40":"markdown","089fc92b":"markdown","c388c53f":"markdown"},"source":{"b082fcef":"import pandas as pd, numpy as np, os\nimport warnings\nimport random\nwarnings.filterwarnings('ignore')\npd.set_option('max_columns',None)\nimport gc\n\nfrom sklearn.metrics import roc_auc_score,auc, roc_curve\nfrom sklearn.experimental import enable_hist_gradient_boosting\nfrom sklearn.ensemble import GradientBoostingClassifier\nfrom sklearn.model_selection import KFold, StratifiedKFold","d7e8707d":"# helper functions\ndef get_auc(y_true, y_hat):\n    fpr, tpr, _ = roc_curve(y_true, y_hat)\n    score = auc(fpr, tpr)\n    return score\n\ndef seed_everything(seed=42):\n    random.seed(seed)\n    os.environ['PYTHONHASHSEED'] = str(seed)\n    np.random.seed(seed)","5a938a8c":"train = pd.read_csv(\"..\/input\/titanic\/train.csv\")\ntest = pd.read_csv(\"..\/input\/titanic\/test.csv\")","761598ac":"TARGET = 'Survived'\nFOLD = 5\nSEED = 42\nseed_everything(SEED)","bef93505":"drop_elements = ['PassengerId', 'Name', 'Ticket', 'Cabin', 'SibSp','Parch']\ntrain = train.drop(drop_elements, axis = 1)\ntest = test.drop(drop_elements, axis = 1)\n\ndef checkNull_fillData(df):\n    for col in df.columns:\n        if len(df.loc[df[col].isnull() == True]) != 0:\n            if df[col].dtype == \"float64\" or df[col].dtype == \"int64\":\n                df.loc[df[col].isnull() == True,col] = df[col].mean()\n            else:\n                df.loc[df[col].isnull() == True,col] = df[col].mode()[0]\n                \ncheckNull_fillData(train)\ncheckNull_fillData(test)\n\nstr_list = [] \nnum_list = []\nfor colname, colvalue in train.iteritems():\n    if type(colvalue[1]) == str:\n        str_list.append(colname)\n    else:\n        num_list.append(colname)\n        \ntrain = pd.get_dummies(train, columns=str_list)\ntest = pd.get_dummies(test, columns=str_list)","d3b3bd5a":"y = train['Survived']\nX = train.drop(['Survived'], axis=1)\nX_test = test","129a4096":"hist_params = {\n#     'l2_regularization': 1.3244040135051264e-10,\n#                'early_stopping': 'True',\n               'learning_rate': 0.01, \n#                'max_iter': 100, \n               'max_depth': 3, \n#                'max_bins': 129, \n#                'min_samples_leaf': 13449, \n#                'max_leaf_nodes': 68\n              }","cb15de96":"#check of all the columns in train is in test set\nassert X.columns.to_list() == X_test.columns.to_list()\n\nmeta_pred_tmp = []\nscores_tmp = []\n\n# create cv\nkf = StratifiedKFold(n_splits=FOLD, shuffle=False, random_state=SEED)\n\nfor fold, (idx_train, idx_valid) in enumerate(kf.split(X, y)):\n    # create train, validation sets\n    X_train, y_train = X.iloc[idx_train], y.iloc[idx_train]\n    X_valid, y_valid = X.iloc[idx_valid], y.iloc[idx_valid]\n    \n    model = GradientBoostingClassifier(**hist_params)\n    model.fit(X_train, y_train)\n    # validation prediction\n    pred_valid = model.predict_proba(X_valid)[:,1]\n    \n    score = get_auc(y_valid, pred_valid)\n    scores_tmp.append(score)\n    \n    print(f\"Fold: {fold + 1} Score: {score}\")\n    print('--'*20)\n    \n    # test prediction based on oof_set\n    y_hat = model.predict_proba(X_test)[:,1]\n    meta_pred_tmp.append(y_hat)\n# print overall validation scores\nprint(f\"Overall Validation Score | Meta: {np.mean(scores_tmp)}\")\nprint('::'*20)","56513fd8":"meta_predictions = np.mean(np.column_stack(meta_pred_tmp), axis=1)\nmeta_predictions[:20]","f79fbd00":"stacked_submission = pd.read_csv(\"..\/input\/titanic\/gender_submission.csv\")\nstacked_submission[TARGET] = (meta_predictions > 0.5).astype(int)\nstacked_submission.to_csv('.\/titanic_submission.csv', index=False)","6240e8b4":"# get mean of test predictions","a68179bd":"# global variables","a9113d6a":"# train and predict using StratifiedKFold","b038bd81":"# submission","6caf3222":"# common functions","29c9497a":"# preprocessing","0881ae40":"# split input and label ","089fc92b":"# load data","c388c53f":"# hyperparameters"}}