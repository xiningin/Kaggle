{"cell_type":{"7c61ef42":"code","d9421797":"code","6287f78f":"code","af0862cc":"code","6b40e7f4":"code","23ebffa5":"code","367722e7":"code","7523ebc1":"code","06a4ebb5":"code","fc766d1a":"code","b924300e":"code","0a9263eb":"code","e71c6c5a":"code","c8dd5c98":"code","d6d9de84":"code","00c9d3ce":"code","015a57af":"code","91791167":"code","2ed52735":"code","f55d032e":"code","97e56a3c":"code","12497553":"code","3b7acae4":"code","9c031ce3":"code","e2a60060":"code","f2bcd7bd":"code","788b5619":"code","ef6c9bb5":"code","42999b75":"code","6e6423cf":"code","269a6e1c":"code","52baa6d3":"code","4c6149d6":"code","060134c7":"code","08d2fb87":"code","6eedb093":"code","3405eeba":"code","a8440728":"code","26aa482a":"code","17025352":"code","2ad5d2e8":"code","c414e4eb":"code","2267a220":"code","e7152fb3":"code","77907a27":"code","a758778e":"code","2ddc163a":"code","e049d9a2":"code","d5429154":"code","6a344b68":"code","b809db9b":"code","f7e01703":"code","67c0cc9e":"code","dc60ad0e":"code","4508b980":"code","0bc24016":"code","ef19737b":"code","f992e59c":"code","9d78431a":"code","0b97880b":"code","10dbe823":"code","5adde614":"code","522dc031":"code","1355fbb4":"code","03e94b79":"code","881f1395":"markdown","d0a16d98":"markdown","440bfbf0":"markdown","35fd8a61":"markdown","dda9b43f":"markdown","40442ba1":"markdown","c6865610":"markdown","cea617d5":"markdown","4e56a199":"markdown","df511d3e":"markdown","cb75b5ea":"markdown","b9444c74":"markdown","d5697038":"markdown","caa3e820":"markdown","7be5cd74":"markdown","05535648":"markdown","c314e9eb":"markdown","19f75288":"markdown","4a54bf2b":"markdown","e7820467":"markdown","b80b1bac":"markdown","a785a3c8":"markdown","ecb991cf":"markdown","d90c9716":"markdown","d2d9ca85":"markdown","fc3567c3":"markdown","2127231f":"markdown","db740675":"markdown","797e27e1":"markdown","b511b5f7":"markdown","ddb201d4":"markdown","422132a5":"markdown","1a74e3c3":"markdown","8471e402":"markdown","afc1235a":"markdown","4612c2ab":"markdown","30087469":"markdown","246d7612":"markdown","496508fa":"markdown","924f3ac5":"markdown","8cd23473":"markdown","c92c8d0f":"markdown","54fa9627":"markdown","e72fdb7b":"markdown","9a040aa1":"markdown","af93b20f":"markdown","d4feffc8":"markdown","d68f66d7":"markdown","1f06e05e":"markdown"},"source":{"7c61ef42":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.cluster import KMeans\nimport matplotlib.colors\n%matplotlib inline","d9421797":"pd.set_option('display.max_columns', None)  \npd.set_option('display.expand_frame_repr', False)\npd.set_option('max_colwidth', -1)","6287f78f":"df=pd.read_csv(\"\/kaggle\/input\/open-exoplanet-catalogue\/oec.csv\")","af0862cc":"df.head()","6b40e7f4":"df.describe()","23ebffa5":"df.groupby(['DiscoveryMethod', 'DiscoveryYear']).size().unstack().T.fillna(0).astype(int).sort_values(by=['DiscoveryYear'])","367722e7":"numericCols=['PlanetaryMassJpt', 'RadiusJpt','PeriodDays', 'SemiMajorAxisAU', 'Eccentricity',\n                 'SurfaceTempK','HostStarMassSlrMass', 'HostStarRadiusSlrRad',\n                 'HostStarMetallicity','HostStarTempK','HostStarAgeGyr']\nfig, ax = plt.subplots(figsize=(10,10))\nax=sns.heatmap(df[numericCols].corr(), annot=True, linewidths=.5,square=True)\nprint(ax.get_ylim())\nax.set_ylim(10.0, 0) #Due to few cropping issues in seaborn","7523ebc1":"df.isna().mean().sort_values(ascending=False).head(15)*100","06a4ebb5":"fig, axes = plt.subplots(2, 2,figsize=(18,12))\naxes[0,0].hist(df[\"PlanetaryMassJpt\"],bins=100)\naxes[0,1].hist(df[\"RadiusJpt\"],bins=100)\naxes[1,0].hist(df[\"PeriodDays\"],bins=100)\naxes[1,1].hist(df[\"SemiMajorAxisAU\"],bins=100)\nplt.show()","fc766d1a":"df=df.dropna(subset=['PlanetaryMassJpt', 'RadiusJpt'])#Remove null values\nplt.scatter(df[\"RadiusJpt\"],df[\"PlanetaryMassJpt\"])","b924300e":"df[\"RadiusJpt\"].quantile(0.999)","0a9263eb":"dfremoved=df[df[\"RadiusJpt\"]<df[\"RadiusJpt\"].quantile(0.999)]\ndfremoved=dfremoved[dfremoved[\"PlanetaryMassJpt\"]<dfremoved[\"RadiusJpt\"].quantile(0.999)]\nplt.scatter(dfremoved[\"RadiusJpt\"],dfremoved[\"PlanetaryMassJpt\"])","e71c6c5a":"df[\"PlanetaryMassJptlog\"]=df[\"PlanetaryMassJpt\"].apply(np.log)\ndf[\"RadiusJptlog\"]=df[\"RadiusJpt\"].apply(np.log)\n\nplt.scatter(df[\"RadiusJptlog\"],df[\"PlanetaryMassJptlog\"])","c8dd5c98":"linearRegressor = LinearRegression()","d6d9de84":"xTrain=df[[\"RadiusJptlog\"]]\nyTrain=df[\"PlanetaryMassJptlog\"]","00c9d3ce":"linearRegressor.fit(xTrain,yTrain)","015a57af":"plt.scatter(xTrain, yTrain, color = 'red')\nplt.plot(xTrain, linearRegressor.predict(xTrain), color = 'blue')\nplt.title('Radius vs Mass of planets')\nplt.xlabel('log(Radius)')\nplt.ylabel('log(Mass)')\nplt.show()","91791167":"linearRegressor.score(xTrain,yTrain)","2ed52735":"linearRegressor.coef_","f55d032e":"linearRegressor.intercept_","97e56a3c":"km = KMeans(\n    n_clusters=2, init='random',\n    n_init=10, max_iter=300, \n    tol=1e-04, random_state=0\n)","12497553":"X=np.array(df[[\"RadiusJptlog\",\"PlanetaryMassJptlog\"]])\nX=X.reshape(-1,2)","3b7acae4":"km.fit(X)\ny_km = km.fit_predict(X)\n","9c031ce3":"plt.scatter(\n    X[y_km == 0, 0], X[y_km == 0, 1],\n    s=50, c='lightgreen',\n    edgecolor='black',\n    label='gas giants'\n)\n\nplt.scatter(\n    X[y_km == 1, 0], X[y_km == 1, 1],\n    s=50, c='orange',\n    edgecolor='black',\n    label='rocky planets'\n)\nplt.title('Radius vs Mass of planets')\nplt.xlabel('log(Radius)')\nplt.ylabel('log(Mass)')\n\nplt.legend(scatterpoints=1)\nplt.show()","e2a60060":"df[\"cluster\"]=y_km","f2bcd7bd":"df[\"MassRadiusLogRatio\"]=df[\"PlanetaryMassJptlog\"]\/df[\"RadiusJptlog\"]","788b5619":"df.groupby(\"cluster\").agg({\"MassRadiusLogRatio\":\"mean\"})","ef6c9bb5":"df[\"MassRadiusCubeRatio\"]=df[\"PlanetaryMassJpt\"]\/df[\"RadiusJpt\"]**3","42999b75":"df[\"MassRadiusCubeRatio\"].hist()","6e6423cf":"df.groupby(\"cluster\").agg({\"MassRadiusCubeRatio\":\"mean\"})","269a6e1c":"plt.boxplot([df[df[\"cluster\"]==0][\"MassRadiusCubeRatio\"],df[df[\"cluster\"]==1][\"MassRadiusCubeRatio\"]])\npositions = (1, 2)\nlabels = (\"Rocky planets\", \"Gas giants\")\nplt.ylabel('Density')\nplt.xticks(positions, labels)\nplt.show()","52baa6d3":"df=pd.read_csv(\"\/kaggle\/input\/open-exoplanet-catalogue\/oec.csv\")","4c6149d6":"plt.scatter(df[\"SemiMajorAxisAU\"],df[\"PeriodDays\"])","060134c7":"df=df.dropna(subset=['SemiMajorAxisAU', 'PeriodDays']) #Removing null values","08d2fb87":"df[\"SemiMajorAxisAUlog\"]=df[\"SemiMajorAxisAU\"].apply(np.log)\ndf[\"PeriodDayslog\"]=df[\"PeriodDays\"].apply(np.log)\nplt.scatter(df[\"SemiMajorAxisAUlog\"],df[\"PeriodDayslog\"])","6eedb093":"linearRegressor = LinearRegression()","3405eeba":"xTrain=df[[\"SemiMajorAxisAUlog\"]]\nyTrain=df[\"PeriodDayslog\"]","a8440728":"yTrain.shape","26aa482a":"xTrain.describe()","17025352":"yTrain.describe()","2ad5d2e8":"linearRegressor.fit(xTrain,yTrain)","c414e4eb":"plt.scatter(xTrain, yTrain, color = 'blue')\nplt.plot(xTrain, linearRegressor.predict(xTrain), color = 'red',linewidth=5.0)\nplt.title('Semi major axis vs time of orbit')\nplt.xlabel('log(Semimajor axis)')\nplt.ylabel('log(Time of orbit)')\nplt.show()","2267a220":"linearRegressor.score(xTrain,yTrain)","e7152fb3":"linearRegressor.coef_","77907a27":"linearRegressor.intercept_","a758778e":"df.head()","2ddc163a":"def linreg(x,y):\n    x=np.array(x).reshape(-1,1)\n    y=np.array(y)\n    linearRegressor = LinearRegression()\n    linearRegressor.fit(x,y)\n    return len(y),linearRegressor.score(x,y),linearRegressor.coef_[0],linearRegressor.intercept_\n    ","e049d9a2":"ra=\"\"\ndec=\"\"\nx=[]\ny=[]\ncounts=[]\nscores=[]\nslopes=[]\nintercepts=[]\n","d5429154":"for row in df.itertuples(index=True, name='Pandas'):\n    if(ra==getattr(row, \"RightAscension\") and dec==getattr(row, \"Declination\")):\n        x.append(getattr(row, \"SemiMajorAxisAUlog\"))\n        y.append(getattr(row, \"PeriodDayslog\"))\n    else:\n        if(len(x)>=2):\n            count,score,slope,intercept=linreg(x,y)\n            counts.append(count)\n            scores.append(score)\n            slopes.append(slope)\n            intercepts.append(intercept)\n\n        ra=getattr(row, \"RightAscension\")\n        dec=getattr(row, \"Declination\")\n        x=[getattr(row, \"SemiMajorAxisAUlog\")]\n        y=[getattr(row, \"PeriodDayslog\")]\n        \nlinreg_results=pd.DataFrame({\"Count\":counts,\"Score\":scores,\"Slope\":slopes,\"Intercept\":intercepts})  ","6a344b68":"linreg_results.head()","b809db9b":"linreg_results.describe()","f7e01703":"plt.boxplot(linreg_results[\"Slope\"])\nplt.show()","67c0cc9e":"linreg_results=linreg_results[linreg_results[\"Slope\"]<6]\nlinreg_results.describe()","dc60ad0e":"plt.hist(linreg_results[\"Slope\"])\nplt.show()","4508b980":"df[\"Luminosity\"]=df[\"HostStarRadiusSlrRad\"]**2*df[\"HostStarTempK\"]**4\ndf[\"Luminositylog\"]=np.log(df[\"Luminosity\"])","0bc24016":"cmap = matplotlib.colors.ListedColormap([\"blue\",\"blue\",\"blue\",\"blue\",\"yellow\",\"darkorange\",\"red\",\"red\",\"red\"][::-1])","ef19737b":"fig = plt.figure(figsize=(5, 5))\nplt.scatter(df[\"HostStarTempK\"],df[\"Luminositylog\"],c=df[\"HostStarTempK\"],s=100*df[\"HostStarRadiusSlrRad\"], cmap=\"coolwarm_r\",edgecolor='black', linewidth=0.2)\nplt.gca().invert_xaxis()\nplt.title('HR Diagram')\nplt.xlabel('HostStarTempK')\nplt.ylabel('log(luminosity)')\nplt.show()","f992e59c":"df=df[df[\"HostStarTempK\"]<25000]","9d78431a":"fig = plt.figure(figsize=(18, 12))\npoints=plt.scatter(df[\"HostStarTempK\"],df[\"Luminositylog\"],c=df[\"HostStarTempK\"],s=100*df[\"HostStarRadiusSlrRad\"], cmap=cmap,edgecolor='black', linewidth=0.5)\nplt.colorbar(points)\nplt.gca().invert_xaxis()\nplt.title('HR Diagram')\nplt.xlabel('HostStarTempK')\nplt.ylabel('log(luminosity)')\nplt.show()","0b97880b":"df['Luminosity'] = df['HostStarRadiusSlrRad']**2  * (df['HostStarTempK']\/5777)**4","10dbe823":"#add habitable zone boundaries\ndf['HabZoneOut'] = np.sqrt(df['Luminosity']\/0.53)\ndf['HabZoneIn'] = np.sqrt(df['Luminosity']\/1.1)","5adde614":"habitable_zone=df[(df[\"SemiMajorAxisAU\"]>df[\"HabZoneIn\"]) & (df[\"SemiMajorAxisAU\"]<df[\"HabZoneOut\"])]\nhabitable_zone","522dc031":"habitable_zone=habitable_zone[(habitable_zone[\"PlanetaryMassJpt\"]>0.0015) & (habitable_zone[\"PlanetaryMassJpt\"]<0.03)]\nhabitable_zone","1355fbb4":"habitable_zone[[\"PlanetIdentifier\",\"DistFromSunParsec\"]].sort_values(by=[\"DistFromSunParsec\"])","03e94b79":"df[df[\"ListsPlanetIsOn\"]==\"Solar System\"]","881f1395":"## Verifying keplers 3rd law","d0a16d98":"### Cuurently Transit method has become the most popular method for finding exoplanets","440bfbf0":"**If you want to know where these values came from check out this paper**\n\nKasting, James; Whitmire, Daniel; and Reynolds, Ray (1993). Habitable zones around main sequence stars. Icarus 101: 108-128.","35fd8a61":"### TASK: Try checking if 2 is the best value for k (i.e are there only 2 clusters)","dda9b43f":"### Plotting the HR Diagram we find a few outliers ruining the plot so we remove them\n### The dot size in the scatterplot is mapped to the size of the star","40442ba1":"**The standard deviation of slope is now reasonably good**","c6865610":"## Again this is an incorrect analysis!\n## The proportionality constant depends on mass of host star\n## Hence Keplers law should be verified within a star system\n","cea617d5":"**Correlation coefficient**","4e56a199":"**Slope**\n\n**(Expected 1.5)**","df511d3e":"**Correlation coefficient**","cb75b5ea":"### Doing log transformation and linear regression similar to before","b9444c74":"# Exploratory Data Analysis","d5697038":"<img src=\"https:\/\/www.thoughtco.com\/thmb\/AAOKF09g0hT5BdaGf2xIK8Zz4b0=\/768x0\/filters:no_upscale():max_bytes(150000):strip_icc():format(webp)\/HR_diagram_from_eso0728c-58d19c503df78c3c4f23f536.jpg\" style=\"height:700px\">","caa3e820":"### Linear regression","7be5cd74":"**This method is inefficient as it is not vectorised**\n### TASK : Try vectorising the above code","05535648":"#### A planet is habitable if it falls inside the habitable zone of the host star, where liquid water","c314e9eb":"**We find AgeGyr, LongitudeDeg, AscendingNodeDeg, PeriastronDeg have more than 75% null values and hence won't be of much use**","19f75288":"### Initializing variables for iterating","4a54bf2b":"$\\large inner radius(AU)=\\sqrt{\\frac{L}{1.1}}$\n\n$\\large outer radius(AU)=\\sqrt{\\frac{L}{0.53}}$\n\n$\\small L = Luminosity\\:of\\:host\\:star$","e7820467":"## K-means Clustering","b80b1bac":"### TASK: Try clustering the HR diagram into the main sequence and giants","a785a3c8":"**We will try clustering the planets into two groups based on mass and radius naturallywe expect them to be either rocky or gas giant**","ecb991cf":"**Attempting to plot a scatter of Mass vs Radius we find that the skew ruins the plot**","d90c9716":"#### Removing outliers to get a good scatter plot","d2d9ca85":"## TASK: Instead of hardcoding the parameters for habitability try finding the similarity of each exoplanet with earth and hence the most earth like exoplanets","fc3567c3":"**As seen from histograms data is highly skewed**\n\n\n**If we attempt regression on such data it will fail miserably**","2127231f":"### Why is this incorrect?","db740675":"## Habitability","797e27e1":"**Slope of line**","b511b5f7":"**Intercept**","ddb201d4":"**Let's try finding the distribution of some columns like radius, mass, time period, semi major axis**","422132a5":"**Plotting a scatter plot of period vs semi major axis**","1a74e3c3":"$log(Mass)=2.2*log(Radius)-0.45$\n\n$Predicted : Mass=0.637*Radius^{2.2}$\n\n\n$Actual : Mass=c*Radius^3$","8471e402":"### Keplers 3rd Law\n$T^2\\propto a^3$\n\nwhere a is semi major axis","afc1235a":"### Interesting correlations\n- Surface Temp and Radius of planet\n- Host star mass and Radius of planet\n- Eccentricity and surface temperature\n\n**Correlation does not imply causation!**\n\n### Obvious correlations\n- Host star mass and host star temp\n- Host star mass and host star radius\n- SurfaceTemp and Host star temp\n- Period and semi major axis\n\n\n","4612c2ab":"### Planets from the same system occur together\n**So we'll do linear regression on the planets in the same star system and form a new dataframe with the results**","30087469":"**The dataset contains 3584 planets and 25 columns**","246d7612":"**We find one outlier having a very high slope so let's check after removing it**","496508fa":"**The standard deviation of slope is unnaturally high lets make a boxplot to find the problem**","924f3ac5":"### Task: Try clustering the planets in our solar system based on density ans verify if they form two clusters for rocky planets and gas giants","8cd23473":"**Finding the percentage of null values in each column :**","c92c8d0f":"### Checking for correlation in the data","54fa9627":"**Let's group the number of discoveries by discovery method and year**","e72fdb7b":"### As you can see the HR diagram provides a clean separation between the main sequence stars and giants","9a040aa1":"### RV \nA star with a planet will move in its own small orbit in response to the planet's gravity. This leads to variations in the speed with which the star moves toward or away from Earth, i.e. the variations are in the radial velocity of the star with respect to Earth. The radial velocity can be deduced from the displacement in the parent star's spectral lines due to the Doppler effect.\n<img src=\"https:\/\/www.universetoday.com\/wp-content\/uploads\/2017\/12\/Radial-Velocity-Method-star-orbits.png\" style=\"height:500px\">\n### Direct Imaging\n(Usually in infrared)\n### Microlensing\nPlanets found due to gravitational lensing\n<img src=\"https:\/\/exoplanets.nasa.gov\/system\/resources\/detail_files\/53_hs-2012-07-b-web_print.jpg\" style=\"height:500px\">\n### Timing\nSimilar to transit method checking for time intervals between dips","af93b20f":"### Making a linear regression function","d4feffc8":"### Log transformation\n#### Instead of trying to fit a polynomial we fill log transform the variables(Take their log values) and fit a straight line through them\n#### The slope of the line would give the degree of the polynomial","d68f66d7":"#### Removing outliers with values more than the 99.9th percentile we get an approximately polynomial graph between radius and mass as expected","1f06e05e":"# HR Diagram"}}