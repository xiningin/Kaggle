{"cell_type":{"47aa88f7":"code","8f005625":"code","f3202b90":"code","35b38748":"code","68d84690":"code","8fe9b8d2":"code","335dea6a":"code","e913333a":"code","ca372a94":"code","138cc54f":"code","12d0cb81":"code","a61c3200":"code","deb93c51":"code","13e5438b":"code","dc8dd36e":"code","ebe20f72":"code","2dec2689":"code","26ee3b4c":"code","245cb618":"code","71347eae":"markdown","4c0a0774":"markdown","33b77edc":"markdown","3a21bbf5":"markdown"},"source":{"47aa88f7":"import os\nimport numpy as np\nimport pandas as pd\nimport random","8f005625":"train = pd.read_csv(\"..\/input\/tabular-playground-series-jan-2021\/train.csv\")\ntest = pd.read_csv(\"..\/input\/tabular-playground-series-jan-2021\/test.csv\")\n\ntrain.drop([170514], axis=0, inplace=True)\n\nX = np.array(train.drop([\"id\", \"target\"], axis=1))\nX_test = np.array(test.drop(\"id\", axis=1))\ny = np.array(train[\"target\"])","f3202b90":"print(f\"X.shape      : {X.shape}\")\nprint(f\"y.shape      : {y.shape}\")\nprint(f\"X_test.shape : {X_test.shape}\")","35b38748":"from sklearn.model_selection import KFold\nimport xgboost as xgb\nimport lightgbm as lgb\n\nSEED = 1380","68d84690":"params_xgb = {\n    \"booster\": \"gbtree\",\n    \"objective\": \"reg:squarederror\",\n    \"eval_metric\": \"rmse\",\n    \"max_depth\": 15,\n    \"eta\": 0.005,\n    \"gamma\": 0.005346636874993822,\n    \"colsample_bytree\": 0.5,\n    \"subsample\": 0.7,\n    \"min_child_weight\": 257,\n    \"alpha\": 0.01563,\n    \"lambda\": 0.003,\n    \"tree_method\": \"hist\",\n    \"seed\": SEED\n}","8fe9b8d2":"d_test = xgb.DMatrix(X_test)","335dea6a":"def prediction_xgb(X, y):\n    \n    pred_xgb = pd.DataFrame()\n    \n    SEED = random.randint(0, 100)\n    kf = KFold(n_splits=5, shuffle=True, random_state=SEED)\n    \n    for tr_id, vl_id in kf.split(X, y):\n        print(\"==================================================================\")\n    \n        X_train, X_val = X[tr_id, :], X[vl_id, :]\n        y_train, y_val = y[tr_id], y[vl_id]\n\n        d_train = xgb.DMatrix(X_train, y_train)\n        d_val = xgb.DMatrix(X_val, y_val)\n\n        model = xgb.train(params=params_xgb,\n                          dtrain=d_train,\n                          num_boost_round=100000,\n                          early_stopping_rounds=200,\n                          verbose_eval=500,\n                          evals=[(d_train, \"train\"), (d_val, \"val\")])\n\n        pred = model.predict(d_test, ntree_limit=model.best_ntree_limit)\n        pred = pd.Series(pred)\n        pred_xgb = pd.concat([pred_xgb, pred], axis=1)\n        \n    pred_xgb = pred_xgb.mean(axis=1)\n    pred_xgb = np.array(pred_xgb)\n    \n    return pred_xgb","e913333a":"pred_xgb = prediction_xgb(X, y)","ca372a94":"X_xgb = np.concatenate([X, X_test], axis=0)\ny_xgb = np.concatenate([y, pred_xgb])","138cc54f":"pred_xgb = prediction_xgb(X_xgb, y_xgb)","12d0cb81":"params_lgb = {\n    \"task\": \"train\",\n    \"boosting_type\": \"gbdt\",\n    \"objective\": \"regression\",\n    \"metric\": \"rmse\",\n    \"learning_rate\": 0.005,\n    \"num_leaves\": 256,\n    \"bagging_fraction\": 0.8206341150202605,\n    \"feature_fraction\": 0.5,\n    \"min_data_in_leaf\": 100,\n    \"lambda_l1\": 1.074622455507616e-05,\n    \"lambda_l2\": 2.0521330798729704e-06,\n    \"min_data_per_group\": 5,\n    \"max_depth\": -1,\n    \"subsample_for_bin\": 200000,\n    \"cat_smooth\": 1.0,\n    \"min_sum_hessian_in_leaf\": 0.001,\n    \"bagging_freq\": 6,\n    \"min_gain_to_split\": 0.0,\n    \"verbosity\": -1,    # warning\u3084info\u3092\u975e\u8868\u793a\u306b\u3059\u308b\n    \"random_state\": SEED\n}","a61c3200":"def prediction_lgb(X, y):\n    \n    pred_lgb = pd.DataFrame()\n    \n    SEED = random.randint(0, 100)\n    kf = KFold(n_splits=5, shuffle=True, random_state=SEED)\n    \n    for tr_id, vl_id in kf.split(X, y):\n        print(\"=====================================================================\")\n    \n        X_train, X_val = X[tr_id, :], X[vl_id, :]\n        y_train, y_val = y[tr_id], y[vl_id]\n\n        lgb_train = lgb.Dataset(X_train, label=y_train)\n        lgb_val = lgb.Dataset(X_val, label=y_val, reference=lgb_train)\n\n        model = lgb.train(params=params_lgb,\n                          train_set=lgb_train,\n                          valid_sets=(lgb_train, lgb_val),\n                          num_boost_round=10000,\n                          early_stopping_rounds=100,\n                          verbose_eval=500)\n\n        pred = model.predict(X_test, num_iteration=model.best_iteration)\n        pred = pd.Series(pred)\n        pred_lgb = pd.concat([pred_lgb, pred], axis=1)\n        \n    pred_lgb = pred_lgb.mean(axis=1)\n    pred_lgb = np.array(pred_lgb)\n    \n    return pred_lgb","deb93c51":"pred_lgb = prediction_lgb(X, y)","13e5438b":"X_lgb = np.concatenate([X, X_test], axis=0)\ny_lgb = np.concatenate([y, pred_lgb])","dc8dd36e":"pred_lgb = prediction_lgb(X_lgb, y_lgb)","ebe20f72":"pred = pd.concat([pd.Series(pred_xgb), pd.Series(pred_lgb)], axis=1)\npred  = pred.mean(axis=1)","2dec2689":"sample_sub = pd.read_csv(\"..\/input\/tabular-playground-series-jan-2021\/sample_submission.csv\")\nsub = sample_sub.copy()","26ee3b4c":"sub[\"target\"] = pred\nsub","245cb618":"sub.to_csv(\"submission_pseudo.csv\", index=False)","71347eae":"# Pseudo Labeling \/ \u7591\u4f3c\u30e9\u30d9\u30ea\u30f3\u30b0\nOne of the methods of semi-supervised learning \/ \u534a\u6559\u5e2b\u3042\u308a\u5b66\u7fd2\u306e\u624b\u6cd5\u306e\u4e00\u3064","4c0a0774":"# LightGBM","33b77edc":"# Submission","3a21bbf5":"# Modeling"}}