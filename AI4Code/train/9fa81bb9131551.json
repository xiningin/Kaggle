{"cell_type":{"c5767cc4":"code","c4931669":"code","2676c6a3":"code","0defe755":"code","1b768323":"code","3a7a1d78":"code","03656a5b":"code","86347ae9":"code","3425bc96":"code","ffb60978":"code","4481f684":"code","c1bf2f7c":"code","0a8f927d":"code","31935d60":"code","b7bfd904":"code","a91e593a":"code","923eea6c":"code","f3367c54":"code","6f89a5db":"code","bcbf787b":"code","ccb799f9":"code","1f606058":"code","0683a28d":"code","24a9e9bf":"markdown","e74aa277":"markdown","fa4cad35":"markdown","724f1df1":"markdown","927aaa12":"markdown","bf76af07":"markdown","79445646":"markdown","ff7ae66e":"markdown","40c16fba":"markdown","30d14d6d":"markdown","6ab96f5e":"markdown","b38be67e":"markdown","8ce752df":"markdown","e96e0ad9":"markdown","1f13c363":"markdown","a7f26676":"markdown"},"source":{"c5767cc4":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline\nsns.set_style('whitegrid')\ncolor = sns.color_palette()\nimport plotly\nimport plotly.graph_objs as go\nimport cufflinks as cf\ncf.go_offline()\n\nimport os\nfrom configparser import ConfigParser\nimport requests\nfrom datetime import datetime\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","c4931669":"# Dataframe having list of stocks with their ticker symbols\nstocklist = pd.DataFrame([['Bank of America', 'BAC'], ['CitiGroup','C'], ['Goldman Sachs', 'GS'], ['JPMorgan Chase', 'JPM'],\n                                  ['Morgan Stanley','MS'], ['Wells Fargo','WFC']], columns= ['stock','symbol'])\nstocklist","2676c6a3":"# Reading the stock price CSV files\nfor i,val in stocklist.iterrows():\n    #print(val['symbol'])\n    path = '..\/input\/' +  val['symbol'] + '.csv'\n    vars()[val['symbol']] = pd.read_csv(path).rename(columns= {'Unnamed: 0':'date'}).set_index('date')","0defe755":"# Concatenating the files together in a single dataframe\ntickers = stocklist['symbol'].tolist()\nbank_stocks = pd.concat([BAC, C, GS, JPM, MS, WFC],axis=1,keys=tickers)\nbank_stocks.columns.names = ['Stock','Info']\nbank_stocks.head()","1b768323":"# Making a plotly plot of the Close Price vs Time for the years 2007-2011 showing the financial crisis in 2008.\nlayout = go.Layout(\n    title=go.layout.Title(\n        text='Close Price (2007-2011) vs Time',\n    ))\nbank_stocks.xs(key='close',axis=1,level='Info').loc['2007-01-01':'2012-01-01'].iplot(layout=layout)","3a7a1d78":"# Close Price and Smoothed Close Price of BAC during the financial crisis\nplt.figure(figsize=(12,6))\nplt.title('Downtrend of BAC stock during the financial crisis', size=14)\nBAC['close'].loc['2008-01-01':'2009-01-01'].rolling(window=30).mean().plot(label='30 Day MA')\nBAC['close'].loc['2008-01-01':'2009-01-01'].plot(label='BAC CLOSE')\nplt.legend()\nplt.show()","03656a5b":"# Finding max and min Close price of each stock and plotting it\nmaxs = bank_stocks.xs(key='close',axis=1,level='Info').max().reset_index()\nmaxs.columns= ['stock', 'max']\nmins = bank_stocks.xs(key='close',axis=1,level='Info').min().reset_index()\nmins.columns= ['stock', 'min']","86347ae9":"m = maxs.merge(mins, on='stock').set_index('stock')\nm.plot(kind='line', figsize=(6,5), style='o')\nplt.xlabel('Stocks')\nplt.ylabel('Close Price')\nplt.title('Max and Min Close Price')\n# Loc, Value to xticks\nplt.xticks(range(m.shape[0]), m.index)\nplt.xlim([-1, len(m)])\nplt.show()","3425bc96":"print(m)","ffb60978":"# Boxplots to see a comparison of the ranges and quartiles of stock prices\nb =bank_stocks.xs(key='close',axis=1,level='Info')\nc = b.unstack().reset_index()\nc = c.rename(columns={0:'val'})\nplt.figure(figsize=(12,6))\nsns.boxplot(x='Stock', y=\"val\", data=c, color='crimson')\nplt.ylabel('Close Price', fontsize=12)\nplt.xlabel('Stock', fontsize=12)\nplt.title(\"Box Plots of Close Prices\", fontsize=15)\nplt.show()","4481f684":"# Violinplots to get idea of the distribution of stock prices\nplt.figure(figsize=(12,6))\nsns.violinplot(x='Stock', y=\"val\", data=c, color='gold', alpha=0.9)\nplt.ylabel('Close Price', fontsize=12)\nplt.xlabel('Stocks', fontsize=12)\nplt.title(\"Violin Plots of Close Prices\", fontsize=15)\nplt.show()","c1bf2f7c":"# Finding the daily returns of each stock from the close prices\nreturns = pd.DataFrame()\nfor tick in tickers:\n    returns[tick+' Return'] = bank_stocks[tick]['close'].pct_change()\n    returns = returns.dropna(axis=0)\nreturns.head()","0a8f927d":"# Pair-wise scatter plot of returns of each stock\nsns.pairplot(returns)\nplt.show()","31935d60":"# Candlestick chart of Citibank stock in Nov 2008.\nC[['open', 'high', 'low', 'close']].loc['2008-10-01':'2009-01-01'].iplot(kind='candle')","b7bfd904":"# Worst Drop in returns\n\nret_idx_min = returns.idxmin().reset_index()\nret_idx_min.columns = ['stock', 'date']\nret_min = returns.min().reset_index()\nret_min.columns = ['stock', 'min_return']\nret_min['min_return'] = ret_min['min_return'].apply(lambda x: '%.2f'%x)\nret_idx_min.merge(ret_min, on='stock').set_index('stock')","a91e593a":"# Best single day gains\n\nret_idx_max = returns.idxmax().reset_index()\nret_idx_max.columns = ['stock', 'date']\nret_max = returns.max().reset_index()\nret_max.columns = ['stock', 'max_return']\nret_max['max_return'] = ret_max['max_return'].apply(lambda x: '%.2f'%x)\nret_idx_max.merge(ret_max, on='stock').set_index('stock')","923eea6c":"# Some idea of sudden Recuperation-- Difference between max and min gain days\npd.to_datetime(returns.idxmax()) - pd.to_datetime(returns.idxmin())","f3367c54":"# Distribution plots of stock returns during crisis and stable periods\nfig,ax = plt.subplots(nrows=1, ncols=2, figsize=(16,6))\nplt.suptitle('Comparison of returns during stable (left) and crisis period (right)', size=15)\nsns.distplot(returns.loc['2018-01-01':'2018-12-31']['MS Return'],color='brown',bins=100, ax= ax[0])\nsns.distplot(returns.loc['2008-01-01':'2008-12-31']['C Return'],color='red',bins=100, ax=ax[1])\nplt.show()","6f89a5db":"# Standard Deviation of returns as a measure of riskness of the stocks\nreturns.std().map(lambda x :'%.2f'%x)","bcbf787b":"# Bollinger Bands (for risk assessement) of Citibank stock\nC['close'].loc['2007-01-01':'2009-12-31'].ta_plot(study='boll')","ccb799f9":"# Standard Deviation during Jan 2018- Dec 2018\nreturns.loc['2018-01-01':'2018-12-31'].std().map(lambda x :'%.3f'%x)","1f606058":"# Heatmap of correlation between stock prices\nplt.figure(figsize=(7,5))\nsns.heatmap(bank_stocks.xs(key='close',axis=1,level='Info').corr(),annot=True, cmap='YlGnBu')\nplt.show()","0683a28d":"# Dendogram of correlation between stock prices\nsns.clustermap(bank_stocks.xs(key='close',axis=1,level='Info').corr(),annot=True, figsize=(7,7))","24a9e9bf":"<font color=navy size=3>**All stock prices except GS fell really low.\n    <br>GS max price is quite higher than other stocks** <\/font>","e74aa277":"<font color=navy size=3>**Long recuperation time for Citigroup as it entirely crashed.\n<br>JPM- the next day itself!\n<br>GS had the day of max returns 2 months earlier than the day of worst returns.**<\/font>","fa4cad35":"<font color=navy size=3>**The Dendrogram above shows hierarchichal clustering where stocks with high correlation are grouped together.**<\/font>","724f1df1":"<font color=navy size=3>**Citibank (C) seems to have a strange relation with other stocks, with its returns always being close to zero.\n<br>A google search determied that Citibank stock had a crash in Nov, 2008\n<br>Also, there's an extreme outlier in Citibank returns.** <\/font>","927aaa12":"<font color=navy size=3>**3 of these were on 2009-01-20, which was when Barack Obama became the President of US!**<\/font>","bf76af07":"<font color=navy size=3>**(BAC,MS) and (WFC, C) prices quite correlated.**<\/font>","79445646":"<font color=navy size=3>**Note the series of Red candles (Close Price < Open Price) along with the downward trend in Nov 2008, indicating the crash of Citibank stock.**<\/font>","ff7ae66e":"<font color=navy size=3>**Note the wide Bollinger bands indicating high volatility in the crisis period before the stock value became almost nill.**<\/font>","40c16fba":"<font color=navy size=3>**Citigroup has been the riskiest stock as indicated by the high value of standard deviation.**<\/font>","30d14d6d":"#### Reference roadmap to guide data analysis-\n- Unknown results\/values\n- Surprising comparisons\n- Significant extremes or outliers\n- Abnormal distributions","6ab96f5e":"<font color=navy size=3>**Very similar risk profiles of the stocks in stable period.**<\/font>","b38be67e":"<font color=navy size=3>**Interseting to observe the multinodal distribution of the prices, which was not indicated by the boxplots.** <\/font>","8ce752df":"<font color=navy size=3>**Its interesting to see that some stocks (BAC, JPM, MS) have outliers on upper extremes while GS has outliers on the lower extreme.**<\/font>","e96e0ad9":"<font color=navy size=3> **Price downtrends can be clearly seen in 2008** <\/font>**","1f13c363":"<font color=navy size=5>**Conclusions** <\/font>\n* Stock prices during the financial crisis of 2008 were analyzed.\n* There was a dip in the prices of all the stocks.\n* GS stock was relatively stable, with its maximum price quite higher than the other stocks.\n* When boxplots were plotted for the stock prices, there were some stocks with outliers at lower extremes, while some with outliers at upper extremes.\n* Violinplots revealed the multinodal distribution of the prices, which were not indicated by the boxplots.\n* Citibank stock had a crash in November 2008, indicated by the Scatter plot of its returns against other stocks' returns.\n* The day of worst drop in returns was Jan 20, 2009 for three of our stocks. This was when Barack Obama became the new President of USA!\n* Citibank stock took a long time to recuperate compared to other stocks.\n* Variance of returns during the crisis were about an order of magnitude greater than the variance of returns in the stable period.\n* Citigroup was the riskiest stock as indicated by the high standard deviation of its returns.\n* Wide Bollingers bands for Citibank revealed the stock volatility.\n* The stocks had a very similar risk profile in the stable period.\n* (BAC, MS) and (WFC, C) stocks were quite correlated. Dendrogram groupings gave further insight into this.\n","a7f26676":"<font color=navy size=3>**In the stable period, returns ranged from about -0.06 to 0.08 while in the period of financial crisis the range increases to -0.2 to 0.6, an increase by a magnitude of 10!**<\/font>"}}