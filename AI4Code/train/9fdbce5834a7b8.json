{"cell_type":{"1ff74f86":"code","58ffa56a":"code","8c9decab":"code","a8f024d8":"code","5630e8fd":"code","97e60ae6":"code","58367486":"code","37b84712":"code","cf3a7827":"code","9ddd1296":"code","c33b203f":"code","0872c6bc":"code","70c90edd":"code","57a7a928":"code","ac2cca4e":"code","d8e70ec8":"code","7c099e66":"code","ce0cf830":"code","267a3eb7":"code","484adbf5":"code","eec0af79":"code","46b61941":"markdown","2bec4285":"markdown","2cbc4214":"markdown","ff6928ad":"markdown","1260dcda":"markdown","a0a7d543":"markdown","6661567c":"markdown","f03215e3":"markdown","2b2bc85c":"markdown","bd1b416c":"markdown","445c8f81":"markdown","3fd34b4e":"markdown","fb79efbb":"markdown","d80b625c":"markdown","bb435d85":"markdown","a87f4f0a":"markdown","1e687ad5":"markdown"},"source":{"1ff74f86":"import numpy as np\nimport pandas as pd \nimport matplotlib.pyplot as plt\nimport os \nimport seaborn as sns\nimport geopandas as gpd\nimport folium\nfrom folium import plugins\nimport datetime\nimport math","58ffa56a":"os.listdir('..\/input\/denver-crime-data')","8c9decab":"data=pd.read_csv('..\/input\/denver-crime-data\/crime.csv')\ndata.head()","a8f024d8":"y=data.isnull().sum().sort_values(ascending=False)[:6].index\nx=data.isnull().sum().sort_values(ascending=False)[:6]\nplt.figure(figsize=(8,8))\nsns.barplot(x,y)\nplt.title(\"counts of missing value\",size=20)","5630e8fd":"data=data.dropna(subset=['GEO_LAT','GEO_LON'])\ndata.isnull().sum()","97e60ae6":"data['REPORTED_DATE']=data.REPORTED_DATE.apply(lambda x:datetime.datetime.strptime(x,'%m\/%d\/%Y %I:%M:%S %p'))\ndata['year']=data.REPORTED_DATE.apply(lambda x:x.strftime('%Y'))\ndata['month']=data.REPORTED_DATE.apply(lambda x:x.strftime('%m'))\ndata['hour']=data.REPORTED_DATE.apply(lambda x:x.strftime('%H'))\ndata.head()","58367486":"data=data[data.GEO_LAT>39]","37b84712":"Top10_crime_type=data[data['OFFENSE_CATEGORY_ID'].isin(list(data.OFFENSE_CATEGORY_ID.value_counts()[:10].index[:10]))]\nfig,ax=plt.subplots(2,2,figsize=(20,20))\ny=Top10_crime_type.OFFENSE_CATEGORY_ID.value_counts().index\nx=Top10_crime_type.OFFENSE_CATEGORY_ID.value_counts()\nsns.barplot(x=x,y=y,ax=ax[0,0])\nax[0,0].set_title(\"Top 10 crime type by counts\",size=20)\nax[0,0].set_xlabel('counts',size=18)\nax[0,0].set_ylabel('')\n\n\nTop10_crime_type.groupby(['year','OFFENSE_CATEGORY_ID'])['INCIDENT_ID'].agg('count').unstack('OFFENSE_CATEGORY_ID').plot(ax=ax[0,1])\nax[0,1].legend(loc=0, ncol=1, fontsize=14,bbox_to_anchor=(1.10,1))\nax[0,1].set_title(\"Top 10 crime type counts by year\",size=20)\nax[0,1].set_ylabel('counts',size=18)\nax[0,1].set_xlabel('year',size=18)\n\nTop10_crime_type.groupby(['month','OFFENSE_CATEGORY_ID'])['INCIDENT_ID'].agg('count').unstack('OFFENSE_CATEGORY_ID').plot(ax=ax[1,0])\nax[1,0].legend(loc=0, ncol=1, fontsize=14,bbox_to_anchor=(-0.25,1))\nax[1,0].set_title(\"Top 10 crime type counts by month\",size=20)\nax[1,0].set_ylabel('counts',size=18)\nax[1,0].set_xlabel('month',size=18)\n\nsns.scatterplot(x=\"GEO_LON\", y=\"GEO_LAT\", hue=\"OFFENSE_CATEGORY_ID\",data=Top10_crime_type,ax=ax[1,1])\nax[1,1].legend(loc=0, ncol=1, fontsize=14,bbox_to_anchor=(1.10,1))\nax[1,1].set_title(\"The distribution of Top 10 crime type\",size=20)\nax[1,1].set(xlabel='Longitude', ylabel='LATITUDE')\n","cf3a7827":"data_2000=data[:2000]\nLong=data_2000.GEO_LON.mean()\nLat=data_2000.GEO_LAT.mean()\ndata_map=folium.Map([Lat,Long],zoom_start=12)\n\ndata_crime_map=plugins.MarkerCluster().add_to(data_map)\nfor lat,lon,label in zip(data_2000.GEO_LAT,data_2000.GEO_LON,data_2000.OFFENSE_CATEGORY_ID):\n    folium.Marker(location=[lat,lon],icon=None,popup=label).add_to(data_crime_map)\ndata_map.add_child(data_crime_map)\n\ndata_map","9ddd1296":"fig,ax=plt.subplots(2,2,figsize=(20,20))\ny=data.year.value_counts()\nx=data.year.value_counts().index\nsns.barplot(x=x,y=y,ax=ax[0,0])\nax[0,0].set_title(\"The number of crimes by year\",size=20)\nax[0,0].set_ylabel('counts',size=18)\nax[0,0].set_xlabel('')\n\n\ny=data.month.value_counts()\nx=data.month.value_counts().index\nsns.barplot(x=x,y=y,ax=ax[0,1])\nax[0,1].set_title(\"The number of crimes by month\",size=20)\nax[0,1].set_ylabel('counts',size=18)\nax[0,1].set_xlabel('')\n\ny=data.hour.value_counts()\nx=data.hour.value_counts().index\nsns.barplot(x=x,y=y,ax=ax[1,0])\nax[1,0].set_title(\"The number of crimes by hour\",size=20)\nax[1,0].set_ylabel('counts',size=18)\nax[1,0].set_xlabel('')\n\n\n\n\ny=data.NEIGHBORHOOD_ID.value_counts()[:10].index\nx=data.NEIGHBORHOOD_ID.value_counts()[:10]\nsns.barplot(x=x,y=y,ax=ax[1,1])\nax[1,1].set_title(\"The 10 NEIGHBORHOOD_ID by the number of crimes\",size=20)\nax[1,1].set_xlabel('counts',size=18)\nax[1,1].set_ylabel('')","c33b203f":"map_all=folium.Map([39.7,-105],zoom_start=12)\ncrime_new=pd.DataFrame({\"Lat\":data['GEO_LAT'],\"Long\":data['GEO_LON']})\ncrime_new=crime_new[:20000]\nmap_all.add_child(plugins.HeatMap(data=crime_new))\nmap_all","0872c6bc":"data_traf=data[data.OFFENSE_CATEGORY_ID=='traffic-accident']\ndata_traf.head()","70c90edd":"fig,ax=plt.subplots(2,2,figsize=(20,20))\ny=data_traf.year.value_counts()\nx=data_traf.year.value_counts().index\nsns.barplot(x=x,y=y,ax=ax[0,0])\nax[0,0].set_title(\"The number of traffic-accident by year\",size=20)\nax[0,0].set_ylabel('counts',size=18)\nax[0,0].set_xlabel('')\n\n\ny=data_traf.month.value_counts()\nx=data_traf.month.value_counts().index\nsns.barplot(x=x,y=y,ax=ax[0,1])\nax[0,1].set_title(\"The number of traffic-accident by month\",size=20)\nax[0,1].set_ylabel('counts',size=18)\nax[0,1].set_xlabel('')\n\ny=data_traf.hour.value_counts()\nx=data_traf.hour.value_counts().index\nsns.barplot(x=x,y=y,ax=ax[1,0])\nax[1,0].set_title(\"The number of traffic-accident by hour\",size=20)\nax[1,0].set_ylabel('counts',size=18)\nax[1,0].set_xlabel('')\n\n\nsns.scatterplot(x=\"GEO_LON\", y=\"GEO_LAT\", hue=\"NEIGHBORHOOD_ID\",data=data_traf,ax=ax[1,1])\nax[1,1].legend(loc=0, ncol=1, fontsize=14,bbox_to_anchor=(1.10,2.5))\nax[1,1].set_title(\"The distribution of traffic-accident\",size=20)\nax[1,1].set(xlabel='Longitude', ylabel='LATITUDE')","57a7a928":"data_IS_TRAFFIC=data[data.IS_TRAFFIC==1]\ndata_IS_TRAFFIC.head()","ac2cca4e":"data_IS_TRAFFIC=data_IS_TRAFFIC[:2000]\ncolors = {'2014' : 'red', '2015' : 'blue','2016' :'green','2017':'brown','2018':'plum','2019':'purple'}\nLong=data_IS_TRAFFIC.GEO_LON.mean()\nLat=data_IS_TRAFFIC.GEO_LAT.mean()\ndata_IS_TRAFFIC_map=folium.Map([Lat,Long],zoom_start=12)\nfor i in range(len(data_IS_TRAFFIC.groupby(['GEO_LAT','GEO_LON'])['INCIDENT_ID'].agg('count').index)):\n    lat,lon=data_IS_TRAFFIC.groupby(['GEO_LAT','GEO_LON'])['INCIDENT_ID'].agg('count').index[i]\n    folium.Circle(location=[lat,lon],\n    popup=data_IS_TRAFFIC.iloc[i]['OFFENSE_TYPE_ID'],\n    radius=int(data_IS_TRAFFIC.groupby(['GEO_LAT','GEO_LON'])['INCIDENT_ID'].agg('count')[i])*70,\n    fill=True,\n    fill_color=colors[data_IS_TRAFFIC['year'].iloc[i]],\n    fill_opacity=0.7,).add_to(data_IS_TRAFFIC_map)\n\ndata_IS_TRAFFIC_map","d8e70ec8":"data_IS_TRAFFIC=data[data.IS_TRAFFIC==1]\nplt.figure(figsize=(20,20))\nfor i in range(6):\n    traffic=data_IS_TRAFFIC[data_IS_TRAFFIC.year==str(2014+i)]\n    plt.subplot(3,2,i+1)\n    plt.scatter('GEO_LON', 'GEO_LAT', data=traffic, c=colors[traffic['year'].iloc[0]])\n    plt.title(\"The distribution of traffic-accident in \"+str(2014+i),size=20)\n    plt.xlabel('Longitude')\n    plt.ylabel('LATITUDE')","7c099e66":"data_larceny=data[data.OFFENSE_CATEGORY_ID=='larceny']\ndata_larceny.head()","ce0cf830":"fig,ax=plt.subplots(2,2,figsize=(20,20))\ny=data_larceny.year.value_counts()\nx=data_larceny.year.value_counts().index\nsns.barplot(x=x,y=y,ax=ax[0,0])\nax[0,0].set_title(\"The number of larceny by year\",size=20)\nax[0,0].set_ylabel('counts',size=18)\nax[0,0].set_xlabel('')\n\n\ny=data_larceny.month.value_counts()\nx=data_larceny.month.value_counts().index\nsns.barplot(x=x,y=y,ax=ax[0,1])\nax[0,1].set_title(\"The number of larceny by month\",size=20)\nax[0,1].set_ylabel('counts',size=18)\nax[0,1].set_xlabel('')\n\ny=data_larceny.hour.value_counts()\nx=data_larceny.hour.value_counts().index\nsns.barplot(x=x,y=y,ax=ax[1,0])\nax[1,0].set_title(\"The number of larceny by hour\",size=20)\nax[1,0].set_ylabel('counts',size=18)\nax[1,0].set_xlabel('')\n\n\nsns.scatterplot(x=\"GEO_LON\", y=\"GEO_LAT\", hue=\"NEIGHBORHOOD_ID\",data=data_larceny,ax=ax[1,1])\nax[1,1].legend(loc=0, ncol=1, fontsize=14,bbox_to_anchor=(1.10,2.5))\nax[1,1].set_title(\"The distribution of larency\",size=20)\nax[1,1].set(xlabel='Longitude', ylabel='LATITUDE')","267a3eb7":"def rank_NEIGHBORHOOD(NEIGHBORHOOD_ID):\n    year=['2014','2015','2016','2017','2018','2019']\n    B={}\n    for i in range(len(year)):\n        A=data[data.year==year[i]]\n        value=A.groupby(['NEIGHBORHOOD_ID'])['OFFENSE_ID'].agg('count')\n        rank=A.groupby(['NEIGHBORHOOD_ID'])['OFFENSE_ID'].agg('count').rank(method='min',ascending=False)\n        new=pd.DataFrame({'rank':rank,'value':value})\n        B['rank '+year[i]]=str(new[new.index==NEIGHBORHOOD_ID].iloc[0,0])+\"\/\"+str(max(rank))\n        B['value '+year[i]]=str(new[new.index==NEIGHBORHOOD_ID].iloc[0,1])\n\n    return B","484adbf5":"def rank_plot(NEIGHBORHOOD_ID):\n    ID=rank_NEIGHBORHOOD(NEIGHBORHOOD_ID)\n    y=[]\n    x=[]\n    n=[]\n    for i in range(6):\n        r1,r2=ID['rank '+str(i+2014)].split('\/')\n        R=float(r1)\/float(r2)\n        R=1-R\n        y.append(1.5+R*math.sin(0+i*2*math.pi\/6))\n        x.append(1.5+R*math.cos(0+i*2*math.pi\/6))\n        n.append('rank '+str(i+2014)+' '+ID['rank '+str(i+2014)])\n    \n    x.append(x[0])\n    y.append(y[0])\n    plt.plot(x,y, marker='o', markerfacecolor='blue', markersize=12, color='skyblue', linewidth=2)\n    for i, txt in enumerate(n):\n        plt.annotate(txt, (x[i], y[i]))\n        plt.xlim(0.45,2.7)\n        plt.ylim(0.45,2.7)\n        plt.fill(x, y,\"plum\")\n        plt.plot( 1.5, 1.5, marker='o', markerfacecolor='blue', markersize=8, linewidth=2)\n        plt.title(\"The rank of the number of crime by year in \"+NEIGHBORHOOD_ID,size=18) ","eec0af79":"plt.figure(figsize=(20,30))\nplt.subplot(3,2,1)\nrank_plot('five-points')\nplt.subplot(3,2,2)\nrank_plot('stapleton')\nplt.subplot(3,2,3)\nrank_plot('cbd')\nplt.subplot(3,2,4)\nrank_plot('capitol-hill')\nplt.subplot(3,2,5)\nrank_plot('virginia-village')\nplt.subplot(3,2,6)\nrank_plot('city-park')","46b61941":"According to the following chart,we know that the crime almost are happened at 12~18 o'clock.","2bec4285":"<h3 id=\"23\">2.3 visualization for 'traffic-accident'<\/h3>","2cbc4214":"<h3 id=\"21\">2.1 visualization for crime type<\/h3>","ff6928ad":"I remove the data whcih LAT is less than 39","1260dcda":"# 3.Suggestion","a0a7d543":"1.From the rank plot,the neighborhood is dangerous if the area of the plot is large.Police have to pay more attention to five-points,stapleton,cbd,and capitol-hill.\n\n2.According to the following chart from 2.2,we know that the crime almost are happened at 12~18 o'clock.\n\n3.From the bar chart of 2.1, we know that the most of crime type is traffic-accident in this data.","6661567c":"<h3 id=\"24\">2.4 visualization for 'larceny'<\/h3>","f03215e3":"From the bar chart, we know that the most of crime type is traffic-accident in this data.","2b2bc85c":"* [1.DataOverview](#1.DataOverview)\n* [2.Visualization](#2.Visualization)\n    * [2.1 visualization for crime type](#21)\n    * [2.2 visualization for the number of crime](#22)\n    * [2.3 visualization for 'traffic-accident'](#23)\n    * [2.4 visualization for 'larceny'](#24)\n    * [2.5 visualization for 'NEIGHBORHOOD_ID'](#25)\n* [3.Suggestion](#3.Suggestion)","bd1b416c":"# 2.Visualization","445c8f81":"I use the top 2000 data to visualize on map,you can see the crime's location and type on map.","3fd34b4e":"The crime data size is 509346,and the variables include INCIDENT_ID,OFFENSE_ID,and so on.\n\n'LAST_OCCURRENCE_DATE', 'INCIDENT_ADDRESS', 'GEO_LAT', 'GEO_LON','GEO_Y', 'GEO_X' have missing value\n\nIf you want to use these variables,you have to watch out missing value.\n\nIn this kernel,I will use the Geo_LON and GEO_LAT to visualize the data,so I will remove the missing value from these variables.","fb79efbb":"# 1.DataOverview","d80b625c":"From the rank plot, the neighborhood is dangerous if the area of the plot is large.","bb435d85":"According to the map,you can see the distribution of traffic-accident by year clearly.If the circle is more large,the traffic-accidents are happened more frequently in this area. I only show top 2000 data on the map.Since it can not show on the map if the data size too large in KAGGLE.","a87f4f0a":"<h3 id=\"25\">2.5 visualization for 'NEIGHBORHOOD_ID'<\/h3>","1e687ad5":"<h3 id=\"22\">2.2 visualization for the number of crime<\/h3>"}}