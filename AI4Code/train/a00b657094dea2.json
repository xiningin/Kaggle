{"cell_type":{"e468b804":"code","50c7f18b":"code","2a937842":"code","7623ce85":"code","6ecdf265":"code","afe50fa8":"code","dd7f2eb3":"code","2b449114":"code","2fa6a40f":"code","056d1b0a":"code","bbeb3320":"code","fcc390ab":"code","ae54d25c":"code","a07a60b4":"code","a6c876f2":"markdown","5ddadd19":"markdown","a3d130bd":"markdown","d15ae3d0":"markdown","311343eb":"markdown","b46e5456":"markdown","81209c67":"markdown","430b44aa":"markdown","157d5df3":"markdown","7850cdd2":"markdown","4e1ec4d6":"markdown","9aa0aead":"markdown","06296e7a":"markdown"},"source":{"e468b804":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","50c7f18b":"df_base = pd.read_csv(\"..\/input\/base_etablissement_par_tranche_effectif.csv\")\ndf_geo = pd.read_csv(\"..\/input\/name_geographic_information.csv\")\ndf_salary = pd.read_csv(\"..\/input\/net_salary_per_town_categories.csv\")\ndf_population = pd.read_csv(\"..\/input\/population.csv\")\n\nprint (df_base.head())\nprint (df_geo.head())\nprint (df_salary.head())\nprint (df_population.head())","2a937842":"df_base=df_base.rename(columns = {'CODGEO':'code_insee'})\ndf_base['code_insee']=df_base['code_insee'].astype(str)\ndf_geo['code_insee']=df_geo['code_insee'].astype(str)\nmerged_df_1=df_base.merge(df_geo, how='inner', on=['code_insee'])","7623ce85":"df_salary=df_salary.rename(columns = {'CODGEO':'code_insee'})\ndf_population=df_population.rename(columns = {'CODGEO':'code_insee'})\ndf_salary['code_insee']=df_salary['code_insee'].astype(str)\ndf_population['code_insee']=df_population['code_insee'].astype(str)\n\nmerged_df_2=df_salary.merge(df_population, how='inner', on=['code_insee'])\n","6ecdf265":"merged_df_all=merged_df_1.merge(merged_df_2, how='inner', on=['code_insee'])\nmerged_df_all.columns","afe50fa8":"final_df = merged_df_all.drop(columns=['REG','DEP', 'EU_circo', 'code_r\u00e9gion', 'nom_r\u00e9gion', 'chef.lieu_r\u00e9gion', 'num\u00e9ro_d\u00e9partement',\n                                      'nom_commune', 'codes_postaux', '\u00e9loignement', 'LIBGEO_x', 'LIBGEO_y', 'LIBGEO', 'nom_d\u00e9partement', 'pr\u00e9fecture', 'num\u00e9ro_circonscription'])\nfinal_df","dd7f2eb3":"all_columns = final_df.columns\nprint (all_columns)\ngroupby_columns = list(all_columns[:-4])\nprint (groupby_columns)\nfinal_df_sum_population = final_df.reset_index().groupby(groupby_columns, as_index=False).sum()\nfinal_df_sum_population = final_df_sum_population.drop(columns=['MOCO', 'AGEQ80_17', 'SEXE', 'index', 'NIVGEO', 'code_insee'])\n","2b449114":"final_df_sum_population.head()","2fa6a40f":"from pylab import rcParams\nrcParams['figure.figsize'] = 10,10\n\nnum_firms = final_df_sum_population['E14TST']\npercentile_upper = (num_firms.quantile(0.9))\npercentile_lower = (num_firms.quantile(0.1))\nfinal_df_sum_population_small_town = final_df_sum_population[final_df_sum_population['E14TST'] < percentile_upper]\n#final_df_sum_population_small_town = final_df_sum_population[final_df_sum_population['E14TST'] > percentile_lower]\n\nnum_firms = final_df_sum_population_small_town['E14TST']\nnum_population = final_df_sum_population_small_town['NB']\nwoman_salary = final_df_sum_population_small_town['SNHMF14']\nman_salary = final_df_sum_population_small_town['SNHMH14']\n\nplt.subplot(4, 1, 1)\nplt.hist(num_firms, bins = 50)\nplt.title('number of firms histogram')\n\nplt.subplot(4, 1, 2)\nplt.hist(num_population, bins = 50)\nplt.title('town population histogram')\n\nplt.subplot(4, 1, 3)\nplt.hist(woman_salary, bins = 50)\nplt.title('town mean woman salary histogram')\n\nplt.subplot(4, 1, 4)\nplt.hist(man_salary, bins = 50)\nplt.title('town mean man salary histogram')\n\nplt.tight_layout()\nplt.show()","056d1b0a":"firm_population_data = final_df_sum_population_small_town[['E14TST', 'E14TS1', 'E14TS6', 'E14TS10', 'E14TS20', 'E14TS50', 'E14TS100', 'E14TS200', 'E14TS500']].reset_index(drop=True)\nhuman_population = final_df_sum_population_small_town[['NB']].reset_index(drop=True)\nmean_salary_female_overall = final_df_sum_population_small_town[['SNHMF14']].reset_index(drop=True)\nmean_salary_male_overall = final_df_sum_population_small_town[['SNHMH14']].reset_index(drop=True)\nmean_salary_overall = final_df_sum_population_small_town[['SNHM14']].reset_index(drop=True)\nmean_salary_age_overall = final_df_sum_population_small_town[['SNHM1814', 'SNHM2614', 'SNHM5014']].reset_index(drop=True)\n\n# combine firm population column data \nfirm_population_data['binned_small'] = firm_population_data['E14TS1'] +  firm_population_data['E14TS6']\nfirm_population_data['binned_med'] = firm_population_data['E14TS10'] +  firm_population_data['E14TS20']\nfirm_population_data['binned_large'] = firm_population_data['E14TS50'] +  firm_population_data['E14TS100'] + firm_population_data['E14TS200'] + firm_population_data['E14TS500']\n","bbeb3320":"# matrix 1: firm size number, overall salary, human population number\nfirm_generic_pop = firm_population_data[['binned_small', 'binned_med', 'binned_large', 'E14TST']]\ncorr_1 = pd.concat([human_population, firm_generic_pop], axis=1)\ncorr_1 = pd.concat([corr_1, mean_salary_overall], axis=1)\ncorr_1 = corr_1.rename(index=str, columns={\"NB\": \"population\", \"E14TST\": \"total firms\", \"SNHM14\": \"mean_wages\"})\ncorr_matrix = corr_1.corr()\ncorr_matrix.style.background_gradient()\nplt.matshow(corr_matrix)\nplt.xticks(range(len(corr_matrix.columns)), corr_matrix.columns);\nplt.yticks(range(len(corr_matrix.columns)), corr_matrix.columns);\ncorr_matrix","fcc390ab":"final_df_sum_population_large_town = final_df_sum_population[final_df_sum_population['E14TST'] > percentile_upper]\nfirm_population_data = final_df_sum_population_large_town[['E14TST', 'E14TS1', 'E14TS6', 'E14TS10', 'E14TS20', 'E14TS50', 'E14TS100', 'E14TS200', 'E14TS500']].reset_index(drop=True)\nhuman_population = final_df_sum_population_large_town[['NB']].reset_index(drop=True)\nmean_salary_female_overall = final_df_sum_population_large_town[['SNHMF14']].reset_index(drop=True)\nmean_salary_male_overall = final_df_sum_population_large_town[['SNHMH14']].reset_index(drop=True)\nmean_salary_overall = final_df_sum_population_large_town[['SNHM14']].reset_index(drop=True)\nmean_salary_age_overall = final_df_sum_population_large_town[['SNHM1814', 'SNHM2614', 'SNHM5014']].reset_index(drop=True)\n\n# combine firm population column data \nfirm_population_data['binned_small'] = firm_population_data['E14TS1'] +  firm_population_data['E14TS6']\nfirm_population_data['binned_med'] = firm_population_data['E14TS10'] +  firm_population_data['E14TS20']\nfirm_population_data['binned_large'] = firm_population_data['E14TS50'] +  firm_population_data['E14TS100'] + firm_population_data['E14TS200'] + firm_population_data['E14TS500']\n\n# matrix 1: firm size number, overall salary, human population number\nfirm_generic_pop = firm_population_data[['binned_small', 'binned_med', 'binned_large', 'E14TST']]\ncorr_1 = pd.concat([human_population, firm_generic_pop], axis=1)\ncorr_1 = pd.concat([corr_1, mean_salary_overall], axis=1)\ncorr_1 = corr_1.rename(index=str, columns={\"NB\": \"population\", \"E14TST\": \"total firms\", \"SNHM14\": \"mean_wages\"})\ncorr_matrix = corr_1.corr()\ncorr_matrix.style.background_gradient()\nplt.matshow(corr_matrix)\nplt.xticks(range(len(corr_matrix.columns)), corr_matrix.columns);\nplt.yticks(range(len(corr_matrix.columns)), corr_matrix.columns);\ncorr_matrix","ae54d25c":"women_mean_young = final_df_sum_population['SNHMF1814'].mean()\nwomen_mean_mid = final_df_sum_population['SNHMF2614'].mean()\nwomen_mean_old = final_df_sum_population['SNHMF5014'].mean()\nman_mean_young = final_df_sum_population['SNHMH1814'].mean()\nman_mean_mid = final_df_sum_population['SNHMH2614'].mean()\nman_mean_old = final_df_sum_population['SNHMH5014'].mean()\n\nX = ['age 18-25', 'age 26-50', 'age >50']\ny_women = [women_mean_young, women_mean_mid, women_mean_old]\ny_men = [man_mean_young, man_mean_mid, man_mean_old]\ndf = pd.DataFrame(np.c_[y_women, y_men], index=X)\ndf.plot.bar(rot=0)\nplt.title('mean wages of different gender across age group')\nplt.legend(['woman', 'man'])\nplt.show()","a07a60b4":"# The code to create the France map was taken from another kernel, but the plots are mine\nfrom mpl_toolkits.basemap import Basemap\nimport matplotlib.colors as colors\n\nplt.figure(figsize=(20,20))\n# Load map of France\nmap = Basemap(projection='lcc', \n            lat_0=46.2374,\n            lon_0=2.375,\n            resolution='h',\n            llcrnrlon=-4.76, llcrnrlat=41.39,\n            urcrnrlon=10.51, urcrnrlat=51.08)\n\n# Draw parallels.\nparallels = np.arange(40.,52,2.)\nmap.drawparallels(parallels,labels=[1,0,0,0],fontsize=10)\n# Draw meridians\nmeridians = np.arange(-6.,10.,2.)\nmap.drawmeridians(meridians,labels=[0,0,0,1],fontsize=10)\n\nmap.drawcoastlines()\nmap.drawcountries()\nmap.drawmapboundary()\nmap.drawrivers()\n\nlat_long_data = final_df_sum_population[['latitude', 'longitude', 'SNHM14']].dropna(subset=['latitude', 'longitude'])\nlat_long_data = lat_long_data[(lat_long_data['latitude'].astype(str) != '-')]\nlat_long_data = lat_long_data[(lat_long_data['longitude'].astype(str) != '-')]\nlat_long_data = lat_long_data.sort_values(by=[\"SNHM14\"], ascending=False).head(2000)\nlat_ = lat_long_data['latitude'].astype(float).values.tolist()\nlong_ = lat_long_data['longitude'].astype(float).values.tolist()\nprint (lat_[0])\nprint (long_[0])\n# scatter these high wage towns\nx1, y1 = map(long_,lat_)\nmap.scatter(x1, y1, c=lat_long_data['SNHM14'],  norm=colors.LogNorm(vmin=1, vmax=max(lat_long_data['SNHM14'])), cmap='hsv')\n\nx_paris, y_paris = map([2.3522], [48.8566])\nx_Lyon, y_Lyon = map([4.8357], [45.7640])\nx_Marseille, y_Marseille = map([5.3698], [43.2965])\n# plot single points of large cities\nmap.plot(x_paris, y_paris, marker='o', markersize = 20, c='yellow')\nmap.plot(x_Lyon, y_Lyon, marker='o', markersize = 20, c='yellow')\nmap.plot(x_Marseille, y_Marseille, marker='o', markersize = 20, c='yellow')\nplt.annotate('Paris', (x_paris[0], y_paris[0]), fontsize=30)\nplt.annotate('Lyon', (x_Lyon[0],y_Lyon[0]), fontsize=30)\nplt.annotate('Marselle', (x_Marseille[0], y_Marseille[0]), fontsize=35)\nplt.title('scatter plots of top 2000 mean wage towns', fontsize=40, fontweight='bold', y=1.05)\nplt.show()\n","a6c876f2":"# Look's like we have to group the rows together ( using group-by and sum() ) to obtain the population for each town (because of the way the data in population.csv file is arranged)","5ddadd19":"# We then ask ourselves two more questions - does gender affect wages (discrimination in the 21st century? who knew?) and does the location of towns matter?\n### Since we already have the wage breakdown according to gender, we do not need to plot any more correlation matrices - we can simply compare the average wages of different gender across age groups","a3d130bd":"## Seems like the conclusion is the same for larger towns (top 10 percentile) - size of town has no effect on average wages. ","d15ae3d0":"# Let's first cross join each csv with each other with common column _code-insee_ (The unique town id identifier)","311343eb":"# The resulting columns of the merged dataframe","b46e5456":"# Let's extract some numerical insights from the data first - we drop all seemingly irrelevant categorical data first (e.g code_r\u00e9gion, EU_circo, DEP)\n- It is possible these data might be useful later on (possible certain region performs better), but let's drop them first.","81209c67":"# Reading in the data from each csv file","430b44aa":"# Let's look at the correlation matrix for all the columns (minus latitude and longitude)\n## However, the columns seem too messy. I will split the columns into the following groups:\n- mean salary of age groups\n- mean salary of age groups by gender\n- mean salary overall\n- mean salary overall by gender\n- mean salary by job\n- mean salary by job by gender\n- firm population\n- human population\n\nLet's try to form a few correlation matrix so we don't have to go blind trying to view a 30x30 matrix with colours.","157d5df3":"# It seems that wages are not correlated to number of firms in small towns (regardless of size of firm). How about for larger sized towns? (top 10 percentile)","7850cdd2":"# Taking a look at the prior distribution of some important columns (e.g number of firms, average pay, population etc)\n- We will look at the prior distribution of 4 columns - number of known firms (E14TST), general population (NB - after summing via group-by), mean woman salary (SNHMF14 - per hour), mean man salary (SNHMH14 - per hour)\n- Also it seems that the variation of population size \/ city size is really huge (There are towns with 1000 people and towns with 400000 people). I will split the data into two groups - towns with population > 0.9 percentile and population < 0.9 percentile. We will show the histogram plots for smaller towns.","4e1ec4d6":"# So how does location of towns affect the mean wages? Let's scatter the top 2000 town wages on a map of France. We will notice that most of these towns lie near water bodies or around large cities.","9aa0aead":"## Indeed, gender seems to affect average wages across age groups, with a larger difference for older age groups.","06296e7a":"# Concluding statements\n## 1. Wages are not correlated to number of firms or number of people in a town; small towns can have high mean wages as well.\n## 2. However, high wages towns lie near water bodies or in\/near big cities such as Lyon, Marseille and Paris. In fact, Paris has even higher average wage as compared to the other two big cities (notice the pink scatter points at Paris).\n## 3. Gender plays a role in wage as well - woman are paid relatively less than man and the disparity (percentage wise) increases at higher ages."}}