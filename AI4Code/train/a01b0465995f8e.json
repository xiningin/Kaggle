{"cell_type":{"7cd7d84f":"code","cad5e21a":"code","166b646a":"code","176d8e54":"code","8ef733a0":"code","f3cfc24b":"code","a8b1a15a":"code","acb1a444":"code","f2e5ba1f":"code","56a234b7":"code","b38b29f7":"code","d4c5effe":"code","3baaca7e":"code","65ba7e6c":"markdown","7385a615":"markdown","2419454d":"markdown","7d63de28":"markdown","3b5cbfd0":"markdown","2098c699":"markdown","c9a72c3b":"markdown","3dfd98aa":"markdown","78b9e3ab":"markdown"},"source":{"7cd7d84f":"!pip install NRCLex","cad5e21a":"import pandas as pd\nimport numpy as np\nfrom IPython.display import display\nfrom nltk.corpus import stopwords\nfrom nltk.tokenize import sent_tokenize\nfrom nrclex import NRCLex\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set_style('whitegrid')","166b646a":"def process_df(file_path):\n\n    def explode(df, lst_cols, fill_value='', preserve_index=False):\n        idx_cols = df.columns.difference(lst_cols)\n        lens = df[lst_cols[0]].str.len()\n        idx = np.repeat(df.index.values, lens)\n\n        res = (pd.DataFrame({\n                    col:np.repeat(df[col].values, lens)\n                    for col in idx_cols},\n                    index=idx)\n                 .assign(**{col:np.concatenate(df.loc[lens>0, col].values)\n                                for col in lst_cols}))\n\n        if (lens == 0).any():\n            # at least one list in cells is empty\n            res = (res.append(df.loc[lens==0, idx_cols], sort=False)\n                      .fillna(fill_value))\n            \n        res = res.sort_index()\n        \n        if not preserve_index:        \n            res = res.reset_index(drop=True)\n        return res\n\n    df = pd.read_csv(file_path)\n    df['dialog_processed']=df['dialog'].apply(lambda s: sent_tokenize(str(s).lower()))\n    return explode(df,['dialog_processed'])\n\ndef show_vocabulary_scores(movie_df,n=6):\n    dialog_count = movie_df.groupby('character').count().reset_index().sort_values(['dialog_processed'], ascending=False)\n    \n    top_ch = dialog_count['character'][:n]\n    \n    fig,axs = plt.subplots(figsize=(25,9),nrows=2,ncols=n\/\/2,sharex=True,sharey=True)\n    if len(movie_df.movie.unique())>1:\n        fig.suptitle(f\"Harry Potter movies\\n{n} most speaking characters vocabulary  score\")\n    else:\n        fig.suptitle(f\"{movie_df.movie[0]}\\n{n} most speaking characters vocabulary  score\")\n    axs_=axs.flatten()\n    for j,ch in enumerate(top_ch):\n        ax = axs_[j]\n        \n        ch_dialog = list(movie_df[movie_df['character']==ch]['dialog_processed'])\n        text_object = NRCLex(' '.join(ch_dialog))\n        \n        sentiment_scores = pd.DataFrame(list(text_object.raw_emotion_scores.items()))\n        sentiment_scores = sentiment_scores.rename(columns={0: \"sentiment\", 1: \"score\"}).sort_values(['sentiment'])\n        sentiment_scores['score']= sentiment_scores['score']\/(sentiment_scores.sum()[\"score\"])\n        sns.barplot(x='score',y='sentiment', data=sentiment_scores, palette='Spectral',ax=ax)\n        ax.set_title(f\"{ch} ({int(dialog_count[dialog_count['character'] == ch]['dialog_processed'])} sentences)\")\n    return fig.show()\n    ","176d8e54":"main_path = \"..\/input\/harry-potter-movies-dataset\/datasets\"\nmovies_df = [process_df(f\"{main_path}\/hp{i}.csv\") for i in range(1,9)]","8ef733a0":"show_vocabulary_scores(movies_df[0])","f3cfc24b":"show_vocabulary_scores(movies_df[1])","a8b1a15a":"show_vocabulary_scores(movies_df[2])","acb1a444":"show_vocabulary_scores(movies_df[3])","f2e5ba1f":"show_vocabulary_scores(movies_df[4])","56a234b7":"show_vocabulary_scores(movies_df[5])","b38b29f7":"show_vocabulary_scores(movies_df[6])","d4c5effe":"show_vocabulary_scores(movies_df[7])","3baaca7e":"all_movies_df = pd.concat(movies_df,ignore_index=True)\nshow_vocabulary_scores(all_movies_df,n=10)","65ba7e6c":"## Harry Potter and the Deathly Hallows Part 2","7385a615":"## Harry Potter and the Prisoner of Azkaban","2419454d":"## Harry Potter and the Deathly Hallows Part 1","7d63de28":"## Harry Potter and the Gobelt of Fire","3b5cbfd0":"## All movies","2098c699":"## Harry Potter and the Order of the Phoenix","c9a72c3b":"## Harry Potter and the Half-Blood Prince","3dfd98aa":"## Harry Potter and the Philosopher's Stone","78b9e3ab":"## Harry Potter and the Chamber of Secrets"}}