{"cell_type":{"e454ad9b":"code","bb7391b6":"code","1d09b7d0":"code","6cd17d9a":"code","4d469c83":"code","2eb5e6c6":"code","bd16c121":"code","c559c1c7":"code","4ba36345":"code","897ffca9":"code","771016a5":"code","6c0a46e5":"code","e427269a":"code","b51f0fda":"code","5e3cf5a2":"code","1ed980e2":"code","655cd5e8":"code","b12903cb":"code","045cc703":"code","4267ec2a":"code","4e7fe5bd":"code","5071cdc8":"code","448a5a9e":"code","4530ffbb":"code","81aabda1":"code","53d32e18":"markdown","01e8563c":"markdown","a5b08e64":"markdown","1da29697":"markdown","45bd9f18":"markdown","06eaa7ba":"markdown","b7ffd71b":"markdown","e8385a5d":"markdown","ce7021da":"markdown","535d0d75":"markdown","9aa48987":"markdown","2ad679b0":"markdown"},"source":{"e454ad9b":"import os\n\nimport pandas as pd\nimport numpy as np\n\n\nfrom plotly.offline import init_notebook_mode, iplot, plot\nimport plotly as py\nimport plotly.express as px\nimport plotly.graph_objs as go\nimport matplotlib.pyplot as plt\n\ninit_notebook_mode(connected=True)","bb7391b6":"df = pd.read_csv('..\/input\/owid-covid-data.csv')","1d09b7d0":"df['death_rate'] = (df['new_deaths_smoothed_per_million'] \/ df['new_cases_smoothed_per_million']).replace(np.inf,np.nan)\ndf['population_coverage'] = df['total_tests'] \/ df['population']\ndf['datetime'] = pd.to_datetime(df['date'])","6cd17d9a":"df.describe().T","4d469c83":"problem_idx = df[(df['new_cases']<0)|(df['new_deaths']<0)|(df['new_cases_smoothed']<0)|(df['new_deaths_smoothed']<0)|(df['new_cases_per_million']<0)|(df['new_deaths_per_million']<0)\n                 |(df['new_deaths_smoothed_per_million']<0)|(df['new_tests']<0)|(df['new_tests_per_thousand']<0)|(df['location'].isin(['World']))].index","2eb5e6c6":"df = df[~df.index.isin(problem_idx)]\ndf = df[~df['date'].isin(['2020-09-18', '2020-09-19'])].reset_index(drop=True)","bd16c121":"trace1 = go.Scatter(\n    x=df.groupby(['date'])['date'].apply(lambda x: np.unique(x)[0]),\n    y=df.groupby(['date'])['new_tests_smoothed'].sum().astype(int),\n        xaxis='x2',\n    yaxis='y2',\n    name = \"new tests smoothed\"\n)\ntrace2 = go.Scatter(\n    x=df.groupby(['date'])['date'].apply(lambda x: np.unique(x)[0]),\n    y=df.groupby(['date'])['new_deaths_smoothed'].sum().astype(int),\n    name = \"new deaths smoothed\"\n)\ntrace3 = go.Scatter(\n    x=df.groupby(['date'])['date'].apply(lambda x: np.unique(x)[0]),\n    y=(df.groupby(['date'])['positive_rate'].mean() * 100).round(3),\n    xaxis='x3',\n    yaxis='y3',\n    name = \"test positive rate %\"\n)\ntrace4 = go.Scatter(\n    x=df.groupby(['date'])['date'].apply(lambda x: np.unique(x)[0]),\n    y=df.groupby(['date'])['new_cases_smoothed'].sum().astype(int),\n    xaxis='x4',\n    yaxis='y4',\n    name = \"new cases smoothed\"\n)\n\ndata = [trace1, trace2, trace3, trace4]\nlayout = go.Layout(\n    xaxis=dict(\n        domain=[0, 0.45]\n    ),\n    yaxis=dict(\n        domain=[0, 0.45]\n    ),\n    xaxis2=dict(\n        domain=[0.55, 1]\n    ),\n    xaxis3=dict(\n        domain=[0, 0.45],\n        anchor='y3'\n    ),\n    xaxis4=dict(\n        domain=[0.55, 1],\n        anchor='y4'\n    ),\n    yaxis2=dict(\n        domain=[0, 0.45],\n        anchor='x2'\n    ),\n    yaxis3=dict(\n        domain=[0.55, 1]\n    ),\n    yaxis4=dict(\n        domain=[0.55, 1],\n        anchor='x4'\n    ),\n    title = 'New tests, deaths, cases and test positive rate'\n)\nfig = go.Figure(data=data, layout=layout)\niplot(fig)","c559c1c7":"trace1 = go.Scatter(\n    x=df.groupby(['date'])['date'].apply(lambda x: np.unique(x)[0]),\n    y=df.groupby(['date'])['new_deaths_smoothed_per_million'].mean(),\n        xaxis='x2',\n    yaxis='y2',\n    name = \"mean new deaths smoothed per million\"\n)\ntrace2 = go.Scatter(\n    x=df.groupby(['date'])['date'].apply(lambda x: np.unique(x)[0]),\n    y=df.groupby(['date'])['new_tests_smoothed_per_thousand'].mean(),\n    name = \"mean new tests smoothed per thousand\"\n)\ntrace3 = go.Scatter(\n    x=df.groupby(['date'])['date'].apply(lambda x: np.unique(x)[0]),\n    y=(df.groupby(['date'])['death_rate'].mean().replace([np.inf],np.nan).interpolate(method='linear', limit_direction='forward', axis=0) * 100).round(3),\n    xaxis='x3',\n    yaxis='y3',\n    name = \"interpolated death rate %\"\n)\ntrace4 = go.Scatter(\n    x=df.groupby(['date'])['date'].apply(lambda x: np.unique(x)[0]),\n    y=((df.groupby(['date'])['new_cases_per_million'].apply(lambda x: np.mean(x\/1e+6))) * 100).round(6),\n    xaxis='x4',\n    yaxis='y4',\n    name = \"mean covid population d2d coverage %\"\n)\n\ndata = [trace1, trace2, trace3, trace4]\nlayout = go.Layout(\n    xaxis=dict(\n        domain=[0, 0.45]\n    ),\n    yaxis=dict(\n        domain=[0, 0.45]\n    ),\n    xaxis2=dict(\n        domain=[0.55, 1]\n    ),\n    xaxis3=dict(\n        domain=[0, 0.45],\n        anchor='y3'\n    ),\n    xaxis4=dict(\n        domain=[0.55, 1],\n        anchor='y4'\n    ),\n    yaxis2=dict(\n        domain=[0, 0.45],\n        anchor='x2'\n    ),\n    yaxis3=dict(\n        domain=[0.55, 1]\n    ),\n    yaxis4=dict(\n        domain=[0.55, 1],\n        anchor='x4'\n    ),\n    title = 'Mean new deaths per 1M, new tests per 1K, death rate and covid mean coverage'\n)\nfig = go.Figure(data=data, layout=layout)\niplot(fig)","4ba36345":"trace1 = go.Scatter(\n                    x = df[(df['continent']=='Asia')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='Asia')].groupby(['date','continent'])['new_deaths_smoothed'].sum(),\n                    mode = \"lines\",\n                    name = \"Asia\",\n                    marker = dict(color = 'green'),\n)\n\ntrace2 = go.Scatter(\n                    x = df[(df['continent']=='Europe')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='Europe')].groupby(['date','continent'])['new_deaths_smoothed'].sum(),\n                    mode = \"lines\",\n                    name = \"Europe\",\n                    marker = dict(color = 'red'),\n)\n\ntrace3 = go.Scatter(\n                    x = df[(df['continent']=='Africa')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='Africa')].groupby(['date','continent'])['new_deaths_smoothed'].sum(),\n                    mode = \"lines\",\n                    name = \"Africa\",\n                    marker = dict(color = 'blue'),\n                    #text= df.university_name\n)\n\ntrace4 = go.Scatter(\n                    x = df[(df['continent']=='North America')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='North America')].groupby(['date','continent'])['new_deaths_smoothed'].sum(),\n                    mode = \"lines\",\n                    name = \"North America\",\n                    marker = dict(color = 'black'),\n)\n\ntrace5 = go.Scatter(\n                    x = df[(df['continent']=='South America')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='South America')].groupby(['date','continent'])['new_deaths_smoothed'].sum(),\n                    mode = \"lines\",\n                    name = \"South America\",\n                    marker = dict(color = 'brown'),\n)\n\ndata = [trace1,trace2,trace3,trace4,trace5]\nlayout = dict(title = 'New Deaths Smoothed',\n              xaxis= dict(title= '# deaths day by day',ticklen= 5,zeroline= False)\n             )\nfig = dict(data = data, layout = layout)\niplot(fig)","897ffca9":"trace1 = go.Scatter(\n                    x = df[(df['continent']=='Asia')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='Asia')].groupby(['date','continent'])['new_tests_smoothed'].sum(),\n                    mode = \"lines\",\n                    name = \"Asia\",\n                    marker = dict(color = 'green'),\n)\n\ntrace2 = go.Scatter(\n                    x = df[(df['continent']=='Europe')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='Europe')].groupby(['date','continent'])['new_tests_smoothed'].sum(),\n                    mode = \"lines\",\n                    name = \"Europe\",\n                    marker = dict(color = 'red'),\n)\n\ntrace3 = go.Scatter(\n                    x = df[(df['continent']=='Africa')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='Africa')].groupby(['date','continent'])['new_tests_smoothed'].sum(),\n                    mode = \"lines\",\n                    name = \"Africa\",\n                    marker = dict(color = 'blue'),\n)\n\ntrace4 = go.Scatter(\n                    x = df[(df['continent']=='North America')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='North America')].groupby(['date','continent'])['new_tests_smoothed'].sum(),\n                    mode = \"lines\",\n                    name = \"North America\",\n                    marker = dict(color = 'black'),\n)\n\ntrace5 = go.Scatter(\n                    x = df[(df['continent']=='South America')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='South America')].groupby(['date','continent'])['new_tests_smoothed'].sum(),\n                    mode = \"lines\",\n                    name = \"South America\",\n                    marker = dict(color = 'brown'),\n)\n\ndata = [trace1,trace2,trace3,trace4,trace5]\nlayout = dict(title = 'New tests smoothed',\n              xaxis= dict(title= '# tests day by day',ticklen= 5,zeroline= False)\n             )\nfig = dict(data = data, layout = layout)\niplot(fig)","771016a5":"trace1 = go.Scatter(\n                    x = df[(df['continent']=='Asia')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='Asia')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['death_rate'].mean()*100,\n                    mode = \"lines\",\n                    name = \"Asia\",\n                    marker = dict(color = 'green'),\n)\n\ntrace2 = go.Scatter(\n                    x = df[(df['continent']=='Europe')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='Europe')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['death_rate'].mean()*100,\n                    mode = \"lines\",\n                    name = \"Europe\",\n                    marker = dict(color = 'red'),\n)\n\ntrace3 = go.Scatter(\n                    x = df[(df['continent']=='Africa')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='Africa')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['death_rate'].mean()*100,\n                    mode = \"lines\",\n                    name = \"Africa\",\n                    marker = dict(color = 'blue'),\n)\n\ntrace4 = go.Scatter(\n                    x = df[(df['continent']=='North America')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='North America')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['death_rate'].mean()*100,\n                    mode = \"lines\",\n                    name = \"North America\",\n                    marker = dict(color = 'black'),\n)\n\ntrace5 = go.Scatter(\n                    x = df[(df['continent']=='South America')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='South America')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['death_rate'].mean(),\n                    mode = \"lines\",\n                    name = \"South America\",\n                    marker = dict(color = 'brown'),\n)\n\ndata = [trace1,trace2,trace3,trace4,trace5]\nlayout = dict(title = 'Mean death rate over continents',\n              xaxis= dict(title= 'mean deaths\/cases %',ticklen= 5,zeroline= False)\n             )\nfig = dict(data = data, layout = layout)\niplot(fig)","6c0a46e5":"trace1 = go.Scatter(\n                    x = df[(df['continent']=='Asia')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='Asia')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['death_rate'].mean()*100,\n                    mode = \"lines\",\n                    name = \"Asia\",\n                    marker = dict(color = 'green'),\n)\n\ntrace2 = go.Scatter(\n                    x = df[(df['continent']=='Europe')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='Europe')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['population_coverage'].mean()*100,\n                    mode = \"lines\",\n                    name = \"Europe\",\n                    marker = dict(color = 'red'),\n)\n\ntrace3 = go.Scatter(\n                    x = df[(df['continent']=='Africa')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='Africa')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['population_coverage'].mean()*100,\n                    mode = \"lines\",\n                    name = \"Africa\",\n                    marker = dict(color = 'blue'),\n)\n\ntrace4 = go.Scatter(\n                    x = df[(df['continent']=='North America')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='North America')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['population_coverage'].mean()*100,\n                    mode = \"lines\",\n                    name = \"North America\",\n                    marker = dict(color = 'black'),\n)\n\ntrace5 = go.Scatter(\n                    x = df[(df['continent']=='South America')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['date'].apply(lambda x: np.unique(x)[0]),\n                    y = df[(df['continent']=='South America')&(df['datetime']>='2020-03-01')].groupby(['date','continent'])['population_coverage'].mean(),\n                    mode = \"lines\",\n                    name = \"South America\",\n                    marker = dict(color = 'brown'),\n)\n\ndata = [trace1,trace2,trace3,trace4,trace5]\nlayout = dict(title = 'Mean population test coverage over continents',\n              xaxis= dict(title= 'mean tests\/population %',ticklen= 5,zeroline= False)\n             )\nfig = dict(data = data, layout = layout)\niplot(fig)","e427269a":"df_grouped = df.groupby(['location','continent']).agg({'new_deaths': np.sum, 'gdp_per_capita': np.mean, 'new_cases':np.sum}).reset_index()\ndf_grouped = df_grouped[(~df_grouped['new_deaths'].isnull())&(~df_grouped['new_cases'].isnull())&(~df_grouped['gdp_per_capita'].isnull())&(~df_grouped['continent'].isnull())]","b51f0fda":"fig = px.scatter(df_grouped, \n                 x=\"new_deaths\", y=\"gdp_per_capita\", size=\"new_cases\", color=\"continent\",\n                 hover_name=\"location\", log_x=True, size_max=60)\nfig.show()","5e3cf5a2":"df_grouped = df.groupby(['location','continent']).agg({'handwashing_facilities': np.mean, 'new_deaths_smoothed_per_million': np.sum, 'extreme_poverty':np.mean}).reset_index()\ndf_grouped = df_grouped[(~df_grouped['handwashing_facilities'].isnull())&(~df_grouped['new_deaths_smoothed_per_million'].isnull())&(~df_grouped['extreme_poverty'].isnull())&(~df_grouped['continent'].isnull())]","1ed980e2":"fig = px.scatter(df_grouped, \n                 x=\"new_deaths_smoothed_per_million\", y=\"handwashing_facilities\", size=\"extreme_poverty\", color=\"continent\",\n                 hover_name=\"location\", log_x=True, size_max=60)\nfig.show()","655cd5e8":"df_grouped = df.groupby(['location','continent']).agg({'population_density': np.mean, 'new_deaths_smoothed_per_million': np.sum, 'aged_70_older':np.mean}).reset_index()\ndf_grouped = df_grouped[(~df_grouped['population_density'].isnull())&(~df_grouped['new_deaths_smoothed_per_million'].isnull())&(~df_grouped['aged_70_older'].isnull())&(~df_grouped['continent'].isnull())]","b12903cb":"fig = px.scatter(df_grouped, \n                 x=\"new_deaths_smoothed_per_million\", y=\"aged_70_older\", size=\"population_density\", color=\"continent\",\n                 hover_name=\"location\", log_x=True, size_max=60)\nfig.show()","045cc703":"df_grouped = df.groupby(['location','continent']).agg({'life_expectancy': np.mean, 'new_deaths_smoothed_per_million': np.sum, 'hospital_beds_per_thousand':np.mean}).reset_index()\ndf_grouped = df_grouped[(~df_grouped['life_expectancy'].isnull())&(~df_grouped['new_deaths_smoothed_per_million'].isnull())&(~df_grouped['hospital_beds_per_thousand'].isnull())&(~df_grouped['continent'].isnull())]","4267ec2a":"fig = px.scatter(df_grouped, \n                 x=\"new_deaths_smoothed_per_million\", y=\"life_expectancy\", size=\"hospital_beds_per_thousand\", color=\"continent\",\n                 hover_name=\"location\", log_x=True, size_max=60)\nfig.show()","4e7fe5bd":"df_grouped = df.groupby(['location','continent']).agg({'death_rate': np.mean, 'stringency_index': np.mean, 'new_cases':np.sum}).reset_index()\ndf_grouped = df_grouped[(~df_grouped['death_rate'].isnull())&(~df_grouped['stringency_index'].isnull())&(~df_grouped['new_cases'].isnull())&(~df_grouped['continent'].isnull())]","5071cdc8":"fig = px.scatter(df_grouped, \n                 x=\"death_rate\", y=\"stringency_index\", size=\"new_cases\", color=\"continent\",\n                 hover_name=\"location\", log_x=True, size_max=60)\nfig.show()","448a5a9e":"df['year_month'] = df['date'].apply(lambda x: x[:7])\ndf_grouped = df.groupby(['location','year_month']).agg({'new_deaths': np.sum, 'gdp_per_capita': np.mean, 'new_cases':np.sum}).reset_index()\ndf_grouped = df_grouped[(~df_grouped['new_deaths'].isnull())&(~df_grouped['new_cases'].isnull())&(~df_grouped['gdp_per_capita'].isnull())&(~df_grouped['location'].isnull())]\ndel df['year_month']","4530ffbb":"df_grouped = df_grouped[df_grouped['year_month'].isin(['2020-04','2020-05','2020-06','2020-07','2020-08','2020-09'])]","81aabda1":"fig = px.scatter(df_grouped[df_grouped['location'].isin(['United States','India','Brazil','Russia'])], \n                 x=\"new_cases\", y=\"new_deaths\", animation_frame=\"year_month\", animation_group=\"location\",\n                 size=\"new_cases\", color=\"location\", hover_name=\"location\", facet_col=\"location\",\n                 log_x=True, size_max=60,range_x=[5000,10000000], range_y=[100,70000])\nfig.show()","53d32e18":"### New Deaths Smoothed","01e8563c":"### Stringency Index and death rate correlation","a5b08e64":"### Let's find some new_deaths_smoothed_per_million, aged_70_older and population_density clusters over countries","1da29697":"### Death rate","45bd9f18":"### Let's find some new_deaths_smoothed_per_million, life_expectancy and  hospital_beds_per_thousand clusters over countries","06eaa7ba":"### Let's find some new_deaths_smoothed_per_million, handwashing_facilities and extreme_poverty clusters over countries","b7ffd71b":"### Test population coverage","e8385a5d":"### New Cases, Tests, Deaths and positive rate over all countries","ce7021da":"### New Tests Smoothed","535d0d75":"### Let's check changes in TOP-4 countries by Cases starting from April","9aa48987":"### Let's find some gdp_per_capita and new_cases clusters over countries","2ad679b0":"### Some columns are surprisingly negative, lets filter them"}}