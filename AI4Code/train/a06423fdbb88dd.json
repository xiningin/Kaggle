{"cell_type":{"b270e307":"code","ca7fda27":"code","382bfac6":"code","01f43197":"code","033b6bfd":"code","96129deb":"code","01e8aafc":"code","3ab6903a":"code","9c8d1e62":"code","d4b1a8ea":"markdown","63733d30":"markdown","321e898c":"markdown"},"source":{"b270e307":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","ca7fda27":"df_train = pd.read_csv('\/kaggle\/input\/covid19-global-forecasting-week-2\/train.csv')\ndf_test = pd.read_csv('\/kaggle\/input\/covid19-global-forecasting-week-2\/test.csv')\ndf_submission = pd.read_csv('\/kaggle\/input\/covid19-global-forecasting-week-2\/submission.csv')","382bfac6":"df_train","01f43197":"df_test","033b6bfd":"df_submission","96129deb":"# date_list(from 2020-1-22 untill2020-3-18)\nwork_list = []\nfirst_date = df_train['Date'][0]\nlast_date = '2020-03-18'\ninner_list = []\ndata_in_status = 0\nfor i in range(len(df_train)):\n    date = df_train['Date'][i]\n    if date == first_date:\n        date_list = []\n        data_in_status = 1\n    if data_in_status == 1:\n        province_state = df_train['Province_State'][i]\n        country_region = df_train['Country_Region'][i]\n        confirmed_cases = df_train['ConfirmedCases'][i]\n        fatalities = df_train['Fatalities'][i]\n        inner_dic = {'Province_State':province_state,\n                     'Country_Region':country_region,\n                     'Date':date,\n                     'ConfirmedCases':confirmed_cases,\n                     'Fatalities':fatalities\n                    }\n        inner_list.append(inner_dic)\n        date_list.append(date)\n        if date == last_date:\n            work_list.append(inner_list)\n            data_in_status = 0\n            inner_list = []\nnp_date_list = np.array(date_list)\n#np_date_list","01e8aafc":"# Make add_date_list(from 2020-03-19 untill 2020-04-30)\nadd_date_list = []\nfor i in range(len(df_test['Date'])):\n    date = df_test['Date'][i]\n    add_date_list.append(date)\n    if date == '2020-04-30':\n        break\nnp_add_date_list = np.array(add_date_list)\n#np_add_date_list","3ab6903a":"# Analysys, Visualization, output CSV\nimport matplotlib.pyplot as plt\nforecast_id = 0\nsubmission_list = []\ntest_list = []\nfor i in range(len(work_list)):\n    country_list = work_list[i]\n    if pd.isnull(country_list[0]['Province_State']):\n        province_state = ''\n    else:\n        province_state = '(' + country_list[0]['Province_State'] + ')'\n    country_region = country_list[0]['Country_Region']\n    confirmed_list = []\n    fatalities_list = []\n    for j in range(len(country_list)):\n        confirmed = country_list[j]['ConfirmedCases']\n        confirmed_list.append(confirmed)\n        fatalities = country_list[j]['Fatalities']\n        fatalities_list.append(fatalities)\n        \n    fig = plt.figure()\n    ax = fig.add_subplot(1,1,1)\n\n    x = date_list\n    y_c = np.array(confirmed_list)\n    y_f = np.array(fatalities_list)\n    x1 = np.arange(len(x))\n    #**********************************************************\n    # Determine dimensions\n    dimension_c = 6 # for confirmed cases\n    dimension_f = 6 # for fatalities\n    fit_c = np.polyfit(x1, y_c, dimension_c)\n    fit_f = np.polyfit(x1, y_f, dimension_f)\n    #**********************************************************\n    y_c2 = np.poly1d(fit_c)(x1)\n    y_f2 = np.poly1d(fit_f)(x1)\n\n    # predict\n    temp_date = np.append(x, add_date_list)\n    x2 = x\n    predict_list_c = []\n    predict_list_f = []\n    saved_predict_c = 0\n    saved_predict_f = 0\n    inner_count = 0\n    for j in range(len(x), len(temp_date)):\n        predict_c = round(np.poly1d(fit_c)(j))\n        predict_f = round(np.poly1d(fit_f)(j))\n        if predict_c < predict_f:\n            predict_f = predict_c\n        x2 = np.append(x2, temp_date[j])\n        if predict_c > saved_predict_c:\n            predict_list_c.append(predict_c)\n            saved_predict_c = predict_c\n        else:\n            predict_list_c.append(saved_predict_c)\n        if predict_f > saved_predict_f:\n            predict_list_f.append(predict_f)\n            saved_predict_f = predict_f\n        else:\n            predict_list_f.append(saved_predict_f)\n        # for submission\n        forecast_id += 1\n        submission_dic = {'ForecastId':forecast_id,\n                          'ConfirmedCases':saved_predict_c,\n                          'Fatalities':saved_predict_f\n                         }\n        test_dic = {'ForecastId':forecast_id,\n                    'ConfirmedCases':saved_predict_c,\n                    'Fatalities':saved_predict_f,\n                    'Date':np_add_date_list[inner_count],\n                    'Province_State':province_state,\n                    'Country_Region':country_region\n                   }\n        \n        inner_count += 1\n        submission_list.append(submission_dic)\n        test_list.append(test_dic)\n        \n    predict_list_c = np.array(predict_list_c)\n    predict_list_f = np.array(predict_list_f)\n    y_c3 = np.append(y_c2, predict_list_c)\n    y_f3 = np.append(y_f2, predict_list_f)\n\n    ax.plot(x,y_c,'bo', color='y', label='Confirmed')\n    ax.plot(x2,y_c3,'--k', color='g', label='Confirmed')\n    ax.plot(x,y_f,'bo', color='pink', label='Fatalities')\n    ax.plot(x2,y_f3,'--k', color='r', label='Fatalities')\n\n    plt.title(country_region + province_state)\n    plt.xlabel(\"Date\")\n    plt.ylabel(\"Number of people\")\n    plt.xticks(np.arange(0, len(x2), 10), rotation=-45)\n    plt.grid(True)\n    plt.tight_layout()\n    plt.legend()\n    plt.show()\n\n    # r2_score\n    from sklearn.metrics import r2_score\n    print('Score(Confirmed):{:.3f}'.format(r2_score(y_c, y_c2)))\n    print('Score(Fatalities):{:.3f}'.format(r2_score(y_f, y_f2)))\n","9c8d1e62":"my_submission_list = pd.DataFrame(submission_list)\nmy_submission_list.to_csv(path_or_buf='submission.csv', index=False)\ndf_test_list = pd.DataFrame(test_list)\ndf_test_list","d4b1a8ea":"> **Make work_list and date_list**","63733d30":"**Impport files**","321e898c":"**Nonlinear regression analysis**"}}