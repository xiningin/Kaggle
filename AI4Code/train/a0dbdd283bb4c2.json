{"cell_type":{"b75af5c6":"code","6589e590":"code","78e0411e":"code","353ef715":"code","580b1a47":"code","e0c38ad1":"code","0a134d28":"code","4f64662c":"code","a22aa736":"code","d291fda9":"code","40182315":"code","1876fb1f":"code","4454edcb":"code","7b583965":"markdown","e286b4c7":"markdown","bf94a9e5":"markdown","456fae96":"markdown","30efaee5":"markdown","4aacb0c6":"markdown","f25aa335":"markdown","ae0d48a1":"markdown","32f294a0":"markdown","c51f3559":"markdown"},"source":{"b75af5c6":"%%html\n<iframe src=\"https:\/\/ourworldindata.org\/grapher\/covid-confirmed-cases-since-100th-case?country=CAN+MEX+PAN\" style=\"width: 100%; height: 600px; border: 0px none;\"><\/iframe>","6589e590":"import numpy as np\nimport pandas as pd\nimport plotly.graph_objects as go\nimport plotly.express as px\n# Plotly installation: https:\/\/plot.ly\/python\/getting-started\/#jupyterlab-support-python-35\n\nDATA_FOLDER = \"..\/input\/covid19-global-forecasting-week-1\/\"\nDATA_ALT_FOLDER = \"..\/input\/novel-corona-virus-2019-dataset\/\"","78e0411e":"df = pd.read_csv(DATA_FOLDER + \"train.csv\")\ndf[\"Date\"] = pd.to_datetime(df[\"Date\"], format=\"%Y-%m-%d\")\ndf.shape","353ef715":"df_alt = pd.read_csv(DATA_ALT_FOLDER + \"time_series_covid_19_confirmed.csv\")\ndf_alt.shape","580b1a47":"df_country_stats = df.groupby([\"Country\/Region\", \"Date\"])[[\"ConfirmedCases\", \"Fatalities\"]].sum().reset_index()\nprint(\"# of Entries:\", df_country_stats.shape[0])\nprint(\"# of Non-Zero Entries:\", df_country_stats[df_country_stats.ConfirmedCases > 0].shape[0])\nprint(\"# of Countries:\", df_country_stats[\"Country\/Region\"].nunique())\nprint(\"# of Countries with confirmed cases:\", df_country_stats[df_country_stats.ConfirmedCases > 0][\"Country\/Region\"].nunique())\ndf_country_stats.sample(5)","e0c38ad1":"# Only keep entries with ConfirmedCases > 0\ndf_country_stats = df_country_stats[df_country_stats.ConfirmedCases > 0].reset_index(drop=True)\ndf_country_stats[df_country_stats[\"Country\/Region\"] == \"US\"].tail()","0a134d28":"df_tmp = df_alt.drop([\"Lat\", \"Long\"], axis=1).groupby([\"Country\/Region\"]).sum()\ndf_country_stats_alt = df_tmp.reset_index().melt([\"Country\/Region\"], var_name=\"Date\", value_name=\"ConfirmedCases\")\ndf_country_stats_alt[\"Date\"] = pd.to_datetime(df_country_stats_alt[\"Date\"], format=\"%m\/%d\/%y\")\nprint(\"# of Entries:\", df_country_stats_alt.shape[0])\nprint(\"# of Non-Zero Entries:\", df_country_stats_alt[df_country_stats_alt.ConfirmedCases > 0].shape[0])\nprint(\"# of Countries:\", df_country_stats_alt[\"Country\/Region\"].nunique())\nprint(\"# of Countries with confirmed cases:\", df_country_stats_alt[df_country_stats_alt.ConfirmedCases > 0][\"Country\/Region\"].nunique())\ndf_country_stats_alt.sample(5)","4f64662c":"# Only keep entries with ConfirmedCases > 0\ndf_country_stats_alt = df_country_stats_alt[df_country_stats_alt.ConfirmedCases > 0].reset_index(drop=True)\ndf_country_stats_alt[df_country_stats_alt[\"Country\/Region\"] == \"US\"].tail()","a22aa736":"df_tmp = df_country_stats_alt[df_country_stats_alt.Date <= \"2020-03-18\"].merge(\n    df_country_stats[df_country_stats.Date <= \"2020-03-18\"], on=[\"Country\/Region\", \"Date\"], how=\"inner\"\n)\nnp.array_equal(df_tmp[\"ConfirmedCases_x\"].values.astype(\"int\"), df_tmp[\"ConfirmedCases_y\"].values.astype(\"int\"))\ndf_tmp[df_tmp[\"ConfirmedCases_x\"] != df_tmp[\"ConfirmedCases_y\"]]","d291fda9":"df_country_stats = df_country_stats_alt","40182315":"SAMPLED_COUNTRIES = [\"Iran\", \"Korea, South\", \"Japan\", \"US\", \"Italy\", \"France\", \"Germany\", \"UK\", \"Spain\"]\n# Reference: https:\/\/plot.ly\/python\/time-series\/\nfig = go.Figure(\n    [\n        go.Scatter(\n            x=df_country_stats[df_country_stats[\"Country\/Region\"] == name]['Date'], \n            y=df_country_stats[df_country_stats[\"Country\/Region\"] == name]['ConfirmedCases'], \n            name=name,\n            mode='lines',\n            line=dict(width=2)\n        ) for name in SAMPLED_COUNTRIES\n    ],\n    layout_title_text=\"Cumulative number of cases in Selected Countries\"\n)\nfig.update_layout(\n    yaxis_type=\"log\",\n    margin=dict(l=20, r=20, t=50, b=20),\n    template=\"plotly_white\")\nfig.show()","1876fb1f":"fig = go.Figure(\n    [\n        go.Scatter(\n            x=np.arange(df_country_stats[df_country_stats[\"Country\/Region\"] == name].shape[0]), \n            y=df_country_stats[df_country_stats[\"Country\/Region\"] == name]['ConfirmedCases'], \n            name=name,\n            mode='lines',\n            line=dict(width=2)\n        ) for name in SAMPLED_COUNTRIES\n    ],\n    layout_title_text=\"Cumulative number of cases, by number of days since first case\"    \n)\nfig.update_layout(\n    yaxis_type=\"log\",\n    xaxis_title=\"Day\",\n    margin=dict(l=20, r=20, t=50, b=50),\n    template=\"plotly_white\")\nfig.show()","4454edcb":"fig = go.Figure(\n    [\n        go.Scatter(\n            x=np.arange(df_country_stats[\n                (df_country_stats[\"Country\/Region\"] == name) & (df_country_stats.ConfirmedCases >= 100)\n            ].shape[0]), \n            y=df_country_stats[\n                (df_country_stats[\"Country\/Region\"] == name) & (df_country_stats.ConfirmedCases >= 100)\n            ]['ConfirmedCases'], \n            mode='lines',\n            name=name,\n            line=dict(width=2)\n        ) for name in SAMPLED_COUNTRIES\n    ],\n    layout_title_text=\"Cumulative number of cases, by number of days since the 100th case\"\n)\nfig.update_layout(\n    yaxis_type=\"log\",\n    xaxis_title=\"Day\",\n    margin=dict(l=20, r=20, t=50, b=50),\n    width=800, height=500,\n    template=\"plotly_white\")\nfig.add_shape(\n    type=\"line\",\n#     xref=\"x\",\n#     yref=\"y\",\n    x0=0,\n    y0=100,\n    x1=30,\n    y1=799,\n    line=dict(\n        color=\"Grey\",\n        width=1,\n        dash=\"dot\"\n    ),\n)\nfig.add_shape(\n    type=\"line\",\n    x0=0,\n    y0=100,\n    x1=30,\n    y1=6400,\n    line=dict(\n        color=\"Grey\",\n        width=1,\n        dash=\"dot\"\n    ),\n)\nfig.add_shape(\n    type=\"line\",\n    x0=0,\n    y0=100,\n    x1=30,\n    y1=102400,\n    line=dict(\n        color=\"Grey\",\n        width=1,\n        dash=\"dot\"\n    ),\n)\nfig.add_shape(\n    type=\"line\",\n    x0=0,\n    y0=100,\n    x1=20,\n    y1=102400,\n    line=dict(\n        color=\"Grey\",\n        width=1,\n        dash=\"dot\"\n    ),\n)\nfig.add_annotation(\n    xref=\"x\",\n    yref=\"y\",    \n    x=18,\n    y=4.63,\n    showarrow=False,\n    text=\"doubling every 2 days\",\n    textangle=-43,\n    font={\n        \"color\": \"Grey\"\n    }\n)\nfig.add_annotation(\n    xref=\"x\",\n    yref=\"y\",    \n    x=27,\n    y=4.63,\n    showarrow=False,\n    text=\"doubling every 3 days\",\n    textangle=-33,\n    font={\n        \"color\": \"Grey\"\n    }\n)\nfig.add_annotation(\n    xref=\"x\",\n    yref=\"y\",    \n    x=28,\n    y=3.63,\n    showarrow=False,\n    text=\"doubling every 5 days\",\n    textangle=-17,\n    font={\n        \"color\": \"Grey\"\n    }\n)\nfig.add_annotation(\n    xref=\"x\",\n    yref=\"y\",    \n    x=28,\n    y=2.78,\n    showarrow=False,\n    text=\"doubling every 10 days\",\n    textangle=-8,\n    font={\n        \"color\": \"Grey\"\n    }\n)\nfig.show()","7b583965":"## Aggregate to the country level","e286b4c7":"![FT chart](https:\/\/www.ft.com\/__origami\/service\/image\/v2\/images\/raw\/http%3A%2F%2Fcom.ft.imagepublish.upp-prod-us.s3.amazonaws.com%2Febcfb388-6ae3-11ea-800d-da70cff6e4d3?fit=scale-down&quality=highest&source=next&width=1260)","bf94a9e5":"## By number of days since first case","456fae96":"Updated on March 30","30efaee5":"Alternative datset (time series):","4aacb0c6":"## By calendar dates","f25aa335":"This is a preliminary work attempting to reproduce the charts by [FT](https:\/\/www.ft.com\/content\/a26fbf7e-48f8-11ea-aeb3-955839e06441) and [Our World In Data](https:\/\/ourworldindata.org\/coronavirus#trajectories-since-the-100th-confirmed-case) (attached below) using Plotly.\n\n(The US data in the [provided data set](https:\/\/www.kaggle.com\/c\/covid19-global-forecasting-week-1\/data) seems weird and does not match data in other charts. I'm not sure if there's a bug in my code or the difference in data collection methods.) (Update: the timeseries data from the [CSSEGISandData \/ COVID-19](https:\/\/github.com\/CSSEGISandData\/COVID-19) Github repo seems more consistent with other sources, so I switched to it(via [this Kaggle dataset](https:\/\/www.kaggle.com\/sudalairajkumar\/novel-corona-virus-2019-dataset\/)). The comparison between the two dataset are also provided in the notebook)","ae0d48a1":"Use the alternative source (ConfirmedCases_y):","32f294a0":"### Test consistency","c51f3559":"## By number of days since 100th case"}}