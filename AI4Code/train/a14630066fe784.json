{"cell_type":{"8b4a3b26":"code","d82842a2":"code","6abcb44f":"code","aa10fa2c":"code","335a16df":"code","ef237884":"code","36b7920b":"code","318542b8":"code","9b14b54b":"code","53caf2e8":"code","497e2c0e":"code","3662d6a0":"code","0f27f46e":"code","c10997f8":"code","e45ebb60":"code","0653149c":"code","6465930b":"code","c1fb0d37":"code","96189c49":"code","98a7d0be":"code","1b9783de":"code","48e3b28d":"code","f888c6ec":"code","05a701fa":"code","23c4a1fc":"code","0081ced4":"code","4b46340d":"code","531917e7":"code","b84fd046":"code","780f889e":"code","4504608a":"code","dece01fd":"code","92553354":"code","a4513bc0":"code","ec90a09c":"code","8fe44769":"code","1adeb9f7":"code","7eb4fdf5":"code","f7181119":"code","74672533":"code","40b8be80":"code","91f5a57a":"code","516fd7ec":"code","710fc825":"code","01546801":"code","999b7974":"code","73a4485c":"code","01422ccd":"code","984de1f4":"markdown","ebbe11eb":"markdown","b141b2b8":"markdown","136f4ef9":"markdown","8e0541d0":"markdown","5bb1c1a7":"markdown","e6c8b35a":"markdown","245f9398":"markdown","dbc0cf86":"markdown","f3f5b5d8":"markdown"},"source":{"8b4a3b26":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport os\nprint(os.listdir(\"..\/input\"))","d82842a2":"#Load data\ndf=pd.read_csv('..\/input\/yugioh-tcg\/original\/original\/cards.csv',header=None,index_col=0)","6abcb44f":"#Quick inspection. There are no column names!\ndf.head()","aa10fa2c":"#Check for duplicates.\n#One card is in there 30 times!\ndf[1].value_counts().head()","335a16df":"#Remove duplicates & check how many\nprint(df.shape)\ndf=df.drop_duplicates()\nprint(df.shape)\n#There were apparentlly ~1800 duplicate entries","ef237884":"#Check I've not missed anything\ndf[1].value_counts().head()","36b7920b":"#Problem 2: Missing passcodes\n#None is a legitimate entry.\n#'Monster' seems to have been a mistake & the column was missed off\n#Not sure why the passcodes along are duplicated, so will check.\ndf[2].value_counts().head()","318542b8":"#'Monster' entries have the password missing, so want to correct that by shifting the rows\n#A quick inspection showed some of these rows have plenty of other problems too\ndf[df[2]=='Monster'].head()","9b14b54b":"#Save the names, so I can add passcodes later\npasscode_names=df[df[2]=='Monster'][1]","53caf2e8":"#Shift the rows along by 1 where the passcode is missing.\n#The rest of the rows are also a big mess, with other data out of order.\n#To avoid pushing it out of the dataframe, I added a dummy column to put it in for now\nmask = df[2] == 'Monster'\ndf['Dummy']=\"\"\nc = [2,3,4,5,6,7,8,9,10,11,12,13,'Dummy']\n#shift columns\ndf.loc[mask, c] = df.loc[mask, c].shift(1, axis=1)","497e2c0e":"#Something to save me time \/ effort\nfor i in list(passcode_names):\n    print('df.loc[df[1]==\\\"'+i+'\\\",2]')","3662d6a0":"df.loc[df[1]==\"Performapal Card Gardna\",2]='37256334'\ndf.loc[df[1]==\"D\/D\/D Destiny King Zero Laplace\",2]='21686473'\ndf.loc[df[1]==\"Odd-Eyes Wing Dragon\",2]='58074177'\ndf.loc[df[1]==\"D\/D\/D Superdoom King Purplish Armageddon\",2]='84569886'\ndf.loc[df[1]==\"SPYRAL Sleeper\",2]='00035699'\ndf.loc[df[1]==\"Subterror Fiendess\",2]='74762582'\n\n#Tokens are not real cards, so drop\ndf=df[df[1]!=\"Ancient Gear Token\"]\n\ndf.loc[df[1]==\"SPYRAL GEAR - Last Resort\",2]='37433748'\ndf.loc[df[1]==\"Subterror Behemoth Phospheroglacier\",2]='01151281'\ndf.loc[df[1]==\"Subterror Behemoth Speleogeist\",2]='47556396'\ndf.loc[df[1]==\"Link Disciple\",2]='32995276'\n\n#These 2 seem to be prize cards\ndf.loc[df[1]==\"Iron Knight of Revolution\",2]=np.nan\ndf.loc[df[1]==\"Sanctity of Dragon\",2]=np.nan\n\n\ndf.loc[df[1]==\"Hallohallo\",2]='77994337'\ndf.loc[df[1]==\"Mudragon of the Swamp\",2]='54757758'\n\n#Tokens are not real cards, so drop\ndf=df[df[1]!=\"Token\"]\n\n\ndf.loc[df[1]==\"Heavymetalfoes Electrumite\",2]='24094258'","0f27f46e":"#Duplicate passcodes is because of name changes & spelling errors\n#This seems to be the case for 22 cards.\n#Some are actually just passcode errors.\n#Unfortunately, therefore this will probably need to be fixed manually.\ndf[2].value_counts().head(22)","c10997f8":"#Corrections\n\n#Name change & spelling error\ndf.drop(df[df[2]=='62279666'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='62279666'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='48152161'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='12097275'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='97273514'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='40854824'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='58374719'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='07969770'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='43464884'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='99674361'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='87475570'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='87259933'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='93236220'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='50548657'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='96150936'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='25163979'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='01735088'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='14469229'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='85763457'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='08192327'].iloc[[0]].index,inplace=True)\ndf.drop(df[df[2]=='33541430'].iloc[[0]].index,inplace=True)\n\n#Passcode error\ndf.loc[df[1]==\"Metaphys Ragnarok\",2]='19476824'","e45ebb60":"#One more check\ndf[2].value_counts().head()","0653149c":"df[3].value_counts()","6465930b":"df[4].value_counts()","c1fb0d37":"#Check for any problems\ndf[5].value_counts()","96189c49":"#Shift values\nmask=~df[5].isin(['1','2','3','4','5','6','7','8','9','10','11','12',np.nan])\nc = [5,6,7,8,9,10,11,12,13,'Dummy']\n#shift columns\ndf.loc[mask, c] = df.loc[mask, c].shift(1, axis=1)","98a7d0be":"#Check everything is now correct\ndf[5].value_counts()","1b9783de":"df[6].value_counts().head()","48e3b28d":"#Splitting the string into new columns\nstr_df = df[6].str.split('\/',expand=True).add_prefix(\"Card Type \")\ndf=pd.concat([df, str_df], axis=1).replace({None:np.NaN})","f888c6ec":"#Reorder columns & drop the original column\ncols=[1,2,3,4,5,6,'Card Type 0', 'Card Type 1',\n       'Card Type 2', 'Card Type 3',7,8,9,10,11,12,13,'Dummy']\ndf=df[cols]\ndf.drop(6,axis=1,inplace=True)","05a701fa":"#Now all these columns need to be re-checked\n#Nothing looks like an error\nType0=df['Card Type 0'].value_counts()\nType1=df['Card Type 1'].value_counts()\nType2=df['Card Type 2'].value_counts()\nType3=df['Card Type 3'].value_counts()\n\nprint(Type0.index)\nprint(Type1.index)\nprint(Type2.index)\nprint(Type3.index)","23c4a1fc":"df[7].value_counts().head()","0081ced4":"#Split into two columns\nstr_df = df[7].str.split('\/',expand=True).add_prefix(\"Stat \")\ndf=pd.concat([df, str_df], axis=1).replace({None:np.NaN})","4b46340d":"#Reorder & rename columns\ncols=[1,2,3,4,5,'Card Type 0', 'Card Type 1',\n       'Card Type 2', 'Card Type 3','Stat 0','Stat 1',8,9,10,11,12,13,'Dummy',7]\ndf=df[cols]\ndf.drop(7,axis=1,inplace=True)\ndf.rename(columns={'Stat 0':'Attack','Stat 1':'Defense'},inplace=True)","531917e7":"#Check the attack\ndf.Attack.value_counts().index","b84fd046":"# Both ? and X000 exist as non-integer values\n#These will be converted to NAN for now\ndf.loc[df['Attack']==\"?\",'Attack']=np.nan\ndf.loc[df['Attack']==\"X000\",'Attack']=np.nan","780f889e":"#A small number of cards have their scales in the stat slot, which is wrong.\n#This will need to be corrected. \n#Thanfully, this data is (seemingly randomly) in one of the other columns\n\n#Scale 1\ndf.loc[df[1]==\"D\/D\/D Destiny King Zero Laplace\",'Attack']=np.nan\ndf.loc[df[1]==\"D\/D\/D Destiny King Zero Laplace\",'Defense']='0'\ndf.loc[df[1]==\"D\/D\/D Superdoom King Purplish Armageddon\",'Attack']='3500'\ndf.loc[df[1]==\"D\/D\/D Superdoom King Purplish Armageddon\",'Defense']='3000'\ndf.loc[df[1]==\"Yoko-Zuna Sumo Spirit\",'Attack']='2400'\ndf.loc[df[1]==\"Yoko-Zuna Sumo Spirit\",'Defense']='1000'\n\n#Scale 2\ndf.loc[df[1]==\"Foucault's Cannon\",'Attack']='2200'\ndf.loc[df[1]==\"Foucault's Cannon\",'Defense']='1200'\ndf.loc[df[1]==\"Mandragon\",'Attack']='2500'\ndf.loc[df[1]==\"Mandragon\",'Defense']='1000'\ndf.loc[df[1]==\"Risebell the Summoner\",'Attack']='800'\ndf.loc[df[1]==\"Risebell the Summoner\",'Defense']='800'\ndf.loc[df[1]==\"Hallohallo\",'Attack']='800'\ndf.loc[df[1]==\"Hallohallo\",'Defense']='600'\n\n#Scale 3\ndf.loc[df[1]==\"Dragon Horn Hunter\",'Attack']='2300'\ndf.loc[df[1]==\"Dragon Horn Hunter\",'Defense']='1000'\ndf.loc[df[1]==\"Magical Abductor\",'Attack']='1700'\ndf.loc[df[1]==\"Magical Abductor\",'Defense']='1400'\ndf.loc[df[1]==\"Samurai Cavalry of Reptier\",'Attack']='1800'\ndf.loc[df[1]==\"Samurai Cavalry of Reptier\",'Defense']='1200'\n\n#Scale 4\ndf.loc[df[1]==\"Ghost Beef\",'Attack']='2000'\ndf.loc[df[1]==\"Ghost Beef\",'Defense']='1000'\ndf.loc[df[1]==\"Metrognome\",'Attack']='1800'\ndf.loc[df[1]==\"Metrognome\",'Defense']='1600'\ndf.loc[df[1]==\"Pandora's Jewelry Box\",'Attack']='1500'\ndf.loc[df[1]==\"Pandora's Jewelry Box\",'Defense']='1500'\n\n#Scale 5\ndf.loc[df[1]==\"P.M. Captor\",'Attack']='1800'\ndf.loc[df[1]==\"P.M. Captor\",'Defense']='0'\ndf.loc[df[1]==\"Steel Cavalry of Dinon\",'Attack']='1600'\ndf.loc[df[1]==\"Steel Cavalry of Dinon\",'Defense']='2600'\n\n#Scale 7\ndf.loc[df[1]==\"Dragong\",'Attack']='500'\ndf.loc[df[1]==\"Dragong\",'Defense']='2100'\ndf.loc[df[1]==\"Flash Knight\",'Attack']='1800'\ndf.loc[df[1]==\"Flash Knight\",'Defense']='600'\ndf.loc[df[1]==\"Lancephorhynchus\",'Attack']='2500'\ndf.loc[df[1]==\"Lancephorhynchus\",'Defense']='800'\ndf.loc[df[1]==\"Mild Turkey\",'Attack']='1000'\ndf.loc[df[1]==\"Mild Turkey\",'Defense']='2000'\ndf.loc[df[1]==\"Zany Zebra\",'Attack']='0'\ndf.loc[df[1]==\"Zany Zebra\",'Defense']='2000'\n\n#Scale 8\ndf.loc[df[1]==\"Performapal Card Gardna\",'Attack']='1000'\ndf.loc[df[1]==\"Performapal Card Gardna\",'Defense']='1000'\n\n#Scale 9\ndf.loc[df[1]==\"Kuro-Obi Karate Spirit\",'Attack']='2400'\ndf.loc[df[1]==\"Kuro-Obi Karate Spirit\",'Defense']='1000'\ndf.loc[df[1]==\"Kai-Den Kendo Spirit\",'Attack']='2400'\ndf.loc[df[1]==\"Kai-Den Kendo Spirit\",'Defense']='1000'\n\n#Scale 10\ndf.loc[df[1]==\"Odd-Eyes Wing Dragon\",'Attack']='3000'\ndf.loc[df[1]==\"Odd-Eyes Wing Dragon\",'Defense']='2500'\n","4504608a":"test_df=df.loc[df['Attack']=='0']\ntest_df.loc[test_df['Card Type 1']=='Pendulum']","dece01fd":"#Check defense column\ndf.Defense.value_counts().index","92553354":"# Both ? and X000 exist as non-integer values\n#These will be converted to NAN for now\ndf.loc[df['Defense']==\"?\",'Defense']=np.nan\ndf.loc[df['Defense']==\"X000\",'Defense']=np.nan","a4513bc0":"#Let's take a moment to rename some columns\ndf.rename(columns={1:'Name',2:'Passcode',3:'Category',4:'Attribute',5: 'Level',\n                  'Card Type 0':'Type'},inplace=True)","ec90a09c":"df.head()","8fe44769":"#Columns to write\nheader=['Name','Passcode','Category','Attribute','Level','Type','Card Type 1','Card Type 2',\n        'Card Type 3','Attack','Defense']","1adeb9f7":"#Full DF\ndf.to_csv('YGO_partial.csv',columns=header,index=False)","7eb4fdf5":"#Monsters only\ndf_monster=df[df['Category']=='Monster']","f7181119":"#Monsters only\ndf_monster.to_csv('YGO_Monster_partial.csv',columns=header,index=False)","74672533":"YGO_df=pd.read_csv('..\/input\/ygo-data\/YGO_Cards_v2.csv',encoding = \"ISO-8859-1\")","40b8be80":"YGO_P_df=pd.read_csv('..\/input\/ygo-prices-data\/YGO_Cards_v3.csv',encoding = \"ISO-8859-1\")","91f5a57a":"YGO_df.rename(columns={'Unnamed: 0':'Name'},inplace=True)","516fd7ec":"df_monster[~df_monster.Name.isin(YGO_df.Name.values)].Name","710fc825":"YGO_df[~YGO_df.Name.isin(df_monster.Name.values)].Name","01546801":"Missing_monster_df1=df_monster[~df_monster.Name.isin(YGO_df.Name.values)]","999b7974":"Missing_monster_df1[~Missing_monster_df1.Passcode.isin(YGO_df.number.values)]","73a4485c":"Missing_monster_df2=YGO_df[~YGO_df.Name.isin(df_monster.Name.values)]","01422ccd":"len(Missing_monster_df2[~Missing_monster_df2.number.isin(df_monster.Passcode.values)])","984de1f4":"# Fixing Attribute\n\nYu-Gi-Oh! has 7 attributes, covering the 4 classical elements, Light, Dark & Divine. There do not appear to be any problems with this column.","ebbe11eb":"# Fixing Type Info\n\nThe 6th column contains text information about whether the card is Normal, Effect, Tuner etc. This will need to be split into separate columns.\n\nThe first entry appears to be their Type (Warrior etc), followed by further information. str.split offers a way to split these entries into new columns, resulting in 4 new columns, presumably because there are cards with up to 4 entries in the original.\n\nI then removed the original column from the data, and reordered the columns. Further processing will be needed to turn things into the same form as the YGOHub data, but this can be done later.\n\nA quick check of the 4 new columns I've produced does not give any unusual results, so will assume they are correct.","b141b2b8":"This kernel is for cleaning & reformatting the various YGO dataframes, and combining them all together. Before I start doing analysis, I want as much data as I can get in one place. However, everything I have so far contains various problems, like missing entries, duplicate entries, and values in the wrong columns.\n\nTo start with, I will clean up the dataset found on Kaggle from https:\/\/www.kaggle.com\/nalfmalf\/yugioh-tcg. This appears to be the most up to date database, but has a variety of errors. After that, I will turn to my monster data extracted from YGOHub and YGOPrices, and then try to combine all 3 to fill any gaps.\n\nThe dataset found on Kaggle has a wide variety of errors and other problems, including unlabelled columns, duplicate entries, duplicates due to spelling errors, leakage between columns, columns that need splitting, and so on. Unfortunately, due to the size of the dataset, I can only correct for obvious errors, and cannot pick out entries with incorrect information.","136f4ef9":"# Fixing the Names\nIt turns out, there are multiple duplicate entries for card names, so these need to be dropped. Thankfully, this is a simple enough problem, and leads to the removal of ~2000 entries.","8e0541d0":"# Fixing Stats\n\nCurrently Attack \/ Defense are listed as X\/Y in a single column, so I want to split them, as before. As above, I also removed the original column, and renamed them to Attack & Defense.\n\nAfter this, all the entries need to be checked for unusual values or errors. I know that some stats are listed as ? for example.\n\nFor attack, both ? and X000 will be converted to NAN for now, and dealt with later. They basically indicate special conditions.\n\nIt also turns out that pendulum scales are sometimes included in this column, which is wrong. This is made clear by the monsters with unusually low attack, of <10. Scales above 10 do exist, going to 13, but are not incorrectly labelled in this dataset. \n\nA pendulum scale of zero also exists, and will need to be checked too. For now, these entries appear to be correct.\n\nSimilarly, Defense has to worry about ? and X000 entries.","5bb1c1a7":"# Fixing Level\n\nNext up is a card's level. I will be curious to see how they decided to handle cards without levels, like Xyz or Links. I suspect Xyz rank was just translated to a level. For Link monsters, it seems this column was originally just left blank, so has instead been filled by their type info. There is also the 'Number F0\/S0' sereis of monsters, which do not have a printed Rank.\n\nI will shift these columns along, and later think what the best replacement number is.","e6c8b35a":"# Fixing Passcodes\n\nThe second column refers to the passcodes written on the cards. This presents several problems, including string entries, and duplicate passwords.\n\nIn terms of string entries, 'None' refers to cards which do not have a passcode. These are relatively rare, but do exist. At the end, I'll want to convert these entries to NAN, so I can use this as a numerical column. It probably won't be useful for any statistical analysis, but I'm ready to be surprised! I'll need to convert the NANs to a numerical value later, but that can wait until analysis time.\n\nThe second problem is the 17 entries with 'Monster' instead of passcode. As far as I can tell, their passcode entry was missing, so the entry for column 3 has ended up there instead. These likely do have passcodes, so those will need to be added back too. In these cases, I shifted the entries along by 1, to move other data into the correct column. However, since the rest of the data in these rows is a mess too, it became necessary to add an extra column to hold data from the last column. This will need to be fixed & rearranged later.\n\nThe problem of duplicate entries is due to spelling errors or name changes. As far as I can tell, often one entry was for a fan translation, and another for the official translation. In other cases, the password was simply entered wrong.","245f9398":"# Fixing Card Category\n\nThe third column indicates whether a card is a Monster, Spell or Trap. For my later analysis, I don't want the latter 2 fields, but someone else might find it useful. This seems to be correct, although the spell \/trap categories are smaller than expected, so I suspect some are missing.","dbc0cf86":"# Comparing against YGOHub & YGOPrices data\n\nSince the text columns in the Kaggle user set are a mess, I'm going to turn back to the YGO hub data for now. Ultimately, I want to add missing entries from one to the other, so it's useful to know how many extra entries I can gain from the above set. In the raw form, the two dataframes only differ in rows by 1, but I can't guarantee the other 5948 match.\n\nAt first glance, they are mismatched by 43 and 44 columns, but this is partly due to the fact there have been text reading errors (for example the Celtic cards).  Further refining by removing cases where the passcodes match, narrows this list down to ~30, and includes the missing data related to '&' and '#' characters missing in the YGOHub data.","f3f5b5d8":"# Break to Output Data\n\nThe remaining columns tend to include text, such as flavour & effect text, but they are a big mess. Column 8 should be the main text, but sometimes includes Link Number, Xyz\/Fusion materials and more. Since this seems like quite heavy work, I'm simply going to ouput the current results & go back later. For comparison with the YGOHub and YGOPrices data, I'll also split it off to just include the Monsters."}}