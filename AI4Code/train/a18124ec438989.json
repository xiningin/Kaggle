{"cell_type":{"5348435c":"code","a81b2d1b":"code","5c8c3bdb":"code","53899c6d":"code","c73e0283":"code","65541de6":"code","7cd9b3bb":"code","8e7fab94":"code","07fe5241":"code","0dcfe4ff":"code","67ef3cdc":"code","a364102e":"code","97b235eb":"code","4bac8cbe":"code","9be48db5":"code","5d7634b5":"code","c0563dc9":"code","e535a2ab":"code","e649bad0":"code","32ceed79":"code","86935aa3":"code","114a8be2":"code","6f252c96":"code","2a25b0d0":"code","b3d1d644":"code","fa542513":"code","a1b8e843":"code","a014502d":"markdown","c8c757a3":"markdown","4271a1cc":"markdown","03364078":"markdown","c18c6e34":"markdown","6e4a524d":"markdown","4e41d2e3":"markdown","afaa0192":"markdown","a76c01f8":"markdown","1b2dac42":"markdown","f424c5dc":"markdown","c45421de":"markdown","72b5344a":"markdown","332cbcc3":"markdown","572e92a6":"markdown","adc7554a":"markdown","8bb618dd":"markdown","be88d45c":"markdown"},"source":{"5348435c":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport os\npd.set_option('display.max_columns', 100)\nimport plotly.express as px","a81b2d1b":"base_dir = '\/kaggle\/input\/customer-personality-analysis\/'\n\ndf = pd.read_csv(base_dir + '\/marketing_campaign.csv', sep='\\t')\ndf.sample(5)","5c8c3bdb":"# So we have around 2240 unique customors\ndf.shape","53899c6d":"# ahh this plot looks good but, Instead of year of birth if we have age there, It will be great, So base on the age We can comment what \n# is there expenditure capacity, What type of product they prefer\nimport seaborn as sns\nfrom matplotlib import pyplot as plt\nplt.figure(figsize=(18,6))\nsns.set_theme(style = 'darkgrid')\nsns.countplot(x = 'Year_Birth', data = df)\nplt.xticks(rotation=40)\nplt.show()","c73e0283":"\nplt.figure(figsize=(18,6))\nsns.set_theme(style = 'darkgrid')\nsns.countplot(x = [2021]*len(df) - df['Year_Birth'].to_numpy())\nplt.xlabel('Age by 2021')\nplt.xticks(rotation=40)\nplt.show()","65541de6":"df['Education'].value_counts()\nimport plotly.graph_objects as go\nfig = go.Figure(data=[go.Pie(labels=df['Education'].value_counts().index, values=df['Education'].value_counts().values)])\nfig.update_layout(height=400, width=500, title_text=\"Pie chart showing Education\")\nfig.show()","7cd9b3bb":"plt.figure(figsize=(18,8))\nsns.set_theme(style = 'darkgrid')\nsns.countplot(x = df['Marital_Status'].to_numpy())\nplt.xticks(rotation=40)\nplt.show()","8e7fab94":"# First we will check any NA values in our dataset, We will only show, sum of NA values greater than 0.\ndf.isna().sum()[lambda x: x>0]\n\n# Let's replace NA values from the Income column with mean.\n\ndf['Income'] = df['Income'].fillna(df['Income'].mean())","07fe5241":"# 1) What is average Income based on their age. (I assumed age 128,122,121 are not outliers for this question)\n\n#### Comments on the graph,\n# - From age 26-30, Is having more income compare to the age group 30-60, From 30-60 is gradually increasing, Can we assume As experience increasing \n    # They got more salary. May be we can think this ......\nage_df = df.groupby(by = ['Year_Birth']).agg({'Income':'mean'}).reset_index()\nage_df['Year_Birth'] = 2021 - age_df['Year_Birth'] \n\nfig = px.bar(age_df, x = 'Year_Birth', y = 'Income')\nfig.update_layout(height=400, width=700, title_text=\"Age Vs Average Income\")\nfig.show()\n\n","0dcfe4ff":"from plotly.subplots import make_subplots\nimport plotly.graph_objects as go","67ef3cdc":"# 2.1) Let's find correlation we can find between age and the given products \n #     ('MntWines', 'MntFruits' ,'MntMeatProducts', 'MntFishProducts', 'MntSweetProducts', 'MntGoldProds')\n    \n    # I will remove outlier's , Remember people having age 121,122,128\n    \n    # We will create function which will give us list of corresponding interval to Age column indataframe,\n    # So that we will analyze data base on the interval of age\n    \ndef create_interval_column(age_df, interval):\n    inter = []\n    interval = interval\n    j = 0\n    while (j<100):\n        j = j + interval\n        inter.append(j)\n    interval_column = [] \n    for i in age_df['Year_Birth']:\n        for j in range(len(inter)-1):\n            if inter[j]<i <=inter[j+1]:\n                interval_column.append(str(inter[j]) + '-' + str(inter[j+1]))\n                break\n    return interval_column\n\ninterval_you_want_to_plot = 10 \n\ncolumns_to_be_analyzed = ['MntWines', 'MntFruits' ,'MntMeatProducts', 'MntFishProducts', 'MntSweetProducts', 'MntGoldProds']\n\nage_df = df.groupby(by = ['Year_Birth']).agg({'MntWines':'sum','MntFruits':'sum' ,'MntMeatProducts':'sum',\n                                              'MntFishProducts':'sum', 'MntSweetProducts':'sum', 'MntGoldProds':'sum' }).reset_index()\nage_df['Year_Birth'] = 2021 - age_df['Year_Birth'] \nage_df.drop([0,1,2], axis = 0, inplace=True)\n\ninterval_column = create_interval_column(age_df, interval=interval_you_want_to_plot )# Creating interval of 5\n\nage_df['Interval_column'] = interval_column\n\nfig = make_subplots(rows = 3, cols = 3, subplot_titles=columns_to_be_analyzed)\ncnt = 0\nfor i in range(2):\n    for j in range(3):\n        fig.add_trace(go.Bar(x = age_df['Interval_column'].to_numpy(), \n                             y = age_df[columns_to_be_analyzed[cnt]].to_numpy()), \n                    row = i+1, col=j+1 )\n        cnt+=1\nfig.update_layout(  title = 'Columns Vs Amount of quantity',font=dict(\n        family=\"Courier New, monospace\",\n        size=12,\n        color=\"#7f7f7f\"),\n                 showlegend=False,autosize=True,\n                  width=1200,\n                  height=800)\nfig.show()","a364102e":"# 2.2) Let's find correlation we can find between Education and the given products \n #     ('MntWines', 'MntFruits' ,'MntMeatProducts', 'MntFishProducts', 'MntSweetProducts', 'MntGoldProds')\n # As we have more data belong to graduation category we find more amount belongs to this category.\n\nEdu_df = df.groupby(by = ['Education']).agg({'MntWines':'sum','MntFruits':'sum' ,'MntMeatProducts':'sum',\n                                              'MntFishProducts':'sum', 'MntSweetProducts':'sum', 'MntGoldProds':'sum' }).reset_index()\n\nfig = make_subplots(rows = 3, cols = 3, subplot_titles=columns_to_be_analyzed)\ncnt = 0\nfor i in range(2):\n    for j in range(3):\n        fig.add_trace(go.Bar(x = Edu_df['Education'].to_numpy(), \n                             y = Edu_df[columns_to_be_analyzed[cnt]].to_numpy()), row = i+1, col=j+1 )\n        cnt+=1\nfig.update_layout(  title = 'Columns Vs Amount of quantity',font=dict(\n        family=\"Courier New, monospace\", size=12, color=\"#7f7f7f\"), showlegend=False,autosize=True,width=1200,height=800)\nfig.show()","97b235eb":"# 2.3) Let's find correlation we can find between Marital_Status and the given products \n #     ('MntWines', 'MntFruits' ,'MntMeatProducts', 'MntFishProducts', 'MntSweetProducts', 'MntGoldProds')\n # Here we can see that , Married Customer's consumes more, May be this is because there may be childrens in the house. \n \n\nMarital_df = df.groupby(by = ['Marital_Status']).agg({'MntWines':'sum','MntFruits':'sum' ,'MntMeatProducts':'sum',\n                                              'MntFishProducts':'sum', 'MntSweetProducts':'sum', 'MntGoldProds':'sum' }).reset_index()\n\nfig = make_subplots(rows = 3, cols = 3, subplot_titles=columns_to_be_analyzed)\ncnt = 0\nfor i in range(2):\n    for j in range(3):\n        fig.add_trace(go.Bar(x = Marital_df['Marital_Status'].to_numpy(), \n                             y = Marital_df[columns_to_be_analyzed[cnt]].to_numpy()), row = i+1, col=j+1 )\n        cnt+=1\nfig.update_layout(  title = 'Columns Vs Amount of quantity',font=dict(\n        family=\"Courier New, monospace\", size=12, color=\"#7f7f7f\"), showlegend=False,autosize=True,width=1200,height=800)\nfig.show()","4bac8cbe":"# 3.1) Let's plot for age\n\ninterval_you_want_to_plot = 10 \n\ncolumns_to_be_analyzed = ['NumDealsPurchases', 'NumWebPurchases', 'NumCatalogPurchases', 'NumStorePurchases', 'NumWebVisitsMonth']\n\nage_df = df.groupby(by = ['Year_Birth']).agg({'NumDealsPurchases':'sum','NumWebPurchases':'sum' ,'NumCatalogPurchases':'sum',\n                                              'NumStorePurchases':'sum', 'NumWebVisitsMonth':'sum' }).reset_index()\nage_df['Year_Birth'] = 2021 - age_df['Year_Birth'] \nage_df.drop([0,1,2], axis = 0, inplace=True)\n\ninterval_column = create_interval_column(age_df, interval=interval_you_want_to_plot )# Creating interval of 5\n\nage_df['Interval_column'] = interval_column\n\nfig = make_subplots(rows = 2, cols = 3, subplot_titles=columns_to_be_analyzed)\ncnt = 0\nfor i in range(2):\n    for j in range(3):\n        if cnt == 5 :\n          break\n        fig.add_trace(go.Bar(x = age_df['Interval_column'].to_numpy(), \n                             y = age_df[columns_to_be_analyzed[cnt]].to_numpy()), row = i+1, col=j+1 )\n        cnt+=1\nfig.update_layout(  title = 'Columns Vs Number of Purchase',font=dict(\n        family=\"Courier New, monospace\",size=12,color=\"#7f7f7f\"),showlegend=False,autosize=True,width=1200,height=800)\nfig.show()","9be48db5":"# 3.2) Let's plot for Education\n\nEdu_df = df.groupby(by = ['Education']).agg({'NumDealsPurchases':'sum','NumWebPurchases':'sum' ,'NumCatalogPurchases':'sum',\n                                              'NumStorePurchases':'sum', 'NumWebVisitsMonth':'sum' }).reset_index()\n\nfig = make_subplots(rows = 2, cols = 3, subplot_titles=columns_to_be_analyzed)\ncnt = 0\nfor i in range(2):\n    for j in range(3):\n        if cnt == 5 :\n          break\n        fig.add_trace(go.Bar(x = Edu_df['Education'].to_numpy(), \n                             y = Edu_df[columns_to_be_analyzed[cnt]].to_numpy()), row = i+1, col=j+1 )\n        cnt+=1\nfig.update_layout(  title = 'Columns Vs Number of Purchase',font=dict(\n        family=\"Courier New, monospace\",size=12,color=\"#7f7f7f\"),showlegend=False,autosize=True,width=1200,height=800)\nfig.show()","5d7634b5":"# 3.3) Let's plot for  Number of purchases Vs Marital Status\n\nMarital_df = df.groupby(by = ['Marital_Status']).agg({'NumDealsPurchases':'sum','NumWebPurchases':'sum' ,'NumCatalogPurchases':'sum',\n                                              'NumStorePurchases':'sum', 'NumWebVisitsMonth':'sum' }).reset_index()\n\nfig = make_subplots(rows = 2, cols = 3, subplot_titles=columns_to_be_analyzed)\ncnt = 0\nfor i in range(2):\n    for j in range(3):\n        if cnt == 5 :\n          break\n        fig.add_trace(go.Bar(x = Marital_df['Marital_Status'].to_numpy(), \n                             y = Marital_df[columns_to_be_analyzed[cnt]].to_numpy()), row = i+1, col=j+1 )\n        cnt+=1\nfig.update_layout(  title = 'Columns Vs Number of Purchase',font=dict(\n        family=\"Courier New, monospace\",size=12,color=\"#7f7f7f\"),showlegend=False,autosize=True,width=1200,height=800)\nfig.show()","c0563dc9":"# 3.1) Let's find top 10 oldest customers, and appreciate for purchasing from our organization. \n\ndff = df.copy()\n\ndff['How_old_is_our_customer'] = (pd.to_datetime('today').normalize() - dff['Dt_Customer'].astype('datetime64[ns]')).dt.days\n\n# Dataframe shows the top 10 oldest customer.\ndff.sort_values(by = ['How_old_is_our_customer'], ascending=False).head(10)","e535a2ab":"# 3.2) Customer who visited more often.\n  # Yea you are thinking right, There will be some customers who just purchase and then never come back, \n  # So we will go ahead and give gifts to those who purchase more often, By doing this they will be our loyal customers\n\ndff['How_many_time_visited'] = dff['NumDealsPurchases'] + dff['NumWebPurchases'] + dff['NumCatalogPurchases']+ \\\n                              dff['NumStorePurchases']+ dff['NumWebVisitsMonth']\ndff.sort_values(by = ['How_many_time_visited'], ascending=False).head(10)\n","e649bad0":"\ndf = pd.read_csv(base_dir + '\/marketing_campaign.csv', sep='\\t')","32ceed79":"# we will drop some columns \ncolumns_to_be_drop = ['AcceptedCmp3', 'AcceptedCmp4', 'AcceptedCmp5', 'AcceptedCmp1','AcceptedCmp2', 'Complain',\n                      'Z_CostContact', 'Z_Revenue', 'Response','ID', 'Dt_Customer']\ndf = df.drop(columns = columns_to_be_drop, axis = 0)\ndf['Year_Birth'] = 2021 - df['Year_Birth'] # Will change column with age of customer","86935aa3":"cat_df = df[['Education', 'Marital_Status']]\nnum_df = df[['Year_Birth', 'Income', 'Kidhome','Teenhome', 'Recency', 'MntWines', 'MntFruits', 'MntMeatProducts',\n       'MntFishProducts', 'MntSweetProducts', 'MntGoldProds','NumDealsPurchases', 'NumWebPurchases', 'NumCatalogPurchases',\n       'NumStorePurchases', 'NumWebVisitsMonth']]","114a8be2":"cat_df = pd.get_dummies(cat_df)","6f252c96":"# Let's standardize our numerical df with standardscaler\nfrom sklearn.preprocessing import  StandardScaler\n\nscaler = StandardScaler()\nnum_df = pd.DataFrame(scaler.fit_transform(num_df), columns=num_df.columns)","2a25b0d0":"final_df = pd.concat([num_df, cat_df], axis=1)\nfinal_df.sample(2)","b3d1d644":"final_df = final_df.fillna(final_df.mean()) # There are some nan value in input column , so filling value with mean","fa542513":"from sklearn.cluster import KMeans\nimport plotly.express as px\nfrom sklearn.decomposition import PCA\n\nfor clusters in range(2, 9):    # We will run loop and creating clusters from 2- 8\n    km = KMeans(n_clusters=clusters, random_state=0)\n    y_km = km.fit_predict(final_df)\n\n    #To Visualize how our customer form cluster, We need to reduce dimentionality to 2, We will use PCA for that.\n    pca = PCA(  n_components= 2)\n    pca_df =pd.DataFrame(pca.fit_transform(final_df), columns= [str(i) for i in range(2)])\n    pca_df['Predict'] = y_km\n\n    fig = px.scatter(pca_df, x ='0', y = '1', color='Predict', labels={'0': f'X-Dimention- with {clusters} cluster', '1':'Y-Dimention'})\n    fig.update_layout(height = 500, width = 900)\n    fig.show()","a1b8e843":"# If you come at the end of this notebook , Please comment , what imrovement i can do in this notebook....\n# Thank you :)","a014502d":"3) Apreciate the oldest customer, With gifts this Chrismas.  \n Also We will give offers to Customer who visited more often.","c8c757a3":"## Reading Data","4271a1cc":"## Exploring with simple questions, To whom we can recommend ?","03364078":"3) Let's find how people find purchases suitable according to convinience, Based on age, Education, Marital-status  \n('NumDealsPurchases', 'NumWebPurchases', 'NumCatalogPurchases', 'NumStorePurchases', 'NumWebVisitsMonth')","c18c6e34":"- Let's Explore all columns and understand them\n-  People  \n> ID: Customer's unique identifier  \n> Year_Birth: Customer's birth year  \n> Education: Customer's education level  \n> Marital_Status: Customer's marital status  \n> Income: Customer's yearly household income  \n> Kidhome: Number of children in customer's household  \n> Teenhome: Number of teenagers in customer's household  \n> Dt_Customer: Date of customer's enrollment with the company  \n> Recency: Number of days since customer's last purchase  \n> Complain: 1 if customer complained in the last 2 years, 0 otherwise  \n\n- Products  \n> MntWines: Amount spent on wine in last 2 years  \n> MntFruits: Amount spent on fruits in last 2 years  \n> MntMeatProducts: Amount spent on meat in last 2 years  \n> MntFishProducts: Amount spent on fish in last 2 years  \n> MntSweetProducts: Amount spent on sweets in last 2 years  \n> MntGoldProds: Amount spent on gold in last 2 years  \n\n- Promotion  \n> NumDealsPurchases: Number of purchases made with a discount  \n> AcceptedCmp1: 1 if customer accepted the offer in the 1st campaign, 0 otherwise  \n> AcceptedCmp2: 1 if customer accepted the offer in the 2nd campaign, 0 otherwise  \n> AcceptedCmp3: 1 if customer accepted the offer in the 3rd campaign, 0 otherwise  \n> AcceptedCmp4: 1 if customer accepted the offer in the 4th campaign, 0 otherwise  \n> AcceptedCmp5: 1 if customer accepted the offer in the 5th campaign, 0 otherwise  \n> Response: 1 if customer accepted the offer in the last campaign, 0 otherwise  \n\n- Place  \n> NumWebPurchases: Number of purchases made through the company\u2019s web site  \n> NumCatalogPurchases: Number of purchases made using a catalogue  \n> NumStorePurchases: Number of purchases made directly in stores  \n> NumWebVisitsMonth: Number of visits to company\u2019s web site in the last month  ","6e4a524d":"Let's explore dataset with simple question  \n1) What is average Income of person based on their age?  \n2) Let's find customer's to whom we can give recommendation for wine, fruit, Meat, Fish, Sweet, Gold  \n3) Apreciate the oldest customer, With gifts this Chrismas, Also We will give offers to Customer who visited more often.    ","4e41d2e3":"1.1) From the column, date of birth, We can understand distrubution of age.  \nWhat else we can mine from this column ?  \nYes, You are right, Customer's are throwing party on this great day, So by knowing Month, and day we can see expenditure by them on birth day.  \nUnfortunately don't have day and month of birth, But don't be upset, We will see what is distrubution of age of our customer.  ","afaa0192":"## Importing Liabraries","a76c01f8":"## Create model\nAlgorithms we are going to use  \n\nYou can take reference of various algorithms from this [post](https:\/\/towardsdatascience.com\/the-5-clustering-algorithms-data-scientists-need-to-know-a36d136ef68)\n- 1) K-Means  \n> From the elbow method we can decide number of cluster we should consider. But i have plot the cluster It looks like number of clusters (3 and 4) perform good. But elbow menthos is good choice  \n","1b2dac42":"1.2) Education  \n- **Possibilities**  \na) It may be possible that the one with more education having more chances to have good salary than others.  \nb) If he is having good salary then There will be high money flow going in and out, So chances to buy high quality products, high value products are higher.  \nc) Usually high educated people want to invest there time more productvely compare to others, mean less time to spend on the groceries. There are chances that number of products purchased per visit are more than others.  \n\n- **Comments**","f424c5dc":"\nGreat...  \n We have done Some analysis on our data, It's time to play with some clustering alogorithms, You need to wait little bit.. We forgot to convert Categorical column into numerical column  ","c45421de":"Yea , I knew it, this plot make more sense  \n**Comments on Graph**  \nMost of our customers are in range of 40-57, Hurray...  \nSurprise Surprise In this dataset i got customer with age 121, 122,128. I think he should go for Guiness World record, Yeaaa, You are wrong.....   \nNot for his Age, I am thinking about his fitness level, That he came to buy, Enough talking...  I think it is outlier","72b5344a":"## Visualization","332cbcc3":"1.4) Income\n- **Possibilies we can think of**  \na) I think , If we have more income then our expenditure should be more.    \n","572e92a6":"1) KMeans","adc7554a":"1.3) Marital_status","8bb618dd":"2) Let's find customer's to whom we can give recommendation for wine, fruit, Meat, Fish, Sweet, Gold.  \n\n Base on age, gender, Education, Marital Status  ","be88d45c":"## Cleaning and Transforming of Data"}}