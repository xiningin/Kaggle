{"cell_type":{"55e51502":"code","49b8dd1d":"code","0b53c820":"code","2f04f813":"code","39646fe6":"code","b92bd62c":"code","c53f88f7":"code","ff8cbc5e":"code","da3ec67e":"code","31473ae1":"code","b24ff78d":"code","dca38350":"code","4e0ac845":"code","b9ceb752":"code","8e49145a":"code","d6e365fb":"code","6b8eb292":"code","4d7c87c3":"code","cd7eb515":"code","216f6e80":"code","ff6aea38":"code","56b5e614":"code","b7ee8ed1":"code","55b6cb2d":"code","21e3b437":"code","c7637700":"code","38b6889e":"code","d8121622":"code","0df08f7f":"code","bdef28ad":"code","21256122":"code","25c96e60":"code","fe269d23":"code","0ae023c4":"code","85579493":"code","7b43bb57":"markdown","67ed9d9d":"markdown","e0d92e5f":"markdown","6c6073e9":"markdown","fdc1c2d1":"markdown","c21d2feb":"markdown","c8717728":"markdown","ef4fdb8b":"markdown","c140abb6":"markdown","3b591170":"markdown","b2e177fc":"markdown","61d936b7":"markdown"},"source":{"55e51502":"import warnings\nwarnings.filterwarnings('ignore')\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set()","49b8dd1d":"wineDf= pd.read_csv('..\/input\/red-wine-quality-cortez-et-al-2009\/winequality-red.csv')","0b53c820":"wineDf.info()","2f04f813":"wineDf.describe()","39646fe6":"wineDf['quality'].unique()","b92bd62c":"#Fun\u00e7\u00e3o para avaliar agrupar a qualidade em grupos\n\ndef evaluateQuality(quality):\n    if quality <= 4:\n        return 'bad'\n    elif quality >=5 and quality <=6:\n        return 'moderate'\n    else: return 'good'","c53f88f7":"wineDf['quality Evaluate'] = wineDf['quality'].apply(evaluateQuality)","ff8cbc5e":"plt.figure(figsize=(12,6))\nsns.set_style('whitegrid')\nsns.countplot(x='quality Evaluate',data=wineDf)","da3ec67e":"plt.figure(figsize=(20,6))\nplt.title('Distribui\u00e7\u00e3o Alcohol', family='Arial', fontsize=15)\nwineDf[(wineDf['alcohol']>7) & (wineDf['alcohol']<14)]['alcohol'].hist()","31473ae1":"plt.title('pairplot Red Wines', family='Arial', fontsize=15)\nsns.pairplot(wineDf)","b24ff78d":"plt.figure(figsize=(15,10))\nsns.heatmap(wineDf.corr(),annot=True)","dca38350":"wineDf.corr()[['quality','alcohol']]","4e0ac845":"plt.figure(figsize=(12,8))\n_ = plt.plot(wineDf['fixed acidity'],wineDf['density'], marker='.', linewidth=0, color='orange')\n_ = plt.grid(which='major', color='#cccccc', alpha=0.45)\n_ = plt.title('Red Wines - fixed.acidity vs density', family='Arial', fontsize=12)\n_ = plt.xlabel('fixed.acidity')\n_ = plt.ylabel('density')\n_ = plt.show()\n\n\nplt.figure(figsize=(12,8))\n_ = plt.plot(wineDf['alcohol'],wineDf['pH'], marker='.', linewidth=0, color='blue')\n_ = plt.grid(which='major', color='#cccccc', alpha=0.45)\n_ = plt.title('Red Wines - Alcohol vs pH', family='Arial', fontsize=12)\n_ = plt.xlabel('Alcohol')\n_ = plt.ylabel('pH')\n_ = plt.show()","b9ceb752":"#CALCULOS ELBOW\n\ndef calculate_wcss(data,range1=2,range2=21):\n    from sklearn.cluster import KMeans\n    wcss = []\n    for n in range(2, 21):\n        kmeans = KMeans(n_clusters=n, init='k-means++',max_iter=300, n_init=10, random_state=42)\n        kmeans.fit(X=data)\n        wcss.append(kmeans.inertia_)\n\n    return wcss\n\n\ndef optimal_number_of_clusters(wcss):\n    \"\"\"   \n    Parametros\n    ----------\n    wcss : lista\n        lista contendo os valores de soma de quadrados intra-cluster\n    Returns\n    -------\n    int : n\u00famero de clusters \n    \"\"\"\n    from math import sqrt\n    x1, y1 = 2, wcss[0]\n    x2, y2 = 21, wcss[len(wcss)-1]\n\n    distances = []\n    for i in range(len(wcss)):\n        x0 = i+2\n        y0 = wcss[i]\n\n        numerator = abs((y2-y1)*x0 - (x2-x1)*y0 + x2*y1 - y2*x1)\n        denominator = sqrt((y2 - y1)**2 + (x2 - x1)**2)\n        distances.append(numerator\/denominator)\n    return distances.index(max(distances)) + 2\n\n#PLOT ELBOW\ndef elbowPlot(range1,range2,n_cluster, w, title='M\u00e9todo Elbow'):\n    #plt.figure(figsize=(12,6))\n    plt.figure(figsize=(15,10))\n    plt.plot(range(range1,range2), w, linewidth = 2, marker='D',markersize=5)\n    plt.title(title, fontsize=14)\n    plt.xlabel('Numero de Clusters', fontsize=12)\n    plt.ylabel('WCSS (inertia)',  fontsize=12)\n    plt.grid(which='both',color='black', axis='x', alpha=0.5)\n\n    plt.axvline(x=n_cluster,linewidth=2,color='red',linestyle='--')","8e49145a":"wines = wineDf.iloc[:,0:12] ","d6e365fb":"from pylab import rcParams\nfrom sklearn.cluster import KMeans\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.preprocessing import MinMaxScaler\n\n%matplotlib inline\nrcParams['figure.figsize'] = 14,8\nsns.set_style('whitegrid')","6b8eb292":"X_data = wines.values.astype('float32', copy=False)\nscaler = StandardScaler().fit(X_data)\n\nwinesScaler = scaler.transform(X_data)\nwinesScaler","4d7c87c3":"sumSquares_winesScaler = calculate_wcss(winesScaler)\n#sum_of_squares = wcss\nn_sumSquares_winesScaler = optimal_number_of_clusters(sumSquares_winesScaler)\n\nprint('N\u00b0 Clusters = {}'.format(n_sumSquares_winesScaler))\nelbowPlot(2,21,n_sumSquares_winesScaler,sumSquares_winesScaler ,title='M\u00e9todo Elbow - Wines Standard Scaler')","cd7eb515":"#X_data = X_Outlet.values.astype('float32', copy=False)\nmms = MinMaxScaler().fit(X_data)\n\nwinesMmsScaler = scaler.transform(X_data)","216f6e80":"sumSquares_winesMMSScaler = calculate_wcss(winesMmsScaler)\n#sum_of_squares = wcss\nn_winesMssScaler = optimal_number_of_clusters(sumSquares_winesMMSScaler)\n\nprint('N\u00b0 Clusters = {}'.format(n_winesMssScaler))\nelbowPlot(2,21,n_winesMssScaler,sumSquares_winesMMSScaler ,title='M\u00e9todo Elbow - Wines MinMax Scaler')","ff6aea38":"kmeans = KMeans(n_clusters=7)\nclustersWines = kmeans.fit_predict(winesMmsScaler)\nlabelsWines = kmeans.labels_\n\nx1, x2 = 2, 20\nintervalo = range(x1,x2+1)","56b5e614":"def plot_clustering(data, labels, title=None):\n    x_min, x_max = np.min(data, axis=0), np.max(data, axis=0)\n    data = (data - x_min) \/ (x_max - x_min)\n    fig = plt.figure(1, figsize=(4, 3))\n    plt.figure(figsize=(6, 4))\n    plt.scatter(data[:, 0], data[:, 1],\n                 c=labels.astype(np.float))\n    plt.xticks([])\n    plt.yticks([])\n    if title is not None:\n        plt.title(title, size=17)\n    plt.axis('off')\n    plt.tight_layout(rect=[0, 0.03, 1, 0.95]) ","b7ee8ed1":"plot_clustering(winesMmsScaler, labelsWines)\nplt.figure(figsize=(14,10))\nplt.show()","55b6cb2d":"kmeans.labels_","21e3b437":"kmeans.cluster_centers_","c7637700":"wineDf['Clusters'] = kmeans.labels_\nwineDf","38b6889e":"wineDf['Clusters'].value_counts()","d8121622":"wineDf[wineDf['Clusters']==6]","0df08f7f":"pd.crosstab(wineDf.quality,kmeans.labels_)","bdef28ad":"sns.scatterplot(x='pH',y='density', hue='Clusters', data=wineDf)","21256122":"from sklearn.metrics import silhouette_samples, silhouette_score\nimport numpy as np","25c96e60":"silhouette_score(winesMmsScaler, labelsWines)","fe269d23":"kmeans_per_k = [KMeans(n_clusters=k, random_state=5).fit(winesMmsScaler) for k in range(2,21)]","0ae023c4":"silhouete_scores = [silhouette_score(winesMmsScaler, model.labels_) for model in kmeans_per_k[1:]]\nfloat(np.argmax(silhouete_scores))","85579493":"range_n_clusters = [2, 3, 4, 5, 6,7,8,9,10]\nimport matplotlib.cm as cm\nfor n_clusters in range_n_clusters:\n    # Create a subplot with 1 row and 2 columns\n    fig, (ax1, ax2) = plt.subplots(1, 2)\n    fig.set_size_inches(18, 7)\n    # The 1st subplot is the silhouette plot\n    # The silhouette coefficient can range from -1, 1 but in this example all\n    # lie within [-0.1, 1]\n    ax1.set_xlim([-0.1, 1])\n    # The (n_clusters+1)*10 is for inserting blank space between silhouette\n    # plots of individual clusters, to demarcate them clearly.\n    ax1.set_ylim([0, len(wines) + (n_clusters + 1) * 10])\n    # Initialize the clusterer with n_clusters value and a random generator\n    # seed of 10 for reproducibility.\n    clusterer = KMeans(n_clusters=n_clusters, random_state=10)\n    cluster_labels = clusterer.fit_predict(winesMmsScaler)\n# The silhouette_score gives the average value for all the samples.\n    # This gives a perspective into the density and separation of the formed\n    # clusters\n    silhouette_avg = silhouette_score(winesMmsScaler, cluster_labels)\n    print(\"Para n_clusters =\", n_clusters,\n          \"O score_silhouette m\u00e9dio \u00e9 :\", silhouette_avg)\n    # Compute the silhouette scores for each sample\n    sample_silhouette_values = silhouette_samples(winesMmsScaler, cluster_labels)\n    y_lower = 10\n    for i in range(n_clusters):\n        # Aggregate the silhouette scores for samples belonging to\n        # cluster i, and sort them\n        ith_cluster_silhouette_values = \\\n            sample_silhouette_values[cluster_labels == i]\n        ith_cluster_silhouette_values.sort()\n        size_cluster_i = ith_cluster_silhouette_values.shape[0]\n        y_upper = y_lower + size_cluster_i\n        color = cm.nipy_spectral(float(i) \/ n_clusters)\n        ax1.fill_betweenx(np.arange(y_lower, y_upper),\n                          0, ith_cluster_silhouette_values,\n                          facecolor=color, edgecolor=color,       alpha=0.7)\n        # Label the silhouette plots with their cluster numbers at the middle\n        ax1.text(-0.05, y_lower + 0.5 * size_cluster_i, str(i))\n        # Compute the new y_lower for next plot\n        y_lower = y_upper + 10  # 10 for the 0 samples\n    ax1.set_title(\"The silhouette plot for the various clusters.\")\n    ax1.set_xlabel(\"The silhouette coefficient values\")\n    ax1.set_ylabel(\"Cluster label\")\n    # The vertical line for average silhouette score of all the values\n    ax1.axvline(x=silhouette_avg, color=\"red\", linestyle=\"--\")\n    ax1.set_yticks([])  # Clear the yaxis labels \/ ticks\n    ax1.set_xticks([-0.1, 0, 0.2, 0.4, 0.6, 0.8, 1])\n    # 2nd Plot showing the actual clusters formed\n    colors = cm.nipy_spectral(cluster_labels.astype(float) \/ n_clusters)\n    ax2.scatter(winesMmsScaler[:, 0], winesMmsScaler[:, 1], marker='.', s=30, lw=0, alpha=0.7,\n                c=colors, edgecolor='k')\n    # Labeling the clusters\n    centers = clusterer.cluster_centers_\n    # Draw white circles at cluster centers\n    ax2.scatter(centers[:, 0], centers[:, 1], marker='o',\n                c=\"white\", alpha=1, s=200, edgecolor='k')\n    for i, c in enumerate(centers):\n        ax2.scatter(c[0], c[1], marker='$%d$' % i, alpha=1,\n                    s=50, edgecolor='k')\n    ax2.set_title(\"The visualization of the clustered data.\")\n    ax2.set_xlabel(\"Feature space for the 1st feature\")\n    ax2.set_ylabel(\"Feature space for the 2nd feature\")\n    plt.suptitle((\"Silhouette analysis for KMeans clustering on sample data \"\n                  \"with n_clusters = %d\" % n_clusters),\n                 fontsize=14, fontweight='bold')\nplt.show()","7b43bb57":"Os valores que tem maior correla\u00e7\u00e3o com a qualidade s\u00e3o alcohol e volatile acidity.\n\nPh tem uma forte correla\u00e7\u00e3o negativa com os \u00e1cidos (quanto menor o ph maior acidez), por\u00e9m com volatile acidity h\u00e1 correla\u00e7\u00e3o positiva.\n\nSulphates e Chlorides tem correla\u00e7\u00e3o m\u00e9dia, por\u00e9m somente sulphates tem correla\u00e7\u00e3o com a qualidade.\n\nDensity tem forte correla\u00e7\u00e3o com os \u00e1cidos fixed acidity e citric acid, residual sugar e uma forte correla\u00e7\u00e3o negativa com alcohol.","67ed9d9d":"### Normaliza\u00e7\u00e3o ","e0d92e5f":"### Normaliza\u00e7\u00e3o Min Max Scaler","6c6073e9":"### Standard Scaler","fdc1c2d1":"\u00c9 importante ressaltar que a quantidade de vinho moderados \u00e9 muito alta, o que ocasionar\u00e1 numa disparidade nos dados. ","c21d2feb":"A ideia do Elbow \u00e9 rodar o KMeans para v\u00e1rios quantidades diferentes de clusters e dizer qual dessas quantidades \u00e9 o n\u00famero \u00f3timo de clusters. \n\nO que geralmente acontece ao aumentar a quantidade de clusters no KMeans \u00e9 que as diferen\u00e7as entre clusters se tornam muito pequenas, e as diferen\u00e7as das observa\u00e7\u00f5es intra-clusters v\u00e3o aumentando.\n\n-Calcular a fun\u00e7\u00e3o de custo, a soma dos quadrados das dist\u00e2ncias internas dos clusters, e tra\u00e7\u00e1-la em um gr\u00e1fico. ","c8717728":"## Matriz de correla\u00e7\u00e3o ","ef4fdb8b":"### Elbow Analysis","c140abb6":"### Teste kmeans para 10 clusters calculando o silhoute","3b591170":"#### Fixed.acidity \nNormalmente se faz referencia ao \u00e1cido tartarico, uns dos principais \u00e1cidos encontrados em uvas e um dos principais \u00e1cidos do vinho.\n\n#### Volatile.acidity \nA acidez vol\u00e1til refere-se aos \u00e1cidos destilados a vapor presentes no vinho, em grandes quantidades pode levar \u00e0 um gosto desagrad\u00e1vel. O n\u00edvel m\u00e9dio de \u00e1cido ac\u00e9tico em um vinho \u00e9 inferior a 400 mg\/L,embora os n\u00edveis possam variar de indetect\u00e1veis at\u00e9 3 g\/L.\n\n#### Citric.acid\nPresente nas uvas em baixa quantidade, nos vinhos o \u00e1cido c\u00edtrico tem pouca ou nenhuma presen\u00e7a. Nos vinhos tintos desaparece devido \u00e0 a\u00e7\u00e3o de bact\u00e9rias l\u00e1ticas (fermenta\u00e7\u00e3o malol\u00e1tica). Sensorialmente \u00e9 fresco, por\u00e9m em alguns casos pode apresentar um leve final amargo.\n\n#### Residual.sugar\nA fermenta\u00e7\u00e3o de um vinho \u00e9 feita atrav\u00e9s do contato do a\u00e7ucar com a levedura, ap\u00f3s a fermenta\u00e7\u00e3o resta o a\u00e7ucar residual. Quando cont\u00e9m at\u00e9 4 gramas de a\u00e7ucar residual por litro, um vinho pode ser considerado seco, a partir de 25 a 80 gramas \u00e9 considerado doce ou suave.\n\n#### Chlorides\nRepresenta a quantidade de sal contidas nos vinhos.\n\n#### Free.sulfur.dioxide\n\u00c9 uma forma livre de SO2, um g\u00e1s dissolvido que impede o crescimento de microbios e a oxida\u00e7\u00e3o do vinho. Quantidades excessivas de SO2 podem inibir a fermenta\u00e7\u00e3o e causar efeitos sensoriais indesej\u00e1veis.\n\n#### Total.sulfur.dioxide\nO di\u00f3xido de enxofre total (TSO2) \u00e9 a por\u00e7\u00e3o de dioxido de enxofre livre (SO2) que est\u00e1 livre no vinho mais a por\u00e7\u00e3o que est\u00e1 ligada a outros produtos qu\u00edmicos no vinho.\n\n#### Density\nA densidade do vinho se refere ao corpo do vinho, \u00e0 sensa\u00e7\u00e3o de maior ou menor densidade que a bebida apresenta. A densidade do vinho pode variar de acordo com a densidade da \u00e1gua e o teor percentual de \u00e1lcool e a\u00e7\u00facar.\n\n#### PH\nO pH (potencial Hidrogeni\u00f4nico) \u00e9 calculado a partir da concentra\u00e7\u00e3o de \u00edons de hidrog\u00eanio. Indica acidez, neutralidade ou alcalinidade de um produto. A escala varia de 0 a 14 e, quanto menor for o \u00edndice de pH, maior \u00e9 a acidez. Abaixo de 7, o pH \u00e9 \u00e1cido, igual a 7 \u00e9 neutro, e maior que 7 \u00e9 alcalino.\n\nNos vinhos em geral, o pH varia de 2,8 (acidez forte) at\u00e9 3,8 (acidez leve). Com pH acima de 3,5 o vinho \u00e9 fr\u00e1gil e pode estar sujeito a altera\u00e7\u00f5es (defeitos). Um pH baixo tem grande import\u00e2ncia na estabilidade do vinho.\n\n#### Sulphates\nO termo sulfato \u00e9 um termo inclusivo para o di\u00f3xido de enxofre (SO2), um conservante que \u00e9 amplamente utilizado na produ\u00e7\u00e3o de vinho (e na maioria das ind\u00fastrias aliment\u00edcias) por suas propriedades antioxidantes e antibacterianas. O SO2 desempenha um papel importante na preven\u00e7\u00e3o da oxida\u00e7\u00e3o e na manuten\u00e7\u00e3o da frescura de um vinho.\n\n#### Alcohol\nEsta vari\u00e1vel se refere a porcentagem de alcool contida nos vinhos.\n\nO \u00e1lcool \u00e9 a alma do vinho. \u00c9 a sua maior ou menor presen\u00e7a que define muitas das vezes a sua qualidade. \u00c9 habitual dizer-se de um vinho com mais de 13% de \u00e1lcool que \u00e9 encorpado, vinoso, capitoso, quente. J\u00e1 um vinho seco com menos de 11% de \u00e1lcool \u00e9 um vinho leve, magro, ligeiro e quase sempre desinteressante. Mas \u00e1lcool em excesso pode tornar um vinho pesado, chato, mole, desinteressante.","b2e177fc":"### Teste Silhouette \nA an\u00e1lise por Silhouette mede o qu\u00e3o bem um ponto se encaixa em um cluster. Neste m\u00e9todo um gr\u00e1fico \u00e9 feito medindo qu\u00e3o perto os pontos de um cluster est\u00e3o dos pontos de outro cluster mais pr\u00f3ximo. \n\nO coeficiente de Silhouette quando pr\u00f3ximo de +1, indica que os pontos est\u00e3o muito longe dos pontos do outro cluster, e quando pr\u00f3ximo de 0, indica que os pontos ent\u00e3o muito perto ou at\u00e9 interseccionando um outro cluster.","61d936b7":"### Aplicando o K-Means"}}