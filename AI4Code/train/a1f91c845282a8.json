{"cell_type":{"55cd7fbe":"code","2a6ade0d":"code","c0f77738":"code","14116003":"code","6dfdc0f9":"code","085a1b66":"code","727ae2b1":"code","16d217a9":"code","19bbe6ca":"code","b184a61e":"code","1d3c15be":"code","dd007c00":"code","732a7e6f":"code","5de21950":"code","3143e2fc":"code","502aca69":"code","5e477887":"code","4d202423":"code","649d0b17":"code","c534c462":"code","2aae1729":"code","198ca845":"code","57a06c45":"code","3d2b3095":"code","b6b691e5":"code","61d8e33d":"code","305f0ceb":"code","7e89eb16":"code","9699aa25":"code","d3318408":"code","ec849792":"code","67317520":"code","8a47cf59":"code","1b0ea881":"code","a66788f7":"code","f78fd82f":"code","f8bca9e9":"code","9cdba995":"code","581779af":"code","05af72fe":"code","5485e2e4":"code","8f6bd264":"code","22f7fbd1":"code","966c4955":"code","05640c7f":"code","672b8f2a":"code","a8f58949":"markdown","dbe53a71":"markdown","c1de750c":"markdown","caa74786":"markdown","7253742b":"markdown","45eb0f46":"markdown","baeb5109":"markdown","0d265f52":"markdown","3d0b15c2":"markdown","c5fba18b":"markdown","5c257a28":"markdown","1b67796e":"markdown","e9088c42":"markdown","7aee93d2":"markdown","2202247f":"markdown","0fcab96b":"markdown","6e4d7b65":"markdown","c6774a6c":"markdown","590931d4":"markdown","9d127d3d":"markdown","842246e7":"markdown","8d1af740":"markdown","a1848fe0":"markdown","5a722f44":"markdown","67f2784a":"markdown","63581817":"markdown","e2729caf":"markdown","4fd2f113":"markdown","c8450711":"markdown","45c5ef3d":"markdown"},"source":{"55cd7fbe":"#Import libraries\nimport numpy as np\nimport pandas as pd\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport missingno as msno\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","2a6ade0d":"#Read the data\ndata= pd.read_csv(\"\/kaggle\/input\/insurance\/insurance.csv\")","c0f77738":"data.head(5)","14116003":"data.shape","6dfdc0f9":"data.info()","085a1b66":"data.describe(include=\"all\").T","727ae2b1":"#Missing values?\ndata.isnull().sum()","16d217a9":"data.loc [data.duplicated (),:]","19bbe6ca":"sns.pairplot(data)","b184a61e":"sns.scatterplot(x=\"age\",y=\"charges\",data=data, color=\"b\").set(title='AGE vs CHARGES')","1d3c15be":"sns.scatterplot(x=\"bmi\",y=\"charges\",data=data,color=\"b\").set(title='BMI vs CHARGES')","dd007c00":"data =data[(data.charges<=50000)]","732a7e6f":"sns.scatterplot(x=\"age\",y=\"charges\",data=data, color=\"g\").set(title='AGE vs CHARGES')","5de21950":"sns.scatterplot(x=\"bmi\",y=\"charges\",data=data, color=\"g\").set(title='BMI vs CHARGES')","3143e2fc":"#Sex\nsexdummy=pd.get_dummies(data.sex,prefix=\"sex\",drop_first=True)\ndata = pd.concat([data, sexdummy], axis=1)\ndata.drop([\"sex\"],axis=1, inplace=True)","502aca69":"#Smoker\nsmodummy=pd.get_dummies(data.smoker,prefix=\"Smoker\", drop_first=True)\ndata = pd.concat([data, smodummy], axis=1)\ndata.drop([\"smoker\"],axis=1, inplace=True)","5e477887":"#Region\nregdummy=pd.get_dummies(data.region,prefix=\"region\",drop_first=True)\ndata = pd.concat([data, regdummy], axis=1)\ndata.drop([\"region\"],axis=1, inplace=True)","4d202423":"data.head()","649d0b17":"data.corr()[\"charges\"]","c534c462":"sns.set(rc={'figure.figsize':(15,12)})\nsns.heatmap(data.corr(),annot=True)","2aae1729":"#Target distribution\nsns.distplot(data.charges.values, color=\"violet\")\nmean= data.charges.mean()\nplt.axvline(mean,0,1,color=\"red\")","198ca845":"#Target distribution for smokers\nf= plt.figure(figsize=(12,5))\n\nax=f.add_subplot(121)\nsns.distplot(data[data.Smoker_yes==1][\"charges\"], color=\"red\")\nax.set_title('Distribution of charges for smokers')\n\nax=f.add_subplot(122)\nsns.distplot(data[data.Smoker_yes==0][\"charges\"])\nax.set_title('Distribution of charges for not-smokers')","57a06c45":"#Smokers\nsns.catplot(x=\"Smoker_yes\", kind=\"count\",hue = 'sex_male', palette=\"magma\", data=data).set(title=\"SMOKERS\")\nprint(data.Smoker_yes.value_counts())\ndata[(data.sex_male==0) & (data.Smoker_yes==1)].shape[0]","3d2b3095":"#Sex-Smoke\nsns.catplot(x=\"sex_male\", y=\"charges\", hue=\"Smoker_yes\",\n            kind=\"violin\", data=data, palette = 'magma').set(title=\"Sex vs. Smoke, and how it affects the cost\")","b6b691e5":"#Females\nsns.boxplot(x=\"charges\",y=\"Smoker_yes\", data=data[(data.sex_male==0)], orient=\"h\", palette=\"autumn\").set(title=\"FEMALES\")","61d8e33d":"#Males\nsns.boxplot(x=\"charges\",y=\"Smoker_yes\", data=data[(data.sex_male==1)], orient=\"h\", palette=\"cool\").set(title=\"MALES\")","305f0ceb":"#Age\nax = sns.distplot(data[\"age\"], color = 'orange')","7e89eb16":"#Do young people smoke?\nsns.catplot(x=\"Smoker_yes\",kind=\"count\", hue=\"sex_male\", data=data[(data.age==18)]).set(title=\"Do young people smoke?\")","9699aa25":"sns.boxplot(x=\"charges\",y=\"Smoker_yes\", data=data[(data.age==18)], orient=\"h\", palette=\"pink\").set(title=\"Smoking at 18yrs affects the cost of treatment\")","d3318408":"sns.scatterplot(x=\"age\",y=\"charges\",color=\"r\",data=data[data.Smoker_yes==1]).set(title=\"How age of smokers affect the cost?\")","ec849792":"#BMI\nax = sns.distplot(data[\"bmi\"], color = 'brown')","67317520":"#Obese people ()>30) charges\nsns.displot(data[(data.bmi >= 30)]['charges'], color=\"black\").set(title=\"Costs of obese people\")","8a47cf59":"#Rest\nsns.displot(data[(data.bmi < 30)]['charges'], color='grey').set(title=\"Costs of people BMI<30\")","1b0ea881":"#Obese sexs ()>30) charges\nsns.catplot(x=\"sex_male\",kind=\"count\",palette=\"cividis\", data=data[(data.bmi>=30)]).set(title=\"Obese sexs\")","a66788f7":"sns.lmplot(x='bmi',y='charges',data=data,palette='Greys',hue='Smoker_yes').set(title=\"Smoke and BMI vs Cost\")","f78fd82f":"sns.scatterplot(x='age',y='charges',data=data[data.Smoker_yes==1],palette='bone',hue=\"bmi\",size=\"bmi\",sizes=(20,300)).set(title=\"How age of smokers affect the cost?\")","f8bca9e9":"#Children\nsns.catplot(x=\"children\", kind=\"count\", palette=\"autumn\", data=data, size = 6)","9cdba995":"#Do people who have children smoke?\nsns.catplot(x=\"Smoker_yes\", kind=\"count\", palette=\"hot\",hue = \"sex_male\",\n            data=data[(data.children > 0)], size = 6).set(title=\"Do people who have children smoke?\")","581779af":"#What's about obesity?\nsns.catplot(x=\"children\", kind=\"count\", palette=\"hot\",hue = \"sex_male\",\n            data=data[(data.bmi>=30)], size = 6).set(title=\"What's about obesity?\")","05af72fe":"from sklearn.model_selection import train_test_split\n\nseed=14\n\n\nfrom sklearn.linear_model import LinearRegression, Ridge, Lasso, ElasticNet\nfrom sklearn.kernel_ridge import KernelRidge\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.svm import SVR\nfrom sklearn.neighbors import KNeighborsRegressor\nfrom sklearn.cross_decomposition import PLSRegression\nfrom sklearn.ensemble import RandomForestRegressor, ExtraTreesRegressor, AdaBoostRegressor, GradientBoostingRegressor\nfrom xgboost import XGBRegressor\nfrom lightgbm import LGBMRegressor","5485e2e4":"lr = LinearRegression(n_jobs = -1)\nlasso = Lasso()\nridge = Ridge()\ndt = DecisionTreeRegressor()\nsvr = SVR()\nknn = KNeighborsRegressor(n_jobs= -1)\nrf = RandomForestRegressor()\nab = AdaBoostRegressor()\ngb = GradientBoostingRegressor()\nxgb = XGBRegressor(n_jobs = -1)\nlgb = LGBMRegressor(n_jobs = -1)","8f6bd264":"X= data.drop([\"charges\"],axis=1)\nY= data.charges\nX_train,X_test,y_train,y_test=train_test_split(X,Y,test_size=0.2)\nX","22f7fbd1":"from seaborn.external.husl import rgb_prepare\n'''Training accuracy of our regression models. By default score method returns coefficient of determination (r_squared).'''\ndef entrenar(model):\n    model.fit(X_train, y_train)\n    return (model.score(X_train, y_train),model.score(X_test, y_test))\n\nmodels = {'LinearRegression': lr,\n          'Lasso': knn,\n          'Rige': ridge,\n          'DecisionTreeRegressor': dt,\n          'SVR':svr,\n          'KNN':knn,\n          'RandomForestRegressor':rf,\n          'AdaBoostRegressor':ab,\n          'XGB': xgb,\n          'GradientBoostingRegressor': gb,\n          'LGBMRegressor': lgb}\nscores={}\ntrain_scores={}\nfor nombre, modelo in models.items():\n    scores[nombre]=entrenar(modelo)[1]\n    train_scores[nombre]=entrenar(modelo)[0]\n\nscores = pd.DataFrame(scores,index=['Score']).transpose()\nscores = scores.sort_values('Score')\n\ntrain_scores = pd.DataFrame(train_scores,index=['Train Score']).transpose()\ntrain_scores = train_scores.sort_values('Train Score')","966c4955":"cm = sns.color_palette('flare',as_cmap=True)\nscores = scores.style.background_gradient(cmap=cm)\nscores","05640c7f":"train_scores.style.background_gradient(cmap=cm)","672b8f2a":"gb.get_params()","a8f58949":"We have to understand the BMI. From 30 the Obesity begins.\nThen you can take a look at the treatments of patients with <30 and> 30 BMI","dbe53a71":"We can see that we have a majority of non-smokers, and for smokers we have that 58% are men.\nIt can be assumed that the cost of treatment for men will be higher than for women, given the impact of smoking.","c1de750c":"People with a high BMI and smokers pay much more expensive treatments","caa74786":"# Pairplot","7253742b":"It is seen again that smokers cover much larger cost ranges","45eb0f46":"**We have 1338 total rows and 7 columns.**\n3 categorical:\n\n*   sex\n*   smoker\n*   region\n\n4 numerical:\n\n*   age\n*   bmi\n*   children\n*   charges\n\n\n\n","baeb5109":"---\n**No missing values!**\n","0d265f52":"Now let's see the cildren","3d0b15c2":"Most of the patients do not have children.","c5fba18b":"Yes, but not so many","5c257a28":"Now, Smoke and Obesity relationship...","1b67796e":"Yes, they do. Lets see.","e9088c42":"\nLet's investigate BMI for a moment","7aee93d2":"# EDA","2202247f":"Now, returning to the relationship of smokers and age, what if we consider the BMI feature?","0fcab96b":"# Correlation","6e4d7b65":"# Encoding\nOne hote encoding","c6774a6c":"# Outliers","590931d4":"# Missing values\n\n\n","9d127d3d":"Obese people spend much more on treatment!","842246e7":"In non-smokers, we can see outliers. What 18-year-old non-smoker would want to pay for expensive treatment? Maybe someone with a complicated illness or an accident.","8d1af740":"Most people spend on cheap charges","a1848fe0":"**Observations:**\n\n* There is a strong relationship between the variables Smoker and Age with our target\n","5a722f44":"# Context\nMedical Cost Insurance. Can you accurately predict insurance costs?","67f2784a":"be careful with overfitting!","63581817":"There is! High BMI smokers spend much more than low BMI smokers as they get older","e2729caf":"Increase the cost logically.\nWe can see two separate point clouds, there must be a variable that divided them ...","4fd2f113":"A lot of young people","c8450711":"# Model","45c5ef3d":"For smokers we see that they spend on more expensive charges (> 30,000) and that also many spend on charges either cheap (like everyone else) or very expensive (bimodal graph).\nNon-smokers spend much cheaper charges"}}