{"cell_type":{"a25e4716":"code","c8396210":"code","532df09a":"code","5f3f7ac7":"code","1d99b5be":"code","79d19259":"code","254ca1e6":"code","0b7a5c43":"code","98750ac0":"code","3f01c48e":"code","691fb04d":"code","ac7b35f3":"code","d6e889a8":"code","fdc4f690":"markdown","af71d2e0":"markdown","07e3eb88":"markdown","f326b5f3":"markdown","4c9ecfe5":"markdown","4cecdd45":"markdown","2c2aa70a":"markdown","46d08b5f":"markdown","56a6418b":"markdown","5f6918e1":"markdown","e6013e35":"markdown","e09ce266":"markdown","57327388":"markdown","19bb8872":"markdown","17562f2a":"markdown"},"source":{"a25e4716":"!pip install --upgrade wandb","c8396210":"import os\n\nimport json\n\nimport base64\nfrom io import BytesIO\nfrom PIL import Image\nfrom IPython.display import display\n\nimport pickle","532df09a":"import wandb\n\ntry:\n    from kaggle_secrets import UserSecretsClient\n    user_secrets = UserSecretsClient()\n    api_key = user_secrets.get_secret(\"wandb_api\")\n    wandb.login(key=api_key)\n    anony = None\nexcept:\n    anony = \"must\"\n    print('If you want to use your W&B account, go to Add-ons -> Secrets and provide your W&B access token. Use the Label name as wandb_api. \\nGet your W&B access token from here: https:\/\/wandb.ai\/authorize')","5f3f7ac7":"filenames = os.listdir(\"..\/input\/wikipediasmall\")\n\njson_content = []\n\nfor file in filenames:\n    filename = os.path.join(\"..\/input\/wikipediasmall\", file)\n    with open(filename, 'rb') as f:\n        for line in f:\n            if line:\n                obj = json.loads(line)\n                content = {}\n                content['caption_title_and_reference_description'] = []\n                for element in obj['wit_features']:\n                    if element.get('caption_title_and_reference_description'):\n                        content['caption_title_and_reference_description'].append(element['caption_title_and_reference_description'])\n\n                content['b64_bytes'] = obj['b64_bytes']\n\n                # Check if captions or images are empty\n                if len(content['caption_title_and_reference_description']) > 0 and content['b64_bytes'] != \"\":\n                    json_content.append(content)","1d99b5be":"json_content[0].keys()","79d19259":"len(json_content)","254ca1e6":"index = 100\n\nout = base64.b64decode(json_content[index]['b64_bytes'])\nimg = Image.open(BytesIO(out)).convert(\"RGB\")\nprint(json_content[index]['caption_title_and_reference_description'])\ndisplay(img)","0b7a5c43":"run = wandb.init(project='Wikipedia',\n                 job_type='Visualization',\n                 anonymous='must')","98750ac0":"preview_table = wandb.Table(columns=['Image', 'Captions'])\nfor content in json_content[:1000]:\n    out = base64.b64decode(content['b64_bytes'])\n    img = Image.open(BytesIO(out)).convert(\"RGB\")\n    preview_table.add_data(wandb.Image(img), \n                           content['caption_title_and_reference_description'])\n\nwandb.log({'Visualization': preview_table})\nrun.finish()","3f01c48e":"with open(\"data.pkl\", \"wb\") as fp:\n    pickle.dump(json_content, fp)","691fb04d":"run = wandb.init(project=\"Wikipedia\", \n                 job_type=\"data\",\n                 anonymous=\"must\")\nprocessed_data = wandb.Artifact(\"Wiki-data\", type=\"dataset\",\n                                description=\"Processed data from file 00000 and 00001\",\n                                metadata={\"source\": \"analytics.wikimedia.org\/published\/datasets\/one-off\/caption_competition\/training\/joined\/\",\n                                          \"sizes\": len(json_content)})\nprocessed_data.add_file(\"data.pkl\")\nrun.log_artifact(processed_data)\nrun.finish()","ac7b35f3":"run = wandb.init(project=\"Wikipedia\", \n                 anonymous=\"must\")\nartifact = run.use_artifact('dchanda\/Wikipedia\/Wiki-data:v0', type='dataset')\nartifact_dir = artifact.download()\nrun.finish()","d6e889a8":"for file in os.listdir(artifact_dir):\n    filepath = os.path.join(artifact_dir, file)\n    with open(filepath, \"rb\") as fp:\n        contents = pickle.load(fp)\n\nindex = 100\n\nout = base64.b64decode(contents[index]['b64_bytes'])\nimg = Image.open(BytesIO(out)).convert(\"RGB\")\nprint(contents[index]['caption_title_and_reference_description'])\ndisplay(img)","fdc4f690":"# <span><h1 style = \"font-family: garamond; font-size: 40px; font-style: normal; letter-spcaing: 3px; background-color: #f6f5f5; color :#fe346e; border-radius: 100px 100px; text-align:center\">Visualize 1 Example<\/h1><\/span>","af71d2e0":"<span style=\"color: #000508; font-family: Segoe UI; font-size: 1.3em; font-weight: 300;\">Directory Structure<\/span>\n<blockquote>\n<ul>\n    <li><span style=\"color: #000508; font-family: Segoe UI; font-size: 1.3em; font-weight: 300;\"><code>wikipediasmall\/<\/code><\/span>\n    <\/li>\n    <ul>\n        <li>part-00000-48a6f07e-bb86-4735-aac7-883349f41a28-c000.json<\/li>\n        <li>part-00001-48a6f07e-bb86-4735-aac7-883349f41a28-c000.json<\/li>\n        <li>part-00002-48a6f07e-bb86-4735-aac7-883349f41a28-c000.json<\/li>\n    <\/ul>\n<span style=\"color: #000508; font-family: Segoe UI; font-size: 1.3em; font-weight: 300;\">The files have been downloaded from <a href=\"https:\/\/analytics.wikimedia.org\/published\/datasets\/one-off\/caption_competition\/training\/joined\/\">here<\/a><\/span>","07e3eb88":"![Upvote!](https:\/\/img.shields.io\/badge\/Upvote-If%20you%20like%20my%20work-07b3c8?style=for-the-badge&logo=kaggle)","f326b5f3":"![](https:\/\/i.imgur.com\/Uebq4gp.gif)","4c9ecfe5":"![](https:\/\/i.imgur.com\/3neB8pj.jpg)","4cecdd45":"# <span><h1 style = \"font-family: garamond; font-size: 40px; font-style: normal; letter-spcaing: 3px; background-color: #f6f5f5; color :#fe346e; border-radius: 100px 100px; text-align:center\">Download Data<\/h1><\/span>","2c2aa70a":"# <span><h1 style = \"font-family: garamond; font-size: 40px; font-style: normal; letter-spcaing: 3px; background-color: #f6f5f5; color :#fe346e; border-radius: 100px 100px; text-align:center\">Import Required Libraries \ud83d\udcda<\/h1><\/span>","46d08b5f":"<br>\n<h1 style = \"font-size:60px; font-family:Garamond ; font-weight : normal; background-color: #f6f5f5 ; color : #fe346e; text-align: center; border-radius: 100px 100px;\">EDA and Dataset Versioning <br>using W&B<\/h1>\n<br>","56a6418b":"# <span><h1 style = \"font-family: garamond; font-size: 40px; font-style: normal; letter-spcaing: 3px; background-color: #f6f5f5; color :#fe346e; border-radius: 100px 100px; text-align:center\">Visualize Entire Dataset<\/h1><\/span>","5f6918e1":"<blockquote>\n<span style=\"color: #000508; font-family: Segoe UI; font-size: 1.3em; font-weight: 300;\">Some key points to note in the original data:<\/span>\n<ul>\n    <li><span style=\"color: #000508; font-family: Segoe UI; font-size: 1.3em; font-weight: 300;\">Not all the images have a corresponding caption<\/span><\/li>\n    <li><span style=\"color: #000508; font-family: Segoe UI; font-size: 1.3em; font-weight: 300;\">Some images captions available in many languages<\/span><br><\/li>\n<\/ul>\n<\/blockquote>\n\n<span style=\"color: #000508; font-family: Segoe UI; font-size: 1.3em; font-weight: 300;\">This dataset contains 300px <code>b64_bytes<\/code> for all the images (no downloading required) along with a <code>list of captions<\/code> in all the available languages<\/span>","e6013e35":"# <span><h1 style = \"font-family: garamond; font-size: 40px; font-style: normal; letter-spcaing: 3px; background-color: #f6f5f5; color :#fe346e; border-radius: 100px 100px; text-align:center\">Dataset Versioning<\/h1><\/span>","e09ce266":"# <span><h1 style = \"font-family: garamond; font-size: 40px; font-style: normal; letter-spcaing: 3px; background-color: #f6f5f5; color :#fe346e; border-radius: 100px 100px; text-align:center\">Install Required Libraries<\/h1><\/span>","57327388":"<img src=\"https:\/\/camo.githubusercontent.com\/dd842f7b0be57140e68b2ab9cb007992acd131c48284eaf6b1aca758bfea358b\/68747470733a2f2f692e696d6775722e636f6d2f52557469567a482e706e67\">\n\n<blockquote>\n    <span style=\"color: #000508; font-family: Segoe UI; font-size: 1.3em; font-weight: 300;\">We will be using Weights and Biases for:<\/span>\n<ul>\n    <li><span style=\"color: #000508; font-family: Segoe UI; font-size: 1.3em; font-weight: 300;\">Visualizing the dataset<\/span><\/li>\n    <li><span style=\"color: #000508; font-family: Segoe UI; font-size: 1.3em; font-weight: 300;\">Dataset versioning<\/span><br><\/li>\n<\/ul>\n<span style=\"color: #000508; font-family: Segoe UI; font-size: 1.3em; font-weight: 300;\">W&B Dashboard: <a href=\"https:\/\/wandb.ai\/dchanda\/Wikipedia\">wandb.ai\/dchanda\/Wikipedia<\/a><\/span>\n<\/blockquote>","19bb8872":"<span style=\"color: #000508; font-family: Segoe UI; font-size: 1.5em; font-weight: 300;\"><a href=\"https:\/\/wandb.ai\/dchanda\/Wikipedia\/runs\/2kzujq78\">View the Complete Table Here \u2b95<\/a><\/span>","17562f2a":"# <span><h1 style = \"font-family: garamond; font-size: 40px; font-style: normal; letter-spcaing: 3px; background-color: #f6f5f5; color :#fe346e; border-radius: 100px 100px; text-align:center\">Read Data<\/h1><\/span>"}}