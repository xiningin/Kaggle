{"cell_type":{"f1f39474":"code","09fabb48":"code","14b8c12c":"code","19e3dd2b":"code","dcfa53b6":"code","31ff2ffa":"code","6c0edde5":"code","1746bfec":"code","17b5f351":"code","ad12596a":"code","aa0a5e23":"code","7e683ddd":"code","655f63bb":"code","947022d5":"code","fc0cb8cc":"code","276b4da0":"code","27724708":"markdown","fd5871e9":"markdown","d30f561b":"markdown","caa5bc3d":"markdown","e906708a":"markdown","43a67a1b":"markdown","003fe74a":"markdown","6b1c8e8e":"markdown","2315df5a":"markdown","a73c7bf6":"markdown","8775d2b6":"markdown","63393c54":"markdown","e5cb7694":"markdown","03c5d2ea":"markdown","c309b82a":"markdown","f0407150":"markdown","f361868a":"markdown","78759c59":"markdown","f210cbee":"markdown","ba57ed30":"markdown"},"source":{"f1f39474":"import numpy as np\nimport pandas as pd\nimport plotly.graph_objects as go\nimport plotly.subplots as ms\nimport statsmodels.api as sm\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.metrics import accuracy_score\nimport plotly.express as px\n","09fabb48":"df = pd.read_csv('\/kaggle\/input\/heart-failure-clinical-data\/heart_failure_clinical_records_dataset.csv')","14b8c12c":"df.describe()","19e3dd2b":"# Dividing data into survivors vs non survivors for visualizations\n\nsurvivals = df.loc[df['DEATH_EVENT'] == 0]\ndeaths = df.loc[df['DEATH_EVENT'] == 1]","dcfa53b6":"print(\"No. of Samples\", len(df))\nprint('===============================')\nprint(df.isnull().sum())\nprint('===============================')","31ff2ffa":"X = df.drop('DEATH_EVENT', axis=1)\ny = df['DEATH_EVENT']\ncolumns = list(X.columns)\np_max = 1\nwhile (len(columns)>0):\n    p_values = []\n    X_test = X[columns]\n    X_test = sm.add_constant(X_test)\n    model = sm.OLS(y,X_test).fit()\n    p = pd.Series(model.pvalues.values[1:],index = columns)      \n    p_max = max(p)\n    p_max_index = p.idxmax()\n    if(p_max >0.05):\n        columns.remove(p_max_index)\n    else:\n        break\nselected_features_BE = columns\nprint(selected_features_BE)\n\n# Gives us following list ['age', 'ejection_fraction', 'serum_creatinine', 'time']","6c0edde5":"X_train, X_test, y_train, y_test = train_test_split(X,y, test_size = 0.3, random_state = 0)\nmodel = RandomForestClassifier(criterion='entropy')\nmodel.fit(X,y)\nfeature_importance = pd.DataFrame({\n    'feature': X.columns,\n    'importance': model.feature_importances_\n})\n\nfeature_importance.sort_values('importance', inplace=True)\nfeature_importance.reset_index(drop=True, inplace=True)\nfig = px.bar(feature_importance, x='feature', y='importance')\nfig.show()","1746bfec":"bins = list(range(40, 100, 5))\n\nsurvivors_grp = df.loc[df['DEATH_EVENT'] == 0]['age']\ndeaths_grp = df.loc[df['DEATH_EVENT'] == 1]['age']\n\nfig = ms.make_subplots(rows=1,\n    cols=2,\n   subplot_titles = ['Age vs Survival Event', 'Survival Rate vs Age']\n)\n\nfig.add_trace(\n    go.Histogram(\n        x=survivors_grp.values,\n        marker_color='#595ee6',\n        name='Survivals'\n    ),\n    row=1,\n    col=1\n)\nfig.add_trace(\n    go.Histogram(\n        x=deaths_grp.values,\n        marker_color='#d059e6',\n        name='Deaths'\n    ),\n    row=1,\n    col=1\n)\n\n# Plotting Death percantage vs Age groups\ngroups = df.groupby([pd.cut(df['age'], bins), 'DEATH_EVENT'])\nsurvival_rate = groups.size().unstack()\nsurvival_rate['Survival Rate'] = survival_rate[0] * 100 \/ (survival_rate[1] + survival_rate[0])\nsurvival_rate['Age Groups'] = survival_rate.index.astype(str).tolist()\nsurvival_rate['idx'] = range(len(survival_rate))\nsurvival_rate.set_index('idx', inplace=True)\n\nfig.add_trace(\n    go.Bar(\n        x=survival_rate['Age Groups'],\n        y=survival_rate['Survival Rate'],\n        name='Survival %'\n    ),\n    row=1,\n    col=2\n)\n\nfig.update_layout(\n    bargap=0.25,\n    bargroupgap=0.2\n)\n\nfig.show()","17b5f351":"bins = list(range(14, 80, 5))\n\nsurvivors_grp = df.loc[df['DEATH_EVENT'] == 0]['ejection_fraction']\ndeaths_grp = df.loc[df['DEATH_EVENT'] == 1]['ejection_fraction']\n\nfig = ms.make_subplots(rows=1,\n    cols=2,\n   subplot_titles = ['Ejection Fraction vs Survival Event', 'Survival Rate vs Ejection Fraction']\n)\n\nfig.add_trace(\n    go.Histogram(\n        x=survivors_grp.values,\n        marker_color='#595ee6',\n        name='Survivals'\n    ),\n    row=1,\n    col=1\n)\nfig.add_trace(\n    go.Histogram(\n        x=deaths_grp.values,\n        marker_color='#d059e6',\n        name='Deaths'\n    ),\n    row=1,\n    col=1\n)\n\n# Plotting Death percantage vs Age groups\ngroups = df.groupby([pd.cut(df['ejection_fraction'], bins), 'DEATH_EVENT'])\nsurvival_rate = groups.size().unstack()\nsurvival_rate['Survival Rate'] = survival_rate[0] * 100 \/ (survival_rate[1] + survival_rate[0])\nsurvival_rate['Ejection Fraction Groups'] = survival_rate.index.astype(str).tolist()\nsurvival_rate['idx'] = range(len(survival_rate))\nsurvival_rate.set_index('idx', inplace=True)\n\nfig.add_trace(\n    go.Bar(\n        x=survival_rate['Ejection Fraction Groups'],\n        y=survival_rate['Survival Rate'],\n        name='Survival %'\n    ),\n    row=1,\n    col=2\n)\n\nfig.update_layout(\n    bargap=0.25,\n    bargroupgap=0.2\n)\n\nfig.show()","ad12596a":"bins = list(np.arange(0.0, 10, 0.5))\n\nsurvivors_grp = df.loc[df['DEATH_EVENT'] == 0]['serum_creatinine']\ndeaths_grp = df.loc[df['DEATH_EVENT'] == 1]['serum_creatinine']\n\nfig = ms.make_subplots(rows=1,\n    cols=2,\n   subplot_titles = ['Serum Creatinine vs Survival Event', 'Survival Rate vs Serum Creatinine']\n)\n\nfig.add_trace(\n    go.Histogram(\n        x=survivors_grp.values,\n        marker_color='#595ee6',\n        name='Survivals'\n    ),\n    row=1,\n    col=1\n)\nfig.add_trace(\n    go.Histogram(\n        x=deaths_grp.values,\n        marker_color='#d059e6',\n        name='Deaths'\n    ),\n    row=1,\n    col=1\n)\n\n# Plotting Death percantage vs Age groups\ngroups = df.groupby([pd.cut(df['serum_creatinine'], bins), 'DEATH_EVENT'])\nsurvival_rate = groups.size().unstack()\nsurvival_rate['Survival Rate'] = survival_rate[0] * 100 \/ (survival_rate[1] + survival_rate[0])\nsurvival_rate['Serum Creatinine Groups'] = survival_rate.index.astype(str).tolist()\nsurvival_rate['idx'] = range(len(survival_rate))\nsurvival_rate.set_index('idx', inplace=True)\n\nfig.add_trace(\n    go.Bar(\n        x=survival_rate['Serum Creatinine Groups'],\n        y=survival_rate['Survival Rate'],\n        name='Survival %'\n    ),\n    row=1,\n    col=2\n)\n\nfig.update_layout(\n    bargap=0.25,\n    bargroupgap=0.2\n)\n\nfig.show()","aa0a5e23":"bins = list(range(0, 300, 20))\n\nsurvivors_grp = df.loc[df['DEATH_EVENT'] == 0]['time']\ndeaths_grp = df.loc[df['DEATH_EVENT'] == 1]['time']\n\nfig = ms.make_subplots(rows=1,\n    cols=2,\n   subplot_titles = ['Time vs Survival Event', 'Survival Rate vs Time']\n)\n\nfig.add_trace(\n    go.Histogram(\n        x=survivors_grp.values,\n        marker_color='#595ee6',\n        name='Survivals'\n    ),\n    row=1,\n    col=1\n)\nfig.add_trace(\n    go.Histogram(\n        x=deaths_grp.values,\n        marker_color='#d059e6',\n        name='Deaths'\n    ),\n    row=1,\n    col=1\n)\n\n# Plotting Death percantage vs Age groups\ngroups = df.groupby([pd.cut(df['time'], bins), 'DEATH_EVENT'])\nsurvival_rate = groups.size().unstack()\nsurvival_rate['Survival Rate'] = survival_rate[0] * 100 \/ (survival_rate[1] + survival_rate[0])\nsurvival_rate['Time Groups'] = survival_rate.index.astype(str).tolist()\nsurvival_rate['idx'] = range(len(survival_rate))\nsurvival_rate.set_index('idx', inplace=True)\n\nfig.add_trace(\n    go.Bar(\n        x=survival_rate['Time Groups'],\n        y=survival_rate['Survival Rate'],\n        name='Survival %'\n    ),\n    row=1,\n    col=2\n)\n\nfig.update_layout(\n    bargap=0.25,\n    bargroupgap=0.2\n)\n\nfig.show()","7e683ddd":"bins = list(range(23, 6000, 500))\n\nsur_grp = survivals['creatinine_phosphokinase']\ndth_grp = survivals['creatinine_phosphokinase']\n\nfig = ms.make_subplots(rows=1,\n    cols=2,\n   subplot_titles = ['Creatinine vs Survival Event', 'Survival Rate vs Creatinine']\n)\n\nfig.add_trace(\n    go.Histogram(\n        x=sur_grp.values,\n        marker_color='#595ee6',\n        name='Survivals'\n    ),\n    row=1,\n    col=1\n)\nfig.add_trace(\n    go.Histogram(\n        x=dth_grp.values,\n        marker_color='#d059e6',\n        name='Deaths'\n    ),\n    row=1,\n    col=1\n)\n\n# Plotting Death percantage vs Age groups\ngrps = df.groupby([pd.cut(df['creatinine_phosphokinase'], bins), 'DEATH_EVENT'])\nsur_rate = grps.size().unstack()\nsur_rate['Survival Rate'] = sur_rate[0] * 100 \/ (sur_rate[1] + sur_rate[0])\nsur_rate['Creatinine'] = sur_rate.index.astype(str).tolist()\nsur_rate['idx'] = range(len(sur_rate))\nsur_rate.set_index('idx', inplace=True)\n\nfig.add_trace(\n    go.Bar(\n        x=sur_rate['Creatinine'],\n        y=sur_rate['Survival Rate'],\n        name='Survival %'\n    ),\n    row=1,\n    col=2\n)\n\nfig.update_layout(\n    bargap=0.25,\n    bargroupgap=0.2\n)\n\nfig.show()","655f63bb":"bins = list(range(110, 130, 1))\n\nsur_grp = survivals['serum_sodium']\ndth_grp = survivals['serum_sodium']\n\nfig = ms.make_subplots(rows=1,\n    cols=2,\n   subplot_titles = ['Serum Sodium vs Survival Event', 'Survival Rate vs Serum Sodium']\n)\n\nfig.add_trace(\n    go.Histogram(\n        x=sur_grp.values,\n        marker_color='#595ee6',\n        name='Survivals'\n    ),\n    row=1,\n    col=1\n)\nfig.add_trace(\n    go.Histogram(\n        x=dth_grp.values,\n        marker_color='#d059e6',\n        name='Deaths'\n    ),\n    row=1,\n    col=1\n)\n\n# Plotting Death percantage vs Age groups\ngrps = df.groupby([pd.cut(df['serum_sodium'], bins), 'DEATH_EVENT'])\nsur_rate = grps.size().unstack()\nsur_rate['Survival Rate'] = sur_rate[0] * 100 \/ (sur_rate[1] + sur_rate[0])\nsur_rate['Serum Sodium'] = sur_rate.index.astype(str).tolist()\nsur_rate['idx'] = range(len(sur_rate))\nsur_rate.set_index('idx', inplace=True)\n\nfig.add_trace(\n    go.Bar(\n        x=sur_rate['Serum Sodium'],\n        y=sur_rate['Survival Rate'],\n        name='Survival %'\n    ),\n    row=1,\n    col=2\n)\n\nfig.update_layout(\n    bargap=0.25,\n    bargroupgap=0.2\n)\n\nfig.show()","947022d5":"bins = list(range(2500, 850000, 20000))\n\nsur_grp = survivals['platelets']\ndth_grp = survivals['platelets']\n\nfig = ms.make_subplots(rows=1,\n    cols=2,\n   subplot_titles = ['Platelets vs Survival Event', 'Survival Rate vs Platelets']\n)\n\nfig.add_trace(\n    go.Histogram(\n        x=sur_grp.values,\n        marker_color='#595ee6',\n        name='Survivals'\n    ),\n    row=1,\n    col=1\n)\nfig.add_trace(\n    go.Histogram(\n        x=dth_grp.values,\n        marker_color='#d059e6',\n        name='Deaths'\n    ),\n    row=1,\n    col=1\n)\n\n# Plotting Death percantage vs Age groups\ngrps = df.groupby([pd.cut(df['platelets'], bins), 'DEATH_EVENT'])\nsur_rate = grps.size().unstack()\nsur_rate['Survival Rate'] = sur_rate[0] * 100 \/ (sur_rate[1] + sur_rate[0])\nsur_rate['Platelets'] = sur_rate.index.astype(str).tolist()\nsur_rate['idx'] = range(len(sur_rate))\nsur_rate.set_index('idx', inplace=True)\n\nfig.add_trace(\n    go.Bar(\n        x=sur_rate['Platelets'],\n        y=sur_rate['Survival Rate'],\n        name='Survival %'\n    ),\n    row=1,\n    col=2\n)\n\nfig.update_layout(\n    bargap=0.25,\n    bargroupgap=0.2\n)\n\nfig.show()","fc0cb8cc":"x_train, x_test, y_train, y_test = train_test_split(X[['age', 'ejection_fraction', 'serum_creatinine', 'time']], y, test_size = 0.2)","276b4da0":"rfc = RandomForestClassifier(criterion='entropy', max_features=4, n_estimators=1000)\n\nrfc.fit(x_train, y_train)\n\nrfc_predict = rfc.predict(x_test)\n\nacc_score = accuracy_score(y_test, rfc_predict)\n\nprint(\"Accuracy Score: {}%\".format(acc_score*100))","27724708":"### Backward Elimination\n\nWe use p-values to filter out redundant features. ","fd5871e9":"## Train - Test Split","d30f561b":"## Feature Selection\n\nLets find out what features are relevant for predicting heart failure.\n\nWe can do this in two ways:\n* Plotting a correlation wrt death event and visualizing each feature wrt Death Event and see if there is any correlation\n* Using feature importance in ensemble techniques\n\nCorrelation only works in case of non-categorical data. So it needs additional effort for checking relation between categorical data and label.\n\nWe will use a hybrid approach. We'll use BE and Feature importance to find the optimum number of features required for prediction. To make sure selection process is going in the right direction, we'll plot some of the features vs death event.\n","caa5bc3d":"\n## Serum Creatinine\n\nLet's plot the distribution with categorised by survival event.\n\nWe will also plot the survival rate wrt creatinine levels to see if it acts as a factor along with other features.\n\n**From the plots we can see Survival rate decreases as Serum Creatinine increases to a certain point but again increases for higher values. It can be a deciding factor along with other features.**","e906708a":"## Checking the data for missing values and cleaning up (if required)\nI generally prefer to check the data for missing values as the first step. Turns out this data doesn't have any missing values.","43a67a1b":"## Verifying features through visualizing wrt Death Event\n\nWe will use plotly to plot distribution plots and check if we find any pattern between individual features and death event","003fe74a":"**From the plots we see Survival rate increases as Ejection Fraction increases. It can be a deciding factor along with other features.**","6b1c8e8e":"\n## Platelets\n\nLet's plot the distribution with categorised by survival event.\n\nWe will also plot the survival rate wrt Platelets levels to see if it acts as a factor along with other features.\n\n**From the plots we can see there is no clear pattern for survival rate wrt platelets levels. It may not be able to help in prediction.**\n\n**We can ignore this feature**","2315df5a":"\n## Creatinine Phosphokinase\n\nLet's plot the distribution with categorised by survival event.\n\nWe will also plot the survival rate for wrt creatinine levels to see if it acts as a factor along with other features.\n\n**From the plots we can see survival rates for all the cretanine levels are approximately same. It may not be able to help in prediction.**\n\n**We can ignore this feature**","a73c7bf6":"## Loading the dataset\n\nLet's load the data and have a quick preview of what dataset looks like.","8775d2b6":"\n## Serum Sodium\n\nLet's plot the distribution with categorised by survival event.\n\nWe will also plot the survival rate wrt Serum Sodium levels to see if it acts as a factor along with other features.\n\n**From the plots we can see survival rates for all the serum sodium levels are approximately same. It may not be able to help in prediction.**\n\n**We can ignore this feature**","63393c54":"Backward Elimination suggests only 4 features **'age', 'ejection_fraction', 'serum_creatinine', 'time'**\n\nRandom Forest suggests additional 3 features **serum_sodium, platelets, creatinine_phosphate**\n\nWe can safely ignore the rest.","e5cb7694":"### Age\n\nLet's plot age distribution with categorised by survival event.\n\nWe will also plot the survival rate for each age group to see if age acts as a factor along with other features.","03c5d2ea":"### Ejection Fraction\n\nLet's plot Ejection distribution with categorised by survival event.\n\nWe will also plot the survival rate as ejection fraction increases.","c309b82a":"## Selected Features\n\nBased on the models and visualizations, we can select following features for prediction\n\n**'age',  'ejection_fraction',  'serum_creatinine' and 'time'**","f0407150":"## Random Forest Classifier","f361868a":"**From the plots we see age can be a deciding factor along with other features. Death rate is higher in higher age groups**","78759c59":"\n## Time\n\nLet's plot the distribution with categorised by survival event.\n\nWe will also plot the survival rate wrt time to see if it acts as a factor along with other features.\n\n**From the plots we can see Survival rate is higher for higher time values. It can be a deciding factor along with other features.**","f210cbee":"## Overview of the data\n\nColumns **anaemia**, **diabetes**, **high_blood_pressure** and **smoking** are boolean type\n\nRest of the columns except **sex** are numeric.\n\n**sex** is a categorical column with only 2 values ( Male: 0 and Female: 1). Since there are only 2 categories, we need not do any hot encoding and we can leave them as they are.\n\n**DEATH_EVENT** is our label column","ba57ed30":"### Using feature importance in ensemble techniques\n\nWe will first find the optimum number of features required for prediction based on prediction accuracy and then select find the actual list of features.\n\nFrom the plot we can select "}}