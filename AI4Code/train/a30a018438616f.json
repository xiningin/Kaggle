{"cell_type":{"30047f5d":"code","707bb149":"code","1dd14736":"code","d26249fe":"code","84c65023":"code","27748edf":"code","cf5631d5":"code","db82310e":"code","7b5296e1":"code","1c60809a":"code","9a0416df":"code","b5d00c9a":"code","b31394ef":"code","d263d905":"code","354d711f":"code","85fcff2e":"code","87391f91":"code","efde459b":"code","9df81ad7":"code","70ea2b4b":"code","a2d746de":"markdown","c71603d0":"markdown"},"source":{"30047f5d":"# First thing first we have to import some libraries for data manipulation and visualization\nimport pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport matplotlib.ticker as ticker\nfrom PIL import Image\nfrom pylab import rcParams\nrcParams['axes.xmargin'] = 0\nrcParams['axes.ymargin'] = 0\nplt.style.use('fivethirtyeight')\n%matplotlib inline\n","707bb149":"# I have Scraped 5 tables data from Wikipedia article\ndf_religious = pd.read_csv(\"..\/input\/demographics-of-israe\/df_religious.csv\")\ndf_births = pd.read_csv(\"..\/input\/demographics-of-israe\/df_births.csv\")\ndf_bd = pd.read_csv(\"..\/input\/demographics-of-israe\/df_bd.csv\")\ndf_structure = pd.read_csv(\"..\/input\/demographics-of-israe\/df_structure.csv\")\ndf_fertility = pd.read_csv(\"..\/input\/demographics-of-israe\/df_fertilty.csv\")\n\ndf_religious","1dd14736":"# A couple of thing to notice is that we have to rearrange the columns headers and change the data types,\n## set the Group column as an index, sort the values and add 'Total' row. Lets do that.\ndf_religious.info()","d26249fe":"# Population and Religious (df_religious)\ndf_religious = pd.DataFrame(df_religious.values[1:], columns=df_religious.iloc[0])\ndf_religious.set_index('Group', inplace=True)\ndf_religious['Population'] = df_religious['Population'].astype(int)\ndf_religious['%'] = df_religious['%'].astype(str)\ndf_religious['%'] = df_religious['%'].str.replace(\"%\",\"\").astype('float')\ndf_religious[:-1].sort_values(by='Population', ascending=False)\ndf_religious.loc['Total',:] = df_religious.sum(axis=0).round()\ndel df_religious.columns.name\ndf_religious","84c65023":"# Births, in absolute numbers, by mother's religion (df_births)\ndf_births = pd.DataFrame(df_births.values[1:], columns=df_births.iloc[0])\ndf_births[['Year','Jewish','Muslim','Christian','Druze','Others','Total']] = \\\ndf_births[['Year','Jewish','Muslim','Christian','Druze','Others','Total']].apply(pd.to_numeric)\ndf_births['% Muslim'] = df_births['% Muslim'].astype(str)\ndf_births['% Muslim'] = df_births['% Muslim'].str.replace(\"%\",\"\").astype('float')\ndf_births['% Jewish'] = df_births['% Jewish'].astype(str)\ndf_births['% Jewish'] = df_births['% Jewish'].str.replace(\"%\",\"\").astype('float')\ndf_births['Year'] = pd.to_datetime(df_births['Year'],format='%Y')\ndf_births.set_index('Year', inplace=True)\ndf_births.index = df_births.index.year\ndel df_births.columns.name\ndf_births.head()","27748edf":"# Births and deaths (df_bd)\ndf_bd = pd.DataFrame(df_bd.values[1:], columns=df_bd.iloc[0])\nfor i in df_bd.columns:\n    df_bd[i] = df_bd[i].str.replace(\" \",\"\").apply(pd.to_numeric) # replacing spaces and changing data type to numeric\ndf_bd['Year'] = pd.to_datetime(df_bd['Year'],format='%Y')\ndf_bd.set_index('Year', inplace=True)\ndf_bd.index = df_bd.index.year\ndel df_bd.columns.name\ndf_bd.rename(columns={'Population (x1000)':'Population'}, inplace=True)\ndf_bd['Population'] = df_bd['Population'] * 1000 \ndf_bd['TFR'] = df_bd['TFR'].ffill().bfill() # filling missing values forward and backward fill\ndf_bd.head()","cf5631d5":"df_structure","db82310e":"# Structure of the population (01.07.2012)  (df_structure)\n# In this table, as one can see from the code above I had to perform manipulation on all the columns to delete some spaces between the numbers\n# and then to transform the data-type to numeric, a well to set the Age Group as an index with a categorical type.\n\ndf_structure = pd.DataFrame(df_structure.values[1:], columns=df_structure.iloc[0])\ndf_structure['Male'] = df_structure.Male.str.replace(\" \",\"\").apply(pd.to_numeric)\ndf_structure['Female'] = df_structure.Female.str.replace(\" \",\"\").apply(pd.to_numeric)\ndf_structure['Total'] = df_structure.Total.str.replace(\" \",\"\").apply(pd.to_numeric)\ndf_structure['%'] = (df_structure['%'].str.replace(\" \",\"\").apply(pd.to_numeric))\/100\ndf_structure = df_structure.iloc[1:]\ndf_structure['Age Group'] = df_structure['Age Group'].astype('category')\ndf_structure.set_index('Age Group', inplace=True)\ndel df_structure.columns.name\ndf_structure.head()","7b5296e1":"# Total fertility rate since 2000 (df_fertilty)\ndf_fertility = pd.DataFrame(df_fertility.values[1:], columns=df_fertility.iloc[0])\ndf_fertility = df_fertility.apply(pd.to_numeric)\ndf_fertility.set_index('Year', inplace=True)\ndel df_fertility.columns.name\ndf_fertility.head()","1c60809a":"# Generate descriptive statistics that summarize the central tendency, dispersion and shape of a dataset.\ndf_bd.describe().T.round()\n","9a0416df":"#Transform Yearly Population data to yearly precent_change\npct = df_bd.Population.pct_change()*100\npct.tail()","b5d00c9a":"pct.plot(kind='bar',figsize=(18,8), title=f'Population Percent Change. Yearly Average {np.round(pct.mean(),2)}%',\n color=['g' if x > pct.mean() else 'r' for x in pct]);\n# Green Bar = above percent change average, Red Bar = below percent change average ","b31394ef":"# Next, let's produce analysis of Israeli population by age & gender:\n\nfig, ax = plt.subplots(1,2)\ndf_structure.iloc[:,:2].plot.barh(stacked=True, figsize=(14,6), width = 0.9,\ntitle='Population by Age(range) & Sex (2012)', ax=ax[0]);\nax[0].get_xaxis().set_major_formatter(plt.FuncFormatter(lambda x, loc: \"{:.0f}\".format(int(x)\/1000)+'k'))                        \ndf_structure[['Male','Female']].sum().plot(kind='bar', ylim=(0,4500000), rot=True, figsize=(14,6), ax=ax[1]);\nfor i, v in enumerate(df_structure[['Male','Female']].sum()):\n    plt.text(i-0.15,v+100000, '{:,}'.format(v));\n    plt.text(i-0.15, v-1000000,str((v\/df_structure[[\"Total\"]].sum()[0]).round(3)*100)+\"%\", fontsize=20)\nplt.title(\"Israel Population by gender (2012)\")\nplt.xlabel(\"Gender\");","d263d905":"# And by religion:\nplt.style.use('fivethirtyeight')\nfig, ax = plt.subplots(1,2)\ndf_religious.iloc[:-1,:-1].T.plot.bar(figsize=(12,6),stacked=True, ax=ax[0], legend=False);\nax[0].get_yaxis().set_major_formatter(plt.FuncFormatter(lambda y, p: format(int(y), ',')))\nax[0].set_xticks([])\nax[0].set_title(\"Total Population\",fontweight=\"bold\");\nplt.pie(df_religious['%'][:-1],labels=df_religious.index[:-1],autopct='%1.1f%%', shadow=True,\n        explode = (0.05, 0.05, 0.05, 0.05,0.05), startangle=50);\nplt.title(\"%Population by Religious (2017)\",fontweight=\"bold\");","354d711f":"# visualize the absolute numbers of live births vs deaths for the overall population:\nplt.style.use('seaborn-white')\nfig, ax = plt.subplots(1, 1, figsize=(14,8))\nax.fill_between(df_bd.index, y1=df_bd['Live births'].values, y2=0, alpha=0.5, label=df_bd.columns[1], linewidth=2);\nax.fill_between(df_bd.index, y1=df_bd['Deaths'].values, y2=0, alpha=0.5,label = df_bd.columns[2], linewidth=2);\nax.get_yaxis().set_major_formatter(plt.FuncFormatter(lambda y, p: format(int(y), ',')))\nax.set_title('Live births Vs Deaths (absolute numbers)', fontsize=18)\nax.set_xlabel('Year')\nax.legend(loc=2, fontsize=20);\nfor y in range(0, 170000, 10000):    \n    plt.hlines(y, xmin=df_bd.index.min(), xmax=df_bd.index.max(), colors='black', alpha=0.7, linestyles=\"--\", lw=0.5)","85fcff2e":"df_births[['Jewish','Muslim']].plot(kind='bar', figsize=(14,7), ylim=(0,150000),\n                                    title=\"Births, in absolute numbers by religion\");","87391f91":"#  Normalized growth rate science 1996 (*not including Christian,Druze,Others as relatively insignificant)\nax = plt.figure()\nax = (df_births.iloc[:,[0,1,5]]\/df_births.iloc[0,[0,1,5]]-1).plot(figsize=(12,8),title=\"Births, growth rate (since 1996)\")\nvals = ax.get_yticks()\nax.set_yticklabels(['{:,.1%}'.format(x) for x in vals]);","efde459b":"df_fertility[['Jews', 'Muslims', 'Total']].plot(figsize=(12,8), title=(\"Fertility Rate by religion\"));","9df81ad7":"# Now, for the final chart, let's perform a simple population projection, by taking the last 10 years average growth rate of the overall population and compound it forward:\ndf_bdp = pd.DataFrame({'Population_est':range(70)}, index=(range(df_bd.index[-1],df_bd.index[-1]+70)))\ndf_bdp.loc[2018,'Population_est'] = df_bd.iloc[-1,0]\nfor i in range(1,len(df_bdp)):\n    df_bdp.iloc[i,0] = (df_bdp.iloc[i-1,0] * (1+pct[-10:].mean()\/100)).round(0)","70ea2b4b":"plt.style.use('seaborn-white')\nfig, ax = plt.subplots(figsize=(14,8))\nim = np.array(Image.open('..\/input\/picture\/pf3.jpg'))\nx1, x2 = df_bd.index.min(), df_bdp.index.max()-3\ny1, y2 = df_bd.Population.min(), df_bdp.Population_est.max() *1.1\nax.imshow(im, extent=[x1, x2, y1, y2], aspect='auto')\nax.plot(df_bd.index, df_bd.Population, lw=8)\nax.plot(df_bdp.index,df_bdp.Population_est,lw=8, color='r',alpha=0.8)\ny_formatter = ticker.FuncFormatter(lambda x, loc: \"{:,.1f}M\".format(x*1e-6))\nax.yaxis.set_major_formatter(y_formatter);\nax.set_title(\"Israel Population (past & future estimation)\",fontweight=\"bold\");\nax.set_xlabel(\"Year\",fontweight=\"bold\",);","a2d746de":"### Simple EDA using Wikipedia tables that was stored as CSV","c71603d0":"[Demographics of Israel From Wikipedia link](https:\/\/en.wikipedia.org\/wiki\/Demographics_of_Israel)"}}