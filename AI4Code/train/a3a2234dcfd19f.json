{"cell_type":{"b6ffc8e0":"code","f87b81b0":"code","a59364cd":"code","d9370d0f":"code","99c80fbc":"code","e2ed6526":"code","9d20a12e":"code","6b10d7f0":"code","5b13e6e2":"code","4f278e3c":"code","104e0138":"code","5833aed0":"code","b3d5e9c5":"code","07195fec":"code","7830f61e":"code","f4bb9a2d":"code","1de8ee51":"code","3a30192f":"code","7e197ab4":"code","8e614973":"code","1f79b7bd":"code","e7a9dba9":"code","838132cd":"code","1154ac94":"code","3eff3bc7":"code","b5491369":"code","94cb84f8":"code","f9909196":"code","3c486095":"code","a8243833":"code","fa5e3510":"code","01764d95":"code","df3032dd":"code","4d0c21ab":"code","51b8a2ad":"code","c9839b15":"code","6fca8e9d":"code","9ef94aaf":"code","747c9c0c":"code","8069bb21":"code","0a7066ec":"code","76084f1c":"code","5c66dd20":"code","702a993d":"code","54a563da":"code","4bc47316":"code","c45cd7c1":"code","a263cd9c":"code","4152e808":"code","8ff419b8":"code","04afcbc9":"code","6c31e7da":"markdown","ba1eef66":"markdown","74fa86bf":"markdown","3a32edef":"markdown","577390ef":"markdown","6788e53a":"markdown","7444b447":"markdown","027e3651":"markdown","6d224355":"markdown","da233f7f":"markdown","5917fa58":"markdown","f44817a4":"markdown","2402c47a":"markdown","3ae0c220":"markdown","cbf69abe":"markdown","0d241aa1":"markdown","47709420":"markdown","9930a548":"markdown","56970dc5":"markdown","33e52a73":"markdown"},"source":{"b6ffc8e0":"import numpy as np\nimport pandas as pd\nimport os\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly.express as px","f87b81b0":"df = pd.read_csv('..\/input\/churn-modelling\/Churn_Modelling.csv')","a59364cd":"df","d9370d0f":"df.info()","99c80fbc":"fig = px.box(df, y=\"Age\")\nfig.show()","e2ed6526":"plt.figure(figsize=(15,15))\nsns.heatmap(df.corr(), annot=True)","9d20a12e":"age_labels = ['18-20', '21-30', '31-40', '41-50', '51-60', '61-70', '71-80', '81-90', '91-100']\nAge_group = pd.cut(df['Age'], range(10, 101, 10), right=False, labels=age_labels)","6b10d7f0":"df.groupby(Age_group)['EstimatedSalary'].mean().plot(kind='bar',stacked=True)\nplt.title(\"Estimated Salary Distribution by Age Groups\",fontsize=14)\nplt.ylabel('Estimated Salary')\nplt.xlabel('Age Group');","5b13e6e2":"df.groupby(Age_group)['Exited'].mean().plot(kind='bar',stacked=True)\nplt.title(\"Distribution of Age Groups\",fontsize=14)\nplt.ylabel('Credit Score')\nplt.xlabel('Age Group')","4f278e3c":"plt.figure(figsize=(20,20))\nsns.catplot(x=\"Geography\", y=\"EstimatedSalary\", hue=\"Gender\", kind=\"box\", data=df)\nplt.title(\"Geography VS Estimated Salary\")\nplt.xlabel(\"Geography\")\nplt.ylabel(\"Estimated Salary\")","104e0138":"fig = px.box(df, x=\"Age\", y=\"Geography\", notched=True)\nfig.show()\n","5833aed0":"fig = px.parallel_categories(df, dimensions=['HasCrCard', 'IsActiveMember'],\n                 color_continuous_scale=px.colors.sequential.Inferno,\n                labels={'HasCrCard':'Credit Card Holder', 'IsActiveMember':'Activity Status'})\nfig.show()","b3d5e9c5":"fig = px.parallel_categories(df, dimensions=['HasCrCard', 'Gender','IsActiveMember'],\n                 color_continuous_scale=px.colors.sequential.Inferno,\n                labels={'Gender':'Gender', 'HasCrCard':'Credit Card Holder', 'IsActiveMember':'Activity Status'})\nfig.show()\n","07195fec":"fig = px.parallel_categories(df, dimensions=['IsActiveMember', 'Exited',],\n                 color_continuous_scale=px.colors.sequential.Inferno,\n                labels={'IsActiveMember':'Activity Status', 'Exited':'Exited Members',})\nfig.show()\n","7830f61e":"fig = plt.figure(figsize=(8,8))\nsns.distplot(df.CreditScore, color=\"orange\", label=\"CreditScore\")\nplt.legend();","f4bb9a2d":"fig = plt.figure(figsize=(8,8))\nsns.distplot(df.Balance, color=\"red\", label=\"Balance\")\nplt.legend();","1de8ee51":"fig = plt.figure(figsize=(8,8))\nsns.distplot(df.EstimatedSalary, color=\"blue\", label=\"Estimated Salary\")\nplt.legend();","3a30192f":"df.drop('RowNumber', axis = 1, inplace = True)\ndf.drop('CustomerId', axis = 1, inplace = True)\ndf.drop('Surname', axis = 1, inplace = True)","7e197ab4":"df.Geography.unique()","8e614973":"df_geo = pd.get_dummies(df['Geography'], columns= df.Geography[0], dtype= 'int64')\ndf_gender = pd.get_dummies(df['Gender'], columns= df.Gender[0], dtype= 'int64')","1f79b7bd":"df = df.join(df_geo)\ndf = df.join(df_gender)","e7a9dba9":"df.drop('Geography', axis = 1, inplace = True)\ndf.drop('Gender', axis = 1, inplace = True)","838132cd":"df[\"Balance\"] = df[\"Balance\"].replace(0, np.nan)","1154ac94":"from sklearn.experimental import enable_iterative_imputer\nfrom sklearn.impute import IterativeImputer\nfrom sklearn.neighbors import KNeighborsRegressor","3eff3bc7":"df.info()","b5491369":"imp = IterativeImputer(KNeighborsRegressor(n_neighbors=5, weights='distance', algorithm='kd_tree'))","94cb84f8":"df = imp.fit_transform(df)","f9909196":"df = pd.DataFrame(data=imp.transform(df), \n                             columns=['CreditScore', 'Age', 'Tenure', 'Balance', 'NumOfProducts', 'HasCrCard',\n                                      'IsActiveMember', 'EstimatedSalary', 'Exited', 'France', 'Germany', \n                                      'Spain', 'Female', 'Male'])","3c486095":"fig = plt.figure(figsize=(8,8))\nsns.distplot(df.Balance, color=\"red\", label=\"Balance\")\nplt.legend();","a8243833":"from sklearn.preprocessing import MinMaxScaler","fa5e3510":"scaler = MinMaxScaler()","01764d95":"columns = ['CreditScore', 'Balance', 'EstimatedSalary']\nfor col in columns:\n    column = scaler.fit_transform(df[col].values.reshape(-1, 1))\n    df[col] = pd.DataFrame(data=column, columns=[col])","df3032dd":"exited_df = df['Exited']\ndf.drop('Exited', axis = 1, inplace = True)\ndf = df.join(exited_df)","4d0c21ab":"plt.figure(figsize=(20,20))\nsns.heatmap(df.corr(), annot=True)","51b8a2ad":"from sklearn.model_selection import train_test_split\n\nX = df.iloc[:, :-1]\ny = df.iloc[:, -1].astype('float')\n\nX_train, X_val, y_train, y_val = train_test_split(X, y, test_size = 0.3, random_state=42)\nlen(y_train), len(y_val)","c9839b15":"from sklearn.metrics import accuracy_score\nfrom sklearn.ensemble import RandomForestClassifier\n\nmodel = RandomForestClassifier()\n\n# fit the data\nmodel.fit(X_train, y_train)\n\n# Get predictions\ny_preds = model.predict(X_val)\n\n# Get score\naccuracy_score(y_preds, y_val)","6fca8e9d":"from sklearn.decomposition import PCA\n\npca = PCA()\n\npca.fit(df)","9ef94aaf":"pca.explained_variance_ratio_","747c9c0c":"plt.figure(figsize = (8,8))\nplt.plot(range(1,15), pca.explained_variance_ratio_.cumsum(), marker= 'o', linestyle= '--')\nplt.title('Explained Variance by Component')\nplt.xlabel('Number of Component')\nplt.ylabel('Cumulative Explained Variance')","8069bb21":"pca = PCA(n_components=2)\n\nprincipalComponents = pca.fit_transform(df)\n\nprincipalDf = pd.DataFrame(data = principalComponents\n             , columns = ['principal component 1', 'principal component 2'])","0a7066ec":"from sklearn.cluster import KMeans\nwccs = []\nfor i in range (1, 15):\n    kmeans_pca = KMeans(n_clusters=i, init= 'k-means++', random_state = 42)\n    kmeans_pca.fit(principalDf)\n    wccs.append(kmeans_pca.inertia_)","76084f1c":"plt.figure(figsize = (8,8))\nplt.plot(range(1,15), wccs, marker= 'o', linestyle= '--')\nplt.xlabel('Number of Clusters')\nplt.ylabel('WCSS')\nplt.title('K-Means with PCA')\nplt.show()","5c66dd20":"kmeans_pca = KMeans(n_clusters= 2, init = 'k-means++', random_state=42)\nkmeans_pca.fit(principalDf)","702a993d":"principalDf['KmeansPredict'] = kmeans_pca.labels_\nprincipalDf","54a563da":"x_axis = principalDf['principal component 1']\ny_axis = principalDf['principal component 2']\nplt.figure(figsize= (8,8))\nsns.scatterplot(x_axis, y_axis, hue= principalDf['KmeansPredict'], palette=['r', 'b'])\nplt.show()","4bc47316":"x_axis = principalDf['principal component 1']\ny_axis = principalDf['principal component 2']\nplt.figure(figsize= (8,8))\nsns.scatterplot(x_axis, y_axis, hue= df['Exited'], palette=['r', 'b'])\nplt.show()","c45cd7c1":"import tensorflow as tf\nfrom tensorflow import keras\nfrom tensorflow.keras.layers import Dense\nfrom tensorflow.keras import Sequential","a263cd9c":"model = Sequential()\nmodel.add(Dense(13, input_dim=13, kernel_initializer='orthogonal', activation='softplus'))\nmodel.add(Dense(8, kernel_initializer='orthogonal', activation='softplus'))\nmodel.add(Dense(4, kernel_initializer='orthogonal', activation='softplus'))\nmodel.add(Dense(1, kernel_initializer='orthogonal', activation='sigmoid'))\n\nmodel.compile(optimizer='adam', loss='binary_crossentropy', metrics=['accuracy'])","4152e808":"model.fit(X_train, y_train, epochs=250, batch_size= 200)","8ff419b8":"y_preds = model.predict(X_val)\ny_preds = y_preds > 0.5","04afcbc9":"accuracy_score(y_preds, y_val)","6c31e7da":"# Visualizations","ba1eef66":"**PCA with K-Means comparison**","74fa86bf":"**Drop unnecessary columns for training**","3a32edef":"# Meaning of terms\n* **CreditScore:** It is a scoring system created by looking at a person's credit history and various risk factors. This scoring system is the first criterion that banks check in your loan application and is the most important criterion in terms of loan evaluation. For a score with a range between 300-850.\n* **Tenure:** How long you can expect them to remain a customer. Tenure = 1\/Churn\n* **Balance:** The amount in the account.\n* **EstimatedSalary:** The customer's estimated salary.","577390ef":"# Random Forest Classification","6788e53a":"**The reason for using orthogonal is to increase the speed of training data by increasing the number of batch.**","7444b447":"## Future Editing","027e3651":"**One-hot-encoding Gender and Geography**","6d224355":"**Since there is a \"Balance\" value of more than three thousand 0 values, these values are arranged to be a normal distribution.**","da233f7f":"**Only three country**","5917fa58":"**Decide how many features we\u2019d like to keep based on the cumulative variance plot.**","f44817a4":"# NN Model","2402c47a":"**Distributions**","3ae0c220":"**Age feature enhancement**","cbf69abe":"**Correlation matrix after feature editing**","0d241aa1":"# PCA with K-Means","47709420":"**Decide how many clustering solutions will test.**","9930a548":"**The iterative imputer normally uses bayes. However, it was preferred to use KNN for normal distribution.**","56970dc5":"# What is churn?\n\nChurn refers to the ratio of the number of customers you lost in a given period to the total number of customers. For example, if you have 1000 customers and 10 of your customers canceled their subscription that month, your churn speed corresponds to 10\/1000, or 1%.\n\nWhile you initially get 100 customers each month, if the churn rate is 10%, your customer count continues to increase. But if this ratio is still 10% at the point where you reach 1000 customers, then you are losing 100 customers every month. 100 new customers every month become insufficient for your growth.\n\nThe action to be taken at this point is to identify the reasons for losing customers. Churn may either be due to poor quality service, or a competitor may have started selling the same service on more attractive subscription terms.","33e52a73":"![Churn](https:\/\/www.subscreasy.com\/wp-content\/uploads\/2018\/07\/Abonelikte-Churn-Nedir-Neden-Onemlidir.png)"}}