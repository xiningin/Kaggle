{"cell_type":{"a8c79b4a":"code","74a9eb40":"code","d6a41469":"code","30c1636a":"code","eae6eafa":"code","cf490840":"code","90b23475":"code","5456fe54":"code","1b60afe2":"code","94e03b2c":"code","6125863d":"code","6018b3bf":"markdown","078b7837":"markdown","87e22c53":"markdown"},"source":{"a8c79b4a":"# Imports\nimport numpy as np\nimport pandas as pd\nfrom datetime import date, timedelta\nimport geopandas as gpd\nfrom geopandas.tools import geocode\nimport folium\nfrom folium import Marker, Circle, Choropleth\nfrom folium.plugins import MarkerCluster, HeatMap\nimport math\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport os\n#import io\n#import csv\nimport requests\n#import zipfile\n\n# Population Data\npopulationData = pd.read_csv('\/kaggle\/input\/2019-census-us-population-data-by-state\/2019_Census_US_Population_Data_By_State_Lat_Long.csv')\n\n# Get the most recent date for filtering\nfreshDate = date.today() - timedelta(days=1)\nfreshDate = date.strftime(freshDate,\"%Y%m%d\")\nfreshDate = freshDate[0:4] + \"-\" + freshDate[4:6] + \"-\" + freshDate[6:8]\n\n# Vaccination data, for most recent date\nvaccinationData = pd.read_csv('https:\/\/raw.githubusercontent.com\/owid\/covid-19-data\/master\/public\/data\/vaccinations\/us_state_vaccinations.csv')\nvaccinationByLocation = vaccinationData.loc[(vaccinationData.date == freshDate)][[\"location\", \"people_vaccinated\"]]\n\n# Vaccination and population data\nvaccinationAndPopulationByLocation = pd.merge(populationData, vaccinationByLocation, left_on='STATE',right_on='location').drop(columns=\"location\")\n\n# Calculate percentage vaccinated by state\nvaccinationAndPopulationByLocation[\"percent_vaccinated\"] = vaccinationAndPopulationByLocation[\"people_vaccinated\"] \/ vaccinationAndPopulationByLocation[\"POPESTIMATE2019\"]\n\nvaccinationAndPopulationByLocation.head()","74a9eb40":"# Calculate the total percent vaccinated in the US\npercentageTotal = vaccinationAndPopulationByLocation[\"people_vaccinated\"].sum() \/ vaccinationAndPopulationByLocation[\"POPESTIMATE2019\"].sum()\nprint('Percentage Vaccinated in the US: {}%'.format(round(percentageTotal*100, 2))) ","d6a41469":"# Create the map\nv_map = folium.Map(location=[42.32,-71.0589], tiles='cartodbpositron', zoom_start=4) \n\n# Add points to the map\nmc = MarkerCluster()\nfor idx, row in vaccinationAndPopulationByLocation.iterrows(): \n    if not math.isnan(row['long']) and not math.isnan(row['lat']):\n        mc.add_child(Marker(location=[row['lat'], row['long']],\n                            tooltip=str(round(row['percent_vaccinated']*100, 2))+\"%\"))\nv_map.add_child(mc)\n\n# Display the map\nv_map","30c1636a":"vaccinationAndPopulationByLocation.percent_vaccinated.describe()","eae6eafa":"# create Bubble Maps by using circles instead of markers\nc_map = folium.Map(location=[42.32,-71.0589], tiles='cartodbpositron', zoom_start=3)\n\ndef color_producer(val):\n    if val <= 0.09: # region start vaccine with 9%\n        return 'red'\n    if val > 0.09 and val <= (0.096):  #region start vaccine between 9% up to 9.6%\n        return 'orange'\n    if val > (0.096) and val <= (0.1): #region start vaccine between 9.6% p to 10%\n        return 'yellow'\n    if val > (0.1) and val < (0.14): #region start vaccine between 10% p to 14%\n        return 'blue'\n    else:\n        return 'green'\n\n#Add a bubble map to the base map\nfor i in range(0, len(vaccinationAndPopulationByLocation)):\n    Circle(\n        location = [vaccinationAndPopulationByLocation.iloc[i]['lat'], vaccinationAndPopulationByLocation.iloc[i]['long']],\n        radius = 20,\n        color = color_producer(vaccinationAndPopulationByLocation.iloc[i]['percent_vaccinated'])).add_to(c_map)\n\n#Display the map                             \nc_map","cf490840":"# create Heatmap to show the denisty of vaccina in different areas\nh_map = folium.Map(location=[42.32,-71.0589], tiles='cartodbpositron', zoom_start=4)\n\n# Add a heatmap to the base map\nHeatMap(data = vaccinationAndPopulationByLocation[['lat', 'long']], radius = 25).add_to(h_map)\n\n# Display the map\nh_map","90b23475":"# GeoDataFrame with geographical boundaries of USA districts \nUS_districts = gpd.read_file('..\/input\/us-states-cartographic-boundary-shapefiles\/cb_2016_us_state_500k.shp')\nUS_districts.head()","5456fe54":"districts = US_districts[['NAME','geometry']].set_index('NAME')\ndistricts.head()","1b60afe2":"vaccinationData.head()","94e03b2c":"# Number of vaccination status in each district\nvaccinationData_2 = vaccinationData.rename(columns = {'location' : 'NAME'})\nplot_dict = vaccinationData_2.NAME.value_counts()\nplot_dict.head()","6125863d":"# create Choropleth map to show the denisty of vaccina in different areas\nchoropleth_map = folium.Map(location=[42.32,-71.0589], tiles='cartodbpositron', zoom_start=3)\n\n# Add a Choropleth map to the base map\nChoropleth( geo_data = districts.__geo_interface__,\n           data = plot_dict,\n           key_on = 'feature.id',\n           fill_color = 'YlGnBu',\n           legend_name = 'USA People Vaccinated',\n          ).add_to(choropleth_map)\n\n# Display to map\nchoropleth_map ","6018b3bf":"The next code cell uses the data to create a tracker, with one marker for each state.  You can click on the markers to see the percentage of the population that has been vaccinated.","078b7837":"# Introduction\n\nIt can be a troubling time, but we do have hope on the horizon, with the news we get daily about vaccines. Multiple companies are releasing and getting their vaccines approved; we may  soon see a path forward. \n\nUsing the robust toolset provided by Kaggle, I'll show you how to create an interactive map to track, for each state, the percentage of inhabitants that have been vaccinated against COVID-19.  \n\nTo get started, if you haven't already, make your own copy of this notebook by clicking on the **[Copy and Edit]** button in the top right corner. \n\nThis notebook is an example of a project that you can create based on what you'd learn from taking Kaggle's [Geospatial Analysis course](https:\/\/www.kaggle.com\/learn\/geospatial-analysis).\n\n# US Vaccine Tracker\n\nWe'll use two datasets.  \n\n- The first dataset has the total number of inhabitants of each state, along with latitude and longitude data for each state's capital city.  This dataset is pulled from the 2019 US Census, and I've uploaded it [here](https:\/\/www.kaggle.com\/peretzcohen\/2019-census-us-population-data-by-state).\n- The second dataset contains a recent estimate for the total number of people that have been vaccinated in each state.  This [vaccine dataset](https:\/\/github.com\/owid\/covid-19-data\/blob\/master\/public\/data\/vaccinations\/us_state_vaccinations.csv) is drawn from [Our World In Data](https:\/\/ourworldindata.org\/), who update their vaccine datasets from the CDC quite regularly.  Every time you run this notebook, you'll use the most recent version of their data.\n\nIn the next code cell, we load and preprocess the data.  As output, you'll see the total percent of the population that has been vaccinated in the US, along with a preview of the Pandas DataFrame that we'll use to make the tracker.","87e22c53":"# Your turn\n\nHere are some ideas for how you might improve on the work here:\n- In Kaggle's [Geospatial Analysis course](https:\/\/www.kaggle.com\/learn\/geospatial-analysis), you learn how to use folium to create many different types of interactive maps.  How might you use this data to instead create a choropleth map?\n- In case you would like to work with more data sources,\n  - The Centers for Disease Control and Prevention (CDC) in the US releases daily vaccine data and has a vaccination progress tracker on its [COVID Data Tracker site](https:\/\/covid.cdc.gov\/covid-data-tracker\/#vaccinations).\n  - NBC News has a [vaccine tracker](https:\/\/www.nbcnews.com\/health\/health-news\/map-covid-19-vaccination-tracker-across-u-s-n1252085) as well which is quite well done.\n  \nOnce you have created your own extension of this work, let us know about it in the comments!"}}