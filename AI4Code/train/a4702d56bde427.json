{"cell_type":{"6f97f4b2":"code","16314d2e":"code","9fdcaca5":"code","86853973":"code","8fc06bf4":"code","7c79c688":"code","e3a4eb2c":"code","dd896b4f":"code","d50464ef":"code","5e54f25f":"code","32a358a0":"code","f67d8938":"code","a3b9148f":"code","27f08ff0":"code","44a222ec":"code","5a5f3432":"code","e013cd51":"code","27ed92ee":"code","eb9a7324":"code","874f76ca":"code","3cf0afb6":"code","e4c84630":"code","9da19274":"code","eb5bae53":"code","35185201":"code","9c8f371c":"code","2dcebbd3":"code","3d327860":"code","53cd9e0a":"code","54add223":"code","f8d2710d":"code","ef0e578d":"code","3b9e21cf":"code","a8b4f8af":"code","1ba56c5d":"code","5e77fcf0":"code","d7a898a8":"code","31f7c22f":"code","9bcbed2e":"code","7a541e2e":"code","05019ea1":"code","51b6ce5a":"code","32ac0bb4":"code","4760bc07":"code","d6f43035":"code","a52ef80b":"code","f61f9f84":"code","81ba7b8a":"code","c4cc66bb":"code","13f2307e":"code","c8119b48":"code","2a2a716d":"code","a5158a38":"code","32349985":"code","67b445fd":"code","67f8ba29":"code","731e6916":"code","8df15cef":"code","3c1cff67":"markdown","bb5110c2":"markdown","8c406779":"markdown","977b707b":"markdown","4179240f":"markdown","021dcfca":"markdown","d205e925":"markdown","d478b2ef":"markdown","16715cb3":"markdown","368eb2b5":"markdown","20d0b7dd":"markdown","b5a2ed01":"markdown","bcc878ec":"markdown","e65fa391":"markdown","62740dfb":"markdown","8954ae6e":"markdown","f4b14fc3":"markdown","9e1104ad":"markdown","5a99f9ba":"markdown","0b81e0ea":"markdown","35a3cda7":"markdown","3221a971":"markdown","700acfa0":"markdown","59b6cf6f":"markdown","e75d6d0f":"markdown","fbb98ff0":"markdown","ad0674ae":"markdown","5297c5ee":"markdown","9e69d22d":"markdown","06041619":"markdown","d8e995f1":"markdown","ab0ac93e":"markdown","f5fff307":"markdown","9147e141":"markdown"},"source":{"6f97f4b2":"import numpy as np\nimport pandas as pd \nimport plotly.express as px\nfrom wordcloud import WordCloud, STOPWORDS\nimport matplotlib.pyplot as plt\nfrom sklearn.feature_extraction.text import TfidfVectorizer\nfrom sklearn.cluster import KMeans\nfrom iso3166 import countries\nimport plotly.graph_objs as go\nfrom plotly.offline import init_notebook_mode, iplot","16314d2e":"df = pd.read_csv(\"\/kaggle\/input\/covid19-tweets\/covid19_tweets.csv\")","9fdcaca5":"df.head()","86853973":"df.info()","8fc06bf4":"missed = pd.DataFrame()\nmissed['column'] = df.columns\n\nmissed['percent'] = [round(100* df[col].isnull().sum() \/ len(df), 2) for col in df.columns]\nmissed = missed.sort_values('percent')\nmissed = missed[missed['percent']>0]\n\nfig = px.bar(\n    missed, \n    x='percent', \n    y=\"column\", \n    orientation='h', \n    title='Missed values percent for every column (percent > 0)', \n    height=400, \n    width=600\n)\n\nfig.show()","7c79c688":"ds = df['user_name'].value_counts().reset_index()\nds.columns = ['user_name', 'tweets_count']\nds = ds.sort_values(['tweets_count'])\n\nfig = px.bar(\n    ds.tail(40), \n    x=\"tweets_count\", \n    y=\"user_name\", \n    orientation='h', \n    title='Top 40 users by number of tweets', \n    width=800, \n    height=800\n)\n\nfig.show()","e3a4eb2c":"df = pd.merge(df, ds, on='user_name')","dd896b4f":"data = df.sort_values('user_followers', ascending=False)\ndata = data.drop_duplicates(subset='user_name', keep=\"first\")\ndata = data[['user_name', 'user_followers', 'tweets_count']]\ndata = data.sort_values('user_followers')\n\nfig = px.bar(\n    data.tail(40), \n    x=\"user_followers\", \n    y=\"user_name\", \n    color='tweets_count',\n    orientation='h', \n    title='Top 40 users by number of followers', \n    width=800, \n    height=800\n)\n\nfig.show()","d50464ef":"data = df.sort_values('user_friends', ascending=False)\ndata = data.drop_duplicates(subset='user_name', keep=\"first\")\ndata = data[['user_name', 'user_friends', 'tweets_count']]\ndata = data.sort_values('user_friends')\n\nfig = px.bar(\n    data.tail(40), \n    x=\"user_friends\", \n    y=\"user_name\", \n    color = 'tweets_count',\n    orientation='h', \n    title='Top 40 users by number of friends', \n    width=800, \n    height=800\n)\n\nfig.show()","5e54f25f":"df['user_created'] = pd.to_datetime(df['user_created'])\ndf['year_created'] = df['user_created'].dt.year\ndata = df.drop_duplicates(subset='user_name', keep=\"first\")\ndata = data[data['year_created']>1970]\ndata = data['year_created'].value_counts().reset_index()\ndata.columns = ['year', 'number']\n\nfig = px.bar(\n    data, \n    x=\"year\", \n    y=\"number\", \n    orientation='v', \n    title='User created year by year', \n    width=800, \n    height=600\n)\n\nfig.show()","32a358a0":"df.head(10)","f67d8938":"ds = df['user_location'].value_counts().reset_index()\nds.columns = ['user_location', 'count']\nds = ds[ds['user_location']!='NA']\nds = ds.sort_values(['count'])\n\nfig = px.bar(\n    ds.tail(40), \n    x=\"count\", \n    y=\"user_location\", \n    orientation='h', title='Top 40 user locations by number of tweets', \n    width=800, \n    height=800\n)\n\nfig.show()","a3b9148f":"def pie_count(data, field, percent_limit, title):\n    \n    data[field] = data[field].fillna('NA')\n    data = data[field].value_counts().to_frame()\n\n    total = data[field].sum()\n    data['percentage'] = 100 * data[field]\/total    \n\n    percent_limit = percent_limit\n    otherdata = data[data['percentage'] < percent_limit] \n    others = otherdata['percentage'].sum()  \n    maindata = data[data['percentage'] >= percent_limit]\n\n    data = maindata\n    other_label = \"Others(<\" + str(percent_limit) + \"% each)\"\n    data.loc[other_label] = pd.Series({field:otherdata[field].sum()}) \n    \n    labels = data.index.tolist()   \n    datavals = data[field].tolist()\n    \n    trace=go.Pie(labels=labels,values=datavals)\n\n    layout = go.Layout(\n        title = title,\n        height=600,\n        width=600\n        )\n    \n    fig = go.Figure(data=[trace], layout=layout)\n    iplot(fig)\n    \npie_count(df, 'user_location', 0.5, 'Number of tweets per location')","27f08ff0":"ds = df['source'].value_counts().reset_index()\nds.columns = ['source', 'count']\nds = ds.sort_values(['count'])\n\nfig = px.bar(\n    ds.tail(40), \n    x=\"count\", \n    y=\"source\", \n    orientation='h', \n    title='Top 40 user sources by number of tweets', \n    width=800, \n    height=800\n)\n\nfig.show()","44a222ec":"df['hashtags'] = df['hashtags'].fillna('[]')\ndf['hashtags_count'] = df['hashtags'].apply(lambda x: len(x.split(',')))\ndf.loc[df['hashtags'] == '[]', 'hashtags_count'] = 0\n\ndf.head(10)","5a5f3432":"df['hashtags_count'].describe()","e013cd51":"fig = px.scatter(\n    df, \n    x=df['hashtags_count'], \n    y=df['tweets_count'], \n    height=700,\n    width=700,\n    title='Total number of tweets for users and number of hashtags in every tweet'\n)\n\nfig.show()","27ed92ee":"ds = df['hashtags_count'].value_counts().reset_index()\nds.columns = ['hashtags_count', 'count']\nds = ds.sort_values(['count'])\nds['hashtags_count'] = ds['hashtags_count'].astype(str) + ' tags'\n\nfig = px.bar(\n    ds, \n    x=\"count\", \n    y=\"hashtags_count\", \n    orientation='h', \n    title='Distribution of number of hashtags in tweets', \n    width=800, \n    height=600\n)\n\nfig.show()","eb9a7324":"ds = df[df['tweets_count']>10]\nds = ds.groupby(['user_name', 'tweets_count'])['hashtags_count'].mean().reset_index()\nds.columns = ['user', 'tweets_count', 'mean_count']\nds = ds.sort_values(['mean_count'])\n\nfig = px.bar(\n    ds.tail(40), \n    x=\"mean_count\", \n    y=\"user\", \n    color='tweets_count',\n    orientation='h', \n    title='Top 40 users with higher mean number of hashtags (at least 10 tweets per user)', \n    width=800, \n    height=800\n)\n\nfig.show()","874f76ca":"df['date'] = pd.to_datetime(df['date']) \ndf = df.sort_values(['date'])\ndf['day'] = df['date'].astype(str).str.split(' ', expand=True)[0]\ndf['time'] = df['date'].astype(str).str.split(' ', expand=True)[1]\ndf.head()","3cf0afb6":"ds = df.groupby(['day', 'user_name'])['hashtags_count'].count().reset_index()\nds = ds.groupby(['day'])['user_name'].count().reset_index()\nds.columns = ['day', 'number_of_users']\nds['day'] = ds['day'].astype(str) + ':00:00:00'\nfig = px.bar(\n    ds, \n    x='day', \n    y=\"number_of_users\", \n    orientation='v',\n    title='Number of unique users per day', \n    width=800, \n    height=800\n)\nfig.show()","e4c84630":"ds = df['day'].value_counts().reset_index()\nds.columns = ['day', 'count']\nds = ds.sort_values('count')\nds['day'] = ds['day'].astype(str) + ':00:00:00'\nfig = px.bar(\n    ds, \n    x='count', \n    y=\"day\", \n    orientation='h',\n    title='Tweets distribution over days present in dataset', \n    width=800, \n    height=800\n)\nfig.show()","9da19274":"df['hour'] = df['date'].dt.hour\nds = df['hour'].value_counts().reset_index()\nds.columns = ['hour', 'count']\nds['hour'] = 'Hour ' + ds['hour'].astype(str)\nfig = px.bar(\n    ds, \n    x=\"hour\", \n    y=\"count\", \n    orientation='v', \n    title='Tweets distribution over hours', \n    width=800\n)\nfig.show()","eb5bae53":"def split_hashtags(x): \n    return str(x).replace('[', '').replace(']', '').split(',')\n\ntweets_df = df.copy()\ntweets_df['hashtag'] = tweets_df['hashtags'].apply(lambda row : split_hashtags(row))\ntweets_df = tweets_df.explode('hashtag')\ntweets_df['hashtag'] = tweets_df['hashtag'].astype(str).str.lower().str.replace(\"'\", '').str.replace(\" \", '')\ntweets_df.loc[tweets_df['hashtag']=='', 'hashtag'] = 'NO HASHTAG'\ntweets_df","35185201":"ds = tweets_df['hashtag'].value_counts().reset_index()\nds.columns = ['hashtag', 'count']\nds = ds.sort_values(['count'])\nfig = px.bar(\n    ds.tail(20), \n    x=\"count\", \n    y='hashtag', \n    orientation='h', \n    title='Top 20 hashtags', \n    width=800, \n    height=700\n)\nfig.show()","9c8f371c":"df['tweet_length'] = df['text'].str.len()","2dcebbd3":"fig = px.histogram(\n    df, \n    x=\"tweet_length\", \n    nbins=80, \n    title='Tweet length distribution', \n    width=800,\n    height=700\n)\nfig.show()","3d327860":"ds = df[df['tweets_count']>=10]\nds = ds.groupby(['user_name', 'tweets_count'])['tweet_length'].mean().reset_index()\nds.columns = ['user_name', 'tweets_count', 'mean_length']\nds = ds.sort_values(['mean_length'])\nfig = px.bar(\n    ds.tail(40), \n    x=\"mean_length\", \n    y=\"user_name\", \n    color='tweets_count',\n    orientation='h', \n    title='Top 40 users with the longest average length of tweet (at least 10 tweets)', \n    width=800, \n    height=800\n)\nfig.show()","53cd9e0a":"ds = df[df['tweets_count']>=10]\nds = ds.groupby(['user_name', 'tweets_count'])['tweet_length'].mean().reset_index()\nds.columns = ['user_name', 'tweets_count', 'mean_length']\nds = ds.sort_values(['mean_length'])\nfig = px.bar(\n    ds.head(40), \n    x=\"mean_length\", \n    y=\"user_name\", \n    color='tweets_count',\n    orientation='h', \n    title='Top 40 users with the shortest average length of tweet (at least 10 tweets)', \n    width=800, \n    height=800\n)\nfig.show()","54add223":"def build_wordcloud(df, title):\n    wordcloud = WordCloud(\n        background_color='gray', \n        stopwords=set(STOPWORDS), \n        max_words=50, \n        max_font_size=40, \n        random_state=666\n    ).generate(str(df))\n\n    fig = plt.figure(1, figsize=(14,14))\n    plt.axis('off')\n    fig.suptitle(title, fontsize=16)\n    fig.subplots_adjust(top=2.3)\n\n    plt.imshow(wordcloud)\n    plt.show()","f8d2710d":"build_wordcloud(df['text'], 'Prevalent words in tweets for all dataset')","ef0e578d":"test_df = df[df['user_name']=='GlobalPandemic.NET']\nbuild_wordcloud(test_df['text'], 'Prevalent words in tweets for GlobalPandemic.NET')","3b9e21cf":"test_df = df[df['user_name']=='covidnews.ch']\nbuild_wordcloud(test_df['text'], 'Prevalent words in tweets for covidnews.ch')","a8b4f8af":"test_df = df[df['user_name']=='Open Letters']\nbuild_wordcloud(test_df['text'], 'Prevalent words in tweets for Open Letters')","1ba56c5d":"test_df = df[df['user_name']=='Hindustan Times']\nbuild_wordcloud(test_df['text'], 'Prevalent words in tweets for Hindustan Times')","5e77fcf0":"test_df = df[df['user_name']=='Blood Donors India']\nbuild_wordcloud(test_df['text'], 'Prevalent words in tweets for Blood Donors India')","d7a898a8":"build_wordcloud(df['user_description'], 'Prevalent words in tweets for Blood Donors India')","31f7c22f":"vec = TfidfVectorizer(stop_words=\"english\")\nvec.fit(df['text'].values)\nfeatures = vec.transform(df['text'].values)","9bcbed2e":"kmeans = KMeans(n_clusters=2, random_state=0)\nkmeans.fit(features)","7a541e2e":"res = kmeans.predict(features)\ndf['Cluster'] = res\ndf","05019ea1":"df[df['Cluster'] == 0].head(20)['text'].tolist()","51b6ce5a":"df[df['Cluster'] == 1].head(20)['text'].tolist()","32ac0bb4":"print('Number of samples for class 0: ', len(df[df['Cluster'] == 0]))\nprint('Number of samples for class 1: ', len(df[df['Cluster'] == 1]))","4760bc07":"build_wordcloud(df[df['Cluster'] == 0]['text'], 'Wordcloud for cluster 0')","d6f43035":"build_wordcloud(df[df['Cluster'] == 1]['text'], 'Wordcloud for cluster 1')","a52ef80b":"kmeans = KMeans(n_clusters=5, random_state=0)\nkmeans.fit(features)","f61f9f84":"res = kmeans.predict(features)\ndf['Cluster5'] = res\ndf","81ba7b8a":"for i in range(5):\n    print('Number of samples for class ' + str(i) + ': ', len(df[df['Cluster5'] == i]))","c4cc66bb":"build_wordcloud(df[df['Cluster5'] == 0]['text'], 'Wordcloud for cluster 0')","13f2307e":"build_wordcloud(df[df['Cluster5'] == 1]['text'], 'Wordcloud for cluster 1')","c8119b48":"build_wordcloud(df[df['Cluster5'] == 2]['text'], 'Wordcloud for cluster 2')","2a2a716d":"build_wordcloud(df[df['Cluster5'] == 3]['text'], 'Wordcloud for cluster 3')","a5158a38":"build_wordcloud(df[df['Cluster5'] == 4]['text'], 'Wordcloud for cluster 4')","32349985":"df['location'] = df['user_location'].str.split(',', expand=True)[1].str.lstrip().str.rstrip()\nres = df.groupby(['day', 'location'])['text'].count().reset_index()","67b445fd":"country_dict = {}\nfor c in countries:\n    country_dict[c.name] = c.alpha3\n    \nres['alpha3'] = res['location']\nres = res.replace({\"alpha3\": country_dict})\n\ncountry_list = ['England', 'United States', 'United Kingdom', 'London', 'UK']\n\nres = res[\n    (res['alpha3'] == 'USA') | \n    (res['location'].isin(country_list)) | \n    (res['location'] != res['alpha3'])\n]\n\ngbr = ['England', 'UK', 'London', 'United Kingdom']\nus = ['United States', 'NY', 'CA', 'GA']\n\nres = res[res['location'].notnull()]\nres.loc[res['location'].isin(gbr), 'alpha3'] = 'GBR'\nres.loc[res['location'].isin(us), 'alpha3'] = 'USA'\nres.loc[res['alpha3'] == 'USA', 'location'] = 'USA'\nres.loc[res['alpha3'] == 'GBR', 'location'] = 'United Kingdom'\nplot = res.groupby(['day', 'location', 'alpha3'])['text'].sum().reset_index()\nplot","67f8ba29":"fig = px.choropleth(\n    plot, \n    locations=\"alpha3\",\n    hover_name='location',\n    color=\"text\",\n    animation_frame='day',\n    projection=\"natural earth\",\n    color_continuous_scale=px.colors.sequential.Plasma,\n    title='Tweets from different countries for every day',\n    width=800, \n    height=600\n)\nfig.show()","731e6916":"res = df.groupby(['day', 'location', 'user_name'])['text'].count().reset_index()\nres = res[['day', 'location', 'user_name']]\nres['alpha3'] = res['location']\nres = res.replace({\"alpha3\": country_dict})\n\ncountry_list = ['England', 'United States', 'United Kingdom', 'London', 'UK']\n\nres = res[\n    (res['alpha3'] == 'USA') | \n    (res['location'].isin(country_list)) | \n    (res['location'] != res['alpha3'])\n]\n\ngbr = ['England', 'UK', 'London', 'United Kingdom']\nus = ['United States', 'NY', 'CA', 'GA']\n\nres = res[res['location'].notnull()]\nres.loc[res['location'].isin(gbr), 'alpha3'] = 'GBR'\nres.loc[res['location'].isin(us), 'alpha3'] = 'USA'\nres.loc[res['alpha3'] == 'USA', 'location'] = 'USA'\nres.loc[res['alpha3'] == 'GBR', 'location'] = 'United Kingdom'\nplot = res.groupby(['day', 'location', 'alpha3'])['user_name'].count().reset_index()","8df15cef":"fig = px.choropleth(\n    plot, \n    locations=\"alpha3\",\n    hover_name='location',\n    color=\"user_name\",\n    animation_frame='day',\n    projection=\"natural earth\",\n    color_continuous_scale=px.colors.sequential.Plasma,\n    title='Numbers of active users for every day',\n    width=800, \n    height=600\n)\nfig.show()","3c1cff67":"### Just split day and time into separate columns","bb5110c2":"Now it's time to check last one categorical feature - `source`. Lets see top 40 sources by the number of tweets.","8c406779":"### Lets do the same but for hours","977b707b":"<a id=\"1\"><\/a>\n<h2 style='background:green; border:0; color:white'><center>1. Dataset Quick Overview<\/center><h2>","4179240f":"And also we can see the pie plot for the full picture about users locations.","021dcfca":"<h1><center>Covid19 tweets. EDA. Visualization. Insides.<\/center><\/h1>\n\n<center><img src=\"https:\/\/ichef.bbci.co.uk\/news\/1024\/cpsprodpb\/031C\/production\/_112869700_gettyimages-1209519827-1.jpg\"><\/center>","d205e925":"As we can see from chart coronavirus increases the number of new twitter users.","d478b2ef":"Distribution of new feature over the number of tweets is expected - a lot of tweets with few number of hashtags and few tweets with huge number of hashtags.","16715cb3":"<a id=\"4\"><\/a>\n<h2 style='background:green; border:0; color:white'><center>Tweets text analysis<\/center><h2>\n\n### Here we are going to check the `text` feature of the dataset.\n### Lets see general wordcloud for this column.","368eb2b5":"Now we will see top 40 users that like to use hashtags a little bit more than others. ","20d0b7dd":"<a id=\"5\"><\/a>\n<h2 style='background:green; border:0; color:white'><center>Simple sentiment analysis<\/center><h2>\n\n### Lets do simple version of sentiment analysis. We just use Tfidf Vectorizer to get features and use Kmeans clustering algotithm to split data into 2 clusters.","b5a2ed01":"### Let's check more clusters for example 5.","bcc878ec":"### Lets see world clouds for top 5 users.","e65fa391":"Lets create new feature - `hashtags_count` that will show us how many hashtags in the current tweet.","62740dfb":"### Now we are going to calculate the length for every tweet in dataset.","8954ae6e":"### And show top 20 hashtags on tweets.","f4b14fc3":"Let's see percent of NaNs for every column. We will visualize only columns with at least 1 missed value.","9e1104ad":"### Hello everyone! Here I am going to present some basic analysis of this dataset. We will create some plots based on existing features, do starting sentiment analysis (based on clustering). Also we will create world  map animation and prepare a lot of other interesting things! Let's start!\n\n<a id=\"top\"><\/a>\n\n<div class=\"list-group\" id=\"list-tab\" role=\"tablist\">\n<h3 class=\"list-group-item list-group-item-action active\" data-toggle=\"list\" style='background:green; border:0' role=\"tab\" aria-controls=\"home\"><center>Quick navigation<\/center><\/h3>\n\n* [1. Dataset Quick Overview](#1)\n* [2. Data Visualization](#2)\n* [3. Additional features analysis](#3)\n* [4. Tweets text analysis](#4)\n* [5. Simple sentiment analysis](#5)\n* [6. Animation with geographical distribution of tweets](#6)\n\n\n#### If you are interested in Dynamic monitoring of the tweets, please check another one my kernel: https:\/\/www.kaggle.com\/isaienkov\/covid19-dynamic-in-time-and-space-of-the-tweets","5a99f9ba":"<a id=\"6\"><\/a>\n<h2 style='background:green; border:0; color:white'><center>Animation with geographical distribution of tweets<\/center><h2>","0b81e0ea":"Let's see top 40 users by number of tweets.","35a3cda7":"### Lets split hashtags into separate column.","3221a971":"<a id=\"2\"><\/a>\n<h2 style='background:green; border:0; color:white'><center>2. Data Visualization<\/center><\/h2>","700acfa0":"Let's see top 40 most popular locations by the number of tweets.","59b6cf6f":"### Let's also visualize WordCloud for user's description.","e75d6d0f":"Let's see most popular users.","fbb98ff0":"## So we can see that cluster 0 contains more or less positive tweets, but cluster 1 contains tweets with information about new cases, reports and regions.","ad0674ae":"Let's see how coronavirus affect to new users creation.","5297c5ee":"### Here I am going to show approach how to use plotly world map to demonstrate geographical distribution of tweets.","9e69d22d":"Let's do a first quick check of our dataset.","06041619":"And most friendly users.","d8e995f1":"### Number of unique users per day","ab0ac93e":"And see the values for new created column.","f5fff307":"<a id=\"3\"><\/a>\n<h2 style='background:green; border:0; color:white'><center>3. Additional features analysis<center><h2>","9147e141":"### Now we are going to check how many tweets were for every day in our dataset."}}