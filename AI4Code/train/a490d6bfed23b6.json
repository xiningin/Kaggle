{"cell_type":{"a63eae9d":"code","d89a4ce6":"code","6e8b1c91":"code","619efddd":"code","1ad20827":"code","ec13589d":"code","7600a79a":"code","a2c5f556":"code","ee3af736":"code","82c6b4da":"code","ff106863":"code","a1cd3b2f":"code","1556f72e":"code","06f4a510":"code","7f286c0f":"code","9b066075":"code","5d8cb3a3":"code","b6371b19":"code","b63e5734":"code","94d35da5":"code","a3f384c0":"code","2ebb5245":"code","8546ccbd":"code","9ac59f33":"code","ace07fda":"code","8d69b35b":"code","228371c9":"code","2b7003a2":"code","0bb3698e":"code","743b5f92":"code","6316da74":"code","f3ba39cc":"code","e15e6067":"code","26245b49":"code","5ad2ea78":"code","4ba44e2c":"code","16438ae8":"code","ab072a0d":"code","c77eef70":"code","acfa253b":"code","7c21c510":"markdown","2534e0a6":"markdown","a8d2ba23":"markdown","53d86bb6":"markdown","75e72986":"markdown","980f02d7":"markdown","8733e5b8":"markdown","b84b8fad":"markdown","3f5ff3af":"markdown","517b362c":"markdown","ccea57a4":"markdown","8d0f239c":"markdown","de11eb48":"markdown","644049ff":"markdown","5eed1729":"markdown","6fa35db6":"markdown","33c47b4c":"markdown","3588ce2d":"markdown","d920576c":"markdown","9b4a6fb5":"markdown","59dff988":"markdown","e0d54563":"markdown","fb1cd406":"markdown","f1d80784":"markdown","0b9483d4":"markdown","0103c5f7":"markdown","e36188ad":"markdown","ed8bebbd":"markdown","9617fef4":"markdown","24ad9a82":"markdown","e170b81b":"markdown","3beffec1":"markdown","5250eee1":"markdown","3f0bc6c8":"markdown","a827e6d2":"markdown","fbfceb73":"markdown","ee93834c":"markdown","76eeee25":"markdown","819b218f":"markdown","b519fbc9":"markdown","2be91689":"markdown","f095cfe9":"markdown"},"source":{"a63eae9d":"%%javascript\n$.getScript('https:\/\/kmahelona.github.io\/ipython_notebook_goodies\/ipython_notebook_toc.js')","d89a4ce6":"import re\n\nimport numpy as np\nimport pandas as pd\n\npd.set_option('display.max_rows', 100)\npd.set_option('display.max_columns', None)\n\n\ndf = pd.read_csv('..\/input\/data-science-for-good\/2016 School Explorer.csv')\n\n# set index\ndf = df.set_index('Location Code')\ndf.index.name = 'DBN'\n\n# remove unused columns\ncolumns = [\n    'Adjusted Grade',   \n    'New?',\n    'Other Location Code in LCGMS',\n    'School Name',\n    'SED Code',\n    'Address (Full)',\n    'Rigorous Instruction Rating',\n    'Collaborative Teachers Rating',\n    'Supportive Environment Rating',\n    'Effective School Leadership Rating',\n    'Strong Family-Community Ties Rating',\n    'Trust Rating',\n    'Student Achievement Rating',\n    'District',\n    'City',\n    'Zip'\n]\ndf = df.drop(columns, axis=1)\n\n# split columns with amount of 4s\nresult_columns = [c for c in df.columns if re.match(r'Grade \\d.+', c)]\ndf4s = df[result_columns]\ndf = df.drop(result_columns, axis=1)\n\n# fix bad column name\ndf4s = df4s.rename(columns={\n    'Grade 3 Math - All Students tested': 'Grade 3 Math - All Students Tested'\n})\n\n# parse values\ndef parse_pct(x):\n    if isinstance(x, str) and x[-1] == '%':\n        return float(x[:-1]) \/ 100\n    else:\n        return x\n    \ndef parse_income(x):\n    if isinstance(x, str):\n        return float(x[1:].replace(',', ''))\n    else:\n        return np.nan\n    \ndf = df.applymap(parse_pct)\ndf['Community School?'] = df['Community School?'].apply(lambda x: int(x == 'Yes'))\ndf['School Income Estimate'] = df['School Income Estimate'].apply(parse_income)\n\n# fix bad attendance rate values\ndf.loc[df['Student Attendance Rate'] == 0.0, 'Student Attendance Rate'] = np.nan\ndf.loc[df['Percent of Students Chronically Absent'] == 1.0, 'Percent of Students Chronically Absent'] = np.nan\n\n# fix bad 'Rigorous Instruction %' values\ndf.loc[df['Rigorous Instruction %'] == 0, 'Rigorous Instruction %'] = np.nan\n\n# fix school with bad framework entries\ndf.loc['84M202', 'Rigorous Instruction %':'Trust %'] = np.nan\n\n# summarize available grades\ndef parse_grade(x):\n    if x == 'PK':\n        return -1\n    elif x == '0K':\n        return 0\n    else:\n        return int(x)\n    \ndef summarize_grades(x):\n    low = parse_grade(x['Grade Low'])\n    high = parse_grade(x['Grade High'])\n    \n    low_category = None\n    if low in (-1, 0):\n        low_category = 'kinder'\n    elif low in (5, 6, 7):\n        low_category = 'elementary(5-7)'\n        \n    high_category = None\n    if high in (4, 5, 6):\n        high_category = 'elementary(4-6)'\n    if high == 8:\n        high_category = 'middle(8)'\n    if high == 12:\n        high_category = 'high(12)'\n        \n    if low_category and high_category:\n        return \"{} - {}\".format(low_category, high_category)\n    else:\n        return 'other'\n\ndf['Available Grades'] = df.apply(summarize_grades, axis=1)\ndf['SE Grade'] = df['Grades'].str.contains('SE')\ndf = df.drop(['Grades', 'Grade Low', 'Grade High'], axis=1)\n\n# add borough information\nboroughs = pd.read_csv('..\/input\/retrieve-school-boroughs\/NYC Schools Boroughs.csv', index_col=0)\ndf = df.join(boroughs)\n\ndf.head()","6e8b1c91":"### percentage of 4s for each school\n### percentage4s is used by the plot_percentage_of_4s function\n\n\n# melt df so that column names become a variable\nmelted = df4s.reset_index().melt(id_vars='DBN', value_name='Count')\n\n# split column names (now a variable) into 'Grade', 'Test' and 'Group'\npattern = r'^Grade (?P<Grade>\\d) (?P<Test>\\w+) (?:- |)(?P<Group>.*)$'\nsplit_cols = melted.variable.str.extract(pattern)\n\n# merge new variables with DBN and Count\nsplit = pd.concat([\n    melted[['DBN', 'Count']],\n    split_cols\n], axis=1)[['Test', 'DBN', 'Grade', 'Group', 'Count']]\n\n# calculate total percentage of 4s per grade in each school\ndef calculate_grade_pct(df):\n    all_students_tested = df[df.Group == 'All Students Tested'].Count.sum()  # average for both tests\n    all_students_4s = df[df.Group == '4s - All Students'].Count.sum()\n    \n    if all_students_tested > 0:\n        return all_students_4s \/ all_students_tested\n    else:\n        return np.nan\naggregate = split.groupby(['DBN', 'Grade']).apply(calculate_grade_pct).rename('Mean 4s').reset_index()\n\n# unstack results so we can use them with parallel_coordinates\nplanified = aggregate.set_index(['DBN', 'Grade'])['Mean 4s'].unstack()\nplanified.columns.name = None\nplanified.columns = [\"Grade {}\".format(c) for c in planified.columns]\n\n# nicer name\npercentage4s = planified.copy()\npercentage4s.head()","619efddd":"### available grades sorted by incindence\n### grades is used by the plot_available_grades function\n\navailable_grades = df['Available Grades'].value_counts().index\navailable_grades.tolist()","1ad20827":"### functions here are made to be called indirectly (but nothing impedes you of calling them directly)\n\n\nimport warnings\n\nimport matplotlib.cbook\nimport matplotlib.gridspec as gridspec\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom IPython import display\nfrom mpl_toolkits.basemap import Basemap\nfrom pandas.plotting import parallel_coordinates\n\n# ignore deprecation warnings\nwarnings.filterwarnings(\"ignore\",category=matplotlib.cbook.mplDeprecation)\n\n\n# map util\n\nNYC_MAP = plt.imread('..\/input\/nycmap\/basemap.png')\n\ndef plot_basemap(ax=None):\n    m = Basemap(projection='merc',\n                llcrnrlat=40.486,\n                llcrnrlon=-74.261,\n                urcrnrlat=40.925,\n                urcrnrlon=-73.691,\n                resolution='c',\n                epsg='3623')\n    m.imshow(NYC_MAP, origin='upper', ax=ax)\n    m.drawmapboundary(ax=ax)\n    return m\n    \n# minimap\n\ndef plot_minimap(data, ax):\n    map = plot_basemap(ax)\n    lat = data['Latitude'].values\n    lon = data['Longitude'].values\n    x, y = map(lon, lat)    \n    ax.scatter(x, y, alpha=0.5, s=10)\n    ax.set_title('Location of {} Schools'.format(data.shape[0]))\n    \n# parallel coordinates\n\ndef plot_ethnic_distribution(data, ax):\n    data = data[['Percent Hispanic', 'Percent Black', 'Percent White', 'Percent Asian']].copy()\n    data['dummy'] = '-'\n    parallel_coordinates(data, 'dummy', linewidth=1.0, ax=ax)\n    ax.set_title(\"Ethnic distribution\")\n    ax.set_ylim(0.0, 1.0)\n    \ndef plot_framework_measures(data, ax):\n    data = data[['Rigorous Instruction %', 'Collaborative Teachers %', \n                 'Supportive Environment %', 'Effective School Leadership %', \n                 'Strong Family-Community Ties %', 'Trust %']].copy()\n    data.columns = [c[:-2] for c in data.columns]\n    data['dummy'] = '-'\n    parallel_coordinates(data, 'dummy', linewidth=1.0, ax=ax)\n    ax.set_title(\"Framework Measures\")\n    ax.set_ylim(0.0, 1.0)\n    \ndef plot_percentage_of_4s(DBN, ax):\n    data = percentage4s.loc[DBN]\n    data['dummy'] = '-'\n    parallel_coordinates(data, 'dummy', linewidth=1.0, ax=ax)\n    ax.set_title(\"Percentage of 4s\")\n    ax.set_ylim(0.0, 1.0)\n    \n# univariate KDE\n\ndef plot_eni(data, ax):\n    data = data[data['Economic Need Index'].notnull()]\n    sns.distplot(data['Economic Need Index'], hist=False, kde_kws={\"shade\": True}, ax=ax)\n    ax.set_xlim(0, 1)\n    ax.set_title('Economic Need Index')\n    ax.set_xlabel('')\n    \ndef plot_ell(data, ax):\n    sns.distplot(data['Percent ELL'], hist=False, kde_kws={\"shade\": True}, ax=ax)\n    ax.set_xlabel('Percent ELL (English Language Learner)')\n    ax.set_xlim(0, 1)\n    ax.set_title('Percent ELL (English Language Learner)')\n    ax.set_xlabel('')\n    \ndef plot_estimated_income(data, ax):\n    data = data[data['School Income Estimate'].notnull()].copy()\n    data['School Income Estimate (thousands)'] = data['School Income Estimate'] \/ 1000\n    sns.distplot(data['School Income Estimate (thousands)'], hist=False, kde_kws={\"shade\": True}, ax=ax)\n    ax.set_xlim(0.0, 200.0)\n    ax.set_title('Estimated School Income (thousands)')\n    ax.set_xlabel('')\n    \n# bivariate KDE\n\ndef plot_proficiency(data, ax):\n    # remove null entries\n    notnull = data[['Average ELA Proficiency',\n                    'Average Math Proficiency']].notnull().all(axis=1)\n    data = data.loc[notnull]\n    \n    # plot\n    x = data['Average ELA Proficiency']\n    y = data['Average Math Proficiency']\n    sns.kdeplot(x, y, shade=True, cmap='Blues', ax=ax)\n    ax.set_xlim(1.0, 4.5)\n    ax.set_ylim(1.0, 4.5)\n    \ndef plot_attendance(data, ax):\n    # remove null entries\n    notnull = data[['Student Attendance Rate', \n                    'Percent of Students Chronically Absent']].notnull().all(axis=1)\n    data = data.loc[notnull]\n    \n    # plot KDE\n    x = data['Student Attendance Rate']\n    y = data['Percent of Students Chronically Absent']\n    sns.kdeplot(x, y, shade=True, cmap='Blues', ax=ax)\n    ax.set_xlim(0.5, 1.00)\n    ax.set_ylim(0.00, 0.5)\n   \n# bar plot\n\ndef plot_community_school(data, ax):\n    cnt = data.groupby('Community School?').size()\n    \n    xs = ['Community School', 'Regular School']\n    ys = [cnt.get(1, 0), cnt.get(0, 0)]\n    ax.bar(xs, ys)\n    ax.set_title('Community School?')\n    \ndef plot_available_grades(data, ax):\n    grades_cnt = data['Available Grades'].value_counts().to_dict()\n    \n    xs = available_grades\n    ys = [grades_cnt.get(g, 0) for g in available_grades]\n    \n    ax.bar(xs, ys)\n    ax.set_title('Grades Available')\n    ax.tick_params(rotation=90)\n    \ndef plot_unavailable(data, ax):\n    eni = data['Economic Need Index'].isnull().mean()\n    sie = data['School Income Estimate'].isnull().mean()\n    attendance = data[['Student Attendance Rate', \n                       'Percent of Students Chronically Absent']].isnull().any(axis=1).mean()\n    proficiency = data[['Average ELA Proficiency',\n                        'Average Math Proficiency']].isnull().any(axis=1).mean()\n    framework = data[['Rigorous Instruction %', 'Collaborative Teachers %', \n                      'Supportive Environment %', 'Effective School Leadership %', \n                      'Strong Family-Community Ties %', 'Trust %']].isnull().any(axis=1).mean()\n\n    xs = ['Attendance', 'Economic Need Index', 'NYS Test Proficiency', \n          'Framework Measures', 'School Income Estimate']\n    ys = [attendance, eni, proficiency,\n          framework, sie]\n\n    ax.bar(xs, ys)\n    ax.set_title('Percentage of null values')\n    ax.tick_params(rotation=20)\n    ax.set_ylim(0.0, 1.0)","ec13589d":"### functions here are made to be called directly\n\n\n# mapping\n\ndef plot_cluster_map(cluster, data, **kwargs):\n    plt.figure(figsize=(20,12))\n    m = plot_basemap()\n    for c, d in data.groupby(cluster):        \n        lat = d['Latitude'].values\n        lon = d['Longitude'].values\n        x, y = m(lon, lat)\n        plt.scatter(x, y, label=c, **kwargs)\n    plt.title(cluster.name)\n    plt.legend()\n    \ndef plot_continuous_map(features, data, **kwargs):\n    fig, ax = plt.subplots(figsize=(20,12))\n    m = plot_basemap()    \n    \n    lat = data['Latitude'].values\n    lon = data['Longitude'].values\n    x, y = m(lon, lat)    \n    plt.scatter(x, y, c=features, **kwargs)\n    \n    plt.title(features.name)\n    plt.colorbar(fraction=0.046, pad=0.04)  # magic padding https:\/\/stackoverflow.com\/a\/26720422\/\n\n\n# aggregate grids\n\ndef plot_schools_info(data, title=''):\n    fig = plt.figure(figsize=(20, 8))\n    fig.suptitle(title)\n    \n    gs = gridspec.GridSpec(2, 4)\n    ax1 = plt.subplot(gs[0, 0])\n    ax2 = plt.subplot(gs[0, 1:])\n    ax3 = plt.subplot(gs[1, 0])\n    ax4 = plt.subplot(gs[1, 1])\n    ax5 = plt.subplot(gs[1, 2])\n    ax6 = plt.subplot(gs[1, 3])\n\n    plot_minimap(data, ax1)\n    plot_framework_measures(data, ax2)\n    plot_available_grades(data, ax3)\n    plot_community_school(data, ax4)\n    plot_estimated_income(data, ax5)\n    plot_unavailable(data, ax6)\n    \ndef plot_students_info(data, title=''):\n    fig = plt.figure(figsize=(20, 12))\n    fig.suptitle(title)\n    \n    gs = gridspec.GridSpec(3, 4)\n    ax1 = plt.subplot(gs[0, :3])\n    ax2 = plt.subplot(gs[0, 3])\n    ax3 = plt.subplot(gs[1, :3])\n    ax4 = plt.subplot(gs[1, 3])\n    ax5 = plt.subplot(gs[2, 1])\n    ax6 = plt.subplot(gs[2, 2])\n\n    plot_ethnic_distribution(data, ax1)\n    plot_ell(data, ax2)\n    plot_percentage_of_4s(data.index, ax3)\n    plot_eni(data, ax4)\n    plot_proficiency(data, ax5)\n    plot_attendance(data, ax6)\n    \n    \n### clusters utils\n\ndef plot_clusters(clusters, data):\n    # plot big map with clusters\n    display.display_markdown('#### Map', raw=True)\n    plot_cluster_map(clusters, data)\n    plt.show()\n    \n    # unique clusters by number of occurences\n    clusters = pd.Series(clusters)\n    unique = clusters.value_counts().index.tolist()\n    \n    # plot schools characteristics\n    display.display_markdown('#### Schools Characteristics', raw=True)\n    for cluster in unique:\n        d = data[clusters == cluster]\n        plot_schools_info(d, title=\"Cluster {!r}\".format(cluster))\n        plt.show()\n    \n    # plot students characteristics    \n    display.display_markdown('#### Students Characteristics', raw=True)\n    for cluster in unique:\n        d = data[clusters == cluster]\n        plot_students_info(d, title=\"Cluster {!r}\".format(cluster))\n        plt.show()","7600a79a":"plot_continuous_map(df['School Income Estimate'], df)","a2c5f556":"plot_continuous_map(df['Economic Need Index'], df, vmin=0, vmax=1, cmap='Reds')","ee3af736":"plot_continuous_map(df['Percent ELL'], df, vmin=0, vmax=1)","82c6b4da":"plot_continuous_map(df['Student Attendance Rate'], df, cmap=\"Blues\")","ff106863":"plot_continuous_map(df['Percent of Students Chronically Absent'], df, cmap=\"Reds\")","a1cd3b2f":"plot_continuous_map(df['Average ELA Proficiency'], df, vmin=1.8, vmax=4.2)  # normalize both proficiency cmaps","1556f72e":"plot_continuous_map(df['Average Math Proficiency'], df, vmin=1.8, vmax=4.2)","06f4a510":"plot_clusters(df['Community School?'], df)","7f286c0f":"plot_clusters(df['SE Grade'], df)","9b066075":"# checking if Percentage of 4s has fewer students than usual (yes!)\n\nfig, ax = plt.subplots()\nplot_percentage_of_4s(df.sample(25, random_state=1).index, ax)","5d8cb3a3":"# checking if Average Proficiency has two clusters (no!)\n\nd = df[df['SE Grade']]\nplt.scatter(d['Average ELA Proficiency'], d['Average Math Proficiency']);","b6371b19":"df.isnull().sum().sort_values(ascending=False).head(15)","b63e5734":"income_na = df['School Income Estimate'].isnull().rename('Income Unavailable?')\nplot_clusters(income_na, df)","94d35da5":"plot_clusters(df['Borough'], df)","a3f384c0":"df.groupby('Borough')['Effective School Leadership %'].describe()","2ebb5245":"df.groupby('Borough')['Strong Family-Community Ties %'].describe()","8546ccbd":"plot_clusters(df['Available Grades'], df)","9ac59f33":"_aa = df[df['Available Grades'] == 'elementary(5-7) - middle(8)']\nplt.scatter(_aa['Student Attendance Rate'], _aa['Percent of Students Chronically Absent'])","ace07fda":"def get_null_columns(x):\n    return tuple([c for c in x[x.isnull()].index if c != 'School Income Estimate'])\n\ndef summarize_null_columns(columns):\n    return {\n        (): 'none',\n        ('Average ELA Proficiency', 'Average Math Proficiency'): 'ela\/math proficiency',\n        ('Student Attendance Rate', 'Percent of Students Chronically Absent'): 'attendance',\n        ('Economic Need Index',\n          'Student Attendance Rate',\n          'Percent of Students Chronically Absent',\n          'Rigorous Instruction %',\n          'Collaborative Teachers %',\n          'Supportive Environment %',\n          'Effective School Leadership %',\n          'Strong Family-Community Ties %',\n          'Trust %',\n          'Average ELA Proficiency',\n          'Average Math Proficiency'): 'lots of stuff'\n    }.get(columns, 'other')\n\nnull_columns = df.apply(get_null_columns, axis=1).apply(summarize_null_columns).rename('Null columns')\nplot_clusters(null_columns, df)","8d69b35b":"# check only middle schools\n\nd = df[df['Available Grades'] == 'elementary(5-7) - middle(8)'].copy()\nd = d[df['Percent of Students Chronically Absent'].notnull()]  # ignore nulls\nd.head()","228371c9":"sns.distplot(d['Percent of Students Chronically Absent']);","2b7003a2":"from sklearn.cluster import KMeans\n\nmodel = KMeans(n_clusters=2)\nmodel.fit(d[['Percent of Students Chronically Absent']])\nmodel.cluster_centers_","0bb3698e":"cutoff_point = model.cluster_centers_.mean()\ncutoff_point","743b5f92":"clusters = (d['Percent of Students Chronically Absent'] > cutoff_point).rename('Chronic Absent > 21.7%')\nplot_clusters(clusters, d)","6316da74":"# separate the dataframe\n\ncolumns = ['Percent Hispanic',\n           'Percent Black',\n           'Percent White',\n           'Percent Asian']\nd = df[columns].copy()\nd['Percent Other'] = (1 - d.sum(axis=1)).apply(lambda x: max(0.0, x))\nd.head()","f3ba39cc":"from sklearn.metrics.pairwise import pairwise_distances\n\n# calculate the distance matrix\n\ndistances = pairwise_distances(d, metric='cosine', n_jobs=-1)\ndistances","e15e6067":"from sklearn.cluster import AgglomerativeClustering\nfrom sklearn.metrics import silhouette_score\n\n# plot the silhouette score to determine optimal number of clusters\n\nrounds = []\nn_clusters_range = range(2, 25)\nfor n_clusters in n_clusters_range:\n    model = AgglomerativeClustering(n_clusters, linkage='average', affinity='precomputed')\n    labels = model.fit_predict(distances)    \n    score = silhouette_score(distances, labels, metric='precomputed')\n    rounds.append([n_clusters, score])\n    \nrounds_df = pd.DataFrame(rounds, columns=['n_clusters', 'score'])\nplt.bar(rounds_df['n_clusters'], rounds_df['score'])\nplt.xlabel(\"Number of Clusters\")\nplt.ylabel(\"Silhouette Score\");","26245b49":"# create the clusters\n\nmodel = AgglomerativeClustering(n_clusters=4, linkage='average', affinity='precomputed')\nlabels = model.fit_predict(distances)\nclusters = pd.Series(labels, index=d.index, name='Cluster')\nprint(clusters.value_counts())","5ad2ea78":"plot_clusters(clusters, df.loc[d.index])","4ba44e2c":"# separate the DataFrame\n\ncolumns = [c for c in df.columns if c.endswith('%')]\nd = df[columns]\nd = d[d.notnull().all(axis=1)]\nd.head()","16438ae8":"from sklearn.metrics.pairwise import pairwise_distances\n\n# create the distance matrix\n\ndistances = pairwise_distances(d, metric='correlation', n_jobs=-1)\ndistances","ab072a0d":"# choose number of clusters based on the silhouette score\n\nrounds = []\nn_clusters_range = range(2, 14)\nfor n_clusters in n_clusters_range:\n    model = AgglomerativeClustering(n_clusters, linkage='complete', affinity='precomputed')\n    labels = model.fit_predict(distances)    \n    score = silhouette_score(distances, labels, metric='precomputed')\n    rounds.append([n_clusters, score])\n    \nrounds_df = pd.DataFrame(rounds, columns=['n_clusters', 'score'])\nplt.bar(rounds_df['n_clusters'], rounds_df['score'])\nplt.xlabel(\"Number of Clusters\")\nplt.ylabel(\"Silhouette Score\");","c77eef70":"# create clusters\n\nmodel = AgglomerativeClustering(n_clusters=5, linkage='complete', affinity='precomputed')\nlabels = model.fit_predict(distances)\nclusters = pd.Series(labels, index=d.index, name='Cluster')\nprint(clusters.value_counts())","acfa253b":"plot_clusters(clusters, df.loc[d.index])","7c21c510":"# Groups of Schools\n\nThis is my first public kernel!  I will do a very simple thing: group schools by different sets of characteristics and visualize the effects on another sets of characteristics. For example, I will use the ethnicity, framework measures, student achievement, etc...\n\nMy hope is that by providing different groupings, PASSNYC may get a better idea of what works for one group or another.\n\nFeel free to borrow any of the code present here into your own work!","2534e0a6":"### Remarks\n\n- The estimated school income varies a lot between boroughs\n\n  *It has been shown that this value is very correlated to the Economic Need Index.*\n\n- As expected, the ENI also varies a lot\n\n- The ethnic composition of schools seem to reflect that of their regions\n\n- The performance across boroughs is very varied. Manhattan performs best\n\n- Tiny variances in the NYC Framework may indicate areas where PASSNYC might have more ease or difficulty when intervening","a8d2ba23":"### Plotting","53d86bb6":"# Plotting utilities\n\nLet's prepare functions for:\n\n- Plotting clusters statistics\n- Plotting clusters in a map\n- Plotting continuous features in a map","75e72986":"### Plotting","980f02d7":"## School Income Estimate\n\n*note: this value is present in only about 2\/3 of the schools*","8733e5b8":"# Work in Progress\n\nThis is a work in progress. Here are some things that will be done later:\n\n- Create subclusters for NYC Framework metrics\n- Summarize all findings in a concise way\n\nCya!","b84b8fad":"## Average ELA (English Language Arts) Proficiency","3f5ff3af":"### Remarks\n\n- Overall, it's difficult to say much because there are few schools.\n- Schools without ELA\/Math proficiency teach up until the 4th grade, or, their upper-level students do not register for the state tests\n- Schools without attendance information come mainly from Manhattan and have high-performing students","517b362c":"## Borough\n\nNew York is composed of five boroughs:\n\n- Manhattan\n- Brooklyn\n- Queens\n- Bronx\n- Staten Island","ccea57a4":"# Binary Categories\n\nHere we will select some categories, and visualize the difference between the two groups of schools are are present or not in them.","8d0f239c":"I said I wouldn't comment, but, let me make a note. Look at the northeastern part of Brooklyn and at Bronx across all maps. These areas seem to be suffering in all the metrics we used (except 'Percent ELL', but this has no good or bad sides). Meaning... All school factors are probably interrelated with one another in some deeper sense.\n\n![New York City - Boroughs](https:\/\/i.imgur.com\/xQ0XrkL.jpg)","de11eb48":"## Economic Need Index\n\nThis measures the poverty among *students*.","644049ff":"## Percentual of ELL (English Language Learners)","5eed1729":"## Group middle schools by Percent of Students Chronically Absent\n\n*this pattern emerged when splitting schools by the grades available*","6fa35db6":"## Community Schools\n\n\"A type of publicly funded school that serves as both an educational institution and a center of community life.\"","33c47b4c":"## Missing 'School Income Estimate'","3588ce2d":"## Available grades\n\nThese started catching my attention... Let's take a look.","d920576c":"### Remarks\n\nThere are only 25 schools with Special Education, and they look quite similar to the usual schools.\n\n- They are fairly spread across the city\n- *Perhaps* schools with a high overall student achievement don't have SE classes","9b4a6fb5":"The cutoff is the middle of the cluster centers:","59dff988":"# Clustering\n\nHere I will cluster schools based on different characteristics. The focus, instead of creating a powerful grouping, will be on creating a simple thing that is easy to comprehend.","e0d54563":"### Remarks\n\n*the KDE for Estimated School Income for middle schools means nothing (NAs don't appear there)*\n\n- Almost all schools that start at the kindergarten have their 'School Income Estimate'. Other schools almost never do\n- The percentage of 4s from elementary grades look more distributed than the same indicator in middle grades\n- There seems to be a clustering pattern in the attendance of typical middle schools (5,6,7 to 8th grade)","fb1cd406":"### Remarks\n\n- The map produced very crispy areas. This indicates a nice clustering\n- However, the meaning of clusters is not well defined. For example, Cluster 0 (mostly consisted of asians), has a school which is composed mainly of blacks (though still having asians)\n- Schools basic characteristics are kept the same, except for the school estimated income (which is higher where there are more white and asian students)\n- Students characteristics vary a lot:\n  - Hispanic and black students are overall poorer\n  - They also have worse performance and attendance ratings\n  - Hispanic and asian students have a tendency to be english language learners","f1d80784":"## Student Attendance Rate","0b9483d4":"## Group schools by framework measures\n\nHere I will group the schools based on the [NYC Framework for Greate Schools][1].\n\nThe distance used is the pearson correlation, useful in grouping entries with a similar \"shape\" across the compared metrics.\n\nFor example, a school with 'Collaborative Teachers %' slightly higher than 'Rigorous Instruction %' will tend to be grouped with a school that has this same characteristic.\n\n[1]: https:\/\/www.schools.nyc.gov\/about-us\/vision-and-mission\/framework-for-great-schools","0103c5f7":"## Other kinds of NA\n\nWhile we understood the main factor for a school to have a missing 'School Income Estimate Value', there are another NAs. Let's look into them.","e36188ad":"## Schools with Special Education (SE)\n\nSpecial education is about teaching children who have special needs or behavioral problems.","ed8bebbd":"### Remarks\n\n- The schools lots of with chronic skippers (class-skippers) are mostly present in regions with lots of educationals problems (Bronx and Northeastern Brooklyn)\n  \n- The framework measures look surprisingly close for both categories\n  \n  *this leads me to believe that the framework percentages are relative*\n  \n- The percentage of chronic skippers is a great indicator of the overall health of schools.","9617fef4":"## Schools with missing values","24ad9a82":"### Remarks\n\n- School characteristics keep the same through clusters, except for Cluster 1, where there are more middle schools.\n\n  *This may indicate an area that needs improvement (and is relevant because it involves students about to take SHSAT*\n  \n- Cluster 3 presents a visible grouping in the Economic Need Index and Student Attendance Rate (cluster 1 also does, but it is less visible)\n\n- The student performance across groups is remarkably similar, however, the attendance indicators vary. This goes against our findings that lower attendance is correlated with lower performance. Why does it happen?","e170b81b":"Most missing values are in the School Income Estimate. Missing values are also present in:\n\n- Average NYS Test Proficiency\n- Student Attendance\n- NYC Framework measures\n- Economic Need Index\n\nSince there are a lot of sources of NA, let's just look at the main one:","3beffec1":"## Percent of Students Chronically Absent\n\nA student is considered chronically absent if he misses more than *10%*  of his classes.","5250eee1":"And there you are, a seemingly bimodal distribution. Let's use a clustering algorithm to estimate a cutoff point.","3f0bc6c8":"<h1 id=\"tocheading\">Table of Contents<\/h1>\n<div id=\"toc\"><\/div>","a827e6d2":"### Plotting","fbfceb73":"## Group schools by ethnicity\n\nHere I will group schools by their ethnic distribution (e.g., their percentage of students in each ethnicity).\n\nThe measure used will be the cosine distance, that means: two points are considered close to one another if the angle between them is small.","ee93834c":"# Preparing the data\n\nHere we do a bunch of things to get the data nice and beautiful. You can skip over this part if you want.","76eeee25":"## Average Math Proficiency","819b218f":"# Multi-valued categories\n\nHere we will visualize categories which have more than 1 value.","b519fbc9":"### Remarks\n\n*from now on I'll be doing remarks on things that may not be so obvious by looking at the plots (and some obvious things too)*\n\nCommunity schools characteristics:\n\n- They seem to be concentrated in the worst performing regions of the city\n- The majority of them are middle schools (instead of elementary schools)\n- Their income is cut at about \\$60,000 (usual schools go up to \\$200,000)\n- There are more missing values (for the School Income Estimate)\n\nCommunity school students characteristics:\n\n- There are very few white and asian students\n- There are a bit more of ELL\n- Students are poorer\n- Student performance and attendance are overall worse\n\nUnintuitive findings:\n\n- Despite having seemingly worse conditions, the performance of community schools on the NYC Framework for Great School is quite similar to that of regular schools","2be91689":"### Remarks\n\n- All characteristics look the same, except\n- Most schools with NA do not have a kindergarten (and most schools without NA *do* have a kindergarten)","f095cfe9":"# Visualizing continuous features\n\nThis is not the objective of this kernel, so, the plots will be here but the interpretation is up to the reader! :)"}}