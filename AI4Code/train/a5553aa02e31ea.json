{"cell_type":{"ddca2f25":"code","60419b3d":"code","cd29b334":"code","ef3518f2":"code","1778aa5c":"code","291efb7b":"code","fed14a0c":"markdown","028e9a95":"markdown","3521f1c7":"markdown"},"source":{"ddca2f25":"!pip install transformers\n!pip install sentence_transformers\nimport os\nPATH = \"\/kaggle\/working\/model\"\nos.mkdir(PATH)","60419b3d":"from transformers import AutoTokenizer\nfrom transformers import AutoModelWithLMHead\nfrom sentence_transformers import SentenceTransformer \nfrom sentence_transformers import models","cd29b334":"tokenizer = AutoTokenizer.from_pretrained(\"gsarti\/scibert-nli\")\nmodel = AutoModelWithLMHead.from_pretrained(\"gsarti\/scibert-nli\")\nmodel.save_pretrained(PATH)\ntokenizer.save_pretrained(PATH)\nembedding = models.BERT(PATH,max_seq_length=128,do_lower_case=True)\npooling_model = models.Pooling(embedding.get_word_embedding_dimension(),\n                               pooling_mode_mean_tokens=True,\n                               pooling_mode_cls_token=False,\n                               pooling_mode_max_tokens=False)\nmodel = SentenceTransformer(modules=[embedding, pooling_model])\nmodel.save(PATH)","ef3518f2":"encoder = SentenceTransformer(PATH)","1778aa5c":"embedding = encoder.encode(['Temperature significant change COVID-19 Transmission in 429 cities'])[0]","291efb7b":"import requests \nvespa_body_ann = {\n    'yql': 'select * from sources * where source contains \"medrxiv\" and ([{\"targetNumHits\":%i}]nearestNeighbor(title_embedding,vector));' % (5),\n    'hits': 5,\n    'ranking.features.query(vector)': embedding.tolist(),\n    'ranking.profile': 'semantic-search-title',\n    'summary': 'short',\n    'timeout': '5s',\n    'ranking.softtimeout.enable': 'false' \n}\nresponse = requests.post('https:\/\/api.cord19.vespa.ai\/search\/', json=vespa_body_ann) \nresult = response.json()\nfor hit in result['root']['children']:\n    relevance = hit['relevance']\n    id = hit['fields']['id']\n    title = hit['fields'].get('title')\n    print('Semantic Similarity=%f, title = %s' % (relevance, title))\n","fed14a0c":"Use Vespa's nearest neighbor query operator and fetch the similar titles for the title\n> *Temperature significant change COVID-19 Transmission in 429 cities* \n\nWe use the SentenceTransformer model to get the sentence embedding vector","028e9a95":"Install the libraries needed","3521f1c7":"Semantic search using scibert sentence embeddings and Vespa's (https:\/\/vespa.ai\/) CORD-19 Search API \n\n* API guide https:\/\/github.com\/vespa-engine\/cord-19\n* Simple web frontend https:\/\/cord19.vespa.ai\/\n* Sentence embeddings from https:\/\/huggingface.co\/gsarti\/scibert-nli"}}