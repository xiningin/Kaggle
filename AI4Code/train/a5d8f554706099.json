{"cell_type":{"afb2881c":"code","194e021b":"code","85d7dbb4":"code","5194f1c6":"code","236f36db":"code","6e2bbcce":"code","128183bd":"code","361a3fc2":"code","7e4125a1":"code","8f7bc5e7":"markdown","1ef2ee2a":"markdown","e31aadf6":"markdown","a047ed68":"markdown","366ed081":"markdown"},"source":{"afb2881c":"!pip install -U transformers","194e021b":"import pandas as pd\nfrom tqdm.notebook import tqdm","85d7dbb4":"df = pd.read_csv('..\/input\/jigsaw-multilingual-toxic-comment-classification\/validation.csv')\ndf = df.sample(100, random_state=12)\ndf.head(3)","5194f1c6":"df['lang'].unique()","236f36db":"from transformers import MarianMTModel, MarianTokenizer","6e2bbcce":"df['content_english'] = ''","128183bd":"for i, lang in tqdm(enumerate(['es', 'it', 'tr'])):\n    if lang in ['es', 'it']:\n        model_name = 'Helsinki-NLP\/opus-mt-ROMANCE-en'\n        df_lang = df.loc[df['lang']==lang, 'comment_text'].apply(lambda x: '>>{}<< '.format(lang) + x)\n    else:\n        model_name = 'Helsinki-NLP\/opus-mt-{}-en'.format(lang)\n        df_lang = df.loc[df['lang']==lang, 'comment_text']\n    \n    tokenizer = MarianTokenizer.from_pretrained(model_name)\n    model = MarianMTModel.from_pretrained(model_name, output_loading_info=False)\n        \n    batch = tokenizer.prepare_translation_batch(df_lang.values,\n                                               max_length=192,\n                                               pad_to_max_length=True)\n    translated = model.generate(**batch)\n\n    df.loc[df['lang']==lang, 'content_english'] = [tokenizer.decode(t, skip_special_tokens=True) for t in translated]","361a3fc2":"df.head(3)","7e4125a1":"df.to_csv(\"df_translated.csv\")","8f7bc5e7":"# MarianMT","1ef2ee2a":"This notebook is mostly for educational purpose. Transformers released a new function called [MarianMT](https:\/\/huggingface.co\/transformers\/model_doc\/marian.html) which seems to be very powerful to translate text data.\n\nIn this notebook I used a small subset of the validation data because performing translations using this method takes a lot of time and probably doesn't give an edge compared to dataset transleted using tradtionnal methods.","e31aadf6":"MarianMT offers a wider range of things you can do, pleaste take a look at [the official documentation](https:\/\/huggingface.co\/transformers\/model_doc\/marian.html).","a047ed68":"# Load data","366ed081":"# Tokenize & translate"}}