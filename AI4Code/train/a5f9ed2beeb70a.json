{"cell_type":{"db81de68":"code","dae4deac":"code","7b921fbf":"code","11706028":"code","d67637c5":"code","09de4e22":"code","21bab49b":"code","dd1733bf":"code","3471425a":"code","f11ac8a7":"code","e4c97871":"code","27640d5a":"code","f4d0ee0e":"code","44b4d7dc":"code","21bc48b7":"code","17a38df8":"code","970ec7b3":"code","60b64518":"code","6358b7d5":"markdown","61751461":"markdown","5202b0ce":"markdown","bea17ef6":"markdown","e986b3ac":"markdown","09eba000":"markdown","3368b04d":"markdown","0cdd3145":"markdown","2ad408c2":"markdown","c936f288":"markdown","acb82c81":"markdown","c28fee52":"markdown","7b3e136a":"markdown","ed9943cc":"markdown","843ddc41":"markdown","77395b1d":"markdown","db2af645":"markdown","23e46ef9":"markdown","1f8a8bcf":"markdown","962a3b49":"markdown","d9c6163a":"markdown","112772fa":"markdown","af28b44d":"markdown","b38826fa":"markdown","02814b4f":"markdown"},"source":{"db81de68":"import nltk\nimport re\nimport pandas as pd\nimport numpy as np\nimport seaborn as sns \nimport collections as c\nimport plotly.express as px\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots\nfrom nltk.corpus import stopwords\nfrom sklearn.metrics.pairwise import linear_kernel\nfrom sklearn.feature_extraction.text import CountVectorizer\nfrom sklearn.feature_extraction.text import TfidfVectorizer\nfrom sklearn.metrics.pairwise import cosine_similarity","dae4deac":"df_netflix = pd.read_csv('..\/input\/netflix-shows\/netflix_titles.csv')\ndf_netflix.head(3)","7b921fbf":"len(df_netflix.drop_duplicates())","11706028":"len(df_netflix[df_netflix['type'] == 'Movie'])","d67637c5":"list(df_netflix[df_netflix['date_added'].isna()]['title'])","09de4e22":"len(list(df_netflix[df_netflix['date_added'].isna()]['title']))","21bab49b":"df_netflix = df_netflix[df_netflix['date_added'].notna()]","dd1733bf":"# Handled missing values and standardized datetime \ndf_netflix['rating'] = df_netflix['rating'].fillna(\"\")\ndf_netflix['director'] = df_netflix['director'].fillna(\"\")\ndf_netflix['date_added'] = pd.to_datetime(df_netflix['date_added'])\ndf_netflix['year_added'] = df_netflix['date_added'].dt.year","3471425a":"country_count = c.Counter(\", \".join(df_netflix['country'].dropna()).split(\", \"))\ntop_ten_countries = country_count.most_common(10)\ncountry = [val[0] for val in top_ten_countries][::-1]\nshow_count = [val[1] for val in top_ten_countries][::-1]\ntrace1 = go.Bar(y=country, x=show_count, orientation=\"h\", name=\"\", marker=dict(color='#3498DB'))\ndata = [trace1]\nlayout = go.Layout(title=\"Top 10 countries with most content on Netflix\", height=400, width=700, legend=dict(x=0.1, y=1.1, orientation=\"h\"))\nfig = go.Figure(data, layout=layout)\nfig.show()","f11ac8a7":"top_ten_genre = c.Counter((\", \".join(df_netflix['listed_in'])).split(\", \")).most_common(10)\ngenre = [val[0] for val in top_ten_genre][::-1]\ncount = [val[1] for val in top_ten_genre][::-1]\ntrace2 = go.Bar(y=genre, x=count, orientation=\"h\", name=\"\", marker=dict(color='#3498DB'))\ndata = [trace2]\nlayout = go.Layout(title=\"Top 10 genres on Netflix\", height=400, width=700, legend=dict(x=0.1, y=1.1, orientation=\"h\"))\nfig = go.Figure(data, layout=layout)\nfig.show()","e4c97871":"def df_by_country(df, country):\n  '''\n  Returns a filtered df with shows available to a specific country\n  Input: A dataframe and a selected country name\n  Output: A dictionary with country as key and show_id as value\n  '''\n  drop_country_na = df[df['country'].notna()]\n  return drop_country_na[drop_country_na['country'].str.contains(country)]","27640d5a":"def top_genre_by_country(df, country):\n  genre_counter = c.Counter(\", \".join(df_by_country(df_netflix, country)['listed_in']).split(\", \")).most_common(10)\n  genre = [val[0] for val in genre_counter][::-1]\n  count = [val[1] for val in genre_counter][::-1]\n  return genre, count\n\nfig = make_subplots(rows=2, cols=2, horizontal_spacing=0.4,\n      subplot_titles=(\"USA\",'France', 'Japan', 'South Korea'))\ncountry = ['United States', 'France', 'Japan', 'South Korea']\ncolors = ['#AF7AC5', '#76D7C4', '#EC7063', '#F4D03F']\nposition = [(1,1), (1,2), (2,1), (2,2)]\n\nfor i in np.arange(len(country)):\n  genre, count = top_genre_by_country(df_netflix, country[i])\n  fig.add_trace(go.Bar(y=genre, x=count, \n                       orientation=\"h\", name=\"\", \n                       marker=dict(color=colors[i])), position[i][0],  position[i][1])\n  \n  fig.update_layout(showlegend=False, height = 650, width = 900, title_text=\"Top 5 genres by country\")\n  \nfig.show()","f4d0ee0e":"tv_add_count = df_netflix[df_netflix['type'] == 'TV Show'].groupby('year_added').size().reset_index(name = 'added_count').iloc[0:9,:]\nmovie_add_count = df_netflix[df_netflix['type'] == 'Movie'].groupby('year_added').size().reset_index(name = 'added_count').iloc[0:12,:]\ntrace1 = go.Scatter(x=tv_add_count['year_added'], y=tv_add_count['added_count'], name=\"TV Shows\", marker=dict(color=\"#3498DB\"))\ntrace2 = go.Scatter(x=movie_add_count[\"year_added\"], y=movie_add_count['added_count'], name=\"Movies\", marker=dict(color=\"#EC7063\"))\ndata = [trace1, trace2]\nlayout = go.Layout(title=\"TV shows vs. Movies added over the years\", width = 600, legend=dict(x=0.1, y=1.1, orientation=\"h\"))\nfig = go.Figure(data, layout=layout)\nfig.show()","44b4d7dc":"df_netflix = df_netflix[df_netflix['title'].notna()]\ndf_netflix['aggregated_text'] = df_netflix['description'].str.lower() + \" \" + df_netflix['listed_in'].str.lower() + \" \" + df_netflix['rating'].str.lower() + df_netflix['director'].str.lower()        \ncorpus_tokenized = list(df_netflix['aggregated_text'].str.split(\" \"))\nstopwords_list = set(stopwords.words(\"english\"))\nindex = list(range(0, len(corpus_tokenized)))\nclean_corpus = []\n\nfor sentence in corpus_tokenized:\n  s = []\n  for word in sentence:\n    clean_word = re.sub(r'[^\\w\\s]','', word)\n    if clean_word not in stopwords_list:\n      s.append(clean_word)\n  clean_corpus.append(\" \".join(s))","21bc48b7":"tfidf_vectorizer = TfidfVectorizer().fit_transform(clean_corpus)","17a38df8":"def get_recommendation(show_list, vectorizer):\n  '''\n  Returns: \n        A df showing the top 5 similar show and genres of a given list of shows \n  Input: \n        Show_name: A list of shows that the user has already watched\n        Vectorizer: Type of vectorizer \n  '''\n  title, scores, genre = [], [], []\n  for show_name in show_list:\n    show_index = df_netflix[df_netflix['title'] == show_name].index[0]\n    cosine_similarities = linear_kernel(vectorizer[show_index], vectorizer).flatten()\n    similar_show_index = cosine_similarities.argsort()[:-7:-1][1:]\n    title += [df_netflix['title'][i] for i in similar_show_index]\n    genre += [df_netflix['listed_in'][i] for i in similar_show_index]\n    scores += list(cosine_similarities[similar_show_index])\n\n  df = pd.DataFrame(data = {'Title': title, \n                            'Genre': genre,\n                            'Cosine_similarity': scores})\n\n  df = df[~df['Title'].isin(show_list)].sort_values('Cosine_similarity', ascending = False)\n  df['Title'] = df['Title'].drop_duplicates()\n  top_five_list = df[df['Title'].notna()].iloc[0:5, :]\n    \n  return top_five_list","970ec7b3":"watched_shows = ['Stranger Things', 'The Vampire Diaries', 'Sense8']\nget_recommendation(watched_shows, tfidf_vectorizer)","60b64518":"tfidf_vectorizer = TfidfVectorizer(ngram_range = (1, 3)).fit_transform(clean_corpus)\nget_recommendation(watched_shows, tfidf_vectorizer)","6358b7d5":"### **TF-IDF Vectorizer with unigram**","61751461":"### **TF-IDF vectorizer**","5202b0ce":"## **Background**: \n\nThis dataset consists of TV shows and movies available on Netflix as of 2020. The dataset is collected from Flixable which is a third-party Netflix search engine. The data can be downloaded from https:\/\/www.kaggle.com\/shivamb\/netflix-shows.","bea17ef6":"One of Netflix's core business is to offer personalized recommendations of shows to the audience. This article [here](https:\/\/help.netflix.com\/en\/node\/100639) explains how Netflix's recommendation system works on a very high level, and lists a number of factors that Netflix uses to develop their recommendation system. \n\n- **Viewers-level factors**: viewing history, rating of other shows given by the viewers, the time of day they interact with Netflix, duration of each active session, what device they use to watch shows on and other Netflix viewers with similar tastes and preferences. \n\n- **Text-based features of the shows**: content, genre, categories, actors, release year. \n \nApparently, the dataset does not include any views-level factors so we will mainly focus on the text-based features to build our recommendation system. **The goal** here is to recommend 5 shows based on a list of shows that the audience has already watched previously, using the following features: \n\n- `director`\n- `description`\n- `listed in`\n- `rating`","e986b3ac":"### **TF-IDF Vectorizer with unigram, bigram and trigram** ","09eba000":"## **2. EDA**","3368b04d":"There are 6234 movies and tv shows on netflix. About 68% of them are movies and 32% are TV shows. ","0cdd3145":"### **Objective 2: Determine if Netflix has increasingly focusing on TV rather than movies in recent years.**","2ad408c2":"\n### **Data preparation** \n\n","c936f288":"As we observe from the barplots above, the top 10 genre of Netflix shows vary from country to country, which may reflect the difference in the tastes of audience. For example, American and French viewers on Netflix may favor `Drama` and `Comedies` over `Anime series` compared to Japanese viewers, whereas viewers in South Korea favor `Korean TV shows` the most.","acb82c81":"Let's also look at the top genre on Netflix.","c28fee52":"We use TF-IDF vectorizer which stands for *Term Frequency-Inverse Document Frequency*, to vectorize our corpus by turning the raw text into a matrix of TF-IDF features. The reason why I choose TF-IDF vectorizer over CountVectorizer is because word counts do not take words frequency across documents into account. For instance, some words like \"man\" might appear many times in the description of a lot of shows and their large counts will not be very meaningful in the encoded vectors. \n\n- Term Frequency: This summarizes how often a given word appears within a document.\n\n- Inverse Document Frequency: This downscales words that appear a lot across documents.\n\nWe use cosine similarity as our metric to measure the degree of similarity between two shows in terms of their text-based features: content, rating, genres and directors. The larger the cosine similarity is, the closer the vector representation of their text-based features are. ","7b3e136a":"## **1. Initial Checking**","ed9943cc":"We're also interested in identifying the top content by countries to see if there're any difference in the preference of viewers by countries. ","843ddc41":"Let's take a look at an example. Knowing that I have watched three TV shows on Netflix: Stranger Things, The Vampire Diaries, Sense8, what are the 5 shows that Netflix will recommend to me?","77395b1d":"## **3. Content-based recommendation of Netflix shows**","db2af645":"We observe that the number of movies added to Netflix  is higher than that of TV shows all time. In 2019, Netflix added 1546 movies and 803 TV shows. So there is no strong evidence indicating that Netflix has switched focus from movies to TV shows.  ","23e46ef9":"![Netflix logo](https:\/\/www.mercurynews.com\/wp-content\/uploads\/2020\/01\/netflixlogo.jpg?w=877)","1f8a8bcf":"Personally I found the of shows recommended by the second recommendation algorithm more interesting. In the real-world application, companies usually use A\/B testing to determine which recommendation systems are better at finding viewers what they like and improving the users' engagement of the platform. ","962a3b49":"### **Objective 1: Understanding what content is available in different countries**","d9c6163a":"We notice that the column 'date_added' has 11 NA values and further research shows that these 11 shows are not available on Netflix anymore. For example, 'Friends' left Netflix in 2020. \n\nWe will drop those shows which are no longer available on Netflix. ","112772fa":"In this section, we first create a variable `aggregated_text`, which is the concatenation of the four variables: `director` + `description` + `listed in` + `rating`. Then we lowercase each word in our corpus. remove punctuations and English stopwords.","af28b44d":"Currently Netflix is available in 113 countries and regions. Let's see which country has the most content. ","b38826fa":"## **Motivation:**\n\n- Understanding what content is available in different countries\n- Determeine whether Netflix has increasingly focusing on TV rather than movies in recent years.\n- Identifying similar content by matching text-based features\n","02814b4f":"Next, we want to look at how the vectorizer performs when use **unigram, bigram and trigram** instead of only unigram. An n-gram is a sequence of N words: a 2-gram (or bigram) is a two-word sequence of words like \u201cplease turn\u201d,\n\u201cturn your\u201d, or \u201dyour homework\u201d, and a 3-gram (or trigram) is a three-word sequence of words like \u201cplease turn your\u201d, or \u201cturn your homework\u201d\n\nAs we increase the context size, we observe that the cosine similarity decreases but the `Genre` become more similar or nearly identical to the Genre of the given list of shows. "}}