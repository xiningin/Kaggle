{"cell_type":{"03389a2b":"code","5f84825f":"code","ecb79a50":"code","bf534250":"code","2a7a45fd":"code","16f1684a":"code","0e23588c":"code","cf3de5bf":"code","f664d69b":"markdown"},"source":{"03389a2b":"import pandas as pd\nimport numpy as np\n\n##### Part 1 #####\n\n# change these paths with your own path of database\n# movielens-20m-dataset is used on kaggle\nmovie = pd.read_csv('..\/input\/movielens-20m-dataset\/movie.csv')\nrating = pd.read_csv('..\/input\/movielens-20m-dataset\/rating.csv')\n\ndef create_movie_df(nr_drop_movies):\n    #merge datasets\n    df = movie.merge(rating, how=\"left\", on=\"movieId\")\n    rating_count = pd.DataFrame(df[\"title\"].value_counts())\n    #nr_drop_movies= number of dropped movies from list\n    rare_movies = rating_count[rating_count[\"title\"] <= nr_drop_movies].index\n    common_movies = df[~df[\"title\"].isin(rare_movies)]\n    user_movie_df = common_movies.pivot_table(index=[\"userId\"], columns=[\"title\"], values=\"rating\")\n    return user_movie_df\n\nuser_movie_df = create_movie_df(nr_drop_movies = 10000)\nrandom_user = int(pd.Series(user_movie_df.index).sample(1, random_state=40).values)\n\nuser_movie_df.head()","5f84825f":"##### Part 2 #####\n\nrandom_user_df = user_movie_df[user_movie_df.index == random_user]\nmovies_watched = random_user_df.columns[random_user_df.notna().any()].tolist()\n\nmovies_watched","ecb79a50":"##### Part 3 #####\n\nmovies_watched_df = user_movie_df[movies_watched]\nuser_movie_count = movies_watched_df.T.notnull().sum()\nuser_movie_count = user_movie_count.reset_index()\nuser_movie_count.columns = [\"userId\", \"movie_count\"]\nusers_same_movies = user_movie_count[user_movie_count[\"movie_count\"] > len(movies_watched)*0.6][\"userId\"]\nfinal_df = pd.concat([movies_watched_df[movies_watched_df.index.isin(users_same_movies)],\n                      random_user_df[movies_watched]])\n\nusers_same_movies.head()","bf534250":"final_df.head()","2a7a45fd":"##### Part 4 #####\n\ncorr_df = final_df.T.corr().unstack().sort_values().drop_duplicates()\ncorr_df = pd.DataFrame(corr_df, columns=[\"corr\"])\ncorr_df.index.names = ['user_id_1', 'user_id_2']\ncorr_df = corr_df.reset_index()\n\ncorr_df.head(20)","16f1684a":"top_users = corr_df[(corr_df[\"user_id_1\"] == random_user) & (corr_df[\"corr\"] >= 0.65)][\n    [\"user_id_2\", \"corr\"]].reset_index(drop=True)\ntop_users = top_users.sort_values(by='corr', ascending=False)\ntop_users.rename(columns={\"user_id_2\": \"userId\"}, inplace=True)\ntop_users_ratings = top_users.merge(rating[[\"userId\", \"movieId\", \"rating\"]], how='inner')\ntop_users_ratings = top_users_ratings[top_users_ratings[\"userId\"] != random_user]\n\ntop_users_ratings.head(20)","0e23588c":"##### Part 5 #####\n\ntop_users_ratings['weighted_rating'] = top_users_ratings['corr'] * top_users_ratings['rating']\ntop_users_ratings.groupby('movieId').agg({\"weighted_rating\": \"mean\"})\ntop_users_ratings.head()\n\nrecommendation_df = top_users_ratings.groupby('movieId').agg({\"weighted_rating\": \"mean\"})\nrecommendation_df = recommendation_df.reset_index()\n\n\n\nuser_movies_to_be_recommend = recommendation_df[recommendation_df[\"weighted_rating\"] > 3.5].sort_values(\"weighted_rating\", ascending=False)\nuser_movies_to_be_recommend = user_movies_to_be_recommend.merge(movie[[\"movieId\", \"title\"]])\n\nuser_movies_to_be_recommend","cf3de5bf":"##### Part 6 #####\n\nmovie_id=rating[(rating[\"userId\"]==random_user)&(rating[\"rating\"]==5)].sort_values(\"timestamp\",ascending=False)[\"movieId\"][0:1].values[0]\nmovie_title=movie[movie[\"movieId\"]==movie_id][\"title\"].values[0]\n\ndef item_based_recommender(movie_name, user_movie_df):\n    movie_na = user_movie_df[movie_name]\n    return user_movie_df.corrwith(movie_na).sort_values(ascending=False)\n\n\n################\nitem_based = item_based_recommender(movie_title, user_movie_df).reset_index()['title']\nuser_based = user_movies_to_be_recommend['title']\n\n\nhybrid_recommendation=item_based[1:11]\nhybrid_recommendation[5:10]=user_based[1:6]\nhybrid_recommendation.head(10)","f664d69b":"<h1> Hybrid Recommendation System <\/h1>\n\n<div style=\"width:100%; text-align: left;\"> <img align=middle src=\"https:\/\/www.researchgate.net\/profile\/Xiangjie-Kong-2\/publication\/330077673\/figure\/fig5\/AS:710433577107459@1546391972632\/A-hybrid-paper-recommendation-system.png\"> <\/div>\n\n## Table of contents\n* [General info](#general-info)\n* [Dataset info](#dataset-info)\n* [Project info](#project-info)\n* [Technologies](#technologies)\n* [Setup](#setup)\n* [Developments](#developments)\n\n## General info\nRecommendation systems have been around us for quite some time now. Youtube, Facebook, Amazon, and many others provide some sort of recommendations to their users.   \n\nHere, we explore the relationship between the pair of items (the user who bought Y, also bought Z). We find the missing rating with the help of the ratings given to the other items by the user.   \n\nIt was first invented and used by Amazon in 1998. Rather than matching the user to similar customers, item-to-item collaborative filtering matches each of the user\u2019s purchased and rated items to similar items, then combines those similar items into a recommendation list.\n\n\n\n## Dataset info\nThe dataset was provided by MovieLens, a movie recommendation service. It contains the rating scores for these movies along with the movies. It contains 2,000,0263 ratings across 27,278 movies. This data was created by 138,493 users between 09 January 1995 and 31 March 2015. This data set was created on October 17, 2016. Users are randomly selected. It is known that all selected users voted for at least 20 movies.\n## Project info\nMake an estimate for the user whose ID is given, using the item-based and user-based recommender methods.\nHere,we tried to create our own movie database with ratings by using \"movies.csv\" and \"ratings.csv\"(link down below)  \nWe calculated a suggestion with calculating the correlation between the entered movie and other movies. Hence we suggest a movie for user by using correlations among them.\n\n## Technologies\nProject is created with:\n* PyCharm: 2021.3 \n* Pandas: 1.3.4 (especially \"corrwith\")\n\n\n\t\n## Setup\nTo run this project, just run the functions at the bottom of code and call \"item_based_recommender\". That's it!\n\n## Developments \nIt can be achieved more precise results merging both item-based and user-based recommendation by calculating \"Weighted Average Recommendation Score\" and correlations. It is developed based on the previous projects. It become more likely a recommendation system like Netflix uses which is a hybrid system.\n\n\n\n"}}