{"cell_type":{"539a8bf9":"code","8d405e06":"code","97db079e":"code","54ad7be3":"code","9fa2c678":"code","5ded5d6c":"code","e8e33ea5":"code","57e21b73":"code","81674b3a":"code","e78d7974":"code","aa315f4d":"code","99c32421":"code","d6aeffc1":"code","4ae455e1":"code","37592420":"code","eea20c0d":"code","fbdae8a8":"code","5d7d80f7":"code","2d2fe5c3":"code","276d7dcc":"code","84f792af":"code","4debea70":"code","adbc1629":"code","7c4fe0bb":"markdown","e2e04b9b":"markdown","ad91c46e":"markdown","26b27fdd":"markdown","92c1b173":"markdown","53bfe5f5":"markdown","ac829c61":"markdown","d5cb879a":"markdown","80c9f404":"markdown","0a7e497c":"markdown","c1aa5bde":"markdown","01a71409":"markdown","b799ef9b":"markdown","f1132130":"markdown","201f8bd5":"markdown","e951edd2":"markdown"},"source":{"539a8bf9":"import pandas as pd \nimport numpy as np \nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport datetime as dt\nimport time\nfrom statsmodels.tsa.holtwinters import Holt\nfrom statsmodels.tsa.arima_model import ARIMA\n# Simple Exponential Smoothing\nfrom statsmodels.tsa.holtwinters import ExponentialSmoothing\nfrom sklearn import metrics\n#pd.set_option('display.max_columns',None)\n#pd.set_option('display.max_rows',None)","8d405e06":"data = pd.read_csv('\/kaggle\/input\/sunspots\/Sunspots.csv',index_col=0,#parse_dates=['Date'],\n                   names=['Date','Total_Sunspots'],header=0)\ndata.tail(100)","97db079e":"data = data.loc[(data['Date']>='1751') & (data['Date']<='2001'),['Date','Total_Sunspots']]\ndata.reset_index(inplace=True)\ndata.drop('index',axis=1,inplace=True)\ndata","54ad7be3":"data['nth_year'] = [str(d)[3] for d in data.Date]\ndata['nth_year']=data['nth_year'].replace('0','10')\ndata","9fa2c678":"data['Date'] = pd.to_datetime(data['Date'])\ndata['nth_year'] = data['nth_year'].astype(float)","5ded5d6c":"plt.plot(data['Total_Sunspots'])","e8e33ea5":"data['year'] = pd.DatetimeIndex(data['Date']).year\ndata['month'] = [d.strftime('%b') for d in data.Date]\ndata","57e21b73":"fig, axes = plt.subplots(3, 1, figsize=(20,15), dpi= 80)\nsns.boxplot(x='year', y='Total_Sunspots', data=data, ax=axes[0])\nsns.boxplot(x='nth_year', y='Total_Sunspots', data=data,ax = axes[1])\nsns.boxplot(x='month', y='Total_Sunspots', data=data,ax = axes[2])\n\n# Set Title\naxes[0].set_title('Year-wise Box Plot\\n(The Trend)', fontsize=18); \n\naxes[1].set_title('Nth_year-wise Box Plot\\n(The Seasonality)', fontsize=18)\n\naxes[2].set_title('Month-wise Box Plot\\n(The Seasonality)', fontsize=18)\nplt.show()","81674b3a":"data.set_index('Date',inplace=True)","e78d7974":"from statsmodels.tsa.seasonal import seasonal_decompose\nfrom dateutil.parser import parse\n\n# Import Data\n# Multiplicative Decomposition \n#result_mul = seasonal_decompose(data['Total_Sunspots'], model='multiplicative', extrapolate_trend='freq')\n\n# Additive Decomposition\nresult_add = seasonal_decompose(data['Total_Sunspots'], model='additive', extrapolate_trend='freq',freq=96)\n\n# Plot\nplt.rcParams.update({'figure.figsize': (5,5)})\n#result_mul.plot().suptitle('Multiplicative Decompose', fontsize=22)\nresult_add.plot().suptitle('Additive Decompose', fontsize=22)\nplt.show()","aa315f4d":"data['rolling_mean'] = data['Total_Sunspots'].rolling(12).mean()\ndata['Detrend'] = data['Total_Sunspots'] - data['rolling_mean']\ndata","99c32421":"plt.plot(data['Detrend'])\nplt.title('Detrended',fontsize=16)","d6aeffc1":"# Using statmodels: Subtracting the Trend Component.\nfrom statsmodels.tsa.seasonal import seasonal_decompose\nresult_add = seasonal_decompose(data['Total_Sunspots'], model='add', extrapolate_trend='freq',freq=96)\ndetrended = data.Total_Sunspots.values -result_add.trend\nplt.plot(detrended)\nplt.title('Drug Sales detrended by subtracting the trend component', fontsize=16)","4ae455e1":"from statsmodels.tsa.seasonal import seasonal_decompose\nresult_add = seasonal_decompose(data['Total_Sunspots'], model='add', extrapolate_trend='freq',freq=96)\ndeseasonalized = data.Total_Sunspots.values -result_add.seasonal\nplt.plot(deseasonalized)\nplt.title('Drug Sales deseasonalized by subtracting the seasonal component', fontsize=16)","37592420":"from pandas.plotting import autocorrelation_plot\n\n\n# Draw Plot\nplt.rcParams.update({'figure.figsize':(9,5), 'figure.dpi':120})\nautocorrelation_plot(data['Total_Sunspots'].tolist())","eea20c0d":"from statsmodels.tsa.stattools import acf, pacf\nfrom statsmodels.graphics.tsaplots import plot_acf, plot_pacf\n\n# Draw Plot\nfig, axes = plt.subplots(1,2,figsize=(16,3), dpi= 100)\nplot_acf(data['Total_Sunspots'].tolist(), lags=100, ax=axes[0])\nplot_pacf(data['Total_Sunspots'].tolist(), lags=50, ax=axes[1])","fbdae8a8":"count = int(data.shape[0]*0.8)\nTrain = data[:count]\nTest = data[count:]\n\ny_hat_avg = Test.copy()\nfit1 = Holt(np.asarray(Train['Total_Sunspots'])).fit()\ny_hat_avg['Holt_Winter'] = fit1.predict(start=count+1,end=data.shape[0])\nplt.figure(figsize=(16,8))\nplt.plot(Train.index, Train['Total_Sunspots'], label='Train')\nplt.plot(Test.index,Test['Total_Sunspots'], label='Test')\nplt.plot(y_hat_avg.index,y_hat_avg['Holt_Winter'], label='Holt_Winter')\nplt.legend(loc='best')\n# plt.savefig('Holt_Winters.jpg')","5d7d80f7":"new = data[['Total_Sunspots']]\nnew","2d2fe5c3":"new.index.freq = 'M' # Start of the month\nTrain, Test = new.iloc[:count, 0], data.iloc[count:, 0]\n\nmodel = ExponentialSmoothing(Train, trend='add', seasonal='add', seasonal_periods=12, damped=True)\nhw_model = model.fit(optimized=True, use_boxcox=False, remove_bias=False)\npred = hw_model.predict(start=Test.index[0], end=Test.index[-1])\n\nplt.plot(Train.index, Train, label='Train')\nplt.plot(Test.index, Test, label='Test')\nplt.plot(pred.index, pred, label='Holt-Winters')\nplt.legend(loc='best');","276d7dcc":"history = [x for x in Train]","84f792af":"predictions = []\nlower_list = []\nupper_list = []\nfor t in range(len(Test)):\n    model = ARIMA(history, order=(5,0,1))\n    model_fit = model.fit(disp=0)\n    output = model_fit.forecast()\n    yhat = output[0]\n    lower = output[2][0][0]\n    upper = output[2][0][1]\n    predictions.append(yhat)\n    lower_list.append(lower)\n    upper_list.append(upper)\n    obs = Test[t]\n    history.append(obs)\n    print('predicted=%f, expected=%f' % (yhat, obs))","4debea70":"error = metrics.mean_squared_error(Test, predictions)\nprint('Test MSE: %.3f' % error)","adbc1629":"# plot\nplt.plot(Test.values,color='black')\nplt.plot(lower_list,color='red')\nplt.plot(upper_list,color='green')\nplt.plot(predictions)\nplt.show()","7c4fe0bb":"Below is the plot for orginal test data values, predicted values and confidance interval.","e2e04b9b":"## Holt Winter's Model","ad91c46e":"## ARMA Model\n\nremoving the differencing parameter","26b27fdd":"Detrending Manually","92c1b173":"Let's do the analysis on data from 1751 to 2000. That's 250 years.","53bfe5f5":"Creating a new column called nth_year where each value in the column is an integer which represents 1 if it is 1st year of the decade or 2 if it is 2nd year of the decade and so on. This column is created to analyze if any seasonality exists in the data for 25 decades.","ac829c61":"Deseasonalizing using seasonal decompose","d5cb879a":"Detrending using seasonal_decompose","80c9f404":"Now we have to observe the trend and seasonality clearly. For that we use boxlots.","0a7e497c":"We make a list for training data and we will be predicting next day's closing price with this data. Later the predicted value is appended to training data and next day's value is predicted again. This is repeated for all the test data.\n\nARIMA's forecast function gives 4 outputs.\n\npredicted value\n\nstandard error\n\nlower and upper confidance values which are very important when predicting on time series data.","c1aa5bde":"In the below plot you will see that there is some seasonality. By looking closer we can observe that after every 8-9 years the pattern is repeating. Also we can observe that after a specific period of time the number of sunspots start to decrease and then start to increase.","01a71409":"## Holt Winter's using exponential smoothing\n\nEven with exponential smoothing we did not get good predictions.","b799ef9b":"acf plot helps us understand whether the data in additive or multiplicatve in some way. By looking at the plot we can improvise our understanding from above plot and say that present value depends on previous 25-27 values.\n\npacf plot further says that present value depends only on previous 6 values. All these plots help us narrow down thinking and make our model efficient.","f1132130":"Converting date column to datetime object and nth_year to float type.","201f8bd5":"Extracting year and month from the date column.","e951edd2":"Autocorrelation plot\n\nThis helps us to find if current value depends on previous values. In the plot you can observe that current value is dependent on previous 110-125 values. This can be around 8-10 years as it is monthly data."}}