{"cell_type":{"7df01789":"code","2dbe4fb4":"code","eb81970f":"code","38dbb909":"code","fab63cf8":"code","24519a49":"code","22297d53":"code","cba80577":"code","903f89cb":"code","b1e17fc3":"code","04f9ac2a":"code","7aac7dfc":"code","b5c69414":"code","3c844129":"code","e7ab40a8":"code","a408a5fe":"code","00182c44":"code","ac0365af":"code","d265625d":"code","daa2e2c3":"code","5fb3eedd":"code","87229925":"code","0611a3be":"code","ec3603dd":"code","60394dc2":"markdown","29b63136":"markdown","5282a47d":"markdown","944895c8":"markdown","a78aa3aa":"markdown","00a32cca":"markdown","ff694399":"markdown","3ea02d48":"markdown","bf099743":"markdown","80c4bc4b":"markdown","10e918a3":"markdown","49699065":"markdown","4d1aa77b":"markdown","488eeea3":"markdown","cce3aca8":"markdown","13cf7d6d":"markdown","b300a130":"markdown","f37e2f2e":"markdown","2e5b73ae":"markdown","b368495a":"markdown","b30b1a4f":"markdown","691d654c":"markdown","350b51c9":"markdown","a3102261":"markdown","6295842c":"markdown","0aafde0f":"markdown","f1529855":"markdown","2221cead":"markdown","580bb07e":"markdown","29a30346":"markdown"},"source":{"7df01789":"# basic python libraries\nimport pandas as pd\nimport numpy as np\nimport matplotlib\nimport plotly\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly.express as px\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots\nimport plotly.figure_factory as ff\nfrom matplotlib import cm\nfrom collections import OrderedDict\nmatplotlib.rcParams['figure.dpi'] = 200\nmatplotlib.rcParams['figure.figsize'] = (15, 5)\nfrom scipy.stats import norm, shapiro\nfrom colorama import Fore, Back, Style\nfrom mlxtend.plotting import plot_confusion_matrix\nfrom plotly.offline import plot, iplot, init_notebook_mode\nfrom statsmodels.formula.api import ols\nfrom scipy import stats\n\n\n# sklearn libraries\nfrom sklearn.model_selection import StratifiedKFold, train_test_split, cross_val_score, StratifiedShuffleSplit\nfrom sklearn.metrics import accuracy_score, classification_report, confusion_matrix, roc_auc_score\nfrom sklearn.preprocessing import StandardScaler, PowerTransformer, QuantileTransformer\nfrom sklearn.model_selection import GridSearchCV\n\n# feature selection library\nfrom mlxtend.feature_selection import SequentialFeatureSelector\nfrom sklearn.feature_selection import SelectFromModel\n\n# model building libraries\nfrom sklearn.ensemble import RandomForestClassifier,GradientBoostingClassifier,ExtraTreesClassifier,VotingClassifier,StackingClassifier\nfrom lightgbm import LGBMClassifier\nfrom xgboost import XGBClassifier\nfrom catboost import CatBoostClassifier\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.naive_bayes import BernoulliNB, GaussianNB\nfrom sklearn.linear_model import LogisticRegressionCV, LogisticRegression\nfrom sklearn.svm import SVC, NuSVC\nfrom sklearn.neighbors import KNeighborsClassifier\n\n# warning library\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n\n# setting basic options\ninit_notebook_mode(connected=True)\npd.set_option('display.max_columns', None)\n%matplotlib inline","2dbe4fb4":"# importing dataset\ndata = pd.read_csv(r'..\/input\/heart-disease\/heart.csv', error_bad_lines = False)\nprint(\"Shape of the data is {}.\".format(data.shape))","eb81970f":"data.head().style.background_gradient(cmap='viridis')","38dbb909":"# getting the death event distribution\nlabels = data.target.value_counts(normalize = True)*100 \nfig = px.pie(labels, values= 'target', names = ['Disease', 'No Disease'], title='Target Distribution across whole dataset')\nfig.show()","fab63cf8":"# unique values of columns\nfor col in data.columns.tolist():\n    print(col,\": \",display(data[col].describe().to_frame().style.background_gradient(cmap='RdPu')), \"\\n\")","24519a49":"# age distribution across whole dataset\n\nhist_data =[data[\"age\"].values]\ngroup_labels = ['age'] \n\nfig = ff.create_distplot(hist_data, group_labels)\nfig.update_layout(title_text='Age Distribution plot')\n\nfig.show()","22297d53":"# lets see the distribution of age with respect to the target label\nfig = px.box(data, x='target', y='age', points=\"all\")\nfig.update_layout(title_text=\"Target wise Age Spread - Unhealthy = 1 Healthy =0\")\nfig.show()","cba80577":"# lets see those people who are having age of 40-60 and get the gender distribution\ntemp_df = data[(data['age']>=40) & (data['age']<=60)]\nmale = temp_df[temp_df[\"sex\"]==1]\nfemale = temp_df[temp_df[\"sex\"]==0]\n\nmale_survi = male[temp_df[\"target\"]==0]\nmale_not = male[temp_df[\"target\"]==1]\nfemale_survi = female[temp_df[\"target\"]==0]\nfemale_not = female[temp_df[\"target\"]==1]\n\nlabels = ['Male - Healthy','Male - Not Healthy', \"Female -  Healthy\", \"Female - Not Healthy\"]\nvalues = [len(male[temp_df[\"target\"]==0]),len(male[temp_df[\"target\"]==1]),\n         len(female[temp_df[\"target\"]==0]),len(female[temp_df[\"target\"]==1])]\nfig = go.Figure(data=[go.Pie(labels=labels, values=values, hole=.4)])\nfig.update_layout(\n    title_text=\"Age (40-60)yrs - Analysis on Healthy - Sex\")\nfig.show()\n\n# Analysis on Healthy Ratio between Male and Female\nlabels = ['Male - Healthy Ratio',\"Female -  Healthy Ratio\"]\nvalues = [(len(male[temp_df[\"target\"]==0])\/(len(male[temp_df[\"target\"]==0]) + len(male[temp_df[\"target\"]==1]))),\n          (len(female[temp_df[\"target\"]==0])\/(len(female[temp_df[\"target\"]==0]) + len(female[temp_df[\"target\"]==1])))]\nfig = go.Figure(data=[go.Pie(labels=labels, values=values, hole=.4)])\nfig.update_layout(\n    title_text=\"Age (40-60)yrs - Analysis on Healthy Ratio between Male and Female\")\nfig.show()","903f89cb":"fig = px.violin(data, y=\"age\", x=\"exang\", box=True, color=\"target\", points=\"all\", hover_data=data.columns)\nfig.update_layout(title_text=\"Analysis in Age and Excercise induced Angina on Healthy Status\")\nfig.show()","b1e17fc3":"# count of different values present in Chest pain column\nf,ax = plt.subplots(1,1,figsize=(15,5))\nsns.set(font_scale=1)\nsns.countplot('cp',data=data, palette='Set2')","04f9ac2a":"# Analysis on Chest Pain where the patients are healthy.\nlabels = ['typical', 'asymptotic', 'nonanginal', 'nontypical']\nvalues = [len(data[(data['cp']==0) & (data['target'] == 1)]), \n          len(data[(data['cp']==1) & (data['target'] == 1)]),\n          len(data[(data['cp']==2) & (data['target'] == 1)]),\n          len(data[(data['cp']==3) & (data['target'] == 1)])]\nfig = go.Figure(data=[go.Pie(labels=labels, values=values, hole=.4)])\nfig.update_layout(\n    title_text=\"Analysis on Healthy percentage of Chest Pain types\")\nfig.show()","7aac7dfc":"temp_df = data.groupby(['cp', 'ca'])['target'].count().unstack().reset_index().fillna(0)\ncp=['Chest Pain - Typical', 'Chest Pain - Asymptotic', 'Chest Pain - Non Anginal', 'Chest Pain - Non Typical']\n\nfig = go.Figure(data=[\n    go.Bar(name='ca - 0', x=cp, y=temp_df[0]),\n    go.Bar(name='ca - 1', x=cp, y=temp_df[1]),\n    go.Bar(name='ca - 2', x=cp, y=temp_df[2]),\n    go.Bar(name='ca - 3', x=cp, y=temp_df[3]),\n    go.Bar(name='ca - 4', x=cp, y=temp_df[4]),\n])\n# Change the bar mode\nfig.update_layout(barmode='group')\nfig.show()","b5c69414":"# Resting BP distribution across whole dataset\n\nhist_data =[data[\"trestbps\"].values]\ngroup_labels = ['Resting Blood Pressure'] \n\nfig = ff.create_distplot(hist_data, group_labels)\nfig.update_layout(title_text='Resting Blood Pressure Distribution plot')\n\nfig.show()","3c844129":"# survival distribution on the basis of resting BP\ns = data[data['target']==0]['trestbps']\nns = data[data['target']==1]['trestbps']\nhist_data = [s,ns]\ngroup_labels = ['Survived', 'Not Survived']\nfig = ff.create_distplot(hist_data, group_labels, bin_size=0.5)\nfig.update_layout(\n    title_text=\"Distribution in Resting BP on Survival Status\")\nfig.show()","e7ab40a8":"# getting the distribution of different continuous columns\ncontinuous_variables = [\n    'age',\n    'trestbps',\n    'chol',\n    'thalach',\n    'oldpeak'\n]\nsns.pairplot(data, hue=\"target\", palette=\"husl\", vars = continuous_variables, kind = 'scatter', markers=[\"o\", \"s\"],\n             corner = True, diag_kind = 'kde')","a408a5fe":"# distribution of serum cholestoral with respect to the target variable\ns, ns = data[data['target']==0]['chol'], data[data['target']==1]['chol']\nhist_data = [s,ns]\ngroup_labels = ['Survived', 'Not Survived']\nfig = ff.create_distplot(hist_data, group_labels, bin_size=0.5)\nfig.update_layout(\n    title_text=\"Distribution in Serum Cholestoral on Survival Status\")\nfig.show()\n\n# distribution of maximum Heart rate recieved with respect to the target variable\ns, ns = data[data['target']==0]['thalach'], data[data['target']==1]['thalach']\nhist_data = [s,ns]\ngroup_labels = ['Survived', 'Not Survived']\nfig = ff.create_distplot(hist_data, group_labels, bin_size=0.5)\nfig.update_layout(\n    title_text=\"Distribution in Maximum Heartrate recieved on Survival Status\")\nfig.show()\n\n# distribution of oldpeak with respect to the target variable\ns, ns = data[data['target']==0]['oldpeak'], data[data['target']==1]['oldpeak']\nhist_data = [s,ns]\ngroup_labels = ['Survived', 'Not Survived']\nfig = ff.create_distplot(hist_data, group_labels, bin_size=0.5)\nfig.update_layout(\n    title_text=\"Distribution in Oldpeak on Survival Status\")\nfig.show()","00182c44":"# categorical columns\n# Analysis on Fasting blood sugar > 120 mg\/dL, where the patients are healthy or unhealthy.\nlabels = ['FBS >= 120mg\/dL and Healthy', 'FBS >= 120mg\/dL and Not Healthy', 'FBS < 120mg\/dL and Healthy', 'FBS < 120mg\/dL and Not Healthy']\nvalues = [len(data[(data['fbs']==1) & (data['target'] == 1)]), \n          len(data[(data['fbs']==1) & (data['target'] == 0)]),\n          len(data[(data['fbs']==0) & (data['target'] == 1)]),\n          len(data[(data['fbs']==0) & (data['target'] == 0)])]\nfig = go.Figure(data=[go.Pie(labels=labels, values=values, hole=.4)])\nfig.update_layout(\n    title_text=\"Analysis on Healthy percentage of Fasting blood sugar > 120 mg\/dL\")\nfig.show()\n\n# Analysis on Resting ECG, where the patients are healthy or unhealthy.\nlabels = ['rest ecg = 0 and Healthy', 'rest ecg = 0 and Not Healthy',\n          'rest ecg = 1 and Healthy', 'rest ecg = 1 and Not Healthy',\n          'rest ecg = 2 and Healthy', 'rest ecg = 2 and Not Healthy'\n         ]\nvalues = [len(data[(data['restecg']==0) & (data['target'] == 1)]), \n          len(data[(data['restecg']==0) & (data['target'] == 0)]),\n          len(data[(data['restecg']==1) & (data['target'] == 1)]),\n          len(data[(data['restecg']==1) & (data['target'] == 0)]),\n          len(data[(data['restecg']==2) & (data['target'] == 1)]),\n          len(data[(data['restecg']==2) & (data['target'] == 0)])]\nfig = go.Figure(data=[go.Pie(labels=labels, values=values, hole=.4)])\nfig.update_layout(\n    title_text=\"Analysis on Healthy percentage of Resting Electrographic results\")\nfig.show()\n\n# Analysis on Excercise induced angina, where the patients are healthy or unhealthy.\nlabels = ['Exang is present and Healthy', 'Exang is present and Not Healthy',\n          'Exang is absent and Healthy', 'Exang is absent and Not Healthy'\n         ]\nvalues = [len(data[(data['exang']==1) & (data['target'] == 1)]), \n          len(data[(data['exang']==1) & (data['target'] == 0)]),\n          len(data[(data['exang']==0) & (data['target'] == 1)]),\n          len(data[(data['exang']==0) & (data['target'] == 0)])\n         ]\nfig = go.Figure(data=[go.Pie(labels=labels, values=values, hole=.4)])\nfig.update_layout(\n    title_text=\"Analysis on Healthy percentage of Excercise induced Angina\")\nfig.show()\n\n# Analysis on Slope, where the patients are healthy or unhealthy.\nlabels = ['slope = 0 and Healthy', 'slope = 0 and Not Healthy',\n          'slope = 1 and Healthy', 'slope = 1 and Not Healthy',\n          'slope = 2 and Healthy', 'slope = 2 and Not Healthy'\n         ]\nvalues = [len(data[(data['slope']==0) & (data['target'] == 1)]), \n          len(data[(data['slope']==0) & (data['target'] == 0)]),\n          len(data[(data['slope']==1) & (data['target'] == 1)]),\n          len(data[(data['slope']==1) & (data['target'] == 0)]),\n          len(data[(data['slope']==2) & (data['target'] == 1)]),\n          len(data[(data['slope']==2) & (data['target'] == 0)])\n         ]\nfig = go.Figure(data=[go.Pie(labels=labels, values=values, hole=.4)])\nfig.update_layout(\n    title_text=\"Analysis on Healthy percentage of Slope\")\nfig.show()","ac0365af":"# analysis of different continuous columns over chest pain\nfig = px.violin(data, y=\"trestbps\", x=\"cp\", box=True, color=\"target\", points=\"all\", hover_data=data.columns)\nfig.update_layout(title_text=\"Analysis in Resting BP and Chest Pain on Healthy Status\")\nfig.show()\n\nfig = px.violin(data, y=\"chol\", x=\"cp\", box=True, color=\"target\", points=\"all\", hover_data=data.columns)\nfig.update_layout(title_text=\"Analysis in Serum Cholestoral and Chest Pain on Healthy Status\")\nfig.show()\n\nfig = px.violin(data, y=\"thalach\", x=\"cp\", box=True, color=\"target\", points=\"all\", hover_data=data.columns)\nfig.update_layout(title_text=\"Analysis in Max heart rate and Chest Pain on Healthy Status\")\nfig.show()\n\nfig = px.violin(data, y=\"oldpeak\", x=\"cp\", box=True, color=\"target\", points=\"all\", hover_data=data.columns)\nfig.update_layout(title_text=\"Analysis in Oldpeak and Chest Pain on Healthy Status\")\nfig.show()","d265625d":"features = [\n     'age',\n     'sex',\n     'cp',\n     'trestbps',\n     'chol',\n     'fbs',\n     'restecg',\n     'thalach',\n     'exang',\n     'oldpeak',\n     'slope',\n     'ca',\n     'thal'\n]\n\ntarget = ['target']","daa2e2c3":"# splitting the dataset into train and test set\nxtrain, xtest, ytrain, ytest = train_test_split(data[features],\n                                                    data[target],\n                                                    stratify=data[target], test_size=0.20, random_state=42)\n\nprint(\"Shape of train set: \",(xtrain.shape, ytrain.shape))\nprint(\"Shape of test set: \",(xtest.shape, ytest.shape))","5fb3eedd":"mask = np.zeros_like(xtrain.corr())\nmask[np.triu_indices_from(mask)] = True\nwith sns.axes_style(\"white\"):\n    f, ax = plt.subplots(figsize=(15, 15))\n    ax = sns.heatmap(xtrain.corr(), mask=mask, square=True, annot = True)","87229925":"# Sequential Feature Selector Object and Configuring the Parameters -> Backward Elimination\nsfs_bw = SequentialFeatureSelector(LGBMClassifier(random_state = 0, n_jobs = -1, n_estimators = 20, max_depth = 4),\n          k_features = 5,\n          forward = False, \n          floating = False,\n          scoring = 'accuracy',\n          cv = 3,\n          n_jobs = -1)\n\n# Fit the object to the Training Data.\nprint(sfs_bw.fit(xtrain, np.ravel(ytrain)))\n# Print the Selected Features.\nselected_features_BW = xtrain.columns[list(sfs_bw.k_feature_idx_)]\nprint(selected_features_BW)","0611a3be":"top_features = ['sex', 'cp', 'exang', 'oldpeak', 'ca']\nmodel = LGBMClassifier(random_state = 0, n_jobs = -1, n_estimators = 20, max_depth = 3)\nmodel.fit(xtrain[top_features], ytrain)\npred = model.predict(xtest[top_features])\npred_proba = model.predict_proba(xtest[top_features])\nprint(\"\\n\\nClassification_score: \\n\", classification_report(ytest, pred))\nprint(\"\\n\\nThe ROC AUC Score is: \",roc_auc_score(ytest, pred_proba[:,1]))","ec3603dd":"cm = confusion_matrix(ytest, pred)\nplt.figure()\nplot_confusion_matrix(cm, figsize=(12,8), hide_ticks=True, cmap=plt.cm.Blues)\nplt.title(\"Light GBM Model - Confusion Matrix\")\nplt.xticks(range(2), [\"Heart Not Failed\",\"Heart Fail\"], fontsize=16)\nplt.yticks(range(2), [\"Heart Not Failed\",\"Heart Fail\"], fontsize=16)\nplt.show()","60394dc2":"___We can see that the non healthy distribution is more in range of 100-140. And the distribution is fairly similar.___","29b63136":"# <font color = '#F59E14'>Train test split<\/font>","5282a47d":"The target count is near to even distribution across the whole dataset.\n\n<font color=\"green\">This is a good sign<\/font>","944895c8":"* ___From here we got to know that males whose age lies between 40-60 yrs are more likely to stay healthy (71%) than females (29%)___ ","a78aa3aa":"___TASK___: _To predict whether a person will have a heart disease or not based on given conditions_\n***\n__Author of this notebook:__ ___Rudra Narayan Mishra___\n***","00a32cca":"_lets see those people who are having age of 40-60 and get the gender distribution with respect to target_","ff694399":"__Lets see how Chest Pain can affect the heart health__","3ea02d48":"__Checking out the distribution of chest pain over all continuous data columns__","bf099743":"lets see the how chest pain is accompained by number of major vessels colored by floroscopy","80c4bc4b":"# <font color='#000540'>Heart Disease<\/font>\n***","10e918a3":"__Lets see how age affects heart failure risk__","49699065":"__Distribution of different continuous variables__","4d1aa77b":"__Checking out all the distribution of survival probability over all categorical columns__","488eeea3":"* __Age 30-35__: _minimum patients are present_\n* __Age 36-50__: _moderate distribution of patients_\n* __Age 51-70__: _Large distribution of patients across the dataset_\n* __Age > 70__ : _minimum patients are present_","cce3aca8":"___No highly correlated features are there.___","13cf7d6d":"# <font color='#FF5762'>Importing Libraries<\/font>\n***","b300a130":"__Lets see the unique values of different columns__","f37e2f2e":"___Yay! I achieved a AUC score of 0.912 and recall is 100% in heart fail case!!!___\n\n__A recall of 100% is pretty good as it will rarely mispredict for those who have heart fail, and this point is very crucial.__","2e5b73ae":"* ___Here, we can see that people belonging to age group of 40-60 are more prone to heart failure risk.___","b368495a":"# <font color=\"#5650F2\">Exploratory Data Analysis<\/font>\n***","b30b1a4f":"#### Lets move on to Feature selection","691d654c":"__The columns present are:__\n\n___Age___: Age\n\n___Sex___: Sex (1 = male; 0 = female)\n\n___ChestPain___: Chest pain (typical, asymptotic, nonanginal, nontypical)\n\n___tRestBPs___: Resting blood pressure\n\n___Chol___: Serum cholestoral in mg\/dl\n\n___Fbs___: Fasting blood sugar > 120 mg\/dl (1 = true; 0 = false)\n\n___RestECG___: Resting electrocardiographic results\n\n___MaxHR___: Maximum heart rate achieved\n\n___ExAng___: Exercise induced angina (1 = yes; 0 = no)\n\n___Oldpeak___: ST depression induced by exercise relative to rest\n\n___Slope___: Slope of the peak exercise ST segment\n\n___Ca___: Number of major vessels colored by flourosopy (0 - 3)\n\n___Thal___: (3 = normal; 6 = fixed defect; 7 = reversable defect)\n\n___target___: AHD - Diagnosis of heart disease (1 = yes; 0 = no)\n\n***","350b51c9":"# <font color=\"#3DDBC5\">Data Importing<\/font>\n<hr><\/hr>","a3102261":"___The resting BP values are densely distributed from 100 to 160 range.___","6295842c":"# <font color='#F85712'>Feature Selection and Model Building<\/font>\n***","0aafde0f":"__Lets see the distribution of resting blood pressure in the dataset__","f1529855":"__Lets find the output count in this dataset.__","2221cead":"___These are the final features to be used for modelling___","580bb07e":"* ___Patients with `nontypical` type of chest pain have least chances of being healthy and similarly, `typical` type of chest pain has less chances of being healthy___\n\n* ___Patients with `nonanginal` type od=f chest pain have highest chances of being healthy and also there is a fair of being healthy if the patient is having `asymptotic` type of chest pain.___","29a30346":"# <font color = '#EB7B13'>THE END<\/font>\n***\n### If you enjoyed this, a upvote can motivate me further. Thanks!!!\n***"}}