{"cell_type":{"50e4aaab":"code","1a043826":"code","67840a91":"code","1cb79573":"code","c865e797":"code","624aae14":"code","09abb0b0":"code","8acc85c9":"code","d488f8e4":"code","1048498d":"code","9ca7fb37":"code","d8eb27f1":"code","53b7d0a4":"code","3fd96078":"code","3053801c":"code","8e45215a":"code","1438b235":"code","8128e9cd":"code","4ce5fd1a":"code","e67abdef":"code","ce42f307":"code","a2198986":"code","d4563af9":"markdown","45cc5270":"markdown","e846dd83":"markdown","c92c5358":"markdown","134390d0":"markdown","66cb6f6e":"markdown","f3d837ea":"markdown","1a0c1d28":"markdown","abd85346":"markdown","1af55032":"markdown","e7f1c8ee":"markdown","3b4f387a":"markdown","05553d2d":"markdown","b2defb87":"markdown","74ed85d0":"markdown","7c905bc7":"markdown","7c6ca573":"markdown","2d717f1d":"markdown","14f1aaaa":"markdown","0fa99e28":"markdown","8cb7d591":"markdown","b6721781":"markdown"},"source":{"50e4aaab":"IS_LOCAL = True\nimport numpy as np\nimport pandas as pd\nfrom skimage.io import imread\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom glob import glob\nif(IS_LOCAL):\n    import pydicom as dicom\nelse:\n    import dicom\nimport os\n\n\nif(IS_LOCAL):\n    PATH=\"..\/input\/siim-medical-images\"\nelse:\n    PATH=\"..\/input\/\"\nprint(os.listdir(PATH))","1a043826":"data_df = pd.read_csv(PATH+\"\/overview.csv\")","67840a91":"print(\"CT Medical images -  rows:\",data_df.shape[0],\" columns:\", data_df.shape[1])","1cb79573":"data_df.head()","c865e797":"print(\"Number of TIFF images:\", len(os.listdir(PATH+\"\/tiff_images\")))","624aae14":"tiff_data = pd.DataFrame([{'path': filepath} for filepath in glob(PATH+'\/tiff_images\/*.tif')])","09abb0b0":"def process_data(path):\n    data = pd.DataFrame([{'path': filepath} for filepath in glob(PATH+path)])\n    data['file'] = data['path'].map(os.path.basename)\n    data['ID'] = data['file'].map(lambda x: str(x.split('_')[1]))\n    data['Age'] = data['file'].map(lambda x: int(x.split('_')[3]))\n    data['Contrast'] = data['file'].map(lambda x: bool(int(x.split('_')[5])))\n    data['Modality'] = data['file'].map(lambda x: str(x.split('_')[6].split('.')[-2]))\n    return data","8acc85c9":"tiff_data = process_data('\/tiff_images\/*.tif')","d488f8e4":"tiff_data.head(10)","1048498d":"print(\"Number of DICOM files:\", len(os.listdir(PATH+\"\/dicom_dir\")))","9ca7fb37":"dicom_data = process_data('\/dicom_dir\/*.dcm')","d8eb27f1":"dicom_data.head(10)","53b7d0a4":"def countplot_comparison(feature):\n    fig, (ax1, ax2, ax3) = plt.subplots(1,3, figsize = (16, 4))\n    s1 = sns.countplot(data_df[feature], ax=ax1)\n    s1.set_title(\"Overview data\")\n    s2 = sns.countplot(tiff_data[feature], ax=ax2)\n    s2.set_title(\"Tiff files data\")\n    s3 = sns.countplot(dicom_data[feature], ax=ax3)\n    s3.set_title(\"Dicom files data\")\n    plt.show()","3fd96078":"countplot_comparison('Contrast')","3053801c":"countplot_comparison('Age')","8e45215a":"def show_images(data, dim=16, imtype='TIFF'):\n    img_data = list(data[:dim].T.to_dict().values())\n    f, ax = plt.subplots(4,4, figsize=(16,20))\n    for i,data_row in enumerate(img_data):\n        if(imtype=='TIFF'): \n            data_row_img = imread(data_row['path'])\n        elif(imtype=='DICOM'):\n            data_row_img = dicom.read_file(data_row['path'])\n        if(imtype=='TIFF'):\n            ax[i\/\/4, i%4].matshow(data_row_img,cmap='gray')\n        elif(imtype=='DICOM'):\n            ax[i\/\/4, i%4].imshow(data_row_img.pixel_array, cmap=plt.cm.bone) \n        ax[i\/\/4, i%4].axis('off')\n        ax[i\/\/4, i%4].set_title('Modality: {Modality} Age: {Age}\\nSlice: {ID} Contrast: {Contrast}'.format(**data_row))\n    plt.show()\n","1438b235":"show_images(tiff_data,16,'TIFF')","8128e9cd":"show_images(dicom_data,16,'DICOM')","4ce5fd1a":"dicom_file_path = list(dicom_data[:1].T.to_dict().values())[0]['path']\ndicom_file_dataset = dicom.read_file(dicom_file_path)\ndicom_file_dataset","e67abdef":"print(\"Modality: {}\\nManufacturer: {}\\nPatient Age: {}\\nPatient Sex: {}\\nPatient Name: {}\\nPatient ID: {}\".format(\n    dicom_file_dataset.Modality, \n    dicom_file_dataset.Manufacturer,\n    dicom_file_dataset.PatientAge,\n    dicom_file_dataset.PatientSex,\n    dicom_file_dataset.PatientName,\n    dicom_file_dataset.PatientID))","ce42f307":"def show_dicom_images(data):\n    img_data = list(data[:16].T.to_dict().values())\n    f, ax = plt.subplots(4,4, figsize=(16,20))\n    for i,data_row in enumerate(img_data):\n\n        data_row_img = dicom.read_file(data_row['path'])\n        modality = data_row_img.Modality\n        age = data_row_img.PatientAge\n        \n        ax[i\/\/4, i%4].imshow(data_row_img.pixel_array, cmap=plt.cm.bone) \n        ax[i\/\/4, i%4].axis('off')\n        ax[i\/\/4, i%4].set_title('Modality: {} Age: {}\\nSlice: {} Contrast: {}'.format(\n         modality, age, data_row['ID'], data_row['Contrast']))\n    plt.show()\n","a2198986":"show_dicom_images(dicom_data)","d4563af9":"# <a id=\"2\">Load packages<\/a>\n\nWe will load the packages for showing tiff images and dicom data.   \nFor dicom data, we are loading the **dicom**package.   \n","45cc5270":"The values in the 3 data sources are consistent.","e846dd83":"# References\n\n[1] <a href=\"https:\/\/www.kaggle.com\/kmader\">Kevin Mader<\/a>,  <a href=\"https:\/\/www.kaggle.com\/kmader\/show-the-data-in-the-zip-file\">Show the data in the Zip File<\/a>    \n[2] <a href=\"https:\/\/www.kaggle.com\/byrachonok\">Vitaly Byrachonok<\/a>,  <a href=\"https:\/\/www.kaggle.com\/byrachonok\/study-ct-medical-images\">Study CT Medical Images<\/a>    \n[3] Python package for processing DICOM data, dicom-numpy, https:\/\/dicom-numpy.readthedocs.io     \n[4] Viewing DICOM images in Python, https:\/\/pydicom.github.io\/pydicom\/stable\/viewing_images.html   \n\n\n","c92c5358":"### Check DICOM data","134390d0":"## <a id=\"43\">Show DICOM data<\/a>\n\nWe will show a subsample of 16 images from the total of 100 images.   \nWe will use grayscale.   \nIdeally, if the DICOM images would be a set of slices from a single examen, they could be aggregated using a function like the one shown here: extract_voxel_data - which read the DICOM slices (each in a separate file) and aggregate the image data in a 3D voxel tensor. This will not be the case here, because we are storing slices from different patients and exams (one slice \/ exam \/ patient).","66cb6f6e":"    # extract voxel data  \n    def extract_voxel_data(list_of_dicom_files):  \n        datasets = [dicom.read_file(f) for f in list_of_dicom_files]  \n         try:  \n             voxel_ndarray, ijk_to_xyz = dicom_numpy.combine_slices(datasets)  \n         except dicom_numpy.DicomImportException as e:  \n         # invalid DICOM data  \n             raise  \n         return voxel_ndarray  ","f3d837ea":"## <a id=\"41\">Check data consistency<\/a>\n\nLet's verify if the content in overview.csv is consistent with the data in tiff_images folder.","1a0c1d28":"<h1><center><font size=\"6\">Visualize CT DICOM Data<\/font><\/center><\/h1>\n\n<img src=\"https:\/\/kaggle2.blob.core.windows.net\/datasets-images\/1012\/1826\/dcf783d7dd5f628dccb49111ade64649\/dataset-card.jpg\" width=400><\/img>  \n\n# <a id='0'>Content<\/a>\n\n- <a href='#1'>Introduction<\/a>  \n- <a href='#2'>Load packages<\/a>  \n- <a href='#3'>Read the data<\/a> \n    - <a href='#31'>Read overview data<\/a> \n    - <a href='#32'>Read TIFF data<\/a> \n    - <a href='#33'>Read DICOM data<\/a>  \n- <a href='#4'>Data exploration<\/a>\n    - <a href='#41'>Check data consistency<\/a> \n    - <a href='#42'>Show TIFF images<\/a> \n    - <a href='#43'>Show DICOM data<\/a> \n- <a href='#7'>Conclusions<\/a>\n- <a href='#8'>References<\/a>","abd85346":"We can extract various fields from the DICOM FileDataset. Here are few examples:  \n* Modality  \n* Manufacturer\n* Patient Age  \n* Patient Sex\n* Patient Name  \n* Patient ID\n\n","1af55032":"Some of the information are anonymized (like Name and ID), which is common standard for public medical data.   \n\nWe will modify the visualization function, to show parameters from the DICOM data instead of the parameters extracted from the image name.  \n\n","e7f1c8ee":"## <a id=\"33\">Read DICOM data<\/a>","3b4f387a":"# <a id=\"4\">Data exploration<\/a>","05553d2d":"### Check TIFF data\n\nLet's check the TIFF data","b2defb87":"# <a id=\"3\">Read the data<\/a>\n\n\n## <a id=\"31\">Read overview data<\/a>","74ed85d0":"# Conclusion\n\nWe demonstrated how we can load and show **TIFF** images.  \nAs well, using **dicom** and **dicom-numpy** packages, we demonstrated how to read and visualize **DICOM** data.  \nWe also explored preliminary the content of a DICOM data file and modified the visualization function to use (partially) DICOM data for the image attributes.\n","7c905bc7":"## <a id=\"32\">Read TIFF data<\/a>","7c6ca573":"## <a id=\"42\">Show TIFF images<\/a>\n\nWe will show a subsample of 16 images from the total of 100 images.     \nWe will select the first 16 images from the data set.   \nWe will use grayscale.   \nWe define here a generic function to represent both TIFF images and DICOM images.","2d717f1d":"### More about DICOM data\n\nA DICOM file containg much more information than the image itself that we represented. Let's glimpse, for one of the DICOM files, this information. We will read the first dicom file only and show this information.","14f1aaaa":"### Process DICOM data","0fa99e28":"# <a id=\"1\">Introduction<a\/>\n\n## Overview  \n\nThe dataset is designed to allow for different methods to be tested for examining the trends in CT image data associated with using contrast and patient age. The basic idea is to identify image textures, statistical patterns and features correlating strongly with these traits and possibly build simple tools for automatically classifying these images when they have been misclassified (or finding outliers which could be suspicious cases, bad measurements, or poorly calibrated machines)\n\n## Data\nThe data are a tiny subset of images from the cancer imaging archive. They consist of the middle slice of all CT images taken where valid age, modality, and contrast tags could be found.   TCIA Archive Link - https:\/\/wiki.cancerimagingarchive.net\/display\/Public\/TCGA-LUAD","8cb7d591":"We apply the function to show TIFF images.","b6721781":"### Process TIFF data"}}