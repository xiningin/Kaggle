{"cell_type":{"a4f84d6d":"code","2221693a":"code","67dbe9c6":"code","59fa5734":"code","1eb98dd2":"code","3f209d75":"code","ae4ed67c":"code","25406e03":"code","ae605288":"code","87b32dbd":"code","10671a47":"code","2a30de1c":"code","e4bbec7f":"code","99b4b8bf":"code","d6282148":"code","f3ef695b":"code","5d1b61b8":"code","ab8553bc":"code","4dad9f51":"code","6c21143b":"code","cee70830":"code","a0740cbb":"code","083c8d73":"code","7e92d697":"code","8a8801b4":"code","164f531c":"code","3bf843f3":"code","91563d10":"code","65d609b4":"code","1db5a530":"code","a3b0fead":"code","2083de0c":"code","9bb5b6be":"code","4e389ba2":"code","e9ec5684":"code","4881f6e3":"code","e2ef2f6c":"code","5d5038a1":"code","fe669512":"code","1141a837":"code","b4aea2a6":"code","6581de64":"code","2b63b2a7":"code","3a02e3ac":"code","1ec6a8c0":"code","ebae14b6":"code","11027c7c":"code","d8666095":"code","b60fc217":"code","05389e64":"code","6b44c2fc":"code","83aa953c":"code","f661927a":"code","d169999b":"code","81d350fd":"code","d67ae481":"code","1b8d5158":"code","693d5da5":"code","58c35224":"code","2bb652ad":"code","6f671f04":"code","8044ad39":"code","4df2eb1a":"code","a392beab":"code","64441c1f":"code","5b2a50ef":"code","111f8084":"markdown","d63f4032":"markdown","495c47be":"markdown","cbc815f6":"markdown","59619667":"markdown","2d3421a0":"markdown","406aa992":"markdown","753fb8b5":"markdown"},"source":{"a4f84d6d":"import numpy as np\nimport pandas as pd\nfrom statsmodels.tsa.stattools import adfuller\nimport scipy\nimport matplotlib.pyplot as plt\nfrom fbprophet import Prophet\nimport seaborn as sns\nfrom statsmodels.tsa.statespace.sarimax import SARIMAX\nimport datetime as dt","2221693a":"data = pd.read_csv('..\/input\/supermarket-sales\/supermarket_sales - Sheet1.csv')\ndata.head()","67dbe9c6":"# NO Duplicate Values\ndata[data['Invoice ID'].duplicated()]","59fa5734":"# No Null In First Observation\ndata.info()","1eb98dd2":"print(data['Branch'].value_counts())\nprint('-----------------------------------------------------------------')\nprint(data['Customer type'].value_counts())\nprint('------------------------------------------------------------------')\nprint(data['Gender'].value_counts())\nprint('-----------------------------------------------------------------')\nprint(data['Product line'].value_counts())\nprint('------------------------------------------------------------------')\nprint(data['Payment'].value_counts())\nprint('-----------------------------------------------------------------')\n","3f209d75":"#sns.pairplot(data, hue='Rating')","ae4ed67c":"data.select_dtypes(['float64', 'int64']).columns","25406e03":"fig, (ax1, ax2) = plt.subplots(2)\nfig.suptitle('Histogram & BoxPlot')\nax1.boxplot(data['Unit price'])\nax2.hist(data['Unit price'], bins= 50)","ae605288":"plt.figure(figsize=(10, 10))\nfig, (ax1, ax2) = plt.subplots(1, 2)\nfig.suptitle('Histogram & BoxPlot')\nax1.boxplot(data['Quantity'])\nax2.hist(data['Quantity'])","87b32dbd":"fig, (ax1, ax2) = plt.subplots(1, 2)\nfig.suptitle('Histogram & BoxPlot')\nax1.boxplot(data['Tax 5%'])\nax2.hist(data['Tax 5%'])","10671a47":"fig, (ax1, ax2) = plt.subplots(1, 2)\nfig.suptitle('Histogram & BoxPlot')\nax1.boxplot(data['Total'])\nax2.hist(data['Total'])","2a30de1c":"fig, (ax1, ax2) = plt.subplots(1, 2)\nfig.suptitle('Histogram & BoxPlot')\nax1.boxplot(data['cogs'])\nax2.hist(data['cogs'])","e4bbec7f":"fig, (ax1, ax2) = plt.subplots(1, 2)\nfig.suptitle('Histogram & BoxPlot')\nax1.boxplot(data['Rating'])\nax2.hist(data['Rating'], bins=50)","99b4b8bf":"data.describe().T","d6282148":"plt.figure(figsize=(20, 12))\ndata['cogs'].plot(kind='hist', bins=50)","f3ef695b":"index_cogs = data[data['cogs'] > 3 * data['cogs'].std() + 100 ].index\ndata_clean = data.drop(index_cogs, axis=0)","5d1b61b8":"data_clean['Tax 5%'].plot(kind='box')","ab8553bc":"data_clean.describe().T","4dad9f51":"sns.pairplot(data_clean)","6c21143b":"sns.heatmap(data_clean.corr(), annot=True)","cee70830":"data_clean['Date'] = pd.DatetimeIndex(data_clean['Date'])\ndata_clean","a0740cbb":"which_city_sale = data_clean.pivot_table(index = 'City', columns = 'Product line', values = 'cogs', aggfunc = 'sum')\nwhich_city_sale","083c8d73":"which_city_sale.plot(kind='bar', align='center', figsize=(20, 12), color=['red', 'blue', 'yellow', 'black' ,'cyan', 'green'])","7e92d697":"sns.factorplot(x = 'Customer type', y = 'Quantity', hue='Product line', col = 'City', data=data_clean, kind='bar')","8a8801b4":"data_clean['month'] = pd.DatetimeIndex(data_clean['Date']).month","164f531c":"plt.figure(figsize=(20, 12))\nsns.factorplot(x = 'Gender', y = 'cogs', hue = 'Product line', col = 'month', kind='bar',row = 'Customer type' ,data = data_clean)","3bf843f3":"data_clean = data_clean.sort_values(by='Date').reset_index(drop=True)","91563d10":"data_clean","65d609b4":"plt.plot(data_clean['Date'], data_clean['cogs'])","1db5a530":"adfuller(data_clean['cogs'])","a3b0fead":"data_clean['cogs'] = np.log(data_clean['cogs'])","2083de0c":"adfuller(data_clean['cogs'])","9bb5b6be":"data_clean['cogs'] = data_clean['cogs'].diff()\ndata_clean = data_clean.drop(0, axis=0)","4e389ba2":"adfuller(data_clean['cogs'])","e9ec5684":"plt.figure(figsize=(20, 12))\nplt.plot(data_clean['Date'].sort_values(), data_clean['cogs'])","4881f6e3":"m  = SARIMAX(data_clean['cogs'], order = (3, 1, 3), seasonal_order=(3, 1, 3, 6))\nres = m.fit()","e2ef2f6c":"res.summary()","5d5038a1":"data_clean['arima_predict'] = res.fittedvalues","fe669512":"plt.figure(figsize=(20, 12))\nplt.plot(data_clean['Date'].sort_values(), data_clean['cogs'])\nplt.plot(data_clean['Date'].sort_values(), data_clean['arima_predict'])\nplt.legend()","1141a837":"forecast = res.predict(start=len(data_clean), end=len(data_clean) + 15)","b4aea2a6":"forecast","6581de64":"len(data_clean['arima_predict'])","2b63b2a7":"data_clean['cogs'].append(forecast)","3a02e3ac":"plt.figure(figsize=(20, 12))\nplt.plot(data_clean['cogs'])\nplt.plot(forecast)\nplt.legend()","1ec6a8c0":"data_clean = data.drop(index_cogs, axis=0)","ebae14b6":"p = Prophet()\nd = data_clean.rename(columns={'Date':'ds', 'cogs':'y'})\n\np.fit(d)","11027c7c":"d","d8666095":"future = p.make_future_dataframe(periods=15, freq='D')\nfuture","b60fc217":"forecats = p.predict(future)\nforecats","05389e64":"p.plot(forecats, uncertainty=True)","6b44c2fc":"forecats[-15:]['yhat']","83aa953c":"data_clean['Date'] = pd.to_datetime(data_clean['Date'])","f661927a":"max(data_clean['Date'])","d169999b":"pin_date = max(data_clean['Date']) + dt.timedelta(1)\npin_date","81d350fd":"data_clean.describe()","d67ae481":"rfm = data_clean.groupby('Invoice ID').agg({\n    'Date': lambda x: (pin_date - x.max()).days,\n    'Invoice ID': 'count',\n    'cogs': 'sum'\n})","1b8d5158":"rfm.rename(columns={'Invoice ID': 'count buy', 'cogs': 'total_sale', 'Date': 'Last_buy(days)' }, inplace=True)","693d5da5":"rfm","58c35224":"r = pd.qcut(rfm['Last_buy(days)'], 3, labels = range(3, 0, -1))\n#f = pd.qcut(rfm['count buy'], 3, labels = range(3, 0, -1))\nm = pd.qcut(rfm['total_sale'], 3, labels = range(0, 3))","2bb652ad":"rfm['R'] = r\nrfm['M'] = m","6f671f04":"rfm","8044ad39":"x = rfm.iloc[:, -2:]\nfrom sklearn.cluster import KMeans\nkm = KMeans(n_clusters = 5, init = 'k-means++', max_iter = 100)\nkm.fit(x)","4df2eb1a":"label = km.labels_\nrfm['Rank'] = label\nrfm","a392beab":"print(km.inertia_)\nprint('')","64441c1f":"score = []\nfor i in range(1, 10):\n    km = KMeans(n_clusters = i, init = 'k-means++', max_iter = 100)\n    km.fit(x)\n    score.append(km.inertia_)\n","5b2a50ef":"plt.figure(figsize=(20, 12))\nsns.pointplot(x = score, y = score)\nplt.title('Elbow')","111f8084":"## Let's Check If We Drop Some Values Is Effect On DataNoise Or & Not \n### It's Works","d63f4032":"## In This Dataset Maybe Somthing Wrong With Branch Column And Gender Column Because As Same As Each Other","495c47be":"## Now Let's Find Which City More Sale Which Categori :","cbc815f6":"# SARIMAX (Time_Series) & (Prophet)\n## SARIMAX Accept Data Stainsionary \n### What Does it mean Stainsionary:\n#### It Mean's All Data During TimeStamp Not Change  Mean() & STD() ","59619667":"## Let's First Clean The Data:","2d3421a0":"## Clustering_Customer\n### RMF\n#### R: Last Buy \n#### F: How Many Times Buy In Last Year\n#### M: ToTal Sale","406aa992":"## Now Let's EvaluateModel By Elbow:\n","753fb8b5":"### Woww Look At The Gross Margin Percentage All Of The Valu's Is 4.761905 And if look At The Std Is Close To Zero Not Usebale Culumn For Us \n "}}