{"cell_type":{"11c81e21":"code","f094f145":"code","7ba6985e":"code","7c16e1a9":"code","505622a7":"code","4cabf678":"code","45e3d281":"code","f14cd5c2":"code","68afdef0":"code","7df1f6ec":"code","f8ac3817":"code","d7d13455":"code","8155942c":"code","9d06de49":"code","fcd876c0":"code","093eafc5":"code","5dd40184":"code","faadc3bb":"code","8a66e3aa":"code","008e762d":"code","9de802de":"code","54e100ce":"code","cba11131":"code","2d8c9b92":"code","39ca28dc":"code","f2d218e5":"code","61f465e0":"code","9178da67":"code","ccf55ed0":"code","636549f3":"code","dce84845":"code","e880e9da":"code","94cdaa21":"code","47fa4fc5":"code","0fee8c56":"code","38286799":"code","87a7d772":"code","197c5fb2":"code","19bfb5b9":"code","9a536844":"code","659f8cd8":"code","9dc7d6f1":"code","ca3d4d17":"code","4fd55559":"code","10cf7099":"code","1d77bcb3":"code","99f812bd":"code","0a1ce2ff":"code","f5eb6b82":"code","c27cce3a":"code","215e3397":"code","a3651d38":"code","8342bdc7":"code","e8a6939e":"code","abb00005":"code","957453f6":"code","c625bccb":"code","32e2fdc2":"code","b9309827":"code","0f2a93a0":"code","846e2609":"code","15e4d9f6":"code","afc53813":"code","07f79e21":"code","345b8198":"code","b85bc443":"code","b8ec78fa":"code","f8f0ec16":"code","b79d311a":"code","91db9e4e":"code","6e233b43":"markdown","f11d285a":"markdown","aa748ccd":"markdown","31c8d14b":"markdown","4241e665":"markdown","e747048f":"markdown","b8e59bee":"markdown","a8a7e927":"markdown","728fad12":"markdown","724216ae":"markdown","2ed10aff":"markdown","fc9178da":"markdown","bf835294":"markdown","5fe2722c":"markdown","9f0089f9":"markdown","aa33408d":"markdown","d027562e":"markdown","ddc4a221":"markdown","28749387":"markdown","1a5c35c8":"markdown","feebcf4e":"markdown","9a5f8b65":"markdown","a78b1968":"markdown","beab570f":"markdown","ea590b52":"markdown","2c484d15":"markdown","c983bbc2":"markdown","272b025b":"markdown","e04b825f":"markdown","9d19793e":"markdown","d9f865bd":"markdown","1bcacb64":"markdown","13892e3f":"markdown","513ccd0e":"markdown","8a437535":"markdown","c90c8f68":"markdown","d2d35495":"markdown","904fe727":"markdown","a92c298d":"markdown","1e597878":"markdown","3919a75e":"markdown","e600b58f":"markdown","0be751ec":"markdown","3dccfc0c":"markdown","e345a1a8":"markdown","ae6e6296":"markdown","19b3be53":"markdown","08171414":"markdown","6b050dd0":"markdown","533f4f7b":"markdown","e0fcee0d":"markdown","ad2337e0":"markdown","baebc838":"markdown","e4739a58":"markdown","400c58fa":"markdown","7506d9f5":"markdown","75a7d59f":"markdown","cce33a89":"markdown","c644d64b":"markdown","4bb10c53":"markdown","c09f8b2a":"markdown","821a2a7a":"markdown","9f292c78":"markdown","5f12c525":"markdown","0a0e3203":"markdown","6149c326":"markdown","9968d2dc":"markdown","ae5094fc":"markdown","ae4f3f51":"markdown","f2670ee4":"markdown","557aa53c":"markdown","83695334":"markdown","2aeb8144":"markdown","db9171cb":"markdown","caec7620":"markdown","1d0f2ff9":"markdown","6c476ea8":"markdown","eec98fe2":"markdown","497b6771":"markdown","142f433f":"markdown","e28b6d4c":"markdown","5e54aaaf":"markdown","90afddd6":"markdown","e591cf21":"markdown","696c3ab6":"markdown","4e0b0d04":"markdown","56cb1be3":"markdown","4eb586c0":"markdown","80117b02":"markdown","5061430e":"markdown","53378fbe":"markdown","98a49eb1":"markdown","cbce860c":"markdown","97b5fd81":"markdown","babe839c":"markdown","025c0f6a":"markdown","228974f1":"markdown","e0cf7863":"markdown","3f298dcc":"markdown","1fe661d8":"markdown","306d1928":"markdown","1266198a":"markdown","7518a3e4":"markdown","9e1e15a3":"markdown","08f58730":"markdown","5c9edc09":"markdown","bb98acce":"markdown","ad2a67ba":"markdown","a5e7e783":"markdown","0c9a7078":"markdown","bd5134c9":"markdown","6533d2fe":"markdown","d08bd434":"markdown","55468297":"markdown","cff7ec3e":"markdown","2612bf7b":"markdown","1b2b05be":"markdown","0eff37fb":"markdown","e4c7d46d":"markdown"},"source":{"11c81e21":"import pandas as pd\nimport numpy as np\nfrom wordcloud import WordCloud,STOPWORDS\nimport seaborn as sns\nfrom scipy.stats import kurtosis, skew\nfrom scipy import stats\nimport matplotlib.pyplot as plt\n%matplotlib inline\nsns.set(color_codes=True)\nprint(\"Setup Complete\")","f094f145":"wine = pd.read_csv(r'..\/input\/wine-reviews\/winemag-data-130k-v2.csv')\nwine1 = wine","7ba6985e":"wine.head(5)","7c16e1a9":"wine.shape","505622a7":"wine.describe()","4cabf678":"wine.isnull().values.any()","45e3d281":"sns.heatmap(wine.isnull(),yticklabels=False,cbar=False,cmap='viridis')","f14cd5c2":"wine = wine.drop(columns=['Unnamed: 0','region_1','region_2','taster_twitter_handle','designation'])\nwine1 = wine\nsns.heatmap(wine.isnull(),yticklabels=False,cbar=False,cmap='viridis')","68afdef0":"wine1.price.fillna(wine.price.dropna().median(),inplace =True)\nwine1 = wine.dropna()\nsns.heatmap(wine1.isnull(),yticklabels=False,cbar=False,cmap='viridis')","7df1f6ec":"plt.figure(figsize=(30,5))\nsns.boxplot(x=wine['price'],palette = 'colorblind')","f8ac3817":"plt.figure(figsize=(30,5))\nsns.boxplot(x=wine1['price'],palette = 'colorblind')","d7d13455":"plt.figure(figsize=(30,5))\nsns.boxplot(x=wine['points'],palette = 'colorblind')","8155942c":"for feature in wine1.columns:\n    uniq = np.unique(wine1[feature])\n    print('{}: {} distinct values\\n'.format(feature,len(uniq)))","9d06de49":"sns.set_context('talk')\nplt.figure(figsize=(20,10))\ncnt = wine['country'].value_counts().to_frame()[0:20]\n#plt.xscale('log')\nsns.barplot(x= cnt['country'], y =cnt.index, data=cnt, palette='colorblind',orient='h')\nplt.title('Distribution of Wine Reviews of Top 20 Countries');","fcd876c0":"cnt = wine1.groupby(['country',]).median()['price'].sort_values(ascending=False).to_frame()\n\nplt.figure(figsize=(20,15))\nsns.pointplot(x = cnt['price'] ,y = cnt.index ,color='r',orient='h',markers='o')\nplt.title('Country wise average wine price')\nplt.xlabel('Price')\nplt.ylabel('Country');","093eafc5":"cnt = wine.groupby(['country',]).median()['price'].sort_values(ascending=False).to_frame()\n\nplt.figure(figsize=(20,15))\nsns.pointplot(x = cnt['price'] ,y = cnt.index ,color='r',orient='h',markers='o')\nplt.title('Country wise average wine price')\nplt.xlabel('Price')\nplt.ylabel('Country');","5dd40184":"cnt = wine.groupby(['country',]).median()['price'].sort_values(ascending=False).to_frame()\nplt.figure(figsize = (50,10))\ng2 = sns.stripplot(y='price', x= 'country', \n                   data=wine, \n                   jitter=True,\n                   dodge=True,\n                   marker='o', \n                   alpha=0.5)\ng2.set_title(\"Country X Price Distribution\", fontsize=30)\nplt.show()","faadc3bb":"plt.figure(figsize=(16,8))\n\ncnt = wine.groupby(['country'])['price'].max().sort_values(ascending=False).to_frame()[:20]\ng2 = sns.barplot(x = cnt['price'], y = cnt.index, palette= 'colorblind')\ng2.set_title('Most expensive wine in country')\ng2.set_ylabel('Country')\ng2.set_xlabel('')","8a66e3aa":"cnt = wine.groupby(['country',]).mean()['points'].sort_values(ascending=False).to_frame()\n\nplt.figure(figsize=(20,15))\nsns.pointplot(x = cnt['points'] ,y = cnt.index ,color='r',orient='h',markers='o')\nplt.title('Country wise average wine points')\nplt.xlabel('Points')\nplt.ylabel('Country')\n","008e762d":"plt.figure(figsize = (30,20))\ng2 = sns.stripplot(y='points', x= 'country', \n                   data=wine, \n                   jitter=True,\n                   dodge=True,\n                   marker='o', \n                   alpha=0.5)\ng2.set_title(\"Country X Points Distribution\", fontsize=30)\nplt.show()","9de802de":"sns.set_context(\"talk\")\nplt.figure(figsize=(20,10))\ncnt = wine['variety'].value_counts().to_frame()[0:20]\nsns.barplot(x= cnt['variety'], y =cnt.index, data=cnt, palette='colorblind',orient='h')\nplt.title('Distribution of Wine Reviews of Top 20 Varieties');","54e100ce":"sns.set_context(\"talk\")\nplt.figure(figsize=(20,18))\ncnt = wine.groupby(['variety'])['price'].min().sort_values(ascending=True).to_frame()[:20]\ng2 = sns.barplot(x = cnt['price'], y = cnt.index, palette= 'colorblind')\ng2.set_title('The grapes used the cheap wines')\ng2.set_ylabel('Variety')\ng2.set_xlabel('')\nplt.show()","cba11131":"plt.figure(figsize=(20,18))\ncnt = wine.groupby(['variety'])['price'].max().sort_values(ascending=False).to_frame()[:25]\ng2 = sns.barplot(x = cnt['price'], y = cnt.index, palette= 'colorblind')\ng2.set_title('The grapes used for most expensive wine')\ng2.set_ylabel('Variety')\ng2.set_xlabel('')\nplt.show()","2d8c9b92":"plt.figure(figsize=(20,15))\ncnt = wine.groupby(['variety'])['points'].max().sort_values(ascending=False).to_frame()[:20]\ng2 = sns.barplot(x = cnt['points'], y = cnt.index, palette= 'colorblind')\ng2.set_title('Varieties who got highest point')\ng2.set_ylabel('Variety')\ng2.set_xlabel('')\nplt.show()","39ca28dc":"plt.figure(figsize=(16,5))\n\nplt.subplot(1,2,1)\ncnt = wine.groupby(['variety'])['points'].max().sort_values(ascending=False).to_frame()[:15]\ng2 = sns.barplot(x = cnt['points'], y = cnt.index, palette= 'colorblind')\ng2.set_title('Varieties who got highest point')\ng2.set_ylabel('Variety')\ng2.set_xlabel('')\n\nplt.subplot(1,2,2)\ncnt = wine.groupby(['variety'])['price'].min().sort_values(ascending=True).to_frame()[:15]\ng2 = sns.barplot(x = cnt['price'], y = cnt.index, palette= 'colorblind')\ng2.set_title('The grapes used the cheap wines')\ng2.set_xlabel('')\nplt.show()","f2d218e5":"highest_point = wine.groupby(['variety'])['points'].max().sort_values(ascending=False).to_frame()[:15]\ncheap = wine.groupby(['variety'])['price'].min().sort_values(ascending=True).to_frame()[:25]\n\ns1 = pd.merge(highest_point, cheap, how='inner', on=['variety'])\nprint(s1)","61f465e0":"plt.figure(figsize=(20,10))\ncnt = wine['taster_name'].value_counts().to_frame()[0:20]\nsns.barplot(x= cnt['taster_name'], y =cnt.index, data=cnt, palette='colorblind',orient='h')\nplt.title('Top 20 tasters')\nplt.show()","9178da67":"wine.groupby(\"taster_name\")[\"points\"].describe()","ccf55ed0":"plt.figure(figsize = (30,10))\ng2 = sns.stripplot(y='points', x='taster_name', \n                   data=wine, \n                   jitter=True,\n                   dodge=True,\n                   marker='o', \n                   alpha=0.5)\ng2.set_title(\"Taster Name Points Distribuition\", fontsize=25)\nplt.show()","636549f3":"plt.figure(figsize = (50,10))\nsns.boxplot(y='points', x='taster_name', \n                 data=wine )\nsns.stripplot(y='points', x='taster_name', \n                   data=wine, \n                   jitter=True,\n                   dodge=True,\n                   marker='o', \n                   alpha=0.5)\ng2.set_title(\"Taster Name Points Distribuition\", fontsize=25)\nplt.show()","dce84845":"cnt1 = np.where(wine['points']==100)\nfor locs in cnt1:\n    print(wine.loc[locs,['taster_name','variety']])","e880e9da":"sns.set_context(\"talk\")\nplt.figure(figsize= (16,8))\nplt.title('Word cloud of Description of lowest rated wine')\nwc = WordCloud(max_words=1000,max_font_size=40,background_color='black', stopwords = STOPWORDS,colormap='Set1')\nwc.generate(' '.join(wine[wine['points']==80]['description']))\nplt.imshow(wc,interpolation=\"bilinear\")\nplt.axis('off')\nplt.show()","94cdaa21":"plt.figure(figsize= (16,8))\nplt.title('Word cloud of Description of highest rated wines')\nwc = WordCloud(max_words=1000,max_font_size=40,background_color='black', stopwords = STOPWORDS,colormap='Set1')\nwc.generate(' '.join(wine[wine['points']>=97]['description']))\nplt.imshow(wc,interpolation=\"bilinear\")\nplt.axis('off')\nplt.show()","47fa4fc5":"plt.figure(figsize= (16,8))\nplt.title('Word cloud of Description of most expensive wines')\nwc = WordCloud(max_words=1000,max_font_size=40,background_color='black', stopwords = STOPWORDS,colormap='Set1')\nwc.generate(' '.join(wine[wine['price']>=108]['description']))\nplt.imshow(wc,interpolation=\"bilinear\")\nplt.axis('off')\nplt.show()","0fee8c56":"plt.figure(figsize= (16,8))\nplt.title('Word cloud of Description of most expensive wines')\nwc = WordCloud(max_words=1000,max_font_size=40,background_color='black', stopwords = STOPWORDS,colormap='Set1')\nwc.generate(' '.join(wine[wine['price']<=10]['description']))\nplt.imshow(wc,interpolation=\"bilinear\")\nplt.axis('off')\nplt.show()","38286799":"sns.set_context('poster')\nplt.figure(figsize= (16,8))\nplt.title('Word cloud of Description')\nwc = WordCloud(max_words=1000,max_font_size=40,background_color='black', stopwords = STOPWORDS,colormap='Set1')\nwc.generate(' '.join(wine['description']))\nplt.imshow(wc,interpolation=\"bilinear\")\nplt.axis('off')\nplt.show()","87a7d772":"wine = wine.assign(desc_length = wine['description'].apply(len))","197c5fb2":"sns.set_context('paper')\nplt.figure(figsize=(14,6))\n\ng = sns.regplot(x='desc_length', y='price',\n                data=wine, fit_reg=True,  line_kws={'color':'black'},color = 'red' )\ng.set_title('Price by Description Length', fontsize=20)\ng.set_ylabel('Price(USD)', fontsize = 16) \ng.set_xlabel('Description Length', fontsize = 16)\ng.set_xticklabels(g.get_xticklabels(),rotation=45)\n\nplt.show()","19bfb5b9":"g = sns.countplot(x='points', data=wine, palette = 'colorblind') # seting the seaborn countplot to known the points distribuition\ng.set_title(\"Points Count distribuition \", fontsize=20) # seting title and size of font\ng.set_xlabel(\"Points\", fontsize=15) # seting xlabel and size of font\ng.set_ylabel(\"Count\", fontsize=15) # seting ylabel and size of font\n\n\nplt.show() #rendering the graphs","9a536844":"# Finding the relations between the variables.\nplt.figure(figsize=(10,5))\nc= wine.corr()\nsns.heatmap(c,cmap=\"coolwarm\",annot=True) #BrBG, RdGy, coolwarm\nc","659f8cd8":"plt.figure(figsize=(20,8))\n\ng = sns.regplot(x='points', y='price', \n                data=wine, line_kws={'color':'black'},\n                x_jitter=True, fit_reg=True, color = 'red')\ng.set_title(\"Points x Price Distribuition\", fontsize=20)\ng.set_xlabel(\"Points\", fontsize= 15)\ng.set_ylabel(\"Price\", fontsize= 15)\n\nplt.show()","9dc7d6f1":"wine = wine.assign(description_length = wine['description'].apply(len))\nfig, ax = plt.subplots(figsize=(30,10))\nsns.boxplot(x='points', y='description_length', data=wine)\nplt.xticks(fontsize=20) # X Ticks\nplt.yticks(fontsize=20) # Y Ticks\nax.set_title('Description Length per Points', fontweight=\"bold\", size=25) # Title\nax.set_ylabel('Description Length', fontsize = 25) # Y label\nax.set_xlabel('Points', fontsize = 25) # X label\nplt.show()","ca3d4d17":"def cat_points(points):\n    if points in list(range(80,83)):\n        return 0\n    elif points in list(range(83,87)):\n        return 1\n    elif points in list(range(87,90)):\n        return 2\n    elif points in list(range(90,94)):\n        return 3\n    elif points in list(range(94,98)):\n        return 4\n    else:\n        return 5\n\nwine[\"rating_cat\"] = wine[\"points\"].apply(cat_points)","4fd55559":"fig, ax = plt.subplots(figsize=(30,10))\nplt.xticks(fontsize=20) # X Ticks\nplt.yticks(fontsize=20) # Y Ticks\nax.set_title('Number of wines per points', fontweight=\"bold\", size=25) # Title\nax.set_ylabel('Number of wines', fontsize = 25) # Y label\nax.set_xlabel('Points', fontsize = 25) # X label\nwine.groupby(['rating_cat']).count()['description'].plot(ax=ax, kind='bar')","10cf7099":"#given_point = int(input(\"Your preferred point: \"))\n#given_price = float(input(\"Whats your budget, in dollars?: \"))\n\ngiven_point = 96 #dummy value\ngiven_price = 20 #dummy value\nfound = False\nfor row_index,row in wine.iterrows():\n    if row['points']==given_point and row['price']<given_price:\n        print(row['variety'], \"   \", row['price'], \"   \", row['points'])\n        found = True\nif(not found):\n    print(\"Sorry, not found.\")","1d77bcb3":"fig, ax = plt.subplots(figsize=(30,10))\nsns.boxplot(x='points', y='desc_length', data=wine)\nplt.xticks(fontsize=20) # X Ticks\nplt.yticks(fontsize=20) # Y Ticks\nax.set_title('Description Length per Points', fontweight=\"bold\", size=25) # Title\nax.set_ylabel('Description Length', fontsize = 25) # Y label\nax.set_xlabel('Points', fontsize = 25) # X label\nplt.show()","99f812bd":"from sklearn.feature_extraction.text import CountVectorizer, TfidfVectorizer","0a1ce2ff":"import matplotlib.gridspec as gridspec # to do the grid of plots\ncountry = wine.country.value_counts()[:20]\n\ngrid = gridspec.GridSpec(5, 2)\nplt.figure(figsize=(16,7*4))\n\nfor n, cat in enumerate(country.index[:10]):\n    \n    ax = plt.subplot(grid[n])   \n\n    vectorizer = TfidfVectorizer(ngram_range = (2, 3), min_df=5, \n                                 stop_words='english',\n                                 max_df=.5) \n    \n    X2 = vectorizer.fit_transform(wine.loc[(wine.country == cat)]['description']) \n    features = (vectorizer.get_feature_names()) \n    scores = (X2.toarray()) \n    \n    # Getting top ranking features \n    sums = X2.sum(axis = 0) \n    data1 = [] \n    \n    for col, term in enumerate(features): \n        data1.append( (term, sums[0,col] )) \n\n    ranking = pd.DataFrame(data1, columns = ['term','rank']) \n    words = (ranking.sort_values('rank', ascending = False))[:15]\n    \n    sns.barplot(x='term', y='rank', data=words, ax=ax, \n                color='blue', orient='v')\n    ax.set_title(f\"Wine's from {cat} N-grams\", fontsize=19)\n    ax.set_xticklabels(ax.get_xticklabels(),rotation=90)\n    ax.set_ylabel(' ')\n    ax.set_xlabel(\" \")\n\nplt.subplots_adjust(top = 0.95, hspace=.9, wspace=.1)\n\nplt.show()","f5eb6b82":"wine['price_log'] = np.log(wine['price'])\nwine.head(2)","c27cce3a":"from nltk.sentiment.vader import SentimentIntensityAnalyzer\n\nSIA = SentimentIntensityAnalyzer()\n\n# Applying Model, Variable Creation\nsentiment = wine.sample(15000).copy()\nsentiment['polarity_score']=sentiment.description.apply(lambda x:SIA.polarity_scores(x)['compound'])\nsentiment['neutral_score']=sentiment.description.apply(lambda x:SIA.polarity_scores(x)['neu'])\nsentiment['negative_score']=sentiment.description.apply(lambda x:SIA.polarity_scores(x)['neg'])\nsentiment['positive_score']=sentiment.description.apply(lambda x:SIA.polarity_scores(x)['pos'])\n\nsentiment['sentiment']= np.nan\nsentiment.loc[sentiment.polarity_score>0,'sentiment']='POSITIVE'\nsentiment.loc[sentiment.polarity_score==0,'sentiment']='NEUTRAL'\nsentiment.loc[sentiment.polarity_score<0,'sentiment']='NEGATIVE'","215e3397":"def sentiment_analyzer_scores(sentence):\n    score = SIA.polarity_scores(sentence)\n    print(\"{:-<40} {}\".format(sentence, str(score)))","a3651d38":"print(sentiment_analyzer_scores(\"yaaaaay\"))\nprint(sentiment_analyzer_scores(\"Today is a sunny day #love\"))\nprint(sentiment_analyzer_scores(\"UGGHHH SUCH A BORING DAY\"))\nprint(sentiment_analyzer_scores(\"i like kaggle a lot lol\"))\nprint(sentiment_analyzer_scores(\"i like kaggle a lot!!\"))","8342bdc7":"plt.figure(figsize=(14,5))\n\nplt.suptitle('Sentiment of the reviews by: \\n- Points and Price(log) -', size=22)\n\nplt.subplot(121)\nax = sns.boxplot(x='sentiment', y='points', data=sentiment,palette = 'pastel')\nax.set_title(\"Sentiment by Points Distribution\", fontsize=19)\nax.set_ylabel(\"Points \", fontsize=17)\nax.set_xlabel(\"Sentiment Label\", fontsize=17)\n\nplt.subplot(122)\nax1= sns.boxplot(x='sentiment', y='price_log', data=sentiment,palette = 'pastel')\nax1.set_title(\"Sentiment by Price Distribution\", fontsize=19)\nax1.set_ylabel(\"Price (log) \", fontsize=17)\nax1.set_xlabel(\"Sentiment Label\", fontsize=17)\n\nplt.subplots_adjust(top = 0.75, wspace=.2)\nplt.show()","e8a6939e":"from sklearn.neighbors import NearestNeighbors # KNN Clustering \nfrom scipy.sparse import csr_matrix # Compressed Sparse Row matrix\nfrom sklearn.decomposition import TruncatedSVD # Dimensional Reduction","abb00005":"# Lets choice rating of wine is points, title as user_id, and variety,\ncol = ['province','variety','points']\n\nwine1 = wine[col]\nwine1 = wine1.dropna(axis=0)\nwine1 = wine1.drop_duplicates(['province','variety'])\nwine1 = wine1[wine1['points'] > 85]\n\nwine_pivot = wine1.pivot(index= 'variety',columns='province',values='points').fillna(0)\nwine_pivot_matrix = csr_matrix(wine_pivot)","957453f6":"wine_pivot_matrix","c625bccb":"from sklearn.cluster import KMeans\nfrom scipy.cluster.vq import kmeans, vq","32e2fdc2":"trial = wine[['price', 'points']]\ndata = np.asarray([np.asarray(trial['price']), np.asarray(trial['points'])]).T","b9309827":"X = data\ndistortions = []\nfor k in range(2,30):\n    k_means = KMeans(n_clusters = k)\n    k_means.fit(X)\n    distortions.append(k_means.inertia_)\n\nfig = plt.figure(figsize=(15,10))\nplt.plot(range(2,30), distortions, 'bx-')\nplt.title(\"Elbow Curve\")\nplt.show()","0f2a93a0":"knn = NearestNeighbors(n_neighbors=7, algorithm = 'brute',metric = 'cosine')\nmodel_knn = knn.fit(wine_pivot_matrix)","846e2609":"for n in range(5):\n    query_index = np.random.choice(wine_pivot.shape[0])\n    #print(n, query_index)\n    distance, indice = model_knn.kneighbors(wine_pivot.iloc[query_index,:].values.reshape(1,-1), n_neighbors=6)\n    for i in range(0, len(distance.flatten())):\n        if  i == 0:\n            print('Recommendation for ## {0} ##:'.format(wine_pivot.index[query_index]))\n        else:\n            print('{0}: {1} with distance: {2}'.format(i,wine_pivot.index[indice.flatten()[i]],distance.flatten()[i]))\n    print('\\n')","15e4d9f6":"wine.drop(columns=['description'],inplace=True)\n# dropping 'Unnamed: 0' since the ids won't contribute or affect the result of regression model.\nwine.drop(columns=['rating_cat'],inplace=True)\nwine.head(5)","afc53813":"from sklearn.model_selection import train_test_split\n\n# we will toss out the target variable 'points' from our input data features\nX=wine.drop(columns=['points'])\n\n#Filling the null values since CatBoost can't handle missing null values\nX=X.fillna(0)\n\n#To be used during Catboost's Feature Importance extractor\ncategorical_features_indices =np.where(X.dtypes == np.object)[0]\n\ny=wine['points']\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, \n                                                    random_state=101)","07f79e21":"categorical_features_indices","345b8198":"from catboost import Pool, CatBoostRegressor, cv\n\nmodel = CatBoostRegressor(random_seed = 350,loss_function = 'RMSE',iterations=350)\n#fitting the train data\nmodel.fit(X_train, y_train,cat_features = categorical_features_indices,verbose=False)\n\nprint(\"training done\")","b85bc443":"predictions=model.predict(X_test)","b8ec78fa":"fig=plt.figure(figsize=(8,8))\n\nplt.scatter(y_test,predictions,color='darkred')\n# Plot-label\nfig.suptitle('y_test vs predictions',fontsize = 20)\n\n#X-label\nplt.xlabel('y_test')\n\n# Y-label\nplt.ylabel('predcitions')","f8f0ec16":"fig=plt.figure(figsize=(8,8))\n  \nsns.distplot((y_test-predictions),bins=20,color='darkred')\n\n#Plot Label\nfig.suptitle('Residual Analysis', fontsize = 20)","b79d311a":"import shap\nshap_values = model.get_feature_importance(Pool(X_test, label=y_test, cat_features=categorical_features_indices),type=\"ShapValues\")\nshap_values = shap_values[:, :-1]\nshap.summary_plot(shap_values, X_test, plot_type=\"bar\")","91db9e4e":"shap.summary_plot(shap_values, X_test)","6e233b43":"Here are some examples, on how sentiment analyzer works. We can see that the scores are given in positive, negative and neutral.","f11d285a":"## Running our baseline Model","aa748ccd":"So, we do have missing values. Lets see them.","31c8d14b":"## Point Feature","4241e665":"![Cheers](https:\/\/images.unsplash.com\/photo-1516600164266-f3b8166ae679?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=750&q=80)","e747048f":"__CountVectorizer__ <br>\nConvert a collection of text documents to a matrix of token counts\n\nThis implementation produces a sparse representation of the counts using scipy.sparse.csr_matrix.\n\nIf you do not provide an a-priori dictionary and you do not use an analyzer that does some kind of feature selection then the number of features will be equal to the vocabulary size found by analyzing the data.<br> \n[Source](https:\/\/scikit-learn.org\/stable\/modules\/generated\/sklearn.feature_extraction.text.CountVectorizer.html)","b8e59bee":"## Description Vectorization","a8a7e927":"Lots of data to work with.","728fad12":"**What is Sentiment Analysis?**","724216ae":"In the first graph we can see that Switzerland has highest mean with regards to price, but when we see the strip plot, we can see that clearly France has a range of price, and also has the most expensive wine.","2ed10aff":"## Sneak peak of dataset","fc9178da":"# Future Work\n\n* Build the recommender based on points,price,variety or title as given by user.\n* Deploy the recommender on flask or django\n* Try to predict points using the description\n* Using a better language model","bf835294":"### Countries producing expensive wine","5fe2722c":"This answers the 2nd part of 1st question. <br>\n- **Which is the most reviewed country and most reviewed variety?** <br>\nPinot Noir","9f0089f9":"## Taster and point distribution","aa33408d":"Let's try to simplify the model with 5 different values:\n\n0 -> Points 80 to 83 (Under Average wines)\n\n1 -> Points 83 to 87 (Average wines)\n\n2 -> Points 87 to 90 (Good wines)\n\n3 -> Points 90 to 94 (Very Good wines)\n\n4 -> Points 96 to 98 (Excellent wines)\n\n5 -> Points 98 to 100 (Best wines)","d027562e":"Importing some more needed libraries","ddc4a221":"# Background\nWine has always been a topic of discussion for human. The wine industry is blossoming and expanding. For this, people want to buy products that are tried and tested. In this product we will try to find some answers.\n\n## Some important questions\n\n1. Which is the most reviewed country and most reviewed variety?\n2. Is there any relationship between price and points received?\n3. What are some characteristics of wine, country wise?\n4. What are some common terms appearing in the lowest rated and highest rated wine?\n5. Can we create a recommender system?\n6. What should a company keep in mind to get good reviews?\n7. Is there any relationship between points and any other attributes?\n8. Which variety of grape will be best to make wine?\n9. Referring to which reviewer will be beneficial?\n10. Should we go with whats common or with something less common, in terms of variety?","28749387":"## Creating and Training The Model","1a5c35c8":"Sentiment analysis is a type of data mining that measures the inclination of people\u2019s opinions through natural language processing (NLP), computational linguistics and text analysis, which are used to extract and analyze subjective information from the Web - mostly social media and similar sources. The analyzed data quantifies the general public's sentiments or reactions toward certain products, people or ideas and reveal the contextual polarity of the information. [Source](https:\/\/www.techopedia.com\/definition\/29695\/sentiment-analysis)","feebcf4e":"To find the varieties that are both cheap and best, I am going to plot two graphs, one with point in descending, and price in ascending.","9a5f8b65":"So, we have quite a few who have got full point","a78b1968":"This answers our 9th question\n- **Referring to which reviewer will be beneficial?** <br>\nThough the range of giving points does'nt vary much, but still referring to Roger Voss, Paul Gregutt,Joe Czerwinski and Kerin O' Keefe can be beneficial. <br>\nBut still, it can be because Roger Voss has reviewed more wine. ","beab570f":"# Doing some Analysis","ea590b52":"We can see that, most of the reviewers have the same range in which they give points. There are a few reviewers who are below the range, but it can be because they have reviewed less number of wine.","2c484d15":"## Overview of dataset","c983bbc2":"Cool. Bordeaux-style Red blend is the most expensive grape type. <br> Is it also most rated? <br> Lets see.","272b025b":"Cheers...","e04b825f":"Woohoo!!","9d19793e":"Lets see the type of the ```wine_pivot_matrix```","d9f865bd":"This answers our 3rd question.\n-\t**What are some characteristics of wine, country-wise?**\n<br> As we can see the properties of the wine of Austria being white paper etc. (I would really like to taste that)","1bcacb64":"So we have a lot of missing data.","13892e3f":"### Expensive Wine","513ccd0e":"![Funny Cartoon](http:\/\/cdn2.justwineapp.com\/assets\/article\/2015\/08\/How-To-Taste-Wine-Wide-2.jpg)","8a437535":"## Taster Feature","c90c8f68":"## Distribution of country and points","d2d35495":"We can see that the elbow forms near 7, hence we take k as 7.","904fe727":"Let us see the distribution of new simplified points","a92c298d":"## Description Feature","1e597878":"But before that, lets see whether the length of the description has anything to do with points","3919a75e":"But, before that, what do we mean by variety? <br> Wine \u201cvarietals\u201d simply means wine made from a specific winegrape.  Varietal wines in the United States are often named after the dominant grapes used in making the wine.  Cabernet Sauvignon, Merlot, Chardonnay, Riesling, Pinot Noir, and Chenin Blanc are examples of grape varieties. When a wine bottle shows a varietal designation on the label (like Merlot) it means that the wine in the bottle is at least 75%  that grape variety (at least 75% Merlot, for example). <br> [Source](https:\/\/www.wines.com\/wine-varietals\/)","e600b58f":"The word vintage, age and aging appears a lot. This proves that aging is an important aspect of the wine but not the *only* characteristic which makes it score 100.","0be751ec":"## Most frequent taster","3dccfc0c":"# MODEL 2","e345a1a8":"This answers our 8th questions.\n- **Which variety of grape will be best to make wine?**<br>\nThe varieties Merlot, Cabernet Sauvignon, Chardonnay, Portuguese Red, Syrah, and Shiraz \n","ae6e6296":"## Getting more depth","19b3be53":"Roger Voss has reviewed the most number of wines and, its 10000 more than the 2nd person who is Michael Schachner","08171414":"## Instantiating the KNN algorithmn and fitting in the Wine Matrix to it","6b050dd0":"The graph looks like a normal distribution, with majority of wines being between 82 to 95","533f4f7b":"This also answers our 6th question\n-\t**What should a company keep in mind to get good reviews?**\n<br>For a wine to get good review,aging, concentration and aroma play an important role.","e0fcee0d":"Here, we can see that, price doesnt has much effect based on the sentiment of the description,which is kinda  obvious. But we can see that sentiments from description really affects the point. So, we can make our recommender system based on the sentiment and the point involved.","ad2337e0":"![funny picture](https:\/\/www.brandwatch.com\/wp-content\/uploads\/2015\/01\/lego-640.jpg)","baebc838":"![image wine](https:\/\/images.unsplash.com\/photo-1516594915697-87eb3b1c14ea?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=750&q=80)","e4739a58":"# Some interesting blogs\n1. [Sentiment Analysis](https:\/\/www.brandwatch.com\/blog\/understanding-sentiment-analysis\/)\n2. [N Grams](https:\/\/www.youtube.com\/watch?v=MZIm_5NN3MY)\n3. [Collaborative Filtering](https:\/\/www.youtube.com\/watch?v=9AP-DgFBNP4&t=390s)\n4. [KNN Alogrithm](https:\/\/towardsdatascience.com\/a-simple-introduction-to-k-nearest-neighbors-algorithm-b3519ed98e)\n5. [To understand Numpy](https:\/\/www.youtube.com\/watch?v=NlZXAytUeeE&list=PLWKjhJtqVAblvI1i46ScbKV2jH1gdL7VQ&index=3)\n6. [To understand Pandas](https:\/\/www.youtube.com\/watch?v=b2mLDkMSyn4&list=PLWKjhJtqVAblvI1i46ScbKV2jH1gdL7VQ&index=4)\n7. [Exploratory Data Analysis](https:\/\/www.youtube.com\/watch?v=Ea_KAcdv1vs)\n8. [EDA on wine review](https:\/\/towardsdatascience.com\/wine-ratings-prediction-using-machine-learning-ce259832b321)\n9. [Wine Recommender](https:\/\/github.com\/RoaldSchuring\/wine_recommender)\n10. [My notebook inspiration](https:\/\/www.kaggle.com\/kabure\/wine-review-s-eda-recommend-systems)\n11. [An amazing guide to Sentiment Analysis](https:\/\/medium.com\/analytics-vidhya\/simplifying-social-media-sentiment-analysis-using-vader-in-python-f9e6ec6fc52f)\n\n## Important links\n1. [Matplotlib Documentation](https:\/\/matplotlib.org\/)\n2. [Sea Born Documentation](http:\/\/seaborn.pydata.org\/)\n3. [Scikit Learn Documentation](https:\/\/scikit-learn.org\/stable\/)","400c58fa":"We can clearly see the highest rated wine is not the most expensive one. <br> This brings us to the next part of the project, which is the recommender. The recommendation system will return a wine which has same characteristics.\n<br>\nThis answers our 5th question\n-\t**Can we create a recommender system?**\n<br> And the answer is..","7506d9f5":"## Outliers","75a7d59f":"## Plotting the Analysis\nOk cool, we have the analysis, but really, nothing can be understood. We need to plot these to understand whaat exactly is going on.","cce33a89":"## Doing Sentiment Analysis","c644d64b":"# WINE REVIEW - EXPLORATORY DATA ANALYSIS","4bb10c53":"# Cleaning the dataset","c09f8b2a":"Let us see, which of the tasters have give full marks.","821a2a7a":"![](http:\/\/shabal.in\/visuals\/kmeans\/random.gif)","9f292c78":"### Cheapest Wines","5f12c525":"## Most reviewed country","0a0e3203":"### Most Expensive Wine","6149c326":"Lets check the same using strip plot","9968d2dc":"We can see the words show, dense, elegant etc","ae5094fc":"![very big yes](https:\/\/media.tenor.com\/images\/ced1329c89b2cdd0df5381c524f18c0e\/tenor.gif)","ae4f3f51":"## Recommender (Naive Try)","f2670ee4":"Lets try to see the correlation between price and point","557aa53c":"## Making predictions on test","83695334":"### Cheap Wine","2aeb8144":"We can see some interesting statistic-<br>\n1. All the points lie between 80 and 100.<br>\n2. The variance in point is much less as compared to price.\n3. Prices of wine has huge range starting from 4 to 2300\n4. In prices, the IQR (Interquartile Range) is 25. Whereas the max value is 3300","db9171cb":"To understand the statistics along with the outliers in a better way let us try box plot over strip plot","caec7620":"Though there is a relationship between price and point, and it is positive correlation. But the correlation is very weak. To understand it better, let us plot a scatter plot. \nThere is also a relationship between desc_length and points. This too is weak, but stronger than price.\n<br> This answers our 2nd Question\n-\t**Is there any relationship between the price and points received?**\n\nThere is a weak positive correlation between price and points.","1d0f2ff9":"### Lowest points","6c476ea8":"__Lets take a look at all the descriptions__","eec98fe2":"We can see that there is a linear relation between points and description length. So our recommendation system can be based on the description.","497b6771":"## Dimension of the dataset","142f433f":"This answers our 4th question\n-\t**What are some common terms appearing in the lowest-rated and highest rated wine?** <br>","e28b6d4c":"Let us first, simplify the points, because all the points are from 80 to 100 only","5e54aaaf":"Let us see the description of the most expensinve wine","90afddd6":"Here, I am taking sub dataframe from wine dataframe, and have only the price and points in the new dataframe, trial. I am then converting it into a 2D array.","e591cf21":"This is clearly not the way, because, even if the point is same and price is low, it doesn't mean that it is the most preferred, because not all the wines have same flavour and texture, a better model will be which matches according to the description.","696c3ab6":"### Cheap and Best","4e0b0d04":"## Most reviewed variety","56cb1be3":"### Highest Points","4eb586c0":"## Variety Feature","80117b02":"## Price and variety distribution","5061430e":"## Is there any relationship between point and price?","53378fbe":"## Country Feature","98a49eb1":"Here we have 2 points in the outliers but, they cant be called as outlier as maximum point can be 100","cbce860c":"Let us see what the wines with lowest points, have in their description","97b5fd81":"Lets look at the same data, visually","babe839c":"We can see the words heavy, flovor,bitter,burnt and words like sour.","025c0f6a":"To get a better view, I am merging the two groups on variety.","228974f1":"We have a lot of outliers in price.","e0cf7863":"## Average point of wine","3f298dcc":"One of the simplest method to classify texts with ML nowadays is called vectorization.<br>\nBasically, we want to represent our texts in a vector space, associated with weights (number of occurrences etc\u2026), so our classification algorithm will be able to interpret it.<br>\nFor example, if our dictionary contains the words {Jupyter, is, the, not, great}, and we want to vectorize the text \u201cJupyter is great\u201d, we would have the following vector: (1, 1, 0, 0, 1).\nA few vectorization algorithm are available, the most famous being:\n- CountVectorizer: simply weighted by word counting as stated by it\u2019s name\n- TF-IDF Vectorizer: the weight increases proportionally to count, but is offset by the frequency of the word in the total corpus. This is called the IDF (Inverse Document Frequency). This allows the Vectorizer to adjust weights with frequent words like \u201cthe\u201d, \u201ca\u201d etc\u2026\n- n-grams\n- stopwords\n\nVectorization can be called the general process of turning a collection of text documents into numerical feature vectors. This specific strategy (tokenization, counting and normalization) is called the Bag of Words or \u201cBag of n-grams\u201d representation. Documents are described by word occurrences while completely ignoring the relative position information of the words in the document.<br>\n[Source](https:\/\/scikit-learn.org\/stable\/modules\/feature_extraction.html#text-feature-extraction)","1fe661d8":"Let us see the connection between description length and points","306d1928":"Doing the same for highest rated wines.","1266198a":"Creating another dataframe containing the columns that we need. <br> Next we want to create a matrix of the same for analysis","7518a3e4":"### Elbow Curve\nAs KNN algorithm just clusters the data into k clusters, even if the clusters the wrong, we need a way to understand which value of k will be the best for clustering. The elbow curve looks like an arm and the elbow is the best choice of clustering. Here the graph will consider price and points as given in data above.","9e1e15a3":"## N-Grams\nn-gram is a contiguous sequence of n items from a given sample of text or speech. The items can be phonemes, syllables, letters, words or base pairs according to the application. The n-grams typically are collected from a text or speech corpus. When the items are words, n-grams may also be called shingles. [Source](https:\/\/en.wikipedia.org\/wiki\/N-gram) <br>\n[To understand N Grams](https:\/\/kavita-ganesan.com\/what-are-n-grams\/)","08f58730":"## Analysing descriptions","5c9edc09":"ngram_range is set at 2,3 which means it will take bigrams and trigrams from the text. \n<br> [This link](https:\/\/stackoverflow.com\/a\/35615151\/7449819) has an amazing and brief description about min_df and max_df. ","bb98acce":"We will do exploratory data analysis of wine reviews and try to build a recommender system for the same.<br> The dataset is taken from [here](https:\/\/github.com\/RoaldSchuring\/wine_recommender). <br> The data is scrapped from a famous wine magazine named [Winemag](https:\/\/www.winemag.com\/).","ad2a67ba":"So we have wines from 42 countries reviewed which come from 10949 wineries. 608 types of wine are reviewed.","a5e7e783":"# The Recommender System","0c9a7078":"## Using Count Vectorizer","bd5134c9":"__Dealing with missing data__ \n1. First, I am replacing the price with the average price of price.\n2. I am dropping the remaining missing data","6533d2fe":"## Distribution of country and price","d08bd434":"### Highest Rated Wine","55468297":"Starting with importing the libraries","cff7ec3e":"# The Model","2612bf7b":"## Recommender System using a Collaborative Filtering method\nA small recommender system is made using Nearest Neighbors algorithm.\n\n- Similarity is the cosine of the angle between the 2 vectors of the item vectors of A and B\n- Closer the vectors, smaller will be the angle and larger the cosine","1b2b05be":"This answers the first question (first part)\n- Which is the most reviewed country and most reviewed variety?<br>\nUSA","0eff37fb":"We can see a few interesting fact. Each country has its own characteristic and description of wine.","e4c7d46d":"This answers our 7th question\n-\t**Is there any relationship between points and any other attributes?**\n<br> Yes, there is a relationship between points and description length"}}