{"cell_type":{"10647739":"code","9b234ea7":"code","93151729":"code","62d03bb9":"code","51e62fd4":"code","a7769ecb":"code","5eb33ad7":"code","a8829d70":"code","9ba7186d":"code","848d90b2":"code","868b5449":"code","25323ea9":"code","3d3ab750":"code","316571f8":"code","7fd8963e":"code","d44591e3":"code","ae26f80d":"code","61af0747":"code","324b82fc":"code","d3d41439":"code","75252ac3":"code","e95088ca":"code","b301c551":"code","15455434":"code","9ee4892d":"code","d4e6fd3c":"code","4a91507f":"code","e4adcf6d":"code","3d97a6ff":"code","baa4f654":"code","d5196ccf":"code","29537f25":"code","809fcd4b":"code","e8e9db20":"code","fec002ef":"code","529989c2":"code","5d611ea5":"code","4c63fb45":"code","985a81ad":"code","481a4e35":"code","eda09a3c":"code","ad21880c":"code","f8ca0de8":"code","e265991b":"code","b82c1e07":"code","76f09bc5":"code","ea3c4261":"markdown","cf73eb84":"markdown","444acdfc":"markdown","f43e26e2":"markdown","d2efee70":"markdown"},"source":{"10647739":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","9b234ea7":"df = pd.read_csv('\/kaggle\/input\/spotify-south-africa-top-200-weekly-streams\/SA_Spotify_data2.csv')","93151729":"import matplotlib.pyplot as plt\nimport matplotlib.style as style\nimport seaborn as sns\nimport plotly.express as px\nimport plotly.io as pio\npio.templates.default = \"presentation\"\nstyle.use('fivethirtyeight')\nsns.set_context(\"poster\")\nsns.color_palette(\"Paired\")\n%matplotlib inline","62d03bb9":"df.head()","51e62fd4":"df['Week_BD'] = df['Week'].apply((lambda x: x[-10:]))","a7769ecb":"df['Week_BD'] = pd.to_datetime(df['Week_BD'])","5eb33ad7":"df.info()","a8829d70":"# Number of unique songs and artists\nprint(df['Artist'].nunique())\ndf['Track Name'].nunique()","9ba7186d":"df.corr()","848d90b2":"top_guy = df[df['Position']==1]\ntop_guy","868b5449":"streams_per_week_avg = df.groupby(['Week_BD'], as_index=False)['Streams'].mean()\nstreams_per_week_sum = df.groupby(['Week_BD'], as_index=False)['Streams'].sum()","25323ea9":"streams_per_week_avg.sort_values(by='Streams').tail()","3d3ab750":"streams_per_week_sum.sort_values(by='Streams').tail()","316571f8":"#Most common genre\ndf['artist_top_genre'].value_counts(normalize=True, ascending=False).head(10)","7fd8963e":"# Most Streams in Week\ndf.groupby(['Artist', 'Track Name'],as_index=False)['Streams'].max().sort_values(by='Streams', ascending=False).head(10)","d44591e3":"# Most popular artist\ndf['Artist'].value_counts(ascending=False).head(10)","ae26f80d":"# popular albums\ndf['album'].value_counts(ascending=False).head(10)","61af0747":"# Most common artist in the Top 30 streams per week\ndf1 = df[df['Position'] <= 30]\ndf1['Artist'].value_counts(ascending=False).head(15)","324b82fc":"# Most common song in the Top 30 streams per week\ndf1['Track Name'].value_counts(ascending=False).head(15)","d3d41439":"# Oldest song on the chart\ndf[df['release_date'] == df['release_date'].min()]","75252ac3":"\npx.box(df, y=\"danceability\", points='all', hover_name='Track Name', hover_data=['Artist'])","e95088ca":"# Removing duplicate songs from different weeks\nno_dupli = df.copy()\nno_dupli.drop(columns=['Streams','Position','Week','Week_BD'], inplace=True)\nno_dupli.drop_duplicates(inplace=True)","b301c551":"no_dupli.info()","15455434":"# Most popular songs (Popularity is based on the entire Spotify database)\nno_dupli.sort_values(by=['popularity'], ascending=False).head(10)","9ee4892d":"# Popular genres for artists\nno_dupli.groupby(['artist_top_genre'],as_index=False)['Artist'].count().sort_values('Artist', ascending=False).head(15)","d4e6fd3c":"# Isolating the top 10 genres\ndf_genre = df[df['artist_top_genre'].isin([\"dance pop\", \"pop\",\"afro house\",\"chicago rap\",\"alternative r&b\",\"melodic rap\",\"dfw rap\",\"rap\",\"canadian hip hop\"])]","4a91507f":"px.box(df_genre, x='artist_top_genre', color='artist_top_genre',y=\"popularity\", points='all', hover_name='Track Name', hover_data=['Artist'])","e4adcf6d":"# Top genres in the top 30 streams per week\ndf_genre1 = df1[df1['artist_top_genre'].isin([\"dance pop\", \"pop\",\"afro house\",\"chicago rap\",\"brooklyn drill\",\"melodic rap\",\"dfw rap\",\"electropop\",\"canadian contemporary r&b\"])]","3d97a6ff":"px.box(df_genre1, x='artist_top_genre', color='artist_top_genre',y=\"popularity\", points='all', hover_name='Track Name', hover_data=['Artist'])","baa4f654":"plt.figure(figsize=(16, 6))\nmask = np.triu(np.ones_like(no_dupli.corr(), dtype=np.bool))\nheatmap = sns.heatmap(no_dupli.corr(), mask=mask, vmin=-1, vmax=1, annot=True)\nheatmap.set_title('Audio Features Correlation Heatmap', fontdict={'fontsize':18}, pad=16)","d5196ccf":"fig, axes = plt.subplots(nrows=2, ncols=5, figsize=(18,10))\nplt.tight_layout()\naxes[0][0].plot(no_dupli['length'].value_counts().sort_index())\naxes[0][0].set_title('Duration(ms)')\naxes[0][1].plot(no_dupli['energy'].value_counts().sort_index())\naxes[0][1].set_title('energy')\naxes[0][2].plot(no_dupli['danceability'].value_counts().sort_index())\naxes[0][2].set_title('danceability')\naxes[0][3].plot(no_dupli['loudness'].value_counts().sort_index())\naxes[0][3].set_title('loudness(dB)')\naxes[0][4].plot(no_dupli['liveness'].value_counts().sort_index())\naxes[0][4].set_title('liveness')\naxes[1][0].plot(no_dupli['tempo'].value_counts().sort_index())\naxes[1][0].set_title('tempo')\naxes[1][1].plot(no_dupli['instrumentalness'].value_counts().sort_index())\naxes[1][1].set_title('instrumentalness')\naxes[1][2].plot(no_dupli['acousticness'].value_counts().sort_index())\naxes[1][2].set_title('acousticness')\naxes[1][3].plot(no_dupli['speechiness'].value_counts().sort_index())\naxes[1][3].set_title('speechiness')\naxes[1][4].plot(no_dupli['popularity'].value_counts().sort_index())\naxes[1][4].set_title('popularity')","29537f25":"f, axes = plt.subplots(2, 5, figsize=(20, 12))\nsns.despine(left=True)\nsns.boxplot(x=no_dupli.instrumentalness, color=\"r\", ax=axes[0, 0])\nsns.boxplot(x=df.energy,color=\"b\", ax=axes[0, 1])\nsns.boxplot(x=df.danceability, color=\"r\", ax=axes[0, 2])\nsns.boxplot(x=df.loudness, color=\"b\", ax=axes[0, 3])\nsns.boxplot(x=df.liveness, color=\"r\", ax=axes[0, 4])\nsns.boxplot(x=df.tempo, color=\"b\", ax=axes[1, 0])\nsns.boxplot(x=df.length, color=\"r\", ax=axes[1, 1])\nsns.boxplot(x=df.acousticness, color=\"b\", ax=axes[1, 2])\nsns.boxplot(x=df.speechiness, color=\"r\", ax=axes[1, 3])\nsns.boxplot(x=df.popularity, color=\"b\", ax=axes[1, 4])","809fcd4b":"fig = px.scatter(df, x=\"danceability\", y=\"energy\", color='energy', hover_name='Track Name', hover_data=['Artist','artist_top_genre'])\nfig.show()","e8e9db20":"px.box(df_genre1, x='artist_top_genre', color='artist_top_genre',y=\"speechiness\", points='all', hover_name='Track Name', hover_data=['Artist'])","fec002ef":"px.box(df_genre1, x='artist_top_genre', color='artist_top_genre',y=\"tempo\", points='all', hover_name='Track Name', hover_data=['Artist'])","529989c2":"#calculate the average of the popularity and the size of each genre \ngenre_popularity = df.groupby([\"artist_top_genre\"], as_index=False)\ngenre_popularity = genre_popularity.agg({'popularity':[np.mean, np.size]})\ngenre_popularity.columns = list(map(''.join, genre_popularity.columns.values))\n#sort\ngenre_popularity = genre_popularity.sort_values(by=[\"popularitymean\"], ascending = False)\n\ngenre_popularity.head(10)","5d611ea5":"fig = px.scatter(genre_popularity, y=\"popularitymean\", x=\"popularitysize\", hover_name='artist_top_genre', hover_data=['artist_top_genre'])\nfig.show()","4c63fb45":"from sklearn.decomposition import PCA\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.cluster import KMeans\nrs = 123\nnp.random.seed(rs)\n\ndef pca_plot(df, classes=None):\n\n    # Scale data for PCA\n    scaled_df = StandardScaler().fit_transform(df)\n    \n    # Fit the PCA and extract the first two components\n    pca_results = PCA().fit_transform(scaled_df)\n    pca1_scores = pca_results[:,0]\n    pca2_scores = pca_results[:,1]\n    \n    # Sort the legend labels\n    if classes is None:\n      hue_order = None\n      n_classes = 0\n    elif str(classes[0]).isnumeric():\n      classes = ['Cluster {}'.format(x) for x in classes]\n      hue_order = sorted(np.unique(classes))\n      n_classes = np.max(np.unique(classes).shape)\n    else:\n      hue_order = sorted(np.unique(classes))\n      n_classes = np.max(np.unique(classes).shape)\n\n    # Plot the first two principal components\n    plt.figure(figsize=(8.5,8.5))\n    plt.grid()\n    sns.scatterplot(pca1_scores, pca2_scores, s=50, hue=classes,\n                    hue_order=hue_order, palette='Set1')\n    plt.xlabel(\"Principal Component {}\".format(1))\n    plt.ylabel(\"Principal Component {}\".format(2))\n    plt.title('Principal Component Plot')\n    plt.show()","985a81ad":"\naudio_feature_cols = ['danceability', 'energy', 'loudness', \n                      'speechiness', 'acousticness', 'instrumentalness',\n                      'liveness', 'tempo', 'length',\n                      'time_signature']","481a4e35":"# Plot the principal component analysis results\npca_plot(no_dupli[audio_feature_cols])","eda09a3c":"scaled_df = StandardScaler().fit_transform(no_dupli[audio_feature_cols])\n# Calculate the Total Distance for each value of k between 1 and 10\nscores = []\nfor i in range(1,11):\n    fit_k = KMeans(n_clusters=i, n_init=5, random_state=rs).fit(scaled_df)\n    scores.append(fit_k.inertia_)\n\n# Plot this in an elbow plot\nplt.figure(figsize=(11,8.5))\nsns.lineplot(range(1,11), scores, palette=sns.color_palette('Set1'))\nplt.xlabel('Number of clusters $k$')\nplt.ylabel('Total Point to Centroid Distance')\nplt.grid()\nplt.title('The Elbow Method showing the optimal $k$')\nplt.show()","ad21880c":"best_k = 3\nbest_cluster_results = KMeans(n_clusters=best_k, n_init=25, random_state=rs).fit(scaled_df)\n\n# Save the cluster labels in our dataframe\nno_dupli['best_cluster'] = ['Cluster ' + str(i) for i in best_cluster_results.labels_]\n\n# Show a PCA plot of the clusters\npca_plot(no_dupli[audio_feature_cols], classes=no_dupli['best_cluster'])","f8ca0de8":"no_dupli.groupby(['best_cluster'],as_index=False).size()","e265991b":"# Plot the distribution of audio features by cluster\ng = sns.pairplot(no_dupli, hue=\"best_cluster\",\n                 vars=['danceability', 'energy', 'loudness', 'speechiness', 'tempo'],\n                 hue_order=sorted(no_dupli.best_cluster.unique()), palette='Set1')\ng.fig.suptitle('Distribution of Audio Features by Cluster', y=1.05)\nplt.show()","b82c1e07":"c = no_dupli.groupby(['best_cluster','artist_top_genre','Track Name'], as_index=False)['popularity'].mean().sort_values(by='popularity').head(20)","76f09bc5":"\npx.sunburst(c, path=['best_cluster','artist_top_genre', 'Track Name'], values='popularity', title= 'Sunburst chart for top songs',\n           color_discrete_sequence=px.colors.qualitative.Set2, branchvalues='total', width=2000, height = 1000)\n","ea3c4261":"Position and streams, obviously\n\nLength and pop, instrumentalness, loudness\n\nacousticness and energy\n\nenergy and loudness\n\ninstrumentalness and loudness","cf73eb84":"We can also group by the week. find average streams","444acdfc":"## Data Analysis","f43e26e2":"\nPositions are kept for concurrent weeks","d2efee70":"## Clustering"}}