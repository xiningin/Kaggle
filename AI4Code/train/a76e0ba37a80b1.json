{"cell_type":{"65aa767f":"code","05431172":"code","5380fc24":"code","5d78a481":"code","6bf49b8b":"code","4eeb67ed":"code","f8fd557f":"code","81225528":"code","ff72f51b":"code","8cf315c6":"code","1f78f022":"code","53bbd00a":"code","a5aca199":"markdown","f570f76a":"markdown","97f64329":"markdown","26cf9c3b":"markdown","5f664185":"markdown","eee29955":"markdown"},"source":{"65aa767f":"\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport glob\nimport json\nimport re\nimport scipy as sc\nimport warnings\n\nimport matplotlib.pyplot as plt\nimport os\n\n","05431172":"root_path = '\/kaggle\/input\/CORD-19-research-challenge\/'\nmetadata_path = f'{root_path}\/metadata.csv'\nmeta_df = pd.read_csv(metadata_path, dtype={\n    'pubmed_id': str,\n    'Microsoft Academic Paper ID': str, \n    'doi': str\n})\nmeta_df.head()\nmeta_df.info()","5380fc24":"meta_df.head()\n","5d78a481":"df=pd.read_csv('..\/input\/covid19prepareddata\/Prepared_data.csv')\ndf.head()\ndf.info()","6bf49b8b":"task1=\"\"\"Specifically, we want to know what the literature reports about:\n\nWhat do we know about diagnostics and coronavirus?\nNew advances in diagnosing SARS-COV-2\nDevelopment of a point-of-care test and rapid bed-side tests\nDiagnosing SARS-COV-2 with Nucleic-acid based tech\nDiagnosing SARS-COV-2 with antibodies\nHow does viral load relate to disease presentations and likelihood of a positive diagnostic test?\"\"\"","4eeb67ed":"task=[task1]\nquery=[]\nfor i in range(len(task)):\n    task[i]=task[i].split(\"\\n\")\n    query.append(task[i][2:])\nprint(query)","f8fd557f":"!pip install -U sentence-transformers","81225528":"from sklearn.metrics.pairwise import cosine_similarity\nfrom sentence_transformers import SentenceTransformer\n\nwarnings.filterwarnings(\"ignore\")\nmodel = SentenceTransformer('bert-base-nli-mean-tokens')\n    ","ff72f51b":"query_embeddings=[]\nfor i in range(len(query)):\n    query_embeddings.append(model.encode(query[i]))","8cf315c6":"df.reset_index(drop = True, inplace = True)\ndf['abstract_summary']\nabstract_summary_embeddings = model.encode(df['abstract_summary'])\n","1f78f022":"def getfile_insensitive(path):\n    directory, filename = os.path.split(path)\n    directory, filename = (directory or '.'), filename.lower()\n    for f in os.listdir(directory):\n        newpath = os.path.join(directory, f)\n        if os.path.isfile(newpath) and f.lower() == filename:\n            return newpath\n\ndef isfile_insensitive(path):\n    return getfile_insensitive(path) is not None\n\nsample_document='6_diagnostics'\n","53bbd00a":"scores=[]\ndef formatting(_topdf):\n    _topdf.rename(columns={'journal':'Journal'},inplace=True)\n    _topdf.rename(columns={'url':'Study Link'},inplace=True)\n    _topdf.rename(columns={'publish_time':'Date'},inplace=True)\n    _topdf.rename(columns={'title':'Study'},inplace=True)\n    \n    return _topdf\nfor tsk in range(len(task)):\n    \n    for prob, query_embedding in zip(query[tsk], query_embeddings[tsk]):\n        dis = sc.spatial.distance.cdist([query_embedding], abstract_summary_embeddings, \"cosine\")[0]\n        #print(dis)\n        results = zip(range(len(dis)), dis)\n        results = sorted(results, key=lambda x: x[1])\n        #print(\"Query:\", prob)\n        #print(\"Answer:\" )\n        scores.append(1-results[0][1])\n        #print(df['abstract'][results[0][0]].strip(), \"\\n(Score: %.4f)\" % (1-results[0][1]),\"\\n\")\n        k=50\n        #print(results[:k])\n        topk=results[:k]\n        id,id_v=zip(*topk)\n        topData=df.iloc[1]\n        _topdf = df.iloc[list(id), :]\n        _topdf = formatting(_topdf)\n        csv_str=prob.replace('?','_')+'.csv'\n        #print(csv_str)\n        path1 = f'{root_path}Kaggle\/target_tables\/{sample_document}\/'+csv_str\n        path1 = f'{path1}'\n        print(path1)\n        if (isfile_insensitive(path1)):\n            path1=getfile_insensitive(path1)\n            q_df = pd.read_csv(path1)\n            print(\"exist!\")\n        else:      \n            path1 = f'{root_path}Kaggle\/target_tables\/{sample_document}\/'\n            path1 = os.path.join(path1,os.listdir(path1)[-1])\n            q_df = pd.read_csv(path1)\n            q_df.drop(q_df.index,inplace=True)\n        #print(path1)\n        q_df.head()\n        q_df\n        #print(len(q_df))\n        #print(len(_topdf))\n        #print(q_df.columns)\n        res_df = pd.merge(q_df, _topdf, how='outer', on=['Study','Study Link','Date','Journal'])[q_df.columns[1:]]\n        #print(len(res_df))\n        res_df.info()\n        res_csv=r'\/kaggle\/output\/'+ csv_str\n        print(res_csv)\n        res_df.to_csv( csv_str, index = True)","a5aca199":"@inproceedings{Population studies that related to COVID-19, author = {Hang, Wu}, title = {Population studies that related to COVID-19}, year = {2020}, month = {June}, url = {\\url{https:\/\/www.kaggle.com\/nike0good\/population-studies-that-related-to-covid-19} } }","f570f76a":"# Check the keywords of the problems.","97f64329":"Specifically, we want to know what the literature reports about:\n\n- What do we know about **diagnostics** and **coronavirus**?\n- New advances in **diagnosing SARS-COV-2**\n- Development of a **point-of-care test** and **rapid bed-side tests**\n- Diagnosing SARS-COV-2 with **Nucleic-acid based tech**\n- Diagnosing SARS-COV-2 with **antibodies**\n- How does viral load relate to **disease presentations** and likelihood of a **positive diagnostic test**?","26cf9c3b":"# This is a notebook that address diagnostics for COVID-19","5f664185":"# Get data from Prepared data. This data is created in another notebook in kaggle I made.\n\nCite:\nhttps:\/\/www.kaggle.com\/nike0good\/population-studies-that-related-to-covid-19","eee29955":"# Prepare data"}}