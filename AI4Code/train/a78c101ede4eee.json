{"cell_type":{"e00d07a7":"code","7167cf05":"code","f3961d74":"code","9c4902f9":"code","6a7031e1":"code","4b4f9c4b":"code","b11ca12f":"code","5d981771":"code","ec375185":"code","acb398b2":"code","61ad94c1":"code","3a6fcb0d":"code","d10e3781":"code","839cd414":"code","c2200dc2":"code","93329582":"code","b0282765":"code","c7ec6686":"code","e41ee491":"code","e24ad054":"code","a14139b3":"code","ca60debf":"code","4fb87c6d":"code","d2eb88f2":"markdown","facdb424":"markdown","e67d3eba":"markdown","08b440a5":"markdown","d05a653a":"markdown","6b8babb4":"markdown","be4a7039":"markdown","2c2226ef":"markdown","9cb335f1":"markdown","51e25852":"markdown","2b70972f":"markdown","0db96bfd":"markdown","f6f26ced":"markdown","2403c93f":"markdown","16be7351":"markdown","f19cfb49":"markdown","1521b7dc":"markdown","7f3e4673":"markdown"},"source":{"e00d07a7":"# IMPORTING LIBRARIES\n\nimport os\nimport pandas as pd\nimport plotly.express as px\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots\nfrom urllib.request import urlopen\nimport json\nfrom tqdm import tqdm\nimport warnings \n\nwarnings.filterwarnings(action='ignore')","7167cf05":"# load the datasets\ntrain = pd.read_csv(r'\/kaggle\/input\/covid19-global-forecasting-week-4\/train.csv')\ntrain['Date'] = pd.to_datetime(train['Date'])\n\ntest = pd.read_csv(r'\/kaggle\/input\/covid19-global-forecasting-week-4\/test.csv')\ntest['Date'] = pd.to_datetime(test['Date'])\n\n\nsubmission = pd.read_csv(r'\/kaggle\/input\/covid19-global-forecasting-week-4\/submission.csv')","f3961d74":"submission.head(3)","9c4902f9":"test.head(3)","6a7031e1":"train.head()","4b4f9c4b":"# Lets take USA data\ntrain_USA = train[train['Country_Region']=='US']\n\n# grouped data sum\ntrain_USA_grouped_sum = train_USA.groupby(by='Province_State').sum()[['ConfirmedCases', 'Fatalities']]\ntrain_USA_grouped_sum = train_USA_grouped_sum.reset_index()\ntrain_USA_grouped_sum['Death_Rate'] = train_USA_grouped_sum['Fatalities']\/train_USA_grouped_sum['ConfirmedCases']*100\ntrain_USA_grouped_sum = train_USA_grouped_sum.sort_values(by='Death_Rate', ascending=True)","b11ca12f":"# CONFIRMED CASES PER EACH DAY CHANGE OVER TIME FOR USA; \nfig = px.line(train_USA, x=\"Date\", y=\"ConfirmedCases\", color=\"Province_State\", title='CONFIRMED CASES PER EACH DAY CHANGE OVER TIME FOR USA')\nfig.show()","5d981771":"# NUMBER OF FATALITIES PER EACH DAY OVER TIME FOR USA; \nfig = px.line(train_USA, x=\"Date\", y=\"Fatalities\", color=\"Province_State\", title='NUMBER OF FATALITIES PER EACH DAY OVER TIME FOR USA')\nfig.show()","ec375185":"df_USA = train_USA.groupby('Date',as_index=False)['ConfirmedCases','Fatalities'].sum()\ndf_USA['ConfirmedCases_change'] = df_USA['ConfirmedCases'].shift(-1) - df_USA['ConfirmedCases']\ndf_USA['Fatalities_change'] = df_USA['Fatalities'].shift(-1) - df_USA['Fatalities']\n\nfig = go.Figure(data=[\n    go.Bar(name='Cases', x=df_USA['Date'], y=df_USA['ConfirmedCases']),\n    go.Bar(name='Deaths', x=df_USA['Date'], y=df_USA['Fatalities'])])\n\n# Change the bar mode\nfig.update_layout(barmode='overlay', title='Number of ConfirmedCases and Total Fatalities in USA')\nfig.show()","acb398b2":"fig = go.Figure(data=[\n    go.Bar(name='Cases', x=df_USA['Date'], y=df_USA['ConfirmedCases_change']),\n    go.Bar(name='Deaths', x=df_USA['Date'], y=df_USA['Fatalities_change'])])\n\n# Change the bar mode\nfig.update_layout(barmode='overlay', title='Number of ConfirmedCases and Total Fatalities Change in USA')\nfig.show()","61ad94c1":"train_USA.head(3)","3a6fcb0d":"train_USA['ConfirmedCases_shifted'] = train_USA.groupby(by='Province_State')['ConfirmedCases'].shift(-1)\ntrain_USA['Fatalities_shifted'] = train_USA.groupby(by='Province_State')['Fatalities'].shift(-1)\n\ndef calc_percent_change(x1, x2):\n    if x1==0:\n        return 0\n    else:\n        return round(abs(x2-x1)\/x1*100,2)\n    \ntrain_USA['ConfirmedCases_%_change'] = train_USA.apply(lambda x: calc_percent_change(x['ConfirmedCases'], x['ConfirmedCases_shifted']),axis=1 )\ntrain_USA['Fatalities_%_change'] = train_USA.apply(lambda x: calc_percent_change(x['Fatalities'], x['Fatalities_shifted']),axis=1 )\n\ntrain_USA['ConfirmedCases_delta'] = train_USA['ConfirmedCases_shifted'] - train_USA['ConfirmedCases']\ntrain_USA['Fatalities_delta'] = train_USA['Fatalities_shifted'] - train_USA['Fatalities']\n","d10e3781":"# CONFIRMED CASES CHANGE IN % TIME FOR USA; \nfig = px.line(train_USA, x=\"Date\", y=\"ConfirmedCases_%_change\", color=\"Province_State\", title='CONFIRMED CASES PER EACH DAY  CHANGE OVER TIME IN % FOR USA')\nfig.show()","839cd414":"# CONFIRMED CASES DELTA OVER TIME FOR USA; \nfig = px.line(train_USA, x=\"Date\", y=\"ConfirmedCases_delta\", color=\"Province_State\", title='CONFIRMED CASES DELTA FOR USA')\nfig.show()","c2200dc2":"# CONFIRMED CASES DELTA OVER TIME FOR USA; \n\nfor state in train_USA.Province_State.unique().tolist():\n    fig = px.line(train_USA[train_USA['Province_State']==state], x=\"Date\", y=\"ConfirmedCases_delta\", color=\"Province_State\", title=state, \n                 width=1000, height=300)\n    fig.show()","93329582":"# FATALITIES % CHANGE OVER TIME FOR USA; \nfig = px.line(train_USA, x=\"Date\", y=\"Fatalities_%_change\", color=\"Province_State\", title='FATALITIES % CHANGE OVER TIME FOR USA')\nfig.show()","b0282765":"# FATALITIES %DELTA CHANGE OVER TIME FOR USA; \nfig = px.line(train_USA, x=\"Date\", y=\"Fatalities_delta\", color=\"Province_State\", title='FATALITIES %DELTA CHANGE OVER TIME FOR USA')\nfig.show()","c7ec6686":"train_USA.head(3)","e41ee491":"# CREATE PIE CHART FOR TOTAL CONFIRMED CASES AND FATALITIES IN USA \nfig = make_subplots(rows=1, cols=2, specs=[[{'type':'domain'}, {'type':'domain'}]])\n\nfig.add_trace(go.Pie(values=train_USA_grouped_sum['ConfirmedCases'], labels=train_USA_grouped_sum['Province_State'], name=\"ConfirmedCases\"), 1, 1)\nfig.add_trace(go.Pie(values=train_USA_grouped_sum['Fatalities'], labels=train_USA_grouped_sum['Province_State'], name=\"Fatalities\"), 1, 2)\nfig.update_layout(\n    title_text=\"USA Total ConfirmedCases and Fatalities by Province for 2020-04-11\")\n\nfig.show()","e24ad054":"fig = go.Figure(go.Bar(\n            x=train_USA_grouped_sum['Death_Rate'],\n            y=train_USA_grouped_sum['Province_State'],\n            orientation='h'))\nfig.update_layout(\n    title_text=\"USA Death_Rate Horizontal Bar Chart by Province for 2020-04-11\")\nfig.show()\n\n","a14139b3":"# Load data frame and tidy it.\ndf = pd.read_csv('https:\/\/raw.githubusercontent.com\/plotly\/datasets\/master\/2011_us_ag_exports.csv')\ndf = df[['code', 'state']]\ndf = df.set_index('state')\ndf = df.to_dict()['code']\n# converter to convert Province_States \n\n\ndef dict_convert(row, dicti):\n    if row in dicti.keys():\n        return dicti[row]\n    else:\n        return None\n    \n    \ntrain_USA_grouped_sum['Province_State_index'] = train_USA_grouped_sum['Province_State'].apply(lambda x: dict_convert(row=x, dicti=df))\n\n","ca60debf":"# COVID USA CONFIRMED_CASES MAP\nfig = go.Figure(data=go.Choropleth(\n    locations=train_USA_grouped_sum['Province_State_index'], # Spatial coordinates\n    z = train_USA_grouped_sum['ConfirmedCases'].astype(float), # Data to be color-coded\n    locationmode = 'USA-states', # set of locations match entries in `locations`\n    colorscale = 'Blackbody',\n    colorbar_title = \"ConfirmedCases\",\n))\n\nfig.update_layout(\n    title_text = 'Covid USA ConfirmedCases',\n    geo_scope='usa', # limite map scope to USA\n)\n\nfig.show()","4fb87c6d":"# COVID USA FATALITIES MAP\nfig = go.Figure(data=go.Choropleth(\n    locations=train_USA_grouped_sum['Province_State_index'], # Spatial coordinates\n    z = train_USA_grouped_sum['Fatalities'].astype(float), # Data to be color-coded\n    locationmode = 'USA-states', # set of locations match entries in `locations`\n    colorscale = 'Blackbody',\n    colorbar_title = \"Fatalities\",\n))\n\nfig.update_layout(\n    title_text = 'Covid USA Fatalities',\n    geo_scope='usa', # limite map scope to USA\n)\n\nfig.show()","d2eb88f2":"# 3) Lets plot Confirmed Cases and Fatalities properties over time for USA ","facdb424":"# 7) CONFIRMED CASES DELTA OVER TIME FOR USA; ","e67d3eba":"# Train data","08b440a5":"# Submission data","d05a653a":"# 6) CONFIRMED CASES CHANGE IN % TIME FOR USA; ","6b8babb4":"# 4) Total Number (Cumulative) of ConfirmedCases and Total Fatalities in USA","be4a7039":"# 11) CREATE PIE CHART FOR TOTAL CONFIRMED CASES AND FATALITIES IN USA ","2c2226ef":"# USA DATASET CONCLUSION\n\n## Top 5 Provinces with high ConfirmedCases:\n1. New York;\n2. New Jersey;\n3. California; \n4. Michigan; \n5. Massachusetts.\n\n\n## Top 5 Provinces with high Fatalities:\n1. New York;\n2. New Jersey;\n3. Michigan; \n4. Louisiana; \n5. Washington.\n\n## Top 5 Provinces with high DeathRate\n1. Washington; \n2. Kentucky;\n3. Puerto Rico;\n4. Vermont;\n5. Michigan;\n\n## Top 5 Provinces with low DeathRate:\n1. Wyoming;\n2. Utah;\n3. West Virginia;\n4. Hawaii;\n5. Virgin Islands.\n\n\n1) Covid speed rate decreases over the time in percent change for each state (see **SECTIONS** 6,9) <br>\n\n2) Covid absolute number of ConfirmedCases and Fatalities increases (see **SECTIONS** 5). But ConfirmedCases & Fatalities speed decreases and the angle is almost equal to zero (Number of deaths and cases is almost the same) <br> \n\n3) Covid Total ConfirmedCases and Fatalities Maps show that most cases are located in west (California) and north-east of USA (New-York, New-Jersey, Michigan).\n","9cb335f1":"# 8) Lets explore how ConfirmedCases changes per each State in detail","51e25852":"# Test data","2b70972f":"# 1)  STEP 1. LOAD THE DATASETS","0db96bfd":"# 2) STEP 2. Some data exploration results\n## Train dataset:\n* number of train dataset rows = 25040;\n* train start-end dates: 1) 2020-01-22; 2) 2020-04-10; (about 3 month dataset);\n* Total number of countries - 184;\n\n## Test dataset\n* number of test dataset rows = 13459;\n* test start-end dates: 1) 2020-04-02; 2) 2020-05-14;\n* Total number of countries - 184;\n","f6f26ced":"# 13) COVID USA CONFIRMED_CASES & FATALITIES MAPS","2403c93f":"## To be Continued","16be7351":"# 9) FATALITIES % CHANGE OVER TIME FOR USA; ","f19cfb49":"# 5) Total USA ConfirmedCases and Total Fatalities","1521b7dc":"# 12) USA Death_Rate Horizontal Bar Chart by Province for 2020-04-11","7f3e4673":"# 10) FATALITIES %DELTA CHANGE OVER TIME FOR USA; "}}