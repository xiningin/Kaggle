{"cell_type":{"38a2e7cf":"code","4a3d303a":"code","72675ff9":"code","ccf1aa93":"code","d5060111":"code","491a83b9":"code","7dc898d5":"code","d13006f4":"code","b31c6cd8":"code","1fb0162f":"code","e6c9b720":"code","0ce45021":"code","478bccff":"code","0fd561fc":"code","358a015d":"code","1d88a111":"markdown","eadedecb":"markdown","5ba51382":"markdown","74e30d1a":"markdown","6ad562c2":"markdown","abc60a6d":"markdown","c3a44506":"markdown","68f2dc02":"markdown","baed032e":"markdown","75355dff":"markdown","3133413e":"markdown","6441667a":"markdown","89eb7376":"markdown","f2bd746d":"markdown","e33f945c":"markdown"},"source":{"38a2e7cf":"from matplotlib import pyplot as plt\nimport numpy as np\nimport pandas as pd\nimport re\nimport seaborn as sns\nfrom sklearn.cluster import KMeans\n","4a3d303a":"df = pd.read_csv(\"..\/input\/steam-200k.csv\", header=None, index_col=None, names=['UserID', 'Game', 'Action', 'Hours', 'Other'])\ndf.head()","72675ff9":"# infos for action \"play\", seems more relevant to me.\n# we want here to exclude the action = 'purchase' with Hours = 1.0 that are not relevant in the mean computation \ndf.loc[df['Action'] == 'play'].describe()\n\n","ccf1aa93":"values = df.groupby(['UserID', 'Action']).size()\nvalues.head()","d5060111":"print(\"Number of games : {0}\".format(len(df.Game.unique())))\nprint(\"Number of users : {0}\".format(len(df.UserID.unique())))\nprint(\"Number of total purchases : {0}\".format(len(df.loc[df['Action'] == 'purchase'])))\nprint(\"Number of total plays infos : {0}\".format(len(df.loc[df['Action'] == 'play'])))\n\n\n\n","491a83b9":"nb_games = 10\ndf_purchase = df.loc[df['Action'] == 'purchase']\npurchased_times = df_purchase.groupby('Game')['Game'].agg('count').sort_values(ascending=False)\npurchased_times = pd.DataFrame({'game': purchased_times.index, 'times_purchased': purchased_times.values})[0:nb_games]\n\ndf_play = df.loc[df['Action'] == 'play']\nhours_played = df_play.groupby('Game')['Hours'].agg(np.sum).sort_values(ascending=False)\nhours_played = pd.DataFrame({'game': hours_played.index, 'hours_played': hours_played.values})[0:nb_games]\n\nfig, ax =plt.subplots(1,2,figsize=(12,nb_games))\n\nsns.barplot(y = 'game', x = 'times_purchased', data = purchased_times, ax=ax[0])\nsns.barplot(y = 'game', x = 'hours_played', data = hours_played, ax=ax[1])\n\n\nax[1].yaxis.tick_right()\nax[1].yaxis.set_label_position(\"right\")\nfor i in range(0,2):\n    ax[i].tick_params(axis='y', labelsize=18)\n    ax[i].xaxis.label.set_size(20)\n","7dc898d5":"top = 10\nuser_counts = df.groupby('UserID')['Hours'].agg(np.sum).sort_values(ascending=False)[0:top]\nmask = df['UserID'].isin(user_counts.index)\ndf_infos_user = df.loc[mask].loc[df['Action'] == 'play']\nhours_played = df_infos_user.groupby('Game')['Hours'].agg(np.sum).sort_values(ascending=False)\nhours_played = pd.DataFrame({'game': hours_played.index, 'hours_played': hours_played.values})[0:nb_games]\n\nsns.barplot(y = 'game', x = 'hours_played', data = hours_played)\n\n","d13006f4":"nb_top_games = 20\nhours_played = df_play.groupby('Game')['Hours'].agg(np.sum).sort_values(ascending=False)\ntop_played_games = pd.DataFrame({'game': hours_played.index, 'hours_played': hours_played.values})[0:nb_top_games]\n\nmask = df['Game'].isin(top_played_games['game'])\n\ndf_infos_user = df.loc[mask].loc[df['Action'] == 'play'][['Hours', 'Game']]\n\n\nsns.set_style(\"whitegrid\")\nsns.boxplot(x=\"Hours\", y=\"Game\", data=df_infos_user, palette=\"Set3\")\n","b31c6cd8":"df_purchased_games = df.loc[df['Action'] == 'purchase']\ndf_played_games = df.loc[df['Action'] == 'play']\n\n#here we compute the number of games a user has bought\nuser_counts = df_purchased_games.groupby('UserID')['UserID'].agg('count').sort_values(ascending=False)\n#here we compute the number of hours he has played \nhours_played = df_played_games.groupby('UserID')['Hours'].agg(np.sum).sort_values(ascending=False)\n\n#df creation\nuser_df_purchased_games = pd.DataFrame({'UserID': user_counts.index, 'nb_purchased_games': user_counts.values})\nuser_df_hours_played = pd.DataFrame({'UserID': hours_played.index, 'hours_played': hours_played.values})\n\n#merge to have one entry per user with number of hours played and number of purchased games\ndata = pd.merge(user_df_purchased_games, user_df_hours_played, on='UserID')\nsns.jointplot(x=\"nb_purchased_games\", y=\"hours_played\", data=data)# , kind=\"reg\")","1fb0162f":"g = sns.jointplot(x=\"nb_purchased_games\", y=\"hours_played\", data=data )#, kind=\"reg\")\nax = g.ax_joint\nax.set_yscale('log')\ng.ax_marg_y.set_yscale('log')\ng","e6c9b720":"#here we compute the number of games a user has played\nuser_counts = df_played_games.groupby('UserID')['UserID'].agg('count').sort_values(ascending=False)\n#here we compute the number of hours he has played \nhours_played = df_played_games.groupby('UserID')['Hours'].agg(np.sum).sort_values(ascending=False)\n\n#df creation\nuser_df_played_games = pd.DataFrame({'UserID': user_counts.index, 'nb_played_games': user_counts.values})\nuser_df_hours_played = pd.DataFrame({'UserID': hours_played.index, 'hours_played': hours_played.values})\n\n\n#merge to have one entry per user with number of hours played and number of played games\ndata = pd.merge(user_df_played_games, user_df_hours_played, on='UserID')\n\nsns.jointplot(x=\"nb_played_games\", y=\"hours_played\", data=data )# , kind=\"reg\")\n","0ce45021":"g = sns.jointplot(x=\"nb_played_games\", y=\"hours_played\", data=data )#, kind=\"reg\")\nax = g.ax_joint\nax.set_yscale('log')\ng.ax_marg_y.set_yscale('log')\ng","478bccff":"temp = pd.merge(user_df_purchased_games, data, on='UserID')\ntemp = temp.copy()\ndel temp['UserID'] #don't need this for k mean\nsns.heatmap(temp.corr(),annot=True,cmap='cubehelix_r') #draws  heatmap with input as the correlatio","0fd561fc":"# K Means\ntemp = data.copy()\ndel temp['UserID'] #don't need this for k mean\n\nN_CLUSTERS = 6\ntrain_data = temp.as_matrix()\n# Using sklearn\nkm = KMeans(n_clusters=N_CLUSTERS)\nkm.fit(train_data)\n# Get cluster assignment labels\nlabels = km.labels_ # 0 to n_clusters-1\n# Format results as a DataFrame\n\nLABEL_COLOR_MAP = {0 : 'red',\n                   1 : 'blue',\n                   2 : 'green',\n                   3 : 'yellow',\n                   4 : 'orange',\n                   5 : 'pink'\n                  }\n\nlabel_color = [LABEL_COLOR_MAP[l] for l in labels]\n\n\nfig, ax =plt.subplots(2,1,figsize=(10,10))\nax[0].scatter(data[['nb_played_games']], data[['hours_played']], c=label_color, s=8, marker='o')\nax[0].set_xlabel('nb_played_games')\nax[0].set_ylabel('hours_played')\nax[0].set_title('K Means')\n\nax[1].scatter(data[['nb_played_games']], data[['hours_played']], c=label_color, s=8, marker='o')\nax[1].set_xlabel('nb_played_games')\nax[1].set_ylabel('hours_played(log)')\nax[1].set_title('K Means with y log scale')\nax[1].set_yscale('log')\n","358a015d":"from sklearn.mixture import GaussianMixture\ncov_types = ['spherical', 'diag', 'tied', 'full']\n\ngm = GaussianMixture(n_components=N_CLUSTERS, covariance_type='diag')\ngm.fit(train_data)\ny_train_pred = gm.predict(train_data)\nlabel_color = [LABEL_COLOR_MAP[l] for l in y_train_pred]\n\nfig, ax =plt.subplots(3,1,figsize=(10,10))\nax[0].scatter(data[['nb_played_games']], data[['hours_played']], c=label_color, s=8, marker='o')\nax[0].set_xlabel('nb_played_games')\nax[0].set_ylabel('hours_played')\nax[0].set_title('Gaussian Mixture')\n\nax[1].scatter(data[['nb_played_games']], data[['hours_played']], c=label_color, s=8, marker='o')\nax[1].set_xlabel('nb_played_games')\nax[1].set_ylabel('hours_played(log)')\nax[1].set_title('Gaussian Mixture with y log scale')\nax[1].set_yscale('log')\n\nax[2].scatter(data[['nb_played_games']], data[['hours_played']], c=label_color, s=8, marker='o')\nax[2].set_xlabel('nb_played_games(log)')\nax[2].set_ylabel('hours_played(log)')\nax[2].set_title('Gaussian Mixture with x and y log scale')\nax[2].set_yscale('log')\nax[2].set_xscale('log')\n","1d88a111":"With log scale on y axe","eadedecb":"Hard to find a pattern in this ... Let's try the log scale on y","5ba51382":"By testing several value for the number of top gamers, we observe some surprising to-played games like CIvilization V being the most played within the top whereas only on the 5th position of the most-played games.\nSame thing for Mount & Blade Warband, not appearing in the top10 most played games for all users but present in the top with we only keep the most active players. We will now try to observe this distribution of played time for those particular games, and maybe differenciate the famous games played less than some less known games but causing hardcore gaming. ","74e30d1a":"As we can see, there are some games staying quite close to the mean played games, whereas some others like FM or Civilization have some vert extremal played times.","6ad562c2":"In this, we will check if each time a player buys a games, he plays it","abc60a6d":"Now let's sort the most active users by hours played and have a glance at the game they play.","c3a44506":"## User Classification ##\nIn this we will try to find some clusters for users, to determine profile of gamers.\nTo do so, we will try to use :\n\n- Nb Purchased Games vs Hours Played\n- Nb Played Games vs Hours Played\n- Nb Actions vs Hours Played","68f2dc02":"Logically, we have a strong correlation between the number of **played games** and the number of **purchased games**","baed032e":"## Game and Users Analysis ##\nFirst, we will plot how many times each game is purchased. Also we will plot how many hours it is played to see if the most purchased games are the most played.","75355dff":"**Gaussian Mixture**","3133413e":"## Data discovery ##","6441667a":"We can see that for some users, we have some infos about bought games but no infos about the time played, so we will try to consider this skew in the following","89eb7376":"To much noise in the dataset, we should try to eliminate those absurd values to focus more precisely on the core of the points.","f2bd746d":"We have dyssimetric informations between the purchases and the played times.","e33f945c":"**K MEANS**"}}