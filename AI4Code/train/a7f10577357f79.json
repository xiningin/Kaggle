{"cell_type":{"75815e4b":"code","75b28533":"code","a2b494f9":"code","609f0edc":"code","36bbd440":"code","0fed7c23":"code","39e4f4d2":"code","f081f071":"code","97f62cce":"code","a88b9d24":"code","f85cdb36":"code","3de2f49b":"code","f0a51104":"code","e8ba143f":"code","81d30205":"code","87611a02":"code","d79b9180":"code","51483ad3":"code","e3119949":"markdown","ad62fd33":"markdown"},"source":{"75815e4b":"!pip install --upgrade fastai2 > \/dev\/null\n!pip install --upgrade fastcore > \/dev\/null\n!pip install pretrainedmodels > \/dev\/null","75b28533":"from fastai2.vision.all import *\nimport pretrainedmodels","a2b494f9":"panda_block = DataBlock(blocks=(ImageBlock, CategoryBlock),\n                        splitter=RandomSplitter(),\n                        get_x=ColReader('image_id',pref=Path('..\/input\/panda-challenge-512x512-resized-dataset'),suff='.jpeg'),\n                        get_y=ColReader('isup_grade'),\n                        item_tfms=Resize(256),\n                        batch_tfms=aug_transforms()\n                       )","609f0edc":"train_df = pd.read_csv('..\/input\/prostate-cancer-grade-assessment\/train.csv')","36bbd440":"train_df.head()","0fed7c23":"dls = panda_block.dataloaders(train_df,bs=16)","39e4f4d2":"dls.show_batch()","f081f071":"m = pretrainedmodels.se_resnext50_32x4d(pretrained='imagenet')\nchildren = list(m.children())\nhead = nn.Sequential(nn.AdaptiveAvgPool2d(1), Flatten(), \n                                  nn.Linear(children[-1].in_features,200))\nmodel = nn.Sequential(nn.Sequential(*children[:-2]), head)","97f62cce":"learn = Learner(dls,model,splitter=default_split,metrics=[accuracy,CohenKappa(weights='quadratic')])","a88b9d24":"learn.freeze()\nlearn.lr_find()","f85cdb36":"learn.freeze()\nlearn.fit_one_cycle(5,6e-3)","3de2f49b":"learn.save('stage-1-512.pth')","f0a51104":"learn.load('stage-1-512.pth')","e8ba143f":"learn.unfreeze()\nlearn.lr_find()","81d30205":"learn.unfreeze()\nlearn.fit_one_cycle(5,slice(1e-6,5e-5))","87611a02":"learn.save('stage-2-512.pth')","d79b9180":"learn.recorder.plot_loss()","51483ad3":"learn.export()","e3119949":"# fastai2 training baseline\n## If you found this helpful, please upvote!","ad62fd33":"How to improve:\n- The dataset used (resized 512x512) is terrible. Need to determine how to create a better dataset."}}