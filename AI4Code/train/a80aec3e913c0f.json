{"cell_type":{"d0e97c4e":"code","53efe103":"code","db63df16":"code","058c3cf6":"code","afae58aa":"code","30a8c02b":"code","44a1c886":"code","91085cd9":"code","9faa13bc":"code","cb90eede":"code","a7f46bf1":"code","b953e403":"code","1873ddda":"code","a1e3f08f":"code","b9961931":"code","cbd33755":"code","7e9fbbdf":"code","e4e43135":"code","4bbe1b77":"code","1a9bb15c":"code","40bef58b":"code","37fb10cd":"code","9766fbd6":"code","697f6a10":"code","471a282f":"code","099ac19f":"code","7997355c":"code","19f84de3":"code","5e5906d6":"code","74a4fbd7":"code","c37a3192":"code","d9078fb6":"code","bae606e7":"code","90266275":"markdown"},"source":{"d0e97c4e":"save_loc = \"\/kaggle\/tmp\/model\"","53efe103":"!mkdir \/kaggle\/tmp\n!mkdir \/kaggle\/tmp\/model\n!ls \/kaggle\/tmp\n!pip install git+https:\/\/github.com\/Maluuba\/nlg-eval.git@master\n!pip install wandb","db63df16":"# !wandb login \n","058c3cf6":"import pandas as pd\nimport numpy as np","afae58aa":"df_tb = pd.read_csv('..\/input\/indonesia-bible-tb\/tb.csv')\ndf_vmd = pd.read_csv('..\/input\/indonesia-bible-tb\/vmd.csv')\n","30a8c02b":"df_tb.head(5)\ndf_tb.rename({'firman': 'input_text'}, axis=1, inplace=True)\ndf_vmd.rename({'firman': 'target_text'}, axis=1, inplace=True)\ndf_tb.drop('id',axis=1,inplace=True)\ndf_vmd.drop('id',axis=1,inplace=True)\n","44a1c886":"df_tb.head(5)","91085cd9":"df_train = df_tb.merge(df_vmd,how='outer',left_on=['kitab','pasal','ayat'],right_on=['kitab','pasal','ayat'])","9faa13bc":"df_tb['prefix'] = 'simplify'","cb90eede":"! pip uninstall torch torchvision -y\n! pip install torch==1.6.0+cu101 torchvision==0.7.0+cu101 -f https:\/\/download.pytorch.org\/whl\/torch_stable.html\n!pip install -U transformers\n!pip install -U simpletransformers  ","a7f46bf1":"train_df=df_train.sample(frac=0.5,random_state=200) #random state is a seed value\ntest_df=df_train.drop(train_df.index)\n","b953e403":"\ndf_train.drop(['kitab','pasal','ayat'],inplace=True,axis=1)","1873ddda":"df_train.head(5)","a1e3f08f":"!pip install torchsummary\nfrom torchsummary import summary\n# from summary import summary\n","b9961931":"import logging\n\nimport transformers\nfrom simpletransformers.t5 import T5Model\n\nfrom simpletransformers.seq2seq import Seq2SeqModel\nlogging.basicConfig(level=logging.INFO)\ntransformers_logger = logging.getLogger(\"transformers\")\ntransformers_logger.setLevel(logging.WARNING)\n\n\n\nmodel_args = {\n    \"reprocess_input_data\": True,\n#     \"no_save\": True,\n    \"max_seq_length\": 50,\n    \"train_batch_size\": 100,\n    \"output_dir\" : save_loc,\n    \"num_train_epochs\": 10,\n    \"wandb_project\" : \"Bible Paraphrase\",\n    \"save_model_every_epoch\": False,\n    \"overwrite_output_dir\" :True,\n    \"max_length\": 50,\n#     \"do_sample\" : True,\n#     \"num_beams\" : None,\n#     \"num_return_sequences\" : 3,\n#     \"top_k\" : 50,\n#     \"top_p\" : 0.95,\n}\n\n# Initialize model\n# model = Seq2SeqModel(\n#     encoder_decoder_type=\"marian\",\n#     encoder_decoder_name=\"sshleifer\/student_marian_en_ro_6_4\",\n#     args=model_args,\n# )\nmodel = T5Model(\"t5-base\",None, args=model_args)\n# Train the model\n\n# Evaluate the model\n# results = model.eval_model(eval_df)","cbd33755":"train_df['prefix'] = 'paraphrase'","7e9fbbdf":"\nmodel.train_model(train_df,use_cuda=True)","e4e43135":"\n# Use the model for prediction\nprint(model.predict(['Dan Allah menamai terang itu siang, dan gelap itu malam. Jadilah petang dan jadilah pagi, itulah hari pertama.']))\n","4bbe1b77":"\ntest_df.reset_index(inplace=True)","1a9bb15c":"df_train.head(5)\ndef print_df(df,index):\n    print(df.loc[index]['input_text'])\n    print(df.loc[index]['target_text'])\n    print(model.predict([df.loc[index]['input_text']]))\n    ","40bef58b":"print_df(test_df,6)","37fb10cd":"from tqdm import tqdm\nlen(test_df)","9766fbd6":"# results = model.eval_model(test_df,output_dir='.\/')\nres = model.predict(test_df.loc[:5000]['input_text'].tolist())","697f6a10":"df_eval = test_df.head(5001)","471a282f":"df_eval.head(5)\ndf_eval['pred'] = res","099ac19f":"df_eval.head(5)","7997355c":"!du -h \/kaggle\/tmp\/model","19f84de3":"df_eval.to_csv('result.csv',index=False)","5e5906d6":"len(df_eval)","74a4fbd7":"!pip install sacrebleu","c37a3192":"import sacrebleu\nrefs = [df_eval['target_text'].tolist()]\nsys = df_eval['pred'].tolist()\nbleu = sacrebleu.corpus_bleu(sys, refs)\nprint(bleu.score)","d9078fb6":"from nlgeval import NLGEval\nnlgeval = NLGEval()  # loads the models\nmetrics_dict = nlgeval.compute_metrics(df_eval['target_text'], df_eval['pred'])","bae606e7":"len(sys)","90266275":"# Note\n### This notebook currently in progress and still an experiment\n### Example output available in version 2"}}