{"cell_type":{"5722f4f6":"code","2797c2ee":"code","d2a11e9f":"code","756a4de5":"code","57c7ac8e":"code","d43ba8de":"code","a710a294":"code","dd736f04":"code","cba576b1":"code","f30d5ee9":"code","33313ca2":"code","4cbabb3d":"code","ffc8a7e3":"code","6ae70844":"code","99b86325":"code","48fdaad8":"code","5e4d1729":"code","09725981":"code","f83b7a14":"code","3d2f19c1":"code","75d8ed8e":"code","0a5de100":"code","d06a249a":"code","181ffd81":"code","dfea85ba":"code","97d7c33f":"code","835a56af":"code","8a0c97a2":"code","e62b7322":"code","2558ab59":"code","3cf732d2":"code","fb6977a0":"code","99e11dce":"code","8025d477":"code","a95efb52":"code","e1dd91d0":"code","3f07a888":"code","ef83c4ea":"code","7f5084e8":"code","cee40ce3":"code","cf663b30":"code","3964871e":"code","0e9465ec":"code","ab87ef05":"code","b35cda85":"code","31247f78":"markdown","083e911c":"markdown","ed4e384f":"markdown","e40df8ea":"markdown","a9a856ff":"markdown","ebb53d32":"markdown","79c832f3":"markdown","5c3c44ff":"markdown"},"source":{"5722f4f6":"%reload_ext autoreload\n%autoreload 2\n%matplotlib inline","2797c2ee":"from fastai.vision import*\nfrom fastai.metrics import error_rate","d2a11e9f":"import os","756a4de5":"testpath = \"..\/input\/test1\/test1\/\"\ntrainpath = \"..\/input\/train\/train\/\"","57c7ac8e":"testpath","d43ba8de":"trainpath","a710a294":"torch.cuda.is_available()","dd736f04":"torch.backends.cudnn.enabled","cba576b1":"#fnames = (os.listdir(f'{trainpath}'))","f30d5ee9":"fnames = get_image_files(trainpath)","33313ca2":"fnames[:5]","4cbabb3d":"labels = [('cat' if 'cat' in str(x) else 'dog') for x in fnames]","ffc8a7e3":"labels[:5]","6ae70844":"data = ImageDataBunch.from_lists(trainpath, fnames, ds_tfms=get_transforms(), size=224, bs=64, labels = labels)\ndata.classes","99b86325":"data.show_batch(rows=3, figsize=(5,5))","48fdaad8":"learn = cnn_learner(data, models.resnet34, metrics=error_rate, model_dir=\"\/tmp\/\")","5e4d1729":"learn.fit_one_cycle(4)","09725981":"learn.lr_find()\nlearn.recorder.plot()","f83b7a14":"interp = ClassificationInterpretation.from_learner(learn)","3d2f19c1":"interp.plot_confusion_matrix(figsize=(12,12), dpi=60)","75d8ed8e":"learn.save('model-1')","0a5de100":"#learn.unfreeze()\n#learn.fit_one_cycle(2, max_lr=slice(1e-3,1e-2))","d06a249a":"#learn.load('model-1')","181ffd81":"#learn.fit_one_cycle(2, max_lr=slice(1e-3,1e-2))","dfea85ba":"#learn.lr_find()\n#learn.recorder.plot()","97d7c33f":"#learn.load('model-1')","835a56af":"#learn.fit_one_cycle(2)","8a0c97a2":"#learn.lr_find()\n#learn.recorder.plot()","e62b7322":"#learn.fit_one_cycle(2, max_lr=8e-07)","2558ab59":"#learn.lr_find()\n#learn.recorder.plot()","3cf732d2":"#learn.save('model-2')","fb6977a0":"#learn.load('model-1')","99e11dce":"import numpy as np\nimport pandas as pd","8025d477":"test_images=get_image_files(testpath)\ntest_images[:5]","a95efb52":"fnames[:5]","e1dd91d0":"submission = pd.DataFrame(os.listdir(\"..\/input\/test1\/test1\/\"),columns = ['id'])","3f07a888":"submission['label']=0","ef83c4ea":"submission","7f5084e8":"count = 0","cee40ce3":"count","cf663b30":"for imgpath in test_images:\n    img = open_image(imgpath)\n    pred = learn.predict(img)\n    if str(pred[0]) != 'dog':\n        submission['label'][count]=0\n        count = count+1\n    else:\n        submission['label'][count]=1\n        count = count+1","3964871e":"img = open_image('..\/input\/test1\/test1\/1112.jpg')\npred = learn.predict(img)","0e9465ec":"pred","ab87ef05":"pred[1]","b35cda85":"submission[['id','label']].to_csv('sampleSubmission.csv',index=False)","31247f78":"\u4f7f\u7528fit_one_cycle\u8a13\u7df4","083e911c":"\u5728kaggle\u4e0a\u9700\u8981\u5275\u5efa\u4e00\u500btmp\u5132\u5b58\u6a21\u578b, \u4e0d\u7136\u7121\u6cd5\u64cd\u4f5c\u6a21\u578b","ed4e384f":"\u8f38\u51fa\u7684\u9663\u5217\u4e2d\u6bcf\u500b\u503c\u90fd\u662f\u6a94\u540d","e40df8ea":"\u70ba\u4f55size\u662f224?:\u56e0\u70ba\u6700\u5f8c\u4e00\u5c64\u662f7*7 224\u6bd4\u8f03\u597d","a9a856ff":"\u53ef\u8996\u5316lr&loss \u627e\u5b78\u7fd2\u7387\u7684\u65b9\u6cd5:\u770b\u54ea\u4e00\u9ede\u958b\u59cbloss\u5f80\u4e0b\u964d\u4e14\u662f\u5e73\u6ed1\u9661\u5761 \u5c31\u662f\u597d\u5b78\u7fd2\u7387","ebb53d32":"\u8f38\u51fa\u7684\u9663\u5217\u4e2d\u6bcf\u500b\u503c\u90fd\u662fpath","79c832f3":"Dogs vs cats\u7684\u7279\u8272 : \n1. label\u70ba\u6a94\u540d\n2. \u5169\u7a2e\u985e\u5225\u4f4d\u5728\u540c\u500b\u8cc7\u6599\u593e","5c3c44ff":"\u79c0\u51fa\u5716\u7247\u53ca\u5176label"}}