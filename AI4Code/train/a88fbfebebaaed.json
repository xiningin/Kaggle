{"cell_type":{"486a5ac8":"code","01d8c9b6":"code","2ae4d274":"code","bd32a310":"code","ecd00d95":"code","fab92d54":"code","640a895c":"code","7c1e6e3d":"code","cd069674":"code","1d2e3205":"code","7a00d070":"code","05a0d66e":"code","75f5e1c2":"code","d9db0ebe":"code","3afc647f":"code","45e47f61":"code","2982f2d2":"code","d4b4adc3":"code","c62f8400":"code","4f5fbd1b":"code","0de87d7b":"code","c9683bb0":"code","e5e9bc95":"code","d9ede2de":"code","e7412cb4":"code","efa7c52a":"code","7c3f74e2":"code","0e381b14":"code","b170a7a8":"code","10964acc":"code","e9d0b6c1":"markdown","8eba8e28":"markdown","f479d65f":"markdown","f1454839":"markdown","665cf025":"markdown","bc10b2b2":"markdown","c8f99df6":"markdown","0cdc7320":"markdown","c9f16f6f":"markdown","ff34e9ed":"markdown","33ba7b02":"markdown","50704ad7":"markdown","bdcb2fc9":"markdown","e9a94e6f":"markdown","f7a6c987":"markdown","b98be717":"markdown","5f1ccd73":"markdown","66a0aff6":"markdown"},"source":{"486a5ac8":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport statsmodels.api as sm\nimport seaborn as sns\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","01d8c9b6":"# Reading the data\ndf = pd.read_csv(\"..\/input\/portland-oregon-average-monthly-.csv\")","2ae4d274":"df.columns = [\"month\", \"average_monthly_ridership\"]\ndf.head()","bd32a310":"df.dtypes","ecd00d95":"df = df.drop(df.index[df['average_monthly_ridership'] == ' n=114'])","fab92d54":"df['average_monthly_ridership'].unique()","640a895c":"df['average_monthly_ridership'] = df['average_monthly_ridership'].astype(np.int32)","7c1e6e3d":"df['month'] = pd.to_datetime(df['month'], format = '%Y-%m')","cd069674":"df.dtypes","1d2e3205":"# Normal line plot so that we can see data variation\n# We can observe that average number of riders is increasing most of the time\n\ndf.plot.line(x = 'month', y = 'average_monthly_ridership')\nplt.show()","7a00d070":"to_plot_monthly_variation = df","05a0d66e":"# only storing month for each index \nmon = df['month']","75f5e1c2":"# decompose yyyy-mm data-type \ntemp= pd.DatetimeIndex(mon)","d9db0ebe":"# assign month part of that data to ```month``` variable\nmonth = pd.Series(temp.month)","3afc647f":"# dropping month from to_plot_monthly_variation\nto_plot_monthly_variation = to_plot_monthly_variation.drop(['month'], axis = 1)","45e47f61":"# join months so we can get month to average monthly rider mapping\nto_plot_monthly_variation = to_plot_monthly_variation.join(month)","2982f2d2":"# A quick glance\nto_plot_monthly_variation.head()","d4b4adc3":"# Plotting bar plot for each month\nsns.barplot(x = 'month', y = 'average_monthly_ridership', data = to_plot_monthly_variation)\nplt.show()","c62f8400":"to_plot_monthly_variation.plot.scatter(x = 'month', y = 'average_monthly_ridership')\nplt.show()","4f5fbd1b":"rider = df[['average_monthly_ridership']]","0de87d7b":"rider.rolling(6).mean().plot(figsize=(20,10), linewidth=5, fontsize=20)\nplt.show()","c9683bb0":"rider.diff(periods=4).plot(figsize=(20,10), linewidth=5, fontsize=20)\nplt.show()","e5e9bc95":"pd.plotting.autocorrelation_plot(df['average_monthly_ridership'])\nplt.show()","d9ede2de":"pd.plotting.lag_plot(df['average_monthly_ridership'])\nplt.show()","e7412cb4":"df = df.set_index('month')","efa7c52a":"# Applying Seasonal ARIMA model to forcast the data \nmod = sm.tsa.SARIMAX(df['average_monthly_ridership'], trend='n', order=(0,1,0), seasonal_order=(1,1,1,12))\nresults = mod.fit()\nprint(results.summary())","7c3f74e2":"df['forecast'] = results.predict(start = 102, end= 120, dynamic= True)  \ndf[['average_monthly_ridership', 'forecast']].plot(figsize=(12, 8))\nplt.show()","0e381b14":"def forcasting_future_months(df, no_of_months):\n    df_perdict = df.reset_index()\n    mon = df_perdict['month']\n    mon = mon + pd.DateOffset(months = no_of_months)\n    future_dates = mon[-no_of_months -1:]\n    df_perdict = df_perdict.set_index('month')\n    future = pd.DataFrame(index=future_dates, columns= df_perdict.columns)\n    df_perdict = pd.concat([df_perdict, future])\n    df_perdict['forecast'] = results.predict(start = 114, end = 125, dynamic= True)  \n    df_perdict[['average_monthly_ridership', 'forecast']].iloc[-no_of_months - 12:].plot(figsize=(12, 8))\n    plt.show()\n    return df_perdict[-no_of_months:]","b170a7a8":"predicted = forcasting_future_months(df,10)","10964acc":"df.tail()","e9d0b6c1":"Two most famous seasonability analysis algorithms are:-\n## [Using 1st discrete difference of object](https:\/\/machinelearningmastery.com\/difference-time-series-dataset-python\/)","8eba8e28":"Cleaning data","f479d65f":"![](http:\/\/)Now our data is clean.","f1454839":"## To generate future forcasts","665cf025":"The above curve represents the relation between current time stepp and its previous time step","bc10b2b2":"## Seasonability Analysis\n","c8f99df6":"# Time Series Analysis\n\n","0cdc7320":"## [Periodicity and Autocorrelation](https:\/\/machinelearningmastery.com\/gentle-introduction-autocorrelation-partial-autocorrelation\/)\n\nAuto correlation is the most famous way to understand seasonal variation till now. We can calculate the correlation for time series observations with observations with previous time steps, called lags. Because the correlation of the time series observations is calculated with values of the same series at previous times, this is called a serial correlation, or an autocorrelation.In this plot vertical axis is represented by the following equations:-\n\n> $C_n = \\sum_{t = 1}^{n - h} (y(t) - \\hat{y}) (y(t + n) - \\hat{y}) \/ n$\n\n> $C_0 = \\sum_{t = 1}^{n} (y(t) - \\hat{y})^2 \/ n$\n\nHorizontal axis represents time lag(previous time steps)  h","c9f16f6f":"For trend analysis, we use smoothing techniques. In statistics smoothing a data set means to create an approximating function that attempts to capture important patterns in the data, while leaving out noise or other fine-scale structures\/rapid phenomena. In smoothing, the data points of a signal are modified so individual points (presumably because of noise) are reduced, and points that are lower than the adjacent points are increased leading to a smoother signal.We implement smoothing by taking moving averages. [Exponential moving average](https:\/\/www.investopedia.com\/terms\/e\/ema.asp) is frequently used to compute smoothed function.Here I used the rolling method which is inbuilt in pandas and frequently used for smoothing.","ff34e9ed":"# Time Series","33ba7b02":"The above figure represents difference between average rider of a month and 4 months before that month i.e\n\n> $d[month] = a[month] - a[month - periods]$.\n\nThis gives us idea about variation of data for a period of time.","50704ad7":"Changing data type of both the column\n* Assign int to ```monthly_ridership_data``` column\n* Assign datetime to ```month``` column","bdcb2fc9":"## To check ","e9a94e6f":"About dataset:\n* It is a monthly count of riders for the Portland public transportation system. The website states that it is from January 1973 through June 1982, but when you download the data starts in 1960. \nThis dataset you can also find [here](https:\/\/www.qlik.com\/us\/products\/qlik-data-market#!ds=22w6&display=line)","f7a6c987":"## Trend Analysis","b98be717":"## Ploting monthly variation of dataset\nIt gives us idea about seasonal variation of our data set","5f1ccd73":"## What is a time series problem\nIn the field for machine learning and data science, most of the real-life problems are based upon the prediction of future which is totally oblivious to us such as stock market prediction, future sales prediction and so on.Time series problem is basically the prediction of such problems using various machine learning tools.Time series problem is tackled efficiently when first it is analyzed properly (Time Series Analysis) and according to that observation suitable algorithm is used (Time Series Forecasting).We'll study both of then later in this notebook. ","66a0aff6":"References to:\n* [Time Series Analysis and forecasting using ARIMA](https:\/\/www.kaggle.com\/hsankesara\/time-series-analysis-and-forecasting-using-arima)\n* [Seasonal_ARIMA_model_Portland_transit on Github](https:\/\/github.com\/seanabu\/seanabu.github.io\/blob\/master\/Seasonal_ARIMA_model_Portland_transit.ipynb)\n* [Seasonal ARIMA with Python](http:\/\/www.seanabu.com\/2016\/03\/22\/time-series-seasonal-ARIMA-model-in-python\/)\n"}}