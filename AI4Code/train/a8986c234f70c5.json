{"cell_type":{"321b03e2":"code","5897ffc9":"code","b0132d46":"code","69705bf7":"code","094688f0":"code","9d8295c6":"code","c28f8d07":"code","ba079af0":"code","3958b02e":"code","27d5b271":"code","f531af68":"code","8fcfd108":"code","cd3f043b":"code","56834357":"code","52758a92":"code","600253bd":"code","0dcfdc0c":"code","9394b9fe":"code","85b6e177":"code","808830cb":"code","e6d456b6":"code","a39d03ac":"code","2522a172":"code","4e9cf8f0":"code","7005a859":"code","136410e2":"code","089d752f":"code","8ff1a54d":"code","241a9042":"code","487c7d12":"code","91f7c6dd":"code","de48cdc9":"code","7ae7e9c7":"code","1b3346a3":"code","4546d0ed":"code","991e925c":"code","48c9cfd9":"code","e2778053":"code","fd34552c":"code","cac23d58":"code","355670e9":"code","60ae48be":"code","2a6d7f8f":"code","e13a4494":"code","18ecafe6":"code","d228cd51":"code","84d0062c":"code","557c434b":"code","3ef7d214":"code","b72d0244":"code","ce5d29c4":"code","eba71b15":"code","a15b9c9b":"code","0a176080":"code","2131634c":"code","b89c182f":"code","a693310f":"code","dd51c78c":"code","d0fc43b8":"code","3b70b34e":"code","1f692c34":"code","a87407fd":"code","1faabae8":"code","793e806f":"code","bb1b856e":"code","487ad4c8":"code","7614b973":"code","fc4b9015":"code","8a28f47b":"code","6fe5818b":"code","e123ecb5":"code","c804d295":"code","96f6d1e9":"code","1689b116":"code","275c77ca":"code","aa8dad06":"code","5af652fd":"code","4274d8de":"code","45cbdc5c":"code","da00b7ae":"markdown","06e16197":"markdown","52d156c5":"markdown","cd90b669":"markdown","caee0887":"markdown","30acc2a0":"markdown","73efd46e":"markdown","fe66f624":"markdown","19cbfdd5":"markdown","666b3a98":"markdown","129f5eff":"markdown","37da587c":"markdown","7367c26a":"markdown","fd542ca3":"markdown","06927e0f":"markdown","af2c77f1":"markdown","5063bd79":"markdown","97ae9f5c":"markdown","8a07826c":"markdown","9d613a13":"markdown","b385d636":"markdown","507ec181":"markdown","9d48ec6d":"markdown","171ac470":"markdown","1bd70c6b":"markdown","28a28fb3":"markdown"},"source":{"321b03e2":"!pip install xlrd\n!pip install openpyxl\n!pip install lifetimes","5897ffc9":"# Projede gerekli olan k\u00fct\u00fcphanelerin import i\u015flemini yap\u0131yoruz.\nimport datetime as dt\nimport pandas as pd\nfrom sklearn.preprocessing import MinMaxScaler\nfrom lifetimes import BetaGeoFitter\nfrom lifetimes import GammaGammaFitter\n\n# \u00c7\u0131kt\u0131da t\u00fcm s\u00fctun ve sat\u0131rlar\u0131 g\u00f6zlemlemek i\u00e7in;\npd.set_option('display.max_columns', None)\npd.set_option('display.max_rows', None)\n\n# \u00c7\u0131kt\u0131da s\u00fctunlar\u0131n alta kaymas\u0131n\u0131 engellemek i\u00e7in s\u00fctunlar\u0131 yan yana getirece\u011fimiz kod.\npd.set_option('display.expand_frame_repr', False)","b0132d46":"# Veri Setini okuma i\u015flemlerini ger\u00e7ekle\u015ftiriyoruz. Projede 2010-2011 y\u0131l\u0131na ait verileri kullanaca\u011f\u0131z.\ndf_ = pd.read_excel(\"..\/input\/online-retail-ii-data-set-from-ml-repository\/online_retail_II.xlsx\", sheet_name=\"Year 2010-2011\")","69705bf7":"# Veri setini boyutu fazla oldu\u011fundan dolay\u0131 veriyi okutma s\u00fcresi uzun s\u00fcrmektedir. \n# Herhangi bir sebeple veriyi tekrar okutmam\u0131z gerekirse beklememek i\u00e7in veriyi kopyal\u0131yoruz. \ndf = df_.copy()","094688f0":"# Veri setindeki ilk 5 g\u00f6zlem de\u011ferini inceliyoruz.\ndf.head()","9d8295c6":"# Veride ka\u00e7 sat\u0131r, ka\u00e7 s\u00fctun vard\u0131r?\ndf.shape","c28f8d07":"# Ka\u00e7 e\u015fsiz \u00fcr\u00fcn var? \ndf[\"Description\"].nunique()","ba079af0":"# Hangi \u00fcr\u00fcnden ka\u00e7ar tane var?\ndf[\"Description\"].value_counts().head()   ","3958b02e":"# En \u00e7ok sipari\u015f edilen ilk 5 \u00fcr\u00fcn hangileridir? \n# Veri setindeki \u00fcr\u00fcn isimlerini(Description) groupby alarak \u00fcr\u00fcn adetlerinin(Quantity) toplam\u0131n\u0131 al\u0131yoruz.\n# \u00dcr\u00fcn adetine(Quantity) g\u00f6re b\u00fcy\u00fckten k\u00fc\u00e7\u00fc\u011fe s\u0131ral\u0131yoruz. .head() i\u015flemiyle ilk 5 g\u00f6zleme bak\u0131yoruz.\ndf.groupby(\"Description\").agg({\"Quantity\":\"sum\"}).sort_values(\"Quantity\", ascending = False).head()","27d5b271":"# En pahal\u0131 ilk 5 \u00fcr\u00fcn hangileridir?\n# Veri setindeki \u00fcr\u00fcn isimlerini(Description) groupby alarak \u00fcr\u00fcn fiyatlar\u0131n\u0131n(Price) maksimum de\u011ferini al\u0131yoruz.\n# \u00dcr\u00fcn fiyat\u0131na(Price) g\u00f6re b\u00fcy\u00fckten k\u00fc\u00e7\u00fc\u011fe s\u0131ral\u0131yoruz. .head() i\u015flemiyle ilk 5 g\u00f6zleme bak\u0131yoruz.\ndf.groupby(\"Description\").agg({\"Price\":\"max\"}).sort_values(\"Price\", ascending = False).head()","f531af68":"# En \u00e7ok \u00fcr\u00fcn sat\u0131n alan m\u00fc\u015fteriler hangi \u00fclkeden sat\u0131n alma ger\u00e7ekle\u015ftirmi\u015ftir?\ndf.groupby(\"Country\").agg({\"Quantity\":\"sum\"}).sort_values(\"Quantity\", ascending=False).head()","8fcfd108":"# \u0130lk olarak eksik g\u00f6zlemimiz var m\u0131 onu kontrol edelim.\n# Kod, de\u011fi\u015fkenlerdeki toplam eksik g\u00f6zlem say\u0131s\u0131n\u0131 vermektedir.\ndf.isnull().sum()","cd3f043b":"# Eksik g\u00f6zlemler \u00fczerinde de i\u015flemler yapabilirim ancak veri setimde \u00e7ok fazla g\u00f6zlem var. \n# Bu proje \u00f6zelinde eksik g\u00f6zlemleri veri setinden direk siliyorum.\n# axis=0 sat\u0131ra g\u00f6re, axis=1 s\u00fctuna g\u00f6re i\u015flem yapar. \u0130nplace=True ise bu i\u015flemi atama yapmadan kal\u0131c\u0131 hale getirir.\ndf.dropna(axis=0, inplace=True)\n# \u0130snull fonskiyonu ile tekrar eksik g\u00f6zlem kontrol\u00fc yap\u0131yorum. G\u00f6r\u00fcld\u00fc\u011f\u00fc \u00fczere eksik g\u00f6zlemleri temizledik.\ndf.isnull().sum()","56834357":"# Fatura numaralar\u0131(Invoice) de\u011fi\u015fkeninde \"C\" ile ba\u015flayan de\u011ferler iade olan faturalar\u0131 ifade ediyordu.\n# Biz bu \u00e7al\u0131\u015fmada iade olan faturalarla ilgili bir analiz yapmayaca\u011f\u0131m\u0131z i\u00e7in,\n# Invoice de\u011fi\u015fkeninde C i\u00e7eren g\u00f6zlemlerin d\u0131\u015f\u0131ndakileri se\u00e7erek tekrar df olarak atama yap\u0131yoruz.\ndf = df[~df[\"Invoice\"].str.contains(\"C\", na=False)]","52758a92":"# Bu i\u015flemlerden sonra sat\u0131r ve s\u00fctun say\u0131lar\u0131m\u0131za bakal\u0131m.\ndf.shape","600253bd":"# Bu b\u00f6l\u00fcmde veri setinin betimsel istatistiklerine bakmak \u00f6nemlidir.\n# E\u011fer bir ayk\u0131r\u0131l\u0131k g\u00f6ze \u00e7arparsa bu ayk\u0131rl\u0131\u011f\u0131 gidermek i\u00e7in i\u015flemler yapmam\u0131z gerekir.\n# A\u015fa\u011f\u0131da \u00fcr\u00fcn adeti(Quantity) ve \u00fcr\u00fcn fiyat\u0131n\u0131n\u0131n(Price) istatistiklerini inceledi\u011fimizde ;\n# \u0130ki de\u011fi\u015fkenin de %99'luk ve maksimum de\u011ferleri aras\u0131nda ciddi bir ayk\u0131r\u0131l\u0131k g\u00f6r\u00fclmektedir.\ndf.describe([0.05,0.10,0.25,0.50,0.80,0.95,0.99]).T","0dcfdc0c":"# Analize g\u00f6zlem ayk\u0131rl\u0131\u011f\u0131n\u0131 gidererek devam etmemiz gerekiyor.\n# A\u015fa\u011f\u0131daki outlier_thresholds fonksiyonu ile ayk\u0131r\u0131 de\u011ferler i\u00e7in bir e\u015fik de\u011fer belirliyoruz.\n# Alt ve \u00dcst s\u0131n\u0131r olarak bir e\u015fik de\u011fer belirliyoruz. Bu ayk\u0131r\u0131 g\u00f6zlemler e\u015fik de\u011ferin d\u0131\u015f\u0131nda kal\u0131yor.\ndef outlier_thresholds(dataframe, variable):\n    quartile1 = dataframe[variable].quantile(0.01)\n    quartile3 = dataframe[variable].quantile(0.99)\n    interquantile_range = quartile3 - quartile1\n    up_limit = quartile3 + 1.5 * interquantile_range\n    low_limit = quartile1 - 1.5 * interquantile_range\n    return low_limit, up_limit","9394b9fe":"# replace_with_thresholds fonksiyonunda ise ayk\u0131r\u0131 olan de\u011ferleri outlier_thresholds fonksiyonunda sapta\u0131\u011f\u0131m\u0131z e\u015fik de\u011ferlerle de\u011fi\u015ftiriyoruz.\n# Yani ayk\u0131r\u0131 de\u011ferler art\u0131k bizim belirledi\u011fimiz \u00e7eyreklikte e\u015fik de\u011ferlerle de\u011fi\u015fmi\u015f oluyor.\ndef replace_with_thresholds(dataframe, variable):\n    low_limit, up_limit = outlier_thresholds(dataframe, variable)\n    # dataframe.loc[(dataframe[variable] < low_limit), variable] = low_limit\n    dataframe.loc[(dataframe[variable] > up_limit), variable] = up_limit","85b6e177":"# Art\u0131k hem \u00fcr\u00fcn adeti(Quantity) de\u011fi\u015fkeninde hem de \u00fcr\u00fcn fiyat\u0131(Price) de\u011fi\u015fkenindeki ayk\u0131rl\u0131\u011f\u0131 giderebiliriz. \nreplace_with_thresholds(df, \"Quantity\")\nreplace_with_thresholds(df, \"Price\")","808830cb":"df.describe([0.05,0.10,0.25,0.50,0.80,0.95,0.99]).T","e6d456b6":"# Quantity ve Price de\u011fi\u015fkenleri \u00fcr\u00fcn adet ve her bir \u00fcr\u00fcn\u00fcn birim fiyat\u0131n\u0131 g\u00f6stermektedir.\n# Biz \u00e7al\u0131\u015fmam\u0131zda toplam fatura fiyat\u0131n\u0131 de\u011ferlendirece\u011fiz.\n# Bunun i\u00e7in ise \"Quantity\" ve \"Price\" de\u011fi\u015fkenlerindeki g\u00f6zlemleri \u00e7arparak yeni bir \"Total Price\" de\u011fi\u015fkeni olu\u015fturaca\u011f\u0131z.\ndf[\"TotalPrice\"] = df[\"Quantity\"] * df[\"Price\"]","a39d03ac":"# T\u00fcm veri \u00f6n i\u015fleme ad\u0131mlar\u0131ndan sonra art\u0131k verimizin son halinden ilk 5 g\u00f6zlemi g\u00f6rebiliriz.\n# Total Price de\u011fi\u015fkeni de g\u00f6r\u00fclmektedir.\ndf.head()","2522a172":"# Veri setindeki de\u011fi\u015fkenler ile Receny, Frequency ve Monetary skorlar\u0131n\u0131 olu\u015fturaca\u011f\u0131z.\ndf. info()","4e9cf8f0":"# Veri setindeki maksimum tarihi g\u00f6relim. Ona g\u00f6re referans bir tarih belirleyece\u011fiz.\n# Maksimum tarihimiz 09.12.2011\ndf[\"InvoiceDate\"].max()","7005a859":"# Referans tarih belirleyece\u011fiz. Maksimum tarihten 2 g\u00fcn sonras\u0131n\u0131 se\u00e7iyorum.\ntoday_date = dt.datetime(2011, 12, 11)","136410e2":"# Art\u0131k Recency, Frequency ve Monetary de\u011ferlerinden olu\u015facak RFM Tablomuzu olu\u015fturabiliriz.\nrfm = df.groupby('Customer ID').agg({'InvoiceDate': lambda date: (today_date - date.max()).days,\n                                                'Invoice': lambda num: num.nunique(),\n                                                \"TotalPrice\": lambda price: price.sum()})","089d752f":"# RFM Tablosunun ilk 5 g\u00f6zlemini g\u00f6r\u00fcyoruz.\n# Bu tablo 'InvoiceDate', 'Invoice' ve 'TotalPrice' de\u011fi\u015fkenlerinden olu\u015fuyor.\nrfm.head()","8ff1a54d":"# Yukar\u0131daki de\u011fi\u015fkenlerimiz bizim art\u0131k Recency, Frequency ve Monetary de\u011ferlerimizi ifade ediyor.\n# O zaman de\u011fi\u015fkenlerin isimlerini de\u011fi\u015ftirebiliriz.rfm.columns'a yeni isimleri at\u0131yorum.\nrfm.columns = ['recency', 'frequency', \"monetary\"]\nrfm.head()","241a9042":"# Olu\u015fturdu\u011fumuz rfm tablomuzda monetray ve frequency de\u011ferlerimizde \"0\"'dan b\u00fcy\u00fck olmayanlar var m\u0131 diye kontrol ama\u00e7l\u0131 bir bak\u0131yoruz.\n# Bu kontrol\u00fc yapmam\u0131n sebebi ise Frequency ve Monetray de\u011ferleri \"0\" gelmemesi laz\u0131m.\n# Kontrol sonucunda M\u00fc\u015fteri 1 sat\u0131n alma ger\u00e7ekle\u015ftirmi\u015f ancak m\u00fc\u015fterinin b\u0131rakt\u0131\u011f\u0131 toplam tutar \"0\" birim.\n# B\u00f6yle bir durum ger\u00e7ekle\u015fmesi m\u00fcmk\u00fcn olmayaca\u011f\u0131 i\u00e7in bunu iki de\u011fi\u015fken i\u00e7in de 0 dan b\u00fcy\u00fck olanlar\u0131 tekrar rfm olarak atama yap\u0131yoruz.\nrfm[~((rfm[\"monetary\"]) > 0 & (rfm[\"frequency\"] > 0))]","487c7d12":"rfm = rfm[(rfm['monetary'] > 0)]","91f7c6dd":"rfm.head()","de48cdc9":"# Yukar\u0131da ifade etti\u011fimiz \u015fekilde RFM skorlar\u0131n\u0131 hesapl\u0131yoruz.\n# recency_score ve frequency_score olarak atama yap\u0131yoruz.\nrfm[\"recency_score\"] = pd.qcut(rfm['recency'], 5, labels=[5, 4, 3, 2, 1])\nrfm[\"frequency_score\"] = pd.qcut(rfm[\"frequency\"].rank(method=\"first\"), 5, labels=[1, 2, 3, 4, 5])","7ae7e9c7":"# Art\u0131k RFM Metrikleri ve RFM Skorlar\u0131n\u0131 olu\u015fturduk.\nrfm.head()","1b3346a3":"# \u00d6nce bir segment de\u011fi\u015fkeni atayal\u0131m. Toplamlar\u0131n\u0131 yukar\u0131daki tabloyu olu\u015ftururken kullanaca\u011f\u0131z.\n# Tipi str yapmam\u0131n sebebi ise matematiksel olarak toplama i\u015flemi yapmayaca\u011f\u0131z. Sadece rakamlar\u0131 yan yana getirece\u011fiz.\n# A\u015fa\u011f\u0131da tabloda rfm_segment de\u011fi\u015fkeninde yapt\u0131\u011f\u0131m\u0131z i\u015flem g\u00f6r\u00fclmektedir.\nrfm['rfm_segment'] = rfm['recency_score'].astype(str) + rfm['frequency_score'].astype(str)\nrfm.head()","4546d0ed":"# Bu tablo bile bize bir\u015feyler anlatmaktad\u0131r. \n# \u00d6rne\u011fin sat\u0131n alma davran\u0131\u015f\u0131 en iyi m\u00fc\u015fterilerimizi g\u00f6relim.\nrfm[rfm[\"rfm_segment\"] == \"55\"].head()","991e925c":"# Sat\u0131n alma davran\u0131\u015f\u0131 en k\u00f6t\u00fc m\u00fc\u015fterilerimizi g\u00f6relim.\nrfm[rfm[\"rfm_segment\"] == \"11\"].head()","48c9cfd9":"# \u015eimdi ise a\u015fa\u011f\u0131daki Regular Expressions(Regex) yap\u0131s\u0131yla m\u00fc\u015fterilerimizi RFM skorlar\u0131na g\u00f6re yukar\u0131da inceledi\u011fimiz renkli tablodaki RFM segmentlerine atayaca\u011f\u0131z.\n# M\u00fc\u015fterilerimizin Recency ve Frequency skorlar\u0131na g\u00f6re hangi segmentte yer alaca\u011f\u0131n\u0131 a\u015fa\u011f\u0131da tek tek belirtiyoruz.\n# \u00d6rne\u011fin Recency de\u011feri 1-2, Frequency de\u011feri ise 3 veya 4 olan m\u00fc\u015fteriler At_risk segmentine atanacakt\u0131r.\nseg_map = {\n        r'[1-2][1-2]': 'hibernating',\n        r'[1-2][3-4]': 'at_risk',\n        r'[1-2]5': 'cant_loose',\n        r'3[1-2]': 'about_to_sleep',\n        r'33': 'need_attention',\n        r'[3-4][4-5]': 'loyal_customers',\n        r'41': 'promising',\n        r'51': 'new_customers',\n        r'[4-5][2-3]': 'potential_loyalists',\n        r'5[4-5]': 'champions'\n    }","e2778053":"# Bu Regex yap\u0131s\u0131n\u0131, RFM tablomuzdaki rfm_segment isimli de\u011fi\u015fkenle de\u011fi\u015ftirip dataframe'e \u00e7evirme i\u015flemi yap\u0131yoruz.\n# rfm_segment de\u011fi\u015fkenimizde m\u00fc\u015fterilerimizin hangi s\u0131n\u0131fta\/segmentte oldu\u011funu g\u00f6rebiliyoruz.\nrfm['rfm_segment'] = rfm['rfm_segment'].replace(seg_map, regex=True)","fd34552c":"rfm = rfm[[\"recency\", \"frequency\", \"monetary\", \"rfm_segment\"]]\nrfm.head()","cac23d58":"# Segmentlerde ka\u00e7ar m\u00fc\u015fterimiz var?\n# Segmentlerin betimsel istatistiklerini inceleyelim.\nrfm[[\"rfm_segment\", \"recency\", \"frequency\", \"monetary\"]].groupby(\"rfm_segment\").agg([\"mean\",\"median\", \"count\"])","355670e9":"# Bu sat\u0131rdaki i\u015flemleri g\u00f6rselle\u015ftirme yapabilmek i\u00e7in uygulad\u0131m.\n# Bu sat\u0131rdaki i\u015flemler projemiz ile ilgili bir kod i\u00e7ermemektedir.\nrfm1 = rfm[[\"rfm_segment\", \"recency\", \"frequency\", \"monetary\"]].groupby(\"rfm_segment\").agg([\"mean\",\"median\", \"count\"])\nrfm1.columns = rfm1.columns.droplevel(0)\nrfm1.reset_index(inplace=True)\nrfm1.columns = [\"rfm_segment\",\"bo\u015f\",\"bo\u015f\",\"count\",\"bo\u015f\",\"bo\u015f\",\"bo\u015f\",\"bo\u015f\",\"bo\u015f\",\"bo\u015f\"]\nrfm1 = rfm1.sort_values(by=\"count\", ascending=False)","60ae48be":"# Matplotlib k\u00fct\u00fcphanesini import ederek bir pie chart olu\u015fturdum.\n# A\u015fa\u011f\u0131daki g\u00f6rselde m\u00fc\u015fterilerimizin segmentlere g\u00f6re da\u011f\u0131l\u0131m\u0131n\u0131 g\u00f6r\u00fcyoruz. \n\nimport matplotlib.pyplot as plt\n\ncolors = ['#C2C2C2', '#5BADFF', '#33FF99', '#FFAB4B', \n          '#C184FF', '#AD6F33','#FFFF5B','#85BBB2',\n          '#FF8484','#33FFFF']\n\nfig1, ax1 = plt.subplots(figsize=(10,7))\n\nax1.pie(rfm1[\"count\"] ,labels=rfm1[\"rfm_segment\"].unique() ,colors=colors, \n        explode=[0,0.1,0.1,0.1,0,0,0,0,0,0] ,autopct='%1.1f%%');","2a6d7f8f":"# Olu\u015fturdu\u011fumuz RFM tablosu \u00fczerinden ilk \u00f6nce avg_order _value de\u011ferini hesaplayaca\u011f\u0131z.\n# M\u00fc\u015fterinin her i\u015flemde ortalama ne kadar b\u0131rakt\u0131\u011f\u0131n\u0131 buluyoruz.\nrfm['avg_order_value'] = rfm['monetary'] \/ rfm['frequency']","e13a4494":"# purchase_frequency de\u011ferini hesapl\u0131yoruz. Bu i\u015flemle genele g\u00f6re standartla\u015ft\u0131rma yap\u0131yoruz.\n# Toplam sipari\u015f say\u0131s\u0131 \/ toplam m\u00fc\u015fteri say\u0131s\u0131\nrfm[\"purchase_frequency\"] = rfm['frequency'] \/ rfm.shape[0]","18ecafe6":"# Profit_margin\n# M\u00fc\u015fterinin toplam harcama tutar\u0131ndan %0.5 kar etti\u011fimizi varsay\u0131yoruz.\nrfm['profit_margin'] = rfm['monetary'] * 0.05","d228cd51":"# Repeat_rate ve churn_rate\n# Veri setinde en az 1 kere al\u0131\u015fveri\u015f yapan m\u00fc\u015fteri say\u0131s\u0131 \/ t\u00fcm m\u00fc\u015fteri say\u0131s\u0131\nrepeat_rate = rfm[rfm.frequency > 1].shape[0] \/ rfm.shape[0]\nchurn_rate = 1 - repeat_rate","84d0062c":"# Customer Value\nrfm['cv'] = (rfm['avg_order_value'] * rfm[\"purchase_frequency\"])","557c434b":"# Customer Lifetime Value\nrfm['cltv'] = (rfm['cv'] \/ churn_rate) * rfm['profit_margin']","3ef7d214":"# M\u00fc\u015fteri ya\u015fam boyu de\u011ferini art\u0131k hesaplad\u0131k.\nrfm.head()","b72d0244":"# MinMaxScaler\n# Buldu\u011fumuz CLTV de\u011ferini daha kolay okumak ad\u0131na 1-100 aras\u0131 puanl\u0131yoruz.\n# cltv_c ad\u0131nda yeni bir de\u011fi\u015fkene at\u0131yoruz.Calculate edilmi\u015f cltv de\u011ferine eri\u015fiyoruz.\nscaler = MinMaxScaler(feature_range=(1, 100))\nscaler.fit(rfm[[\"cltv\"]])\nrfm[\"cltv_c\"] = scaler.transform(rfm[[\"cltv\"]])","ce5d29c4":"# Art\u0131k bu hesaplanm\u0131\u015f m\u00fc\u015fteri ya\u015fam de\u011feri \u00fczerinden de m\u00fc\u015fterilerim aras\u0131nda bir segment olu\u015fturabilirim.\n#.qcut() fonksiyonu ile b\u00fcy\u00fckten k\u00fc\u00e7\u00fc\u011fe s\u0131ralay\u0131p en d\u00fc\u015f\u00fck segment C, en iyi m\u00fc\u015fterilerin bulundu\u011fu segment A olacak \u015fekilde grupluyoruz.\nrfm[\"cltv_c_segment\"] = pd.qcut(rfm[\"cltv_c\"], 3, labels=[\"C\", \"B\", \"A\"])","eba71b15":"# \u0130lk olu\u015fturdu\u011fum RFM tablosu ile beraber hesaplanan cltv de\u011feri ve bu de\u011fere g\u00f6re olu\u015fturdu\u011fum segmenti tek bir dataframe'de topluyorum. \nrfm_cltv = rfm[[\"recency\", \"frequency\", \"monetary\", \"rfm_segment\",\"cltv_c\", \"cltv_c_segment\"]]","a15b9c9b":"# Hesaplad\u0131\u011f\u0131m\u0131z m\u00fc\u015fteri ya\u015fam boyu de\u011ferine g\u00f6re m\u00fc\u015fterilerimizi segmentlere ay\u0131rd\u0131k.\nrfm_cltv.sort_values(by=\"cltv_c\", ascending=False).head()","0a176080":"#Referans se\u00e7t\u011fimiz tarihi hat\u0131rlayarak ba\u015flayal\u0131m.\ntoday_date","2131634c":"# RFM tablosuna benzer tablomuzu olu\u015fturuyoruz.\nrfm = df.groupby('Customer ID').agg({'InvoiceDate': [lambda date: (date.max() - date.min()).days,\n                                                                lambda date: (today_date - date.min()).days],\n                                                'Invoice': lambda num: num.nunique(),\n                                                'TotalPrice': lambda TotalPrice: TotalPrice.sum()})","b89c182f":"#Hiyerar\u015fik index yap\u0131s\u0131 olu\u015ftu\u011fundan dolay\u0131 onu ortadan kald\u0131r\u0131yoruz.\nrfm.columns = rfm.columns.droplevel(0)","a693310f":"rfm.head()","dd51c78c":"# De\u011fi\u015fkenler lambda olarak geldi\u011fi i\u00e7in s\u00fctunlar\u0131 tekrar isimlendiriyoruz. \nrfm.columns = ['recency_cltv_p', 'T', 'frequency', 'monetary']","d0fc43b8":"# Gamma gamma modeli klasik monetry de\u011ferini de\u011fil de ortalama monetray de\u011ferini ister.\n# Her bir i\u015flemde(Frequency) m\u00fc\u015fteri ortalama ne kadar b\u0131rakm\u0131\u015f.\n# Her bir m\u00fc\u015fteri Her bir faturada ortalama ne kadar kazand\u0131rm\u0131\u015f.\nrfm[\"monetary\"] = rfm[\"monetary\"] \/ rfm[\"frequency\"]","3b70b34e":"# monetary de\u011feri Gamma-Gamma modeline uygun hale geldi.\nrfm.head()","1f692c34":"# Gamma-Gamma modeli i\u00e7in yapm\u0131\u015f oldu\u011fumuz de\u011fi\u015fikli\u011fin farkedilmesi a\u00e7\u0131s\u0131ndan monetary de\u011ferini de monetary_avg olarak de\u011fi\u015ftiriyoruz. \nrfm.rename(columns={\"monetary\": \"monetary_avg\"}, inplace=True)","a87407fd":"# BGNB Modeli i\u00e7in haftal\u0131k Recency (recency_weekly_p) ve haftal\u0131k Tenure (T_weekly) de\u011ferlerini hesapl\u0131yoruz.\n# Bu de\u011ferler ka\u00e7 hafta \u00f6nce al\u0131\u015fveri\u015f yapt\u0131\u011f\u0131 ve ka\u00e7 haftal\u0131k m\u00fc\u015fteri oldupu bilgisini veriyor.\nrfm[\"recency_weekly_cltv_p\"] = rfm[\"recency_cltv_p\"] \/ 7  # ka\u00e7 hafta \u00f6nce al\u0131\u015fveri\u015f yapt\u0131\u011f\u0131\nrfm[\"T_weekly\"] = rfm[\"T\"] \/ 7  # ka\u00e7 haftal\u0131k m\u00fc\u015fteri oldu\u011fu","1faabae8":"# Kontrol i\u00e7in monetary_avg de\u011ferlerinin \"0\" dan b\u00fcy\u00fck olanlar\u0131 al\u0131yoruz.\nrfm = rfm[rfm[\"monetary_avg\"] > 0]","793e806f":"# Daha sa\u011fl\u0131kl\u0131 bir CLTV hesab\u0131 i\u00e7in; \nrfm = rfm[(rfm['frequency'] > 1)]","bb1b856e":"rfm.head()","487ad4c8":"# BG-NBD ve Gamma-Gamma modelleri frequency de\u011ferini float istemiyor.\n# O y\u00fczden kontrol ama\u00e7l\u0131 yine de frequency tipini int yap\u0131yoruz.\nrfm[\"frequency\"] = rfm[\"frequency\"].astype(int)","7614b973":"# BGNBD modelinin fit edilmesi, BG-NBD modelinin fit edilmesi ile beklenen sat\u0131\u015f adetlerinin tahmini ad\u0131m\u0131na ge\u00e7ebiliriz. \nbgf = BetaGeoFitter(penalizer_coef=0.01)\n    \nbgf.fit(rfm['frequency'],\n        rfm['recency_weekly_cltv_p'],\n        rfm['T_weekly'])","fc4b9015":"# 1 ayl\u0131k beklenen sat\u0131\u015flar\u0131n tahminini veren kod.\n# recency_weekly_cltv_p ve T_weekly de\u011ferini haftal\u0131k de\u011fere \u00e7evirdi\u011fimiz i\u00e7in modelde 4 yazmam\u0131z bize 1 ayl\u0131k beklenen sat\u0131\u015flar\u0131 verir.\nrfm[\"exp_sales_1_month\"] = bgf.predict(4,\n                                        rfm['frequency'],\n                                        rfm['recency_weekly_cltv_p'],\n                                        rfm['T_weekly'])","8a28f47b":"# 3 ayl\u0131k beklenen sat\u0131\u015flar\u0131n tahminini veren kod.\nrfm[\"exp_sales_3_month\"] = bgf.predict(12,\n                                        rfm['frequency'],\n                                        rfm['recency_weekly_cltv_p'],\n                                        rfm['T_weekly'])","6fe5818b":"# M\u00fc\u015fterilerin gelece\u011fe y\u00f6nelik 1 ve 3 ayl\u0131k periyotta beklenen sat\u0131\u015flar\u0131n\u0131 tabloda g\u00f6r\u00fcyoruz.\nrfm.head()","e123ecb5":"# Gamma-Gamma modelinin fit edilmesi, Gamma-Gamma modelinin fit edilmesi ile beklenen karl\u0131l\u0131k tahmini ad\u0131m\u0131na ge\u00e7ebiliriz. \nggf = GammaGammaFitter(penalizer_coef=0.01)\n\nggf.fit(rfm['frequency'], rfm['monetary_avg'])\n\nrfm[\"expected_average_profit\"] = ggf.conditional_expected_average_profit(rfm['frequency'],\n                                                                         rfm['monetary_avg'])","c804d295":"# Tabloda g\u00f6r\u00fcnen expacted_average_profit ile m\u00fc\u015fterilerin beklenen karl\u0131l\u0131\u011f\u0131n\u0131n tahmin etmi\u015f olduk. \nrfm.head()","96f6d1e9":"# M\u00fc\u015fterilerin 6 ayl\u0131k CLTV_p de\u011ferini hesapl\u0131yoruz\ncltv = ggf.customer_lifetime_value(bgf,\n                                    rfm['frequency'],\n                                    rfm['recency_weekly_cltv_p'],\n                                    rfm['T_weekly'],\n                                    rfm['monetary_avg'],\n                                    time=6,\n                                    freq=\"W\",\n                                    discount_rate=0.01)","1689b116":"rfm[\"cltv_p\"] = cltv","275c77ca":"# Her bir m\u00fc\u015fteri i\u00e7in cltv_p tahminini hesaplam\u0131\u015f olduk.\n# 1-100 aras\u0131nda puanlayarak daha iyi okunabilmesini sa\u011flayal\u0131m.\nscaler = MinMaxScaler(feature_range=(1, 100))\nscaler.fit(rfm[[\"cltv_p\"]])\nrfm[\"cltv_p\"] = scaler.transform(rfm[[\"cltv_p\"]])","aa8dad06":"# 1-100 aras\u0131ndaki cltv_p de\u011ferlerini segmentlere ay\u0131r\u0131yoruz.\nrfm[\"cltv_p_segment\"] = pd.qcut(rfm[\"cltv_p\"], 3, labels=[\"C\", \"B\", \"A\"])","5af652fd":"#6 ayl\u0131k CLTV Prediction segmentlerini de olu\u015fturmu\u015f olduk.\nrfm.head()","4274d8de":"# M\u00fc\u015fterilerimizle ilgili detayl\u0131 kararlar alabilmek i\u00e7in \u00e7\u0131kt\u0131lar\u0131 birle\u015ftiriyoruz.\ncrm_final = rfm_cltv.merge(rfm, on=\"Customer ID\", how=\"left\")","45cbdc5c":"crm_final.head(10)","da00b7ae":"\u015eirketimizdeki t\u00fcm m\u00fc\u015fterilerden elde edilen toplam kazan\u00e7, toplam sipari\u015f say\u0131s\u0131, toplam m\u00fc\u015fteri say\u0131s\u0131 gibi durumlar\u0131 t\u00fcm m\u00fc\u015fteriler \u00f6zelinde k\u0131yaslayarak her bir m\u00fc\u015fterinin \u015firketimizdeki de\u011ferini hesaplayaca\u011f\u0131z. Sonras\u0131nda m\u00fc\u015fterilerimizi bu ya\u015fam de\u011ferine g\u00f6re segmentlere ay\u0131raca\u011f\u0131z.\n\nM\u00fc\u015fteri de\u011ferini hesaplamak i\u00e7in baz\u0131 metriklere ihtiyac\u0131m\u0131z var. Bu metrikler ;\n\n![](https:\/\/cdn-images-1.medium.com\/max\/800\/1*qOR8X-PBdKHXXgLIqjc-SA.png)\n\n![](https:\/\/cdn-images-1.medium.com\/max\/800\/1*YzP7_bHcQYl6Hss8wp7aoA.png)\n\nT\u00fcm bu ad\u0131mlar\u0131 ger\u00e7ekle\u015ftirerek m\u00fc\u015fterimizin bizim \u015firketimizdeki de\u011ferini hesaplayaca\u011f\u0131z. Bu de\u011fere g\u00f6re onlar\u0131 tekrar segmentlere atayaca\u011f\u0131z.","06e16197":"RFM metriklerini daha kolay kar\u015f\u0131la\u015ft\u0131rabilmek a\u00e7\u0131s\u0131ndan 1\u20135 aras\u0131nda de\u011ferler vererek metrikleri RFM skorlar\u0131na \u00e7evirece\u011fiz. Bununla beraber 1 \u00e7ok k\u00f6t\u00fc, 5 \u00e7ok iyi olacak \u015fekilde m\u00fc\u015fterileri segmentlere ay\u0131rm\u0131\u015f oluca\u011f\u0131z.\n\nBuradaki \u00f6nemli nokta ise biz m\u00fc\u015fterilerimizin segmentlerini tan\u0131mlarken sadece Recency ve Frequency de\u011ferlerini kullanaca\u011f\u0131z. \u00c7\u00fcnk\u00fc Monetary de\u011feri RFM segmenti tan\u0131mlamada kullan\u0131lm\u0131yor. Rfm segmenti tan\u0131mlamada \u00f6nemli olan de\u011fi\u015fkenler m\u00fc\u015fterimizin en son sat\u0131n alma yapt\u0131\u011f\u0131 tarih ve yapm\u0131\u015f oldu\u011fu sat\u0131n alma say\u0131s\u0131 bunlar\u0131 da bize s\u0131ras\u0131yla Recency ve Frequency de\u011fi\u015fkenleri veriyor.\n\nPeki RFM skorlar\u0131n\u0131 nas\u0131l olu\u015fturaca\u011f\u0131z ?\n\n* .qcut() fonksiyonu ile de\u011fi\u015fkeni k\u00fc\u00e7\u00fckten b\u00fcy\u00fc\u011fe s\u0131ralay\u0131p istedi\u011fimiz \u00e7eyreklik de\u011fere b\u00f6lm\u00fc\u015f oluyoruz.\n\n* Recency de\u011fi\u015fkenini k\u00fc\u00e7\u00fckten b\u00fcy\u00fc\u011fe s\u0131ralarken En k\u00fc\u00e7\u00fck olana 5 puan verip, en y\u00fcksek olana 1 puan verece\u011fiz.\u00c7\u00fcnk\u00fc en k\u00fc\u00e7\u00fck olan say\u0131 en yak\u0131n sat\u0131n alma yapm\u0131\u015f olanlar\u0131 ifade etti\u011finden dolay\u0131 en iyi skoru en k\u00fc\u00e7\u00fck say\u0131ya veriyoruz.\n    * `pd.qcut(rfm['Recency'], 5, labels=[5, 4, 3, 2, 1])`\n\n* Frequency de\u011fi\u015fkeninde ise sat\u0131n alma say\u0131s\u0131 en fazla olana 5, en az sat\u0131n alma say\u0131s\u0131na sahip olana 1 skorlar\u0131n\u0131 verece\u011fiz.\n    * `pd.qcut(rfm['Frequency'].rank(method=\"first\"), 5, labels=[1, 2, 3, 4, 5])`","52d156c5":"### Recency Metri\u011finin Hesaplanmas\u0131\n\nRecency i\u00e7in referans bir tarih belirleyip m\u00fc\u015fterilerin son sat\u0131n alma tarihlerini bu referans tarihten \u00e7\u0131karaca\u011f\u0131z.\n\n(Recency = Bug\u00fcn\u00fcn tarihi\u200a-\u200aSon sat\u0131n alma tarihi)\n\nBunu nas\u0131l yapaca\u011f\u0131z?\n * \u00d6ncelikle bir referans tarih belirleyece\u011fiz. Bunun sebebi ise recency form\u00fcl\u00fcndeki bug\u00fcn\u00fcn tarihini belirlemek. Bug\u00fcn\u00fcn tarihi dedi\u011fimiz durum asl\u0131nda m\u00fc\u015fterinin en son ka\u00e7 g\u00fcn \u00f6nce sat\u0131n alma ger\u00e7ekle\u015ftirdi\u011fini bulmak istiyoruz. Bunun i\u00e7in de bug\u00fcn\u00fcn tarihini veri setinin maksimum g\u00fcn\u00fcnden 1-2 g\u00fcn sonras\u0131 olarak belirleyip bu tarihten her bir m\u00fc\u015fteri \u00f6zelinde son sat\u0131n alma tarihini \u00e7\u0131kard\u0131\u011f\u0131m\u0131zda Recency de\u011ferimize ula\u015fabiliriz.\n * 1-2 g\u00fcn sonras\u0131n\u0131 belirlememizdeki mant\u0131k ise veri setinin en son g\u00fcn\u00fcnde sat\u0131n alma ger\u00e7ekle\u015ftiren m\u00fc\u015fterilerimizin Recency form\u00fcl\u00fcndeki \u00e7\u0131karma i\u015fleminden dolay\u0131 recency de\u011ferlerinin \"0\" gelmesini engellemek.\n * Recency, m\u00fc\u015fterinin son sat\u0131n almas\u0131n\u0131 temsil etti\u011fi i\u00e7in fatura tarihi(InvoiceDate) de\u011fi\u015fkeni kullanaca\u011f\u0131z. \n * M\u00fc\u015fteriler(\"CustomerID\") baz\u0131nda groupby alarak lambda fonksiyonu InvoiceDate de\u011fi\u015fkenini gezerek belirledi\u011fimiz referans tarihi her bir m\u00fc\u015fterinin son sat\u0131n alma tarihinden \u00e7\u0131karaca\u011f\u0131z.\n * `dataframe.groupby('Customer ID').agg({'InvoiceDate': lambda date: (today_date - date.max()).days `\n \n### Frequency Metri\u011finin Hesaplanmas\u0131\n\nFrequency, m\u00fc\u015fterinin toplam sat\u0131n alma say\u0131s\u0131n\u0131 ifade etti\u011fi i\u00e7in fatura de\u011fi\u015fkenini(Invoice) kullanaca\u011f\u0131z.\n\n * M\u00fc\u015fteriler(\"CustomerID\") baz\u0131nda groupby alarak lambda fonksiyonu (Invoice) de\u011fi\u015fkenini  gezerek her fatura numaras\u0131n\u0131n e\u015fsiz de\u011ferini bize sayd\u0131racak. M\u00fc\u015fterinin ka\u00e7 farkl\u0131 sat\u0131n alma ger\u00e7ekle\u015ftirdi\u011fini g\u00f6rece\u011fiz.\n * `dataframe.groupby('Customer ID').agg({'Invoice': lambda num: num.nunique()})`\n \n### Monetary Metri\u011finin Hesaplanmas\u0131 \n\nMonetary, m\u00fc\u015fterinin al\u0131\u015fveri\u015flerinde yapt\u0131\u011f\u0131 toplam harcamay\u0131 ifade etti\u011fi i\u00e7in 20. sat\u0131rda \"Ouantity\" ve \"Price\" de\u011fi\u015fkenlerinin \u00e7arp\u0131mlar\u0131yla olu\u015fturdu\u011fumuz \"TotalPrice\" de\u011fi\u015fkenini kullanaca\u011f\u0131z.\n\n * M\u00fc\u015fteriler(\"CustomerID\") baz\u0131nda groupby alarak lambda fonksiyonu (TotalPrice) de\u011fi\u015fkenini gezerek ilgili m\u00fc\u015fteriye ait her toplam sat\u0131n alma tutar\u0131n\u0131 toplam\u0131n\u0131 bize verecektir. M\u00fc\u015fterinin yapm\u0131\u015f oldu\u011fu toplam harcamay\u0131 g\u00f6rece\u011fiz.\n * `dataframe.groupby('Customer ID').agg({\"TotalPrice\": lambda price: price.sum()})`","cd90b669":"CRM \u00e7al\u0131\u015fmalar\u0131 \u00f6zelinde ele alaca\u011f\u0131m\u0131z konular\u0131 tamamlad\u0131k. \n\nPeki biz \u00f6zet olarak ne yapt\u0131k\u00a0?\u00a0\n\n * 1- Mevcut m\u00fc\u015fterilerimizin  sat\u0131n alma davran\u0131\u015flar\u0131n\u0131 g\u00f6z \u00f6n\u00fcnde bulundurarak RFM analizi ile m\u00fc\u015fterilerimizi segmentlere ay\u0131r\u0131p onlar i\u00e7in \u00f6zel kararlar alabildik. (RFM_Segmentation)\n     \n * 2- Sonras\u0131nda \u015firketimizdeki t\u00fcm m\u00fc\u015fterilerin davran\u0131\u015flar\u0131n\u0131 k\u0131yaslayarak ve tek bir m\u00fc\u015fterinin sat\u0131n alma al\u0131\u015fkanl\u0131klar\u0131n\u0131 g\u00f6z \u00f6n\u00fcnde bulundurup onun \u015firket i\u00e7indeki de\u011ferini bulduk. (CLTV_Calculate)\n     \n * 3- En sonunda ise hem uzun s\u00fcredir bizde olan hem de yeni gelmi\u015f m\u00fc\u015fterilerin sat\u0131n alma davran\u0131\u015flar\u0131n\u0131 g\u00f6z \u00f6n\u00fcnde bulundurarak BGNBD ve Gamma-Gamma modellerini kullan\u0131p gelece\u011fe y\u00f6nelik bir zaman projeksiyonu koyarak m\u00fc\u015fterimizin \u015firketimizdeki di\u011fer m\u00fc\u015fteriler genelinde de\u011ferini tahminledik. (CLTV_Prediction)\n     \nT\u00fcm bu \u00e7al\u0131\u015fman\u0131n sonunda olu\u015fturmu\u015f oldu\u011fumuz CRM_final \u00e7\u0131kt\u0131s\u0131n\u0131 t\u00fcm de\u011fi\u015fkenler \u00f6zelinde de\u011ferlendirdim. Yorumlar\u0131ma a\u015fa\u011f\u0131da yer verdir. \n","caee0887":"### RFM Analizi Sonucu Yorumlama ve Aksiyon Kararlar\u0131\n\nRFM Segmentasyonu olu\u015fturarak RFM analizi s\u00fcrecini tamamlad\u0131k.Yukar\u0131daki g\u00f6rsellerden faydalanarak betimsel istatistik tablolar\u0131n\u0131 daha detayl\u0131 bir \u015fekilde analiz ettim. RFM Analizi sonucunda yukar\u0131daki g\u00f6rselde pasta dilimi olarak ay\u0131rd\u0131\u011f\u0131m 3 farkl\u0131 segmenti se\u00e7erek bu s\u0131n\u0131flar genelinde yorumlamalar ve bu s\u0131n\u0131fta bulunan m\u00fc\u015fterilerimizle ilgili al\u0131nmas\u0131 gereken aksiyon planlar\u0131n\u0131 a\u015fa\u011f\u0131da g\u00f6rebilirsiniz.\n\n#### Kapsam ve Ama\u00e7 :\n\n * RFM Analizi sonucunda tablodaki 3 segmentin se\u00e7ilmesinde segmentlerin m\u00fc\u015fteri say\u0131lar\u0131n\u0131n da\u011f\u0131l\u0131m\u0131 dikkate al\u0131nm\u0131\u015ft\u0131r. \n * En \u00e7ok hangi segmentte m\u00fc\u015fteri daha fazla ise o segmente aksiyon alabiliriz.\n * Veride 2010-2011 y\u0131llar\u0131 aras\u0131ndaki tekil m\u00fc\u015fteri say\u0131s\u0131 4338\u2019dir. \n * Bu m\u00fc\u015fterilerin %19\u2019u Loyal_Customers, %15\u2019i Champions, %14\u2019\u00fc At_Risk segmentlerine aittir.\n * Hibernating grubu en \u00e7ok m\u00fc\u015fterimizin bulundu\u011fu grup olmas\u0131na ra\u011fmen ortalama 217 g\u00fcn ile g\u00fcncel al\u0131\u015fveri\u015f de\u011feri en eski olan gruptur. M\u00fc\u015fterilerin bu grupta bulunmas\u0131na ra\u011fmen Recency de\u011feri ortalamas\u0131n\u0131 g\u00f6z \u00f6n\u00fcnde bulundurdu\u011fumuzda \u015fimdilik bu segment aksiyon a\u00e7\u0131s\u0131ndan dikkate al\u0131nmam\u0131\u015ft\u0131r.\n \n#### LOYAL CUSTOMERS\n \n * Bu grupta 819 ki\u015fi yer al\u0131yor.\n * Ortalama 33 g\u00fcn \u00f6nce al\u0131\u015fveri\u015f yapm\u0131\u015flar.\n * Bu gruptaki m\u00fc\u015fterilerin sat\u0131n alma say\u0131lar\u0131 ise ortalama 6\u2019d\u0131r. Bu veri setinde bulunan m\u00fc\u015fteriler, t\u00fcm segmentlerdeki m\u00fc\u015fterilere oranla %52 daha fazla al\u0131\u015fveri\u015f yapm\u0131\u015flard\u0131r. (Genel ortalama sat\u0131n alma say\u0131s\u0131 4,27)\n * Grubun ortalama harcama tutar\u0131 ise 2864,00\u00a3. Bu veri setinde harcama yapm\u0131\u015f olan t\u00fcm m\u00fc\u015fterilere oranla %39 daha fazla harcama tutar\u0131 ger\u00e7ekle\u015ftirmi\u015flerdir.   \n\n*Aksiyon \u00d6nerileri :*\n * Bu grupla ilgilenerek Champions segmentine dahil olmas\u0131 sa\u011flanmal\u0131d\u0131r. Buna elveri\u015fli m\u00fc\u015fteriler mevcuttur.\n * Champions grubundaki \u00f6zel i\u00e7erikleri artt\u0131rarak bu grup te\u015fvik edilebilir. \n * Bu segmentin Recency de\u011feri yani al\u0131\u015fveri\u015f s\u00fcrelerini \u00f6ne \u00e7ekebilecek \u015fekilde daha fazla temas halinde olmal\u0131y\u0131z.\n\n#### CHAMP\u0130ONS\n\n * Bu grupta 633 ki\u015fi yer al\u0131yor.\n * Ortalama 6 g\u00fcn \u00f6nce al\u0131\u015fveri\u015f yapm\u0131\u015flar.\n * Bu gruptaki m\u00fc\u015fterilerin sat\u0131n alma say\u0131lar\u0131 ise ortalama 12\u2019d\u0131r. \n * Grubun ortalama harcama tutar\u0131 ise 6857,96\u00a3. \n\n*Aksiyon \u00d6nerileri :*\n * Kalite ve fiyat a\u00e7\u0131s\u0131ndan en tepede olan \u00fcr\u00fcnleri bu segmente \u00f6nerebiliriz.\n * Piyasaya yeni s\u00fcr\u00fclen ve kullan\u0131c\u0131lara tan\u0131t\u0131lacak \u00fcr\u00fcnleri bu gruba \u00fccretsiz g\u00f6ndererek deneyimlerinden de\u011fer ortaya \u00e7\u0131karabiliriz.\n * Bu segmente \u00f6zel kartlarla anla\u015fmal\u0131 giyim, aksesuar ve yiyecek, i\u00e7ecek yerlerinden indirim sa\u011flanabilir. Ger\u00e7ekten ayr\u0131cal\u0131kl\u0131 olduklar\u0131n\u0131 hissettirmemiz gerekir.\n \n#### AT R\u0130SK\n\n * Bu grupta 593 ki\u015fi yer al\u0131yor.\n * Ortalama 153 g\u00fcn \u00f6nce al\u0131\u015fveri\u015f yapm\u0131\u015flar.\n * Bu gruptaki m\u00fc\u015fterilerin sat\u0131n alma say\u0131lar\u0131 ise ortalama 2,87\u2019d\u0131r. Bu veri setinde bulunan m\u00fc\u015fteriler, t\u00fcm segmentlerdeki m\u00fc\u015fterilere oranla %33 daha **az** al\u0131\u015fveri\u015f yapm\u0131\u015flard\u0131r. (Genel ortalama al\u0131\u015fveri\u015f say\u0131s\u0131 4,27)\n * Grubun ortalama harcama tutar\u0131 ise 1084,54\u00a3. Bu veri setinde harcama yapm\u0131\u015f olan t\u00fcm m\u00fc\u015fterilere oranla %47 daha **az** harcama tutar\u0131 ger\u00e7ekle\u015ftirmi\u015flerdir.   \n\n*Aksiyon \u00d6nerileri :*\n * Sms yoluyla ileti\u015fime ge\u00e7ilebilir.\n * Bu gruptaki m\u00fc\u015fterilerin uyku grubuna ge\u00e7me durumlar\u0131 \u00e7ok y\u00fcksek. Bu gruba \u00f6zel indirimler ve kampanyalar tan\u0131mlanabilir.\n\n---","30acc2a0":"RFM skorlar\u0131n\u0131 olu\u015fturduktan sonra a\u015fa\u011f\u0131daki yayg\u0131n olarak kullan\u0131lan RFM tablosuna g\u00f6re RFM segmentlerini olu\u015fturaca\u011f\u0131z. A\u015fa\u011f\u0131daki tabloda m\u00fc\u015fteriler segmentlere ayr\u0131lm\u0131\u015ft\u0131r. Bu tabloda Frequecy ve Recency olarak 2 metrik bulunmaktad\u0131r. Skorlar\u0131m\u0131z\u0131 biz de bu 2 metrik \u00fczerinden olu\u015fturmu\u015ftuk. 2 Metrik i\u00e7in de 1 \u00e7ok iyi, 5 \u00e7ok k\u00f6t\u00fc anlam\u0131na gelir.\n\nBiz de m\u00fc\u015fterilerimizi yukar\u0131daki onlar\u0131n davran\u0131\u015flar\u0131ndan olu\u015fturdu\u011fumuz skorlara g\u00f6re Frequency ve Recency de\u011ferleri ile a\u015fa\u011f\u0131daki tablo \u00f6zelinde segmentlere ay\u0131raca\u011f\u0131z.\n\nGelin \u00f6nce beraber tablodan birka\u00e7 s\u0131n\u0131f\u0131 inceleyelim;\n * Champions s\u0131n\u0131f\u0131nda yer alanlar bizim i\u00e7in en de\u011ferli m\u00fc\u015fterilerdir. Bu s\u0131n\u0131f\u0131n son sat\u0131n alma tarihi en erken ve sat\u0131n alma say\u0131s\u0131 en fazla olan s\u0131n\u0131ft\u0131r.\n * Loyal Customer s\u0131n\u0131f\u0131nda yer alanlar bizim sad\u0131k m\u00fc\u015fterilerimizdir. Bu s\u0131n\u0131fta bulunanlar\u0131n Recency de\u011feri 3 ve 4, Frequency de\u011feri ise 4 ve 5 skorlar\u0131ndan olu\u015fur.\n * At Risk s\u0131n\u0131f\u0131nda bulunanlar ise riskli s\u0131n\u0131f\u0131 temsil eder. Bu s\u0131n\u0131fta bulunanlar\u0131n Recency de\u011feri 1 ve 2, Frequecny de\u011feri ise 3 ve 4 skorlar\u0131ndan olu\u015fur. Yani En son sat\u0131n alma tarihi \u00fczerinden uzun bir s\u00fcre ge\u00e7mi\u015f ve bu uzun s\u00fcre \u00f6nce sat\u0131n alma say\u0131lar\u0131 ortalama olan m\u00fc\u015fterilerdir.\n \nTabloyu bu \u015fekilde yorumlayabiliriz.","73efd46e":"# 1- Data Understanding","fe66f624":"Art\u0131k RFM metriklerini hesaplam\u0131\u015f bulunmaktay\u0131z. Tekrardan hat\u0131rlamak i\u00e7in;\n * Recency : M\u00fc\u015fterilerimizin son sat\u0131n alma tarihinden referans tarihe kadar ge\u00e7en s\u00fcreyi ifade ediyor.\n * Frequency : M\u00fc\u015fterilerimizin toplam sat\u0131n alma say\u0131lar\u0131n\u0131 ifade ediyor.\n * Monetary : M\u00fc\u015fterilerin bu sat\u0131n almalar sonucunda toplam harcama tutar\u0131n\u0131 ifade ediyor.\n\nGelin birlikte \u00f6rnek olarak yukar\u0131dan bir m\u00fc\u015fteriyi yorumlayal\u0131m.\n * 12348 ID'l\u0131 m\u00fc\u015fterimiz, 76 g\u00fcn \u00f6nce al\u0131\u015fveri\u015f yapm\u0131\u015f. 4 sat\u0131n alma ger\u00e7ekle\u015ftirmi\u015f. Bu sat\u0131n almalar sonucunda b\u0131rakt\u0131\u011f\u0131 toplam tutar 1770.78 birimdir. \n \nArt\u0131k RFM skorlar\u0131n\u0131 hesaplamaya ge\u00e7ebiliriz.","19cbfdd5":"### RFM Segmentlerinin Olu\u015fturulmas\u0131","666b3a98":"Projemi inceledi\u011finiz i\u00e7in te\u015fekk\u00fcrler.","129f5eff":"![](https:\/\/miro.medium.com\/max\/805\/1*TjJt4rUiBtXLAF84--V-Cg.png)","37da587c":"### CRM_Final Sonucu Yorumlama ve Aksiyon Kararlar\u0131\n\nA\u015fa\u011f\u0131da CLTV Calculate\u2019e g\u00f6re A segmentinde oldu\u011fu hesaplanan 3 farkl\u0131 m\u00fc\u015fterinin CLTV Prediction\u2019a g\u00f6re nas\u0131l farkl\u0131 segmentte yer ald\u0131\u011f\u0131n\u0131 de\u011ferlendirece\u011fiz. A\u015fa\u011f\u0131daki yorumlar \u00f6zelinde A segmenti en iyi m\u00fc\u015fteriler, C segmenti en k\u00f6t\u00fc m\u00fc\u015fterileri ifade eder.\n\n * 1.sat\u0131rdaki m\u00fc\u015fterinin Calculate sonucu A segmentinde olaca\u011f\u0131 de\u011ferlendirilirken Prediction sonucu B segmentinde oldu\u011fu g\u00f6zlemleniyor. Bunun sebeplerinden biri \"Recency\" de\u011feri yani 10 g\u00fcn \u00f6nce al\u0131\u015fveri\u015f yapm\u0131\u015f olmas\u0131na ra\u011fmen, m\u00fc\u015fterinin yapt\u0131\u011f\u0131 17 al\u0131\u015fveri\u015f sonucunda b\u0131rakt\u0131\u011f\u0131 ortalama \"monetary_avg\" di\u011fer 2 ki\u015fiye g\u00f6re daha az tutard\u0131r.\n \n * 2.sat\u0131rdaki m\u00fc\u015fteri ise tahmin edilen ortalama harcama tutar\u0131 di\u011fer 1. sat\u0131rdaki m\u00fc\u015fteriden daha y\u00fcksek olmas\u0131na kar\u015f\u0131n Prediction sonucu C segmentinde g\u00f6zlemleniyor. Bunun sebebi \"frequency\" de\u011ferinin 5 olmas\u0131yla birlikte en son 219 g\u00fcn \u00f6nce al\u0131\u015fveri\u015f yapm\u0131\u015f ve buna kar\u015f\u0131l\u0131k \"recency_cltv_p\" ise yani son al\u0131\u015fveri\u015f ve ilk al\u0131\u015fveri\u015f aras\u0131ndaki g\u00fcn fark\u0131 ise 153 g\u00fcn hesaplanm\u0131\u015f. Yani ben bu m\u00fc\u015fteriden ilk al\u0131\u015fveri\u015f ve son al\u0131\u015fveri\u015f tarihi aral\u0131\u011f\u0131n\u0131 maksimum 153 g\u00fcn beklerken m\u00fc\u015fteri 219 g\u00fcnd\u00fcr yok. En son 219 g\u00fcn \u00f6nce al\u0131\u015fveri\u015f yapm\u0131\u015f. Art\u0131k m\u00fc\u015fterinin beni terk etti\u011fi yorumu yapabilirim. Bu sebeple Prediction sonucu C segmentinde yer al\u0131yor.\n \n * 3.sat\u0131rdaki m\u00fc\u015fteri Calculate segmenti A ve Prediction sonucu segmenti de A olarak hesaplanm\u0131\u015f. Bu m\u00fc\u015fterinin \"frequency\" de\u011feri d\u00fc\u015f\u00fck olmas\u0131na ra\u011fmen \"monetray_avg\" de\u011ferinden dolay\u0131 yani yapm\u0131\u015f oldu\u011fu al\u0131\u015fveri\u015flerden y\u00fcksek para b\u0131rakaca\u011f\u0131ndan dolay\u0131 Prediction sonucu A segmenti olarak tahmin edilmi\u015ftir.\n\n![image-2.png](attachment:image-2.png)","7367c26a":"T\u00fcm m\u00fc\u015fterilerimizin kullan\u0131c\u0131 davran\u0131\u015flar\u0131n\u0131 g\u00f6z \u00f6n\u00fcnde bulundurarak belli bir zaman projeksiyonu ile gelece\u011fe y\u00f6nelik Customer Life Time Value tahmini yapaca\u011f\u0131z.\n\nM\u00fc\u015fteriye ait elimizde ortalama en son ne zaman sat\u0131n alma yapt\u0131\u011f\u0131, b\u0131rakt\u0131\u011f\u0131 gelir ve sat\u0131n alma frekans\u0131 olsa da ileriye d\u00f6n\u00fck tahmin yapam\u0131yor olmam\u0131z\u0131n sebebi,\n * \u015eirket a\u00e7\u0131s\u0131ndan t\u00fcm m\u00fc\u015fterilerin davran\u0131\u015f da\u011f\u0131l\u0131m\u0131 elimizde yok.\n * Bireyler a\u00e7\u0131s\u0131ndan da bu olas\u0131l\u0131k da\u011f\u0131l\u0131m\u0131na g\u00f6re bir tahmin yok.\n\nBG-NBD ve Gamma-Gamma modelleri ile bu sorunu \u00e7\u00f6zerek ileriye d\u00f6n\u00fck tahminleme yapm\u0131\u015f olaca\u011f\u0131z.\n\nCLTV tahmini ger\u00e7ekle\u015ftirirken RFM tablosuna benzer bir tablo olu\u015fturup, ek olarak Tenure de\u011feri ekleyece\u011fiz. **Tenure**, m\u00fc\u015fterinin \u015firket ile ilk konta\u011f\u0131ndan referans belirledi\u011fimiz tarihe kadar ge\u00e7en zaman olarak tan\u0131mlan\u0131r. Belirledi\u011fimiz referans tarihten m\u00fc\u015fterinin ilk sat\u0131n alma yapt\u0131\u011f\u0131 tarih \u00e7\u0131kar\u0131larak hesaplanabilir. Buna ek olarak Recency de\u011feri hesaplarken referans tarihimizden son sat\u0131n alma tarihini \u00e7\u0131kar\u0131yorduk. Ancak CLTV tahmini yaparken m\u00fc\u015fterinin sat\u0131n alma yapt\u0131\u011f\u0131 son tarihten, sat\u0131n alma yapt\u0131\u011f\u0131 ilk tarihi \u00e7\u0131karmam\u0131z gerekiyor. Bunun sebebi ise; BGNBD ve Gamma-Gamma modelleri form\u00fclleri bizden arg\u00fcmanlar\u0131 bu hesaplama mant\u0131\u011f\u0131yla istiyor. \n\n * **recency_cltv_p :** `lambda date: (date.max() - date.min()).days`\n * **Tenure :** `lambda date: (today_date - date.min()).days`\n ","fd542ca3":"\u00c7\u0131kt\u0131da bo\u015f gelen de\u011ferler \u015fu ana kadar 1 sat\u0131n alma ger\u00e7ekle\u015ftiren m\u00fc\u015fterilerimizi ifade etmektedir. Hat\u0131rlayacak olursak CLTV Prediction hesab\u0131nda bunlar\u0131 \u00e7al\u0131\u015fman\u0131n d\u0131\u015f\u0131nda tutmu\u015ftuk. En az 1'den fazla sat\u0131n alma ger\u00e7ekle\u015ftiren m\u00fc\u015fterilerin ileriye d\u00f6n\u00fck m\u00fc\u015fteri ya\u015fam boyu de\u011ferlerini hesaplam\u0131\u015ft\u0131k.","06927e0f":"M\u00fc\u015fterilerimizle ilgili detayl\u0131 kararlar alabilmek i\u00e7in RFM Analizi, CLTV Calculate ve CLTV Prediction \u00e7\u0131kt\u0131lar\u0131n\u0131n hepsini tek bir crm_final olarak olu\u015fturarak gerekli yorumlar ve aksiyon kararlar\u0131n\u0131 ger\u00e7ekle\u015ftirebiliriz. ","af2c77f1":"### RFM Skorlar\u0131n\u0131n Hesaplanmas\u0131","5063bd79":"# 5- Predicted CLTV","97ae9f5c":"Biz art\u0131k RFM skorlar\u0131m\u0131z\u0131 olu\u015fturduk. \u015eimdi ise bu skorlar\u0131 kullanarak m\u00fc\u015fterilerimizi yukar\u0131da g\u00f6rd\u00fc\u011f\u00fcm\u00fcz tablo \u00f6zelinde segmentlere ay\u0131raca\u011f\u0131z. \u00d6rne\u011fin Frequency de\u011feri 5 ve Recency de\u011feri 5 olan m\u00fc\u015fterimize \"Champions\" s\u0131n\u0131f\u0131nda yer verece\u011fiz.","8a07826c":"# 2- Data Preperation","9d613a13":"# 4- Calculated CLTV","b385d636":"# CRM Analytics (RFM Analysis, CLTV)\n\n![](https:\/\/cdn-images-1.medium.com\/max\/800\/1*8kB7crU624Xc4Gksb327mw.png)\n\n1- **Data Understanding** (Veriyi anlama)\n\n2- **Data Preperation** (Veri \u00f6n i\u015fleme)\n\n3- **Creating RFM Segments** (RFM Analizi ile m\u00fc\u015fterilerin Recency ve Frequency de\u011ferlerini kullanarak m\u00fc\u015fteri segmentasyonu ger\u00e7ekle\u015ftirece\u011fiz.)\n\n4- **Calculated CLTV** (Bir m\u00fc\u015fterinin \u015firket i\u00e7in de\u011ferinin hesaplan\u0131p segmentlere ayr\u0131lmas\u0131n\u0131 g\u00f6rece\u011fiz.)\n\n5- **Predicted CLTV** (Bu m\u00fc\u015fteri de\u011feri hesaplamas\u0131n\u0131n zaman eksenli bir projeksiyonu olmad\u0131\u011f\u0131 i\u00e7in zaman projeksiyonu getirerek gelece\u011fe y\u00f6nelik m\u00fc\u015fteri de\u011feri hesaplamay\u0131 ve segmentlere ay\u0131rmay\u0131 ger\u00e7ekle\u015ftirece\u011fiz.)\n * BG-NBD modeli ile gelce\u011fe y\u00f6nelik beklenen sat\u0131\u015flar\u0131n tahmini,\n * Gamma-Gamma modeli ile gelece\u011fe y\u00f6nelik beklenen karl\u0131l\u0131k tahmini ger\u00e7ekle\u015ftirece\u011fiz.\n * BG-NBD ve Gamma-Gamma modelleri ile belirli bir zaman periyodu i\u00e7in CLTV tahmini ger\u00e7ekle\u015ftirece\u011fiz.\n\n6- T\u00fcm \u00e7al\u0131\u015fmalar\u0131 tek bir \u00e7at\u0131 alt\u0131nda toplayarak proje \u00fczerinden \u00f6nemli yorumlamalar yapaca\u011f\u0131z.\n\n---\n\n### Veri Seti Hikayesi  \ud83d\udc49  https:\/\/archive.ics.uci.edu\/ml\/datasets\/Online+Retail+II\n\nOnline Retail II, \u0130ngiltere merkezli bir e-ticaret \u015firketinin 01\/12\/2009 - 09\/12\/2011 tarihleri aras\u0131ndaki sat\u0131\u015flar\u0131n\u0131 i\u00e7ermektedir. \u015eirket hediyelik e\u015fya sat\u0131\u015f\u0131 ger\u00e7ekle\u015ftirmekte ve m\u00fc\u015fterileri de toptanc\u0131lard\u0131r.\n\n### Veri Setindeki De\u011fi\u015fkenler\n\n* **Invoice:** Fatura numaras\u0131. Her faturaya ait e\u015fsiz numara. E\u011fer bu kod C ile ba\u015fl\u0131yorsa i\u015flemin iptal edildi\u011fini ifade eder.\n* **StockCode:** \u00dcr\u00fcn kodu. Her bir \u00fcr\u00fcn i\u00e7in e\u015fsiz numara.\n* **Description:** \u00dcr\u00fcn ismi\n* **Quantity:** \u00dcr\u00fcn adedi. Faturalardaki \u00fcr\u00fcnlerden ka\u00e7ar tane sat\u0131ld\u0131\u011f\u0131n\u0131 ifade etmektedir.\n* **InvoiceDate:** Fatura tarihi ve zaman\u0131.\n* **UnitPrice:** \u00dcr\u00fcn fiyat\u0131\n* **CustomerID:** E\u015fsiz m\u00fc\u015fteri numaras\u0131\n* **Country:** \u00dclke ismi. M\u00fc\u015fterinin ya\u015fad\u0131\u011f\u0131 \u00fclke.\n","507ec181":"Art\u0131k RFM Metrikleri ve RFM Skorlar\u0131n\u0131 olu\u015fturduk.\n\n\u00d6rne\u011fin a\u015fa\u011f\u0131daki tabloyu yorumlad\u0131\u011f\u0131m\u0131zda;\n* 12347 ID'li m\u00fc\u015fteri recency de\u011feri 3, Frequecny de\u011feri 7, yani m\u00fc\u015fteri en son 3 g\u00fcn \u00f6nce al\u0131\u015fveri\u015f yapm\u0131\u015f ve bu benim i\u00e7in \u00f6nemli bir metrik oldu\u011fundan dolay\u0131 RFM skoru olarak 5 puan\u0131 ald\u0131. Ayn\u0131 m\u00fc\u015fterinin sat\u0131n alma say\u0131s\u0131 da 7 oldu\u011fu i\u00e7in yine frequecny skoru olarak 5 puan\u0131n\u0131 ald\u0131.","9d48ec6d":"RFM, m\u00fc\u015fterilerin sat\u0131n alma al\u0131\u015fkanl\u0131klar\u0131 \u00fczerinden onlar\u0131 segmentlere ay\u0131rarak pazarlama ve sat\u0131\u015f stratejileri belirlemeye yard\u0131mc\u0131 olur.\n\n3 davran\u0131\u015f metri\u011finin ba\u015f harflerinden meydana gelir.\n\n* **Recency :** M\u00fc\u015fterinin \u015firketle son temas\u0131ndan yani m\u00fc\u015fterinin son sat\u0131n almas\u0131ndan bug\u00fcne kadar ge\u00e7en s\u00fcredir.\n    * (Recency = Bug\u00fcn\u00fcn tarihi\u200a-\u200aSon sat\u0131n alma tarihi)\n    * Burada dikkat etmemiz gereken nokta Recency de\u011feri olacakt\u0131r. Bu de\u011ferde Frequency ve Monetary metriklerine g\u00f6re tersten bir skorlama yap\u0131lmaktad\u0131r.\n    * Recency de\u011feri yani m\u00fc\u015fterinin en son sat\u0131n alma ger\u00e7ekle\u015ftirdi\u011fi tarih ne kadar yak\u0131nsa bizim i\u00e7in bir o kadar de\u011ferlidir. Bu y\u00fczden yukar\u0131daki Recency form\u00fcl\u00fcnden gelecek olan sonu\u00e7 ne kadar k\u00fc\u00e7\u00fck olursa bizim i\u00e7in skorlamada o kadar y\u00fcksek puan alacakt\u0131r.\n\n* **Frequency :** M\u00fc\u015fterinin toplam sat\u0131n alma say\u0131s\u0131n\u0131 g\u00f6sterir.\n\n* **Monetary :** M\u00fc\u015fterinin al\u0131\u015fveri\u015flerinde yapt\u0131\u011f\u0131 toplam harcamad\u0131r.\n\nFrequency ve Monetray metriklerinin ise de\u011ferleri ne kadar y\u00fcksekse skorlamada da o kadar y\u00fcksek puan alacakt\u0131r.","171ac470":"---","1bd70c6b":"### Veri okuma i\u015flemini ger\u00e7ekle\u015ftirdik.\n### Veriyi anlamaya \u00e7al\u0131\u015faca\u011f\u0131z.","28a28fb3":"# 3- Creating RFM Segments"}}