{"cell_type":{"0b05afac":"code","56990006":"code","4890ed5f":"code","2ac1106a":"code","1a954610":"code","e5a3f6a6":"code","72ccebb3":"code","0cc810f9":"code","9e3c3f5e":"code","494f7c8f":"code","1e6be39c":"code","067cd782":"code","f94427a8":"code","d8b45eb4":"code","cb67b0b5":"code","a6299467":"code","65f7eb9e":"code","b7f46129":"code","1ebd59a9":"code","f32519e1":"code","b19e32ca":"code","f65ec69b":"code","b477fe7b":"code","137ef0d0":"code","f7aa685e":"code","4f9e38a5":"code","89c7c49f":"code","1cfac200":"code","14a2d119":"markdown","c68d13d8":"markdown","1969bba1":"markdown","e7187327":"markdown","76f7d925":"markdown","bb007ed5":"markdown","d18f70d7":"markdown","7a03c927":"markdown","2a4b63e6":"markdown","954c7a95":"markdown","3ed45768":"markdown","cf0ce30b":"markdown","6dbc506c":"markdown","30298aae":"markdown","e8d2c16d":"markdown","dffcec47":"markdown","ad57a404":"markdown","df108958":"markdown","069632d3":"markdown","cc0822d9":"markdown","e9cbcb3c":"markdown","6f01819e":"markdown","c76347d8":"markdown","a9936a75":"markdown","dfc4a127":"markdown","d3281de9":"markdown","574170a7":"markdown"},"source":{"0b05afac":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport os\nimport re\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set_theme(style=\"whitegrid\")\n\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n","56990006":"# import data\ndf = pd.read_csv(r\"\/kaggle\/input\/amazon-top-50-bestselling-books-2009-2019\/bestsellers with categories.csv\")","4890ed5f":"# quick view about the table\ndf.head()","2ac1106a":"print(f\"There are {np.shape(df)[0]} rows and {np.shape(df)[1]} columns\")","1a954610":"# check the numeric columns\ndf.describe()","e5a3f6a6":"ax = sns.boxplot(x=df[\"User Rating\"])","72ccebb3":"ax = sns.boxplot(x=df[\"Reviews\"])","0cc810f9":"ax = sns.boxplot(x=df[\"Price\"])","9e3c3f5e":"df[df[\"User Rating\"] == 3.3]","494f7c8f":"df[df[\"Reviews\"] == 37]","1e6be39c":"df[df[\"Price\"] == 0]","067cd782":"# Seperate the dataframe into two dataframes\ndf_not_zero = df[df[\"Price\"] != 0]\ndf_equal_zero = df[df[\"Price\"] == 0]\n\n# calculate the mean price, grouped by year and genre\nprice_groubpy_year_genre = df_not_zero.groupby([\"Year\", \"Genre\"])[\"Price\"].mean()\n\n# Drop the \"Price\" column\ndf_equal_zero.drop(columns=['Price'], inplace = True)\n\n# Left join the average price and concate the two dataframes.\ndf_replaced_zero = pd.merge(df_equal_zero,price_groubpy_year_genre,on=[\"Year\", \"Genre\"])\ndf_new = pd.concat([df_not_zero, df_replaced_zero])","f94427a8":"print(f\"There are {np.shape(df_new)[0]} rows and {np.shape(df_new)[1]} columns\")","d8b45eb4":"print(f\"There are {len(df_new.Name.unique())} books and {len(df_new.Author.unique())} arthurs\")","cb67b0b5":"# Import libries:\nfrom sklearn.feature_extraction.text import CountVectorizer\nfrom sklearn.metrics.pairwise import cosine_similarity","a6299467":"# Find all the Unique names, and transform to lower case:\nunique_name = df_new.Name.unique()\nunique_name = [word.lower() for word in unique_name]\n# Vectorize words:\ncount_vectorizer = CountVectorizer()\nsparse_matrix = count_vectorizer.fit_transform(unique_name)\n\n# Calculate the similarity between each other\nresult = (cosine_similarity(sparse_matrix, sparse_matrix))\n\n# Only get similar names with score > 0.7 and < 1. \n# Similarity Score is a hyperparameter can be set by ourselves.\n# I have tried several similarity score. 0.7 give a good result.\nsimilar_name = np.argwhere(result > 0.7)\nsimilar_name_filter = similar_name[similar_name[:,0] != similar_name[:,1]]\n\n# Some result is repeated. The below code filter them out\nsimilar_name_filter_not_repeat = similar_name_filter[similar_name_filter[:,1] > similar_name_filter[:,0]]\n\n# Make a dataframe for easier comparison\nleft = np.array(similar_name_filter_not_repeat[:,0])\nright = np.array(similar_name_filter_not_repeat[:,1])\ndf_similar = pd.DataFrame({'col1': np.take(unique_name, left), 'col2': np.take(unique_name, right)}) ","65f7eb9e":"# Set pandas to show more rows\npd.set_option('display.max_rows', 100)\n# Result that some books have similar with another books\ndf_similar","b7f46129":"# Find all the Unique names, and transform to lower case:\nunique_name = df_new.Author.unique()\nunique_name = [word.lower() for word in unique_name]\n# Vectorize words into vectors:\ncount_vectorizer = CountVectorizer(ngram_range=(1, 3))\nsparse_matrix = count_vectorizer.fit_transform(unique_name)\n\n# Calculate the similarity between each other\nresult = (cosine_similarity(sparse_matrix, sparse_matrix))\n\n# Only get similar names with score > 0.7 and < 1. \n# Similarity Score is a hyperparameter can be set by ourselves.\n# I have tried several similarity score. 0.7 give a good result.\nsimilar_name = np.argwhere(result > 0.7)\nsimilar_name_filter = similar_name[similar_name[:,0] != similar_name[:,1]]\n\n# Some result is repeated. The below code filter them out\nsimilar_name_filter_not_repeat = similar_name_filter[similar_name_filter[:,1] > similar_name_filter[:,0]]\n\n# Make a dataframe for easier comparison\nleft = np.array(similar_name_filter_not_repeat[:,0])\nright = np.array(similar_name_filter_not_repeat[:,1])\ndf_similar = pd.DataFrame({'col1': np.take(unique_name, left), 'col2': np.take(unique_name, right)}) ","1ebd59a9":"df_similar","f32519e1":"# Correct the authors' names in the dataframe\n# Remember that authors' names were transformed to lower case. Here, I hard code to change the dataframe.\ndf_new = df_new.replace([\"George R. R. Martin\", \"J. K. Rowling\"], [\"George R.R. Martin\",\"J.K. Rowling\"])","b19e32ca":"print(f\"There are {len(df_new.Name.unique())} books and {len(df_new.Author.unique())} arthurs. There are 248 arthurs' names before correction.\")","f65ec69b":"# We can see there are different series of books.\n# I use \"dog man series\" as an example and to \n# see if we can find some insight from it.\ndf_new = df_new.reset_index()\nname_list = []\nname_lower = df_new[\"Name\"].apply(lambda x: x.lower())\nfor i in range(len(name_lower)):\n    if \"dog man\" in name_lower[i]:\n        name_list.append(i)\ndf_series = df_new.iloc[name_list, :]","b477fe7b":"df_series","137ef0d0":"df_series_avg = df_series.groupby([\"Year\"]).mean().reset_index()\ndf_fiction_avg = df[df[\"Genre\"] == \"Fiction\"].groupby([\"Year\", \"Genre\"]).mean()\n\ndf_fiction_avg = df_fiction_avg.reset_index()[[\"Year\", \"Reviews\"]]\ndf_fiction_avg = df_fiction_avg.iloc[-3:]\n\ndf_series_avg[\"Legend\"] = \"Dog Man\"\ndf_fiction_avg[\"Legend\"] = \"Total\"\n\ndog_man_df = pd.concat([df_series_avg, df_fiction_avg])\ndog_man_df = dog_man_df.astype({\"Year\": \"string\"})","f7aa685e":"sns.lineplot(data = dog_man_df, x=\"Year\", y=\"Reviews\", hue=\"Legend\", style=\"Legend\")\nax.set(xlim=(2017, 2019))","4f9e38a5":"# First, I find which author had most bestselling books in amazon\ndf_author = df_new.groupby([\"Author\"]).count().reset_index()\ndf_author.sort_values(by=['index']).tail(1)[\"Author\"]","89c7c49f":"JK_df = df_new[df_new[\"Author\"] == \"Jeff Kinney\"]\nJK_df = JK_df.groupby([\"Year\"]).mean()\nJK_df[\"Legend\"] = \"Jeff Kinney\"\nJK_df = JK_df[[\"Legend\", \"User Rating\"]]\nJK_df.reset_index(inplace=True)\n\ndf_fiction_avg = df[df[\"Genre\"] == \"Fiction\"].groupby([\"Year\", \"Genre\"]).mean()\ndf_fiction_avg = df_fiction_avg.reset_index()[[\"Year\", \"User Rating\"]]\ndf_fiction_avg[\"Legend\"] = \"Total\"\n\nJK_df = pd.concat([JK_df, df_fiction_avg])","1cfac200":"sns.lineplot(data = JK_df, x=\"Year\", y=\"User Rating\", hue=\"Legend\", style=\"Legend\")","14a2d119":"Next, we can take a look at the data in the perspective of author.","c68d13d8":"Feel free to upvote it if you think this notebook is useful for you! Thank You!","1969bba1":"Plot three figures to show the details of \"User Rating\", \"Reviews\", \"Price\".","e7187327":"Some question I have after reading the figures:\n* (1) Which book got average 3.3 user rating?\n* (2) Which book got only 37 reviews while other books have thousands of reviews?\n* (3) The minimun price is 0? >> seems that we need to take a detailed look at it","76f7d925":"Jeff Kinney published most books that are the bestselling books. Code to draft the figure:","bb007ed5":"(2) Which book got only 37 reviews?","d18f70d7":"The actual number of unique books or arthurs may be less due to typing difference in name. For example, ","7a03c927":"# Data Exploration - checking duplicate names","2a4b63e6":"    We can also find books with low price (eg. 1,2,3). As long as the price is not 0, we can accept the validity of the table. I will replace the 0 with average price grouped by year and genre. ","954c7a95":"    \"The Girl Who Played with Fire (Millennium Series)\" and \n    \"The Girl Who Played with Fire (Millennium)\" ","3ed45768":"This notebook contains\n- Data Preparation: quick view towards the dataset, replacing value with mean value\n- Data Exploration: finding duplicates\/ similar words by using cosine similarity\n- Data Visualization","cf0ce30b":"(1) Which book got average 3.3 user rating?","6dbc506c":"# Import Library","30298aae":"The meaning of Similarity Score:\n* (1) It gives us a fast and easy way to check if there are similar words in the dataset. Here, we find that some books' names are different but they are acturally representing the same book.","e8d2c16d":">Okay. Reasonable.","dffcec47":"# Data Visualization","ad57a404":"    It just seem unreasonable that one of the best selling books in amazon only got 37 review on that year. Anyway, I dont have way to check the validity.","df108958":"We can change the book name, if we want to explore the data in the perspective of book name. \nHere, I just leave it unchanged now.","069632d3":"The meaning of Similarity Score:\n* (2) It gives us another view to look into the dataset. We found some Series of books by using the above method. For example: heroes of olympus,harry potter, heroes of olympus, diary of a wimpy kid, dog man, etc. This gives us another perspective to drive into the dataset.","cc0822d9":"Code to find similar names:","e9cbcb3c":"Price that equals to 0 is replaced with the average price.\nCode:","6f01819e":"Below I will use word similarity to check all the unique books name and arthurs name. ","c76347d8":"I made some changes to the above code.\nWe can now find the similar authors' names by the following code:","a9936a75":"To check if the code is correct:","dfc4a127":"# Data Preparation","d3281de9":"Lets see how is the performace of the Dog Man series (by comparing with the average review of all books at different years).\nCode:","574170a7":"(3) The minimun price is 0? "}}