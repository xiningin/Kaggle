{"cell_type":{"717d69e2":"code","362438fa":"code","1e955d59":"code","aa2b6a48":"code","3a43f8aa":"code","3c7ba6d1":"code","04f7fe21":"code","adfdbd11":"code","4fd8063f":"code","af568ea2":"code","9a50175c":"code","13b15625":"code","da5b3e6d":"code","ec0b8c41":"code","f088fb32":"markdown","2b1b171b":"markdown"},"source":{"717d69e2":"import numpy as np\nimport pandas as pd\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import roc_auc_score\nimport shap\nimport gc\nfrom random import shuffle\nfrom sklearn.preprocessing import LabelEncoder\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('..\/input\/'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","362438fa":"import xgboost\nxgboost.__version__","1e955d59":"train = pd.read_csv('..\/input\/tabular-playground-series-jul-2021\/train.csv')\ntest = pd.read_csv('..\/input\/tabular-playground-series-jul-2021\/test.csv')","aa2b6a48":"train.head()","3a43f8aa":"test.head()","3c7ba6d1":"columns = test.columns[1:]\ncolumns","04f7fe21":"target = np.hstack([np.ones(train.shape[0]), np.zeros(test.shape[0])])","adfdbd11":"train_test = np.vstack([train[columns].values, test[columns].values])","4fd8063f":"index = list(range(train_test.shape[0]))\nshuffle(index)\ntrain_test = train_test[index, :]\ntarget = target[index]\ntrain_test = train_test.astype(np.float)","af568ea2":"train, test, y_train, y_test = train_test_split(train_test, target, test_size=0.33, random_state=42)\ntrain = xgboost.DMatrix(train, label=y_train)\nval = xgboost.DMatrix(test, label=y_test)","9a50175c":"%%time\nparam = {\n    'eta': 0.02,\n    'max_depth': 5,\n    'subsample': 0.8,\n    'colsample_bytree': 0.8,\n    'objective': 'reg:logistic',\n    'eval_metric': 'auc',\n    'tree_method': 'hist', \n    'predictor': 'cpu_predictor'\n}\nclf = xgboost.train(param, train, 2500)","13b15625":"preds = clf.predict(val)\nroc_auc_score(y_test, preds)\n","da5b3e6d":"%%time\nshap_preds = clf.predict(val, pred_contribs=True) ","ec0b8c41":"shap.summary_plot(shap_preds[:,:-1], pd.DataFrame(test, columns=columns))","f088fb32":"This is a rather significant AUC. It indicates that there is a significant shift in many of the variables. Let us look what variables are the most distinct between the train and test sets.","2b1b171b":"Looks like Sensor 3 data is the most different between the train and test sets. "}}