{"cell_type":{"83078269":"code","1820bd4b":"code","9b15e763":"code","a500e777":"code","7f28544b":"code","60b27d1b":"code","62c47071":"code","a73152b3":"code","942fed6d":"code","1dd1d245":"code","7971673e":"code","3e716f29":"code","4ca6f3e1":"code","f1ee02f9":"code","fdbffc2f":"code","92f72401":"code","8b3c9c37":"code","c27a2743":"code","95c19e69":"code","3ae5227c":"code","2c8f0487":"code","7e8f2d77":"code","82ba9d80":"code","972ad352":"code","da2d1e87":"markdown","b172e5fb":"markdown","f2883fc8":"markdown","76a5b54d":"markdown","5a8673fc":"markdown","9bbadc68":"markdown","977bd4c1":"markdown","d327e6ca":"markdown","de79a4a4":"markdown","63cd4f10":"markdown","1268acd7":"markdown","4b91e73e":"markdown","a39beccd":"markdown","05184d8e":"markdown","ddc16edd":"markdown","63a28352":"markdown","8ca4ad34":"markdown","1385a39c":"markdown","f5a13f18":"markdown"},"source":{"83078269":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline\n\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import MinMaxScaler\n\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.ensemble import GradientBoostingClassifier\nfrom sklearn.svm import SVC\nfrom xgboost import XGBClassifier\n\nfrom sklearn.metrics import accuracy_score, classification_report\nfrom sklearn.metrics import f1_score\nfrom sklearn.metrics import recall_score\nfrom sklearn.metrics import precision_score\n\nimport os\nprint(os.listdir(\"..\/input\"))","1820bd4b":"df1 = pd.read_csv('..\/input\/heart-disease-uci\/heart.csv')","9b15e763":"df1.head(3)","a500e777":"df1.shape #it is a pretty small dataset with only about 300 rows of patient data.","7f28544b":"df1.isnull().sum() #no null values","60b27d1b":"sns.histplot(x='age', hue='sex', data=df1, kde=True,bins=20)\n#age distribution is similar for both genders. Greater proportion of patients are male","62c47071":"print('Mean age females :',df1[df1['sex']==0]['age'].mean())\nprint('Mean age males :',df1[df1['sex']==1]['age'].mean())\nprint('Number of females :', df1[df1['sex']==0]['age'].count())\nprint('Number of males :', df1[df1['sex']==1]['age'].count())","a73152b3":"df1[df1['target']==0]['trestbps'].mean()","942fed6d":"df1[df1['target']==1]['trestbps'].mean()","1dd1d245":"sns.histplot(x=df1['trestbps'], hue=df1['target'], kde=True)\nplt.axvline(x=df1[df1['target']==0]['trestbps'].mean(), lw=2, c='b')\nplt.axvline(x=df1[df1['target']==1]['trestbps'].mean(), lw=2, c='orange')\nplt.legend(['+ CAD','- CAD'])","7971673e":"plt.figure(figsize=(12,10))\nsns.heatmap(df1.corr(), annot=True)","3e716f29":"sns.barplot(y='thalach', x='target', data=df1)\nplt.xlabel('+\/- CAD')\nplt.ylabel('Mx Heart Rate (bpm)')\nplt.show()\n#max heart rate during excercise is higher in patients with CAD compared to those without","4ca6f3e1":"sns.countplot(x='cp', hue='target', data=df1)\nplt.legend(['- CAD', '+ CAD'])\nplt.xlabel('Chest Pain Type')\nplt.show()","f1ee02f9":"sns.countplot(x='slope', hue='target', data=df1)\nplt.legend(['- CAD', '+ CAD'])\nplt.xlabel('Slope of ST segment')\nplt.show()","fdbffc2f":"sns.barplot(y='chol', x='target', data=df1)\nplt.xlabel('+\/- CAD')\nplt.ylabel('Serum Cholesterol (mg\/dL)')\nplt.show()","92f72401":"sns.countplot(x='target', data=df1)\nplt.xlabel('+\/- CAD')\nplt.show()","8b3c9c37":"df1.dtypes","c27a2743":"dummy_cols = ['sex', 'cp', 'fbs', 'restecg', 'exang', 'slope', 'ca', 'thal']","95c19e69":"df2 = pd.get_dummies(data = df1, columns = dummy_cols, drop_first =  True)","3ae5227c":"df2.head()","2c8f0487":"#define X and y\nX = df2.drop('target', axis = 1)\ny = df2['target']","7e8f2d77":"#split the data\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.2, random_state = 42, stratify = y)","82ba9d80":"#scale the data\nscaler = MinMaxScaler()\nX_train = scaler.fit_transform(X_train)\nX_test = scaler.transform(X_test)","972ad352":"model_logreg = LogisticRegression(max_iter=3500, C=1)\nmodel_SVC=SVC(kernel='rbf', C=5, gamma='auto')\nmodel_rfc=RandomForestClassifier(n_estimators=100, max_depth = 5)\nmodel_gbc=GradientBoostingClassifier(learning_rate=0.1, max_depth=3)\nmodel_xgb=XGBClassifier(use_label_encoder=False, eval_metric='mlogloss', n_estimators=100, learning_rate=0.5, max_depth=3)\n\n#create a list of the model objects to be used in the for loop below\nmodels=[model_logreg, model_SVC, model_rfc, model_gbc, model_xgb]\n\n#an empty dictionary for storing average model metric data\nscore_dict = {'Logistic Regression':{},\n              'Support Vector':{},\n              'Random Forest':{},\n              'Gradient Boost':{},\n              'XG Boost':{}\n             }\n\n#following function inserts model metrics into the score_dict dictionary\ndef score_dict_edit (model):\n    score_dict[model]['Model accuracy']=np.mean(accuracy_scores)\n    score_dict[model]['CAD_precision']=np.mean(precision_scores)\n    score_dict[model]['CAD_recall']=np.mean(recall_scores)\n    score_dict[model]['CAD_F1']=np.mean(f1_scores)\n    \n    \n    \nfor model in models: \n    #create empty lists to store the different testing metrics\n    accuracy_scores =[]\n    precision_scores = []\n    recall_scores = []\n    f1_scores = []\n    \n    model.fit(X_train, y_train)\n    predict = model.predict(X_test)\n    accuracy_scores.append(accuracy_score(y_test, predict))\n    precision_scores.append(precision_score(y_test, predict, average=None)[1])\n    recall_scores.append(recall_score(y_test, predict, average=None)[1])\n    f1_scores.append(f1_score(y_test, predict, average=None)[1])\n    \n\n    if model==model_logreg:\n        score_dict_edit ('Logistic Regression')\n    elif model==model_SVC:\n        score_dict_edit ('Support Vector')\n    elif model==model_rfc:\n        score_dict_edit ('Random Forest')\n    elif model==model_gbc:\n        score_dict_edit ('Gradient Boost')\n    else:\n        score_dict_edit ('XG Boost')\n        \nprint('Following table summarizes the model accuracy and metrics for correctly classifying patients with CAD')\ndf_data=pd.DataFrame(score_dict).transpose()\ndf_data\n","da2d1e87":"### 3) Correlation Heat Map","b172e5fb":"# Data Modeling\nModels tested include Logistic Regression, Random Forest Classifier, Support Vector Machine, Gradient Boosting Classifier and XGBoost Classifier","f2883fc8":"# Create Dummy Columns","76a5b54d":"The age distribution is similar for males (mean age approx. 54 ys) and females (mean age approx 56 years) but a greater proportion, almost twice as many, of the patients in the dataset are males.","5a8673fc":"# Introduction   \n   \nThe following dataset contains various measured parameters from patients undergoing angiography which is clinical test used to visualize blood vessels in the body including the heart. In these patients, angiography was used to determine the narrowing of coronary arteries that supply blood to the cardiac muscle. Those with artery narrowing are deemed to have coronary artery disease (Detrano et. al.).     \nThe purpose of this notebook is to take a closer look at this relatively small dataset and then establish a machine learning model that can correctly predict coronary artery disease (CAD). Predictions from such a model can then be corroborated with angiograms, if possible, to do so in a timely manner so that an appropriate line of treatment can be initiated without delay.   ","9bbadc68":"# Train\/test Split the Data","977bd4c1":"### 2) Blood pressure","d327e6ca":"### 5) Chest Pain Type Associated with CAD\nChest pain (angina) of all types is associated with the presence of heart disease.","de79a4a4":"### 8) Number of Patients in Each Group\nThe patient groups are more or less balanced. Therefore we will proceed with the preparing the data for modeling.","63cd4f10":"All the models tested performed fairly well without hyperparameter tuning. Logistic regression and SVM, performed the best with impressive (~ 90%) recall scores for correctly classifying CAD class.","1268acd7":"### Feature Description  \n\n1) age  \n2) sex (1 = male, 0 = female)  \n3) cp -chest pain type (4 values: 0: asymptomatic, 1: atypical angina, 2: non-anginal pain, 3: typical angina)  \n4) trestbps - resting blood pressure (mm Hg on admission to the hospital)  \n5) chol - serum cholestoral in mg\/dl  \n6) fbs - fasting blood sugar (> 120 mg\/dl, 1 = true; 0 = false)  \n7) restecg - resting electrocardiographic results (value 0: showing probable or definite left ventricular hypertrophy by Estes\u2019 criteria, Value 1: normal, value 2: having ST-T wave abnormality (T wave inversions and\/or ST elevation or depression of > 0.05 mV))  \n8) thalach - maximum heart rate achieved  \n9) exang - exercise induced angina (1 = yes; 0 = no)  \n10) oldpeak - ST depression induced by exercise relative to rest  \n11) slope - the slope of the peak exercise ST segment  (0: downsloping; 1: flat; 2: upsloping)  \n12) ca - number of major vessels (0-3) colored by flourosopy  \n13) thal: A blood disorder called thalassemia Value 0: NULL (dropped from the dataset previously), Value 1: fixed defect (no blood flow in some part of the heart), Value 2: normal blood flow, Value 3: reversible defect (a blood flow is observed but it is not normal)  \n14) Target - Coronary Artery Disease - CAD (0 = no, 1= yes)  ","4b91e73e":"# Reference\n\nDetrano, R., Janosi, A., Steinbrunn, W., Pfisterer, M., Schmid, J., Sandhu, S., Guppy, K., Lee, S., & Froelicher, V. (1989). International application of a new probability algorithm for the diagnosis of coronary artery disease, American Journal of Cardiology, 64,304-310.","a39beccd":"# Concluding Remarks\n1) Despite the small size of the dataset, we were able to establish a machine learning model for predicting coronary artery disease (CAD) in patients using parameters (features) that can be easily determined in a hospital setting.  \n2) Models using Logistic Regression or Support Vector Machine algorithms performed exceptionally well in predicting patients with CAD. Due to the satisfactory outcome, no effort was made to eliminate any of the features. As a matter of fact, other kagglers have noted that the model performances do not improve upon removing features, perhaps indicating that all the features play an important role in the models' predictive capabilities.  \n3) Presence of other risk factors that can be associated with CAD include smoking, diabetes, obesity and family history of CAD. Inclusion of this information in the dataset may have improved the predictive capabilities of the model.","05184d8e":"### 6) ECG Abnormalities Associated with CAD\nDuring exercise testing, an upward ST slope is present in a large proportion of those with CAD. A downward slope is less commonly observed in those with CAD but more common in those without.","ddc16edd":"There are no strong positive or negative correlations with within various features. The best positive correlations are between target and max heart rate achieved (thalarch) and chest pain type (cp). The strongest negative correlations are between target and exercise induced angina (exang) and ST segment depression due to exercise (oldpeak). Let's take a closer look at these features and how they may differ between the patient groups.","63a28352":"Strangely, though it is considered a strong associated risk factor, the mean blood pressure is slightly lower in those diagnosed with CAD compared to those who were not. The mean blood pressure in both groups exceed 120 mm Hg and can be considered elevated. The histogram below illustrates blood pressure distribution in the patient groups.","8ca4ad34":"### 7) Serum Cholesterol Levels\nSerum cholesterol is not very different between those with or without CAD. This is surprising since high cholesterol levels is strong risk factor for developing coronary artery disease. Since it is not clear what the bad cholesterol (LDL - low density lipoprotein) and good cholesterol (HDL - high density lipoprotein) levels are, we will assume that we cannot draw firm conclusions based on this data alone. It is however interesting to note is that the cholesterol levels are elevated in both groups. Ideal total cholesterol levels are 200 mg\/dL or lower (https:\/\/www.healthline.com\/health\/high-cholesterol\/levels-by-age). It is possible in the presence of elevated total serum cholesterol; some patients are more prone to developing CAD than others.","1385a39c":"# EDA\n### 1) Age distribution ","f5a13f18":"### 4) Maximum Heart Rate Achieved in Patients with CAD"}}