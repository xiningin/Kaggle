{"cell_type":{"4205c20a":"code","b0fb78ff":"code","39771b37":"code","282445c5":"code","e1ddeab7":"code","bba4a99d":"code","bc3b1424":"code","af71933d":"code","3a38adcd":"code","b5c3a710":"code","44b1624e":"code","a5646de8":"code","14ad8155":"code","bdba6f13":"code","ff52f383":"code","eff44978":"code","9611edd1":"code","8548c25f":"code","7585ca8f":"code","b9a634db":"code","66299001":"code","7cfac823":"markdown","1a7a8093":"markdown","334288bd":"markdown","05c1e4a8":"markdown","569096c1":"markdown","12b70a6d":"markdown","68eefe2a":"markdown","33d5a00f":"markdown","e796979a":"markdown","231dccbe":"markdown","38a77e24":"markdown","4a47dd18":"markdown","b2b8087f":"markdown","00c2487f":"markdown","51fe2ef6":"markdown","b49455c8":"markdown","e46672e6":"markdown","89626669":"markdown"},"source":{"4205c20a":"import numpy as np\nimport pandas as pd\n\nimport matplotlib.pyplot as plt; plt.style.use('ggplot')\nimport seaborn as sns\nimport plotly.express as px\n\n%matplotlib inline\n\npx.defaults.template = 'plotly_dark'\n# px.defaults.template = 'ggplot2'","b0fb78ff":"plt.rcParams['figure.dpi'] = 100","39771b37":"# filename_pattern = 'https:\/\/raw.githubusercontent.com\/CSSEGISandData\/COVID-19\/master\/csse_covid_19_data\/csse_covid_19_time_series\/time_series_19-covid-{}.csv'\n# filename_pattern = 'COVID-19-master\/csse_covid_19_data\/csse_covid_19_time_series\/time_series_19-covid-{}.csv'\nfilename_pattern = \"..\/input\/novel-corona-virus-2019-dataset\/time_series_covid_19_{}.csv\"\n\nconfirmed = pd.read_csv(filename_pattern.format('confirmed')).set_index(['Province\/State','Country\/Region', 'Lat', 'Long'])\nrecovered = pd.read_csv(filename_pattern.format('recovered')).set_index(['Province\/State','Country\/Region', 'Lat', 'Long'])\ndeaths = pd.read_csv(filename_pattern.format('deaths')).set_index(['Province\/State','Country\/Region', 'Lat', 'Long'])\n\nprint(f'Dates: From {confirmed.columns[0]} to {confirmed.columns[-1]}.')\nconfirmed","282445c5":"covid = pd.concat([pd.read_csv(filename_pattern.format(name.lower())) \\\n                       .melt(id_vars=['Province\/State','Country\/Region', 'Lat', 'Long'], var_name='Date', value_name=name) \\\n                       .set_index(['Province\/State','Country\/Region', 'Lat', 'Long', 'Date'])\n                   for name in ['Confirmed', 'Recovered', 'Deaths']], axis=1).reset_index() \\\n    .assign(Infected=lambda df: df['Confirmed']-df['Recovered']-df['Deaths'])\ncovid['Date'] = pd.to_datetime(covid['Date'])\ncovid['Country\/Region'] = covid['Country\/Region'].replace({\n    'Mainland China': 'China',\n    'Republic of Korea': 'Korea, South',\n    'Iran (Islamic Republic of)': 'Iran',\n})\n\ncovid","e1ddeab7":"covid_world = covid.groupby('Date')[['Confirmed', 'Recovered', 'Deaths', 'Infected']].sum()\ncovid_world.iloc[[-1]].style.format('{:,}')","bba4a99d":"df = covid_world.reset_index().melt(id_vars='Date', var_name='Status', value_name='Subjects')\npx.line(df, 'Date', 'Subjects', color='Status', title='World wide trends')","bc3b1424":"covid_world.iloc[[-1]].assign(\n        RecoveryRate=lambda df: df['Recovered']\/df['Confirmed'], \n        DeathRate=lambda df: df['Deaths']\/df['Confirmed']) \\\n    .style.format('{:,}').format('{:.2%}', subset=['RecoveryRate', 'DeathRate'])","af71933d":"country = confirmed.groupby(['Country\/Region']).sum()\n# country","3a38adcd":"latest_confirmed = country[country.columns[-1]].sort_values(ascending=False).astype(int).to_frame('Confirmed').reset_index()\ndisplay(latest_confirmed.nlargest(20, 'Confirmed').style.format('{:,}', subset='Confirmed'))\npx.bar(latest_confirmed.nlargest(20, 'Confirmed'), x='Country\/Region', y='Confirmed')","b5c3a710":"covid_countries = covid.groupby(['Country\/Region', 'Date'])['Confirmed', 'Recovered', 'Deaths', 'Infected'].sum()\ncovid_countries","44b1624e":"# countries = ['Mainland China', 'Republic of Korea', 'Italy', 'Iran (Islamic Republic of)', 'US', 'Israel']\n\nimport re\ncountries = [c for c in covid['Country\/Region'].unique() \n             if re.search(r'China|Korea, South|Italy|Iran|US|Israel', c)]\nprint(f'Countries of interest: {countries}')","a5646de8":"covid_countries_long = covid_countries.reset_index().melt(id_vars=['Date', 'Country\/Region'], var_name='Status', value_name='Subjects')\n\nfig = px.line(covid_countries_long[covid_countries_long['Country\/Region'].isin(countries)], 'Date', 'Subjects', \n              color='Status', facet_col='Country\/Region', \n              facet_col_wrap=2, height=600)\nfig.update_yaxes(matches=None, showticklabels=True)\n# fig.update_layout(legend_orientation=\"h\")","14ad8155":"fig = px.scatter(covid_countries_long[covid_countries_long['Country\/Region'].isin(countries)], 'Date', 'Subjects',\n                 color='Status', facet_col='Country\/Region', \n                 facet_col_wrap=2, log_y=True, height=600)\nfig.update_yaxes(matches=None, showticklabels=True)\nfig.update_traces(mode='lines+markers', line=dict(width=.5))\n# fig.update_layout(legend_orientation=\"h\")\nfig.update_xaxes(range=['2020-02-20', '2020-03-12'])\n","bdba6f13":"top_countries = covid_countries_long[(covid_countries_long['Country\/Region'].isin(latest_confirmed.nlargest(10, 'Confirmed')['Country\/Region'][1:])) &\n                 (covid_countries_long['Status']=='Confirmed')] \\\n    .rename({'Subjects': 'Confirmed'}, axis=1)\n\nfig = px.scatter(top_countries, 'Date', 'Confirmed', color='Country\/Region', \n                 log_y=True, height=600)\nfig.update_traces(mode='lines+markers', line=dict(width=.5))\nfig.update_layout(title='Exponential growth in the top ten most-affected countries (except China)')","ff52f383":"diffs = covid_countries.reset_index().groupby('Country\/Region') \\\n    .apply(lambda g: g.sort_values('Date').assign(Diff=g['Infected'].diff())).reset_index(drop=True)\ndisplay(diffs.head())\n\nfig = px.line(diffs[diffs['Country\/Region'].isin(countries)], x='Date', y='Diff', color='Country\/Region')\nfig","eff44978":"recent_diffs = diffs.pivot_table(index='Date', columns='Country\/Region', values='Diff').tail(7).mean()\n\nxaxes_range = [diffs['Date'].max() - pd.DateOffset(weeks=2), diffs['Date'].max()]\n\ndf = recent_diffs.nlargest(10)\ndisplay(df.to_frame('Daily Diff').T.style.format('{:+,.2f}'))\nfig = px.line(diffs[diffs['Country\/Region'].isin(df.index)],\n              x='Date', y='Diff', color='Country\/Region')\nfig.update_xaxes(range=xaxes_range)\ndisplay(fig)\n\ndf = recent_diffs[recent_diffs<0].nsmallest(10)\ndisplay(df.to_frame('Daily Diff').T.style.format('{:+,.2f}'))\nfig = px.line(diffs[diffs['Country\/Region'].isin(df.index)],\n              x='Date', y='Diff', color='Country\/Region')\nfig.update_xaxes(range=xaxes_range)\ndisplay(fig)","9611edd1":"diffs[diffs['Country\/Region']=='Italy'].tail(10) \\\n    .style.format({'Diff':'{:+,}'}).background_gradient('Reds', subset=['Confirmed', 'Diff'])","8548c25f":"rates = covid_countries.assign(\n    RecoveryRate=lambda df: df['Recovered']\/df['Confirmed'], \n    DeathRate=lambda df: df['Deaths']\/df['Confirmed'])\n\nrates.reset_index().groupby('Country\/Region').tail(1) \\\n    .set_index(['Country\/Region', 'Date']).loc[countries] \\\n    .sort_values('Infected', ascending=False) \\\n    .style.format('{:,}').format('{:.2%}', subset=['RecoveryRate', 'DeathRate']) \\\n    .background_gradient(subset='RecoveryRate', cmap='Greens') \\\n    .background_gradient(subset='DeathRate', cmap='Reds')","7585ca8f":"df = rates.reset_index().melt(id_vars=['Date', 'Country\/Region'], var_name='Status', value_name='Subjects')\ndf = df[df['Status'].isin(['RecoveryRate', 'DeathRate'])]\n        \nfig = px.line(df[df['Country\/Region'].isin(countries)], 'Date', 'Subjects', color='Status', \n        facet_col='Country\/Region', facet_col_wrap=3,\n        height=600)\nfig","b9a634db":"china_latest = covid[covid['Country\/Region']=='China'].groupby(['Province\/State']).tail(1)\n\nchina_latest.sort_values('Confirmed', ascending=False) \\\n    .style.background_gradient(cmap='Pastel1_r', subset=['Confirmed', 'Recovered', 'Deaths', 'Infected'])","66299001":"fig = px.scatter_geo(china_latest.assign(LogConfirmed=lambda df: np.log(df['Confirmed'])),\n                     lat='Lat', lon='Long', size='LogConfirmed', color='Confirmed', hover_name='Province\/State', \n                     hover_data=['Confirmed', 'Recovered'],\n                     scope='asia')\nfig.update_geos(fitbounds=\"locations\")\nfig.update_geos(\n    resolution=50,\n    showcoastlines=True, coastlinecolor=\"RebeccaPurple\",\n    showland=True, landcolor=\"LightGreen\",\n    showocean=True, oceancolor=\"LightBlue\",\n    showlakes=True, lakecolor=\"Blue\",\n    showrivers=True, rivercolor=\"Blue\"\n)\n# fig.update_layout(height=300, margin={\"r\":0,\"t\":0,\"l\":0,\"b\":0})\n","7cfac823":"## Country-level trends","1a7a8093":"### The Good, the Bad, and the Ugly\n\nLet's first try to na\u00efvely divide all countries into two: those who are still experiencing a daily increase of COVID-19 cases, and those who have already transformed to the healthy dynamics of reducing the numbers.","334288bd":"This is intriguing in many aspects. To name a few:\n1. The unique point in time where the disease outbreak is highly prominent.\n2. The exponential and very high (x10) growth rate seems univeral across countries.\n3. _(2020-03-13)_ Again, Korea is starting to succesfully reduce its COVID-19 growth rate.\n\n(@TODO: quantify the exponent.)","05c1e4a8":"Let's transform the three tables into a single one.","569096c1":"<img src='https:\/\/www.who.int\/about\/Logo-WHO.jpg' style='width:300px; float:right'\/>\n\n## The Data\n\nThe data originates from the daily [Coronavirus disease (COVID-2019) situation reports](https:\/\/www.who.int\/emergencies\/diseases\/novel-coronavirus-2019\/situation-reports) of World Health Organization. The Johns Hopkins University have transform the reports into a structured dataset available on their [GitHub repository](https:\/\/github.com\/CSSEGISandData\/COVID-19\/tree\/master\/csse_covid_19_data\/csse_covid_19_time_series).\n\nLoad (and clean) the dataset.","12b70a6d":"## References\n\nData\n* [Coronavirus disease (COVID-2019) situation reports](https:\/\/www.who.int\/emergencies\/diseases\/novel-coronavirus-2019\/situation-reports) by World Health Organization.\n* [GitHub data repository](https:\/\/github.com\/CSSEGISandData\/COVID-19\/tree\/master\/csse_covid_19_data\/csse_covid_19_time_series) by Johns Hopkins.\n\nDashboards\n* [Coronavirus COVID-19 (2019-nCoV)](https:\/\/gisanddata.maps.arcgis.com\/apps\/opsdashboard\/index.html#\/bda7594740fd40299423467b48e9ecf6) @gisanddata\n* [Coronavirus Update (Live)](https:\/\/www.worldometers.info\/coronavirus\/) @worldmeters\n* https:\/\/www.technologyreview.com\/s\/615330\/best-worst-coronavirus-dashboards\/\n\nBlogs\n* TBD","68eefe2a":"As a start, we can focus on a few countries of interest","33d5a00f":"A recovery rate of 71% in China? can it be so?\n\nWell, at least according to China's health officials statement from the [2020-03-01](http:\/\/www.xinhuanet.com\/english\/2020-03\/01\/c_138832732.htm) it is not far fetched..\n> _The proportion of Chinese patients who recovered from the novel coronavirus disease (COVID-19) and were discharged from hospitals continued to rise in the past week to reach 52.1 percent, a health official said on Sunday._\n\nAnd, as a second WOW, Korea's statistics might hint that a good treatment can substantially reduce the death rate.","e796979a":"Let's see the currenly most-affected countries","231dccbe":"And, up to now, what are the computed recovery and death rates?","38a77e24":"## Appendix A - Map of China's Latest Numbers","4a47dd18":"About x10 per week!\n\nLet's see it on the top ten most-affected countries.","b2b8087f":"### Recovery and Death Rates","00c2487f":"Except for China, who seems to have reached a stable state with the number of confirmed COVID-19 cases (and even a **reduction** in the net infected subjects), all of the rest are still on their steeply increasing stage (Korea looks on a good direction, though). \n\nSo, what is the growth rate? Let's switch to a log scale.","51fe2ef6":"## World-wide trends\n\nSo, what are the updated global numbers?","b49455c8":"<div style='text-align:center; margin-bottom:40px'>\n    <img src='https:\/\/media.nature.com\/lw1024\/magazine-assets\/d41586-020-00190-6\/d41586-020-00190-6_17590322.jpg'\/>\n    The new coronavirus take its name from its crown-like halo (see <a href='https:\/\/www.nature.com\/articles\/d41586-020-00190-6'><b>nature.com<\/b><\/a>).\n<\/div>\n\n\n# Dashboarding the Coronavirus Pandemic - the Good, the Bad, and the Ugly\n---\n\nRecently, the widespread of the _New Coronavirus Disease (COVID-19)_ around the world [has reached pandemic levels](https:\/\/www.nytimes.com\/2020\/03\/11\/health\/coronavirus-pandemic-who.html), according to the World Health Organization (WHO).\n\nBut, at least from the datascience perspective, the tracking of COVID-19 seems like a good news. Complete datasets are available online and updated on a daily and hourly basis. Here, we demonstrate a basic analysis of the data from the official [Coronavirus disease (COVID-2019) situation reports](https:\/\/www.who.int\/emergencies\/diseases\/novel-coronavirus-2019\/situation-reports) published daily by World Health Organization. In short, the epidemiological data accompanied with these reports tracks the disease speard world wide, and desribes the updated number of COVID-19 cases at the country level.\n\n<img src='https:\/\/i.imgur.com\/XpGB70y.png' style='width:200px; float:right; margin-left:20px'\/>\n\nThis notebook was written with few major objectives in mind. Obviously, the first is to become better acquainted with the disease and its spreading process. Second, to demonstrate an analysis and visualization of potentially insightful points. And third, to leverage the frequent online data updates for dashboarding - i.e., pose questions that continously monitoring their answers will be beneficial.\n\nThis notebook is rather preliminary, and will monitor the following specific questions:\n\n* What are the global, world-wide, trends of infection, recovery, and death?\n* The same thing, at the country level.\n* Furthermore, we split the countries according to their current treatment effectivity. Which is getting \"healthier\", and which is still on the bad path? The Good, the Bad, and the Ugly.\n* Then, some distinctive country-level rates: recovery-rate and death-rate.\n\nFinally, some open issues and potential future directions for deeper analysis.\n\nLet's get started.","e46672e6":"## Next steps\n\n..will be written later as a first step..","89626669":"Now, let's examine the daily dynamics"}}