{"cell_type":{"ae813c91":"code","611b8288":"code","4b4da0fe":"code","3274065b":"code","5566616e":"code","87b53230":"code","075d176c":"code","8f0e9681":"code","2bb0dbbc":"code","549ef07a":"code","e97d5c87":"code","d6e0519d":"code","b36a01e1":"code","e8d2f0f8":"code","69ce69b3":"code","fdc75410":"code","6cd6c523":"code","fce53b19":"code","74b9a48e":"code","70a54b43":"code","91cbcfbb":"code","3640d6ab":"code","44ab3998":"code","993e6887":"code","362014ea":"code","42a2e3c2":"code","b6448162":"code","da8c203d":"code","bd9f763b":"code","fd16a6e4":"code","6004a5c7":"code","57f2bd05":"code","06df7d0b":"code","8fbe7756":"code","d0c50a03":"code","ac4f06a8":"code","4ed9f40c":"code","e350bd65":"code","8d5feebf":"code","c351a998":"code","3abd55cf":"code","11a75bf7":"code","25e7ea71":"code","06c9ee33":"code","2783307c":"code","ce2cc558":"code","775e8ed0":"code","657cb0b0":"code","db6f684e":"code","3e0bd1ae":"code","2b599884":"code","a81e2e70":"code","12f85e68":"code","8a8a0556":"code","12d2359a":"code","758c4e36":"code","780ed292":"code","5f9baf89":"code","4367fc7f":"code","5cc9e74c":"code","1be0d513":"code","b7bc9e17":"code","4c367dc6":"code","d843e35b":"code","04e9ce17":"code","3fd2ab3a":"code","1d44cdb4":"code","264276a5":"code","85df844b":"code","249a66ac":"code","c1dc8ed0":"code","1857ccef":"code","f62658f1":"code","f314706d":"code","ec1dafdd":"code","30d75e52":"code","77d5dc6e":"code","7d062e69":"code","fee13455":"code","2ac024bd":"code","78fe505f":"code","572c9107":"code","61146fbe":"code","aa7de290":"code","38b73dd7":"code","bccf542d":"code","59ab493e":"code","34550a20":"code","8f7e7af4":"code","3b21ade7":"code","0927d072":"code","112e94df":"code","18d73853":"code","1c323ef0":"code","670a09e4":"code","5c04fcbe":"code","fb6fe7c6":"code","59d6e7d7":"code","67da8703":"code","49214441":"code","a882529e":"code","849c568d":"code","b89486c1":"code","2e002782":"code","3f96464c":"code","3924cf6f":"code","706a6e08":"markdown","10164a71":"markdown","f7b36d1f":"markdown","979d6c18":"markdown","748cd40f":"markdown","3649c0d9":"markdown","ba7e74a2":"markdown","56e2e26c":"markdown","b3f07af5":"markdown","f2a256de":"markdown","cede8757":"markdown","5bce979b":"markdown","f0090256":"markdown","01d6bab4":"markdown","7f4cb347":"markdown","b2abb342":"markdown","3e1d088e":"markdown","9643af28":"markdown","1e76c40f":"markdown","2227788b":"markdown","199b0567":"markdown","51954bff":"markdown","ca9ad60f":"markdown","3e64ddd4":"markdown","d4176af0":"markdown","1c5621ad":"markdown","44947b8b":"markdown","24fd05af":"markdown","54ef413b":"markdown","383d8f3d":"markdown","6916d892":"markdown","e01bd1fd":"markdown","27ceae69":"markdown","64486726":"markdown"},"source":{"ae813c91":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport os\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom mpl_toolkits.basemap import Basemap\nfrom sklearn.cluster import AgglomerativeClustering\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.preprocessing import OrdinalEncoder\nprint(os.listdir(\"..\/input\"))","611b8288":"dtype = {'census_block_group': 'object', 'date_range_start': 'int', 'date_range_end':'int',\n       'raw_visit_count':'float', 'raw_visitor_count':'float', 'visitor_home_cbgs':'object',\n       'visitor_work_cbgs':'object', 'distance_from_home':'float', 'related_same_day_brand':'object',\n       'related_same_month_brand':'object', 'top_brands':'object', 'popularity_by_hour':'object',\n       'popularity_by_day':'object'}\ndata = pd.read_csv('..\/input\/visit-patterns-by-census-block-group\/cbg_patterns.csv', dtype=dtype)\ndata.info()","4b4da0fe":"data.head()","3274065b":"data = data.dropna(subset=['census_block_group'])\ndata.info()","5566616e":"data.loc[data.raw_visit_count.isna()].head()","87b53230":"data = data.dropna(subset=['raw_visitor_count'])\ndata.info()","075d176c":"data['duration'] = data['date_range_end'] - data['date_range_start']\ndata['duration_days'] = data['duration'] \/ 86400\ndata.head()","8f0e9681":"print(data.duration_days.describe())","2bb0dbbc":"dtype = {'census_block_group': 'object', 'amount_land': 'float', 'amount_water': 'float', 'latitude': 'float', 'longitude': 'float'}\ngeo = pd.read_csv('..\/input\/census-block-group-american-community-survey-data\/safegraph_open_census_data\/safegraph_open_census_data\/metadata\/cbg_geographic_data.csv',dtype=dtype)\ngeo.info()","549ef07a":"geo = geo.set_index('census_block_group')","e97d5c87":"data = data.join(geo, on='census_block_group')\ndata.info()","d6e0519d":"data = data.dropna(subset=['amount_land'])\ndata.info()","b36a01e1":"data.sort_values(by='longitude',ascending=False).head(3)","e8d2f0f8":"adj_val = data.loc[data.longitude==data.longitude.max()].longitude - 360","69ce69b3":"data.loc[data.longitude==data.longitude.max(),'longitude'] = adj_val","fdc75410":"def plot_map(data, column, alpha=0.7, colormap='coolwarm'):\n    plt.figure(figsize=(30,30))\n\n    m = Basemap(projection='lcc', \n                resolution='h',\n            lat_0=38,\n            lon_0=-101,\n                llcrnrlon=-125, llcrnrlat=20,\n                urcrnrlon=-64, urcrnrlat=47)\n\n    m.drawcoastlines(linewidth=1)\n    m.drawcountries(linewidth=2, color='blue')\n    m.drawstates()\n    m.drawmapboundary()\n    \n    lons = data[\"longitude\"].values.tolist()\n    lats = data[\"latitude\"].values.tolist()\n\n    # Draw scatter plot with all CBGs\n    x,y = m(lons, lats)\n    m.scatter(x, y, c=data[column], alpha=alpha, cmap=colormap, s=4)\n    m.colorbar(location=\"bottom\", pad=\"4%\")\n    \n    plt.show()","6cd6c523":"plot_map(data,'raw_visit_count')","fce53b19":"cluster_data = data.loc[:,['latitude','longitude']]","74b9a48e":"c_sample = cluster_data.sample(frac=0.2, random_state=100)\nHC = AgglomerativeClustering(n_clusters=12,linkage='ward')\nc_sample_label = HC.fit_predict(c_sample[['latitude','longitude']])","70a54b43":"c_sample['label_HC'] = c_sample_label\nc_sample['label_HC'] = c_sample['label_HC'].astype(int)\nc_sample.plot(x='longitude',y='latitude', c='label_HC', kind='scatter', colormap='Paired', s=3, figsize=(20,10))\nplt.show()","91cbcfbb":"from sklearn.ensemble import RandomForestClassifier","3640d6ab":"RF = RandomForestClassifier(random_state=100)\nRF.fit(c_sample[['latitude','longitude']], c_sample['label_HC'])","44ab3998":"cluster_data['label'] = RF.predict(cluster_data)","993e6887":"cluster_data.plot(x='longitude',y='latitude', c='label', kind='scatter', colormap='Paired', s=3, figsize=(20,10))\nplt.show()","362014ea":"data = pd.concat([data, cluster_data['label']], axis=1)","42a2e3c2":"plot_map(data,'label', colormap='Paired', alpha=0.9)","b6448162":"data['top_brands'] = data.top_brands.map(lambda x:eval(x))","da8c203d":"brand_dict = {}\nfor x in data.top_brands:\n    for y in x:\n        if y.lower() in brand_dict.keys():\n            brand_dict[y.lower()] += 1\n        else:\n            brand_dict[y.lower()] = 1","bd9f763b":"top_10_pop = pd.Series(brand_dict).sort_values().tail(10)\ntop_10_pop.plot(kind='barh', color='darkblue', alpha=0.5)\nplt.title('Top 10 Brands across all CBGs')\nplt.show()","fd16a6e4":"(top_10_pop\/pd.Series(brand_dict).sum()).plot(kind='barh', color='darkblue', alpha=0.5)\nplt.title('Top 10 Brands across all CBGs')\nplt.xlabel('Percent of total count')\nplt.show()","6004a5c7":"brand_cluster = {}\nfor label in data.label.unique():\n    brand_cluster[label] = {}\n    for x in data.loc[data.label==label].top_brands:\n        for y in x:\n            if y.lower() in brand_cluster[label].keys():\n                brand_cluster[label][y.lower()] += 1\n            else:\n                brand_cluster[label][y.lower()] = 1","57f2bd05":"labels = [0, 1, 2, 3, 7, 8, 11]\nfig, ax = plt.subplots(nrows=len(labels), figsize=(5,20), sharex='all')\n\nfor i, label in enumerate(labels):\n    \n    top_5_pop = pd.Series(brand_cluster[label]).sort_values().tail(5)\n    \n    ax[i].barh(top_5_pop.index, top_5_pop.values\/pd.Series(brand_cluster[label]).sum(), color='darkblue', alpha=0.5)\n    \n    ax[i].set_title('Top 5 brands for Cluster {}'.format(label), loc='left')\n    \n    if i == len(labels)-1:\n        ax[i].set_xlabel('Percent of total occurrence')\n\nplt.show()","06df7d0b":"labels = [10]\nfig, ax = plt.subplots(nrows=len(labels), figsize=(5,2.5), sharex='all')\n\nfor i, label in enumerate(labels):\n    \n    top_5_pop = pd.Series(brand_cluster[label]).sort_values().tail(5)\n    \n    ax.barh(top_5_pop.index, top_5_pop.values\/pd.Series(brand_cluster[label]).sum(), color='darkblue', alpha=0.5)\n    \n    ax.set_title('Top 5 brands for Cluster {}'.format(label), loc='left')\n    \n    ax.set_xlabel('Percent of total occurrence')\n\nplt.show()","8fbe7756":"labels = [4, 5, 6, 9]\nfig, ax = plt.subplots(nrows=len(labels), figsize=(5,10), sharex='all')\n\nfor i, label in enumerate(labels):\n    \n    top_5_pop = pd.Series(brand_cluster[label]).sort_values().tail(5)\n    \n    ax[i].barh(top_5_pop.index, top_5_pop.values\/pd.Series(brand_cluster[label]).sum(), color='darkblue', alpha=0.5)\n    \n    ax[i].set_title('Top 5 brands for Cluster {}'.format(label), loc='left')\n    \n    if i == len(labels)-1:\n        ax[i].set_xlabel('Percent of total occurrence')\n\nplt.show()","d0c50a03":"data['related_same_day_brand'] = data.related_same_day_brand.map(lambda x:eval(x))","ac4f06a8":"brand_day_dict = {}\nfor x in data.related_same_day_brand:\n    for y in x:\n        if y.lower() in brand_day_dict.keys():\n            brand_day_dict[y.lower()] += 1\n        else:\n            brand_day_dict[y.lower()] = 1","4ed9f40c":"top_10_pop_day = pd.Series(brand_day_dict).sort_values().tail(10)\ntop_10_pop_day.plot(kind='barh', color='darkblue', alpha=0.5)\nplt.title('Top 10 Related Day Brands across all CBGs')\nplt.show()","e350bd65":"(top_10_pop_day\/pd.Series(brand_day_dict).sum()).plot(kind='barh', color='darkblue', alpha=0.5)\nplt.title('Top 10 Related Day Brands across all CBGs')\nplt.xlabel('Percent of total count')\nplt.show()","8d5feebf":"brand_cluster_day = {}\nfor label in data.label.unique():\n    brand_cluster_day[label] = {}\n    for x in data.loc[data.label==label].related_same_day_brand:\n        for y in x:\n            if y.lower() in brand_cluster_day[label].keys():\n                brand_cluster_day[label][y.lower()] += 1\n            else:\n                brand_cluster_day[label][y.lower()] = 1","c351a998":"labels = [0,1,11]\nfig, ax = plt.subplots(nrows=len(labels), figsize=(5,10), sharex='all')\n\nfor i, label in enumerate(labels):\n    \n    top_5_pop = pd.Series(brand_cluster_day[label]).sort_values().tail(5)\n    \n    ax[i].barh(top_5_pop.index, top_5_pop.values\/pd.Series(brand_cluster_day[label]).sum(), color='darkblue', alpha=0.5)\n    \n    ax[i].set_title('Top 5 brands for Cluster {}'.format(label), loc='left')\n    \n    if i == len(labels)-1:\n        ax[i].set_xlabel('Percent of total occurrence')\n\nplt.show()","3abd55cf":"labels = [4,8,10]\nfig, ax = plt.subplots(nrows=len(labels), figsize=(5,10), sharex='all')\n\nfor i, label in enumerate(labels):\n    \n    top_5_pop = pd.Series(brand_cluster_day[label]).sort_values().tail(5)\n    \n    ax[i].barh(top_5_pop.index, top_5_pop.values\/pd.Series(brand_cluster_day[label]).sum(), color='darkblue', alpha=0.5)\n    \n    ax[i].set_title('Top 5 brands for Cluster {}'.format(label), loc='left')\n    \n    if i == len(labels)-1:\n        ax[i].set_xlabel('Percent of total occurrence')\n\nplt.show()","11a75bf7":"labels = [3,7,9]\nfig, ax = plt.subplots(nrows=len(labels), figsize=(5,10), sharex='all')\n\nfor i, label in enumerate(labels):\n    \n    top_5_pop = pd.Series(brand_cluster_day[label]).sort_values().tail(5)\n    \n    ax[i].barh(top_5_pop.index, top_5_pop.values\/pd.Series(brand_cluster_day[label]).sum(), color='darkblue', alpha=0.5)\n    \n    ax[i].set_title('Top 5 brands for Cluster {}'.format(label), loc='left')\n    \n    if i == len(labels)-1:\n        ax[i].set_xlabel('Percent of total occurrence')\n\nplt.show()","25e7ea71":"labels = [2,5,6]\nfig, ax = plt.subplots(nrows=len(labels), figsize=(5,10), sharex='all')\n\nfor i, label in enumerate(labels):\n    \n    top_5_pop = pd.Series(brand_cluster_day[label]).sort_values().tail(5)\n    \n    ax[i].barh(top_5_pop.index, top_5_pop.values\/pd.Series(brand_cluster_day[label]).sum(), color='darkblue', alpha=0.5)\n    \n    ax[i].set_title('Top 5 brands for Cluster {}'.format(label), loc='left')\n    \n    if i == len(labels)-1:\n        ax[i].set_xlabel('Percent of total occurrence')\n\nplt.show()","06c9ee33":"data['related_same_month_brand'] = data.related_same_month_brand.map(lambda x:eval(x))\n\nbrand_month_dict = {}\nfor x in data.related_same_month_brand:\n    for y in x:\n        if y.lower() in brand_month_dict.keys():\n            brand_month_dict[y.lower()] += 1\n        else:\n            brand_month_dict[y.lower()] = 1","2783307c":"top_10_pop_month = pd.Series(brand_month_dict).sort_values().tail(10)\ntop_10_pop_month.plot(kind='barh', color='darkblue', alpha=0.5)\nplt.title('Top 10 Related Month Brands across all CBGs')\nplt.show()","ce2cc558":"(top_10_pop_month\/pd.Series(brand_month_dict).sum()).plot(kind='barh', color='darkblue', alpha=0.5)\nplt.title('Top 10 Related Month Brands across all CBGs')\nplt.xlabel('Percent of total count')\nplt.show()","775e8ed0":"brand_cluster_month = {}\nfor label in data.label.unique():\n    brand_cluster_month[label] = {}\n    for x in data.loc[data.label==label].related_same_month_brand:\n        for y in x:\n            if y.lower() in brand_cluster_month[label].keys():\n                brand_cluster_month[label][y.lower()] += 1\n            else:\n                brand_cluster_month[label][y.lower()] = 1","657cb0b0":"labels = np.arange(12)\nfig, ax = plt.subplots(nrows=len(labels), figsize=(5,30), sharex='all')\n\nfor i, label in enumerate(labels):\n    \n    top_5_pop = pd.Series(brand_cluster_month[label]).sort_values().tail(5)\n    \n    ax[i].barh(top_5_pop.index, top_5_pop.values\/pd.Series(brand_cluster_month[label]).sum(), color='darkblue', alpha=0.5)\n    \n    ax[i].set_title('Top 5 brands for Cluster {}'.format(label), loc='left')\n    \n    if i == len(labels)-1:\n        ax[i].set_xlabel('Percent of total occurrence')\n\nplt.show()","db6f684e":"labels=np.arange(12)\ntop_day = {}\nfor i, label in enumerate(labels):\n    \n    top_day[label] = [key for key, value in brand_cluster_day[label].items() if value == max(brand_cluster_day[label].values())][0]\n\ntop_month = {}\nfor i, label in enumerate(labels):\n    \n    top_month[label] = [key for key, value in brand_cluster_month[label].items() if value == max(brand_cluster_month[label].values())][0]","3e0bd1ae":"data['top_related_day'] = data.label.map(lambda x: top_day[x])\ndata['top_related_month'] = data.label.map(lambda x: top_month[x])","2b599884":"OE = OrdinalEncoder()\ndata['top_day_encoded'] = OE.fit_transform(np.array(data['top_related_day']).reshape(-1,1))\ndata['top_month_encoded'] = OE.fit_transform(np.array(data['top_related_month']).reshape(-1,1))","a81e2e70":"plot_map(data, 'top_day_encoded', colormap='Paired')","12f85e68":"plot_map(data, 'top_month_encoded', colormap='Paired')","8a8a0556":"data['number_of_top_brand'] = data.top_brands.map(len)\ndata['number_of_related_day_brand'] = data.related_same_day_brand.map(len)\ndata['number_of_related_month_brand'] = data.related_same_month_brand.map(len)","12d2359a":"data['intersection_day_top_brand'] = data.apply(lambda x: list(set(x.related_same_day_brand)&set(x.top_brands)), axis=1)","758c4e36":"data['intersection_month_top_brand'] = data.apply(lambda x: list(set(x.related_same_month_brand)&set(x.top_brands)), axis=1)","780ed292":"brand_day_dict_intersect = {}\nfor x in data.intersection_day_top_brand:\n    for y in x:\n        if y.lower() in brand_day_dict_intersect.keys():\n            brand_day_dict_intersect[y.lower()] += 1\n        else:\n            brand_day_dict_intersect[y.lower()] = 1\n            \nbrand_month_dict_intersect = {}\nfor x in data.intersection_month_top_brand:\n    for y in x:\n        if y.lower() in brand_month_dict_intersect.keys():\n            brand_month_dict_intersect[y.lower()] += 1\n        else:\n            brand_month_dict_intersect[y.lower()] = 1","5f9baf89":"top_10_pop_day_int = pd.Series(brand_day_dict_intersect).sort_values().tail(10)\ntop_10_pop_day_int.plot(kind='barh', color='darkblue', alpha=0.5)\nplt.title('Top 10 Popular and Related Day Brands across all CBGs')\nplt.show()","4367fc7f":"(top_10_pop_day_int\/pd.Series(brand_day_dict_intersect).sum()).plot(kind='barh', color='darkblue', alpha=0.5)\nplt.title('Top 10 Popular and Related Day Brands across all CBGs')\nplt.xlabel('Percent of total count')\nplt.show()","5cc9e74c":"brand_cluster_day_int = {}\nfor label in data.label.unique():\n    brand_cluster_day_int[label] = {}\n    for x in data.loc[data.label==label].intersection_day_top_brand:\n        for y in x:\n            if y.lower() in brand_cluster_day_int[label].keys():\n                brand_cluster_day_int[label][y.lower()] += 1\n            else:\n                brand_cluster_day_int[label][y.lower()] = 1","1be0d513":"labels = np.arange(12)\nfig, ax = plt.subplots(nrows=len(labels), figsize=(5,30), sharex='all')\n\nfor i, label in enumerate(labels):\n    \n    top_5_pop = pd.Series(brand_cluster_day_int[label]).sort_values().tail(5)\n    \n    ax[i].barh(top_5_pop.index, top_5_pop.values\/pd.Series(brand_cluster_day_int[label]).sum(), color='darkblue', alpha=0.5)\n    \n    ax[i].set_title('Top 5 brands for Cluster {}'.format(label), loc='left')\n    \n    if i == len(labels)-1:\n        ax[i].set_xlabel('Percent of total occurrence')\n\nplt.show()","b7bc9e17":"top_10_pop_month_int = pd.Series(brand_month_dict_intersect).sort_values().tail(10)\ntop_10_pop_month_int.plot(kind='barh', color='darkblue', alpha=0.5)\nplt.title('Top 10 Popular and Related Month Brands across all CBGs')\nplt.show()","4c367dc6":"(top_10_pop_month_int\/pd.Series(brand_month_dict_intersect).sum()).plot(kind='barh', color='darkblue', alpha=0.5)\nplt.title('Top 10 Popular and Related Month Brands across all CBGs')\nplt.xlabel('Percent of total count')\nplt.show()","d843e35b":"brand_cluster_month_int = {}\nfor label in data.label.unique():\n    brand_cluster_month_int[label] = {}\n    for x in data.loc[data.label==label].intersection_month_top_brand:\n        for y in x:\n            if y.lower() in brand_cluster_month_int[label].keys():\n                brand_cluster_month_int[label][y.lower()] += 1\n            else:\n                brand_cluster_month_int[label][y.lower()] = 1","04e9ce17":"labels = np.arange(12)\nfig, ax = plt.subplots(nrows=len(labels), figsize=(5,30), sharex='all')\n\nfor i, label in enumerate(labels):\n    \n    top_5_pop = pd.Series(brand_cluster_month_int[label]).sort_values().tail(5)\n    \n    ax[i].barh(top_5_pop.index, top_5_pop.values\/pd.Series(brand_cluster_month_int[label]).sum(), color='darkblue', alpha=0.5)\n    \n    ax[i].set_title('Top 5 brands for Cluster {}'.format(label), loc='left')\n    \n    if i == len(labels)-1:\n        ax[i].set_xlabel('Percent of total occurrence')\n\nplt.show()","3fd2ab3a":"plt.figure(figsize=(10,5))\ndata.distance_from_home.plot(kind='hist',bins=50)\nplt.show()","1d44cdb4":"data['distance_log'] = np.log(data['distance_from_home'])","264276a5":"plt.figure(figsize=(10,10))\nsns.scatterplot(x='raw_visit_count',y='distance_from_home', data=data)\nplt.show()","85df844b":"data['popularity_by_day'] = data.popularity_by_day.map(lambda x:eval(x))","249a66ac":"data = pd.concat([data, pd.DataFrame.from_dict(data['popularity_by_day'].to_dict(), orient='index')],axis=1)\ndata.head()","c1dc8ed0":"data[['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday']].agg('median').plot(kind='bar')\nplt.show()","1857ccef":"data['day_sum'] = data['Monday']+data['Tuesday']+data['Wednesday']+data['Thursday']+data['Friday']+data['Saturday']+data['Sunday']","f62658f1":"for x in ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday']:\n    data[x+'_prop'] = data[x]\/data['day_sum']","f314706d":"plt.figure(figsize=(10,8))\nsns.violinplot(x='variable', y='value', data=pd.melt(data[['census_block_group','Monday_prop','Tuesday_prop','Wednesday_prop','Thursday_prop','Friday_prop','Saturday_prop','Sunday_prop']], id_vars=['census_block_group']))\nplt.xticks(rotation=60)\nplt.show()","ec1dafdd":"data.loc[data[['Monday_prop','Tuesday_prop','Wednesday_prop','Thursday_prop','Friday_prop','Saturday_prop','Sunday_prop']].agg('max', axis=1)>0.5].sort_values(by='day_sum',ascending=False).head()","30d75e52":"data.loc[data[['Monday_prop','Tuesday_prop','Wednesday_prop','Thursday_prop','Friday_prop','Saturday_prop','Sunday_prop']].agg('max', axis=1)>0.5].sort_values(by='day_sum',ascending=False).head(1)[['Monday_prop','Tuesday_prop','Wednesday_prop','Thursday_prop','Friday_prop','Saturday_prop','Sunday_prop']].plot(kind='bar')\nplt.show()","77d5dc6e":"data['popularity_by_hour'] = data.popularity_by_hour.map(lambda x:eval(x))","7d062e69":"data = pd.concat([data, pd.DataFrame.from_records(data['popularity_by_hour'].to_dict()).transpose()], axis=1)\ndata.head()","fee13455":"plt.figure(figsize=(10,5))\ndata[np.arange(24)].agg('median').plot(kind='bar', color='grey')\nplt.xticks(rotation=0)\nplt.show()","2ac024bd":"data['hour_sum'] = data[np.arange(24)].sum(axis=1)","78fe505f":"for x in np.arange(24):\n    data[str(x)+'_prop'] = data[x]\/data['hour_sum']","572c9107":"plt.figure(figsize=(20,10))\nsns.violinplot(x='variable', y='value', data=pd.melt(data[['census_block_group']+[str(x)+'_prop' for x in np.arange(24)]], id_vars=['census_block_group']))\nplt.xticks(rotation=90)\nplt.show()","61146fbe":"data.loc[data[[str(x)+'_prop' for x in np.arange(24)]].agg('max', axis=1)>0.2].sort_values(by='hour_sum',ascending=False).head()","aa7de290":"data.loc[data[[str(x)+'_prop' for x in np.arange(24)]].agg('max', axis=1)>0.2].sort_values(by='hour_sum',ascending=False).head(1)[[str(x)+'_prop' for x in np.arange(24)]].plot(kind='bar')\nplt.legend().remove()\nplt.show()","38b73dd7":"data.raw_visit_count.plot(kind='hist',bins=20)\nplt.show()","bccf542d":"data.raw_visitor_count.plot(kind='hist',bins=20)\nplt.show()","59ab493e":"data['percent_unique_visitor'] = data['raw_visitor_count']\/data['raw_visit_count']\ndata['percent_unique_visitor'].plot(kind='hist',bins=50)\nplt.show()","34550a20":"plt.figure(figsize=(10,10))\nsns.scatterplot(x='raw_visit_count',y='raw_visitor_count', data=data)\nplt.show()","8f7e7af4":"plt.figure(figsize=(10,10))\nsns.scatterplot(y='raw_visit_count',x='percent_unique_visitor', data=data)\nplt.show()","3b21ade7":"data['raw_visit_count_log'] = np.log(data['raw_visit_count'])\ndata['raw_visitor_count_log'] = np.log(data['raw_visitor_count'])","0927d072":"plt.figure(figsize=(10,10))\nsns.scatterplot(x='raw_visit_count_log',y='percent_unique_visitor', data=data)\nplt.show()","112e94df":"plt.figure(figsize=(10,10))\nsns.scatterplot(y='distance_from_home',x='percent_unique_visitor', data=data)\nplt.show()","18d73853":"data['visitor_home_cbgs'] = data.visitor_home_cbgs.map(lambda x:eval(x))\ndata['visitor_work_cbgs'] = data.visitor_work_cbgs.map(lambda x:eval(x))","1c323ef0":"data['number_of_home_cbgs'] = data.visitor_home_cbgs.map(len)\ndata['number_of_work_cbgs'] = data.visitor_work_cbgs.map(len)","670a09e4":"home_cbgs = {}\nfor x in data.visitor_home_cbgs:\n    for key, value in x.items():\n        if key in home_cbgs.keys():\n            home_cbgs[key] += np.array([1, value])\n        else:\n            home_cbgs[key] = np.array([1, value])","5c04fcbe":"home_cbgs_df = pd.DataFrame.from_dict(home_cbgs, orient='index',columns=['number_of_occurrence_home','total_visitors_count_home'])","fb6fe7c6":"work_cbgs = {}\nfor x in data.visitor_work_cbgs:\n    for key, value in x.items():\n        if key in work_cbgs.keys():\n            work_cbgs[key] += np.array([1, value])\n        else:\n            work_cbgs[key] = np.array([1, value])\n            \nwork_cbgs_df = pd.DataFrame.from_dict(work_cbgs, orient='index',columns=['number_of_occurrence_work','total_visitors_count_work'])","59d6e7d7":"total = pd.concat([home_cbgs_df,work_cbgs_df],axis=1, sort=True)\ntotal.fillna(0, inplace=True)\ntotal.head()","67da8703":"total['log_home'] = np.log(total.total_visitors_count_home+1)\ntotal['log_work'] = np.log(total.total_visitors_count_work+1)","49214441":"plt.figure(figsize=(10,10))\nsns.scatterplot(x='total_visitors_count_home',y='total_visitors_count_work', data=total)\nplt.show()","a882529e":"total.log_home.plot(kind='hist',bins=60)","849c568d":"plt.figure(figsize=(10,10))\nsns.scatterplot(x='log_home',y='log_work', data=total)\nplt.show()","b89486c1":"data = data.join(total, on='census_block_group')","2e002782":"data.loc[:,total.columns] = data.loc[:,total.columns].fillna(0)","3f96464c":"data.loc[(data.number_of_occurrence_home!=0)&(data.number_of_home_cbgs!=0)]","3924cf6f":"plt.figure(figsize=(10,10))\nsns.regplot(x='number_of_work_cbgs',y='number_of_occurrence_work', data=data.loc[(data.number_of_occurrence_work!=0)&(data.number_of_work_cbgs!=0)])\nplt.show()","706a6e08":"Cluster 10's most popular top brand is also USPS. One interesting observation is that for this cluster, USPS accounts for more than 8% of the total occurrence. This is more than twice of USPS's percentage of total occurrence at the nationa level.","10164a71":"Cluster 2, 5 and 6 have other brands as their top related same day brand.\n\nThe same analysis was also done for the related same month brand, and the results are quite similar for each clusters. Below are the results.","f7b36d1f":"## Questions\n\n### What are the most popular brands in a neighborhood? Are there regional preferences for some brands over others?","979d6c18":"## Conclusion Related Brands\n\nEarlier, we see that USPS and Subways are popular brands across the USA, meaning there is not much regional  brand preference towards these two brands. By analysing the related brands, we can see that there are more obvious regional brand preferences. ","748cd40f":"NA values for raw_visitor_count will also be removed.","3649c0d9":"Sunday has the lowest median number of visitors. From the above plot, there are less visitors during the weekend than on weekdays. This could suggest that many people \"visit\" other CBGs for work during the weekdays, and many people choose to stay at home\/own CBGs during the weekend. Thursday has the lowest median number of visitors. Note that the data only relates to a single month, hence, a public holiday on a Thursday might have lower the number of visitors on Thursday.","ba7e74a2":"Walmart is the top related same day brand for clusters 3, 7 and 9.","56e2e26c":"### How do people travel between neighborhoods? How does distance traveled compare for suburban and urban communities?","b3f07af5":"Only three regional clusters ( 0 ,1 and 11) have McDonalds as the top related same day brand.","f2a256de":"Clusters 4, 8 and 10 have Starbucks as their top related same day brand. It would seem like Starbucks is more popular in the west coast as compared to the rest of the USA.","cede8757":"### What times do people visit certain census block groups (ex. Manhattan during the day vs. night)?","5bce979b":"# Introduction\n\nThis kernel aims to explore this dataset on Visitor information to Census Block Groups.","f0090256":"## Conclusion: Top Brands\n\nThere are differences in brands preference across the USA, as shown by the different top brands in each cluster. USPS is the most popular top brands when looking at the aggregated data. It is also the top brand across a number of regional clusters. However, Subway can also be considered the most consistent top brand as it is the only brand that is among the top 5 brands in all regional clusters.","01d6bab4":"There is one NA CBG. This row will be removed.","7f4cb347":"By counting the occurrence of each brands in the top brand column, I can find out what are the most popular top brands. The most popular brands are:\n1. United States Postal Service\n2. Subway\n3. Dollar General\n4. McDonald's\n5. Shell Oil\n6. Cricket Wireless\n7. Starbucks\n8. Family Dollar Stores\n9. The American Legion\n10. Walgreens","b2abb342":"This plot shows the expected trend of number of visitors throughout a single day. At the peak hour of 0700 and 1700, there are the most number of visitors. This is in line with the usual business working hours.","3e1d088e":"There are some missing values for some columns.","9643af28":"Geographical information is added.","1e76c40f":"A list of description of data attributes:\n* census_block_group: The unique 12-digit FIPS code for the Census Block Group. Please note that some CBGs have leading zeroes.\n* date_range_start: Start time for measurement period as a timestamp in UTC seconds.\n* date_range_end: End time for measurement period as a timestamp in UTC seconds.\n* raw_visit_count: Number of visits seen by our panel to this CBG during the date range.\n* raw_visitor_count: Number of unique visitors seen by our panel to this POI during the date range.\n* visitor_home_cbgs: This column lists all the origin home CBGs for devices that visited a destination in the CBG listed in the column census_block_group (the destination CBG). The number mapped to each home CBG indicates the number of visitors observed from this home CBG that visited census_block_group during this time period. Home CBGs with less than 50 visitors to census_block_group are not included.\n* visitor_work_cbgs: This column lists all the work-location CBGs for devices that visited a destination in the CBG listed in the column census_block_group (the destination CBG). The number mapped to each work CBG indicates the number of visitors observed with this work CBG that visited census_block_group during this time period. Work CBGs with less than 50 visitors to census_block_group are not included.\n* distance_from_home: Median distance from home traveled to CBG by visitors (of visitors whose home we have identified) in meters.\n* related_same_day_brand: Brands that the visitors to this CBG visited on the same day as their visit to the CBG where customer overlap differs by at least 5% from the SafeGraph national average to these brands. Order by strength of difference and limited to top ten brands.\n* related_same_month_brand: Brands that the visitors to this CBG visited on the same month as their visit to the CBG where customer overlap differs by at least 5% from the SafeGraph national average. Order by strength of difference and limited to top ten brands.\n* top_brands: A list of the the top brands visited in the CBG during the time period. Limited to top 10 brands.\n* popularity_by_hour: A mapping of hour of the day to the number of visits in each hour over the course of the date range in local time.\n* popularity_by_day: A mapping of day of week to the number of visits on each day (local time) in the course of the date range.","2227788b":"### Which neighborhoods are the most mobile? Which neighborhoods receive the most outside visitors?","199b0567":"NA rows are removed.","51954bff":"Longitude of one CBG was adjusted for better visualisation.","ca9ad60f":"We can further substantiate our observation of brands preference by analysing the related_same_day_brand and related_same_month_brand columns. These columns provide a more accurate depiction of brand preference as it indicates in each CBG, what brands are visited more than the national average. ","3e64ddd4":"This is an interesting plot as you can see there are almost two separate relationships, indicating there may be two broad categories of CBGs.","d4176af0":"For cluster 4, 5, 6, and 9, their most popular brand is not USPS. Only cluster 9 has USPS among its top brands. Cluster 6 has more than 17.5% of its total occurrence coming from department of veteran affairs. This probably indicates there is higher proportion of its residents are veteran.","1c5621ad":"All rows have the same observation period of 31 days.","44947b8b":"Now, I want to find out if there are any brands that are both popular in terms of visitor traffic and regional preference i.e. the brand appears in both top brand list and related brand list.","24fd05af":"We can see that the top 10 related same day brands are quite different from the top 10 top brands we seen earlier.\n\nThe top 10 related same day brands are:\n1. McDonald's (Also in top brands)\n2. Walmart\n3. Dunkin' Donuts\n4. Dollar General (Also in top brands)\n5. Starbucks (Also in top brands)\n6. Shell Oil (Also in top brands)\n7. Sonic\n8. Quiktrip\n9. 7-Eleven \n10. Casey's General Stores\n\nNext, I will analyse by regional clusters.","54ef413b":"Next, I consider the top brands in each of the regional cluster.","383d8f3d":"For cluster 0, 1, 2, 3, 7, 8 and 11, their most popular brand is USPS. They also have similar top brands (Subway, McDonald's)","6916d892":"The above plot shows that there are big variations for each day of the week. We can take a look at some of the outliers.","e01bd1fd":"Each CBG will be grouped under one of 12 clusters. This is firstly done by sampling 20% of the data. This is due to insufficient memory. After which a random forest classifier is built to classify all CBGs into the 12 clusters.","27ceae69":"A high percent of unique visitors indicate that this CBG is most likely a tourist attraction, where there are no regular visitors.","64486726":"# Additional Features"}}