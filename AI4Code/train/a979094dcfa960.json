{"cell_type":{"71edf0a1":"code","c287eb1f":"code","f953da45":"code","d8c36179":"code","ed082638":"code","24cbacc4":"code","fbef5f54":"code","7172d396":"code","c43319c6":"code","19741a73":"code","b0f128f1":"code","b93a1e4f":"code","a887ed17":"code","1ac0053b":"code","fac44146":"code","5cc88169":"code","d88cd7c8":"code","ed67efe7":"code","5d0a8298":"code","ce0847c4":"code","3ad85414":"code","f5ac7b53":"code","839fe105":"code","00adb856":"code","49ca5369":"code","ffb34452":"code","f6336307":"code","b2e47b7e":"code","9a1e10f0":"code","bc714135":"code","d2cce558":"code","4c2a010e":"code","7303e50a":"code","e81937fe":"code","bb3d7956":"code","d8a54d29":"code","245eae9d":"code","6f67f9da":"code","703d7c43":"code","c05a9024":"code","d4bcd2e3":"code","bf667cee":"code","e8d07307":"code","eba0415f":"code","45da0cce":"code","c0f9e307":"code","00a0cd81":"code","b7353a73":"code","3439b019":"code","6b698d11":"code","ef7c23a7":"code","c7ed1ad5":"code","41882b0f":"code","3f1f71db":"code","03154e13":"markdown","40864d38":"markdown","e4200b19":"markdown","6fc9b4c2":"markdown","b1f5b999":"markdown","c17caec6":"markdown","7a9436b1":"markdown","df3c4b0c":"markdown"},"source":{"71edf0a1":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns","c287eb1f":"pip install openpyxl","f953da45":"df=pd.read_excel('..\/input\/flight-fare-prediction-mh\/Data_Train.xlsx')","d8c36179":"df.head()","ed082638":"df['Journey_Day']=df['Date_of_Journey'].apply(lambda x: x.split('\/')[0])\ndf['Journey_month']=df['Date_of_Journey'].apply(lambda x: x.split('\/')[1])","24cbacc4":"df.head()","fbef5f54":"df.drop('Date_of_Journey',axis=1,inplace=True)","7172d396":"df.isnull().mean()","c43319c6":"df.dropna(inplace=True)","19741a73":"df.columns","b0f128f1":"df.isnull().mean()","b93a1e4f":"#extract hours and mins from departure time\ndf['Dep_Hour']=df['Dep_Time'].apply(lambda x: x.split(':')[0])\ndf['Dep_Min']=df['Dep_Time'].apply(lambda x: x.split(':')[1])","a887ed17":"df.head()","1ac0053b":"df.drop('Dep_Time',axis=1,inplace=True)\ndf.head()","fac44146":"df['Arrival_Hour']=pd.to_datetime(df['Arrival_Time']).dt.hour    #extract arrival hour and mins from arrival time\ndf['Arrival_min']=pd.to_datetime(df['Arrival_Time']).dt.minute","5cc88169":"df.drop('Arrival_Time',axis=1,inplace=True)","d88cd7c8":"#now lets deal with duration..make separate column for hour and min..extract it from duration","ed67efe7":"duration=list(df['Duration'])","5d0a8298":"for i in range(len(duration)):\n    if len(duration[i].split())!=2:\n        if 'h' in duration[i]:\n            duration[i]=duration[i].strip() + \" 0m \"\n        else:\n            duration[i]=' 0h ' + duration[i]      ","ce0847c4":"duration_hours=[]\nduration_mins=[]\nfor i in range(len(duration)):\n    duration_hours.append(int(duration[i].split(sep='h')[0]))\n    duration_mins.append(int(duration[i].split(sep='m')[0].split()[-1]))","3ad85414":"df['Duration_hours']=duration_hours\ndf['Duration_mins']=duration_mins","f5ac7b53":"df.head()","839fe105":"df.drop('Duration',axis=1,inplace=True)\ndf.head()","00adb856":"df['Airline'].value_counts()","49ca5369":"Airline=df[['Airline']]\nAirline=pd.get_dummies(Airline,drop_first=True)","ffb34452":"df['Source'].value_counts()  #prform one hot encoding on Source","f6336307":"Source=df[['Source']]\nSource=pd.get_dummies(Source,drop_first=True)\nSource.head()","b2e47b7e":"Destination=df[['Destination']]\nDestination=pd.get_dummies(Destination, drop_first=True)","9a1e10f0":"df.drop(['Route','Additional_Info'],axis=1,inplace=True)","bc714135":"df['Total_Stops'].value_counts()","d2cce558":"df.replace({'non-stop':0, '1 stop':1, '2 stops':2, '3 stops':3, '4 stops':4},inplace=True) #perform label encoding on ordinal stops data","4c2a010e":"df.head()","7303e50a":"df_final=pd.concat([df,Airline,Source,Destination],axis=1)\ndf_final.head()","e81937fe":"df_final.shape","bb3d7956":"df_final.drop(['Airline','Source','Destination'],axis=1,inplace=True)\ndf_final.head()","d8a54d29":"X=df_final.drop('Price',axis=1)\ny=df_final['Price']","245eae9d":"plt.figure(figsize=(18,18))\nsns.heatmap(df_final.corr(),annot=True,cmap='RdYlGn')\nplt.show()","6f67f9da":"from sklearn.ensemble import ExtraTreesRegressor\nselection=ExtraTreesRegressor()\nselection.fit(X,y)\nprint(selection.feature_importances_)","703d7c43":"plt.figure(figsize=(12,8))\nfeat_importances=pd.Series(selection.feature_importances_,index=X.columns)\nfeat_importances.nlargest(20).plot(kind='barh')\nplt.show()","c05a9024":"from sklearn.model_selection import train_test_split","d4bcd2e3":"X_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=42)","bf667cee":"from sklearn.ensemble import RandomForestRegressor\nreg_rf=RandomForestRegressor()\nreg_rf.fit(X_train,y_train)","e8d07307":"y_pred=reg_rf.predict(X_test)","eba0415f":"reg_rf.score(X_train,y_train)   #Training accuracy","45da0cce":"reg_rf.score(X_test,y_test)     #Testing accuracy","c0f9e307":"n_estimators=[int(x) for x in np.linspace(start=100, stop=1200, num=12)]\n\nmax_features=['auto','sqrt']\n\nmax_depth=[int(x) for x in np.linspace(5,30,num=6)]\n\nmin_samples_split=[2,5,10,15,100]\n\nmin_samples_leaf=[1,2,5,10]","00a0cd81":"random_grid={\n    'n_estimators':n_estimators,\n    'max_features':max_features,\n    'max_depth':max_depth,\n    'min_samples_split':min_samples_split,\n    'min_samples_leaf':min_samples_leaf\n}","b7353a73":"from sklearn.model_selection import RandomizedSearchCV","3439b019":"rf_random1=RandomizedSearchCV(estimator=reg_rf, param_distributions=random_grid, scoring='neg_mean_squared_error',n_iter=10, cv=4,random_state=42,n_jobs=1)","6b698d11":"rf_random1.fit(X_train,y_train)","ef7c23a7":"rf_random1.best_params_","c7ed1ad5":"prediction=rf_random1.predict(X_test)","41882b0f":"from sklearn import metrics","3f1f71db":"print(metrics.r2_score(y_test,prediction))","03154e13":"# Hyperparameter Tuning ( Randomized Search CV)","40864d38":"# Data Pre-processing","e4200b19":"**Flight ticket prices can be something hard to guess, today we might see a price, check out the price of the same flight tomorrow, it will be a different story. We might have often heard travellers saying that flight ticket prices are so unpredictable.**\n\nIn this kernel, we will go through this ML problem statement where we predict the price of Flight tickets based on some independent Features.","6fc9b4c2":"# Model Building using Random Forest","b1f5b999":"# Now let's handle categorical data","c17caec6":"# Feature Selection using Extra Trees Regressor ","7a9436b1":"**Do leave an upvote if you happen to like it !**","df3c4b0c":"# Introduction"}}