{"cell_type":{"cbef81fc":"code","ccdc383e":"code","2ed4d7d1":"code","dfd919a3":"code","dc6043bf":"code","6e869d17":"code","68630a62":"code","0fe64563":"code","710f2485":"code","ef92d1b1":"code","e9db9237":"code","6008dedf":"code","478b834f":"code","d15386de":"code","8ea8fa5f":"code","56d8b353":"code","24a4e766":"code","d315d27c":"code","27ed77b5":"markdown","0498224e":"markdown","5085867e":"markdown","6cf6417b":"markdown","6f35d722":"markdown","0e70a521":"markdown","3b650e1b":"markdown"},"source":{"cbef81fc":"import os\nimport numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport librosa\nimport librosa.display\n\nimport wave\nfrom matplotlib import pyplot as plt\nfrom IPython import display as ipd\nfrom scipy.io import wavfile","ccdc383e":"import warnings\nwarnings.filterwarnings('ignore')","2ed4d7d1":"# Script containing lwlrap functions\n%run ..\/usr\/lib\/2019_fat_lwlrap\/2019_fat_lwlrap.py","dfd919a3":"SAMPLE_RATE = 44100\nN_MFCC = 50\nFIGSIZE = (16,9)\nWIDTH = 1.0","dc6043bf":"DATA_PATH = '..\/input\/freesound-audio-tagging-2019\/'\n\nCURATED_CSV = DATA_PATH + 'train_curated.csv'\nCURATED_DIR = DATA_PATH + 'train_curated\/'\nNOISY_CSV = DATA_PATH + 'train_noisy.csv'\nNOISY_DIR = DATA_PATH + 'train_noisy\/'\nSAMPLE_CSV = DATA_PATH + 'sample_submission.csv'","6e869d17":"def gen_duration(path):\n    def f(file):\n        with wave.open(path+file) as data:\n            return data.getnframes() \/ SAMPLE_RATE\n    return f\n\ntrain_curated = pd.read_csv(CURATED_CSV)\ntrain_curated['curated'] = True\ntrain_curated['duration'] = train_curated.fname.apply(gen_duration(CURATED_DIR))\n\ntrain_noisy = pd.DataFrame()\ntrain_noisy = pd.read_csv(NOISY_CSV)\ntrain_noisy['curated'] = False\ntrain_noisy['duration'] = train_noisy.fname.apply(gen_duration(NOISY_DIR))\n\ntrain = pd.concat([train_curated, train_noisy], ignore_index=True)","68630a62":"# N-hot for labels\ncurated_labels = train[train.curated==True].labels.str.get_dummies(sep=',')\nnoisy_labels = train[train.curated==False].labels.str.get_dummies(sep=',')","0fe64563":"# plt.figure(figsize=FIGSIZE)\n\nplt.subplot(121)\nax = curated_labels.sum(axis=1).value_counts().sort_index().plot.bar()\nax.set_title('File with N labels : Curated')\nax.set_xlabel('label count')\nax.set_ylabel('count')\nplt.tight_layout()\n\nplt.subplot(122)\nax = noisy_labels.sum(axis=1).value_counts().sort_index().plot.bar()\nax.set_title('File with N labels : Noisy')\nax.set_xlabel('label count')\nax.set_ylabel('count')\nplt.tight_layout()","710f2485":"plt.figure(figsize=FIGSIZE)\n\nax = curated_labels.sum().plot.bar(color='r', width=WIDTH)\nax = curated_labels[curated_labels.sum(axis=1)==1].sum().plot.bar(color='b', width=WIDTH)\nax.set_title('samples per label : Curated');\nplt.tight_layout()","ef92d1b1":"plt.figure(figsize=FIGSIZE)\n\nax = noisy_labels.sum().plot.bar(color='r', width=WIDTH)\nax = noisy_labels[noisy_labels.sum(axis=1)==1].sum().plot.bar(color='b', width=WIDTH)\nax.set_title('samples per label : Noisy')\nplt.tight_layout();","e9db9237":"plt.figure(figsize=FIGSIZE)\n\nlabels = train.labels.str.get_dummies(sep=',')\nax = labels.sum().plot.bar(color='r', width=WIDTH)\nax = labels[labels.sum(axis=1)==1].sum().plot.bar(color='b', width=WIDTH)\nax.set_title('samples per label : Combined')\nplt.tight_layout();","6008dedf":"plt.figure(figsize=FIGSIZE)\n\nN_BIN = 50\n\n# upper half\nplt.subplot(211)\nax1 = train.duration.hist(bins=N_BIN, color='r')\nax1 = train[train.curated==True].duration.hist(bins=N_BIN)\nplt.ylim([17000,18500])\n\n# lower half\nplt.subplot(212)\nax2 = train.duration.hist(bins=N_BIN, color='r')\nax2 = train[train.curated==True].duration.hist(bins=N_BIN)\nax2.set_xlabel('Duration (sec)')\nax2.set_ylabel('count');\nplt.ylim([0,1500]);\n\n\n# hide the spines between ax and ax2\nax1.spines['bottom'].set_visible(False)\nax2.spines['top'].set_visible(False)\nax1.xaxis.tick_top()\nax1.tick_params(labeltop='off')  # don't put tick labels at the top\nax2.xaxis.tick_bottom()\n\nd = .01  # how big to make the diagonal lines in axes coordinates\n# arguments to pass to plot, just so we don't keep repeating them\nkwargs = dict(transform=ax1.transAxes, color='k', clip_on=False)\nax1.plot((-d, +d), (-d, +d), **kwargs)        # top-left diagonal\nax1.plot((1 - d, 1 + d), (-d, +d), **kwargs)  # top-right diagonal\n\nkwargs.update(transform=ax2.transAxes)  # switch to the bottom axes\nax2.plot((-d, +d), (1 - d, 1 + d), **kwargs)  # bottom-left diagonal\nax2.plot((1 - d, 1 + d), (1 - d, 1 + d), **kwargs); # bottom-right diagonal","478b834f":"durations = []\nlabels = []\nfor index, row in train[(train.curated==True)].iterrows():\n    arr = row.labels.split(',')\n    durations.extend([row.duration]*len(arr))\n    labels.extend(arr)\n\nplt.figure(figsize=FIGSIZE)\nplt.grid()\nax = sns.boxplot(x=np.array(labels), y=np.array(durations));\nax.set_title('Duration distribution per class')\nplt.xticks(rotation=90);","d15386de":"def audio_analysis(x, draw_plot=True):\n    \n    if type(x) is str:\n        rows = train[train.fname==x]\n        assert len(rows)>0, f'\"{x}\" not found in training dataframe.'\n        x = rows.iloc[0]\n    \n    \n    DIR = CURATED_DIR if x.curated else NOISY_DIR\n    \n    # Obtain audio data\n    rate, data = wavfile.read(DIR + x.fname)\n    data = data.astype(float)\n    data \/= data.max()\n    \n    if draw_plot:\n        # Plot\n        plt.figure(figsize=FIGSIZE)\n\n        # Waveform\n        ax = plt.subplot(311)\n        ax.set_title('{} \/ {} \/ {}'.format(x.fname, x.labels, f'Curated={x.curated}'))\n        ax.set_ylabel('Amplitude')    \n        librosa.display.waveplot(data, sr=rate)\n\n        # Spectrogram\n        ax = plt.subplot(312)\n        S = librosa.feature.melspectrogram(data, sr=rate, n_mels=128)\n        log_S = librosa.power_to_db(S, ref=np.max)\n        librosa.display.specshow(log_S, sr=rate, x_axis='time', y_axis='mel')\n        ax.set_title('Mel power spectrogram ')\n        plt.colorbar(format='%+02.0f dB')\n        plt.tight_layout()\n\n        # MFCC coefficient\n        ax = plt.subplot(313)\n        mfcc = librosa.feature.mfcc(S=log_S, n_mfcc=13)\n        delta2_mfcc = librosa.feature.delta(mfcc, order=2)\n        librosa.display.specshow(delta2_mfcc)\n        plt.ylabel('MFCC coeffs')\n        plt.xlabel('Time')\n        plt.title('MFCC')\n        plt.colorbar()\n        plt.tight_layout()\n    \n    return ipd.Audio(filename=DIR+x.fname)","8ea8fa5f":"# numerous labels\naudio_analysis('4dad3998.wav')","56d8b353":"# Distinct labels\naudio_analysis('d828ffce.wav')","24a4e766":"# Mixed with other sounds\naudio_analysis('8250b48f.wav')","d315d27c":"# Incorrect label '6a1f682a.wav'\naudio_analysis('f76181c4.wav')","27ed77b5":"## Audio","0498224e":"## Labels","5085867e":"---\n# Analysis","6cf6417b":"---\n# Init","6f35d722":"# Preprocessing","0e70a521":"- File with N labels","3b650e1b":"- Samples per label(1-label)"}}