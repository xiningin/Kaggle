{"cell_type":{"7b0a6395":"code","63908d54":"code","9453bb6d":"code","9075d4f8":"code","5f018a2f":"code","be4c7ddc":"code","cb92cf59":"code","a37ea9d7":"code","e940bf36":"code","d0e06118":"code","430daf4d":"code","5b3f62a8":"code","e2aaf9b7":"code","0731e70b":"code","4aaae8bd":"code","febb03d5":"code","e2f5a192":"code","405dc868":"code","2e65759e":"code","30997cb4":"code","af008641":"code","550754ad":"code","7699bfbf":"code","b49a089d":"code","611a86f3":"code","45074bc9":"code","1f841851":"code","8014af9c":"code","8da27547":"code","298a3b47":"code","3a81b8c4":"code","a3ac00b9":"code","c962bad1":"code","66c07871":"code","0c69e887":"code","e922006c":"code","56a3d119":"code","b2ce392f":"code","20e2d064":"code","6dd3d395":"code","c0bd52fc":"code","3d7208c6":"code","a5d4af37":"code","021028b8":"code","3c7e1e73":"code","9ebc4142":"code","bea31d0d":"code","c266868d":"code","bc8abf90":"code","b5e858d9":"code","1a504b60":"code","f7d689a0":"code","49fc381b":"code","6b8e5008":"code","53e90ed6":"code","7c703979":"code","9694ea93":"code","b9e50b7d":"code","e6f5b045":"code","43eb15a9":"code","515159de":"code","29b7b490":"code","ed889422":"code","26cce821":"code","9f684814":"code","1dd93a2c":"code","f192be9c":"code","6384b441":"code","240e3ced":"code","0ccdfa02":"code","f23622ba":"code","169deff9":"code","4a1dbe9f":"code","51747fec":"code","21faec40":"code","8c7b8ec2":"code","ef5351c9":"code","448b0139":"code","1c9f48ef":"code","43ec9eb6":"code","8ad02edb":"code","24ab7003":"code","58206864":"code","bc93ee8a":"code","b0c9deaf":"code","5ceec5ac":"code","9ce0352c":"code","e344d9f1":"code","6b780158":"code","942121d1":"code","49ae0a98":"code","f7ad34f1":"code","39051d23":"code","e8fcdb40":"code","3c37ec27":"code","fb9abd1d":"code","d12a1236":"code","6ef3a6b1":"code","f8340d5c":"code","998d9b72":"code","17aba394":"code","e7f8e90a":"code","9962b4b5":"code","6edefce8":"code","3435a485":"markdown","0786aad5":"markdown","d396867b":"markdown","df1b1797":"markdown","7fe46b34":"markdown","aa456a6a":"markdown","f9b81b2f":"markdown","c96284eb":"markdown","c0c9c61a":"markdown","289ffa09":"markdown","db3217d9":"markdown","8d6da526":"markdown","e778f689":"markdown","394ed596":"markdown","226d1d0f":"markdown","5515b0ce":"markdown","07b79c31":"markdown","d4d783bf":"markdown","cd13fa28":"markdown","4e1311c9":"markdown","f3947c7f":"markdown","c66cb38d":"markdown","6c6344d1":"markdown","29d6cd8b":"markdown","0f33b05c":"markdown","2059d10e":"markdown","b14a1c4c":"markdown","23a5983f":"markdown","deb2d158":"markdown","5c92cb38":"markdown","4bedec25":"markdown","b67dad2b":"markdown","e3cc6643":"markdown","be2a74ec":"markdown"},"source":{"7b0a6395":"import pandas as pd\nimport numpy as np\nimport random\nimport zipfile\nimport matplotlib.pyplot as plt\nfrom datetime import datetime","63908d54":"train = pd.read_csv('..\/input\/new-york-city-taxi-fare-prediction\/train.csv')\ntest = pd.read_csv('..\/input\/new-york-city-taxi-fare-prediction\/test.csv')","9453bb6d":"train.shape","9075d4f8":"train.head(10)","5f018a2f":"train.dtypes","be4c7ddc":"train = train.sample(n = 250000)","cb92cf59":"train.shape","a37ea9d7":"train.to_csv('train_sample.csv', index = False)\ntrain = pd.read_csv('.\/train_sample.csv', parse_dates = ['key', 'pickup_datetime'])\ntrain.shape\ntrain.head()","e940bf36":"train.dtypes","d0e06118":"train.isna().sum(axis = 0)","430daf4d":"key = train['key']\n#visualizing data distributions with 100 divisions(bins)::\nplt.hist(key, bins = 100)","5b3f62a8":"pdt = train['pickup_datetime']","e2aaf9b7":"key.describe()","0731e70b":"pdt.describe()","4aaae8bd":"#eliminating seconds:\npdt = pdt.map(lambda date: date.tz_localize(None))\npdt","febb03d5":"#key with same format as pdt:\nkey = pd.to_datetime(key.dt.strftime('%Y-%m-%d %H:%M:%S'))\nkey","e2f5a192":"(key == pdt)","405dc868":"(key == pdt).value_counts()","2e65759e":"train.drop(['key'], axis = 1, inplace = True)\ntrain.head()","30997cb4":"#formatting:\ntrain['pickup_datetime'] = pdt\ntrain.head()","af008641":"plon = train['pickup_longitude']\nplon.describe()","550754ad":"plt.hist(plon, bins = 150)","7699bfbf":"plon.median()","b49a089d":"#A zoom:\nplt.hist(plon[(plon > plon.median() - 2.5) & (plon < plon.median() + 2.5)], bins = 100)","611a86f3":"##Let's eliminate the inconsistent values:\nplon_val = (plon > plon.median() - 0.5) & (plon < plon.median() + 0.5)\nplon_val.value_counts()","45074bc9":"#percent:\nprint(plon_val.value_counts(), '\\n', plon_val.value_counts(normalize = True))","1f841851":"plat = train['pickup_latitude']\nplat.describe()","8014af9c":"plt.hist(plat, bins = 100)","8da27547":"plat.median()","298a3b47":"plt.hist(plat[(plat > plat.median() - 2.5) & (plat < plat.median() + 2.5)], bins = 100)","3a81b8c4":"plat_val = (plat > plat.median() - 0.5) & (plat < plat.median() + 0.5)","a3ac00b9":"#percent:\nprint(plat_val.value_counts(), '\\n', plat_val.value_counts(normalize = True))","c962bad1":"dlon = train['dropoff_longitude']\ndlon.describe()","66c07871":"fig, ax = plt.subplots(1, 2, figsize = (15, 5))\nax[0].hist(dlon, bins = 100)\nax[1].hist(dlon[(dlon > dlon.median() - 2.5) & (dlon < dlon.median() + 2.5)], bins = 100)","0c69e887":"dlon_val = (dlon > dlon.median() - 0.5) & (dlon < dlon.median() + 0.5)","e922006c":"#percent\nprint(dlon_val.value_counts(), '\\n', dlon_val.value_counts(normalize = True))","56a3d119":"dlat = train['dropoff_latitude']\ndlat.describe()","b2ce392f":"fig, ax = plt.subplots(1, 2, figsize = (15, 5))\nax[0].hist(dlat, bins = 100)\nax[1].hist(dlat[(dlat > dlat.median() - 2.5) & (dlat < dlat.median() + 2.5)], bins = 100)","20e2d064":"dlat_val = (dlat > dlat.median() - 0.5) & (dlat < dlat.median() + 0.5)","6dd3d395":"#percent\nprint(dlat_val.value_counts(), '\\n', dlat_val.value_counts(normalize = True))","c0bd52fc":"pcount = train['passenger_count']\npcount.describe()","3d7208c6":"print((pcount == 0).sum(), (pcount == 0).mean())","a5d4af37":"plt.hist(pcount, bins = 100)","021028b8":"plt.hist(pcount[pcount < 15], bins = 100)","3c7e1e73":"pcount_val = (pcount >= 1) & (pcount <= 6)\nprint(pcount_val.value_counts(), '\\n', pcount_val.value_counts(normalize = True))","9ebc4142":"fare = train['fare_amount']\nfare.describe()","bea31d0d":"plt.hist(fare, bins = 100)","c266868d":"plt.hist(fare[fare < 10], bins = 100)","bc8abf90":"plt.hist(fare[fare > 50], bins = 100)","b5e858d9":"fare_val = (fare > 2) & (fare < 150)\nprint(fare_val.value_counts(), '\\n', fare_val.value_counts(normalize = True))","1a504b60":"#concatenating the values:\nval_entries = fare_val & plon_val & plat_val & dlon_val & dlat_val & pcount_val\nprint(val_entries.value_counts(), '\\n', val_entries.value_counts(normalize = True))","f7d689a0":"train = train.drop(val_entries[val_entries == False].index)\ntrain.head()","49fc381b":"train.shape","6b8e5008":"train['hour_of_day'] = train['pickup_datetime'].map(lambda date: date.timetuple().tm_hour)\ntrain['day_of_week'] = train['pickup_datetime'].map(lambda date: date.timetuple().tm_wday)\ntrain['day_of_year'] = train['pickup_datetime'].map(lambda date: date.timetuple().tm_yday)\ntrain['year'] = train['pickup_datetime'].map(lambda date: date.timetuple().tm_year)\ntrain.head()","53e90ed6":"len(train['pickup_datetime'][train['pickup_datetime'].dt.strftime('%m-%d') == '02-29'])","7c703979":"train.drop(train['pickup_datetime'][train['pickup_datetime'].dt.strftime('%m-%d') == '02-29'].index, inplace = True)","9694ea93":"train.shape","b9e50b7d":"condition = (train['year'] == 2012) & (train['day_of_year'] > 59)\ntrain['day_of_year'][condition] = train['day_of_year'] - 1","e6f5b045":"fig, ax = plt.subplots(1, 4, figsize = (15,3))\ntrain_not_2015 = train[train['year'] < 2015] # we won't use 2015 because we only have the dates until half of the year\nax[0].hist(train_not_2015['hour_of_day'], bins = 24) # 24 hours in a day\nax[0].set_title('Hour of day')\nax[1].hist(train_not_2015['day_of_week'], bins = 7) # 7 days in a week\nax[1].set_title('Days of week')\nax[2].hist(train_not_2015['day_of_year'], bins = 365) # 365 days\nax[2].set_title('Day of year')\nax[3].hist(train_not_2015['year'], bins = 6) # we have 6 years\nax[3].set_title('Year')","43eb15a9":"plt.figure(figsize = (15, 5))\nplt.scatter(train['pickup_datetime'], train['fare_amount'], s = 1, alpha = 0.2)","515159de":"from collections import Counter\nfare_zoom = train['fare_amount'][(train['fare_amount'] > 40) & (train['fare_amount'] < 60)]","29b7b490":"common_fares_zoom = Counter(fare_zoom)","ed889422":"common_fares_zoom","26cce821":"most_common_fares_zoom = common_fares_zoom.most_common(10)\nmost_common_fares_zoom","9f684814":"plt.bar([x[0] for x in most_common_fares_zoom], [x[1] for x in most_common_fares_zoom])","1dd93a2c":"from mpl_toolkits.basemap import Basemap\n#NYC latitude and longitude definition\nlat1, lat2 = 40.55, 40.95\nlon1, lon2 = -74.10, -73.70\n\nplt.figure(figsize = (10, 10))\nm = Basemap(projection = 'cyl', resolution = 'h',\n            llcrnrlat = lat1, urcrnrlat = lat2,\n            llcrnrlon = lon1, urcrnrlon = lon2)\nm.drawcoastlines()\nm.fillcontinents(color = 'palegoldenrod', lake_color = 'lightskyblue')\nm.drawmapboundary(fill_color = 'lightskyblue')\nm.drawparallels(np.arange(lat1, lat2 + 0.05, 0.1), labels = [1, 0, 0, 0])\nm.drawmeridians(np.arange(lon1, lon2 + 0.05, 0.1), labels = [0, 0, 0, 1])\n\n#Pickup locations - of all exits (green)\nm.scatter(train['pickup_longitude'], train['pickup_latitude'], s = 1, c = 'green',\n          alpha = 0.1, zorder = 5)\n#Dropoof locations - of all exits (yellow)\nm.scatter(train['dropoff_longitude'], train['dropoff_latitude'], s = 1, c='yellow',\n         alpha = 0.1, zorder = 5)\nfor i in [0, 1, 2, 4]:\n  this_fare = most_common_fares_zoom[i][0]\n  this_df = train[train['fare_amount'] == this_fare]\n  #pickup location - red\n  m.scatter(this_df['pickup_longitude'], this_df['pickup_latitude'], s = 2, c = 'red',\n           alpha = 0.2, zorder = 5)\n  #dropoff location - blue\n  m.scatter(this_df['dropoff_longitude'], this_df['dropoff_latitude'], s = 2, c = 'blue',\n           alpha = 0.2, zorder = 5)","f192be9c":"#Arrival point coordinates\ncoords = train[['dropoff_latitude',\n                'dropoff_longitude']][(train['fare_amount'] > 40) &\n                                       (train['fare_amount'] < 60) &\n                                       (train['dropoff_latitude'] < 40.7) &\n                                       (train['dropoff_latitude'] > 40.6) &\n                                       (train['dropoff_longitude'] < -73.7) &\n                                       (train['dropoff_longitude'] > -73.9)]","6384b441":"coords.shape","240e3ced":"coords.head()","0ccdfa02":"print(coords['dropoff_latitude'].median(), coords['dropoff_longitude'].median())","f23622ba":"#Starting point coordinates\ncoords = train[['dropoff_latitude',\n                'dropoff_longitude']][(train['fare_amount'] > 40) &\n                                       (train['fare_amount'] < 60) &\n                                       (train['dropoff_latitude'] < 40.85) &\n                                       (train['dropoff_latitude'] > 40.7) &\n                                       (train['dropoff_longitude'] < -73.9) &\n                                       (train['dropoff_longitude'] > -74.1)]\nprint(coords['dropoff_latitude'].median(), coords['dropoff_longitude'].median())","169deff9":"filtered = train[['fare_amount', \n                  'passenger_count']][((train['fare_amount'] == most_common_fares_zoom[0][0]) |\n                                       (train['fare_amount'] == most_common_fares_zoom[1][0]) |\n                                       (train['fare_amount'] == most_common_fares_zoom[2][0]) |\n                                       (train['fare_amount'] == most_common_fares_zoom[4][0]))&\n                                       (train['fare_amount'] < 60) &\n                                       (train['dropoff_latitude'] < 40.7) & \n                                       (train['dropoff_latitude'] > 40.6) & \n                                       (train['dropoff_longitude'] < -73.7) &\n                                       (train['dropoff_longitude'] > -73.9)]\nplt.scatter(filtered['passenger_count'], filtered['fare_amount'])","4a1dbe9f":"filtered2 = train[['fare_amount', \n                  'hour_of_day',\n                  'day_of_week',\n                  'day_of_year']][((train['fare_amount'] == most_common_fares_zoom[0][0]) |\n                                       (train['fare_amount'] == most_common_fares_zoom[1][0]) |\n                                       (train['fare_amount'] == most_common_fares_zoom[2][0]) |\n                                       (train['fare_amount'] == most_common_fares_zoom[4][0]))&\n                                       (train['fare_amount'] < 60) &\n                                       (train['dropoff_latitude'] < 40.7) & \n                                       (train['dropoff_latitude'] > 40.6) & \n                                       (train['dropoff_longitude'] < -73.7) &\n                                       (train['dropoff_longitude'] > -73.9)]\n\nfig, ax = plt.subplots(1, 3, figsize = (15, 5))\nax[0].scatter(filtered2['hour_of_day'], filtered2['fare_amount'])\nax[0].set_title('Hour of day')\nax[1].scatter(filtered2['day_of_week'], filtered2['fare_amount'])\nax[1].set_title('Day of week')\nax[2].scatter(filtered2['day_of_year'], filtered2['fare_amount'])\nax[2].set_title('Day of year')","51747fec":"train.drop('pickup_datetime', axis = 1, inplace = True)\ntrain.head()","21faec40":"#conversion to radians:\nlon1, lon2 = np.radians(train['pickup_longitude']), np.radians(train['dropoff_longitude'])\nlat1, lat2 = np.radians(train['pickup_latitude']), np.radians(train['dropoff_latitude'])\n#subtraction from the start point to the end point:\ndlon = lon2 - lon1\ndlat = lat2 - lat1","8c7b8ec2":"#Euclidean Distance (Km)\na = np.sin(dlat \/ 2)**2 + np.cos(lat1) * np.cos(lat2) * np.sin(dlon\/2)**2\nc = 2 * np.arctan2(np.sqrt(a), np.sqrt(1 - a))\ntrain['eucl_distance'] = 6373 * c\n\ntrain.head()","ef5351c9":"#Manhattan Distance (Km)\na1 = np.sin(dlon \/ 2)**2\nc1 = 2 * np.arctan2(np.sqrt(a1), np.sqrt(1 - a1))\na2 = np.sin(dlat \/ 2)**2\nc2 = 2 * np.arctan2(np.sqrt(a2), np.sqrt(1 - a2))\ntrain['manh_distance'] = 6373 * (c1 + c2)\n\ntrain.head()","448b0139":"fig, ax = plt.subplots(1, 2, figsize = (10,5))\nax[0].hist(train['eucl_distance'])\nax[0].set_title('Euclidian Distance')\nax[1].hist(train['manh_distance'])\nax[1].set_title('Manhattan Distance')","1c9f48ef":"X_train = train.drop('fare_amount', axis = 1)\nY_train = train['fare_amount']","43ec9eb6":"from sklearn.preprocessing import MinMaxScaler\nscaler = MinMaxScaler()\nscaler.fit(X_train)\nX_train_scaled = scaler.transform(X_train)","8ad02edb":"from sklearn.model_selection import cross_val_score\ncv = 3\nscoring = 'neg_mean_squared_error'\nimport multiprocessing\nn_jobs = multiprocessing.cpu_count() - 1","24ab7003":"#Linear Regression:\nfrom sklearn.linear_model import LinearRegression\nmodel = LinearRegression()\nscores = cross_val_score(model, X_train_scaled, Y_train, cv = cv,\n                         scoring = scoring, n_jobs = n_jobs)\nnp.sqrt(-scores.mean())","58206864":"#Ridge Regression:\nfrom sklearn.linear_model import Ridge\nmodel = Ridge()\nscores = cross_val_score(model, X_train_scaled, Y_train, cv = cv,\n                         scoring = scoring, n_jobs = n_jobs)\nnp.sqrt(-scores.mean())","bc93ee8a":"#Lasso Regression:\nfrom sklearn.linear_model import Lasso\nmodel = Lasso()\nscores = cross_val_score(model, X_train_scaled, Y_train, cv = cv,\n                         scoring = scoring, n_jobs = n_jobs)\nnp.sqrt(-scores.mean())","b0c9deaf":"#Nearest Neighbors:\nfrom sklearn.neighbors import KNeighborsRegressor\nmodel = KNeighborsRegressor()\nscores = cross_val_score(model, X_train_scaled, Y_train, cv = cv,\n                         scoring = scoring, n_jobs = n_jobs)\nnp.sqrt(-scores.mean())","5ceec5ac":"#Decision Tree:\nfrom sklearn.tree import DecisionTreeRegressor\nmodel = DecisionTreeRegressor()\nscores = cross_val_score(model, X_train_scaled, Y_train, cv = cv,\n                         scoring = scoring, n_jobs = n_jobs)\nnp.sqrt(-scores.mean())","9ce0352c":"#Random Forest:\nfrom sklearn.ensemble import RandomForestRegressor\nmodel = RandomForestRegressor()\nscores = cross_val_score(model, X_train_scaled, Y_train, cv = cv,\n                         scoring = scoring, n_jobs = n_jobs)\nnp.sqrt(-scores.mean())","e344d9f1":"#Deep Learning:\nfrom sklearn.neural_network import MLPRegressor\nmodel = MLPRegressor()\nscores = cross_val_score(model, X_train_scaled, Y_train, cv = cv,\n                         scoring = scoring, n_jobs = n_jobs)\nnp.sqrt(-scores.mean())","6b780158":"#Gradient Boosting\nfrom sklearn.ensemble import GradientBoostingRegressor\nmodel = GradientBoostingRegressor()\nscores = cross_val_score(model, X_train_scaled, Y_train, cv = cv,\n                         scoring = scoring, n_jobs = n_jobs)\nnp.sqrt(-scores.mean())","942121d1":"from sklearn.model_selection import train_test_split\nX_train1, X_test, Y_train1, Y_test = train_test_split(X_train_scaled, Y_train,test_size = 0.2, random_state = 24)","49ae0a98":"model = RandomForestRegressor(n_estimators = 150)\nmodel.fit(X_train1, Y_train1)\n\nfeatures_importances = model.feature_importances_\nargsort = np.argsort(features_importances) #making a ordering of importances\nfeatures_importances_sorted = features_importances[argsort]","f7ad34f1":"feature_names = X_train.columns\nfeatures_sorted = feature_names[argsort]","39051d23":"plt.barh(features_sorted, features_importances_sorted)","e8fcdb40":"Y_pred = model.predict(X_test)","3c37ec27":"from sklearn.metrics import mean_squared_error\nmse = mean_squared_error(Y_test, Y_pred)\nrmse = np.sqrt(mse)","fb9abd1d":"mse","d12a1236":"rmse","6ef3a6b1":"print_every = int(250000 \/ 1000)\n\nfig = plt.figure(figsize=(20,5))\nplt.bar(list(range(len(Y_test[::print_every]))), Y_test.values[::print_every],\n        alpha = 1, color = 'red', width = 1, label = 'true values')\nplt.bar(list(range(len(Y_pred[::print_every]))), Y_pred[::print_every],\n        alpha = 0.5, color = 'blue', width = 1, label = 'predicted values')\nplt.legend()","f8340d5c":"test = pd.read_csv('..\/input\/new-york-city-taxi-fare-prediction\/test.csv',parse_dates = ['pickup_datetime'])","998d9b72":"key = test['key']","17aba394":"#Data\npdt = test['pickup_datetime']\npdt = pdt.map(lambda date: date.tz_localize(None))\ntest.drop(['key'], axis = 1, inplace=True)\ntest['pickup_datetime'] = pdt\n\n#New attributes\ntest['day_of_week'] = test['pickup_datetime'].map(lambda date: date.timetuple().tm_wday)\ntest['day_of_year'] = test['pickup_datetime'].map(lambda date: date.timetuple().tm_yday)\ntest['year'] = test['pickup_datetime'].map(lambda date: date.timetuple().tm_year)\ntest['hour_of_day'] = test['pickup_datetime'].map(lambda date: date.timetuple().tm_hour)\ntest.drop('pickup_datetime', axis = 1, inplace = True)\n\n#Distance\nlon1, lon2 = np.radians(test['pickup_longitude']), np.radians(test['dropoff_longitude'])\nlat1, lat2 = np.radians(test['pickup_latitude']), np.radians(test['dropoff_latitude'])\ndlon = lon2 - lon1\ndlat = lat2 - lat1\n\na = np.sin(dlat\/2)**2 + np.cos(lat1) * np.cos(lat2) * np.sin(dlon\/2)**2\nc = 2 * np.arctan2(np.sqrt(a), np.sqrt(1-a))\ntest['eucl_distance'] = 6373 * c\n\na1 = np.sin(dlon\/2)**2\nc1 = 2 * np.arctan2(np.sqrt(a1), np.sqrt(1-a1))\na2 = np.sin(dlat\/2)**2\nc2 = 2 * np.arctan2(np.sqrt(a2), np.sqrt(1-a2))\ntest['manh_distance'] = 6373 * (c1+c2)","e7f8e90a":"X_test = test\nX_test_scaled = scaler.transform(X_test) #scaled between 0 and 1","9962b4b5":"Y_pred = model.predict(X_test)","6edefce8":"sub = pd.DataFrame({'key': key, 'fare_amount': Y_pred})\nsub.head()\nsub.to_csv('submission.csv', index = False)","3435a485":"![IMAGE](https:\/\/drive.google.com\/file\/d\/1Gv-ttT5bv6h57LoCI8FYJpZzCgp1h9t1\/view?usp=sharing)","0786aad5":"Let's check for missing values:","d396867b":"The 'key' and 'pickup_datetime' attributes are records that contain dates, let's convert them to dates. I will create a new file with only 250000 samples and do the conversion.","df1b1797":"As we can see, the number of passengers does not change the amount to be paid in the fare.\nLet's see if the tariff has anything to do with the day of the week, year and time:","7fe46b34":"We are working with day of the week and year, and considering holidays and breaks. There are leap years in the database, it is from 2009 to 2015, and that gets in the way because if a holiday is on the 34th, with the leap year, it becomes the 35th. First let's see how many records we have on the 29th of February.","aa456a6a":"# **Comparing the models:**","f9b81b2f":"In the graphs we can see that low values, close to zero are very difficult, as well as values that exceed the value of $ 150. Then we will filter within that range.","c96284eb":"Let's check the 'key' and 'pickup_datetime':","c0c9c61a":"I will exclude the variables outside the established ranges and form the database for the training.","289ffa09":"Let's perform a logical command to find out if the columns actually have the same values:","db3217d9":"The max and min values are quite different from the mean and quartiles.","8d6da526":"How the number of records is very large, I'll take a sample of the file so that it's easier to work with the data","e778f689":"Analyzing the fare_amount","394ed596":"We can see that the fixed rates have their standard going from the city center to the international airport. Now let's see if there is a relationship between number of passengers and fares:","226d1d0f":"We can see that we have a pattern forming straight horizontal lines, that means fixed rate, since a path that has a preset value. Let's zoom in on these records for a more detailed view:","5515b0ce":"# **Now creating the predictive attributes and the response attribute**","07b79c31":"![IMAGE](https:\/\/drive.google.com\/file\/d\/18Xtflx7mvncHnW3XfcSSU7NV2XcrCt3E\/view?usp=sharing)","d4d783bf":"We know that distance influences the tariff, so let's see what is the best way to calculate it and use it in the model:","cd13fa28":"As we can see, the 'key' and 'pickup_datetime' columns have similar values for fist and last. We can associate this as an indication that the columns have the same values.","4e1311c9":"#  **Create new features**\nWe can see that distance and duration are important for determining the tariff. But we also see that there are no such characteristics. Something that influences the duration of the trip is the traffic condition.","f3947c7f":"Let's normalize the data as they are on different scales:","c66cb38d":"As we excluded the 29th, we will have to fix the year 2012 because otherwise we will have the holidays on the wrong days. The condition will be 59 days because 31 days (like August, for example) + 28 (February) = 59. And make the correcting the extra days left over because of the leap year, for example, if before it was the 61st, it returns to the 60th.","6c6344d1":"It will count the tariffs, for example: $ 40 there are 7 records. Soon after we will see which are the most common ","29d6cd8b":"It is very strange that a taxi takes 0 people, just as it is impossible to take more than 200 people in a single car. Let's see how many numbers 0 we have and the mean:","0f33b05c":"# Making the importation of the libraries","2059d10e":"# **We will now clean and manipulate the data**","b14a1c4c":"Let's do an analysis of the passenger_count column","23a5983f":"We have no missing values.","deb2d158":"We can see that these variables do not change the rate.","5c92cb38":"Let's create a new variable called 'coordinates' to be able to zoom in on the points located on the map where the fixed rates are:","4bedec25":"As they are just 108, it is a small value compared to all abse of data, so we will exclude it","b67dad2b":"Now let's look at the coordinate attributes.","e3cc6643":"The key column is a primary key and is not used in machine learning models. Com has the same values as pickup_datetime, we will exclude it.","be2a74ec":"If we take the mean latitude and longitude, we can play on Google Maps and find the real location. Let's see:"}}