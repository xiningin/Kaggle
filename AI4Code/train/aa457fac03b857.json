{"cell_type":{"b14eb210":"code","3a2303c4":"code","e3f34347":"code","8247c7c4":"code","4860189b":"code","3cfbbfae":"code","b885483f":"code","13ac8d03":"code","0c755f2e":"code","9cc99a15":"code","0eef4d58":"code","dc35f627":"code","95df32d8":"code","488f0569":"code","ed551f16":"markdown","c57f517e":"markdown","1e93aa51":"markdown","f700bd4e":"markdown","661debb1":"markdown","839fbc22":"markdown","1300207e":"markdown","aff4f7b7":"markdown","654278a7":"markdown","6eea05b8":"markdown","a637d11a":"markdown","dae1d2ea":"markdown","4958c876":"markdown","f5d131e4":"markdown","ddf03e54":"markdown","780e2f46":"markdown","fb457482":"markdown","90e580bc":"markdown"},"source":{"b14eb210":"import numpy as np\nimport pandas as pd","3a2303c4":"from fastai.vision import *\nfrom fastai.metrics import *\nfrom fastai.callbacks.hooks import *\nfrom fastai.utils.mem import *","e3f34347":"# Defining the path where my JPG images are stored:\ntrainpath = \"..\/input\/tray-food-segmentation\/TrayDataset\/TrayDataset\/XTrain\/\"\n\n# Defining the path where the mask PNG images of the images mentioned above are stored:\ntrainlabel = \"..\/input\/tray-food-segmentation\/TrayDataset\/TrayDataset\/yTrain\/\"\n\n# Taking out the JPG filenames out of the training data folder:\nfnames = get_image_files(trainpath)","8247c7c4":"get_y = lambda x: trainlabel + x.stem + '.png' ","4860189b":"for i in range(0,4):\n    img = open_image(fnames[i])\n    mask = open_mask(get_y(fnames[i]))\n    img.show(figsize=(6,6)), mask.show(figsize=(6,6), alpha=1)","3cfbbfae":"src_shape = np.array(mask.shape[1:])\n\nsize = src_shape \/\/ 2\n\nbs = 4","b885483f":"classescsv = pd.read_csv(\"..\/input\/tray-food-segmentation\/classes.csv\")\n\nclassescsv.head()","13ac8d03":"classes = list(classescsv['_class'])","0c755f2e":"src = (SegmentationItemList\n       .from_folder(trainpath)\n       .split_by_rand_pct(.2)\n       .label_from_func(get_y, classes=classes))","9cc99a15":"data = (src.transform(get_transforms(), size=size, tfm_y=True)\n        .databunch(bs=bs)\n        .normalize(imagenet_stats))","0eef4d58":"data.show_batch(1, figsize=(6,6))","dc35f627":"learner = unet_learner(data, models.resnet34)","95df32d8":"learner.fit_one_cycle(12)","488f0569":"learner.show_results(figsize=(15,15))","ed551f16":"Since the both the losses seem small enough, lets predict:","c57f517e":"Noting important measures:","1e93aa51":"# Training and Predicting:","f700bd4e":"Welcome to this notebook where I try to segment pictures of various items on a food tray using UNets with an architecture of ResNet34. This is my first time doing segmentation in computer vision so do correct me and give any suggestions in the comments :)\n\nAn [article on Medium](https:\/\/towardsdatascience.com\/fastai-image-segmentation-eacad8543f6f) about the same helped me quite a lot, so do check it out.","661debb1":"Defining and downloading the UNet:","839fbc22":"# Data Prep:","1300207e":"Lets take a look at the images and their respective masks:","aff4f7b7":"# Importing the Libraries:","654278a7":"Importing the FastAI libraries:","6eea05b8":"Below is a function which defines how our data module will find the labels to the images it learns segmentation with. Lambda in layman's language here refers to defining a function with input x.\n\n*trainlabel* refers to the folder path where all the labels are stored.\n\n*x.stem* refers to the image's name while, .PNG is concatenated with it because the mask is not a JPG but a PNG. ","a637d11a":"Down here I am preparing the data to be trained and fastAI's library is quite simplistic to use like, anyone can train a UNet using it and do segmentation.","dae1d2ea":"Taking a look at an image with its mask:","4958c876":"I will now seperate out the _class since it contains the classes and turn it into a list:","f5d131e4":"Finally defining the data our model will run on:","ddf03e54":"On the left is the actual images while on the left is the predictions! They look almost identical and thereby here I conclude this notebook.\n\nIf you liked this notebook, an upvote would be of tremendous help as I trot forward with my infatuation with Deep Learning :)","780e2f46":"The classes are stored in a csv so taking a look at it:","fb457482":"Training the data:","90e580bc":"![](https:\/\/cdn.theatlantic.com\/thumbor\/npZfAjSjxXVdQoYrvTSm6th1GHY=\/584x0:2917x2333\/500x500\/media\/img\/mt\/2016\/01\/RTX22DCB\/original.jpg)"}}