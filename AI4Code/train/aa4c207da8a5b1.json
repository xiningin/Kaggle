{"cell_type":{"f4feef43":"code","0f901774":"code","d4ae6078":"code","e05bbb10":"code","9634487f":"code","b1285c68":"code","f17505b3":"code","d9c80145":"code","34e7dc01":"code","8e378483":"code","776fbfcc":"code","c765f7c1":"code","b3312092":"code","98303622":"code","37b7f2e6":"code","ce29bb26":"code","c828d6ef":"code","626b3f26":"code","c5c48d09":"code","dd60e178":"code","3ff86d10":"code","1e584a95":"code","cc256fb9":"code","e630eeff":"code","daf565f8":"code","121383de":"code","76b358e3":"code","0ab47aa1":"code","58ba7428":"code","4ba9725c":"code","8a76791a":"code","cdd54aa4":"code","87d29dde":"code","2c9907f7":"code","2780c38f":"code","b63bfd81":"code","c5bec6a0":"code","3721ffb7":"code","d1046f50":"code","08c4b586":"code","a8253a4e":"code","027f99f4":"code","44a68643":"code","a80a156a":"code","1a7f918c":"code","f0536231":"code","cebb831c":"code","5a7e751b":"code","7b5664c0":"code","c875f3e5":"code","5c3ca78d":"code","0ae67037":"code","1382eab4":"code","44cb686a":"code","1d00772a":"code","9e4c9fc6":"code","47fbb625":"code","ddaeccaf":"code","5e3f0921":"code","c7e71b4c":"code","06eec073":"code","0bb3fb32":"code","c88dc421":"code","31c6364a":"code","8e5bee57":"code","51b50a6d":"code","db853f37":"code","72fed424":"code","3cd7ca09":"code","6390994b":"code","ea55944c":"code","313f9f47":"code","275d9e88":"code","e92da065":"code","b65ecf9e":"code","3e5b9da7":"code","fa238b4f":"code","000f67e7":"code","8e142d51":"code","7bb72e5e":"code","8809f199":"code","6b478c5b":"markdown","1286879b":"markdown","e9693eb2":"markdown","3713fb30":"markdown","92bb83a2":"markdown","56e71f26":"markdown","d773c57e":"markdown","6d8bc875":"markdown","8824943f":"markdown","ecba8953":"markdown","768123ce":"markdown","5233644a":"markdown","9ba81208":"markdown","3f9681d9":"markdown","9edbbb03":"markdown","507a80a3":"markdown","95d8b9c7":"markdown","1a6f5f01":"markdown","f2272882":"markdown","99ef9f48":"markdown","eb49c662":"markdown","6dde2746":"markdown","214be8b7":"markdown","5c302af0":"markdown","7478d714":"markdown","47eb5f33":"markdown","d88f147b":"markdown","905fd830":"markdown","1d4252cc":"markdown","0d7fbd74":"markdown","ef7898d9":"markdown","20f8500e":"markdown","2954dd8c":"markdown","8b6d7882":"markdown","808b260d":"markdown","089c7cd8":"markdown","cff1e367":"markdown","37f6c641":"markdown","cef86466":"markdown","5f8404bc":"markdown","65e74eff":"markdown","23212f21":"markdown","320bca4b":"markdown","5e34f114":"markdown","895ae1e2":"markdown","f1548948":"markdown","a8095bc2":"markdown","ab5ef791":"markdown","4cbeb99f":"markdown","924ca4d7":"markdown","a65d175a":"markdown","bd40872e":"markdown"},"source":{"f4feef43":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nfrom matplotlib import pyplot as plt # plotting\nfrom math import * # sqrt() etc\nimport seaborn as sns\n# with %matplotlib inline you turn on the immediate display.\n# %matplotlib inline\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","0f901774":"data_dictionary_loc = '..\/input\/CAB_data_dictionary.xlsx'\ndata_dic = pd.read_excel(data_dictionary_loc, dtype = object)\ndata_dic['File Content Description'] #well, how to import the correct column width? can be viewed using other programs\ndata_dic","d4ae6078":"data_u_pradesh = pd.read_csv('..\/input\/CAB_09_UP.csv', low_memory = False) \n#needed to specify low_memory because columns (14, 43 had mixed types)\ndata_u_pradesh.head()","e05bbb10":"data = data_u_pradesh[(data_u_pradesh['age_code']=='Y')&(data_u_pradesh['age']>=18)]\nlen(data)","9634487f":"data = data.replace([-1, '-1'], np.nan)","b1285c68":"cols_under5 = ['illness_type', 'illness_duration', 'treatment_type']\ncols_under3 = ['first_breast_feeding', 'is_cur_breast_feeding', 'day_or_month_for_breast_feeding_', 'day_or_month_for_breast_feeding', 'water_month', 'ani_milk_month', 'semisolid_month_or_day', 'solid_month', 'vegetables_month_or_day']","f17505b3":"data = data.drop(cols_under5, axis = 1)\ndata = data.drop(cols_under3, axis = 1)","d9c80145":"data = data.drop(['state_code', 'psu_id', 'ahs_house_unit', 'house_hold_no', 'record_code_iodine_reason', 'sl_no', 'usual_residance', 'usual_residance_reason', 'identification_code', 'v54'], axis = 1)","34e7dc01":"data = data.drop('rural_urban', axis = 1)","8e378483":"display(np.unique(data['age_code']))\ndata = data.drop('age_code', axis = 1)","776fbfcc":"plt.hist(data.age.dropna(), bins = 50)\nplt.title('Age')\nplt.show","c765f7c1":"pd.value_counts(data['record_code_iodine'])","b3312092":"data = data.drop(['weight_measured', 'length_height_measured', 'length_height_code'], axis = 1)","98303622":"data = data.rename(index=str, columns={\"weight_in_kg\": \"weight\", \"length_height_cm\": \"height\"})","37b7f2e6":"plt.boxplot(data['weight'].dropna())\nplt.title('Weight with outliers')\nplt.show","ce29bb26":"plt.boxplot(data['height'].dropna())\nplt.title('Height with outliers')\nplt.show","c828d6ef":"# exclude any measurements where difference from median is larger than 3 standard deviations\ndef remove_outliers(data, feature):\n    stdev = sqrt(np.var(data[feature].dropna()))\n    median = np.median(data[feature].dropna())\n    print(\"number of discarded measurements\")\n    display(len(data[[feature]].where(abs(data[feature] - median)>(3*stdev)).dropna()))\n# keep original values if difference from mean is less than 3 standard deviations. NA otherwise\n    return data[[feature]].where(abs(data[feature] - median)<(3*stdev), other = np.nan)","626b3f26":"data['height'] = remove_outliers(data, 'height')","c5c48d09":"print('number of discarded measurements')\ndisplay(len(data[data['weight']<20]))\ndata['weight'] = data['weight'].where(data['weight']>20, other=np.nan)","dd60e178":"plt.boxplot(data['weight'].dropna())\nplt.title('Weight without outliers')\nplt.show","3ff86d10":"plt.boxplot(data['height'].dropna())\nplt.title('Height without outliers')\nplt.show","1e584a95":"data['bmi'] = data['weight']\/(data['height']\/100)**2","cc256fb9":"plt.hist(data['weight'].dropna(), bins = 50)\nplt.title('Weight without outliers')\nplt.show()","e630eeff":"plt.hist(data['height'].dropna(), bins = 50)\nplt.title('Height without outliers')\nplt.show()","daf565f8":"plt.hist(data['bmi'].dropna(), bins = 50)\nplt.title('BMI')\nplt.show()","121383de":"# distribution of measurement differences\n#plt.hist((data['bp_systolic'] - data['bp_systolic_2_reading']).dropna(), bins = 50)\n#plt.hist((data['pulse_rate'] - data['pulse_rate_2_reading']).dropna(), bins = 50)\n#plt.hist((data['bp_diastolic'] - data['bp_diastolic_2reading']).dropna(), bins = 50)","76b358e3":"# for features where two measurements were taken, exclude any where difference between measurements is larger than 3 standard deviations\ndef remove_outliers_difference(data, col1, col2):\n    stdev = sqrt((data[col1] - data[col2]).var())\n# how many measurements were excluded\n    print('number of discarded measurements')\n    display(len(data[[col1, col2]].where(abs(data[col1] - data[col2])>(3*stdev)).dropna()))\n# keep original values if difference of two measurements is less than 3 standard deviations. NA otherwise\n    return data[[col1, col2]].where(abs(data[col1] - data[col2])<(3*stdev), other = np.nan)","0ab47aa1":"data[['bp_systolic', 'bp_systolic_2_reading']] = remove_outliers_difference(data, 'bp_systolic', 'bp_systolic_2_reading')\ndata[['bp_diastolic', 'bp_diastolic_2reading']] = remove_outliers_difference(data, 'bp_diastolic', 'bp_diastolic_2reading')\ndata[['pulse_rate', 'pulse_rate_2_reading']] = remove_outliers_difference(data, 'pulse_rate', 'pulse_rate_2_reading')","58ba7428":"# aggregate two reading by finding mean\ndef aggregate_readings(data, col1, col2):\n    data[col1] = data.apply(lambda row: sum([row[col1], row[col2]])\/2, axis = 1)\n    data = data.drop(col2, axis = 1)\n    return data","4ba9725c":"data = aggregate_readings(data, 'bp_systolic', 'bp_systolic_2_reading')\ndata = aggregate_readings(data, 'bp_diastolic', 'bp_diastolic_2reading')\ndata = aggregate_readings(data, 'pulse_rate', 'pulse_rate_2_reading')","8a76791a":"# retain original values where resting blood pressure lower than beating. NA otherwise \ndata[['bp_diastolic', 'bp_systolic']] = data[['bp_diastolic', 'bp_systolic']].where(data.bp_diastolic < data.bp_systolic, other = np.nan)","cdd54aa4":"data = data.drop(['haemoglobin_test', 'haemoglobin'], axis = 1)","87d29dde":"plt.hist(data.haemoglobin_level[~np.isnan(data.haemoglobin_level)], bins=50)\nplt.title('Blood haemoglobin')\nplt.show","2c9907f7":"data = data.drop(['diabetes_test', 'fasting_blood_glucose'], axis = 1)","2780c38f":"data = data.rename(index = str, columns = {'fasting_blood_glucose_mg_dl' : 'glucose'})","b63bfd81":"plt.hist(data.glucose[~np.isnan(data.glucose)], bins=50)\nplt.title('Blood sugar')\nplt.show","c5bec6a0":"plt.boxplot(data.glucose[~np.isnan(data.glucose)])\nplt.title('Blood sugar')\nplt.show","3721ffb7":"data['glucose'] = remove_outliers(data,'glucose')","d1046f50":"cols_women = ['marital_status', 'gauna_perfor_not_perfor', 'duration_pregnanacy']","08c4b586":"data['marital_status'] = data['marital_status'].where(~(data['marital_status']==8.0), other = np.nan)","a8253a4e":"# input errors have to be dealt with\nplt.boxplot(data['duration_pregnanacy'].dropna())\nplt.show","027f99f4":"corr=data.corr()[['haemoglobin_level', 'pulse_rate', 'bp_diastolic', 'bp_systolic', 'glucose']]\ncorr.where(abs(corr)>0.1)","44a68643":"data_correlated = data.drop(['district_code', 'stratum', 'test_salt_iodine', 'record_code_iodine', 'date_of_birth', 'month_of_birth', 'duration_pregnanacy'], axis = 1)\ncorr = data_correlated.corr()[['haemoglobin_level', 'pulse_rate', 'bp_diastolic', 'bp_systolic', 'glucose']]\ncorr.where(abs(corr)>0.1)","a80a156a":"dummieable =['district_code', 'stratum', 'record_code_iodine', 'sex', 'marital_status', 'gauna_perfor_not_perfor']\ndummiedata = [data]\nfor dum in dummieable: \n    dummiedata.append(pd.get_dummies(data[dum], prefix = dum))\ndummied_data = pd.concat(dummiedata, axis = 1)","1a7f918c":"print(\"Number of features\", len(dummied_data.columns))\ndummied_data.columns","f0536231":"dummied_data = dummied_data.drop(dummieable, axis =1)\nprint(\"Number of features\", len(dummied_data.columns))\ndummied_data.columns","cebb831c":"rename_dict = {'marital_status_1.0': 'never_married', 'marital_status_2.0': 'married_no_gauna',\n               'marital_status_3.0': 'married_and_gauna',\n       'marital_status_4.0': 'remarried', 'marital_status_5.0': 'widow', 'marital_status_6.0': 'divorced',\n       'marital_status_7.0': 'separated', 'gauna_perfor_not_perfor_1.0': 'pregnant',\n       'gauna_perfor_not_perfor_2.0': 'lactating', 'gauna_perfor_not_perfor_3.0': 'non_pregnant_non_lactating',\n        'sex_1': 'male', 'sex_2': 'female'}\ndummied_data = dummied_data.rename(rename_dict, axis = 'columns').drop(['female'], axis = 1)\ndummied_data.columns[70:]","5a7e751b":"ft_without_district = [x for x in dummied_data.columns if not x.startswith('district')]\nft_without_district.remove('glucose')\nprint(\"These\", len(ft_without_district),\"features are going to be compared to diabetes: \\n\")\nprint(ft_without_district)","7b5664c0":"dummied_data['diabetes'] = dummied_data['glucose'].apply(lambda x: 1 if x >= 100 else 0)\ndata['diabetes'] = data['glucose'].apply(lambda x: 1 if x >= 100 else 0)","c875f3e5":"dummied_data.diabetes.value_counts()","5c3ca78d":"# make pairplots of each feature and blood glucose\nimport seaborn as sns\nsns.pairplot(data.dropna(), x_vars = data.columns.drop(['diabetes', 'glucose'])[0:4] , y_vars = ['glucose'])\nsns.pairplot(data.dropna(), x_vars = data.columns.drop(['diabetes', 'glucose'])[4:8] , y_vars = ['glucose'])\nsns.pairplot(data.dropna(), x_vars = data.columns.drop(['diabetes', 'glucose'])[8:12] , y_vars = ['glucose'])\nsns.pairplot(data.dropna(), x_vars = data.columns.drop(['diabetes', 'glucose'])[12:16] , y_vars = ['glucose'])\nsns.pairplot(data.dropna(), x_vars = data.columns.drop(['diabetes', 'glucose'])[16:20] , y_vars = ['glucose'])","0ae67037":"# getting relative frequency of high blood sugar\ndef diabetes_relative_freq(feature):\n    subset = data.groupby(feature)\n    high = pd.Series()\n    for i in np.unique(data[feature]):\n        high = high.append(pd.Series((subset['diabetes'].value_counts()[i]\/sum(subset['diabetes'].value_counts()[i])).loc[1]))\n    high.index = np.arange(1,len(subset)+1)  \n    plt.bar(np.arange(1, len(subset)+1), high)\n    plt.ylabel(\"Realtive freq of high blood sugar\")\n    plt.title(feature)\n    plt.show","1382eab4":"plt.rcParams['figure.figsize'] = [35, 15]\ndiabetes_relative_freq(\"district_code\")","44cb686a":"plt.rcParams['figure.figsize'] = [6, 6]\ndiabetes_relative_freq(\"stratum\")","1d00772a":"plt.rcParams['figure.figsize'] = [6, 6]\ndiabetes_relative_freq('sex')","9e4c9fc6":"ft_with_district = [x for x in dummied_data.columns if x.startswith('district')]\n\nfig = plt.figure(figsize = (20, 50))\n\nfor counter, d in enumerate(ft_with_district): \n    df= dummied_data.loc[dummied_data[d] == 1].glucose.dropna()\n    axes= fig.add_subplot(14, 5, 1+ counter)\n    axes.hist(df, density = True, bins = 20)\n    axes.set_title(d + ' ' +str(df.shape[0]))\nplt.subplots_adjust(wspace = 0.5, hspace = 0.5)\nplt.show()","47fbb625":"var = []\nfor dist in ft_with_district:\n    df= dummied_data.loc[dummied_data[dist] == 1].glucose.dropna()\n    var.append(np.var(df.value_counts().sort_index()))\nprint(\"The lowest glucose distribution variance: \", np.min(var))\nprint(\"The highest glucose distribution variance \", np.max(var))\n\nft_district_droppable = []\nfor d in ft_with_district: \n    df= dummied_data.loc[dummied_data[d] == 1].glucose.dropna()\n    if(np.var(df.value_counts().sort_index()))< 2000: \n        ft_district_droppable.append(d)\nprint(\"The following districts will be discarded: \", ft_district_droppable)","ddaeccaf":"print(dummied_data.shape[1], \"features before\")\ndummied_data.drop(ft_district_droppable, axis = 1, inplace = True)\nprint(dummied_data.shape[1], \"features left\")","5e3f0921":"#transform survey date into year and month\ndef parse(string):\n    return int(string[6:])*10000 + int(string[3:5])*100 + int(string[:2])\ndummied_data['year_month_day_survey'] = dummied_data.date_survey.apply(parse)\ndisplay(dummied_data[['date_survey', 'year_month_day_survey']].head(10))\n\nft_numeric = ['year_month_day_survey','test_salt_iodine', 'age', 'date_of_birth', 'month_of_birth', 'year_of_birth', 'weight', \n              'height', 'haemoglobin_level', 'bp_systolic', 'bp_diastolic', 'duration_pregnanacy',\n              'bmi', 'pulse_rate']\n\ndummied_data.drop('date_survey', axis = 1, inplace = True);","c7e71b4c":"dummied_data['female'] = dummied_data['male'].apply(lambda x: 1 if x == 0 else 0)","06eec073":"ft_cat_no_distr = [x for x in dummied_data.columns if x not in ft_numeric + ft_with_district + ['glucose'] + ['diabetes']]\nfig = plt.figure(figsize = (20, 50))\nstd_dict = {}\n\nfor counter, d in enumerate(ft_cat_no_distr): \n    df= dummied_data.loc[dummied_data[d] == 1].glucose.dropna()\n    std_dict[d] = (np.std(df.value_counts().sort_index()\/np.nanmean(dummied_data.glucose)))\n    axes= fig.add_subplot(14, 5, 1+ counter)\n    axes.hist(df, density = True, bins = 20)\n    axes.set_title(d + ' ' +str(df.shape[0]))\n    \nplt.subplots_adjust(wspace = 0.5, hspace = 0.5)\nplt.show()","0bb3fb32":"std_dict","c88dc421":"dummied_data['stratum_1_2'] = dummied_data['stratum_1'] + dummied_data.stratum_2\nprint(np.nanstd(dummied_data.stratum_1_2.value_counts().sort_index())\/np.nanmean(dummied_data.pulse_rate))\ndummied_data.drop(['stratum_1', 'stratum_2'], axis = 1, inplace = True)","31c6364a":"ft_with_district = [x for x in dummied_data.columns if x.startswith('district')]\nstd_dict = {}\nfor f in ft_with_district: \n    df= dummied_data.loc[dummied_data[f] == 1].pulse_rate.dropna()\n    std_dict[f] = (np.std(df.value_counts().sort_index()\/np.nanmean(dummied_data.glucose)))\ndummied_data['district_signi'] = dummied_data[ft_with_district].sum(axis = 0)\nstd_dict['district_signi'] = (np.std(df.value_counts().sort_index()\/np.nanmean(dummied_data.glucose)))\nstd_dict","8e5bee57":"stds = sorted(list(std_dict.values()))\nstd_treshold = stds[np.round(int(len(stds)*3\/4))]\nfor f in ft_with_district: \n    if std_dict[f] < std_treshold: \n        std_dict.pop(f)","51b50a6d":"dummied_data.drop([x for x in dummied_data[ft_with_district].columns if x not in std_dict.keys()], axis = 1, inplace= True)\nprint(dummied_data.shape[1], \"features left\")","db853f37":"#only apply on numerical features, as categorical ones have too many zeros and might be discarded\n\ndummied_data_numeric = dummied_data[ft_numeric]\n#centralize data\ndummied_data_numeric_cent = (dummied_data_numeric-dummied_data_numeric.mean())\n#normalize by mean to get relative information of the feature\nd = (dummied_data_numeric_cent.apply(np.nanstd, axis= 0))\/dummied_data_numeric.mean()\nprint(\"This is the normalized standard deviation: \")\ndisplay(d)\nft_numeric_selected = d.where(d > 0.11)\nft_numeric_selected = ft_numeric_selected.index[np.where(ft_numeric_selected > 0)].tolist()\nprint(\"The following features will be kept: \", )\ndisplay(ft_numeric_selected)     \nprint(\"The following features will be discarded: \")\nft_numeric_discarded = [x for x in ft_numeric if x not in ft_numeric_selected]\ndisplay(ft_numeric_discarded)","72fed424":"dummied_data['age_orig'] = dummied_data['age']","3cd7ca09":"dummied_data = dummied_data.drop(ft_numeric, axis = 1)\ndummied_data = pd.concat([dummied_data, dummied_data_numeric_cent[ft_numeric_selected]], axis = 1)\nprint(dummied_data.shape[1], \"features left\")","6390994b":"dummied_data.columns","ea55944c":"dummied_data.drop('district_signi', axis = 1, inplace = True)","313f9f47":"cols_women = ['never_married', 'married_no_gauna', 'married_and_gauna', 'remarried', 'widow', 'divorced', 'separated', 'pregnant', 'lactating', 'non_pregnant_non_lactating', 'duration_pregnanacy']\ndata_over45 = dummied_data.where(dummied_data['age_orig']>=45)\ndata_over45.drop('age_orig', axis = 1, inplace = True)\n\nmen_over45 = data_over45.where(dummied_data.male == 1).drop(cols_women, axis = 1).dropna()\nwomen_over45 = data_over45.where(dummied_data.male == 0).dropna()","275d9e88":"from sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(men_over45.drop(['diabetes', 'glucose'], axis = 1).fillna(0),\n                                                    men_over45.diabetes)\nX_train.shape, X_test.shape, y_train.shape, y_test.shape","e92da065":"from sklearn.model_selection import GridSearchCV\nfrom sklearn.metrics import accuracy_score as acc\n\nfrom sklearn.ensemble import RandomForestClassifier\nrfc = RandomForestClassifier()\nrfc_param_grid = {'n_estimators': np.arange(160, 170, 1), \n                  'criterion': ['entropy', 'gini']}\nrfc_grid_search = GridSearchCV(rfc, rfc_param_grid, cv=20, return_train_score=True)\nrfc_grid_search.fit(X_train, y_train)\nrfc_grid_search.best_params_\nprint(\"Accuracy achieved by Random Forest with parameters above: \", \n     acc(y_test, rfc_grid_search.best_estimator_.predict(X_test)))","b65ecf9e":"from sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(women_over45.drop(['diabetes', 'glucose'], axis = 1).fillna(0),\n                                                    women_over45.diabetes)\nX_train.shape, X_test.shape, y_train.shape, y_test.shape","3e5b9da7":"from sklearn.model_selection import GridSearchCV\nfrom sklearn.metrics import accuracy_score as acc\n\nfrom sklearn.ensemble import RandomForestClassifier\nrfc = RandomForestClassifier()\nrfc_param_grid = {'n_estimators': np.arange(160, 170, 1), \n                  'criterion': ['entropy', 'gini']}\nrfc_grid_search = GridSearchCV(rfc, rfc_param_grid, cv=20, return_train_score=True)\nrfc_grid_search.fit(X_train, y_train)\nrfc_grid_search.best_params_\nprint(\"Accuracy achieved by Random Forest with parameters above: \", \n     acc(y_test, rfc_grid_search.best_estimator_.predict(X_test)))","fa238b4f":"data_pregnant = dummied_data.where(dummied_data.pregnant == 1).dropna(how = \"all\")\n# centralized age is used for modeling\ndata_pregnant.drop(['age_orig'], axis = 1, inplace = True)\n#data_pregnant['diabetes'] = data_pregnant.glucose.apply(lambda x : 1 if x > 92 else 0)","000f67e7":"from sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(data_pregnant.drop(['diabetes', 'glucose'], axis = 1).fillna(0),\n                                                    data_pregnant.diabetes)\nX_train.shape, X_test.shape, y_train.shape, y_test.shape","8e142d51":"from sklearn.model_selection import GridSearchCV\nfrom sklearn.metrics import accuracy_score as acc\n\nfrom sklearn.ensemble import RandomForestClassifier\nrfc = RandomForestClassifier()\nrfc_param_grid = {'n_estimators': np.arange(160, 170, 1), \n                  'criterion': ['entropy', 'gini']}\nrfc_grid_search = GridSearchCV(rfc, rfc_param_grid, cv=20, return_train_score=True)\nrfc_grid_search.fit(X_train, y_train)\nrfc_grid_search.best_params_\nprint(\"Accuracy achieved by Random Forest with parameters above: \", \n     acc(y_test, rfc_grid_search.best_estimator_.predict(X_test)))","7bb72e5e":"data_pregnant = dummied_data.where(dummied_data.pregnant == 1).dropna(how = \"all\")\n# centralized age is used for modeling\ndata_pregnant.drop(['age_orig'], axis = 1, inplace = True)\ndata_pregnant['diabetes'] = data_pregnant.glucose.apply(lambda x : 1 if x > 92 else 0)","8809f199":"from sklearn.model_selection import GridSearchCV\nfrom sklearn.metrics import accuracy_score as acc\n\nfrom sklearn.ensemble import RandomForestClassifier\nrfc = RandomForestClassifier()\nrfc_param_grid = {'n_estimators': np.arange(160, 170, 1), \n                  'criterion': ['entropy', 'gini']}\nrfc_grid_search = GridSearchCV(rfc, rfc_param_grid, cv=20, return_train_score=True)\nrfc_grid_search.fit(X_train, y_train)\nrfc_grid_search.best_params_\nprint(\"Accuracy achieved by Random Forest with parameters above: \", \n     acc(y_test, rfc_grid_search.best_estimator_.predict(X_test)))","6b478c5b":"Issues: \n- Method for assigning diabetes categorical variable. Need to take into account NA values.","1286879b":"## Dummies code from Sophie ","e9693eb2":"Urban and rural populations have similar frequency of high blood sugar. Not really informative ","3713fb30":"Removing weight outliers. NA for anything under 20kg","92bb83a2":"Now that outliers have been removed, aggregate remaining data by finding mean between two readings","56e71f26":"From data dictionary:\n- 'rural_urban' - Rural-1; Urban-2\n- 'stratum' - 1 or 2 when 'rural_urban'=1, 0 when 'rural_urban'=2\n\ndropping feature 'rural_urban', since 'stratum' contains the same information\n\nI guess 'stratum' feature values:\n- 0 - urban\n- 1 - rural  \n- 2 - very rural?\n\nnot specified in dictionary","d773c57e":"## Ensemble methods","6d8bc875":"# Overview\nThese models are hoping to predict type 2 diabetes or a prediabetic condition. These are characterized by a fasting blood glucose over 100mg\/dl. India has the largest population of type 2 diabetics in the world. Most patients are diagnosed at 46-47years of age. https:\/\/www.ncbi.nlm.nih.gov\/pmc\/articles\/PMC3920109\/\nThe rising number of diabetic patients in India is thought to be caused by urbanization and excessive weight.\n\nPregnant women also have a higher risk of developing type 2 diabetes. In addition India has a high prevalence of gestational diabetes(gestational==pregnant) compared to world average. https:\/\/www.ncbi.nlm.nih.gov\/pmc\/articles\/PMC4673797\/\n\nThese studies are the reason why the models are hoping to predict high blood glucose specifically in people over 45 and pregnant women.","8824943f":"## Iodine\nFrom data dictionary:\n- 'test_salt_iodine' - Salt used by the Household has been tested for Iodine content[Recorded as Parts Per Million(PPM)]\n- 'record_code_iodine' - No iodine \u2013 1; Less than 15 PPM \u2013 2; More than or equal to 15 PPM \u2013 3; No salt in Household \u2013 4; Salt not tested  \u2013 5","ecba8953":"Predictions for women","768123ce":"77893 individuals have a high fasting blood sugar","5233644a":"# Modeling\nTrying to predict categorical variable \"diabetes\". \n- 1 stands for blood glucose > 100md\/dl","9ba81208":"Results when predicting with blood glucose normal upper limit 100mg\/dl.","3f9681d9":"A lot of individuals with 130, 140, 150cm height","9edbbb03":"# Cleaning data","507a80a3":"Removing features where there's no correlation","95d8b9c7":"Finally remove the old columns, rename the new ones and set all not given data NaN.","1a6f5f01":"Same for relative frequency in men\/women","f2272882":"### Gestational diabetes\nTrying to predict diabetes in pregnant women. This https:\/\/www.ncbi.nlm.nih.gov\/pmc\/articles\/PMC4673797\/ paper suggest that a normal upper limit for fasting blood glucose in pregnant women is 92mg\/dl. The upper limit is slightly higher for the general population. I have taken this into account when assigning the categorical feature \"diabetes\".","99ef9f48":"Blood sugar is very similarly distributed across all features. There are some differences in features only applycable to women(remarried, separated, widow, divorced).","eb49c662":"### Over 45year olds\n- linear svm 68%\n- Ensemble rf for men&women 59%. This took 2 hours since subset of data is so large. \n\nNow looking at men and women separately.","6dde2746":"Based on medical knowledge people with higher weight, bmi and age should have higher blood sugar. These plots don't really depict that, hard to make any judgement.","214be8b7":"### Looking at relative frequency of high blood sugar by different features to find features that might be good indicators of diabetes risk. ","5c302af0":"Blood glucose seems to be quite similarly distributed in all districts. At least there are no districts that remarkably stand out.   ","7478d714":"Results when predicting with blood glucose normal upper limit 92mg\/dl.","47eb5f33":"Original data had -1 for missing values","d88f147b":"Dropping columns only applicable to under 5 year olds","905fd830":"## Height\/weight\nFrom data dictionary:\n- 'weight_measured' - Measured-1;  Member - not present-2, Refused-3, Other-4\n- 'weight_in_kg' - outcome\n- 'length_height_measured' - Measured-1;  Member not present-2, Refused-3, Other-4\n- 'length_height_code' - L- Length, H-Height\n- 'length_height_cm' - outcome\n\nDropping, unnecessary columns, NA in weight\/length column if measurement was not conducted","1d4252cc":"## Age related\nFrom data dictionary:\n- 'age_code' - unit of recording age\n- 'age'\n- 'date_of_birth' - DD\n- 'month_of_birth' - MM\n- 'year_of_birth' - YYYY","0d7fbd74":"# Gather Data","ef7898d9":"Actual age will be needed for filtering, this column will later be dropped. Only centralized age will be used in modeling. ","20f8500e":"Predictions for men","2954dd8c":"Systolic - beating, diastolic - resting blood pressure. Likely input\/measurement error where systolic < diastolic","8b6d7882":"Lets now handle the other categorical features.","808b260d":"Relative frequency of high blood sugar by district. Number of individuals with high blood sugar is normalized by total number of individuals in district. This shows that frequency of high blood sugar might be as low as 10% or as high as 45% depending on the district. So district code might be a good indicator of diabetes risk","089c7cd8":"## Blood sugar(diabetes)\nFrom data dictionary:\n- 'diabetes_test' - consent for testing\n- 'fasting_blood_glucose' - Measured-1; Member not present-2; Refused-3; Other-4\n- 'fasting_blood_glucose_mg_dl' - outcome of test","cff1e367":"## Haemoglobin(anemia)\nFrom data dictionary:\n- 'haemoglobin_test' - Consent for Haemoglobin test (Yes-1; No-2)\n- 'haemoglobin'- Status of Haemoglobin Test (Measured-1; Member not present-2; Refused-3, Other-4)\n- 'haemoglobin_level' - Outcome of Haemoglobin Level (Hb) Test (in percentage gms)  ","37f6c641":"Looking at how each feature correlates to blood sugar values. Using categorical values for depicting blood sugar. Category \"1\" stands for diabetic or prediabetic based on https:\/\/www.mayoclinic.org\/diseases-conditions\/diabetes\/diagnosis-treatment\/drc-20371451","cef86466":"Data cleaning steps for heart disease related data: \n- Discarded any where difference between two measurements was further from mean than 3 standard deviations. Looking at distribution of measurement differences as normally distributed.\n- Aggregated two measurements by finding mean\n- Discarded any where diastolic pressure was higher than systolic\n\nLost less than 5% of values for each feature","5f8404bc":"Dropping unnecessary features\n - 'state_code'\n - 'PSU_ID' - This is a seven digit number to uniquely identify each record.\n - 'ahs_house_unit' - House Number\n - 'house_hold_no' - Household Number\n - 'record_code_iodine_reason' - Why was iodine testing refused\n - 'sl_no' - Each record of the Household has a serial no. \n - 'usual_residence' - Whether the member usually lives here\n - 'usual_residence_reason' - Reason for member not being usual resident\n - 'identification_code' - Each member of a PSU is assigned a unique number\n - 'v54' ?","65e74eff":"placing NA where marital status 'not stated' ","23212f21":"# Patterns in diabetes\n- First trying to see how blood sugar is distributed among general population\n    - among subpopulations? men, women, different counties, strata?\n- Looking to predict gestational diabetes\n    - pregnant women have a higher risk of developing diabetes\n- Creating new categorical column for blood sugar. Where \"1\" stands for (pre)diabetes\n    - 1 >=100mg\/dl\n    - 0 <100mg\/dl\n\nThe data is collected as fasting blood sugar, for which the normal range is <100mg\/dl","320bca4b":"Body mass index: weight(kg)\/(height(m) * height(m))","5e34f114":"## Correlations\nFrom 53 initial features to 21","895ae1e2":"Dropping feature age_code(values: Y, M, D for years, months, days), since age always recorded in years for adults","f1548948":"Dummies should be drawn by all features that are encoded numerically and which are actually categorical. From the 21 remaining, these are\n\ndistrict_code\nstratum\nrecord_code_iodine. Here, 1, 2 and 3 are ordered, while 4 should be 0 (no salt in household) and 5 should be replaced by NaN (no information).\nsex should be replaced by male and female as categorical features.\nmarital status\ngauna_perfor_not_perfor: 1- pregnant, 2-lactating, 3-nothing of both. Better rename to \"pregnant\" and \"lactating\" after OneHoteEncoding","a8095bc2":"Preparing the separate subsets for men and women over 45 years old. For men dropping features only applicable to women.","ab5ef791":"## Features only applicable to women\nFrom data dictionary:\n- 'marital_status' - Never married=1,Married but Gauna not performed=2, Married and Gauna perfomed=3, Remarried=4,Widow=5, Divorced=6, Separated=7, Not stated=8\n- 'gauna_perfor_not_perfor' - Pregnant-1; Lactating-2; Non-pregnant or Non-lactating-3\n- 'duration_pregnanacy' - Duration of pregnancy\/lactation (in months)","4cbeb99f":"## Trying variance filtering techinques","924ca4d7":"Subset of adults has 299 570 individuals","a65d175a":"Data cleaning steps for height\/weight related data: \n- Discarded any height measurements where difference from median was further than 3 standard deviations. Looking at distribution of height\/weight as normally distributed.\n- Discarded any weight measurements under 20kg\n- Calculated BMI\n\nDiscarded ~800 values for height, ~460 values for weight. Out of ~200 000","bd40872e":"## Pulse, blood pressure(heart disease)\nFrom data dictionary:\n- 'bp_systolic'\n- 'bp_systolic_2_reading'\n- 'bp_diastolic'\n- 'bp_diastolic_2reading'\n- 'pulse_rate',\n- 'pulse_rate_2_reading'"}}