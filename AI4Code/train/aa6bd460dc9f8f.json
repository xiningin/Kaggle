{"cell_type":{"2ec9d94a":"code","e9493035":"code","36fce10f":"code","3f08a414":"code","76c92e4d":"code","2d3d61b3":"code","7243e6cf":"code","97b5a088":"code","d60d7c95":"code","55435b74":"code","5e207b87":"code","b38aa474":"code","52116767":"code","8f7fc350":"code","4b0ca379":"code","1f5750a2":"code","5cddcdbc":"code","e8474cad":"code","dda1c446":"markdown","4f6cbacb":"markdown","e4874497":"markdown","87d37fdb":"markdown"},"source":{"2ec9d94a":"from tensorflow.compat.v1 import ConfigProto\nfrom tensorflow.compat.v1 import InteractiveSession\n\nconfig = ConfigProto()\nconfig.gpu_options.per_process_gpu_memory_fraction = 0.8\nconfig.gpu_options.allow_growth = True\nsession = InteractiveSession(config=config)","e9493035":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom sklearn.model_selection import StratifiedKFold\nfrom sklearn.utils import class_weight\nfrom sklearn.metrics import classification_report","36fce10f":"def create_pd(train_path,test_path):\n    train=pd.read_csv(train_path)\n    test=pd.read_csv(test_path)\n    train.columns=[x for x in range(188)]\n    test.columns=[x for x in range(188)]\n    return pd.concat([train,test], axis=0, join='inner').sort_index()\n    ","3f08a414":"mit_train_path=\"..\/input\/heartbeat\/mitbih_train.csv\"\nmit_test_path=\"..\/input\/heartbeat\/mitbih_test.csv\"","76c92e4d":"mit= create_pd(mit_train_path,mit_test_path)\nmit.head()","2d3d61b3":"def create_k_folds_column(df):\n    df.loc[:,'kfold']=-1\n    df=df.sample(frac=1).reset_index(drop=True)\n    y=df.loc[:,187].values\n    kf=StratifiedKFold(n_splits=5)\n    for fold,(target,index) in enumerate(kf.split(X=df,y=y)):\n        df.loc[index,'kfold']=fold\n    return df\n    ","7243e6cf":"mit= create_k_folds_column(mit)","97b5a088":"mit.head()","d60d7c95":"mit.loc[:,187].astype('int').value_counts()","55435b74":"import tensorflow as tf\nfrom tensorflow.keras.layers import Dense, Activation, Flatten, Convolution1D, Dropout,MaxPooling1D,GlobalAveragePooling1D\nfrom tensorflow.keras import Model, layers,Sequential,regularizers\nfrom tensorflow.keras.utils import to_categorical\nfrom tensorflow.keras.callbacks import EarlyStopping,ReduceLROnPlateau\nfrom tensorflow.keras.optimizers import Adam\nfrom tensorflow.keras.callbacks import LearningRateScheduler","5e207b87":"def make_model(X_train):\n    model= Sequential()\n    model.add(Convolution1D(32,5,activation='relu',input_shape=(187,1)))\n    model.add(Convolution1D(64,5,activation='relu'))         \n    model.add(MaxPooling1D(3))\n    model.add(Convolution1D(128, 3, activation='relu'))\n    model.add(Convolution1D(256, 3, activation='relu'))\n    model.add(GlobalAveragePooling1D())\n    model.add(Dropout(0.3))\n    model.add(Flatten())\n    model.add(Dense(1024,activation='relu'))\n    model.add(Dropout(0.3))\n    model.add(Dense(256,activation='relu'))\n    model.add(Dropout(0.3))\n    model.add(Dense(32,activation='relu'))\n    model.add(Dropout(0.3))\n    model.add(Dense(5,activation='softmax'))\n    model.compile(optimizer='adam',loss='categorical_crossentropy',metrics=['accuracy',tf.keras.metrics.AUC(name='auc')])\n    return model\n\n","b38aa474":"def training_data(train,valid):\n    X_train=np.asarray(train.iloc[:,:187].values)\n    y_train=train.iloc[:,187].values\n    X_valid=np.asarray(valid.iloc[:,:187].values)\n    y_valid=valid.iloc[:,187].values\n    X_train=tf.expand_dims(X_train, axis=2)\n    X_valid=tf.expand_dims(X_valid, axis=2)\n    y_train=to_categorical(y_train)\n    y_valid=to_categorical(y_valid)\n    return X_train,y_train,X_valid,y_valid","52116767":"Epochs=100\nBatch_size=64\nmy_callbacks = [EarlyStopping(patience=3,monitor='val_loss', mode='min',restore_best_weights=True),\n               ReduceLROnPlateau(monitor='val_loss', factor=0.1,patience=2, min_lr=0.00001, mode='auto')]\ndict_acc={}\ndict_acc2={}","8f7fc350":"def run_train(fold):\n    train=mit[mit[\"kfold\"]!=fold].reset_index(drop=True)\n    valid=mit[mit[\"kfold\"]==fold].reset_index(drop=True)\n    X_train,y_train,X_valid,y_valid=training_data(train,valid)\n    model=make_model(X_train)\n    history = model.fit(X_train,y_train,validation_split=0.1,batch_size=Batch_size,epochs=Epochs,callbacks=my_callbacks)\n    model.save(f'model{fold}.h5')\n    results = model.evaluate(X_valid, y_valid)\n    print(\"Test Accuracy: {:.2f}%\".format(results[1] * 100))\n    print(\"     Test AUC: {:.4f}\".format(results[2]))\n    dict_acc[f\"{i}\"]= \"Test Accuracy: {:.2f}%\".format(results[1] * 100) \n    \n    ","4b0ca379":"for i in range(5):\n    print(f\"{i}-fold trained\",sep=\"\/n\")\n    run_train(i)\n    print(\"_______________________________\",sep='\/n')\n    print(\"_______________________________\",sep='\/n')","1f5750a2":"print(dict_acc)","5cddcdbc":"mit_model=tf.keras.models.load_model('model1.h5')","e8474cad":"mit_model.summary()","dda1c446":"**Fitting the model**","4f6cbacb":"The MITBIH dataset is constituted of 109446 beats, labeled with 5 different classes :\n\n'N': 0, 'S': 1, 'V': 2, 'F': 3, 'Q': 4\n\nN : Non-ecotic beats (normal beat) \n\nS : Supraventricular ectopic beats \n\nV : Ventricular ectopic beats\n\nF : Fusion Beats \n\nQ : Unknown Beats\n\nThe PTBHB dataset is constituted of 14552 beats, labeled with two different classes :\n\n'0' for normal beat\n'1' for abnormal beat (Myocardial infarction)\n\nAll the beats are recorded with 187 points. The shorter beats are padded with zeros to reach 187.","e4874497":"Model trained with Kfold 1 is with best performance.","87d37fdb":"Defining the model"}}