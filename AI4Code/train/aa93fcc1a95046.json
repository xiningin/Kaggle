{"cell_type":{"ef30abbf":"code","28b6384c":"code","b22bd67e":"code","ba7a5432":"code","fbe981f4":"code","0d380158":"code","21085d51":"code","73c72aea":"code","c0058944":"code","7db5b1f8":"code","b6e5c221":"code","3691fc7f":"code","3494a3b8":"code","50a3d368":"code","4c9b969e":"code","c98f4984":"code","6d6d959c":"code","be3003c7":"code","999914b2":"code","91050bcf":"code","f9350ef4":"code","77a0fcf9":"code","f922f5e6":"code","440dd683":"code","22cd47f0":"code","4c32946e":"code","d728e79a":"code","ab96dc1b":"code","e00a7eba":"code","33e097c4":"code","9c56f040":"code","c13c2f5b":"code","989d004d":"code","32b75392":"code","3f24b29f":"code","85c8d819":"code","e1772b2a":"code","e5b6611a":"code","9de3060b":"code","30c6b237":"code","b6c10fb4":"code","b3ab1910":"code","36c75cec":"code","e0c34db7":"code","0ac7f1c6":"code","1f1a905f":"code","a6dc9adf":"code","506c9449":"code","0827d880":"code","1a397e18":"code","6d6dd1aa":"code","08643ec4":"code","9a9b2481":"code","b61dce5e":"code","edf66260":"code","a0cc5de9":"code","1bfb981f":"code","e0f959a5":"code","99e324a9":"code","3bdaf99b":"code","4d4d8fb2":"code","6701fbf8":"code","435a990f":"code","cc9aca06":"code","f97ac19f":"code","117c1fe7":"code","6d2ee96b":"code","84852a0f":"code","7a64229b":"code","fb0cba62":"code","204395d6":"code","6d9c0d7b":"code","19dd5eec":"code","027bb2ba":"code","66f1c55e":"code","bfe347f3":"code","375aa1ea":"code","1115911c":"code","c73bdef4":"code","286543ad":"code","0acb1ffb":"code","ab71d062":"code","a55ea4a7":"code","6e4d59e3":"code","14374ac3":"code","9f22dd86":"code","37ddf50d":"code","acf13e0e":"code","24be56d6":"code","340eca3d":"code","473685ed":"code","57e6739f":"code","25fb1a63":"code","9230bd81":"markdown","086f647c":"markdown","b3121c58":"markdown","67e24930":"markdown","a3d5221a":"markdown","0e3b294f":"markdown","7dee0623":"markdown","6b541d08":"markdown","0995e6bf":"markdown","6afd088c":"markdown","9c3c6778":"markdown","4f2323ed":"markdown","5fe5b483":"markdown","70a4ffee":"markdown","18eb99a4":"markdown","a48fac27":"markdown","0db111d0":"markdown","4956919e":"markdown","d415736b":"markdown","5906285e":"markdown","6d6b68cb":"markdown","562a53e6":"markdown","c98be97f":"markdown","03be6b9d":"markdown","bf545118":"markdown","0d703c2b":"markdown","cf92f951":"markdown","3ff197da":"markdown","e011edff":"markdown","44c84a95":"markdown","80bed6a8":"markdown","eef4f6b4":"markdown","9598f9e5":"markdown","66cf2395":"markdown","0c27bbf0":"markdown","127cde9f":"markdown","12610da5":"markdown","b05f3e48":"markdown","e82405ed":"markdown","17bb0edb":"markdown","8c422f42":"markdown","751b6ef0":"markdown","130ea232":"markdown","92e894e3":"markdown","d49b8270":"markdown","67575289":"markdown","97b631e4":"markdown","d0680ffc":"markdown"},"source":{"ef30abbf":"import numpy as np\nimport pandas as pd\nimport dask.dataframe as dd\nimport pandas_profiling\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\nimport plotly_express as px\nimport time\nimport random \nfrom sklearn.preprocessing import MinMaxScaler, StandardScaler\nfrom sklearn.model_selection import train_test_split\nfrom pylab import rcParams\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.ensemble import RandomForestRegressor\nfrom sklearn.svm import SVR\nfrom sklearn.neighbors import KNeighborsRegressor\nfrom sklearn.ensemble import AdaBoostRegressor\nfrom sklearn.ensemble import GradientBoostingRegressor\nfrom xgboost.sklearn import XGBRegressor\nimport lightgbm as lgb\nfrom vecstack import stacking\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.model_selection import RandomizedSearchCV\nfrom sklearn import metrics\nimport eli5\nfrom eli5.sklearn import PermutationImportance\nimport lime\nimport lime.lime_tabular\nimport shap\nimport geopandas as gpd\nfrom shapely.geometry import Point,Polygon\nimport descartes","28b6384c":"#Read data through Pandas and compute time taken to read\ndf_taxi = pd.read_csv('..\/input\/nyc-taxi-trip-duration\/train.zip',parse_dates=['pickup_datetime','dropoff_datetime'],infer_datetime_format=True)","b22bd67e":"#Getting the head of the dataset\ndf_taxi.head(5)","ba7a5432":"#Shape of the dataset\ndf_taxi.shape","fbe981f4":"#Data Type of features for dataset\ndf_taxi.dtypes","0d380158":"#Info of the dataset\ndf_taxi.info()","21085d51":"#Checking for null values in dataset\ndf_taxi.isnull().sum()","73c72aea":"#Checking duplicate value in vendor_id\ndf_taxi[df_taxi.duplicated(['id'], keep=False)]","c0058944":"#Checking Date and Time range\nprint('Datetime range: {} to {}'.format(df_taxi.pickup_datetime.min(),df_taxi.dropoff_datetime.max()))","7db5b1f8":"#Checking no. of vendors\ndf_taxi['vendor_id'].value_counts()","b6e5c221":"#Checking Passenger count\nprint('Passenger Count: {} to {}'.format(df_taxi.passenger_count.min(),df_taxi.passenger_count.max()))","3691fc7f":"#The distribution of Pickup and Drop Off day of the week\nprint(df_taxi['pickup_datetime'].nunique())\nprint(df_taxi['dropoff_datetime'].nunique())","3494a3b8":"#Performing Pandas profiling to understand quick overview of columns\nreport = pandas_profiling.ProfileReport(df_taxi)\n#coverting profile report as html file\nreport.to_file('taxi_train.html')\n\nfrom IPython.display import display,HTML,IFrame\ndisplay(HTML(open('taxi_train.html').read()))  ","50a3d368":"#Summary statistics for the dataset\ndf_taxi.describe()","4c9b969e":"#Passenger Count\nsns.distplot(df_taxi['passenger_count'],kde=False)\nplt.title('Distribution of Passenger Count')\nplt.show()","c98f4984":"#Creating pickup and dropoff day\ndf_taxi['pickup_day']=df_taxi['pickup_datetime'].dt.day_name()\ndf_taxi['dropoff_day']=df_taxi['dropoff_datetime'].dt.day_name()","6d6d959c":"#Creating pickup and dropoff month\ndf_taxi['pickup_month']=df_taxi['pickup_datetime'].dt.month\ndf_taxi['dropoff_month']=df_taxi['dropoff_datetime'].dt.month","be3003c7":"#Creating pickup and dropoff hour\ndf_taxi['pickup_hour']=df_taxi['pickup_datetime'].dt.hour\ndf_taxi['dropoff_hour']=df_taxi['dropoff_datetime'].dt.hour","999914b2":"df_taxi.head(2)","91050bcf":"#Plotting monthly Pickup and Dropoff trip distribution\nfigure,ax=plt.subplots(nrows=1,ncols=2,figsize=(15,4))\nsns.countplot(x='pickup_month',data=df_taxi,ax=ax[0])\nax[0].set_title('The distribution of number of pickups each month')\nsns.countplot(x='dropoff_month',data=df_taxi,ax=ax[1])\nax[1].set_title('The distribution of number of dropoffs each month')\nplt.tight_layout()","f9350ef4":"#Plotting daily Pickup and Dropoff trip distribution\nfigure,ax=plt.subplots(nrows=1,ncols=2,figsize=(15,4))\nsns.countplot(x='pickup_day',data=df_taxi,ax=ax[0])\nax[0].set_title('The distribution of number of pickups each day')\nsns.countplot(x='dropoff_day',data=df_taxi,ax=ax[1])\nax[1].set_title('The distribution of number of dropoffs each day')\nplt.tight_layout()","77a0fcf9":"#Plotting hourly Pickup and Dropoff trip distribution\nfigure,ax=plt.subplots(nrows=1,ncols=2,figsize=(20,5))\nsns.countplot(x='pickup_hour',data=df_taxi,ax=ax[0])\nax[0].set_title('The distribution of number of pickups each hour')\nsns.countplot(x='dropoff_hour',data=df_taxi,ax=ax[1])\nax[1].set_title('The distribution of number of dropoffs each hour')\nplt.tight_layout()","f922f5e6":"#Creating a new column according to the traffic scenerio of New York\ndef rush_hour(hour):\n    if hour.item()>=7 and hour.item()<=9:\n        return 'rush_hour_morning(7-9)'\n    elif hour.item()>9 and hour.item()<16:\n        return 'normal_hour_afternoon(9-16)'\n    elif hour.item()>=16 and hour.item()<=19:\n        return 'rush_hour_evening(16-19)'\n    elif hour.item()>19 and hour.item()<=23:\n        return 'normal_hour_evining(19-23)'\n    else:\n        return 'latenight(23 onwards)'\ndf_taxi['traffic_scenerio_pickup']=df_taxi[['pickup_hour']].apply(rush_hour, axis=1)\ndf_taxi['traffic_scenerio_dropoff']=df_taxi[['dropoff_hour']].apply(rush_hour, axis=1)","440dd683":"#Plotting pickup and dropoff trip distribution as per traffic scenerio\nfigure,ax=plt.subplots(nrows=1,ncols=2,figsize=(20,5))\nsns.countplot(x='traffic_scenerio_pickup',data=df_taxi,ax=ax[0])\nax[0].set_title('The distribution of number of pickups as per traffics scenerio')\nsns.countplot(x='traffic_scenerio_dropoff',data=df_taxi,ax=ax[1])\nax[1].set_title('The distribution of number of dropoffs as per traffics scenerio')\nplt.tight_layout()","22cd47f0":"sns.distplot(df_taxi['trip_duration'],kde=True)\nplt.title('The distribution of of the Pick Up  Duration distribution')","4c32946e":"sns.boxplot(df_taxi['trip_duration'], orient='horizontal')\nplt.title('A boxplot depicting the pickup duration distribution')","d728e79a":"#Dropping trip_duration <1 min\ndf_taxi= df_taxi[df_taxi.trip_duration>60] # >1 min","ab96dc1b":"#Dropping trip_duration >2 Hrs\ndf_taxi= df_taxi[df_taxi.trip_duration<=7200] # >2 hrs","e00a7eba":"sns.countplot(x='vendor_id',data=df_taxi)","33e097c4":"#Checking Longitude and Lattitude bounds available in the data\nprint('Longitude Bounds: {} to {}'.format(max(df_taxi.pickup_longitude.min(),df_taxi.dropoff_longitude.min()),max(df_taxi.pickup_longitude.max(),df_taxi.dropoff_longitude.max())))\nprint('Lattitude Bounds: {} to {}'.format(max(df_taxi.pickup_latitude.min(),df_taxi.dropoff_latitude.min()),max(df_taxi.pickup_latitude.max(),df_taxi.dropoff_latitude.max())))","9c56f040":"#The borders of NY City, in coordinates comes out to be: city_long_border = (-74.03, -73.75) & city_lat_border = (40.63, 40.85)\n#Comparing this to our 'df_taxi.describe()' output we see that there are some coordinate points (pick ups\/drop offs) that fall outside these borders. So let's limit our area of investigation to within the NY City borders.\ndf_taxi = df_taxi[df_taxi['pickup_longitude'] <= -73.75]\ndf_taxi = df_taxi[df_taxi['pickup_longitude'] >= -74.03]\ndf_taxi = df_taxi[df_taxi['pickup_latitude'] <= 40.85]\ndf_taxi = df_taxi[df_taxi['pickup_latitude'] >= 40.63]\ndf_taxi = df_taxi[df_taxi['dropoff_longitude'] <= -73.75]\ndf_taxi = df_taxi[df_taxi['dropoff_longitude'] >= -74.03]\ndf_taxi = df_taxi[df_taxi['dropoff_latitude'] <= 40.85]\ndf_taxi = df_taxi[df_taxi['dropoff_latitude'] >= 40.63]","c13c2f5b":"#Getting distance(in km) from geographocal co-ordinates\nfrom math import radians, sin, cos, sqrt, asin\ndef haversine(columns):\n    lat1, lon1, lat2, lon2 = columns\n    R = 6372.8 # Earth radius in kilometers\n    \n    dLat = radians(lat2 - lat1)\n    dLon = radians(lon2 - lon1)\n    lat1 = radians(lat1)\n    lat2 = radians(lat2)\n    \n    a = sin(dLat\/2)**2 + cos(lat1)*cos(lat2)*sin(dLon\/2)**2\n    c = 2*asin(sqrt(a))\n    \n    return R * c\n\ncols = ['pickup_latitude','pickup_longitude','dropoff_latitude','dropoff_longitude']\ndistances = df_taxi[cols].apply(lambda x: haversine(x),axis = 1)\ndf_taxi['distance_km'] = distances.copy()\ndf_taxi['distance_km'] = round(df_taxi.distance_km,2)","989d004d":"sns.scatterplot(x='distance_km',y='trip_duration',data=df_taxi)","32b75392":"#Removing distance Outliers\ndf_taxi = df_taxi[df_taxi['distance_km'] > 0]","3f24b29f":"#Getting Speed(Km\/h) of the taxi \ndf_taxi['speed_km\/h']= 3600*(df_taxi.distance_km\/df_taxi.trip_duration)  #3600 to convert it from km\/s to km\/h","85c8d819":"#Checking Distance and Speed range\nprint('Distance Bounds: {} to {}'.format(df_taxi.distance_km.min(),df_taxi.distance_km.max()))\nprint('Speed Bounds: {} to {}'.format(df_taxi['speed_km\/h'].min(),df_taxi['speed_km\/h'].max()))","e1772b2a":"#Removing speed Outliers\ndf_taxi = df_taxi[df_taxi['speed_km\/h'] > 0]\ndf_taxi = df_taxi[df_taxi['speed_km\/h'] < 100]","e5b6611a":"#Dropping passenger count=0\ndf_taxi= df_taxi[df_taxi.passenger_count>0]\ndf_taxi['passenger_count'].value_counts()","9de3060b":"#Plotting Trip Distribution\nplt.figure(figsize=(10,6))\nplt.hist(df_taxi.trip_duration, bins=100)\nplt.xlabel('Trip_duration')\nplt.ylabel('Number of Trips')\nplt.title('Trip Distribution')\nplt.show()","30c6b237":"#Applying Feature Scaling in trip_duration caloumn to normalize the data\ndf_taxi['log_trip_duration']= np.log1p(df_taxi['trip_duration'])\nplt.hist(df_taxi['log_trip_duration'].values, bins=100)\nplt.title('Log Trip Distribution')\nplt.xlabel('log(trip_duration)')\nplt.ylabel('Number of Trips')\nplt.show()\nsns.distplot(df_taxi[\"log_trip_duration\"], bins =100)","b6c10fb4":"#Visualizing Passenger road map for picking up\nfig, ax = plt.subplots(ncols=1, nrows=1,figsize=(10,8))\nplt.ylim(40.63, 40.85)\nplt.xlim(-74.03,-73.75)\nax.scatter(df_taxi['pickup_longitude'],df_taxi['pickup_latitude'], s=0.02, alpha=1)","b3ab1910":"#Visualizing Passenger road map for dropoff\nfig, ax = plt.subplots(ncols=1, nrows=1,figsize=(10,8))\nplt.ylim(40.63, 40.85)\nplt.xlim(-74.03,-73.75)\nax.scatter(df_taxi['dropoff_longitude'],df_taxi['dropoff_latitude'], s=0.02, alpha=1)","36c75cec":"#Converting Data to Geo Dataframe for pickup \ngdf=gpd.GeoDataFrame(df_taxi,geometry=gpd.points_from_xy(df_taxi['pickup_longitude'],df_taxi['pickup_latitude']))","e0c34db7":"#Geometry point has been generated for pickup\ngdf.head(2)","0ac7f1c6":"#Visulizing pickup points with geopandas\ngdf.plot(figsize=(12,10))","1f1a905f":"#Getting New York City map from Geopandas\nnyc = gpd.read_file(gpd.datasets.get_path('nybb'))\nax = nyc.plot(figsize=(12, 10))","a6dc9adf":"#Applying one hot encoding to the catagorical variables\ntaxi_vendor=pd.get_dummies(df_taxi['vendor_id'], prefix='vendor_id',drop_first= True)\ntaxi_pax=pd.get_dummies(df_taxi['passenger_count'], prefix='passenger',drop_first= True)\ntaxi_store_and_fwd_flag=pd.get_dummies(df_taxi['store_and_fwd_flag'], prefix='store_and_fwd_flag',drop_first= True)\ntaxi_pickup_day=pd.get_dummies(df_taxi['pickup_day'], prefix='pickup_day',drop_first= True)\ntaxi_dropoff_day=pd.get_dummies(df_taxi['dropoff_day'], prefix='dropoff_day',drop_first= True)\ntaxi_pickup_month=pd.get_dummies(df_taxi['pickup_month'], prefix='pickup_month',drop_first= True)\ntaxi_dropoff_month=pd.get_dummies(df_taxi['dropoff_month'], prefix='dropoff_month',drop_first= True)\ntaxi_pickup_traffic_scenerio=pd.get_dummies(df_taxi['traffic_scenerio_pickup'], prefix='pickup_',drop_first= True)\ntaxi_dropoff_traffic_scenerio=pd.get_dummies(df_taxi['traffic_scenerio_dropoff'], prefix='dropoff_',drop_first= True)","506c9449":"#Adding encoded columns to final data\ndf_taxi=pd.concat([df_taxi,taxi_pax,taxi_vendor,taxi_store_and_fwd_flag,taxi_pickup_day,taxi_dropoff_day,taxi_pickup_month,taxi_dropoff_month,taxi_pickup_traffic_scenerio,taxi_dropoff_traffic_scenerio],axis=1)","0827d880":"df_taxi.head(2)","1a397e18":"#Dropping unnecessary columns from dataset\ndf_taxi=df_taxi.drop(['id','vendor_id','passenger_count','pickup_datetime','dropoff_datetime','pickup_longitude','pickup_latitude','dropoff_longitude','dropoff_latitude','log_trip_duration','speed_km\/h','store_and_fwd_flag','traffic_scenerio_pickup','traffic_scenerio_dropoff','pickup_month','dropoff_month','pickup_day','dropoff_day','pickup_hour','dropoff_hour','geometry','dropoff_month_7'],axis=1)","6d6dd1aa":"df_taxi.columns","08643ec4":"#Assigning X and y variables\nX = df_taxi.drop('trip_duration',1)\ny = df_taxi['trip_duration']","9a9b2481":"#Splitting the dataset into train and test\nX_train,X_test,y_train,y_test = train_test_split(X,y,test_size=0.25,random_state=0)","b61dce5e":"lr = LinearRegression()\nlr.fit(X_train,y_train)\nlr_pred = lr.predict(X_test)","edf66260":"#RMSE score \nlr_rmse = np.sqrt(metrics.mean_squared_error(lr_pred,y_test))\nlr_rmse","a0cc5de9":"#R2 score\nlr_r2score = metrics.r2_score(lr_pred,y_test)\nlr_r2score","1bfb981f":"#Train Score\nlr_train=lr.score(X_train,y_train)\nlr_train","e0f959a5":"#Test Score\nlr_test=lr.score(X_test,y_test)\nlr_test","99e324a9":"#Null RMSE\ny_null=np.zeros_like(y_test,dtype=float)\ny_null.fill(y_test.mean())\nnp.sqrt(metrics.mean_squared_error(y_test,y_null))","3bdaf99b":"coef1 = pd.DataFrame(lr.coef_,index=X_train.columns)\ncoef1.plot(kind='bar', title='Model Coefficients')","4d4d8fb2":"dt=DecisionTreeRegressor()\ndt.fit(X_train,y_train)\ndt_pred=dt.predict(X_test)","6701fbf8":"#RMSE score \ndt_rmse = np.sqrt(metrics.mean_squared_error(dt_pred,y_test))\ndt_rmse","435a990f":"#R2 score\ndt_r2score = metrics.r2_score(dt_pred,y_test)\ndt_r2score","cc9aca06":"#Train Score\ndt_train=dt.score(X_train,y_train)\ndt_train","f97ac19f":"#Test Score\ndt_test=dt.score(X_test,y_test)\ndt_test","117c1fe7":"rf=RandomForestRegressor()\nrf.fit(X_train,y_train)\nrf_pred=rf.predict(X_test)","6d2ee96b":"#RMSE score \nrf_rmse = np.sqrt(metrics.mean_squared_error(rf_pred,y_test))\nrf_rmse","84852a0f":"#R2 score\nrf_r2score = metrics.r2_score(rf_pred,y_test)\nrf_r2score","7a64229b":"#Train Score\nrf_train=rf.score(X_train,y_train)\nrf_train","fb0cba62":"#Test Score\nrf_test=rf.score(X_test,y_test)\nrf_test","204395d6":"ab=AdaBoostRegressor()\nab.fit(X_train,y_train)\nab_pred=ab.predict(X_test)","6d9c0d7b":"#RMSE score \nab_rmse = np.sqrt(metrics.mean_squared_error(ab_pred,y_test))\nab_rmse","19dd5eec":"#R2 score\nab_r2score = metrics.r2_score(ab_pred,y_test)\nab_r2score","027bb2ba":"#Train Score\nab_train=ab.score(X_train,y_train)\nab_train","66f1c55e":"#Test Score\nab_test=ab.score(X_test,y_test)\nab_test","bfe347f3":"gb = GradientBoostingRegressor()\ngb.fit(X_train,y_train)\ngb_pred = gb.predict(X_test)","375aa1ea":"#RMSE score \ngb_rmse = np.sqrt(metrics.mean_squared_error(gb_pred,y_test))\ngb_rmse","1115911c":"#R2 score\ngb_r2score = metrics.r2_score(gb_pred,y_test)\ngb_r2score","c73bdef4":"#Train Score\ngb_train=gb.score(X_train,y_train)\ngb_train","286543ad":"#Test Score\ngb_test=gb.score(X_test,y_test)\ngb_test","0acb1ffb":"xgb= XGBRegressor()\nxgb.fit(X_train,y_train)\nxgb_pred=xgb.predict(X_test)","ab71d062":"#RMSE score \nxgb_rmse = np.sqrt(metrics.mean_squared_error(xgb_pred,y_test))\nxgb_rmse","a55ea4a7":"#R2 score\nxgb_r2score = metrics.r2_score(xgb_pred,y_test)\nxgb_r2score","6e4d59e3":"#Train Score\nxgb_train=xgb.score(X_train,y_train)\nxgb_train","14374ac3":"#Test Score\nxgb_test=xgb.score(X_test,y_test)\nxgb_test","9f22dd86":"lgbm = lgb.LGBMRegressor()\nlgbm.fit(X_train,y_train)\nlgbm_pred = lgbm.predict(X_test)","37ddf50d":"#RMSE score \nlgbm_rmse = np.sqrt(metrics.mean_squared_error(lgbm_pred,y_test))\nlgbm_rmse","acf13e0e":"#R2 score\nlgbm_r2score = metrics.r2_score(lgbm_pred,y_test)\nlgbm_r2score","24be56d6":"#Train Score\nlgbm_train=lgbm.score(X_train,y_train)\nlgbm_train","340eca3d":"#Test Score\nlgbm_test=lgbm.score(X_test,y_test)\nlgbm_test","473685ed":"#Creating dictionary for all the metrics and models\nmetrics = {'Metrics': ['RMSE Score','R2 Score','Train Score','Test Score'],'Linear Regression':[lr_rmse,lr_r2score,lr_train,lr_test],\n          'Decision Tree Regressor':[dt_rmse,dt_r2score,dt_train,dt_test],'Random Forest Regressor':[rf_rmse,rf_r2score,rf_train,rf_test],\n        'AdaBoost Regressor':[ab_rmse,ab_r2score,ab_train,ab_test],\n          'GradientBoosting Regressor':[gb_rmse,gb_r2score,gb_train,gb_test],'XGBoost Regressor':[xgb_rmse,xgb_r2score,xgb_train,xgb_test],\n           'LGBM Regressor':[lgbm_rmse,lgbm_r2score,lgbm_train,lgbm_test]}","57e6739f":"#Converting dictionary to dataframe\nmetrics = pd.DataFrame(metrics)\nmetrics","25fb1a63":"#Finding the importance of columns for prediction\nperm = PermutationImportance(xgb, random_state=1).fit(X_test,xgb_pred)\neli5.show_weights(perm, feature_names = X_test.columns.tolist())","9230bd81":"## 5. Descriptive Statistics of the dataset <a id='describe'> ","086f647c":"**There is not so much of difference in Pickup and dropoff month.**","b3121c58":"##### Categorical Encoding - One Hot Encoding","67e24930":"**Limited the New York City boundary as per City Long and Lat Boundary!**","a3d5221a":"## 1. Dataset Description <a id='dataset'>\n\n<p\/>\nThe data set contains the data regarding several taxi trips and its duration in New York City. I will now try and apply different techniques of Data Analysis to get insights about the data and determine how different variables are dependent on the target variable Trip Duration.My objective is to build a model that predicts the total trip duration of taxi trips in New York City.\n\n\n<p\/>\n<b>File Descriptions:<\/b>\n<br\/>\n<b>taxi_train.csv<\/b> - the training set (contains 1458644 trip records)\n\n<p\/>\n<b>Data Fields:<\/b>\n<br\/>\n<b>id<\/b> - a unique identifier for each trip.<br\/>\n<b>vendor_id<\/b> - a code indicating the provider associated with the trip record <br\/>\n<b>pickup_datetime<\/b> - date and time when the meter was engaged. <br\/>\n<b>dropoff_datetime<\/b> - date and time when the meter was disengaged.<br\/>\n<b>passenger_count<\/b> - the number of passengers in the vehicle (driver entered value). <br\/>\n<b>pickup_longitude<\/b> - the longitude where the meter was engaged. <br\/>\n<b>pickup_latitude<\/b> - the latitude where the meter was engaged. <br\/>\n<b>dropoff_longitude<\/b> - the longitude where the meter was disengaged. <br\/>\n<b>dropoff_latitude<\/b> - the latitude where the meter was disengaged.<br\/>\n<b>store_and_fwd_flag<\/b> - This flag indicates whether the trip record was held in vehicle memory before sending to the vendor because the vehicle did not have a connection to the server - Y=store and forward; N=not a store and forward trip.<br\/>\n<b>trip_duration<\/b> - duration of the trip in seconds.<br\/>","0e3b294f":"## 6. Exploratory Data Analysis(EDA) <a id='EDA'> ","7dee0623":"### 8.3. Building Random Forest Regressor Model <a id='rf'>","6b541d08":"### 8.1. Building Linear Regression Model <a id='logreg'>","0995e6bf":"**Data is of 6 full months, from January 2016 to June 2016!**","6afd088c":"#### Distribution of vendor_id","9c3c6778":"### Feature Engineering & Data Visualization<a id='feature'>","4f2323ed":"### 8.5. Building GradientBoosting Regressor Model <a id='gb'>","5fe5b483":"**This histogram shows extreme right skewness, hence there are outliers. Lets see the boxplot of this variable.**","70a4ffee":"**In this project we covered various aspects of the Machine learning development cycle. We observed that the data exploration and variable analysis is a very important aspect of the whole cycle and should be done for thorough understanding of the data. We also cleaned the data while exploring as there were some outliers which should be treated before feature engineering. Further we did feature engineering to filter and gather only the optimal features which are more significant and covered most of the variance in the dataset. Then finally we trained the models on the optimum featureset to get the results.**","18eb99a4":"**Here we can see that mostly 1 or 2 passengers avail the taxi. The instance of large group of people travelling together is rare.**","a48fac27":"**We can see that the regression model with all the columns performed well except few columns.**","0db111d0":"### 8.7. Building LGBM Regressor Model <a id='lgbm'>","4956919e":"#### Analysing geographical boundary of NYC.","d415736b":"## 3. Loading the data <a id='read'>\n\nWe'll be working with a dataset that was used in a Kaggle competition ([data dictionary](https:\/\/www.kaggle.com\/c\/nyc-taxi-trip-duration\/overview)).","5906285e":"## 10. Model Explanability <a id='explain'> ","6d6b68cb":"## 11. Closing Remarks <a id='close'> ","562a53e6":"**We can see most trips were taken on Friday & least trips were taken on Monday.**","c98be97f":"**Removed average speed equals to zero and more than 100, as its seems to be outliers.**","03be6b9d":"#### Lets create some features from datetime stamp. ","bf545118":"## 7. Spliting Dataset into Train and Test <a id='split'> ","0d703c2b":"### 8.4. Building AdaBoost Regressor Model <a id='ab'>","cf92f951":"**We can overlap datapoints to the map for getting better idea!**","3ff197da":"#### Lets have a look at the distribution of various variables in the Data set.","e011edff":"**Looking at the above Performance Matrix we can say thay XGBoost is the best model for this dataset.We may perform hyperparameter tuning on XGBoost model to improve the performance of the model**","44c84a95":"### 10.1. Eli5<a id='eli5'>","80bed6a8":"## 2. Import relevent packages <a id='package'>","eef4f6b4":"## 9. Model Performance Assessment <a id='perform'> ","9598f9e5":"**There are many different pickup and drop off dates in these 2 columns.**","66cf2395":"### 8.2. Building Decision Tree Regressor Model <a id='dt'>","0c27bbf0":"**We have 1458644 observations, 11 features, and our target variable is trip_duration**","127cde9f":"**We can see there are few outliers, which we have to treat.**","12610da5":"### 8.6. Building XGB Regressor Model <a id='xgb'>","b05f3e48":"## 4. Data Wrangling\/Explore the Dataset <a id='explore'>","e82405ed":"#### Distribution of the trip duration","17bb0edb":"## 8. Learning Algorithm Selection<a id='algo'> ","8c422f42":"**The distribution of vendor id is not much different.**","751b6ef0":"**Removed distance which have 0 value,seems to be cancelled trips.**","130ea232":"**Great!No missing values in the dataset.**","92e894e3":"# Machin Learning Model on NYC Taxi Trip Duration\n\n## Agenda\n\n1. [Dataset Description](#dataset)\n2. [Import relevant packages](#package)\n3. [Loading the data](#read)\n4. [Data Wrangling\/Explore the Dataset](#explore)\n5. [Descriptive Statistics of the dataset](#describe)\n6. [Exploratory Data Analysis(EDA)](#EDA)\n    - 6.1. [Data Visualization](#visualize)\n    - 6.2. [Feature Engineering](#feature)\n7. [Spliting Dataset into Train and Test](#split)\n8. [Learning Algorithm Selection](#algo)\n    - 8.1 [Building Linear Regression Model](#logreg)\n    - 8.2 [Building Decision Tree Regressor Model](#dt)\n    - 8.3 [Building Random Forest Regressor Model](#rf)\n    - 8.4 [Building AdaBoost Regressor Model](#ab)\n    - 8.5 [Building GradientBoosting Regressor Model](#gb)\n    - 8.6 [Building XGB Regressor Model](#xgb)\n    - 8.7 [Building LGBM Regressor Model](#lgbm)\n9. [Model Performance Assessment](#perform)\n    - 9.1 [RMSE Score](#perform)\n    - 9.2 [R2 Score](#perform)\n    - 9.3 [Train and Test Score](#perform)\n10. [Model Explanability](#explain)\n    - 10.1 [Eli5](#eli5)\n    - 10.2 [LIME](#lime)\n    - 10.3 [SHAP](#shap)\n11. [Closing Remarks](#close)","d49b8270":"**Seems the distribution is skewed so we can apply certain transforms such as log transform!**","67575289":"**Removed trip duration of less than 1 min and greater than 2 hrs as its not looking sensible that one can hire taxi for less than a min or more that 2 hrs in a city like New York!**","97b631e4":"**Both the distribution looks quite similiar,majority of the trip has been booked from 6PM to 10PM.**","d0680ffc":"**No duplicastes available in id which is trip id!**"}}