{"cell_type":{"e7ca5402":"code","294f631d":"code","f09f7867":"code","10ebd269":"code","2a23f8f0":"code","669f98d7":"code","eef4f0e2":"code","883c1450":"code","5dc35cf6":"code","57b67841":"code","b9c656f9":"code","c2d56f63":"code","d34a16e8":"code","bd8b97d0":"code","c9a488d6":"code","43f5735b":"code","bf754107":"code","06095664":"code","cdde8a47":"code","913eb59c":"code","c106ed9e":"code","60c9c125":"code","1138c32c":"code","d5fa75fb":"code","8fce5eb0":"code","29ea6502":"code","c6d147fb":"code","8f79f650":"code","ae1f9d9b":"code","f3816818":"code","59f02600":"code","bc919cec":"code","ea9bc9cd":"code","8b7dce3e":"code","9088e81f":"markdown","32ded4cb":"markdown","d53212c5":"markdown","d94b4c34":"markdown","47ccfd34":"markdown","3f4cd357":"markdown","e34177fb":"markdown","7031bef9":"markdown","7e61c52a":"markdown","0600e15f":"markdown","b2d941bc":"markdown","b1059fd4":"markdown","bef1cd4b":"markdown","92a02bee":"markdown","8f87a04a":"markdown","01f0aa29":"markdown","f24eb2bd":"markdown","49ff7c7d":"markdown"},"source":{"e7ca5402":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline","294f631d":"df = pd.read_csv(\"..\/input\/travel-insurance\/travel insurance.csv\")","f09f7867":"df.head()","10ebd269":"df.info()","2a23f8f0":"def cleanYesNo(s):\n    if s == \"Yes\":\n        return 1\n    elif s == \"No\":\n        return 0\n\ndf[\"Claim0\"] = df.loc[:,'Claim'].apply(cleanYesNo)","669f98d7":"df.drop([\"Claim\", \"Gender\"], axis = 1, inplace = True)","eef4f0e2":"df.groupby([\"Agency\"]).mean()","883c1450":"df.groupby(['Agency Type']).mean()","5dc35cf6":"df.groupby(['Distribution Channel']).mean()","57b67841":"df.describe()","b9c656f9":"df[df[\"Duration\"] <0]","c2d56f63":"df[df[\"Age\"] > 100]","d34a16e8":"df.loc[df['Duration'] < 0, 'Duration'] = 49.317\ndf.loc[df['Age'] > 100, 'Age'] = 39.969981","bd8b97d0":"df.describe()","c9a488d6":"print(\"Claimed\")\nprint(df[df[\"Claim0\"] == 1][\"Claim0\"].count())\nprint(\"Not Claimed\")\nprint(df[df[\"Claim0\"] == 0][\"Claim0\"].count())","43f5735b":"g = sns.catplot(x=\"Agency\",y = \"Claim0\", data=df)\ng.fig.set_size_inches(10,5)","bf754107":"claimeddata = df[df[\"Claim0\"]==1]","06095664":"claimeddata['Destination'].value_counts().head(10).plot(kind='barh', figsize=(5,5))","cdde8a47":"f, axes = plt.subplots(1, 2)\nf.set_size_inches(15,5)\naxes[0].set_title('General')\naxes[1].set_title('Agency (Claimed Policies)')\nsns.countplot(y=\"Agency\", data=df, ax = axes[0])\nsns.countplot(y=\"Agency\", data=claimeddata, ax = axes[1])","913eb59c":"a = pd.DataFrame(df.loc[:, \"Product Name\"].value_counts())\nb = pd.DataFrame(claimeddata.loc[:, \"Product Name\"].value_counts())\ncombined = a.join(b, lsuffix = \"_general\", rsuffix = \"_claimed\")\ncombined.fillna(0, inplace = True)\ncombined","c106ed9e":"ratio_list = []\nfor i in range(len(combined)):\n    ratio_list.append(combined.iloc[i][1] \/ combined.iloc[i][0])\nratio = pd.DataFrame(ratio_list, index = np.array(combined.index))\nratio = ratio.rename(columns = {0:\"Ratio\"})\n\nplt.figure(figsize=(7,7))\nsns.barplot(data = ratio, y = ratio.index, x = \"Ratio\")","60c9c125":"sns.heatmap(df.corr(), square=True)","1138c32c":"X = df.drop(columns=['Claim0'])\ny = df['Claim0']","d5fa75fb":"from sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=42)","8fce5eb0":"updated_X = X_train.drop(columns = [\"Agency\", \"Agency Type\", \"Distribution Channel\", \"Product Name\", \"Destination\"])","29ea6502":"from imblearn.over_sampling import RandomOverSampler\nros = RandomOverSampler(random_state=0)\nX_resampled, y_resampled = ros.fit_resample(updated_X, y_train)","c6d147fb":"(unique, counts) = np.unique(y_resampled, return_counts=True)\n(unique, counts)","8f79f650":"X_test_updated = X_test.drop(columns = [\"Agency\", \"Agency Type\", \"Distribution Channel\", \"Product Name\", \"Destination\"])","ae1f9d9b":"from sklearn.linear_model import LogisticRegression\nclf = LogisticRegression(random_state=0).fit(X_resampled, y_resampled)\ny_pred = clf.predict(X_test_updated)","f3816818":"clf.score(X_resampled, y_resampled)","59f02600":"from sklearn.metrics import confusion_matrix\nconfusion_matrix(y_test, y_pred)","bc919cec":"from sklearn.metrics import classification_report\nprint(classification_report(y_test, y_pred, target_names = [\"Claimed\", \"Non-claimed\"]))","ea9bc9cd":"from sklearn.model_selection import cross_validate\ncv_results = cross_validate(clf, X_resampled, y_resampled, cv=10)","8b7dce3e":"cv_results['test_score']","9088e81f":"Imbalanced data set is as follows. Claimed policies are 927. However, Not Claimed policies are 62399.","32ded4cb":"Different policy plans have different coverage. Some of plans cover most of types of injury or disease, so the possibility of claims ","d53212c5":"## Cross-Validation\nTo avoid the overfitting problem, we will perform cross-validation method to check our accuracy score. But the result shows that our accruacy scores are around 65%","d94b4c34":"Accuracy is around 65%. Since we do not have more features, it seems that we still need some features to improve accuracy.","47ccfd34":"The following visualization is to understand whether claimed policies happens in few of countries. If an abudunce in one of countries means that this country might have some of unavoidable situtation that lead to injury or disease. ","3f4cd357":"Imbalanced dataset appears here. Oversample method will be performed to deal with imblancing problems. Before resampling, data visualization is executed first to know potential relationship.","e34177fb":"## Model Building","7031bef9":"# Travel Insurance Logistic Regression","7e61c52a":"From the above Ratio figure, we know different policies have different rate of being claimed.","0600e15f":"In the below graph, we want to discover whether specific agency companies lead to an increase in the numbers of claimed policies. In this figure, clearly no moral hazard happens here. Since in gernal one, EPX has more sold policies, but it does not lead to more claimed policies.","b2d941bc":"## Oversampling\nOversampling methods should be performed in that the number of claimed policies is much less than non-claimed ones. So oversampling methods are used to address this issue.","b1059fd4":"## Read Data","bef1cd4b":"# Training Dataset and Testing Dataset","92a02bee":"## Data Visualization","8f87a04a":"## Goal: \nThe goal of this project is to predict whether insurance policies are claimed based on some of features. \nBefore doing data analysis, we will introduce travel insurance policy first. Usually, travel insurance will have coverage for travelers concerns, including flight delays, trip cancellation, or loggage loss. And, some of policies include medical emergency. It means that the insured's age might have an influence on whether the policy is claimed. \n## Problem:\nFor any insurance policy, we would like to know whether some features lead to the policy claimed. Some features like age, gender or commision value could have influence on that. ","01f0aa29":"## Clean Data\nSome of data in some of columns are suspicious. If needed, we will transform the value of the data. Like Duration, negative values are strange. And, in age column, only 118 appears.","f24eb2bd":"Gender column has too many missing values, so at this point, we delete this column. ","49ff7c7d":"The following graph is to make sure whether claimed policies just occur in few of agencies. From this graph, it distributed evenly."}}