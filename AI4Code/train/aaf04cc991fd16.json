{"cell_type":{"08f5d13e":"code","5dfd8133":"code","4bc92063":"code","ad4b92ed":"code","549d13e1":"code","08fd4b77":"code","7d12af78":"code","10c1a0d9":"code","12b333b9":"code","a9116a09":"code","cbbe1dab":"code","689b5bf6":"code","b23201af":"code","a33eca8e":"code","b91619a2":"code","6130db5d":"code","9a0fc2d4":"code","fdbde2c2":"code","4cb8e1ae":"code","6a5f8c3f":"code","6112f328":"code","cf4ecfa2":"code","067b45ee":"code","297c5992":"markdown","f6c63e77":"markdown","12a4b133":"markdown","ea52a018":"markdown","eb23545a":"markdown","84df5529":"markdown","8fc1306d":"markdown"},"source":{"08f5d13e":"%%html\n<style>\n@import url('https:\/\/fonts.googleapis.com\/css?family=Ewert|Roboto&effect=3d');\nspan {font-family:'Roboto'; color:black; text-shadow:4px 4px 4px #aaa;}  \ndiv.output_area pre{font-family:'Roboto'; font-size:110%; color:royalblue;}      \n<\/style>","5dfd8133":"import warnings; warnings.filterwarnings('ignore')\nimport urllib,cv2,os,h5py\nfrom skimage import io,transform,color,measure\nimport numpy as np,pylab as pl,pandas as pd\nimport seaborn as sb,scipy as sp\ndef get_image(original):\n    img=cv2.imread(original)\n    return cv2.cvtColor(img,cv2.COLOR_BGR2RGB)\npl.style.use('seaborn-whitegrid')\nprint(os.listdir(\"..\/input\"))","4bc92063":"# load and display the data\nfpath1='..\/input\/traditional-decor-patterns\/'\nfpath2='..\/input\/image-examples-for-mixed-styles\/'\nfpath3='..\/input\/haarcascades\/'\ndata=pd.read_csv(fpath1+\"decor.csv\")\nimg0=get_image(fpath2+\"pattern01.png\")\nflower_img=get_image(fpath2+\"flower.png\")\ncat_img=get_image(fpath2+\"cat.png\")\nsport_img=get_image(fpath2+\"sport.png\")\n# read the h5 file\nf=h5py.File(fpath1+'DecorColorImages.h5','r')\n# list all groups\nkeys=list(f.keys())\n# data arrays\ncountries=np.array(f[keys[0]])\ndecors=np.array(f[keys[1]])\nimages=np.array(f[keys[2]])\/255\ntypes=np.array(f[keys[3]])","ad4b92ed":"ColorFlags=[flag for flag in dir(cv2) if flag.startswith('COLOR')]\nprint (np.array(ColorFlags[:100]))","549d13e1":"pl.rcParams['figure.figsize']=(6,6)\n[fn,fn2,fn3]=[fpath1+'decor\/'+el for el in \n              ['01_01_1_007.png','01_03_1_017.png','01_03_1_027.png']]\nimg=get_image(fn)\nst='Image parameters: size - %s; shape - %s; type - %s'\nprint (st%(img.size,img.shape,img.dtype))\npl.imshow(img); pl.show()\nfor i in range(3):\n    min_value,max_value,min_location,max_location=cv2.minMaxLoc(img[:,:,i])\n    print (\"min {} is at {}, and max {} is at {}\"\\\n           .format(min_value,min_location,max_value,max_location))","08fd4b77":"# invert colors\nimg_inv=cv2.bitwise_not(img)\npl.imshow(img_inv); pl.show()","7d12af78":"# change white to black\nimg_w2b=img.copy()\nimg_w2b[np.where((img_w2b==[255,255,255]).all(axis=2))]=[0,0,0]\npl.imshow(img_w2b); pl.show()","10c1a0d9":"# gray scale\npl.rcParams['figure.figsize']=(12,6)\npl.figure(1); pl.subplot(121)\nimg_gray1=cv2.cvtColor(img,cv2.COLOR_RGB2GRAY)\npl.imshow(img_gray1)\npl.figure(1); pl.subplot(122)\nimg_gray2=cv2.cvtColor(img_w2b,cv2.COLOR_RGB2GRAY)\npl.imshow(img_gray2); pl.show()","12b333b9":"pl.rcParams['figure.figsize']=(8,8); N=50\n# skimage & opencv - grayscale, resize, invert\nimg_skgray=io.imread(fn,as_grey=True)\nimg_skgray_resized=transform.resize(img_skgray,(N,N))\nimg_skgray_resized2=cv2.bitwise_not(img_skgray_resized)\nimg_cvgray_resized=cv2.resize(img_gray1,(N,N),interpolation=cv2.INTER_CUBIC)\nimg_cvgray_resized2=cv2.bitwise_not(img_cvgray_resized)\npl.figure(1); pl.subplot(221)\npl.imshow(img_skgray_resized,cmap=pl.cm.Greys)\npl.subplot(222)\npl.imshow(img_skgray_resized2)\npl.subplot(223)\npl.imshow(img_cvgray_resized,cmap=pl.cm.Greys)\npl.subplot(224)\npl.imshow(img_cvgray_resized); pl.show()","a9116a09":"pl.rcParams['figure.figsize']=(8,8)\n# split channels\nb,g,r=cv2.split(img0)\n# merge channels\nimg_merged=cv2.merge([b,g,r])\n# display one of the channels\npl.figure(1); pl.subplot(231); pl.imshow(r,cmap=pl.cm.Reds_r)\npl.subplot(232); pl.imshow(g,cmap=pl.cm.Greens_r)\npl.subplot(233); pl.imshow(b,cmap=pl.cm.Blues_r)\n# display merged image\npl.subplot(234); pl.imshow(img_merged); pl.show()","cbbe1dab":"# display different ColorFlags\nhsv_img=cv2.cvtColor(img0,cv2.COLOR_RGB2HSV_FULL)\nlab_img=cv2.cvtColor(img0,cv2.COLOR_RGB2LAB)\npl.figure(1); pl.subplot(121); pl.imshow(hsv_img)\npl.subplot(122); pl.imshow(lab_img); pl.show()","689b5bf6":"pl.rcParams['figure.figsize']=(12,4)\n# flip images\nimg_vertical_flipped=cv2.flip(img,0)\nimg_horizontal_flipped=cv2.flip(img,1)\nimg_transposed=cv2.transpose(img)\npl.figure(1); pl.subplot(131); pl.imshow(img_vertical_flipped)\npl.subplot(132); pl.imshow(img_horizontal_flipped)\npl.subplot(133); pl.imshow(img_transposed); pl.show()","b23201af":"# repeat the fragment\nimg_twice=img.copy()\nimg_fragment=img_twice[15:60,15:60]\nimg_twice[105:105+img_fragment.shape[0],105:105+\\\n          img_fragment.shape[1]]=img_fragment\npl.imshow(img_twice); pl.show()","a33eca8e":"pl.rcParams['figure.figsize']=(8,4)\n# perspective transformation\nrows,cols,ch=img.shape\npts1=np.float32([[10,10],[140,40],[10,140],[140,100]])\npts2=np.float32([[0,0],[150,0],[0,150],[150,150]])\nm=cv2.getPerspectiveTransform(pts1,pts2)\ndst=cv2.warpPerspective(img,m,(150,150))\npl.subplot(121),pl.imshow(img),pl.title('Input')\npl.scatter(pts1[:,0],pts1[:,1],c='g')\npl.subplot(122),pl.imshow(dst),pl.title('Output')\npl.xlim(-5,155); pl.ylim(155,-5)\npl.scatter(pts2[:,0],pts2[:,1],c='g'); pl.show()","b91619a2":"pl.rcParams['figure.figsize']=(12,12)\n# gradient filters\nimg2=cv2.imread(fn2)\nimg2_gray=cv2.cvtColor(img2,cv2.COLOR_BGR2GRAY)\nimg2=cv2.cvtColor(img2,cv2.COLOR_BGR2RGB)\/255\nlaplacian=cv2.Laplacian(img2_gray,cv2.CV_64F,ksize=5)\nsobel=cv2.Sobel(img2_gray,cv2.CV_64F,1,0,ksize=3)\nscharr=cv2.Scharr(img2_gray,cv2.CV_64F,1,0)\npl.subplot(2,2,1),pl.imshow(img2)\npl.title('Original'),pl.xticks([]),pl.yticks([])\npl.subplot(2,2,2),pl.imshow(laplacian,cmap=pl.cm.bone)\npl.title('Laplacian'),pl.xticks([]),pl.yticks([])\npl.subplot(2,2,3),pl.imshow(sobel,cmap=pl.cm.bone)\npl.title('Sobel'),pl.xticks([]),pl.yticks([])\npl.subplot(2,2,4),pl.imshow(scharr,cmap=pl.cm.bone)\npl.title('Scharr'),pl.xticks([]),pl.yticks([]); pl.show()","6130db5d":"# erosion\nkernel=np.ones((3,3),np.uint8)\nerosion=cv2.erode(img_gray1,kernel,iterations=1)\npl.subplot(2,2,1),pl.imshow(img_gray1)\npl.title('Original Gray'),pl.xticks([]),pl.yticks([])\npl.subplot(2,2,2),pl.imshow(erosion,cmap=pl.cm.bone)\npl.title('Erosion'),pl.xticks([]),pl.yticks([])\nimg_gray1_inv=cv2.bitwise_not(img_gray1)\nerosion_inv=cv2.erode(img_gray1_inv,kernel,iterations=1)\npl.subplot(2,2,3),pl.imshow(img_gray1_inv)\npl.title('Inverted Gray'),pl.xticks([]),pl.yticks([])\npl.subplot(2,2,4),pl.imshow(erosion_inv,cmap=pl.cm.bone)\npl.title('Erosion for Inverted')\npl.xticks([]),pl.yticks([]); pl.show()","9a0fc2d4":"# morphological gradient\ngradient=cv2.morphologyEx(img,cv2.MORPH_GRADIENT,kernel)\npl.subplot(1,2,1),pl.imshow(img)\npl.title('Original Gray'),pl.xticks([]),pl.yticks([])\npl.subplot(1,2,2),pl.imshow(gradient,cmap=pl.cm.bone)\npl.title('Morphological Gradient')\npl.xticks([]),pl.yticks([]); pl.show()","fdbde2c2":"pl.rcParams['figure.figsize']=(12,6)\nimg3=cv2.imread(fn3)\nimg3_gray=cv2.cvtColor(img3,cv2.COLOR_BGR2GRAY)\nimg3=cv2.cvtColor(img3,cv2.COLOR_BGR2RGB)\nedge_img=img.copy(); edge_img3=img3.copy()\nedge=cv2.Canny(img_gray1,90,240)\nedge_img[edge!=0]=(0,255,0) \nedge3=cv2.Canny(img3_gray,90,240)\nedge_img3[edge3!=0]=(0,255,0) \npl.figure(1); pl.subplot(121); pl.imshow(edge_img)\npl.subplot(122); pl.imshow(edge_img3); pl.show()","4cb8e1ae":"img=io.imread(fn2); level=.68\ngray_img=color.colorconv.rgb2grey(img) \ncontours=measure.find_contours(gray_img,level)\nn=len(contours); pl.figure(figsize=(6,6))\npl.gca().invert_yaxis()\n[pl.plot(contours[i][:,1],contours[i][:,0],lw=.5,\n         color=pl.get_cmap('cool')(i\/n)) \n for i in range(n)]\npl.xticks([]); pl.yticks([]); pl.show()","6a5f8c3f":"pl.rcParams['figure.figsize']=(12,4)\norb_img=flower_img.copy()\norb=cv2.ORB_create()\nkeypoints=orb.detect(orb_img,None)\nkeypoints,descriptors=orb.compute(orb_img,keypoints)\ncv2.drawKeypoints(orb_img,keypoints,orb_img)\nmatch_img=np.zeros(flower_img.shape,np.uint8)\ncenter_img=flower_img[60:140,90:180] \nmatch_img[60:140,100:180]=[0,0,0] \ncenter_img=cv2.flip(center_img,0)\nmatch_img[100:100+center_img.shape[0],\n          150:150+center_img.shape[1]]=center_img\npl.figure(1); pl.subplot(121); pl.imshow(orb_img)\npl.subplot(122); pl.imshow(match_img); pl.show()","6112f328":"match_keypoints=orb.detect(match_img,None)\nmatch_keypoints,match_descriptors=\\\norb.compute(match_img,match_keypoints)\nbrute_force=cv2.BFMatcher(cv2.NORM_HAMMING,crossCheck=True)\nmatches=brute_force.match(descriptors,match_descriptors)\nmatches=sorted(matches,key=lambda x:x.distance) \ndraw_matches=cv2.drawMatches(orb_img,keypoints,\n                             match_img,match_keypoints, \n                             matches[:7],orb_img)\npl.imshow(draw_matches); pl.show()","cf4ecfa2":"pl.rcParams['figure.figsize']=(10,10)\nurl='haarcascade_frontalcatface.xml'\ngray_cat_img=cv2.cvtColor(cat_img,cv2.COLOR_RGB2GRAY)\ncatface_img=cat_img.copy()\ncatface_cascade=cv2.CascadeClassifier(fpath3+url)\ncatfaces=catface_cascade.detectMultiScale(gray_cat_img,1.095,6)\nfor (x,y,w,h) in catfaces:\n    cv2.rectangle(catface_img,(x,y),(x+w,y+h),(0,255,0),3)\npl.figure(1); pl.subplot(121); pl.imshow(cat_img)\npl.subplot(122); pl.imshow(catface_img); pl.show() ","067b45ee":"gray_sport_img=cv2.cvtColor(sport_img,cv2.COLOR_RGB2GRAY)\nface_img=sport_img.copy()\nurl2='haarcascade_frontalface_default.xml'\nface_cascade=cv2.CascadeClassifier(fpath3+url2)\nfaces=face_cascade.detectMultiScale(gray_sport_img,1.095,4)\nfor (x,y,w,h) in faces:\n     cv2.rectangle(face_img,(x,y),(x+w,y+h),\n     (int(0),int(255),int(0)),int(3))\nfig=pl.figure(figsize=(10,10))  \nax=fig.add_subplot(211); ax.imshow(sport_img)\nax=fig.add_subplot(212); ax.imshow(face_img); pl.show()","297c5992":"<h2 style=\"color:#37c9e1; font-family:Ewert; font-size:150%;\" class=\"font-effect-3d\">Data<\/h2>","f6c63e77":"<h2 style=\"color:#37c9e1; font-family:Ewert; font-size:150%;\" class=\"font-effect-3d\">Key Points<\/h2>","12a4b133":"<h2 style=\"color:#37c9e1; font-family:Ewert; font-size:150%;\" class=\"font-effect-3d\">Edges' & Contours' Detection<\/h2>","ea52a018":"<h2 style=\"color:#37c9e1; font-family:Ewert; font-size:150%;\" class=\"font-effect-3d\">Basic Manipulations<\/h2>","eb23545a":"<h2 style=\"color:#37c9e1; font-family:Ewert; font-size:150%;\" class=\"font-effect-3d\">Advanced Manipulations<\/h2>","84df5529":"<h2 style=\"color:#37c9e1; font-family:Ewert; font-size:150%;\" class=\"font-effect-3d\">Objects' Detection<\/h2>","8fc1306d":"<h1 style=\"color:#37c9e1; font-family:Ewert; font-size:200%;\" class=\"font-effect-3d\">OpenCV Cookbook<\/h1>\n<h2 style=\"color:#37c9e1; font-family:Ewert; font-size:150%;\" class=\"font-effect-3d\">Style, Links and Libraries<\/h2>\n#### [`Version in Google Colaboratory`](https:\/\/colab.research.google.com\/drive\/1GD7Oi1LtFaEi8VOjiBM5cj5ayWpaejaf) & [`SageMathCell Version`](lgabelitskaya.github.io\/opencv_cookbook_SMC.html)"}}