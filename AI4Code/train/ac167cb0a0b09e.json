{"cell_type":{"ab2bf68f":"code","1118c887":"code","0df28c00":"code","fe16ff7d":"code","eceb0ead":"code","b4205220":"code","1c4abb1b":"code","b2a77679":"code","54bbcae9":"code","dee1b187":"code","9f74e704":"code","a9056715":"code","51ea8f6f":"code","5d5e9e97":"code","77883735":"code","58478be1":"code","55695c5d":"code","cc33f1ba":"code","09d39ee6":"code","beb0ad14":"code","d2550818":"code","9e552193":"code","b85b6b71":"code","833d2c8f":"code","1a7baff4":"code","dc3be795":"code","04061666":"code","2cd6e6fe":"code","b17ed432":"code","cfbdc371":"code","e4fd584a":"code","bbb821fd":"code","d9610bd5":"markdown","e65db86b":"markdown","2fb3cde1":"markdown","a514a66d":"markdown","2d529d2e":"markdown","9daf363d":"markdown","f30d6873":"markdown","0564cfc5":"markdown","2d58d927":"markdown","e31e9b6a":"markdown","de896542":"markdown","29908468":"markdown","c2f363fa":"markdown","ab686ae0":"markdown","36658f92":"markdown","54b7342c":"markdown","73124636":"markdown","94572af1":"markdown","ad52efae":"markdown"},"source":{"ab2bf68f":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport matplotlib.pyplot as plt\n\n## timeseries package\nfrom statsmodels.tsa.stattools import adfuller\nfrom statsmodels.graphics.tsaplots import plot_acf, plot_pacf\n\nfrom datetime import timedelta\nfrom numpy import log","1118c887":"df = pd.read_csv(\"..\/input\/gold-rate-history-in-tamilnadu-india\/gold_rate_history.csv\")\ndf.shape","0df28c00":"df.columns","fe16ff7d":"print(f\"The dataset available for State: {df['State'].unique()[0]} and City: {df['Location'].unique()[0]}\")","eceb0ead":"## Convert date string to datetime object\ndf[\"Date\"] = pd.to_datetime(df[\"Date\"], format=\"%m\/%d\/%Y\")","b4205220":"print(f'The date ranging from {df[\"Date\"].min()} to {df[\"Date\"].max()}')","1c4abb1b":"df[\"Pure Gold (24 k)\"] = df[\"Pure Gold (24 k)\"].astype(np.float)\ndf[\"Standard Gold (22 K)\"] = df[\"Standard Gold (22 K)\"].astype(np.float)","b2a77679":"df.index = df.Date","54bbcae9":"plt.figure(figsize=(15, 7))\nplt.plot(df['Standard Gold (22 K)'])\nplt.title('Standard Gold Price (22K) - (Daily data)')\nplt.grid(True)\nplt.show()","dee1b187":"result = adfuller(df['Standard Gold (22 K)'])\nprint('ADF Statistic: %f' % result[0])\nprint('p-value: %f' % result[1])","9f74e704":"\n# Original Series\nfig, axes = plt.subplots(3, 2, sharex=False)\n\nfig.set_size_inches(14,13)\n\naxes[0, 0].plot(df['Standard Gold (22 K)'].values); axes[0, 0].set_title('Original Series')\nplot_acf(df['Standard Gold (22 K)'].values, ax=axes[0, 1])\n\n\n# 1st Differencing\naxes[1, 0].plot(df['Standard Gold (22 K)'].diff()); axes[1, 0].set_title('1st Order Differencing')\nplot_acf(df['Standard Gold (22 K)'].diff().dropna(), ax=axes[1, 1])\n\n# 2nd Differencing\naxes[2, 0].plot(df['Standard Gold (22 K)'].diff().diff()); axes[2, 0].set_title('2nd Order Differencing')\nplot_acf(df['Standard Gold (22 K)'].diff().diff().dropna(), ax=axes[2, 1])\n\nplt.show()","a9056715":"# PACF plot of 1st differenced series\nplt.rcParams.update({'figure.figsize':(14,8), 'figure.dpi':150})\n\n## first order differencing\nfig, axes = plt.subplots(2, 2, sharex=False)\naxes[0, 0].plot(df['Standard Gold (22 K)'].diff()); axes[0, 0].set_title('1st Differencing')\nplot_pacf(df['Standard Gold (22 K)'].diff().dropna(), ax=axes[0, 1])\n\n## second order differencing\naxes[1, 0].plot(df['Standard Gold (22 K)'].diff().diff()); axes[1, 0].set_title('2nd Differencing')\nplot_pacf(df['Standard Gold (22 K)'].diff().diff().dropna(), ax=axes[1, 1])\n\nplt.show()","51ea8f6f":"from statsmodels.tsa.arima_model import ARIMA\n\n# 1,1,2 ARIMA Model\nmodel = ARIMA(df['Standard Gold (22 K)'], order=(1,1,2))\nmodel_fit = model.fit(disp=0)\nprint(model_fit.summary())","5d5e9e97":"# Create Training and Test\ntrain = df['Standard Gold (22 K)'][:-200]\ntest = df['Standard Gold (22 K)'][-200:]\n\nprint(train.shape, test.shape)","77883735":"# Build Model\nmodel = ARIMA(train, order=(1, 2, 1))  \nfitted = model.fit()  \n\n# Forecast\nfc, se, conf = fitted.forecast(test.shape[0], alpha=0.05)  # 95% conf","58478be1":"# Make as pandas series\nfc_series = pd.Series(fc, index=test.index)\nlower_series = pd.Series(conf[:, 0], index=test.index)\nupper_series = pd.Series(conf[:, 1], index=test.index)","55695c5d":"# Plot\nplt.figure(figsize=(12,5), dpi=100)\nplt.plot(train, label='training')\nplt.plot(test, label='actual')\nplt.plot(fc_series, label='forecast')\nplt.fill_between(lower_series.index, lower_series, upper_series, \n                 color='k', alpha=.15)\nplt.title('Forecast vs Actuals')\nplt.legend(loc='upper left', fontsize=8)\nplt.show()","cc33f1ba":"NO_OF_LAG_DAYS = 14","09d39ee6":"def create_lag_feature(df, no_of_days):\n    \n    for day in range(1, no_of_days+1):\n        df[f\"lag_{day}\"] = df[\"Standard Gold (22 K)\"].shift(day)\n        \n    return df","beb0ad14":"df_features = create_lag_feature(df, NO_OF_LAG_DAYS)","d2550818":"lag_features =  [ col for col in df_features.columns if \"lag\" in col]\nprint(lag_features)","9e552193":"df_lag_features = df_features[lag_features + ['Standard Gold (22 K)']].dropna()\ndf_lag_features.columns","b85b6b71":"NUM_PREDICTION = 500\ntrain_df = df_lag_features[:-NUM_PREDICTION]\ntest_df = df_lag_features[-NUM_PREDICTION:]\n\nprint(train_df.shape, test_df.shape)","833d2c8f":"import xgboost as xgb\nfrom sklearn import linear_model\nfrom sklearn.neural_network import MLPRegressor\nfrom sklearn import ensemble\nfrom sklearn.svm import SVR\nfrom sklearn.metrics import mean_squared_error","1a7baff4":"model = mlp = MLPRegressor(solver='lbfgs', hidden_layer_sizes=12,\n                           max_iter=100, random_state=5,\n                           activation=\"relu\") ","dc3be795":"X_train_df = train_df[lag_features]\nX_test_df = test_df[lag_features]","04061666":"model.fit(X_train_df, train_df['Standard Gold (22 K)'])","2cd6e6fe":"predicted_price = model.predict(X_test_df)\ntest_df[\"22K Gold Predicted_Price\"] = predicted_price","b17ed432":"test_df[[\"Standard Gold (22 K)\", \"22K Gold Predicted_Price\"]].head()","cfbdc371":"# Plot\nplt.figure(figsize=(12,5), dpi=100)\nplt.plot(train_df['Standard Gold (22 K)'], label='training')\nplt.plot(test_df['Standard Gold (22 K)'], label='actual')\nplt.plot(test_df['22K Gold Predicted_Price'], label='forecast')\nplt.title('Forecast vs Actuals')\nplt.legend(loc='upper left', fontsize=8)\nplt.show()","e4fd584a":"print(f\"RMSE {mean_squared_error(test_df['Standard Gold (22 K)'], test_df['22K Gold Predicted_Price'], squared= False)}\")","bbb821fd":"# Plot\nplt.figure(figsize=(12,5), dpi=100)\nplt.plot(test_df['Standard Gold (22 K)'][-NUM_PREDICTION:], label='actual')\nplt.plot(test_df['22K Gold Predicted_Price'][-NUM_PREDICTION:], label='forecast')\nplt.title('Forecast vs Actuals')\nplt.legend(loc='upper left', fontsize=8)\nplt.show()","d9610bd5":"For the above series, the time series reaches stationarity with one orders of differencing. But on looking at the autocorrelation plot for the 2nd differencing the lag goes into the far negative zone fairly quick, which indicates, the series might have been over differenced.\n\n**Will fix order of differencing as 1.** This is the **d** term in ARIMA.","e65db86b":"## Let's treat the problem as Regression","2fb3cde1":"P value is not significant 0.05 hence the data is not stationary. it required order of differencing (D).","a514a66d":"The price indicated for Pure Gold (24 k) and Standard Gold (22 K) is 1Gram weight.","2d529d2e":"## Regression model","9daf363d":"![image.png](attachment:image.png)","f30d6873":"## ARIMA model","0564cfc5":"The price is not consistent over the period of time. Yup. There could be many other factor which directly influence the gold price like increasing the US dollar value for Indian curreny, oil price and etc.\n\nBut, Will treat this as **Univariate Time series Forecasting** problem now.","2d58d927":"### Problem\n\n- Forecast the 1gram of 22K or 24K Gold price in India \n\n<font color=\"red\"> Note: Updated with recent Gold Price data 10\/Oct\/2020<\/font>","e31e9b6a":"### Let's take a closer look at Prediction Vs Actual","de896542":"The important parameters of ARIMA is p, d and q. Lets see how to determine each parameter.","29908468":"Convert Datetime object","c2f363fa":"## How Gold price has increased over a decade?","ab686ae0":"### Create Lag Feature","36658f92":"Will focus on the following points:\n- Let's predict 22K Gold price in future\n- Will create Lag feature from the current Gold price","54b7342c":"#### Observation:\n\n- Results are not good. Even, I tried changing the P, D and Q parameter for ARIMA. It didn't help much.","73124636":"### Well done!!!\n\nAchieved better RMSE in regression model rather than considering it as Time series problem (Exspecially ARIMA didn't work well, but other time series model need to try).","94572af1":" PACF lag 1 is quite significant since is well above the significance line. \n \n **Hence, P value will tentatively fix 1**","ad52efae":"Lets look at the data fields."}}