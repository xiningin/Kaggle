{"cell_type":{"35e30803":"code","6f0dde5a":"code","18832159":"code","899a776f":"code","667af0b1":"code","9f60d2df":"code","84f1d5fe":"code","66e8442f":"code","d1b4d1c2":"code","d0bec461":"code","759d1924":"code","093ece2a":"code","d06be256":"code","1636c1fc":"code","34e71b91":"code","28b73ad0":"code","64a210a3":"code","6ec3c748":"code","d51562a2":"code","5e8fd6d1":"code","afbaa92c":"code","cc6c30eb":"code","ecb9a87b":"code","c3e8e9a4":"code","0c43adb3":"code","41c04bcb":"code","e19faebd":"code","1c1da940":"code","f19fa9e1":"code","fef5c8c7":"code","71a1fcce":"code","a817ac1e":"code","e6ccda46":"code","80a17a21":"code","0ec2a703":"code","0224f837":"code","2d32fcd7":"code","c243543c":"code","90ebf739":"code","61df6ac7":"code","f2ae6c07":"code","175535db":"code","7971aa16":"code","13047548":"code","e4ae95b4":"code","e32a11d1":"code","6a89adc8":"code","58da4c0c":"code","1062c349":"code","a2644069":"code","2c43454f":"code","75840fbb":"code","47f5316d":"code","c560d2d1":"markdown"},"source":{"35e30803":"import pandas as pd  \nimport numpy as np\nimport matplotlib.pyplot as plt\n\ncols = ['target','id','date','query_string','user','text']\ndf = pd.read_csv('..\/input\/twitter-sentiment-analysis\/sentiment3.csv', header=None, names=cols)\ndf.head()","6f0dde5a":"df.isnull().sum()","18832159":"import seaborn as sns\nsns.countplot(x = 'target', data = df)","899a776f":"df.drop(['id','date','query_string','user'],axis=1,inplace=True)","667af0b1":"df.head()","9f60d2df":"df[df.target == 4].head()","84f1d5fe":"df[df.target == 0].head()","66e8442f":"df['pre_clean_len'] = [len(t) for t in df.text]   ","d1b4d1c2":"#boxplot for length of the text\nfig, ax = plt.subplots(figsize=(5,5))\nplt.boxplot(df.pre_clean_len)\nplt.show()","d0bec461":"df[df.pre_clean_len > 140]","759d1924":"#only one result is more than 175 charactors\ndf[df.pre_clean_len > 175]  ","093ece2a":"df.drop(['pre_clean_len'],axis=1,inplace=True)","d06be256":"import string\nimport nltk\nimport warnings \nimport re\nwarnings.filterwarnings(\"ignore\", category=DeprecationWarning)\n\n%matplotlib inline","1636c1fc":"def remove_pattern(input_txt, pattern):\n    r = re.findall(pattern, input_txt)\n    for i in r:\n        input_txt = re.sub(i, '', input_txt)\n        \n    return input_txt   ","34e71b91":"# remove twitter handles (@user)\ndf['text'] = np.vectorize(remove_pattern)(df['text'], \"@[\\w]*\")","28b73ad0":"df.head()","64a210a3":"# remove twitter url\ndf['text'] = np.vectorize(remove_pattern)(df['text'], \"https?:\/\/[A-Za-z0-9.\/]+\")","6ec3c748":"df.head()","d51562a2":"# remove special characters, numbers, punctuations\ndf['text'] = df['text'].str.replace(\"[^a-zA-Z#]\", \" \")","5e8fd6d1":"df.head()","afbaa92c":"#remove short word\ndf['text'] = df['text'].apply(lambda x: ' '.join([w for w in x.split() if len(w)>3]))","cc6c30eb":"df.head()","ecb9a87b":"#tokenization\ntokenized_df= df['text'].apply(lambda x: x.split())\ntokenized_df.head()","c3e8e9a4":"from nltk.stem.porter import *\nstemmer = PorterStemmer()\n\ntokenized_df = tokenized_df.apply(lambda x: [stemmer.stem(i) for i in x]) # stemming\ntokenized_df.head()","0c43adb3":"import nltk\nnltk.download('wordnet')","41c04bcb":"wn = nltk.WordNetLemmatizer()\n\ndef lemmatizer(text):\n    text = [wn.lemmatize(word) for word in text]\n    return text\n\ntokenized_df = tokenized_df.apply(lambda x: lemmatizer(x))\ntokenized_df.head()","e19faebd":"for i in range(len(tokenized_df)):\n    tokenized_df[i] = ' '.join(tokenized_df[i])\n\ndf['text'] = tokenized_df","1c1da940":"df.loc[df['target'] ==4, 'target'] = 1","f19fa9e1":"clean_df = pd.DataFrame(df.text,columns=['text'])\nclean_df['target'] = df.target\nclean_df.to_csv('clean_sentiment.csv',encoding='utf-8')","fef5c8c7":"from wordcloud import WordCloud, STOPWORDS","71a1fcce":"all_words = ' '.join([text for text in df['text']])\nfrom wordcloud import WordCloud\nwordcloud = WordCloud(width=800, height=500, random_state=21, max_font_size=110).generate(all_words)\n\nplt.figure(figsize=(10, 7))\nplt.imshow(wordcloud, interpolation=\"bilinear\")\nplt.axis('off')\nplt.show()","a817ac1e":"df.head() #prove of token alrady swtiched back together","e6ccda46":"neg_tweets = df[df.target == 0]\nneg_string = []\nfor t in neg_tweets.text:\n    neg_string.append(t)\nneg_string = pd.Series(neg_string).str.cat(sep=' ')\nfrom wordcloud import WordCloud\n\nwordcloud = WordCloud(width=1600, height=800,max_font_size=200).generate(neg_string)\nplt.figure(figsize=(12,10))\nplt.imshow(wordcloud, interpolation=\"bilinear\")\nplt.axis(\"off\")\nplt.show()","80a17a21":"pos_tweets = df[df.target == 1 ]\npos_string = []\nfor t in pos_tweets.text:\n    pos_string.append(t)\npos_string = pd.Series(pos_string).str.cat(sep=' ')\n\nwordcloud = WordCloud(width=1600, height=800,max_font_size=200,colormap='magma').generate(pos_string) \nplt.figure(figsize=(12,10)) \nplt.imshow(wordcloud, interpolation=\"bilinear\") \nplt.axis(\"off\") \nplt.show()","0ec2a703":"def hashtag_extract(x):\n    hashtags = []\n    # Loop over the words in the tweet\n    for i in x:\n        ht = re.findall(r\"#(\\w+)\", i)\n        hashtags.append(ht)\n\n    return hashtags","0224f837":"# extracting hashtags from positive\/negative tweets\nHT_positive = hashtag_extract(df['text'][df['target'] == 1])\n\n# extracting hashtags from racist\/sexist tweets\nHT_negative = hashtag_extract(df['text'][df['target'] == 0])\n\n# unnesting list\nHT_positive = sum(HT_positive,[])\nHT_negative = sum(HT_negative,[])","2d32fcd7":"#positive tweet\na = nltk.FreqDist(HT_positive)\nd = pd.DataFrame({'Hashtag': list(a.keys()),\n                  'Count': list(a.values())})\n# selecting top 10 most frequent hashtags     \nd = d.nlargest(columns=\"Count\", n = 10) \nplt.figure(figsize=(16,5))\nax = sns.barplot(data=d, x= \"Hashtag\", y = \"Count\")\nax.set(ylabel = 'Count')\nplt.show()","c243543c":"b = nltk.FreqDist(HT_negative)\ne = pd.DataFrame({'Hashtag': list(b.keys()), 'Count': list(b.values())})\n# selecting top 10 most frequent hashtags\ne = e.nlargest(columns=\"Count\", n = 10)   \nplt.figure(figsize=(16,5))\nax = sns.barplot(data=e, x= \"Hashtag\", y = \"Count\")\nax.set(ylabel = 'Count')\nplt.show()","90ebf739":"#tweete token visualisation\nfrom sklearn.feature_extraction.text import CountVectorizer\ncvec = CountVectorizer(stop_words='english',max_features=10000)   #insert stopword\ncvec.fit(df.text)","61df6ac7":"document_matrix = cvec.transform(df.text)","f2ae6c07":"%%time\nneg_batches = np.linspace(0,80000,10).astype(int)\ni=0\nneg_tf = []\nwhile i < len(neg_batches)-1:\n    batch_result = np.sum(document_matrix[neg_batches[i]:neg_batches[i+1]].toarray(),axis=0)\n    neg_tf.append(batch_result)\n    print(neg_batches[i+1],\"entries' term freuquency calculated\")\n    i += 1","175535db":"%%time\npos_batches = np.linspace(80000,160000,10).astype(int)\ni=0\npos_tf = []\nwhile i < len(pos_batches)-1:\n    batch_result = np.sum(document_matrix[pos_batches[i]:pos_batches[i+1]].toarray(),axis=0)\n    pos_tf.append(batch_result)\n    print(pos_batches[i+1],\"entries' term freuquency calculated\")\n    i += 1","7971aa16":"neg = np.sum(neg_tf,axis=0)\npos = np.sum(pos_tf,axis=0)\nterm_freq_df2 = pd.DataFrame([neg,pos],columns=cvec.get_feature_names()).transpose()\nterm_freq_df2.columns = ['negative', 'positive']\nterm_freq_df2['total'] = term_freq_df2['negative'] + term_freq_df2['positive']\nterm_freq_df2.sort_values(by='total', ascending=False).iloc[:10]","13047548":"y_pos = np.arange(50)\nplt.figure(figsize=(12,10))\nplt.bar(y_pos, term_freq_df2.sort_values(by='negative', ascending=False)['negative'][:50], align='center', alpha=0.5)\nplt.xticks(y_pos, term_freq_df2.sort_values(by='negative', ascending=False)['negative'][:50].index,rotation='vertical')\nplt.ylabel('Frequency')\nplt.xlabel('Top 50 negative tokens')\nplt.title('Top 50 tokens in negative tweets')","e4ae95b4":"y_pos = np.arange(50)\nplt.figure(figsize=(12,10))\nplt.bar(y_pos, term_freq_df2.sort_values(by='positive', ascending=False)['positive'][:50], align='center', alpha=0.5)\nplt.xticks(y_pos, term_freq_df2.sort_values(by='positive', ascending=False)['positive'][:50].index,rotation='vertical')\nplt.ylabel('Frequency')\nplt.xlabel('Top 50 positive tokens')\nplt.title('Top 50 tokens in positive tweets')","e32a11d1":"import seaborn as sns\nplt.figure(figsize=(8,6))\nax = sns.regplot(x=\"negative\", y=\"positive\",fit_reg=False, scatter_kws={'alpha':0.5},data=term_freq_df2)\nplt.ylabel('Positive Frequency')\nplt.xlabel('Negative Frequency')\nplt.title('Negative Frequency vs Positive Frequency')\nplt.figure(figsize=(8,6))\nax = sns.regplot(x=\"negative\", y=\"positive\",fit_reg=False, scatter_kws={'alpha':0.5},data=term_freq_df2)\nplt.ylabel('Positive Frequency')\nplt.xlabel('Negative Frequency')\nplt.title('Negative Frequency vs Positive Frequency')","6a89adc8":"from sklearn.model_selection import train_test_split\n\nx = df.text\ny = df.target\n\nX_train, X_test, y_train, y_test = train_test_split(x, y, test_size=.02, random_state=2000)","58da4c0c":"from sklearn.feature_extraction.text import CountVectorizer\ncv = CountVectorizer(ngram_range=(1,2), max_features=60000, stop_words='english')\ncountX_train = cv.fit_transform(X_train)\ncountX_test = cv.transform(X_test)","1062c349":"from sklearn.feature_extraction.text import TfidfVectorizer\n# Create feature vectors\nvectorizer = TfidfVectorizer(min_df = 5,\n                             max_df = 0.8,\n                             max_features=200000, \n                             stop_words='english')\nX_train_vectors = vectorizer.fit_transform(X_train)\nX_test_vectors = vectorizer.transform(X_test)","a2644069":"#Import svm model\nfrom sklearn import svm\nfrom sklearn.metrics import classification_report\n#Create a svm Classifier\nclf = svm.SVC(kernel='linear')\n\n#Train the model using the training sets\nclf.fit(X_train_vectors, y_train)\n#Predict the response for test dataset\ny_pred = clf.predict(X_test_vectors)","2c43454f":"print(\"Accuracy:\",metrics.accuracy_score(y_test, y_pred))","75840fbb":"from sklearn.metrics import classification_report, confusion_matrix\nprint(confusion_matrix(y_test, y_pred))\nprint(classification_report(y_test, y_pred))","47f5316d":"from sklearn.svm import SVC\nfrom sklearn.model_selection import GridSearchCV\n\nparam_grid = {'C': [0.1,1, 10, 100], 'gamma': [1,0.1,0.01,0.001],'kernel': ['linear']}\n\ngrid = GridSearchCV(SVC(),param_grid,refit=True,verbose=2)\ngrid.fit(X_train_vectors, y_train)\nprint(grid.best_estimator_)\nprint(model_svm.best_score_)","c560d2d1":"XGBOOST"}}