{"cell_type":{"e2cc33ad":"code","4ededf9b":"code","a0dfe970":"code","a978625e":"code","2342b12e":"code","62c8c49c":"code","d94d16eb":"code","d3f0cce0":"code","5f312294":"code","1a488b2c":"code","f9e8f8f7":"code","f33d3422":"code","dc8a79bf":"code","60ade1f7":"code","47795842":"code","83c91ae3":"code","c1d3ca01":"code","d75e8c1d":"code","35b0d4df":"code","e71a3c6b":"code","0339b066":"code","a179e59f":"code","855fdd3f":"code","7a5361ab":"code","aa121887":"code","8400189c":"code","278b7464":"code","7c57fb98":"code","c0edccaa":"code","350ca725":"code","cc804abe":"code","fec6e8aa":"code","836fc63e":"code","9183b8ba":"code","7e703686":"code","abf49e6e":"code","f7e54967":"code","9320487e":"code","c37d3cf4":"code","b521df9f":"code","62b1158f":"code","be90dcc7":"code","a888f815":"code","16df7c9b":"code","0554484c":"code","860b7bc0":"code","6165b6f1":"code","141fab2a":"code","9c013c99":"code","51eec118":"code","553dec63":"markdown","4fd226e4":"markdown","b39a88e9":"markdown","b48919fa":"markdown","38f8b21f":"markdown","195d4893":"markdown","d1870f51":"markdown","47342844":"markdown","1585cff0":"markdown","5846b5e8":"markdown","25a47652":"markdown","27ad3714":"markdown","b29072f4":"markdown","66204aaa":"markdown","b565e395":"markdown","d4bc3074":"markdown","65eb1eb1":"markdown","9aa55b1a":"markdown","1b56b29f":"markdown"},"source":{"e2cc33ad":"#First we will load the necessary libraries and classes\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nfrom pandas.io.json import json_normalize\nimport json\nimport seaborn as sns\nimport matplotlib\nimport matplotlib.pyplot as plt\n%matplotlib inline  \n%pylab inline\nimport string\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n#from subprocess import check_output\n#print(check_output([\"ls\", \"..\/input\"]).decode(\"utf8\"))","4ededf9b":"biz_f = open('..\/input\/yelp_academic_dataset_business.json',encoding=\"utf8\")\nbiz_df = pd.DataFrame([json.loads(x) for x in biz_f.readlines()])\nbiz_f.close()\nbiz_df.info()","a0dfe970":"# We should have a feel for how the data frame itself looks like before doing anything else on it\nbiz_df.head(5)","a978625e":"#Check the missing values for each column\nbiz_df.isnull().sum()","2342b12e":"biz_df[biz_df['categories'].isnull()].head()","62c8c49c":"#Total number of reviews associated with nan values in categories\nbiz_df[biz_df['categories'].isnull()]['review_count'].sum()","d94d16eb":"biz_df.dropna(subset=['categories'],inplace=True)","d3f0cce0":"#Total number of unique business categories in the dataset\nbiz_df['categories'].nunique()","5f312294":"#Plotting top 25 most reviewed businesses among all categories\nax = sns.catplot(x=\"review_count\", y=\"name\",data= biz_df.nlargest(20,'review_count'), \n                 kind=\"bar\",hue= \"categories\", dodge= False, height= 10 )\n\nplt.subplots_adjust(top=0.9)\nax.fig.suptitle('Top 25 Most Reviewed Businesses And Categories Lables Used') # can also get the figure from plt.gcf()","1a488b2c":"#Trim any leading white-space. This takes care of cases where some items were not being sorted properly due to whitespaces.\nbiz_df['categories'].str.strip()\n\n#Create an sorted string, does not create list, and can use .nunique() function if it's not list\n#biz_df['categories'] = biz_df['categories'].apply(lambda x: ', '.join(sorted(x.split(', '))))\n\n#Following turns into lists, .nunique() does not work on lists, so need to count list length of the items (!!USE THIS!!)\nbiz_df['categories'] = biz_df.categories.map(lambda x: [i.strip() for i in sorted(x.split(\", \"))])\n\n#biz_df['categories'].nunique()\nbiz_df['categories']\n\n#Count of unique combinations of business categories after alphabetically ordering the labels\nprint (biz_df['categories'].apply(tuple).nunique())","f9e8f8f7":"#Add a new column to count the number of category keywords used\nbiz_df['Num_Keywords'] = biz_df['categories'].str.len()\n\n#Top 20 categories with most keyword\nbiz_df[['categories','Num_Keywords']].sort_values('Num_Keywords',ascending = False).head(10)","f33d3422":"fig = plt.figure()\nax = fig.add_subplot(111)\n\nx = biz_df['Num_Keywords']\nnumBins = 100\nax.hist(x,numBins,color='green',alpha=0.7)\nplt.show()","dc8a79bf":"#Populating the number of times each combination of unique category combinations found used in the dataset.\ndf_biz_CountBizPerCat = pd.DataFrame(biz_df.groupby(biz_df['categories'].map(tuple))['Num_Keywords'].count())\n\n#Looking at 'n' category combinations\nn = 10\ndf_biz_CountBizPerCat.sort_values(['Num_Keywords'], ascending = 1).head(n)","60ade1f7":"#New lets look at the distribution of review counts across major categories\ndf_BusinessesPerCategories_pre = pd.DataFrame(biz_df.groupby(biz_df['categories'].map(tuple))['review_count'].sum())\ndf_BusinessesPerCategories_pre.reset_index(level=0, inplace=True) #reset index to column\ndf_BusinessesPerCategories_pre['Cum_review_count'] = df_BusinessesPerCategories_pre['review_count'].cumsum(axis = 0)\ndf_BusinessesPerCategories_pre['Percent'] = (df_BusinessesPerCategories_pre['review_count']\/df_BusinessesPerCategories_pre['review_count'].sum())*100.00\ndf_BusinessesPerCategories_pre = df_BusinessesPerCategories_pre.sort_values(['Percent'], ascending = 0)\n\ndf_BusinessesPerCategories_pre['Cum_Percent'] = df_BusinessesPerCategories_pre['Percent'].cumsum(axis = 0)\ndf_BusinessesPerCategories_pre = df_BusinessesPerCategories_pre.sort_values(['Percent'], ascending = 0)\n\ndf_BusinessesPerCategories_pre.head(10)","47795842":"#What are the top-10 business categories before we remove the businesses using more than 3 top-level labels\nax = sns.catplot(x=\"Percent\", y=\"categories\",kind=\"bar\",data=df_BusinessesPerCategories_pre.head(10), aspect= 1.5)\nplt.subplots_adjust(top=0.9)\nax.fig.suptitle('Top 10 Business Categories by Total Review Counts (Before)') # can also get the figure from plt.gcf()\n","83c91ae3":"#List of top-level business categories as foudn in Yelp website\nmajor_categories = ['Active Life', 'Arts & Entertainment', 'Automotive', 'Beauty & Spas', 'Education', 'Event Planning & Services', 'Financial Services', 'Food','Health & Medical',\n                    'Home Services', 'Hotels & Travel', 'Local Flavor', 'Local Services', 'Mass Media', 'Nightlife', 'Pets', 'Professional Services', 'Public Services & Government', \n                    'Real estate','Religious Organizations','Restaurants', 'Shopping']","c1d3ca01":"#Creating two empty columns for major category keywords and the counts of such use for each business and categories they have used\nbiz_df['Count_MajorCategories'] = NaN\nbiz_df['MajorCategories'] = NaN\n\n#Populating the values in the new columns for each business\nbiz_df['Count_MajorCategories'] = biz_df['categories'].apply(lambda x: len([value for value in major_categories if value in x]))\nbiz_df['MajorCategories'] = biz_df['categories'].apply(lambda x: [str(value) for value in major_categories if str(value) in x])\n\n##Printing count of businesses with exactly one top-level category\nprint(len(biz_df[biz_df.Count_MajorCategories <= 3].sort_values('Count_MajorCategories'))\/biz_df['business_id'].count()*100)\n\n##Printing count of businesses with more than one to-level category\nprint(len(biz_df[biz_df.Count_MajorCategories > 3].sort_values('Count_MajorCategories'))\/biz_df['business_id'].count()*100)","d75e8c1d":"print(biz_df['Count_MajorCategories'].value_counts()\/biz_df['business_id'].count()*100)\n\n#Count of unique combinations of top-level business categories\nprint (biz_df['MajorCategories'].apply(tuple).nunique())\n\n#Count of unique combinations of top-level business categories for businesses with no more than 3 such labels used\nprint (biz_df[biz_df.Count_MajorCategories > 3]['MajorCategories'].apply(tuple).nunique())","35b0d4df":"#New lets look at the distribution of review counts across major categories\n# df_BusinessesPerCategories_major = biz_df.groupby(['MajorCategories'])['review_count'].sum().reset_index().sort_values('review_count',ascending = False)\n# df_BusinessesPerCategories_major['Percent'] = (df_BusinessesPerCategories_major['review_count']\/df_BusinessesPerCategories_major['review_count'].sum())*100.00\n# df_BusinessesPerCategories_major.head()\n\n#New lets look at the distribution of review counts across major categories\ndf_BusinessesPerCategories_major = pd.DataFrame(biz_df.groupby(biz_df['MajorCategories'].map(tuple))['review_count'].sum())\ndf_BusinessesPerCategories_major.reset_index(level=0, inplace=True) #reset index to column\ndf_BusinessesPerCategories_major['Cum_review_count'] = df_BusinessesPerCategories_major['review_count'].cumsum(axis = 0)\ndf_BusinessesPerCategories_major['Percent'] = (df_BusinessesPerCategories_major['review_count']\/df_BusinessesPerCategories_major['review_count'].sum())*100.00\ndf_BusinessesPerCategories_major = df_BusinessesPerCategories_major.sort_values(['Percent'], ascending = 0)\n\ndf_BusinessesPerCategories_major['Cum_Percent'] = df_BusinessesPerCategories_major['Percent'].cumsum(axis = 0)\ndf_BusinessesPerCategories_major = df_BusinessesPerCategories_major.sort_values(['Percent'], ascending = 0)\n\ndf_BusinessesPerCategories_major.head(10)","e71a3c6b":"#Converting the list back to string because some operations and plots are not easy to deal with list types.\nbiz_df['MajorCategories'] = biz_df.MajorCategories.apply(', '.join)\npd.DataFrame(biz_df['MajorCategories'].unique()).head(10)","0339b066":"# #Plotting top 25 most reviewed businesses among all categories\nax = sns.catplot(x=\"review_count\", y=\"name\",data= biz_df.nlargest(25,'review_count'), \n                  kind=\"bar\", hue = 'MajorCategories', dodge= False, height= 10 )\n\nplt.subplots_adjust(top=0.9)\nax.fig.suptitle('Top 25 Most Reviewed Businesses And Categories Lables Used') # can also get the figure from plt.gcf()","a179e59f":"#Drop the businesses that use more than three top-level business categories\nto_drop = list(biz_df.query(\"Count_MajorCategories > 3\")['MajorCategories'])\nto_drop\nbiz_df = biz_df[~biz_df.MajorCategories.isin(to_drop)]\nbiz_df.head(3)","855fdd3f":"print (biz_df['MajorCategories'].nunique())","7a5361ab":"#Following turns into lists, .nunique() does not work on lists, so need to count list length of the items (!!USE THIS!!)\n#biz_df['MajorCategories'] = biz_df.MajorCategories.map(lambda x: [i.strip() for i in sorted(x.split(\", \"))])","aa121887":"biz_df.head(5)","8400189c":"#Finding the distrubution of the counts of businesses per category\ndf_BusinessesPerCategories = pd.DataFrame(biz_df['MajorCategories'].value_counts())\ndf_BusinessesPerCategories.reset_index(level=0, inplace=True) #reset index to column\ndf_BusinessesPerCategories.rename(columns={'MajorCategories':'Count_Businesses','index':'MajorCategories'}, inplace=True) #Renaming columns\ndf_BusinessesPerCategories['Cum_Count_Businesses'] = df_BusinessesPerCategories['Count_Businesses'].cumsum(axis = 0)\n\ndf_BusinessesPerCategories['Percent_Busnisses'] = (df_BusinessesPerCategories['Count_Businesses']\/df_BusinessesPerCategories['Count_Businesses'].sum())*100.00\ndf_BusinessesPerCategories = df_BusinessesPerCategories.sort_values(['Percent_Busnisses'], ascending = 0)\ndf_BusinessesPerCategories = df_BusinessesPerCategories.reset_index(drop=True)\n\ndf_BusinessesPerCategories['Cum_Percent_Busnisses'] = df_BusinessesPerCategories['Percent_Busnisses'].cumsum(axis = 0)\ndf_BusinessesPerCategories = df_BusinessesPerCategories.sort_values(['Percent_Busnisses'], ascending = 0)\n\n#df_categoriesDist['Cum_'] = df_categoriesDist['MajorCategories'].cumsum(axis = 0)\ndf_BusinessesPerCategories.head(10)","278b7464":"#Finding the distribution of review counts per category\ndf_ReviewsPerCategories = pd.DataFrame(biz_df.groupby(['MajorCategories'])['review_count'].sum())\ndf_ReviewsPerCategories.reset_index(level=0, inplace=True) #reset index to column\ndf_ReviewsPerCategories['Cum_review_count'] = df_ReviewsPerCategories['review_count'].cumsum(axis = 0)\n\ndf_ReviewsPerCategories['Percent_reviews'] = (df_ReviewsPerCategories['review_count']\/df_ReviewsPerCategories['review_count'].sum())*100.00\ndf_ReviewsPerCategories = df_ReviewsPerCategories.sort_values(['Percent_reviews'], ascending = 0)\ndf_ReviewsPerCategories = df_ReviewsPerCategories.reset_index(drop=True)\n\ndf_ReviewsPerCategories['Cum_Percent_reviews'] = df_ReviewsPerCategories['Percent_reviews'].cumsum(axis = 0)\n#df_ReviewsPerCategories = df_ReviewsPerCategories.sort_values(['Percent'], ascending = 0)\n\n#df_categoriesDist['Cum_'] = df_categoriesDist['MajorCategories'].cumsum(axis = 0)\ndf_ReviewsPerCategories.head(10)","7c57fb98":"df_BusinessesPerCategories= df_BusinessesPerCategories.head(50)\ndf_ReviewsPerCategories = df_ReviewsPerCategories.head(50)","c0edccaa":"#Joining the reviews counts and business counts dataframe per business category\ndf_CtReviewsAndBiz_PerCat = df_ReviewsPerCategories.merge(df_BusinessesPerCategories, on='MajorCategories', how='inner')\n\n#Adding weighted column Ct_ReviewPerBiz\ndf_CtReviewsAndBiz_PerCat['Weight'] = df_CtReviewsAndBiz_PerCat['Percent_reviews']*df_CtReviewsAndBiz_PerCat['Percent_Busnisses']\n\n#Lets also add the differences in percent of business vs. percent of review and sort the df with this new column to help with vizualization later on\ndf_CtReviewsAndBiz_PerCat['Percent_Diff'] = df_CtReviewsAndBiz_PerCat['Percent_reviews']-df_CtReviewsAndBiz_PerCat['Percent_Busnisses']\ndf_CtReviewsAndBiz_PerCat = df_CtReviewsAndBiz_PerCat.sort_values(['Percent_Diff'], ascending = 0)\n\ndf_CtReviewsAndBiz_PerCat = df_CtReviewsAndBiz_PerCat.reset_index(drop=True)\ndf_CtReviewsAndBiz_PerCat.head(5)","350ca725":"import seaborn as sns\nsns.set(style=\"white\")\n\n# Load the example mpg dataset\nplt_data = df_CtReviewsAndBiz_PerCat.head(50)\n\n# Plot miles per gallon against horsepower with other semantics\nsns.relplot(x=\"Percent_reviews\", y=\"Percent_Busnisses\", hue=\"MajorCategories\", size=\"Weight\",\n            sizes=(100, 1000), alpha=0.7, palette=\"muted\", height=10, data=plt_data)","cc804abe":"plt_data = df_CtReviewsAndBiz_PerCat.head(50)\n\nplt_data = plt_data[['MajorCategories','Percent_reviews','Percent_Busnisses']]\nplt_data = plt_data.melt('MajorCategories', var_name='Group', value_name='Percent')\nplt_data.head(5)","fec6e8aa":"sns.set(style=\"whitegrid\")\n\n# Load the example Titanic dataset\ntitanic = sns.load_dataset(\"titanic\")\n\n# Draw a nested barplot to show survival for class and sex\ng = sns.catplot(x=\"Percent\", y=\"MajorCategories\", hue=\"Group\", data=plt_data,\n                height=12, kind=\"bar\", palette=\"muted\")\ng.despine(left=True)\ng.set_ylabels(\"Business Categories\")","836fc63e":"#Next lets also look at the reviews distribution by cities\ndf_reviewsPerCity = pd.DataFrame(biz_df.groupby(['city'])['review_count'].sum().sort_values(ascending=False))\ndf_reviewsPerCity.reset_index(level=0, inplace=True) #reset index to column\ndf_reviewsPerCity['Cum_review_count'] = df_reviewsPerCity['review_count'].cumsum(axis = 0)\n\ndf_reviewsPerCity['Percent_reviews'] = (df_reviewsPerCity['review_count']\/df_reviewsPerCity['review_count'].sum())*100.00\ndf_reviewsPerCity = df_reviewsPerCity.sort_values(['Percent_reviews'], ascending = 0)\ndf_reviewsPerCity = df_reviewsPerCity.reset_index(drop=True)\n\ndf_reviewsPerCity['Cum_Percent_reviews'] = df_reviewsPerCity['Percent_reviews'].cumsum(axis = 0)\n\nax = sns.catplot(x=\"Percent_reviews\", y=\"city\",kind=\"bar\",data=df_reviewsPerCity.head(25), height = 7)\nplt.subplots_adjust(top=0.9)\nax.fig.suptitle('Top 25 Cities by Total Review Counts') # can also get the figure from plt.gcf()\n\ndf_reviewsPerCity.head(5)","9183b8ba":"#Next lets also look at the business distribution by cities\ndf_bizPerCity = pd.DataFrame(biz_df.groupby(['city'])['business_id'].count().sort_values(ascending=False))\ndf_bizPerCity.reset_index(level=0, inplace=True) #reset index to column\ndf_bizPerCity['Cum_Biz_Count'] = df_bizPerCity['business_id'].cumsum(axis = 0)\n\ndf_bizPerCity['Percent_Biz'] = (df_bizPerCity['business_id']\/df_bizPerCity['business_id'].sum())*100.00\ndf_bizPerCity = df_bizPerCity.sort_values(['Percent_Biz'], ascending = 0)\ndf_bizPerCity = df_bizPerCity.reset_index(drop=True)\n\ndf_bizPerCity['Cum_Percent_Biz'] = df_bizPerCity['Percent_Biz'].cumsum(axis = 0)\n\nax = sns.catplot(x=\"Percent_Biz\", y=\"city\",kind=\"bar\",data=df_bizPerCity.head(25), height = 7)\nplt.subplots_adjust(top=0.9)\nax.fig.suptitle('Top 25 Cities by Total Business Counts') # can also get the figure from plt.gcf()\n\ndf_reviewsPerCity.head(5)","7e703686":"#Joining the reviews counts and business counts dataframe per business category\ndf_CtReviewsAndBiz_PerCity = df_bizPerCity.merge(df_reviewsPerCity, on='city', how='inner')\n\n# #Adding weighted column Ct_ReviewPerBiz\ndf_CtReviewsAndBiz_PerCity['Weight'] = df_CtReviewsAndBiz_PerCity['Percent_reviews']*df_CtReviewsAndBiz_PerCity['Percent_Biz']\n\n#Lets also add the differences in percent of business vs. percent of review and sort the df with this new column to help with vizualization later on\ndf_CtReviewsAndBiz_PerCity['Percent_Diff'] = df_CtReviewsAndBiz_PerCity['Percent_reviews']-df_CtReviewsAndBiz_PerCity['Percent_Biz']\ndf_CtReviewsAndBiz_PerCity = df_CtReviewsAndBiz_PerCity.sort_values(['Percent_Diff'], ascending = 0)\n\n# df_CtReviewsAndBiz_PerCity = df_CtReviewsAndBiz_PerCity.reset_index(drop=True)\ndf_CtReviewsAndBiz_PerCity.head(10)","abf49e6e":"import seaborn as sns\nsns.set(style=\"white\")\n\n# Load the example mpg dataset\nplt_data = df_CtReviewsAndBiz_PerCity.head(50)\n\n# Plot miles per gallon against horsepower with other semantics\nsns.relplot(x=\"Percent_reviews\", y=\"Percent_Biz\", hue=\"city\", size=\"Weight\",\n            sizes=(100, 1000), alpha=0.7, palette=\"muted\", height=10, data=plt_data)","f7e54967":"plt_data = df_CtReviewsAndBiz_PerCity.head(20)\n\nplt_data = plt_data[['city','Percent_reviews','Percent_Biz']]\nplt_data = plt_data.melt('city', var_name='Group', value_name='Percent')\n\nsns.set(style=\"whitegrid\")\n\n# Draw a nested barplot to show survival for class and sex\ng = sns.catplot(x=\"Percent\", y=\"city\", hue=\"Group\", data=plt_data,\n                aspect=2, kind=\"bar\", palette=\"muted\")\ng.despine(left=True)\ng.set_ylabels(\"City\")","9320487e":"df_BusinessesPerCategories_perCity = (biz_df.groupby(['city','MajorCategories']).agg({'business_id':'count', 'review_count': 'sum'}).reset_index().rename(columns={'business_id':'biz_count','MajorCategories':'MajorCat'}))","c37d3cf4":"#Order by cities and biz counts to populate ordered cum  counts of biz per city\ndf_BusinessesPerCategories_perCity = df_BusinessesPerCategories_perCity.sort_values(['city','biz_count'], ascending = [0,0])\ndf_BusinessesPerCategories_perCity['Cum_biz_ct'] = df_BusinessesPerCategories_perCity.groupby(['city'])['biz_count'].transform(pd.Series.cumsum)\n\n#Order by cities and review counts to populate ordered cum  counts of reviews per city\ndf_BusinessesPerCategories_perCity = df_BusinessesPerCategories_perCity.sort_values(['city','review_count'], ascending = [0,0])\ndf_BusinessesPerCategories_perCity['Cum_review_ct'] = df_BusinessesPerCategories_perCity.groupby(['city'])['review_count'].transform(pd.Series.cumsum)\n\n#Populating percent business and cumulitive percent business columns\ntotal = df_BusinessesPerCategories_perCity.groupby('city')['biz_count'].transform('sum')\ndf_BusinessesPerCategories_perCity['biz_pc'] = (df_BusinessesPerCategories_perCity['biz_count']\/total)*100\n#Sort the df by percent biz before populating cumulitive biz percent\ndf_BusinessesPerCategories_perCity = df_BusinessesPerCategories_perCity.sort_values(['city','biz_pc'], ascending = [0,0])\ndf_BusinessesPerCategories_perCity['Cum_biz_pc'] = df_BusinessesPerCategories_perCity.groupby(['city'])['biz_pc'].transform(pd.Series.cumsum)\n\n#Populating percent reviews and cumulitive reviews  columns\ntotal = df_BusinessesPerCategories_perCity.groupby('city')['review_count'].transform('sum')\ndf_BusinessesPerCategories_perCity['review_pc'] = (df_BusinessesPerCategories_perCity['review_count']\/total)*100\n#Sort the df by percent reviews before populating cumulitive reviews percent\ndf_BusinessesPerCategories_perCity = df_BusinessesPerCategories_perCity.sort_values(['city','review_pc'], ascending = [0,0])\ndf_BusinessesPerCategories_perCity['Cum_review_pc'] = df_BusinessesPerCategories_perCity.groupby(['city'])['review_pc'].transform(pd.Series.cumsum)","b521df9f":"n_top_categories = 10\ndf_topX_reviewCats_perCity = df_BusinessesPerCategories_perCity.loc[df_BusinessesPerCategories_perCity.\n                                                                    groupby('city')['review_pc'].nlargest(n_top_categories)\n                                                                    .reset_index()['level_1']]\n\nn_top_cities = 10\ncities_to_analyze = df_CtReviewsAndBiz_PerCity.nlargest(n_top_cities, 'review_count')['city']\nplt_data = df_topX_reviewCats_perCity[df_topX_reviewCats_perCity.city.isin(cities_to_analyze)]\nplt_data = plt_data[['city','MajorCat','biz_pc','review_pc']]\n\n#plt_data.melt('name').sort_values('name')\n#plt_data = plt_data[['city','MajorCat','biz_count']]\n#plt_data = plt_data.melt('city', var_name='Group', value_name='Percent')\nplt_data[plt_data.city == 'Las Vegas'].head(5)","62b1158f":"sns.set(style=\"whitegrid\")\n\n# Draw a nested barplot to show survival for class and sex\ng = sns.catplot(x=\"review_pc\", y=\"MajorCat\", col = \"city\",col_wrap = 3 ,data=plt_data,\n                aspect=0.9,height=5, kind=\"bar\", palette=\"muted\")\ng.despine(left=True)\ng.set_ylabels(\"City\")","be90dcc7":"analysis_categories = ['Restaurants','Food,Restaurants','Nightlife,Restaurants','Food,Nightlife,Restaurants']","a888f815":"df_biz_Resturants = biz_df[biz_df.MajorCategories.isin(analysis_categories)]\nprint(df_biz_Resturants['MajorCategories'].value_counts())\ndf_biz_Resturants.head(5)","16df7c9b":"df_Resturants_LV = df_biz_Resturants[df_biz_Resturants['city'] == 'Las Vegas']","0554484c":"sns.regplot(x=\"latitude\", y=\"longitude\",data=df_Resturants_LV,scatter_kws={\"color\":\"darkred\",\"alpha\":0.2,\"s\":3},fit_reg=False)","860b7bc0":"# Lets also load the reviews data into pandas dataframe and look into the size, and structure of the dataframe, columns and their data types\n# review_file = open('..\/input\/yelp_academic_dataset_review.json',encoding=\"utf8\")\n# review_df = pd.DataFrame([json.loads(next(review_file)) for x in range(5200000)])\n# review_file.close()\n# review_df.info()","6165b6f1":"# review_df['stars'].value_counts()","141fab2a":"# # Lets observe the reviews dataframe as well\n# review_df.head()","9c013c99":"# #Drop the reviews of businesses that do not belong to the categories we are interested in.\n# to_keep = list(biz_df['business_id'].unique())\n# to_keep\n# review_df = review_df[review_df.business_id.isin(to_keep)]\n# review_df.info()\n\n# del review_df\n# del restaurant_reviews\n\n# del [[review_df,restaurant_reviews]]\n# gc.collect()","51eec118":"#join dataframe\nrestaurant_reviews = biz_df.merge(review_df, on='business_id', how='inner')\nrestaurant_reviews.info()","553dec63":"We see that the most reviewed resturant category businesses are including at least one other label from the sub-categories, and there are plenty of variants\/combinations of sub-categories used with the top-level resturant. For our analysis, we are only interested in the top-level category, for example, 'Resturant' or 'Shopping', not 'Mexican' or 'Chinese' resturant. We will discard the sub-category labels such as 'Mexican', 'Pizza', 'Sushi Bars' that are not among the 22 top-level catetogy labels as found in Yelp website, and focus on determining which of the 22 top-level categories businesses belong to before performing our categories based analyses.","4fd226e4":"There are 758 unique combination of 3 or less top-level categories used by businesses.","b39a88e9":"This notebook attempts to perform an extensive exploratory data analysis of the Yelp business dataset with various summary statistics and plots. I hope some of you might find it useful. Please upvote and fork the notebook if you like it, and please comment on your take on the approach I have taken in this EDA.\n\nMy original goal of doing time-series analysis on few top major categories by extracting the reviews data on some top business categories identified in this EDA.\nHowever, I have halted my attempt, for now, to use reviews data as I want to read all of the dataset and then filter on to extract all the reivews associated with few specific business categories. I found that it is not feasible to do that in Kaggle due to RAM limit at 16GB which caused the memory to max out whenver I read the entire review dataset. Given the data format the review file is in (.json that is not in proper .json format), I could not find an efficient way of reading by streaming the data only saving what I wanted to a dataframe. ","b48919fa":"93,385 business categories are too many categories for the purpose of our analysis.\n\nNext, we will look at top 25 most reviewed business and see what business categories they belong to.","38f8b21f":"Ordering the lists of business labels in the categories brought the unique counts down to 48,856 from 93,385. Still, 48,000 plus is a lots of categories for category based analyses.\n\nOne challenge in business category based analyses is deciding how to treat non-specialized businesses that label themselves using multiple diverse lables. Should we extract all unique categories keywords used in the dataset and let businesses using diverse labels to be counted\/used across all such categories lables? That might not actually be a good idea.\n\nAccording to Yelp, businesses can be in up to three categories. It lists only 22 top-level businesses categories that have over 1200 sub-categories overall, which can lead to millions of category combinations. [Yelp website](https:\/\/blog.yelp.com\/2018\/01\/yelp_category_list#section13)\n\nGiven the Yelp policy that businesses can be in up to three top-level categories, we can see that lots of businesses have used multiple top-level categories to describe themselves, and many are still using more than three, probably keywords from the sub-categories.\n\nFor our purpose, we will use the 22 top-level categories of Yelp to find out which businesses are using how many of these labels and create new classification column to re-assign the categories using top-level words only. This should help put many businesses into their most representative categories high-level categories while also brining down the total number of unique categories for the analysis. ","195d4893":"We see that there is some variation among businesses in the way and number of keywords they use in the categories.\nSome specific businesses, for example, Secret Pizza is using just two labels, 'Resturants' and 'Pizza' in their categories.\nOn the other hand, The Buffet is using 10 different labels in their categories. One other thing to notice is that the categories keywords are not always alphabetically ordered. If we order them all, we might end up with lower than 90,000+ unique categories.","d1870f51":"Next, lets load the business data into pandas dataframe and look into the size, and structure of the dataframe, columns and their data types\n","47342844":"# Extensive Exploratory Data Analysis of Yelp Business Dataset","1585cff0":"Next, we will parse and conver the categories to lists so that other operations can be performed on it.","5846b5e8":"We can see that some businesses are using as much as 37 keywords in their categories. Let's look at some of these businesses.\n\nHow about the overall distribution of the number of keywords used by businesses? Let's discern that information.","25a47652":"With the scatterplot above, we can see that businesses using singular 'Resturant' keyword in category represent proportionally very high number of businesses as well as reivews. Another group of businesses using 'Nightlife, Resturants' and 'Food, Resurants' could be seen as a group with around 10-15% of reviews and 2.5-7.5% of businesses. \n\nOther six categories can be seen as a third cluster representing 5-9% of businesses with only 2-5% of reviews. Yet another less significant cluster appears to be businesses using categories that represent less than 2.5% of businesses and less than 4% of all reviews.\n\nWe can clearly see that 'Resturants' represent the highest categories of businesses in Yelp and also receive proportionally highest number of user reviews.\n\nWe will vizualize this using a differnt approach to try better understand the data by using bar plot.","27ad3714":"Next, for the remaining 758 unique combinations of categories we will look at the which ones by most used and important by ranking them by the counts of businesses using them and the total reviews for all businesses in each categories.","b29072f4":"Top 50 records contain over all the categories with over 92% of businesses as well as over 94% of all user reviews. Therefore, we will cut down the categories we will look at from over 758 to 50 by discarding records other than top 50 in the above datasets.","66204aaa":"Looking at the distribution of numbers of keywords used by businesses in their categories, vast majority of them are using between one to five keywords. Very few businesses are using over ten keywords, and it is likely to drop such businesses due to possible uncertainity in determining their actual representative top-level category.","b565e395":"There are a significant number of missing values for business attributes and business hours. For our purpose, we will not be using these two columns and thus do not need to worry about them. \n\nHowever, we will use business categories in the analysis and need to decide what to do about the missing values. We cannot impute the missing business categories, thus we will most certainly need to drop these observations. Let's take a detailed look at those rows.","d4bc3074":"We see that over 67.60% of businesses are using a single top-level business category, 25.69% are using two categories, and only 5.37% are using three cateories. \n\nAlso, the unique categories are now down to 1602 from over 48,000 if we went by the original labels used by the businesses that included many different sub-category keywords. If we discard the businesses using more than 3 top-level categories, the unique counts lowers almost by half to 844 unique combinations.","65eb1eb1":"Let's go ahead and drop the rows that have 'None' values for business categories.","9aa55b1a":"Next, we will repeat the analysis per city per category","1b56b29f":"In addition to information seen in the scatterplot above, the bar plot above shows a few additional information. To vizualize the differences in the percentage of total businesses in the given category vs. total percentage of reviews of all businesses in that category, the categories are sorted with the highest positive difference between percent reviews minus percent businesses on the top.\n\nWe can see that shopping has the highest negative difference- meaning, although this category represents 7.8% of businesses, they received only 2.8% of user reviews in Yelp, which is the highest difference among all the categories."}}