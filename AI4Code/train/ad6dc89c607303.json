{"cell_type":{"c14506db":"code","f079842e":"code","9c7212f1":"code","0fdefa8d":"code","a1424bc2":"code","ee37fc1c":"code","3aa08571":"code","5fea5474":"code","32c5ce49":"code","352eaf2e":"code","d99041df":"code","5b6f2b50":"code","cb22eb81":"code","e02efddc":"code","8309ba7c":"code","7f41a657":"code","3a572222":"code","fee64faf":"code","cbab936d":"code","233cc17b":"code","4c0b22a0":"code","90319dfd":"code","230d50fb":"code","ffba5d49":"code","e4909e73":"code","d95189aa":"code","5ac6e29f":"code","59da593e":"code","696f518b":"code","713a0dcc":"code","ac8f8924":"code","bd8580e2":"code","1c35952a":"code","bfd6dde2":"code","1702c912":"code","fdcccecf":"code","332bd2bf":"code","be9e592d":"code","eff02d9f":"code","43a37491":"code","0e70bea9":"code","18b08d74":"code","62b08275":"code","da5d96a9":"code","acf0566d":"code","e256762c":"code","7a4dc27f":"code","7b3739c5":"code","759a9de1":"code","a783c739":"code","9e3fa8b1":"code","acc580bd":"code","789a6c3b":"code","85fcba18":"code","cd0cf1c8":"code","379a60c2":"code","afc82707":"code","820948c5":"code","7f69a2d9":"code","9089b9cb":"code","4d97d835":"code","6ca07b98":"code","ce3a5974":"code","91810759":"code","08a74e39":"code","8e1b2ef8":"code","97267e9d":"code","71124ffa":"code","f8502ef7":"code","1922339d":"code","bf2bb449":"code","fa69c530":"code","987a61d1":"code","98f174dd":"code","1eb5dc7f":"code","c54665f8":"code","f93425b4":"code","66364bbd":"code","c6ca8bc0":"code","85f29c23":"code","81df25cb":"code","7c8471be":"code","7865b2b4":"code","dcb4a1a3":"code","4ead4295":"code","2a1eca95":"code","f26bc67a":"code","a17408d6":"code","00f4406b":"code","23ab53f7":"code","95c7dae1":"code","a77230da":"code","bc780bf9":"code","066f21e5":"code","592eb6e8":"code","42445ff9":"code","d5c65342":"code","b4416f27":"code","afd4cb72":"code","e117e3d0":"code","f6deb6ab":"code","469fd3da":"code","e2534213":"code","cad49614":"code","bc706f6f":"code","8d9d4084":"code","452518e9":"code","f46f7257":"code","6bc053f8":"code","db9feda8":"code","17ea73d3":"code","5745f87f":"code","b30bcd77":"code","646bc1de":"markdown","b5a36737":"markdown","5a4a80b1":"markdown","605fc9a7":"markdown","950c726a":"markdown","238813f6":"markdown","36092d96":"markdown","9b56dc3b":"markdown","d585c3f6":"markdown","3ddc63dc":"markdown","e48a5f90":"markdown","de7021dd":"markdown","5893248a":"markdown","e11aefb4":"markdown","02188db1":"markdown","cdd4e880":"markdown","0b1b22f3":"markdown","82d05de8":"markdown","171471cc":"markdown","a1860b18":"markdown","7c33db39":"markdown","5e06b24c":"markdown","92aa8979":"markdown","b632fee4":"markdown","a4df048c":"markdown","3f0b4ad1":"markdown","8fa77e46":"markdown","dfbd31ce":"markdown","7a727dbb":"markdown","e16d1c57":"markdown","2f5161d6":"markdown","398b57fb":"markdown","70170910":"markdown","b8748ea6":"markdown","089bbf40":"markdown","a201b18c":"markdown","5d674bab":"markdown","b90c8072":"markdown","2d424c9f":"markdown","e3f51423":"markdown","c46daa2b":"markdown","4c3ad234":"markdown","e566b738":"markdown","16ea35bf":"markdown","d627dd59":"markdown","00334e5e":"markdown","bcedc033":"markdown","bd457b3f":"markdown","0f4607a1":"markdown","3b3bd79c":"markdown","1dc253ba":"markdown","6c3b9e0c":"markdown","9027a5d2":"markdown","4dafd237":"markdown","e9b0aedd":"markdown","dcb420db":"markdown","dc735323":"markdown","1d3a86c5":"markdown","a2099040":"markdown","15049f19":"markdown","3999a106":"markdown","aa591c47":"markdown","aa7559ce":"markdown","0d2532be":"markdown","f7951623":"markdown","5202828d":"markdown","3394b2b1":"markdown","c8af4271":"markdown","3dda6c85":"markdown","5ca7f247":"markdown","4ff574c4":"markdown","bc5c208d":"markdown","21ef742f":"markdown","fe48a87d":"markdown","328d466f":"markdown","c9a5f48e":"markdown","f5da74f5":"markdown","37211fbb":"markdown","a9168b81":"markdown","499c062f":"markdown","441dc481":"markdown","72fb159b":"markdown","e9e3209e":"markdown","aa057a1f":"markdown","9825270c":"markdown","54e92cd7":"markdown","97ceb699":"markdown","d5573b19":"markdown","e6aa1892":"markdown","3eb7df82":"markdown","455bef9d":"markdown","643f1f39":"markdown","0933f197":"markdown","ce07999d":"markdown","840a35cd":"markdown","24fd3ff7":"markdown","b43f688b":"markdown","cb50da9d":"markdown","669c6e11":"markdown","94b0c1d4":"markdown","1d8c7a08":"markdown","ffa230dc":"markdown","a8bf2d7c":"markdown","5243d04c":"markdown","3095f456":"markdown","53fa5479":"markdown","b3a61550":"markdown","5c9ff136":"markdown","96ec300d":"markdown","c194d2f3":"markdown"},"source":{"c14506db":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","f079842e":"!pip install pycaret-nightly\n!pip install missingno","9c7212f1":"import warnings\nwarnings.filterwarnings('ignore')\nimport pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom sklearn.compose import ColumnTransformer\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.impute import SimpleImputer\nfrom sklearn.preprocessing import OneHotEncoder\nfrom sklearn.metrics import mean_absolute_error\nfrom sklearn.decomposition import PCA\nfrom matplotlib import rcParams\nfrom sklearn.preprocessing import QuantileTransformer","0fdefa8d":"train = pd.read_csv(\"..\/input\/house-prices-advanced-regression-techniques\/train.csv\")\nX_test = pd.read_csv(\"..\/input\/house-prices-advanced-regression-techniques\/test.csv\")\nsubmission_data = pd.read_csv('\/kaggle\/input\/house-prices-advanced-regression-techniques\/sample_submission.csv')","a1424bc2":"house_df = pd.concat([train,X_test],ignore_index = True, sort = False)\ntr_idx = house_df['SalePrice'].notnull()","ee37fc1c":"def apply_pca(X, standardize=True):\n    # Standardize\n    if standardize:\n        X = (X - X.mean(axis=0)) \/ X.std(axis=0)\n    # Create principal components\n    pca = PCA()\n    X_pca = pca.fit_transform(X)\n    # Convert to dataframe\n    component_names = [f\"PC{i+1}\" for i in range(X_pca.shape[1])]\n    X_pca = pd.DataFrame(X_pca, columns=component_names)\n    # Create loadings\n    loadings = pd.DataFrame(\n        pca.components_.T,  # transpose the matrix of loadings\n        columns=component_names,  # so the columns are the principal components\n        index=X.columns,  # and the rows are the original features\n    )\n    return pca, X_pca, loadings","3aa08571":"def outlier_iqr(data):\n    q1,q3 = np.percentile(data,[25,75])\n    iqr = q3-q1\n    lower = q1-(iqr*2)\n    upper = q3+(iqr*2)\n    return np.where((data>upper)|(data<lower))","5fea5474":"house_df.shape","32c5ce49":"house_df.info()","352eaf2e":"house_df.head(3).style.set_properties(**{'background-color': 'Grey',\n                           'color': 'white',\n                           'border-color': 'darkblack'})","d99041df":"house_df.drop('Id',axis=1,inplace=True,errors='ignore')","5b6f2b50":"house_df.describe().T.style.set_properties(**{'background-color': 'Grey',\n                           'color': 'white',\n                           'border-color': 'darkblack'})","cb22eb81":"plt.figure(figsize = (8,6))\nax = house_df.dtypes.value_counts().plot(kind='bar',grid = False,fontsize=20,color='grey')\nfor p in ax.patches:\n    height = p.get_height()\n    ax.text(p.get_x()+ p.get_width() \/ 2., height + 1, height, ha = 'center', size = 25)\nsns.despine()","e02efddc":"# \"Cardinality\" meancategorical_colss the number of unique values in a column\n# Select categorical columns with relatively low cardinality (convenient but arbitrary)\ncategorical_cols = [cname for cname in house_df.loc[:,:'SaleCondition'].columns if\n                    house_df[cname].nunique() < 10 and \n                    house_df[cname].dtype == \"object\"]\n\n# Select numerical columns\nint_cols = [cname for cname in house_df.loc[:,:'SaleCondition'].columns if \n                house_df[cname].dtype in ['int64']]\nfloat_cols = [cname for cname in house_df.loc[:,:'SaleCondition'].columns if \n                house_df[cname].dtype in ['float64']]\n\nnumerical_cols = int_cols + float_cols\n\n# Keep selected columns only\nmy_cols = categorical_cols + numerical_cols","8309ba7c":"import missingno as msno\nmsno.matrix(house_df[tr_idx])","7f41a657":"from sklearn.impute import KNNImputer\nimputer = KNNImputer(n_neighbors=5)\nhouse_df.loc[:,numerical_cols] = imputer.fit_transform(house_df.loc[:,numerical_cols])","3a572222":"msno.bar(house_df.loc[:,categorical_cols])","fee64faf":"house_df[['PoolQC','MiscFeature','Alley','Fence','FireplaceQu']].info()","cbab936d":"isnull_series = house_df.loc[:,:'SaleCondition'].isnull().sum()\nisnull_series[isnull_series > 0].sort_values(ascending=False)\n\nplt.figure(figsize = (20,10))\nax = isnull_series[isnull_series > 0].sort_values(ascending=False).plot(kind='bar',\n                                                                        grid = False,\n                                                                        fontsize=20,\n                                                                        color='grey')\nplt.legend(loc = 'upper right')\nfor p in ax.patches:\n    height = p.get_height()\n    ax.text(p.get_x()+ p.get_width() \/ 2., height + 5, height, ha = 'center', size = 20)\nsns.despine()","233cc17b":"house_df['SalePriceCpy'] = house_df['SalePrice'].copy()","4c0b22a0":"plt.figure(figsize = (15,6))\nax1 = plt.subplot(1,2,1)\nsns.histplot(house_df['SalePrice'],color='Blue',kde=True)\nplt.axvline(x=house_df['SalePrice'].mean(), color='g', linestyle='--', linewidth=3)\nplt.text(house_df['SalePrice'].mean(), 125, \"Mean\", horizontalalignment='left', size=20, color='black', weight='semibold')\nplt.title('Original Sale Price Histogram',fontsize=20)\nax2 = plt.subplot(1,2,2)\nsns.regplot(data=house_df, y=\"SalePrice\", x=\"GrLivArea\",ax=ax2,color='Blue')\nax2.set_title('Orignaal Sale Price',fontsize=20)\nsns.despine()","90319dfd":"mean = house_df['SalePrice'].mean()\nstd = house_df['SalePrice'].std()\nskew = house_df['SalePrice'].skew()\nprint('SalePrice : mean: {0:.4f}, std: {1:.4f}, skew: {2:.4f}'.format(mean, std, skew))","230d50fb":"house_df['SalePriceCpy'] = np.log1p(house_df['SalePrice'])","ffba5d49":"plt.figure(figsize = (25,20))\nplt.subplots_adjust(hspace=0.3)\nax1 = plt.subplot(2,2,1)\nsns.histplot(house_df['SalePrice'],color='Blue',kde=True)\nplt.axvline(x=house_df['SalePrice'].mean(), color='g', linestyle='--', linewidth=3)\nplt.text(house_df['SalePrice'].mean(), 125, \"Mean\", horizontalalignment='left', size=20, color='black', weight='semibold')\nplt.title('Original Sale Price Histogram',fontsize=20)\nax2 = plt.subplot(2,2,2)\nsns.regplot(data=house_df, y=\"SalePrice\", x=\"GrLivArea\",ax=ax2,color='Blue')\nax2.set_title('Orignaal Sale Price',fontsize=20)\nax3 = plt.subplot(2,2,3)\nsns.histplot(house_df['SalePriceCpy'],color='Blue',kde=True)\nplt.axvline(x=house_df['SalePriceCpy'].mean(), color='g', linestyle='--', linewidth=3)\nplt.text(house_df['SalePriceCpy'].mean(), 125, \"Mean\", horizontalalignment='left', size=20, color='black', weight='semibold')\nplt.title('Log transformed Sale Price Histogram',fontsize=20)\nax4 = plt.subplot(2,2,4)\nsns.regplot(data=house_df, y=\"SalePriceCpy\", x=\"GrLivArea\",ax=ax4,color='Blue')\nax4.set_title('Log transformed Sale Price',fontsize=20)\nsns.despine()","e4909e73":"mean = house_df['SalePriceCpy'].mean()\nstd = house_df['SalePriceCpy'].std()\nskew = house_df['SalePriceCpy'].skew()\nprint('SalePrice : mean: {0:.4f}, std: {1:.4f}, skew: {2:.4f}'.format(mean, std, skew))","d95189aa":"house_df.drop('SalePriceCpy',axis=1,inplace=True,errors='ignore')","5ac6e29f":"i = 1\nsns.set(font_scale = 1.5)\nsns.set_style(\"white\")\nsns.set_palette(\"bright\")\nplt.figure(figsize=(20, 20))\nplt.subplots_adjust(hspace=1)\nfor feature in float_cols:\n    plt.subplot(6,2,i)\n    sns.histplot(house_df[feature], color='Blue')\n    i = i +1","59da593e":"i = 1\nsns.set(font_scale = 1.5)\nsns.set_style(\"white\")\nsns.set_palette(\"Blues_r\")\nplt.figure(figsize=(20,20))\nplt.subplots_adjust(hspace=1)\nfor feature in float_cols:\n    plt.subplot(6,2,i)\n    sns.regplot(data=house_df, x=feature,y='SalePrice')\n    i = i +1","696f518b":"i = 1\nsns.set(font_scale = 2)\nsns.set_style(\"white\")\nsns.set_palette(\"bright\")\nplt.figure(figsize=(40, 40))\nplt.subplots_adjust(hspace=1)\nfor feature in int_cols:\n    plt.subplot(9,4,i)\n    sns.histplot(house_df[feature], color='Blue')\n    i = i +1","713a0dcc":"house_df['MSSubClass'] = house_df['MSSubClass'].apply(str)\nhouse_df['YrSold'] = house_df['YrSold'].astype(str)\nhouse_df['MoSold'] = house_df['MoSold'].astype(str)","ac8f8924":"# \"Cardinality\" meancategorical_colss the number of unique values in a column\n# Select categorical columns with relatively low cardinality (convenient but arbitrary)\ncategorical_cols = [cname for cname in house_df.loc[:,:'SaleCondition'].columns if\n                    house_df[cname].nunique() < 10 and \n                    house_df[cname].dtype == \"object\"]\n\n# Select numerical columns\nint_cols = [cname for cname in house_df.loc[:,:'SaleCondition'].columns if \n                house_df[cname].dtype in ['int64']]\nfloat_cols = [cname for cname in house_df.loc[:,:'SaleCondition'].columns if \n                house_df[cname].dtype in ['float64']]\n\nnumerical_cols = int_cols + float_cols\n\n# Keep selected columns only\nmy_cols = categorical_cols + numerical_cols","bd8580e2":"sns.set(font_scale = 1.5)\nsns.set_style(\"white\")\nsns.set_palette(\"Blues_r\")\nplt.figure(figsize=(16,5))\nplt.subplot(1,2,1)\nplt.subplots_adjust(wspace=0.3)\nax1 = sns.regplot(data=house_df, x='GrLivArea',y='SalePrice')\nax1.set_title('Outliers in GrLivArea',fontsize=20)\nplt.axhline(y=250000, color='Green', linestyle='--', linewidth=3)\nplt.axvline(x=4000, color='Green', linestyle='--', linewidth=3)\nplt.text(4500, 150000, 'Outliers',color='red')\nplt.subplot(1,2,2)\nax2 = sns.regplot(data=house_df, x='TotalBsmtSF',y='SalePrice')\nax2.set_title('Outliers in TotalBsmtSF',fontsize=20)\nplt.axhline(y=250000, color='Green', linestyle='--', linewidth=3)\nplt.axvline(x=4500, color='Green', linestyle='--', linewidth=3)\nplt.text(5000, 200000, 'Outliers',color='red')\nsns.despine()","1c35952a":"features = [\"GarageArea\",\"OverallQual\",\"TotalBsmtSF\",\"GrLivArea\"]","bfd6dde2":"house_copy = house_df[tr_idx].copy()\ny_copy = house_copy.pop(\"SalePrice\")\nX_copy = house_copy.loc[:, features]\n\nX_copy.isnull().sum()\npca, X_pca, loadings = apply_pca(X_copy)\nprint(loadings)","1702c912":"import plotly.express as px\nfig = px.histogram(X_pca.melt(), color=\"variable\", \n                   marginal=\"box\",\n                   barmode =\"overlay\",\n                   histnorm ='density'\n                  )  \nfig.update_layout(\n    title_font_color=\"black\",\n    legend_title_font_color=\"green\",\n    title={\n        'text': \"PCA Histogram\",\n        'x':0.5,\n        'xanchor': 'center',\n        'yanchor': 'top'},\n)","fdcccecf":"pc1_outlier_idx = list(outlier_iqr(X_pca['PC1'])[0])","332bd2bf":"component = \"PC1\"\n\npc1_idx = X_pca[component].sort_values(ascending=False).index\ndf_temp_pc1 = house_df.loc[pc1_idx, [\"SalePrice\", \"Neighborhood\", \"SaleCondition\"] + features]\n\ndef highlight_min(s, props=''):\n    return np.where(s == np.nanmin(s.values), props, '')\n\ndf_temp_pc1.iloc[pc1_outlier_idx,:].style.set_properties(**{'background-color': 'Grey',\n                            'color': 'white',\n                            'border-color': 'darkblack'})","be9e592d":"sns.set(font_scale = 1.5)\nsns.set_style(\"white\")\nsns.set_palette(\"Blues_r\")\nplt.figure(figsize=(20,30))\nplt.subplots_adjust(hspace=0.3)\nplt.subplot(4,2,1)\nax1 = sns.regplot(data=house_df, x='GrLivArea',y='SalePrice')\nax1.set_title('Outliers in GrLivArea',fontsize=20)\nplt.axhline(y=250000, color='Green', linestyle='--', linewidth=3)\nplt.axvline(x=4000, color='Green', linestyle='--', linewidth=3)\nplt.text(4500, 200000, 'Outliers',color='red')\nplt.subplot(4,2,2)\nax2 = sns.regplot(data=house_df.iloc[pc1_outlier_idx,:], x='GrLivArea',y='SalePrice')\nax2.set_title('Outliers After PCA',fontsize=20)\nplt.axhline(y=300000, color='Green', linestyle='--', linewidth=3)\nplt.axvline(x=4000, color='Green', linestyle='--', linewidth=3)\nplt.text(4500, 200000, 'Outliers',color='red')\nplt.subplot(4,2,3)\nax3 = sns.regplot(data=house_df, x='TotalBsmtSF',y='SalePrice')\nax3.set_title('Outliers in TotalBsmtSF',fontsize=20)\nplt.axhline(y=450000, color='Green', linestyle='--', linewidth=3)\nplt.axvline(x=4500, color='Green', linestyle='--', linewidth=3)\nplt.text(5000, 220000, 'Outliers',color='red')\nplt.subplot(4,2,4)\nax4 = sns.regplot(data=house_df.iloc[pc1_outlier_idx,:], x='TotalBsmtSF',y='SalePrice')\nax4.set_title('Outliers After PCA',fontsize=20)\nplt.axhline(y=450000, color='Green', linestyle='--', linewidth=3)\nplt.axvline(x=3500, color='Green', linestyle='--', linewidth=3)\nplt.text(5000, 250000, 'Outliers',color='red')\nplt.subplot(4,2,5)\nax5 = sns.regplot(data=house_df, x='OverallQual',y='SalePrice')\nax5.set_title('Outliers in OverallQual',fontsize=20)\nplt.axhline(y=650000, color='Green', linestyle='--', linewidth=3)\nplt.text(6, 700000, 'Outliers',color='red')\nplt.subplot(4,2,6)\nax6 = sns.regplot(data=house_df.iloc[pc1_outlier_idx,:], x='OverallQual',y='SalePrice')\nax6.set_title('Outliers After PCA',fontsize=20)\nplt.axhline(y=650000, color='Green', linestyle='--', linewidth=3)\nplt.text(6, 700000, 'Outliers',color='red')\nplt.subplot(4,2,7)\nax7 = sns.regplot(data=house_df, x='GarageArea',y='SalePrice')\nax7.set_title('Outliers in GarageArea',fontsize=20)\nplt.axhline(y=700000, color='Green', linestyle='--', linewidth=3)\nplt.text(400, 720000, 'Outliers',color='red')\nplt.subplot(4,2,8)\nax8 = sns.regplot(data=house_df.iloc[pc1_outlier_idx,:], x='GarageArea',y='SalePrice')\nax8.set_title('Outliers After PCA',fontsize=20)\nplt.axhline(y=700000, color='Green', linestyle='--', linewidth=3)\nplt.text(1000, 720000, 'Outliers',color='red')\nsns.despine()","eff02d9f":"pc2_outlier_idx = list(outlier_iqr(X_pca['PC2'])[0])","43a37491":"component = \"PC2\"\n\npc2_idx = X_pca[component].sort_values(ascending=False).index\ndf_temp_pc2 = house_df.loc[pc2_idx, [\"SalePrice\", \"Neighborhood\", \"SaleCondition\"] + features]\n\ndef highlight_min(s, props=''):\n    return np.where(s == np.nanmin(s.values), props, '')\n\ndf_temp_pc2.iloc[pc2_outlier_idx,:].style.set_properties(**{'background-color': 'Grey',\n                            'color': 'white',\n                            'border-color': 'darkblack'})","0e70bea9":"house_df.drop(pc1_outlier_idx,axis=0,inplace=True,errors='ignore')\nhouse_df.drop(pc2_outlier_idx,axis=0,inplace=True,errors='ignore')","18b08d74":"sns.set(font_scale = 1.5)\nsns.set_style(\"white\")\nsns.set_palette(\"Blues_r\")\nplt.figure(figsize=(20,15))\nplt.subplots_adjust(hspace=0.2,wspace=0.4)\nplt.subplot(2,2,1)\nsns.regplot(data=house_df, x='GrLivArea',y='SalePrice')\nplt.axhline(y=250000, color='Green', linestyle='--', linewidth=3)\nplt.axvline(x=4000, color='Green', linestyle='--', linewidth=3)\nplt.text(4010, 200000, 'Outliers',color='red')\nplt.subplot(2,2,2)\nsns.regplot(data=house_df, x='TotalBsmtSF',y='SalePrice')\nplt.axhline(y=450000, color='Green', linestyle='--', linewidth=3)\nplt.axvline(x=4500, color='Green', linestyle='--', linewidth=3)\nplt.text(4800, 250000, 'Outliers',color='red')\nplt.subplot(2,2,3)\nsns.regplot(data=house_df, x='YearRemodAdd',y='SalePrice')\nplt.axhline(y=650000, color='Green', linestyle='--', linewidth=3)\nplt.text(2000, 680000, 'Outliers',color='red')\nplt.subplot(2,2,4)\nsns.regplot(data=house_df, x='GarageArea',y='SalePrice')\nplt.axhline(y=680000, color='Green', linestyle='--', linewidth=3)\nplt.text(400, 720000, 'Outliers',color='red')\nsns.despine()","62b08275":"house_df[\"AllArea\"] = house_df.GrLivArea + house_df.TotalBsmtSF","da5d96a9":"sns.set_style(\"white\")\nsns.set_palette(\"Blues_r\")\nsns.regplot(data=house_df, x='AllArea',y='SalePrice')\nplt.title('AllArea-SalePrice',fontsize=20)\nsns.despine()","acf0566d":"house_df[\"NewBsmtSF\"] = house_df['YearRemodAdd'] + house_df['TotalBsmtSF']","e256762c":"sns.set_style(\"white\")\nsns.set_palette(\"Blues_r\")\nsns.regplot(data=house_df, x='NewBsmtSF',y='SalePrice')\nplt.title('NewBsmtSF-SalePrice',fontsize=20)\nsns.despine()","7a4dc27f":"house_df[\"HighQualSF\"] = house_df[\"1stFlrSF\"] + house_df[\"2ndFlrSF\"]","7b3739c5":"sns.set_style(\"white\")\nsns.set_palette(\"Blues_r\")\nsns.regplot(data=house_df, x='NewBsmtSF',y='SalePrice')\nplt.title('HighQualSF-SalePrice',fontsize=20)\nsns.despine()","759a9de1":"# \"Cardinality\" meancategorical_colss the number of unique values in a column\n# Select categorical columns with relatively low cardinality (convenient but arbitrary)\ncategorical_cols = [cname for cname in house_df.loc[:,:'SaleCondition'].columns if\n                    house_df[cname].nunique() < 10 and \n                    house_df[cname].dtype == \"object\"]\n\n# Select numerical columns\nint_cols = [cname for cname in house_df.loc[:,:'SaleCondition'].columns if \n                house_df[cname].dtype in ['int64']]\nfloat_cols = [cname for cname in house_df.loc[:,:'SaleCondition'].columns if \n                house_df[cname].dtype in ['float64']]\n\nnumerical_cols = int_cols + float_cols\n\n# Keep selected columns only\nmy_cols = categorical_cols + numerical_cols","a783c739":"from scipy.stats import skew\nplt.figure(figsize=(20, 10))\nskew_features = house_df[numerical_cols].apply(lambda x : skew(x))\nskew_features = skew_features[skew_features > 1].sort_values(ascending=False)\nax = sns.barplot( x =skew_features.index,y=skew_features.values,color='grey')\nfor p in ax.patches:\n    height = p.get_height().round(1)\n    ax.text(p.get_x()+ p.get_width()\/\/2, height, height, ha = 'left', size = 20)\nplt.xticks(rotation=45)\nplt.text(5, 1.2, 'Threshold',color='red')\nplt.axhline(y=1, color='green', linestyle='--', linewidth=3)\nplt.title('Skewness',fontsize=30)\nsns.despine()","9e3fa8b1":"house_df[skew_features.index] = np.log1p(house_df[skew_features.index])","acc580bd":"from scipy.stats import skew\nplt.figure(figsize=(10, 5))\nskew_features = house_df[numerical_cols].apply(lambda x : skew(x))\nskew_features = skew_features[skew_features > 1].sort_values(ascending=False)\nax = sns.barplot( x =skew_features.index,y=skew_features.values,color='grey')\nfor p in ax.patches:\n    height = p.get_height().round(1)\n    ax.text(p.get_x()+ p.get_width()\/\/2, height, height, ha = 'left', size = 20)\nplt.xticks(rotation=45)\nplt.axhline(y=1, color='green', linestyle='--', linewidth=3)\nplt.text(4, 1.2, 'Threshold',color='red')\nplt.title('Skewness',fontsize=30)\nsns.despine()","789a6c3b":"i = 1\nsns.set(font_scale = 1.5)\nsns.set_style(\"white\")\nsns.set_palette(\"gist_yarg_r\")\nplt.figure(figsize=(20,30))\nplt.subplots_adjust(hspace=1)\nfor feature in skew_features.index:\n    plt.subplot(10,2,i)\n    sns.histplot(house_df[feature], color='blue')\n    i = i +1","85fcba18":"categorical_cols = [cname for cname in house_df.columns if\n                    house_df[cname].dtype == \"object\"]","cd0cf1c8":"isnull_series = house_df.loc[:,:'SaleCondition'].isnull().sum()\nisnull_series[isnull_series >= 20].sort_values(ascending=False)\n\nplt.figure(figsize = (20,10))\nax = isnull_series[isnull_series >= 20].sort_values(ascending=False).plot(kind='bar',\n                                                                        grid = False,\n                                                                        fontsize=20,\n                                                                        color='grey')\nplt.legend(loc = 'upper right')\nfor p in ax.patches:\n    height = p.get_height()\n    ax.text(p.get_x()+ p.get_width() \/ 2., height + 5, height, ha = 'center', size = 20)\nsns.despine()","379a60c2":"house_df['HasPoolQC'] = house_df['PoolQC'].notnull().astype(int)\n\nplt.figure(figsize=(20,6))\nplt.subplots_adjust(wspace=0.3)\nplt.subplot(1,2,1)\nsns.boxenplot(data=house_df, x='HasPoolQC',y='SalePrice',palette='Set2')\nplt.subplot(1,2,2)\nsns.regplot(data=house_df, x='HasPoolQC',y='SalePrice',color='black')","afc82707":"house_df['HasMiscFeature'] = house_df['MiscFeature'].notnull().astype(int)\n\nplt.figure(figsize=(20,6))\nplt.subplots_adjust(wspace=0.3)\nplt.subplot(1,2,1)\nsns.boxenplot(data=house_df, x='HasMiscFeature',y='SalePrice',palette='Set2')\nplt.subplot(1,2,2)\nsns.regplot(data=house_df, x='HasMiscFeature',y='SalePrice',color='black')","820948c5":"house_df['HasAlley'] = house_df['Alley'].notnull().astype(int)\n\nplt.figure(figsize=(20,6))\nplt.subplots_adjust(wspace=0.3)\nplt.subplot(1,2,1)\nsns.boxenplot(data=house_df, x='HasAlley',y='SalePrice',palette='Set2')\nplt.subplot(1,2,2)\nsns.regplot(data=house_df, x='HasAlley',y='SalePrice',color='black')","7f69a2d9":"house_df['HasFence'] = house_df['Fence'].notnull().astype(int)\n\nplt.figure(figsize=(20,6))\nplt.subplots_adjust(wspace=0.3)\nplt.subplot(1,2,1)\nsns.boxenplot(data=house_df, x='HasFence',y='SalePrice',palette='Set2')\nplt.subplot(1,2,2)\nsns.regplot(data=house_df, x='HasFence',y='SalePrice',color='black')","9089b9cb":"house_df['HasFireplaceQu'] = house_df['FireplaceQu'].notnull().astype(int)\n\nplt.figure(figsize=(20,6))\nplt.subplots_adjust(wspace=0.3)\nplt.subplot(1,2,1)\nsns.boxenplot(data=house_df, x='HasFireplaceQu',y='SalePrice',palette='Set2')\nplt.subplot(1,2,2)\nsns.regplot(data=house_df, x='HasFireplaceQu',y='SalePrice',color='black')","4d97d835":"house_df['HasGarageQual'] = house_df['GarageQual'].notnull().astype(int)\n\nplt.figure(figsize=(20,6))\nplt.subplots_adjust(wspace=0.3)\nplt.subplot(1,2,1)\nsns.boxenplot(data=house_df, x='HasGarageQual',y='SalePrice',palette='Set2')\nplt.subplot(1,2,2)\nsns.regplot(data=house_df, x='HasGarageQual',y='SalePrice',color='black')","6ca07b98":"house_df['HasBsmtQual'] = house_df['BsmtQual'].notnull().astype(int)\n\nplt.figure(figsize=(20,6))\nplt.subplots_adjust(wspace=0.3)\nplt.subplot(1,2,1)\nsns.boxenplot(data=house_df, x='HasBsmtQual',y='SalePrice',palette='Set2')\nplt.subplot(1,2,2)\nsns.regplot(data=house_df, x='HasBsmtQual',y='SalePrice',color='black')","ce3a5974":"house_df['HasMasVnrType'] = house_df['MasVnrType'].notnull().astype(int)\n\nplt.figure(figsize=(20,6))\nplt.subplots_adjust(wspace=0.3)\nplt.subplot(1,2,1)\nsns.boxenplot(data=house_df, x='HasMasVnrType',y='SalePrice',palette='Set2')\nplt.subplot(1,2,2)\nsns.regplot(data=house_df, x='HasMasVnrType',y='SalePrice',color='black')","91810759":"house_df['Alley'] = house_df['Alley'].fillna('missing')\nhouse_df['MasVnrType'] = house_df['MasVnrType'].fillna('None')\nhouse_df['GarageType'] = house_df['GarageType'].fillna('missing')\nhouse_df['GarageCond'] = house_df['GarageCond'].fillna('missing')\nhouse_df['Fence'] = house_df['Fence'].fillna('missing')\nhouse_df['Street'] = house_df['Street'].fillna('missing')\nhouse_df['LotShape'] = house_df['LotShape'].fillna('missing')\nhouse_df['LandContour'] = house_df['LandContour'].fillna('missing')\nhouse_df['BsmtFinType1'] = house_df['BsmtFinType1'].fillna('missing')\nhouse_df['BsmtFinType2'] = house_df['BsmtFinType2'].fillna('missing')\nhouse_df['CentralAir'] = house_df['CentralAir'].fillna('missing')\nhouse_df['MiscFeature'] = house_df['MiscFeature'].fillna('missing')\nhouse_df['Utilities'] = house_df['Utilities'].fillna('missing')\nhouse_df['SaleCondition'] = house_df['SaleCondition'].fillna('missing')\nhouse_df[\"Functional\"] = house_df[\"Functional\"].fillna(\"Typ\")","08a74e39":"house_df['MSZoning'] = house_df['MSZoning'].fillna(house_df['MSZoning'].mode()[0])\nhouse_df['PoolQC'] = house_df['PoolQC'].fillna(house_df['PoolQC'].mode()[0])\nhouse_df['BsmtQual'] = house_df['BsmtQual'].fillna(house_df['BsmtQual'].mode()[0])\nhouse_df['BsmtCond'] = house_df['BsmtCond'].fillna(house_df['BsmtCond'].mode()[0])\nhouse_df['FireplaceQu'] = house_df['FireplaceQu'].fillna(house_df['FireplaceQu'].mode()[0])\nhouse_df['GarageFinish'] = house_df['GarageFinish'].fillna(house_df['GarageFinish'].mode()[0])\nhouse_df['GarageQual'] = house_df['GarageQual'].fillna(house_df['GarageQual'].mode()[0])\nhouse_df['BsmtExposure'] = house_df['BsmtExposure'].fillna(house_df['BsmtExposure'].mode()[0])\nhouse_df['Electrical'] = house_df['Electrical'].fillna(house_df['Electrical'].mode()[0])\nhouse_df['Exterior1st'] = house_df['Exterior1st'].fillna(house_df['Exterior1st'].mode()[0])\nhouse_df['Exterior2nd'] = house_df['Exterior2nd'].fillna(house_df['Exterior2nd'].mode()[0])    \nhouse_df['KitchenQual'] = house_df['KitchenQual'].fillna(house_df['KitchenQual'].mode()[0])\nhouse_df['SaleType'] = house_df['SaleType'].fillna(house_df['SaleType'].mode()[0])","8e1b2ef8":"house_df['MSZoning'] = house_df['MSZoning'].replace({'C (all)':1,'RM':2,'RH':3,'RL':4,'FV':5})","97267e9d":"house_df['Condition1'] = house_df['Condition1'].replace({'Artery':1,\n                                                         'RRAe':1,\n                                                         'RRNn':1,\n                                                         'Feedr':1,\n                                                         'RRNe':1,\n                                                         'RRAn':1,\n                                                         'Norm':2,\n                                                         'PosA':3,\n                                                         'PosN':3})","71124ffa":"house_df['Condition2'] = house_df['Condition2'].replace({'RRNn':1,\n                                                         'Artery':2, \n                                                         'Feedr':2,\n                                                         'RRAn':2,\n                                                         'RRAe':2,    \n                                                         'Norm':2,\n                                                         'PosA':3,\n                                                         'PosN':3})","f8502ef7":"def HouseStyleToInt(x):\n    if(x=='1.5Unf'):\n        r = 0\n    elif(x=='SFoyer'):\n        r = 1\n    elif(x=='1.5Fin'):\n        r = 2\n    elif(x=='2.5Unf'):\n        r = 3\n    elif(x=='SLvl'):\n        r = 4\n    elif(x=='1Story'):\n        r = 5\n    elif(x=='2Story'):\n        r = 6  \n    elif(x==' 2.5Fin'):\n        r = 7          \n    else:\n        r = 8\n    return r\n\nhouse_df['HouseStyle'] = house_df['HouseStyle'].apply(HouseStyleToInt)","1922339d":"def MasVnrTypeToInt(x):\n    if(x=='Stone'):\n        r = 3\n    elif(x=='BrkFace'):\n        r = 2\n    elif(x=='BrkCmn'):\n        r = 1        \n    else:\n        r = 0\n    return r\n\nhouse_df['MasVnrType'] = house_df['MasVnrType'].apply(MasVnrTypeToInt)","bf2bb449":"foundation_label = {'Slab':1,'BrkTil':2,'Stone':2,'CBlock':3,'Wood':4,'PConc':5}\nhouse_df['Foundation'] = house_df['Foundation'].replace(foundation_label)","fa69c530":"garagetype_label = {'CarPort':1,'Basment':2,'Detchd':2,'Attchd':3,'2Types':3,'BuiltIn':4}\nhouse_df['GarageType'] = house_df['GarageType'].replace(garagetype_label)","987a61d1":"house_df['GarageFinish'] = house_df['GarageFinish'].replace({'Unf':1,'RFn':2,'Fin':3})","98f174dd":"house_df['PavedDrive'] = house_df['PavedDrive'].replace({'N':1,'P':2,'Y':3})","1eb5dc7f":"salecon_label = {'AdjLand':1,'Abnorml':2,'Family':2,'Alloca':2,'Normal':3,'Partial':4}\nhouse_df['SaleCondition'] = house_df['SaleCondition'].replace(salecon_label)","c54665f8":"ext_lable = {'AsbShng':1,'AsphShn':1,\n             'MetalSd':2,'Wd Sdng':2,'WdShing':2, 'Wd Shng':2,'Stucco':2,'CBlock':2,\n             'HdBoard':3,'BrkFace':3,'Plywood':3,'Other':3,\n             'VinylSd':4,'CemntBd':4,'BrkComm':4,'CmentBd':4,'Brk Cmn':4,\n             'Stone':5,'ImStucc':5 }\nhouse_df['Exterior1st'] = house_df['Exterior1st'].replace(ext_lable)\nhouse_df['Exterior2nd'] = house_df['Exterior2nd'].replace(ext_lable)","f93425b4":"def BsmtExposureToInt(x):\n    if(x=='Gd'):\n        r = 4\n    elif(x=='Av'):\n        r = 3\n    elif(x=='Mn'):\n        r = 2\n    elif(x=='No'):\n        r = 1\n    else:\n        r = 0\n    return r\n\nhouse_df['BsmtExposure'] = house_df['BsmtExposure'].apply(BsmtExposureToInt)","66364bbd":"def BsmtFinType1ToInt(x):\n    if(x=='GLQ'):\n        r = 6\n    elif(x=='ALQ'):\n        r = 5\n    elif(x=='BLQ'):\n        r = 4\n    elif(x=='Rec'):\n        r = 3   \n    elif(x=='LwQ'):\n        r = 2\n    elif(x=='Unf'):\n        r = 1        \n    else:\n        r = 0\n    return r\n\nhouse_df['BsmtFinType1_int'] = house_df['BsmtFinType1'].apply(BsmtFinType1ToInt)","c6ca8bc0":"quality_label = {'Po':1,'Fa':2,'TA':3,'Gd':4,'Ex':5}\n\nhouse_df['ExterQual'] = house_df['ExterQual'].replace(quality_label)\nhouse_df['ExterCond'] = house_df['ExterCond'].replace(quality_label)\nhouse_df['KitchenQual'] = house_df['KitchenQual'].replace(quality_label)\nhouse_df['HeatingQC'] = house_df['HeatingQC'].replace(quality_label)\nhouse_df['BsmtQual'] = house_df['BsmtQual'].replace(quality_label)\nhouse_df['BsmtCond'] = house_df['BsmtCond'].replace(quality_label)\nhouse_df['FireplaceQu'] = house_df['FireplaceQu'].replace(quality_label)\nhouse_df['GarageQual'] = house_df['GarageQual'].replace(quality_label)\nhouse_df['PoolQC'] = house_df['PoolQC'].replace(quality_label)","85f29c23":"categorical_cols = [cname for cname in house_df.columns if\n                    house_df[cname].dtype == \"object\"]","81df25cb":"house_df['Total_Home_Quality'] = (house_df['OverallQual'] + house_df['OverallCond'])**2\nplt.figure(figsize=(20,6))\nplt.subplots_adjust(wspace=0.3)\nplt.subplot(1,2,1)\nsns.boxenplot(data=house_df, x='Total_Home_Quality',y='SalePrice',palette='Set2')\nplt.xticks(rotation=90)\nplt.subplot(1,2,2)\nsns.regplot(data=house_df, x='Total_Home_Quality',y='SalePrice',color='black')\n","7c8471be":"house_df['Total_Bathrooms'] = (house_df['FullBath'] + (0.5 * house_df['HalfBath']) + (house_df['BsmtFullBath'] + (0.5 * house_df['BsmtHalfBath'])))\nplt.figure(figsize=(20,6))\nplt.subplots_adjust(wspace=0.3)\nplt.subplot(1,2,1)\nsns.boxenplot(data=house_df, x='Total_Bathrooms',y='SalePrice',palette='Set2')\nplt.xticks(rotation=90)\nplt.subplot(1,2,2)\nsns.regplot(data=house_df, x='Total_Bathrooms',y='SalePrice',color='black')","7865b2b4":"house_df['total_condition'] = house_df['Condition1'] + house_df['Condition2'] \nplt.figure(figsize=(20,6))\nplt.subplots_adjust(wspace=0.3)\nplt.subplot(1,2,1)\nsns.boxenplot(data=house_df, x='total_condition',y='SalePrice',palette='Set2')\nplt.subplot(1,2,2)\nsns.regplot(data=house_df, x='total_condition',y='SalePrice',color='black')","dcb4a1a3":"house_df[\"SqFtPerRoom\"] = house_df[\"GrLivArea\"] \/ (house_df[\"TotRmsAbvGrd\"] +\n                                                       house_df[\"FullBath\"] +\n                                                       house_df[\"HalfBath\"] +\n                                                       house_df[\"KitchenAbvGr\"])\nplt.figure(figsize=(8,8))\nsns.regplot(data=house_df, x='SqFtPerRoom',y='SalePrice',color='blue')","4ead4295":"import missingno as msno\nmsno.matrix(house_df[tr_idx])","2a1eca95":"corr=house_df.corr().round(1)\nsns.set(font_scale=1)\nplt.figure(figsize=(10, 15))\nsns.set_style(\"white\")\nsns.set_palette(\"bright\")\nabs(corr['SalePrice']).sort_values()[:-1].plot.barh()\nplt.gca().set_facecolor('#FFFFFF')\nplt.title('Correlation with SalePrice',fontsize=20)","f26bc67a":"abs_corr = abs(corr['SalePrice']).sort_values()[:-1]\nlow_corr_list = abs_corr[abs_corr.values == 0].index\nhouse_df.drop(low_corr_list, axis=1,inplace=True)","a17408d6":"house_df = pd.get_dummies(house_df, drop_first=True)","00f4406b":"house_df['SalePriceCpy'] = np.log1p(house_df['SalePrice'])\nhouse_df.drop('SalePrice',axis=1,inplace=True)\nhouse_df['SalePrice'] = house_df['SalePriceCpy'].copy()\nhouse_df.drop('SalePriceCpy',axis=1,inplace=True)","23ab53f7":"house_train_x = house_df.drop('SalePrice',axis=1)\nall_cols = [cname for cname in house_train_x.columns]\nhouse_train_y = house_df['SalePrice']","95c7dae1":"import umap\nimport umap.plot\nmapper = umap.UMAP().fit(house_train_x[tr_idx])\numap.plot.points(mapper, labels=house_train_y[tr_idx].round(1), theme='fire')","a77230da":"import plotly\nimport plotly.express as px\nfrom umap import UMAP\n\numap_3d = UMAP(n_components=3, init='random', random_state=0)\nx_umap = umap_3d.fit_transform(house_train_x[tr_idx])\numap_df = pd.DataFrame(x_umap)\ntrain_y_sr = pd.Series(house_train_y[tr_idx],name='price')\nprint(type(x_umap))\nnew_df = pd.concat([umap_df,train_y_sr],axis=1)\nfig = px.scatter_3d(\n    new_df, x=0, y=1, z=2,\n    color='price', labels={'color': 'number'}\n)\nfig.update_traces(marker_size=1.5)\nfig.show()","bc780bf9":"from pycaret.regression import *","066f21e5":"reg = setup(data = house_df[tr_idx],\n            target = 'SalePrice',\n            normalize = False,\n            preprocess = False,\n            numeric_features = all_cols,\n            silent = True)","592eb6e8":"catboost = create_model('catboost')\nbr = create_model('br')\nridge = create_model('ridge')\ngbr = create_model('gbr')\nlightgbm = create_model('lightgbm')","42445ff9":"tuned_catboost = tune_model(catboost,early_stopping=True,optimize='RMSE',search_library='optuna')","d5c65342":"tuned_br = tune_model(br,early_stopping=True,optimize='RMSE',search_library='optuna')","b4416f27":"tuned_gbr = tune_model(gbr,early_stopping=True,optimize='RMSE',search_library='optuna')","afd4cb72":"tuned_ridge = tune_model(ridge,early_stopping=True,optimize='RMSE',search_library='optuna')","e117e3d0":"tuned_lightgbm = tune_model(lightgbm,early_stopping=True,optimize='RMSE',search_library='optuna')","f6deb6ab":"interpret_model(tuned_catboost)","469fd3da":"interpret_model(tuned_lightgbm)","e2534213":"stacking = stack_models(estimator_list = [catboost,br,ridge,gbr,lightgbm],\n                           meta_model = catboost,\n                           optimize = 'RMSE')","cad49614":"plot_model(stacking, plot='residuals')","bc706f6f":"plot_model(stacking, plot='error')","8d9d4084":"blend_soft = blend_models(estimator_list = [catboost,br,ridge,gbr,lightgbm], \n                          #weights = [0.4,0.3,0.2,0.1], \n                          optimize = 'RMSE')","452518e9":"plot_model(blend_soft, plot='residuals')","f46f7257":"plot_model(blend_soft, plot='error')","6bc053f8":"final_model = finalize_model(blend_soft)","db9feda8":"plot_model(final_model, plot='residuals')","17ea73d3":"plot_model(final_model, plot='error')","5745f87f":"plot_model(final_model, plot='manifold')","b30bcd77":"X_test_df = house_df[~tr_idx].drop('SalePrice',axis=1)\npreds_test = final_model.predict(X_test_df)\nsubmission_data.loc[:,'SalePrice'] = np.expm1(preds_test)\nsubmission_data.to_csv('submission.csv', index=False)","646bc1de":"Let's remove the outliers detected above.","b5a36737":"<span style=\"color:Blue\"> Observation:\n    \nLooking at the figure above, points that are clearly judged as outliers in the figures on the left are also judged as outliers in PC1 after PCA.\nThat is, outlier judgment using PCA seems very effective.","5a4a80b1":"## Missing values","605fc9a7":"## Question 2: Is the total number of bathrooms correlated with the sale price?","950c726a":"## GarageType\nGarage location\n\n* 2Types More than one type of garage\n* Attchd Attached to home\n* Basment Basement Garage\n* BuiltIn Built-In (Garage part of house - typically has room above garage)\n* CarPort Car Port\n* Detchd Detached from home\n* NA No Garage","238813f6":"## Checking Categorical Missing Values\n\nNumerical missing values were filled in. Let's check again what the remaining missing values are.","36092d96":"<hr style=\"border: solid 3px blue;\">\n\n# Introduction\n\n![](https:\/\/media3.giphy.com\/media\/5UBoT7DNaP3aBUi2vJ\/giphy.gif)\n\nPicture Credit: https:\/\/media3.giphy.com","9b56dc3b":"## Evaluating Models\n> In statistics, the coefficient of determination, also spelled co\u00ebfficient, denoted R2 or r2 and pronounced \"R squared\", is the proportion of the variation in the dependent variable that is predictable from the independent variable(s).\n> \n> It is a statistic used in the context of statistical models whose main purpose is either the prediction of future outcomes or the testing of hypotheses, on the basis of other related information. It provides a measure of how well observed outcomes are replicated by the model, based on the proportion of total variation of outcomes explained by the model\n\nRef: https:\/\/en.wikipedia.org\/wiki\/Coefficient_of_determination","d585c3f6":"Let's update the column lists again.","3ddc63dc":"> Imputation is the standard approach, and it usually works well. However, imputed values may be systematically above or below their actual values (which weren't collected in the dataset). Or rows with missing values may be unique in some other way. In that case, your model would make better predictions by considering which values were originally missing.\n\n![](https:\/\/i.imgur.com\/UWOyg4a.png)\n\n> In this approach, we impute the missing values, as before. And, additionally, for each column with missing entries in the original dataset, we add a new column that shows the location of the imputed entries.\n> \n> In some cases, this will meaningfully improve results. In other cases, it doesn't help at all.\n\nRef: https:\/\/www.kaggle.com\/alexisbcook\/missing-values","e48a5f90":"**Good derivative features come from good questions. Good questions come from a lot of domain-knowledge.**\n\nShould I really be a real estate agent? If you have any good information, please share.","de7021dd":"## Fence: Fence quality\n\n**Question: Is there a difference in house price with and without fence?**","5893248a":"> **R-squared** is a statistical measure of how close the data are to the fitted regression line. It is also known as the coefficient of determination, or the coefficient of multiple determination for multiple regression.\n> \n> The definition of R-squared is fairly straight-forward; it is the percentage of the response variable variation that is explained by a linear model. Or:\n> \n> * R-squared = Explained variation \/ Total variation\n> \n> R-squared is always between 0 and 100%:\n> \n> * 0% indicates that the model explains none of the variability of the response data around its mean.\n> * 100% indicates that the model explains all the variability of the response data around its mean.\n> In general, the higher the R-squared, the better the model fits your data. However, there are important conditions for this guideline that I\u2019ll talk about both in this post and my next post.\n\nRef: https:\/\/blog.minitab.com\/en","e11aefb4":"---------------------------------------------------------------------------------------\n# Checking Dataset before Modeling","02188db1":"<span style=\"color:Blue\"> Observation:\n    \nThe order of distribution size for each PC is PC1->PC2->PC3->PC4. Since the process of finding a PC through PCA is to find a direction vector with the largest variance, this result is self-evident.\n    \nBased on the boxplot, there are outliers for each PC. Let's check further if it makes sense to remove those values.","cdd4e880":"## Quality Features\n\n* Ex Excellent\n* Gd Good\n* TA Average\/Typical\n* Fa Fair\n* Po Poor","0b1b22f3":"----------------------------------------------\nMetric:\n\n> Submissions are evaluated on **Root-Mean-Squared-Error (RMSE) between the logarithm of the predicted value and the logarithm of the observed sales price.** (Taking logs means that errors in predicting expensive houses and cheap houses will affect the result equally.)\n\nIt is described that the following metrics are used in the competition site. The reason for using the above metric is that the distribution of targets is concentrated toward the low price. If logarithm is not applied, the performance of the model will be determined by matching the expensive house price well. Thus, it seems the wisdom of the organizers who decided to write RMSLE ( Root-Mean-Squared-Error (RMSE) between the logarithm ).","82d05de8":"## MiscFeature: Miscellaneous feature not covered in other categories\n\n**Question: Is there a difference in house price with and without miscellaneous features?**","171471cc":"--------------------------------------------------------\n## Visualizing Training Dataset after Dimension Reduction\n\nThe preprocessed training dataset is 202 dimensions. After reducing the dimensions to 2D and 3D, let's check the distribution for each price.","a1860b18":"## FireplaceQu: Fireplace quality\n\n**Question: Is there a difference in house prices with and without Fireplace?**","7c33db39":"## Question 2: If you recently remodeled and have a large basement, will your sale price increase?\n\n* TotalBsmtSF: Total square feet of basement area\n* YearRemodAdd: Remodel date (same as construction date if no remodeling or additions)","5e06b24c":"What were your thoughts when you first saw this problem? As soon as I saw this problem, I was very frustrated because there were so many features. **Really, should I be a real estate agent?**\nIf I have domain knowledge about real estate, I will be able to select important features as soon as I see them. However, I have no such knowledge. Therefore, I tried to visualize it as much as possible and gain insight through various methods as much as possible. However, EDA work was difficult in the absence of domain knowledge.\n\nI tried to write a notebook without a logical leap as much as possible. In addition, we tried to present the reasons for a certain decision as much as possible. For that reason, the notebook may be a little long, so please understand.","92aa8979":"## Imputing Numerical Missing Valuse","b632fee4":"## Evaluating Models\n> In statistics, the coefficient of determination, also spelled co\u00ebfficient, denoted R2 or r2 and pronounced \"R squared\", is the proportion of the variation in the dependent variable that is predictable from the independent variable(s).\n> \n> It is a statistic used in the context of statistical models whose main purpose is either the prediction of future outcomes or the testing of hypotheses, on the basis of other related information. It provides a measure of how well observed outcomes are replicated by the model, based on the proportion of total variation of outcomes explained by the model\n\nRef: https:\/\/en.wikipedia.org\/wiki\/Coefficient_of_determination","a4df048c":"# Tuning Hyperparameters","3f0b4ad1":"---------------------------\n## Removing Outlier using PCA","8fa77e46":"----------------------------------------------------------------------------\n# Ensemble\n\n![](https:\/\/media3.giphy.com\/media\/26xBvMWzk7FQr54Sk\/giphy.gif)\n\nPicture Credit: https:\/\/media3.giphy.com\n\n**In this notebook, I would like to organize the following three ensemble models.**\n* Stacking Model\n* Soft Voting Model","dfbd31ce":"<span style=\"color:Blue\"> Observation:\n    \nThere is only one outlier detected as the second Principal Component.","7a727dbb":"--------------------------------------------------------\n# Making Derived Features for Categorical Data","e16d1c57":"First, let's check skewness. A skewness greater than 1 is generally judged to be skewed, so check mainly those greater than 1.","2f5161d6":"## PavedDrive\nPaved driveway\n\n* Y Paved\n* P Partial Pavement\n* N Dirt\/Gravel","398b57fb":"# Creating Models","70170910":"## Question 1: Does the combination of underground and above-ground area have a high correlation with the Sale Price?\n\n* TotalBsmtSF: Total square feet of basement area\n* GrLivArea: Above grade (ground) living area square feet","b8748ea6":"### Plotting after dimensionality reduction to 3D","089bbf40":"## Condition1\/Condition2\nProximity to various conditions\n\n* Artery: Adjacent to arterial street\n* Feedr: Adjacent to feeder street\n* Norm: Normal\n* RRNn: Within 200' of North-South Railroad\n* RRAn: Adjacent to North-South Railroad\n* PosN: Near positive off-site feature--park, greenbelt, etc.\n* PosA: Adjacent to postive off-site feature\n* RRNe: Within 200' of East-West Railroad\n* RRAe: Adjacent to East-West Railroad","a201b18c":"Skewness was also improved.","5d674bab":"-----------------------------------------------------------------------\n# Detecting Outliers by PCA\n\n![](https:\/\/miro.medium.com\/max\/602\/0*PnqMbZEdnuL9yHuo.png)\n\nPicture Credit: https:\/\/miro.medium.com\n\nThe more features, the higher the dimension. When projecting to a lower dimension through PCA, new insights can be gained. PCA can effectively detect outliers. Let's apply PCA to this problem and check whether the detection actually confirmed by the eye is also detected through PCA.\n\nIn other words, let's reduce the dimension, check the things that are judged as outliers in the reduced dimension, and check whether the row is an outlier for some reason.\n\n**Looking at the figure above, PC 1 has the largest variance in the dataset distribution. That is, the outlier in PC 1 is very likely to be an outlier that needs to be removed from the dataset.\nFor this reason, there is a high possibility that an outlier to be removed is detected in PC 2 as well.**","b90c8072":"Only features with more than 20 missing values are checked. It was judged that the smaller features were probably omitted due to a mistake during the recording process.","2d424c9f":"If we ask a good question and generate good derivatives from it, we will train our model further. \n\n**However, I'm not a real estate agent, and I'm not very knowledgeable about it.**","e3f51423":"# Setting up","c46daa2b":"<span style=\"color:Blue\"> Observation:\n    \n**Oh my god!. 81 features!**","4c3ad234":"----------------------------------------------------------\n# Checking Target\n\nThe problem is a regression problem. Therefore, we analyze the distribution of the target and check whether there is necessary preprocessing based on this. If it is a classification problem\nWe need to check target imbalance.","e566b738":"### Plotting after dimensionality reduction to 2D","16ea35bf":"## Question 1: Is total house quality correlated with sale price?","d627dd59":"## Basement features\n\n**Question: Is there a difference in the house price with and without a Basement?**","00334e5e":"## GarageFinish\nInterior finish of the garage\n\n* Fin Finished\n* RFn Rough Finished\n* Unf Unfinished\n* NA No Garage","bcedc033":"## Checking Missig Values Again","bd457b3f":"The number of skewed features is reduced from 14 to 9. The remaining 4 skewness was greatly reduced.","0f4607a1":"<span style=\"color:Blue\"> Observation:\n    \nPoolQC, MiscFeature, Alley, Fence, and FireplaceQu features have too many missing values.\n\nDeleting those features may be the easiest way. However, a lot of thought must be taken into account when removing missing values. When data is written, it can have some intent. These are categorical features, so we'll think about them again later.","3b3bd79c":"11 outliers were detected as the first principal component.","1dc253ba":"Since it is a regression problem, filling it with KNN seems to be a wise choice.\n\n> Each sample\u2019s missing values are imputed using the mean value from n_neighbors nearest neighbors found in the training set. Two samples are close if the features that neither is missing are close.\n\nRef: https:\/\/scikit-learn.org\/stable","6c3b9e0c":"## MasVnrType\nMasonry veneer type\n\n* BrkCmn Brick Common\n* BrkFace Brick Face\n* CBlock Cinder Block\n* None None\n* Stone Stone","9027a5d2":"------------------------------------\n# Finalizing the last model\n> This function trains a given estimator on the entire dataset including the holdout set.\n\nRef: https:\/\/pycaret.readthedocs.io\/en\/latest\/api\/classification.html\n\n\n**The blend model seems to be stable. Let's use this model as our final model.**","4dafd237":"<span style=\"color:Blue\"> Observation:\n\n* Newly created derived variables play an important role in model learning.\n* When the models are different, the feature importance is also slightly different. This diversity is the power of ensemble. ","e9b0aedd":"------------------------------------------------------------------------\n## Filling missing values\n\nA good way to fill in the missing values of categorical features in the absence of domain-knowledge is to take the most-frequent strategy.","dcb420db":"-------------------------------------------------------------------------------\n# Soft Voting (Soft Blending)\n\n![](https:\/\/miro.medium.com\/max\/1000\/1*T0L64nrOJSr8-LRJlWfLtQ.jpeg)\n\nPicture Credit: https:\/\/miro.medium.com","dc735323":"## Encoding nominal data using one-hot encoding.","1d3a86c5":"## BsmtExposure\nRefers to walkout or garden level walls\n\n* Gd:Good Exposure\n* Av:Average Exposure (split levels or foyers typically score average or above)\n* Mn:Mimimum Exposure\n* No:No Exposure\n* NA:No Basement","a2099040":"Let's remove features that have a correlation coefficient of 0 with the sale price!","15049f19":"--------------------------------------------------\n# EDA","3999a106":"----------------------------------------------------------------\n# Doing EDA for Categorical Features\n\n![](https:\/\/miro.medium.com\/max\/1400\/1*wYbTRM0dgnRzutwZq63xCg.png)\n\nPicture Credit: https:\/\/miro.medium.com\n\nCategorical data can be classified into ordinal data and nominal data. In the case of an ordinal type, there is a difference in importance for each level. This value plays an important role in the case of regression, so encode it with care.\n\nIt is difficult to encode categorical features compared to numeric features. For ordinal data, it is more difficult.","aa591c47":"## Checking Missing Values","aa7559ce":"## SaleCondition\nCondition of sale\n\n* Normal: Normal Sale\n* Abnorml: Abnormal Sale - trade, foreclosure, short sale\n* AdjLand: Adjoining Land Purchase\n* Alloca: Allocation - two linked properties with separate deeds, typically condo with a garage unit\n* Family: Sale between family members\n* Partial: Home was not completed when last assessed (associated with New Homes)","0d2532be":"<hr style=\"border: solid 3px blue;\">","f7951623":"## Question 3: Can the combined area of the 1st and 2nd floors affect the sale price?\n* 1stFlrSF: First Floor square feet \n* 2ndFlrSF: Second floor square feet","5202828d":"## HouseStyle:\nHouseStyle: Style of dwelling\n\n* 1Story: One story\n* 1.5Fin: One and one-half story: 2nd level finished\n*    1.5Unf: One and one-half story: 2nd level unfinished\n*    2Story: Two story\n*    2.5Fin: Two and one-half story: 2nd level finished\n*    2.5Unf: Two and one-half story: 2nd level unfinished\n*    SFoyer: Split Foyer\n*    SLvl: Split Level","3394b2b1":"<span style=\"color:Blue\"> Observation:\n    \nIt seems that there are outliers that deviate from the regression line. Let's check some more.","c8af4271":"----------------------------------------------------------------\n## Checking Outliers after removing outliers","3dda6c85":"<span style=\"color:Blue\"> Observation:\n\nIf you look at the picture above, you can see an outlier. Regression models are sensitive to outliers, so it is better to remove them. Outlier is like gravity. It pulls the regression line. Therefore, it is better to remove outliers.\nHowever, it is not easy to judge an outlier. Domain knowledge may also be required to remove outliers.","5ca7f247":"Even looking at the 3D scaled-down picture, it is difficult to observe the special rules. If we look at it in 202 dimensions, I don't know if there is a possibility of finding any regularity.\nNow, all we can do is create a good model and make the model learn well.","4ff574c4":"-----------------------------------------------------\n# Checking Ordinal Features\nIn some cases, it is easy to judge that there is an order on a commonsense level. However, there are many cases where it is difficult to judge that there is an order. The method used in this notebook to determine whether the features are ordinal or not was determined to have a certain order through visualization. However, if you have real estate knowledge, you will be able to determine the order of each level by classifying ordinal features smarter than me.\n\n\n\n","bc5c208d":"# Categorizing Columns","21ef742f":"## MasVnrType: Masonry veneer type\n\n**Question: Is there a difference in house price with and without Masonry veneer?**","fe48a87d":"--------------------------------------------------------------\n## Utility Functions","328d466f":"---------------------------------------------------------------------------\n# Doing EDA for Numerical Features\n\n![](https:\/\/static-assets.codecademy.com\/Courses\/Hypothesis-Testing\/Intro_to_variable_types_4.png)\n\nPicture Credit: https:\/\/t3.ftcdn.net","c9a5f48e":"## Encoding Target using Log Scaling","f5da74f5":"<span style=\"color:Blue\"> Observation:\n\n* The newly created derivative variable AllArea feature and house price have a high correlation!\n* Pool-related features and fireplaces with many missing values have a low correlation with house price. \n","37211fbb":"-----------------------------------------------------------------\n## The Fist Principal Component\n\nAfter PCA, if you draw histogram and box plot for each comment, IQR based outliers are visible.\n\n","a9168b81":"In the regression problem, discrete and non-order features must be converted to one-hot encoding. ","499c062f":"## PoolQC: Pool quality \n\n**Question: Does the lack of pool quality mean that the house does not have a pool? If so, is there a relationship between the missing value and the house price?**","441dc481":"<span style=\"color:Blue\"> Observation:\n\n* R squared is 97.5%. This means that our model can explain the dataset by 97.5%. ","72fb159b":"<span style=\"color:Blue\"> Observation:\n\nThe skewness was about 1.88. Also, since the metric is RMSLE, we will perform log scaling.","e9e3209e":"## Question 3: Can Total Condition Affect Sale Price?","aa057a1f":"<span style=\"color:Blue\"> Observation:\n    \n* Garage-related features have 157 to 159 missing values. It is unknown whether the houses lacked garages or were intentionally omitted.\n* Basement-related features also have 79 to 82 missing values.\n\nIt seems that we need to focus more on the process of filling in the missing values \u200b\u200bof the corresponding Garage and Basement features.","9825270c":"## Question 4: Can area per room affect the sale price?","54e92cd7":"------------------------------------------------------------------------\n## MSZoning\n\nIdentifies the general zoning classification of the sale.\n\n* A: Agriculture\n* C: Commercial\n* FV: Floating Village Residential\n* I: Industrial\n* RH: Residential High Density\n* RL: Residential Low Density\n* RP: Residential Low Density Park\n* RM: Residential Medium Density","97ceb699":"## Foundation\nType of foundation\n\n* BrkTil Brick & Tile\n* CBlock Cinder Block\n* PConc Poured Contrete\n* Slab Slab\n* Stone Stone\n* Wood Wood","d5573b19":"<span style=\"color:Blue\"> Observation:\n\nObserving the above figures, it can be seen that many of the points previously judged to be outliers have disappeared. Assuming that the outlier has been removed to some extent, let's try another feature engineer.\nOf course, we can delete outliers directly by looking at each graph, but in doing so, our model reads a lot of generality. The method using PCA is reasonable and can be used generally.\nIt can be used for this problem as well as other problems.\n\nAlso, as the outliers are removed, the regression line seems to be well-fitted to more general data.","e6aa1892":"## Exterior1st \/ Exterior2nd\nExterior covering on house\n\n* AsbShng: Asbestos Shingles\n* AsphShn: Asphalt Shingles\n* BrkComm: Brick Common\n* BrkFace: Brick Face\n* CBlock: Cinder Block\n* CemntBd: Cement Board\n* HdBoard: Hard Board\n* ImStucc: Imitation Stucco\n* MetalSd: Metal Siding\n* Other: Other\n* Plywood: Plywood\n* PreCast: PreCast\n* Stone: Stone\n* Stucco: Stucco\n* VinylSd: Vinyl Siding\n* Wd Sdng: Wood Siding\n* WdShing: Wood Shingles","3eb7df82":"## BsmtFinType1\nRating of basement finished area\n\n*        GLQ:\tGood Living Quarters\n*        ALQ:\tAverage Living Quarters\n*        BLQ:\tBelow Average Living Quarters\t\n*        Rec:\tAverage Rec Room\n*        LwQ:\tLow Quality\n*        Unf:\tUnfinshed\n*        NA:\tNo Basement","455bef9d":"We trained by taking the logarithm of the target values. Therefore, since predicted values \u200b\u200bare also in the logarithm state, they take the process of converting back to actual values \u200b\u200bthrough the exponential function.","643f1f39":"<span style=\"color:Blue\"> Observation:\n    \nIt is conformed that 14 features are skewed. We will do log transformation for these features.","0933f197":"## Selecting Features","ce07999d":"----------------------------------------------------\n# Scaling\n\nThere are various scaling methods for numerical features. However, we did log scaling, which is a non-linear scaling of our target. Therefore, other numerical features are also subjected to log scaling.","840a35cd":"Some features still have skewness greater than 1, but further improvement seems difficult.","24fd3ff7":"-----------------------------------------------------------------------------\n## Continous Features","b43f688b":"------------------------------------------------------\n# Adding New Derived Features using Numerical Feature\n\nLet's create a new derived variable so that our model can learn better.\n\n* TotalBsmtSF: Total square feet of basement area\n* GrLivArea: Above grade (ground) living area square feet\n* YearRemodAdd: Remodel date (same as construction date if no remodeling or additions)\n* 1stFlrSF: First Floor square feet \n* 2ndFlrSF: Second floor square feet","cb50da9d":"-------------------------------------------\n## Discrete Features","669c6e11":"# Interpreting Models","94b0c1d4":"-------------------------------------------\n# Submitting Result","1d8c7a08":"----------------------------------------------------------------------\n# Stacking\n\n![](https:\/\/miro.medium.com\/max\/1000\/1*CoauXirckomVXxw2Id2w_Q.jpeg)\n\nPicture Credit: https:\/\/miro.medium.com","ffa230dc":"<span style=\"color:Blue\"> Observation:\n\nThere are 37 numerical features and 43 object (string) types.\nAmong the numeric features, 25 are int types and 12 are float types.\nThere must be a reason for using a different type like this. Let's check some more.","a8bf2d7c":"## Garage Features\n\n**Question: Is there a difference in house price with and without Garage?**","5243d04c":"Id feature is simply unique ID, so it is not helpful for learning. Let's remove it.","3095f456":"-------------------------------------\n## The Second Principal Component","53fa5479":"------------------------------------------------------------------------\n## Checking Outliers","b3a61550":"> Logarithm function increases the spacing between small numbers and reduces the spacing between large numbers. When certain features are dense with values in small values, by increasing these intervals, our models increase the intervals for small values, and we can improve the performance of the model when training and testing using these values.\n\nRef: https:\/\/www.kaggle.com\/ohseokkim\/preprocessing-linear-nonlinear-scaling\n\n<span style=\"color:Blue\"> Observation:\n    \nIf you look at the regression plot between GrLivArea and SalePrice, you can see that a clearer regression line is drawn after conversion. Log transform will definitely help with learning.","5c9ff136":"## Seting up","96ec300d":"## Alley: Type of alley access to property\n\n**Question: Is there a difference in house price with and without Alley access?**","c194d2f3":"<span style=\"color:Blue\"> Observation:\n    \n* GarageCars, BsmtHalfBath, BsmtFullBath and GarageCars are discrete variables.\n* Some features have a skewed shape to one side."}}