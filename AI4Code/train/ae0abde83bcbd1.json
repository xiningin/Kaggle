{"cell_type":{"73566027":"code","bfbfabed":"code","165a9f1b":"code","215940c9":"code","9e65fcc7":"code","d516517d":"code","a2ea129b":"code","afb07139":"code","b7e16f70":"code","98cbbcaa":"code","01644667":"code","cc73f619":"code","d7f9641a":"code","8bfd55e8":"code","b7a148c2":"code","1540b5a8":"code","11ad6032":"code","dd3665c7":"code","d3902242":"code","8098797f":"code","694cad56":"code","862d0967":"code","1ae635e6":"code","b77fb0df":"markdown","fb32ccd7":"markdown","d24f646f":"markdown","848981a1":"markdown","db09faf7":"markdown","b1c6481b":"markdown","a7e9d0c2":"markdown","8f734a65":"markdown","898fca65":"markdown","9a7af4c0":"markdown"},"source":{"73566027":"import pandas as pd\nimport numpy as np\nfrom column_encoder import *\nfrom sklearn.feature_selection import SelectFromModel\nfrom catboost import CatBoostRegressor\nfrom statsmodels.stats.outliers_influence import variance_inflation_factor\nimport seaborn as sns\nfrom scipy.stats import zscore\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.model_selection import KFold\nfrom sklearn.metrics import mean_squared_error\ncm = sns.light_palette(\"orange\", as_cmap=True)","bfbfabed":"train=pd.read_csv('..\/input\/tabular-playground-series-feb-2021\/train.csv')\ntest=pd.read_csv('..\/input\/tabular-playground-series-feb-2021\/test.csv')","165a9f1b":"fit(train,list(train.columns[1:11]))\ntransform(train)\ntransform(test)","215940c9":"train.head()","9e65fcc7":"train.drop('id',axis=1,inplace=True)\nX=train.drop(['target'],axis=1).values\ny=train['target'].values","d516517d":"# Select from model feature selection\nselector = SelectFromModel(estimator=CatBoostRegressor()).fit(X, y)","a2ea129b":"# Getting a mask of the features used using get support function\nselector.get_support()","afb07139":"# Selecting the features that weren't masked \nfeatured_columns=[]\nt=list(train.drop('target',axis=1).columns)\nfor i in range(len(t)):\n    if selector.get_support()[i]==True:\n        featured_columns.append(t[i])\n    else:\n        continue\ntrain=train[featured_columns]\ntest=test[featured_columns]","b7e16f70":"# Checking for Multicollinearity\n# Making a vif function for the dataset\ndef calc_vif(X):\n\n    # Calculating VIF\n    vif = pd.DataFrame()\n    vif[\"variables\"] = X.columns\n    vif[\"VIF\"] = [variance_inflation_factor(X.values, i) for i in range(X.shape[1])]\n    s = vif.style.background_gradient(cmap=cm)\n    return(s)","98cbbcaa":"# Checking multicollinearity in our training data\ncalc_vif(train)","01644667":"train.drop(['cont0',\"cont5\",'cont9',\"cont11\"],axis=1,inplace=True)","cc73f619":"test=test[list(train.columns)]","d7f9641a":"train['target']=y","8bfd55e8":"z_scores = zscore(train)\n\nabs_z_scores = np.abs(z_scores)\nfiltered_entries = (abs_z_scores < 3).all(axis=1)\ntrain = train[filtered_entries]","b7a148c2":"model=CatBoostRegressor()","1540b5a8":"params={'nan_mode': 'Min',\n 'eval_metric': 'RMSE',\n 'iterations': 300,\n 'sampling_frequency': 'PerTree',\n 'leaf_estimation_method': 'Newton',\n 'grow_policy': 'SymmetricTree',\n 'penalties_coefficient': 1,\n 'boosting_type': 'Plain',\n 'model_shrink_mode': 'Constant',\n 'feature_border_type': 'GreedyLogSum',\n 'l2_leaf_reg': 7,\n 'random_strength': 0.4000000059604645,\n 'rsm': 1,\n 'boost_from_average': True,\n 'model_size_reg': 0.5,\n 'subsample': 0.800000011920929,\n 'use_best_model': False,\n 'random_seed': 3042,\n 'depth': 11,\n 'posterior_sampling': False,\n 'border_count': 254,\n 'sparse_features_conflict_fraction': 0,\n 'leaf_estimation_backtracking': 'AnyImprovement',\n 'best_model_min_trees': 1,\n 'model_shrink_rate': 0,\n 'min_data_in_leaf': 1,\n 'loss_function': 'RMSE',\n 'learning_rate': 0.029999999329447743,\n 'score_function': 'Cosine',\n 'task_type': 'CPU',\n 'leaf_estimation_iterations': 1,\n 'bootstrap_type': 'MVS',\n 'max_leaves': 2048,\n    'verbose':False}","11ad6032":"model=CatBoostRegressor(**params)","dd3665c7":"skf = KFold(n_splits=10,random_state=None,shuffle=False)\nl=[]\ncount=0\nfor train_index, test_index in skf.split(X, y):\n        X_train, X_test = X[train_index], X[test_index]\n        y_train, y_test = y[train_index], y[test_index]\n        model.fit(X_train,y_train)\n        print(\"TRAIN:\", train_index, \"TEST:\", test_index)\n        print('mean squred error is ',mean_squared_error(model.predict(X_test),y_test))\n        l.append(mean_squared_error(model.predict(X_test),y_test))\n        count+=1\n        if mean_squared_error(model.predict(X_test),y_test)==min(l):\n            main_model=CatBoostRegressor(**params)\n            main_model.fit(X_train,y_train)\n            print('new model trained on fold ',count-1)\n        else:\n            continue\n","d3902242":"test2=pd.read_csv('..\/input\/tabular-playground-series-feb-2021\/test.csv')","8098797f":"sample=pd.DataFrame()\nsample['id']=test2['id']\nX_test=test.values","694cad56":"predictions=main_model.predict(X_test)","862d0967":"sample['target']=predictions","1ae635e6":"sample.to_csv('submission.csv',index=False)","b77fb0df":"# Importing Packages","fb32ccd7":"# Select From Model Feature Selection","d24f646f":"# Importing the data","848981a1":"# Transforming the categorical data to numeric","db09faf7":"# Doing Predictions and saving the file","b1c6481b":"# Thank you","a7e9d0c2":"# Removing Outliers","8f734a65":"# Using KFolds","898fca65":"# Using Catboost Model ","9a7af4c0":"# Checking for Multicollinearity"}}