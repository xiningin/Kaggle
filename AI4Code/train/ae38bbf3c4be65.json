{"cell_type":{"81a9fdf1":"code","7f0d01c4":"code","9c73a307":"code","c32aae42":"code","f9f6a72e":"code","491289e7":"code","58e8b1fd":"code","2e335672":"code","75e69550":"code","bfb6c15e":"code","407019ce":"code","ccca0fb2":"code","cc122252":"code","e12e9ee7":"code","bbf970f8":"code","22097077":"code","629aa02d":"code","6e8d14fb":"code","14e66888":"code","6ef18326":"code","58b480bc":"code","46674413":"code","ad6708dd":"code","49c6aee0":"code","2d7111c5":"code","bd751da7":"code","bbff935b":"code","38eeaefd":"code","c40fc409":"code","03fd0f63":"code","4b90cd36":"code","24a2e329":"code","ec336227":"code","c6eb5219":"code","a2eb8c05":"code","7add5c68":"code","6eaad711":"code","975ab1c3":"code","df81a5f9":"code","0efb28ce":"code","a782e12a":"markdown","d0f15ac4":"markdown","a3d9adfd":"markdown","b2235701":"markdown"},"source":{"81a9fdf1":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nfrom matplotlib import pyplot\nimport seaborn as sns; sns.set()\n# Visualisation\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nimport matplotlib.pylab as pylab\nimport seaborn as sns\nimport missingno as msno\n# Configure visualisations\n%matplotlib inline\nmpl.style.use( 'ggplot' )\nplt.style.use('fivethirtyeight')\nsns.set(context=\"notebook\", palette=\"dark\", style = 'whitegrid' , color_codes=True)\n\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\nimport csv as csv\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","7f0d01c4":"#Download Data\ndeaths_global = pd.read_csv('\/kaggle\/input\/ece657aw20asg4coronavirus\/time_series_covid19_deaths_global.csv')\nconfirmed_global = pd.read_csv('\/kaggle\/input\/ece657aw20asg4coronavirus\/time_series_covid19_confirmed_global.csv')","9c73a307":"deaths_global.head()","c32aae42":"confirmed_global.head()","f9f6a72e":"deaths_global.tail()","491289e7":"confirmed_global.tail()","58e8b1fd":"country=['Canada', 'US']\ny=deaths_global.loc[deaths_global['Country\/Region']=='Italy'].iloc[0,4:]\ns = pd.DataFrame({'Italy':y})\nfor i in country:    \n    s[i] = deaths_global.loc[deaths_global['Country\/Region']==i].iloc[0,4:]\npyplot.plot(range(y.shape[0]), s)","2e335672":"country=['Canada', 'US']\ny=confirmed_global.loc[confirmed_global['Country\/Region']=='Italy'].iloc[0,4:]\ns = pd.DataFrame({'Italy':y})\nfor i in country:    \n    s[i] = confirmed_global.loc[confirmed_global['Country\/Region']==i].iloc[0,4:]\npyplot.plot(range(y.shape[0]), s)","75e69550":"cols = confirmed_global.keys()\ncols","bfb6c15e":"cols_d=deaths_global.keys()\ncols_d","407019ce":"confirmed_g = confirmed_global.loc[:, cols[4]:cols[-1]]\nconfirmed_g","ccca0fb2":"deaths_g = deaths_global.loc[:, cols[4]:cols[-1]]\ndeaths_g","cc122252":"confirmed_canada = confirmed_global.loc[confirmed_global['Country\/Region']=='Canada'].iloc[:,4:].values","e12e9ee7":"deaths_canada = deaths_global.loc[deaths_global['Country\/Region']=='Canada'].iloc[:,4:].values","bbf970f8":"confirmed_canada","22097077":"confirmed_canada.shape","629aa02d":"deaths_canada","6e8d14fb":"deaths_canada.shape","14e66888":"dates = confirmed_g.keys()\ndf1 = pd.DataFrame(confirmed_canada,columns=dates)\ndf1","6ef18326":"dates_d = deaths_g.keys()\ndf2 = pd.DataFrame(deaths_canada,columns=dates_d)\ndf2","58b480bc":"#Caculate the sum of confirmed cases for each day\nca_sum= df1.sum(axis=0)\nca_sum=pd.DataFrame(ca_sum) \nca_sum","46674413":"#Caculate the sum of deaths for each day\nca_sum_d= df2.sum(axis=0)\nca_sum_d=pd.DataFrame(ca_sum_d) \nca_sum_d","ad6708dd":"ca_training_processed = ca_sum.iloc[:, 0:1].values\n#ca_training_processed","49c6aee0":"ca_d_training_processed = ca_sum_d.iloc[:, 0:1].values","2d7111c5":"from sklearn.preprocessing import MinMaxScaler\nscaler = MinMaxScaler(feature_range = (0, 1))\n\nca_training_scaled = scaler.fit_transform(ca_training_processed)\n\nca_d_training_scaled = scaler.fit_transform(ca_d_training_processed)","bd751da7":"#Convert Training Data to Right Shape for the cnfirmed cases' dataset\nfeatures_set = []\nlabels = []\nfor i in range(15, 87):\n    features_set.append(ca_training_scaled[i-15:i, 0])\n    labels.append(ca_training_scaled[i, 0])","bbff935b":"#Convert Training Data to Right Shape for the deaths' dataset\nfeatures_set_d = []\nlabels_d = []\nfor i in range(15, 87):\n    features_set_d.append(ca_d_training_scaled[i-15:i, 0])\n    labels_d.append(ca_d_training_scaled[i, 0])","38eeaefd":"#X_train and y_train for confirmed cases\nfeatures_set, labels = np.array(features_set), np.array(labels)","c40fc409":"#X_train and y_train for deaths\nfeatures_set_d, labels_d = np.array(features_set_d), np.array(labels_d)","03fd0f63":"features_set = np.reshape(features_set, (features_set.shape[0], features_set.shape[1], 1))\n#features_set = np.reshape(features_set, (72, 15, 1))\nfeatures_set_d = np.reshape(features_set_d, (features_set_d.shape[0], features_set_d.shape[1], 1))","4b90cd36":"from keras.models import Sequential\nfrom keras.layers import Dense\nfrom keras.layers import LSTM\nfrom keras.layers import Dropout\n#Training The LSTM for confirmed cases\n#Creating LSTM and Dropout Layers\nmodel = Sequential()\nmodel.add(LSTM(units=256, activation='relu', return_sequences=True, input_shape=(features_set.shape[1], 1)))\nmodel.add(Dropout(0.2))\nmodel.add(LSTM(units=128, return_sequences=True))\nmodel.add(Dropout(0.2))\nmodel.add(LSTM(units=128, return_sequences=False))\nmodel.add(Dropout(0.2))\n#model.add(LSTM(units=64))\n#model.add(Dropout(0.2))\n\nmodel.add(Dense(units = 1))\nmodel.compile(optimizer = 'adam', loss = 'mean_squared_error')\nmodel.fit(features_set, labels, epochs = 100, batch_size = 32)","24a2e329":"#Training The LSTM for deaths\n\nmodel_d = Sequential()\nmodel_d.add(LSTM(units=256, activation='relu', return_sequences=True, input_shape=(features_set_d.shape[1], 1)))\nmodel_d.add(Dropout(0.2))\nmodel_d.add(LSTM(units=128, return_sequences=True))\nmodel_d.add(Dropout(0.2))\nmodel_d.add(LSTM(units=128, return_sequences=False))\nmodel_d.add(Dropout(0.2))\n\nmodel_d.add(Dense(units = 1))\nmodel_d.compile(optimizer = 'adam', loss = 'mean_squared_error')\n\nmodel_d.fit(features_set_d, labels_d, epochs = 60, batch_size = 32)","ec336227":"# Define the function to predict the number of comfirmed cases in the next days\ndef predict_comfirmed_CA_model(number_days):\n    features=ca_training_scaled.copy()\n    pred_data=[]\n    for i in range(number_days-1):\n        features=features[-15:]\n        #print(features.shape[1])\n        features = features.reshape(1,15, 1)\n        prediction_record=model.predict(features, verbose=0)\n        #print(prediction_record)\n        pred_data=np.append(pred_data,prediction_record)\n        features= np.append(features, prediction_record)\n    return  pred_data \n","c6eb5219":"# Define the function to predict the number of deaths in the next days\ndef predict_deaths_CA_model(number_days):\n    features_d=ca_d_training_scaled.copy()\n    pred_d_data=[]\n    for i in range(number_days-1):\n        features_d=features_d[-15:]\n        features_d = features_d.reshape(1,15, 1)\n        prediction_d_record=model_d.predict(features_d, verbose=0)\n        #print(prediction_record)\n        pred_d_data=np.append(pred_d_data,prediction_d_record)\n        features_d= np.append(features_d, prediction_d_record)\n    return  pred_d_data ","a2eb8c05":"# Predict the confirmed cases in the next 15 days\npred15=predict_comfirmed_CA_model(15)\npred15","7add5c68":"# Plot to the prediction of confirmed cases\nplt.plot(np.append(ca_training_scaled,pred15))\nplt.axis('tight')\nplt.show()","6eaad711":"index=list(range(87,87+14))\nplt.plot(ca_training_scaled)\nplt.plot(index,pred15)\nplt.show()","975ab1c3":"# Predict the the number of deaths in the next 15 days\npred15_d=predict_deaths_CA_model(15)\npred15_d","df81a5f9":"# Plot to the prediction of deaths\nplt.plot(np.append(ca_d_training_scaled,pred15_d))\nplt.axis('tight')\nplt.show()","0efb28ce":"index_d=list(range(87,87+14))\nplt.plot(ca_d_training_scaled)\nplt.plot(index_d,pred15_d)\nplt.show()","a782e12a":"# Exploring data","d0f15ac4":"Reference:\nhttps:\/\/stackabuse.com\/time-series-analysis-with-lstm-using-pythons-keras-library\/","a3d9adfd":"# LSTM models for Canada confirmed cases and the number of deaths","b2235701":"# Data Normalization"}}