{"cell_type":{"be469f85":"code","1fa83fe1":"code","8ae9200d":"code","20c89d3d":"code","2d7f7ec8":"code","fbd50856":"code","79b87efb":"code","d1c3aed2":"code","41369f59":"code","116a5e22":"code","62866368":"code","b366f9ca":"code","22da515d":"code","663891d1":"code","92c4085d":"code","a3af1ab6":"code","cb8a07b3":"code","b91e3d42":"code","067cd65b":"code","fd367884":"code","e5ec606d":"code","c736396a":"code","1ec4b9cc":"code","23c2eb8c":"code","a922089f":"code","b5470ffc":"markdown","1614c26e":"markdown","1a845e0b":"markdown","9319da01":"markdown","e745c30b":"markdown"},"source":{"be469f85":"pip install split-folders --quiet","1fa83fe1":"import splitfolders\nsplitfolders.ratio(\"..\/input\/danger-of-extinction-animal-image-set\/Danger Of Extinction\",output='Splitted',ratio=(0.8,0.1,0.1))","8ae9200d":"import numpy as np\nimport pandas as pd\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nimport tensorflow as tf\nfrom tensorflow import keras\nimport keras.layers as ml\n\nfrom PIL import Image\n\nfrom keras.preprocessing import image\nfrom keras.preprocessing.image import ImageDataGenerator as Imgen\n","20c89d3d":"train_dir = \".\/Splitted\/train\"\nval_dir = \".\/Splitted\/val\"\ntest_dir = \".\/Splitted\/test\"","2d7f7ec8":"train_ds = Imgen(rescale=1.\/255).flow_from_directory(train_dir,\n                                                    target_size=(150,150),\n                                                    seed = 1,\n                                                     batch_size=32\n                                                    )\nval_ds = Imgen(rescale=1.\/255).flow_from_directory(val_dir,\n                                                    target_size=(150,150),\n                                                    seed = 1,\n                                                     batch_size=32\n                                                    )\ntest_ds = Imgen(rescale=1.\/255).flow_from_directory(test_dir,\n                                                    target_size=(150,150),\n                                                    seed = 1,\n                                                     batch_size=32\n                                                    )","fbd50856":"x_train,y_train = next(train_ds)\nlabels = train_ds.class_indices\nlabels","79b87efb":"pred_li = list(labels.keys())\npred_li","d1c3aed2":"un_labels = train_ds.classes\nlen(un_labels)","41369f59":"un_animals = pd.DataFrame(un_labels).value_counts()\nun_animals","116a5e22":"plt.figure(figsize=(12,15))\nun_animals.plot(kind='pie',shadow=True)\nplt.legend(pred_li,loc ='upper right');","62866368":"plt.figure(figsize=(12,10))\nfor i in range(16):\n    plt.subplot(4,4,i+1)\n    plt.xticks([])\n    plt.yticks([])\n    plt.imshow(x_train[i])\n    plt.title(pred_li[np.argmax(y_train[i])])\n    ","b366f9ca":"from keras.applications.xception import Xception","22da515d":"base_model = Xception(include_top=False,\n                       weights='imagenet',\n                       input_shape=(150,150,3)\n                       )\nbase_model.trainable = False","663891d1":"model = keras.models.Sequential([\n    \n    #base_model\n    base_model,\n    \n    ml.GlobalAveragePooling2D(),\n    \n    ml.Dense(128,activation='relu'),\n    ml.Dropout(0.5),\n    \n    ml.Dense(64,activation='relu'),\n    ml.Dropout(0.5),\n    \n    ml.Dense(11,activation='relu')\n])","92c4085d":"model.summary()","a3af1ab6":"#compile\nmodel.compile(optimizer='adam',loss=keras.losses.CategoricalCrossentropy(from_logits=True),metrics=['accuracy'])","cb8a07b3":"#callbacks\nmy_calls = [tf.keras.callbacks.EarlyStopping(monitor='val_accuracy',patience=3),tf.keras.callbacks.ModelCheckpoint(monitor='val_accuracy',save_best_only=True,mode='max',filepath=\".\/\")]","b91e3d42":"#train\nhist = model.fit(train_ds,epochs=15,validation_data=val_ds,callbacks=my_calls)","067cd65b":"#test\nmodel.evaluate(test_ds)","fd367884":"plt.figure(figsize=(6,6))\n\nplt.plot(hist.epoch,hist.history['accuracy'],label = 'Training')\nplt.plot(hist.epoch,hist.history['val_accuracy'],label = 'validation')\n\nplt.title(\"Accuracy\")\nplt.legend()\nplt.show()","e5ec606d":"plt.figure(figsize=(6,6))\n\nplt.plot(hist.epoch,hist.history['loss'],label = 'Training')\nplt.plot(hist.epoch,hist.history['val_loss'],label = 'validation')\n\nplt.title(\"Loss\")\nplt.legend()\nplt.show()","c736396a":"x_test,y_test = next(test_ds)\nprint(x_test.shape,y_test.shape)","1ec4b9cc":"pred_test = model.predict(x_test)\npred_test = [np.argmax(i) for i in pred_test]","23c2eb8c":"pred_li","a922089f":"plt.figure(figsize=(18,15))\nfor i in range(25):\n    plt.subplot(5,5,i+1)\n    plt.xticks([])\n    plt.yticks([])\n    plt.imshow(x_test[i])\n    plt.xlabel(\"Actual: {}\".format(pred_li[np.argmax(y_test[i])]))\n    plt.ylabel(\"Pred: {}\".format(pred_li[pred_test[i]]))","b5470ffc":"> Importing Libraries","1614c26e":"### Trying transfer learning","1a845e0b":"> Images","9319da01":"### Tests","e745c30b":"> Splitting data"}}