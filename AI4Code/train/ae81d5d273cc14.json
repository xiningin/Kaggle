{"cell_type":{"2917c849":"code","fbaec34e":"code","231495eb":"code","b8463b94":"code","446c6f62":"code","4eccd1c4":"code","74ad27bb":"code","6473a409":"code","283778fe":"code","39666138":"code","391dc1c4":"code","43d93207":"code","2cdde39f":"code","8dc14b1d":"code","978126a4":"code","29cd3449":"code","bea2e2ac":"code","d6a1ca54":"code","228482d8":"code","a25b2ed1":"code","a4fb8a3b":"code","4045e08c":"code","db9fad84":"code","d38a1446":"code","d70fd7b5":"code","ae61f8bf":"code","627d0f2c":"code","8a2fcb09":"code","eb585e56":"code","45cd4e8d":"code","16726ee7":"code","f30433a9":"code","ffb40dba":"code","0828dea0":"code","93a3c9cb":"code","ddda38e6":"code","1e04f59a":"code","d36d97d4":"code","16dc8e11":"code","a8ec44fa":"code","e9b3779e":"code","54e5023b":"markdown","d0451023":"markdown","f787d814":"markdown","3cbde5b1":"markdown","d1626362":"markdown","6268a888":"markdown","c6089462":"markdown","4ecbd690":"markdown","b0965f62":"markdown","d9a00ef1":"markdown","2cfcdd1d":"markdown","8fa5e8fa":"markdown","b703fffe":"markdown","0e41cd5b":"markdown","16c70fe0":"markdown","02b747f8":"markdown","4e7bad72":"markdown","8fdc1ef2":"markdown","c0257d8f":"markdown","fe161e6b":"markdown","6e2fa7f4":"markdown","f23f2f87":"markdown","37f2783b":"markdown","64ec01f6":"markdown","8c15ed25":"markdown","b953ef85":"markdown"},"source":{"2917c849":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nplt.style.use('bmh')\nimport seaborn as sns","fbaec34e":"df_raw = pd.read_csv('..\/input\/testes\/dados.csv')\ndf_raw","231495eb":"df_raw.isnull().values.any()","b8463b94":"# unique values in each column\nfor i in df_raw.columns:\n    print(i, \": \", df_raw[i].nunique())","446c6f62":"df_raw.dtypes","4eccd1c4":"State_dict = {\n    11 : 'Rond\u00f4nia',\n    12 : 'Acre',\n    13 : 'Amazonas',\n    14 : 'Roraima',\n    15 : 'Par\u00e1',\n    16 : 'Amap\u00e1',\n    17 : 'Tocantins',\n    21 : 'Maranh\u00e3o',\n    22 : 'Piau\u00ed',\n    23 : 'Cear\u00e1',\n    24 : 'Rio Grande do Norte',\n    25 : 'Para\u00edba',\n    26 : 'Pernambuco',\n    27 : 'Alagoas',\n    28 : 'Sergipe',\n    29 : 'Bahia',\n    31 : 'Minas Gerais',\n    32 : 'Esp\u00edrito Santo',\n    33 : 'Rio de Janeiro',\n    35 : 'S\u00e3o Paulo',\n    41 : 'Paran\u00e1',\n    42 : 'Santa Catarina',\n    43 : 'Rio Grande do Sul',\n    50 : 'Mato Grosso do Sul',\n    51 : 'Mato Grosso',\n    52 : 'Goi\u00e1s',\n    53 : 'Distrito Federal'\n}","74ad27bb":"Sex_dict = {\n    0 : 'Male',\n    1 : 'Female'\n}","6473a409":"Color_dict = {\n    0 : 'Indigenous',\n    2 : 'White',\n    4 : 'Black',\n    6 : 'Yellow',\n    8 : 'Brown',\n    9 : 'N\/A'\n    }","283778fe":"Years_of_study_dict = {\n    1 : 0,\n    2 : 1,\n    3 : 2,\n    4 : 3,\n    5 : 4,\n    6 : 5,\n    7 : 6,\n    8 : 7,\n    9 : 8,\n    10 : 9,\n    11 : 10,\n    12 : 11,\n    13 : 12,\n    14 : 13,\n    15 : 14,\n    16 : 15,\n    17 : 0\n    }\n\n# 15 years of study means '15 years or more'","39666138":"%%time\ndef preprocess(dataframe):\n    df = dataframe.copy()\n    df.rename(columns={\"UF\": \"State\", \n                     \"Sexo\": \"Sex\",\n                     \"Idade\": \"Age\",\n                     \"Cor\": \"Color\",\n                     \"Anos de Estudo\": \"Years_of_study\",\n                     \"Renda\": \"Income\",\n                     \"Altura\": \"Height\"}, inplace=True)\n    \n    df[\"State\"] = df[\"State\"].map(State_dict)\n    df[\"Sex\"] = df[\"Sex\"].map(Sex_dict)\n    df[\"Color\"] = df[\"Color\"].map(Color_dict)\n    df[\"Years_of_study\"] = df[\"Years_of_study\"].map(Years_of_study_dict)\n    df['Height'] = round(df['Height'], 2)\n    \n    return df\n\ndf = preprocess(df_raw)","391dc1c4":"df","43d93207":"# basic statistics\ndf.describe()","2cdde39f":"df.hist(figsize=(10,8));","8dc14b1d":"%%time\nfig = plt.figure(figsize = (10,8))\nfig.suptitle('Boxplots')\n\nvars = [j for j in df.columns if j not in ['State', 'Sex', 'Color']]\n\nfor i in range(0, len(vars)):\n    ax = plt.subplot(2, 2, i + 1)\n    var = vars[i]\n    plt.title(var)\n    sns.boxplot(data = df[var]);","978126a4":"def plot_together(df, var, bins=10):\n    sns.set(style=\"ticks\")\n\n    x = df[var]\n\n    f, (ax_box, ax_hist) = plt.subplots(2, sharex=True, \n                                        gridspec_kw={\"height_ratios\": (.15, .85)})\n\n    sns.boxplot(x, ax=ax_box)\n    sns.distplot(x, ax=ax_hist, norm_hist=False, bins=bins)\n\n    ax_box.set(yticks=[])\n    sns.despine(ax=ax_hist)\n    sns.despine(ax=ax_box, left=True);","29cd3449":"%%time\n# Age\nplot_together(df, 'Age', bins=20)\n\n# Income\nplot_together(df, 'Income', bins=1000)\nplt.xlim(0, 10000)\n# plt.xticks(rotation=90)\n\n# Years of study\nplot_together(df, 'Years_of_study', bins=20)\n\n# Height\nplot_together(df, 'Height')","bea2e2ac":"%%time\nfig = plt.figure(figsize = (14,8))\n\nvars = [j for j in df.columns if j not in ['Income', 'Age', 'Height']]\n\nfor i in range(0, len(vars)):\n    ax = plt.subplot(2, 2, i + 1)\n    var = vars[i]\n    plt.title(var)\n    df[var].value_counts().plot(kind = 'bar')\n    plt.tight_layout()","d6a1ca54":"%%time\nfig = plt.figure(figsize = (16,10))\n\nvars = ['Age', 'Height']\n\nfor i in range(0, len(vars)):\n    ax = plt.subplot(2, 1, i + 1)\n    var = vars[i]\n    plt.title(var)\n    df[var].value_counts().plot(kind = 'bar')\n    plt.tight_layout()","228482d8":"print(df[\"Sex\"].value_counts())\nprint(\"\\n\")\nprint(df[\"Sex\"].value_counts(normalize=True))","a25b2ed1":"# from 76840 samples, there are 423 that have Age less than 20\nlen(df[\"Age\"][df[\"Age\"]<20])","a4fb8a3b":"print(\"Maximum value for column Age:\", df[\"Age\"].max())\nprint(\"Minimum value for column Age:\", df[\"Age\"].min())","4045e08c":"plt.figure(figsize=(10,6))\nsns.boxplot(x = df['Color'], y = df['Years_of_study'], data = df)\nplt.title(\"Years of study x Color\");","db9fad84":"plt.figure(figsize=(10,6))\nsns.boxplot(x = df['Sex'], y = df['Years_of_study'], data = df)\nplt.title(\"Years of study x Sex\");","d38a1446":"df.groupby('State').mean()[['Years_of_study']].plot(figsize=(14,6), kind='bar')\nplt.title(\"Years of study (Average) x State\");","d70fd7b5":"# Some insights\nprint(\"Number of samples that have Income < 20 k :\", len(df[df[\"Income\"] < 20000]), \":\", round(len(df[df[\"Income\"] < 20000])\/len(df),4), \"%\")\nprint(\"Number of samples that have Income >= 20 k :\", len(df[df[\"Income\"] >= 20000]), \":\", round(len(df[df[\"Income\"] >= 20000])\/len(df),4), \"%\")\nprint(\"Number of samples that have Income >= 40 k :\", len(df[df[\"Income\"] >= 40000]), \":\", round(len(df[df[\"Income\"] >= 40000])\/len(df),4), \"%\")\nprint(\"\\nAverage Salary (Income) :\", round(df['Income'].mean(), 2))\nprint(\"Maximum value for Income :\", df[\"Income\"].max())\nprint(\"Minimum value for Income :\", df[\"Income\"].min())","ae61f8bf":"# income histogram with zoom (less than 40k)\n\nfig, ax = plt.subplots(1, 4, figsize = (16, 5))\nax[0].hist(df[\"Income\"][df[\"Income\"] < 40000], bins = 100)\nax[0].set_title('Frequency x Income (<40k)')\nax[1].hist(df[\"Income\"][df[\"Income\"] < 15000], bins = 100)\nax[1].set_title('Frequency x Income (<15k)')\nax[2].hist(df[\"Income\"][df[\"Income\"] < 10000], bins = 100)\nax[2].set_title('Frequency x Income (<10k)')\nax[3].hist(df[\"Income\"][df[\"Income\"] < 5000], bins = 100)\nax[3].set_title('Frequency x Income (<5k)');","627d0f2c":"# income histogram with zoom (more than 40k)\ndf[\"Income\"][df[\"Income\"] > 40000].plot(figsize=(10,4), kind = 'hist', bins = 300)\nplt.title('Frequency x Income (>40k)');","8a2fcb09":"%%time\nfig = plt.figure(figsize = (14,12))\n\nvars = [j for j in df.columns if j not in ['Income', 'Height', 'Age', 'State']]\n\nmax_value = 5000\n\nfor i in range(0, len(vars)):\n    ax = plt.subplot(3, 1, i + 1)\n    var = vars[i]\n    sns.boxplot(x = df[var], y = df['Income'][df['Income']<max_value], data = df[df['Income'] < max_value])\n    plt.tight_layout();","eb585e56":"%%time\nfig = plt.figure(figsize = (16,10))\n\nvars = ['Age', 'Height']\n\nmax_value = 5000\n\nfor i in range(0, len(vars)):\n    ax = plt.subplot(2, 1, i + 1)\n    var = vars[i]\n    plt.title(var)\n    sns.boxplot(x = df[var], y = df['Income'][df['Income']<max_value], data = df[df['Income'] < max_value])\n    \n    if var == 'Height':\n        plt.xticks(rotation = 90)\n    \n    plt.tight_layout();","45cd4e8d":"n = 500\nsample = df.sample(n, random_state=4) # plot only n samples\n\nplt.figure(figsize=(16, 6))\nplt.style.use('fivethirtyeight')\nplt.ylim(0, 20000)\nplt.title(\"Income x Age x Color\")\nplt.xticks([0, 10, 20, 30, 40, 50, 60, 70, 80], labels = [0, 10, 20, 30, 40, 50, 60, 70, 80])\nsns.scatterplot(x = sample['Age'], y = sample['Income'], data = sample, hue = sample['Color']);","16726ee7":"limit = 10_000\n\ndf[df['Income'] < limit].plot.hexbin(x='Age', y='Income', gridsize=15);","f30433a9":"less_than_five_years = df[df[\"Years_of_study\"] <= 5]\nfive_nine_years = df[(df[\"Years_of_study\"] > 5) &  (df[\"Years_of_study\"] < 10)]\nnine_fourteen_years = df[(df[\"Years_of_study\"] >= 10) & (df[\"Years_of_study\"] < 15)]\nmore_than_fifteen_years = df[df[\"Years_of_study\"] >= 15]\n\nprint(\"Average income for 0-5 years of study :\", round(less_than_five_years['Income'].mean(), 2))\nprint(\"Average income for 6-9 years of study :\", round(five_nine_years['Income'].mean(), 2))\nprint(\"Average income for 10-14 years of study :\", round(nine_fourteen_years['Income'].mean(), 2))\nprint(\"Average income for 15+ years of study :\", round(more_than_fifteen_years['Income'].mean(), 2))","ffb40dba":"# plot averages\nyear_avgs = np.array([\n    round(less_than_five_years['Income'].mean(), 2),\n    round(five_nine_years['Income'].mean(), 2),\n    round(nine_fourteen_years['Income'].mean(), 2),\n    round(more_than_fifteen_years['Income'].mean(), 2)\n    ])\n\ncategories = np.array(['<5', '5-9', '10-14', '15+'])\n\nplt.figure(figsize=(8,6))\nplt.style.use('bmh')\nsns.barplot(x=categories, y=year_avgs)\nplt.title(\"Income x Years of study\");","0828dea0":"limit = 10_000\n\ndf[df['Income'] < limit].plot.hexbin(x='Years_of_study', y='Income', gridsize=15);","93a3c9cb":"df.groupby('State').mean()[['Income']].plot(figsize=(16,6), kind='bar');\nplt.axhline(y = df['Income'].mean(), color = 'r', linestyle = 'dashed', label = 'mean value');\nplt.legend();","ddda38e6":"plt.figure(figsize=(8,6))\nplt.title(\"Height x Sex\")\nsns.boxplot(x = df['Sex'], y = df['Height']);","1e04f59a":"print(\"Average height for men :\", round(df[df['Sex'] == 'Male']['Height'].mean(), 3))\nprint(\"Average height for women :\", round(df[df['Sex'] == 'Female']['Height'].mean(), 3))","d36d97d4":"%%time\n\nn = 800\nsample = df.sample(n, random_state=0)\n\nsns.pairplot(sample, hue = 'Color');","16dc8e11":"%%time\n\nn = 800\nsample = df.sample(n, random_state=0)\n\nsns.pairplot(sample, hue = 'Sex');","a8ec44fa":"# heatmap for correlations\ncorr = df.corr()\nplt.figure(figsize=(8,6))\nsns.heatmap(corr, annot = True, vmin = 0, vmax = 1, cmap = 'Purples');","e9b3779e":"df.to_csv('\/kaggle\/working\/pnad_clean.csv', index=False)","54e5023b":"# Load data","d0451023":"## Income x Age x Color","f787d814":"This is a brief exploratory analysis of brazilian society using the 2015 PNAD dataset (Pesquisa Nacional por Amostras de Domic\u00edlios: National Survey by Household Sample).\n\nPart 1: Data analysis (this notebook)\n\nPart 2: [Modeling](https:\/\/www.kaggle.com\/hinepo\/pnad-income-prediction?scriptVersionId=74289035)\n\nPart 3: [Lazy Predict](https:\/\/www.kaggle.com\/hinepo\/pnad-lazy-predict?scriptVersionId=74288711)","3cbde5b1":"# Height x Sex","d1626362":"## Boxplots","6268a888":"## Histograms","c6089462":"[matplotlib styles](https:\/\/matplotlib.org\/stable\/gallery\/style_sheets\/style_sheets_reference.html)","4ecbd690":"## Histograms & Boxplots","b0965f62":"## Income x Years of study","d9a00ef1":"- As expected, height does not affect income.\n- As people get older, they tend to have lower incomes.","2cfcdd1d":"# About this notebook","8fa5e8fa":"## Years of study vs Color","b703fffe":"## Income x State","0e41cd5b":"# Univariate Analysis","16c70fe0":"# Export clean PNAD df","02b747f8":"# Bivariate Analysis","4e7bad72":"# Preprocess","8fdc1ef2":"# Imports","c0257d8f":"## Value counts","fe161e6b":"- Women tend to study more years than men.","6e2fa7f4":"# Multivariate Analysis\n\nNow let's check some correlations on the data.\n\nReminder: Correlation is not causality!","f23f2f87":"## Years of study vs State","37f2783b":"# Income","64ec01f6":"## Years of study vs Sex","8c15ed25":"# Years of study","b953ef85":"- Although women usually study more than men (as seen in the item Years of study vs. Sex), they generally have lower income than men.\n- There is a clear relationship between years of schooling and earnings."}}