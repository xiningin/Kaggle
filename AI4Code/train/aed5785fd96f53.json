{"cell_type":{"f74b8245":"code","d889f8d5":"code","58d64687":"code","d92ed311":"code","d0105b53":"code","7616c341":"code","e17bcf81":"code","eb5ae581":"code","8becfe02":"code","266a3dc3":"code","2c28b3e6":"code","df822980":"code","aa86517d":"code","de8de203":"code","53c5cde9":"code","7829ebee":"code","4038d99b":"code","657fc873":"code","c14ddfb8":"code","dd8b9bc1":"markdown","42d1f6f7":"markdown","06767d5a":"markdown","db457f19":"markdown","f81855b7":"markdown","d625ee1a":"markdown","3af4bbdf":"markdown","3db813aa":"markdown","0dba3e14":"markdown","a49ca6ef":"markdown","5482b2c4":"markdown","e7931008":"markdown","dcb36f4c":"markdown","8d47cc67":"markdown","9736ba48":"markdown","b47d3f4b":"markdown","c26a8c4b":"markdown","fa5510a2":"markdown"},"source":{"f74b8245":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n#import datatable as dt","d889f8d5":"%%time\ndata_train = pd.read_csv(\"..\/input\/jane-street-market-prediction\/train.csv\")","58d64687":"#%%time\n\n#data = dt.fread(\"..\/input\/jane-street-market-prediction\/train.csv\")\n\n#print(\"Train size:\", data.shape)","d92ed311":"data_train.head()","d0105b53":"#column names\ndata_train.columns","7616c341":"# column types\ndata_train.dtypes","e17bcf81":"missing_values_count = data_train.isnull().sum()\nmissing_values_count","eb5ae581":"total_cells_data = np.product(data_train.shape)\ntotal_missing_data = missing_values_count.sum()\nprint (\"The percentage of missing data = \",(total_missing_data\/total_cells_data) * 100, \"%\")","8becfe02":"data_train = data_train.fillna(-999)","266a3dc3":"data_train = data_train[data_train['weight'] != 0]\ndata_train['action'] = ((data_train['weight'].values * data_train['resp'].values) > 0).astype('int')\ndata_train['action']","2c28b3e6":"data_train","df822980":"X_train = data_train.loc[:, data_train.columns.str.contains('feature')]\ny_train = data_train.loc[:, 'action']","aa86517d":"import xgboost as xgb\nfrom xgboost import XGBClassifier","de8de203":"# fit model no training data\nmodel = xgb.XGBClassifier(\n    n_estimators=480,\n    max_depth=10,\n    learning_rate=0.05,\n    subsample=0.9,\n    colsample_bytree=0.7,\n    missing=-999,\n    random_state=2020,\n    tree_method='gpu_hist'\n)","53c5cde9":"%time \nmodel.fit(X_train, y_train)","7829ebee":"sample_prediction_df  = pd.read_csv(\"..\/input\/jane-street-market-prediction\/example_sample_submission.csv\")\ndata_test= pd.read_csv(\"..\/input\/jane-street-market-prediction\/example_test.csv\")","4038d99b":"data_test.isnull().sum()","657fc873":"import janestreet\n# initiation of the environment\nenv = janestreet.make_env()\n# an iterator to loops over the test set\niter_test = env.iter_test() ","c14ddfb8":"for (test_df, sample_prediction_df) in iter_test:\n    #We will specify the X_test from our test data (features)\n    X_test = test_df.loc[:, test_df.columns.str.contains('feature')]\n    #Replace the missing value with -999\n    X_test.fillna(-999)\n    #Predict using our X_test\n    y_preds = model.predict(X_test)\n    #Make \/ store our prediction results in sample_pred_df\n    sample_prediction_df.action = y_preds\n    env.predict(sample_prediction_df)","dd8b9bc1":" It contains 2390491 datapoints in 138 unique columns.","42d1f6f7":"**iter_test** function is:\n\nGenerator which loops through each rushing play in the test set and provides the observations at TimeHandoff just like the training set. Once you call predict to make your yardage prediction, you can continue on to the next play.","06767d5a":"**Read The Data**","db457f19":"Method: Datatable\n\n![](https:\/\/i.ibb.co\/V9S7jRH\/0-w7dsj-AY9-CKNY7ow-L.png)\n\nDatatable (heavily inspired by R's data.table) can read large datasets fairly quickly and is often faster than pandas. It is specifically meant for data processing of tabular datasets with emphasis on speed and support for large sized data.\n\nDocumentation: https:\/\/datatable.readthedocs.io\/en\/latest\/index.html","f81855b7":"# Make The environement","d625ee1a":"# Train the XGBoost Model","3af4bbdf":"In Pandas it will take approximately 1min 40s","3db813aa":"This dataset contains an anonymized set of features, feature_{0...129}, representing real stock market data. Each row in the dataset represents a trading opportunity, for which you will be predicting an action value: 1 to make the trade and 0 to pass on it. Each trade has an associated weight and resp, which together represents a return on the trade. ","0dba3e14":"**What is XGBoost**?\n\nXGBoost stands for eXtreme Gradient Boosting.\n\nThe name xgboost, though, actually refers to the engineering goal to push the limit of computations resources for boosted tree algorithms. Which is the reason why many people use xgboost.\n\n\nIt is an implementation of gradient boosting machines created by Tianqi Chen, now with contributions from many developers. It belongs to a broader collection of tools under the umbrella of the Distributed Machine Learning Community or DMLC who are also the creators of the popular mxnet deep learning library.\n\nTianqi Chen provides a brief and interesting back story on the creation of XGBoost in the post Story and Lessons Behind the Evolution of XGBoost.\n\nXGBoost is a software library that you can download and install on your machine, then access from a variety of interfaces. Specifically, XGBoost supports the following main interfaces:\n\n* Command Line Interface (CLI).\n* C++ (the language in which the library is written).\n* Python interface as well as a model in scikit-learn.\n* R interface as well as a model in the caret package.\n* Julia.\n* Java and JVM languages like Scala and platforms like Hadoop.\n\n**XGBoost Features**:\n\nThe library is laser focused on computational speed and model performance, as such there are few frills. Nevertheless, it does offer a number of advanced features.\n\n[Reference: To get More](https:\/\/machinelearningmastery.com\/gentle-introduction-xgboost-applied-machine-learning\/)","a49ca6ef":"If we try to read with pandas it will take a long time, The opperation is faster on Datatable , we can try with Datatable but it will bring us in a memory problem .The notebook will try to allocate more memory than is available.","5482b2c4":"install datatable","e7931008":"# Checking the missing data ","dcb36f4c":"# splitting The Train data","8d47cc67":"# Import The data\n**Load the data**","9736ba48":"# Import The Libraries Needed","b47d3f4b":"# Make Predictions with XGBoost Model","c26a8c4b":"**Why replacing with -999**  >  [Reference](https:\/\/stats.stackexchange.com\/questions\/225175\/why-do-some-people-use-999-or-9999-to-replace-missing-values\/225179)\n\nAnd since our data is distributed far from -999 we can replace it:","fa5510a2":"The types of columns:"}}