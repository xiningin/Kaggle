{"cell_type":{"dcf9ace8":"code","510bb072":"code","b4060d1c":"code","4cd5e3b1":"code","125dc5d1":"code","fd0396a4":"code","8ddb4e93":"markdown"},"source":{"dcf9ace8":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport imageio\nplt.style.use('seaborn')\n\ndeaths_raw = pd.read_csv('\/kaggle\/input\/novel-corona-virus-2019-dataset\/time_series_covid_19_deaths.csv').groupby('Country\/Region').sum().reset_index()\ncases_raw = pd.read_csv('\/kaggle\/input\/novel-corona-virus-2019-dataset\/time_series_covid_19_confirmed.csv').groupby('Country\/Region').sum().reset_index()","510bb072":"# pivot the tables for convenience\ncountry2deaths = dict(zip(deaths_raw['Country\/Region'], deaths_raw.to_numpy()[:, 3:].astype(float)))\ncountry2cases = dict(zip(cases_raw['Country\/Region'], cases_raw.to_numpy()[:, 3:].astype(float)))\ndates = pd.to_datetime(deaths_raw.columns[3:])\n\ndeaths = pd.DataFrame(dict(date=dates))\ncases = pd.DataFrame(dict(date=dates))\nfor country in country2cases.keys():\n    deaths[country] = country2deaths[country]\n    cases[country] = country2cases[country]","b4060d1c":"countries = ['China', 'Italy', 'US', 'Germany', 'Iran', 'Spain', 'France', 'Korea, South', 'United Kingdom']\ncolors = ['red', 'black', 'green', 'brown', 'darkorchid', 'cyan', 'darkslategray', 'darkorange', 'b']\n\ny_max = 2 * max(d for country in countries for d in deaths[country])\nx_max = 2 * max(c for country in countries for c in cases[country])\n\ndef draw_trajectories(date):\n    fig = plt.figure(figsize=(10, 6))\n    X = np.arange(1, x_max)\n    plt.plot(X, X*0.002, '--', color='grey')\n    plt.text(x_max, x_max * 0.002, '0.2% mortality')\n    plt.plot(X, X*0.01, '--', color='grey')\n    plt.text(x_max, x_max * 0.01, '1% mortality')\n    plt.plot(X, X*0.05, '--', color='grey')\n    plt.text(x_max, x_max * 0.05, '5% mortality')\n    plt.plot(X, X*0.25, '--', color='grey')\n    plt.text(y_max * 3, y_max, '25% mortality')\n    \n    cases_lim = cases[cases.date <= date]\n    deaths_lim = deaths[deaths.date <= date]\n    for country, color in zip(countries, colors):\n        plt.plot(cases_lim[country], deaths_lim[country], label=country, color=color, marker='*')\n\n\n    if not isinstance(date, str):\n        date = str(date.date())\n    plt.title('COVID-19 country trajectories as of %s' % date)\n    plt.legend()\n    plt.ylim(1, y_max)\n    plt.xlim(1, x_max)\n    plt.yscale('log')\n    plt.xscale('log')\n    plt.xlabel('Confirmed Cases')\n    plt.ylabel('Deaths')\n    plt.close()\n    return fig","4cd5e3b1":"# plot latest data\ndraw_trajectories(dates[-1])","125dc5d1":"# make animation\nframes = []\nfor date in dates:\n    fig = draw_trajectories(date)\n    fig.canvas.draw()       # draw the canvas, cache the renderer\n    image = np.frombuffer(fig.canvas.tostring_rgb(), dtype='uint8')\n    image  = image.reshape(fig.canvas.get_width_height()[::-1] + (3,))\n    frames.append(image)\n\nending_frames = 20\nframes = frames + ([frames[-1]] * ending_frames)","fd0396a4":"# save animation\nimageio.mimsave('.\/trajectories.gif', frames, fps=1.5)\n\n# display animation\nfrom IPython.display import Image\nImage(filename=\"trajectories.gif\")","8ddb4e93":"![Trajectories](trajectories.gif \"trajectories\")"}}