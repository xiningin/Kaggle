{"cell_type":{"9f255da8":"code","2818fdcd":"code","71b9d8af":"code","a2e2d396":"code","17015a2c":"code","f74aec46":"code","3b598baf":"code","af40d28f":"code","b35a0344":"code","b688c0c6":"markdown"},"source":{"9f255da8":"import os\nimport glob\nimport math\nimport numpy as np \nimport pandas as pd \nimport tensorflow as tf\nimport tensorflow.keras.backend as K\nimport matplotlib.pyplot as plt","2818fdcd":"sub = pd.read_csv('..\/input\/cassava-leaf-disease-classification\/sample_submission.csv', index_col=0)","71b9d8af":"fs = sub.index","a2e2d396":"def read_tfrecord(filename):\n    filename = tf.strings.join([\"..\/input\/cassava-leaf-disease-classification\/test_images\/\", filename])\n    b = tf.io.read_file(filename)\n    image = tf.image.decode_jpeg(b)\n    image = tf.cast(image, tf.float32) \/ 255.0\n    return image","17015a2c":"AUTO = tf.data.experimental.AUTOTUNE\n\ndataset = tf.data.Dataset.from_tensor_slices(fs)\ndataset = dataset.map(read_tfrecord, num_parallel_calls=AUTO)\ndataset = dataset.prefetch(AUTO)\ndataset = dataset.batch(1)\n","f74aec46":"model = tf.keras.models.load_model('..\/input\/getting-started-tpus-new-tfrecords\/resnet50.h5')\n# model.summary(line_length=130)","3b598baf":"for i, image in enumerate(dataset.as_numpy_iterator()):\n    ps = []\n    ps.append(model.predict(image)[0])    \n    ps = np.mean(ps, axis=0)\n    sub.iloc[i, 0] = np.argmax(ps)","af40d28f":"sub.to_csv('submission.csv')","b35a0344":"sub","b688c0c6":"# The inference of official baseline (Tensorflow + new tfrecords).\n\n# Training code is [here](https:\/\/www.kaggle.com\/wuliaokaola\/getting-started-tpus-new-tfrecords)."}}