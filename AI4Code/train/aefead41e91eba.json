{"cell_type":{"ee1429e5":"code","ab537f99":"code","c65780e5":"code","9812bbed":"code","e4081992":"code","21915c38":"code","fe658933":"code","2cbc129f":"code","4a6991cf":"code","b844c391":"code","50efdcf5":"code","0b3a88e7":"code","7951d998":"code","2b6f491d":"code","8e9777b5":"code","15dc01b0":"code","3465ea78":"code","d90d2a26":"code","d077000b":"code","8c3afe6c":"code","65460755":"code","6a5bbcca":"markdown","70699592":"markdown","a311a7d9":"markdown","f48f5aae":"markdown","be645296":"markdown"},"source":{"ee1429e5":"import numpy as np\nimport pandas as pd\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set_style('darkgrid')\n\nfrom tensorflow import keras\nfrom keras.models import Sequential,load_model\nfrom keras.layers import Dense,GlobalAveragePooling2D,Flatten,Conv2D,BatchNormalization,Dropout,MaxPooling2D,Activation\nfrom keras.preprocessing import image\nfrom keras.preprocessing.image import ImageDataGenerator as Imgen\n\nfrom PIL import Image\nfrom sklearn.metrics import confusion_matrix,classification_report","ab537f99":"train_df = pd.read_csv(\"..\/input\/plant-pathology-2021-fgvc8\/train.csv\")","c65780e5":"train_df.shape","9812bbed":"train_df.labels.value_counts()","e4081992":"sample = pd.read_csv('..\/input\/plant-pathology-2021-fgvc8\/sample_submission.csv')\nsample.head()","21915c38":"datagen = Imgen(preprocessing_function=keras.applications.xception.preprocess_input,\n                 rotation_range=4,\n                  shear_range=0.2,\n                  zoom_range=0.2,\n                  horizontal_flip=True,\n                  validation_split=0.2\n                 )","fe658933":"train_ds = datagen.flow_from_dataframe(\n    train_df,\n    directory = '..\/input\/resized-plant2021\/img_sz_256', \n    x_col = 'image',\n    y_col = 'labels',\n    subset=\"training\",\n    color_mode=\"rgb\",\n    target_size = (224,224),\n    class_mode=\"categorical\",\n    batch_size=32,\n    shuffle=True,\n    seed=123,\n)\n\n\nval_ds = datagen.flow_from_dataframe(\n    train_df,\n    directory = '..\/input\/resized-plant2021\/img_sz_256',\n    x_col = 'image',\n    y_col = 'labels',\n    subset=\"validation\",\n    color_mode=\"rgb\",\n    target_size = (224,224),\n    class_mode=\"categorical\",\n    batch_size=32,\n    shuffle=True,\n    seed=123,\n)","2cbc129f":"a = train_ds.class_indices\nclass_names = list(a.keys())\nclass_names","4a6991cf":"x,y = next(train_ds)\nx.shape","b844c391":"#plot function\ndef plot_images(img,labels):\n    plt.figure(figsize=(15,10))\n    for i in range(25):\n        plt.subplot(5,5,i+1)\n        plt.imshow(img[i])\n        plt.title(class_names[np.argmax(labels[i])])\n        plt.axis('off')","50efdcf5":"plot_images(x,y)","0b3a88e7":"model = Sequential([\n    \n    Conv2D(32,(3,3),activation='relu',input_shape=(224,224,3)),\n    MaxPooling2D((2,2)),\n    \n    Conv2D(64,(3,3),activation='relu'),\n    MaxPooling2D((2,2)),\n    \n    Conv2D(64,(3,3),activation='relu'),\n    MaxPooling2D((2,2)),\n    \n    Conv2D(128,(3,3),activation='relu'),\n    MaxPooling2D((2,2)),\n    \n    Flatten(),\n    \n    Dense(128,activation='relu'),\n    Dropout(0.5),\n    \n    Dense(64,activation='relu'),\n    Dropout(0.5),\n    \n    Dense(12,activation='softmax')\n    \n])\n\nmodel.summary()","7951d998":"keras.utils.plot_model(model,\n                      show_shapes=True,\n                      show_dtype=True,\n                      show_layer_names=True)","2b6f491d":"model.compile(optimizer='adam',loss='categorical_crossentropy',metrics=['accuracy'])","8e9777b5":"my_calls = [keras.callbacks.EarlyStopping(monitor='val_accuracy',patience=2),\n            keras.callbacks.ModelCheckpoint(\"Model_xcp.h5\",verbose=1,save_best_only=True)]","15dc01b0":"hist = model.fit(train_ds,epochs=25,validation_data=val_ds,callbacks=my_calls)","3465ea78":"plt.figure(figsize=(15,6))\n\nplt.subplot(1,2,1)\nplt.plot(hist.epoch,hist.history['accuracy'],label = 'Training')\nplt.plot(hist.epoch,hist.history['val_accuracy'],label = 'validation')\n\nplt.title(\"Accuracy\")\nplt.legend()\n\nplt.subplot(1,2,2)\nplt.plot(hist.epoch,hist.history['loss'],label = 'Training')\nplt.plot(hist.epoch,hist.history['val_loss'],label = 'validation')\n\nplt.title(\"Loss\")\nplt.legend()\nplt.show()","d90d2a26":"sample.head()","d077000b":"test_gen = Imgen(preprocessing_function=keras.applications.xception.preprocess_input)\n\ntest_ds = test_gen.flow_from_dataframe(sample,\n                                      directory='..\/input\/plant-pathology-2021-fgvc8\/test_images',\n                                      x_col = 'image',\n                                       y_col = None,\n                                       class_mode=None,\n                                       target_size=(224,224)\n                                      )","8c3afe6c":"pred = model.predict(test_ds)\npred","65460755":"pred = [np.argmax(i) for i in pred]\nfor i in pred:\n    print(class_names[i])","6a5bbcca":"## **MODEL**","70699592":"**Data Generation**","a311a7d9":"**Image Data Gen**","f48f5aae":"**Visualize some images**","be645296":"**Train**"}}