{"cell_type":{"ea8df6b7":"code","754faf06":"code","a3c4000b":"code","7cb01a96":"code","9e90955a":"code","2385a1cb":"code","1cd3ec67":"code","26a4407d":"code","9800118d":"code","8f75e523":"code","e78cc736":"code","3dc19657":"code","a93d6f16":"code","f0756557":"code","856ac862":"code","6ed69d39":"code","8ababf1c":"code","b11f6a3e":"code","4bf44c05":"code","5469cb71":"code","cf1b18ff":"code","7cceda76":"code","5dbe05cd":"code","55761eae":"code","22d67079":"markdown","a78d9af8":"markdown","bde55170":"markdown","05aa303d":"markdown","1f27a6e8":"markdown","7f0f3d2e":"markdown","c4a41e2e":"markdown"},"source":{"ea8df6b7":"import fastai\nfrom fastai.vision.all import *\nfrom pathlib import Path\nimport pandas as pd\nimport numpy as np","754faf06":"path = Path('..\/input\/waste-classification-data\/dataset\/DATASET\/')","a3c4000b":"images = path \/ 'TRAIN' ","7cb01a96":"db = DataBlock(blocks=(ImageBlock, CategoryBlock),\n                   splitter=RandomSplitter(seed=42),\n                   get_items=get_image_files, \n                   get_y=parent_label,\n                   item_tfms=Resize(256))","9e90955a":"dl = db.dataloaders(images)","2385a1cb":"dl.show_batch(nrows=3, ncols=3)","1cd3ec67":"model = cnn_learner(dl, resnet34, metrics=error_rate)\nmodel.fine_tune(1, base_lr=0.1)","26a4407d":"model.lr_find()","9800118d":"model = cnn_learner(dl, resnet34, metrics=error_rate)\nmodel.fine_tune(1, base_lr=2e-3)","8f75e523":"model = cnn_learner(dl, resnet34, metrics=error_rate)\nmodel.fit_one_cycle(1, 2e-3)\nmodel.unfreeze()\nmodel.fit_one_cycle(8, lr_max=slice(1e-6,1e-4))","e78cc736":"model.recorder.plot_loss()","3dc19657":"model.show_results()","a93d6f16":"interp = ClassificationInterpretation.from_learner(model)","f0756557":"interp.print_classification_report()","856ac862":"interp.plot_confusion_matrix(figsize=(9,7), dpi=60)","6ed69d39":"interp.plot_top_losses(7, figsize=(15,11))","8ababf1c":"test = path\/'TEST'\ntest.ls()","b11f6a3e":"test_images = get_image_files(test)","4bf44c05":"test_db = DataBlock(blocks=(ImageBlock, CategoryBlock),\n                   get_items=get_image_files,\n                  get_y=parent_label,\n                   item_tfms=Resize(256))","5469cb71":"test_dl = test_db.dataloaders(test)","cf1b18ff":"tdl = test_dl.test_dl(test_images, with_labels=False)","7cceda76":"tdl.show_batch(nrows=3, ncols=3)","5dbe05cd":"preds = model.get_preds(dl=tdl)","55761eae":"predictions = torch.argmax(preds[0], dim=1)\ntest_labels = torch.Tensor([1 if i.name[0] == 'R' else 0 for i in test_images])\naccuracy = round((test_labels == predictions).float().mean().item()*100,1)\nprint(f'Accuracy on test set {accuracy}%')","22d67079":"We've got a better error rate! Now let's train the final model and see if results improve a bit more. First, the model trains on randomly added layers for one epoch, with all other layers frozen. Then it unfreezes all the layers and  trains with *discriminative learning rates*. ","a78d9af8":"# **Training**","bde55170":"First let's create a basic cnn model with fastai","05aa303d":"# **Creating a datablock and dataloader for train images**","1f27a6e8":"# **Import libraries**","7f0f3d2e":"# **Model performance on test set**","c4a41e2e":"Now let's train a model specifying the suitable learning rate"}}