{"cell_type":{"f7fc0191":"code","f20d89be":"code","c43b05ca":"code","dd7c30d6":"code","487ca7d7":"code","179bab0d":"code","a70f0b56":"code","d425cc96":"code","42c790e3":"code","bac30acb":"code","36d6a8c0":"code","237b6887":"code","ef9b1a89":"code","1b8983db":"code","e3050dfd":"code","e07e0f5f":"code","d368e42f":"code","42e7fc35":"code","44142d00":"code","3edd895e":"code","72058e1e":"code","b4503340":"code","a3a78545":"code","30ca8c08":"code","a79c2054":"code","5d9e737f":"code","00206f94":"code","2cbf6e62":"code","26ce0ee3":"code","f79493e2":"code","fcde6f0a":"code","627f3296":"code","3937f36e":"code","891fdf27":"code","f9a8222d":"code","8ba12045":"code","0b78fde5":"code","6316a2eb":"markdown","6595246a":"markdown","56e7fe81":"markdown","2aec9302":"markdown","15a74356":"markdown","a858b5a5":"markdown","06936b80":"markdown","5f00124b":"markdown","1ca4e335":"markdown","9bbc9c64":"markdown","1b71267e":"markdown","e641e563":"markdown","d418fb1c":"markdown","9a67fe8b":"markdown","986be4f3":"markdown","30e0be61":"markdown","31f31ec0":"markdown","73b8ae45":"markdown"},"source":{"f7fc0191":"# import packages\nfrom __future__ import print_function\n\n\nimport pandas as pd\nimport numpy as np\n\nimport seaborn as sns\nfrom matplotlib import pyplot as plt\nimport plotly as py\nimport plotly.graph_objects as go\nimport plotly.express as px\nfrom ipywidgets import interact, interactive, fixed, interact_manual,IntSlider\nimport ipywidgets as widgets\nfrom IPython.core.display import display, HTML\n\n#import plotly.offline as py\n#autosize =False\nimport plotly.io as pio\n","f20d89be":"death_df     = pd.read_csv(\"..\/input\/novel-corona-virus-2019-dataset\/time_series_covid_19_deaths.csv\") \nconfirmed_df = pd.read_csv(\"..\/input\/novel-corona-virus-2019-dataset\/time_series_covid_19_confirmed.csv\") \nrecovered_df = pd.read_csv(\"..\/input\/novel-corona-virus-2019-dataset\/time_series_covid_19_recovered.csv\")\ndf           = pd.read_csv(\"..\/input\/novel-corona-virus-2019-dataset\/covid_19_data.csv\")\n","c43b05ca":"df.columns = map(str.lower, df.columns)\nconfirmed_df.columns = map(str.lower, confirmed_df.columns)\nrecovered_df.columns = map(str.lower, recovered_df.columns)\ndeath_df.columns = map(str.lower, death_df.columns)\n","dd7c30d6":"del df['sno']","487ca7d7":"df           = df.rename(columns           = {\"province\/state\":\"state\",\"country\/region\": \"country\",})\nconfirmed_df = confirmed_df.rename(columns = {\"province\/state\": \"state\", \"country\/region\": \"country\"})\nrecovered_df = recovered_df.rename(columns = {\"province\/state\": \"state\", \"country\/region\": \"country\"})\ndeath_df     = death_df.rename(columns     = {\"province\/state\": \"state\", \"country\/region\": \"country\"})\n","179bab0d":"nan_states_df = df[df['state'].isnull()]\n\nprint('nan_states_df shape is : '+ str(nan_states_df.shape))\nprint('nan_states_df has got : '+ str(nan_states_df['country'].nunique()) + ' unique Country values')\n\nnan_states_df = nan_states_df[['observationdate','country','confirmed','deaths','recovered']]\nnan_states_df.head()","a70f0b56":"states_df = df[df['state'].notnull()]\n\nprint('states_df shape is : '+ str(states_df.shape))\nprint('states_df has got : '+ str(states_df['state'].nunique()) + ' unique State values')\n \nstates_df = states_df[['observationdate','state','country','confirmed','deaths','recovered']]\nstates_df.head()","d425cc96":"concentrated_states_df= states_df.groupby(['observationdate','country'])[['confirmed','deaths','recovered']].sum().reset_index()\nconcentrated_states_df.head()","42c790e3":"full_countries_df = pd.concat([nan_states_df, concentrated_states_df], axis=0).reset_index()\nfull_countries_df.head()","bac30acb":"lastest_full_countries_df = full_countries_df.groupby(['country'])[['observationdate','confirmed','deaths','recovered']].max().reset_index()\nlastest_full_countries_df.head()","36d6a8c0":"sorted_countries_df = lastest_full_countries_df.sort_values(\"confirmed\", ascending = False)\nsorted_countries_df.head()","237b6887":"# sorting the values by confirmed descednding order\nfig = go.FigureWidget( layout=go.Layout() )\ndef highlight_col(x):\n    r = 'background-color: red'\n    y = 'background-color: purple'\n    g = 'background-color: grey'\n    temp_df = pd.DataFrame('', index=x.index, columns=x.columns)\n    temp_df.iloc[:, 2] = y\n    temp_df.iloc[:, 3] = r\n    temp_df.iloc[:, 4] = g\n    \n    return temp_df\n\n\ndef show_latest_cases(n):\n    n = int(n)\n    return sorted_countries_df.sort_values('confirmed', ascending= False).head(n).style.apply(highlight_col, axis=None)\n\ninteract(show_latest_cases, n='10');","ef9b1a89":"usa_df = states_df[states_df['country']=='US'] \nusa_df.head()","1b8983db":"lastest_usa_df = usa_df.groupby(['state']).max().reset_index()\nlastest_usa_df.head()","e3050dfd":"confirmed_usa_total = int(lastest_usa_df['confirmed'].sum())\ndeaths_usa_total = int(lastest_usa_df['deaths'].sum())\nrecovered_usa_total = int(lastest_usa_df['recovered'].sum())","e07e0f5f":"# displaying the USA total stats\n\ndisplay(HTML(\"<div style = 'background-color: white; padding: 30px '>\" +\n             \"<span style='color: black; font-size:30px;'> Confirmed: \"  + str(confirmed_usa_total) +\"<\/span>\" +\n             \"<span style='color: red; font-size:30px;margin-left:20px;'> Deaths: \" + str(deaths_usa_total) + \"<\/span>\"+\n             \"<span style='color: darkgreen; font-size:30px; margin-left:20px;'> Recovered: \" + str(recovered_usa_total) + \"<\/span>\"+\n             \"<\/div>\")\n       )","d368e42f":"sorted_lastest_usa_df = lastest_usa_df.sort_values(by='confirmed', ascending=False)\nsorted_lastest_usa_df[:10]","42e7fc35":"f, ax = plt.subplots(figsize=(10,15))\n\nsns.set_color_codes(\"bright\")\nsns.barplot(x=\"confirmed\", y=\"state\", data=sorted_lastest_usa_df[:50],\n            label=\"Confirmed\", color=\"y\")\n\nsns.set_color_codes(\"bright\")\nsns.barplot(x=\"recovered\", y=\"state\", data=sorted_lastest_usa_df[:50],\n            label=\"Recovered\", color=\"g\")\n\nsns.set_color_codes(\"bright\")\nsns.barplot(x=\"deaths\", y=\"state\", data=sorted_lastest_usa_df[:50],\n            label=\"Deaths\", color=\"r\")\n\n# Add a legend and informative axis label\nax.legend(ncol=2, loc=\"lower right\", frameon=True)\nax.set(xlim=(0, 400), ylabel=\"\",\n       xlabel=\"Stats\")\nsns.despine(left=True, bottom=True)","44142d00":"fig_pie = px.pie(lastest_usa_df, values = 'confirmed',names='state', height=600)\nfig_pie.update_traces(textposition='inside', textinfo='percent+label')\n\nfig_pie.update_layout(\n    title_x = 0.5,\n    geo=dict(\n        showframe = False,\n        showcoastlines = False,\n    ))\n\npio.show(fig_pie)","3edd895e":"lastest_usa_df[(lastest_usa_df['confirmed'] == lastest_usa_df['deaths'])]","72058e1e":"lastest_usa_df[(lastest_usa_df['recovered'] < lastest_usa_df['deaths'])]","b4503340":"lastest_usa_df['death ratio'] = (lastest_usa_df['deaths']\/lastest_usa_df['confirmed'])*100","a3a78545":"lastest_usa_df['recovered ratio'] = (lastest_usa_df['recovered']\/lastest_usa_df['confirmed'])*100","30ca8c08":"lastest_usa_df.sort_values(by='death ratio', ascending=False).head()","a79c2054":"lastest_usa_df[lastest_usa_df.confirmed>100].sort_values(by='death ratio', ascending=False).head()","5d9e737f":"lastest_usa_df.sort_values(by='recovered ratio', ascending=False).head()","00206f94":"lastest_usa_df[lastest_usa_df.confirmed>100].sort_values(by='recovered ratio', ascending=False).head()","2cbf6e62":"fig_c = px.treemap(lastest_usa_df, path=[\"state\"], values=\"confirmed\", \n                 title='Number of Confirmed Cases in the USA',\n                 color_discrete_sequence = px.colors.qualitative.Pastel)\nfig_c.show()","26ce0ee3":"fig_d = px.treemap(lastest_usa_df, path=[\"state\"], values=\"deaths\", \n                 title='Number of Deaths Cases in the USA',\n                 color_discrete_sequence = px.colors.qualitative.Pastel)\nfig_d.show()","f79493e2":"confirmed_total = int(sorted_countries_df['confirmed'].sum())\ndeaths_total = int(sorted_countries_df['deaths'].sum())\nrecovered_total = int(sorted_countries_df['recovered'].sum())\nactive_total = confirmed_total-deaths_total-recovered_total","fcde6f0a":"# displaying the total stats\n\ndisplay(HTML(\"<div style = 'background-color: white; padding: 30px '>\" +\n             \"<span style='color: black; font-size:30px;'> Confirmed: \"  + str(confirmed_total) +\"<\/span>\" +\n             \"<span style='color: red; font-size:30px;margin-left:20px;'> Deaths: \" + str(deaths_total) + \"<\/span>\"+\n             \"<span style='color: darkgreen; font-size:30px; margin-left:20px;'> Recovered: \" + str(recovered_total) + \"<\/span>\"+\n             \"<\/div>\")\n       )","627f3296":"# # plotting the 10 worst hit countries\n\ndef bubble_chart(n):\n    fig = px.scatter(sorted_countries_df.head(n), x=\"country\", y=\"confirmed\", size=\"confirmed\", color=\"country\",\n               hover_name=\"country\", size_max=60)\n    fig.update_layout(\n    title=str(n) +\" Worst hit countries\",\n    xaxis_title=\"Countries\",\n    yaxis_title=\"Confirmed Cases\",\n    width = 700\n    )\n    fig.show();\n\ninteract(bubble_chart, n=10);","3937f36e":"# I will use plotly again,\nimport plotly.graph_objects as go\n\ndef plot_cases_for_country(country):\n    labels = [\"confirmed\", \"deaths\"]\n    colors = [\"blue\", \"red\"]\n    mode_size = [6,8]\n    line_size = [4,5]\n\n    df_list = [confirmed_df, death_df]\n\n    fig = go.Figure()\n\n    for i, df in enumerate(df_list):\n        if country == \"World\" or country == \"world\":\n            x_data = np.array(list(df.iloc[:,5:])) # after 5th column we have dates on datasets\n            y_data = np.sum(np.asarray(df.iloc[:, 5:]), axis = 0)\n        else:\n            x_data = np.array(list(df.iloc[:, 5:].columns))\n            y_data = np.sum(np.asarray(df[df[\"country\"]== country].iloc[:,5:]),axis = 0)\n        fig.add_trace(go.Scatter(x=x_data, y= y_data, mode=\"lines+markers\", \n                                name = labels[i],\n                                line = dict(color = colors[i], width = line_size[i]),\n                                connectgaps = True,\n                                text = \"Total\" + str(labels[i]) + \" : \" + str(y_data[-1])\n                                                    ))\n       # pio.show(fig)\n       #py.iplot(fig)\n        fig.show()\n       \n        \n# so make it interactive\ninteract(plot_cases_for_country, country = \"World\");","891fdf27":" import folium","f9a8222d":"world_map = folium.Map(location=[11,0], titles = \"cartodbpositron\", zoom_start = 2, max_zoom = 6, min_zoom = 2)\n\nfor i in range(len(confirmed_df)):\n    folium.Circle(\n    location = [confirmed_df.iloc[i][\"lat\"],confirmed_df.iloc[i][\"long\"]],\n    fill= True,\n    radius = (int((np.log(confirmed_df.iloc[i,-1]+1.00001)))+0.2)*25000,\n    fill_color = \"blue\",\n    color = \"darkorange\",\n    tooltip = \"<div style='margin:0; background-color: grey; color:white;'>\" +\n                \"<h4 style= 'text-align:center; font-weight:bold'>\"+confirmed_df.iloc[i][\"country\"]+\"<\/h4>\"\n                \"<hr style='margin:10px;color:white;'>\"+\n                \"<ul style='color: white;;list-style-type:circle;align-item:left;padding-left:20px;padding-right:20px'>\"+\n                    \"<li>Confirmed: \"+str(confirmed_df.iloc[i,-1])+\"<\/li>\"+\n                    \"<li>Deaths: \"+str(death_df.iloc[i,-1])+\"<\/li>\"+\n                    \"<li>Deaeth Rate: \"+str(np.round(death_df.iloc[i,-1]\/(confirmed_df.iloc[i,-1]+1.00001)*100,2))+\"<\/li>\"+\n                \"<\/ul><\/div>\"\n    ).add_to(world_map)\n\nworld_map","8ba12045":"fig1 = px.choropleth(full_countries_df, \n                    locations=\"country\", \n                    locationmode = \"country names\",\n                    color=\"confirmed\",\n                    color_continuous_scale='sunsetdark',\n                    hover_name=\"country\", \n                    animation_frame=\"observationdate\"\n                   )\n\nfig1.update_layout(\n    title_text = 'Spread of Coronavirus',\n    title_x = 0.85,\n    geo=dict(\n        showframe = False,\n        showcoastlines = False,\n    ))\n    \nfig1.show()","0b78fde5":"fig2 = px.choropleth(full_countries_df, \n                    locations=\"country\", \n                    locationmode = \"country names\",\n                    color=\"recovered\",\n                    #color_continuous_scale='Rainbow',\n                    hover_name=\"country\", \n                    animation_frame=\"observationdate\"\n                   )\n\nfig2.update_layout(\n    title_text = 'Number of Corona Virus recovered',\n    title_x = 0.5,\n    geo=dict(\n        showframe = False,\n        showcoastlines = False,\n    ))\n    \nfig2.show()","6316a2eb":"## Deaths and Recovered ratio in confirmed cases","6595246a":"## Are there states where all of the cases have died?","56e7fe81":"Also according this table, again I should put a limit to confirmed cases","2aec9302":"## USA","15a74356":">* Enter the name of your country(in capitalized format(e.g. Italy)) and world for total cases\n","a858b5a5":"### Comparison of States in the USA","06936b80":"Based on the latest updates, I have colored confirmed cases, recovered cases and deaths.","5f00124b":"## Spread of Recovered from Corona Virus","1ca4e335":"> I have divided the countries in the data with states(states_df) and without a \n\n---\n\nstate(nan_states_df).\n  \n    \n# Concentrating and preparing dataframes","9bbc9c64":"## Are there any states where there are more deaths than survivors?","1b71267e":"## Spread of Coronavirus","e641e563":"### What are the top 10 states with the most cases?","d418fb1c":"When I look at the results from this table, Michigan has the best recovered rate.\n\n## Let's look at the distribution of cases and deaths to America in a tree map","9a67fe8b":"# Exploring Current Status in the USA","986be4f3":"## Other countries in the world","30e0be61":" > When I make the number of confirmed more than 100, I see that the state with the highest death rate is Connecticut. ","31f31ec0":" > According to these results, Grant County, WA and Santa Rosa County, FL are the cities with the highest mortality rates.\n \n >However, the number of dead is quite low, so I think I should set a limit","73b8ae45":"# Exploring Cases Over Time Worldwide with Interactive Time Map"}}