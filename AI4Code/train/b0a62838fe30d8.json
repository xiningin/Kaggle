{"cell_type":{"b3ae41c0":"code","4af2f6cb":"code","1bca453a":"code","4fc3f58f":"code","f6d8be2d":"code","e5f49488":"code","23f8a1e7":"code","5912ea52":"code","b33352da":"code","fb486afe":"code","cd7851d4":"code","fbac2830":"code","a5024ad9":"code","7e4f856b":"code","0beef43f":"code","68ea29ff":"code","4b0cd4f2":"code","8cc233e0":"markdown"},"source":{"b3ae41c0":"# \u3053\u308c\u3092pip install\u3057\u3066import\u3059\u308b\u3060\u3051\u3067matplotlib\u3067\u65e5\u672c\u8a9e\u8868\u793a\u304c\u7c21\u5358\u306b\u3067\u304d\u307e\u3059\n!pip install japanize-matplotlib","4af2f6cb":"import gc\n\nimport numpy as np\nimport pandas as pd\nfrom pandas import DataFrame\nimport matplotlib.pyplot as plt\nimport japanize_matplotlib\nplt.style.use('ggplot')\n%matplotlib inline\n\nfrom tqdm.notebook import tqdm\nfrom umap import UMAP","1bca453a":"# \u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\ndf_train = pd.read_csv('\/kaggle\/input\/data-science-summer2-osaka\/train.csv')\ndf_test = pd.read_csv('\/kaggle\/input\/data-science-summer2-osaka\/test.csv')\ndf_user = pd.read_csv('\/kaggle\/input\/data-science-summer2-osaka\/user_x_anime.csv')","4fc3f58f":"# \u30e6\u30fc\u30b6\u30fc\u3054\u3068\u306e\u8996\u8074\u30a2\u30cb\u30e1ID\u3092\u30ea\u30b9\u30c8\u3067\u53d6\u5f97\u3057\u307e\u3059\u3002\n# \u6b8b\u5ff5\u306a\u304c\u3089\u3061\u3083\u3093\u3068\u3057\u305f\u8996\u8074\u9806\u5e8f\u306b\u306f\u306a\u3063\u3066\u3044\u307e\u305b\u3093\u304c\u3001\u307e\u305a\u306f\u3053\u308c\u3067\u3084\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\nanime_lists = df_user.groupby(['user_id'])['anime_id'].apply(lambda x: [str(s) for s in x])\nanime_lists","f6d8be2d":"anime_lists = pd.concat([anime_lists, anime_lists.apply(lambda x: list(np.random.choice(x, len(x), replace=False)))])","e5f49488":"# gensim\u3092\u4f7f\u3046\u3068\u3068\u3066\u3082\u7c21\u5358\u306bword vector\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\nfrom gensim.models import word2vec","23f8a1e7":"# \u5b66\u7fd2\u3057\u307e\u3059\u3002\u591a\u5c11\u6642\u9593\u304c\u304b\u304b\u308b\u3067\u3057\u3087\u3046\u3002\n# gensim\u306fGPU\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u306e\u304c\u7389\u306b\u7455\u3067\u3059\u306d\u3002\nmodel = word2vec.Word2Vec(anime_lists.values, vector_size=100, min_count=5, window=5, epochs=100, workers=4)","5912ea52":"# \u3053\u306e\u3088\u3046\u306a\u30d9\u30af\u30c8\u30eb\u8868\u73fe\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nmodel.__dict__['wv']['419']","b33352da":"# train\u3068test\u3092\u7d50\u5408\u3057\u3066\u304a\u304d\u307e\u3059\u3002\ndf_concat = pd.concat([df_train, df_test])\ndf_concat.index = range(len(df_concat))","fb486afe":"# \u305d\u306e\u9806\u306b\u5f97\u3089\u308c\u305f\u30a2\u30cb\u30e1\u30d9\u30af\u30c8\u30eb\u3092\u683c\u7d0d\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nembedding_matrix = np.zeros((len(df_concat), 100))\n\nfor i in tqdm(range(len(embedding_matrix))):\n    embedding_matrix[i] = model.__dict__['wv'][df_concat.MAL_ID.astype(str).values[i]]","cd7851d4":"# \u5f97\u3089\u308c\u305fembedding_matrix\u3067\u3059\u3002\nembedding_matrix","fbac2830":"# \u53ef\u8996\u5316\u3059\u308b\u305f\u3081\u306bUMAP\u3067\uff12\u6b21\u5143\u306b\u5727\u7e2e\u3057\u3066\u307f\u307e\u3059\u3002\numap = UMAP(n_components=2)\numap.fit(embedding_matrix)\nprojected_matrix = umap.transform(embedding_matrix)","a5024ad9":"# \uff12\u6b21\u5143\u306b\u306a\u308a\u307e\u3057\u305f\u3002\nprojected_matrix","7e4f856b":"# \u4f8b\u3048\u3070\u4eca\u56de\u306e\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306b\u306f\u30ac\u30f3\u30c0\u30e0\u95a2\u9023\u306e\u30a2\u30cb\u30e1\u304c\u3053\u306e\u3088\u3046\u306b\u3044\u304f\u3064\u3082\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002\ndf_concat[df_concat['Japanese name'].apply(lambda x: '\u30ac\u30f3\u30c0\u30e0' in x)]","0beef43f":"# \u3053\u308c\u3089\u306e4\u3064\u306e\u30b7\u30ea\u30fc\u30ba\u306b\u3064\u3044\u3066\u3001\u53ef\u8996\u5316\u3057\u3066\u307f\u307e\u3057\u3087\u3046\nanime_series = ['\u30ac\u30f3\u30c0\u30e0', '\u30d1\u30c8\u30ec\u30a4\u30d0\u30fc', '\u30d7\u30ea\u30ad\u30e5\u30a2', '\u30a2\u30a4\u30ab\u30c4']","68ea29ff":"# \u307e\u3042\u307e\u3042\u3067\u3057\u3087\u3046\u304b\u306d\u3002\nplt.figure(figsize=[7,7])\nfor a in anime_series:\n    anime_ix = df_concat[df_concat['Japanese name'].apply(lambda x: a in x)].index\n    plt.scatter(projected_matrix[anime_ix, 0], projected_matrix[anime_ix, 1], s=15, label=a)\nplt.legend()\nplt.xlabel('UMAP-0')\nplt.ylabel('UMAP-1')\nplt.show()","4b0cd4f2":"# \u4fdd\u5b58\u3057\u3066\u304a\u304d\u307e\u3059\nnp.save('embedding_matrix.npy', embedding_matrix)\nnp.save('projected_matrix.npy', projected_matrix)\nmodel.save('anime2vec.model')","8cc233e0":"\u30e6\u30fc\u30b6\u30fc\u3054\u3068\u306e\u8996\u8074\u5c65\u6b74\u3084\u95b2\u89a7\u5c65\u6b74\u304c\u4e0e\u3048\u3089\u308c\u305f\u969b\u306b\u3001\u305d\u306e\u7cfb\u5217\u3092\u6587\u7ae0\u306b\u898b\u7acb\u3066\u3066NLP\u306e\u624b\u6cd5\u3092\u9069\u7528\u3059\u308b\u3068\u3044\u3046\u30a2\u30d7\u30ed\u30fc\u30c1\u306f\u4f8b\u3048\u3070\u3001KaggleDaysTokyo\u306b\u304a\u3051\u308b\u65e5\u7d4c\u96fb\u5b50\u7248\u306e\u30da\u30fc\u30b8\u95b2\u89a7\u5c65\u6b74\u304b\u3089\u53e4\u304f\u306fKDDCup2015\u306b\u304a\u3051\u308b\u30aa\u30f3\u30e9\u30a4\u30f3\u5b66\u7fd2\u30b3\u30fc\u30b9\u306b\u304a\u3051\u308b\u53d7\u8b1b\u5c65\u6b74\u306b\u5bfe\u3057\u3066\u306a\u3069\u5e45\u5e83\u304f\u9069\u7528\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u3001\u30a2\u30cb\u30e1\u3092\u5358\u8a9e\u306b\u306b\u3001\u30a2\u30cb\u30e1\u30ec\u30d3\u30e5\u30fc\u5c65\u6b74\u306e\u30b7\u30fc\u30af\u30a8\u30f3\u30b9\u3092\u6587\u7ae0\u306b\u898b\u7acb\u3066\u3066word2vec\u306b\u3088\u308b\u30a2\u30cb\u30e1\u30d9\u30af\u30c8\u30eb\u306e\u62bd\u51fa\u3092\u884c\u3063\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002"}}