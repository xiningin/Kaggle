{"cell_type":{"f679df20":"code","4ec38ae8":"code","9912b22d":"code","246bf049":"code","bafb6296":"code","d241d829":"code","8ce0635b":"code","254694ab":"code","f1fd9030":"code","9a4462f7":"code","a2fce83d":"code","b39fea36":"code","dc741290":"code","d7aab05e":"code","64b023b2":"code","2fcd2b77":"code","ac14fe1c":"code","18cd2d6b":"code","6e3441c2":"code","dc76c95e":"code","e0bdd93c":"code","11908bbf":"code","bc870949":"code","bcc0fd48":"code","e425caa3":"code","870bd90f":"code","8860c0db":"code","1b014894":"code","0713c3e6":"code","e3fb9cf0":"code","bc288152":"code","9facfdc0":"code","c7349fee":"code","cc5dcab7":"code","c2413911":"markdown","6cd7f973":"markdown","10b5aa74":"markdown","400fedbf":"markdown","ea98bbcb":"markdown","a254123e":"markdown","2f40601c":"markdown","53831adf":"markdown","e4224afc":"markdown"},"source":{"f679df20":"!pip install pyspark","4ec38ae8":"from pyspark.sql import SparkSession\nimport pyspark.sql.functions as F\nfrom pyspark.sql.types import *\nspark = SparkSession.builder.appName('data_processing').getOrCreate()\nfrom pyspark.sql.functions import udf","9912b22d":"df = spark.read.csv(\"..\/input\/sales\/Sales Records.csv\",header=True,inferSchema=True)","246bf049":"df.show(5)","bafb6296":"df.dtypes","d241d829":"df = df.withColumnRenamed('Item Type','Item_Type').withColumnRenamed('Sales Channel','Sales_Channel').withColumnRenamed('Order Priority','Order_Priority')\ndf = df.withColumnRenamed('Order Date','Order_Date').withColumnRenamed('Order ID','Order_ID').withColumnRenamed('Ship Date','Ship_Date')\ndf = df.withColumnRenamed('Units Sold','Units_Sold').withColumnRenamed('Unit Price','Unit_Price').withColumnRenamed('Unit Cost','Unit_Cost')\ndf = df.withColumnRenamed('Total Revenue','Total_Revenue').withColumnRenamed('Total Cost','Total_Cost').withColumnRenamed('Total Profit','Total_Profit')","8ce0635b":"df.select(['Item_Type']).distinct().show()","254694ab":"df.select(['Region','Country']).distinct().show()","f1fd9030":"df[(df.Order_Priority == 'H') \n   & (df.Country == 'United States of America') ].show(5,False)","9a4462f7":"df.filter(df.Sales_Channel == 'Online').filter(df.Region == 'North America').show(5,False)","a2fce83d":"df.filter(df.Sales_Channel == 'Offline').filter(df.Region == 'North America').show(5,False)","b39fea36":"df.where((df.Units_Sold > 5000) | (df.Total_Revenue >= 100000)).show(5,False)","dc741290":"df.where((df.Order_Priority == 'H') & (df.Total_Profit >= 1000000)).show(5,False)","d7aab05e":"df.groupby('Region').agg(F.sum('Total_Profit').alias('Region Profits')).show(5,False)","64b023b2":"df.groupby('Item_Type').agg(F.sum('Total_Profit').alias('Item Profits')).show(5,False)","2fcd2b77":"df.groupby('Country').agg(F.sum('Total_Profit').alias('Sum Total Profits')).show(5,False)","ac14fe1c":"df.groupby('Sales_Channel').agg(F.sum('Total_Profit').alias('Channel Profits')).show(5,False)","18cd2d6b":"df.groupby('Region').agg(F.mean('Total_Revenue').alias('Sum Total Revenue')).show(5,False)","6e3441c2":"df.groupby('Country').agg(F.mean('Total_Revenue').alias('Average Revenue')).show(5,False)","dc76c95e":"df.groupby('Region').agg(F.mean('Total_Cost').alias('Item Cost')).show(5,False)","e0bdd93c":"df.groupby('Region').agg(F.collect_set('Item_Type')).show(5)","11908bbf":"df.groupby(\"Region\").agg(F.collect_list(\"Units_Sold\")).show()","bc870949":"def Prof(Total_Profit):\n    if Total_Profit >= 937196.46:\n        return 'Above Average Profit'\n    else: \n        return 'Below Average Profit'","bcc0fd48":"Prof_udf=udf(Prof,StringType())\ndf=df.withColumn('Prof',Prof_udf(df['Total_Profit']))","e425caa3":"df.select('Total_Profit','Prof').show(5,False)","870bd90f":"df[df.Total_Profit >= 950000].show(5)","8860c0db":"df1 = spark.read.csv('..\/input\/working13\/ManagerInformation.csv',header=True,inferSchema=True)","1b014894":"df1.show()","0713c3e6":"join_df = df.join(df1,on='Region')","e3fb9cf0":"join_df.groupby('Manager_Name').agg(F.sum('Total_Profit').alias('Manager Profits')).show(5,False)","bc288152":"df.groupby('Region').pivot('Item_Type').sum('Total_Revenue').fillna(0).show(5,False)","9facfdc0":"from pyspark.sql.window import Window\nfrom pyspark.sql.functions import col,row_number","c7349fee":"WinF = Window.orderBy(df['Total_Profit'].desc())\ndf = df.withColumn('rank',row_number().over(WinF).alias('rank'))","cc5dcab7":"df.show(5)","c2413911":"### Window Function","6cd7f973":"### Filter Statements","10b5aa74":"### (UDF) User Defined Function","400fedbf":"### Select Statements","ea98bbcb":"### Pivot","a254123e":"### Groupby\/Aggregation","2f40601c":"### Collect Set\/List","53831adf":"### Where Statements","e4224afc":"### Join"}}