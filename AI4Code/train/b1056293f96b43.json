{"cell_type":{"baa2b023":"code","17b03690":"code","b3514b14":"code","16b0a708":"code","d910d6bc":"code","7d8f9bdb":"code","fa73953a":"code","5bfae41f":"code","af2986fb":"code","2274674b":"code","8b282b28":"code","89c189dd":"code","3eef6039":"code","9ad216e4":"code","6eebc568":"code","8c015870":"code","2d9c1043":"code","d5eb2b27":"code","2997dbce":"code","04127ece":"code","5cd2f9b0":"code","d5b97d1d":"code","23a22c47":"code","b381abd0":"code","ab05319f":"code","03a12188":"code","4aadeee7":"code","47d59850":"code","222c6d70":"code","1048c680":"code","e3ab1604":"code","e050254f":"code","33eed90c":"code","6e9de6f0":"code","349c4ece":"code","c16c064a":"code","291b3a64":"code","f5d10762":"code","ef059bac":"code","f48b5919":"code","ba02cb73":"code","25a5b32a":"code","a64d8050":"markdown","2f0a53c8":"markdown","4b9973ba":"markdown","17127ca4":"markdown","5fc0693c":"markdown","854c052b":"markdown","e4968fb9":"markdown","2d1abdc7":"markdown","ff952182":"markdown","51519ff3":"markdown","5eb4f1c5":"markdown","6a2dab49":"markdown","fea73ca2":"markdown","f2c446b7":"markdown","badfcd16":"markdown","d3e1523e":"markdown"},"source":{"baa2b023":"#import all the neccesary libraries\nimport numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom tqdm import tqdm","17b03690":"county_time_series = pd.read_csv(\"..\/input\/zecon\/County_time_series.csv\")\ncrosswalk = pd.read_csv(\"..\/input\/zecon\/CountyCrossWalk_Zillow.csv\")\nunemployment = pd.read_csv(\"..\/input\/2018-unemployment-rate-by-county\/GeoFRED_Unemployment_Rate_by_County_Percent.csv\")\ninterest_rates = pd.read_csv(\"..\/input\/interest-rates\/index.csv\")","b3514b14":"#displaying few rows of dataset\ncounty_time_series.head()","16b0a708":"#selecting and displaying three columns from the dataset\ncrosswalk = crosswalk[['FIPS', 'CountyName', 'StateName']]\ncrosswalk[\"FIPS\"] = crosswalk[\"FIPS\"].astype(\"int64\")\ncrosswalk.head()","d910d6bc":"new = county_time_series[county_time_series['Date'] >= '2000-01-01'][['Date', 'RegionName', 'ZHVI_AllHomes']]","7d8f9bdb":"new.head()","fa73953a":"new.rename(index=str, columns={\"RegionName\": \"FIPS\", \"ZHVI_AllHomes\": \"AverageHousePrice\"}, inplace=True)\nnew.head()","5bfae41f":"#merged dataset\nnew101 = new.merge(crosswalk, on=\"FIPS\")\nnew101.head()","af2986fb":"temp = []\nfor i in tqdm(range(len(new101))):\n    date = new101.iloc[i]['Date'].split('-')[:-1]\n    date.append('01')\n    temp.append('-'.join(date))","2274674b":"new101['Date'] = temp ","8b282b28":"new101.head()","89c189dd":"unemployment.shape","3eef6039":"unemployment.head()","9ad216e4":"#create a column named 'UnemploymentRate'\nnew101['UnemploymentRate'] = [0] * len(new101)","6eebc568":"#get state avg for missing unemployment rates\ndef getStateAvg(fips, date):\n    # unemployment[unemployment['Region Code'] in fips]\n    running_unempRate, considered = 0, 0\n    for i in fips:\n        try:\n            running_unempRate = running_unempRate + unemployment[unemployment['Region Code'] == i ][date].iloc[0]\n            considered = considered + 1\n        except:\n            pass\n    if considered == 0:\n        raise('Issue in calculating the getStateAvg')\n    else:\n        return running_unempRate \/ considered","8c015870":"#merge unemployment data with zecon data\nfor i in tqdm(range( len(new101) )):\n    regionCode = new101.iloc[i]['FIPS']\n    date = new101.iloc[i]['Date']\n    state = new101.iloc[i]['StateName']\n    try:\n        unempRate = unemployment[unemployment['Region Code'] == regionCode][date.split('-')[0]].iloc[0]\n    except:\n        # Put the average of that state\n        # Get all the FIPS numbers\n        fips = list( set( new101[new101['StateName'] == state]['FIPS'] ))\n        unempRate = round( getStateAvg(fips, date.split('-')[0]), 1)\n        \n    new101.iloc[i, -1] = unempRate","2d9c1043":"new101.head()","d5eb2b27":"interest_rates.shape","2997dbce":"interest_rates.head()","04127ece":"#filter out the important columns\ninterest_rates = interest_rates[['Year','Month','Day', 'Real GDP (Percent Change)', 'Inflation Rate']]\ninterest_rates.dropna()\ninterest_rates.head()","5cd2f9b0":"#merge according to 'Date' as common key from 2000\ntemp = []\nfor i in tqdm(range(len(interest_rates))):\n    year = str(int(interest_rates.iloc[i]['Year']))\n    month = str(int(interest_rates.iloc[i]['Month']))\n    day = str(int(interest_rates.iloc[i]['Day']))\n    if len(month) == 1:\n        month = '0'+ month\n    if len(day) == 1:\n        day = '0'+ day\n    date = year + '-' + month + '-' + day\n    temp.append(date)","d5b97d1d":"interest_rates['Date'] = temp","23a22c47":"interest_rates.head()","b381abd0":"#filtering out the numerical factors\ninterest_rates = interest_rates[['Real GDP (Percent Change)', 'Inflation Rate', 'Date']]\ninterest_rates.head()","ab05319f":"#merge according to date\nnew102 = new101.merge(interest_rates, on ='Date')\nnew102.head() ","03a12188":"new102.shape","4aadeee7":"#checking missing values\nnew102.isnull().sum()","47d59850":"mean_avghouseprice = new102['AverageHousePrice'].mean()\nnew102['AverageHousePrice'].fillna(value=mean_avghouseprice, inplace=True)","222c6d70":"mean_gdp = new102['Real GDP (Percent Change)'].mean()\nnew102['Real GDP (Percent Change)'].fillna(value=mean_gdp, inplace=True)","1048c680":"mean_irate = new102['Inflation Rate'].mean()\nnew102['Inflation Rate'].fillna(value=mean_irate, inplace=True)","e3ab1604":"new102.tail()","e050254f":"final_data = new102[['FIPS','AverageHousePrice', 'UnemploymentRate', 'Real GDP (Percent Change)', 'Inflation Rate']]\nfinal_data.head()","33eed90c":"#Plotting histograms for all features in the data set\nfor i in final_data.columns:\n    plt.figsize=(5,5)\n    plt.hist(new102[i])\n    plt.title(i)\n    plt.show()","6e9de6f0":"#Plotting correlation matrix for all features in the dataset\ncorrmat = final_data.corr()\nplt.subplots(figsize=(6, 6))\nsns.heatmap(corrmat.abs(), vmax=.4, square=True)","349c4ece":"#Correlation of each feature with house price\nprint (\"The correlation between a house price and unemployment rate is: {0}\".format(corrmat[\"UnemploymentRate\"][\"AverageHousePrice\"]))\nprint (\"The correlation between a house price and Real GDP is: {0}\".format(corrmat[\"Real GDP (Percent Change)\"][\"AverageHousePrice\"]))\nprint (\"The correlation between a house price and Inflation Rate is: {0}\".format(corrmat[\"Inflation Rate\"][\"AverageHousePrice\"]))\nprint (\"The correlation between a house price and FIPS is: {0}\".format(corrmat[\"FIPS\"][\"AverageHousePrice\"]))","c16c064a":"#Model\nfrom xgboost import XGBRegressor\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import r2_score, mean_squared_error\n\nxgboost = XGBRegressor(objective ='reg:linear',\n                       colsample_bytree = 0.3, \n                       learning_rate = 0.1,\n                       max_depth = 5, \n                       alpha = 10, \n                       random_state=777,\n                       n_estimators = 100)","291b3a64":"#shuffling data before splitting into train and test\nfinal_data.sample(frac = 1)","f5d10762":"#splitting the data into 'training' and 'testing'\nx = final_data[['FIPS','UnemploymentRate', 'Real GDP (Percent Change)', 'Inflation Rate']]\ny = final_data[['AverageHousePrice']] \n\nx_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.2, random_state=0)","ef059bac":"#predicting the model metric\nxgboost.fit(x_train, y_train)\ny_pred = xgboost.predict(x_test)\nprint(\"mse of the model : \", mean_squared_error(y_test, y_pred)) ","f48b5919":"print(\"This is the importance of each feature: {0}\".format(xgboost.feature_importances_))","ba02cb73":"#Plot showing feature importance\nfrom xgboost import plot_importance\nplot_importance(xgboost)\nplt.show()","25a5b32a":"# Generating a few examples\nprint (\"These are the first five entries\")\nprint (x_test[:5])\nprint (\"These are the model prediction for these entries\")\nprint (xgboost.predict(x_test[:5]))\nprint (\"These are the actual prices\")\nprint (y_test[:5])","a64d8050":"#### The below data shows UnemploymentRate feature added to the dataset","2f0a53c8":"### Interest Rates\nMerging GDP and Inflation Rate (supply factors) in our data.","4b9973ba":"### Zillow economics data","17127ca4":"#### Below is the merged data along with changed dates","5fc0693c":"#### The below dataset is compilation of zecon, unemployment and interest rates data along with 'FIPS' (it represents location) and 'Date' ranging from 2000 to 2017","854c052b":"## Model","e4968fb9":"## Final Data","2d1abdc7":"#### Checking how the model works.","ff952182":"## Data Visualisation","51519ff3":"#### As 'Date' is not going to be a numerical feature for our model to train as we have all the data from 2000 to 2017, we can drop it and create our final dataset. Shown below.","5eb4f1c5":"### Unemployment Data\nMerging Unemployment rate (demand factor) in our data.","6a2dab49":"#### Tackling missing values in data columns by calculating the mean of the column and replacing missing values with it.","fea73ca2":"## Datasets\nTo predict house prices using supply-demand features, three main datasets have been used.\n1. Federal Reserve Interest Rates (1954 - 2017)\n2. Unemployment Rate by County in the USA (2000 - 2018)\n3. Zillow economics data (County_time_series and Crosswalk)","f2c446b7":"#### To avoid clash with interest rate data, date is assumed to be the start of every month as shown below.","badfcd16":"#### All the data ranging from date '2000-01-01' is taken along with the RegionName and House Prices","d3e1523e":"#### The datasets Crosswalk and County_time_Series have a common column, which is 'FIPS'\/'RegionName', and both of them can be merged on that basis."}}