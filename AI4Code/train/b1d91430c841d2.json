{"cell_type":{"e04ed185":"code","a2c24ca6":"code","c1892e7c":"code","435382dc":"code","a3967156":"code","d8cb3b6b":"code","d20afff4":"code","ce6a8bd8":"code","90156e89":"code","863d4f79":"code","dbd99677":"code","691525e7":"code","3f791e6b":"code","b689ebdf":"code","963bd358":"code","bfee07b2":"code","3cd663e9":"code","7998f852":"code","a6c0caa6":"code","cfd85149":"markdown","dc6d4bdc":"markdown","1efc9ae3":"markdown","af4c10b1":"markdown","b026ed70":"markdown","6c8d21a9":"markdown","bd27558c":"markdown","87c47794":"markdown","51517cc2":"markdown","b8458695":"markdown","b1f163d3":"markdown","651412c5":"markdown","2b960dfc":"markdown","d89038a8":"markdown","2e1b7028":"markdown","d3b283cb":"markdown","fe4da320":"markdown","949b6ba5":"markdown","8307a6e5":"markdown","6407fb20":"markdown","0da30541":"markdown","344fb08a":"markdown","6a8203d6":"markdown"},"source":{"e04ed185":"import pandas as pd\nimport matplotlib.pyplot as plt\nplt.style.use('ggplot')","a2c24ca6":"df = pd.read_csv('..\/input\/daily-total-female-births-in-california-1959\/daily-total-female-births-CA.csv')\ndf.head()","c1892e7c":"x , y = df.date , df.births\nfig = plt.figure(figsize=(12,4))\nplt.plot(x, y);\nplt.xlabel('Date')\nplt.ylabel('Number of Births')\nplt.title('Daily total female births in california, 1959')\nplt.show()","435382dc":"from statsmodels.stats.diagnostic import acorr_ljungbox\nimport numpy as np\n\n# lags is suggested to be the log(len(y))\nacorr_ljungbox(y, lags=6, return_df =True)\n","a3967156":"from statsmodels.tsa.statespace.tools import diff\n\nfig = plt.figure(figsize=(12,4))\nplt.plot(diff(y),color='b');\nplt.xlabel('Date')\nplt.ylabel('Number of Births')\nplt.title('Differenced series')\nplt.show()","d8cb3b6b":"from statsmodels.graphics.tsaplots import plot_acf, plot_pacf\n\nplt.figure(figsize=(16,4))\nax1 = plt.subplot(1,2,1)\nplot_acf(diff(y), title='ACF of differenced time series',ax=ax1 )\nplt.xlabel('Lag')\nplt.ylabel('ACF')\nax2 = plt.subplot(1,2,2)\nplot_pacf(diff(y), title='PACF of differenced time series',ax=ax2)\nplt.xlabel('Lag')\nplt.ylabel('Partial ACF')\nplt.show()","d20afff4":"from statsmodels.tsa.arima_model import ARIMA\n\nmodel1 = ARIMA(y, order=(0,1,1))\nmodel1_fit = model1.fit(disp=0)\nprint(model1_fit.summary())\n\nresiduals = pd.DataFrame(model1_fit.resid)\n\nmodel1_sse = sum((residuals**2).values)\nmodel1_aic = model1_fit.aic\n","ce6a8bd8":"model2 = ARIMA(y, order=(0,1,2))\nmodel2_fit = model2.fit(disp=0)\nprint(model2_fit.summary())\n\nresiduals = pd.DataFrame(model2_fit.resid)\n\nmodel2_sse = sum((residuals**2).values)\nmodel2_aic = model2_fit.aic","90156e89":"model3 = ARIMA(y, order=(7,1,1))\nmodel3_fit = model3.fit(disp=0)\nprint(model3_fit.summary())\n\nresiduals = pd.DataFrame(model3_fit.resid)\n\nmodel3_sse = sum((residuals**2).values)\nmodel3_aic = model3_fit.aic","863d4f79":"model4 = ARIMA(y, order=(7,1,2))\nmodel4_fit = model4.fit(disp=0)\nprint(model4_fit.summary())\n\nresiduals = pd.DataFrame(model4_fit.resid)\n\nmodel4_sse = sum((residuals**2).values)\nmodel4_aic = model4_fit.aic","dbd99677":"results_df = pd.DataFrame({\n    'Arima(0,1,1)': [model1_aic, \"{:.3f}\".format(model1_sse[0])], \n    'Arima(0,1,2)': [model2_aic, \"{:.3f}\".format(model2_sse[0])],\n    'Arima(7,1,1)': [model3_aic, \"{:.3f}\".format(model3_sse[0])],\n    'Arima(7,1,2)': [model4_aic, \"{:.3f}\".format(model4_sse[0])]\n}, index=['AIC', 'SSE'])\n\nresults_df.head()","691525e7":"df_comp = df.copy()\ndf_comp.head()","3f791e6b":"df_comp.set_index('date', inplace=True)\ndf_comp = df_comp.asfreq('d')\ndf_comp.head()","b689ebdf":"# Import\nfrom statsmodels.tsa.seasonal import seasonal_decompose# Decompose time series into daily trend, seasonal, and residual components.\n\ndecomp = seasonal_decompose(df_comp, model = 'additive')# Plot the decomposed time series to interpret.\n\nfig, (ax0, ax1,ax2,ax3) = plt.subplots(4,1, figsize=(15,8));\ndecomp.observed.plot(ax=ax0, title='Our time series');\ndecomp.trend.plot(ax=ax1, title='Trend');\ndecomp.resid.plot(ax=ax2, title='Residual');\ndecomp.seasonal.plot(ax=ax3, title='Seasonality');","963bd358":"decomp = seasonal_decompose(df_comp, model = 'multiplicative')# Plot the decomposed time series to interpret.\n\nfig, (ax0, ax1,ax2,ax3) = plt.subplots(4,1, figsize=(15,8));\ndecomp.observed.plot(ax=ax0, title='Our time series');\ndecomp.trend.plot(ax=ax1, title='Trend');\ndecomp.resid.plot(ax=ax2, title='Residual');\ndecomp.seasonal.plot(ax=ax3, title='Seasonality');","bfee07b2":"import itertools\n\nq = [1,2]\np = [1,7]\nd = [0,1]\npdq = list(itertools.product(p, d, q))\nseasonal_pdq = [(x[0], x[1], x[2], 12) for x in list(itertools.product(p, d, q))]\nprint('Examples of parameter for SARIMA...')\nprint('SARIMAX: {} x {}'.format(pdq[1], seasonal_pdq[1]))\nprint('SARIMAX: {} x {}'.format(pdq[1], seasonal_pdq[2]))\nprint('SARIMAX: {} x {}'.format(pdq[2], seasonal_pdq[3]))\nprint('SARIMAX: {} x {}'.format(pdq[2], seasonal_pdq[4]))","3cd663e9":"from statsmodels.tsa.statespace.sarimax import SARIMAX\n\nrest_dict = {}\n\nfor param in pdq:\n    for param_seasonal in seasonal_pdq:\n        try:\n            mod = SARIMAX(diff(y),order=param,seasonal_order=param_seasonal)\n            results = mod.fit(maxiter=100, method='powell')\n#             print('ARIMA{}x{}12 - AIC:{}'.format(param,param_seasonal,results.aic)) \n            rest_dict[param] = {param_seasonal: results.aic}\n        except: \n            continue\nprint(rest_dict)","7998f852":"mod =  SARIMAX(diff(y),\n               order=(1, 0, 1),\n               seasonal_order=(7, 1, 2, 12))\n\nresults = mod.fit(maxiter=100, method='powell')\nprint(results.summary().tables[1])","a6c0caa6":"results.plot_diagnostics(figsize=(18, 8))\nplt.show()","cfd85149":"### Results visualization","dc6d4bdc":"#### ARIMA (0,1,1)","1efc9ae3":"### Time series Plot","af4c10b1":"#### ARIMA (7,1,1)","b026ed70":"- From the trend plot we can say there is an upward trend overal\n- From the seasonality plot we can say there is definitely a seasonality causing the female births to fluctuate over the period\n- We can see from the residual plot that there appears to be randomness in the data","6c8d21a9":"### Seasonal decomposition","bd27558c":"### SARIMA","87c47794":"### Best model","51517cc2":"- My insights are\n - Data is stationary and the AR parameters are chosen correctly\n - Needless to say, residual indeed is the difference between true and predicted value. If there are correlations between residuals there is information left. Thus, there is no correlation between residuals and we can say everything is fine","b8458695":"- ACF denotes that the order of moving average process of q\n  - ACF -> There are 1 or 2 significant lags \n- PACF dentoes that the order of autoregressive process of p\n  - PACF -> There are 7 significant lags ","b1f163d3":"### Differenced time series, to remove the trend\n- because ACF & PACF works with stationary time *series*","651412c5":"### Setting index & frequency for time series","2b960dfc":"#### ARIMA (0,1,2)","d89038a8":"- Due to parsimonious principle in time series, I choose this model {(1, 0, 1): {(7, 1, 2, 12)} as my best model","2e1b7028":"### ARIMA Model","d3b283cb":"#### Additive or multiplicative?","fe4da320":"- We can also say the same things for the multiplicative one, with some changes in the y-axis of seasonality and residual plots","949b6ba5":"### Ljung\u2013Box test, Correlation test","8307a6e5":"### Results comparision","6407fb20":"- Since all p-value numbers are significant we cannot reject the null hypothesis of no auto-correlation between the series, thus there is definitely an autocorrelation ","0da30541":"#### ARIMA (7,1,2)","344fb08a":"- Thus, it is better to stick with a smaller model Arima(0,1,2) \n- The fitted ARIMA model is:\n\\begin{align}\nX_{t} = X_{t-1} + 0.015 + Z_{t} - 0.8511 Z_{t-1} - 0.1113Z_{t-2} \\\\\n\\end{align}","6a8203d6":"### ACF & PACF"}}