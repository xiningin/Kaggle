{"cell_type":{"8814e24a":"code","af80112e":"code","aef5788b":"code","43cc69f2":"code","4c03db93":"code","764fa6c5":"code","0c186442":"code","d449ebad":"code","00e89588":"code","feb54e21":"code","f0ecfea9":"code","066f01ed":"code","8b476aa6":"code","a872a1d1":"code","89daa37c":"code","74d2ee70":"code","f3e75b5c":"code","52b780a0":"code","e21f6288":"code","9fc44224":"markdown","e58d91da":"markdown","06222238":"markdown","4befd02c":"markdown","772a610e":"markdown","cce439d7":"markdown","c2626d08":"markdown","08af9594":"markdown","84947c55":"markdown","d043eb7b":"markdown","68e0741e":"markdown","54fec2d0":"markdown","9ae470ac":"markdown","1468c7af":"markdown"},"source":{"8814e24a":"import pandas as pd\nimport seaborn as sns\nimport numpy as np\nimport matplotlib.pyplot as plt\n\n# Tools from sklearn\nfrom sklearn.model_selection import train_test_split\nfrom sklearn import preprocessing\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.metrics import plot_confusion_matrix\n\n# Models\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.ensemble import BaggingClassifier\nfrom xgboost import XGBClassifier\n\noriginal_data = pd.read_csv(\"..\/input\/stellar-classification-dataset-sdss17\/star_classification.csv\")\noriginal_data\n\nmodels = []\n\ndataset, test_dataset = train_test_split(original_data, test_size=0.05, random_state=100)\n\n# test_dataset will not be treated UNDER NO CIRCUMSTANCE. Only we are going to use to verify final model accuracy\n\ndef plot_box_plots(dataset, x, ys, figsize = (20, 15)):\n    fig, axes = plt.subplots(1, len(ys), figsize=figsize)\n    fig.suptitle('Spectral Characteristics')\n\n    for index in range(len(ys)):\n        sns.boxplot(ax=axes[index], data=dataset, x='class', hue='class', y=ys[index])\n        \ndef select_best_model_with_grid_search(grid, estimator, X_train, Y_train):\n    grid_search = GridSearchCV(estimator=estimator, param_grid=grid, scoring='accuracy', verbose=5)\n    grid_result = grid_search.fit(X_train, Y_train)\n    print(\"Best: %f using %s\" % (grid_result.best_score_, grid_result.best_params_))\n    return grid_result.best_estimator_\n\ndataset","af80112e":"predictor_variables = [\"u\", \"g\", \"r\", \"i\", \"z\", \"redshift\"]\nresponse_variables = [\"class\"]","aef5788b":"plot_box_plots(dataset, \"class\", predictor_variables,figsize=(35,10))","43cc69f2":"outlier = dataset.query('u < 0 or g < 0 or r < 0 or i < 0 or z < 0')\noutlier","4c03db93":"int(outlier.loc[79543, 'obj_ID'])","764fa6c5":"dataset = dataset.drop(79543)\ndataset","0c186442":"plot_box_plots(dataset, \"class\", predictor_variables, figsize=(35,10))","d449ebad":"X = dataset[predictor_variables]\nY = dataset[response_variables]\n\nX_train, X_validation, Y_train, Y_validation = train_test_split(X, Y, test_size=0.2)\nY_train = np.ravel(Y_train)\nY_validation = np.ravel(Y_validation)","00e89588":"#Fast Analysis\nmodel = LogisticRegression(solver='liblinear').fit(X_train, Y_train)\nprint(\"Validation score:\", model.score(X_validation, Y_validation))\nplot_confusion_matrix(model, X_validation, Y_validation, normalize='all')","feb54e21":"models.append(model)","f0ecfea9":"#Fast Analysis\nmodel = KNeighborsClassifier().fit(X_train, Y_train)\nprint(\"Validation score:\", model.score(X_validation, Y_validation))\nplot_confusion_matrix(model, X_validation, Y_validation, normalize='all')","066f01ed":"models.append(select_best_model_with_grid_search({\"n_neighbors\": list(range(5,50, 5))}, KNeighborsClassifier(), X_train, Y_train))","8b476aa6":"#Fast Analysis\nmodel = BaggingClassifier().fit(X_train, Y_train)\nprint(\"Validation score:\", model.score(X_validation, Y_validation))\nplot_confusion_matrix(model, X_validation, Y_validation, normalize='all')","a872a1d1":"models.append(select_best_model_with_grid_search({\"n_estimators\": [3,5,7,9,11],\"max_samples\": [0.2,0.4,0.6,0.8,1.0]}, BaggingClassifier(), X_train, Y_train))\n","89daa37c":"#Fast Analysis\nmodel = XGBClassifier().fit(X_train, Y_train)\nprint(\"Validation score:\", model.score(X_validation, Y_validation))\nplot_confusion_matrix(model, X_validation, Y_validation, normalize='all')","74d2ee70":"model = XGBClassifier(n_estimators=1000, learning_rate=0.5).fit(X_train, Y_train, early_stopping_rounds=5, eval_set=[(X_validation, Y_validation)])\nprint(\"Validation score:\", model.score(X_validation, Y_validation))\nplot_confusion_matrix(model, X_validation, Y_validation, normalize='all')","f3e75b5c":"models.append(model)","52b780a0":"best_model = None\nbest_score = None\n\nfor model in models:\n    model_score = model.score(X_validation, Y_validation)\n    print(model, \"validation score:\", model_score)\n    if best_model is None or best_score < model_score:\n        best_model = model\n        best_score = model_score\n\nprint(\"Model selected\")\nprint(model)","e21f6288":"X_test = test_dataset[predictor_variables]\nY_test = test_dataset[response_variables]\n\nbest_model.score(X_test, Y_test)","9fc44224":"## XGboost","e58d91da":"## Bagging","06222238":"# EDA\nLet's begin with a exploratory data analysis. If we find some special outliers we are going to work on them and try to get some conclusions of the dataset that we have. Spectral Characteristics are related with the wavelengths that the spectograph detected. In this case, we have 'u', 'g', 'r', 'i', and 'z'. All of them correspond to a specific color. Also, we have the 'redshift' parameter. In physics, a **redshift** is an increase in the wavelength, and corresponding decrease in the frequency and photon energy, of electromagnetic radiation (such as light). The opposite change, a decrease in wavelength and simultaneous increase in frequency and energy, is known as a negative redshift, or blueshift. The terms derive from the colours red and blue which form the extremes of the visible light spectrum.\n\n<div style=\"text-align:center\"><img width=\"200\" src=\"https:\/\/upload.wikimedia.org\/wikipedia\/commons\/thumb\/6\/6a\/Redshift.svg\/340px-Redshift.svg.png\" alt=\"Wien\u2019s Displacement Law\"><\/div>\n\nIf you explore the website I passed before to interact with the sky map, other features like 'run_ID', 'rerun_ID' or 'cam_co' are not spectral characteristics, they are part of the experiments they carried on to take all those pictures. So, we remove them because it add 'noise' to our models.","4befd02c":"The redshift plot is the *weirdest*. There are a lot of outliers and also no important data in 'star' samples. It seems to be so characteristic the distribution in every class of this characteristic. We are going to take in account.","772a610e":"## K-Nearest Neighbor","cce439d7":"It's weird, isn't? It seems to be that some data collected from the original dataset reached some mininum (around -9999) and they didn't reach further. I would like to know if this is result of bad data collection or it means something. First, we get the outlier.","c2626d08":"I would like to visualize data. At the beggining of the notebook, I write some functions that are useful for this. here we have some box plots:","08af9594":"# Models","84947c55":"I am going to verify if this is not a mistake. The original data of that sample is here: https:\/\/skyserver.sdss.org\/dr17\/VisualTools\/quickobj?plate=3314&mjd=54970&fiber=162. It is not a reliable sample. Remove it.","d043eb7b":"## Model Selection","68e0741e":"# Domain Understanding\n\nBefore we get into fun, understanding of astronomy and physics basic principles is important and (under my consideration) a must. Of course, we have to do it briefly and we are not astronomy experts.\n\nAs a body gets hotter, its peak radiated wavelength gets smaller. Wien\u2019s Displacement Law illustrates this as follows:\n\n<div style=\"text-align:center\"><img width=\"200\" src=\"https:\/\/latex.codecogs.com\/svg.image?%5Clambda_%7Bpeak%7D%20=%20%5Cfrac%7B0.0028976%7D%7BT%7D\" alt=\"Wien\u2019s Displacement Law\"><\/div>\n\nWhere ![equation](https:\/\/latex.codecogs.com\/svg.image?%5Clambda_%7Bpeak%7D) is in meters and ![equation](https:\/\/latex.codecogs.com\/svg.image?T) is in degrees Kelvin.\n\nWhy do we care this law? This theory has practical relevance for us because the intensity profile of the spectrum provides information about the temperature of the radiator! The radiation distribution of different stars shows bell-shaped curves, whose peak intensity shifts to shorter wavelength, respectively higher frequency with increasing temperature (Planck's radiation law). In this way we could get information of stellar bodies and, at the same time, find relationships between them.\n\nWe can use the Wien displacement law to measure the temperature of stars by looking at the wavelength at which their spectrum peaks. Of course, this requires using a spectrograph (instrument used to measure properties of light over a specific portion of the electromagnetic spectrum), but there is an easier way.  Astronomers have developed and refined a precise color filter scheme that can be used to quickly form a measure of temperature of a star.  Star color magnitudes are measured through these filters (the U, B, and V filter transmission curves are shown below), and the star color index (just the difference of two color magnitudes) can be used to determine the star's color temperature.\n\n<div style=\"text-align:center\"><img width=\"500\" src=\"https:\/\/web.njit.edu\/~gary\/321\/UBV_filters.gif\" alt=\"Wien\u2019s Displacement Law\"><\/div>\n\nFor example, look at this picture (or interact with this [link](http:\/\/skyserver.sdss.org\/dr17\/VisualTools\/navi?ra=256.157116458609&dec=60.5851296110757&scale=0.2)):\n\n<div style=\"text-align:center\"><img width=\"1000\" src=\"https:\/\/i.ibb.co\/0V2hq0t\/Screenshot-from-2022-01-16-23-00-33.png\" alt=\"Wien\u2019s Displacement Law\"><\/div>\n\n\nThis is a galaxy. The objective of this dataset is to, giving spectral characteristics, predict if the image is a quasar, galaxy or a star.\n\nIf you want to know more, I recommend the following sources:\n* [Astrophysics II: Blackbody Radiation and Quantization of Energy by Prof. Dale E. Gary](https:\/\/web.njit.edu\/~gary\/321\/Lecture2.html)\n* [Analysis and Interpretation of Astronomical Spectra](https:\/\/www.unitronitalia.com\/prodotti\/analysis-and-interpretation-of-astronomical-sp.pdf)","54fec2d0":"## Logistic Regression","9ae470ac":"It worked quite good. Maybe we may do better. We are going to use the 'early_stopping_rounds' to get the correct model closes to our expected validation score.","1468c7af":"# Future Work\n* Dataset comes from images. I think is a good idea to train Convolutional Neural Networks to classify stellar bodies.\n* More complex models should be trained."}}