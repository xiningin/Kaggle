{"cell_type":{"d7c2b3e4":"code","1dd7d458":"code","ed15899c":"code","56e3c8db":"code","f8dd219b":"code","cc5c399c":"code","e3ae2a50":"code","6e230204":"code","b23c1f91":"code","a7dd1b24":"code","e6f47f3e":"code","6dec5cca":"code","fd2cc4e3":"code","3956b68d":"code","e3d89aaf":"code","05345f05":"code","a21d8f7f":"code","e61090f8":"code","48e36c60":"code","b1371710":"code","473ac351":"code","e44f133d":"code","b4587447":"code","17ce6769":"code","e69ec5f0":"code","b551213c":"code","b2cdbc57":"code","068ce25f":"code","6ebf7845":"code","56526b98":"code","979e9046":"code","db9bb9d1":"code","e9506305":"code","a84ec151":"code","03b0704b":"code","ee1c3754":"code","a1f850f5":"code","de29fd5a":"code","602b4d4b":"code","7ce08a21":"code","11322353":"code","ab962221":"code","6a94c489":"code","04ec9b9a":"code","6115d915":"code","6884f3e6":"code","05aa1413":"code","a4a0cdbe":"code","ef5bf2fd":"code","dbc546c5":"code","a4f68e7c":"code","73139a7b":"code","2b659879":"code","f95c8995":"code","7a2f92ab":"code","72bc0183":"code","1491ce86":"code","ac4f5994":"code","237dfa9a":"code","ba2d74d0":"code","58323cd8":"code","0d999e36":"code","f805e1b1":"code","cbce91eb":"code","295d1bc9":"code","37cefec8":"code","c56af4a1":"code","4eb2bac0":"code","d921fb19":"code","3e571732":"code","89c199fb":"code","58bec7b8":"code","c85c530f":"code","2e66edbe":"code","da4b0a42":"code","4471f250":"code","d55c31c6":"code","b292d732":"code","e1716515":"code","48d4b4f5":"code","d3e40116":"code","b9fd13f7":"code","a89636eb":"code","2ab79e51":"code","5e2b9d1a":"code","6d889a43":"code","bc69608d":"code","1831a238":"code","9eca0796":"code","9a88ed47":"code","27b92320":"code","cba9f148":"code","bbda9961":"code","eca3de0b":"code","0ffbc4d9":"code","1b602ce3":"code","a70faa7e":"code","c6247698":"code","b5b152ff":"code","5d202ea5":"code","c60fc04c":"code","1de88f35":"code","0ad90b01":"code","d3943804":"code","823344ab":"code","21cf76f1":"markdown","c857b7a2":"markdown","1267087d":"markdown","dff8a05c":"markdown","0f30cb7e":"markdown","9737ab09":"markdown","ddad23dd":"markdown","d7981ca8":"markdown","4dce2815":"markdown","efa9b5d5":"markdown","33a318a5":"markdown","5dea26a9":"markdown","c8d0d038":"markdown","df5c83d8":"markdown","5f8b81d3":"markdown","04558d5d":"markdown","58231a7f":"markdown","280f3706":"markdown","f1ac53a5":"markdown","fb5c44d9":"markdown","331e172b":"markdown","cc6f4e01":"markdown","7c2947e7":"markdown","7b665f57":"markdown","2ed1ee15":"markdown","000f5de9":"markdown","4ba865fc":"markdown","8478f825":"markdown","14064986":"markdown","942b4a4d":"markdown","7dc14ba2":"markdown","7b9d0e88":"markdown","9ebdd3c2":"markdown","66a1671f":"markdown","d27cc00a":"markdown","16aa768d":"markdown","f13551a8":"markdown","6c725c90":"markdown","28b50593":"markdown","ce582b84":"markdown","dccc33cd":"markdown","eee5affc":"markdown"},"source":{"d7c2b3e4":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nfrom sklearn.impute import SimpleImputer, KNNImputer\nfrom sklearn.ensemble import RandomForestRegressor, GradientBoostingRegressor, ExtraTreesRegressor\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nfrom catboost import CatBoostRegressor\nfrom lightgbm import LGBMRegressor\nfrom sklearn.ensemble import RandomForestRegressor, GradientBoostingRegressor\nfrom sklearn.linear_model import LinearRegression, Ridge, Lasso, ElasticNet\nfrom sklearn.model_selection import GridSearchCV, cross_val_score\nfrom sklearn.neighbors import KNeighborsRegressor\nfrom sklearn.svm import SVR\nfrom sklearn.tree import DecisionTreeRegressor\nfrom xgboost import XGBRegressor\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","1dd7d458":"train = pd.read_csv(\"..\/input\/house-prices-advanced-regression-techniques\/train.csv\")\ntest = pd.read_csv(\"..\/input\/house-prices-advanced-regression-techniques\/test.csv\")\nprint(train.shape)\nprint(test.shape)","ed15899c":"# N\u00fcmerik de\u011fi\u015fkenlerin se\u00e7ilmesi\nnum_cols = [col for col in train.columns if train[col].dtype in ['int64', 'float64']]\n# Id & SalePrice de\u011fi\u015fkenlerinin \u00e7\u0131kar\u0131lmas\u0131\nnum_cols.remove('Id')\nnum_cols.remove('SalePrice')\n# Num_cols u dataframe e \u00e7evirme\nnum_analysis = train[num_cols].copy()\n# Eksik g\u00f6zlemlerin doldurulmas\u0131\nfor col in num_cols:\n    if num_analysis[col].isnull().sum() > 0:\n        num_analysis[col] = SimpleImputer(strategy='median').fit_transform(num_analysis[col].values.reshape(-1,1))\n        \n# Model\n# ExtraTressRegressor ?\nclf = ExtraTreesRegressor(random_state=42)\netreg_model = clf.fit(num_analysis, train.SalePrice)\n","56e3c8db":"def plot_importance(model, features, num=len(num_cols), save=False):\n    feature_imp = pd.DataFrame({'Value': model.feature_importances_, 'Feature': features})\n    plt.figure(figsize=(16, 10))\n    sns.set(font_scale=1)\n    sns.barplot(x=\"Value\", y=\"Feature\", data=feature_imp.sort_values(by=\"Value\",\n                                                                     ascending=False)[0:num])\n    plt.title('Features')\n    plt.tight_layout()\n    plt.show()\n    if save:\n        plt.savefig('importances.png')\n\nplot_importance(etreg_model, num_cols)\n","f8dd219b":"plt.figure(figsize=(8,8))\nplt.title('\u00d6nemli de\u011fi\u015fkenlerin korelasyon matrisi')\ncols =['OverallQual', 'GarageCars', 'GrLivArea', 'YearBuilt', \n       'FullBath', '1stFlrSF', 'TotalBsmtSF', 'GarageArea','Fireplaces','GarageYrBlt','SalePrice']\nsns.heatmap(train[cols].corr(),annot=True,square=True);\n","cc5c399c":"# https:\/\/www.kaggle.com\/mviola\/house-prices-eda-lasso-lightgbm-0-11635 \ndef plot_numerical(col, discrete=False):\n    if discrete:\n        fig, ax = plt.subplots(1,2,figsize=(12,6))\n        sns.stripplot(x=col, y='SalePrice', data=train, ax=ax[0])\n        sns.countplot(train[col], ax=ax[1])\n        fig.suptitle(str(col) + ' analysis')\n    else:\n        fig, ax = plt.subplots(1,2,figsize=(12,6))\n        sns.scatterplot(x=col, y='SalePrice', data=train, ax=ax[0])\n        sns.distplot(train[col], kde=False, ax=ax[1])\n        fig.suptitle(str(col) + ' analysis')\n\n\nprint('Plot functions are ready to use')","e3ae2a50":"# cols =['OverallQual', 'GarageCars', 'GrLivArea', 'YearBuilt', \n       #'FullBath', '1stFlrSF', 'TotalBsmtSF', 'GarageArea','Fireplaces','GarageYrBlt','SalePrice']\nplot_numerical('OverallQual',discrete=True)","6e230204":"plot_numerical('GarageCars',discrete=True)","b23c1f91":"plot_numerical('GrLivArea')","a7dd1b24":"plot_numerical('YearBuilt')","e6f47f3e":"plot_numerical('FullBath',discrete=True)\n# FullBath: \u00dcst katlardaki tam banyolar","6dec5cca":"plot_numerical('1stFlrSF')\n# 1stFlrSF : 1.kat metrekare alan\u0131","fd2cc4e3":"plot_numerical('TotalBsmtSF')\n# TotalBsmtSF : Kare ayakl\u0131 duvar kaplama alan\u0131","3956b68d":"plot_numerical('GarageArea')","e3d89aaf":"plot_numerical('Fireplaces',discrete=True)","05345f05":"# Kategorik de\u011fi\u015fkenlerin se\u00e7ilmesi\ncat_features = [col for col in train.columns if train[col].dtype =='object']\n\ncat_analysis = train[cat_features].copy()\n\nfor col in cat_analysis:\n    if cat_analysis[col].isnull().sum() > 0:\n        cat_analysis[col] = SimpleImputer(strategy='constant').fit_transform(cat_analysis[col].values.reshape(-1,1))\n\n# One-Hot Encoding\ndef one_hot_encoder(dataframe, categorical_cols, drop_first=False):\n    dataframe = pd.get_dummies(dataframe, columns=categorical_cols, drop_first=drop_first)\n    return dataframe\ncat_analysis = one_hot_encoder(cat_analysis,cat_features)\n\n# Model \nclf = ExtraTreesRegressor(random_state=42)\nh = clf.fit(cat_analysis, train.SalePrice)\n","a21d8f7f":"def plot_importance(model, features, save=False):\n    feature_imp = pd.DataFrame({'Value': model.feature_importances_, 'Feature': features.columns})\n    plt.figure(figsize=(16, 10))\n    sns.set(font_scale=1)\n    sns.barplot(x=\"Value\", y=\"Feature\", data=feature_imp.sort_values(by=\"Value\",\n                                                                     ascending=False)[0:20])\n    plt.title('Features')\n    plt.tight_layout()\n    plt.show()\n    if save:\n        plt.savefig('importances.png')\n\nplot_importance(h, cat_analysis)\n","e61090f8":"cat_analysis[\"SalePrice\"] = train[\"SalePrice\"]\n","48e36c60":"def cat_plot(col1,col2):\n    # t\u00fcm veri\n    fig, ax = plt.subplots(1,2,figsize=(12,6), sharey=True)\n    sns.stripplot(x=col1, y='SalePrice', data=train, ax=ax[0])\n    sns.boxplot(x=col1, y='SalePrice', data=train, ax=ax[1])\n    ax[0].set_xticklabels(ax[0].get_xticklabels(), rotation=90)\n    ax[1].set_xticklabels(ax[1].get_xticklabels(), rotation=90)\n    fig.suptitle(str(col1) + ' analysis')\n    \n    # one-hot encoding\n    fig, ax = plt.subplots(1,2,figsize=(12,6), sharey=True)\n    sns.stripplot(x=col2, y='SalePrice', data=cat_analysis, ax=ax[0])\n    sns.boxplot(x=col2, y='SalePrice', data=cat_analysis, ax=ax[1])\n    fig.suptitle(str(col2) + ' analysis')\n\n","b1371710":"cat_plot(\"ExterQual\",\"ExterQual_TA\")","473ac351":"cat_plot(\"BsmtQual\",\"BsmtQual_Ex\")","e44f133d":"cat_plot(\"FireplaceQu\",\"FireplaceQu_missing_value\")","b4587447":"cat_plot(\"Neighborhood\",\"Neighborhood_NoRidge\")","17ce6769":"# train.drop('Id', axis=1, inplace=True)\n# test.drop('Id', axis=1, inplace=True)","e69ec5f0":"# Train ve test dataler\u0131n\u0131 birle\u015ftirme\ndf = pd.concat([train, test]).reset_index(drop=True)\nprint(df.shape)","b551213c":"def missing_values_table(dataframe, na_name=False):\n    na_columns = [col for col in dataframe.columns if dataframe[col].isnull().sum() > 0]\n    n_miss = dataframe[na_columns].isnull().sum().sort_values(ascending=False)\n    ratio = (dataframe[na_columns].isnull().sum() \/ dataframe.shape[0] * 100).sort_values(ascending=False)\n    missing_df = pd.concat([n_miss, np.round(ratio, 2)], axis=1, keys=['n_miss', 'ratio'])\n    print(missing_df, end=\"\\n\")\n    if na_name:\n        return na_columns\n    \nmissing_values_table(df)","b2cdbc57":"# Baz\u0131 de\u011fi\u015fkenledeki NAN olanlar\u0131 eksiklik olarak g\u00f6r\u00fcyor ama asl\u0131nda bunlar\n# eksiklik de\u011fil yoklu\u011fu ifade ediyor.Bu nedenle onlar\u0131 None olarak de\u011fi\u015ftirece\u011fim.\n\nnone_cols = ['Alley', 'PoolQC', 'MiscFeature', 'Fence', 'FireplaceQu', 'GarageType',\n             'GarageFinish', 'GarageQual', 'GarageCond', 'BsmtQual', 'BsmtCond',\n             'BsmtExposure', 'BsmtFinType1', 'BsmtFinType2', 'MasVnrType']\n\n\n# Say\u0131sal de\u011ferlerdeki Nan olanlar asl\u0131nda yokluk anlam\u0131nda oldu\u011fu i\u00e7in onlar\u0131 da 0 \n# ile de\u011fi\u015ftirece\u011fim.\n\nzero_cols = ['BsmtFinSF1', 'BsmtFinSF2', 'BsmtUnfSF', 'TotalBsmtSF', 'BsmtFullBath',\n             'BsmtHalfBath', 'GarageYrBlt', 'GarageArea', 'GarageCars', 'MasVnrArea']\n\n# Di\u011fer de\u011fi\u015fkenlerde eksiklik az oldu\u011fu i\u00e7in mod ile dolduraca\u011f\u0131m.\nfreq_cols = ['Electrical', 'Exterior1st', 'Exterior2nd', 'Functional', 'KitchenQual',\n             'SaleType', 'Utilities']\n\n\nfor col in zero_cols:\n    df[col].replace(np.nan, 0, inplace=True)\n\nfor col in none_cols:\n    df[col].replace(np.nan, 'None', inplace=True)\n    \nfor col in freq_cols:\n    df[col].replace(np.nan, df[col].mode()[0], inplace=True)","068ce25f":"missing_values_table(df)","6ebf7845":"# MsZoning(genel imar s\u0131n\u0131fland\u0131rmas\u0131) de\u011fi\u015fkenindeki bo\u015f de\u011ferleri \n# MSSubClassa(in\u015faat s\u0131n\u0131f\u0131) g\u00f6re dolduraca\u011f\u0131m.\n\ndf['MSZoning'] = df.groupby('MSSubClass')['MSZoning'].apply(\n    lambda x: x.fillna(x.mode()[0]))\n\n# LotFrontage m\u00fclkiyetin cadde ile ba\u011flant\u0131s\u0131n\u0131 g\u00f6steren bir de\u011fi\u015fken, her mahallenin \n# cadde ba\u011flant\u0131s\u0131n\u0131n birbirine benzeyebilece\u011finden bunu Neighborhood'a g\u00f6re dolduraca\u011f\u0131m.\n\ndf['LotFrontage'] = df.groupby(\n    ['Neighborhood'])['LotFrontage'].apply(lambda x: x.fillna(x.median()))\n\nmissing_values_table(df)\n","56526b98":"# Say\u0131sal de\u011fi\u015fken olup asl\u0131nda kategorik de\u011fi\u015fken olmas\u0131 gerekenleri d\u00fczeltme\n\ndf['MSSubClass'] = df['MSSubClass'].astype(str)\ndf['YrSold'] = df['YrSold'].astype(str)\ndf['MoSold'] = df['MoSold'].astype(str)\ndf.info()","979e9046":"df[\"LotShape\"].value_counts()","db9bb9d1":"# LotShape(\u0130mar \u015fekli) de\u011fi\u015fkeninin IR2 ve IR3 alt s\u0131n\u0131flar\u0131n\u0131n frekans\u0131 d\u00fc\u015f\u00fck.\n# Bu nedenle bunlar\u0131 IR1 e atayaca\u011f\u0131m.\n\ndf.loc[(df[\"LotShape\"] == \"IR2\"), \"LotShape\"] = \"IR1\"\ndf.loc[(df[\"LotShape\"] == \"IR3\"), \"LotShape\"] = \"IR1\"\ndf[\"LotShape\"].value_counts()","e9506305":"df[\"ExterQual\"].value_counts()","a84ec151":"# S\u0131n\u0131flar aras\u0131nda dengesizlik oldu\u011fu i\u00e7in Ex ve Gd(en iyi kaliteli iki s\u0131n\u0131f) birle\u015ftirdik.\n# TA ve Fa (orta kaliteli s\u0131n\u0131f) birle\u015ftirdik\n\ndf.loc[df[\"ExterQual\"]==\"Ex\",\"ExterQual\"]=2\ndf.loc[df[\"ExterQual\"]==\"Gd\",\"ExterQual\"]=2\ndf.loc[df[\"ExterQual\"]==\"TA\",\"ExterQual\"]=1\ndf.loc[df[\"ExterQual\"]==\"Fa\",\"ExterQual\"]=1\ndf[\"ExterQual\"]= df[\"ExterQual\"].astype(\"int\")\n\ndf[\"ExterQual\"].value_counts()","03b0704b":"df[\"BsmtQual\"].value_counts()","ee1c3754":"# S\u0131n\u0131flar aras\u0131nda dengesizlik oldu\u011fu i\u00e7in Ex ve Gd(90 ile 100 inches aras\u0131) birle\u015ftirdik.\n# TA ve Fa (70 ile 89 inches aras\u0131) birle\u015ftirdik.\n# None da yokluk oldu\u011fu i\u00e7in dokunmad\u0131k.\n\ndf.loc[df[\"BsmtQual\"]==\"Ex\",\"BsmtQual\"]=2\ndf.loc[df[\"BsmtQual\"]==\"Gd\",\"BsmtQual\"]=2\ndf.loc[df[\"BsmtQual\"]==\"TA\",\"BsmtQual\"]=1\ndf.loc[df[\"BsmtQual\"]==\"Fa\",\"BsmtQual\"]=1\ndf.loc[df[\"BsmtQual\"]==\"None\",\"BsmtQual\"]=0\ndf[\"BsmtQual\"]= df[\"BsmtQual\"].astype(\"int\")\n\ndf[\"BsmtQual\"].value_counts()","a1f850f5":"df[\"KitchenQual\"].value_counts()","de29fd5a":"df.loc[df[\"KitchenQual\"]==\"Ex\",\"KitchenQual\"]=2\ndf.loc[df[\"KitchenQual\"]==\"Gd\",\"KitchenQual\"]=2\ndf.loc[df[\"KitchenQual\"]==\"TA\",\"KitchenQual\"]=1\ndf.loc[df[\"KitchenQual\"]==\"Fa\",\"KitchenQual\"]=1\ndf[\"KitchenQual\"]= df[\"KitchenQual\"].astype(\"int\")\ndf[\"KitchenQual\"].value_counts()","602b4d4b":"df.groupby(\"Neighborhood\").agg({\"SalePrice\":\"mean\"}).sort_values(by=\"SalePrice\", ascending=False)","7ce08a21":"# https:\/\/www.kaggle.com\/oguzerdo\/top-1-house-pricing-project-regression-models\n# Target de\u011fi\u015fkeninin ortalamas\u0131na g\u00f6re birbirine benzeyen il\u00e7eleri birle\u015ftirdik.\n\nneigh_map = {'MeadowV': 1,'IDOTRR': 1,'BrDale': 1,'BrkSide': 2,'OldTown': 2,'Edwards': 2,\n             'Sawyer': 3,'Blueste': 3,'SWISU': 3,'NPkVill': 3,'NAmes': 3,'Mitchel': 4,\n             'SawyerW': 5,'NWAmes': 5,'Gilbert': 5,'Blmngtn': 5,'CollgCr': 5,\n             'ClearCr': 6,'Crawfor': 6,'Veenker': 7,'Somerst': 7,'Timber': 8,\n             'StoneBr': 9,'NridgHt': 10,'NoRidge': 10}\n\ndf['Neighborhood'] = df['Neighborhood'].map(neigh_map).astype('int')","11322353":"# Derecelendirme i\u00e7eren de\u011fi\u015fkenleri ordinal yap\u0131ya getirece\u011fim.\n\next_map = {'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5}\ndf['ExterCond'] = df['ExterCond'].map(ext_map).astype('int')\n\nbsm_map = {'None': 0, 'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5}\n\ndf['BsmtCond'] = df['BsmtCond'].map(bsm_map).astype('int')\n\nbsmf_map = {'None': 0,'Unf': 1,'LwQ': 2,'Rec': 3,'BLQ': 4,'ALQ': 5,'GLQ': 6}\ndf['BsmtFinType1'] = df['BsmtFinType1'].map(bsmf_map).astype('int')\ndf['BsmtFinType2'] = df['BsmtFinType2'].map(bsmf_map).astype('int')\n\nheat_map = {'Po': 1, 'Fa': 2, 'TA': 3, 'Gd': 4, 'Ex': 5}\ndf['HeatingQC'] = df['HeatingQC'].map(heat_map).astype('int')\n\ndf['FireplaceQu'] = df['FireplaceQu'].map(bsm_map).astype('int')\ndf['GarageCond'] = df['GarageCond'].map(bsm_map).astype('int')\ndf['GarageQual'] = df['GarageQual'].map(bsm_map).astype('int')\n","ab962221":"def rare_analyser(dataframe, target, rare_perc):\n    \n    rare_cols = [col for col in dataframe.columns if len(dataframe[col].value_counts()) <= 20\n                    and (dataframe[col].value_counts() \/ len(dataframe) < rare_perc).sum() > 1]\n    \n    for col in rare_cols:\n        print(col, \":\", len(dataframe[col].value_counts()))\n        print(pd.DataFrame({\"COUNT\": dataframe[col].value_counts(),\n                            \"RATIO\": dataframe[col].value_counts() \/ len(dataframe),\n                            \"TARGET_MEAN\": dataframe.groupby(col)[target].mean()}), end=\"\\n\\n\\n\")\n        \nrare_analyser(df, \"SalePrice\", 0.01)","6a94c489":"df[\"GarageCars\"].value_counts()","04ec9b9a":"df[\"LotConfig\"].value_counts()","6115d915":"df.loc[(df[\"LotConfig\"]==\"Inside\"),\"LotConfig\"] = 1\ndf.loc[(df[\"LotConfig\"]==\"FR2\"),\"LotConfig\"] = 1\ndf.loc[(df[\"LotConfig\"]==\"Corner\"),\"LotConfig\"] = 1\n\ndf.loc[(df[\"LotConfig\"]==\"FR3\"),\"LotConfig\"] = 2\ndf.loc[(df[\"LotConfig\"]==\"CulDSac\"),\"LotConfig\"] = 2\ndf[\"LotConfig\"].value_counts()\n","6884f3e6":"df[\"LandSlope\"].value_counts()","05aa1413":"df.loc[df[\"LandSlope\"] == \"Gtl\", \"LandSlope\"] = 1\ndf.loc[df[\"LandSlope\"] == \"Sev\", \"LandSlope\"] = 2\ndf.loc[df[\"LandSlope\"] == \"Mod\", \"LandSlope\"] = 2\ndf[\"LandSlope\"]= df[\"LandSlope\"].astype(\"int\")\ndf[\"LandSlope\"].value_counts()","a4a0cdbe":"df[\"OverallQual\"].value_counts()","ef5bf2fd":"df.loc[df[\"OverallQual\"] == 1, \"OverallQual\"] = 1\ndf.loc[df[\"OverallQual\"] == 2, \"OverallQual\"] = 1\ndf.loc[df[\"OverallQual\"] == 3, \"OverallQual\"] = 1\ndf.loc[df[\"OverallQual\"] == 4, \"OverallQual\"] = 2\ndf.loc[df[\"OverallQual\"] == 5, \"OverallQual\"] = 3\ndf.loc[df[\"OverallQual\"] == 6, \"OverallQual\"] = 4\ndf.loc[df[\"OverallQual\"] == 7, \"OverallQual\"] = 5\ndf.loc[df[\"OverallQual\"] == 8, \"OverallQual\"] = 6\ndf.loc[df[\"OverallQual\"] == 9, \"OverallQual\"] = 7\ndf.loc[df[\"OverallQual\"] == 10, \"OverallQual\"] = 8\ndf[\"OverallQual\"].value_counts()","dbc546c5":"df[\"MasVnrType\"].value_counts()","a4f68e7c":"df.loc[df[\"MasVnrType\"] == \"BrkCmn\" , \"MasVnrType\"] = \"None\" \ndf[\"MasVnrType\"].value_counts()","73139a7b":"df[\"Foundation\"].value_counts()","2b659879":"df.loc[df[\"Foundation\"] == \"Stone\", \"Foundation\"] = \"BrkTil\"\ndf.loc[df[\"Foundation\"] == \"Wood\", \"Foundation\"] = \"CBlock\"\ndf[\"Foundation\"].value_counts()","f95c8995":"df[\"Fence\"].value_counts()","7a2f92ab":"df.loc[df[\"Fence\"] == \"MnWw\", \"Fence\"] = \"MnPrv\"\ndf.loc[df[\"Fence\"] == \"GdWo\", \"Fence\"] = \"MnPrv\"\ndf[\"Fence\"].value_counts()","72bc0183":"# Total banyo say\u0131s\u0131\ndf[\"TotalBath_NEW\"] = df['BsmtFullBath'] + df['BsmtHalfBath'] * 0.5 + df['FullBath'] + df['HalfBath'] * 0.5\n\n# Toplam Kat Say\u0131s\u0131\ndf['TotalSF_NEW'] = (df['BsmtFinSF1'] + df['BsmtFinSF2'] + df['1stFlrSF'] + df['2ndFlrSF'])\n\n# Toplam Veranda Alan\u0131\ndf['TotalPorchSF_NEW'] = (df['OpenPorchSF'] + df['3SsnPorch'] +df['EnclosedPorch'] +df['ScreenPorch'] + df['WoodDeckSF'])\n\n# Kaliteleriyle ilgili de\u011fi\u015fkenler\ndf[\"OVER_QUAL_NEW\"] = df['OverallQual'] + df['OverallCond']\n\n# Bodrum kalitesi\ndf[\"BSMT_QUAL_NEW\"] = df['BsmtQual'] + df['BsmtCond']\n\n# D\u0131\u015f malzeme kalitesi\ndf[\"EX_QUAL_NEW\"] = df['ExterQual'] + df['ExterCond']\n\n# Garaj kalitesi\ndf['TotalGrgQual_NEW'] = (df['GarageQual'] + df['GarageCond'])\n\n# Genel kalite\ndf['TotalQual_NEW'] = df['OverallQual'] + df['EX_QUAL_NEW']  + df['TotalGrgQual_NEW'] + df['KitchenQual'] + df['HeatingQC']\n\n# Lux evler\ndf.loc[(df['Fireplaces'] > 0) & (df['GarageCars'] >= 3), \"LUX_NEW\"] = 1\ndf[\"LUX_NEW\"].fillna(0, inplace=True)\ndf[\"LUX_NEW\"] = df[\"LUX_NEW\"].astype(int)\n\n# Restore Edilmemi\u015f-Edilmemi\u015f\ndf.loc[df[\"YearBuilt\"] == df[\"YearRemodAdd\"], \"NEW_home\"] = 0\ndf.loc[df[\"YearBuilt\"] != df[\"YearRemodAdd\"], \"NEW_home\"] = 1\n\ndf['QualPorch_NEW'] = df['EX_QUAL_NEW'] * df['TotalPorchSF_NEW']\n\ndf['HasPool_NEW'] = df['PoolArea'].apply(lambda x: 1 if x > 0 else 0)\ndf['Has2ndFloor_NEW'] = df['2ndFlrSF'].apply(lambda x: 1 if x > 0 else 0)\ndf['HasGarage_NEW'] = df['TotalGrgQual_NEW'].apply(lambda x: 1 if x > 0 else 0)\ndf['HasFireplace_NEW'] = df['Fireplaces'].apply(lambda x: 1 if x > 0 else 0)\ndf['HasPorch_NEW'] = df['QualPorch_NEW'].apply(lambda x: 1 if x > 0 else 0)\n\n# Bah\u00e7e alan\u0131\ndf[\"Garden_NEW\"]=df[\"LotArea\"] - df[\"GrLivArea\"]","1491ce86":"def outlier_thresholds(dataframe, col_name, q1=0.25, q3=0.75):\n    quartile1 = dataframe[col_name].quantile(q1)\n    quartile3 = dataframe[col_name].quantile(q3)\n    interquantile_range = quartile3 - quartile1\n    up_limit = quartile3 + 1.5 * interquantile_range\n    low_limit = quartile1 - 1.5 * interquantile_range\n    return low_limit, up_limit\n\ndef replace_with_thresholds(dataframe, variable):\n    low_limit, up_limit = outlier_thresholds(dataframe, variable)\n    dataframe.loc[(dataframe[variable] < low_limit), variable] = low_limit\n    dataframe.loc[(dataframe[variable] > up_limit), variable] = up_limit\n    \ndef check_outlier(dataframe, col_name):\n    low_limit, up_limit = outlier_thresholds(dataframe, col_name)\n    if dataframe[(dataframe[col_name] > up_limit) | (dataframe[col_name] < low_limit)].any(axis=None):\n        return True\n    else:\n        return False\n","ac4f5994":"num_cols = [col for col in df.columns if df[col].dtype in ['int64', 'float64']]\nfor col in num_cols:\n    replace_with_thresholds(df, col)","237dfa9a":"for col in num_cols:\n    print(col, check_outlier(df, col))","ba2d74d0":"def grab_col_names(dataframe, cat_th=10, car_th=20):\n    # cat_cols, cat_but_car\n    cat_cols = [col for col in dataframe.columns if dataframe[col].dtypes == \"O\"]\n    num_but_cat = [col for col in dataframe.columns if dataframe[col].nunique() < cat_th and\n                   dataframe[col].dtypes != \"O\"]\n    cat_but_car = [col for col in dataframe.columns if dataframe[col].nunique() > car_th and\n                   dataframe[col].dtypes == \"O\"]\n    cat_cols = cat_cols + num_but_cat\n    cat_cols = [col for col in cat_cols if col not in cat_but_car]\n\n    # num_cols\n    num_cols = [col for col in dataframe.columns if dataframe[col].dtypes != \"O\"]\n    num_cols = [col for col in num_cols if col not in num_but_cat]\n\n    print(f\"Observations: {dataframe.shape[0]}\")\n    print(f\"Variables: {dataframe.shape[1]}\")\n    print(f'cat_cols: {len(cat_cols)}')\n    print(f'num_cols: {len(num_cols)}')\n    print(f'cat_but_car: {len(cat_but_car)}')\n    print(f'num_but_cat: {len(num_but_cat)}')\n    return cat_cols, num_cols, cat_but_car\ncat_cols, num_cols, cat_but_car = grab_col_names(df)","58323cd8":"def rare_analyser(dataframe, target, cat_cols):\n    for col in cat_cols:\n        print(col, \":\", len(dataframe[col].value_counts()))\n        print(pd.DataFrame({\"COUNT\": dataframe[col].value_counts(),\n                            \"RATIO\": dataframe[col].value_counts() \/ len(dataframe),\n                            \"TARGET_MEAN\": dataframe.groupby(col)[target].mean()}), end=\"\\n\\n\\n\")\n\ndef rare_encoder(dataframe, rare_perc,cat_cols):\n    \n    rare_columns = [col for col in cat_cols if (dataframe[col].value_counts()\/len(dataframe) < 0.01).sum() > 1]\n\n    for col in rare_columns:\n        tmp = dataframe[col].value_counts() \/ len(dataframe)\n        rare_labels = tmp[tmp < rare_perc].index\n        dataframe[col] = np.where(dataframe[col].isin(rare_labels), 'Rare', dataframe[col])\n\n    return dataframe\n\nrare_analyser(df, \"SalePrice\", cat_cols)","0d999e36":"df = rare_encoder(df, 0.01, cat_cols)","f805e1b1":"rare_analyser(df, \"SalePrice\", cat_cols)","cbce91eb":"useless_cols = [col for col in cat_cols if df[col].nunique() == 1 or\n                (df[col].nunique() == 2 and (df[col].value_counts() \/ len(df) <= 0.02).any(axis=None))]\nuseless_cols","295d1bc9":"cat_cols = [col for col in cat_cols if col not in useless_cols]\ndf.shape","37cefec8":"for col in useless_cols:\n    df.drop(col, axis=1, inplace=True)\ndf.shape    ","c56af4a1":"rare_analyser(df, \"SalePrice\", cat_cols)","4eb2bac0":"def one_hot_encoder(dataframe, categorical_cols, drop_first=False):\n    dataframe = pd.get_dummies(dataframe, columns=categorical_cols, drop_first=drop_first)\n    return dataframe","d921fb19":"df = one_hot_encoder(df, cat_cols, drop_first=True)\ndf.shape","3e571732":"cat_cols, num_cols, cat_but_car = grab_col_names(df)","89c199fb":"rare_analyser(df, \"SalePrice\", cat_cols)","58bec7b8":"useless_cols_new = [col for col in cat_cols if (df[col].value_counts() \/ len(df) <= 0.01).any(axis=None)]\nuseless_cols_new","c85c530f":"for col in useless_cols_new:\n    df.drop(col, axis=1, inplace=True)\ndf.shape    ","2e66edbe":"#test train setini \u00f6nce birle\u015ftirmi\u015ftik \u015fimdi ay\u0131ral\u0131m\ntrain_df = df[df['SalePrice'].notnull()]\ntest_df = df[df['SalePrice'].isnull()].drop(\"SalePrice\", axis=1)","da4b0a42":"y = np.log1p(train_df['SalePrice'])\nX = train_df.drop([\"Id\", \"SalePrice\"], axis=1)","4471f250":"models = [('LR', LinearRegression()),\n          (\"Ridge\", Ridge()),\n          (\"Lasso\", Lasso()),\n          (\"ElasticNet\", ElasticNet()),\n          ('KNN', KNeighborsRegressor()),\n          ('CART', DecisionTreeRegressor()),\n          ('RF', RandomForestRegressor()),\n          ('SVR', SVR()),\n          ('GBM', GradientBoostingRegressor()),\n          (\"XGBoost\", XGBRegressor(objective='reg:squarederror')),\n          (\"LightGBM\", LGBMRegressor()),\n          (\"CatBoost\", CatBoostRegressor(verbose=False))]","d55c31c6":"for name, regressor in models:\n    rmse = np.mean(np.sqrt(-cross_val_score(regressor, X, y, cv=5, scoring=\"neg_mean_squared_error\")))\n    print(f\"RMSE: {round(rmse, 4)} ({name}) \")","b292d732":"lgbm_model = LGBMRegressor(random_state=46)","e1716515":"# modelleme \u00f6ncesi hata:\nrmse = np.mean(np.sqrt(-cross_val_score(lgbm_model,\n                                        X, y, cv=10, scoring=\"neg_mean_squared_error\")))\nrmse","48d4b4f5":"lgbm_params = {\"learning_rate\": [0.001, 0.01, 0.05, 0.1],\n               \"n_estimators\": [200, 500, 750],\n               \"max_depth\": [-1, 2, 5, 8],\n               \"colsample_bytree\": [1, 0.50, 0.75],\n               \"num_leaves\": [25, 31, 44]}","d3e40116":"lgbm_gs_best = GridSearchCV(lgbm_model,\n                            lgbm_params,\n                            cv=10,\n                            n_jobs=-1,\n                            verbose=True).fit(X, y)","b9fd13f7":"lgbm_gs_best.best_params_","a89636eb":"final_model = lgbm_model.set_params(**lgbm_gs_best.best_params_).fit(X, y)","2ab79e51":"rmse = np.mean(np.sqrt(-cross_val_score(final_model, X, y, cv=5, scoring=\"neg_mean_squared_error\")))\nrmse\n#hiperparametrelerin default kendi de\u011feriyle rmse 0.12676 idi.\n#optimizasyonlarla 0.1228 e indirdik","5e2b9d1a":"def plot_importance(model, features, num=len(X), save=False):\n    feature_imp = pd.DataFrame({'Value': model.feature_importances_, 'Feature': features.columns})\n    plt.figure(figsize=(10, 10))\n    sns.set(font_scale=1)\n    sns.barplot(x=\"Value\", y=\"Feature\", data=feature_imp.sort_values(by=\"Value\",\n                                                                     ascending=False)[0:num])\n    plt.title('Features')\n    plt.tight_layout()\n    plt.show()\n    if save:\n        plt.savefig('importances.png')","6d889a43":"plot_importance(final_model, X, 50)","bc69608d":"feature_imp = pd.DataFrame({'Value': final_model.feature_importances_, 'Feature': X.columns})\nfeature_imp.sort_values(by=\"Value\",ascending=False)\n","1831a238":"feature_imp[feature_imp[\"Value\"] > 0].shape","9eca0796":"feature_imp[feature_imp[\"Value\"] < 1].shape","9a88ed47":"zero_imp_cols = feature_imp[feature_imp[\"Value\"] < 1][\"Feature\"].values\nzero_imp_cols","27b92320":"selected_cols = [col for col in X.columns if col not in zero_imp_cols]\nlen(selected_cols)","cba9f148":"lgbm_model = LGBMRegressor(random_state=46)","bbda9961":"lgbm_params = {\"learning_rate\": [0.001, 0.01, 0.05, 0.1],\n               \"n_estimators\": [200, 500, 750],\n               \"max_depth\": [-1, 2, 5, 8],\n               \"colsample_bytree\": [1, 0.50, 0.75],\n               \"num_leaves\": [25, 31, 44]}","eca3de0b":"lgbm_gs_best = GridSearchCV(lgbm_model,\n                            lgbm_params,\n                            cv=10,\n                            n_jobs=-1,\n                            verbose=True).fit(X[selected_cols], y)","0ffbc4d9":"final_model = lgbm_model.set_params(**lgbm_gs_best.best_params_).fit(X[selected_cols], y)","1b602ce3":"rmse = np.mean(np.sqrt(-cross_val_score(final_model, X[selected_cols], y, cv=5, scoring=\"neg_mean_squared_error\")))\nrmse\n\n#bir \u00f6nceli rmse de\u011feri 0.12281029384862836\n#\u00e7\u00f6p de\u011fi\u015fkenlerle azaltm\u0131\u015f olduk biraz da olsa 0.12315210453826239","a70faa7e":"submission_df = pd.DataFrame()","c6247698":"submission_df['Id'] = test_df[\"Id\"]","b5b152ff":"y_pred_sub = final_model.predict(test_df[selected_cols])","5d202ea5":"y_pred_sub = np.expm1(y_pred_sub) #\u00f6l\u00e7eklendirmi\u015ftik ya onu geri ald\u0131k","c60fc04c":"submission_df['SalePrice'] = y_pred_sub","1de88f35":"submission_df[\"Id\"]=submission_df[\"Id\"].astype(\"int32\")","0ad90b01":"submission_df.dtypes","d3943804":"submission_df.to_csv('submission.csv', index=False)","823344ab":"submission_df","21cf76f1":"# Sonu\u00e7lar\u0131n Y\u00fcklenmesi","c857b7a2":"### Missing Values","1267087d":"* 1.kat metrekare alan\u0131 b\u00fcy\u00fck olup fiyat\u0131 d\u00fc\u015f\u00fck olan evler var.Di\u011fer de\u011fi\u015fkenlerle incelenmeli.","dff8a05c":"# Hyperparameter Optimization with Selected Features","0f30cb7e":"### Neighborhood: Ames \u015fehir s\u0131n\u0131rlar\u0131 i\u00e7indeki fiziksel konumlar\u0131\n* Neighborhood_NoRidge: Northridge","9737ab09":"## OUTLIERS(Ayk\u0131r\u0131 de\u011ferler)","ddad23dd":"* Genel malzeme kalitesi y\u00fcksek olanlar\u0131n fiyatlar\u0131 daha y\u00fcksek.\n* Ama 10. kalitede olup fiyat\u0131 d\u00fc\u015f\u00fck olan iki g\u00f6zlem var bunlar ayk\u0131r\u0131 olabilir.\n* 5.ve 6. kalitede olan evlerin say\u0131s\u0131 daha fazla.","d7981ca8":"### - MasVnrType (Duvar kaplama t\u00fcr\u00fc)","4dce2815":"#### - Neighborhood (Ames \u015fehir s\u0131n\u0131rlar\u0131 i\u00e7indeki fiziksel konum)","efa9b5d5":"## DATA PREPROCESSING & FEATURE ENGINEERING","33a318a5":"### - Foundation (Vak\u0131f tipi)","5dea26a9":"* GarageCars ile GarageArea aras\u0131nda 0.88 lik pozitif y\u00f6nl\u00fc korelasyon var yani ili\u015fkileri y\u00fcksek.\n* YearBuilt ile GarageYrBlt aras\u0131nda 0.83 l\u00fck korelasyon var.\n* 1stFlrSF ile TotalBsmtSF aras\u0131nda 0.82 lik koralsyon var.","c8d0d038":"#### - LotConfig(Parsel yap\u0131land\u0131rma)","df5c83d8":"### BsmtQual: Bodrum y\u00fcksekli\u011fi\n* Ex: Excellent (100+inches)\n* Gd: Good (90-99)\n* TA: Average \/ Typical (80-89)\n* Fa: Fair (70-79)\n* Po: Poor (<70)\n* NA: No basement","5f8b81d3":"#### - ExterQual(D\u0131\u015f malzeme kalitesi)","04558d5d":"* Ara\u00e7 kapasitesi fazla olanlar\u0131n ev fiyatlar\u0131n\u0131n y\u00fcksek olmas\u0131n\u0131 bekleriz.\n* Ama 3 ara\u00e7 kapasiteli garaj\u0131 olan evlerin fiyatlar\u0131 4 ara\u00e7 kapasiteli olanlardan daha fazla olmas\u0131 dikkat \u00e7ekiyor.\n* 4 ara\u00e7 kapasiteli garaj\u0131 olan evlerin fiyat\u0131 daha d\u00fc\u015f\u00fck g\u00f6r\u00fcn\u00fcyor.\n* 2 ara\u00e7 kapasiteli garaj\u0131 olan evlerin say\u0131s\u0131 daha fazla.","58231a7f":"## RARE ENCODING","280f3706":"## \u00d6nemli Kategorik De\u011fi\u015fkenlerin \u0130ncelenmesi","f1ac53a5":"* **Hyperparameter Optimization**","fb5c44d9":"## Feature Selection","331e172b":"#### - LotShape(\u0130mar \u015fekli)","cc6f4e01":"#### - OverallQual(Genel malzeme ve biti\u015f kalitesi) ","7c2947e7":"* 3 \u015f\u00f6minesi olup fiyat\u0131 daha d\u00fc\u015f\u00fck olan evler var.","7b665f57":"#### KitchenQual(Mutfak kalitesi)","2ed1ee15":"## NEW FEATURES(YEN\u0130 DE\u011e\u0130\u015eKENLER)","000f5de9":"* Metrekaresi y\u00fcksek oldu\u011fu halde(4000-5000) fiyat\u0131 d\u00fc\u015f\u00fck olan iki g\u00f6zlem var,ayk\u0131r\u0131 olabilir.\n* GrLivArea ile SalePrice aras\u0131nda do\u011frusal ili\u015fki var gibi g\u00f6r\u00fcn\u00fcyor.\n* Evlerin oturma alan\u0131 genelde 1000 ile 2500 metrekare aras\u0131nda yo\u011funluk g\u00f6stermektedir.","4ba865fc":"#### - GarageCars(Garaj\u0131n araba kapasitesi)","8478f825":"### - Fence (\u00c7it kalitesi)","14064986":"* \u00dcst katta hi\u00e7 banyosu olmad\u0131\u011f\u0131 halde fiyat\u0131 y\u00fcksek olan evler var.","942b4a4d":"## \u00d6nemli N\u00fcmerik De\u011fi\u015fkenlerin \u0130ncelenmesi","7dc14ba2":"## One-Hot Encoder","7b9d0e88":"### - LandSlope(M\u00fclk\u00fcn e\u011fimi)","9ebdd3c2":"* TotalBsmtSF de\u011fi\u015fkeni toplam \"Basement\" y\u00fcz\u00f6l\u00e7\u00fcm\u00fcn\u00fc veriyor.\"GrLivArea\" ve \"1stFlrSF\" ve \"2ndFlrSF\" alan \u00f6l\u00e7\u00fcmlerinin toplam\u0131 oldu\u011fu i\u00e7in bu de\u011fi\u015fkenlerin grafikleri ile benzer oldu\u011fu g\u00f6r\u00fcl\u00fcyor.","66a1671f":"* Garaj alan\u0131 b\u00fcy\u00fck olup fiyat\u0131 d\u00fc\u015f\u00fck olan evler var.\n* Hi\u00e7 garaj\u0131 olmayan evler var.\n","d27cc00a":"* Yap\u0131m y\u0131l\u0131 1880 ile 1900 aras\u0131nda olup fiyat\u0131 y\u00fcksek olan evler var.Bunlar tarihi yap\u0131lar olabilir.\n* 2000 y\u0131l\u0131 sonras\u0131nda yap\u0131lan evlerin fiyatlar\u0131 artm\u0131\u015f.","16aa768d":"* Di\u011fer \u015fehirlere bak\u0131ld\u0131\u011f\u0131nda en y\u00fcksek fiyatl\u0131 evler North Ridge de g\u00f6r\u00fcn\u00fcyor bu nedenle SalePrice i\u00e7in belirleyici.Burada ayk\u0131r\u0131l\u0131k olabilir.Ayk\u0131r\u0131l\u0131ktan etkilenmi\u015f olabilir.\n### North Ridge de fiyatlar\u0131n y\u00fcksek olmas\u0131n\u0131n sebebi California State \u00dcniversitesinin bu il\u00e7ede olmas\u0131 olabilir,yani belki de ayk\u0131r\u0131l\u0131k de\u011fildir.","f13551a8":"## Feature Engineering","6c725c90":"### ExterQual: D\u0131\u015f malzeme kalitesi\n* Ex: Excellent\n* Gd: Good\n* TA: Average \/ Typical\n* Fa: Fair\n* Po: Poor","28b50593":"## MODEL","ce582b84":"### FirePlaceQu: \u015e\u00f6mine kalitesi\n* Ex: Excellent-Exceptional masonry fireplace(ola\u011fan\u00fcst\u00fc duvar \u015f\u00f6minesi)\n* Gd: Good - masonry fireplace in main level(ana seviyede)\n* TA: Average \/ Typical- Prefabricated Fireplace in main living area or Masonry Fireplace in      basement(Prefabrik \u015f\u00f6mine ya da bodurm kat\u0131nda \u015f\u00f6mine)\n* Fa: Fair- Prefabricated Fireplace in basement(bodrum prefabrik \u015f\u00f6mine)\n* Po: Poor- Ben Franklin Stove\n* NA: No fireplace","dccc33cd":"# Base Model","eee5affc":"#### - BsmtQual(Bodrum Y\u00fcksekli\u011fi)"}}