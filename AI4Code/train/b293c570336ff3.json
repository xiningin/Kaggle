{"cell_type":{"3a1605c1":"code","846c61d2":"code","6f96df81":"code","69e8c04a":"code","ceb43755":"code","5f4d4b2a":"code","31e989de":"code","3432507a":"code","a53c6727":"markdown","ac536e84":"markdown","97b1b0e1":"markdown","ee4eb094":"markdown","6cd68fb6":"markdown","3d5360d9":"markdown","606d5de3":"markdown","93dc3cdd":"markdown"},"source":{"3a1605c1":"import random\nimport os\nfrom multiprocessing import Pool\n\n\nimport numpy as np\nimport pandas as pd\nimport itertools\nimport glob\nimport cv2\nfrom sklearn.metrics import accuracy_score\nfrom tqdm.auto import tqdm\nfrom matplotlib import pyplot as plt\nimport seaborn as sns\nimport matplotlib.patches as patches\nfrom sklearn.cluster import KMeans\nfrom IPython.display import Video","846c61d2":"debug = True\nCONF_THRE = 0.3\nBASE_DIR = '..\/input\/nfl-health-and-safety-helmet-assignment'\n\nlabels = pd.read_csv(f'{BASE_DIR}\/train_labels.csv')\nif debug:\n    tracking = pd.read_csv(f'{BASE_DIR}\/train_player_tracking.csv')\n    helmets = pd.read_csv(f'{BASE_DIR}\/train_baseline_helmets.csv')\nelse:\n    tracking = pd.read_csv(f'{BASE_DIR}\/test_player_tracking.csv')\n    helmets = pd.read_csv(f'{BASE_DIR}\/test_baseline_helmets.csv')","6f96df81":"image_labels_df = pd.read_csv(os.path.join(BASE_DIR, 'image_labels.csv'))","69e8c04a":"image_labels_df.head()","ceb43755":"## Functions to plot image and bounding boxes together\ndef plot_image_bbox(image, left, width, top, height, ax):\n    \"\"\"\n    Plots image and helmet bounding box\n    \"\"\"\n    ax.imshow(image)\n    rect = patches.Rectangle((left,top), width, height, edgecolor='r', facecolor=\"none\", linewidth=2)\n    ax.add_patch(rect)\n    \ndef plot_image_bboxes(image, image_name, labels_df, ax):\n    \"\"\"\n    Plots image and bounding box for all the \n    helmet instances in the image\n    \"\"\"\n    df = labels_df[labels_df[\"image\"] == image_name]\n    for i, row in df.iterrows():\n        plot_image_bbox(image, row[\"left\"], row[\"width\"], row[\"top\"], row[\"height\"], ax=ax)  ","5f4d4b2a":"fig, axs = plt.subplots(nrows = 2, ncols = 2, figsize=(20, 12))\nfig.tight_layout()\naxs = axs.ravel()\nimages_dir = os.path.join(BASE_DIR, \"images\")\nimage_names = os.listdir(images_dir)\nfor i, ax in enumerate(axs):\n    image_path = os.path.join(images_dir, image_names[i])\n    image = cv2.imread(filename=image_path)\n    plot_image_bboxes(image, image_names[i], image_labels_df, ax=ax)\nfig.suptitle(\"Sample images with helmet bbox\")    \nplt.show()","31e989de":"boxes_per_image = image_labels_df.groupby([\"image\"]).agg({\"left\": \"count\"}).rename(columns={\"left\":\"count\"})\n\nsns.displot(x=boxes_per_image[\"count\"], height=6, aspect=2) \nplt.title(\"Distribution of number of helmets per image\")\nplt.xlabel(\"Number of helmets\")\nplt.show()","3432507a":"sns.barplot(x = image_labels_df[\"label\"].value_counts(normalize=True).values, \n            y = image_labels_df[\"label\"].value_counts(normalize=True).index, \n           )\nplt.title('Distribution of Helmet types')\nplt.xlabel('Proportion of all helmets')\nplt.grid()\nplt.show()","a53c6727":"Let's plot the raw image along after helmet bounding boxes gven in the file `image_labels.csv`. This data would be crucial to train a model to detect helmets","ac536e84":"## setting and loading data","97b1b0e1":"Now lets take a lot at the distribution of number of helmets per image...","ee4eb094":"Not bad..... annotation of helmets look pretty neat!!","6cd68fb6":"#### Stay tuned for more.....","3d5360d9":"There is clearly a peak at `22` (which is the total number of players in ground at a time)\n\nThere are values greater than 22 as well due to the sidelined players","606d5de3":"### EDA","93dc3cdd":"Note that most of the helmets are normal while 3-4% of helmets are difficult to classify."}}