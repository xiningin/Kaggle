{"cell_type":{"95b41263":"code","d300aafa":"code","8c1ba00c":"code","c60fd300":"code","ca89882c":"code","3bf8f252":"code","911c153a":"code","61178525":"code","856280af":"code","bad9da4b":"code","d57d3112":"code","e10a2fd7":"code","8be92d74":"code","9103419f":"code","bda6341f":"code","c5024130":"code","0df312e1":"code","098d8964":"code","4e2ada09":"code","5b9054b2":"code","260aec16":"code","078dc07f":"code","5fa22268":"code","b5e28584":"code","628eaaf6":"code","835ba45c":"code","f4a69f70":"code","5e8967f3":"code","92ab60f3":"code","471f2972":"code","e5ecccf9":"code","10a3ec0a":"code","ec17e996":"code","f9cb682f":"code","479dee67":"code","a1c411e2":"code","983cffd3":"code","1ab8e07a":"code","cc1098eb":"code","29e77c83":"code","da7c02ba":"code","8d8f4679":"code","b3fe9231":"code","ecb2f3e2":"code","98d4f1cd":"code","c34bb8e6":"code","1c17ca18":"code","f0f6e932":"code","8b4474b2":"code","0a1c77db":"code","12b181e5":"code","78f75299":"markdown","25d0bee5":"markdown","3f182fc7":"markdown","afb2fd01":"markdown","5c9737c6":"markdown","d5c20f7a":"markdown","c2b7b5a2":"markdown","45199b6a":"markdown","45916232":"markdown"},"source":{"95b41263":"import numpy as np\nimport pandas as pd \n\nimport matplotlib.pyplot as plt\nplt.style.use('ggplot')\n\nimport torch\nfrom fastai.vision import *\nfrom fastai.metrics import *\n\nnp.random.seed(7)\ntorch.cuda.manual_seed_all(7)\n\nimport os\nprint(os.listdir(\"..\/input\"))","d300aafa":"pred = !ls ..\/input\/seg_pred\/seg_pred\nlen(pred)","8c1ba00c":"buildings = !ls ..\/input\/seg_train\/seg_train\/buildings\nforest = !ls ..\/input\/seg_train\/seg_train\/forest\nglacier = !ls ..\/input\/seg_train\/seg_train\/glacier\nmountain = !ls ..\/input\/seg_train\/seg_train\/mountain\nsea = !ls ..\/input\/seg_train\/seg_train\/sea\nstreet = !ls ..\/input\/seg_train\/seg_train\/street\n\nlen(buildings) + len(forest) + len(glacier) + len(mountain) + len(sea) + len(street)","c60fd300":"buildings = !ls ..\/input\/seg_test\/seg_test\/buildings\nforest = !ls ..\/input\/seg_test\/seg_test\/forest\nglacier = !ls ..\/input\/seg_test\/seg_test\/glacier\nmountain = !ls ..\/input\/seg_test\/seg_test\/mountain\nsea = !ls ..\/input\/seg_test\/seg_test\/sea\nstreet = !ls ..\/input\/seg_test\/seg_test\/street\n\nlen(buildings) + len(forest) + len(glacier) + len(mountain) + len(sea) + len(street)","ca89882c":"# Batches of 256\ndatabunch = ImageDataBunch.from_folder(Path('..\/input'), ds_tfms=get_transforms(),\n                               train='seg_train', valid='seg_test',\n                                   size=64, bs=256).normalize(imagenet_stats)","3bf8f252":"# Add the test images to the DataBunch\ntest_img = ImageList.from_folder(path=Path('..\/input\/seg_pred', folder='swg_pred'))\ndatabunch.add_test(test_img)","911c153a":"databunch.show_batch(rows=4)","61178525":"databunch.classes","856280af":"databunch.label_list","bad9da4b":"learner = cnn_learner(databunch, models.resnet50, metrics=accuracy, model_dir='\/tmp\/models')\nlearner.lr_find();\nlearner.recorder.plot()","d57d3112":"# Crazy story of learning rates you see :P\nlearner.fit_one_cycle(5, max_lr=(2e-04, 1e-03, 3*1e-02))\nlearner.recorder.plot_losses()","e10a2fd7":"del learner\ngc.collect()","8be92d74":"# Towards a more stable training\nlearner = cnn_learner(databunch, models.resnet50, metrics=accuracy, model_dir='\/tmp\/models').to_fp16()\nlearner.fit_one_cycle(5, max_lr=slice(1e-02, 1e-03))","9103419f":"learner.recorder.plot_losses()","bda6341f":"learner.show_results(ds_type=DatasetType.Valid)","c5024130":"interp = ClassificationInterpretation.from_learner(learner.to_fp32())\ninterp.plot_top_losses(9, figsize=(12,10))","0df312e1":"interp.plot_confusion_matrix(figsize=(8,8))","098d8964":"del learner\ngc.collect()","4e2ada09":"learner = cnn_learner(databunch, models.resnet50, metrics=accuracy, model_dir='\/tmp\/models').to_fp16()\nlearner.fit_one_cycle(10, max_lr=slice(1e-02, 1e-03))\nlearner.recorder.plot_losses()","5b9054b2":"del learner\ngc.collect()","260aec16":"new_transforms = get_transforms(do_flip=True, flip_vert=True, \n                      max_lighting=0.3, max_warp=0.3, max_rotate=20., max_zoom=0.05)","078dc07f":"# Batches of 256\nnew_databunch = ImageDataBunch.from_folder(Path('..\/input'), ds_tfms=new_transforms,\n                               train='seg_train', valid='seg_test',\n                                   size=64, bs=256).normalize(imagenet_stats)\n\nnew_databunch.add_test(test_img)","5fa22268":"new_databunch.show_batch(rows=4)","b5e28584":"learner = cnn_learner(new_databunch, models.resnet50, metrics=accuracy, model_dir='\/tmp\/models').to_fp16()\nlearner.fit_one_cycle(10, max_lr=slice(1e-02, 1e-03))\nlearner.recorder.plot_losses()","628eaaf6":"del learner\ngc.collect()","835ba45c":"less_transforms = get_transforms(do_flip=True, max_warp=0.3, max_zoom=0.05)","f4a69f70":"# Batches of 256\nnew_databunch_2 = ImageDataBunch.from_folder(Path('..\/input'), ds_tfms=less_transforms,\n                               train='seg_train', valid='seg_test',\n                                   size=64, bs=256).normalize(imagenet_stats)\n\nnew_databunch_2.add_test(test_img)","5e8967f3":"learner = cnn_learner(new_databunch_2, models.resnet50, metrics=accuracy, model_dir='\/tmp\/models').to_fp16()\nlearner.fit_one_cycle(10, max_lr=slice(1e-02, 1e-03))\nlearner.recorder.plot_losses()","92ab60f3":"learner.save('stage-1-rn50')","471f2972":"interp = ClassificationInterpretation.from_learner(learner.to_fp32())\ninterp.plot_top_losses(9, figsize=(12,10))","e5ecccf9":"interp.plot_confusion_matrix(figsize=(8,8))","10a3ec0a":"del learner\ngc.collect()","ec17e996":"learner = cnn_learner(new_databunch_2, models.resnet50, metrics=accuracy, model_dir='\/tmp\/models').to_fp16()\nlearner.fit_one_cycle(15, max_lr=slice(1e-02, 1e-03))\nlearner.recorder.plot_losses()","f9cb682f":"learner.save('stage-2-rn50')","479dee67":"del learner\ngc.collect()","a1c411e2":"learner = cnn_learner(new_databunch_2, models.resnet101, metrics=accuracy, model_dir='\/tmp\/models').to_fp16()\nlearner.lr_find()\nlearner.recorder.plot()","983cffd3":"learner.fit_one_cycle(5, max_lr=slice(1e-02, 1e-03))\nlearner.recorder.plot_losses()","1ab8e07a":"del learner\ngc.collect()","cc1098eb":"learner = cnn_learner(new_databunch_2, models.resnet101, metrics=accuracy, model_dir='\/tmp\/models').to_fp16()\nlearner.fit_one_cycle(10, max_lr=slice(1e-02, 1e-03))\nlearner.recorder.plot_losses()","29e77c83":"interp = ClassificationInterpretation.from_learner(learner)\ninterp.plot_confusion_matrix(figsize=(8,8))","da7c02ba":"learner.save('stage-1-rn101')","8d8f4679":"del learner\ngc.collect()","b3fe9231":"# Size of 150*150\nnew_databunch_3 = ImageDataBunch.from_folder(Path('..\/input'), ds_tfms=less_transforms,\n                               train='seg_train', valid='seg_test',\n                                   size=150, bs=256).normalize(imagenet_stats)\n\nnew_databunch_3.add_test(test_img)","ecb2f3e2":"new_databunch_3.show_batch(rows=4)","98d4f1cd":"learner = cnn_learner(new_databunch_3, models.resnet101, metrics=accuracy, model_dir='\/tmp\/models').to_fp16()\nlearner.lr_find();\nlearner.recorder.plot()","c34bb8e6":"learner.fit_one_cycle(10, max_lr=slice(1e-02, 1e-03))\nlearner.recorder.plot_losses()","1c17ca18":"interp = ClassificationInterpretation.from_learner(learner)\ninterp.plot_confusion_matrix(figsize=(8,8))","f0f6e932":"del learner\ngc.collect()","8b4474b2":"new_databunch_4 = ImageDataBunch.from_folder(Path('..\/input'), ds_tfms=get_transforms(),\n                               train='seg_train', valid='seg_test',\n                                   size=150, bs=256).normalize(imagenet_stats)\n\nnew_databunch_4.add_test(test_img)","0a1c77db":"learner = cnn_learner(new_databunch_4, models.resnet101, metrics=accuracy, model_dir='\/tmp\/models').to_fp16()\nlearner.fit_one_cycle(10, max_lr=slice(1e-02, 1e-03))\nlearner.recorder.plot_losses()","12b181e5":"interp = ClassificationInterpretation.from_learner(learner)\ninterp.plot_confusion_matrix(figsize=(8,8))","78f75299":"## Trying deeper architectures","25d0bee5":"## Experiments for Intel Scene Classification challenge","3f182fc7":"Overfits slightly.","afb2fd01":"## A bit more data augmentation","5c9737c6":"It overfits after augmentation. The augmented transforms were may be way to much. ","d5c20f7a":"Slightly overfits!","c2b7b5a2":"Ensembling the last two models will definitely help. ","45199b6a":"Class performance right here.","45916232":"## Loading data in a larger size"}}