{"cell_type":{"b7b4902f":"code","489dc07d":"code","90720ae8":"code","641370c8":"code","d8a24a90":"code","53c0d9d3":"code","0be2ffd3":"code","4a8d4f31":"code","30d84d26":"code","76a50484":"code","099e0902":"code","8c0c31de":"code","059f9686":"code","da5f3736":"code","e0dfec6d":"code","c8d6a4de":"code","11762d14":"code","81c7a57e":"code","e1c43fc8":"code","cc8727a9":"code","9a1c40de":"code","e4fc7a6a":"code","c408f70e":"code","2fc05e12":"code","c42dee12":"code","6d2af4ce":"code","0c1e3ae1":"code","41e925a8":"code","b22deef7":"code","31539567":"code","50c64bd9":"code","f3e3cad1":"code","ee279ca8":"code","dfef98eb":"code","7fed1b8a":"code","5ee8c358":"code","e1f1c36d":"code","50f23921":"code","bebc92cf":"code","ef197275":"code","62bcb79d":"code","4491fb60":"code","a377e0b7":"code","2b6492e8":"code","b4433b96":"code","f3fb8e6d":"code","951c4cc3":"code","7b0ea057":"code","8359de91":"code","72e9e836":"code","0267a075":"code","9304a532":"code","4f2e0a3c":"code","ab59fb16":"code","af818130":"code","78ae1811":"code","5c335593":"code","406e87bf":"code","6380da42":"code","589e3524":"code","59512d23":"code","20394cac":"code","ace4fa80":"code","ca329164":"code","77bba81e":"code","0284174b":"code","b0549523":"code","98dcae8a":"code","0fcf3af7":"code","1c8be652":"code","9448e8eb":"code","f82c3f96":"code","458fc251":"code","a1434ff8":"code","0c2a1b08":"code","b7fd5ed9":"code","52d4fbcc":"code","ca7fb3de":"code","16f1732c":"code","9aa0ea86":"code","996790f1":"code","eab15c75":"code","f906a919":"code","79e9215d":"code","abcd5889":"code","74bf8e9a":"code","c6fcda52":"code","54e0c751":"code","1a4bb9eb":"code","b809f734":"code","ac81222d":"code","a0df67d7":"code","74174030":"code","f36ebb1f":"code","12d164ac":"code","df7008c0":"code","c3fb38f9":"code","1957db28":"code","6171127c":"code","5a027049":"code","85c2f6aa":"code","8bf50337":"code","3b50c7e0":"code","7e4eaa7d":"code","572df7da":"code","b7d087ad":"code","ca947bd2":"code","be3e3048":"code","581c6dd7":"code","03f86270":"code","69051754":"code","ee8cb66e":"code","7586c0bb":"code","14048e41":"code","0de99146":"code","5117293e":"code","c401ee9d":"code","6aa18da9":"code","3003b797":"code","2392c680":"code","9f2695f2":"code","6c05e6c8":"code","4e0cf245":"code","ebe59ec0":"code","8c93fa44":"code","2b21f7bf":"code","6239b0c8":"code","fca35f64":"code","18024335":"code","33eb344c":"code","7e27b205":"code","b2c47388":"code","137b7432":"code","f24514c6":"code","656f074f":"code","c79d854b":"code","df14ed1f":"code","51ba0c3a":"code","a3cb3eed":"code","2a1041c3":"code","f56e1024":"code","2484f4ee":"code","59a9d4a6":"code","abfd4e96":"code","2f036fe2":"code","4341c9fb":"code","fed5a4bb":"code","01cc5610":"code","90b13297":"code","e3088d9e":"code","88a66973":"code","e7a527a7":"code","76b8ab57":"code","b1949689":"code","12f0495f":"code","9596afa6":"code","4da8bc9c":"code","0dccd427":"code","53af4af1":"code","17c3aebb":"code","b304dd7e":"code","7f0b9c68":"code","afcec826":"markdown","00d56244":"markdown","69ed0667":"markdown","309db67f":"markdown","4e2e94f3":"markdown","2478e45d":"markdown","c1a2e937":"markdown","cba02180":"markdown","170ea3c4":"markdown","96768117":"markdown","54a003b0":"markdown","250a9b54":"markdown","e2533248":"markdown","bd66991d":"markdown","77238698":"markdown","0e3f2d2c":"markdown","b009d6de":"markdown","2e9875cf":"markdown","b02621ea":"markdown","60c7387c":"markdown","0ee529b8":"markdown","1073ff31":"markdown","fe099576":"markdown","de9a90b1":"markdown","9ed400a6":"markdown","ec39436c":"markdown","1d7907be":"markdown","e3fe7bd5":"markdown","f48e036b":"markdown","5d0d8f32":"markdown","b4472898":"markdown","0d18f2e7":"markdown","4fae0d0d":"markdown","5f275615":"markdown","bb3bcaa1":"markdown","4c06629b":"markdown","4be4f6d7":"markdown","e255c48a":"markdown","54b61313":"markdown","8c0a4247":"markdown","9c2fb06e":"markdown","d41bcfcb":"markdown","df742010":"markdown"},"source":{"b7b4902f":"import pandas as pd\nimport numpy as np\nimport matplotlib.pylab as plt\nimport matplotlib as mpl\nfrom matplotlib.patches import Circle, Rectangle, Arc\nimport seaborn as sns\nplt.style.use('seaborn-dark-palette')\nmypal = plt.rcParams['axes.prop_cycle'].by_key()['color'] # Grab the color pal\nimport os\nimport gc","489dc07d":"def mkdir(path):\n    import os\n    path = path.strip()\n    path = path.rstrip(\"\\\\\")\n    isExists = os.path.exists(path)\n    if not isExists:\n        os.makedirs(path)\n        print(path + 'Successufully established')\n        return True\n    else:\n        print(path + 'dir existed')\n        return False","90720ae8":"MENS_DIR = '..\/input\/march-madness-analytics-2020\/2020DataFiles\/2020DataFiles\/2020-Mens-Data\/MDataFiles_Stage1'\nWOMENS_DIR = '..\/input\/march-madness-analytics-2020\/2020DataFiles\/2020DataFiles\/2020-Womens-Data\/WDataFiles_Stage1'\nMss = pd.read_csv(f'{MENS_DIR}\/MTeams.csv')\nWss = pd.read_csv(f'{WOMENS_DIR}\/WTeams.csv')","641370c8":"M_drop_list = [\"FirstD1Season\",\"TeamName\",\"LastD1Season\"]\nW_drop_list = ['TeamName']\nMss.drop(M_drop_list,axis = 1,inplace = True)\nWss.drop(W_drop_list,axis = 1,inplace = True)\n# Team_box\ntime_list = [2015,2016,2017,2018,2019]","d8a24a90":"Mss = pd.read_csv(f'{MENS_DIR}\/MTeams.csv')\nWss = pd.read_csv(f'{WOMENS_DIR}\/WTeams.csv')\nM_Seed = pd.read_csv(f'{MENS_DIR}\/MNCAATourneySeeds.csv')\nW_Seed = pd.read_csv(f'{WOMENS_DIR}\/WNCAATourneySeeds.csv')\nM_Team_seed = M_Seed[M_Seed['Season'].isin(time_list)]\nW_Team_seed = W_Seed[W_Seed['Season'].isin(time_list)]\nM_game_result_detailed =  pd.read_csv(f'{MENS_DIR}\/MRegularSeasonDetailedResults.csv')\nW_game_result_detailed =  pd.read_csv(f'{WOMENS_DIR}\/WRegularSeasonDetailedResults.csv')","53c0d9d3":"M_game_result_detailed = M_game_result_detailed[M_game_result_detailed['Season'].isin(time_list)]\nW_game_result_detailed = W_game_result_detailed[W_game_result_detailed['Season'].isin(time_list)]","0be2ffd3":"win_list = ['Season','WTeamID','WScore','WFGM', 'WFGA', 'WFGM3', 'WFGA3', 'WFTM', 'WFTA', 'WOR', 'WDR',\n       'WAst', 'WTO', 'WStl', 'WBlk', 'WPF']\nM_game_result_win = M_game_result_detailed[win_list]\nW_game_result_win = W_game_result_detailed[win_list]\nlose_list = ['Season','LTeamID','LScore','LFGM', 'LFGA', 'LFGM3', 'LFGA3',\n       'LFTM', 'LFTA', 'LOR', 'LDR', 'LAst', 'LTO', 'LStl', 'LBlk', 'LPF']\nM_game_result_lose = M_game_result_detailed[lose_list]\nW_game_result_lose = W_game_result_detailed[lose_list]","4a8d4f31":"M_team_win_box = M_game_result_win.groupby(['WTeamID','Season']).count()\nW_team_win_box = W_game_result_win.groupby(['WTeamID','Season']).count()","30d84d26":"drop_list = ['WFGM', 'WFGA', 'WFGM3', 'WFGA3', 'WFTM', 'WFTA', 'WOR', 'WDR',\n       'WAst', 'WTO', 'WStl', 'WBlk', 'WPF']\nM_team_win_box = M_team_win_box.drop(drop_list,axis = 1)\nW_team_win_box = W_team_win_box.drop(drop_list,axis = 1)\nM_team_win_box = M_team_win_box.rename(columns = {'WScore':'count'})\nW_team_win_box = W_team_win_box.rename(columns = {'WScore':'count'})","76a50484":"M_team_count = M_team_win_box.reset_index()\nW_team_count = W_team_win_box.reset_index()","099e0902":"M_team_win_box = M_game_result_win.groupby(['WTeamID','Season']).sum()\nM_team_win_box = M_team_win_box.reset_index()\nM_team_win_box = pd.merge(M_team_win_box,M_team_count,on = ['WTeamID','Season'])\nwin_rename_columns = {'WTeamID':\"TeamID\",\"WScore\":\"Score\",'WFGM':'FGM', 'WFGA':'FGA', 'WFGM3':'FGM3', 'WFGA3':'FGA3',\n       'WFTM':'FTM', 'WFTA':'FTA', 'WOR':'OR', 'WDR':'DR', 'WAst':'Ast', 'WTO':'TO', 'WStl':'Stl', 'WBlk':'Blk', 'WPF':'PF'}\nM_team_win_box = M_team_win_box.rename(columns=win_rename_columns)\nM_team_win_box.head()","8c0c31de":"W_team_win_box = W_game_result_win.groupby(['WTeamID','Season']).sum()\nW_team_win_box = W_team_win_box.reset_index()\nW_team_win_box = pd.merge(W_team_win_box,W_team_count,on = ['WTeamID','Season'])\nW_team_win_box = W_team_win_box.rename(columns=win_rename_columns)\nW_team_win_box.head()","059f9686":"M_team_lose_box = M_game_result_lose.groupby(['LTeamID','Season']).count()\ndrop_list = ['LFGM', 'LFGA', 'LFGM3', 'LFGA3', 'LFTM', 'LFTA', 'LOR', 'LDR',\n       'LAst', 'LTO', 'LStl', 'LBlk', 'LPF']\nM_team_lose_box = M_team_lose_box.drop(drop_list,axis = 1)\nM_team_lose_box = M_team_lose_box.rename(columns = {'LScore':'count'})","da5f3736":"W_team_lose_box = W_game_result_lose.groupby(['LTeamID','Season']).count()\nW_team_lose_box = W_team_lose_box.drop(drop_list,axis = 1)\nW_team_lose_box = W_team_lose_box.rename(columns = {'LScore':'count'})\nM_team_lose_count = M_team_lose_box.reset_index()\nW_team_lose_count = W_team_lose_box.reset_index()","e0dfec6d":"M_result_lose = M_game_result_lose.groupby(['LTeamID','Season']).sum()\nM_team_lose_box = M_result_lose.reset_index()\nM_team_lose_box = pd.merge(M_team_lose_box,M_team_lose_count,on = ['LTeamID','Season'])\nrename_columns = {'LTeamID':\"TeamID\",\"LScore\":\"Score\",'LFGM':'FGM', 'LFGA':'FGA', 'LFGM3':'FGM3', 'LFGA3':'FGA3',\n       'LFTM':'FTM', 'LFTA':'FTA', 'LOR':'OR', 'LDR':'DR', 'LAst':'Ast', 'LTO':'TO', 'LStl':'Stl', 'LBlk':'Blk', 'LPF':'PF'}\nM_team_lose_box = M_team_lose_box.rename(columns=rename_columns)\nW_result_lose = W_game_result_lose.groupby(['LTeamID','Season']).sum()\nW_team_lose_box = W_result_lose.reset_index()\nW_team_lose_box = pd.merge(W_team_lose_box,W_team_lose_count,on = ['LTeamID','Season'])\nW_team_lose_box = W_team_lose_box.rename(columns=rename_columns)","c8d6a4de":"M_result = pd.merge(M_team_win_box,M_team_lose_box,on=['TeamID','Season'])\nW_result = pd.merge(W_team_win_box,W_team_lose_box,on=['TeamID','Season'])\nM_result = M_team_win_box.append(M_team_lose_box)\nW_result = W_team_win_box.append(W_team_lose_box)","11762d14":"M_result = M_result.groupby(['TeamID','Season']).sum()\nW_result = W_result.groupby(['TeamID','Season']).sum()","81c7a57e":"element_list = ['Score','FGM','FGA','FGM3','FGA3','FTM','FTA','OR','DR','TO','Stl','Blk','PF','Ast']\nM_result = M_result[element_list].apply(lambda x:x\/M_result['count'])\nW_result = W_result[element_list].apply(lambda x:x\/W_result['count'])\nM_result_withseed = pd.merge(M_result,M_Team_seed,on=['TeamID','Season'],how = 'outer')\nW_result_withseed = pd.merge(W_result,W_Team_seed,on=['TeamID','Season'],how = 'outer')\nM_team_win_box = M_result_withseed.rename(columns = {'TeamID':'WTeamID'})\nM_team_lose_box = M_result_withseed.rename(columns = {'TeamID':'LTeamID'})\nW_team_win_box = W_result_withseed.rename(columns = {'TeamID':'WTeamID'})\nW_team_lose_box = W_result_withseed.rename(columns = {'TeamID':'LTeamID'})","e1c43fc8":"M_result_withseed.to_csv('M_result.csv')\nW_result_withseed.to_csv('W_result.csv')","cc8727a9":"M_game_result =  pd.read_csv(f'{MENS_DIR}\/MNCAATourneyCompactResults.csv')\nM_game_result = M_game_result[M_game_result['Season'].isin(time_list)]\nW_game_result =  pd.read_csv(f'{WOMENS_DIR}\/WNCAATourneyCompactResults.csv')\nW_game_result = W_game_result[W_game_result['Season'].isin(time_list)]","9a1c40de":"M_game_result_1 = pd.merge(M_game_result,M_team_win_box,on=['WTeamID','Season'],how = 'left')\nW_game_result_1 = pd.merge(W_game_result,W_team_win_box,on=['WTeamID','Season'],how = 'left')\nM_game_result_final = pd.merge(M_game_result_1,M_team_lose_box,on=['LTeamID','Season'],how = 'left')\nW_game_result_final = pd.merge(W_game_result_1,W_team_lose_box,on=['LTeamID','Season'],how = 'left')\n\nM_game_result_final.to_csv('M_result_by_game_tourney.csv')\nW_game_result_final.to_csv('W_result_by_game_tourney.csv')","e4fc7a6a":"M_game_result_final.head()","c408f70e":"import statsmodels.api as sm\n\nfrom matplotlib import pyplot as plt\n%matplotlib inline\n\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.datasets import load_diabetes\nfrom sklearn.impute import SimpleImputer\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.metrics import accuracy_score\n\nimport warnings\nwarnings.filterwarnings('ignore')","2fc05e12":"df = M_game_result_final.copy()\ndf1=df.copy()\ndf_WTeamID=df['WTeamID']\ndf_LTeamID=df['LTeamID']\ndf_WScore=df['WScore']\ndf_LScore=df['LScore']\ndf1['WTeamID']=df_LTeamID\ndf1['LTeamID']=df_WTeamID\ndf1['WScore']=df_LScore\ndf1['LScore']=df_WScore\nlabel_x=df1.columns[8:23]\nlabel_y=df1.columns[23:38]\nlabel_x=list(label_x)\nlabel_y=list(label_y)\nfor i in range(len(label_x)):\n    df1[label_x[i]]=df[label_y[i]]\n    df1[label_y[i]]=df[label_x[i]]","c42dee12":"df['target']=1\ndf1['target']=0\ndf_final=df.append(df1)","6d2af4ce":"df_W = W_game_result_final.copy()\ndf_W1=df_W.copy()\ndf_W_WTeamID=df_W['WTeamID']\ndf_W_LTeamID=df_W['LTeamID']\ndf_W_WScore=df_W['WScore']\ndf_W_LScore=df_W['LScore']\ndf_W1['WTeamID']=df_W_LTeamID\ndf_W1['LTeamID']=df_W_WTeamID\ndf_W1['WScore']=df_W_LScore\ndf_W1['LScore']=df_W_WScore\nlabel_x_W=df_W1.columns[8:23]\nlabel_y_W=df_W1.columns[23:38]\nlabel_x_W=list(label_x_W)\nlabel_y_W=list(label_y_W)\nfor i in range(len(label_x_W)):\n    df_W1[label_x_W[i]]=df_W[label_y_W[i]]\n    df_W1[label_y_W[i]]=df_W[label_x_W[i]]","0c1e3ae1":"df_W['target']=1\ndf_W1['target']=0\ndf_W_final=df_W.append(df_W1)\ndf_final.to_csv('M_result_by_game_tourney_editored.csv')\ndf_W_final.to_csv('W_result_by_game_tourney_editored.csv')","41e925a8":"m,n=np.shape(df_final)\ndf_final.reset_index(inplace = True)\ndf_final = df_final.drop(columns = 'index')\ndata=df_final.copy()\nwseed = data[\"Seed_x\"]\nlseed = data[\"Seed_y\"]\nWseed  = np.zeros([m])\nLseed = np.zeros([m])","b22deef7":"for i in range(m):\n    Wseed[i] = wseed[i][1:3]\n    Lseed[i] = lseed[i][1:3]\n    \nseeddiff=Wseed-Lseed","31539567":"df_final=df_final.drop(['WLoc','Seed_x','Seed_y','WTeamID','WScore','LTeamID','LScore'],axis=1)\nm,n=np.shape(df_final)\ndf_final.insert(n-1,'Seeddiff',seeddiff) \n# Split the data \ndf_train=df_final[df_final['Season']<2019]\ndf_test=df_final[df_final['Season']>2018]","50c64bd9":"x_train = df_train.iloc[:,0:n].values\ny_train = df_train.target.values\nx_test = df_test.iloc[:,0:n].values\ny_test = df_test.target.values","f3e3cad1":"from sklearn.linear_model import LogisticRegressionCV\n\nlogreg = LogisticRegressionCV(cv=5,random_state=0, solver='newton-cg')\nlogreg.fit(x_train, y_train)\n\ny_pred_train = logreg.predict(x_train)\ny_pred_test = logreg.predict(x_test)\n\nprint(\"Coefficients :\", np.round(logreg.intercept_,4), np.round(logreg.coef_,4))\ny_pred_train = logreg.predict(x_train)\ny_pred_test = logreg.predict(x_test)\n\naccuracy_train = accuracy_score(y_train, y_pred_train)\naccuracy_test = accuracy_score(y_test, y_pred_test)\nprint('Accuracy on the training set =', np.round(accuracy_train,4))\nprint('Accuracy on the test set =', np.round(accuracy_test,4))","ee279ca8":"m,n=np.shape(df_W_final)\ndf_W_final.reset_index(inplace = True)\ndf_W_final = df_W_final.drop(columns = 'index')","dfef98eb":"data=df_W_final.copy()\nwseed = data[\"Seed_x\"]\nlseed = data[\"Seed_y\"]\nWseed  = np.zeros([m])\nLseed = np.zeros([m])\nfor i in range(m):\n    Wseed[i] = wseed[i][1:3]\n    Lseed[i] = lseed[i][1:3]\n    \nseeddiff=Wseed-Lseed","7fed1b8a":"df_W_final=df_W_final.drop(['WLoc','Seed_x','Seed_y','WTeamID','WScore','LTeamID','LScore'],axis=1)\nm,n=np.shape(df_W_final)\ndf_W_final.insert(n-1,'Seeddiff',seeddiff) ","5ee8c358":"# Split the data \ndf_train_W=df_W_final[df_W_final['Season']<2019]\ndf_test_W=df_W_final[df_W_final['Season']>2018]\nx_train_W = df_train_W.iloc[:,0:n].values\ny_train_W = df_train_W.target.values\nx_test_W = df_test_W.iloc[:,0:n].values\ny_test_W = df_test_W.target.values","e1f1c36d":"from sklearn.linear_model import LogisticRegressionCV\n\nlogreg = LogisticRegressionCV(cv=5,random_state=0, solver='newton-cg')\nlogreg.fit(x_train, y_train)\n\ny_pred_train = logreg.predict(x_train_W)\ny_pred_test = logreg.predict(x_test_W)\n\nprint(\"Coefficients :\", np.round(logreg.intercept_,4), np.round(logreg.coef_,4))","50f23921":"y_pred_train = logreg.predict(x_train_W)\ny_pred_test = logreg.predict(x_test_W)\n\naccuracy_train = accuracy_score(y_train_W, y_pred_train)\naccuracy_test = accuracy_score(y_test_W, y_pred_test)\nprint('Accuracy on the training set =', np.round(accuracy_train,4))\nprint('Accuracy on the test set =', np.round(accuracy_test,4))","bebc92cf":"import xgboost as xgb","ef197275":"data_xgb = pd.read_csv(\"M_result_by_game_tourney_editored.csv\")\ndata_xgb","62bcb79d":"wseed = data_xgb[\"Seed_x\"]\nlseed = data_xgb[\"Seed_y\"]\nWseed  = np.zeros([data_xgb.shape[0]])\nLseed = np.zeros([data_xgb.shape[0]])\nfor i in range(data_xgb.shape[0]):\n    Wseed[i] = wseed[i][1:3]\n    Lseed[i] = lseed[i][1:3]\ndata_xgb[\"Seed_x\"] = Wseed\ndata_xgb[\"Seed_y\"] = Lseed","4491fb60":"data_xgb[\"Score_diff\"] = data_xgb[\"Score_x\"]-data_xgb[\"Score_y\"]\ndata_xgb[\"FGM_diff\"] = data_xgb[\"FGM_x\"]-data_xgb[\"FGM_y\"]\ndata_xgb[\"Ast_diff\"] = data_xgb[\"Ast_x\"]-data_xgb[\"Ast_y\"]\ndata_xgb[\"FGA_diff\"] = data_xgb[\"FGA_x\"]-data_xgb[\"FGA_y\"]\ndata_xgb[\"FGM3_diff\"] = data_xgb[\"FGM3_x\"]-data_xgb[\"FGM3_y\"]\ndata_xgb[\"FGA3_diff\"] = data_xgb[\"FGA3_x\"]-data_xgb[\"FGA3_y\"]\ndata_xgb[\"FTM_diff\"] = data_xgb[\"FTM_x\"]-data_xgb[\"FTM_y\"]\ndata_xgb[\"FTA_diff\"] = data_xgb[\"FTA_x\"]-data_xgb[\"FTA_y\"]\ndata_xgb[\"OR_diff\"] = data_xgb[\"OR_x\"]-data_xgb[\"OR_y\"]\ndata_xgb[\"DR_diff\"] = data_xgb[\"DR_x\"]-data_xgb[\"DR_y\"]\ndata_xgb[\"TO_diff\"] = data_xgb[\"TO_x\"]-data_xgb[\"TO_y\"]\ndata_xgb[\"Stl_diff\"] = data_xgb[\"Stl_x\"]-data_xgb[\"Stl_y\"]\ndata_xgb[\"Blk_diff\"] = data_xgb[\"Blk_x\"]-data_xgb[\"Blk_y\"]\ndata_xgb[\"PF_diff\"] = data_xgb[\"PF_x\"]-data_xgb[\"PF_y\"]\ndata_xgb[\"Seed_diff\"] = data_xgb[\"Seed_x\"]-data_xgb[\"Seed_y\"]\n","a377e0b7":"data_xgb.head()","2b6492e8":"data_xgb.drop(['DayNum','NumOT'],axis = 1,inplace = True)","b4433b96":"trainlabel = data_xgb[data_xgb['Season']<2019]['target']\ntestlabel = data_xgb[data_xgb['Season']==2019]['target']\ntraindata = data_xgb[data_xgb['Season']<2019]\ntestdata = data_xgb[data_xgb['Season']==2019]\ndroplist = [\"Unnamed: 0\",\"LTeamID\",\"WTeamID\",\"WLoc\",\"target\",\"WScore\",\"Score_x\",\"FGM_x\",\"FGA_x\",\"FGM3_x\",\"FGA3_x\",\n            \"LScore\",\"Ast_x\",\"Ast_y\",\"FTM_x\",\"FTA_x\",\"OR_x\",\"DR_x\",\"TO_x\",\"Stl_x\",\"Blk_x\",\n           \"PF_x\",\"Score_y\",\"FGM_y\",\"FGA_y\",\"FGM3_y\",\"FGA3_y\",\"FTM_y\",\"FTA_y\",\n            \"OR_y\",\"DR_y\",\"TO_y\",\"Stl_y\",\"Blk_y\",\"PF_y\",\"Seed_x\",\"Seed_y\"]\ntraindata.drop(droplist,axis=1,inplace = True)\ntestdata.drop(droplist,axis=1,inplace = True)\ntraindata","f3fb8e6d":"xg_reg = xgb.XGBRegressor(objective ='binary:logistic', colsample_bytree = 0.8, learning_rate = 0.001,\n                max_depth = 10, alpha = 7, n_estimators = 50000)\nxg_reg.fit(traindata,trainlabel)","951c4cc3":"preds  = xg_reg.predict(testdata)\npreds = np.floor(preds+0.5)\nnp.sum(preds==testlabel)\/testdata.shape[0]","7b0ea057":"xgb.plot_tree(xg_reg,num_trees=0)\nplt.rcParams['figure.figsize'] = [500, 400]\nplt.show()","8359de91":"data_xgb = pd.read_csv(\"W_result_by_game_tourney_editored.csv\")\n\nwseed = data_xgb[\"Seed_x\"]\nlseed = data_xgb[\"Seed_y\"]\nWseed  = np.zeros([data_xgb.shape[0]])\nLseed = np.zeros([data_xgb.shape[0]])\nfor i in range(data_xgb.shape[0]):\n    Wseed[i] = wseed[i][1:3]\n    Lseed[i] = lseed[i][1:3]\ndata_xgb[\"Seed_x\"] = Wseed\ndata_xgb[\"Seed_y\"] = Lseed","72e9e836":"data_xgb[\"Score_diff\"] = data_xgb[\"Score_x\"]-data_xgb[\"Score_y\"]\ndata_xgb[\"FGM_diff\"] = data_xgb[\"FGM_x\"]-data_xgb[\"FGM_y\"]\ndata_xgb[\"FGA_diff\"] = data_xgb[\"FGA_x\"]-data_xgb[\"FGA_y\"]\ndata_xgb[\"Ast_diff\"] = data_xgb[\"Ast_x\"]-data_xgb[\"Ast_y\"]\ndata_xgb[\"FGM3_diff\"] = data_xgb[\"FGM3_x\"]-data_xgb[\"FGM3_y\"]\ndata_xgb[\"FGA3_diff\"] = data_xgb[\"FGA3_x\"]-data_xgb[\"FGA3_y\"]\ndata_xgb[\"FTM_diff\"] = data_xgb[\"FTM_x\"]-data_xgb[\"FTM_y\"]\ndata_xgb[\"FTA_diff\"] = data_xgb[\"FTA_x\"]-data_xgb[\"FTA_y\"]\ndata_xgb[\"OR_diff\"] = data_xgb[\"OR_x\"]-data_xgb[\"OR_y\"]\ndata_xgb[\"DR_diff\"] = data_xgb[\"DR_x\"]-data_xgb[\"DR_y\"]\ndata_xgb[\"TO_diff\"] = data_xgb[\"TO_x\"]-data_xgb[\"TO_y\"]\ndata_xgb[\"Stl_diff\"] = data_xgb[\"Stl_x\"]-data_xgb[\"Stl_y\"]\ndata_xgb[\"Blk_diff\"] = data_xgb[\"Blk_x\"]-data_xgb[\"Blk_y\"]\ndata_xgb[\"PF_diff\"] = data_xgb[\"PF_x\"]-data_xgb[\"PF_y\"]\ndata_xgb[\"Seed_diff\"] = data_xgb[\"Seed_x\"]-data_xgb[\"Seed_y\"]\n","0267a075":"data_xgb.drop(['DayNum','NumOT'],axis = 1,inplace = True)","9304a532":"trainlabel = data_xgb[data_xgb['Season']<2019]['target']\ntestlabel = data_xgb[data_xgb['Season']==2019]['target']\ntraindata = data_xgb[data_xgb['Season']<2019]\ntestdata = data_xgb[data_xgb['Season']==2019]\ndroplist = [\"Unnamed: 0\",\"LTeamID\",\"WTeamID\",\"WLoc\",\"target\",\"WScore\",\"Score_x\",\"FGM_x\",\"FGA_x\",\"FGM3_x\",\"FGA3_x\",\n            \"LScore\",\"Ast_x\",\"Ast_y\",\"FTM_x\",\"FTA_x\",\"OR_x\",\"DR_x\",\"TO_x\",\"Stl_x\",\"Blk_x\",\n           \"PF_x\",\"Score_y\",\"FGM_y\",\"FGA_y\",\"FGM3_y\",\"FGA3_y\",\"FTM_y\",\"FTA_y\",\n            \"OR_y\",\"DR_y\",\"TO_y\",\"Stl_y\",\"Blk_y\",\"PF_y\",\"Seed_x\",\"Seed_y\"]\ntraindata.drop(droplist,axis=1,inplace = True)\ntestdata.drop(droplist,axis=1,inplace = True)","4f2e0a3c":"xg_reg = xgb.XGBRegressor(objective ='binary:logistic', colsample_bytree = 0.8, learning_rate = 0.001,\n                max_depth = 10, alpha = 7, n_estimators = 50000)\nxg_reg.fit(traindata,trainlabel)","ab59fb16":"preds  = xg_reg.predict(testdata)\npreds = np.floor(preds+0.5)\nnp.sum(preds==testlabel)\/testdata.shape[0]","af818130":"MENS_DIR_2 = '..\/input\/march-madness-analytics-2020\/MDataFiles_Stage2'\nWOMENS_DIR_2 = '..\/input\/march-madness-analytics-2020\/WDataFiles_Stage2'\nMRegul_detailed = pd.read_csv(f'{MENS_DIR}\/MRegularSeasonDetailedResults.csv')\nWRegul_detailed = pd.read_csv(f'{WOMENS_DIR}\/WRegularSeasonDetailedResults.csv')\nM_Seed_stage1 = pd.read_csv(f'{MENS_DIR}\/MNCAATourneySeeds.csv')\nW_Seed_stage1 = pd.read_csv(f'{WOMENS_DIR}\/WNCAATourneySeeds.csv')\n\n","78ae1811":"seed_list = [2015,2016,2017,2018,2019]\nM_seed = M_Seed_stage1[M_Seed_stage1['Season'].isin(seed_list)]\nW_seed = W_Seed_stage1[W_Seed_stage1['Season'].isin(seed_list)]\ntime_list = [2015,2016,2017,2018,2019]\nMRegul_detailed = MRegul_detailed[MRegul_detailed['Season'].isin(time_list)]\nWRegul_detailed = WRegul_detailed[WRegul_detailed['Season'].isin(time_list)]\nwin_list = ['Season','WTeamID','WScore','WFGM', 'WFGA', 'WFGM3', 'WFGA3', 'WFTM', 'WFTA', 'WOR', 'WDR',\n       'WAst', 'WTO', 'WStl', 'WBlk', 'WPF']\nMRegul_detailed_win = MRegul_detailed[win_list]\nWRegul_detailed_win = WRegul_detailed[win_list]","5c335593":"MRegul_WinTeam_box = MRegul_detailed_win.groupby(['WTeamID','Season']).count()\nWRegul_WinTeam_box = WRegul_detailed_win.groupby(['WTeamID','Season']).count()\ndrop_list = ['WFGM', 'WFGA', 'WFGM3', 'WFGA3', 'WFTM', 'WFTA', 'WOR', 'WDR',\n       'WAst', 'WTO', 'WStl', 'WBlk', 'WPF']\nMRegul_WinTeam_box = MRegul_WinTeam_box.drop(drop_list,axis = 1)\nWRegul_WinTeam_box = WRegul_WinTeam_box.drop(drop_list,axis = 1)\nMRegul_WinTeam_box = MRegul_WinTeam_box.rename(columns = {'WScore':'count'})\nWRegul_WinTeam_box = WRegul_WinTeam_box.rename(columns = {'WScore':'count'})\nM_team_count = MRegul_WinTeam_box\nW_team_count = WRegul_WinTeam_box","406e87bf":"MRegul_WinTeam_box = MRegul_detailed_win.groupby(['WTeamID','Season']).sum()\nWRegul_WinTeam_box = WRegul_detailed_win.groupby(['WTeamID','Season']).sum()\nMRegul_WinTeam_box = MRegul_WinTeam_box.reset_index()\nWRegul_WinTeam_box = WRegul_WinTeam_box.reset_index()","6380da42":"MRegul_WinTeam_box = pd.merge(MRegul_WinTeam_box,M_team_count,on = ['Season','WTeamID'])\nWRegul_WinTeam_box = pd.merge(WRegul_WinTeam_box,W_team_count,on = ['Season','WTeamID'])\nwin_rename_columns = {'WTeamID':\"TeamID\",\"WScore\":\"Score\",'WFGM':'FGM', 'WFGA':'FGA', 'WFGM3':'FGM3', 'WFGA3':'FGA3',\n       'WFTM':'FTM', 'WFTA':'FTA', 'WOR':'OR', 'WDR':'DR', 'WAst':'Ast', 'WTO':'TO', 'WStl':'Stl', 'WBlk':'Blk', 'WPF':'PF'}\nMRegul_WinTeam_box = MRegul_WinTeam_box.rename(columns = win_rename_columns)\nWRegul_WinTeam_box = WRegul_WinTeam_box.rename(columns = win_rename_columns)","589e3524":"lose_list = ['Season','LTeamID','LScore','LFGM', 'LFGA', 'LFGM3', 'LFGA3', 'LFTM', 'LFTA', 'LOR', 'LDR',\n       'LAst', 'LTO', 'LStl', 'LBlk', 'LPF']\nMRegul_detailed_lose = MRegul_detailed[lose_list]\nWRegul_detailed_lose = WRegul_detailed[lose_list]","59512d23":"MRegul_LoseTeam_box = MRegul_detailed_lose.groupby(['LTeamID','Season']).count()\nWRegul_LoseTeam_box = WRegul_detailed_lose.groupby(['LTeamID','Season']).count()\ndrop_list = ['LFGM', 'LFGA', 'LFGM3', 'LFGA3', 'LFTM', 'LFTA', 'LOR', 'LDR',\n       'LAst', 'LTO', 'LStl', 'LBlk', 'LPF']\nMRegul_LoseTeam_box = MRegul_LoseTeam_box.drop(drop_list,axis = 1)\nWRegul_LoseTeam_box = WRegul_LoseTeam_box.drop(drop_list,axis = 1)\nMRegul_LoseTeam_box = MRegul_LoseTeam_box.rename(columns = {'LScore':'count'})\nWRegul_LoseTeam_box = WRegul_LoseTeam_box.rename(columns = {'LScore':'count'})","20394cac":"M_team_count = MRegul_LoseTeam_box\nW_team_count = WRegul_LoseTeam_box\nMRegul_LoseTeam_box = MRegul_detailed_lose.groupby(['LTeamID','Season']).sum()\nWRegul_LoseTeam_box = WRegul_detailed_lose.groupby(['LTeamID','Season']).sum()\nMRegul_LoseTeam_box = MRegul_LoseTeam_box.reset_index()\nWRegul_LoseTeam_box = WRegul_LoseTeam_box.reset_index()","ace4fa80":"MRegul_LoseTeam_box = pd.merge(MRegul_LoseTeam_box,M_team_count,on = ['Season','LTeamID'])\nWRegul_LoseTeam_box = pd.merge(WRegul_LoseTeam_box,W_team_count,on = ['Season','LTeamID'])\nlose_rename_columns = {'LTeamID':\"TeamID\",\"LScore\":\"Score\",'LFGM':'FGM', 'LFGA':'FGA', 'LFGM3':'FGM3', 'LFGA3':'FGA3',\n       'LFTM':'FTM', 'LFTA':'FTA', 'LOR':'OR', 'LDR':'DR', 'LAst':'Ast', 'LTO':'TO', 'LStl':'Stl', 'LBlk':'Blk', 'LPF':'PF'}\nMRegul_LoseTeam_box = MRegul_LoseTeam_box.rename(columns = lose_rename_columns)\nWRegul_LoseTeam_box = WRegul_LoseTeam_box.rename(columns = lose_rename_columns)","ca329164":"MRegul_Team_box = MRegul_WinTeam_box.append(MRegul_LoseTeam_box)\nWRegul_Team_box = WRegul_WinTeam_box.append(WRegul_LoseTeam_box)\nMRegul_Team_box = MRegul_Team_box.groupby(['Season','TeamID']).sum()\nWRegul_Team_box = WRegul_Team_box.groupby(['Season','TeamID']).sum()\n#MRegul_Team_box = MRegul_Team_box.reset_index()\n#WRegul_Team_box = WRegul_Team_box.reset_index()\nelement_list = ['Score','FGM','FGA','FGM3','FGA3','FTM','FTA','OR','DR','TO','Stl','Blk','PF','Ast']\nMRegul_Team_box = MRegul_Team_box[element_list].apply(lambda x:x\/MRegul_Team_box['count'])\nWRegul_Team_box = WRegul_Team_box[element_list].apply(lambda x:x\/WRegul_Team_box['count'])\nMRegul_Team_box = MRegul_Team_box.reset_index()\nWRegul_Team_box = WRegul_Team_box.reset_index()\nM_seed['Seed'] = M_seed['Seed'].apply(lambda x:x[1:3])\nW_seed['Seed'] = W_seed['Seed'].apply(lambda x:x[1:3])\nM_seed['Seed'] = pd.to_numeric(M_seed['Seed'],errors = 'ignore')\nW_seed['Seed'] = pd.to_numeric(W_seed['Seed'],errors = 'ignore')","77bba81e":"MRegul_Team_box = pd.merge(MRegul_Team_box,M_seed,on = ['Season','TeamID'],how = 'left')\nWRegul_Team_box = pd.merge(WRegul_Team_box,W_seed,on = ['Season','TeamID'],how = 'left')\n","0284174b":"def random_combination(team_list): #team_list:[68,1] \n    numTeam = len(team_list) \n    team_comb = np.zeros((numTeam*(numTeam-1)\/\/2, 2)) \n    first_col = 0 \n    second_col = 0 \n#    print(team_list)\n    for i in range(numTeam-1): \n        for ii in range(first_col,first_col+(numTeam-i-1)):\n            team_comb[ii,0] = team_list[i]\n        num_list = i+1 \n        for iii in range(second_col,second_col+(numTeam-i-1)): \n            team_comb[iii,1] = team_list[num_list]\n            num_list += 1\n        first_col = first_col+(numTeam-i-1)\n        second_col = second_col+(numTeam-i-1)\n            \n    comb = pd.DataFrame(team_comb,dtype = 'int')\n    return comb","b0549523":"#seed_list = [2015,2016,2017,2018,2019]\n#M_seed = M_Seed_stage1[M_Seed_stage1['Season'].isin(seed_list)]\n#W_seed = W_Seed_stage1[W_Seed_stage1['Season'].isin(seed_list)]\nM_seed_2015 = M_seed[M_seed['Season'] == 2015]\nW_seed_2015 = W_seed[W_seed['Season'] == 2015]\nM_seed_2016 = M_seed[M_seed['Season'] == 2016]\nW_seed_2016 = W_seed[W_seed['Season'] == 2016]\nM_seed_2017 = M_seed[M_seed['Season'] == 2017]\nW_seed_2017 = W_seed[W_seed['Season'] == 2017]\nM_seed_2018 = M_seed[M_seed['Season'] == 2018]\nW_seed_2018 = W_seed[W_seed['Season'] == 2018]\nM_seed_2019 = M_seed[M_seed['Season'] == 2019]\nW_seed_2019 = W_seed[W_seed['Season'] == 2019]","98dcae8a":"M_seedsort_2015 = M_seed_2015.sort_values(by = \"TeamID\",ascending=True) \nW_seedsort_2015 = W_seed_2015.sort_values(by = \"TeamID\",ascending=True)\nM_seedsort_2016 = M_seed_2016.sort_values(by = \"TeamID\",ascending=True)\nW_seedsort_2016 = W_seed_2016.sort_values(by = \"TeamID\",ascending=True)\nM_seedsort_2017 = M_seed_2017.sort_values(by = \"TeamID\",ascending=True)\nW_seedsort_2017 = W_seed_2017.sort_values(by = \"TeamID\",ascending=True)\nM_seedsort_2018 = M_seed_2018.sort_values(by = \"TeamID\",ascending=True)\nW_seedsort_2018 = W_seed_2018.sort_values(by = \"TeamID\",ascending=True)\nM_seedsort_2019 = M_seed_2019.sort_values(by = \"TeamID\",ascending=True)\nW_seedsort_2019 = W_seed_2019.sort_values(by = \"TeamID\",ascending=True)","0fcf3af7":"M_list_2015 = M_seedsort_2015['TeamID'].values\nW_list_2015 = W_seedsort_2015['TeamID'].values\nM_list_2016 = M_seedsort_2016['TeamID'].values\nW_list_2016 = W_seedsort_2016['TeamID'].values\nM_list_2017 = M_seedsort_2017['TeamID'].values\nW_list_2017 = W_seedsort_2017['TeamID'].values\nM_list_2018 = M_seedsort_2018['TeamID'].values\nW_list_2018 = W_seedsort_2018['TeamID'].values\nM_list_2019 = M_seedsort_2019['TeamID'].values\nW_list_2019 = W_seedsort_2019['TeamID'].values\nMNCAA_gamelist_2015 = random_combination(M_list_2015)\nWNCAA_gamelist_2015 = random_combination(W_list_2015)\nMNCAA_gamelist_2016 = random_combination(M_list_2016)\nWNCAA_gamelist_2016 = random_combination(W_list_2016)\nMNCAA_gamelist_2017 = random_combination(M_list_2017)\nWNCAA_gamelist_2017 = random_combination(W_list_2017)\nMNCAA_gamelist_2018 = random_combination(M_list_2018)\nWNCAA_gamelist_2018 = random_combination(W_list_2018)\nMNCAA_gamelist_2019 = random_combination(M_list_2019)\nWNCAA_gamelist_2019 = random_combination(W_list_2019)","1c8be652":"gamelist_rename_column = ['First_team','Second_team']\nMNCAA_gamelist_2015.columns = gamelist_rename_column\nWNCAA_gamelist_2015.columns = gamelist_rename_column\nMNCAA_gamelist_2016.columns = gamelist_rename_column\nWNCAA_gamelist_2016.columns = gamelist_rename_column\nMNCAA_gamelist_2017.columns = gamelist_rename_column\nWNCAA_gamelist_2017.columns = gamelist_rename_column\nMNCAA_gamelist_2018.columns = gamelist_rename_column\nWNCAA_gamelist_2018.columns = gamelist_rename_column\nMNCAA_gamelist_2019.columns = gamelist_rename_column\nWNCAA_gamelist_2019.columns = gamelist_rename_column","9448e8eb":"MNCAA_gamelist_2015['Season'] = 2015\nWNCAA_gamelist_2015['Season'] = 2015\nMNCAA_gamelist_2016['Season'] = 2016\nWNCAA_gamelist_2016['Season'] = 2016\nMNCAA_gamelist_2017['Season'] = 2017\nWNCAA_gamelist_2017['Season'] = 2017\nMNCAA_gamelist_2018['Season'] = 2018\nWNCAA_gamelist_2018['Season'] = 2018\nMNCAA_gamelist_2019['Season'] = 2019\nWNCAA_gamelist_2019['Season'] = 2019\norder = ['Season','First_team','Second_team']\nMNCAA_gamelist_2015 = MNCAA_gamelist_2015[order]\nWNCAA_gamelist_2015 = WNCAA_gamelist_2015[order]\nMNCAA_gamelist_2016 = MNCAA_gamelist_2016[order]\nWNCAA_gamelist_2016 = WNCAA_gamelist_2016[order]\nMNCAA_gamelist_2017 = MNCAA_gamelist_2017[order]\nWNCAA_gamelist_2017 = WNCAA_gamelist_2017[order]\nMNCAA_gamelist_2018 = MNCAA_gamelist_2018[order]\nWNCAA_gamelist_2018 = WNCAA_gamelist_2018[order]\nMNCAA_gamelist_2019 = MNCAA_gamelist_2019[order]\nWNCAA_gamelist_2019 = WNCAA_gamelist_2019[order]","f82c3f96":"M_gamelist = pd.concat([MNCAA_gamelist_2015,MNCAA_gamelist_2016,MNCAA_gamelist_2017,MNCAA_gamelist_2018,MNCAA_gamelist_2019])\nW_gamelist = pd.concat([WNCAA_gamelist_2015,WNCAA_gamelist_2016,WNCAA_gamelist_2017,WNCAA_gamelist_2018,WNCAA_gamelist_2019])","458fc251":"first_rename = {'TeamID':'First_team'}\nsecond_rename = {'TeamID':'Second_team'}\nM_first_team = MRegul_Team_box.rename(columns = first_rename)\nW_first_team = WRegul_Team_box.rename(columns = first_rename)\nM_second_team = MRegul_Team_box.rename(columns = second_rename)\nW_second_team = WRegul_Team_box.rename(columns = second_rename)\nMNCAA_gamebox = pd.merge(M_gamelist,M_first_team,on = ['Season','First_team'],how = 'left')\nMNCAA_gamebox = pd.merge(MNCAA_gamebox,M_second_team,on = ['Season','Second_team'],how = 'left')\nWNCAA_gamebox = pd.merge(W_gamelist,W_first_team,on = ['Season','First_team'],how = 'left')\nWNCAA_gamebox = pd.merge(WNCAA_gamebox,W_second_team,on = ['Season','Second_team'],how = 'left')\n","a1434ff8":"MNCAA_gamebox.to_csv('M_result.csv')\nWNCAA_gamebox.to_csv('W_result.csv')","0c2a1b08":"MNCAA_gamebox_diff = MNCAA_gamebox\nWNCAA_gamebox_diff = WNCAA_gamebox\n#Men\nMNCAA_gamebox_diff[\"Score_diff\"] = MNCAA_gamebox_diff[\"Score_x\"]-MNCAA_gamebox_diff[\"Score_y\"]\nMNCAA_gamebox_diff[\"FGM_diff\"] = MNCAA_gamebox_diff[\"FGM_x\"]-MNCAA_gamebox_diff[\"FGM_y\"]\nMNCAA_gamebox_diff[\"FGA_diff\"] = MNCAA_gamebox_diff[\"FGA_x\"]-MNCAA_gamebox_diff[\"FGA_y\"]\nMNCAA_gamebox_diff[\"FGM3_diff\"] = MNCAA_gamebox_diff[\"FGM3_x\"]-MNCAA_gamebox_diff[\"FGM3_y\"]\nMNCAA_gamebox_diff[\"FGA3_diff\"] = MNCAA_gamebox_diff[\"FGA3_x\"]-MNCAA_gamebox_diff[\"FGA3_y\"]\nMNCAA_gamebox_diff[\"FTM_diff\"] = MNCAA_gamebox_diff[\"FTM_x\"]-MNCAA_gamebox_diff[\"FTM_y\"]\nMNCAA_gamebox_diff[\"FTA_diff\"] = MNCAA_gamebox_diff[\"FTA_x\"]-MNCAA_gamebox_diff[\"FTA_y\"]\nMNCAA_gamebox_diff[\"OR_diff\"] = MNCAA_gamebox_diff[\"OR_x\"]-MNCAA_gamebox_diff[\"OR_y\"]\nMNCAA_gamebox_diff[\"DR_diff\"] = MNCAA_gamebox_diff[\"DR_x\"]-MNCAA_gamebox_diff[\"DR_y\"]\nMNCAA_gamebox_diff[\"TO_diff\"] = MNCAA_gamebox_diff[\"TO_x\"]-MNCAA_gamebox_diff[\"TO_y\"]\nMNCAA_gamebox_diff[\"Stl_diff\"] = MNCAA_gamebox_diff[\"Stl_x\"]-MNCAA_gamebox_diff[\"Stl_y\"]\nMNCAA_gamebox_diff[\"Ast_diff\"] = MNCAA_gamebox_diff[\"Ast_x\"]-MNCAA_gamebox_diff[\"Ast_y\"]\nMNCAA_gamebox_diff[\"Blk_diff\"] = MNCAA_gamebox_diff[\"Blk_x\"]-MNCAA_gamebox_diff[\"Blk_y\"]\nMNCAA_gamebox_diff[\"PF_diff\"] = MNCAA_gamebox_diff[\"PF_x\"]-MNCAA_gamebox_diff[\"PF_y\"]\nMNCAA_gamebox_diff[\"Seed_diff\"] = MNCAA_gamebox_diff[\"Seed_x\"]-MNCAA_gamebox_diff[\"Seed_y\"]\n#Women\nWNCAA_gamebox_diff[\"Score_diff\"] = WNCAA_gamebox_diff[\"Score_x\"]-WNCAA_gamebox_diff[\"Score_y\"]\nWNCAA_gamebox_diff[\"FGM_diff\"] = WNCAA_gamebox_diff[\"FGM_x\"]-WNCAA_gamebox_diff[\"FGM_y\"]\nWNCAA_gamebox_diff[\"FGA_diff\"] = WNCAA_gamebox_diff[\"FGA_x\"]-WNCAA_gamebox_diff[\"FGA_y\"]\nWNCAA_gamebox_diff[\"FGM3_diff\"] = WNCAA_gamebox_diff[\"FGM3_x\"]-WNCAA_gamebox_diff[\"FGM3_y\"]\nWNCAA_gamebox_diff[\"FGA3_diff\"] = WNCAA_gamebox_diff[\"FGA3_x\"]-WNCAA_gamebox_diff[\"FGA3_y\"]\nWNCAA_gamebox_diff[\"FTM_diff\"] = WNCAA_gamebox_diff[\"FTM_x\"]-WNCAA_gamebox_diff[\"FTM_y\"]\nWNCAA_gamebox_diff[\"FTA_diff\"] = WNCAA_gamebox_diff[\"FTA_x\"]-WNCAA_gamebox_diff[\"FTA_y\"]\nWNCAA_gamebox_diff[\"OR_diff\"] = WNCAA_gamebox_diff[\"OR_x\"]-WNCAA_gamebox_diff[\"OR_y\"]\nWNCAA_gamebox_diff[\"DR_diff\"] = WNCAA_gamebox_diff[\"DR_x\"]-WNCAA_gamebox_diff[\"DR_y\"]\nWNCAA_gamebox_diff[\"TO_diff\"] = WNCAA_gamebox_diff[\"TO_x\"]-WNCAA_gamebox_diff[\"TO_y\"]\nWNCAA_gamebox_diff[\"Stl_diff\"] = WNCAA_gamebox_diff[\"Stl_x\"]-WNCAA_gamebox_diff[\"Stl_y\"]\nWNCAA_gamebox_diff[\"Ast_diff\"] = WNCAA_gamebox_diff[\"Ast_x\"]-WNCAA_gamebox_diff[\"Ast_y\"]\nWNCAA_gamebox_diff[\"Blk_diff\"] = WNCAA_gamebox_diff[\"Blk_x\"]-WNCAA_gamebox_diff[\"Blk_y\"]\nWNCAA_gamebox_diff[\"PF_diff\"] = WNCAA_gamebox_diff[\"PF_x\"]-WNCAA_gamebox_diff[\"PF_y\"]\nWNCAA_gamebox_diff[\"Seed_diff\"] = WNCAA_gamebox_diff[\"Seed_x\"]-WNCAA_gamebox_diff[\"Seed_y\"]","b7fd5ed9":"drop_list = [\"Score_x\",\"FGM_x\",\"FGA_x\",\"FGM3_x\",\"FGA3_x\",\n            \"FTM_x\",\"FTA_x\",\"OR_x\",\"DR_x\",\"TO_x\",\"Ast_x\",\"Stl_x\",\"Blk_x\",\n           \"PF_x\",\"Score_y\",\"FGM_y\",\"FGA_y\",\"FGM3_y\",\"FGA3_y\",\"FTM_y\",\"FTA_y\",\n            \"OR_y\",\"DR_y\",\"TO_y\",\"Ast_y\",\"Stl_y\",\"Blk_y\",\"PF_y\",\"Seed_x\",\"Seed_y\"]\nMNCAA_gamebox_diff.drop(drop_list,axis=1,inplace = True)\nWNCAA_gamebox_diff.drop(drop_list,axis=1,inplace = True)","52d4fbcc":"MNCAA_gamebox_diff.to_csv('M_result_diff.csv')\nWNCAA_gamebox_diff.to_csv('W_result_diff.csv')","ca7fb3de":"MNCAA_gamebox_diff","16f1732c":"MNCAA_gamebox_diff.drop(['First_team','Second_team'],axis = 1,inplace = True)","9aa0ea86":"order = ['Season', 'Score_diff', 'FGM_diff', 'FGA_diff', 'Ast_diff', 'FGM3_diff', 'FGA3_diff', 'FTM_diff', 'FTA_diff', 'OR_diff', 'DR_diff', 'TO_diff', 'Stl_diff', 'Blk_diff', 'PF_diff', 'Seed_diff']\nMNCAA_gamebox_diff = MNCAA_gamebox_diff[order]","996790f1":"ypred=xg_reg.predict(MNCAA_gamebox_diff)","eab15c75":"ypred","f906a919":"!pip install pygam","79e9215d":"from pygam import LinearGAM,f,s,l\nimport eli5\nfrom eli5.sklearn import PermutationImportance","abcd5889":"X=x_train\ny=y_train","74bf8e9a":"# perform LASSO CV\n# Note that the regularization strength is denoted by alpha in sklearn.\nfrom sklearn import linear_model\ncv = 10\nlassocv = linear_model.LassoCV(cv=cv)\nlassocv.fit(X, y)\nprint('alpha =',lassocv.alpha_.round(4))","c6fcda52":"# draw solution path\nalphas = np.logspace(-8,1,21)\nalphas_lassocv, coefs_lassocv, _ = lassocv.path(X, y, alphas=alphas)\nlog_alphas_lassocv = np.log10(alphas_lassocv)\n\nplt.figure(figsize=(12,8)) \nplt.plot(log_alphas_lassocv,coefs_lassocv.T)\nplt.vlines(x=np.log10(lassocv.alpha_), ymin=np.min(coefs_lassocv), ymax=np.max(coefs_lassocv), \n           color='b',linestyle='-.',label = 'alpha chosen')\nplt.axhline(y=0, color='black',linestyle='--')\nplt.xlabel(r'$\\log_{10}(\\alpha)$', fontsize=12)\nplt.ylabel(r'$\\hat{\\beta}$', fontsize=12, rotation=0)\nplt.title('Solution Path',fontsize=12)\nplt.legend()\nplt.show()","54e0c751":"\n# fit a multiple layer percepton (neural network)\nfrom sklearn.neural_network import MLPClassifier\nnames=df_train.drop('target',axis=1).columns\nnames=list(names)\nclf = MLPClassifier(max_iter=1000, random_state=0)\nclf.fit(X, y)\n# define a permutation importance object\nperm = PermutationImportance(clf).fit(X, y)\n# show the importance\neli5.show_weights(perm, feature_names=names)","1a4bb9eb":"df_train[['Seeddiff','Score_y','FGM_y','FGA_y','FTM_x','FTA_x']].values\nx_train =df_train[['Seeddiff','Score_y','FGM_y','FGA_y','FTM_x','FTA_x']].values\nx_test =df_test[['Seeddiff','Score_y','FGM_y','FGA_y','FTM_x','FTA_x']].values\nnames = ['Seeddiff','Score_y','FGM_y','FGA_y','FTM_x','FTA_x']","b809f734":"from pygam import LogisticGAM,f,s,l\n\ngam = LogisticGAM().fit(x_train,y_train)\n# f: factor term\n# some parameters combinations in grid search meet the error exception.\ngam.gridsearch(x_train,y_train)","ac81222d":"# plotting\nfig, axs = plt.subplots(2,3,figsize=(20,8))\nfor i, ax in enumerate(axs.flatten()):\n    XX = gam.generate_X_grid(term=i)\n    plt.subplot(ax)\n    plt.plot(XX[:, i], gam.partial_dependence(term=i, X=XX))\n    plt.plot(XX[:, i], gam.partial_dependence(term=i, X=XX, width=.95)[1], c='grey', ls='--')\n    plt.title(names[i])","a0df67d7":"y_pred_train = gam.predict(x_train)\ny_pred_test = gam.predict(x_test)\n\nprint('The Acc on training set:',accuracy_score(y_train,y_pred_train))\nprint('The Acc on testing set:',accuracy_score(y_test,y_pred_test))","74174030":"X=x_train_W\ny=y_train_W","f36ebb1f":"# perform LASSO CV\n# Note that the regularization strength is denoted by alpha in sklearn.\nfrom sklearn import linear_model\ncv = 10\nlassocv = linear_model.LassoCV(cv=cv)\nlassocv.fit(X, y)\nprint('alpha =',lassocv.alpha_.round(4))","12d164ac":"# draw solution path\nalphas = np.logspace(-8,1,21)\nalphas_lassocv, coefs_lassocv, _ = lassocv.path(X, y, alphas=alphas)\nlog_alphas_lassocv = np.log10(alphas_lassocv)\n\nplt.figure(figsize=(12,8)) \nplt.plot(log_alphas_lassocv,coefs_lassocv.T)\nplt.vlines(x=np.log10(lassocv.alpha_), ymin=np.min(coefs_lassocv), ymax=np.max(coefs_lassocv), \n           color='b',linestyle='-.',label = 'alpha chosen')\nplt.axhline(y=0, color='black',linestyle='--')\nplt.xlabel(r'$\\log_{10}(\\alpha)$', fontsize=12)\nplt.ylabel(r'$\\hat{\\beta}$', fontsize=12, rotation=0)\nplt.title('Solution Path',fontsize=12)\nplt.legend()\nplt.show()","df7008c0":"# fit a multiple layer percepton (neural network)\nfrom sklearn.neural_network import MLPClassifier\nnames=df_train.drop('target',axis=1).columns\nnames=list(names)\nclf = MLPClassifier(max_iter=1000, random_state=0)\nclf.fit(X, y)\n# define a permutation importance object\nperm = PermutationImportance(clf).fit(X, y)\n# show the importance\neli5.show_weights(perm, feature_names=names)","c3fb38f9":"x_train =df_train[['Seeddiff','Score_y','FGM_y','FGA_y','FTM_x','FTA_x']].values\nx_test =df_test[['Seeddiff','Score_y','FGM_y','FGA_y','FTM_x','FTA_x']].values\nnames = ['Seeddiff','Score_y','FGM_y','FGA_y','FTM_x','FTA_x']\ngam = LogisticGAM().fit(x_train,y_train)\n# f: factor term\n# some parameters combinations in grid search meet the error exception.\ngam.gridsearch(x_train_W,y_train_W)","1957db28":"# plotting\nfig, axs = plt.subplots(2,3,figsize=(20,8))\nfor i, ax in enumerate(axs.flatten()):\n    XX = gam.generate_X_grid(term=i)\n    plt.subplot(ax)\n    plt.plot(XX[:, i], gam.partial_dependence(term=i, X=XX))\n    plt.plot(XX[:, i], gam.partial_dependence(term=i, X=XX, width=.95)[1], c='grey', ls='--')\n    plt.title(names[i])\nplt.tight_layout()","6171127c":"y_pred_train = gam.predict(x_train)\ny_pred_test = gam.predict(x_test)\n\nprint('The Acc on training set:',accuracy_score(y_train,y_pred_train))\nprint('The Acc on testing set:',accuracy_score(y_test,y_pred_test))","5a027049":"MENS_DIR_player = '..\/input\/march-madness-analytics-2020\/2020DataFiles\/2020DataFiles\/2020-Mens-Data'\nWOMENS_DIR_player = '..\/input\/march-madness-analytics-2020\/2020DataFiles\/2020DataFiles\/2020-Womens-Data'\nM_players = pd.read_csv(f'{MENS_DIR_player}\/MPlayers.csv')\nW_players = pd.read_csv(f'{WOMENS_DIR_player}\/WPlayers.csv')","85c2f6aa":"def high_order_stats(event_by_player):\n    event_by_player['Points'] = event_by_player['made1']+2*event_by_player['made2']+3*event_by_player['made3']\n    element_list = ['assist','block','foul','made1','made2','made3','miss1','miss2','miss3',\n               'reb','steal','sub','timeout','turnover','Points']\n    for item in element_list:\n        event_by_player[item] = event_by_player[item]\/event_by_player['count']\n    event_by_player['Field_goal'] = (event_by_player['made2']+\n                                 event_by_player['made3'])\/(event_by_player['made2']+\n                                                            event_by_player['made3']+\n                                                           event_by_player['miss2']+\n                                                            event_by_player['miss3'])\n    event_by_player['FT_goal'] = event_by_player['made1']\/(event_by_player['miss1']+event_by_player['made1'])\n    event_by_player['3PT'] = event_by_player['made3']\/(event_by_player['miss3']+event_by_player['made3'])\n    # assist vs turnover\n    event_by_player['AT'] = event_by_player['assist']\/event_by_player['turnover']\n    event_by_player['eFG'] = (event_by_player['made2']+\n                          0.5*event_by_player['made3'])\/(event_by_player['made2']+\n                                                         event_by_player['made3']+\n                                                         event_by_player['miss2']+\n                                                         event_by_player['miss3'])\n    event_by_player['TS'] = event_by_player['Points']\/(2*((event_by_player['made2']+\n                                                         event_by_player['made3']+\n                                                         event_by_player['miss2']+\n                                                         event_by_player['miss3'])\n                                                      +0.44*(event_by_player['made1']+\n                                                         event_by_player['made1'])))\n    event_by_player['PER'] = (event_by_player['Points']+event_by_player['assist']+event_by_player['reb']+event_by_player['steal']+\n                         event_by_player['block']-event_by_player['miss1']-event_by_player['turnover'])\/event_by_player['count']\n    return event_by_player\n    \n\nmkdir('mens_stats')\nmkdir('womens_stats')","8bf50337":"# year of stats\nyear = 2015\nfor year in range(2015,2020):\n    M_events = pd.read_csv(f'{MENS_DIR_player}\/MEvents{year}.csv')\n    W_events = pd.read_csv(f'{WOMENS_DIR_player}\/WEvents{year}.csv')\n    M_game_made = M_events[['DayNum','EventPlayerID']]\n    W_game_made = W_events[['DayNum','EventPlayerID']]\n    M_game_made['count'] = 0\n    W_game_made['count'] = 0\n    M_game_made = M_game_made.drop_duplicates()\n    W_game_made = W_game_made.drop_duplicates()\n    M_game_made = M_game_made.groupby(['EventPlayerID']).count()\n    M_game_made.reset_index(inplace = True)\n    W_game_made = W_game_made.groupby(['EventPlayerID']).count()\n    W_game_made.reset_index(inplace = True)\n    M_game_made.drop(index = 0,inplace = True)\n    W_game_made.drop(index = 0,inplace = True)\n    M_game_made = M_game_made[['EventPlayerID','count']]\n    W_game_made = W_game_made[['EventPlayerID','count']]\n    M_events_useful = M_events[['EventPlayerID','EventType']]\n    W_events_useful = W_events[['EventPlayerID','EventType']]\n    M_events_useful['count'] = 0\n    W_events_useful['count'] = 0\n    M_events_useful = M_events_useful.groupby(['EventPlayerID','EventType']).count()\n    W_events_useful = W_events_useful.groupby(['EventPlayerID','EventType']).count()\n    M_events_reindex = M_events_useful.reset_index()\n    W_events_reindex = W_events_useful.reset_index()\n    M_events_pivoted=M_events_reindex.pivot('EventPlayerID', 'EventType', 'count')\n    W_events_pivoted=W_events_reindex.pivot('EventPlayerID', 'EventType', 'count')\n    M_event_by_player = M_events_pivoted.fillna(0)\n    W_event_by_player = W_events_pivoted.fillna(0)\n    M_event_by_player = M_event_by_player.drop(index = 0)\n    W_event_by_player = W_event_by_player.drop(index = 0)\n    M_event_by_player = pd.merge(M_event_by_player, M_game_made,on = 'EventPlayerID')\n    W_event_by_player = pd.merge(W_event_by_player, W_game_made,on = 'EventPlayerID')\n    M_event_by_player = high_order_stats(M_event_by_player)\n    W_event_by_player = high_order_stats(W_event_by_player)\n    M_players.rename(columns = {'PlayerID':'EventPlayerID'},inplace = True)\n    W_players.rename(columns = {'PlayerID':'EventPlayerID'},inplace = True)\n\n    M_player_stats = pd.merge(M_players,M_event_by_player,on = 'EventPlayerID',how = 'left')\n    W_player_stats = pd.merge(W_players,W_event_by_player,on = 'EventPlayerID',how = 'left')\n    M_player_stats = M_player_stats.fillna(0)\n    W_player_stats = W_player_stats.fillna(0)\n    \n    \n    M_player_stats.to_csv(f'mens_stats\/M_player_stats_{year}.csv')\n    W_player_stats.to_csv(f'womens_stats\/W_player_stats_{year}.csv')","3b50c7e0":"def pre_processer(df):\n    player_information=df.iloc[:,0:4]\n    EventPlayerID=player_information['EventPlayerID']\n    df=df.drop(['EventPlayerID','LastName','FirstName'],axis=1)\n    df[df==0]=np.nan\n    pd.isnull(df)\n    df=df.dropna(how='all')\n    df.tail()\n    df.insert(0,'EventPlayerID',EventPlayerID)\n    df=pd.merge(player_information, df, on='EventPlayerID')\n    return df\n\ndef Team_member(df):\n    number_of_teamplayer=Counter(df['TeamID'])\n    #number=list(number_of_tramplayer)\n    number=number_of_teamplayer.values()\n    number=list(number)\n    np.shape(number)\n    \n    return number\n\ndef TeamID_made(df):\n    TeamID=list(df.drop_duplicates(['TeamID']).TeamID)\n    k=len(TeamID)\n    \n    return TeamID\n\ndef calculator_advanced(i,df,TeamID): \n    df1=df[df['TeamID']==TeamID[i]][['AT','eFG','TS','PER']].sum()\n    #df_sum=df1.append([df2,df3,df4],ignore_index = False)\n    df_sum=pd.DataFrame(df1,columns=[TeamID[i]])\n    return df_sum\n\ndef sum_final(df,k,TeamID):\n    df[df['AT']>10000]=0\n    # k=len(TeamID)\n    df_sum_final=calculator_advanced(0,df,TeamID)\n    for i in range (1,k):\n        df_temp=calculator_advanced(i,df,TeamID)\n        df_sum_final=pd.concat([df_sum_final,df_temp],axis=1)\n        #df_sum_final=df_sum_final.append([df_temp],ignore_index = False)\n    return df_sum_final","7e4eaa7d":"from collections import Counter\nimport warnings\nwarnings.filterwarnings('ignore')\n\ndf_2015=pd.read_csv(\"mens_stats\/M_player_stats_2015.csv\")\ndf_2016=pd.read_csv(\"mens_stats\/M_player_stats_2016.csv\")\ndf_2017=pd.read_csv(\"mens_stats\/M_player_stats_2017.csv\")\ndf_2018=pd.read_csv(\"mens_stats\/M_player_stats_2018.csv\")\ndf_2019=pd.read_csv(\"mens_stats\/M_player_stats_2019.csv\")","572df7da":"df_2015=pre_processer(df_2015)\nnumber_2015=Team_member(df_2015)\nTeamID_2015=TeamID_made(df_2015)\nk_2015=len(TeamID_2015)\ndf_sum_final_2015=sum_final(df_2015,k_2015,TeamID_2015)\nfor i in range(k_2015):\n    df_sum_final_2015.iloc[:,i]=df_sum_final_2015.iloc[:,i]\/number_2015[i]\n\ndf_2016=pre_processer(df_2016)\nnumber_2016=Team_member(df_2016)\nTeamID_2016=TeamID_made(df_2016)\nk_2016=len(TeamID_2016)\ndf_sum_final_2016=sum_final(df_2016,k_2016,TeamID_2016)\nfor i in range(k_2016):\n    df_sum_final_2016.iloc[:,i]=df_sum_final_2016.iloc[:,i]\/number_2016[i]\n\ndf_2017=pre_processer(df_2017)\nnumber_2017=Team_member(df_2017)\nTeamID_2017=TeamID_made(df_2017)\nk_2017=len(TeamID_2017)\ndf_sum_final_2017=sum_final(df_2017,k_2017,TeamID_2017)\nfor i in range(k_2017):\n    df_sum_final_2017.iloc[:,i]=df_sum_final_2017.iloc[:,i]\/number_2017[i]\n    \ndf_2018=pre_processer(df_2018)\nnumber_2018=Team_member(df_2018)\nTeamID_2018=TeamID_made(df_2018)\nk_2018=len(TeamID_2018)\ndf_sum_final_2018=sum_final(df_2018,k_2018,TeamID_2018)\nfor i in range(k_2018):\n    df_sum_final_2018.iloc[:,i]=df_sum_final_2018.iloc[:,i]\/number_2018[i]\n\ndf_2019=pre_processer(df_2019)\nnumber_2019=Team_member(df_2019)\nTeamID_2019=TeamID_made(df_2019)\nk_2019=len(TeamID_2019)\ndf_sum_final_2019=sum_final(df_2019,k_2019,TeamID_2019)\nfor i in range(k_2019):\n    df_sum_final_2019.iloc[:,i]=df_sum_final_2019.iloc[:,i]\/number_2019[i]\ndf_sum_final_2019.tail()","b7d087ad":"mkdir('player_as')","ca947bd2":"df_sum_final_2015.to_csv('player_as\/df_sum_final_2015.csv')\ndf_sum_final_2016.to_csv('player_as\/df_sum_final_2016.csv')\ndf_sum_final_2017.to_csv('player_as\/df_sum_final_2017.csv')\ndf_sum_final_2018.to_csv('player_as\/df_sum_final_2018.csv')\ndf_sum_final_2019.to_csv('player_as\/df_sum_final_2019.csv')\ndf_target=pd.read_csv(\"M_result_by_game_tourney_editored.csv\")\ndf_target=df_target[['Season','WTeamID','LTeamID','target']]","be3e3048":"def preprocess_win(df,i,TeamID):\n    df_new=df.T\n    df_new.columns=[['AT_win','eFG_win','TS_win','PER_win']]\n    df_new['Season']=i\n    df_new['WTeamID']=TeamID\n    \n    return df_new\n\ndef preprocess_lose(df,i,TeamID):\n    df_new=df.T\n    df_new.columns=[['AT_lose','eFG_lose','TS_lose','PER_lose']]\n    df_new['Season']=i\n    df_new['LTeamID']=TeamID\n    \n    return df_new","581c6dd7":"df_2015_new_win=preprocess_win(df_sum_final_2015,2015,TeamID_2015)\ndf_2016_new_win=preprocess_win(df_sum_final_2016,2016,TeamID_2016)\ndf_2017_new_win=preprocess_win(df_sum_final_2017,2017,TeamID_2017)\ndf_2018_new_win=preprocess_win(df_sum_final_2018,2018,TeamID_2018)\ndf_2019_new_win=preprocess_win(df_sum_final_2019,2019,TeamID_2019)\ndf_2015_new_lose=preprocess_lose(df_sum_final_2015,2015,TeamID_2015)\ndf_2016_new_lose=preprocess_lose(df_sum_final_2016,2016,TeamID_2016)\ndf_2017_new_lose=preprocess_lose(df_sum_final_2017,2017,TeamID_2017)\ndf_2018_new_lose=preprocess_lose(df_sum_final_2018,2018,TeamID_2018)\ndf_2019_new_lose=preprocess_lose(df_sum_final_2019,2019,TeamID_2019)","03f86270":"df1=df_2015_new_win.append(df_2016_new_win)\ndf2=df1.append(df_2017_new_win)\ndf3=df2.append(df_2018_new_win)\ndf4=df3.append(df_2019_new_win)\ndf_final_win=df4","69051754":"df1=df_2015_new_lose.append(df_2016_new_lose)\ndf2=df1.append(df_2017_new_lose)\ndf3=df2.append(df_2018_new_lose)\ndf4=df3.append(df_2019_new_lose)\ndf_final_lose=df4","ee8cb66e":"df_final_win.columns=df_final_win.columns.get_level_values(0)","7586c0bb":"#\u7b2c\u4e00\u53e5\u8bdd\u4e0d\u88ab\u8fd0\u884c\u662f\u7b2c\u4e00\u6b21\u7684\u65f6\u5019\u624d\u7528\uff1a\ndf_target_new=pd.merge(df_target,df_final_win,on = ['Season','WTeamID'],how='left')\ndf_final_lose.columns=df_final_lose.columns.get_level_values(0)\ndf_target_new=pd.merge(df_target_new,df_final_lose,on = ['Season','LTeamID'],how='left')","14048e41":"df_target_new.to_csv('with_advanced_stat.csv')\ndf_2015=pd.read_csv(\"womens_stats\/W_player_stats_2015.csv\")\ndf_2016=pd.read_csv(\"womens_stats\/W_player_stats_2016.csv\")\ndf_2017=pd.read_csv(\"womens_stats\/W_player_stats_2017.csv\")\ndf_2018=pd.read_csv(\"womens_stats\/W_player_stats_2018.csv\")\ndf_2019=pd.read_csv(\"womens_stats\/W_player_stats_2019.csv\")","0de99146":"df_2015=pre_processer(df_2015)\nnumber_2015=Team_member(df_2015)\nTeamID_2015=TeamID_made(df_2015)\nk_2015=len(TeamID_2015)\ndf_sum_final_2015=sum_final(df_2015,k_2015,TeamID_2015)\nfor i in range(k_2015):\n    df_sum_final_2015.iloc[:,i]=df_sum_final_2015.iloc[:,i]\/number_2015[i]\n\ndf_2016=pre_processer(df_2016)\nnumber_2016=Team_member(df_2016)\nTeamID_2016=TeamID_made(df_2016)\nk_2016=len(TeamID_2016)\ndf_sum_final_2016=sum_final(df_2016,k_2016,TeamID_2016)\nfor i in range(k_2016):\n    df_sum_final_2016.iloc[:,i]=df_sum_final_2016.iloc[:,i]\/number_2016[i]\n\ndf_2017=pre_processer(df_2017)\nnumber_2017=Team_member(df_2017)\nTeamID_2017=TeamID_made(df_2017)\nk_2017=len(TeamID_2017)\ndf_sum_final_2017=sum_final(df_2017,k_2017,TeamID_2017)\nfor i in range(k_2017):\n    df_sum_final_2017.iloc[:,i]=df_sum_final_2017.iloc[:,i]\/number_2017[i]\n    \ndf_2018=pre_processer(df_2018)\nnumber_2018=Team_member(df_2018)\nTeamID_2018=TeamID_made(df_2018)\nk_2018=len(TeamID_2018)\ndf_sum_final_2018=sum_final(df_2018,k_2018,TeamID_2018)\nfor i in range(k_2018):\n    df_sum_final_2018.iloc[:,i]=df_sum_final_2018.iloc[:,i]\/number_2018[i]\n\ndf_2019=pre_processer(df_2019)\nnumber_2019=Team_member(df_2019)\nTeamID_2019=TeamID_made(df_2019)\nk_2019=len(TeamID_2019)\ndf_sum_final_2019=sum_final(df_2019,k_2019,TeamID_2019)\nfor i in range(k_2019):\n    df_sum_final_2019.iloc[:,i]=df_sum_final_2019.iloc[:,i]\/number_2019[i]\ndf_sum_final_2019.tail()","5117293e":"df_sum_final_2015.to_csv('player_as\/W_df_sum_final_2015.csv')\ndf_sum_final_2016.to_csv('player_as\/W_df_sum_final_2016.csv')\ndf_sum_final_2017.to_csv('player_as\/W_df_sum_final_2017.csv')\ndf_sum_final_2018.to_csv('player_as\/W_df_sum_final_2018.csv')\ndf_sum_final_2019.to_csv('player_as\/W_df_sum_final_2019.csv')","c401ee9d":"df_target=pd.read_csv(\"W_result_by_game_tourney_editored.csv\")\ndf_target=df_target[['Season','WTeamID','LTeamID','target']]","6aa18da9":"df_2015_new_win=preprocess_win(df_sum_final_2015,2015,TeamID_2015)\ndf_2016_new_win=preprocess_win(df_sum_final_2016,2016,TeamID_2016)\ndf_2017_new_win=preprocess_win(df_sum_final_2017,2017,TeamID_2017)\ndf_2018_new_win=preprocess_win(df_sum_final_2018,2018,TeamID_2018)\ndf_2019_new_win=preprocess_win(df_sum_final_2019,2019,TeamID_2019)\ndf_2015_new_lose=preprocess_lose(df_sum_final_2015,2015,TeamID_2015)\ndf_2016_new_lose=preprocess_lose(df_sum_final_2016,2016,TeamID_2016)\ndf_2017_new_lose=preprocess_lose(df_sum_final_2017,2017,TeamID_2017)\ndf_2018_new_lose=preprocess_lose(df_sum_final_2018,2018,TeamID_2018)\ndf_2019_new_lose=preprocess_lose(df_sum_final_2019,2019,TeamID_2019)","3003b797":"df1=df_2015_new_win.append(df_2016_new_win)\ndf2=df1.append(df_2017_new_win)\ndf3=df2.append(df_2018_new_win)\ndf4=df3.append(df_2019_new_win)\ndf_final_win=df4\n\ndf1=df_2015_new_lose.append(df_2016_new_lose)\ndf2=df1.append(df_2017_new_lose)\ndf3=df2.append(df_2018_new_lose)\ndf4=df3.append(df_2019_new_lose)\ndf_final_lose=df4","2392c680":"df_final_win.columns=df_final_win.columns.get_level_values(0)\n#\u7b2c\u4e00\u53e5\u8bdd\u4e0d\u88ab\u8fd0\u884c\u662f\u7b2c\u4e00\u6b21\u7684\u65f6\u5019\u624d\u7528\uff1a\ndf_target_new=pd.merge(df_target,df_final_win,on = ['Season','WTeamID'],how='left')\ndf_target_new.tail()","9f2695f2":"df_final_lose.columns=df_final_lose.columns.get_level_values(0)\ndf_target_new_W=pd.merge(df_target_new,df_final_lose,on = ['Season','LTeamID'],how='left')\ndf_target_new_W.to_csv('W_with_advanced_stat.csv')","6c05e6c8":"df=df_target_new\n#order=['Season','WTeamID','LTeamID','AT_win','eFG_win','TS_win','PER_win','AT_lose','eFG_lose','TS_lose','PER_lose','target']\ntarget=df['target']\ndf=df.drop('target',axis=1)\ndf['target']=target\ndf.tail()","4e0cf245":"df_plot=df[['target','AT_win','eFG_win','TS_win','PER_win']]\nsns.pairplot(df_plot, hue=\"target\", size=3, diag_kind=\"kde\")","ebe59ec0":"# Split the data \ndf_train=df[df['Season']<2019]\ndf_test=df[df['Season']>2018]\n\ndf_train=df_train.drop(['Season','WTeamID','LTeamID'],axis=1)\ndf_test=df_test.drop(['Season','WTeamID','LTeamID'],axis=1)\n\nm,n=np.shape(df_train)\n\nx_train = df_train.iloc[:,0:n-1].values\ny_train = df_train.target.values\n\nx_test = df_test.iloc[:,0:n-1].values\ny_test = df_test.target.values","8c93fa44":"from sklearn.linear_model import LogisticRegressionCV\nfrom sklearn.metrics import accuracy_score\nlogreg = LogisticRegressionCV(cv=5,random_state=0, solver='newton-cg')\nlogreg.fit(x_train, y_train)\n\ny_pred_train = logreg.predict(x_train)\ny_pred_test = logreg.predict(x_test)\n\nprint(\"Coefficients :\", np.round(logreg.intercept_,4), np.round(logreg.coef_,4))","2b21f7bf":"y_pred_train = logreg.predict(x_train)\ny_pred_test = logreg.predict(x_test)\n\naccuracy_train = accuracy_score(y_train, y_pred_train)\naccuracy_test = accuracy_score(y_test, y_pred_test)\nprint('Accuracy on the training set =', np.round(accuracy_train,4))\nprint('Accuracy on the test set =', np.round(accuracy_test,4))","6239b0c8":"df=df_target_new_W\n#order=['Season','WTeamID','LTeamID','AT_win','eFG_win','TS_win','PER_win','AT_lose','eFG_lose','TS_lose','PER_lose','target']\ntarget=df['target']\ndf=df.drop('target',axis=1)\ndf['target']=target\ndf.tail()","fca35f64":"df_plot=df[['target','AT_win','eFG_win','TS_win','PER_win']]\nsns.pairplot(df_plot, hue=\"target\", size=3, diag_kind=\"kde\")","18024335":"# Split the data \ndf_train=df[df['Season']<2019]\ndf_test=df[df['Season']>2018]\n\ndf_train=df_train.drop(['Season','WTeamID','LTeamID'],axis=1)\ndf_test=df_test.drop(['Season','WTeamID','LTeamID'],axis=1)\n\nm,n=np.shape(df_train)\n\nx_train = df_train.iloc[:,0:n-1].values\ny_train = df_train.target.values\n\nx_test = df_test.iloc[:,0:n-1].values\ny_test = df_test.target.values","33eb344c":"from sklearn.linear_model import LogisticRegressionCV\nfrom sklearn.metrics import accuracy_score\nlogreg = LogisticRegressionCV(cv=5,random_state=0, solver='newton-cg')\nlogreg.fit(x_train, y_train)\n\ny_pred_train = logreg.predict(x_train)\ny_pred_test = logreg.predict(x_test)\n\nprint(\"Coefficients :\", np.round(logreg.intercept_,4), np.round(logreg.coef_,4))","7e27b205":"y_pred_train = logreg.predict(x_train)\ny_pred_test = logreg.predict(x_test)\n\naccuracy_train = accuracy_score(y_train, y_pred_train)\naccuracy_test = accuracy_score(y_test, y_pred_test)\nprint('Accuracy on the training set =', np.round(accuracy_train,4))\nprint('Accuracy on the test set =', np.round(accuracy_test,4))","b2c47388":"df_2015=df_2015[['AT','eFG','TS','PER','TeamID']]\ndf_2016=df_2016[['AT','eFG','TS','PER','TeamID']]\ndf_2017=df_2017[['AT','eFG','TS','PER','TeamID']]\ndf_2018=df_2018[['AT','eFG','TS','PER','TeamID']]\ndf_2019=df_2019[['AT','eFG','TS','PER','TeamID']]","137b7432":"coef=np.round(logreg.coef_,4)\ncoef[0][0:4]","f24514c6":"def project(df):\n    df_player_influence=0\n    for i in range(4):  \n        df_player_influence=coef[0][i]*df.iloc[:,i]+df_player_influence\n    df['player_influence']=df_player_influence\n    return df","656f074f":"df_2015_new=project(df_2015)\ndf_2016_new=project(df_2016)\ndf_2017_new=project(df_2017)\ndf_2018_new=project(df_2018)\ndf_2019_new=project(df_2019)\n\ndf_2015_new.dropna(axis=0,how='any',inplace=True)\ndf_2016_new.dropna(axis=0,how='any',inplace=True)\ndf_2017_new.dropna(axis=0,how='any',inplace=True)\ndf_2018_new.dropna(axis=0,how='any',inplace=True)\ndf_2019_new.dropna(axis=0,how='any',inplace=True)","c79d854b":"from collections import Counter\nimport warnings\nwarnings.filterwarnings('ignore')\n\ndf_2015=pd.read_csv(\"mens_stats\/M_player_stats_2015.csv\")\ndf_2016=pd.read_csv(\"mens_stats\/M_player_stats_2016.csv\")\ndf_2017=pd.read_csv(\"mens_stats\/M_player_stats_2017.csv\")\ndf_2018=pd.read_csv(\"mens_stats\/M_player_stats_2018.csv\")\ndf_2019=pd.read_csv(\"mens_stats\/M_player_stats_2019.csv\")","df14ed1f":"df_2015=pre_processer(df_2015)\nnumber_2015=Team_member(df_2015)\nTeamID_2015=TeamID_made(df_2015)\nk_2015=len(TeamID_2015)\ndf_sum_final_2015=sum_final(df_2015,k_2015,TeamID_2015)\nfor i in range(k_2015):\n    df_sum_final_2015.iloc[:,i]=df_sum_final_2015.iloc[:,i]\/number_2015[i]\n\ndf_2016=pre_processer(df_2016)\nnumber_2016=Team_member(df_2016)\nTeamID_2016=TeamID_made(df_2016)\nk_2016=len(TeamID_2016)\ndf_sum_final_2016=sum_final(df_2016,k_2016,TeamID_2016)\nfor i in range(k_2016):\n    df_sum_final_2016.iloc[:,i]=df_sum_final_2016.iloc[:,i]\/number_2016[i]\n\ndf_2017=pre_processer(df_2017)\nnumber_2017=Team_member(df_2017)\nTeamID_2017=TeamID_made(df_2017)\nk_2017=len(TeamID_2017)\ndf_sum_final_2017=sum_final(df_2017,k_2017,TeamID_2017)\nfor i in range(k_2017):\n    df_sum_final_2017.iloc[:,i]=df_sum_final_2017.iloc[:,i]\/number_2017[i]\n    \ndf_2018=pre_processer(df_2018)\nnumber_2018=Team_member(df_2018)\nTeamID_2018=TeamID_made(df_2018)\nk_2018=len(TeamID_2018)\ndf_sum_final_2018=sum_final(df_2018,k_2018,TeamID_2018)\nfor i in range(k_2018):\n    df_sum_final_2018.iloc[:,i]=df_sum_final_2018.iloc[:,i]\/number_2018[i]\n\ndf_2019=pre_processer(df_2019)\nnumber_2019=Team_member(df_2019)\nTeamID_2019=TeamID_made(df_2019)\nk_2019=len(TeamID_2019)\ndf_sum_final_2019=sum_final(df_2019,k_2019,TeamID_2019)\nfor i in range(k_2019):\n    df_sum_final_2019.iloc[:,i]=df_sum_final_2019.iloc[:,i]\/number_2019[i]","51ba0c3a":"df_2015=df_2015[['AT','eFG','TS','PER','TeamID']]\ndf_2016=df_2016[['AT','eFG','TS','PER','TeamID']]\ndf_2017=df_2017[['AT','eFG','TS','PER','TeamID']]\ndf_2018=df_2018[['AT','eFG','TS','PER','TeamID']]\ndf_2019=df_2019[['AT','eFG','TS','PER','TeamID']]\n\ndf_2015_new=project(df_2015)\ndf_2016_new=project(df_2016)\ndf_2017_new=project(df_2017)\ndf_2018_new=project(df_2018)\ndf_2019_new=project(df_2019)\n\ndf_2015_new.dropna(axis=0,how='any',inplace=True)\ndf_2016_new.dropna(axis=0,how='any',inplace=True)\ndf_2017_new.dropna(axis=0,how='any',inplace=True)\ndf_2018_new.dropna(axis=0,how='any',inplace=True)\ndf_2019_new.dropna(axis=0,how='any',inplace=True)","a3cb3eed":"def impact_object(df):\n    df_influence = df[df['player_influence']>0]\n    df_influence=df_influence['player_influence']\n    \n    return df_influence","2a1041c3":"def impact(df):\n    tstat2015=df\n    tstat2015[\"impact\"] = tstat2015[\"Points\"]+tstat2015[\"made1\"]+tstat2015[\"made2\"]-tstat2015[\"miss1\"]- \\\n                tstat2015[\"miss2\"]+tstat2015[\"reb\"]+tstat2015[\"assist\"]+tstat2015[\"steal\"] \\\n                +0.5*tstat2015[\"block\"]-tstat2015[\"foul\"]-tstat2015[\"turnover\"]\n    a = tstat2015[tstat2015[\"impact\"]>0]\n    a=a['impact']\n    return a","f56e1024":"tstat2015 = pd.read_csv(\"mens_stats\/M_player_stats_2015.csv\")\ntstat2016 = pd.read_csv(\"mens_stats\/M_player_stats_2016.csv\")\ntstat2017 = pd.read_csv(\"mens_stats\/M_player_stats_2017.csv\")\ntstat2018 = pd.read_csv(\"mens_stats\/M_player_stats_2018.csv\")\ntstat2019 = pd.read_csv(\"mens_stats\/M_player_stats_2019.csv\")","2484f4ee":"fig, ax = plt.subplots(5,2, figsize=(12, 16), facecolor='#f7f7f7')\n#sns.set_style(\"ticks\")\nsns.set_style(\"darkgrid\")\nsns.kdeplot(data=impact(tstat2015),ax=ax[0][0],label=\"Player_offi_2015\" ,shade=True)\nsns.kdeplot(data=impact_object(df_2015_new),ax=ax[0][1],label=\"Player_ours_2015\" ,shade=True)\n\nsns.kdeplot(data=impact(tstat2016),ax=ax[1][0],label=\"Player_offi_2016\" ,shade=True)\nsns.kdeplot(data=impact_object(df_2016_new),ax=ax[1][1],label=\"Player_ours_2016\" ,shade=True)\n\nsns.kdeplot(data=impact(tstat2017),ax=ax[2][0],label=\"Player_offi_2017\" ,shade=True)\nsns.kdeplot(data=impact_object(df_2017_new),ax=ax[2][1],label=\"Player_ours_2017\" ,shade=True)\n\nsns.kdeplot(data=impact(tstat2018),ax=ax[3][0],label=\"Player_offi_2018\" ,shade=True)\nsns.kdeplot(data=impact_object(df_2018_new),ax=ax[3][1],label=\"Player_ours_2018\" ,shade=True)\n\nsns.kdeplot(data=impact(tstat2019),ax=ax[4][0],label=\"Player_offi_2019\" ,shade=True)\nsns.kdeplot(data=impact_object(df_2019_new),ax=ax[4][1],label=\"Player_ours_2019\" ,shade=True)\n#sns.kdeplot(data=impact_object(df_2015_new),label=\"Player_influence_2015\" ,shade=True)","59a9d4a6":"a = tstat2015[tstat2015[\"impact\"]>0]\nb = a.sort_values(by = \"impact\",ascending=False)\n\nmrc = pd.read_csv(f'..\/input\/march-madness-analytics-2020\/2020DataFiles\/2020DataFiles\/2020-Mens-Data\/MDataFiles_Stage1\/MRegularSeasonCompactResults.csv')\nmrc = mrc[mrc[\"Season\"]==2015]\nw = mrc['WTeamID'].value_counts()\nl = mrc[\"LTeamID\"].value_counts()\nwinrate = w\/(w+l)\nwinrate[1246] = 1\nc = b['TeamID'].value_counts()\nnp.sum(winrate[c[0:20].index])","abfd4e96":"quantile_2015_50=df_2015_new['player_influence'].describe()['50%']\ndf_2015_thresh=np.where(df_2015_new['player_influence']<quantile_2015_50,np.nan,1)\n#df_2015_new['player_influence'].dropna(axis=0,how='any',inplace=True)\ndf_2015_new['player_influence']=df_2015_thresh\ndf_2015_compare=df_2015_new.dropna(axis=0,how='any')\ndf_2015_compare.tail()\nindex_2015=df_2015_compare['TeamID'].value_counts()\nnp.sum(winrate[index_2015[0:20].index])\n#index_2015[1:20].index","2f036fe2":"a = tstat2017[tstat2017[\"impact\"]>0]\nb = a.sort_values(by = \"impact\",ascending=False)\nmrc = pd.read_csv(f'..\/input\/march-madness-analytics-2020\/2020DataFiles\/2020DataFiles\/2020-Mens-Data\/MDataFiles_Stage1\/MRegularSeasonCompactResults.csv')\nmrc = mrc[mrc[\"Season\"]==2017]\nw = mrc['WTeamID'].value_counts()\nl = mrc[\"LTeamID\"].value_counts()\nwinrate = w\/(w+l)\n#winrate[1246] = 1\nc = b['TeamID'].value_counts()\nnp.sum(winrate[c[0:20].index])\n","4341c9fb":"quantile_2017_50=df_2017_new['player_influence'].describe()['50%']\ndf_2017_thresh=np.where(df_2017_new['player_influence']<quantile_2017_50,np.nan,1)\n#df_2015_new['player_influence'].dropna(axis=0,how='any',inplace=True)\ndf_2017_new['player_influence']=df_2017_thresh\ndf_2017_compare=df_2017_new.dropna(axis=0,how='any')\ndf_2017_compare.tail()\nindex_2017=df_2017_compare['TeamID'].value_counts()\nnp.sum(winrate[index_2017[0:20].index])","fed5a4bb":"a = tstat2019[tstat2019[\"impact\"]>0]\nb = a.sort_values(by = \"impact\",ascending=False)\nmrc = pd.read_csv(f'..\/input\/march-madness-analytics-2020\/2020DataFiles\/2020DataFiles\/2020-Mens-Data\/MDataFiles_Stage1\/MRegularSeasonCompactResults.csv')\nmrc = mrc[mrc[\"Season\"]==2019]\nw = mrc['WTeamID'].value_counts()\nl = mrc[\"LTeamID\"].value_counts()\nwinrate = w\/(w+l)\n#winrate[1246] = 1\nc = b['TeamID'].value_counts()\nnp.sum(winrate[c[0:20].index])","01cc5610":"quantile_2019_50=df_2019_new['player_influence'].describe()['50%']\ndf_2019_thresh=np.where(df_2019_new['player_influence']<quantile_2019_50,np.nan,1)\n#df_2015_new['player_influence'].dropna(axis=0,how='any',inplace=True)\ndf_2019_new['player_influence']=df_2019_thresh\ndf_2019_compare=df_2019_new.dropna(axis=0,how='any')\ndf_2019_compare.tail()\nindex_2019=df_2019_compare['TeamID'].value_counts()\nnp.sum(winrate[index_2019[0:20].index])","90b13297":"def sum_influence(df,k,TeamID,q,number):\n    # k=len(TeamID)\n    df_sum_final=[]\n    df_sum_final.append(df[df['TeamID']==TeamID[0]]['player_influence'].sum())\n    lists=['influence_2015','influence_2016','influence_2017','influence_2018','influence_2019']\n    for i in range (1,k):\n        df_temp=df[df['TeamID']==TeamID[i]]['player_influence'].sum()\n        df_sum_final.append(df_temp)\n        #df_sum_final=df_sum_final.append([df_temp],ignore_index = False)\n    df_sum_final=pd.DataFrame(df_sum_final,columns=[lists[q]])\n    for i in range(k):\n        df_sum_final.loc[i]=df_sum_final.loc[i]\/number[i]\n    return df_sum_final","e3088d9e":"team_2015_influence=sum_influence(df_2015_new,k_2015,TeamID_2015,0,number_2015)\nteam_2015_influence['Season_2015']=2015\nteam_2015_influence['TeamID']=TeamID_2015\n\nteam_2016_influence=sum_influence(df_2016_new,k_2016,TeamID_2016,1,number_2016)\nteam_2016_influence['Season_2016']=2016\nteam_2016_influence['TeamID']=TeamID_2016\n\nteam_2017_influence=sum_influence(df_2017_new,k_2017,TeamID_2017,2,number_2017)\nteam_2017_influence['Season_2017']=2017\nteam_2017_influence['TeamID']=TeamID_2017\n\nteam_2018_influence=sum_influence(df_2018_new,k_2018,TeamID_2018,3,number_2018)\nteam_2018_influence['Season_2018']=2018\nteam_2018_influence['TeamID']=TeamID_2018\n\nteam_2019_influence=sum_influence(df_2019_new,k_2019,TeamID_2019,4,number_2019)\nteam_2019_influence['Season_2019']=2019\nteam_2019_influence['TeamID']=TeamID_2019","88a66973":"df_1=pd.merge(team_2015_influence,team_2016_influence,on=['TeamID'])\ndf_2=pd.merge(df_1,team_2017_influence,on=['TeamID'])\ndf_3=pd.merge(df_2,team_2018_influence,on=['TeamID'])\ndf_final_influence=pd.merge(df_3,team_2019_influence,on=['TeamID'])\ndf_final_influence=df_final_influence.drop(['Season_2015','Season_2016','Season_2017','Season_2018','Season_2019'],axis=1)\nTeamID=df_final_influence['TeamID']\ndf_final_influence.drop(['TeamID'],axis=1,inplace=True)\ndf_final_influence.insert(0,'TeamID',TeamID)\ndf_final_influence.tail()","e7a527a7":"df_final_influence.to_csv('team_influence_time_series.csv')","76b8ab57":"!pip install pmdarima","b1949689":"import pmdarima as pm\nfrom statsmodels.tsa.arima_model import ARIMA\nfrom statsmodels.tsa.stattools import adfuller\n\ndf_input=df_final_influence.iloc[:,1:6]\ndf_input=df_input.T\ndf_input.tail()\n\n\ndef auto_arima(df,i):\n    model = pm.auto_arima(df.iloc[:,i], trace=False, error_action='ignore', suppress_warnings=True)\n    model.fit(df.iloc[:,i])\n    forecast = model.predict(n_periods=1)\n    \n    return forecast","12f0495f":"m,n=np.shape(df_input)\nresult=[]\nfor i in range(n):\n    temp=auto_arima(df_input,i)\n    result.append(temp)","9596afa6":"result=pd.DataFrame(result,columns=['prediction_2020'])\nresult=result.T","4da8bc9c":"df_output=df_input.append(result)","0dccd427":"df_output.to_csv('team_influence_prediction.csv')","53af4af1":"!pip install chart_studio\n!pip install bubbly","17c3aebb":"df_output_new=df_output.T\ndf_1=df_output_new[['influence_2015']]\ndf_1.rename(columns={'influence_2015': 'influence'}, inplace=True)\ndf_1['teamid']=TeamID\ndf_1['season']='Real'\n\ndf_2=df_output_new[['influence_2016']]\ndf_2.rename(columns={'influence_2016': 'influence'}, inplace=True)\ndf_2['teamid']=TeamID\ndf_2['season']='Real'\n\ndf_3=df_output_new[['influence_2017']]\ndf_3.rename(columns={'influence_2017': 'influence'}, inplace=True)\ndf_3['teamid']=TeamID\ndf_3['season']='Real'\n\ndf_4=df_output_new[['influence_2018']]\ndf_4.rename(columns={'influence_2018': 'influence'}, inplace=True)\ndf_4['teamid']=TeamID\ndf_4['season']='Real'\n\ndf_5=df_output_new[['influence_2019']]\ndf_5.rename(columns={'influence_2019': 'influence'}, inplace=True)\ndf_5['teamid']=TeamID\ndf_5['season']='Real'\n\ndf_6=df_output_new[['prediction_2020']]\ndf_6.rename(columns={'prediction_2020': 'influence'}, inplace=True)\ndf_6['teamid']=TeamID\ndf_6['season']='Prediction'\n\ndf_bubble=pd.concat([df_1,df_2,df_3,df_4,df_5,df_6],axis=0)\ndf_bubble\n\n#df_bubble.iloc[:,0]=df_bubble.iloc[:,0]-min(df_bubble.iloc[:,0])\ndf_bubble.reset_index(drop=True, inplace=True)\ndf_bubble.sort_values(by='influence',ascending=False,inplace=True)\ndf_bubble_plot=df_bubble.head(50)\ndf_bubble_plot.tail()","b304dd7e":"from bubbly.bubbly import bubbleplot \nfrom plotly.offline import iplot\nimport chart_studio.plotly as py\n\nfigure = bubbleplot(dataset=df_bubble_plot, x_column='teamid', y_column='influence', \n                    bubble_column='season', size_column='influence', color_column='season', \n                    x_logscale=True, scale_bubble=1, height=350)\n\niplot(figure)","7f0b9c68":"import seaborn as sns\ndf_influence = df_bubble['influence']\nplt.figure(figsize=(8,6))\nsns.set_style(\"darkgrid\")\nsns.kdeplot(data=df_influence,label=\"Team_Competitiveness\" ,shade=True)","afcec826":"# Team Influence:","00d56244":"#### Official Definition Win Rate:","69ed0667":"Our final result is as follows. This df contains two groups of information, which respectively come from two teams in the game. The columns with the subscript \"x\" are from the winning team, the columns with the subscript \"y\" are from another team. ","309db67f":"## Logistic Regression","4e2e94f3":"#### We use pairplot to show the bivariate data relation.\n#### Where we find \"target=1\" group shows a tighter convergence than \"target=0\" group. There is a different distribution of these four advanced statistics(AT,eFG,TS,PER) according to these two \"targets\", that is to say to some degree, \"target\" can be explained by these four stats. Hence, we then use Logistic Regression.","2478e45d":"#### 2019","c1a2e937":"### Same for women","cba02180":"## lasso selection","170ea3c4":"### Win rate:","96768117":"### References\n* [Comparition on differences between Men's and Women's tournaments](https:\/\/www.kaggle.com\/lucabasa\/are-men-s-and-women-s-tournaments-different)\n* [Impact index defines competiveness](http:\/\/www.kaggle.com\/lucabasa\/quantify-the-madness-a-study-of-competitiveness)","54a003b0":"## Begining of player stats mining","250a9b54":"# making submission","e2533248":"## Regression","bd66991d":"In our approach, we applied Logistic Regression, XGboost and pygam for prediction. Our goal is to estimate the winning rate of two teams in a game. Similiarly, the results of the different methods are around 0.7. When we got all the results of three models, ensembling learning is utilized to stack all the models and make a prediction for the final result. ","77238698":"## xgboost for women","0e3f2d2c":"## XGboost","b009d6de":"### 2015","2e9875cf":"#### 2017","b02621ea":"# Player Influence","60c7387c":"In this section, we hope to explore the impact of players objectively based on the avaliable data. We introduce four advanced statistics to describe the impact of teams and players. To be specific, the four advanced statistics are assist to turnover ratio (AT), effective field goal percentage (eFG), true shooting percentage (TS) and player efficiency rating (PER), which can be calculated acoordingly as,\n\nAT=ASTTOAT=ASTTO\n\neFG%=FG+(0.5\u2217FGM3)FGAeFG%=FG+(0.5\u2217FGM3)FGA\n\nTS%=PTS2(FGA+(0.44\u00d7FTA))TS%=PTS2(FGA+(0.44\u00d7FTA))\n\nPER=PTS+AST+OR+DR+Block+Stl\u2212(FGA\u2212FGM)\u2212(FTA\u2212FTM)\u2212TOmatchnumberPER=PTS+AST+OR+DR+Block+Stl\u2212(FGA\u2212FGM)\u2212(FTA\u2212FTM)\u2212TOmatchnumber\n\nBased on the four advanced statistics, however, it is still not easy to directly obtain the representation of players' impact. To solve this, considering the fact that the only labels we possess are game results of regular seasons and tournaments, we connect the players with teams. Specifically, we define the team's advanced statistics as the average of its player's advanced statistics and define team's impact as its winning percentage against other teams. We apply logistic regression to teams' advanced statistics with game results as labels and obtain the formula to calculate the winning rate. Then we apply this formula to calculate the players' impacts based on their advanced statistics.","0ee529b8":"# Limits and next steps","1073ff31":"To load the data of regular season, use 'MRegularSeasibCompactResults.csv' or 'WRegularSeasibCompactResults.csv'","fe099576":"##  Analysis by year","de9a90b1":"In this section, the goal of our task is to predict the win percentage given two teams in NCAA. Denote the response as\n\n $$response(Team X,Team Y) =\\left\\{\\begin{array}{ll}1, & \\text { Team X won}  \\\\ 0, & \\text { Team X lost}\\end{array}\\right.$$\n\nThen, it is natural to come to the Logistic Regression, which models the probability that the game result belongs to a particular category .\n  For the game result data, logistic regression method models the probability of game results. For example, the probability of game results given inputs (average score, FGM, FGA, FGM3, etc ) can be written as\n\n$$Pr(game result = Win | inputs)=Pr(response=1| inputs)$$\n\nThe values of Pr(game result = Win | inputs) ranges from 0 to 1. Then for any given values of inputs, a prediction of game result can be made.\n\n\n$$p(\\textbf{X})=\\frac{e^{\\beta_{0}+\\beta_{1} X_{1}+\\ldots +\\beta_{k} X_{k}}}{1+e^{\\beta_{0}+\\beta_{1} X_{1}+\\ldots +\\beta_{k} X_{k}}}$$\n\nIn logistic learning, we chose both teams' regular season basic detailed statistic data like average score, FGM, FGA, FGM3, FGA3, FTM, FTA, #offensive rebounds, #defensive rebounds, #assitants, #turnovers, #Steals, #Blocks, and #Personal Fouls as the inputs of the model. Besides, we supplemented Season, DayNum, and #OT to improve the performance of logistic regression model. During the training process, we selected 2015~2018 total 536 NCAA games as the training dataset, using preprocessed regular season detailed data of the two sides as the inputs and the game result categorical label of the first team as the output to training the model and get the coefficients of relevant parameters. Finally using the trained model coefficients to test on the 2019 NCAA dataset(total 134 games) and get 74.63% prediction accuracy.","9ed400a6":"#### Our Method Win Rate:","ec39436c":"To demonstrate the effect of our proposed method (denoted as ours)to calculate players' impact, we compare our method with official impact formula (denoted as offi). \nThe following graphs shows the distribution of players' impact calculated by ours and offi.","1d7907be":"#### Our Method Win Rate:","e3fe7bd5":"#### Official Definition Win Rate:","f48e036b":"XGBoost algorithm constructs a tree by adding new trees and splitting new features constantly. Adding new trees means that learning a new function to explain the left residual. Unlike logistic regression model above, we calculate the difference of major statistic data like average score, FGM, FGA, FGM3, FGA3, FTM, FTA,** offensive rebounds, defensive rebounds, assitants, turnovers, Steals, Blocks, Personal Fouls**, and Seed between two sides of every match and supplement Season, DayNum and #OT data. Same as logistic regression, using 0\/1 game result data as output to train XGBoost model. Total 436 matches in the training dataset and 134 matches in the test set. Finally we achieved 74.62% prediction accuracy.\n\nAdditionally, a benefit of using ensembles of decision tree methods like XGBoost is that they can automatically provide estimates of feature importance from a trained predictive model. Here we give some easy explanation of it. Generally, feature importance means how useful or valuable each feature was in the construction of the model. Feature importance provides a score that measures the contribution of the feature, which could be ranked and compared to each other. The detail of the feature importance calculation can be found in the book The Elements of Statistical Learning: Data Mining, Inference, and Prediction, page 367.","5d0d8f32":"## Using PyGam","b4472898":"From the graphs, we discover that the shapes of the two formulas' distribution are roughly similar. To better compare the power of ours and offi, we design an experiment as follows. We calculate the impact of each player in the above two ways, sort the top 50% and define them as \"good players\". A team tends to be more competitive when it has more \"good players\". We count the number of \"good players\" of each team and sort the top 20. These teams are chosen as competitive teams respectively by ours and offi. We calculate the actual winning rate of these teams of the picking season and sum. A higher winning rate sum means the method is better at describing the impact. The results are as follows.  ","0d18f2e7":"#### Official Definition Win Rate:","4fae0d0d":"## data for women","5f275615":"# Model Selection and Prediction","bb3bcaa1":"# Impact","4c06629b":"## same for women","4be4f6d7":"To make it more comprehensive, we also build a model including the categorical variable like #TeamRegion (values in X,Y,Z,W). Based on spline regression, this model combined discrete kernel to cope with categorical variable. The form of this model can be denoted by \n\n$$\\hat{g}(\\mathbf{x}, \\mathbf{z})=\\mathcal{B}(\\mathbf{x})^{\\mathrm{T}} \\hat{\\beta}(\\mathbf{z})$$\n\n,in which $\\mathcal{B}(\\mathbf{x})$is the tensor product B-spline and $\\hat{\\beta}(\\mathbf{z})$ is estimation with weighted least square criteria that weight is related with the categorical variable. The detail of this method can be found in the article *Spline Regression with the presence of Categorical Predictor*. \nBased on XGBoost, we choose five important features as the continuous variable in our model:\nDifference of Seed, average Score, FGM, FGM3 and TO, together with categorical variables team region of both team.\nSince the package of this method was created in R, we only present the result here. The following graph shows the relationship between $\\lambda$ and predict accuracy. Note that when $\\lambda=1$, the model is equal to spline regression and the small $\\lambda$ means the stronger influence of categorical variable.\n![2ef4f0250670b95c52b7177c4eaa29d.bmp](attachment:2ef4f0250670b95c52b7177c4eaa29d.bmp)\nTherefore, the graph shows that the use of categorical variable TeamRegion actually harm the prediction accuracy, which imply that TeamRegion does not actually matter when we predict the game result.\nAdditionally, we switched the degree of tensor product spline and found that following choice of degree result in best accuracy:\nSeedDiff(degree1),ScoreDiff(degree1),FGMDiff(degree1),FGM3Diff(degree1),TODiff(degree2)\n\nwhich on the other hand explain the power of simple model.","e255c48a":"In this part, we start to clean the data for our usage. Our ultimate goal is to estimate the team impacts and how this could lead to game results, the data we use came from the Regular Season statistics and tourney competitions from 2015 to 2019. Towards this goal, we managed to quantify the performance of various teams in every single season simply by averaging the games stats, including points, assists, rebounds, blocks, etc., that they played. ","54b61313":"### Conclusion,Limits and next Steps\n\nIn this notebook, we started with prediction of tournament results in season 2019-2020 based on some machine learning models(Logistic Regression, Xgboost and  Pygam) to find the relation between competition results with the core statistics. Doing so, we are now able to predict the competition results based on these core statistics which we have known during the regular season. Then we use an original method as objective as possible to measure players' infuence--using four advanced players' stats as inputs and competition results as targets to build logistic regression model. Our experiments verifies the superiority of our method.\n\nThere are two potential limits\n* Naturally, taking men's data as an example, our prediction accuracy can not be higher above 0.75 even when we add independent variables as much as we can or delete some uncorrelated variables intuitively. Also using \"Lasso-$L_1$ \" as our penalty, we observe that a large amount of independent variables is useless and \"MLP Classifier\" also verifies this observation. Through \"MLP Classifier\" we find that the independent variable \"Sedddiff\" is most significant than any other variable. \"Seeddiff\" seems to be dominant in prediction, hence it is hard for these model to find \"cinderellas\". Since in these models, seed_01 always wins seed_16.\n\n\n* Another limitation that we should address is that our objective method related to player influence may exist endogenous problem, since we only select four advanced stats as our logistic regression model inputs. However, it may be not enough that only include this four independent variables. For example, the omitted variable --'Score' is correlated with PER and thus results in endogenous problem.\n\nLooking ahead, we could try to remove the most significant independent variable--\"Seeddiff\" and then build the model again. It may sacrifice some accuracy but can find \"cinderellas\". Another way to find \"cinderellas\" is that define a metric subjectively to measure which team is a potential \"cinderellas\". For example, in season 2018-2019, if seed_16(team A) has won seed_01(team B) and then in season 2019-2020, team A is more likely to be \"cinderellas\". After selecting these knids of teams as a sub-dataset, we build the model alone with this sub-dataset to find \"cinderellas\".To address potential endogenous problem, we can use 2SLS(two stages least squares) or add some potential omitted variables intuitively and compare the results.\n\nOn the other hand, one could argue that embedded in player influence there is an element of unpredictability.\n* There is a player and season 2019-2020 is his\/her first season.\n* Player accident injury\n* Players' breakthrough in physical fitness or basketball skills","8c0a4247":"Then we use the average influence of players in the same team to represent this team's influence. Based on the output of the previous five years(2015-2019), we then use the ARIMA model to predict the result in 2020. It may be too tricky to predict the team influence only based on five previous data, however, this problem can be handled if we have enough data.","9c2fb06e":"### What's the result in *March Madness*(2019-2020) if coronavirus did not spread?\n### Do players fail to match, match, or exceed expectations according to their previous seasons?\n\nBasically, these are two opening questions related to various factors:\n* Players' physical condition at the time\n* Audiences' support for the host team\n* Psychological quality for coaches and players\n* Weather, competitiveness, and chance\n\nIn this notebook, first, we will try to **make a prediction of the tournament result in season 2019-2020**. Second, we will seek to quantify the player influence as objective as possible, by abusing the terminology of the official definition, **define how influential college basketball player can be**.\n\nTrying to use the existing official definition to metric players' influence, such as Impact defined in this [article](https:\/\/www.kaggle.com\/lucabasa\/quantify-the-madness-a-study-of-competitiveness#Conclusions,-limits,-and-next-steps) and WS(Win Share) may be too subjective, although the existing official definition has its own reasonability. However, the core merit of this notebook is using an objective metric to measure players' influence. We use the information of every player as our input, team competition results as our target(only two values--0 and 1), and then build Logistic Regression. Then we use the results of Logistic Regression to inversely predict the information of every player. Last, we compare the distribution between Impact with the results of our method and we find they are both seem reasonable.\n\nWhile some [differences between the two tournaments](https:\/\/www.kaggle.com\/lucabasa\/are-men-s-and-women-s-tournaments-different) can be found, we find that our method can be used in both situations. We will compare  players' influence between the result that we predict and the official definition.\n\nThis notebook is organized as follows\n* Data Preparation:  the key concept will be summarized in this section and the main output will be displayed.\n* Model Selection and Prediction: the prediction of competition results in season 2019-2020 and model will be showed.\n* Player Influence: where a Machine Learning model will guide us towards the definition of our players' influence.\n* Team Influence: where shows the average performance of players' influence\n* Limits and next steps: where we will conclude our story.","d41bcfcb":"#### Our Method Win Rate:","df742010":"# Data Preparation"}}