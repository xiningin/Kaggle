{"cell_type":{"9ade9a56":"code","6c156f66":"code","42eaa110":"code","8544652b":"code","b1ba4bb7":"code","080416f7":"code","10aa8635":"code","40d4f2c3":"code","c39feed9":"code","3af3efbf":"code","2bfd42d6":"code","bc90a2c7":"code","351025e8":"code","09ff2167":"code","c3f64da9":"code","3f491bfe":"code","d8c348d2":"code","0c598216":"code","2ddd02df":"code","13a815f8":"code","a21df3e5":"code","439cfc2c":"code","a77c0d3a":"markdown","15ca70b4":"markdown","f69d8e1d":"markdown","cd16299a":"markdown","e157f6c4":"markdown","2a22f59a":"markdown","0ccb238d":"markdown","4473a100":"markdown","31fd9758":"markdown","ae8660e2":"markdown","8b32253c":"markdown","abaa2742":"markdown","d7db6290":"markdown","8e7f3b33":"markdown","0a6b5067":"markdown"},"source":{"9ade9a56":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline\nimport pymc3 as pm\nprint(pm.__version__)","6c156f66":"d = np.array([3, 2, 1])\nalphas = np.array([1.5, 1, 0.5])\nplays = [\"run\", 'pass', 'rpo']","42eaa110":"with pm.Model() as mod:\n    params = pm.Dirichlet('params', a=alphas, shape=3)\n    observed = pm.Multinomial('observed', n=6, p=params, shape=3, observed=d)  ","8544652b":"with mod:\n    trace = pm.sample(700, return_inferencedata=False)","b1ba4bb7":"x = pm.summary(trace).iloc[:,0:4]\nx.index = plays\nx","080416f7":"tdf = pd.DataFrame(trace['params'], columns = plays)","10aa8635":"fig, ax = plt.subplots()\ntdf['run'].hist() ##blue\ntdf['pass'].hist()  ##orange\ntdf['rpo'].hist()  ## green","40d4f2c3":"ax = pm.plot_posterior(trace, varnames = ['params'], \n                       figsize = (20, 10))\nfor i, a in enumerate(['run','pass','rpo']):\n    ax[i].set_title(a)","c39feed9":"ax = pm.traceplot(trace, figsize = (25, 10), combined = True)","3af3efbf":"with mod:\n    ppc = pm.sample_posterior_predictive(trace)","2bfd42d6":"ppc['observed'].shape","bc90a2c7":"df = pd.DataFrame(ppc['observed'],index=[i for i in range(ppc['observed'].shape[0])], columns = ['run', 'pass', 'rpo'])\ndf","351025e8":"fig, (ax1, ax2, ax3) = plt.subplots(1, 3, figsize=(15,5))\nax1.hist(df['run'])\nax1.title.set_text('Run')\nax2.hist(df['pass'])\nax2.title.set_text('Pass')\nax3.hist(df['rpo'])\nax3.title.set_text('RPO')","09ff2167":"td = np.array([33, 27, 29, 49])","c3f64da9":"sig = np.sqrt(np.var(td))\nmu = np.mean(td)","3f491bfe":"with pm.Model() as model:\n    obs = pm.Normal('obs', mu, sig)","d8c348d2":"with model:\n    trace = pm.sample(700, return_inferencedata=False)","0c598216":"y = pm.summary(trace).iloc[0,0:4]\ny","2ddd02df":"tdf2 = pd.DataFrame(trace['obs'], columns = ['td'])\ntdf2","13a815f8":"tdf2['td'].hist()","a21df3e5":"ax = pm.traceplot(trace, figsize = (25, 10), combined = True)","439cfc2c":"ax = pm.plot_posterior(trace, varnames = ['obs'], \n                       figsize = (8, 8))","a77c0d3a":"# Part 2","15ca70b4":"The posterior KDE (kernal density estimation) plots","f69d8e1d":"On average we run 50% of the time, pass 33% and call rpo 17% based on 700 simulations.","cd16299a":"# Part 1","e157f6c4":"In this notebook I wanted to try some bayesian analysis techniques; the goal here is to similar to a previous notebook where I ran a simple Markov chain model to predict the likelihood of calling a pass, run or rpo (un-pass option) play on a particular drive.","2a22f59a":"Distribution plots before kernel estimation","0ccb238d":"Histograms of our simulations; most often we run 4 times, pass 1-3 times and call rpo's 0-1 times. ","4473a100":"Using a  normal prior to predict likely number of toudowns given the 4 seasons (I used the middle of Peyton Manning's career).","31fd9758":"Traceplots and the KDE plots together; we see that the run distribution (blue) is centered around 0.5, the orange (pass) around 0.3 and the green (rpo) around 0.15 as expected. ","ae8660e2":"Setting up the model; there are 6 events (add up the parameters in d), shape is 3 because there are 3 columns we are observing.","8b32253c":"hdi is basically the baseian interpretation of a (in this case 97%) confidence interval.","abaa2742":"That's a hue variance; we'd expect somewhere between 19-51 touchdowns on any given year!","d7db6290":"So for example, on one drive we ran 5 times and passed once; on another we ran twice and passed 4 times. One drive even includes 2 runs and 4 rpo's (must have been the ravens or a college team ;) ). ","8e7f3b33":"d is the observed data, i.e on this drive we ran 3 run plays, 2 pass plays and 1 rpo.","0a6b5067":"Here I'm sampling from the posterior distributions so we can see how some drives might look."}}