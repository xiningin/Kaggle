{"cell_type":{"3b6b3acb":"code","7aa82bf5":"code","1db2ddd1":"code","ae6c1ac1":"code","e7a60f04":"code","c49ade54":"code","57daca3d":"code","0381bfd9":"code","9f496406":"code","29e92257":"code","c36120e0":"code","db5a33fa":"code","7120fb6a":"code","37d89fce":"code","f523bda6":"code","95a5de80":"code","bf1dcd3a":"code","7f43ff45":"code","2b271008":"code","26854997":"code","06c57ae3":"markdown","b78abada":"markdown","efd41b8e":"markdown","496b19c0":"markdown","985789e9":"markdown","2a00d7ca":"markdown","2db2c3a0":"markdown","27b986dd":"markdown","d05f97a4":"markdown","b53051bd":"markdown","11e70b0c":"markdown","f93a13c1":"markdown","ebb9803a":"markdown","b0dc6f3b":"markdown","d5aecf30":"markdown","3f64bf04":"markdown","881e91e1":"markdown","d9a5c2fe":"markdown","f65ce178":"markdown","1bc1c9d6":"markdown","c65e0eb9":"markdown","dd765ced":"markdown","d43a03a7":"markdown","67546905":"markdown"},"source":{"3b6b3acb":"print(\"There are following directories and files in this dataset\")\nprint(*list(os.listdir(\"..\/input\/siim-isic-melanoma-classification\")),sep = \"\\n\")","7aa82bf5":"import glob\ntrain_images_jpg_format = glob.glob('..\/input\/siim-isic-melanoma-classification\/jpeg\/train\/*.jpg')\nlen(train_images_jpg_format)","1db2ddd1":"import glob\ntrain_images_dcm_format = glob.glob('..\/input\/siim-isic-melanoma-classification\/train\/*.dcm')\nlen(train_images_dcm_format)","ae6c1ac1":"import pandas as pd\n\nimport fastai\nfrom fastai.vision.all import *","e7a60f04":"path = Path('..\/input\/input\/siim-isic-melanoma-classification\/')\nimage_path = Path('..\/input\/siim-isic-melanoma-classification\/jpeg\/train')\ntraining_data_file = Path('..\/input\/siim-isic-melanoma-classification\/train.csv')\nsample_submission_file = Path('..\/input\/siim-isic-melanoma-classification\/sample_submission.csv')","c49ade54":"train_df = pd.read_csv(training_data_file)","57daca3d":"print(\"Size of Training data \\n\", train_df.shape)\nprint(\"----------------------------------------------------------\")\nprint(\"\\nFirst few samples of data are \\n\",train_df.head())","0381bfd9":"train_df_output_1 = train_df[train_df['target']==1]\ntrain_df_output_1.shape","9f496406":"train_df_output_0 = train_df[train_df['target']==0]\ntrain_df_output_0.shape","29e92257":"train_df_output_0 = train_df[train_df['target']==0].sample(frac=0.03,random_state=111)\ntrain_df_output_0.shape","c36120e0":"new_df = pd.concat([train_df_output_0,train_df_output_1]).reset_index(drop=True)\nnew_df.shape","db5a33fa":"image_data_loader = ImageDataLoaders.from_df(new_df, path=image_path,\n                               seed=42, fn_col=0, \n                               suff='.jpg', label_col=7, \n                               item_tfms=Resize(128), \n                               batch_tfms=aug_transforms(flip_vert=True, max_warp=0.), \n                               bs=128, val_bs=None, shuffle_train=True)","7120fb6a":"image_data_loader.device","37d89fce":"image_data_loader.show_batch()\n","f523bda6":"learn = cnn_learner(image_data_loader, resnet34, metrics=error_rate)","95a5de80":"learn.fine_tune(2)","bf1dcd3a":"sub = pd.read_csv(sample_submission_file)\nsub.head()","7f43ff45":"for i in range(10982):\n    x = sub.at[i,'image_name']\n    test_image = Path(\"..\/input\/siim-isic-melanoma-classification\/jpeg\/test\/\" + x + \".jpg\")\n    pr1,_,pr2 = learn.predict(test_image)\n    sub.at[i,'target'] = float(pr2[int(pr1)])","2b271008":"sub.head()\n","26854997":"sub.to_csv('my_submission_file.csv', index=False)","06c57ae3":"# We will use JPEG format of images and treat this problem as an image classification problem with 2 cateories.","b78abada":"# The dataset provided for this competition is as follows","efd41b8e":"Let us join the inputs selected from both the categories and call it a \"new_df\".","496b19c0":"We will now count the number of images in the following directories:\n\n1. jpeg -> train\n2. train\n","985789e9":"# ![Screenshot%202020-11-04%20at%203.02.16%20PM.png](attachment:Screenshot%202020-11-04%20at%203.02.16%20PM.png)","2a00d7ca":"# Creating the image data loader","2db2c3a0":"# Analysing the data","27b986dd":"# Trainnig the image recognizer model","d05f97a4":"# Understanding the dataset","b53051bd":"# Importing necessary libraries\n","11e70b0c":"Let us print the number of data samples with output as category \"1\"  ","f93a13c1":"Let us check the device type of our \"ImageDataLoader\" to make sure that we are using \"GPU\" ","ebb9803a":"Let us train the model for 4 epochs","b0dc6f3b":"Import Pandas - For data analysis\nImport Fastai - For training of deep learning model and predictions.\n\n**Note**: We are using Fastai version 2 (Not previous version of Fastai- which is version 1).\n","d5aecf30":"We will select all the training data which has the output category as \"1\" and 0.3 % of training data which has the output category as \"0\" to have equal number of inputs with the same category of output.","3f64bf04":"As we can see above the number of images in the DICOM format and JPEG format are same. So we will be using JPEG format images in this notebook for training and prediction purpose.","881e91e1":"Let us print the dataset ","d9a5c2fe":"We create a CNN (convolutional neural network) with the following specific details:\n\n* What data we want to train it on?\n<\/br>\n  Our data to be used for training is \"image_data_loader\"\n  \n* Which architecture to use?\n<\/br>\n  We are using Resnet34 \n  \n* what metric to use for our training evaluation?\n  <\/br>\n  We have specified it as \"error_rate\"","f65ce178":"You can read more about the dataset\n[here](http:\/\/https:\/\/www.kaggle.com\/c\/siim-isic-melanoma-classification\/data)","1bc1c9d6":"# Selecting a subset of data for training purpose","c65e0eb9":"Let us print the number of data samples with output as category \"0\"  ","dd765ced":"Let us check few random images from our ImageDataLoader's batch to make sure that images and labels appears correctly in it.","d43a03a7":"# Defining the variables and assigning the paths for this notebook\n","67546905":"# Choosing the data for model training"}}