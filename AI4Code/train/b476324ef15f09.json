{"cell_type":{"fd5cf83a":"code","ff845761":"code","47f2ae41":"code","b6ea88c9":"code","3a6374dc":"code","47944ed7":"code","32a07158":"code","6e1fc5a5":"code","b3d8d01c":"code","c4f173ef":"code","dd3e6259":"code","55cc00b8":"code","98e7b96b":"code","1f57269a":"code","e10e72da":"code","3755f881":"code","bf8b09a6":"code","80e4ee48":"code","91af511e":"code","005be75e":"code","dc3c26bd":"code","55ff84de":"code","42578cf6":"code","21132552":"code","7b4ca676":"code","90613568":"code","81e1bd6e":"code","d3bd576a":"code","661153fb":"code","b4604059":"code","01c30686":"code","e3a0380a":"code","0623cecf":"code","7f6305a6":"code","00839dff":"code","84b4e18c":"code","30512087":"code","ca137508":"code","6c196243":"code","be89007d":"code","36d8f48e":"code","848fdd62":"code","d812f6e8":"code","cae80987":"code","2764a2aa":"code","a1f69e94":"code","bb343889":"code","c5fb2022":"code","07639610":"code","6206e39b":"code","dcfb58cd":"code","4511488d":"code","3d0f18bf":"code","f97b0226":"code","944a609f":"code","a7153f9c":"code","931312ea":"code","19f169ce":"markdown","aab26682":"markdown","2a722dfc":"markdown","5352017e":"markdown","cd0ab382":"markdown","890b831a":"markdown","9d5ad21f":"markdown","51fab1c6":"markdown","87a6f5a2":"markdown","39199d54":"markdown","8c177b6b":"markdown","5df52d2f":"markdown"},"source":{"fd5cf83a":"import warnings\nwarnings.filterwarnings(\"ignore\") ","ff845761":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nplt.style.use(\"fivethirtyeight\")","47f2ae41":"ratings_file = \"..\/input\/book-crossing-dataset\/BX-Book-Ratings.csv\"\nbooks_file = \"..\/input\/book-crossing-dataset\/BX-Books.csv\"\nusers_file = \"..\/input\/book-crossing-dataset\/BX-Users.csv\"","b6ea88c9":"ratings_df = pd.read_csv(ratings_file,sep=\";\",error_bad_lines=False, encoding='latin-1')\nbooks_df = pd.read_csv(books_file,sep=\";\",error_bad_lines=False, encoding='latin-1')\nusers_df = pd.read_csv(users_file,sep=\";\",error_bad_lines=False, encoding='latin-1')","3a6374dc":"books_df.head()","47944ed7":"# Changing column names to lowercase separated by '_'\nbooks_df.columns = [x.lower().replace(\"-\",\"_\") for x in books_df.columns]","32a07158":"books_df.head()","6e1fc5a5":"books_df.shape","b3d8d01c":"# Currently we can deal with only isbn\tbook_title\tbook_author\tyear_of_publication\tpublisher\t","c4f173ef":"books_df = books_df[['isbn', 'book_title', 'book_author', 'year_of_publication', 'publisher']]","dd3e6259":"books_df.head()","55cc00b8":"books_df.year_of_publication.unique()","98e7b96b":"# removing fault data (ie) 0, 2038, 2026, 2037, 2030, DK Publishing Inc, Gallimard","1f57269a":"mask = books_df.year_of_publication.isin(['DK Publishing Inc', 'Gallimard'])","e10e72da":"books_df.shape","3755f881":"books_df = books_df[~books_df.year_of_publication.isin(['DK Publishing Inc', 'Gallimard'])]","bf8b09a6":"sns.heatmap(books_df.isnull(), cbar=False)\nplt.title(\"NO NULL Values\")","80e4ee48":"books_df.year_of_publication.value_counts(normalize=True).plot()\nplt.xlabel(\"Year of Publication\")\nplt.ylabel(\"No of Publications\")\nplt.legend()","91af511e":"books_df.info()\nbooks_df.year_of_publication = books_df.year_of_publication.astype('int32')\n","005be75e":"books_df.year_of_publication.sort_values().unique()","dc3c26bd":"books_df = books_df[~books_df.year_of_publication.isin([0, 1376, 1378, 2024, 2026, 2030, 2037, 2038, 2050])]","55ff84de":"books_df.year_of_publication.sort_values().unique()","42578cf6":"hist_data = books_df.year_of_publication.value_counts(normalize=True)","21132552":"plt.hist(x=hist_data.index, weights=hist_data.values, bins=25, edgecolor='black')\nplt.xlabel(\"Years\")\nplt.ylabel(\"Publications %\")\n","7b4ca676":"books_df.head()","90613568":"books_df.book_title.isnull().sum()","81e1bd6e":"sns.heatmap(ratings_df.isnull(), cbar=False)\nplt.title(\"No Null Values\")","d3bd576a":"ratings_df.info()","661153fb":"ratings_df.columns = [x.lower().replace(\"-\",\"_\") for x in ratings_df.columns]","b4604059":"ratings_df.sort_values(by=[\"user_id\"])","01c30686":"users_df.head()","e3a0380a":"users_df.columns = [x.lower().replace(\"-\",\"_\") for x in users_df.columns]","0623cecf":"users_df.head()","7f6305a6":"users_df.shape","00839dff":"sns.heatmap(users_df.isnull(), cbar=False)\nplt.title(\"Null Values\")","84b4e18c":"users_df.age.isnull().sum()","30512087":"users_df.drop(columns=[\"age\"], inplace=True)","ca137508":"# Merging Books DF and Ratings DF\ndf = pd.merge(books_df,ratings_df,on='isbn')","6c196243":"df.head()","be89007d":"df = pd.merge(df, users_df, on='user_id')","36d8f48e":"df.head()","848fdd62":"def split_country(x):\n    return x.split(\",\")[-1].strip()","d812f6e8":"df[\"country\"] = df.location.apply(split_country)","cae80987":"df.head()","2764a2aa":"df.country.value_counts()","a1f69e94":"rating_data = df.groupby(by = ['book_title'])['book_rating'].sum().sort_values(ascending=False).reset_index()\n               ","bb343889":"rating_of_books_df = pd.DataFrame(rating_data)","c5fb2022":"rating_of_books_df.rename(columns={'book_rating':'total_rating'}, inplace=True)\nrating_of_books_df","07639610":"final_book_df = df.merge(rating_of_books_df,left_on='book_title',right_on='book_title',how='left')","6206e39b":"final_book_df.head()","dcfb58cd":"rating_gt_100 = final_book_df.query('total_rating>=100')\nrating_gt_100.head()","4511488d":"features = rating_gt_100.pivot_table(index='book_title',columns='user_id',values='book_rating').fillna(0)","3d0f18bf":"#now using scipy convert the pivot table to csr matrix\nfrom scipy.sparse import csr_matrix\nbooks_features_matrix = csr_matrix(features.values)","f97b0226":"from sklearn.neighbors import NearestNeighbors\nmodel = NearestNeighbors(metric='cosine',algorithm='brute')","944a609f":"model.fit(books_features_matrix)\n#creating an unspuerised NearestNeighbor algorthim","a7153f9c":"query_index = np.random.choice(features.shape[0])\ndistances, indices = model.kneighbors(features.iloc[query_index,:].values.reshape(1, -1), n_neighbors = 6)","931312ea":"for i in range(0, len(distances.flatten())):\n    if i == 0:\n        print('Recommendations for {0}:\\n'.format(features.index[86]))\n    else:\n        print('{0}: {1}, with distance of {2}:'.format(i, features.index[indices.flatten()[i]], distances.flatten()[i]))","19f169ce":"# Dataset Intro and Reading\n","aab26682":"### Calculating total ratings for each book","2a722dfc":"## Books DF","5352017e":"# Basic Analysis","cd0ab382":"### We can see, some values are 0 and some  are future values (1376, 1378, 2024, 2026, 2030, 2037, 2038, 2050). We can remove them ","890b831a":"# Data Merge","9d5ad21f":"We have 3 different datasets, namely ratings, users, books. We can merge the data to make a recommendation system.","51fab1c6":"# Users DF","87a6f5a2":"## Books Ratings Data\n\nCollected by Cai-Nicolas Ziegler in a 4-week crawl (August \/ September 2004) from the Book-Crossing community with kind permission from Ron Hornbaker, CTO of Humankind Systems. Contains 278,858 users (anonymized but with demographic information) providing 1,149,780 ratings (explicit \/ implicit) about 271,379 books.\n\nFreely available for research use when acknowledged with the following reference (further details on the dataset are given in this publication):\nImproving Recommendation Lists Through Topic Diversification,\nCai-Nicolas Ziegler, Sean M. McNee, Joseph A. Konstan, Georg Lausen; Proceedings of the 14th International World Wide Web Conference (WWW '05), May 10-14, 2005, Chiba, Japan. To appear.\n","39199d54":"### Here Age column is having nearly half null values so we can ignore for now. ","8c177b6b":"# Ratings DF","5df52d2f":"## The data needed is converted to a matrix"}}