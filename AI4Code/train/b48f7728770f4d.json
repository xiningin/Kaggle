{"cell_type":{"7cc9016e":"code","c277fe09":"code","e18debf5":"code","14debd43":"code","62eb8345":"code","bcc650da":"code","6310cefc":"code","f81ee854":"code","581ea23a":"code","c1392f41":"code","d4852c4b":"code","47bceda8":"markdown"},"source":{"7cc9016e":"import pandas as pd\nimport os\nimport gc\nfrom tqdm import tqdm","c277fe09":"ROOT_DIR = \"..\/input\/mlb-player-digital-engagement-forecasting\"","e18debf5":"tgt_df = pd.read_csv(\"..\/input\/mlb-data\/target.csv\")","14debd43":"tgt_df.head()","62eb8345":"player_mean = tgt_df.groupby(\"playerId\")[[\"target1\",\"target2\",\"target3\",\"target4\"]].median().reset_index()\ngc.collect()\nprint(player_mean.shape)","bcc650da":"player_mean.head()","6310cefc":"TGTCOLS = [\"target1\",\"target2\",\"target3\",\"target4\"]\nimp = tgt_df[TGTCOLS].median()","f81ee854":"def process_pred(df):\n    df = df.reset_index()\n    df[\"playerId\"] = df[\"date_playerId\"].apply(lambda x: int( x.split(\"_\")[1] ) )\n    df.drop([\"target1\",\"target2\",\"target3\",\"target4\"], axis=1, inplace=True)\n    df = df.merge(player_mean, on=\"playerId\", how=\"left\")\n    df.drop([\"playerId\",\"date\"], axis=1, inplace=True)\n    #df = df.fillna(0.)\n    for col in TGTCOLS:\n        df[col] = df[col].fillna(imp[col])\n    return df\n#===================","581ea23a":"import mlb\nenv = mlb.make_env() # initialize the environment\niter_test = env.iter_test() # iterator which loops over each date in test set\n\nfor (test_df, sample_prediction_df) in iter_test:\n    sample_prediction_df = process_pred(sample_prediction_df)\n    env.predict(sample_prediction_df)","c1392f41":"sample_prediction_df.head()","d4852c4b":"sample_prediction_df[\"target1\"] = sample_prediction_df[\"target1\"].fillna(imp[\"target1\"])","47bceda8":"## COMPUTING PLAYER MEAN"}}