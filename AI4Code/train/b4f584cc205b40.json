{"cell_type":{"44df2b38":"code","590d3c53":"code","3dc3348f":"code","f16db5ec":"code","19cd2c65":"code","2da9f30e":"code","c4769e87":"code","03e46ddf":"code","9ac72ff1":"code","1c1a878a":"code","bea66a11":"code","85b8a5cd":"code","a3a2ef38":"code","9fc8cd2b":"code","aed64ccb":"code","04e2f0f2":"code","dbfc5bd4":"code","e7d219c2":"code","9adedc2b":"code","f157e7b4":"code","f7f0dd0f":"code","777c955f":"code","0d4b3a31":"code","e594cce7":"code","f173f67d":"code","afaf0d74":"code","75fbd7ed":"code","0217ca21":"code","be3de215":"code","12831d1f":"code","3c405070":"code","cd6a249b":"code","3e54c82f":"code","243fbe04":"code","39d6f3fa":"code","438c1719":"code","d56db66e":"code","a0e217b2":"code","b342de80":"code","3058133c":"markdown","075e735d":"markdown","3a95c445":"markdown","6b8c0283":"markdown","41237efe":"markdown","e20e787e":"markdown","32f4de97":"markdown","6ea1c129":"markdown","adfe7957":"markdown","05c5e925":"markdown","794e88a9":"markdown"},"source":{"44df2b38":"# You can use shell commands with \"!\"\n!ls ..\/input","590d3c53":"# Pipe output to do basic analysis\n!ls ..\/input\/train\/ | wc -l\n!ls ..\/input\/train\/ | head","3dc3348f":"!ls ..\/input\/train\/00070df0-bbc3-11e8-b2bc-ac1f6b6435d0_*.png","f16db5ec":"# Better approach: use pathlib\nfrom pathlib import Path\n\nDATA_DIR = Path('..\/input')\nTRAIN_DIR = DATA_DIR\/'train'\nTEST_DIR = DATA_DIR\/'test'","19cd2c65":"list(set([str(fn).split('\/')[-1].split('_')[0] for fn in TEST_DIR.iterdir()]))[:10]","2da9f30e":"# Use the full power of Python\ntest_ids = list(set([str(fn).split('\/')[-1].split('_')[0]  for fn in TEST_DIR.iterdir()]))\nprint('Test IDs:', len(test_ids))\ntest_ids[:10]","c4769e87":"# You can even create directories\nSUB_DIR = Path('files\/submissions')\nSUB_DIR.mkdir(parents=True, exist_ok=True)\n!ls files","03e46ddf":"# You could always use shell commands\nLABELS_CSV = DATA_DIR\/'train.csv'\n!head {LABELS_CSV}","9ac72ff1":"# Enter pandas\nimport pandas as pd\n\ntrain_df = pd.read_csv(LABELS_CSV, index_col='Id')\ntrain_df.head(10)","1c1a878a":"# You can look at a random sample\ntrain_df.sample(10)","bea66a11":"# Or get basic information about the data\ntrain_df.info()","85b8a5cd":"# Use Python to your advantage\ntrain_df['Target'] = train_df['Target'].str.split(' ').map(lambda x: list(map(int, x)))\ntrain_df.head(10)","a3a2ef38":"label_names = [\"Nucleoplasm\", \"Nuclear membrane\", \"Nucleoli\", \"Nucleoli fibrillar center\", \n               \"Nuclear speckles\", \"Nuclear bodies\", \"Endoplasmic reticulum\", \n               \"Golgi apparatus\", \"Peroxisomes\", \"Endosomes\",\"Lysosomes\", \n               \"Intermediate filaments\", \"Actin filaments\", \"Focal adhesion sites\", \n               \"Microtubules\", \"Microtubule ends\", \"Cytokinetic bridge\", \"Mitotic spindle\", \n               \"Microtubule organizing center\", \"Centrosome\", \"Lipid droplets\", \n               \"Plasma membrane\", \"Cell junctions\", \"Mitochondria\", \"Aggresome\",   \n               \"Cytosol\", \"Cytoplasmic bodies\", \"Rods & rings\"]","9fc8cd2b":"import numpy as np\n\ndef get_label_freqs(targets, label_names, ascending=None):\n    n_classes = len(label_names)\n    freqs = np.array([0] * n_classes)\n    for lst in targets:\n        for c in range(n_classes):\n            freqs[c] += c in lst\n    data = {\n        'name': label_names, \n        'frequency': freqs, \n        'percent': (10000 * freqs \/ len(targets)).astype(int) \/ 100.,\n    }\n    cols = ['name', 'frequency', 'percent']\n    df = pd.DataFrame(data, columns=cols)\n    if ascending is not None:\n        df = df.sort_values(by='frequency', ascending=ascending)\n    return df","aed64ccb":"# Create a frequency table\ntrain_freqs = get_label_freqs(train_df.Target, label_names, ascending=False)\ntrain_freqs","04e2f0f2":"# Visualize the frequency table using a chart\ntrain_freqs.plot(x='name', y='frequency', kind='bar', title='Name vs. Frequency');","dbfc5bd4":"# Use logarithmic axis for easier interpretation\ntrain_freqs.plot(x='name', y='frequency', kind='bar', logy=True, title='Name vs. log(Frequency)');","e7d219c2":"train_sample = \"ac39847a-bbb1-11e8-b2ba-ac1f6b6435d0_red.png\"","9adedc2b":"from imageio import imread\nimport matplotlib.pyplot as plt\n\n# Look at one channel\/filter\nimg0 = imread(str(TRAIN_DIR\/train_sample))\nprint(img0.shape)\nplt.imshow(img0)\nplt.title(train_sample[0]);","f157e7b4":"# Use a color map for grayscale images\nplt.imshow(img0, cmap=\"Reds\");","f7f0dd0f":"# For RGB images, it \"just works\"\n!curl https:\/\/www.what-dog.net\/Images\/faces2\/scroll001.jpg -o sample.jpg\n\nimg = imread('sample.jpg')\nplt.imshow(img);","777c955f":"!ls {TRAIN_DIR}\/ac39847a-bbb1-11e8-b2ba-ac1f6b6435d0_*.png","0d4b3a31":"CHANNELS = ['green', 'red', 'blue', 'yellow']\n\n# Load images for multiple channels\ndef load_image(image_id, channels=CHANNELS, img_dir=TRAIN_DIR):\n    image = np.zeros(shape=(len(channels),512,512))\n    for i, ch in enumerate(channels):\n        image[i,:,:] = imread(str(img_dir\/f'{image_id}_{ch}.png'))\n    return image","e594cce7":"# Plot multiple images in a grid\ndef show_image_filters(image, title, figsize=(16,5)):\n    fig, subax = plt.subplots(1, 4, figsize=figsize)\n    # Green channel\n    subax[0].imshow(image[0], cmap=\"Greens\")\n    subax[0].set_title(title)\n    # Red channel\n    subax[1].imshow(image[1], cmap=\"Reds\")\n    subax[1].set_title(\"Microtubules\")\n    # Blue channel\n    subax[2].imshow(image[2], cmap=\"Blues\")\n    subax[2].set_title(\"Nucleus\")\n    # Orange channel\n    subax[3].imshow(image[3], cmap=\"Oranges\")\n    subax[3].set_title(\"Endoplasmatic reticulum\")\n    return subax","f173f67d":"# Use the traning data to show appropriate labels\ndef get_labels(image_id):\n    labels = [label_names[x] for x in train_df.loc[image_id]['Target']]\n    return ', '.join(labels)","afaf0d74":"# Look at a sample grid\nimg_id = 'ac39847a-bbb1-11e8-b2ba-ac1f6b6435d0'\nimg, title = load_image(img_id), get_labels(img_id)\nshow_image_filters(img, title);\nprint(img.shape)","75fbd7ed":"# Combine with pandas to view a random sample\nfor img_id in train_df.sample(3).index:\n    print(img_id)\n    img, title = load_image(img_id), get_labels(img_id)\n    show_image_filters(img, title)","0217ca21":"# Let's define a sophisticated and highly accurate model\ndef model(inputs):\n    return np.random.randn(len(inputs), len(label_names))","be3de215":"# Generate some predictions (logits)\npreds = model(test_ids)\nprint(preds.shape)\nprint(preds)","12831d1f":"# Convert them into probabilities\ndef sigmoid(x):\n    return np.reciprocal(np.exp(-x) + 1) \n\nprobs = sigmoid(preds)\nprobs","3c405070":"# Convert probabilities into labels\ndef make_labels(y, thres=0.5):\n    return ' '.join([str(i) for i, p in enumerate(y) if p > thres])\n\nmake_labels(probs[0])","cd6a249b":"# Create a pandas dataframe\nlabels = list(map(make_labels, probs))\nsub_df = pd.DataFrame({ 'Id': test_ids, 'Predicted': labels}, columns=['Id', 'Predicted'])\nsub_df.head(10)","3e54c82f":"# Export it to a file and make sure it looks okay\nsub_fname = SUB_DIR\/'basic.csv'\nsub_df.to_csv(sub_fname, index=None)\n\n!head {sub_fname}","243fbe04":"# Use FileLink to download the file\nfrom IPython.display import FileLink\n\nFileLink(sub_fname)","39d6f3fa":"def make_sub(fname):\n    preds = model(test_ids)\n    probs = sigmoid(preds)\n    labels = list(map(make_labels, probs))\n    sub_df = pd.DataFrame({ 'Id': test_ids, 'Predicted': labels}, columns=['Id', 'Predicted'])\n    fpath = SUB_DIR\/fname\n    sub_df.to_csv(fpath, index=None)\n    !head {fpath}\n    return FileLink(fpath)","438c1719":"make_sub('best_submission.csv')","d56db66e":"!pip install jovian --upgrade -q","a0e217b2":"import jovian","b342de80":"jovian.commit()","3058133c":"## 2. How to work with CSV files","075e735d":"Learn more here: https:\/\/docs.python.org\/3\/library\/pathlib.html","3a95c445":"# Save and commit\nFinally, we you save and commit out work using Jovian, so that anyone (including you), can reproduce it later with a single command, on any machine.","6b8c0283":"# Exploratory Data Analysis: an end-to-end example\n\n1. How to work with the filesystem\n2. How to work with CSV files\n3. How to do exploratory data analysis (EDA)\n4. How to display images in a grid\n5. How to create a Kaggle submission file\n\n<iframe width=\"560\" height=\"315\" src=\"https:\/\/www.youtube.com\/embed\/1vUeDkORVcA\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen><\/iframe>","41237efe":"## 3. How to do Exploratory Data Analysis (EDA)\n\nPandas dataframe is a great starting point for doing EDA. It provides many utilities for plotting graphs right out of the box.","e20e787e":"Clearly, there is a huge imbalance between the classes, and **15 of the 28 classes have less than 900 samples (~ 3% of the data)**, and 9 classes have fewer than 330 samples (~1% of the data). Any model which always predicts 0 or 'not present' for these classes is already 97% accurate.\n\nSo, it's going to be really difficult to train a model that can detect the less frequently occuring classes. This may lead to a recall of 0, which will lead to and F1 score of 0 for these classes, thus putting a ceiling of 0.465 on the evaluation metric. In fact, we might need to train a separate model for these classes.","32f4de97":"## 4. How to display an image, or show multiple images in a grid?","6ea1c129":"## 5. How to generate a submission file?","adfe7957":"Now you can generate test predictions with a single line of code!","05c5e925":"The last but **MOST IMPORTANT** step is to take all of the above code (once it works as expected), and wrap it into a function (or two)","794e88a9":"## 1. How to work with the filesystem & directories"}}