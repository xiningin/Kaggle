{"cell_type":{"38d71101":"code","be16ce3c":"code","794a1b59":"code","49e9e2ac":"code","7c62aa9e":"code","d4dd243e":"code","777adff5":"code","6f59855a":"code","31bd6896":"code","bac010f0":"code","52a94b9e":"code","f8d2df2d":"code","065c81f6":"code","3d11432a":"code","799de27a":"code","fc390e96":"code","fb30bcf0":"code","2c8845f5":"code","71bb3d34":"code","de09ddd7":"code","34539f51":"code","f3940fd6":"code","dfd7fd51":"code","17a50883":"code","a509b1f9":"code","0666da9e":"code","faae4889":"code","e668471b":"code","2d51143a":"code","051e6445":"code","67855e6b":"code","681f2885":"code","67f125b6":"code","e78ff872":"code","d79f6d23":"code","39ebae70":"code","af4e3218":"code","e400114e":"code","c75baab4":"code","6c4df1b5":"code","ad92ca07":"markdown","ef8cf54d":"markdown","5cb073e5":"markdown","eeef198f":"markdown","bb904475":"markdown","1815a239":"markdown","b01221be":"markdown","4af69654":"markdown","a4d95d44":"markdown","d2802151":"markdown","305c9f36":"markdown","61875aca":"markdown","ff08bc7f":"markdown","b77d7fee":"markdown","5ff39e42":"markdown","8e6fe8c7":"markdown","6daf270f":"markdown","c3ee6b18":"markdown","dc7f8825":"markdown","8cb051b6":"markdown","121cdcb4":"markdown","ccc8e383":"markdown","d684a464":"markdown"},"source":{"38d71101":"import numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt","be16ce3c":"pd.set_option('display.max_columns',None)\ndf=pd.read_csv('..\/input\/covid19-patient-precondition-dataset\/covid.csv')\ndf.head()","794a1b59":"df.info()","49e9e2ac":"date_fields=['entry_date','date_symptoms']\nfor dates in date_fields:\n    df[dates]=pd.to_datetime(df[dates],infer_datetime_format=True)","7c62aa9e":"df['date_died'].replace('9999-99-99','Not Applicable',inplace=True)","d4dd243e":"df.columns","777adff5":"df=df[['sex', 'patient_type', 'entry_date', 'date_symptoms', 'date_died', 'age',\n       'intubed', 'pneumonia', 'pregnancy', 'diabetes', 'copd',\n       'asthma', 'inmsupr', 'hypertension', 'other_disease', 'cardiovascular',\n       'obesity', 'renal_chronic', 'tobacco', 'contact_other_covid',\n       'covid_res', 'icu']]\ndf.rename(columns={'covid_res':'Test result'},inplace=True)","6f59855a":"df.iloc[:,6:]=df.iloc[:,6:].replace([97,98,99],np.nan)\ndf.iloc[:,6:]=df.iloc[:,6:].replace(1,'Yes')\ndf.iloc[:,6:]=df.iloc[:,6:].replace(2,'No')\n\ndf.iloc[:,-2]=df.iloc[:,-2].replace('Yes','Positive')\ndf.iloc[:,-2]=df.iloc[:,-2].replace('No','Negative')\ndf.iloc[:,-2]=df.iloc[:,-2].replace(3,'Results awaited')","31bd6896":"df.head()","bac010f0":"plt.figure(figsize=(10,8))\nsns.heatmap(df.isnull(),cmap='viridis')\nplt.title('Null value heatmap',size=25)","52a94b9e":"df['intubed'].isna().value_counts()","f8d2df2d":"plt.figure(figsize=(10,8))\nax=sns.catplot('intubed',data=df,kind='count',palette='autumn_d',hue='Test result')\nplt.xticks(size=15,)\nplt.xlabel('Intubation \\n \\n Yes:{}  No:{}'.format(df['intubed'].value_counts()[1] , df['intubed'].value_counts()[0]),size=15)\nplt.ylabel('Count',size=15)\nplt.title('Reported intubations \\n \\n  Ratio={0:.0f}'.format(df['intubed'].value_counts()[0]\/df['intubed'].value_counts()[1])\n          ,size=20)\n\n","065c81f6":"df_intubed=df[df['intubed']=='Yes']\nsns.catplot('Test result',data=df_intubed,kind='count')\nplt.title('Intubed patient numbers',size=20)\nplt.xlabel('Results \\n Test postivity rate: {0:.2f} %'.format(\n    100* df_intubed['Test result'].value_counts()[0]\/df_intubed['Test result'].size),size=15)","3d11432a":"\ndf_intubed.reset_index(drop=True,inplace=True)\ndf_intubed['Fatal']=np.nan\n\ni=0\nfor i in range(len(df_intubed)):\n    if df_intubed['date_died'][i]!='Not Applicable':\n        df_intubed['Fatal'][i]='Yes'\n    ","799de27a":"df_intubed['Fatal'].fillna('No',inplace=True)","fc390e96":"df_int_pos=df_intubed[df_intubed['Test result']=='Positive']","fb30bcf0":"\nsns.catplot('Test result',kind='count',hue='Fatal',data=df_intubed,palette='Accent',height=5,aspect=2)\nplt.title('Intubed patients with case fatality',size=25)\n\nplt.xlabel('\\n Results  \\n \\n Case Fatality Rate: {0:.2f} %  \\n \\n COVID +ve Fatality Rate: {1:.2f} %'.format(100* df_intubed['Fatal'].value_counts()[0]\/df_intubed.shape[0],100 * df_int_pos['Fatal'].value_counts()[0]\/df_int_pos.shape[0]),size=20)\nplt.xticks(size=15)","2c8845f5":"df['sex'].replace(1,'Female',inplace=True)\ndf['sex'].replace(2,'Male',inplace=True)\n","71bb3d34":"sns.catplot('sex',data=df,kind='count')\nplt.title('Gender distribution')","de09ddd7":"df_pos=df[df['Test result']=='Positive']\n\ndf_pos.reset_index(drop=True,inplace=True)\ndf_pos['Fatal']=np.nan\n\ni=0\nfor i in range(len(df_pos)):\n    if df_pos['date_died'][i]!='Not Applicable':\n        df_pos['Fatal'][i]='Yes'\n\ndf_pos['Fatal']=df_pos['Fatal'].fillna('No')","34539f51":"df_pos['Fatal']=df_pos['Fatal'].fillna('No')","f3940fd6":"\ndf_m_pos=df_pos[df_pos['sex']=='Male']\ndf_f_pos=df_pos[df_pos['sex']=='Female']\n\n\nsns.catplot('sex',data=df_pos,hue='Fatal',kind='count',palette='rocket',aspect=2,height=6)\nplt.xlabel('Sex \\n \\n Male fatality : {0:.2f} % \\n \\n Female fatality: {1:.2f} %'.format(100*df_m_pos['Fatal'].value_counts()[1]\/df_m_pos.shape[0],100*df_f_pos['Fatal'].value_counts()[1]\/df_m_pos.shape[0]),size=15)\nplt.ylabel('Count',size=15)\nplt.title('Gender wise COVID +ve results',size=25)","dfd7fd51":"def age_band(age):\n    \n   \n    if age<2:\n        return 'Less than 2'\n    elif (age>1) and (age<11):\n        return '2-10'\n    elif (age>10 and age<21):\n        return '10-20'\n    elif (age>20 and age<31):\n        return '20-30'\n    elif (age>30 and age<41):\n        return '30-40'\n    elif (age>40 and age<51):\n        return '40-50'\n    elif (age>50 and age<61):\n        return '50-60'\n    elif (age>60 and age<81):\n        return '60-80'\n    else:\n        return 'Above 80'","17a50883":"sns.set()\nfig1=plt.figure(figsize=(15,5))\nax1=fig1.add_subplot(121)\na=sns.distplot(df['age'],ax=ax1,label='Population ages')\nax1.legend()\nax1.set_title('Complete population age distribution',size=15)\nax2=fig1.add_subplot(122)\n\ndf_m=df[df['sex']=='Male']\ndf_f=df[df['sex']=='Female']\n\nb=sns.kdeplot(df_m['age'],shade=True,ax=ax2,label='Male age distribution',color='orange')\nc=sns.kdeplot(df_f['age'],ax=ax2,label='Female age distribution',color='green',shade=True)\nax2.set_xlabel('Age')\nax2.set_title('Gender wise age distribution',size=15)","a509b1f9":"df['Age band']=df['age'].apply(age_band)\ndf['Count']=1","0666da9e":"df_age_band=df.groupby('Age band')['Count'].count().reset_index().sort_values(by='Count',ascending=False)","faae4889":"\n\n\n\nsns.catplot('Age band','Count', data=df_age_band,kind='bar',height=10,aspect=2)\n\n\nplt.title('Age band distribution',size=25)\nplt.xlabel('Age band',size=15)\nplt.ylabel('Count',size=15)\nplt.xticks(size=15)","e668471b":"def fatality(fatal):\n    if fatal =='Not Applicable':\n        return 'No'\n    else:\n        return 'Yes'","2d51143a":"df['Fatal']=df['date_died'].apply(fatality)","051e6445":"df.head()","67855e6b":"df_pos=df[df['Test result']=='Positive']\nsns.catplot('Age band',kind='count',hue='Fatal',data=df_pos,height=8,aspect=2,palette='winter')\n\nplt.xticks(size=15)\n\nplt.title('COVID +ve case fatality with respect to age groups',size=20)","681f2885":"df['delta']=abs(df['entry_date']-df['date_symptoms'])\ndf.head()","67f125b6":"df_pos=df[df['Test result']=='Positive']\ndf_case_load=df.groupby('entry_date')['Count'].count().reset_index()\ndf_case_load.sort_values(by='entry_date',inplace=True)\ndf_case_load.head()","e78ff872":"fig1=plt.figure(figsize=(10,8))\nax1=fig1.add_subplot(111)\n\ndf_case_load['Moving average_25']=df_case_load['Count'].rolling(25).mean()\ndf_case_load['Moving average_35']=df_case_load['Count'].rolling(35).mean()\ndf_case_load['Moving average_50']=df_case_load['Count'].rolling(50).mean()\n\nax1.plot(df_case_load['entry_date'],df_case_load['Moving average_25'],label='25 day moving average',color='indianred')\nax1.plot(df_case_load['entry_date'],df_case_load['Moving average_35'],label='35 day moving average',color='seagreen')\nax1.plot(df_case_load['entry_date'],df_case_load['Moving average_50'],label='50 day moving average',color='blue')\n\nplt.legend()\nplt.title('COVID-19 case loads',size=20)\nplt.xticks(rotation=45)","d79f6d23":"df_pos['delta'].value_counts()[0:8]","39ebae70":"df_delta=df_pos[df_pos['delta']<'8 days']","af4e3218":"df_delta['Time gap']=df_delta['delta'].astype(str)","e400114e":"df_split=df_delta['Time gap'].str.rsplit('00',expand=True)\ndf_delta['Time gap']=df_split.iloc[:,0]\n","c75baab4":"fig=plt.figure(figsize=(20,10))\nax1=fig.add_subplot(111)\n\ng=sns.countplot('Time gap',hue='Fatal',data=df_delta,palette='rainbow',ax=ax1)\nax1.set_ylabel('Count',size=20)\nax1.set_xlabel('Time gap',size=20)\nax1.set_title('Duration between first symptom and date of hospitalisation with fatality',size=25)\nax1.legend(fontsize=15)\n","6c4df1b5":"fig2=plt.figure(figsize=(15,15))\nax1=fig2.add_subplot(2,2,1)\nax2=fig2.add_subplot(2,2,2)\nax3=fig2.add_subplot(2,2,3)\nax4=fig2.add_subplot(2,2,4)\ndf_pneu=df_pos[df_pos['pneumonia']=='Yes']\ndf_preg=df_pos[df_pos['pregnancy']=='Yes']\ndf_card=df_pos[df_pos['cardiovascular']=='Yes']\ndf_obes=df_pos[df_pos['obesity']=='Yes']\n\n\nsns.countplot('pneumonia',data=df_pneu,hue='Fatal',ax=ax1,palette='gnuplot')\nsns.countplot('pregnancy',data=df_preg,hue='Fatal',ax=ax2,palette='summer')\nsns.countplot('cardiovascular',data=df_card,hue='Fatal',ax=ax3,palette='viridis')\nsns.countplot('obesity',data=df_obes,hue='Fatal',ax=ax4,palette='winter')\n\nax1.set_title('Pneumonia + COVID',size=20)\nax2.set_title('Pregnancy + COVID',size=20)\nax3.set_title('Cardiovascular disease + COVID',size=20)\nax4.set_title('Obesity + COVID',size=20)\n\n\n\n\n\n\nax1.set_xlabel('Fatality rate: {0:.2f} %'.format(100*df_pneu['Fatal'].value_counts()[1]\/df_pneu['Fatal'].shape[0]),size=15)\n\n\nax2.set_xlabel('Fatality rate: {0:.2f} %'.format(100*df_preg['Fatal'].value_counts()[1]\/df_preg['Fatal'].shape[0]),size=15)\n\n\nax3.set_xlabel('Fatality rate: {0:.2f} %'.format(100*df_card['Fatal'].value_counts()[1]\/df_card['Fatal'].shape[0]),size=15)\n\n\nax4.set_xlabel('Fatality rate: {0:.2f} %'.format(100*df_obes['Fatal'].value_counts()[1]\/df_obes['Fatal'].shape[0]),size=15)\n\n\n\n","ad92ca07":"As we can see from the above barplots, even when patients got admitted on the same day as symptoms, there were quite a few fatalities as compared to others. However, the fatality rate for 7 day difference is also quite high. Hence, it is suggested to only visit the hospital after 1-3 days of selfcare as it doesn't significantly effect fatality.This would help to lessen the burden over the healthcare facilities.\n\n\n### Other patient medical conditions\n\nWe shall now check how the comorbidities or medical conditions such as pregnancy effects fatality of patients.\n\n\n### Pneumonia, Cardiovascular, Pregnancy, Obesity\n\nLet us check how the patients with the above medical conditions have fared.","ef8cf54d":"From the above plot, we see that 30-40 aged people are maximum followed by 40-50 and then, 20-30.\n\nLet us now check how the fatalities change with respect to each age band.","5cb073e5":"As we can see, the data has now been properly cleaned. All values with 97,98,99 have been replaced by null values. Let us check the number of null values for each feature.","eeef198f":"As we can see from the plot above, the data is quite balanced in terms of gender. This is exremely desirable when we are analysing data as it removes bias.\n\nLet us now check how many of these patients are positive and how many of each gender was fatal in nature.","bb904475":"Now that we have managed to separate the COVID +ve cases datewise, let us see how the time series analysis looks like. For the purpose of our analysis, we shall consider a rolling average of 10 days.","1815a239":"# 2. Importing relevant libraries and data\n\nLet us import all the necessary libraries and the datasets we require for our data visualisations.","b01221be":"From the above plot, we can see that number of intubations were far lower than non intubations. The intubation ratio basically tells for **every one single reported intubation, there were 11 other patients who weren't intubated**.\n\n\nWhat is also interesting to note is that even without intubations, there are a lot of patients who are COVID +ve. This goes to show that only a few patients with infection have severe requirement of intubations which are basically external respiratory devices.\n\nSince there is no way of knowing about the actual intubations for the null values, we will have to ignore these values completely.\n\n\n### Intubation test positivity\n\nThrough this metric we try to understand what are our chances of being COVID +ve if we are intubated.\n\n","4af69654":"From the above stats, we can observe that the male fatality rate is almost double of the female fatality rate. It seems that women are recovering better from the disease as compared to men.","a4d95d44":"As we can see from the plot above, the case fatality rate is quite high for patients who are already on incubators.\n\nBut what's staggering to see is that for patients who are on incubators and are COVID +ve, the case fatality is extremely high when in comparison to non positive cases. \n\nFor COVID +ve patients who are also intubed through ventilators, the fatality rate is 67.64 % which is quite high.\n\n### Sex\n\nNow, we shall check if sex is also a determining factor in case fatalities. Many diseases are such that females could recover better than males or vice versa. Hence, we are gonna check how the females and males have fared in their fight against the virus.","d2802151":"From the above graphs, we can see that patients with pneumonia and COVID-19 had the highest mortality rate followed by cardiovascular diseases.\n\n\n# 4. Conclusion\n\nFrom the analysis of the above data from Mexico, we could draw the following conlusions:\n\n* Ages above 60 significantly increased the fatalities for COVID +ve patients\n* Male fatality was found to be almost twice that of female fatality\n* Patients with didn't hospitalise themselves even after a week of syptoms and tested positive had reasonable fatalities. If symptoms are severe, it is best to be hospitalised in 2-3 days since the onset.\n* For patients with comorbities such as pneumonia, obesity or cardiovascular diseases, the fatality is higher.\n* Pregancy doesn't lead to any significant increase in fatality.\n\n\n# If you found my notebook helpful, an upvote would really help. \n\n\n# Stay safe fellow Kagglers !","305c9f36":"# 3. Data Cleaning and visualisation\n\nSince not all the data is always clean, we must take some effort to make the data more understandable and easier to plot. These steps would include things like idetifying null values, filling null values or dropping them, changing data type to required types.\n\n\nLet us list down all the descriptors of the data to clearly understand what the entries mean.\n\n## Data descriptors\n\n### (a) Sex\n\n1: Female\n\n2: Male\n\n### (b) Patient_type\n\n1: Outpatient\n\n2: Inpatient\n\n\n### (c) Columns with details like pregnancy, diabetes,copd,asthma , etc.\n\n1: Yes\n\n2: No\n\nOthers (97,98,99) : Not available\n\n\nOkay great ! Now that we have the available descriptors of each column, we can move forward with the cleaning of wrangling of the data.\n\n\nLet us check the various data types we are dealing with first.\n\n","61875aca":"# 1. Acknowledgment \n\n\n\nAt the very beginning, I would like to acknowledge the dataset contributor for his efforts to get the data that can help us analyse the data. \n\nCOVID-19 (SARS Cov-2) is a virus that targets the respiratory tract of vulnerable patients. According to WHO, this is the 14th worldwide pandemic and due to the nature of how global the world is today, this pandemic has been the most spread out in terms of infections with almost the entire world suffering. The pandemic has brought about huge economic worries for nations and even more so for the daily wage workers who are without any work now and need to depend upon goverment subsidies.\n\nNot just for the daily wage workers, this virus has caused immense strain in many other fields such as the educational field, aviation field, markets, travel industry and many more.\n\n\nWith respect to the nature of virus, due to it's nature, it keeps cosntantly mutating hence, making the job of the virologists extremely challenging to come up with a virus. This ailment has also brough about a great deal of an opportunity for budding data sceince emthisiasts such as myself to understand how the virus effects some poeple more than the rest. Through this kernel, I would like to find a few insights such. Moreover, understanding the pre-conditions would also help us make a smarter decision whether we should go to the hospital or keep ourselves home quarantined and not overload the hospitals. Some patients need health care facility much more than others. Hence, we must be considerate while making such choices.\n\n\n## Reminder\n\nThe data obtained is from the Mexican government and hence, the analysis is valid for Mexico or maybe North America. The pandemic stats and behaviours are extremely different for Asian countries when compared to North American or European countries owing to far lower case fatality rate for Asia.\n\n![COV.jpg](attachment:COV.jpg)","ff08bc7f":"Oh wow ! A large majority of the entries are null here. Let us analyse the non null values.","b77d7fee":"From the above left graph, we can see that we have a bimodal graph with high distribution from 20-60 years. There is also a peak in the lower section of the graph meaning we have high number of infants in our distribution.\n\nOn the right, we see that the distribution for both women and men is nearly identical. This is great because it will let us understand the body responses of the sexes with an identical age distribution.\n\n\nLet us now move ahead with the","5ff39e42":"From the above barplot, we can see that for the reported intubed patients, about 65.72 % of the patients are COVID +VE. This basically tells us that intubation is a strong indicator for indicator.\n\n\n### Intubation and fatality rate\n\nLet us try to understand how are the fatality numbers when a patient is intubed.","8e6fe8c7":"From the above plot, it can be seen that the case fatality is quite high for ages of 60-80 and above 80. This is expected since with body, the immune system becomes weaker and hence, it becomes tough for the body to fight a completely new virus. This is not just true for COVID but for most diseases.\n\n\n### Case load\n\n\nIn this particular section, we will check how the case loads vary across the dates. Moreover, we will also check the number of days since hospitalisation and symptoms and see if there are any relations with fatality.","6daf270f":"## Other patient details\n\nLet us check the other columns now. As we already know, entries such as 97,98,99 are codes for empty values. Hence, we shall replace these value with null values.\n\nHowever we don't want to mess with the age values since ages could genuinely be 97,98 or 99.\n\nMoreover, we don't have any use of id column. Hence, we can safely drop the id.","c3ee6b18":"The delta section in the above dataframe basically shows the number of days since first symptoms and hospitalisation.\n\nFirst, let us check the case loads of COVID +ve on each of the dates.","dc7f8825":"### Age\n\nLet us see how the ages are distributed and then check the number of positive cases for each age group. For the purpose of better understanding, we shall convert the continuous values of ages into various age bands as shown.\n\n\n* Less than 2 years\n* 2-10 years\n* 10-20 years\n* 20-30 years\n* 30-40 years\n* 40-50 years\n* 50-60 years\n* 60-80 years\n* Above 80 years","8cb051b6":"However, the data for date_died is not straightforward. Since only a fraction of the cases are actually fatal, hence, the date_died column will have many entries with 9s. We shall replace these values with some other value such as Not applicable.","121cdcb4":"From the above heatmap, high number of null values can bee seen in intubed, pregnancy , ICU and contact_other_covid features. Rest of the values don't seem to have much.\n\nLet us figure out what to with the null values one by one.\n\n### Intubed","ccc8e383":"Judging from the above data, we can see that we have a data of 5,66,602 patients.\n\nMost of the data is fine and requires no further wrangling other than the dates. Let us convert the date columns to a datetime datatype.\n\n## Date columns\n\nThe columns we are interested are:\n\n* entry_date\n* date_symptoms\n* date_died","d684a464":"From the above moving average curve, it seems like the infections spread very quickly since the start of April 2020 at an exponential rate.  After the month of July 2020, there seems to be a gradual decrease in number of incoming COVID +ve patients.\n\n\nLet us now check if the duration between first symptom and hospitalisation date has any relation of fatality.\n\nSince there are very absurd values such where difference between first symptomm and hospitalisation for COVID +ve patients are quite high, we will ignore these. We will consider a max of 5 days delta."}}