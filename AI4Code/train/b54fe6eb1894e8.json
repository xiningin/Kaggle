{"cell_type":{"3328ef59":"code","6f5222a6":"code","0da1e61b":"code","e66ed14a":"code","d5606498":"code","259d1510":"code","c1c6377e":"code","1cdf3fd1":"code","377a4db2":"code","23028b67":"code","592815fb":"code","be505446":"code","46c5378d":"code","eab485aa":"code","5219d17b":"code","fedc9ec3":"code","b22f1b92":"code","f9305ce2":"code","f509b21f":"code","1099864e":"code","eb7ca8ef":"code","8f8f2407":"code","429e8000":"code","4163fed5":"code","bcd19020":"code","e6ddd6c4":"code","ba3f1b91":"markdown","8ef610a5":"markdown","0fdcc5ba":"markdown","452c4e91":"markdown","12afa581":"markdown","7d701ae8":"markdown","b5d1bc3d":"markdown","98e797e0":"markdown","00cf72a8":"markdown","7da91ab2":"markdown","678b66dd":"markdown","89d60009":"markdown","d97b4d03":"markdown","8dbd1253":"markdown","8aa329d7":"markdown","bb6b6eab":"markdown","fee3e1dd":"markdown","7681d467":"markdown","0f38c707":"markdown","0c4bec78":"markdown","df145e2c":"markdown","406d62b2":"markdown","8905cc8d":"markdown","893cb368":"markdown","f5f32b7f":"markdown","9056f08b":"markdown"},"source":{"3328ef59":"import numpy as np \nimport pandas as pd \nimport matplotlib\nimport matplotlib.pyplot as plt\nimport calendar\nimport folium","6f5222a6":"df2015 = pd.read_csv('\/kaggle\/input\/daily-aqi-in-usa-counties-20152020\/daily_aqi_by_county_2015.csv')\ndf2016 = pd.read_csv('\/kaggle\/input\/daily-aqi-in-usa-counties-20152020\/daily_aqi_by_county_2016.csv')\ndf2017 = pd.read_csv('\/kaggle\/input\/daily-aqi-in-usa-counties-20152020\/daily_aqi_by_county_2017.csv')\ndf2018 = pd.read_csv('\/kaggle\/input\/daily-aqi-in-usa-counties-20152020\/daily_aqi_by_county_2018.csv')\ndf2019 = pd.read_csv('\/kaggle\/input\/daily-aqi-in-usa-counties-20152020\/daily_aqi_by_county_2019.csv')\ndf2020 = pd.read_csv('\/kaggle\/input\/daily-aqi-in-usa-counties-20152020\/daily_aqi_by_county_2020.csv')","0da1e61b":"print(df2015.dtypes)\nprint('-'*40)\nprint(df2016.dtypes)\nprint('-'*40)\nprint(df2017.dtypes)\nprint('-'*40)\nprint(df2018.dtypes)\nprint('-'*40)\nprint(df2019.dtypes)\nprint('-'*40)\nprint(df2020.dtypes)\nprint('-'*40)","e66ed14a":"df = pd.concat([df2015, df2016, df2017, df2018, df2019, df2020], ignore_index=True)\ndf.head(3)","d5606498":"df.dtypes","259d1510":"states=['California', 'Texas', 'Florida', 'New York', 'Pennsylvania', 'Illinois', 'Ohio', \n        'Georgia', 'North Carolina', 'Michigan', 'New Jersey', 'Virginia', 'Washington', \n        'Arizona', 'Massachusetts', 'Tennessee', 'Indiana', 'Missouri', 'Maryland', 'Wisconsin', \n        'Colorado', 'Minnesota', 'South Carolina', 'Alabama', 'Louisiana', 'Kentucky', 'Oregon', \n        'Oklahoma', 'Connecticut', 'Iowa', 'Utah', 'Nevada', 'Arkansas', 'Mississippi', 'Kansas', \n        'New Mexico', 'Nebraska', 'West Virginia', 'Idaho', 'Hawaii', 'New Hampshire', 'Maine', \n        'Montana', 'Rhode Island', 'Delaware', 'South Dakota', 'North Dakota', 'Alaska', \n        'District Of Columbia', 'Vermont', 'Wyoming']\nprint('Exclude data from the following regions\/countries:', \n      df[~df['State Name'].isin(states)]['State Name'].unique())\ndf = df[df['State Name'].isin(states)]\ndf.head()","c1c6377e":"df.Category.unique()","1cdf3fd1":"df_cat = df.groupby('Category')['AQI'].count().sort_values(ascending=False)\ndf_cat['Unhealthy'] = df_cat['Unhealthy']+df_cat['Very Unhealthy']+df_cat['Hazardous']\ndf_cat = df_cat[0:4]\ndf_cat","377a4db2":"plt.figure(figsize=(12,8))\nplt.pie(df_cat.values, colors=['#00db00', 'yellow', 'orange', 'red'], autopct='%1.1f%%',\n       pctdistance=1.35, explode=(0., 0., 0.1, 0.15))\nmy_circle=plt.Circle( (0,0), 0.6, color='white')\np=plt.gcf()\np.gca().add_artist(my_circle)\nplt.title('Air Quality (2015-2020)', fontsize=14, fontweight=\"bold\")\nplt.legend(['Good (AQI 0-50)', 'Moderate (AQI 51-100)', 'Unhealthy for Sensitive Groups (AQI 101-150)', \n            'Unhealthy (AQI>150)'], \n           bbox_to_anchor=(0.95, 0.85), loc='upper left')\nplt.show()","23028b67":"good = len(df[df['AQI']<=50]['State Name'].unique())\nmoderate = len(df[(df['AQI']>=51) & (df['AQI']<=100)]['State Name'].unique())\nunh_sens = len(df[(df['AQI']>=101) & (df['AQI']<=150)]['State Name'].unique())\n[good, moderate, unh_sens]","592815fb":"set(states)-set(df[df['AQI']>=151]['State Name'].unique())","be505446":"set(states)-set(df[df['AQI']>=201]['State Name'].unique())","46c5378d":"sites = pd.read_csv('\/kaggle\/input\/aqssites\/aqs_sites.csv')\nsites = sites[['State Code', 'County Code', 'Site Number', 'Latitude', 'Longitude', 'Elevation',\n       'Site Established Date', 'Site Closed Date', 'State Name', 'County Name', 'City Name', 'CBSA Name']]\nsites.head(3)","eab485aa":"print('Exclude data from the following regions\/countries:', \n      sites[~sites['State Name'].isin(states)]['State Name'].unique())","5219d17b":"sites['Site Closed Date'] = pd.to_datetime(sites['Site Closed Date'])\ncond = (( ( sites['Site Closed Date'].isna() ) | ( sites['Site Closed Date'].dt.year>=2015 ) )\n        & ( sites['State Name'].isin(states) )\n        & ( sites['Longitude']!=0 ) & ( sites['Latitude']!=0 )\n       )\nsites = sites[cond]\nsites.head(3)","fedc9ec3":"sites['Defining Site'] = sites['State Code']+'-'+sites['County Code'].astype(str).str.zfill(3)+'-'+sites['Site Number'].astype(str).str.zfill(4)\nsites.head(3)","b22f1b92":"df_h = pd.merge(df[df['AQI']>300], sites, how='left', on='Defining Site')","f9305ce2":"m = folium.Map(location=[48, -102], zoom_start=3)\n\nfor i in df_h.index:\n    if str(df_h['CBSA Name'][i])=='nan':\n        t = df_h['State Name_x'][i]\n    else:\n        t = df_h['CBSA Name'][i]\n    p = 'AQI='+str(df_h['AQI'][i])+' ('+str(df_h['Date'][i])+')'\n    folium.Marker([df_h['Latitude'][i], df_h['Longitude'][i]], \n                  tooltip=t, popup=p,\n                  icon=folium.Icon(icon='map-marker', color='darkred')).add_to(m)\nm","f509b21f":"site_max = df_h['Defining Site'].value_counts()\nsite_max_d = sites[sites['Defining Site']==site_max.index[0]]\nprint('In the period 2015-2020, there are ',df_h['Defining Site'].nunique(),\n      ' sites with reported hazardous air quality.')\nprint('The most reported site is located in ',\n      site_max_d['County Name'].values[0]+', '+site_max_d['State Name'].values[0],\n      ' with ', site_max[0],' measurements of AQI>300.')","1099864e":"df_Minn = pd.merge(df[df['State Name'] == 'Minnesota'], sites, how='left', on='Defining Site')\ndf_Minn.Date = pd.to_datetime(df_Minn.Date)\nprint('In the period 2015-2020, there are ',df_Minn.shape[0], ' measurements over ',\n      df_Minn.Date.nunique(), ' different dates.')","eb7ca8ef":"df_gr = df_Minn.groupby([df_Minn.Date.dt.year,'county Name','Category'])['AQI'].count().unstack(level=-1)\ndf_gr = df_gr[['Good', 'Moderate', 'Unhealthy for Sensitive Groups', 'Unhealthy']]\ndf_gr.fillna(0, inplace=True)\ndf_gr","8f8f2407":"fig, axes = plt.subplots(5, 1, figsize=(6,30))\nfor i in range(0,5):\n    d = df_gr.xs(2015+i, level=0, axis=0).sort_values(['county Name'], ascending=False)\n    d.plot.barh(ax=axes[i], stacked=True, color=['#00db00', 'yellow', 'orange', 'red'])\n    axes[i].set_title(str(2015+i))\n    axes[i].set_xlabel('Number of measurement days')\n    axes[i].legend(bbox_to_anchor=(1.05, 1))\nfor ax in axes:\n    ax.grid()\nplt.show()","429e8000":"df_Henn = df[df['county Name'] == 'Hennepin'][['Date','AQI']]\ndf_Henn.Date = pd.to_datetime(df_Henn.Date)\ndf_Henn.head()","4163fed5":"c = np.arange(1,6)\nnorm = matplotlib.colors.Normalize(vmin=c.min(), vmax=c.max())\ncmap = matplotlib.cm.ScalarMappable(norm=norm, cmap=matplotlib.cm.Blues)\ncmap.set_array([])\n\nfig, axes = plt.subplots(5, 1, figsize=(6,30))\nfor i in range(0,5):\n    d = df_Henn[df_Henn.Date.dt.year==(2015+i)]    \n    axes[i].plot(d['Date'], d['AQI'], c=cmap.to_rgba(i+2))\n    axes[i].set_title(str(2015+i))\n    axes[i].set_xlabel('Date')\n    axes[i].set_ylabel('AQI')\nfor ax in axes:\n    ax.grid()\nplt.show()","bcd19020":"df_Henn.set_index('Date', inplace=True)","e6ddd6c4":"def split_into_cycles():\n    cycles = []\n    for y in range(2015,2020):\n        cycle = df_Henn[df_Henn.index.year.isin([y])]\n        cycle.index = (cycle.index - cycle.index[0]).days\n        cycle.reindex(pd.Int64Index(np.arange(0,366)))\n        cycles.append(cycle)\n    return cycles\naqi_cycles = split_into_cycles()\n\nplt.figure(figsize=(15,8))\nfor i, cycle in enumerate(aqi_cycles):\n    cycle['AQI'].plot(label=f\"Year {i+2015}\", c=cmap.to_rgba(i+2))    \nplt.title('AQI levels for Hennepin county (2015-1019)', fontsize=16)\nplt.xticks(np.arange(0, 366, step=30.5), calendar.month_name[1:13], rotation=20)\nplt.xlabel('')\nplt.ylabel('AQI')\nplt.axhline(50, color='#00db00');\nplt.axhline(100, color='yellow');\nplt.legend()\nplt.show()","ba3f1b91":"# What about Minnesota?","8ef610a5":"Create new feature 'Defining Site' (e.g. 01-003-0010). The name matches the column name in the main 'df' dataframe.","0fdcc5ba":"In 2020, there was only 1 measurement that will be omitted in data visualization.","452c4e91":"We are interested in AQI measurements just in the USA.","12afa581":"## AQI levels in Minnesota counties (2015-2019)","7d701ae8":"# Map of sites with hazardous air quality measurements","b5d1bc3d":"Before mapping places with AQI values indicating *Hazardous* air quality, first read data with locations of measurement sites.","98e797e0":"We can present data for each year and each county.","00cf72a8":"# Air quality categories","7da91ab2":"We can merge the main dataframe (with AQI>300) with the dataframe 'sites' based on the measurement site entries from the column 'Defining Site'.","678b66dd":"## Hennepin county","89d60009":"In conclusion, during 2015-2020, in 98.65% of measurements the air quality in the USA was reported to be *Good* or *Moderate*. ","d97b4d03":"# Import packages and read data","8dbd1253":"Accoring to EPA, there are several categories that describe air quality, based on different values of AQI (Air Quality Index):\n> \n> * Good (AQI 0-50): Air quality is good and poses little or no risk.\n> * Moderate (AQI 51-100): Air quality is acceptable; however, there may be some health concern for a small number of unusually sensitive people. \n> * Unhealthy for Sensitive Groups (AQI 101-150): People who are in sensitive groups may experience health effects when engaged in outdoor activities.\n> * Unhealthy (AQI 151-200): Everyone who is active outdoors may experience effects. Members of sensitive groups are likely to experience more serious effects.\n> * Very Unhealthy (AQI 201-300): It is expected that there will be widespread effects among the general population and more serious effects in members of sensitive groups. \n> * Hazardous (AQI 301-500): Air quality in this range triggers health warnings of emergency conditions by media outlets. The entire population is more likely to be affected by serious health effects.\n> ","8aa329d7":"# States with the highest air quality","bb6b6eab":"After inspection of dataframes 'df2015', ..., 'df2020', we can notice that data are consistently recorded, and that we can concatenate these dataframes into a single dataframe 'df'.","fee3e1dd":"Conclusion:\n* In the counties with measurement sites, each year the majority of days had *Good* air quality.\n* During 2015-2019, Hennepin county had more *Moderate* air quality days compared to other counties. This shouldn't be a surprise since it is the most populated county in Minnesota with more than 1.2 mil. residents, and with Minneapolis as its seat. ","7681d467":"Beside dropping data that are not registered at 50 USA states or *Disctrict of Columbia*, we need to exclude closed sites (at least closed before 2015), and those for which longitude and latitude are entered as zero.","0f38c707":"Collecting public data from EPA (U.S. Environmental Protection Agency), the goal is to investigate air quality based on levels of AQI (Air Quality Index). \n\nData are analyzed for US counties in the period 2015-2020.","0c4bec78":"# Introduction","df145e2c":"According to www.exploreminnesota.com, state of Minnesota has more than 4,000 miles of paved bike trails, 11,000 lakes, 500 golf courses, and the nation\u2019s top city parks. While enjoying in various outdoor activities (bike riding, fishing, kayaking, golfing, ...), what is the quality of air we breathe?","406d62b2":"Mouse over marker for the location name.\n\nClick on the marker to read AQI level and measurement date.","8905cc8d":"In the period 2015-2020, let's count how many times the air is reported to be *Good*, *Moderate*, *Unhealthy for sensitive groups*, or *Unhealthy* (all values of AQI higher than 150 will be considered as unhealthy).","893cb368":"States **Nebraska** and **Vermont** have no Air Quality Index (AQI) values higher than 150 in the period 2015-2020. Thus we can regard them as the *states with the highest air quality*.\n\nMeasurements in the following states showed that during 2015-2020, the air quality was never *Very unhealthy* or *Hazardous*.","f5f32b7f":"During 2015-2020, all states have reported at least once that the air was *Good*, *Moderate*, or *Unhealthy for sensitive groups* (as to be expected).\n\nThere are only two states that stand out:","9056f08b":"# Site listing"}}