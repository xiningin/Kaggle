{"cell_type":{"34e00e72":"code","166b34ed":"code","5f340087":"code","28449fba":"code","c2369823":"code","044e5d2e":"code","7b5c2b36":"code","678f7e74":"code","b6e4cede":"code","8033c5d4":"code","92613f5c":"code","7f69bba6":"code","f384b5be":"code","baa1aaab":"code","d6021899":"code","347308f4":"code","9adf88ac":"code","f6b83c94":"code","8e46c47c":"code","d125c178":"code","3cf8d8f9":"code","1debb03b":"code","42462f76":"code","62af156c":"code","5f0f68ac":"code","1fa611d1":"code","eaaf5a6d":"code","9dd4c45b":"markdown","c2ba21a3":"markdown","41e75aaf":"markdown","b69b8a32":"markdown","7147c0f8":"markdown"},"source":{"34e00e72":"import numpy as np\nimport tensorflow as tf\nimport random as rn\nimport os\nfrom keras import backend as K\nimport pandas as pd # \u57fa\u672c\u30e9\u30a4\u30d6\u30e9\u30ea\nimport numpy as np # \u57fa\u672c\u30e9\u30a4\u30d6\u30e9\u30ea\nimport matplotlib.pyplot as plt # \u30b0\u30e9\u30d5\u63cf\u753b\u7528\nimport seaborn as sns; sns.set() # \u30b0\u30e9\u30d5\u63cf\u753b\u7528\nimport shap\nimport tensorflow_hub as hub\nfrom tensorflow.keras import layers\nfrom tensorflow.keras.models import Sequential\nfrom tensorflow.keras.layers import Dense, GlobalAveragePooling2D\nfrom tensorflow.keras import optimizers\nfrom keras.preprocessing.image import load_img, img_to_array\nfrom keras.preprocessing.image import ImageDataGenerator\nimport matplotlib.pyplot as plt\nimport glob","166b34ed":"!pip install -U git+https:\/\/github.com\/qubvel\/efficientnet","5f340087":"from efficientnet.tfkeras import EfficientNetB0","28449fba":"from keras.preprocessing import image\nfrom sklearn.model_selection import train_test_split\nimport keras\ninput_shape = (224, 224, 3)\nbatch_size = 512\nepochs = 30\nnum_classes = 5\ntrain_images = []\ntrain_labels = []\nfor f in os.listdir(\"\/kaggle\/input\/1056lab-noodles-image-classification\/train\/pad_thai\"):\n    train_images.append(image.img_to_array(image.load_img(\"\/kaggle\/input\/1056lab-noodles-image-classification\/train\/pad_thai\/\"+f, target_size=input_shape[:2])))\n    train_labels.append(0)\nfor f in os.listdir(\"\/kaggle\/input\/1056lab-noodles-image-classification\/train\/pho\"):\n    train_images.append(image.img_to_array(image.load_img(\"\/kaggle\/input\/1056lab-noodles-image-classification\/train\/pho\/\"+f, target_size=input_shape[:2])))\n    train_labels.append(1)\nfor f in os.listdir(\"\/kaggle\/input\/1056lab-noodles-image-classification\/train\/ramen\"):\n    train_images.append(image.img_to_array(image.load_img(\"\/kaggle\/input\/1056lab-noodles-image-classification\/train\/ramen\/\"+f, target_size=input_shape[:2])))\n    train_labels.append(2)\nfor f in os.listdir(\"\/kaggle\/input\/1056lab-noodles-image-classification\/train\/spaghetti_bolognese\"):\n    train_images.append(image.img_to_array(image.load_img(\"\/kaggle\/input\/1056lab-noodles-image-classification\/train\/spaghetti_bolognese\/\"+f, target_size=input_shape[:2])))\n    train_labels.append(3)\nfor f in os.listdir(\"\/kaggle\/input\/1056lab-noodles-image-classification\/train\/spaghetti_carbonara\"):\n    train_images.append(image.img_to_array(image.load_img(\"\/kaggle\/input\/1056lab-noodles-image-classification\/train\/spaghetti_carbonara\/\"+f, target_size=input_shape[:2])))\n    train_labels.append(4)","c2369823":"test_images = []\ntest_labels = []\nfor f in sorted(os.listdir(\"\/kaggle\/input\/1056lab-noodles-image-classification\/test\")):\n    test_images .append(image.img_to_array(image.load_img(\"\/kaggle\/input\/1056lab-noodles-image-classification\/test\/\"+f, target_size=input_shape[:2])))\n    test_labels .append(0)","044e5d2e":"train_images = np.asarray(train_images)\ntrain_labels = np.asarray(train_labels)\ntest_images = np.asarray(test_images)\ntest_labels = np.asarray(test_labels)","7b5c2b36":"class_names = ['pad_thai', 'pho', 'ramen', 'spaghetti_bolognese', 'spaghetti_carbonara']","678f7e74":"train_images = train_images \/ 255.0\ntest_images = test_images \/ 255.0","b6e4cede":"def horizontal_flip(image):\n    return image[:, ::-1, :]\nhf_img = horizontal_flip(train_images)","8033c5d4":"han_img = horizontal_flip(train_images)","92613f5c":"from skimage import util\n#noise_img = util.random_noise(train_images)","7f69bba6":"train_images = han_img","f384b5be":"train_labels = keras.utils.to_categorical(train_labels, num_classes)\ntest_labels = keras.utils.to_categorical(test_labels, num_classes)","baa1aaab":"from tensorflow.python.keras.models import load_model","d6021899":"from keras.models import Sequential\nfrom keras.layers import Input, Dense, Dropout, Activation, Flatten\nfrom keras.optimizers import SGD\nnb_classes = 5","347308f4":"feature_extractor_url = tf.keras.models.load_model('..\/input\/noodlesmodelattention\/EfficientNetB0.h5')","9adf88ac":"input_shape = train_images.shape[1:]\ntrain_samples = train_images.shape[0]\ntest_samples = test_images.shape[0]\n\n# \u30cf\u30a4\u30d1\u30d1\u30e9\u30e1\u30fc\u30bf\nepochs = 20\nbatch_size = 32","f6b83c94":"feature_extractor_layer = hub.KerasLayer(feature_extractor_url,input_shape=(224,224,3))\n# \u5b66\u7fd2\u6e08\u307f\u91cd\u307f\u306f\u56fa\u5b9a\nfeature_extractor_layer.trainable = False\n\nmodel = Sequential([\n  feature_extractor_layer,\n  layers.Dense(256),\n    layers.Activation('relu'),\n    layers.Dropout(0.5),\n  layers.Dense(num_classes, activation='softmax')\n])","8e46c47c":"model.summary()","d125c178":"model.compile(loss='categorical_crossentropy',\n              optimizer=SGD(lr=1e-3, decay=1e-6, momentum=0.9, nesterov=True),\n              metrics=['accuracy'])","3cf8d8f9":"model.fit(train_images, train_labels,batch_size=batch_size,epochs=epochs)","1debb03b":"predictions = model.predict(test_images)","42462f76":"predictions=np.argmax(predictions,axis=1).astype(str)","62af156c":"np.place(predictions,predictions=='0','pad_thai')\nnp.place(predictions,predictions=='1','pho')\nnp.place(predictions,predictions=='2','ramen')\nnp.place(predictions,predictions=='3','spaghetti_bolognese')\nnp.place(predictions,predictions=='4','spaghetti_carbonara')","5f0f68ac":"submit_df = pd.read_csv('\/kaggle\/input\/1056lab-noodles-image-classification\/sampleSubmission.csv', index_col=0)","1fa611d1":"submit_df[\"label\"] = predictions","eaaf5a6d":"submit_df","9dd4c45b":"## \u30af\u30e9\u30b9\u540d\u306e\u4fdd\u5b58","c2ba21a3":"# Data Augmentation","41e75aaf":"# google colaboratory\u3067training\u3092\u884c\u3063\u305f\u30e2\u30c7\u30eb\u3092\u4f7f\u7528\u3059\u308b\u3002  \nhttps:\/\/www.kaggle.com\/kotashimomura\/noodlesmodelattention","b69b8a32":"# \u30c7\u30fc\u30bf\u306e\u30ed\u30fc\u30c9","7147c0f8":"# \u30a2\u30f3\u30b5\u30f3\u30d6\u30eb\u3059\u308b"}}