{"cell_type":{"2b313392":"code","9e1161d4":"code","777a8c24":"code","48befdc1":"code","e774f12d":"code","0cce4057":"code","4ddba593":"code","d793e5b7":"code","29008fd8":"code","18ec2748":"code","a81ad77c":"code","e953f91f":"code","c366f33a":"code","3131e537":"code","be63b88e":"code","14c52051":"code","a480a005":"code","f4bf313a":"code","55d04209":"code","e78b03f3":"code","3e9182a4":"code","7704c4c2":"code","0a17acd8":"code","5757b053":"code","5fc07f39":"code","51508ee4":"code","22ae4ef5":"code","9f3f6ff1":"code","527de83d":"code","190b1ce5":"code","13c59b52":"code","999a2a84":"code","73827144":"code","f0a9168a":"code","60d8ffe2":"code","a15c2cf8":"code","b4895409":"code","af90675b":"code","e89b6411":"code","7e90920b":"code","21141ccf":"code","64d87a42":"code","f410731a":"code","94014844":"code","6c291bd2":"code","e10097d9":"code","bff7fee5":"code","dd39c122":"code","4fa66521":"code","f9233cb5":"code","864baddd":"code","8dd1ae4d":"code","f2c82ee5":"code","37e8c6e2":"code","9a45e554":"code","2b54d0de":"code","281992d7":"code","407c0bca":"code","b4f4decd":"code","e7d173eb":"code","03548522":"code","94a1b728":"code","ee08ea71":"code","ff6325a9":"code","923d2707":"code","13453ad0":"code","64e04e95":"code","c755d7df":"code","0bd79572":"code","d3ed95a0":"code","be22a5d6":"code","d32e30de":"code","fb9da9df":"code","bc77dc29":"code","265cc52b":"code","0f8a1ddd":"code","98c749d4":"code","4acd4333":"code","3b7a3e63":"code","819712f9":"code","49fa0981":"code","0480e6e9":"code","c5c33763":"code","7672757b":"code","241165fe":"code","25381a76":"code","1aea6389":"code","e763b84b":"code","71754005":"code","d45f2a23":"code","20ccd91f":"code","f1e7aa4e":"code","b9644229":"code","68006c2f":"code","e7f0d8e2":"code","6c78b713":"code","c5c69e01":"code","83e7ada9":"code","ebd8ef67":"code","9f547c10":"code","09f2f496":"code","3731b6e1":"code","e44d3d4a":"code","dab9e15a":"code","7f71a3ec":"code","758179dc":"code","15abb8d6":"code","919fa16a":"code","18d55508":"code","af32b24d":"code","8ae73442":"code","3636aa5c":"code","eb550788":"code","8ab7b822":"code","9d432d7c":"code","ddea29f1":"code","a6728b60":"code","7ff4519e":"code","4e6fa9c1":"code","177bfc0a":"code","b939c0b9":"code","f902afa4":"markdown","71e0d3d4":"markdown","e3427512":"markdown","ca706390":"markdown","cf420e95":"markdown","5d7cfebf":"markdown","3b467a3e":"markdown","5a2bc20f":"markdown","c2f86c12":"markdown","336bb7dd":"markdown","6464d56c":"markdown","65daacdb":"markdown","65abd18a":"markdown","68a6aa82":"markdown","cdc8a927":"markdown","7ed3ddbd":"markdown","7e66c4d3":"markdown","20af5e2a":"markdown","8685d174":"markdown","9a8979f9":"markdown","4deaf9a5":"markdown","26aac5f2":"markdown","cd58e43c":"markdown","740f3334":"markdown","db72de21":"markdown","93cc9a02":"markdown","1d428c0b":"markdown","be17457f":"markdown","76957f79":"markdown","51d7b07d":"markdown","8b25542b":"markdown","2b6a3e6b":"markdown","ed75400f":"markdown","c4ecfa27":"markdown","e07d3441":"markdown","f1fa1c76":"markdown","c9586c15":"markdown","dc7de03c":"markdown","5a2c81fd":"markdown","7f5b6749":"markdown","8b9f35a2":"markdown","49b09e43":"markdown","3d2aa475":"markdown","a9831cbf":"markdown","217bba11":"markdown","917548fc":"markdown","4ca9b3aa":"markdown","fe66df74":"markdown","dc3308df":"markdown","08084e0d":"markdown","ff703ec7":"markdown","3d0cfb90":"markdown","eb92a932":"markdown","5c5b9e5e":"markdown","6faae583":"markdown","ae229385":"markdown","3ad49b28":"markdown","f9ad7f61":"markdown","0a5d95be":"markdown","f6b691fb":"markdown","dea53cc8":"markdown","63a60617":"markdown","00ed1a4e":"markdown","08deff47":"markdown","570cf290":"markdown","3272621c":"markdown","1d648882":"markdown","7f95bbc0":"markdown","6283bcfe":"markdown","9b198bd7":"markdown","61c0cb95":"markdown","7616f9a5":"markdown","55296a64":"markdown","b6f184b0":"markdown","e214b3fb":"markdown","1599c613":"markdown","5a5fb0fe":"markdown","61170ee0":"markdown","2ae8fe23":"markdown","b8d6b6a6":"markdown","ea1f9633":"markdown","dcdce5fd":"markdown","c923b35a":"markdown","850198dd":"markdown","470b1fac":"markdown"},"source":{"2b313392":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly.express as px \nimport warnings\nwarnings.filterwarnings('ignore')","9e1161d4":"df=pd.read_csv('..\/input\/telco-customer-churn\/WA_Fn-UseC_-Telco-Customer-Churn.csv')","777a8c24":"df.head()","48befdc1":"df.shape","e774f12d":"df.nunique()","0cce4057":"df.isnull().sum()","4ddba593":"df.dtypes","d793e5b7":"df['Churn'].value_counts()","29008fd8":"df.skew()","18ec2748":"df.describe()","a81ad77c":"#Separating categorical and continuous features\ncat=[i for i in df.columns if df[i].nunique()<10 ]\ncont=[i for i in df.columns if df[i].nunique()>10 and i!='customerID']","e953f91f":"plt.figure(figsize=(15,8))\nplt.subplot(1,2,1)\ndf['Churn'].value_counts().plot.pie(autopct='%1.1f%%')\ncentre=plt.Circle((0,0),0.7,fc='white')\nfig=plt.gcf()\nfig.gca().add_artist(centre)\nplt.subplot(1,2,2)\nsns.countplot(x='Churn',data=df)\ndf['Churn'].value_counts()","c366f33a":"plt.figure(figsize=(15,8))\nplt.subplot(1,2,1)\ndf['gender'].value_counts().plot.pie(autopct='%1.1f%%')\ncentre=plt.Circle((0,0),0.7,fc='white')\nfig=plt.gcf()\nfig.gca().add_artist(centre)\nplt.subplot(1,2,2)\nsns.countplot(x='gender',data=df)\ndf['gender'].value_counts()","3131e537":"plt.figure(figsize=(15,8))\nplt.subplot(1,2,1)\ndf['SeniorCitizen'].value_counts().plot.pie(autopct='%1.1f%%')\ncentre=plt.Circle((0,0),0.7,fc='white')\nfig=plt.gcf()\nfig.gca().add_artist(centre)\nplt.subplot(1,2,2)\nsns.countplot(x='SeniorCitizen',data=df)\ndf['SeniorCitizen'].value_counts()","be63b88e":"plt.figure(figsize=(15,8))\nplt.subplot(1,2,1)\ndf['Partner'].value_counts().plot.pie(autopct='%1.1f%%')\ncentre=plt.Circle((0,0),0.7,fc='white')\nfig=plt.gcf()\nfig.gca().add_artist(centre)\nplt.subplot(1,2,2)\nsns.countplot(x='Partner',data=df)\ndf['Partner'].value_counts()","14c52051":"plt.figure(figsize=(15,8))\nplt.subplot(1,2,1)\ndf['Dependents'].value_counts().plot.pie(autopct='%1.1f%%')\ncentre=plt.Circle((0,0),0.7,fc='white')\nfig=plt.gcf()\nfig.gca().add_artist(centre)\nplt.subplot(1,2,2)\nsns.countplot(x='Dependents',data=df)\ndf['Dependents'].value_counts()","a480a005":"plt.figure(figsize=(15,8))\nplt.subplot(1,2,1)\ndf['PhoneService'].value_counts().plot.pie(autopct='%1.1f%%')\ncentre=plt.Circle((0,0),0.7,fc='white')\nfig=plt.gcf()\nfig.gca().add_artist(centre)\nplt.subplot(1,2,2)\nsns.countplot(x='PhoneService',data=df)\ndf['PhoneService'].value_counts()","f4bf313a":"plt.figure(figsize=(15,8))\nplt.subplot(1,2,1)\ndf['MultipleLines'].value_counts().plot.pie(autopct='%1.1f%%')\ncentre=plt.Circle((0,0),0.7,fc='white')\nfig=plt.gcf()\nfig.gca().add_artist(centre)\nplt.subplot(1,2,2)\nsns.countplot(x='MultipleLines',data=df)\ndf['MultipleLines'].value_counts()","55d04209":"plt.figure(figsize=(15,8))\nplt.subplot(1,2,1)\ndf['InternetService'].value_counts().plot.pie(autopct='%1.1f%%')\ncentre=plt.Circle((0,0),0.7,fc='white')\nfig=plt.gcf()\nfig.gca().add_artist(centre)\nplt.subplot(1,2,2)\nsns.countplot(x='InternetService',data=df)\ndf['InternetService'].value_counts()","e78b03f3":"plt.figure(figsize=(15,8))\nplt.subplot(1,2,1)\ndf['OnlineSecurity'].value_counts().plot.pie(autopct='%1.1f%%')\ncentre=plt.Circle((0,0),0.7,fc='white')\nfig=plt.gcf()\nfig.gca().add_artist(centre)\nplt.subplot(1,2,2)\nsns.countplot(x='OnlineSecurity',data=df)\ndf['OnlineSecurity'].value_counts()","3e9182a4":"plt.figure(figsize=(15,8))\nplt.subplot(1,2,1)\ndf['OnlineBackup'].value_counts().plot.pie(autopct='%1.1f%%')\ncentre=plt.Circle((0,0),0.7,fc='white')\nfig=plt.gcf()\nfig.gca().add_artist(centre)\nplt.subplot(1,2,2)\nsns.countplot(x='OnlineBackup',data=df)\ndf['OnlineBackup'].value_counts()","7704c4c2":"plt.figure(figsize=(15,8))\nplt.subplot(1,2,1)\ndf['DeviceProtection'].value_counts().plot.pie(autopct='%1.1f%%')\ncentre=plt.Circle((0,0),0.7,fc='white')\nfig=plt.gcf()\nfig.gca().add_artist(centre)\nplt.subplot(1,2,2)\nsns.countplot(x='DeviceProtection',data=df)\ndf['DeviceProtection'].value_counts()","0a17acd8":"plt.figure(figsize=(15,8))\nplt.subplot(1,2,1)\ndf['TechSupport'].value_counts().plot.pie(autopct='%1.1f%%')\ncentre=plt.Circle((0,0),0.7,fc='white')\nfig=plt.gcf()\nfig.gca().add_artist(centre)\nplt.subplot(1,2,2)\nsns.countplot(x='TechSupport',data=df)\ndf['TechSupport'].value_counts()","5757b053":"plt.figure(figsize=(15,8))\nplt.subplot(1,2,1)\ndf['StreamingTV'].value_counts().plot.pie(autopct='%1.1f%%')\ncentre=plt.Circle((0,0),0.7,fc='white')\nfig=plt.gcf()\nfig.gca().add_artist(centre)\nplt.subplot(1,2,2)\nsns.countplot(x='StreamingTV',data=df)\ndf['StreamingTV'].value_counts()","5fc07f39":"plt.figure(figsize=(15,8))\nplt.subplot(1,2,1)\ndf['StreamingMovies'].value_counts().plot.pie(autopct='%1.1f%%')\ncentre=plt.Circle((0,0),0.7,fc='white')\nfig=plt.gcf()\nfig.gca().add_artist(centre)\nplt.subplot(1,2,2)\nsns.countplot(x='StreamingMovies',data=df)\ndf['StreamingMovies'].value_counts()","51508ee4":"plt.figure(figsize=(15,8))\nplt.subplot(1,2,1)\ndf['Contract'].value_counts().plot.pie(autopct='%1.1f%%')\ncentre=plt.Circle((0,0),0.7,fc='white')\nfig=plt.gcf()\nfig.gca().add_artist(centre)\nplt.subplot(1,2,2)\nsns.countplot(x='Contract',data=df)\ndf['Contract'].value_counts()","22ae4ef5":"plt.figure(figsize=(15,8))\nplt.subplot(1,2,1)\ndf['PaperlessBilling'].value_counts().plot.pie(autopct='%1.1f%%')\ncentre=plt.Circle((0,0),0.7,fc='white')\nfig=plt.gcf()\nfig.gca().add_artist(centre)\nplt.subplot(1,2,2)\nsns.countplot(x='PaperlessBilling',data=df)\ndf['PaperlessBilling'].value_counts()","9f3f6ff1":"plt.figure(figsize=(15,8))\nplt.subplot(1,2,1)\ndf['PaymentMethod'].value_counts().plot.pie(autopct='%1.1f%%')\ncentre=plt.Circle((0,0),0.7,fc='white')\nfig=plt.gcf()\nfig.gca().add_artist(centre)\nplt.subplot(1,2,2)\nsns.countplot(x='PaymentMethod',data=df)\nplt.xticks(rotation=45)\ndf['PaymentMethod'].value_counts()","527de83d":"plt.figure(figsize=(8,6))\nsns.histplot(df['tenure'],kde=True,color='k')\nprint('Minimum',df['tenure'].min())\nprint('Maximum',df['tenure'].max())","190b1ce5":"plt.figure(figsize=(8,6))\nsns.histplot(df['MonthlyCharges'],kde=True,color='k')\nprint('Minimum',df['MonthlyCharges'].min())\nprint('Maximum',df['MonthlyCharges'].max())","13c59b52":"df['TotalCharges']=df['TotalCharges'].apply(lambda x: np.NaN if x==' ' else float(x))","999a2a84":"plt.figure(figsize=(8,6))\nsns.distplot(df['TotalCharges'],kde=True,color='k')\nprint('Minimum',df['TotalCharges'].min())\nprint('Maximum',df['TotalCharges'].max())","73827144":"for i in cont:\n    sns.boxplot(df[i])\n    plt.figure()","f0a9168a":"plt.figure(figsize=(8,6))\nsns.boxenplot(x='Churn',y='TotalCharges',data=df,palette='rainbow')","60d8ffe2":"plt.figure(figsize=(8,6))\nsns.boxenplot(x='Churn',y='MonthlyCharges',data=df,palette='rainbow')","a15c2cf8":"plt.figure(figsize=(8,6))\nsns.boxenplot(x='Churn',y='tenure',data=df,palette='rainbow')","b4895409":"plt.figure(figsize=(8,6))\nsns.countplot(df['gender'],hue=df['Churn'],palette='Set1')","af90675b":"plt.figure(figsize=(8,6))\nsns.countplot(df['SeniorCitizen'],hue=df['Churn'],palette='Set1')","e89b6411":"plt.figure(figsize=(8,6))\nsns.countplot(df['Partner'],hue=df['Churn'],palette='Set1')","7e90920b":"plt.figure(figsize=(8,6))\nsns.countplot(df['Dependents'],hue=df['Churn'],palette='Set1')","21141ccf":"plt.figure(figsize=(8,6))\nsns.countplot(df['PhoneService'],hue=df['Churn'],palette='Set1')","64d87a42":"plt.figure(figsize=(12,6))\nsns.countplot(df['MultipleLines'],hue=df['Churn'],palette='Set1')","f410731a":"plt.figure(figsize=(12,6))\nsns.countplot(df['InternetService'],hue=df['Churn'],palette='Set1')","94014844":"plt.figure(figsize=(12,6))\nsns.countplot(df['OnlineSecurity'],hue=df['Churn'],palette='Set1')","6c291bd2":"plt.figure(figsize=(12,6))\nsns.countplot(df['OnlineBackup'],hue=df['Churn'],palette='Set1')","e10097d9":"plt.figure(figsize=(12,6))\nsns.countplot(df['DeviceProtection'],hue=df['Churn'],palette='Set1')","bff7fee5":"plt.figure(figsize=(12,6))\nsns.countplot(df['TechSupport'],hue=df['Churn'],palette='Set1')","dd39c122":"plt.figure(figsize=(12,6))\nsns.countplot(df['StreamingTV'],hue=df['Churn'],palette='Set1')","4fa66521":"plt.figure(figsize=(12,6))\nsns.countplot(df['StreamingMovies'],hue=df['Churn'],palette='Set1')","f9233cb5":"plt.figure(figsize=(12,6))\nsns.countplot(df['Contract'],hue=df['Churn'],palette='Set1')","864baddd":"plt.figure(figsize=(15,6))\nsns.countplot(df['PaymentMethod'],hue=df['Churn'],palette='Set1')","8dd1ae4d":"sns.lmplot(x='MonthlyCharges',y='TotalCharges',data=df,height=6, aspect=1.2)","f2c82ee5":"sns.lmplot(x='tenure',y='TotalCharges',data=df,height=6, aspect=1.2,)","37e8c6e2":"#Senior citizen vs other features.\nplt.figure(figsize=(10,10))\nplt.subplot(2,2,1)\nsns.countplot(df['StreamingMovies'],hue=df['SeniorCitizen'],palette='Set2')\n\nplt.subplot(2,2,2)\nsns.countplot(df['StreamingTV'],hue=df['SeniorCitizen'],palette='Set2')\n\nplt.subplot(2,2,3)\nsns.countplot(df['Contract'],hue=df['SeniorCitizen'],palette='Set2')\n\nplt.subplot(2,2,4)\nsns.countplot(df['PaymentMethod'],hue=df['SeniorCitizen'],palette='Set2')\nplt.xticks(rotation=45)\n","9a45e554":"#Phone service vs other features.\nplt.figure(figsize=(10,10))\nplt.subplot(3,2,1)\nsns.countplot(df['MultipleLines'],hue=df['PhoneService'],palette='Set2')\n\nplt.subplot(3,2,2)\nsns.countplot(df['OnlineBackup'],hue=df['PhoneService'],palette='Set2')\n\nplt.subplot(3,2,3)\nsns.countplot(df['OnlineSecurity'],hue=df['PhoneService'],palette='Set2')\n\nplt.subplot(3,2,4)\nsns.countplot(df['TechSupport'],hue=df['PhoneService'],palette='Set2')\n\nplt.subplot(3,2,5)\nsns.countplot(df['StreamingMovies'],hue=df['PhoneService'],palette='Set2')\n\nplt.subplot(3,2,6)\nsns.countplot(df['DeviceProtection'],hue=df['PhoneService'],palette='Set2')","2b54d0de":"#Internet Service vs other features.\nplt.figure(figsize=(10,10))\nplt.subplot(3,2,1)\nsns.countplot(df['OnlineSecurity'],hue=df['InternetService'],palette='Set2')\n\nplt.subplot(3,2,2)\nsns.countplot(df['OnlineBackup'],hue=df['InternetService'],palette='Set2')\n\nplt.subplot(3,2,3)\nsns.countplot(df['DeviceProtection'],hue=df['InternetService'],palette='Set2')\n\nplt.subplot(3,2,4)\nsns.countplot(df['TechSupport'],hue=df['InternetService'],palette='Set2')\n\nplt.subplot(3,2,5)\nsns.countplot(df['StreamingMovies'],hue=df['InternetService'],palette='Set2')\n\nplt.subplot(3,2,6)\nsns.countplot(df['StreamingTV'],hue=df['InternetService'],palette='Set2')","281992d7":"plt.figure(figsize=(8,6))\nsns.stripplot(x='PhoneService',y='InternetService',hue='Churn',data=df)","407c0bca":"plt.figure(figsize=(8,6))\nsns.scatterplot(x='tenure',y='TotalCharges',hue='Churn',data=df,palette='inferno',marker='D')","b4f4decd":"plt.figure(figsize=(8,6))\nsns.scatterplot(x='tenure',y='MonthlyCharges',hue='Churn',data=df,palette='inferno',marker='D')","e7d173eb":"plt.figure(figsize=(8,6))\nsns.scatterplot(x='MonthlyCharges',y='TotalCharges',hue='Churn',data=df,palette='inferno',marker='D')","03548522":"plt.figure(figsize=(10,8))\nsns.heatmap(df.corr(),annot=True,cmap='Greys')","94a1b728":"sns.pairplot(df, hue = 'Churn',palette='Set2')","ee08ea71":"df.drop('customerID',axis=1,inplace=True)","ff6325a9":"#Creating pivot table to help fill nan values of visibility from here\ntable = df.pivot_table(values='TotalCharges', index='InternetService', columns='Contract', aggfunc='mean')\ntable","923d2707":"def find_mean(x):\n    \n    return table.loc[x['InternetService'], x['Contract']]\n\n# replace missing values in visibility with mean values from above pivot table\ndf['TotalCharges'].fillna(df[df['TotalCharges'].isnull()].apply(find_mean, axis=1), inplace=True)","13453ad0":"sns.heatmap(df.isnull())","64e04e95":"from sklearn.preprocessing import OrdinalEncoder,LabelEncoder\no=OrdinalEncoder()\nl=LabelEncoder()","c755d7df":"#using ordinal encoder for independent features\nfor i in df.columns:\n    if df[i].dtypes=='O' and i!='Churn':\n        df[i]=o.fit_transform(df[i].values.reshape(-1,1))\n\n#Using label encoder for Label Column\ndf['Churn']=l.fit_transform(df['Churn'])","0bd79572":"x=df.copy()\nx.drop('Churn',axis=1,inplace=True)\ny=df['Churn']","d3ed95a0":"from imblearn.over_sampling import SMOTE\nover=SMOTE()","be22a5d6":"x,y=over.fit_resample(x,y)","d32e30de":"from sklearn.preprocessing import MinMaxScaler\nscaler=MinMaxScaler()","fb9da9df":"xd=scaler.fit_transform(x)\nx=pd.DataFrame(xd,columns=x.columns)","bc77dc29":"from sklearn.model_selection import train_test_split,cross_val_score","265cc52b":"#We import Classification Models\nfrom sklearn.naive_bayes import  GaussianNB\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.svm import SVC\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.ensemble import AdaBoostClassifier\nfrom sklearn.ensemble import GradientBoostingClassifier\nfrom xgboost import XGBClassifier","0f8a1ddd":"from sklearn.metrics import accuracy_score,confusion_matrix,classification_report,roc_auc_score,roc_curve","98c749d4":"#Function to find the best random state\ndef randomstate(x,y):\n    maxx=0\n    model=LogisticRegression()\n    for i in range(1,201):\n        xtrain,xtest,ytrain,ytest=train_test_split(x,y,test_size=0.25,random_state=i)\n        model.fit(xtrain,ytrain)\n        p=model.predict(xtest)\n        accu=accuracy_score(p,ytest)\n        if accu>maxx:\n            maxx=accu\n            j=i\n    return j","4acd4333":"#Splitting data into train and test\nxtrain,xtest,ytrain,ytest=train_test_split(x,y,test_size=0.25,random_state=randomstate(x,y))","3b7a3e63":"#To evaluate performances of all the models\ndef performance(p,ytest,m,xtest,s):\n    print('------------------------------------',m,'------------------------------------')\n    print('Accuracy',np.round(accuracy_score(p,ytest),4))\n    print('----------------------------------------------------------')\n    print('Mean of Cross Validation Score',np.round(s.mean(),4))\n    print('----------------------------------------------------------')\n    print('AUC_ROC Score',np.round(roc_auc_score(ytest,m.predict_proba(xtest)[:,1]),4))\n    print('----------------------------------------------------------')\n    print('Confusion Matrix')\n    print(confusion_matrix(p,ytest))\n    print('----------------------------------------------------------')\n    print('Classification Report')\n    print(classification_report(p,ytest))","819712f9":"#Creating a list of models which will be created one by one\nmodels=[GaussianNB(),KNeighborsClassifier(),SVC(probability=True),LogisticRegression(),DecisionTreeClassifier(),\n        RandomForestClassifier(),AdaBoostClassifier(),GradientBoostingClassifier(),XGBClassifier(verbosity=0)]","49fa0981":"#Creates and trains model from the models list\ndef createmodel(trainx,testx,trainy,testy):\n    for i in models:\n        model=i\n        model.fit(trainx,trainy)\n        p=model.predict(testx)\n        score=cross_val_score(model,x,y,cv=10)\n        performance(p,testy,model,testx,score) ","0480e6e9":"createmodel(xtrain,xtest,ytrain,ytest)","c5c33763":"m=RandomForestClassifier()\nm.fit(x,y)\nprint(m.feature_importances_)","7672757b":"#plot graph of feature importances for better visualization\nfeat_importances = pd.Series(m.feature_importances_, index=x.columns)\nfeat_importances.nlargest(19).plot(kind='barh')\nplt.show()","241165fe":"len(x.columns)","25381a76":"fi=list(feat_importances.nlargest(19).index)\nfi","1aea6389":"from sklearn.feature_selection import SelectKBest\nfrom sklearn.feature_selection import chi2","e763b84b":"selection = SelectKBest(score_func=chi2)\nfit = selection.fit(x,y)","71754005":"dfscores = pd.DataFrame(fit.scores_)\ndfcolumns = pd.DataFrame(x.columns)\nfeatureScores = pd.concat([dfcolumns,dfscores],axis=1)\nfeatureScores.columns = ['Features','Score']  #naming the dataframe columns\nfeatureScores","d45f2a23":"print(featureScores.nlargest(19,'Score'))  #print10 best features\nfeat=list(featureScores.nlargest(19,'Score')['Features'])","20ccd91f":"#We create a function to test the performance of dataset after removing above features.\n#We use Random Forest and XGBClassifier as our models to test as they were giving the best results.\ndef feature_test(xtrain,xtest,ytrain,ytest):\n    model=RandomForestClassifier()\n    model.fit(xtrain,ytrain)\n    score=cross_val_score(model,xd,y,cv=10)\n    p=model.predict(xtest)\n    print(\"Random Forest\")\n    print('Accuracy Score',accuracy_score(p,ytest))\n    print('Cross Validation Score',score.mean())\n    model=XGBClassifier()\n    model.fit(xtrain,ytrain)\n    score=cross_val_score(model,xd,y,cv=10)\n    p=model.predict(xtest)\n    print(\"XGBCLassifier\")\n    print('Accuracy Score',accuracy_score(p,ytest))\n    print('Cross Validation Score',score.mean())","f1e7aa4e":"xd=x.drop(['PhoneService','gender','SeniorCitizen'],axis=1)\nx_train,x_test,y_train,y_test=train_test_split(xd,y,test_size=0.25,random_state=randomstate(xd,y))\nfeature_test(x_train,x_test,y_train,y_test)","b9644229":"xd=x.drop(['PhoneService','gender'],axis=1)\nx_train,x_test,y_train,y_test=train_test_split(xd,y,test_size=0.25,random_state=randomstate(xd,y))\nfeature_test(x_train,x_test,y_train,y_test)","68006c2f":"xd=x.drop(['PhoneService'],axis=1)\nx_train,x_test,y_train,y_test=train_test_split(xd,y,test_size=0.25,random_state=randomstate(xd,y))\nfeature_test(x_train,x_test,y_train,y_test)","e7f0d8e2":"x.drop(['PhoneService'],axis=1,inplace=True)","6c78b713":"xtrain,xtest,ytrain,ytest=train_test_split(x,y,test_size=0.25,random_state=randomstate(x,y))","c5c69e01":"createmodel(xtrain,xtest,ytrain,ytest)","83e7ada9":"from sklearn.model_selection import GridSearchCV,RandomizedSearchCV","ebd8ef67":"params={'n_estimators':[100, 300, 500, 700],\n        'min_samples_split':[1,2,3,4],\n        'min_samples_leaf':[1,2,3,4],\n        'max_depth':[None,1,2,3,4,5,6,7,8,9,10,15,20,25,30,35,40]}","9f547c10":"g=RandomizedSearchCV(RandomForestClassifier(),params,cv=5)","09f2f496":"g.fit(xtrain,ytrain)","3731b6e1":"print(g.best_estimator_)\nprint(g.best_params_)\nprint(g.best_score_)","e44d3d4a":"m=RandomForestClassifier(max_depth=15, min_samples_leaf=3, min_samples_split=4,n_estimators=700)\nm.fit(xtrain,ytrain)\np=m.predict(xtest)","dab9e15a":"score=cross_val_score(m,x,y,cv=5)\nperformance(p,ytest,m,xtest,score)","7f71a3ec":"params={'n_estimators':[100,200,300,400,500],\n      'learning_rate':[0.001,0.01,0.10,],\n      'subsample':[0.5,1],\n      'max_depth':[1,2,3,4,5,6,7,8,9,10]}","758179dc":"g=RandomizedSearchCV(GradientBoostingClassifier(),params,cv=10)","15abb8d6":"g.fit(xtrain,ytrain)","919fa16a":"print(g.best_estimator_)\nprint(g.best_params_)\nprint(g.best_score_)","18d55508":"m=GradientBoostingClassifier(learning_rate=0.01, max_depth=6, n_estimators=500,subsample=0.5)\nm.fit(xtrain,ytrain)\np=m.predict(xtest)","af32b24d":"score=cross_val_score(m,x,y,cv=5)\nperformance(p,ytest,m,xtest,score)","8ae73442":"params={\n     \"learning_rate\"    : [0.001,0.05, 0.10 ] ,\n     \"max_depth\"        : [ 5, 6, 8, 10, 12, 15,20,25,30,35,40],\n     \"min_child_weight\" : [ 1, 3, 5, 7,10],\n     \"gamma\"            : [ 0.0, 0.1, 0.2 , 0.3, 0.4,10],\n     \"colsample_bytree\" : [ 0.3, 0.4, 0.5 , 0.7 ]\n    }","3636aa5c":"g=RandomizedSearchCV(XGBClassifier(),params,cv=10)","eb550788":"g.fit(xtrain,ytrain)","8ab7b822":"print(g.best_estimator_)\nprint(g.best_params_)\nprint(g.best_score_)","9d432d7c":"m=XGBClassifier(min_child_weight=1,max_depth=10,learning_rate=0.05,gamma=0.4,colsample_bytree=0.4)\nm.fit(xtrain,ytrain)\np=m.predict(xtest)","ddea29f1":"score=cross_val_score(m,x,y,cv=5)\nperformance(p,ytest,m,xtest,score)","a6728b60":"model=RandomForestClassifier(max_depth=15, min_samples_leaf=3, min_samples_split=4,n_estimators=700)\nmodel.fit(xtrain,ytrain)\np=model.predict(xtest)\nscore=cross_val_score(model,x,y,cv=10)","7ff4519e":"performance(p,ytest,model,xtest,score)","4e6fa9c1":"fpred=pd.Series(model.predict_proba(xtest)[:,1])\nfpr,tpr,threshold=roc_curve(ytest,fpred)","177bfc0a":"plt.plot(fpr,tpr,color='k',label='ROC')\nplt.plot([0,1],[0,1],color='b',linestyle='--')\nplt.xlabel('False Positive Rate')\nplt.ylabel('True Positive Rate')\nplt.title('ROC-AUC curve')\nplt.legend()","b939c0b9":"import joblib\njoblib.dump(model,'Churn.obj')","f902afa4":"Senior citizens have a higher ratio of streaming tv and movies than the younger ones. Ratio of senior citizens for contract is almost similar in all the categories while for payment method. senior citizens using mailed checks are least.","71e0d3d4":"There are almost equal no of males and females who churn away but no. of people churning are way lower than peole who do not.","e3427512":"### Bivariate Analysis","ca706390":"Phone Service dosent seem to be an important feature as there is already a category in other features of no phone service and those who do not use internet service  are the ones who not use phone service. ","cf420e95":"Customers who have not subscribed for online backup have higher ratio for churning away.","5d7cfebf":"Dataset has 7043 rows and 21 columns including the label v=column.","3b467a3e":"There are 30% customers with dependents while rest donot.","5a2bc20f":"Total charges and monthly charges show positive correlation, one increases as the other increases.","c2f86c12":"Customers who have not subscrobed online security churn the most.","336bb7dd":"People having shorter contract churn higher than the people who have contract for a longer time.","6464d56c":"Total charges and tenure also show positive correlation, one increases as the other increases.","65daacdb":"##### Using Feature importance of random forrest","65abd18a":"# Evaluation Metrics","68a6aa82":"# Building Models","cdc8a927":"Count of every column is 7043. Mean is higher than median in tenure colum, and lower in Monthly charges. Both the columns show a little skewness. Difference between the interquartile range, min and max dosent vary much that means there are less outliers. There are high variance in tenure and Monthtly charges column.","7ed3ddbd":"On the basis of above two method of feature selection 'PhoneService','gender' and 'SeniorCitizen' seem to have the lowest scores so we try to remove them and see if our accuracy increases.","7e66c4d3":"Customers who use internet service are the ones who can use this service. Among the users of customer service, there is balance in the users who Watch Streaming Tv and who do not.","20af5e2a":"### Pre Processing Pipeline","8685d174":"Customers who use internet service are the ones who can use this service. Among the users of customer service, there is balance in the users who Watch Streaming Movies and who do not.","9a8979f9":"There are no outliers in the above continuous data.","4deaf9a5":"##### Encoding Object type Columns","26aac5f2":"Dataset has one identifier columns, 3 continuos and rest of them are categorical columns.","cd58e43c":"People who have stayed customers for longer term does not seem to churn away.","740f3334":"Dataset is imbalanced there are 73.5% people who have not churned while 26.5% who have.","db72de21":"There are 3 columns with numerical columns rest all object types including the Total charges column.","93cc9a02":"Monthly charges almost follows normal distribution, whith its majority of customers paying monthly charges 19 to 25.","1d428c0b":"Tenure data seems to be normally distributed, with just little of roght skewness. Customers as long as 72 years have been loyal to this company, while the majority lies between 0 to 2 years range.","be17457f":"##### Using chi2 test","76957f79":"People payong bills through electronic check have the highest ratio for churning compared to people who use other medium for payment.","51d7b07d":"Most of the people using Internet service use Fiber optic instead of DSL, while 21.7% donot use internet service","8b25542b":"##### Handling Imbalanced Dataset","2b6a3e6b":"Most of the customer like paperless billing which is good as it is environment friendly.","ed75400f":"No. of females and males are almost equal.","c4ecfa27":"Still Best performance is given by Random Forest, Gradient Boost and Extreme Gradient Boost models, So we futher perform Hyperparameter Tuning on them.","e07d3441":"Customers who use internet service are the ones who can use this service. Majority of people among the internet users do not use this service.","f1fa1c76":"# Saving the Model","c9586c15":"##### There are no outliers or skewness in our dataset therefore we proceed further.","dc7de03c":"There are very few customers who do not have phone service, less than 10%.","5a2c81fd":"People who do not have phone service only use DSL internet service. While People using the phone service and who do not use internet service are the ons's who rarely churn.","7f5b6749":"Customers using fiber optic internet service are the highest no. of people churning away.","8b9f35a2":"##### Scaling the Dataset","49b09e43":"![](https:\/\/tecnicadevoz.com\/wp-content\/uploads\/2019\/02\/Depositphotos_104970638_l-2015.jpg)","3d2aa475":"Customers who have subscribed for streaming Movies have slightly lower ratio of churning compared to those who have't while customers who do not use internet service churn the least.","a9831cbf":"Customers who do not opt for device protection have highest no. of churning away.","217bba11":"### Multivariate Analysis","917548fc":"##### Dropping identifier columns","4ca9b3aa":"Customers who have been seen to pay more total charges dosent seem to churn.","fe66df74":"Customers who do not opt for tech support have highest no. of churning away.","dc3308df":"Total charges is skewed towards rightand goes up to a range of 8684, while majority of customers lie in 18.8 to 500 range.","08084e0d":"Importong neccessary libraries and modules","ff703ec7":"Most of the customers have subscribed for month to month followed by two year plan, one year contract is used by least no. of customers.","3d0cfb90":"Dataset is imbalanced","eb92a932":"All the model are giving almost same accuracy but Random Forest has the least variance between accuracy score and mean of cross validation score. So we choose Random Forest as our final model.","5c5b9e5e":"There are only 16.2% senior citizens, while the majority of customers are young.","6faae583":"Customers paying high mean monthly charges seem to churn away.","ae229385":"Most customers use electronic check for making payments, while rest of the methods are used by almost equal no. of customers.","3ad49b28":"There are 90.3% people who use phone service and 42.2% who also use multiple lines among them.","f9ad7f61":"# **Do Upvote if you like my work. Thanks and God Bless You!!!**","0a5d95be":"### Univariate Analysis","f6b691fb":"There is high correlation between Total charges and tenure. Also a high correlation between Monthlly charges and Total Charges.","dea53cc8":"Majority of customers do use Online Backup service among the people who use internet but still there are more than half who do not use online backup service service,","63a60617":"Customers who do not have partners have higher chances of churning.","00ed1a4e":"People using multiple lines have lower ratio of churning compared to customers who donot use multiple lines.","08deff47":"Removing Only phone service gives us the best result. We have also previously in the EDA process where Phone service was just an extra feature.","570cf290":"People having lowe total charges and higher monthly charge have a higher ratio of churning than the rest of the population.","3272621c":"##### Extreme Gradient Boost","1d648882":"As Compared to younger ones senior citizens seem to churn easily.","7f95bbc0":"People who do not have internet service do not use the above features. Customers having fiber optic have higher ratio of not opting for Online Security, Device Protection and tech Support while customers having DSL internet service have a higher ratio of opting for these services and there is a vice versa scenario for  Online Backup, Streaming MOvies and Tv services.","6283bcfe":"# Finalizing the best Model","9b198bd7":"There are no null values.","61c0cb95":"Customers seem to churn away with higher monthly charges, lower tenure and lowe total charges, while the ratio of senior citizen than the young people churning is more.","7616f9a5":"Majority of customers do not use Online security service among the people who use internet but still there are more than half who use online security.","55296a64":"Partner category is almost equal as customers having partners while no. of people without partners are almost equal.","b6f184b0":"There is no skewness in the continuous column.","e214b3fb":"No. of people churning are almost same in the ratio of people who use phone service and who do not.","1599c613":"Customers who have subscribed for streaming tv have skightly lower ratio of churning compared to those who have't while customers who do not use internet service churn the least.","5a5fb0fe":"# Hyperparameter Tuning","61170ee0":"##### Random Forest","2ae8fe23":"Customers who use internet service are the ones who can use this service. Majority of people among the internet users do not use this service.","b8d6b6a6":"People having higher tenure and higher monthly charges seem to churn faster than the rest.","ea1f9633":"## Feature Selection","dcdce5fd":"##### Conclusion","c923b35a":"##### Handling null values of Total charges column","850198dd":"Customers with depemdemts have lower rate of churning than the customers who do not have partners.","470b1fac":"##### Gradient Boost"}}