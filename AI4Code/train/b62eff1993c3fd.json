{"cell_type":{"94a039ef":"code","1aeebd99":"code","c6291ebf":"code","3d7c91fe":"code","43fa874c":"code","a0902c4e":"code","5aefd4da":"code","40cdd38d":"code","bdbcda3c":"code","ba24c478":"code","6c4c0139":"code","9e287650":"code","281c9bde":"code","d7c6c0d1":"code","556030df":"code","b2564575":"markdown","042ab0d5":"markdown","0cf49143":"markdown","4e889445":"markdown","b720d8f9":"markdown","9f7e19bd":"markdown","f9d938dd":"markdown","56548aec":"markdown","4e15cabe":"markdown","a7cf1436":"markdown","b85a33f1":"markdown","b5f3a0e7":"markdown"},"source":{"94a039ef":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)","1aeebd99":"df = pd.read_csv('..\/input\/train.csv')\ndf['Surname'] = df['Name'].apply(lambda l: l.split(',')[0])\ny = df['Survived']\nX = df.fillna(0)","c6291ebf":"from sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.5, random_state=42)","3d7c91fe":"import matplotlib.pyplot as plt\nimport seaborn as sns\nfig, ax = plt.subplots(2, 4, sharex='col', sharey='row', figsize=(15,14))\nplt.subplots_adjust(hspace = 0.5)\nplt.subplot(4, 2, 1)\nsns.barplot(x = \"Pclass\",y = \"Survived\",data=X_train,linewidth=2)\n\nplt.subplot(4, 2, 2)\nsns.barplot(x = \"Pclass\",y = \"Survived\",data=X_test,linewidth=2)\n\nplt.subplot(4, 2, 3)\nsns.barplot(x = \"Sex\",y = \"Survived\",data=X_train,linewidth=2)\n\nplt.subplot(4, 2, 4)\nsns.barplot(x = \"Sex\",y = \"Survived\",data=X_test,linewidth=2)\n\n\nplt.subplot(4, 2, 5)\nsns.boxplot(x=\"Pclass\", y=\"Fare\", hue=\"Survived\", data=X_train)\n\nplt.subplot(4, 2, 6)\nsns.boxplot(x=\"Pclass\", y=\"Fare\", hue=\"Survived\", data=X_test)\n\nplt.subplot(4,2,7)\nsns.distplot(X_train['Age'],label='train');\nsns.distplot(X_test['Age'],label='test');\nplt.legend()\n\nplt.subplot(4,2,8)\nsns.distplot(X_train['Pclass'],label='train',bins=3);\nsns.distplot(X_test['Pclass'],label='test',bins=3);\nplt.title('Comparison of Pclasses')\nplt.legend()\n\n\nfig.show()\nplt.show()","43fa874c":"pd.DataFrame({'train':X_test[['Survived','Sex']].groupby(['Survived','Sex']).size(),'test':X_train[['Survived','Sex']].groupby(['Survived','Sex']).size()})","a0902c4e":"from scipy.stats import ks_2samp\nprint(ks_2samp(X_train['Pclass'],X_test['Pclass']))\nprint(ks_2samp(X_train['Sex'],X_test['Sex']))\nprint(ks_2samp(X_train['Age'],X_test['Age']))\nprint(ks_2samp(X_train['Fare'],X_test['Fare']))\nprint(ks_2samp(X_train['Surname'],X_test['Surname']))","5aefd4da":"top_values = 15\na = X_train[X_train['Surname'].isin(df['Surname'].value_counts()[:top_values].index)]['Surname'].value_counts()\nb = X_test[X_test['Surname'].isin(df['Surname'].value_counts()[:top_values].index)]['Surname'].value_counts()\nsurname_count = pd.DataFrame({'train':a,'test':b}).fillna(0)\nsurname_count.plot.bar(rot=45)\nplt.show()","40cdd38d":" X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=42, stratify=X['Surname'])","bdbcda3c":"df2 = df[df['Surname'].isin(df['Surname'].value_counts()[df['Surname'].value_counts()>2].index)]\ny2 = df2['Survived']\nX2 = df2.fillna(0)","ba24c478":" X2_train, X2_test, y2_train, y2_test = train_test_split(X2, y2, test_size=0.33, random_state=42, stratify=X2['Surname'])","6c4c0139":"top_values = 15\na = X2_train[X2_train['Surname'].isin(df['Surname'].value_counts()[:top_values].index)]['Surname'].value_counts()\nb = X2_test[X2_test['Surname'].isin(df['Surname'].value_counts()[:top_values].index)]['Surname'].value_counts()\nsurname_count2 = pd.DataFrame({'train':a,'test':b}).fillna(0)","9e287650":"fig, ax = plt.subplots(1, 2, sharex='col', sharey='row', figsize=(15,2))\n\nax1 = plt.subplot(121)\nax2= plt.subplot(122)\n\nsurname_count.plot.bar(rot=45,ax=ax1)\nsurname_count2.plot.bar(rot=45,ax=ax2)\n\nplt.show()","281c9bde":"print(ks_2samp(X_train['Surname'],X_test['Surname']))\nprint(ks_2samp(X2_train['Surname'],X2_test['Surname']))","d7c6c0d1":"import matplotlib.pyplot as plt\nimport seaborn as sns\nfig, ax = plt.subplots(2, 4, sharex='col', sharey='row', figsize=(15,14))\nplt.subplots_adjust(hspace = 0.5)\nplt.subplot(4, 2, 1)\nsns.barplot(x = \"Pclass\",y = \"Survived\",data=X2_train,linewidth=2)\n\nplt.subplot(4, 2, 2)\nsns.barplot(x = \"Pclass\",y = \"Survived\",data=X2_test,linewidth=2)\n\nplt.subplot(4, 2, 3)\nsns.barplot(x = \"Sex\",y = \"Survived\",data=X2_train,linewidth=2)\n\nplt.subplot(4, 2, 4)\nsns.barplot(x = \"Sex\",y = \"Survived\",data=X2_test,linewidth=2)\n\n\nplt.subplot(4, 2, 5)\nsns.boxplot(x=\"Pclass\", y=\"Fare\", hue=\"Survived\", data=X2_train)\n\nplt.subplot(4, 2, 6)\nsns.boxplot(x=\"Pclass\", y=\"Fare\", hue=\"Survived\", data=X2_test)\n\nplt.subplot(4,2,7)\nsns.distplot(X_train['Age'],label='train');\nsns.distplot(X_test['Age'],label='test');\nplt.legend()\n\nplt.subplot(4,2,8)\nsns.distplot(X_train['Pclass'],label='train',bins=3);\nsns.distplot(X_test['Pclass'],label='test',bins=3);\nplt.title('Comparison of Pclasses')\nplt.legend()\n\n\nfig.show()\nplt.show()","556030df":"print(ks_2samp(X2_train['Pclass'],X2_test['Pclass']))\nprint(ks_2samp(X2_train['Sex'],X2_test['Sex']))\nprint(ks_2samp(X2_train['Age'],X2_test['Age']))\nprint(ks_2samp(X2_train['Fare'],X2_test['Fare']))\nprint(ks_2samp(X2_train['Surname'],X2_test['Surname']))","b2564575":"In the ML processing it is important that the data have close distribution in the train and test set. Let's graphically explore what does standard sklearn train_test_split does with the distribution of the data.","042ab0d5":"Initially it fails, because plenty of surnames appear just once in the data frame. So let's try to update the dataframe to contain only surnames which appear at least twice","0cf49143":"Let's evaluate if the distributions are the same for few values using Kolmogorov-Smirnov test. If the p value is smaller than our statistical significance we can reject the null hypothesis that the distributions are the same. However all our tests, should high values of p which suggest that the distributions are the same (considering the values are distributed in the normal distribution)","4e889445":"Let's try to do the split specifying stratify on the 'Surname' column","b720d8f9":"Let's print some data characteristics and compare train (on the left) and test (on the right) set","9f7e19bd":"But how does the other values look like if we specify the stratications","f9d938dd":"The stratify tries to split the major variables into representative groups, however if you look on a feature with big number of values, you can see that the split is not ideal. For example some surnames appear only the train set while some are more significant in the test set (despite high p value above)","56548aec":"When we printed several distribution of the key fields, everything looks well distributed","4e15cabe":"Nevertheless we will never get the ideal distribution in relation to all the variables. Look at the distribution of survivors in the 1st class based on fare on the above chart. ","a7cf1436":"and stratify specifically based on 'Surname' column","b85a33f1":"We will try this on the famous Titanic dataframe","b5f3a0e7":"Just to make sure, let's review the distribution of survivors based on their gender"}}