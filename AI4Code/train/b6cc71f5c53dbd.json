{"cell_type":{"d193193f":"code","ef1ed41d":"code","cccfb3a5":"code","94a1e57f":"code","13939093":"code","8afd2d90":"code","8c7d2444":"code","6a83c0db":"code","ce6355fc":"code","1b0fa78c":"code","72242d3f":"code","1d242269":"code","56d2aaf1":"code","0de1f7f0":"code","b1180070":"code","66ef3887":"code","3eec2eb2":"code","cb8925b6":"code","c5326fe8":"code","c804ee9e":"code","72822c49":"code","05c3f37a":"code","954e9130":"code","93e6c309":"code","0d3f0ff9":"code","8d2141b3":"code","fb7fe5bc":"code","b317f170":"code","f5ff4f0e":"code","695ac664":"code","b4d3c0e2":"code","698462a7":"code","d4bdcbf2":"code","d63bd61c":"code","3278acb3":"code","4f4509e6":"code","b940f852":"code","bd4a61e8":"code","75a73cb5":"code","e888738f":"code","e69c6a44":"code","099bf97b":"markdown","df413991":"markdown","e9342ed2":"markdown","b7d0674b":"markdown","33c5a1d1":"markdown","b4863083":"markdown","f3f6165e":"markdown"},"source":{"d193193f":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","ef1ed41d":"import matplotlib.pyplot as plt\nfrom tqdm import tqdm\ntqdm.pandas()","cccfb3a5":"data = pd.read_csv('..\/input\/elo-merchant-eda\/data_train.csv.gz')","94a1e57f":"data.head()","13939093":"data = data.sort_values(by='first_active_month')","8afd2d90":"data.head()","8c7d2444":"print('The earliest date is {}, most recent date is {}.'.format(data.first_active_month.iloc[0], data.first_active_month.iloc[-1]))","6a83c0db":"data.target.describe()","ce6355fc":"target_stats = data.groupby('first_active_month').target.agg(['count','max','min','mean','median'])","1b0fa78c":"target_stats.head()","72242d3f":"fig, ax = plt.subplots()\nax.plot(target_stats.iloc[:,0])\nax.set_xlabel(xlabel='First Active Month')\nax.set_ylabel(ylabel='Frequency')\nax.xaxis.set_tick_params(rotation=90)\nstart, end = ax.get_xlim()\nax.xaxis.set_ticks(np.arange(start, end, 5))\nax.set_title('Frequency of target in chronological order')","1d242269":"fig, ax = plt.subplots()\nax.plot(target_stats.iloc[:,[1,2]])\nax.set_xlabel(xlabel='First Active Month')\nax.set_ylabel(ylabel='Target')\nax.xaxis.set_tick_params(rotation=90)\nstart, end = ax.get_xlim()\nax.xaxis.set_ticks(np.arange(start, end, 5))\nax.set_title('Max and min of target in chronological order')\nax.legend(['Max','Min'])","56d2aaf1":"fig, ax = plt.subplots()\nax.plot(target_stats.iloc[:,[3]])\nax.set_xlabel(xlabel='First Active Month')\nax.set_ylabel(ylabel='Target')\nax.xaxis.set_tick_params(rotation=90)\nstart, end = ax.get_xlim()\nax.xaxis.set_ticks(np.arange(start, end, 5))\nax.set_title('Mean of target in chronological order')\nax.legend(['Mean'])","0de1f7f0":"fig, ax = plt.subplots()\nax.plot(target_stats.iloc[:,[4]])\nax.set_xlabel(xlabel='First Active Month')\nax.set_ylabel(ylabel='Target')\nax.xaxis.set_tick_params(rotation=90)\nstart, end = ax.get_xlim()\nax.xaxis.set_ticks(np.arange(start, end, 5))\nax.set_title('Median of target in chronological order')\nax.legend(['Median'])","b1180070":"less_than_thirty = data.loc[data.target < -30]\nless_than_thirty.head()","66ef3887":"print('There are {} records with loyalty score less than -30.'.format(less_than_thirty.shape[0]))","3eec2eb2":"less_than_thirty.describe()","cb8925b6":"less_than_thirty.target.unique()","c5326fe8":"target_stats_less_than_thirty = less_than_thirty.groupby('first_active_month').target.agg(['count'])\ntarget_stats_less_than_thirty.head()","c804ee9e":"fig, ax = plt.subplots()\nax.plot(target_stats_less_than_thirty.iloc[:,0])\nax.set_xlabel(xlabel='First Active Month')\nax.set_ylabel(ylabel='Frequency')\nax.xaxis.set_tick_params(rotation=90)\nstart, end = ax.get_xlim()\nax.xaxis.set_ticks(np.arange(start, end, 5))\nax.set_title('Frequency of target in chronological order')","72822c49":"target_stats = target_stats.join(target_stats_less_than_thirty, rsuffix='_less_than_thirty')","05c3f37a":"target_stats = target_stats.fillna(0)","954e9130":"target_stats.head()","93e6c309":"target_stats['percent_of_less_than_thirty'] = target_stats.iloc[:,-1]\/target_stats.iloc[:,0]","0d3f0ff9":"target_stats.head()","8d2141b3":"target_stats.percent_of_less_than_thirty.describe()","fb7fe5bc":"fig, ax = plt.subplots()\nax.plot(target_stats.iloc[:,-1])\nax.set_xlabel(xlabel='First Active Month')\nax.set_ylabel(ylabel='Percentage')\nax.xaxis.set_tick_params(rotation=90)\nstart, end = ax.get_xlim()\nax.xaxis.set_ticks(np.arange(start, end, 5))\nax.set_title('% target which is < -30 in chronological order')","b317f170":"data['feature_combn'] = data.progress_apply(lambda x: str([x.feature_1,x.feature_2, x.feature_3]), axis=1)","f5ff4f0e":"print('There are {} feature combinations.'.format(len(data.feature_combn.unique())))","695ac664":"len(data.feature_1.unique())*len(data.feature_2.unique())*len(data.feature_3.unique())","b4d3c0e2":"pd.crosstab(index=data.feature_1, columns=data.feature_2)","698462a7":"pd.crosstab(index=data.feature_1, columns=data.feature_3)","d4bdcbf2":"pd.crosstab(index=data.feature_2, columns=data.feature_3)","d63bd61c":"feature_combn_target_stats = data.groupby('feature_combn').target.agg(['count','max','min','mean','median'])","3278acb3":"feature_combn_target_stats","4f4509e6":"data_test = pd.read_csv('..\/input\/elo-merchant-eda\/data_test.csv.gz')","b940f852":"data_test['feature_combn'] = data_test.progress_apply(lambda x: str([x.feature_1,x.feature_2, x.feature_3]), axis=1)","bd4a61e8":"print('There are {} feature combinations.'.format(len(data_test.feature_combn.unique())))","75a73cb5":"pd.crosstab(index=data_test.feature_1, columns=data_test.feature_2)","e888738f":"pd.crosstab(index=data_test.feature_1, columns=data_test.feature_3)","e69c6a44":"pd.crosstab(index=data_test.feature_2, columns=data_test.feature_3)","099bf97b":"From the above plot, we can see that in almost all the month, there will be a loyalty score of less than -30.","df413991":"Let's investigate these less than -30 loyalty scores.","e9342ed2":"It looks like the percentage of target that is less than -30 is quite stable, with a slight decrease across the months.","b7d0674b":"Test set display the same relationships for features.","33c5a1d1":"From the table, we can see that regardless of feature combination, the min loyalty score is still -33.219.","b4863083":"The distribution seems to follow the general distribution of the whole training sample.","f3f6165e":"There is only one value for this loyalty score."}}