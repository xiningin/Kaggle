{"cell_type":{"70e5aac7":"code","933f6d71":"code","38411600":"code","3cccae6c":"code","a216d0af":"code","ebb332b6":"code","c01ff349":"code","ecec6e85":"markdown"},"source":{"70e5aac7":"import pandas as pd\nimport numpy as np\nimport time\n\nstart_time = time.time()\n\ndf = pd.read_csv(\"..\/input\/logistics-shopee-code-league\/delivery_orders_march.csv\")\ndf","933f6d71":"def replaceaddress(add):\n    area = add.split()[-1].lower()\n    return area\n\ndf['buyeraddress'] = df['buyeraddress'].apply(replaceaddress)\ndf['selleraddress'] = df['selleraddress'].apply(replaceaddress)\ndf['combined'] = df['buyeraddress'] + \"-\" + df['selleraddress']\n\ndef get_SLA_days(d):\n    s, e = d.split(\"-\")\n    if s == \"manila\":\n        if e == \"manila\":\n            return 3\n        elif e == \"luzon\":\n            return 5\n    if s == \"luzon\":\n        if e == \"manila\" or \"luzon\":\n            return 5\n    return 7\n\ndf['sla_days'] = df['combined'].apply(get_SLA_days)","38411600":"from datetime import datetime\n\ngmt_offset = 8 * 60 * 60\n\nfor col in [\"pick\", \"1st_deliver_attempt\", \"2nd_deliver_attempt\"]:\n    df[col] = df[col] + gmt_offset\n    df[col] = pd.to_datetime(df[col], unit='s')\n    df[col] = df[col].values.astype('datetime64[D]')\n    \ndf.head()","3cccae6c":"from datetime import date\n\nalgo_time = time.time()\n\n# PHs and Sundays\nhol_list = [date(2020, 3, 25), date(2020, 3, 30), date(2020, 3, 31),\n            date(2020, 3, 1), date(2020, 3, 8), date(2020, 3, 15), \n            date(2020, 3, 22), date(2020, 3, 29), date(2020, 4, 5)]\n\ndef is_late(row):\n    first = row['1st_deliver_attempt']\n    second = row['2nd_deliver_attempt']\n    pick = row['pick']\n    \n    # second delivery exists\n    if pd.notnull(second):\n        num_days = (second - first).days\n        \n        if num_days > 3: #earlier stop\n            for hol in hol_list:\n                if first <= hol <= second:\n                    num_days -= 1\n            if num_days > 3:\n                return 1\n    \n    # check first delivery is ok\n    num_days = (first - pick).days\n    \n    if num_days > row['sla_days']: #earlier stop\n        for hol in hol_list:\n            if pick <= hol <= first:\n                num_days -= 1\n        if num_days > row['sla_days']:\n            return 1\n    \n    return 0\n    \ndf['is_late'] = df.apply(is_late, axis=1)\n\nprint(\"Algo time elapsed:\", time.time() - algo_time, \"seconds\")","a216d0af":"submission = df.copy()\nsubmission['is_late'] = submission['is_late'].fillna(0)\nsubmission = submission[['orderid', 'is_late']]\nsubmission['is_late'] = submission['is_late'].astype(int)\n\nsubmission['is_late'].value_counts()","ebb332b6":"submission.to_csv('submission.csv', index=False)","c01ff349":"print(\"Overall time elapsed:\", time.time() - start_time, \"seconds\")","ecec6e85":"**start here**"}}