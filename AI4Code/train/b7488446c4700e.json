{"cell_type":{"689b8e2f":"code","9ee683ae":"code","2af9a759":"code","e0bbe35f":"code","7951e2ab":"code","69e18485":"code","b63727d3":"code","86953601":"code","44a66db5":"code","d47ebbb5":"code","84997a2d":"code","20da61e8":"code","227561bd":"markdown","26b510b6":"markdown","c9458a15":"markdown","81a6f19d":"markdown","8a650111":"markdown","ba3b37c1":"markdown","d76253e7":"markdown","24ffa80d":"markdown","16e9593e":"markdown","c70fda00":"markdown","a3364547":"markdown","657f3aef":"markdown","e0c7e3b6":"markdown","e9a80104":"markdown"},"source":{"689b8e2f":"import pandas as pd\nfrom pandas import crosstab\nimport matplotlib.pyplot as plt\nimport seaborn as sns","9ee683ae":"PROJECT_ID = 'biomarker'\nfrom google.cloud import bigquery\nclient = bigquery.Client(project=PROJECT_ID)","2af9a759":"# change the OCID here\ndisease_ocid=208000009025","e0bbe35f":"query = \"\"\"\nSELECT  mkr.termFields.biomarker AS marker, \n        mkr.conceptFields.biomarker AS marker_ocid, \n        mkr_pl_tbl.name AS marker_lbl,\n        mkr.termFields.biomarker_target AS target, \n        mkr.conceptFields.biomarker_target AS target_ocid,\n        tgt_pl_tbl.name AS target_lbl,\n        termFields.source_id AS src_id,\n        termFields.srcrep AS src_repo\nFROM `biomarker.relationships.dbrel` mkr\nINNER JOIN ( \n    SELECT DISTINCT ocid \n    FROM `biomarker.ontologies.diseases_ancestors` \n    WHERE parent_ocid = {ocid}\n) nsd ON nsd.ocid = mkr.conceptFields.biomarker_target\nLEFT JOIN `biomarker.ontologies.full_preflabel` mkr_pl_tbl ON mkr_pl_tbl.ocid = mkr.conceptFields.biomarker\nLEFT JOIN `biomarker.ontologies.full_preflabel` tgt_pl_tbl ON tgt_pl_tbl.ocid = mkr.conceptFields.biomarker_target\nWHERE mkr.conceptFields.biomarker_target IS NOT NULL\nAND mkr.conceptFields.biomarker IS NOT NULL\n\"\"\".format(ocid=disease_ocid)\n\nquery_job = client.query(query, location=\"US\")  \ndf = query_job.to_dataframe()","7951e2ab":"pref_lbl_lut_df = df[[\"marker_ocid\", \"marker_lbl\"]].rename(columns={'marker_lbl':'label', 'marker_ocid':'ocid'}).append(\n    df[[\"target_ocid\", \"target_lbl\"]].rename(columns={'target_lbl':'label', 'target_ocid':'ocid'}))\n\n# create a dictionary (ocid->pref_label) using the data frame\npref_lbl_lut = dict(zip(pref_lbl_lut_df.ocid, pref_lbl_lut_df.label))","69e18485":"df_uniq_srcid = df.groupby([\"target_ocid\", \"marker_ocid\", \"src_id\"]).first().reset_index()","b63727d3":"marker_tgt_counts = df_uniq_srcid.groupby([\"target_ocid\", \"marker_ocid\",\"target_lbl\", \"marker_lbl\"]).size().reset_index(name='counts')\nmarker_tgt_counts.sort_values(by=[\"counts\"], ascending=False).head(20)","86953601":"# get the top 30 most promiscuous markers respective diseases\nmost_promiscuous_markers = df_uniq_srcid[[\"marker_ocid\", \"target_ocid\"]].drop_duplicates()[\"marker_ocid\"].value_counts().index.tolist()[:30]\nmost_promiscuous_targets = df_uniq_srcid[[\"marker_ocid\", \"target_ocid\"]].drop_duplicates()[\"target_ocid\"].value_counts().index.tolist()[:30]\ndf_most_promiscuous_biomarkers = df_uniq_srcid[df_uniq_srcid.marker_ocid.isin(most_promiscuous_markers) & df_uniq_srcid.target_ocid.isin(most_promiscuous_targets)]\n\n# create a frequency table\ntab_most_promiscuous_biomarkers = crosstab(index=df_most_promiscuous_biomarkers['marker_ocid'], columns=df_most_promiscuous_biomarkers['target_ocid'])\n\n# resort the table by most promiscuous target and markers\ntab_most_promiscuous_biomarkers = tab_most_promiscuous_biomarkers[most_promiscuous_targets]\ntab_most_promiscuous_biomarkers = tab_most_promiscuous_biomarkers.reindex(index=most_promiscuous_markers)\n\n# set the pref labels \ntab_most_promiscuous_biomarkers.columns = [pref_lbl_lut[i] for i in tab_most_promiscuous_biomarkers.columns]\ntab_most_promiscuous_biomarkers.index = [pref_lbl_lut[i] for i in tab_most_promiscuous_biomarkers.index]\n\n# plot the heat map\nsns.set(font_scale=1.1) \nfig, (ax) = plt.subplots(1, 1, figsize=(20,15))\nhm = sns.heatmap(tab_most_promiscuous_biomarkers, ax=ax, cmap=\"YlOrRd\", annot=True, vmin=0, vmax=10, linewidths=.05)","44a66db5":"# get the top 30 most appearing markers respective diseases\nmost_appearing_markers = df_uniq_srcid[\"marker_ocid\"].value_counts().index.tolist()[:30]\nmost_appearing_targets = df_uniq_srcid[\"target_ocid\"].value_counts().index.tolist()[:30]\ndf_most_appearing_biomarkers = df_uniq_srcid[df_uniq_srcid.marker_ocid.isin(most_appearing_markers) & df_uniq_srcid.target_ocid.isin(most_appearing_targets)]\n\n# create a frequency table\ntab_most_appearing_biomarkers = crosstab(index=df_most_appearing_biomarkers['marker_ocid'], columns=df_most_appearing_biomarkers['target_ocid'])\n\n# resort the table by most appearing target and markers\ntab_most_appearing_biomarkers = tab_most_appearing_biomarkers[most_appearing_targets]\ntab_most_appearing_biomarkers = tab_most_appearing_biomarkers.reindex(index=most_appearing_markers)\n\n# set the pref labels \ntab_most_appearing_biomarkers.index = [pref_lbl_lut[i] for i in tab_most_appearing_biomarkers.index]\ntab_most_appearing_biomarkers.columns = [pref_lbl_lut[i] for i in tab_most_appearing_biomarkers.columns]\n\n# plot the heat map\nsns.set(font_scale=1.1) \nfig, (ax) = plt.subplots(1, 1, figsize=(20,15))\nhm = sns.heatmap(tab_most_appearing_biomarkers, ax=ax, cmap=\"YlOrRd\", annot=True, vmin=0, vmax=10, linewidths=.05)","d47ebbb5":"# number of biomarker diseases pair count to be seen as evident.\ncutoff = 3","84997a2d":"tab_most_promiscuous_biomarkers_clustr = crosstab(index=df_most_promiscuous_biomarkers['marker_lbl'], columns=df_most_promiscuous_biomarkers['target_lbl'])\ntab_most_promiscuous_biomarkers_clustr[tab_most_promiscuous_biomarkers_clustr < cutoff] = 0\ntab_most_promiscuous_biomarkers_clustr[tab_most_promiscuous_biomarkers_clustr >= cutoff] = 1\n\nsns.set(font_scale=1.1) \ncm = sns.clustermap(tab_most_promiscuous_biomarkers_clustr, method='average', metric='euclidean', cmap=\"YlOrRd\", annot=True, vmin=0, vmax=1, linewidths=.05)","20da61e8":"tab_most_appearing_biomarkers_clustr = crosstab(index=df_most_appearing_biomarkers['marker_lbl'], columns=df_most_appearing_biomarkers['target_lbl'])\ntab_most_appearing_biomarkers_clustr[tab_most_appearing_biomarkers_clustr < cutoff] = 0\ntab_most_appearing_biomarkers_clustr[tab_most_appearing_biomarkers_clustr >= cutoff] = 1\n\nsns.set(font_scale=1.1) \ncm = sns.clustermap(tab_most_appearing_biomarkers_clustr, method='average', metric='euclidean', cmap=\"YlOrRd\", annot=True, vmin=0, vmax=1, linewidths=.05)","227561bd":"## Create a BQ query to fetch all biomarkers which target the `disease_ocid` class and all respective child concepts\n\nThe BQ query uses standard SQL statements. Please ask for access to the OntoChem biomarker project for table and column names if you would like to create different data analytics.","26b510b6":"### Top 30 appearing biomarkers and diseases","c9458a15":"# Biomarker - disease analytics\n\nThis notebook allows to investigate correlations between genomic and proteomic biomarkers and diseases of your interest. The underlying biomarker data is coming from the normalized indexing of databases such as ClinicalTrials.gov, ClinVar, Cosmic, GWAS, OMIM, but also text data from Medline, PubMed Central, Embase, Medmeme and patents that resides in proprietary OntoChem DB tables. It represents the largest data set on biomarkers and disease correlations.\n\nThe notebook shall demonstrate possibilities of data analytics with Kaggle notebooks and ontology based semantic data - showing interesting correlations between diseases based on their biomarkers.","81a6f19d":"## Top 20 Biomarker disease pairs sorted by occurence count\n\nLet's look at the top 20 biomarker-disease pairs with the most mentions on our data:","8a650111":"#### Most appearing biomarkers and diseases cluster","ba3b37c1":"## Connect to the Biomarker project\nThe OntoChem biomarker project stores data in its own BigQuery (BQ) tables. This technology allows any user with appropriate permissions from OntoChem to access the data and use it for any data analytics - using programmatic access via the BQ API or other tools like Looker or Kaggle. When using Kaggle, no individual Google BQ user account is required to access the tables. ","d76253e7":"## Select a disease concept or class\n\nYou can select a disease concept or a class of diseases and their corresponding OCIDs (OntoChem's **O**ntology **C**oncept **ID**s) at: `https:\/\/sciwalker.com\/` > `Search` > `Domain browser`\n\nFor this example we're going to search for biomarkers which target `Nervous System Diseases`, \nthe corresponding concept has the OCID: `208000009025`","24ffa80d":"## Biomarker disease co-occurrences\nLet's look how often the most occurring markers appear together with the most occuring diseases.\n\nTo achieve this, we calculate two measurements of occurrence:\n1. promiscuity counts: for each marker how many different diseases it targets and vice versa. This reflects the selectivity of a given biomarker for a disease - the lower the promiscuity count of a biomarker, the higher the selectivity for a disease.\n2. appearence counts: for each marker how often it is mentioned together with any target and vice versa.\n\nTo visualize these co-occurencens we created a crosstab for counting the biomarker disease pairs and a heatmap for visualization.","16e9593e":"### Cluster biomarkers with similar disease targets and vice versa\n\nIn this part we're going to cluster biomarker-disease co-occurrences. Thus, we cluster  diseases together that are targeted by the same biomarkers and cluster biomarkers that target the same diseases.\nTo do so, we define a minimal counts cutoff above which we consider a biomarker diseases pair as valid. All pairs that have a count above this cutoff get a one and all counts\nbelow this cutoff get a zero in the correlation matrix. This is done for both occurrence measurements.","c70fda00":"### Create a concept label lookup table\nEach concept such as a disease or a gene has a preferred label, this allows normalizing data from different sources that use different synonyms for the same concept.","a3364547":"## Remove duplicate mentions from the same source\n\nUnique biomarker disease pairs may appear multiple times in our data, e.g. if this relationship was mentionend multiple times in the same PubMedCentral article.\nBecause we want to count multiple mentions in the same document or data source only as one mention, we group the data by their `src_id`.","657f3aef":"The clustering in the correlated most frequent biomarker-diseases shows that diseases schizophrenia and glioma share many of the same biomarkes - is this creating the hypothesis that both diseases share some common mechanisms?\nIn any case, https:\/\/www.ncbi.nlm.nih.gov\/pmc\/articles\/PMC6129591\/ advances data that glioma is more likely for people with schizophrenia. ","e0c7e3b6":"### Top 30 promiscuous biomarkers and diseases\nThe correlation shows that Interleukin 6 (IL-6) is the most promiscuous and thus the most disease unselective biomarker:","e9a80104":"#### Most promiscuous biomarkers and diseases cluster"}}