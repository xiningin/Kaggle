{"cell_type":{"50110a76":"code","3dea3f4a":"code","7d42e1f4":"code","7ee9bca0":"code","34746ab7":"code","6b49f145":"code","c517f567":"code","07b5d6b0":"code","e808c94d":"code","9fa2d3db":"code","d9eeab09":"code","7c4d6808":"code","a507cdfa":"code","91351718":"code","913bf1ad":"code","05ba27c0":"code","159c2d98":"code","a70bb7b7":"code","28e9f9d9":"code","2f842bcb":"code","ef33bfee":"code","679cda7f":"code","e739380c":"code","fc16f164":"code","44f09732":"code","0289080a":"code","12c093fd":"code","c7154947":"code","049617f6":"code","7064e617":"code","46831240":"code","4158eee2":"code","7871ea70":"code","f1bed3b4":"code","cec59275":"code","3a6201c4":"code","c2f6a915":"code","1e56675f":"code","61039e05":"code","c18d1b55":"code","7f05a502":"code","4124aa2f":"code","6aabf1f0":"code","883f722b":"code","b9b9759e":"code","474eeab6":"code","18afd20e":"code","0ca327d0":"code","b3d36ee1":"markdown","0c6e77fd":"markdown","e997f0d5":"markdown","0a087fa6":"markdown","5818709b":"markdown","4dfc6cbd":"markdown","6a031691":"markdown","31a74645":"markdown","ad74bd2d":"markdown","33493aa4":"markdown","0753810d":"markdown","67ced226":"markdown","68eb593c":"markdown","c6ecdf3c":"markdown","1c4552a7":"markdown","e1f14c88":"markdown","95409e86":"markdown","5cfd214f":"markdown","45d54e9d":"markdown","1560602a":"markdown","9ca40fc0":"markdown","eca39700":"markdown","0c092c7b":"markdown","1b220741":"markdown","a9bffdca":"markdown","3c149fc0":"markdown","edbff773":"markdown","0c9ceb94":"markdown","790b0961":"markdown","301606e4":"markdown","c5e9a53f":"markdown","77d2fd6c":"markdown","b92685ae":"markdown","45b1aa69":"markdown","3b0fbf82":"markdown"},"source":{"50110a76":"#loading data\n\nimport numpy as np \nimport pandas as pd \nimport riiideducation \nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport gc\nimport os\nimport warnings \nwarnings.filterwarnings('ignore')\n\nfor dirname, _, filenames in os.walk('\/kaggle\/input\/riiid-test-answer-prediction'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","3dea3f4a":"train_df = pd.read_csv('\/kaggle\/input\/riiid-test-answer-prediction\/train.csv', low_memory=False, nrows=3*(10**6), \n                       dtype={'row_id': 'int64', 'timestamp': 'int64', 'user_id': 'int32', 'content_id': 'int16', 'content_type_id': 'int8',\n                              'task_container_id': 'int16', 'user_answer': 'int8', 'answered_correctly': 'int8', 'prior_question_elapsed_time': 'float32', \n                             'prior_question_had_explanation': 'boolean',\n                             }\n                      )\ntrain_df.head()","7d42e1f4":"question = pd.read_csv('..\/input\/riiid-test-answer-prediction\/questions.csv')\nquestion.head()","7ee9bca0":"lecture = pd.read_csv('..\/input\/riiid-test-answer-prediction\/lectures.csv')\nlecture.head()","34746ab7":"def seperate_interactions(train_df):\n    questions_interactions = train_df.merge(question, left_on = 'content_id', right_on = 'question_id', how = 'left')\n    questions_interactions = questions_interactions[questions_interactions.content_type_id == 0]\n    questions_interactions.rename(columns = {'part': 'test_part'}, inplace = True)\n\n    lectures_interactions = train_df.merge(lecture, left_on = 'content_id', right_on = 'lecture_id', how = 'left') \n    lectures_interactions.rename(columns = {'part': 'category'}, inplace = True)\n    lectures_interactions = lectures_interactions[lectures_interactions.content_type_id == 1]\n    return questions_interactions,lectures_interactions\ndef fill_question_nulls(questions_interactions,elapse_val=-1,expl_val=-1):\n    '''Fixes the nulls in prior_question_elapsed_time and prior_question_had_explanation'''\n    indeces = questions_interactions[questions_interactions.prior_question_had_explanation.isnull()].index\n    values = {'prior_question_elapsed_time': elapse_val, 'prior_question_had_explanation': False}\n    questions_interactions.fillna(value=values,inplace=True)\n    questions_interactions.prior_question_had_explanation = questions_interactions.prior_question_had_explanation.astype('int8')\n    questions_interactions.loc[indeces,'prior_question_had_explanation'] = expl_val\n    return questions_interactions\n","6b49f145":"def reduce_mem_usage(props):\n    start_mem_usg = props.memory_usage().sum() \/ 1024**2 \n    print(\"Memory usage of properties dataframe is :\",start_mem_usg,\" MB\")\n    NAlist = [] # Keeps track of columns that have missing values filled in. \n    for col in props.columns:\n        if props[col].dtype != object:  # Exclude strings\n            # make variables for Int, max and min\n            IsInt = False\n            mx = props[col].max()\n            mn = props[col].min()\n            \n            # Integer does not support NA, therefore, NA needs to be filled\n            if not np.isfinite(props[col]).all(): \n                NAlist.append(col)\n                props[col].fillna(mn-1,inplace=True)  \n                   \n            # test if column can be converted to an integer\n            asint = props[col].fillna(0).astype(np.int64)\n            result = (props[col] - asint)\n            result = result.sum()\n            if result > -0.01 and result < 0.01:\n                IsInt = True\n\n            \n\n            \n            # Make Integer\/unsigned Integer datatypes\n            if IsInt:\n                if mn >= 0:\n                    if mx < 255:\n                        props[col] = props[col].astype(np.uint8)\n                    elif mx < 65535:\n                        props[col] = props[col].astype(np.uint16)\n                    elif mx < 4294967295:\n                        props[col] = props[col].astype(np.uint32)\n                    else:\n                        props[col] = props[col].astype(np.uint64)\n                else:\n                    if mn > np.iinfo(np.int8).min and mx < np.iinfo(np.int8).max:\n                        props[col] = props[col].astype(np.int8)\n                    elif mn > np.iinfo(np.int16).min and mx < np.iinfo(np.int16).max:\n                        props[col] = props[col].astype(np.int16)\n                    elif mn > np.iinfo(np.int32).min and mx < np.iinfo(np.int32).max:\n                        props[col] = props[col].astype(np.int32)\n                    elif mn > np.iinfo(np.int64).min and mx < np.iinfo(np.int64).max:\n                        props[col] = props[col].astype(np.int64)    \n            \n            # Make float datatypes 32 bit\n            else:\n                props[col] = props[col].astype(np.float32)\n            \n            # Print new column type\n           # print(\"dtype after: \",props[col].dtype)\n           # print(\"******************************\")\n    \n    # Print final result\n    print(\"___MEMORY USAGE AFTER COMPLETION:___\")\n    mem_usg = props.memory_usage().sum() \/ 1024**2 \n    print(\"Memory usage is: \",mem_usg,\" MB\")\n    print(\"This is \",100*mem_usg\/start_mem_usg,\"% of the initial size\")\n    return props","c517f567":"questions_interactions,lectures_interactions = seperate_interactions(train_df)\nquestions_interactions_cleaned = (questions_interactions.pipe(fill_question_nulls).pipe(reduce_mem_usage))","07b5d6b0":"questions_interactions_cleaned.head()","e808c94d":"non_sense_columns_lecture = ['content_type_id','user_answer','answered_correctly','prior_question_elapsed_time','prior_question_had_explanation']\nnon_sense_columns_question =['content_id','content_type_id']\nquestions_interactions_cleaned.drop(columns=non_sense_columns_question,inplace=True)\nlectures_interactions.drop(columns=non_sense_columns_lecture,inplace=True)","9fa2d3db":"# let's first get the maximum time a student spent on the app\nprint('The maximum time is {} hour'.format(questions_interactions_cleaned.timestamp.max()\/(1000*60*60*24)))","d9eeab09":"x=questions_interactions_cleaned.groupby('user_id').timestamp.max()\/(1000*60*60*24)\nplt.hist(x=x,bins=100);\n","7c4d6808":"x.value_counts().sort_index()","a507cdfa":"students_quit_early = x[x<24*15]\ndf_early_quit = questions_interactions_cleaned[questions_interactions_cleaned.user_id.isin(students_quit_early.index)]\ndf_early_quit.groupby('user_id').answered_correctly.mean().hist(grid=False);","91351718":"df_cont = questions_interactions_cleaned[~questions_interactions_cleaned.user_id.isin(students_quit_early.index)]\ndf_cont.groupby('user_id').answered_correctly.mean().hist(bins=19,grid=False);","913bf1ad":"100*df_cont.shape[0]\/questions_interactions_cleaned.shape[0]","05ba27c0":"x[x>24*15].shape","159c2d98":"df_new = df_cont.copy()\ndf_new['timestamp'] = round(df_new['timestamp']\/(1000*60*60*24))\ndf_new = df_new.groupby('user_id').agg({'answered_correctly':'mean','timestamp':'std'})\nsns.regplot(x='timestamp',y='answered_correctly',data=df_new,fit_reg=True);","a70bb7b7":"df_new = df_early_quit.copy()\ndf_new['timestamp'] = round(df_new['timestamp']\/(1000*60*60*24))\ndf_new = df_new.groupby('user_id').agg({'answered_correctly':'mean','timestamp':'std'})\nsns.regplot(x='timestamp',y='answered_correctly',data=df_new,fit_reg=True);","28e9f9d9":"color = sns.color_palette()[0]\nsns.countplot(data=questions_interactions_cleaned,x='test_part',color=color);","2f842bcb":"questions_interactions_cleaned.groupby('test_part').answered_correctly.mean()","ef33bfee":"df_early_quit.groupby('test_part').answered_correctly.mean()","679cda7f":"df_cont.groupby('test_part').answered_correctly.mean()","e739380c":"containers_perf = questions_interactions_cleaned.groupby('task_container_id').answered_correctly.mean()\ncontainers_perf.hist(grid=False,bins=100);","fc16f164":"containers_perf_filtered = containers_perf[containers_perf>0][containers_perf<1]\ncontainers_perf_filtered.hist(grid=False,bins=200);","44f09732":"containers_perf_filtered.shape","0289080a":"containers_perf_filtered.value_counts().nlargest(5)","12c093fd":"user_lectures_info = lectures_interactions.groupby(['user_id','category']).timestamp.min().reset_index()\nuser_lectures_info['user_cat'] = user_lectures_info['user_id'].astype(str)+'_'+user_lectures_info['category'].astype('int32').astype(str)\nuser_lectures_info = user_lectures_info[['user_cat','timestamp']]\nuser_lectures_info.rename(columns = {'timestamp': 'min_time'}, inplace = True)\nuser_lectures_info.head()","c7154947":"questions_interactions_cleaned_copy = questions_interactions_cleaned.copy()\nquestions_interactions_cleaned_copy['user_cat'] = questions_interactions_cleaned_copy['user_id'].astype(str)+'_'+questions_interactions_cleaned_copy['test_part'].astype(str)\nquestions_interactions_cleaned_copy = questions_interactions_cleaned_copy.merge(user_lectures_info, on = 'user_cat', how = 'left') \nquestions_interactions_cleaned_copy.head()","049617f6":"questions_interactions_cleaned_copy.fillna(questions_interactions_cleaned_copy.timestamp.max()+1,inplace=True)\nquestions_interactions_cleaned_copy['is_lec_watched'] = questions_interactions_cleaned_copy['timestamp'] > questions_interactions_cleaned_copy['min_time']\n","7064e617":"sns.countplot(questions_interactions_cleaned_copy.is_lec_watched);","46831240":"questions_interactions_cleaned_copy.groupby('is_lec_watched').answered_correctly.mean()","4158eee2":"early_lec_watch = questions_interactions_cleaned_copy[questions_interactions_cleaned_copy.user_id.isin(students_quit_early.index)]\nsns.countplot(early_lec_watch.is_lec_watched);\n","7871ea70":"cont_lec_watch = questions_interactions_cleaned_copy[~questions_interactions_cleaned_copy.user_id.isin(students_quit_early.index)]\n\nsns.countplot(cont_lec_watch.is_lec_watched);","f1bed3b4":"early_lec_watch.groupby('is_lec_watched').answered_correctly.mean()","cec59275":"cont_lec_watch.groupby('is_lec_watched').answered_correctly.mean()","3a6201c4":"user_lectures_info = lectures_interactions.groupby(['user_id','category','type_of']).timestamp.min().reset_index()\nuser_lectures_info['user_cat'] = user_lectures_info['user_id'].astype(str)+'_'+user_lectures_info['category'].astype('int32').astype(str)\nuser_lectures_info = user_lectures_info[['user_cat','type_of','timestamp']]\nuser_lectures_info.rename(columns = {'timestamp': 'min_time'}, inplace = True)\nuser_lectures_info.head()","c2f6a915":"questions_interactions_cleaned_copy = questions_interactions_cleaned.copy()\nquestions_interactions_cleaned_copy['user_cat'] = questions_interactions_cleaned_copy['user_id'].astype(str)+'_'+questions_interactions_cleaned_copy['test_part'].astype(str)\nquestions_interactions_cleaned_copy = questions_interactions_cleaned_copy.merge(user_lectures_info, on = 'user_cat', how = 'left') \nvalues = {'min_time':questions_interactions_cleaned_copy.timestamp.max()+1,'type_of':'na'} \nquestions_interactions_cleaned_copy.fillna(value=values,inplace=True)\nquestions_interactions_cleaned_copy['is_lec_watched'] = questions_interactions_cleaned_copy['timestamp'] > questions_interactions_cleaned_copy['min_time']\nquestions_interactions_cleaned_copy.head()","1e56675f":"for val in questions_interactions_cleaned_copy.type_of.unique():\n    df = questions_interactions_cleaned_copy[questions_interactions_cleaned_copy.type_of==val]\n    y=  df.groupby('is_lec_watched').answered_correctly.mean()\n    x = y.index\n    sns.barplot(x=x,y=y);\n    plt.title(val)\n    plt.show()\n","61039e05":"records_per_student = questions_interactions_cleaned.groupby('user_id').row_id.count()\nrecords_per_student.hist(bins=100,grid=False);","c18d1b55":"records_per_student_count = records_per_student.value_counts()\nrecords_per_student_count[records_per_student_count<10 ].shape[0]\/records_per_student_count.shape[0]","7f05a502":"100*questions_interactions_cleaned_copy.question_id.nunique()\/questions_interactions_cleaned_copy.shape[0]","4124aa2f":"quest_perf = questions_interactions_cleaned_copy.groupby('question_id').answered_correctly.mean()\nquest_perf.hist(grid=False,bins=100);","6aabf1f0":"filtered_quest_per = quest_perf[quest_perf<1]\nfiltered_quest_per.hist(grid=False,bins=20);","883f722b":"filtered_questions = filtered_quest_per.index\nfiltered_df = questions_interactions_cleaned_copy[questions_interactions_cleaned_copy.question_id.isin(filtered_questions)]\n100*filtered_df.shape[0]\/questions_interactions_cleaned_copy.shape[0]","b9b9759e":"df = questions_interactions_cleaned_copy.copy()\ndf = df.assign(tags2=df['tags'].str.split(' ')).explode('tags2')\ndf['tags2'] = df['tags2'].astype('int32') \ndf.head()","474eeab6":"tags_perf = df.groupby('tags2').answered_correctly.mean()\ntags_perf.hist(grid=False,bins=20);","18afd20e":"df = questions_interactions_cleaned_copy.copy()\ndf = df.assign(tags2=df['tags'].str.split(' '))\ndf['num_tags'] = df['tags2'].str.len()\ndf.head()","0ca327d0":"plt.plot(df.groupby('num_tags').answered_correctly.mean().index,df.groupby('num_tags').answered_correctly.mean(),color=color);","b3d36ee1":"> We can see that a lot of users don't continue using the app \n\n> Let's see how are they doing compared with those who use the app for longer times","0c6e77fd":"  > The standard deviation values start from 50 to 400 and looks to have negative relationship with the performance with high outliers.","e997f0d5":"> The mean of the filtered is high at about 0.66\n\n> It can be observed we have peaks at 0.667. 0.5,0.75,0.33\n\n> The peak of 0.667 can appear when a container has only 3 questions, one of them answered wrongly to have a 2\/3 score.\n","0a087fa6":"# Refrences\n\n1- memory used reduction: https:\/\/www.kaggle.com\/cdeotte\/dae-book3c from the cool grand master: Chris Deotte\n\n2- https:\/\/stackoverflow.com\/questions\/12680754\/split-explode-pandas-dataframe-string-entry-to-separate-rows\n\n","5818709b":" The type_of doesn't look to have an effect on the correct answers","4dfc6cbd":"Let's see the relation between time spent and score for these students","6a031691":"## Can we get the questions easiness ?","31a74645":"# Let's see how the type of the lecture affects the previous results","ad74bd2d":"sns.countplot(df['num_tags'],color=color)","33493aa4":"# Are students performing well when they see the lecture related to the question before answering ?\n","0753810d":"> some tags look to have high scores at 0.7 and less tags has higher scores\n","67ced226":">A lot of the task containers have only one record that they have just a 0 or 1 mean.","68eb593c":"> The relation between the number of the tags and the performance is positive","c6ecdf3c":"### Watching the lecture before answering looks to improve the early quitting students performance and doesn't affect the others much.","1c4552a7":"### Now let's try to answer some questions","e1f14c88":"# Let's check the performance against the task_container_id","95409e86":"> The relation looks to be positive with a lot of students with low time standard deviation and maximum standard deviation of 175.","5cfd214f":"## Let's see the number of persons who use the app for less than half month","45d54e9d":"> The position of these parts is  independent on the student category.","1560602a":"## Is there a relation between the part (relevant section of the TOEIC test) being answered and the performance ? ","9ca40fc0":"The users mean performance is slightly right skewed and has mean at about 0.6","eca39700":"Let's see the distribution of the overall time spent by the students in hours","0c092c7b":"> Many questions has only one answered right record\n\n> The mean is 0.8 when we filter out the always right questions","1b220741":"# Are students getting better after they spend much time on the app ?","a9bffdca":"# Finally let's check the tags relation with the performance.","3c149fc0":"> 88% of the students has less than 10 records !!\n\n> We may focus on looking at different features independent from students.","edbff773":"### How much the early quitting students watch the lectures before answering compared with those who didn't quit early ?","0c9ceb94":"## Now let's check other students performance","790b0961":"Most of the questions lies on the 5th part followed by the 2nd part.","301606e4":"> There are just 511 student who continued for more than one month with just 18% percent of the total records.\n\n> Their distribution is more right skewed which suggests that they have better grades","c5e9a53f":"## Let's now check the base student level against his overall performance","77d2fd6c":"* We can see that the statistics across the data are different depending on the student quit time.\n* The standard deviation of time for each student is related to his performance\n* The features that addresses the question difficulity (eg. task,container_id,tag) are more related to the performance than the features related to the students.\n* The most related feature to the performance is the number of tags per question.","b92685ae":"> The early quitting students watched lectures less","45b1aa69":"The first 5 parts look to a decreasing score pattern.","3b0fbf82":"### Let's start by cleaning the data as in part1 but using a pipe for cleaner code"}}