{"cell_type":{"78b14655":"code","ae206561":"code","23d92bda":"code","8784e131":"code","870e02d3":"code","f88a536d":"code","a0f5c04c":"code","7e8247de":"code","31bb8242":"code","a6e9d4e5":"code","3dc38357":"code","8f1c34fb":"code","01fed103":"code","48400841":"code","dbe41811":"code","1dd80a05":"code","887be1b8":"code","b3779e15":"code","ff20fe03":"code","b10d953c":"code","71e573a6":"code","a526209a":"code","c79d8693":"code","9c5f57a7":"code","388e01d9":"code","2fc05c36":"code","014702cd":"code","d9505df2":"code","589b9a26":"code","c062bf36":"code","abbd62e6":"code","24fc4d1d":"code","f5a4311c":"code","f76e3d14":"code","4d46a3b5":"code","4c2b6bcb":"code","4acb6bb5":"code","1ae91b70":"code","54b47b7a":"code","43cc36e6":"code","fd5da032":"code","bf385b7a":"code","36042523":"code","0b778bc1":"code","9720bb5c":"code","f44190ea":"code","2689fc58":"code","0719b1c1":"code","f6122a7f":"code","011f0b73":"code","115f37b2":"code","df638713":"code","9976a3d3":"code","3c46e8b4":"code","381a88af":"code","c20f3bae":"code","c6097690":"code","26c5fb6a":"code","bd4ea88b":"code","7d6105bf":"code","52f2ccf9":"code","45ae7730":"code","17739155":"code","f2e04f71":"markdown","3b5b86b5":"markdown","722d552a":"markdown","19a6dcff":"markdown","201cda33":"markdown","ea71b691":"markdown","0fb85253":"markdown","1ef17113":"markdown","5e74e269":"markdown","348960c3":"markdown","1ede9275":"markdown","27138829":"markdown","eb3e81d1":"markdown","78007c5c":"markdown","88e9e94a":"markdown","be3668f1":"markdown","c080bf0a":"markdown","22b18ac0":"markdown","693ab195":"markdown","84583587":"markdown","6f2ae557":"markdown","7c428920":"markdown","80cf7a1b":"markdown","231a96b0":"markdown","bde305a3":"markdown","7b2f2f02":"markdown","e677c6fd":"markdown","8c971964":"markdown","3fd92e32":"markdown","26e0cd56":"markdown","75f6ee44":"markdown","5612aefd":"markdown"},"source":{"78b14655":"# linear algebra\nimport numpy as np\n# data processing, CSV file I\/O (e.g. pd.read_csv)\nimport pandas as pd\n#Unix commands\nimport os\n\n# import useful tools\nfrom glob import glob\nfrom PIL import Image\nimport cv2\n\n# import data visualization\nimport matplotlib.pyplot as plt\nimport matplotlib.patches as patches\nimport seaborn as sns\n\nfrom bokeh.plotting import figure\nfrom bokeh.io import output_notebook, show, output_file\nfrom bokeh.models import ColumnDataSource, HoverTool, Panel\nfrom bokeh.models.widgets import Tabs\n\n# import data augmentation\nimport albumentations as albu\n\n# import math module\nimport math","ae206561":"#Libraries\nimport pandas_profiling\nimport xgboost as xgb\nfrom sklearn.metrics import log_loss\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn import preprocessing\nfrom sklearn.model_selection import KFold\nfrom sklearn.tree import DecisionTreeRegressor","23d92bda":"# One-hot encoding\nfrom sklearn.model_selection import cross_val_score\nfrom sklearn.ensemble import RandomForestRegressor","8784e131":"# Setup the paths to train and test images\nDATASET = '..\/input\/osic-pulmonary-fibrosis-progression'\nTEST_DIR = '..\/input\/osic-pulmonary-fibrosis-progression\/test'\nTRAIN_CSV_PATH = '..\/input\/osic-pulmonary-fibrosis-progression\/train.csv'\n\n# Glob the directories and get the lists of train and test images\ntrain_fns = glob(DATASET + '*')\ntest_fns = glob(TEST_DIR + '*')","870e02d3":"# Loading training data and test data\ntrain = pd.read_csv('..\/input\/osic-pulmonary-fibrosis-progression\/train.csv')\ntrain_dcm = pd.read_csv('..\/input\/osic-image-eda\/n_dicom_df.csv')\ntrain_dcm_shp = pd.read_csv('..\/input\/osic-image-eda\/shape_df.csv')\ntrain_meta_dcm = pd.read_csv('..\/input\/pulmonary-fibrosis-prep-data\/meta_train_data.csv')\ntest = pd.read_csv('..\/input\/osic-pulmonary-fibrosis-progression\/test.csv')","f88a536d":"# Display of training data\nprint(train)","a0f5c04c":"#Loading Sample Files for Submission\nsample = pd.read_csv('..\/input\/osic-pulmonary-fibrosis-progression\/sample_submission.csv')\n# Confirmation of the format of samples for submission\nsample.head(3)","7e8247de":"#Loading Sample Files for Submission\nsample = pd.read_csv('..\/input\/osic-pulmonary-fibrosis-progression\/sample_submission.csv')","31bb8242":"# display the smoking status of the training data without duplicates\nprint(train['SmokingStatus'].drop_duplicates())","a6e9d4e5":"# display the training data without gender duplication\nprint(train['Sex'].drop_duplicates())","3dc38357":"# Display some of the training data\ntrain.head(10)","8f1c34fb":"# Display some of the training data\ntrain_dcm.head(10)","01fed103":"# Display some of the training data\ntrain_dcm_shp.head(10)","48400841":"# Display some of the training data\ntrain_meta_dcm.head(10)","dbe41811":"# Check for missing values in the training data\ntrain.isnull().sum()","1dd80a05":"# Let's check the max value and the max value for Weeks\nprint(\"Minimum number of value for Weeks is: {}\".format(train['Weeks'].min()), \"\\n\" +\n      \"Maximum number of value for Weeks is: {}\".format(train['Weeks'].max() ))","887be1b8":"# Check the Patient statistics of the training data\ntrain['Patient'].describe()","b3779e15":"# Check the FVC statistics of the training data\ntrain['FVC'].describe(percentiles=[0.1,0.2,0.5,0.75,0.9])","ff20fe03":"# Check age-related statistics in the training data\ntrain['Age'].describe()","b10d953c":"# Display of test data\nprint(test)","71e573a6":"# Combine the Patient ID and Week columns\ntest_patient_weeklist = test['Patient_Week'] = test['Patient'].astype(str)+\"_\"+test['Weeks'].astype(str)\ntest2 = test.drop('Patient', axis=1)\ntest3 = test.drop('Weeks', axis=1)\ntest4 = test.reindex(columns=['Patient_Week', 'FVC', 'Percent', 'Age', 'Sex', 'SmokingStatus'])\ntest4.head(7)","a526209a":"# Find the unique number of patient IDs. \nn = train['Patient'].nunique()\nprint(n)","c79d8693":"# First, I'll use Sturgess's formula to find the appropriate number of classes in the histogram \nk = 1 + math.log2(n)","9c5f57a7":"# Display a histogram of the FVC of the training data\nsns.distplot(train['FVC'], kde=True, rug=False, bins=int(k)) \n# Graph Title\nplt.title('FVC')\n# Show Histogram\nplt.show() ","388e01d9":"# Display a histogram of the age of the training data\nsns.distplot(train['Age'], kde=True, rug=False, bins=int(k)) \n# Title of the study data age graph\nplt.title('Age')\n# Display a histogram of the age of the training data\nplt.show() ","2fc05c36":"# Show the correlation between age and FVC in the training data\nsns.scatterplot(data=train, x='Age', y='FVC')","014702cd":"# Produce correlation coefficients between age and FVC of the training data\ndf = train\ndf.corr()['Age']['FVC']","d9505df2":"# Narrowing down to smokers in the training data to produce a correlation coefficient between age and FVC \ndf_smk = train.query('SmokingStatus == \"Currently smokes\"')\n\ndf_smk.corr()['Age']['FVC']","589b9a26":"# Scatterplots of age and FVC for training data extracted by smokers\nsns.scatterplot(data=df_smk, x='Age', y='FVC')","c062bf36":"# Show the correlation between age and FVC in the training data\nsns.scatterplot(data=train, x='Percent', y='FVC')","abbd62e6":"# Compute summary statistics for FVC aggregated by age\ndf.groupby('Age').describe()['FVC']","24fc4d1d":"# Calculate summary statistics for FVC aggregated by patient ID \ndf.groupby('Patient').describe(percentiles=[0.1,0.2,0.5,0.8])['FVC']","f5a4311c":"df_corr = df.corr()\nprint(df_corr)","f76e3d14":"# View the correlation heat map\ncorr_mat = df.corr(method='pearson')\nsns.heatmap(corr_mat,\n            vmin=-1.0,\n            vmax=1.0,\n            center=0,\n            annot=True, # True:Displays values in a grid\n            fmt='.1f',\n            xticklabels=corr_mat.columns.values,\n            yticklabels=corr_mat.columns.values\n           )\nplt.show()","4d46a3b5":"# Draw a pie chart about gender.\nplt.pie(train[\"Sex\"].value_counts(),labels=[\"Male\",\"Female\"],autopct=\"%.1f%%\")\nplt.title(\"Ratio of Sex\")\nplt.show()","4c2b6bcb":"# Draw a pie chart about smoking status\nplt.pie(train[\"SmokingStatus\"].value_counts(),labels=[\"Ex-smoker\",\"Never smoked\",\"Currently smokes\"],autopct=\"%.1f%%\")\nplt.title(\"SmokingStatus\")\nplt.show()","4acb6bb5":"print(train[train.FVC < 1651])","1ae91b70":"def extract_num(s, p, ret=0):\n    search = p.search(s)\n    if search:\n        return int(search.groups()[0])\n    else:\n        return ret","54b47b7a":"import pydicom\n\ndef plot_pixel_array(dataset, figsize=(5,5)):\n    plt.figure(figsize=figsize)\n    plt.imshow(dataset.pixel_array, cmap=plt.cm.bone)\n    plt.show()","43cc36e6":"file_path = \"..\/input\/osic-pulmonary-fibrosis-progression\/train\/ID00023637202179104603099\/3.dcm\"\ndataset = pydicom.dcmread(file_path)\nplot_pixel_array(dataset)","fd5da032":"file_path = \"..\/input\/osic-pulmonary-fibrosis-progression\/train\/ID00023637202179104603099\/5.dcm\"\ndataset = pydicom.dcmread(file_path)\nplot_pixel_array(dataset)","bf385b7a":"file_path = \"..\/input\/osic-pulmonary-fibrosis-progression\/train\/ID00023637202179104603099\/7.dcm\"\ndataset = pydicom.dcmread(file_path)\nplot_pixel_array(dataset)","36042523":"file_path = \"..\/input\/osic-pulmonary-fibrosis-progression\/train\/ID00023637202179104603099\/15.dcm\"\ndataset = pydicom.dcmread(file_path)\nplot_pixel_array(dataset)","0b778bc1":"print(train[train.FVC > 3874])","9720bb5c":"file_path = \"..\/input\/osic-pulmonary-fibrosis-progression\/train\/ID00009637202177434476278\/11.dcm\"\ndataset = pydicom.dcmread(file_path)\nplot_pixel_array(dataset)","f44190ea":"file_path = \"..\/input\/osic-pulmonary-fibrosis-progression\/train\/ID00014637202177757139317\/2.dcm\"\ndataset = pydicom.dcmread(file_path)\nplot_pixel_array(dataset)","2689fc58":"file_path = \"..\/input\/osic-pulmonary-fibrosis-progression\/train\/ID00032637202181710233084\/30.dcm\"\ndataset = pydicom.dcmread(file_path)\nplot_pixel_array(dataset)","0719b1c1":"file_path = \"..\/input\/osic-pulmonary-fibrosis-progression\/train\/ID00032637202181710233084\/35.dcm\"\ndataset = pydicom.dcmread(file_path)\nplot_pixel_array(dataset)","f6122a7f":"# Create models and train them with training data\ntrain_x = train.drop(['FVC'], axis=1)\ntrain_y = df['FVC']","011f0b73":"#Combining training data with data frames with DICOM data and patient IDs as keys\ntrain_x2 = pd.merge(train_x, train_dcm, on='Patient')","115f37b2":"# Conversion of category variables to arbitrary values\ntrain_x2['Sex'] = train_x2['Sex'].map({'Male': 0, 'Female': 1})\ntrain_x2['SmokingStatus'] = train_x2['SmokingStatus'].map({'Never smoked': 0, 'Ex-smoker': 1, 'Currently smokes': 2})","df638713":"# Confirmation of current value\nprint(train_x2)","9976a3d3":"# Combine the Patient ID and Week columns\ntrain_x2['Patient_Week'] = train_x2['Patient'].astype(str)+\"_\"+train_x2['Weeks'].astype(str)\ntrain_x3 = train_x2.drop('Patient', axis=1)\ntrain_x4 = train_x3.drop('Weeks', axis=1)\ntrain_x5 = train_x4.reindex(columns=['Patient_Week', 'Percent', 'Age', 'Sex', 'SmokingStatus', 'n_dicom', 'n_list'])\ntrain_x5.head(7)\n# Confirming the converted value\nprint(train_x5)","3c46e8b4":"# Conversion of category variables to arbitrary values of test data\ntest2['Sex'] = test['Sex'].map({'Male': 0, 'Female': 1})\ntest2['SmokingStatus'] = test2['SmokingStatus'].map({'Never smoked': 0, 'Ex-smoker': 1, 'Currently smokes': 2})","381a88af":"test3 = test2.drop('Weeks', axis=1)\ntest4 = test3.drop('FVC', axis=1)\ntest5 = test4.reindex(columns=['Patient_Week', 'Percent', 'Age', 'Sex', 'SmokingStatus'])\ntest5.head(7)\n# Confirming the converted value\nprint(test5)","c20f3bae":"# I'll just copy test data\ntest_x = test5.copy()\nprint(test_x)","c6097690":"osic_features = ['Percent', 'Age', 'Sex', 'SmokingStatus']","26c5fb6a":"X = train_x5[osic_features]","bd4ea88b":"# Define model. Specify a number for random_state to ensure same results each run\nosic_model = DecisionTreeRegressor(random_state=1)\n\n# Fit model\nosic_model.fit(X, train_y)","7d6105bf":"print(X.head())\nprint(\"The predictions are\")\nprint(osic_model.predict(X.head()))","52f2ccf9":"# Let's visualize the FVC of Training Data\n# plt.figure(figsize=(18,6))\n# plt.plot(train_x5[\"FVC\"], label = \"Train_Data\")\n# plt.legend()","45ae7730":"# Let's visualize the FVC predictions\nplt.figure(figsize=(18,6))\n\nY_train_Graph = pd.DataFrame(X)\nplt.plot(Y_train_Graph, label = \"Predict\")\nplt.legend()","17739155":"#Reading the file\nsubmission = pd.DataFrame(columns = [\"Patient_Week\", \"FVC\", \"Confidence\"])\n#Exporting Files\nsubmission.to_csv('submission.csv', index=False)","f2e04f71":"# References & Credits","3b5b86b5":"* Therefore, we can conclude that there is no missing training data","722d552a":"* We understand that there are three types of smoking status.","19a6dcff":"# Checking data statistics","201cda33":"* From the output, we see that there is no correlation between age and fvc.","ea71b691":"* It seem to be understood that this group is predominantly elderly, given that the average age of this group is 67 years old!","0fb85253":"* Patient_Week is supposed to be a value obtained by concatenating PatientID and Week with underscore.","1ef17113":"This is my first exploratory data analysis. Of course, there are still many things I can't fix, so I plan to update as much as possible. I'd appreciate it if you all could give me accurate advice.","5e74e269":"* Explicitly, there appears to be no correlation between age and fvc when focusing on smokers","348960c3":"* The lungs are made up of many small balloon-shaped pouches called alveoli. Pulmonary fibrosis is a general term for a disease that causes inflammation and damage to the walls of these alveoli. This inflammation and damage is thought to gradually cause the walls of the alveoli to become thicker and harder. The hardening of the alveolar walls is called fibrosis. In other words, we seem to be able to determine that patients with thicker alveolar walls are the ones with this disease progressing and tails.\n\n* It should be noted that more than half of pulmonary fibrosis cases are still unexplained. It is characterized by the appearance of a beehive of broken lungs on chest CT.","1ede9275":"* From the output results, we can say that it is in the bottom 25% if the FVC is smaller than 2109.","27138829":"# What is pulmonary fibrosis?","eb3e81d1":"* From the output results, we can see that far fewer people are currently smoking","78007c5c":"# Creat Features","88e9e94a":"* Patient_Week is supposed to be a value obtained by concatenating PatientID and Week with underscore.","be3668f1":"*  [Code Requirements](https:\/\/www.kaggle.com\/c\/osic-pulmonary-fibrosis-progression\/overview\/code-requirements) say that No internet access enabled.Let's turn off the Internet.At the same time, the TPU says it cannot be used to enter this competition, so be careful when creating your submission file!","c080bf0a":"# Environmental construction","22b18ac0":"* At the same time, there appears to be no correlation between age and fvc when focusing on smokers","693ab195":"# * Overview of Correlation","84583587":"# Overview","6f2ae557":"# Intuitive understanding through images","7c428920":"* We can find that the only gender values are male and female and no other values","80cf7a1b":"# Creation of a submission file","231a96b0":"* We've been able to determine the general composition of the patient population, but it's still difficult to understand the relationship between the disease . \n* Let's move away from looking at the overall data and focus our search on the patients with the worst symptoms.\n* Let's get the information needed for the FVC to display the top 10% and bottom 10% of the image data.\n* We want to identify multiple patient IDs whenever possible, as we will consider the possibility of picking up outliers.","bde305a3":"* Let's take a look at the images of patients in the bottom 10% of FVC.","7b2f2f02":"* Next, let's look at the images of patients in the top 10% of FVC.","e677c6fd":"# Loading data","8c971964":"* [Tokyo Medical and Dental University](http:\/\/www.tmd.ac.jp\/med\/pulm\/d1.html)\n* [using-categorical-data-with-one-hot-encoding](https:\/\/www.kaggle.com\/dansbecker\/using-categorical-data-with-one-hot-encoding)\n* [OSIC - EDA & SimpleModel & Overview \u3010With\u65e5\u672c\u8a9e\u3011](https:\/\/www.kaggle.com\/koheist\/osic-eda-simplemodel-overview-with)\n* [Random Forest Submission](https:\/\/www.kaggle.com\/srikanthpotukuchi\/random-forest-submission)\n* [OSIC \/ image shape EDA and preprocess](https:\/\/www.kaggle.com\/currypurin\/osic-image-shape-eda-and-preprocess\/data)\n* [Doing something with DICOM images in Python](https:\/\/qiita.com\/fukuit\/items\/ed163f9b566baf3a6c3f)","3fd92e32":"# Building Model","26e0cd56":"# Choosing \"Features\"","75f6ee44":"* From the output results, we can see that we are overwhelmingly male.","5612aefd":"# Create test data"}}