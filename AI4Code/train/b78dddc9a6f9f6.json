{"cell_type":{"2e3f9041":"code","0d0fa736":"code","a14a0075":"code","939b3e57":"code","cb4ea710":"code","2f4dd846":"code","d8658d3d":"code","392f66d2":"code","5dbe9f86":"code","41d11c79":"code","fbe94062":"code","8e0d7945":"code","332daa14":"code","ae6d7dd1":"code","17178296":"code","df924853":"code","8cc0d1a0":"code","1740b2e7":"code","c1ade144":"code","01c9cb3d":"code","9bb62b9e":"code","56fbcfdf":"code","a211b332":"code","7211ad6d":"markdown","142942e3":"markdown","9c986749":"markdown","a7c16a74":"markdown","7445c133":"markdown","ab3d02ea":"markdown","fab41271":"markdown","392db3e2":"markdown","7f1bd4bc":"markdown","fc8c3a06":"markdown","4fe2fd1d":"markdown","96a4fc15":"markdown","0c25312f":"markdown","0b300953":"markdown","a38fea57":"markdown","2f90ec82":"markdown","e731a93c":"markdown","aaca615c":"markdown","19fcc7bf":"markdown"},"source":{"2e3f9041":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom keras.preprocessing.image import load_img,img_to_array,ImageDataGenerator\nfrom PIL import Image\nfrom glob import glob\nimport cv2\nfrom keras.utils import to_categorical\nfrom keras.models import Sequential\nfrom keras.layers import Dense , Dropout, Flatten , Conv2D,MaxPool2D\nfrom sklearn.metrics import confusion_matrix\nfrom sklearn.model_selection import train_test_split\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n","0d0fa736":"def read_images(path,num_img):\n    array=np.zeros((num_img,224,224,3))\n    i=0\n    for img in os.listdir(path):\n        img_path=path + \"\/\" + img\n        img=Image.open(img_path,mode=\"r\")\n        data=np.asarray(img,dtype=\"uint8\")\n        array[i]=data\n        i+=1\n    return array\n#no\nno_dr_path=r\"\/kaggle\/input\/diabetic-retinopathy-224x224-gaussian-filtered\/gaussian_filtered_images\/gaussian_filtered_images\/No_DR\"\nnum_no_dr=len(glob(\"\/kaggle\/input\/diabetic-retinopathy-224x224-gaussian-filtered\/gaussian_filtered_images\/gaussian_filtered_images\/No_DR\/*\"))\nno_dr_array=read_images(no_dr_path,num_no_dr)\nno_dr_array=no_dr_array.astype(np.uint8)\n#mild\nmild_path=r\"\/kaggle\/input\/diabetic-retinopathy-224x224-gaussian-filtered\/gaussian_filtered_images\/gaussian_filtered_images\/Mild\"\nnum_mild=len(glob(\"\/kaggle\/input\/diabetic-retinopathy-224x224-gaussian-filtered\/gaussian_filtered_images\/gaussian_filtered_images\/Mild\/*\"))\nmild_array=read_images(mild_path,num_mild)\nmild_array=mild_array.astype(np.uint8)\n#moderate\nmoderate_path=r\"\/kaggle\/input\/diabetic-retinopathy-224x224-gaussian-filtered\/gaussian_filtered_images\/gaussian_filtered_images\/Moderate\"\nnum_moderate=len(glob(\"\/kaggle\/input\/diabetic-retinopathy-224x224-gaussian-filtered\/gaussian_filtered_images\/gaussian_filtered_images\/Moderate\/*\"))\nmoderate_array=read_images(moderate_path,num_moderate)\nmoderate_array=moderate_array.astype(np.uint8)\n#proliferate\nproliferate_dr_path=r\"\/kaggle\/input\/diabetic-retinopathy-224x224-gaussian-filtered\/gaussian_filtered_images\/gaussian_filtered_images\/Proliferate_DR\"\nnum_proliferate_dr=len(glob(\"\/kaggle\/input\/diabetic-retinopathy-224x224-gaussian-filtered\/gaussian_filtered_images\/gaussian_filtered_images\/Proliferate_DR\/*\"))\nproliferate_dr_array=read_images(proliferate_dr_path,num_proliferate_dr)\nproliferate_dr_array=proliferate_dr_array.astype(np.uint8)\n#severe\nsevere_path =r\"\/kaggle\/input\/diabetic-retinopathy-224x224-gaussian-filtered\/gaussian_filtered_images\/gaussian_filtered_images\/Severe\"\nnum_severe=len(glob(\"\/kaggle\/input\/diabetic-retinopathy-224x224-gaussian-filtered\/gaussian_filtered_images\/gaussian_filtered_images\/Severe\/*\"))\nsevere_array=read_images(severe_path,num_severe)\nsevere_array=severe_array.astype(np.uint8)","a14a0075":"print(\"no_dr_array\",no_dr_array.shape)\nprint(\"mild_array\",mild_array.shape)\nprint(\"moderate_array\",moderate_array.shape)\nprint(\"proliferate_dr_array\",proliferate_dr_array.shape)\nprint(\"severe_array\",severe_array.shape)","939b3e57":"plt.imshow(no_dr_array[1])\nplt.axis(\"off\")\nplt.show()","cb4ea710":"print(\"no_dr_array dtype is\",no_dr_array.dtype)\nprint(\"mild_array dtype is\",mild_array.dtype)\nprint(\"moderate_array dtype is\",moderate_array.dtype)\nprint(\"proliferate_dr_array dtype is\",proliferate_dr_array.dtype)\nprint(\"severe_array dtype is\",severe_array.dtype)","2f4dd846":"print(\"num_no_dr:\",num_no_dr)\nprint(\"num_mild:\",num_mild)\nprint(\"num_moderate:\",num_moderate)\nprint(\"num_proliferate_dr:\",num_proliferate_dr)\nprint(\"num_severe:\",num_severe)","d8658d3d":"zeros=np.zeros(1805)\nones=np.ones(370)\ntwos=np.full(999,2)\nthrees=np.full(295,3)\nfours=np.full(193,4)\ny = np.concatenate((zeros,ones,twos,threes,fours),axis=0)\nprint(\"y shape\",y.shape)","392f66d2":"sns.countplot(y)\nplt.show()","5dbe9f86":"def resize_images(img):\n    number_of_image=img.shape[0]\n    new_array=np.zeros((number_of_image,64,64,3))\n    for i in range(number_of_image):\n        new_array[i]=cv2.resize(img[i,:,:,:],(64,64))\n    return new_array\nno_dr_array=resize_images(no_dr_array)\nno_dr_array=no_dr_array.astype(np.uint8)\nmild_array=resize_images(mild_array)\nmild_array=mild_array.astype(np.uint8)\nmoderate_array=resize_images(moderate_array)\nmoderate_array=moderate_array.astype(np.uint8)\nproliferate_dr_array=resize_images(proliferate_dr_array)\nproliferate_dr_array=proliferate_dr_array.astype(np.uint8)\nsevere_array=resize_images(severe_array)\nsevere_array=severe_array.astype(np.uint8)","41d11c79":"plt.imshow(no_dr_array[1])\nplt.axis(\"off\")\nplt.show()","fbe94062":"print(\"new no_dr_array shape\",no_dr_array.shape)\nprint(\"new mild_array shape\",mild_array.shape)\nprint(\"new moderate_array shape\",moderate_array.shape)\nprint(\"new proliferate_dr_array shape\",proliferate_dr_array.shape)\nprint(\"new severe_array shape\",severe_array.shape)","8e0d7945":"print(\"no_dr_array dtype is\",no_dr_array.dtype)\nprint(\"mild_array dtype is\",mild_array.dtype)\nprint(\"moderate_array dtype is\",moderate_array.dtype)\nprint(\"proliferate_dr_array dtype is\",proliferate_dr_array.dtype)\nprint(\"severe_array dtype is\",severe_array.dtype)","332daa14":"y = to_categorical(y,5)\nprint(\"new y shape\",y.shape)","ae6d7dd1":"x=np.concatenate((no_dr_array,mild_array,moderate_array,proliferate_dr_array,severe_array),axis=0)\nprint(\"x shape\",x.shape)\nprint(\"x dtype is \",x.dtype)","17178296":"x=x \/ 255.0","df924853":"x_train,x_test,y_train,y_test=train_test_split(x,y,test_size=0.3,random_state=42)\nprint(\"x_train shape\",x_train.shape)\nprint(\"x_test shape\",x_test.shape)\nprint(\"y_train shape\",y_train.shape)\nprint(\"y_test shape\",y_test.shape)","8cc0d1a0":"model = Sequential()\n\nmodel.add(Conv2D(filters=250,kernel_size=(3,3),activation=\"relu\",padding=\"same\",input_shape=(64,64,3)))\nmodel.add(MaxPool2D(pool_size=(2,2),strides=1))\n\nmodel.add(Conv2D(filters=125,kernel_size=(3,3),activation=\"relu\",padding=\"same\"))\nmodel.add(MaxPool2D(pool_size=(2,2),strides=1))\n\n\nmodel.add(Flatten())\nmodel.add(Dense(250,activation=\"relu\"))\nmodel.add(Dropout(0.5))\nmodel.add(Dense(125,activation=\"relu\"))\nmodel.add(Dropout(0.5))\nmodel.add(Dense(5,activation=\"softmax\"))","1740b2e7":"model.compile(optimizer=\"rmsprop\",loss=\"categorical_crossentropy\",metrics=[\"accuracy\"])","c1ade144":"datagen=ImageDataGenerator(\n                          shear_range=0.3,\n                          horizontal_flip=True,\n                          vertical_flip=True,\n                          zoom_range=0.3,\n                          rotation_range=0.3)\ndatagen.fit(x_train)","01c9cb3d":"batch_size=125\nepochs=30","9bb62b9e":"hist=model.fit_generator(datagen.flow(x_train,y_train,batch_size=batch_size),\n                        epochs=epochs,validation_data=(x_test,y_test),steps_per_epoch=x_train.shape[0] \/\/ batch_size)","56fbcfdf":"plt.figure(figsize=(20,10))\nplt.subplot(1,2,1)\nplt.plot(hist.history[\"loss\"],label=\"train loss\")\nplt.plot(hist.history[\"val_loss\"],label=\"val loss\")\nplt.legend()\nplt.show()","a211b332":"plt.figure(figsize=(20,10))\nplt.subplot(1,2,2)\nplt.plot(hist.history[\"accuracy\"],label=\"train accuracy\")\nplt.plot(hist.history[\"val_accuracy\"],label=\"val accuracy\")\nplt.legend()\nplt.show()","7211ad6d":"### I splitted it into two as training set and test set.","142942e3":"### I resized arrays (64,64,3) because RAM inadequate from me. If you increase size of arrays, the machine learn better but it works slowly","9c986749":"### I showed the shape for learning images' shape","a7c16a74":"### I normalized the arrays for faster machine operation","7445c133":"### I converted from image to array but array's dtype must be uint8 for show the images.\n","ab3d02ea":"### I determined different figures the labels for creating y variable according to keras\n\nno_dr = 0\n\nmild = 1\n\nmoderate = 2\n\nproliferate_dr = 3\n\nsevere = 4","fab41271":"### I combined the arrays for creating training set and test set","392db3e2":"### I showed an image you","7f1bd4bc":"### I showed the dtypes of arrays for learning arrays' dtypes","fc8c3a06":"### I showed how many have images the different features","4fe2fd1d":"### I showed the arrays (64,64,3)","96a4fc15":"### I imported the necessary libraries ","0c25312f":"### I observed the new shape of arrays","0b300953":"### I showed the dtypes of arrays for learning arrays' dtypes","a38fea57":"### I added new images. For example, I wrote horizontal_flip=True. This parameter take an image and it is rotated horizontally and new images are created.","2f90ec82":"### I started to work my model","e731a93c":"### I created my model\n* if you increase conv2d number or filters number, your machine learn better\n* if you incerase Dense number or units number, your machine learn better (units=Dense's parameter. Such as 250,125","aaca615c":"### I compiled my model ","19fcc7bf":"### I categorized the labels for working my model"}}