{"cell_type":{"49d419c1":"code","2e26891f":"code","b932635c":"code","e6fd58cd":"code","21d7d164":"code","56b62037":"code","1a1e087c":"code","07916e2a":"code","7a3a79fa":"code","62bf5cbb":"code","1c6df36e":"code","428434dc":"code","1ffc8ac7":"code","a0ee9a5e":"code","204b23df":"code","f32fc422":"code","916141c0":"code","bcad3bce":"code","38d25beb":"code","e338d520":"code","b791d65e":"code","aeec6312":"code","86ed0124":"code","2ef338af":"code","164906b4":"code","5fee9b57":"code","15950498":"code","6e0f0c20":"code","7981a477":"code","e8ea533b":"code","aa688f31":"code","cf281a94":"code","21a3ccdd":"code","7229f369":"code","f7cdcadf":"code","026c6f46":"code","e56ca9c9":"code","c18c443a":"code","d1fb59b9":"code","ec614cac":"code","6efb64c9":"code","333f8a16":"code","79e9d8c2":"code","667f377a":"code","108d0ccc":"code","56fc7670":"code","08a799ec":"code","1042481f":"code","ec5cb65f":"code","e994f9fd":"code","8222d00d":"code","aa451cb6":"code","f63c7baf":"code","9213f1d8":"code","d0441bd3":"code","f977e086":"code","254be3ce":"code","62761a70":"code","18e5ea8b":"code","522d9cd6":"code","0e3bb543":"code","c246cf0c":"code","34f2b05b":"code","9d29e63f":"code","837a50ce":"code","c22c5b0c":"code","490d240e":"code","ea845f5b":"code","7c470623":"code","3601f821":"markdown","e31223fe":"markdown","17218847":"markdown","b991069a":"markdown","5899f468":"markdown","83b83a56":"markdown","fdcf02c7":"markdown","e3a2eb17":"markdown","74ed6242":"markdown","17041956":"markdown","93bfd76b":"markdown","4f3726a3":"markdown","a4313c30":"markdown","ca735061":"markdown","0f6b0a37":"markdown","20c58b8e":"markdown","650cba72":"markdown","604e86ad":"markdown","18d7a64c":"markdown","58377c20":"markdown"},"source":{"49d419c1":"#import libraries\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib \nimport matplotlib.pyplot as plt\n%matplotlib inline","2e26891f":"#read csv\ndata = pd.read_csv(\"..\/input\/la-liga-match-data\/combined_data_laliga.csv\")","b932635c":"#create dataframe\ndf = pd.DataFrame(data)","e6fd58cd":"df.sample()","21d7d164":"temp_df = pd.DataFrame(data)","56b62037":"#Changing Score column to goal difference\ntemp_df[\"Score\"] = temp_df[\"Home Team Goals Scored\"] - temp_df[\"Away Team Goals Scored\"]","1a1e087c":"#We will also change the Score column in the main df and use that as the dependant variable to predict\ndf[\"Score\"] = df[\"Home Team Goals Scored\"] - df[\"Away Team Goals Scored\"]","07916e2a":"#drop duplicate index column\ntemp_df = temp_df.drop(\"Unnamed: 0\", axis=1)","7a3a79fa":"#dropping unncessary columns\ntemp_df = temp_df.drop([\"Half Time Score\", \"Home Team Off Target Shots\", \"Away Team Off Target Shots\", \"Home Team Blocked Shots\", \"Away Team Blocked Shots\", \"Home Team Corners\", \"Away Team Corners\", \"Home Team Throw Ins\", \"Away Team Throw Ins\", \"Home Team Aerials Won\", \"Away Team Aerials Won\", \"Home Team Clearances\", \"Away Team Clearances\", \"Home Team Second Yellow Cards\", \"Away Team Second Yellow Cards\"], axis=1)","62bf5cbb":"#Creating Winning Team Column -> 1 is when home team wins, -1 is when away team wins, 0 is draw\ndef winning_team(score):\n  if score > 0:\n    return 1\n  elif score == 0:\n    return 0\n  else:\n    return -1","1c6df36e":"temp_df[\"Winning Team\"] = temp_df.Score.apply(lambda x:winning_team(x))","428434dc":"temp_df.sample()","1ffc8ac7":"#Heatmap\ncorr = temp_df.corr()\nplt.figure(figsize=(10,10))\nsns.heatmap(corr)\nplt.xticks(rotation=70)","a0ee9a5e":"#Correlation between (Match Excitement, Total Shots) along with Total Fouls\n#Create new column for total shots and for total fouls\ntemp_df[\"Total Shots\"] = temp_df[\"Home Team Total Shots\"] + temp_df[\"Away Team Total Shots\"]\ntemp_df[\"Total Fouls\"] = temp_df[\"Home Team Fouls\"] + temp_df[\"Away Team Fouls\"]","204b23df":"plt.figure(figsize=(10,5))\nax = plt.subplot(1,2,1)\nsns.scatterplot(x=\"Total Shots\", y=\"Match Excitement\", data=temp_df, ax=ax)\nax = plt.subplot(1,2,2)\nsns.scatterplot(x=\"Total Fouls\", y=\"Match Excitement\", data=temp_df, ax=ax)","f32fc422":"#Correlation between (Match Excitement, Total Goals)\n#Create new column for total goals\ntemp_df[\"Total Goals\"] = temp_df[\"Home Team Goals Scored\"] + temp_df[\"Away Team Goals Scored\"]","916141c0":"plt.figure(figsize=(10,5))\nsns.scatterplot(x=\"Total Goals\", y=\"Match Excitement\", data=temp_df)","bcad3bce":"#Correlation between (Winning Team Rating, Winning Team Goals)\n#For this, we will create 2 new DFs, (Winning Team (home), Home Team Rating, Home Goals) and (Winning Team (away), Away Team Rating, Away Goals)\nhome_df = temp_df[:].copy()","38d25beb":"home_df = home_df[home_df[\"Winning Team\"] > 0]","e338d520":"home_df['Winning Team'].value_counts()","b791d65e":"away_df = temp_df[:].copy()","aeec6312":"away_df = away_df[away_df[\"Winning Team\"] < 0]\naway_df['Winning Team'].value_counts()","86ed0124":"plt.figure(figsize=(10,5))\nax = plt.subplot(1,2,1)\nsns.scatterplot(x=\"Home Team Goals Scored\", y=\"Home Team Rating\", data=home_df, ax=ax)\nax = plt.subplot(1,2,2)\nsns.scatterplot(x=\"Away Team Goals Scored\", y=\"Away Team Rating\", data=away_df, ax=ax)","2ef338af":"#Correlation between (Total Fouls, Total Yellow \/ Red Cards)\n#For this, we will create 2 new columns to calculate the total fouls and total cards\ntemp_df[\"Total Fouls\"] = temp_df['Away Team Fouls'] + temp_df['Home Team Fouls']\ntemp_df[\"Total Cards\"] = temp_df['Home Team Red Cards'] + temp_df['Home Team Yellow Cards'] + temp_df['Away Team Yellow Cards'] + temp_df['Away Team Red Cards'] ","164906b4":"plt.figure(figsize=(10,5))\nsns.lineplot(x=\"Total Fouls\", y=\"Total Cards\", data=temp_df)","5fee9b57":"#Correlation between (Winning Team Pass Success, Winning Team Total Shots)\nplt.figure(figsize=(10,5))\nax = plt.subplot(1,2,1)\nsns.lineplot(y=\"Home Team Pass Success %\", x=\"Home Team Total Shots\", data=home_df, ax=ax)\nax = plt.subplot(1,2,2)\nsns.lineplot(y=\"Away Team Pass Success %\", x=\"Away Team Total Shots\", data=away_df, ax=ax)","15950498":"#Correlation between (Winning Team Pass Success, Winning Team Total Goals)\nplt.figure(figsize=(10,5))\nax = plt.subplot(1,2,1)\nsns.lineplot(y=\"Home Team Pass Success %\", x=\"Home Team Goals Scored\", data=home_df, ax=ax)\nax = plt.subplot(1,2,2)\nsns.lineplot(y=\"Away Team Pass Success %\", x=\"Away Team Goals Scored\", data=away_df, ax=ax)","6e0f0c20":"#Correlation between (Year, Total Shots for one team)\n#For this example, let's take Real Madrid and put it in 2 new Data Frames (home and away)\n\n## NEED HELP WITH THIS: Is there a way we can do the same analysis with all the teams rather than having to pick one team like I did with REAL MADRID down below?\n\nmadridhome_df = temp_df.copy()\nmadridaway_df = temp_df.copy()","7981a477":"madridhome_df = madridhome_df[madridhome_df['Home Team'] == 'REAL MADRID']\nmadridaway_df = madridaway_df[madridaway_df['Away Team'] == 'REAL MADRID']","e8ea533b":"plt.figure(figsize=(10,5))\nax=plt.subplot(1,2,1)\nsns.scatterplot(x=\"year\", y=\"Home Team Goals Scored\", data=madridhome_df, ax=ax)\nax=plt.subplot(1,2,2)\nsns.scatterplot(x=\"year\", y=\"Away Team Goals Scored\", data=madridaway_df, ax=ax)","aa688f31":"## NEED HELP WITH THIS: Is there a better way to plot this? ^","cf281a94":"#Correlation between (Winning Team Possession, Winning Team Total Shots)\nplt.figure(figsize=(10,5))\nax = plt.subplot(1,2,1)\nsns.scatterplot(y=\"Home Team Possession %\", x=\"Home Team Total Shots\", data=home_df, ax=ax)\nax = plt.subplot(1,2,2)\nsns.scatterplot(y=\"Away Team Possession %\", x=\"Away Team Total Shots\", data=away_df, ax=ax)","21a3ccdd":"#Correlation between (Winning Team Possession, Winning Team Goals)\nplt.figure(figsize=(10,5))\nax = plt.subplot(1,2,1)\nsns.scatterplot(y=\"Home Team Possession %\", x=\"Home Team Goals Scored\", data=home_df, ax=ax)\nax = plt.subplot(1,2,2)\nsns.scatterplot(y=\"Away Team Possession %\", x=\"Away Team Goals Scored\", data=away_df, ax=ax)","7229f369":"#Do teams that play at home win more often?\nhometeam_df = temp_df.filter([\"Home Team\", \"Winning Team\"])\nhometeam_df = hometeam_df[hometeam_df[\"Winning Team\"] != 0]\nsns.countplot(hometeam_df[\"Winning Team\"])","f7cdcadf":"#Do teams that play at home score more goals?\n#For this, we create 2 new data frames for the home team and the away team\nhometeam_df = temp_df.filter([\"Home Team\", \"Home Team Goals Scored\"])\nhometeam_df.groupby(\"Home Team\").mean().sum()","026c6f46":"awayteam_df = temp_df.filter([\"Away Team\", \"Away Team Goals Scored\"])\nawayteam_df.groupby(\"Away Team\").mean().sum()","e56ca9c9":"plt.figure(figsize=(50,10))\nax = plt.subplot(1,2,1)\nsns.barplot(y=\"Home Team\", x=\"Home Team Goals Scored\", data=home_df, ax=ax)\nax = plt.subplot(1,2,2)\nsns.barplot(y=\"Away Team\", x=\"Away Team Goals Scored\", data=away_df, ax=ax)","c18c443a":"## NEED HELP WITH THIS: Is there a better way to plot this? ^","d1fb59b9":"#Do Home Teams conceede less goals?\nhometeam_df = temp_df.filter([\"Home Team\", \"Home Team Goals Conceeded\"])\nhometeam_df.groupby(\"Home Team\").mean().sum()","ec614cac":"awayteam_df = temp_df.filter([\"Away Team\", \"Away Team Goals Conceeded\"])\nawayteam_df.groupby(\"Away Team\").mean().sum()","6efb64c9":"plt.figure(figsize=(50,10))\nax = plt.subplot(1,2,1)\nsns.barplot(y=\"Home Team\", x=\"Home Team Goals Conceeded\", data=home_df, ax=ax)\nax = plt.subplot(1,2,2)\nsns.barplot(y=\"Away Team\", x=\"Away Team Goals Conceeded\", data=away_df, ax=ax)","333f8a16":"## NEED HELP WITH THIS: Is there a better way to plot this? ^","79e9d8c2":"#Do Home Teams have more possession?\nhometeam_df = temp_df.filter([\"Home Team\", \"Home Team Possession %\"])\nhometeam_df.groupby(\"Home Team\").mean().sum()","667f377a":"awayteam_df = temp_df.filter([\"Away Team\", \"Away Team Possession %\"])\nawayteam_df.groupby(\"Away Team\").mean().sum()","108d0ccc":"plt.figure(figsize=(50,10))\nax = plt.subplot(1,2,1)\nsns.barplot(y=\"Home Team\", x=\"Home Team Possession %\", data=home_df, ax=ax)\nax = plt.subplot(1,2,2)\nsns.barplot(y=\"Away Team\", x=\"Away Team Possession %\", data=away_df, ax=ax)","56fc7670":"## NEED HELP WITH THIS: Is there a better way to plot this? ^","08a799ec":"#Do teams taht play at home have a higher team rating compared to when they play away?\nhometeam_df = temp_df.filter([\"Home Team\", \"Home Team Rating\"])\nawayteam_df = temp_df.filter([\"Away Team\", \"Away Team Rating\"])","1042481f":"hometeam_df.groupby(\"Home Team\").mean().sum()","ec5cb65f":"awayteam_df.groupby(\"Away Team\").mean().sum()","e994f9fd":"plt.figure(figsize=(50,10))\nax = plt.subplot(1,2,1)\nsns.barplot(y=\"Home Team\", x=\"Home Team Rating\", data=home_df, ax=ax)\nax = plt.subplot(1,2,2)\nsns.barplot(y=\"Away Team\", x=\"Away Team Rating\", data=away_df, ax=ax)","8222d00d":"## NEED HELP WITH THIS: Is there a better way to plot this? ^","aa451cb6":"#Which teams score the most amount of goals?\nhometeam_df = temp_df.filter([\"Home Team\", \"Home Team Goals Scored\"])","f63c7baf":"hometeam_df.groupby('Home Team')['Home Team Goals Scored'].sum().plot(kind='bar')","9213f1d8":"awayteam_df = temp_df.filter([\"Away Team\", \"Away Team Goals Scored\"])\nawayteam_df.groupby('Away Team')['Away Team Goals Scored'].sum().plot(kind='bar')","d0441bd3":"## NEED HELP WITH THIS: Is there a way to find out the total amount of goals for a certain team whether it plays at home or away? I can only think of creating 2 dfs for home and away.","f977e086":"#import libraries\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import mean_squared_error\nfrom xgboost import XGBRegressor","254be3ce":"temp_df.sample()","62761a70":"#change the data types of categorial variables into integer\nbase = pd.get_dummies(temp_df,columns=['Home Team','Away Team'],dtype = int)","18e5ea8b":"base.sample()","522d9cd6":"#Split the data by year and remove unncessary columns or columns that give the answer (Score)\nbase1 = base[base[\"year\"]<2020]\nbase2 = base[base[\"year\"]>2019]\nbase1 = base1.drop([\"Home Team Goals Scored\", \"Away Team Goals Scored\", \"Home Team Goals Conceeded\", \"Away Team Goals Conceeded\", \"Total Goals\", \"Winning Team\"], axis=1)\nbase2 = base2.drop([\"Home Team Goals Scored\", \"Away Team Goals Scored\", \"Home Team Goals Conceeded\", \"Away Team Goals Conceeded\", \"Total Goals\", \"Winning Team\"], axis=1)","0e3bb543":"train_x = (base1.iloc[:,1:])\ntrain_x ","c246cf0c":"train_y = (base1.iloc[:,0])\ntrain_y","34f2b05b":"test_x = (base2.iloc[:,1:])\ntest_x","9d29e63f":"test_y = (base2.iloc[:,0])\ntest_y","837a50ce":"#Train model using XGBoost\nmodel = XGBRegressor(max_depth = 6)\nmodel.fit(train_x,train_y)","c22c5b0c":"#now we will set the target (actual value) and compared to the predicted value\ntarget = model.predict(test_x)\nmean_squared_error(target,test_y)","490d240e":"## NEED HELP WITH THIS: \n## How to find out the accuracy of the model? \n## Is there a better model suited for making such a prediction?\n## Since we are predicting the GOAL DIFFERENCE (SCORE) value here, don't you think the model will always have a low mean squared error value since the almost all the values of the goal difference are very low and close to zero.","ea845f5b":"#let's visualize the first 5 values in the test data\ntest_y[:5].values","7c470623":"#let's visualize the first 5 values in the target data\ntarget[:5]","3601f821":"Insight 1: As we can see, there is a clear positive correlation between the total number of shots and the match excitement rating. However, this is not the same case between total fouls and match excitement. So we can infer that people get excited by goals and are not influenced by fouls.","e31223fe":"Insight 9: Both the plots prove that even if there is a high possession %, we can't expect a higher amount of goals. However, there is an important point to note here which is that for a team to score a high amount of goals, they must have a high % of possession.","17218847":"Insight 2: As we can see, there is a clear positive correlation between the total number of goals and the match excitement rating. However, there is 1 outlier that has a relatively low rating but high amount of goals, might be a data anamoly.","b991069a":"Insight 14: As we can see, on average, Teams that play at home have a higher % of team rating.","5899f468":"Insight 12: As we can see, on average, Teams that play at home conceeded lesser goals.","83b83a56":"**DATA VISUALIZATION**","fdcf02c7":"Insight 4: As we can see, there is a clear positive correlation between the number of fouls and the total number of cards.","e3a2eb17":"Insight 10: As we can see, there is a higher amount of winning rate for teams that play at home.","74ed6242":"Insight 5: Both the plots prove that even if there is a high success rate of passing, we can't expect a higher amount of shots. However, there is an important point to note here which is that for a team to shoot more, they must have a high % of passing success rate.","17041956":"**DATA PREPROCESSING**","93bfd76b":"Insight 8: There is a pretty strong positive correlation between the number of shots taken and the possession %.","4f3726a3":"Insight 7: As we can see, there is no clear correlation between the number of goals scored and the years.","a4313c30":"Insight 11: As we can see, on average, Teams that play at home score more goals.","ca735061":"Insight 3: As we can see, there is a clear positive correlation between the Winning Team Rating and Number of goals scored by the winning team.","0f6b0a37":"We need to first create a new column to record the goal difference that will be the new 'Score' column, this will easily tell us who was the winner of the game and by how many goals.\n\nWe then will remove all the columns not required for our analysis but will include some of them in our ML prediction model, therefore we will create a new temporary df for analysis and visualization.","20c58b8e":"**I am very new with Data Analysis, so please bare with me. Any and every feedback is appreciated.**\n\nA few points to note:\n1. I need help with visualizing some of the results drawn (mentioned in the comments of that particular question being answered)\n2. I need help to know which ML model is the best to select and use for such kind of a prediction.\n3. Please do state if there are better ways to plot certain correlations.","650cba72":"Insight 15: As we can see, Barcelona has scored the most amount of goals and Real Madrid comes second.","604e86ad":"Insight 13: As we can see, on average, Teams that play at home have a higher % of possession.","18d7a64c":"**MACHINE LEARNING**","58377c20":"Insight 6: Both the plots prove that even if there is a high success rate of passing, we can't expect a higher amount of goals. However, there is an important point to note here which is that for a team to score a high amount of goals, they must have a high % of passing success rate."}}