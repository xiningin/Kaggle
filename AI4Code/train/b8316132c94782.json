{"cell_type":{"9525bbad":"code","20362ae6":"code","f1d61b74":"code","61e293d8":"code","286fcc74":"code","98828e86":"code","4cb9b50c":"code","3071885c":"code","d0a84048":"code","0e162228":"code","e0c4502a":"code","1791d037":"code","98f4b4d7":"code","4e72ee51":"code","751bdb39":"code","8449e2fe":"code","fe43b1eb":"code","7466e2fe":"code","d49463e4":"markdown","936059b6":"markdown","986b8ba5":"markdown","867c1926":"markdown"},"source":{"9525bbad":"import numpy as np\nimport pandas as pd\nimport xarray as xr\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import mean_squared_error, r2_score\n\nimport tensorflow as tf\nfrom tensorflow import keras\ntf.__version__, keras.__version__","20362ae6":"def rmse(y_true, y_pred):\n    return np.sqrt(mean_squared_error(y_true, y_pred))","f1d61b74":"tf.config.experimental.list_physical_devices('GPU')","61e293d8":"ls -lh ..\/input\/galaxy-zoo-cleaned\/","286fcc74":"%time ds = xr.load_dataset('..\/input\/galaxy-zoo-cleaned\/galaxy_train.nc')\nds","98828e86":"ds['image_train'].isel(sample=range(0, 50, 10)).plot(col='sample', row='channel', x='x', y='y')","4cb9b50c":"ds['label_train'].isel(sample=range(0, 50, 10)).plot(col='sample')","3071885c":"%%time\nX = ds['image_train'].data\ny = ds['label_train'].data\n\nX_train, X_valid, y_train, y_valid = train_test_split(\n    X, y, test_size=0.2, random_state=0)","d0a84048":"X_train.shape, y_train.shape","0e162228":"model = keras.Sequential([\n    keras.layers.Conv2D(32, kernel_size=(3, 3), activation='relu', padding='same'),\n    keras.layers.MaxPooling2D((3, 3)),\n    keras.layers.Conv2D(64, kernel_size=(3, 3), activation='relu', padding='same'),\n    keras.layers.MaxPooling2D((3, 3)),\n    keras.layers.Conv2D(128, kernel_size=(3, 3), activation='relu', padding='same'),\n    keras.layers.Flatten(),\n    keras.layers.Dense(37)\n])","e0c4502a":"%%time\nmodel.compile('adam', 'mse')\nhistory = model.fit(\n    X_train, y_train, batch_size=32, epochs=15,\n    validation_data=(X_valid, y_valid)\n)","1791d037":"pd.DataFrame(history.history).plot(marker='o')","98f4b4d7":"%time y_train_pred = model.predict(X_train)\nr2_score(y_train, y_train_pred)","4e72ee51":"rmse(y_train, y_train_pred)","751bdb39":"%time y_valid_pred = model.predict(X_valid)\nr2_score(y_valid, y_valid_pred)","8449e2fe":"rmse(y_valid, y_valid_pred)","fe43b1eb":"%time model.save('trained_simple_cnn_galaxy.h5')","7466e2fe":"ls -lh trained_simple_cnn_galaxy.h5","d49463e4":"# Fitting model","936059b6":"# Evaluate on train & validation data","986b8ba5":"# Save trained model","867c1926":"# Explore data"}}