{"cell_type":{"44dc73a6":"code","a2cc462d":"code","8c60cf33":"code","9955ab23":"code","06803a50":"code","88b1109d":"code","3819a9ff":"code","97a7f8a5":"code","f40bd7c6":"code","3bb822d2":"code","84a92011":"code","26634881":"code","8ab6c088":"code","458c8329":"code","309ed71d":"code","b73dadf1":"code","0213b0ea":"code","d699fde5":"code","4a422931":"code","e4f1d50d":"code","d075ac25":"code","3ccc977d":"code","6f6bee7a":"code","e1a16988":"code","368d623b":"code","45d31ad9":"code","a4653cb7":"code","d3864e89":"code","f001e3ad":"code","1dfcdcc3":"code","74857906":"code","67aa75d8":"code","02aa4b51":"code","ed4ccf41":"markdown","81560fe3":"markdown","7965fa68":"markdown","692797c1":"markdown","b0557a81":"markdown","a1da826b":"markdown","e0b80b06":"markdown","f21ca8bc":"markdown","d5fc4b1b":"markdown","2eb31d0e":"markdown","fb16dbb7":"markdown","490dae53":"markdown","ec850820":"markdown","9139c9c5":"markdown","d61582c1":"markdown"},"source":{"44dc73a6":"import numpy as np \nimport pandas as pd \nimport time\nimport os\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom fbprophet import Prophet\nimport statsmodels.api as sm\nfrom plotly.offline import init_notebook_mode, iplot\nfrom plotly import graph_objs as go\ninit_notebook_mode(connected=True)\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","a2cc462d":"df_raw= pd.read_csv('\/kaggle\/input\/demand-forecasting-kernels-only\/train.csv')\ndf_test=pd.read_csv('\/kaggle\/input\/demand-forecasting-kernels-only\/test.csv')\ndf_raw.head()","8c60cf33":"df_raw.describe().T","9955ab23":"plt.figure(figsize=(16,6))\nsns.barplot(data=df_raw,x='store',y='sales')","06803a50":"df_store=df_raw[(df_raw['store']==2) & (df_raw['date']>='2017-01-01')]\ndf_sc=df_store.copy()\ndf_sc.loc[:,'month'] = pd.DatetimeIndex(df_sc['date']).month\n#df_sc['month'] = pd.DatetimeIndex(df_sc['date']).month\ndf_sc.head()","88b1109d":"df_store1=pd.DataFrame(df_sc.groupby(['month','item']).sum()['sales'])\ndf_store1.reset_index(inplace=True)","3819a9ff":"import plotly.express as px\nfig = px.line(df_store1, x='month', y='sales',color='item')\nfig.show()","97a7f8a5":"df1=pd.DataFrame(df_raw.groupby('date').sum()['sales'],columns=['sales'])\ndf2=df1.reset_index()\ndf2['date']=pd.to_datetime(df2['date'])\ndf2['sales']=df2['sales']*1.0\ndf2.head()","f40bd7c6":"plt.figure(figsize=(16,6))\nsns.lineplot(data=df2,x='date',y='sales')","3bb822d2":"df3=df2.set_index(pd.to_datetime(df2['date']))\ndf3.info()","84a92011":"y = df3['sales'].resample('MS').mean() \ndecomposition = sm.tsa.seasonal_decompose(y)\nplt.figure(figsize=(16,12))\ndecomposition.plot()","26634881":"df4=df3.reset_index(drop=True)\ndf4.columns=['ds','y']\ndf4.head()","8ab6c088":"#df4['ds'].dt.strftime('%Y-%m')\ndf4['year'] = pd.DatetimeIndex(df4['ds']).year\ndf4['month'] = pd.DatetimeIndex(df4['ds']).month\ndf4['week'] = df4['ds'].dt.strftime('%A')\n#https:\/\/pandas.pydata.org\/pandas-docs\/stable\/reference\/api\/pandas.Period.strftime.html\ndf4.tail()","458c8329":"plt.figure(figsize=(10,6))\nsns.lineplot(data=df4,x='year',y='y',ci=1)","309ed71d":"plt.figure(figsize=(16,6))\nsns.lineplot(data=df4,x='month',y='y', hue='year',ci=1)","b73dadf1":"plt.figure(figsize=(16,6))\nsns.lineplot(data=df4,x='week',y='y',sort='True',hue='year',ci=1)","0213b0ea":"#df4.head()\ndf_raw.tail()","d699fde5":"df_train = df_raw[(df_raw['item'] == 15) & (df_raw['store'] == 2) & (df_raw['date']<='2016-12-31')]\ndf_train.columns=['ds','store','item','y']\n#Renaming is required since Facebook Prohet requires date column with name as ds and metric column name as y\ndf_train.tail()","4a422931":"m = Prophet(yearly_seasonality=True, weekly_seasonality=True)\nm.fit(df_train[['ds','y']])","e4f1d50d":"future = m.make_future_dataframe(periods=365)\nfuture.tail(n=3)","d075ac25":"forecast = m.predict(future)\nforecast.head(n=3)","3ccc977d":"m.plot(forecast)","6f6bee7a":"m.plot_components(forecast)","e1a16988":"df_orig = df_raw[(df_raw['item'] == 15) & (df_raw['store'] == 2)]\ndf_orig.columns=['ds','store','item','y']\ndf_orig.loc[:,('ds')]=pd.to_datetime(df_orig['ds'])","368d623b":"df_forecast=forecast[['ds','yhat_lower','yhat_upper','yhat']]\ndf_result= pd.merge(df_orig,df_forecast,on='ds')\ndf_result.tail()","45d31ad9":"from fbprophet.diagnostics import cross_validation\ndf_cv = cross_validation(m, initial='730 days', period='90 days', horizon = '365 days')","a4653cb7":"from fbprophet.diagnostics import performance_metrics\ndf_p = performance_metrics(df_cv)\ndf_p.tail()","d3864e89":"from fbprophet.plot import plot_cross_validation_metric\nfig = plot_cross_validation_metric(df_cv, metric='mape')","f001e3ad":"def mean_absolute_percentage_error(y_true, y_pred): \n    y_true, y_pred = np.array(y_true), np.array(y_pred)\n    return np.mean(np.abs((y_true - y_pred) \/ y_true)) * 100","1dfcdcc3":"mean_absolute_percentage_error(df_result['y'],df_result['yhat'])","74857906":"df_result_2017= df_result[df_result['ds']>='2017-01-01']\nmean_absolute_percentage_error(df_result_2017['y'],df_result_2017['yhat'])","67aa75d8":"df_result['y - yhat']=df_result['y'] - df_result['yhat']\nplt.figure(figsize=(16,6))\nsns.lineplot(data=df_result,x='ds',y='y - yhat')","02aa4b51":"df_result.describe().T","ed4ccf41":"### Objective:  Sales Forecasting Using Facebook Prophet\n\n#### Summary Of Steps Followed: \n1. Exploratory Data Analysis to undestand different data, its features and associated trend \n2. Extract Inference from Data Analysis \n3. Prepare Data for Training & Testing Model \n4. Create Forecast Model using Facebook Prophet \n5. Create Future Data Frame duration for which we need predection values \n6. Predect Sales for Future Data Frame\n7. Evaluate accuracy of your model \n8. Conclusion Report\n\nIf you like this notebook or learned anything from here. Share a token of appreciation by casting an upvote :)","81560fe3":"> Lets get the stats of Actuls, Forecasted & Error Values.","7965fa68":"### Step 6: Predict Sales for Future Data Frame","692797c1":"### With above visulisation its avident that the most selling item no is 15.","b0557a81":"### Step 5: Create Future Data Frame duration for which we need predection values\nIn this case we are keeping it as 365 i.e. next complete year. ","a1da826b":"### Step 4: Create Forecast Model using Facebook Prophet ","e0b80b06":"### From above analysis we can see that Store 2 has the highest Sales, hence let's take this store for futher analysis to identify which Item is the most selling in recent year.","f21ca8bc":"### Step 3: Prepare Data for Training & Testing Model  ","d5fc4b1b":"### Step 7: Evaluate Accuracy Of Your Model ","2eb31d0e":"### Step 1: Exploratory Data Analysis to undestand different data, its features and associated trend","fb16dbb7":"### With below decomposition we can see that the model is Additive, since the seasonal component is similar (not getting multiplied) over the period of time. ","490dae53":"### Conclusion: \n\n1. FB Prophet works very well for this time series sales data set, its is givig us MAPE <10% which means accuracy of >90% \n2. With above measurement report & stats we can visualize that the variations (y-yhat) between actuals (y) & predicted (yhat)  value, which seems pretty good. \n\n\n> If you like this notebook or learned anything from here. Share a token of appreciation by casting an upvote. :) \n\nCheers For The Solution! \n","ec850820":"> As you can see from above Cross Validation Report that the MAPE across all the date range is less then 0.1 i.e. 10% which is decent % Error. \n\n> ** Below is another traditional way of calculating MAPE, lets see what results it gives. ","9139c9c5":"> With this we can see that the MAPE value is similar to what we have calcualted via prophet metric validation report.\nLets plot these error & see its quantification.","d61582c1":"## Step 2: Inference from EDA: \n1. Store 2 has maxium sales in which the most popular Item is number 15\n2. With Trend analysis we can see that the Model is Additive (seasonal component is similar over period of time, not multiplying) \n3. Trend is positive with increase in sales over the year \n4. Sales increases in Q2, where in Maximum sales has been observed during month of July after which it again decreases \n5. With Weekly Trend we can infer that consumers prefer to shop during weekends. Sales trend increases from Friday with maximum sales on Sunday and then it again gets back to normal during weekdays."}}