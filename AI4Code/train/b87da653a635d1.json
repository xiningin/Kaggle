{"cell_type":{"30755c38":"code","be1793dc":"code","7c36b2e2":"code","3793d39a":"code","bbf26cfd":"code","2f599899":"code","04d3aaad":"code","0e6c6d8f":"code","52a87c5b":"code","19af0192":"code","daab85f9":"code","1554dbaf":"code","cf24f1b0":"code","deef8038":"code","d4594ccb":"code","3cc7f8b5":"code","829badeb":"code","5560bace":"code","226b9ede":"code","b9d81edd":"code","06683a4a":"code","86fa2fe8":"code","58346395":"code","30535497":"code","ff97eacc":"code","86e4ea1f":"code","8026f11f":"code","04ee1ea8":"code","267dc5f7":"code","dca62100":"code","642de7a5":"code","a51d153e":"code","df853481":"code","fe7f35df":"code","01ff6d4a":"code","50bef3c4":"code","fc73694a":"code","f0c8f650":"code","5e979fc7":"code","ef9c337b":"code","99fcd8d7":"code","bb440db3":"code","544c2c8f":"markdown","674e84af":"markdown","73d4cc4f":"markdown","0de1fd4b":"markdown","7ae37d1e":"markdown","2748c5c4":"markdown","fe070055":"markdown","0899bedd":"markdown","60700709":"markdown","e5ded5af":"markdown","08847d1f":"markdown"},"source":{"30755c38":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport statsmodels.graphics.tsaplots as sgt\nimport statsmodels.tsa.stattools as sts\nfrom statsmodels.tsa.arima_model import ARMA\nfrom scipy.stats.distributions import chi2 \nimport seaborn as sns\nsns.set()","be1793dc":"raw_csv_data = pd.read_csv(\"..\/input\/financial-markets\/Index2018.csv\") \ndf_comp=raw_csv_data.copy()\ndf_comp.date = pd.to_datetime(df_comp.date, dayfirst = True)\ndf_comp.set_index(\"date\", inplace=True)\ndf_comp=df_comp.asfreq('b')\ndf_comp=df_comp.fillna(method='ffill')","7c36b2e2":"df_comp['market_value']=df_comp.ftse","3793d39a":"del df_comp['spx']\ndel df_comp['dax']\ndel df_comp['ftse']\ndel df_comp['nikkei']\nsize = int(len(df_comp)*0.8)\ndf, df_test = df_comp.iloc[:size], df_comp.iloc[size:]","bbf26cfd":"import warnings\nwarnings.filterwarnings(\"ignore\")","2f599899":"def LLR_test(mod_1, mod_2, DF = 1):\n    L1 = mod_1.fit().llf\n    L2 = mod_2.fit().llf\n    LR = (2*(L2-L1))    \n    p = chi2.sf(LR, DF).round(3)\n    return p","04d3aaad":"df['returns'] = df.market_value.pct_change(1)*100","0e6c6d8f":"model_ret_ar_1_ma_1 = ARMA(df.returns[1:], order=(1,1))\nresults_ret_ar_1_ma_1 = model_ret_ar_1_ma_1.fit()\nresults_ret_ar_1_ma_1.summary()","52a87c5b":"model_ret_ar_1 = ARMA(df.returns[1:], order = (1,0))\nmodel_ret_ma_1 = ARMA(df.returns[1:], order = (0,1))","19af0192":"print(\"\\nARMA vs AR \", LLR_test(model_ret_ar_1, model_ret_ar_1_ma_1))\nprint(\"\\nARMA vs MA \", LLR_test(model_ret_ma_1, model_ret_ar_1_ma_1))","daab85f9":"model_ret_ar_3_ma_3 = ARMA(df.returns[1:], order=(3,3))\nresults_ret_ar_3_ma_3 = model_ret_ar_3_ma_3.fit()","1554dbaf":"LLR_test(model_ret_ar_1_ma_1, model_ret_ar_3_ma_3, DF = 4)","cf24f1b0":"results_ret_ar_3_ma_3.summary()","deef8038":"model_ret_ar_3_ma_2 = ARMA(df.returns[1:], order=(3,2))\nresults_ret_ar_3_ma_2 = model_ret_ar_3_ma_2.fit()\nresults_ret_ar_3_ma_2.summary()","d4594ccb":"model_ret_ar_2_ma_3 = ARMA(df.returns[1:], order=(2,3))\nresults_ret_ar_2_ma_3 = model_ret_ar_2_ma_3.fit()\nresults_ret_ar_2_ma_3.summary()","3cc7f8b5":"LLR_test(model_ret_ar_2_ma_3, model_ret_ar_3_ma_3)","829badeb":"model_ret_ar_3_ma_1 = ARMA(df.returns[1:], order=(3,1))\nresults_ret_ar_3_ma_1 = model_ret_ar_3_ma_1.fit()\nresults_ret_ar_3_ma_1.summary()","5560bace":"LLR_test(model_ret_ar_3_ma_1, model_ret_ar_3_ma_2)","226b9ede":"model_ret_ar_2_ma_2 = ARMA(df.returns[1:], order=(2,2))\nresults_ret_ar_2_ma_2 = model_ret_ar_2_ma_2.fit()\nresults_ret_ar_2_ma_2.summary()","b9d81edd":"model_ret_ar_1_ma_3 = ARMA(df.returns[1:], order=(1,3))\nresults_ret_ar_1_ma_3 = model_ret_ar_1_ma_3.fit()\nresults_ret_ar_1_ma_3.summary()","06683a4a":"print(\"\\n ARMA(3,2): \\tLL = \", results_ret_ar_3_ma_2.llf, \"\\tAIC = \", results_ret_ar_3_ma_2.aic)\nprint(\"\\n ARMA(1,3): \\tLL = \", results_ret_ar_1_ma_3.llf, \"\\tAIC = \", results_ret_ar_1_ma_3.aic)","86fa2fe8":"df['res_ret_ar_3_ma_2'] = results_ret_ar_3_ma_2.resid[1:]","58346395":"df.res_ret_ar_3_ma_2.plot(figsize = (20,5))\nplt.title(\"Residuals of Returns\", size=24)\nplt.show()","30535497":"sgt.plot_acf(df.res_ret_ar_3_ma_2[2:], zero = False, lags = 40)\nplt.title(\"ACF Of Residuals for Returns\",size=24)\nplt.show()","ff97eacc":"model_ret_ar_5_ma_5 = ARMA(df.returns[1:], order=(5,5))\nresults_ret_ar_5_ma_5 = model_ret_ar_5_ma_5.fit()\nresults_ret_ar_5_ma_5.summary()","86e4ea1f":"model_ret_ar_5_ma_1 = ARMA(df.returns[1:], order=(5,1))\nresults_ret_ar_5_ma_1 = model_ret_ar_5_ma_1.fit()\nresults_ret_ar_5_ma_1.summary()","8026f11f":"model_ret_ar_1_ma_5 = ARMA(df.returns[1:], order=(1,5))\nresults_ret_ar_1_ma_5 = model_ret_ar_1_ma_5.fit()\nresults_ret_ar_1_ma_5.summary()","04ee1ea8":"print(\"ARMA(5,1):  \\t LL = \",results_ret_ar_5_ma_1.llf,\"\\t AIC = \",results_ret_ar_5_ma_1.aic)\nprint(\"ARMA(1,5):  \\t LL = \",results_ret_ar_1_ma_5.llf,\"\\t AIC = \",results_ret_ar_1_ma_5.aic)","267dc5f7":"print(\"ARMA(3,2):  \\t LL = \",results_ret_ar_3_ma_2.llf,\"\\t AIC = \",results_ret_ar_3_ma_2.aic)","dca62100":"df['res_ret_ar_5_ma_1'] = results_ret_ar_5_ma_1.resid","642de7a5":"sgt.plot_acf(df.res_ret_ar_5_ma_1[1:], zero = False, lags = 40)\nplt.title(\"ACF of Residuals for Returns\",size=24)\nplt.show()","a51d153e":"sgt.plot_acf(df.market_value, unbiased=True, zero = False, lags = 40)\nplt.title(\"Autocorrelation Function for Prices\",size=20)\nplt.show()","df853481":"sgt.plot_pacf(df.market_value, lags = 40, alpha = 0.05, zero = False , method = ('ols'))\nplt.title(\"Partial Autocorrelation Function for Prices\",size=20)\nplt.show()","fe7f35df":"model_ar_1_ma_1 = ARMA(df.market_value, order=(1,1))\nresults_ar_1_ma_1 = model_ar_1_ma_1.fit()\nresults_ar_1_ma_1.summary()","01ff6d4a":"df['res_ar_1_ma_1'] = results_ar_1_ma_1.resid","50bef3c4":"sgt.plot_acf(df.res_ar_1_ma_1, zero = False, lags = 40)\nplt.title(\"ACF Of Residuals of Prices\",size=20)\nplt.show()","fc73694a":"model_ar_6_ma_6 = ARMA(df.market_value, order=(6,6))\nresults_ar_6_ma_6 = model_ar_6_ma_6.fit(start_ar_lags = 11)\nresults_ar_6_ma_6.summary()","f0c8f650":"model_ar_5_ma_6 = ARMA(df.market_value, order=(5,6))\nresults_ar_5_ma_6 = model_ar_5_ma_6.fit(start_ar_lags = 7)\nresults_ar_5_ma_6.summary()","5e979fc7":"model_ar_6_ma_1 = ARMA(df.market_value, order=(6,1))\nresults_ar_6_ma_1 = model_ar_6_ma_1.fit(start_ar_lags = 7)\nresults_ar_6_ma_1.summary()","ef9c337b":"print(\"ARMA(5,6):  \\t LL = \", results_ar_5_ma_6.llf, \"\\t AIC = \", results_ar_5_ma_6.aic)\nprint(\"ARMA(6,1):  \\t LL = \", results_ar_6_ma_1.llf, \"\\t AIC = \", results_ar_6_ma_1.aic)","99fcd8d7":"df['res_ar_5_ma_6'] = results_ar_5_ma_6.resid\nsgt.plot_acf(df.res_ar_5_ma_6, zero = False, lags = 40)\nplt.title(\"ACF Of Residuals of Prices\",size=20)\nplt.show()","bb440db3":"print(\"ARMA(5,6):  \\t LL = \", results_ar_5_ma_6.llf, \"\\t AIC = \", results_ar_5_ma_6.aic)\nprint(\"ARMA(5,1):  \\t LL = \", results_ret_ar_5_ma_1.llf, \"\\t AIC = \", results_ret_ar_5_ma_1.aic)","544c2c8f":"## Reevaluating Model Selection","674e84af":"## Importing the Data and Pre-processing ","73d4cc4f":"## ARMA for Returns vs ARMA for Prices","0de1fd4b":"## ARMA Models for Prices","7ae37d1e":"## ARMA(1,1)","2748c5c4":"## Importing the relevant packages","fe070055":"## Creating Returns","0899bedd":"## Residuals for Returns","60700709":"## Higher-Lag ARMA Models","e5ded5af":"## Residuals for the New Model","08847d1f":"## The LLR Test"}}