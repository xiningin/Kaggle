{"cell_type":{"d42a6b0d":"code","8a01c899":"code","0937bb1c":"code","470d1c3a":"code","3e79ce85":"code","b20b365b":"code","fce54f59":"code","00c04261":"code","585ddd1a":"code","36c75a6d":"code","4b6cc6b1":"code","dda6432f":"code","e64a519e":"code","acc58591":"code","196309b7":"code","6c0096c0":"code","3b0c33e5":"code","b4846a1c":"code","e61d3627":"code","4e45d77f":"code","25b08f12":"code","e2ec9840":"code","e1d47ad5":"code","3fac9797":"code","648b1639":"code","ad0ec0ff":"code","ad1c7b48":"code","e14e1ceb":"code","3fc016ab":"code","8d9903d0":"code","5d54ece9":"code","8bc31914":"code","d6ab9578":"code","c6f6c400":"code","6ce02e3b":"code","d8f7a3bf":"code","95f725fa":"code","2b080ba4":"code","1ec3993c":"code","cce4160b":"code","003ada14":"code","a3b94bd7":"code","0f812d2b":"code","eb6b7d79":"code","475cbd27":"code","616d3ca9":"code","bfbb4fbe":"code","397b1ca2":"code","fff21ac4":"code","1d9061f5":"code","1bc7ed84":"code","4ee5371a":"code","015f1561":"code","55440c65":"code","746fe0ce":"code","12d06eb7":"code","b2f60280":"code","26935f41":"code","566ebc86":"code","38e94036":"code","36ff5cc0":"code","3f293e64":"code","6532ddba":"code","936f17bd":"code","30a2c253":"code","b42cdecb":"markdown","06497d07":"markdown","7db75411":"markdown","cc98789f":"markdown","2f1e201d":"markdown","c3970106":"markdown","b7a28faf":"markdown","05f8f581":"markdown","0dc5b592":"markdown","b9ed5b09":"markdown","a98e6e46":"markdown","504b8620":"markdown","90cc9b59":"markdown","bbaade42":"markdown","6509d93c":"markdown","d9fb0485":"markdown"},"source":{"d42a6b0d":"import pandas as pd\nimport sys\n'geopandas' in sys.modules\nimport geopandas as gpd\nimport matplotlib.pyplot as plt\n\nplt.style.use('ggplot')\n\npd.set_option('display.max_columns', None)\npd.set_option('max_colwidth', None)\npd.set_option('max_rows', None)","8a01c899":"df = pd.read_csv('..\/input\/accidents-at-work-in-italy\/inail_inail.csv')","0937bb1c":"territorial_codes = pd.read_csv('..\/input\/istat-italian-province-namescodes\/Codici-statistici-e-denominazioni.csv', sep=\";\", encoding = \"ISO-8859-1\")","470d1c3a":"territorial_codes.head()","3e79ce85":"territorial_codes.columns = ['region code', 'Code of the supra-municipal territorial unit', 'Province Code (Historical)', 'Municipality progressive',\n                            'Municipality code in alphanumeric format', 'Name (Italian and foreign)', 'Name in Italian', 'Name in other language',\n                            'Code Geographical Distribution', 'Geographical distribution', 'Region Name', 'Name of the supra-municipal territorial unit',\n                            'Type of supra-municipal territorial unit', 'Flag Provincial capital \/ metropolitan city \/ free consortium',\n                            'Automotive abbreviation', 'Municipal code numeric format', 'Numeric municipality code with 110 provinces (from 2010 to 2016)',\n                            'Numeric municipality code with 107 provinces (from 2006 to 2009)', 'Numeric municipality code with 103 provinces (1995 to 2005)',\n                            'Cadastral code of the municipality', 'NUTS1 code 2010', 'NUTS2 code 2010', 'NUTS3 code 2010', 'NUTS1 code 2021', 'NUTS2 code 2021',\n                            'NUTS3 code 2021']","b20b365b":"code_province_name_region = pd.concat([territorial_codes['Province Code (Historical)'],\n                                     territorial_codes['Automotive abbreviation'],\n                                     territorial_codes['Region Name']], axis = 1)","fce54f59":"# When the province is Naples, the abbreviation is NA. This is read as a missing value, replace NA with 'NAPOLI' in full:\ncode_province_name_region['Automotive abbreviation'][code_province_name_region['Automotive abbreviation'].isna()] = 'NAPOLI' \ncode_province_name_region.columns = ['PlaceOfOccurrence', 'abbreviation', 'Region']\n\ncode_province_name_region = code_province_name_region.drop_duplicates()","00c04261":"# merge accident data with ISTAT data\ndata = pd.merge(df, code_province_name_region, on='PlaceOfOccurrence' , how='left')","585ddd1a":"italy = gpd.read_file('..\/input\/italy-shapefiles\/ProvCM01012021_g_WGS84.shp') # shape files","36c75a6d":"italy = italy.rename(columns = {'SIGLA':'abbreviation'})","4b6cc6b1":"data.abbreviation[data.abbreviation.isna()] = 'NAPOLI'\n\nitaly.abbreviation[italy.abbreviation == 'NA'] = 'NAPOLI'\n\nmerge = italy.merge(data, on='abbreviation', how='right')","dda6432f":"injuries_provinces = pd.DataFrame(merge.groupby(['abbreviation']).size())","e64a519e":"injuries_provinces.reset_index(level=0, inplace=True)","acc58591":"injuries_provinces.columns = ['abbreviation', 'Number of Injuries']","196309b7":"injuries_map = italy.merge(injuries_provinces, on='abbreviation', how='right')","6c0096c0":"# Number of injuries by province\nfig, ax = plt.subplots(1, figsize=(10, 10))\ncol = 'Number of Injuries'\nax.set_title(\ncol, \nfontdict={'fontsize':'15', 'fontweight':'3'}, \ncolor='#14295d', \nfontfamily='monospace')\ninjuries_map.plot(\nax=ax,\ncolumn=col,\ncmap='Reds',\nlabel='',\nlegend=True,\ncategorical=False\n).axis('off')","3b0c33e5":"italy = gpd.read_file('..\/input\/italy-shapefiles\/Reg01012021_g_WGS84.shp') # region files","b4846a1c":"italy.DEN_REG.unique()","e61d3627":"data.Region.unique()","4e45d77f":"data.Region[data.Region == 'Friuli-Venezia Giulia'] = 'Friuli Venezia Giulia'\ndata.Region[data.Region == \"Valle d'Aosta\/Vall\u00e9e d'Aoste\"] = \"Valle d'Aosta\"\ndata.Region[data.Region == 'Trentino-Alto Adige\/S\u00fcdtirol'] = 'Trentino-Alto Adige'","25b08f12":"italy = italy.rename(columns = {'DEN_REG':'Region'})","e2ec9840":"merge = italy.merge(data, on='Region', how='right')","e1d47ad5":"injuries_regions = pd.DataFrame(merge.groupby(['Region']).size())","3fac9797":"injuries_regions.reset_index(level=0, inplace=True)","648b1639":"injuries_regions.columns = ['Region', 'Number of Injuries']","ad0ec0ff":"population_by_region = {'Abruzzo':1285256,'Basilicata':547579, 'Calabria':1877728, 'Campania':5679759,\n                        'Emilia-Romagna':4445549, 'Friuli Venezia Giulia':1198753, 'Lazio':5720796, \n                        'Liguria':1509805, 'Lombardia':9966992, 'Marche':1501406, 'Molise':296547, \n                        'Piemonte':4273210, 'Puglia':3926931, 'Sardegna':1598225,\n                        'Sicilia':4840876\t, 'Toscana':3668333, 'Trentino-Alto Adige':1078460\t, 'Umbria':865013,\n                        \"Valle d'Aosta\":123895, 'Veneto':4852453}\nemployment_rate_by_region = {'Abruzzo':0.622,'Basilicata':0.533, 'Calabria':0.456, 'Campania':0.453,\n                        'Emilia-Romagna':0.744, 'Friuli Venezia Giulia':0.71, 'Lazio':0.653, \n                        'Liguria':0.673, 'Lombardia':0.726, 'Marche':0.694, 'Molise':0.574, \n                        'Piemonte':0.707, 'Puglia':0.494, 'Sardegna':0.561,\n                        'Sicilia':0.441\t, 'Toscana':0.713, 'Trentino-Alto Adige':0.763\t, 'Umbria':0.677,\n                        \"Valle d'Aosta\":0.729, 'Veneto':0.715}\npopulation_rate_between_20_60_years_old = 0.592","ad1c7b48":"employment_rate_per_region_20_60_years = {Region: population * employment_rate_by_region[Region] * population_rate_between_20_60_years_old for Region, population in population_by_region.items()}","e14e1ceb":"injuries_map = italy.merge(injuries_regions, on='Region', how='right')","3fc016ab":"injuries_map['Number of Employees by Region'] = injuries_map['Region']\ninjuries_map['Number of Employees by Region'] = injuries_map['Number of Employees by Region'].map(employment_rate_per_region_20_60_years)","8d9903d0":"injuries_map['Accident Rate Per Inhabitant By Region'] = injuries_map['Number of Injuries']\/injuries_map['Number of Employees by Region']","5d54ece9":"fig, ax = plt.subplots(1, figsize=(10, 10))\ncol = 'Number of Injuries'\nax.set_title(\ncol, \nfontdict={'fontsize':'15', 'fontweight':'3'}, \ncolor='#14295d', \nfontfamily='monospace')\ninjuries_map.plot(\nax=ax,\ncolumn=col,\ncmap='Reds',\nlabel='',\nlegend=True,\ncategorical=False\n).axis('off')","8bc31914":"fig, ax = plt.subplots(1, figsize=(10, 10))\ncol = 'Accident Rate Per Inhabitant By Region'\nax.set_title(\ncol, \nfontdict={'fontsize':'15', 'fontweight':'3'}, \ncolor='#14295d', \nfontfamily='monospace')\ninjuries_map.plot(\nax=ax,\ncolumn=col,\ncmap='Reds',\nlabel='',\nlegend=True,\ncategorical=False\n).axis('off')","d6ab9578":"accidents_regions_gender = pd.DataFrame(merge.groupby(['Region','Gender']).size())","c6f6c400":"accidents_regions_gender.reset_index(level=0, inplace=True)\naccidents_regions_gender.reset_index(level=0, inplace=True)","6ce02e3b":"accidents_regions_gender.columns = ['Gender', 'Region', 'Number of Injuries']","d8f7a3bf":"injuries_map = italy.merge(accidents_regions_gender, on='Region', how='right')","95f725fa":"injuries_map_F = injuries_map[injuries_map.Gender == 'F']\ninjuries_map_M = injuries_map[injuries_map.Gender == 'M']","2b080ba4":"injuries_map_F = injuries_map_F.rename(columns = {'Number of Injuries':'Number of Injuries Gender = F'})\ninjuries_map_M = injuries_map_M.rename(columns = {'Number of Injuries':'Number of Injuries Gender = M'})","1ec3993c":"fig = plt.figure(figsize=(20,8))\n\nax1 = fig.add_subplot(121)\ncol = 'Number of Injuries Gender = M'\nax1.set_title(col, \nfontdict={'fontsize':'15', 'fontweight':'3'}, \ncolor='#14295d', \nfontfamily='monospace')\nax1 = injuries_map_M.plot(\nax=ax1,\ncolumn=col,\ncmap='Reds',\nlabel='',\nlegend=True,\ncategorical=False\n).axis('off')\n\nax2 = fig.add_subplot(122)\ncol = 'Number of Injuries Gender = F'\nax2.set_title(col, \nfontdict={'fontsize':'15', 'fontweight':'3'}, \ncolor='#14295d', \nfontfamily='monospace')\nax2 = injuries_map_F.plot(\nax=ax2,\ncolumn=col,\ncmap='Reds',\nlabel='',\nlegend=True,\ncategorical=False\n).axis('off')\nplt.show()","cce4160b":"population_M_by_region = {'Abruzzo':627509,'Basilicata':269350, 'Calabria':919061, 'Campania':2767607,\n                        'Emilia-Romagna':2165612, 'Friuli Venezia Giulia':583280, 'Lazio':2761729, \n                        'Liguria':723647, 'Lombardia':4882206, 'Marche':730536, 'Molise':145946, \n                        'Piemonte':2077405, 'Puglia':1910616, 'Sardegna':784501,\n                        'Sicilia':2353823\t, 'Toscana':1773215, 'Trentino-Alto Adige':531999, 'Umbria':417598,\n                        \"Valle d'Aosta\":60557, 'Veneto':2377891}\nemployment_rate_M_per_region_15_64_years = {'Abruzzo':0.687,'Basilicata':0.634, 'Calabria':0.533, 'Campania':0.533,\n                        'Emilia-Romagna':0.755, 'Friuli Venezia Giulia':0.752, 'Lazio':0.686, \n                        'Liguria':0.693, 'Lombardia':0.743, 'Marche':0.718, 'Molise':0.639, \n                        'Piemonte':0.714, 'Puglia':0.597, 'Sardegna':0.590,\n                        'Sicilia':0.529\t, 'Toscana':0.729, 'Trentino-Alto Adige':0.762, 'Umbria':0.702,\n                        \"Valle d'Aosta\":0.711, 'Veneto':0.753}","003ada14":"population_F_by_region = {'Abruzzo':657747,'Basilicata':278229, 'Calabria':958667, 'Campania':2912152,\n                        'Emilia-Romagna':2279937, 'Friuli Venezia Giulia':615473, 'Lazio':2959067, \n                        'Liguria':786158, 'Lombardia':5084786, 'Marche':770870, 'Molise':150601, \n                        'Piemonte':2195805, 'Puglia':2016315, 'Sardegna':813724,\n                        'Sicilia':2487053, 'Toscana':1895118, 'Trentino-Alto Adige':546461, 'Umbria':447415,\n                        \"Valle d'Aosta\":63338, 'Veneto':2474562}\nemployment_rate_F_per_region_15_64_years = {'Abruzzo':0.464,'Basilicata':0.377, 'Calabria':0.290, 'Campania':0.287,\n                        'Emilia-Romagna':0.620, 'Friuli Venezia Giulia':0.589, 'Lazio':0.521, \n                        'Liguria':0.562, 'Lombardia':0.593, 'Marche':0.564, 'Molise':0.430, \n                        'Piemonte':0.578, 'Puglia':0.328, 'Sardegna':0.451,\n                        'Sicilia':0.293, 'Toscana':0.595, 'Trentino-Alto Adige':0.632, 'Umbria':0.569,\n                        \"Valle d'Aosta\":0.634, 'Veneto':0.565}","a3b94bd7":"employment_rate_F_per_region_15_64_years = {Region: Population * employment_rate_F_per_region_15_64_years[Region]  for Region, Population in population_F_by_region.items()}\nemployment_rate_M_per_region_15_64_years = {Region: Population * employment_rate_M_per_region_15_64_years[Region]  for Region, Population in population_M_by_region.items()}","0f812d2b":"injuries_map_F['Number of Employees F By Region'] = injuries_map_F['Region']\ninjuries_map_F['Number of Employees F By Region'] = injuries_map_F['Number of Employees F By Region'].map(employment_rate_F_per_region_15_64_years)","eb6b7d79":"injuries_map_M['Number of Employees M By Region'] = injuries_map_M['Region']\ninjuries_map_M['Number of Employees M By Region'] = injuries_map_M['Number of Employees M By Region'].map(employment_rate_M_per_region_15_64_years)","475cbd27":"injuries_map_F['Accident Rate Per Inhabitant By Region F'] = injuries_map_F['Number of Injuries Gender = F']\/injuries_map_F['Number of Employees F By Region']\ninjuries_map_M['Accident Rate Per Inhabitant By Region M'] = injuries_map_M['Number of Injuries Gender = M']\/injuries_map_M['Number of Employees M By Region']","616d3ca9":"fig = plt.figure(figsize=(20,8))\n\nax1 = fig.add_subplot(121)\ncol = 'Accident Rate Per Inhabitant By Region M'\nax1.set_title(col, \nfontdict={'fontsize':'15', 'fontweight':'3'}, \ncolor='#14295d', \nfontfamily='monospace')\nax1 = injuries_map_M.plot(\nax=ax1,\ncolumn=col,\ncmap='Reds',\nlabel='',\nlegend=True,\ncategorical=False\n).axis('off')\n\nax2 = fig.add_subplot(122)\ncol = 'Accident Rate Per Inhabitant By Region F'\nax2.set_title(col, \nfontdict={'fontsize':'15', 'fontweight':'3'}, \ncolor='#14295d', \nfontfamily='monospace')\nax2 = injuries_map_F.plot(\nax=ax2,\ncolumn=col,\ncmap='Reds',\nlabel='',\nlegend=True,\ncategorical=False\n).axis('off')\nplt.show()","bfbb4fbe":"df.DegreeOfImpairment.nunique()","397b1ca2":"severity_of_injuries_by_region = pd.DataFrame(merge.groupby(['Region','DegreeOfImpairment']).size())","fff21ac4":"severity_of_injuries_by_region.reset_index(level=0, inplace=True)\nseverity_of_injuries_by_region.reset_index(level=0, inplace=True)","1d9061f5":"severity_of_injuries_by_region.columns = ['DegreeOfImpairment', 'Region', 'Number of Injuries']","1bc7ed84":"df_total_injuries = severity_of_injuries_by_region.groupby(['Region']).sum()","4ee5371a":"df_total_injuries.reset_index(level=0, inplace=True)","015f1561":"df_total_injuries.columns = ['Region', 'Total DegreeOfImpairment', 'Total Number of Injuries']","55440c65":"severity_of_injuries_by_region_total = pd.merge(severity_of_injuries_by_region, df_total_injuries, on='Region' , how='left')","746fe0ce":"severity_of_injuries_by_region_total['Weighted Average Injury Severity'] = severity_of_injuries_by_region_total['Total Number of Injuries']","12d06eb7":"for Region in severity_of_injuries_by_region_total.Region.drop_duplicates():\n    severity_of_injuries_by_region_total['Weighted Average Injury Severity'][severity_of_injuries_by_region_total.Region == Region] = (severity_of_injuries_by_region_total['DegreeOfImpairment'][severity_of_injuries_by_region_total.Region == Region] * severity_of_injuries_by_region_total['Number of Injuries'][severity_of_injuries_by_region_total.Region == Region]).sum()\/(severity_of_injuries_by_region_total['Number of Injuries'][severity_of_injuries_by_region_total.Region == Region]).sum()","b2f60280":"severity_injuries_map = injuries_map","26935f41":"final_df = pd.concat([severity_of_injuries_by_region_total.Region, severity_of_injuries_by_region_total['Weighted Average Injury Severity']], axis = 1)","566ebc86":"final_df = final_df.drop_duplicates()","38e94036":"dct = final_df.set_index('Region').to_dict()","36ff5cc0":"res = dict(ele for sub in dct.values() for ele in sub.items())","3f293e64":"severity_injuries_map['Weighted Average Injury Severity'] = severity_injuries_map['Region']\nseverity_injuries_map['Weighted Average Injury Severity'] = severity_injuries_map['Weighted Average Injury Severity'].map(res)","6532ddba":"fig, ax = plt.subplots(1, figsize=(10, 10))\ncol = 'Weighted Average Injury Severity'\nax.set_title(\ncol, \nfontdict={'fontsize':'15', 'fontweight':'3'}, \ncolor='#14295d', \nfontfamily='monospace')\nseverity_injuries_map.plot(\nax=ax,\ncolumn=col,\ncmap='Reds',\nlabel='',\nlegend=True,\ncategorical=False\n).axis('off')","936f17bd":"fig = plt.figure(figsize=(20,8))\n\nax1 = fig.add_subplot(121)\nax1 = data.DegreeOfImpairment[data.Region == 'Calabria'].hist(bins = 50)\nax1.set_title('Degree of Impairment Calabria')\n\nax2 = fig.add_subplot(122)\nax2 = data.DegreeOfImpairment[data.Region == 'Trentino-Alto Adige'].hist(bins = 50)\nax2.set_title('Degree of Impairment Trentino-Alto Adige')\nplt.show()","30a2c253":"fig = plt.figure(figsize=(20,8))\n\nax1 = fig.add_subplot(121)\nax1 = data.DegreeOfImpairment[(data.Region == 'Calabria')&(data.DegreeOfImpairment!=-1)].hist(bins = 50)\nax1.set_title('Degree of Impairment Calabria')\n\nax2 = fig.add_subplot(122)\nax2 = data.DegreeOfImpairment[(data.Region == 'Trentino-Alto Adige')&(data.DegreeOfImpairment!=-1)].hist(bins = 50)\nax2.set_title('Degree of Impairment Trentino-Alto Adige')\nplt.show()","b42cdecb":"Let's add some ISTAT information related to male and female employment rates in different regions and population","06497d07":"Let's see the difference in degree of impairment for two random regions, Trentino-Alto Adige and Calabria","7db75411":"Let's take from istat some information related to regions:","cc98789f":"<a id='five'><\/a>\n## Injury Rate per Inhabitant per Gender by Region","2f1e201d":"Region names must be the same for both files:","c3970106":"<a id='six'><\/a>\n## Average Degree of Impairment by Region","b7a28faf":"<a id='load'><\/a>\n## Data Loading and Cleaning","05f8f581":"<div style='color:white;background-color:#ff6b40; height: 100px; border-radius: 25px;'><h1 style='text-align:center;padding: 3%'>Geospatial EDA Italian Injuries Data<\/h1><\/div>","0dc5b592":"Let's remove the -1 to make the graph clearer:","b9ed5b09":"<a id='one'><\/a>\n## Number of Injuries per Province","a98e6e46":"<a id='data_information'><\/a>\n## Datasets Information","504b8620":"<a id='two'><\/a>\n## Number of Injuries per Region","90cc9b59":"<a id='three'><\/a>\n## Injury Rate per Inhabitant by Region","bbaade42":"<a id='four'><\/a>\n## Number of Injuries per Gender by Region","6509d93c":"## Table of Contents\n* [Datasets Information](#data_information)\n* [Data Loading and Cleaning](#load)\n* [Number of Injuries per Province](#one)\n* [Number of Injuries per Region](#two)\n* [Injury Rate per Inhabitant by Region](#three)\n* [Number of Injuries per Gender by Region](#four)\n* [Injury Rate per Inhabitant per Gender by Region](#five)\n* [Average Degree of Impairment by Region](#six)","d9fb0485":"\nThis dataset was collected from INAIL's open data. The data refer to workplace accidents of the last 5 years in Italy. Some exploratory analyses have been carried out"}}