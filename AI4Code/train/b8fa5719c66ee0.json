{"cell_type":{"5a77f63c":"code","67cba21f":"code","e789f65a":"code","6e65fd1c":"code","11821bff":"code","3d476b0c":"code","78e378d5":"code","e876703a":"code","d42cb9d9":"code","4511c2d0":"code","acbfe20c":"code","c44ff0df":"code","800c8e22":"code","c1ca3dcc":"code","41bb6ea6":"code","6b83637c":"code","266754f1":"code","ec12d596":"code","959a24a5":"code","2c73cc35":"code","c4796583":"code","6ea198ea":"code","86812024":"code","a077ca88":"code","5277e95e":"markdown","ffae5390":"markdown","6a272077":"markdown","2d5dbec0":"markdown","812c10f4":"markdown","d1086b44":"markdown","bcac2bc3":"markdown","5c1a519b":"markdown","4f5c6fc0":"markdown","4c1675ca":"markdown","a67fc79b":"markdown","dba3b483":"markdown","293693b9":"markdown","9948e72d":"markdown","dc479788":"markdown","2e2ecb69":"markdown","cca27a8d":"markdown","f67486e0":"markdown","a9ee3319":"markdown","aa328cb7":"markdown","4ef74318":"markdown","984757a8":"markdown","77075ab0":"markdown"},"source":{"5a77f63c":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport plotly.figure_factory as ff\nimport plotly.graph_objects as go\nimport statsmodels.api as sm\nimport math\nfrom collections import defaultdict\nfrom plotly.subplots import make_subplots\nfrom scipy.stats import skew, kstest, skewtest, boxcox, probplot, norm\nfrom scipy.special import inv_boxcox\n\nimport warnings\nwarnings.simplefilter(action='ignore', category=FutureWarning)\nwarnings.simplefilter(action='ignore', category=UserWarning)","67cba21f":"df = pd.read_csv(\"..\/input\/company-sales\/company.csv\")\ndf.head()","e789f65a":"df.shape","6e65fd1c":"df.info()","11821bff":"df.describe()","3d476b0c":"fig = make_subplots(rows=2, cols=2)\n\ntrace0 = go.Histogram(x=df['TV'], name='TV')\ntrace1 = go.Histogram(x=df['Radio'], name='Radio')\ntrace2 = go.Histogram(x=df['Newspaper'], name='Newspaper')\ntrace3 = go.Histogram(x=df['Sales'], name='Sales')\n\nfig.append_trace(trace0, 1, 1)\nfig.append_trace(trace1, 1, 2)\nfig.append_trace(trace2, 2, 1)\nfig.append_trace(trace3, 2, 2)\n\nfig.show()","78e378d5":"df.corr().style.background_gradient(cmap='coolwarm')","e876703a":"fig = go.Figure()\n\nfor c in df.columns:\n        fig.add_trace(go.Box(\n            y=df[c], name=c))\n        \nfig.show()","d42cb9d9":"df[df == 0] = 0.1\ndf_2 = df.copy()","4511c2d0":"def boxCox(df):\n    params = defaultdict()\n    for c in df.columns:\n        c_transformed, param = boxcox(df[c])\n        df[c] = c_transformed\n        params[c] = param\n    return df, dict(params)","acbfe20c":"df_transformed, params = boxCox(df_2)","c44ff0df":"fig = plt.figure()\nax1 = fig.add_subplot(211)\nprob = probplot(df['Newspaper'], dist=norm, plot=ax1)\nax1.set_xlabel('')\nax1.set_title('Probplot of Newspaper against normal distribution')\n\nax2 = fig.add_subplot(212)\nprob = probplot(df_transformed['Newspaper'], dist=norm, plot=ax2)\nax2.set_title('Probplot of Newspaper after Box-Cox transformation')\n\nplt.show()","800c8e22":"y = df_transformed['Sales']\nX = df_transformed[['TV', 'Newspaper', 'Radio']]\nX = sm.add_constant(X)\n\nfrom sklearn.model_selection import train_test_split\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)","c1ca3dcc":"results = sm.OLS(y_train, X_train).fit()\nprint(results.summary()) ","41bb6ea6":"y = df_transformed['Sales']\nX = df_transformed[['TV', 'Radio']]\nX = sm.add_constant(X)\n\nfrom sklearn.model_selection import train_test_split\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)","6b83637c":"results = sm.OLS(y_train, X_train).fit()\nprint(results.summary()) ","266754f1":"y_cox = results.predict(X_test)","ec12d596":"y_inv = inv_boxcox(y_cox, params['Sales'])","959a24a5":"residuals = y_inv - y_test","2c73cc35":"import plotly.express as px\n\nfig = px.scatter(residuals, trendline=\"ols\", title='Distribution of residuals')\nfig.show()","c4796583":"skewtest(residuals)","6ea198ea":"residuals_norm = (residuals - residuals.mean())\/residuals.std()\nkstest(residuals_norm, 'norm')","86812024":"fig = go.Figure()\n\ntrace0 = go.Scatter(y=y_test, name='real')\ntrace1 = go.Scatter(y=y_inv, name='predicted')\n\nfig.add_trace(trace0)\nfig.add_trace(trace1)\n\nfig.update_layout(\n    title={\n        'text': \"Sales amount\"})\nfig.show()","a077ca88":"from sklearn.metrics import r2_score\n\nr2_score(y_test, y_inv)","5277e95e":"# Making predictions","ffae5390":"Boxplot shows two outliers in Newspaper, but this can happen simply because of highly skewed distribution.","6a272077":"Now all features are important to a model.","2d5dbec0":"So, our model have met all of four assumptions associated with a linear regression model:\n\n1. Linearity: The relationship between X and the mean of Y is linear.\n2. Homoscedasticity: The variance of residual is the same for any value of X.\n3. Independence: Observations are independent of each other.\n4. Normality: For any fixed value of X, Y is normally distributed.","812c10f4":"# Regression analysis","d1086b44":"The results show that the given model got an F-statistic score of 426.4 compared to the intercept-only model (only bias - const) - it is much higher than F-critical score for degreses of freedom equal to 136 and 3. P-value of F-statistic is very small. It means that we can reject H0 and the independent variables are jointly significant in explaining the variance of the dependent variable - the model have good quality.\n\nR^2 value (90%) is the amount of the variation of Sales which is predictable from the input independent variables.\n\nNull hypotesis of p-value > t: weight values of features are not equal to zero. The Newspaper p-value is 0.160 > 0.05, so we can exclude it.","bcac2bc3":"Seems like residuals are really close to normal distribution, but still we need some testing.\n\nSkewtest tests the null hypothesis that the skewness of the population that the sample was drawn from is the same as that of a corresponding normal distribution.","5c1a519b":"'Newspaper' looks more like exponential distribution, and other columns are also not exactly normally distributed.","4f5c6fc0":"From BoxCox we get transformed df and dict of used alpha params for furhter inverse transformation.","4c1675ca":"Get original value of Sales with alpha-parameter:","a67fc79b":"With of p-value = 0.09 > 0.05, the skewtest does not reject the hypothesis that the sample (residuals) came from the normal distribution.\n\nKstest tests the null hypothesis that the two distributions are identical (compares with 'norm' with 0 mean, 1 std; so normalization needed).","dba3b483":"In order to do linear regression analysis and achieve homoscedasticity of residuals we need our data normalized. Best option here is BoxCox transformation. We can take the whole df, because all features have continuous values.","293693b9":"We can see that spendings on TV advertisment are higly correlated with Sales, so that feature can be the most important. Radio might be the second important feature, but Newspaper influence is questionable.","9948e72d":"Let's look at the data:","dc479788":"With of p-value = 0.66 > 0.05, the K-S test does not reject the hypothesis that the sample came from the normal distribution.\n\nSo, we cannot reject the H0 hypothesis that residuals are normally distributed.","2e2ecb69":"# Residuals analysis","cca27a8d":"It's time to check residuals distribution and predictions:","f67486e0":"Let's use statmodels OLS regression (Ordinary Least Squares) for modeling.","a9ee3319":"# EDA","aa328cb7":"Seems like the top advertisement fields (by costs) are:\n\n1. TV\n2. Newspapers\n3. Radio\n\nAnd that makes perfect sense.","4ef74318":"And that means model (includes costs of TV and Radio advertisements) explained 76% of variety in Sales amount.","984757a8":"# Data preparation","77075ab0":"Data shows the sales amount generated for various companies after advertising through three main forms."}}