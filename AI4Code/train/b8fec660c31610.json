{"cell_type":{"0f566a70":"code","b9bdbaca":"code","e30d053f":"code","7b649e71":"code","3769038a":"code","0f2378b7":"code","44d3393b":"code","326f3429":"code","75a5c922":"code","ce910900":"code","73967130":"code","ed28bc1c":"code","119151b2":"code","8eca7214":"code","b89d4be4":"code","62eddcfa":"code","3d3b388b":"code","f2e48a72":"markdown"},"source":{"0f566a70":"%%writefile color_left_header.py\nfrom IPython.display import display,HTML\nfrom IPython.core.magic import register_line_magic\nimport random\n\n@register_line_magic\ndef left_header(params):\n    params=params.split('|'); string=params[0]\n    if len(params)==1: font_size=24; font_family='Ewert'\n    elif  len(params)==2: font_size=int(params[1]); font_family='Ewert' \n    else: font_size=int(params[1]); font_family=params[2]\n    width=650; height=font_size*2.5\n    randi=str(random.uniform(0,9999999))\n    html_str=\"\"\"\n    <head><script src='https:\/\/d3js.org\/d3.v6.min.js'><\/script>\n    <\/head><style>@import 'https:\/\/fonts.googleapis.com\/css?family=\"\"\"+\\\n    font_family+\"\"\"&effect=3d'; #colorized1 {font-family:\"\"\"+font_family+\\\n    \"\"\"; color:white; padding-left:10px; font-size:\"\"\"+str(font_size)+\\\n    \"\"\"px;}<\/style><h1 id='colorized1' class='font-effect-3d'>\"\"\"+string+\\\n    \"\"\"<\/h1><script>\n    var tc=setInterval(function(){\n        var now=new Date().getTime();\n        var iddoc1=document.getElementById('colorized1');\n        iddoc1.style.color=d3.interpolateRainbow(now\/20000); },1)\n    <\/script>\"\"\"\n    file='d3header'+randi+'.html'\n    with open(file,'w') as f:\n         f.write(html_str); f.close()\n    string=\"\"\"<div id='html_string\"\"\"+randi+\\\n    \"\"\"'><iframe src='\"\"\"+file+\\\n    \"\"\"' height=\"\"\"+str(height)+\"\"\" width=\"\"\"+str(width)+\\\n    \"\"\" style='display:block;'><\/iframe><\/div>\"\"\"\n    display(HTML(string))","b9bdbaca":"%run color_left_header.py\n%left_header Code Modules & Functions|22|Orbitron","e30d053f":"import warnings; warnings.filterwarnings('ignore')\nimport tensorflow as tf,pylab as pl\nimport pandas as pd,numpy as np,seaborn as sb\nimport tensorflow.keras.utils as tku\nfrom tensorflow.data import Dataset as tfd\nimport sklearn.model_selection as sms\nimport tensorflow_datasets as tfds\nimport tensorflow.image as tfim\nfrom IPython.display import display,HTML\nfrom IPython.core.magic import register_line_magic\ntfds.disable_progress_bar()","7b649e71":"def phtml(str):\n    display(HTML(\"\"\"<style>\n    @import 'https:\/\/fonts.googleapis.com\/css?family=Aladin&effect=3d-float';      \n    <\/style><h1 class='font-effect-3d-float' \n    style='font-family:Smokum; color:#11ff11; font-size:18px;'>\n    %s<\/h1>\"\"\"%str))\ndef preprocess(item):\n    image,label=item['image'],item['label']\n    image=tfim.convert_image_dtype(image,tf.float32)\n    image=tf.reshape(image,(-1,))\n    return {'image-pixels':image},label[...,tf.newaxis]\ndef train_input_fn(buffer_size,batch_size):\n    mnist_train=tfds.load(\n        name='mnist',split='train[0%:90%]',shuffle_files=True)\n    ds=mnist_train.map(preprocess)\n    ds=ds.shuffle(buffer_size)\n    ds=ds.batch(batch_size)\n    return ds.repeat()\ndef valid_input_fn(batch_size):\n    mnist_valid=tfds.load(\n        name='mnist',split='train[90%:100%]',shuffle_files=True)\n    ds=mnist_valid.map(preprocess)\n    ds=ds.batch(batch_size)\n    return ds\ndef test_input_fn(batch_size):\n    datasets=tfds.load(name='mnist')\n    mnist_test=datasets['test']\n    ds=mnist_test.map(preprocess)\n    ds=ds.batch(batch_size)\n    return ds\n@register_line_magic\ndef display_predict(n):\n    n=int(n)\n    fig=pl.figure(figsize=(10,8))\n    randch=np.random.choice(batch_size,size=n,replace=False)\n    for i,idx in enumerate(randch):\n        ax=fig.add_subplot(3,n\/\/3,i+1,xticks=[],yticks=[])\n        ax.imshow(bx_test[idx].reshape(img_size,img_size),\n                  cmap='rainbow')\n        pred_idx=py_test[idx]; true_idx=by_test[idx]\n        color=('#11ff11' if pred_idx==true_idx else '#ffee11')\n        ax.set_title('{} \\n({})'.format(pred_idx,true_idx),\n                     color=color)\n    pl.show()","3769038a":"%left_header Data Processing|22|Orbitron","0f2378b7":"buffer_size=1000; batch_size=16\nimg_size=28; num_epochs=20\nsteps_per_epoch=np.ceil(.9*60000\/batch_size)\nfeature_column=tf.feature_column.numeric_column(\n    key='image-pixels',shape=(img_size*img_size))","44d3393b":"ds_test=test_input_fn(batch_size)\nbx_test,by_test=[],[]\nbatch=next(iter(ds_test))\nfor j in range(batch_size):\n    by_test.append(batch[1].numpy()[j][0])\n    bx_test.append(batch[0]['image-pixels'].numpy()[j])","326f3429":"phtml('keys: %s'%batch[0].keys())\nn=np.random.randint(0,batch_size,1)[0]\nimg=bx_test[n].reshape(img_size,img_size)\npl.imshow(img,cmap='rainbow'); pl.tight_layout();\npl.title(by_test[n],fontdict={'fontsize':'xx-large'});","75a5c922":"%left_header DNN Classifiers|22|Orbitron","ce910900":"dnn_clf=tf.estimator.DNNClassifier(\n    feature_columns=[feature_column],hidden_units=[1024,196,32],\n    n_classes=10,model_dir='models\/mnist-dnn\/');","73967130":"#train without validation\n#dnn_clf.train(\n#    input_fn=lambda:train_input_fn(buffer_size,batch_size),\n#    steps=num_epochs*steps_per_epoch);","ed28bc1c":"#train with validation\ntf.estimator.train_and_evaluate(\n    dnn_clf,\n    tf.estimator.TrainSpec(\n        input_fn=lambda:train_input_fn(buffer_size,batch_size), \n        max_steps=num_epochs*steps_per_epoch),\n    tf.estimator.EvalSpec(\n        input_fn=lambda:valid_input_fn(batch_size)))","119151b2":"test_result=dnn_clf.evaluate(\n    input_fn=lambda:test_input_fn(batch_size))\nphtml(test_result)","8eca7214":"%left_header Predictions|22|Orbitron","b89d4be4":"y_test_pred=dnn_clf.predict(\n    input_fn=lambda:test_input_fn(batch_size))\npy_test=[]\nfor i in range(10000):\n    py_test.append(next(iter(y_test_pred))['class_ids'][0])","62eddcfa":"pl.figure(figsize=(10,4))\npl.scatter(\n    range(batch_size),by_test,\n    s=50,label='real data',c='#ffee11')\npl.scatter(\n    range(batch_size),py_test[:batch_size],\n    s=20,marker='*',label='predictions',c='#11ff11')\npl.tight_layout(); pl.legend();","3d3b388b":"%display_predict 15","f2e48a72":"Reading classics [Python Machine Learning 3rd Edition](https:\/\/github.com\/rasbt\/python-machine-learning-book-3rd-edition\/blob\/master\/ch14\/ch14_part3.ipynb)"}}