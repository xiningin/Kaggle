{"cell_type":{"8c1be93d":"code","ef2d600f":"code","9c875f23":"code","8f5e0551":"code","6d079fe4":"code","5f1bc553":"code","2f8dbb36":"code","7e04a208":"code","95ce84f8":"markdown","05e4f3ca":"markdown","3cf40370":"markdown","42fe84c7":"markdown","e245b423":"markdown","6e008f59":"markdown"},"source":{"8c1be93d":"import os\nimport glob\nimport regex\nimport pandas as pd\nfrom tqdm import tqdm","ef2d600f":"import re\ndef clean_text(txt):\n    return re.sub('[^A-Za-z0-9]+', ' ', str(txt).lower()).strip()","9c875f23":"def import_json(dataset):\n    files = glob.glob(f\"..\/input\/coleridgeinitiative-show-us-the-data\/{dataset}\/*.json\")\n    data = {}\n    for file in tqdm(files):\n        df = pd.read_json(file)\n        pub_id = os.path.basename(file)[:-5]\n        data[pub_id] = ' '.join(df.text)\n    return data","8f5e0551":"test = import_json('test')","6d079fe4":"df = pd.read_csv(\"..\/input\/coleridgeinitiative-show-us-the-data\/train.csv\")\ndatasets = list(df['dataset_label']) + list(df['dataset_title']) + list(df['cleaned_label'])\ndatasets = {clean_text(d) for d in datasets}","5f1bc553":"pred = []\nfor pub_id in tqdm(test.keys()):\n    # clean text\n    text = clean_text(test[pub_id])\n    # list of matching strings\n    matches = []    \n    for dataset in datasets:\n        if dataset in text:\n        #if regex.search(f\"\\\\b{dataset}\\\\b\", text):\n            matches += [dataset]\n    if 'assessment of educational progress' in text:\n        matches += ['ThisStringWillNeverMatch']\n    # append prediction\n    pred.append({'Id': pub_id, 'PredictionString': \"|\".join(matches)})","2f8dbb36":"submission = pd.DataFrame(pred)\nsubmission","7e04a208":"submission.to_csv('submission.csv', index=False)","95ce84f8":"For each publication, add to the predictions the datasets that appear in the text via exact matching.","05e4f3ca":"Save to file and submit.","3cf40370":"### Add exact matching","42fe84c7":"# Test data are NOT fully labeled (!!)\n\nThis notebook is the replication code or the discussion at:\nhttps:\/\/www.kaggle.com\/c\/coleridgeinitiative-show-us-the-data\/discussion\/233170\n\nImport some modules and define some utility functions.","e245b423":"Reshape as requested by the submission. ","6e008f59":"Existing datasets."}}