{"cell_type":{"42505b8c":"code","cbbae6d8":"code","70d1eecf":"code","82d518e4":"code","e805d43e":"code","09bcebe3":"code","209c8f98":"code","c16753aa":"code","ccc4ecb1":"code","c246ace5":"code","4807f847":"code","405325c9":"code","846ededc":"code","56038ff5":"code","49204fb8":"code","36640622":"code","af3017b4":"code","731dcce5":"code","0b182134":"code","7ec84501":"code","751e8fe5":"code","87ba06ff":"code","c67a6a41":"code","9a7ad965":"code","f1283e4f":"code","4c95ecd1":"code","a05a6ece":"code","6d7a0ac0":"code","a757a516":"code","03809328":"code","923b0d0f":"code","ca7fbd62":"code","7fb47236":"code","d1dbe500":"code","12afe323":"code","1c358fb8":"code","fc25611f":"code","97dc428e":"code","10dc50dd":"code","433689a9":"code","1b3b2ba2":"code","64bbe692":"code","37dfaea5":"code","59293c48":"code","c1dbcfab":"code","6db355dc":"code","8962308f":"code","408d7557":"code","89779014":"code","0bfbbb91":"code","63aff3ea":"code","b6a16305":"code","1dd1326b":"code","bb02d871":"code","f6627a00":"code","252212b6":"markdown","8fb810ce":"markdown","89e185e5":"markdown","a6a82b2b":"markdown","f5d230ee":"markdown","ce412ec1":"markdown","df2f06c3":"markdown","3987b217":"markdown","9bed8026":"markdown","49f0884d":"markdown","81990fc4":"markdown","5318d077":"markdown","e310d287":"markdown","1be6b43b":"markdown","d280a706":"markdown","b6645d82":"markdown","d080b757":"markdown","ac692581":"markdown","22863ed1":"markdown","f29ca30d":"markdown"},"source":{"42505b8c":"import os\nimport cv2\nimport pandas as pd\nfrom matplotlib import pyplot as plt\nimport seaborn as sns\nimport random as rd\nimport numpy as np\nfrom tensorflow import keras\nfrom sklearn.metrics import confusion_matrix,classification_report\n%matplotlib inline","cbbae6d8":"sample = cv2.imread('..\/input\/knife-vs-pistol\/Knife_vs_Pistol\/Knife\/285.jpg')\nplt.matshow(sample)\nplt.show()","70d1eecf":"knifes = os.listdir('..\/input\/knife-vs-pistol\/Knife_vs_Pistol\/Knife\/')\ni = 1\navg_rows_knife = 0\navg_cols_knife = 0\nfor knife in knifes:\n    sample = cv2.imread(f'..\/input\/knife-vs-pistol\/Knife_vs_Pistol\/Knife\/{knife}')\n    if sample is not None:\n        print(f'{i}: {knife}: {sample.shape}')\n        avg_rows_knife += sample.shape[1]\n        avg_cols_knife += sample.shape[0]\n        i += 1","82d518e4":"int(avg_rows_knife\/i), int(avg_cols_knife\/i)","e805d43e":"!ls ..\/input\/knife-vs-pistol\/Knife_vs_Pistol\/Pistol\/","09bcebe3":"Pistols = os.listdir('..\/input\/knife-vs-pistol\/Knife_vs_Pistol\/Pistol\/')\ni = 1\navg_rows_pistol = 0\navg_cols_pistol = 0\nfor pistol in Pistols:\n    sample = cv2.imread(f'..\/input\/knife-vs-pistol\/Knife_vs_Pistol\/Pistol\/{pistol}')\n    if sample is not None:\n        print(f'{i}: {pistol}: {sample.shape}')\n        avg_rows_pistol += sample.shape[1]\n        avg_cols_pistol += sample.shape[0]\n        i += 1","209c8f98":"int(avg_rows_pistol\/i),int(avg_cols_pistol\/i)","c16753aa":"(((266+250)\/\/2)+((205+187)\/\/2))\/\/2","ccc4ecb1":"!mkdir resized\n!mkdir resized\/knifes\n!mkdir resized\/pistols","c246ace5":"!ls resized","4807f847":"knifes = os.listdir('..\/input\/knife-vs-pistol\/Knife_vs_Pistol\/Knife\/')\ni = 0\nfor knife in knifes:\n    sample = cv2.imread(f'..\/input\/knife-vs-pistol\/Knife_vs_Pistol\/Knife\/{knife}')\n    if sample is not None:\n        resized = cv2.resize(sample, (227,227))\n        gray = cv2.cvtColor(resized, cv2.COLOR_BGR2GRAY)\n        cv2.imwrite(f'resized\/knifes\/{i}.jpg',gray)\n    i += 1","405325c9":"!ls resized\/knifes","846ededc":"len(os.listdir('resized\/knifes'))","56038ff5":"for i in range(5):\n    n = rd.randint(1,320)\n    k_img = cv2.imread(f'resized\/knifes\/{n}.jpg')\n    plt.matshow(k_img)\n    plt.title(n)\n    plt.show()\n    print('Shape:',k_img.shape)\n    print('\\n')","49204fb8":"pistols = os.listdir('..\/input\/knife-vs-pistol\/Knife_vs_Pistol\/Pistol\/')\n\ni = 0\nfor pistol in pistols:\n    sample = cv2.imread(f'..\/input\/knife-vs-pistol\/Knife_vs_Pistol\/Pistol\/{pistol}')\n    if sample is not None:\n        resized = cv2.resize(sample, (227,227))\n        gray = cv2.cvtColor(resized, cv2.COLOR_BGR2GRAY)\n        cv2.imwrite(f'resized\/pistols\/{i}.jpg',gray)\n    i += 1","36640622":"!ls resized\/pistols","af3017b4":"len(os.listdir('resized\/pistols'))","731dcce5":"for i in range(5):\n    n = rd.randint(1,91)\n    p_img = cv2.imread(f'resized\/pistols\/{n}.jpg')\n    plt.matshow(p_img)\n    plt.title(n)\n    plt.show()\n    print('Shape:',p_img.shape)\n    print('\\n')","0b182134":"X = []\nY= []\n\n#Knifes = 1\n#Pistols = 0\n\nfor k in os.listdir('resized\/knifes\/'):\n    data = cv2.imread(f'resized\/knifes\/{k}')\/255\n    X.append(data)\n    Y.append(1)\nfor p in os.listdir('resized\/pistols\/'):\n    data = cv2.imread(f'resized\/pistols\/{p}')\/255\n    X.append(data)\n    Y.append(0)\n","7ec84501":"model = keras.Sequential([\n    keras.layers.Conv2D(filters=227, kernel_size=(3,3), activation='relu', input_shape=(227,227,3)),\n    keras.layers.MaxPool2D((5,5)),\n    keras.layers.Conv2D(filters=227*2, kernel_size=(3,3), activation='relu'),\n    keras.layers.MaxPool2D((3,3)),\n    keras.layers.Flatten(),\n    keras.layers.Dense(227*2,activation='relu'),\n    keras.layers.Dense(1, activation='sigmoid')\n])","751e8fe5":"model.compile(\n    optimizer='adam',\n    loss='binary_crossentropy',\n    metrics=['accuracy']\n)","87ba06ff":"x = np.array(X)\ny = np.array(Y)","c67a6a41":"model.fit(x, y, epochs=5) #Ranned twice","9a7ad965":"model.evaluate(x, y)","f1283e4f":"predicted = model.predict(x).flatten()\npredicted[predicted >= 0.5] = 1\npredicted[predicted < 0.5] = 0","4c95ecd1":"cm = confusion_matrix(Y, predicted)\nplt.figure(figsize=(7,7))\nsns.heatmap(cm, annot=True,fmt='g',xticklabels=['Pistols','Knifes'],yticklabels=['Pistols','Knifes'])\nplt.title('Train Accuracy')\nplt.show()","a05a6ece":"print(classification_report(Y,predicted))","6d7a0ac0":"!ls ..\/input\/knife-vs-pistol\/Knife_vs_Pistol","a757a516":"!mkdir resized_test\n!mkdir resized_test\/knifes\n!mkdir resized_test\/pistols","03809328":"path = '..\/input\/knife-vs-pistol\/Knife_vs_Pistol\/'\nknifes_test =os.listdir(path+'eval_Knife')\npistols_test =os.listdir(path+'eval_pistol')","923b0d0f":"len(knifes_test),len(pistols_test)","ca7fbd62":"i = 0\nfor k in os.listdir('..\/input\/knife-vs-pistol\/Knife_vs_Pistol\/eval_Knife'):\n    print(k)\n    sample = cv2.imread(f'..\/input\/knife-vs-pistol\/Knife_vs_Pistol\/eval_Knife\/{k}')\n    if sample is not None:\n        resize = cv2.resize(sample,(227,227))\n        gray = cv2.cvtColor(resize, cv2.COLOR_BGR2GRAY)\n        plt.imshow(gray)\n        plt.show()\n        cv2.imwrite(f'resized_test\/knifes\/{i}.jpg',gray)\n        i += 1","7fb47236":"i = 0\nfor p in os.listdir('..\/input\/knife-vs-pistol\/Knife_vs_Pistol\/eval_pistol'):\n    print(p)\n    sample = cv2.imread(f'..\/input\/knife-vs-pistol\/Knife_vs_Pistol\/eval_pistol\/{p}')\n    if sample is not None:\n        resize = cv2.resize(sample,(227,227))\n        gray = cv2.cvtColor(resize, cv2.COLOR_BGR2GRAY)\n        plt.imshow(gray)\n        plt.show()\n        cv2.imwrite(f'resized_test\/pistols\/{i}.jpg',gray)\n        i += 1","d1dbe500":"!ls resized_test\/pistols","12afe323":"!ls resized_test\/pistols\/","1c358fb8":"Xtest = []\nYtest = []\n\n#Knifes = 1\n#Pistols = 0\n\nfor k in os.listdir('resized_test\/knifes\/'):\n    data = cv2.imread(f'resized_test\/knifes\/{k}')\/255\n    Xtest.append(data)\n    Ytest.append(1)\nfor p in os.listdir('resized_test\/pistols\/'):\n    data = cv2.imread(f'resized_test\/pistols\/{p}')\/255\n    Xtest.append(data)\n    Ytest.append(0)\n","fc25611f":"np.array(Xtest).shape","97dc428e":"Xtest2 = np.array(Xtest)\nYtest2 = np.array(Ytest)","10dc50dd":"model.evaluate(Xtest2,Ytest2)","433689a9":"test_pred = model.predict(Xtest2)\ntest_pred[test_pred >= 0.5] = 1\ntest_pred[test_pred < 0.5] = 0","1b3b2ba2":"cm2 = confusion_matrix(Ytest2, test_pred)\nplt.figure(figsize=(7,7))\nsns.heatmap(cm2, annot=True,fmt='g',xticklabels=['Pistols','Knifes'],yticklabels=['Pistols','Knifes'])\nplt.title('Test Accuracy')\nplt.show()","64bbe692":"start = 320\nfor i in range(92):\n    new_img = cv2.rotate(X[start],cv2.ROTATE_90_CLOCKWISE)\n    X.append(new_img)\n    start += 1","37dfaea5":"start = 320\nfor i in range(92):\n    new_img = cv2.rotate(X[start],cv2.ROTATE_180)\n    X.append(new_img)\n    start += 1","59293c48":"start = 320\nfor i in range(92):\n    new_img = cv2.rotate(X[start],cv2.ROTATE_90_COUNTERCLOCKWISE)\n    X.append(new_img)\n    start += 1","c1dbcfab":"len(X)","6db355dc":"689-412","8962308f":"Y += [0 for i in range(277)]\nlen(Y)","408d7557":"model = keras.Sequential([\n    keras.layers.Conv2D(filters=227, kernel_size=(3,3), activation='relu', input_shape=(227,227,3)),\n    keras.layers.MaxPool2D((5,5)),\n    keras.layers.Conv2D(filters=227*2, kernel_size=(3,3), activation='relu'),\n    keras.layers.MaxPool2D((3,3)),\n    keras.layers.Flatten(),\n    keras.layers.Dense(227*2,activation='relu'),\n    keras.layers.Dense(1, activation='sigmoid')\n])","89779014":"model.compile(\n    optimizer='adam',\n    loss='binary_crossentropy',\n    metrics=['accuracy']\n)","0bfbbb91":"x = np.array(X)\ny = np.array(Y)\nmodel.fit(x, y, epochs=5)","63aff3ea":"model.fit(x, y, epochs=5)","b6a16305":"model.fit(x, y, epochs=5,batch_size=5)","1dd1326b":"model.evaluate(Xtest2,Ytest2)","bb02d871":"test_pred = model.predict(Xtest2)\ntest_pred[test_pred >= 0.5] = 1\ntest_pred[test_pred < 0.5] = 0\ncm2 = confusion_matrix(Ytest2, test_pred)\nplt.figure(figsize=(7,7))\nsns.heatmap(cm2, annot=True,fmt='g',xticklabels=['Pistols','Knifes'],yticklabels=['Pistols','Knifes'])\nplt.title('Test Accuracy')\nplt.show()","f6627a00":"print(classification_report(Ytest2,test_pred))","252212b6":"# **Visualizing 5 random pistol resized images**","8fb810ce":"### **Let's Up Sample Pistol Images by adding rotational pistol images**","89e185e5":"# **Pistol Shapes**","a6a82b2b":"# **Average Size of Pistol**","f5d230ee":"# **Check Resized Images**","ce412ec1":"# **CNN Model Building and Predictions**","df2f06c3":"# **Resizing Pistol images**","3987b217":"# **Resizing Knife images**","9bed8026":"# **Data Preparation**","49f0884d":"# **Append Y Samples as well**","81990fc4":"# **Resizing the images by taking the average of Knife and Pistols.**","5318d077":"# **Average Size of Knife**","e310d287":"# **Knife shapes**","1be6b43b":"# **We have to resize all the images into (227, 227)**","d280a706":"# **Predicions on Test Data**","b6645d82":"# **Rotate 180 degrees**","d080b757":"# **Rotate 90 degrees**","ac692581":"# **Visualizing 5 random knife resized images**","22863ed1":"# **Check Resized Pistols**","f29ca30d":"# **OverFitted**"}}