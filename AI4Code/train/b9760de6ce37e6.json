{"cell_type":{"6e3aade2":"code","ed743184":"code","49a6bd6d":"code","b57cf636":"code","39574894":"code","dbe06352":"code","3c2f9f42":"code","16918ba1":"code","c051f88c":"code","c32b4544":"code","13d3a196":"code","45f1a93d":"code","9a69e977":"code","4d741db3":"code","bd2f8cac":"code","28d7f02b":"markdown","a2a07fb8":"markdown","e85836d3":"markdown","83a0ce7b":"markdown","4ec3f991":"markdown","7efb3ba5":"markdown","ecea2bc4":"markdown","278eda57":"markdown","4077e0f4":"markdown","5b5a5272":"markdown","bcaac600":"markdown","fc8c4cb0":"markdown","cda9d8c5":"markdown","c40dfb5d":"markdown"},"source":{"6e3aade2":"import os\nimport cv2\nimport numpy as np\nimport pandas as pd\nimport tensorflow as tf\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom PIL import Image\nfrom tensorflow.keras.layers import Dropout, Activation, Input, GlobalAveragePooling2D, Dense\nfrom tensorflow.keras.models import Model\nfrom tensorflow.keras.preprocessing.image import ImageDataGenerator\nfrom tensorflow.keras.applications import InceptionResNetV2\nfrom tensorflow.keras.applications.inception_resnet_v2 import preprocess_input","ed743184":"training_folder = '..\/input\/riceleafs\/RiceLeafs\/train'\nvalidation_folder = '..\/input\/riceleafs\/RiceLeafs\/validation'","49a6bd6d":"brownspot = [training_folder + '\/BrownSpot\/' + img for img in os.listdir(training_folder + '\/BrownSpot')[:9]]\nhealthy = [training_folder + '\/Healthy\/' + img for img in os.listdir(training_folder + '\/Healthy')[:9]]\nhispa = [training_folder + '\/Hispa\/' + img for img in os.listdir(training_folder + '\/Hispa')[:9]]\nleafblast = [training_folder + '\/LeafBlast\/' + img for img in os.listdir(training_folder + '\/LeafBlast')[:9]]","b57cf636":"plt.figure(figsize=(16,16))\nfor i,k  in enumerate(brownspot):\n    image = Image.open(k)\n    plt.subplot(3,3,i+1)\n    plt.imshow(image)\n    plt.title(\"Brown Spot\")","39574894":"plt.figure(figsize=(16,16))\nfor i,k  in enumerate(hispa):\n    image = Image.open(k)\n    plt.subplot(3,3,i+1)\n    plt.imshow(image)\n    plt.title(\"Hispa\")","dbe06352":"plt.figure(figsize=(16,16))\nfor i,k  in enumerate(leafblast):\n    image = Image.open(k)\n    plt.subplot(3,3,i+1)\n    plt.imshow(image)\n    plt.title(\"Leaf Blast\")","3c2f9f42":"plt.figure(figsize=(16,16))\nfor i,k  in enumerate(healthy):\n    image = Image.open(k)\n    plt.subplot(3,3,i+1)\n    plt.imshow(image)\n    plt.title(\"Healthy\")","16918ba1":"batch_size = 10\nimage_size = 300\ninput_shape = (image_size, image_size, 3)\ndropout_rate = 0.3","c051f88c":"train_datagen = ImageDataGenerator(\n        rescale=1.\/255,\n        horizontal_flip=True,\n        vertical_flip=True,\n        fill_mode = 'nearest',\n        channel_shift_range=0.5,\n        brightness_range=[0.5,1.2],\n        rotation_range=25,\n        zoom_range=[0.5, 1],\n        )\nvalidation_datagen = ImageDataGenerator(rescale=1.\/255, \n                                        horizontal_flip = True,\n                                        vertical_flip = True,\n                                        fill_mode = \"nearest\")","c32b4544":"train_datagenerator = train_datagen.flow_from_directory(\n        training_folder,\n        target_size=(image_size, image_size),\n        shuffle=True,\n        batch_size=batch_size,\n        class_mode='categorical')\nvalidation_datagenerator = validation_datagen.flow_from_directory(\n        validation_folder,\n        target_size=(image_size, image_size),\n        shuffle=True,\n        batch_size=batch_size,\n        class_mode='categorical') ","13d3a196":"# This function will plot images in the form of a grid with 3 row and 3 columns where images are placed in each column.\ndef plotImages(images_arr):\n    fig, axes = plt.subplots(3, 3, figsize=(16,16))\n    axes = axes.flatten()\n    for img, ax in zip( images_arr, axes):\n        ax.imshow(img)\n    plt.tight_layout()\n    plt.show()\n    \naugmented_images = [train_datagenerator[0][0][0] for i in range(9)]\nplotImages(augmented_images)","45f1a93d":"def create_model():\n    resnet= InceptionResNetV2(weights=\"imagenet\", \n                                   include_top=False, \n                                   input_shape=input_shape, \n                                   )\n\n\n    input_layer = Input(shape = input_shape)\n    preprocess = preprocess_input(input_layer)\n    efficientnet = resnet(preprocess)\n    pooling = GlobalAveragePooling2D()(efficientnet)\n    dropout = Dropout(dropout_rate)(pooling)\n    outputs = Dense(4, activation=\"softmax\")(dropout)\n    model = Model(inputs=input_layer, outputs=outputs)\n\n    return model\nmodel = create_model()\nmodel.summary()","9a69e977":"epochs = 10\ndecay_steps = int(np.ceil(train_datagenerator.n \/ float(batch_size)))*epochs\ncosine_decay = tf.keras.experimental.LinearCosineDecay(initial_learning_rate=1e-4, decay_steps=decay_steps, alpha=0.3)\ncallbacks = [tf.keras.callbacks.ModelCheckpoint(filepath='best_rice_disease_model.h5', monitor='val_loss', save_best_only=True)]\nmodel.compile(loss=tf.keras.losses.CategoricalCrossentropy(), optimizer=tf.keras.optimizers.Adam(cosine_decay), metrics=[\"accuracy\"])","4d741db3":"# Fitting models to the generators\nhistory = model.fit(\n    train_datagenerator,\n    steps_per_epoch=int(np.ceil(train_datagenerator.n \/ float(batch_size))),\n    epochs=epochs,\n    validation_data=validation_datagenerator,\n    validation_steps=int(np.ceil(validation_datagenerator.n \/ float(batch_size)))\n)","bd2f8cac":"plt.plot(history.history['accuracy'])\nplt.plot(history.history['val_accuracy'])\nplt.title('Accuracy over epochs')\nplt.ylabel('Accuracy')\nplt.xlabel('Epoch')\nplt.legend(['Train', 'Validation'], loc='best')\nplt.show()","28d7f02b":"# Exploratory data analysis on the dataset","a2a07fb8":"## How to Identify Brown Spot \n\nCheck for lesions:\n* Infected seedlings have small, circular, yellow brown or brown lesions that may girdle the coleoptile and distort primary and secondary leaves.\n* Starting at tillering stage, lesions can be observed on the leaves. They are initially small, circular, and dark brown to purple-brown.\n* Fully developed lesions are circular to oval with a light brown to gray center, surrounded by a reddish brown margin caused by the toxin produced by the fungi.","e85836d3":"## Prepare the training and validation data generators","83a0ce7b":"## Brown Spot: What is brown spot disease and why it occurs? \n\nBrown spot is a fungal disease that infects the coleoptile, leaves, leaf sheath, panicle branches, glumes, and spikelets. \nThe disease can develop in areas with high relative humidity (86\u2212100%) and temperature between 16 and 36\u00b0C. It is common in unflooded and nutrient-deficient soil, or in soils that accumulate toxic substances. \n\nFor infection to occur, the leaves must be wet for 8\u221224 hours.\n\nThe fungus can survive in the seed for more than four years and can spread from plant to plant through air. Major sources of brown spot in the field include:\n\n* infected seed, which give rise to infected seedlings\n* volunteer rice\n* infected rice debris\n* weeds","4ec3f991":"# Preparing Data and Building Classification Model  ","7efb3ba5":"## How to Identify?\nCheck the leaf and collar for lesions:\n\n* Initial symptoms appear as white to gray-green lesions or spots, with dark green borders.\n* Older lesions on the leaves are elliptical or spindle-shaped and whitish to gray centers with red to brownish or necrotic border.","ecea2bc4":"## Importing Libraries","278eda57":"## Hispa: What is Hispa disease and why it occurs?\nRice hispa scrapes the upper surface of leaf blades leaving only the lower epidermis.\nThe presence of grassy weeds in and near rice fields as alternate hosts harbor and encourage the pest to develop. Heavily fertilized field also encourages the damage.\n\nHeavy rains, especially in premonsoon or earliest monsoon periods, followed by abnormally low precipitation, minimum day-night temperature differential for a number of days, and high RH are favorable for the insect\u2019s abundance.","4077e0f4":"# Exploratory Data Analysis and   Rice Disease Classification using Tensorflow and Keras\n\nIn this notebook, I am going to perform exploratory data analysis and build a model to classify rice diseases from the rice-diseases-image-dataset.","5b5a5272":"Now, I will check, how my model performed on similar level on both the training and validation. The training curve will also tel, if I stopped training too early or may have overfitted in comparison to the validation data.","bcaac600":"## Leaf Blast: What is Leaf Blast and Why it occurs?\n\nBlast is caused by the fungus Magnaporthe oryzae. It can affect all above ground parts of a rice plant.\nBlast can occur wherever blast spores are present.\n\nIt occurs in areas with low soil moisture, frequent and prolonged periods of rain shower, and cool temperature in the daytime. In upland rice, large day-night temperature differences that cause dew formation on leaves and overall cooler temperatures favor the development of the disease.","fc8c4cb0":"## How to identify Hispa disease?\nCheck for feeding damage:\n\n* scraping of the upper surface of the leaf blade leaving only the lower epidermis as white streaks parallel to the midrib\n* irregular translucent white patches that are parallel to the leaf veins caused by tunneling of larvae through leaf tissue causes\n* withering of damaged leaves\n* whitish and membranous leaves","cda9d8c5":"## Healthy:","c40dfb5d":"## Building Model\n\nI am using an InceptionResNet on rice disease classes."}}