{"cell_type":{"cabfd76c":"code","54269e4d":"code","78b197ee":"code","98dacd41":"code","6618d5a9":"code","65a5b069":"code","6334feee":"code","5414b607":"code","e77b0435":"code","70aa5553":"code","4694c2fc":"code","3dfb66d9":"code","5d4a2998":"code","7ac1bec7":"markdown","05f73f00":"markdown","a07fba66":"markdown","a76a6ec4":"markdown","b141fbd6":"markdown","996f10c6":"markdown","20a770c3":"markdown","0c569906":"markdown","cf125b76":"markdown"},"source":{"cabfd76c":"import numpy as np\nimport pandas as pd\npd.set_option('display.max_columns', 500)\npd.set_option('display.max_rows', 500)\n\nimport seaborn as sns\nimport sklearn\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nimport h2o\n\nprint(\"seaborn\", sns.__version__)\nprint(\"pandas\", pd.__version__)\n\nfrom pathlib import Path\n\nPATH = Path.cwd().parent\nDATA_PATH = \"..\/input\/tabular-playground-series-apr-2021\/\"\nSEED = 42","54269e4d":"h2o.init(min_mem_size=\"15G\")","78b197ee":"train = h2o.import_file(DATA_PATH + \"train.csv\")\nprint(train.shape)\ntrain.head()","98dacd41":"train.describe()","6618d5a9":"target = \"Survived\"\n\nremove = ['PassengerId', 'Ticket', 'Cabin']\nnum_cols = ['Age', 'SibSp', 'Parch', 'Fare']\ntext_cols = ['Name']\ncat_cols = ['Sex', 'Embarked', 'Pclass']\nfeatures = num_cols + cat_cols + text_cols\n\nprint(\"missing\", [f for f in train.columns if f not in features + remove + [target]])\nprint(\"not founded\", [f for f in features + remove + [target] if f not in train.columns])\nprint(\"features\", len(features), features)","65a5b069":"dfs = {\"train\":train}\nfor key in dfs:\n    print(\"--------\", key, dfs[key].shape, \"--------\")\n    for col in features:\n        print(col, dfs[key][col].isna().sum())","6334feee":"from sklearn.preprocessing import KBinsDiscretizer\n\ndef mk_discrete_values(hdf, col, n_bins=10, sufix=\"_disc\"):\n    discretizer = KBinsDiscretizer(n_bins=n_bins, encode=\"ordinal\")\n    discrete_values = discretizer.fit_transform(hdf[col].as_data_frame().values)\n    hdf[col+sufix] = h2o.H2OFrame(discrete_values.reshape(-1))\n    return hdf\n\ndef mk_imputation(hdf, col, by, method=\"median\"):\n    _ = hdf.impute(col, method=method, by=by)    \n    return hdf\n\n# split names\ndef get_names(hdf):\n    names = hdf[\"Name\"].strsplit(\",\")\n    names.columns = [\"Last_Name\", \"First_Name\"]\n    hdf = hdf.cbind(names)\n    return hdf\n\ndef preprocess(hdf, as_trainning=True):\n    # ensure the categorical variables\n    hdf[cat_cols] = hdf[cat_cols].asfactor()\n    if as_trainning:\n        hdf[target] = hdf[target].asfactor()\n        \n    \n    # some imputation\n    imputation = {\"Age\":[\"Pclass\", \"Sex\"], \"Fare\":[\"Pclass\"]}\n    for keys in imputation:\n        hdf = mk_imputation(hdf, keys, imputation[keys])\n        \n    hdf = mk_discrete_values(hdf, \"Fare\")\n    hdf = mk_imputation(hdf, \"Embarked\", [\"Pclass\", \"Fare_disc\"])\n    \n    hdf = get_names(hdf)\n    \n    return hdf\n\ntrain = preprocess(train)","5414b607":"train[features].describe()","e77b0435":"from h2o.automl import H2OAutoML\n\nfeatures.remove(\"Name\")\nfeatures.append(\"Last_Name\")\n\naml = H2OAutoML(max_runtime_secs = 6 * 3600,\n                seed = SEED, \n                stopping_metric ='logloss', \n                sort_metric ='logloss', \n                max_models=100)\n\naml.train(x=features, y=target, training_frame=train)\n\nlb = aml.leaderboard \nlb.head()","70aa5553":"test = h2o.import_file(DATA_PATH + \"test.csv\")\nprint(test.shape)\ntest.head()\n\ntest = preprocess(test, False)","4694c2fc":"predictions = aml.leader.predict(test)\npredictions","3dfb66d9":"submission = pd.concat([test.as_data_frame()[\"PassengerId\"],\n                        predictions.as_data_frame()[\"predict\"]], axis=1)\nsubmission.columns = [\"PassengerId\", target]\nsubmission.head()","5d4a2998":"submission.to_csv(\"submission.csv\", index=False)","7ac1bec7":"# Basic Stats","05f73f00":"# Check Nulls","a07fba66":"# Features","a76a6ec4":"# Libraries","b141fbd6":"# Tabular Playground Series - Apr-2021\nhttps:\/\/www.kaggle.com\/c\/tabular-playground-series-apr-2021","996f10c6":"# Submission","20a770c3":"# Load the Data","0c569906":"# Preprocessing","cf125b76":"# Model"}}