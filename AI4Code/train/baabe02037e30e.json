{"cell_type":{"d22c1b54":"code","7db4b82d":"code","f87b3486":"code","69495555":"code","68fc07aa":"code","10f3e202":"code","865ed05f":"code","d4a44395":"code","8010c019":"code","9c3d7e96":"code","2e4f3f75":"code","a8beac87":"code","1e4bbf4b":"code","6cecf562":"code","942a439c":"code","8f4ed50d":"code","a4d33f6a":"code","b24454d4":"code","5f9fa3a9":"code","23533543":"code","c5e48fd7":"code","2408f72c":"code","2b47ce2f":"code","1e3615cd":"code","33bd5f23":"code","e6eb7c79":"code","9c77ccc4":"code","eac7ecb5":"code","9fbac0c6":"code","c948b716":"code","40d2d62c":"code","30e92564":"code","d0993bf7":"code","fad701d4":"code","7a1ab5a8":"code","851f5968":"code","a4d0688b":"code","3e2721f4":"code","b4cbc275":"code","46d2bc69":"code","9062ea55":"code","cff079c6":"code","ef9724d6":"code","7edf830a":"code","5bd921e3":"code","d8736b70":"code","58897aa5":"code","cd0b3aaf":"code","62e48530":"markdown","57bd3d67":"markdown"},"source":{"d22c1b54":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os,sys\nprint(os.listdir(\"\/kaggle\/\"))\n\n# Any results you write to th5,\/45,,,,,,e current directory are saved as output.","7db4b82d":"os.listdir('\/kaggle\/working')","f87b3486":"%matplotlib inline\nfrom fastai import *\nfrom fastai.vision import *\nfrom fastai.widgets import *\nimport shutil","69495555":"src = \"..\/input\/fishdataset\/FishDataset\/\"\npath = \"\/kaggle\/fishset\/FishDataset\/\"\nshutil.copytree(src, path)\n","68fc07aa":"os.listdir(path)","10f3e202":"classes = ['salmon',\n 'SardineFish',\n 'TilapiaFish',\n 'bassfish',\n 'swordfish',\n 'catfish',\n 'ArcticCharFish',\n 'haddockfish',\n 'tuna',\n 'Red-snapper']\npth = Path(path)\nfor c in classes:\n    print(c)\n    verify_images(pth\/c, delete=True, max_size=500)","865ed05f":"np.random.seed(42)\ndata = ImageDataBunch.from_folder(pth, train=\".\",test=\".\", valid_pct=0.2,\n        ds_tfms=get_transforms(), size=128, num_workers=4).normalize(imagenet_stats)\ndata","d4a44395":"# testData = \"\/kaggle\/working\/test\/\"","8010c019":"# data.test_ds[0]","9c3d7e96":"# import PIL","2e4f3f75":"# index = 0\n# for img in data.test_ds[:10]:\n#     x = image2np(img[0].data*255).astype(np.uint8)\n#     PIL.Image.fromarray(x).convert(\"RGB\").save(f\"{index}.png\")\n#     print(f\"{index}.png\")\n#     index += 1 ","a8beac87":"# os.listdir(\"\/kaggle\/working\")","1e4bbf4b":"learn = cnn_learner(data, models.resnet50, metrics=error_rate)","6cecf562":"learn.lr_find()\n","942a439c":"learn.recorder.plot()","8f4ed50d":"lr = 2e-04\nlearn.fit_one_cycle(8,slice(lr))","a4d33f6a":"learn.save('\/kaggle\/working\/stage-1')","b24454d4":"learn.unfreeze()\nlearn.lr_find()\nlearn.recorder.plot()","5f9fa3a9":"learn.fit_one_cycle(8, max_lr=slice(2e-6,2e-4))","23533543":"learn.save('\/kaggle\/working\/stage-2')","c5e48fd7":"np.random.seed(42)\ndata = ImageDataBunch.from_folder(pth, train=\".\",test=\".\", valid_pct=0.2,\n        ds_tfms=get_transforms(), size=256, num_workers=4).normalize(imagenet_stats)\ndata","2408f72c":"\nlearn.data = data\n","2b47ce2f":"learn.freeze()\nlearn.lr_find()","1e3615cd":"learn.recorder.plot()","33bd5f23":"\nlearn.fit_one_cycle(7, slice(1e-05,2e-03))","e6eb7c79":"learn.save('\/kaggle\/working\/stage2')","9c77ccc4":"learn.unfreeze()\nlearn.fit_one_cycle(7, slice(1e-05,2e-03))","eac7ecb5":"learn.save('\/kaggle\/working\/stage-2-93')","9fbac0c6":"\ndb = (ImageList.from_folder(pth)\n                   .split_none()\n                   .label_from_folder()\n                   .transform(get_transforms(), size=224)\n                   .databunch()\n     )","c948b716":"learn_cln = cnn_learner(db, models.resnet50, metrics=error_rate)\nlearn_cln.load('\/kaggle\/working\/stage-2-93')","40d2d62c":"ds, idxs = DatasetFormatter().from_toplosses(learn_cln, n_imgs = 200)","30e92564":"ImageCleaner(ds, idxs, pth)","d0993bf7":"df = pd.read_csv(pth\/'cleaned.csv', header='infer')\ndf.head()","fad701d4":"np.random.seed(42)\ndb = (ImageList.from_df(df, pth)\n                   .split_by_rand_pct(0.2)\n                   .label_from_df()\n                   .transform(size=224)\n                   .databunch(bs=64)\n                   .normalize(imagenet_stats))","7a1ab5a8":"learn = cnn_learner(db, models.resnet50, metrics=error_rate)\nlearn = learn.load('\/kaggle\/working\/stage2-93')","851f5968":"learn.freeze()","a4d0688b":"learn.lr_find()\nlearn.recorder.plot()","3e2721f4":"learn.fit_one_cycle(6, slice(1e-4,3e-3))","b4cbc275":" learn.save('\/kaggle\/working\/stage-2cleaned99')","46d2bc69":"os.listdir('\/kaggle\/working\/')","9062ea55":"\nlearn.export()","cff079c6":"img = open_image(pth\/'catfish'\/'images26.jpg')\nimg","ef9724d6":"learn = load_learner(pth)","7edf830a":"pred_class,pred_idx,outputs = learn.predict(img)\npred_class","5bd921e3":"#ds, idxs = DatasetFormatter().from_similars(learn_cln, n_imgs = 200)","d8736b70":"#ImageCleaner(ds, idxs,\"..\/fishset\/\", duplicates=True)","58897aa5":"#learn_cln.fit_one_cycle(6, max_lr=slice(1e-6,5e-4))","cd0b3aaf":"# datapath = \"..\/fishset\/Fishdata\/\" \n# np.random.seed(42)\n# data = ImageDataBunch.from_folder(datapath, train=\".\", valid_pct=0.2,\n#         ds_tfms=get_transforms(), size=224, num_workers=4).normalize(imagenet_stats)\n","62e48530":"Copy the images to the new path, as we can't make changes in input directory","57bd3d67":"Verify the images and delete the corrupted images "}}