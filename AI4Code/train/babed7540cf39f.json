{"cell_type":{"dc65b82d":"code","2772c382":"code","be335a6d":"code","9eeaf825":"code","04c7a913":"code","81000b1f":"code","e573feef":"code","87e8da8c":"code","58814fc5":"code","4ce91dfa":"code","280b7c81":"code","ade86419":"code","d339d5ad":"code","05166554":"code","1ccb17b6":"code","8f53210e":"code","a810b72f":"code","a6effbc4":"code","87edec44":"code","37e8f549":"code","295363b7":"code","b7ec21f6":"markdown","97d847bc":"markdown","2040aa98":"markdown","fc86289c":"markdown","50fdd8a2":"markdown","ccf53b8c":"markdown","4ede1948":"markdown","aaa77286":"markdown","34b77d40":"markdown","761860fa":"markdown","aaabd31e":"markdown","27e6e887":"markdown","bf8e4afc":"markdown","c6ed3681":"markdown","a1210eb2":"markdown","4cd03a9b":"markdown"},"source":{"dc65b82d":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport seaborn as sns\nsns.set_style(\"ticks\")","2772c382":"df=pd.read_csv(\"..\/input\/customer-segmentation-tutorial-in-python\/Mall_Customers.csv\")\ndf.head()","be335a6d":"df.drop([\"CustomerID\"],axis=1,inplace=True)","9eeaf825":"df[\"Gender\"]=pd.get_dummies(df[\"Gender\"],drop_first=True)\n#where 0=female and 1=male","04c7a913":"df.info()","81000b1f":"df.describe().T","e573feef":"df.isnull().sum()\n#no missing data, which is good","87e8da8c":"df.head()","58814fc5":"fig=plt.figure(figsize=(12,8))\nsns.distplot(a=df[\"Spending Score (1-100)\"],bins=40,color=\"mediumpurple\")\nplt.title(\"Customer Spending Distribution\",size=16)","4ce91dfa":"fig=plt.figure(figsize=(12,8))\n\nax1=plt.subplot2grid((2,3),(0,0),colspan=3)\nax2=plt.subplot2grid((2,3),(1,0))\nax3=plt.subplot2grid((2,3),(1,1))\nax4=plt.subplot2grid((2,3),(1,2))\n\nsns.boxplot(x=df[\"Spending Score (1-100)\"],y=df[\"Gender\"],orient=\"h\",palette={0:\"pink\",1:\"skyblue\"},ax=ax1)\n\nax2.pie(df[\"Gender\"].value_counts(),colors=[\"pink\",\"skyblue\"],labels=[\"Females\",\"Males\"])\n\nsns.distplot(a=df[\"Age\"].loc[(df[\"Gender\"]==0)],bins=20,color=\"pink\",ax=ax3)\nsns.distplot(a=df[\"Age\"].loc[(df[\"Gender\"]==1)],bins=20,color=\"skyblue\",ax=ax3)\n\nsns.distplot(a=df[\"Annual Income (k$)\"].loc[(df[\"Gender\"]==0)],bins=20,color=\"pink\",ax=ax4)\nsns.distplot(a=df[\"Annual Income (k$)\"].loc[(df[\"Gender\"]==1)],bins=20,color=\"skyblue\",ax=ax4)\n\nplt.tight_layout(pad=1,h_pad=1,w_pad=1)\nplt.suptitle(\"Gender Distribution\",y=1.01,size=16)","280b7c81":"fig=plt.figure(figsize=(12,7))\n\nax1=plt.subplot2grid((2,3),(0,0),colspan=2,rowspan=2)\nax2=plt.subplot2grid((2,3),(0,2))\nax3=plt.subplot2grid((2,3),(1,2))\n\nsns.scatterplot(x=df[\"Age\"],y=df[\"Spending Score (1-100)\"],hue=df[\"Gender\"],palette={0:\"pink\",1:\"skyblue\"},ax=ax1)\n\nsns.distplot(a=df[\"Age\"],bins=20,color=\"lightsalmon\",ax=ax2)\n\nsns.scatterplot(x=df[\"Age\"],y=df[\"Annual Income (k$)\"],color=\"lightgreen\",ax=ax3)\n\nplt.suptitle(\"Age Distribution\",y=1.01,size=16)\nplt.tight_layout(pad=1,h_pad=1,w_pad=1)","ade86419":"fig=plt.figure(figsize=(12,5))\n\nax1=fig.add_subplot(1,2,1)\nax2=fig.add_subplot(1,2,2)\n\nsns.scatterplot(x=df[\"Annual Income (k$)\"],y=df[\"Spending Score (1-100)\"],color=\"mediumpurple\",ax=ax1)\n\nsns.distplot(a=df[\"Annual Income (k$)\"],bins=30,color=\"lightgreen\",ax=ax2)\n\nplt.suptitle(\"Annual Income Distribution\",y=0.93,size=16)","d339d5ad":"from sklearn.preprocessing import StandardScaler\nscaler=StandardScaler()\nscaled_df=pd.DataFrame(scaler.fit_transform(df),columns=df.columns)\nscaled_df.head()","05166554":"from sklearn.cluster import KMeans","1ccb17b6":"kinertia=[]\n\nfor i in range(1,11):\n    kmodel=KMeans(n_clusters=i)\n    kmodel.fit(scaled_df.drop([\"Gender\"],axis=1))\n    kinertia.append(kmodel.inertia_)\n\nkinertia_df=pd.DataFrame({\"No of Cluster\":range(1,11),\"Inertia\":kinertia})\n\nsns.lineplot(x=kinertia_df[\"No of Cluster\"],y=kinertia_df[\"Inertia\"],color=\"powderblue\",linewidth=2,marker=\"s\",markersize=8,markeredgecolor=\"whitesmoke\",markeredgewidth=1)","8f53210e":"from sklearn.metrics import silhouette_score","a810b72f":"ksilhouette=[]\n\nfor j in range(2,11):\n    kmodel=KMeans(n_clusters=j)\n    kpredict=kmodel.fit_predict(scaled_df.drop([\"Gender\"],axis=1))\n    kscores=silhouette_score(scaled_df.drop([\"Gender\"],axis=1),kpredict)\n    ksilhouette.append(kscores)\n\nsilhouette_df=pd.DataFrame({\"no_k\":list(range(2,11)),\"silhoutte\":ksilhouette})\n\nsns.barplot(x=silhouette_df[\"no_k\"],y=silhouette_df[\"silhoutte\"],color=\"mistyrose\")\nplt.xlabel(\"Number of Clusters\")\nplt.ylabel(\"Silhouette Score\")","a6effbc4":"model=KMeans(n_clusters=6,random_state=7)\nmodel.fit(scaled_df)\ndf[\"Cluster\"]=model.labels_","87edec44":"cluster_df=df.groupby([\"Cluster\"]).mean().T\ncluster_df[\"Average\"]=df.apply(lambda x:x.mean(),axis=0)\ncluster_df","37e8f549":"cluster_df_graphing=cluster_df.drop([\"Gender\"])\n\nfig,ax=plt.subplots(3,2,figsize=(12,6))\n\nfor i,ax in enumerate(ax.flat):\n    sns.scatterplot(x=cluster_df_graphing[\"Average\"],y=cluster_df_graphing.index,marker=\"X\",color=\"k\",ax=ax)\n    sns.barplot(x=cluster_df_graphing[i],y=cluster_df_graphing.index,palette={\"Age\":\"lightsalmon\",\"Annual Income (k$)\":\"lightgreen\",\"Spending Score (1-100)\":\"#AE9CCD\"},ax=ax)\n    ax.set_xlim(1,90)\n    plt.setp(ax.collections,zorder=100)\n    ax.set_xlabel(\"Cluster {}\".format(i))\n    \nplt.tight_layout(pad=1,h_pad=1,w_pad=1)    ","295363b7":"from sklearn.decomposition import PCA\npca=PCA(n_components=2)\n\npca_df=pd.DataFrame(pca.fit_transform(scaled_df),columns=[\"PC1\",\"PC2\"])\npca_df[\"Cluster\"]=model.labels_\n\nplt.figure(figsize=(12,8))\nsns.scatterplot(x=pca_df[\"PC1\"],y=pca_df[\"PC2\"],hue=pca_df[\"Cluster\"],palette=\"Pastel1\")","b7ec21f6":"Now we can examine our 6 mall customer clusters:","97d847bc":"* Although they share the same median spending score, females spend slightly more than males.\n* There are more females in the customer pool than males with most females being aged between 30 and 40.\n* Not much disparity in annual income between the sexes.","2040aa98":"* Those with an annual income of less than 40,000 either spend less or more, but not average.\n* Those with an annual income of between 40,000 and 70,000 spend the average amount.\n* And those with an annual income of more than 70,000 again either spend less or more, but not average.","fc86289c":"The optimal number of clusters using their inertia is not very clear so let's compare this to their silhouette scores (remember the silhouette coefficient measures how close each point in a cluster is to the points in its neighbouring clusters - thus the closer the value to +1 the better):","50fdd8a2":"Drop the \"CustomerID\" column as it does not provide any insight to the clusters:","ccf53b8c":"Optimal number of clusters should be 6!","4ede1948":"Now let's check the data:","aaa77286":"* Majority of the customers have a spending score of between 40 and 60, then again between 0 and 20 & 70 and 100.","34b77d40":"Before going further with clustering, it is important to ensure there are no biases and so the data must be scaled:","761860fa":"Everyone goes to the mall, but not everyone spends at the mall. Some are just window shopping while others go on a mass shopping expedition.\n\nInformation on customers' gender, age, annual income and spending score was gathered to identify clusters within them to better serve them. The mall may also use this data to develop a marketing strategy!","aaabd31e":"Let's take a look at the raw data:","27e6e887":"OK this is what the working dataset looks like:","bf8e4afc":"Change the \"Gender\" column to binary:","c6ed3681":"Cluster 0: relatively young cluster with a high annual income and correspondingly high spending score (the highest spending score).\n\nCluster 1: second youngest cluster with a slightly lower than average annual income who spends more than their annual income, more than the average spending score.\n\nCluster 2: the youngest cluster with the lowest annual income spending who again spends more than their annual income, more than the average spending score.\n\nCluster 3: average aged cluster with the highest annual income but lowest spending score.\n\nCluster 4: second oldest cluster with a slightly lower than average annual income with a medium spending score.\n\nCluster 5: the oldest cluster with the second lowest annual income with a medium spending score.","a1210eb2":"* People younger than 40 tend to spend more than those older than 40; and more customers younger than 40.\n* No relationship between age and annual income, so those younger than 40 are not necessarily earning more but just have more disposable income.","4cd03a9b":"KMeans requires us to indiate the number of clusters the algorithm should identify. So let's try looking for the elbow point in their inertia (remember the inertia is the sum of squared distances within the cluster - thus the smaller the inertia the better):"}}