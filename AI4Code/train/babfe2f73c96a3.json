{"cell_type":{"4021f658":"code","cd0cb9c3":"code","bb72499d":"code","33366623":"code","455e1229":"code","f64d4554":"code","0f31f40c":"code","fc4b6c55":"code","c2b98030":"code","627ea614":"code","adfc426c":"code","b3cb8aeb":"code","a3ce84f8":"code","1134c21b":"code","d724d918":"code","94d408a8":"code","f08e0add":"code","36bce758":"code","a2cff262":"code","add740f7":"code","f5ea7eee":"code","35fa6d86":"code","75f36430":"code","546886ba":"code","6aff65f6":"code","d565f302":"code","aa6ba9c1":"code","076efd7e":"code","6cb98b3a":"code","a4f17736":"code","854c1add":"code","92d499fb":"code","be277b02":"code","3ef14cb7":"code","7a0a18a0":"code","b31e26d1":"code","0ea92d5e":"code","23426386":"code","cfbacf39":"code","820a3227":"code","3dba7b3e":"code","a80ac19b":"code","ae0a6a02":"code","6b0d1e5f":"code","715a9c61":"code","1b730e78":"code","f87ad1a6":"code","6ec76734":"code","45f06d18":"code","d2330a91":"code","aadc617a":"code","68cfa23d":"code","05295bdb":"code","f3dfa236":"code","7114b1c9":"code","016e2181":"code","2759b40e":"code","ba8f390d":"code","0b2de2d1":"code","d26c99f0":"code","0cf431d1":"code","e173bf13":"code","625af9ad":"code","a525295e":"code","cb267b38":"code","878bd874":"code","974ddee4":"code","4150b7aa":"markdown","4a0b230a":"markdown","899e7428":"markdown","1512df9a":"markdown","1e348334":"markdown","d14601aa":"markdown","939cf7d9":"markdown","2990fca4":"markdown","a40883c1":"markdown","00523d57":"markdown","d16238cb":"markdown","0f564f59":"markdown","dc136339":"markdown","14379efb":"markdown","df55cc76":"markdown","f28334a7":"markdown","c25abbd4":"markdown","825d24d1":"markdown","8f647abb":"markdown","c39cd781":"markdown","2b7c7896":"markdown","a4ed75e6":"markdown"},"source":{"4021f658":"import warnings\nwarnings.filterwarnings('ignore')\n\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport nltk\nimport re\nfrom wordcloud import WordCloud","cd0cb9c3":"from tensorflow.keras.preprocessing.text import Tokenizer\nfrom tensorflow.keras.preprocessing.sequence import pad_sequences\nfrom tensorflow.keras.models import Sequential\nfrom tensorflow.keras.layers import Dense, Embedding, LSTM, Conv1D, MaxPool1D\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import classification_report, accuracy_score","bb72499d":"fake = pd.read_csv(\"\/kaggle\/input\/fake-and-real-news-dataset\/Fake.csv\")","33366623":"fake.head()","455e1229":"#Counting by Subjects \nfor key,count in fake.subject.value_counts().iteritems():\n    print(f\"{key}:\\t{count}\")\n    \n#Getting Total Rows\nprint(f\"Total Records:\\t{fake.shape[0]}\")","f64d4554":"plt.figure(figsize=(8,5))\nsns.countplot(\"subject\", data=fake)\nplt.show()","0f31f40c":"#Word Cloud\ntext = ''\nfor news in fake.text.values:\n    text += f\" {news}\"\nwordcloud = WordCloud(\n    width = 3000,\n    height = 2000,\n    background_color = 'black',\n    stopwords = set(nltk.corpus.stopwords.words(\"english\"))).generate(text)\nfig = plt.figure(\n    figsize = (40, 30),\n    facecolor = 'k',\n    edgecolor = 'k')\nplt.imshow(wordcloud, interpolation = 'bilinear')\nplt.axis('off')\nplt.tight_layout(pad=0)\nplt.show()\ndel text","fc4b6c55":"real = pd.read_csv(\"\/kaggle\/input\/fake-and-real-news-dataset\/True.csv\")\nreal.head()","c2b98030":"#First Creating list of index that do not have publication part\nunknown_publishers = []\nfor index,row in enumerate(real.text.values):\n    try:\n        record = row.split(\" -\", maxsplit=1)\n        #if no text part is present, following will give error\n        record[1]\n        #if len of piblication part is greater than 260\n        #following will give error, ensuring no text having \"-\" in between is counted\n        assert(len(record[0]) < 260)\n    except:\n        unknown_publishers.append(index)","627ea614":"#Thus we have list of indices where publisher is not mentioned\n#lets check\nreal.iloc[unknown_publishers].text\n#true, they do not have text like \"WASHINGTON (Reuters)\"","adfc426c":"real.iloc[8970]\n#yep empty\n#will remove this soon","b3cb8aeb":"#Seperating Publication info, from actual text\npublisher = []\ntmp_text = []\nfor index,row in enumerate(real.text.values):\n    if index in unknown_publishers:\n        #Add unknown of publisher not mentioned\n        tmp_text.append(row)\n        \n        publisher.append(\"Unknown\")\n        continue\n    record = row.split(\" -\", maxsplit=1)\n    publisher.append(record[0])\n    tmp_text.append(record[1])","a3ce84f8":"#Replace existing text column with new text\n#add seperate column for publication info\nreal[\"publisher\"] = publisher\nreal[\"text\"] = tmp_text\n\ndel publisher, tmp_text, record, unknown_publishers","1134c21b":"real.head()","d724d918":"#checking for rows with empty text like row:8970\n[index for index,text in enumerate(real.text.values) if str(text).strip() == '']\n#seems only one :)","94d408a8":"#dropping this record\nreal = real.drop(8970, axis=0)","f08e0add":"# checking for the same in fake news\nempty_fake_index = [index for index,text in enumerate(fake.text.values) if str(text).strip() == '']\nprint(f\"No of empty rows: {len(empty_fake_index)}\")\nfake.iloc[empty_fake_index].tail()","36bce758":"#Looking at publication Information\n# Checking if Some part of text has been included as publisher info... No such cases it seems :)\n\n# for name,count in real.publisher.value_counts().iteritems():\n#     print(f\"Name: {name}\\nCount: {count}\\n\")","a2cff262":"#Getting Total Rows\nprint(f\"Total Records:\\t{real.shape[0]}\")\n\n#Counting by Subjects \nfor key,count in real.subject.value_counts().iteritems():\n  print(f\"{key}:\\t{count}\")","add740f7":"sns.countplot(x=\"subject\", data=real)\nplt.show()","f5ea7eee":"#WordCloud For Real News\ntext = ''\nfor news in real.text.values:\n    text += f\" {news}\"\nwordcloud = WordCloud(\n    width = 3000,\n    height = 2000,\n    background_color = 'black',\n    stopwords = set(nltk.corpus.stopwords.words(\"english\"))).generate(str(text))\nfig = plt.figure(\n    figsize = (40, 30),\n    facecolor = 'k',\n    edgecolor = 'k')\nplt.imshow(wordcloud, interpolation = 'bilinear')\nplt.axis('off')\nplt.tight_layout(pad=0)\nplt.show()\ndel text","35fa6d86":"# Adding class Information\nreal[\"class\"] = 1\nfake[\"class\"] = 0","75f36430":"#Combining Title and Text\nreal[\"text\"] = real[\"title\"] + \" \" + real[\"text\"]\nfake[\"text\"] = fake[\"title\"] + \" \" + fake[\"text\"]","546886ba":"# Subject is diffrent for real and fake thus dropping it\n# Aldo dropping Date, title and Publication Info of real\nreal = real.drop([\"subject\", \"date\",\"title\",  \"publisher\"], axis=1)\nfake = fake.drop([\"subject\", \"date\", \"title\"], axis=1)","6aff65f6":"#Combining both into new dataframe\ndata = real.append(fake, ignore_index=True)\ndel real, fake","d565f302":"# Download following if not downloaded in local machine\n\n# nltk.download('stopwords')\n# nltk.download('punkt')","aa6ba9c1":"y = data[\"class\"].values\n#Converting X to format acceptable by gensim, removing annd punctuation stopwords in the process\nX = []\nstop_words = set(nltk.corpus.stopwords.words(\"english\"))\ntokenizer = nltk.tokenize.RegexpTokenizer(r'\\w+')\nfor par in data[\"text\"].values:\n    tmp = []\n    sentences = nltk.sent_tokenize(par)\n    for sent in sentences:\n        sent = sent.lower()\n        tokens = tokenizer.tokenize(sent)\n        filtered_words = [w.strip() for w in tokens if w not in stop_words and len(w) > 1]\n        tmp.extend(filtered_words)\n    X.append(tmp)\n\ndel data","076efd7e":"import gensim","6cb98b3a":"#Dimension of vectors we are generating\nEMBEDDING_DIM = 100\n\n#Creating Word Vectors by Word2Vec Method (takes time...)\nw2v_model = gensim.models.Word2Vec(sentences=X, size=EMBEDDING_DIM, window=5, min_count=1)","a4f17736":"#vocab size\nlen(w2v_model.wv.vocab)\n\n#We have now represented each of 122248 words by a 100dim vector.","854c1add":"#see a sample vector for random word, lets say Corona \nw2v_model[\"corona\"]","92d499fb":"w2v_model.wv.most_similar(\"iran\")","be277b02":"w2v_model.wv.most_similar(\"fbi\")","3ef14cb7":"w2v_model.wv.most_similar(\"facebook\")","7a0a18a0":"w2v_model.wv.most_similar(\"computer\")","b31e26d1":"#Feeding US Presidents\nw2v_model.wv.most_similar(positive=[\"trump\",\"obama\", \"clinton\"])\n#First was Bush","0ea92d5e":"# Tokenizing Text -> Repsesenting each word by a number\n# Mapping of orginal word to number is preserved in word_index property of tokenizer\n\n#Tokenized applies basic processing like changing it yo lower case, explicitely setting that as False\ntokenizer = Tokenizer()\ntokenizer.fit_on_texts(X)\n\nX = tokenizer.texts_to_sequences(X)","23426386":"# lets check the first 10 words of first news\n#every word has been represented with a number\nX[0][:10]","cfbacf39":"#Lets check few word to numerical replesentation\n#Mapping is preserved in dictionary -> word_index property of instance\nword_index = tokenizer.word_index\nfor word, num in word_index.items():\n    print(f\"{word} -> {num}\")\n    if num == 10:\n        break        ","820a3227":"# For determining size of input...\n\n# Making histogram for no of words in news shows that most news article are under 700 words.\n# Lets keep each news small and truncate all news to 700 while tokenizing\nplt.hist([len(x) for x in X], bins=500)\nplt.show()\n\n# Its heavily skewed. There are news with 5000 words? Lets truncate these outliers :) ","3dba7b3e":"nos = np.array([len(x) for x in X])\nlen(nos[nos  < 700])\n# Out of 48k news, 44k have less than 700 words","a80ac19b":"#Lets keep all news to 700, add padding to news with less than 700 words and truncating long ones\nmaxlen = 700 \n\n#Making all news of size maxlen defined above\nX = pad_sequences(X, maxlen=maxlen)","ae0a6a02":"#all news has 700 words (in numerical form now). If they had less words, they have been padded with 0\n# 0 is not associated to any word, as mapping of words started from 1\n# 0 will also be used later, if unknows word is encountered in test set\nlen(X[0])","6b0d1e5f":"# Adding 1 because of reserved 0 index\n# Embedding Layer creates one more vector for \"UNKNOWN\" words, or padded words (0s). This Vector is filled with zeros.\n# Thus our vocab size inceeases by 1\nvocab_size = len(tokenizer.word_index) + 1","715a9c61":"# Function to create weight matrix from word2vec gensim model\ndef get_weight_matrix(model, vocab):\n    # total vocabulary size plus 0 for unknown words\n    vocab_size = len(vocab) + 1\n    # define weight matrix dimensions with all 0\n    weight_matrix = np.zeros((vocab_size, EMBEDDING_DIM))\n    # step vocab, store vectors using the Tokenizer's integer mapping\n    for word, i in vocab.items():\n        weight_matrix[i] = model[word]\n    return weight_matrix","1b730e78":"#Getting embedding vectors from word2vec and usings it as weights of non-trainable keras embedding layer\nembedding_vectors = get_weight_matrix(w2v_model, word_index)","f87ad1a6":"#Defining Neural Network\nmodel = Sequential()\n#Non-trainable embeddidng layer\nmodel.add(Embedding(vocab_size, output_dim=EMBEDDING_DIM, weights=[embedding_vectors], input_length=maxlen, trainable=False))\n#LSTM \nmodel.add(LSTM(units=128))\nmodel.add(Dense(1, activation='sigmoid'))\nmodel.compile(optimizer='adam', loss='binary_crossentropy', metrics=['acc'])\n\ndel embedding_vectors","6ec76734":"model.summary()","45f06d18":"#Train test split\nX_train, X_test, y_train, y_test = train_test_split(X, y) ","d2330a91":"model.fit(X_train, y_train, validation_split=0.3, epochs=6)","aadc617a":"#Prediction is in probability of news being real, so converting into classes\n# Class 0 (Fake) if predicted prob < 0.5, else class 1 (Real)\ny_pred = (model.predict(X_test) >= 0).astype(\"int\")","68cfa23d":"accuracy_score(y_test, y_pred)\n\nfrom sklearn.metrics import confusion_matrix\n\ncm= confusion_matrix(y_pred,y_test)\n\nprint(cm)","05295bdb":"print(classification_report(y_test, y_pred))","f3dfa236":"del model","7114b1c9":"#invoke garbage collector to free ram\nimport gc\ngc.collect()","016e2181":"from gensim.models.keyedvectors import KeyedVectors","2759b40e":"# Takes RAM \nword_vectors = KeyedVectors.load_word2vec_format('..\/input\/googlenewsvectorsnegative300\/GoogleNews-vectors-negative300.bin', binary=True)\nEMBEDDING_DIM=300","ba8f390d":"# word_vectors.most_similar('usa')","0b2de2d1":"# word_vectors.most_similar('fbi')","d26c99f0":"# word_vectors.most_similar('Republic')","0cf431d1":"embedding_matrix = np.zeros((vocab_size, EMBEDDING_DIM))\nfor word, i in word_index.items():\n    try:\n        embedding_vector = word_vectors[word]\n        embedding_matrix[i] = embedding_vector\n    except KeyError:\n        embedding_matrix[i]=np.random.normal(0,np.sqrt(0.25),EMBEDDING_DIM)\n\ndel word_vectors ","e173bf13":"model = Sequential()\nmodel.add(Embedding(vocab_size, output_dim=EMBEDDING_DIM, weights=[embedding_matrix], input_length=maxlen, trainable=False))\nmodel.add(Conv1D(activation='relu', filters=4, kernel_size=4))\nmodel.add(MaxPool1D())\nmodel.add(LSTM(units=128))\nmodel.add(Dense(1, activation='sigmoid'))\nmodel.compile(optimizer='adam', loss='binary_crossentropy', metrics=['acc'])\n\ndel embedding_matrix","625af9ad":"model.summary()","a525295e":"model.fit(X_train, y_train, validation_split=0.3, epochs=12)","cb267b38":"y_pred = (model.predict(X_test) > 0.5).astype(\"int\")","878bd874":"accuracy_score(y_test, y_pred)\n\nfrom sklearn.metrics import confusion_matrix\n\ncm2= confusion_matrix(y_pred,y_test)\n\nprint(cm2)","974ddee4":"print(classification_report(y_test, y_pred))","4150b7aa":"**630 Rows in Fake news with empty text**\n\nAlso noticed fake news have a lot of CPATIAL-CASES. Could preserve Cases of letters, but as we are using Google's pretrained word2vec vectors later on, which haswell-formed lower cases word. We will contert to lower case.\n\nThe text for these rows seems to be present in title itself. Lets merge title and text to solve these cases.","4a0b230a":"Removing StopWords, Punctuations and single-character words","899e7428":"New column called \"Publisher\" has been added.\n","1512df9a":"# Cleaning Data\nRemoving Reuters or Twitter Tweet information from the text \n\n- Text can be splitted only once at \" - \" which is always present after mentioning source of publication, this gives us publication part and text part\n- If we do not get text part, this means publication details was't given for that record\n- The Twitter tweets always have same source, a long text of max 259 characters ","1e348334":"### Exploring Vectors\n\nLets checkout these vectors","d14601aa":"**Looking at the similar words, vectors are well formed for these words :)**\n\n\nThese Vectors will be passed to LSTM\/GRU instead of words. 1D-CNN can further be used to extract features from the vectors. \n\n\nKeras has implementation called \"**Embedding Layer**\" which would create word embeddings(vectors). Since we did that with gensim's word2vec, we will load these vectors into embedding layer and make the layer non-trainable.\n\n\n","939cf7d9":"#### Let's create and check our own Word2Vec model with **gensim**","2990fca4":"# Exploring Real news","a40883c1":"# Preprocessing Text","00523d57":"While looking at texts that do not contain publication info such as which reuter, we noticed one thing.\n\n**Text at index 8970 is empty**","d16238cb":"### Exploring these trained Vectors","0f564f59":"We Create a matrix of mapping between word-index and vectors. We use this as weights in embedding layer\n\nEmbedding layer accepts numecical-token of word and outputs corresponding vercor to inner layer.\n\nIt sends vector of zeros to next layer for unknown words which would be tokenized to 0.\n\n\nInput length of Embedding Layer is the length of each news (700 now due to padding and truncating)","dc136339":"Now, instead of creating word vectors, let us use pre-trained vectors trained on part of **Google News dataset** (about 100 billion words). The model contains 300-dimensional vectors for 3 million words and phrases.  Source: https:\/\/code.google.com\/archive\/p\/word2vec\/\n\n**Please download model file from**: https:\/\/drive.google.com\/file\/d\/0B7XkCwpI5KDYNlNUTTlSS21pQmM\/edit?usp=sharing\n\n\nOr add Dataset from https:\/\/www.kaggle.com\/sandreds\/googlenewsvectorsnegative300\n","14379efb":"We cannot pass string words to embedding layer, thus need some way to represent each words by numbers.\n\nTokenizer can represent each word by number","df55cc76":"# Exploring Fake News","f28334a7":"### Using Pre-Trained Word2Vec Vectors\n\n**Needs 12GB RAM and 4GB HardDisk Space **","c25abbd4":"# Library Imports","825d24d1":"**Do Upvote if you find this notebook useful.**\n\n**Thanks**","8f647abb":"### Difference in Text\nReal news seems to have source of publication which is not present in fake news set\n\nLooking at the data:\n- most of text contains reuters information such as \"**WASHINGTON (Reuters)**\".\n- Some text are tweets from Twitter \n- Few text do not contain any publication info","c39cd781":"### Vectorization -- Word2Vec\n\nWord2Vec is one of the most popular technique to learn word embeddings using shallow neural network. It was developed by Tomas Mikolov in 2013 at Google.\n\nWord embedding is the most popular representation of document vocabulary. It is capable of capturing context of a word in a document, semantic and syntactic similarity, relation with other words, etc.\n\n[Here](https:\/\/towardsdatascience.com\/introduction-to-word-embedding-and-word2vec-652d0c2060fa) is a nice article about it.\n\n\n","2b7c7896":"**Notice it starts with 1**\n","a4ed75e6":"We can pass numerical representation of words into neural network.\n\nWe can use Many-To-One (Sequence-To-Word) Model of RNN, as we have many words in news as input and one output ie Probability of being Real.\n\nFor Many-To-One model, lets use a fixed size input. \n"}}