{"cell_type":{"2225a33a":"code","f5ba73f2":"code","bd7ad218":"code","8edce61a":"code","bd83244d":"code","66b89522":"code","f2898003":"code","960232f6":"markdown"},"source":{"2225a33a":"import ast\nimport numpy as np\nimport pandas as pd\nimport cv2\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nctr = pd.read_csv('..\/input\/ranzcr-clip-tracheal-bifurcation\/RANZCR_CLiP_tracheal_bifurcation.csv')\ntrain = pd.read_csv('..\/input\/ranzcr-clip-catheter-line-classification\/train.csv')\ntrain_ann = pd.read_csv('..\/input\/ranzcr-clip-catheter-line-classification\/train_annotations.csv')","f5ba73f2":"normal_uid = train.loc[train['ETT - Normal']==1,'StudyInstanceUID'].tolist()\nabnormal_uid = train.loc[train['ETT - Abnormal']==1,'StudyInstanceUID'].tolist()","bd7ad218":"def plot_xray(StudyInstanceUID, label):\n    \"\"\"\n    intubation as green\n    bifurcation as red\n    \"\"\"\n    img = cv2.imread('..\/input\/ranzcr-clip-catheter-line-classification\/train\/'+StudyInstanceUID+'.jpg')\n    bifurcation = ast.literal_eval(ctr.loc[ctr.StudyInstanceUID==StudyInstanceUID,'tracheal_bifurcation'].values[0])\n    intubation = ast.literal_eval(train_ann.loc[(train_ann.StudyInstanceUID==StudyInstanceUID) & (train_ann.label==label),'data'].values[0])[0]\n    img = cv2.circle(img, tuple(bifurcation), 50, (255,0,0), 10)\n    img = cv2.circle(img, tuple(intubation), 50, (0,255,0), 10)\n    plt.figure(figsize=(16,16))\n    plt.imshow(img)","8edce61a":"# bifurcation detected correctly\nplot_xray(normal_uid[9],'ETT - Normal')","bd83244d":"# model failed to detect bifurcation correctly\nplot_xray(normal_uid[3],'ETT - Normal')","66b89522":"# ETT is way too deep - abnormality is obvious\nplot_xray(abnormal_uid[16],'ETT - Abnormal')","f2898003":"# incorrect label in training data - should be CVC - Abnormal\nplot_xray(abnormal_uid[9],'ETT - Abnormal')","960232f6":"## ETT & bifurcation visualization\n\nThis notebook uses external information about tracheal bifurcation (coming from https:\/\/www.kaggle.com\/raddar\/ranzcr-clip-tracheal-bifurcation). Bifurcation is a point in trachea, where it splits into left and right lungs. ETT is considered to be placed normal, if the ETT end point is above bifurcation point, and abnormal - if below bifurcation point. So having both ETT end point and bifurcation point can directly help to estimate if `ETT - Abnormal` or not. This is especially important in this competition, as only ~70 abnormal cases are available in training set."}}