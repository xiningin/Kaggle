{"cell_type":{"792db68b":"code","48bf66eb":"code","7aaadfa1":"code","7613d497":"code","e5c470d1":"code","9b95d8b8":"code","275e6858":"code","581bc46d":"code","c6e6e02f":"code","a2d761c7":"code","c19ddb21":"code","bc3541dd":"code","71b5ad58":"code","00009797":"markdown","ea8a1615":"markdown","849ae007":"markdown","343e6d1a":"markdown","83d1bb74":"markdown"},"source":{"792db68b":"import os\n\nfrom collections import Counter\n\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\nimport skimage\nimport seaborn as sns\n\nfrom IPython.display import Image\n\nINPUT_DIR = '\/kaggle\/input\/kuzushiji-recognition'","48bf66eb":"train_metadata = pd.read_csv(os.path.join(INPUT_DIR, 'train.csv'), index_col='image_id')\nunicode_translations = pd.read_csv(os.path.join(INPUT_DIR, 'unicode_translation.csv'))","7aaadfa1":"train_metadata.head()","7613d497":"print(f'We have {train_metadata.shape[0]} images in the train dataset')","e5c470d1":"# There are some images that do not contain any character, let's have a look at one\nimg_no_chars = train_metadata[train_metadata.labels.isnull()].reset_index().iloc[0].image_id\nImage(os.path.join(INPUT_DIR, 'train_images', '{}.jpg'.format(img_no_chars)), width=500)","9b95d8b8":"def show_page(img_id, bounding_boxes=False):\n    \"\"\" Shows a page (image)\n    \n    :param img_id - str: ID of the page to show\n    :param bounding_boxes - boolean: If True, will drow the bounding boxes on the characters contained in the image\n    \"\"\"\n    img = skimage.io.imread(os.path.join(INPUT_DIR, 'train_images', '{}.jpg'.format(img_id)))\n    plt.figure(figsize=(15,15))\n    plt.imshow(img)\n    \n    if bounding_boxes:\n        def _chunks(l, n):\n            for i in range(0, len(l), n):\n                yield l[i:i+n]\n        ax = plt.gca()\n        chars = train_metadata.loc[img_id].labels.split()\n        for char, x, y, height, width in chars[::5]:\n            ax.add_patch(plt.Rectangle(x, y, height, width, color='blue', fill=False, linewidth=2))\n            ax.text(x, y, char, size='x-large', color='white', bbox={'facecolor':'blue', 'alpha':1.0})\n            plt.show()","275e6858":"show_page('100241706_00004_2', bounding_boxes=True)","581bc46d":"unicode_translations.head()","c6e6e02f":"def num_chars_in_image(labels):\n    \"\"\" Return the number of characters in an image given the labels string\n    \n    Labels is a string with all the characters in the image. The format is labels = ['unicode char', 'X', 'Y', 'width', 'height'] for each character.\n    So if we jump the list in steps of length 5, we can get all the unicodes\n    \"\"\"\n    return 0 if labels is np.nan else len(labels[::5])\n    \ntrain_metadata['num_chars'] = train_metadata.labels.apply(lambda l: num_chars_in_image(l))","a2d761c7":"def count_characters(df):\n    counter = Counter()\n    for labels in df[df.num_chars > 0].labels:\n        for c in labels.split()[::5]:\n            counter[c]+=1\n    return counter\n        \nchars_count = count_characters(train_metadata)","c19ddb21":"print(f'Min characters per image: {train_metadata.num_chars.min()}')\nprint(f'Max characters per image: {train_metadata.num_chars.max()}')\nprint(f'Avg characters per image: {np.average(train_metadata.num_chars)} (std of {np.std(train_metadata.num_chars)})')\nprint(f'Total number of different characters (classes) is {len(chars_count)}')","bc3541dd":"_ = sns.distplot(train_metadata.num_chars, kde=False)\n_ = plt.title('Number of characters per page count distribution')","71b5ad58":"_ = sns.distplot(train_metadata[train_metadata.num_chars > 0].num_chars, kde=False)\n_ = plt.title('Number of characters per page count distribution (no blank pages)')","00009797":"Would be usefult to visualize the images with bounding boxes, let's write a function to do so","ea8a1615":"A random classifier would have an accuracy of `1\/num_classes`, which is `0.0237%` Let's see if we can beat that without _much_ effort","849ae007":"# Load training data\nAvailable data is described in the [competition description](https:\/\/www.kaggle.com\/c\/kuzushiji-recognition\/data)","343e6d1a":"If we don't take into account the pages without characters at all, this looks like a binomial distribution, where the biggest concentration is around 800 characters. The distribution is quite wide though","83d1bb74":"Let's try to understand a bit the available data by answering to the following questions:\n\n1. What's the distribution of characters per image?\n    * Min characters per image\n    * Average characters per image\n    * Max characters per image\n    * Total numbers of different characters (classes)\n    * Overall distribution of classes"}}