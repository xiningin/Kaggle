{"cell_type":{"f05f7057":"code","7478a251":"code","58db4dc8":"code","19af887b":"code","896b9f3b":"code","af95f838":"code","11c74a99":"code","7a11d49a":"code","d95de74e":"code","12b4ae8d":"code","ccb60eb6":"code","9c3335be":"code","53a360ab":"code","b155c938":"code","d6222571":"code","f2e63d08":"code","b8b1a05a":"code","e9b71513":"code","eea22ed6":"code","c84c71db":"code","58540c1a":"code","c3955c46":"code","f0c887e8":"code","324825de":"code","5eb35999":"code","ad46ae41":"code","036ceffe":"code","5ceb2c65":"code","1bc48e64":"code","b0807a90":"code","3fdd82fa":"code","5de9ae7d":"code","215cdde6":"code","1322e78a":"code","2c4e98e1":"code","f4100672":"code","f8478ee2":"code","6f01aea6":"code","85e3913f":"code","6f0b05c2":"code","03a49938":"code","a7da2cf1":"code","0534dfc1":"code","470445a7":"code","60c3bd5e":"code","08fe7620":"code","d138b063":"code","48291ff3":"code","7776825d":"code","58fa5d62":"code","516f9adc":"code","eae3a15a":"code","7133de0b":"code","b5f44eae":"code","6aa22695":"code","6c579373":"code","47498634":"code","8f025ace":"code","1c231fbf":"code","abec1fb8":"code","520e8f57":"code","c5109fa2":"code","9207e436":"code","432b7887":"code","23e11a81":"markdown","6ae139c2":"markdown","4bfd99f1":"markdown","f4268587":"markdown","40c05e83":"markdown","e90af3a9":"markdown","08c70efb":"markdown","770d02bb":"markdown","92f43a1f":"markdown","a33e3682":"markdown","4b0e627f":"markdown","6c190e4f":"markdown","d3dd5018":"markdown","af990842":"markdown","c5fd4d56":"markdown","2fca8668":"markdown","628ce987":"markdown","90c21590":"markdown","7285fcff":"markdown","7c0043e1":"markdown"},"source":{"f05f7057":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nfrom bq_helper import BigQueryHelper\nimport bq_helper\n\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots\nimport matplotlib.pyplot as plt\nimport plotly.express as px\nimport seaborn as sns\nsns.set_theme()\n\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","7478a251":"medicare = bq_helper.BigQueryHelper(active_project=\"bigquery-public-data\", dataset_name=\"cms_medicare\")\nbq_assistant = BigQueryHelper(\"bigquery-public-data\", \"cms_medicare\")\nbq_assistant.list_tables()","58db4dc8":"EDAsq1 = \"\"\"\nSELECT nppes_provider_state AS Estado,SUM(total_claim_count) AS Total_medicamentos\nFROM bigquery-public-data.cms_medicare.part_d_prescriber_2014\nGROUP BY Estado\nORDER BY Total_medicamentos DESC;\n\"\"\"\n\nEDAsdf1 = medicare.query_to_pandas_safe(EDAsq1)\nEDAsdf1['Total_medicamentos'] = EDAsdf1['Total_medicamentos']\nEDAsdf1.head()","19af887b":"fig = px.bar(EDAsdf1, x='Estado', y='Total_medicamentos')\nfig.show()","896b9f3b":"fig = px.choropleth(locations=EDAsdf1.Estado, locationmode=\"USA-states\", color=EDAsdf1['Total_medicamentos'], scope=\"usa\", color_continuous_scale = 'turbo',\n                    title='Total de medicamentos recetados en cada estado en millones')\nfig.show()","af95f838":"dq = '''SELECT nppes_provider_state AS Estado, specialty_description AS Especialidad, SUM(bene_count) AS Numero_de_beneficiarios, \nFROM bigquery-public-data.cms_medicare.part_d_prescriber_2014\nGROUP BY Estado, Especialidad\nORDER BY Numero_de_beneficiarios DESC'''\n\nd = medicare.query_to_pandas_safe(dq)\nd.head()","11c74a99":"d.groupby('Especialidad').sum('Numero_de_beneficiarios').reset_index()","7a11d49a":"d.rename(columns={'Numero_de_beneficiarios':'Numero de beneficiarios'}, inplace=True)\nfig = px.bar(d.groupby('Especialidad').sum('Numero de beneficiarios').reset_index().sort_values('Numero de beneficiarios',ascending = False).head(20), x='Especialidad', y='Numero de beneficiarios')\nfig.show()","d95de74e":"fig = px.bar(d.groupby('Estado').sum('Numero de beneficiarios').reset_index().sort_values('Numero de beneficiarios',ascending = False), x='Estado', y='Numero de beneficiarios')\nfig.show()","12b4ae8d":"fig = px.bar(d.groupby('Especialidad').sum('Numero de beneficiarios').reset_index().sort_values('Numero de beneficiarios',ascending = False).head(20), x='Especialidad', y='Numero de beneficiarios')\nfig.show()","ccb60eb6":"d.groupby(['Estado']).first().reset_index().sort_values('Numero de beneficiarios',ascending = False)","9c3335be":"fig = px.choropleth(data_frame = d.groupby(['Estado']).first().reset_index().sort_values('Numero de beneficiarios',ascending = False), locations='Estado' , locationmode=\"USA-states\", color='Especialidad', scope=\"usa\", color_continuous_scale = 'turbo',\n                    title='Especialidad m\u00e1s comun para cada estado')\nfig.show()\n","53a360ab":"EDAsq2 = \"\"\"\nSELECT nppes_provider_state AS Estado,generic_name AS Nombre_medicamentos, SUM(total_claim_count) AS Total_medicamentos\nFROM bigquery-public-data.cms_medicare.part_d_prescriber_2014\nGROUP BY Estado, Nombre_medicamentos\nORDER BY Total_medicamentos DESC;\n\"\"\"\n\nEDAsdf2 = medicare.query_to_pandas_safe(EDAsq2)\nEDAsdf2.rename(columns={'Total_medicamentos':'Total medicamentos','Nombre_medicamentos':'Nombre medicamento'}, inplace=True)\nEDAsdf2 = EDAsdf2.groupby('Estado').first().reset_index().sort_values('Total medicamentos',ascending=False)\nEDAsdf2.head()","b155c938":"fig = px.bar(EDAsdf2, x='Estado', y='Total medicamentos',  color='Nombre medicamento')\nfig.show()","d6222571":"ch11q = '''\nSELECT provider_state AS Estado,SUM(total_discharges * average_total_payments)\/SUM(total_discharges) AS Costo_promedio\nFROM bigquery-public-data.cms_medicare.inpatient_charges_2011\nGROUP BY Estado\nORDER BY Costo_promedio DESC;\n'''\nch11d = medicare.query_to_pandas_safe(ch11q)\nch11d['A\u00f1o'] = 2011\n\nch12q = '''\nSELECT provider_state AS Estado,SUM(total_discharges * average_total_payments)\/SUM(total_discharges) AS Costo_promedio\nFROM bigquery-public-data.cms_medicare.inpatient_charges_2012\nGROUP BY Estado\nORDER BY Costo_promedio DESC;\n'''\nch12d = medicare.query_to_pandas_safe(ch12q)\nch12d['A\u00f1o'] = 2012\n\nch13q = '''\nSELECT provider_state AS Estado,SUM(total_discharges * average_total_payments)\/SUM(total_discharges) AS Costo_promedio\nFROM bigquery-public-data.cms_medicare.inpatient_charges_2013\nGROUP BY Estado\nORDER BY Costo_promedio DESC;\n'''\nch13d = medicare.query_to_pandas_safe(ch13q)\nch13d['A\u00f1o'] = 2013\n\nch14q = '''\nSELECT provider_state AS Estado,SUM(total_discharges * average_total_payments)\/SUM(total_discharges) AS Costo_promedio\nFROM bigquery-public-data.cms_medicare.inpatient_charges_2014\nGROUP BY Estado\nORDER BY Costo_promedio DESC;\n'''\nch14d = medicare.query_to_pandas_safe(ch14q)\nch14d['A\u00f1o'] = 2014\n\nch15q = '''\nSELECT provider_state AS Estado,SUM(total_discharges * average_total_payments)\/SUM(total_discharges) AS Costo_promedio\nFROM bigquery-public-data.cms_medicare.inpatient_charges_2015\nGROUP BY Estado\nORDER BY Costo_promedio DESC;\n'''\nch15d = medicare.query_to_pandas_safe(ch15q)\nch15d['A\u00f1o'] = 2015\n\nca11q = '''\nSELECT provider_state AS Estado, SUM(average_total_payments * outpatient_services)\/SUM(outpatient_services) AS Costo_promedio\nFROM bigquery-public-data.cms_medicare.outpatient_charges_2011\nGROUP BY Estado\nORDER BY Costo_promedio DESC;\n'''\nca11d = medicare.query_to_pandas_safe(ca11q)\nca11d['A\u00f1o'] = 2011\n\nca12q = '''\nSELECT provider_state AS Estado, SUM(average_total_payments * outpatient_services)\/SUM(outpatient_services) AS Costo_promedio\nFROM bigquery-public-data.cms_medicare.outpatient_charges_2012\nGROUP BY Estado\nORDER BY Costo_promedio DESC;\n'''\nca12d = medicare.query_to_pandas_safe(ca12q)\nca12d['A\u00f1o'] = 2012\n\nca13q = '''\nSELECT provider_state AS Estado, SUM(average_total_payments * outpatient_services)\/SUM(outpatient_services) AS Costo_promedio\nFROM bigquery-public-data.cms_medicare.outpatient_charges_2013\nGROUP BY Estado\nORDER BY Costo_promedio DESC;\n'''\nca13d = medicare.query_to_pandas_safe(ca13q)\nca13d['A\u00f1o'] = 2013\n\nca14q = '''\nSELECT provider_state AS Estado, SUM(average_total_payments * outpatient_services)\/SUM(outpatient_services) AS Costo_promedio\nFROM bigquery-public-data.cms_medicare.outpatient_charges_2014\nGROUP BY Estado\nORDER BY Costo_promedio DESC;\n'''\nca14d = medicare.query_to_pandas_safe(ca14q)\nca14d['A\u00f1o'] = 2014\n\nca15q = '''\nSELECT provider_state AS Estado, SUM(average_total_payments * outpatient_services)\/SUM(outpatient_services) AS Costo_promedio\nFROM bigquery-public-data.cms_medicare.outpatient_charges_2015\nGROUP BY Estado\nORDER BY Costo_promedio DESC;\n'''\nca15d = medicare.query_to_pandas_safe(ca15q)\nca15d['A\u00f1o'] = 2015\n\nChpE = pd.concat([ch11d,ch12d,ch13d,ch14d,ch15d])\nCapE = pd.concat([ca11d,ca12d,ca13d,ca14d,ca15d])\n\nCpE = pd.merge(ChpE, CapE, on=['Estado','A\u00f1o'])\nCpE.rename(columns={'Estado': 'Estado', 'A\u00f1o':'A\u00f1o','Costo_promedio_x': 'Costo promedio hospitalario', 'Costo_promedio_y':'Costo promedio ambulatorio'}, inplace=True)\nCpE = CpE[['Estado', 'A\u00f1o','Costo promedio hospitalario','Costo promedio ambulatorio']]\nCpE['Costo promedio total'] = CpE['Costo promedio hospitalario'] + CpE['Costo promedio ambulatorio']\nCpE.head()","f2e63d08":"fig = px.bar( CpE, x='Estado', y='Costo promedio total',  animation_frame = 'A\u00f1o')\nfig.show()","b8b1a05a":"fig = px.choropleth(locations=CpE.Estado, locationmode=\"USA-states\", color=CpE['Costo promedio total'], scope=\"usa\", color_continuous_scale = 'turbo',\n                    title='Costo promedio total para cada estado', animation_frame=CpE['A\u00f1o'])\nfig.show()","e9b71513":"fig = px.bar(CpE.sort_values('Costo promedio ambulatorio',ascending=False), x='Estado', y='Costo promedio ambulatorio', animation_frame = 'A\u00f1o')\nfig.show()","eea22ed6":"fig = px.choropleth(locations=CpE.Estado, locationmode=\"USA-states\", color=CpE['Costo promedio ambulatorio'], scope=\"usa\", color_continuous_scale = 'turbo',\n                    title='Costo ambulatorio promedio para cada estado', animation_frame=CpE['A\u00f1o'])\nfig.show()","c84c71db":"fig = px.bar(CpE, x='Estado', y='Costo promedio hospitalario', animation_frame = 'A\u00f1o')\nfig.show()","58540c1a":"fig = px.choropleth(locations=CpE.Estado, locationmode=\"USA-states\", color=CpE['Costo promedio hospitalario'], scope=\"usa\", color_continuous_scale = 'turbo',\n                    title='Costo hospitalario promedio para cada estado', animation_frame=CpE['A\u00f1o'])\nfig.show()","c3955c46":"ch11q = '''\nSELECT provider_state AS Estado,UPPER(provider_city) AS Ciudad, drg_definition AS Diagnostico, SUM(total_discharges * average_total_payments)\/SUM(total_discharges) AS Costo_promedio\nFROM bigquery-public-data.cms_medicare.inpatient_charges_2011\nGROUP BY Estado, Ciudad, Diagnostico\nORDER BY Costo_promedio DESC;\n'''\nch11d = medicare.query_to_pandas_safe(ch11q)\nch11d['A\u00f1o'] = 2011\n\nch12q = '''\nSELECT provider_state AS Estado,UPPER(provider_city) AS Ciudad, drg_definition AS Diagnostico, SUM(total_discharges * average_total_payments)\/SUM(total_discharges) AS Costo_promedio\nFROM bigquery-public-data.cms_medicare.inpatient_charges_2012\nGROUP BY Estado, Ciudad, Diagnostico\nORDER BY Costo_promedio DESC;\n'''\nch12d = medicare.query_to_pandas_safe(ch12q)\nch12d['A\u00f1o'] = 2012\n\nch13q = '''\nSELECT provider_state AS Estado,UPPER(provider_city) AS Ciudad, drg_definition AS Diagnostico, SUM(total_discharges * average_total_payments)\/SUM(total_discharges) AS Costo_promedio\nFROM bigquery-public-data.cms_medicare.inpatient_charges_2013\nGROUP BY Estado, Ciudad, Diagnostico\nORDER BY Costo_promedio DESC;\n'''\nch13d = medicare.query_to_pandas_safe(ch13q)\nch13d['A\u00f1o'] = 2013\n\nch14q = '''\nSELECT provider_state AS Estado,UPPER(provider_city) AS Ciudad, drg_definition AS Diagnostico, SUM(total_discharges * average_total_payments)\/SUM(total_discharges) AS Costo_promedio\nFROM bigquery-public-data.cms_medicare.inpatient_charges_2014\nGROUP BY Estado, Ciudad, Diagnostico\nORDER BY Costo_promedio DESC;\n'''\nch14d = medicare.query_to_pandas_safe(ch14q)\nch14d['A\u00f1o'] = 2014\n\nch15q = '''\nSELECT provider_state AS Estado,UPPER(provider_city) AS Ciudad, drg_definition AS Diagnostico, SUM(total_discharges * average_total_payments)\/SUM(total_discharges) AS Costo_promedio\nFROM bigquery-public-data.cms_medicare.inpatient_charges_2015\nGROUP BY Estado, Ciudad, Diagnostico\nORDER BY Costo_promedio DESC;\n'''\nch15d = medicare.query_to_pandas_safe(ch15q)\nch15d['A\u00f1o'] = 2015\n\nhpE = pd.concat([ch11d,ch12d,ch13d,ch14d,ch15d])\nhpE.head()","f0c887e8":"DpA = hpE.groupby(['Diagnostico']).agg({'Estado':'count', 'Costo_promedio': 'sum'}).reset_index()\nDpA.rename(columns={'Estado':'Numero de casos','Costo_promedio':'Costo promedio total'}, inplace=True)\nDpA['Costo promedio'] = DpA['Costo promedio total']\/DpA['Numero de casos']\nDpA.sort_values(by='Numero de casos' , ascending=False, inplace=True)\nDpA.head()","324825de":"DpC = hpE.groupby(['Ciudad', 'Diagnostico']).agg({'Estado':'count', 'Costo_promedio': 'sum'}).reset_index()\nDpC.rename(columns={'Estado':'Numero de casos','Costo_promedio':'Costo promedio total'}, inplace=True)\nDpC = DpC.groupby(['Diagnostico']).head(3).sort_values(by=['Diagnostico','Numero de casos'], ascending=False)\nDpC['Costo promedio'] = DpC['Costo promedio total']\/DpC['Numero de casos']\nDpC.head()","5eb35999":"hq = '''\nSELECT *\nFROM bigquery-public-data.cms_medicare.hospital_general_info\n'''\nhq = medicare.query_to_pandas_safe(hq)\nhq.head()","ad46ae41":"hq.columns","036ceffe":"hq['hospital_overall_rating'].replace(to_replace=\"Not Available\",value=np.nan, inplace = True)","5ceb2c65":"hq['hospital_overall_rating']=pd.to_numeric(hq['hospital_overall_rating'])","1bc48e64":"hqe = hq.groupby('state').agg({'city':'count', 'hospital_overall_rating': 'mean'}).reset_index()\nhqe.rename(columns={'city':'Numero de hospitales','hospital_overall_rating':'puntaje promedio de los hospitales'}, inplace=True)\nhqe.sort_values('Numero de hospitales', ascending=False,inplace = True)\nhqe.head()","b0807a90":"fig = px.choropleth(locations=hqe['state'], locationmode=\"USA-states\", color=hqe['Numero de hospitales'], scope=\"usa\", color_continuous_scale = 'turbo',\n                    title='N\u00famero de hospitales por estado')\nfig.show()","3fdd82fa":"fig = px.choropleth(locations=hqe['state'], locationmode=\"USA-states\", color=hqe['puntaje promedio de los hospitales'], \n                    scope=\"usa\", color_continuous_scale = 'turbo',\n                    title='Puntaje promedio de los hospitales por estado')\nfig.show()","5de9ae7d":"nursingq = '''SELECT *\nFROM bigquery-public-data.cms_medicare.nursing_facilities_2014\n'''\nndf = medicare.query_to_pandas_safe(nursingq)\nndf.head()","215cdde6":"fig = make_subplots(rows=2, cols=3, start_cell=\"bottom-left\",\n                    subplot_titles=(\"Beneficiarios de raza blanca\",\n                                    \"Beneficiarios de raza negra\",\n                                    \"Beneficiarios de raza asiatica\",\n                                    \"Beneficiarios de raza hispana\",\n                                    \"Beneficiarios de raza nativa\",\n                                    \"Beneficiarios de otras raza\"))\n\n\nfig.add_trace(go.Histogram(x=ndf['white_beneficiaries'].dropna(), name = \"Beneficiarios de raza blanca\"),\n              row=2, col=1)\n\nfig.add_trace(go.Histogram(x=ndf['black_beneficiaries'].dropna(), name=\"Beneficiarios de raza negra\"),\n              row=2, col=2)\n\nfig.add_trace(go.Histogram(x=ndf['asian_pacific_islander_beneficiaries'].dropna(),name = \"Beneficiarios de raza asiatica\"),\n              row=2, col=3)\n\nfig.add_trace(go.Histogram(x=ndf['hispanic_beneficiaries'].dropna(),name = \"Beneficiarios de raza hispana\"),\n              row=1, col=1)\n\nfig.add_trace(go.Histogram(x=ndf['american_indian_or_alaska_native_beneficiaries'].dropna(), name = \"Beneficiarios de raza nativa\"),\n              row=1, col=2)\n\nfig.add_trace(go.Histogram(x=ndf['other_unknown_beneficiaries'].dropna(), name = \"Beneficiarios de otras raza\"),\n              row=1, col=3)\n\nfig.update_layout(height=1000, width=1300,\n                  title_text=\"Histograma para cada grupo racial\",showlegend=False)\n\n\nfig.show()","1322e78a":"cenfer = ['percent_of_beneficiaries_with_atrial_fibrillation',\n       'percent_of_beneficiaries_with_alzheimers',\n       'percent_of_beneficiaries_with_asthma',\n        'percent_of_beneficiaries_with_copd',\n       'percent_of_beneficiaries_with_cancer',\n       'percent_of_beneficiaries_with_chf',\n       'percent_of_beneficiaries_with_chronic_kidney_disease',\n       'percent_of_beneficiaries_with_depression',\n       'percent_of_beneficiaries_with_diabetes',\n       'percent_of_beneficiaries_with_hyperlipidemia',\n       'percent_of_beneficiaries_with_hypertension',\n       'percent_of_beneficiaries_with_ihd',\n       'percent_of_beneficiaries_with_osteoporosis',\n       'percent_of_beneficiaries_with_ra_oa',\n       'percent_of_beneficiaries_with_schizophrenia',\n       'percent_of_beneficiaries_with_stroke']\n\nfig = make_subplots(rows=4, cols=4, start_cell=\"bottom-left\")\n\nnom = [\"Fibrilaci\u00f3n auricular\",\n                                    \"Alzh\u00e9imer\",\n                                    \"Asma\",\n                                    \"Enfermedad pulmonar obstructiva cr\u00f3nica\",\n                                    \"C\u00e1ncer\",\n                                    \"Insuficiencia cardiaca\",\n                                    \"Enfermedad cr\u00f3nica de los ri\u00f1ones\",\n                                    \"Depresi\u00f3n\",\n                                    \"Diabetes\", \n                                    \"Hiperlipidemia\",\n                                    \"Hipertensi\u00f3n\",\n                                    \"Anemia ferrop\u00e9nica\", \n                                    \"Osteoporosis\",\n                                    \"RA\/OA\",\n                                    \"Esquizofrenia\", \n                                    \"Derrame cerebral\"]\n\ni = 0\nfor r in range(1,5):\n    for c in range(1,5):\n        \n        fig.add_trace(go.Box(y=ndf[cenfer[i]],name = nom[i]),row=r, col=c)\n        i +=1\n        \nfig.update_layout(height=1300, width=1300,\n                  title_text=\"Porcentaje de beneficiarios por tipo de enfermedad\",showlegend=False)\n\nfig.show()        \n\n","2c4e98e1":"hw = ndf.groupby('state')['female_beneficiaries'].mean().reset_index()\nfig = px.choropleth(locations=hw.state, locationmode=\"USA-states\", color=hw['female_beneficiaries'], scope=\"usa\", color_continuous_scale = 'turbo',\n                    title='Mujeres beneficiarias promedio por estado')\nfig.show()","f4100672":"hw = ndf.groupby('state')['female_beneficiaries'].mean().reset_index()\nfig = px.choropleth(locations=hw.state, locationmode=\"USA-states\", color=hw['female_beneficiaries'], scope=\"usa\", color_continuous_scale = 'turbo',\n                    title='Mujeres beneficiarias promedio por estado')\nfig.show()","f8478ee2":"hage = ndf.groupby('state')['average_age'].mean().reset_index()\nfig = px.choropleth(locations=hage.state, locationmode=\"USA-states\", color=hage['average_age'], scope=\"usa\", color_continuous_scale = 'turbo',\n                    title='Edad promedio de los beneficiarios por estado')\nfig.show()","6f01aea6":"hcce = ndf.groupby('state')['average_hcc_score'].mean().reset_index()\nfig = px.choropleth(locations=hcce.state, locationmode=\"USA-states\", color=hcce['average_hcc_score'], scope=\"usa\", color_continuous_scale = 'turbo',\n                    title='Puntaje promedio de riesgo de HCC por estado')\nfig.show()","85e3913f":"cndf = ndf.groupby('state')['total_snf_charge_amount'].sum().reset_index()\ncndf.rename(columns={'total_snf_charge_amount': 'Costo reportado','state':'Estado'}, inplace=True)\n\nfig = px.bar(cndf.sort_values('Costo reportado',ascending=False), x='Estado', y='Costo reportado', title = 'Costo reportado por los centros hospitalizados por estado')\nfig.show()","6f0b05c2":"fig = px.choropleth(locations=cndf.Estado, locationmode=\"USA-states\", color=cndf['Costo reportado'], scope=\"usa\", color_continuous_scale = 'turbo',\n                    title='Costo reportado por los centros hospitalizados por estado')\nfig.show()","03a49938":"# Librerias para los modelos\nfrom sklearn.preprocessing import MinMaxScaler, StandardScaler\nfrom sklearn.decomposition import PCA\nfrom sklearn.cluster import KMeans\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.feature_selection import RFECV\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn.linear_model import ElasticNet","a7da2cf1":"X = ndf.fillna(0)\nX = X.drop(['facility_name', 'street_address', 'city', 'state',\n       'zip_code', 'percent_of_beneficiaries_with_atrial_fibrillation',\n       'percent_of_beneficiaries_with_alzheimers',\n       'percent_of_beneficiaries_with_asthma',\n       'percent_of_beneficiaries_with_cancer',\n       'percent_of_beneficiaries_with_chf',\n       'percent_of_beneficiaries_with_chronic_kidney_disease',\n       'percent_of_beneficiaries_with_copd',\n       'percent_of_beneficiaries_with_depression',\n       'percent_of_beneficiaries_with_diabetes',\n       'percent_of_beneficiaries_with_hyperlipidemia',\n       'percent_of_beneficiaries_with_hypertension',\n       'percent_of_beneficiaries_with_ihd',\n       'percent_of_beneficiaries_with_osteoporosis',\n       'percent_of_beneficiaries_with_ra_oa',\n       'percent_of_beneficiaries_with_schizophrenia',\n       'percent_of_beneficiaries_with_stroke'],axis = 1)\n#'facility_name', 'street_address', 'city', 'state','zip_code'\nX.groupby('provider_id').mean().reset_index()\nX.index = X.provider_id\nX = X.drop(['provider_id'], axis=1)\nscaler = MinMaxScaler()\nscaler.fit(X)\nXs = pd.DataFrame(scaler.transform(X), columns = X.columns, index = X.index)\n","0534dfc1":"X.columns","470445a7":"pca = PCA()\npca.fit(Xs)\npx.line(x= range(1,len(Xs.columns)+1), y = pca.explained_variance_ratio_.cumsum(), title = 'Varianza explicada acumulada por numero de componentes',markers = True)","60c3bd5e":"pca = PCA(n_components = 3)\nXt = pca.fit_transform(Xs)","08fe7620":"px.bar(x= range(1,4), y = pca.explained_variance_ratio_, title = 'Varianza explicada por numero de componentes')","d138b063":"Ssd = []\nK = range(1,6)\nfor k in K:\n    km = KMeans(n_clusters=k,init='k-means++')\n    km = km.fit(Xt)\n    Ssd.append(km.inertia_)\n    \npx.line(x = K, y = Ssd, title= 'Metodo del codo para determinar el k optimo',markers = True)","48291ff3":"kmeans = KMeans(n_clusters=3,init='k-means++',max_iter = 1)\nkmeans = kmeans.fit(Xt)","7776825d":"nombres = []\nfor i in range(4):\n    co = 'Componente ' + str(i)\n    nombres.append(co)","58fa5d62":"pd.DataFrame(Xt)","516f9adc":"Xpk = pd.concat([Xs.reset_index(),pd.DataFrame(Xt)],axis=1)\nXpk.columns.values[-4:] = nombres\nXpk['Cluster'] = kmeans.labels_\nXpk","eae3a15a":"px.imshow(pd.DataFrame(pca.components_, index = Xpk.columns[-4:-1], columns = X.columns),width=1300, height=800)","7133de0b":"px.scatter_matrix(Xpk[Xpk.columns[-4:-1]],color = Xpk.Cluster,height = 2000)","b5f44eae":"X = ndf.fillna(0)\nX1 = X.drop(['provider_id','facility_name', 'street_address', 'city', 'state','zip_code','total_snf_charge_amount',\n       'total_snf_medicare_allowed_amount',\n       'total_snf_medicare_payment_amount',\n       'total_snf_medicare_standard_payment_amount'], axis=1)\n\ny = X['total_snf_charge_amount']","6aa22695":"x_train, x_test, y_train, y_test = train_test_split(X1, y, test_size = 0.2, random_state = 1126)\n\nscalerx = StandardScaler().fit(x_train)\nscalery = StandardScaler().fit(y_train.values.reshape(-1,1))\n\nx_scale = scalerx.scale_\n\ny_train = np.log(y_train)\ny_test = np.log(y_test)\n\nx_train = pd.DataFrame(scalerx.transform(x_train), columns = x_train.columns, index = x_train.index)\nx_test = pd.DataFrame(scalerx.transform(x_test), columns = x_test.columns, index = x_test.index)","6c579373":"rfe = RFECV(LinearRegression(), step=1)\nselector = rfe.fit(x_train, y_train)","47498634":"y_pred = selector.predict(x_train)\ny_pred_test = selector.predict(x_test)\n\nrmse_train = mean_squared_error(y_train, y_pred)\nrmse_test = mean_squared_error(y_test, y_pred_test)\n\ny_test = np.exp(y_test)\ny_pred_test = np.exp(y_pred_test)\n\nprint(\"Train RMSE is {:.4f}\".format(rmse_train))\nprint(\"Test RMSE is {:.4f}\".format(rmse_test))","8f025ace":"temp = pd.DataFrame(x_train.columns,selector.support_).reset_index()\ntemp.rename(columns={'index': 'Seleccionado', 0: 'Nombre'}, inplace=True)\ntemp[temp['Seleccionado']==False].reset_index(drop=True)","1c231fbf":"feat = temp[temp['Seleccionado']==True].reset_index(drop=True)\nfeat.drop('Seleccionado', axis=1,inplace = True)\nfeat['Coeficiente'] = scalerx.inverse_transform(selector.estimator_.coef_)\nfeat.sort_values('Coeficiente',ascending=False)","abec1fb8":"feat = temp[temp['Seleccionado']==True].reset_index(drop=True)\nfeat.drop('Seleccionado', axis=1,inplace = True)\nfeat['Coeficiente'] = scalerx.inverse_transform(selector.estimator_.coef_)\nfig = px.bar(data_frame = feat,x = 'Nombre',y='Coeficiente',width=1300, height=800)\nfig.update_layout(\n    title=\"Coeficiente de las variables para el modelo de regresi\u00f3n multilinear\",\n    xaxis_title=\"Variable del modelo\",\n    yaxis_title=\"Valor del coeficente [USD]\",\n    )","520e8f57":"fig = px.bar(data_frame = feat.iloc[:15],x = 'Nombre',y='Coeficiente',width=1300, height=800)\nfig.update_layout(\n    title=\"Coeficiente de las variables para el modelo de regresi\u00f3n multilinear\",\n    xaxis_title=\"Variable del modelo\",\n    yaxis_title=\"Valor del coeficente [USD]\",\n    )","c5109fa2":"fig = px.bar(data_frame = feat.iloc[15:],x = 'Nombre',y='Coeficiente',width=1300, height=800)\nfig.update_layout(\n    title=\"Coeficiente de las variables para el modelo de regresi\u00f3n multilinear\",\n    xaxis_title=\"Variable del modelo\",\n    yaxis_title=\"Valor del coeficente [USD]\",\n    )","9207e436":"df = pd.DataFrame({'x' : range(len(x_test)), 'Valor' : y_test\/1e6, 'Predecido' : y_pred_test\/1e6})\nfig = px.line(df,x='x',y=df.columns[1:])\nfig.update_layout(\n    title=\"Comparaci\u00f3n del modelo de predicci\u00f3n de costos facturados\",\n    yaxis_title=\"Costo facturado [MMUSD]\",\n    )","432b7887":"pd.DataFrame(X.iloc[139]).reset_index()","23e11a81":"## Centros de enfermer\u00eda especializada","6ae139c2":"Se toma un valor de 11 componentes para realizar el PCA debido a que en este punto se tiene m\u00e1s del 80% de la representatividad de la varianza.","4bfd99f1":"Los medicamentos mas recetados son LEVOTHYROXINE SODIUM, siendo adquirido m\u00e1s en el estado de California, seguido por la Florida y Pensilvania. Le sigue el medicamento HYDROCODONE\/ACETAMINOPHEN, el cual predomina en los estados de Texas, Minesota y Tenessee. En tercer lugar esta el AMLODIPINE BESYLATE, el cual es m\u00e1s consumido en Nueva York y Georgia.","f4268587":"Se puede ver que el modelo presenta un RMSE entre datos de prueba y entrenamiento menor a 0.1, por lo que se considera que es adecuado. ","40c05e83":"## Modelos en sobre el dataset nursing facilities","e90af3a9":"Los estados con mayor puntaje de riesgo HCC promedio son: California, Texas y Florida y en general, los ubicados en la costa este tambien presentan valores promedios altos. Mientras que se observa que los estados ubicados al noroeste tienden a tener un valor m\u00e1s bajo con excepci\u00f3n de Washington.","08c70efb":"Se toma un valor de k = 3 debido al cambio de pendiente observado. ","770d02bb":"Los estados con mayores costos reportados a Medicare, son California, Texas y Florida. Se puede observar un bajo costo en las zonas centrales y noroeste del pa\u00eds.","92f43a1f":"Se genera una matrix donde se puede evidenciar las relaciones entre los componentes.","a33e3682":"Las enfermedades con mayor porcentaje promedio de beneficiarios son: RA\/OA, esquizofren\u00eda, depresi\u00f3n, hipertensi\u00f3n, anemia ferrop\u00e9nica con valores que rondan al rededor del 55%. Por otra parte, se tiene que las que tienen menor porcentaje promedio son: alzh\u00e9imer, enfermedad cr\u00f3nica de los ri\u00f1ones osteoporosis y hiperlipidem\u00eda con valores cercanos al 12%","4b0e627f":"### Cluster","6c190e4f":"Se procede a determinar el numero optimo de clusters para realizar la agrupaci\u00f3n.","d3dd5018":"### Modelo de regresi\u00f3n multilinear","af990842":"Se descarta la posibilidad de implementar una sola grafica de dos componentes ya que el porcentaje de varianza explicada se encuentra distribuido a lo largo de los diferentes componentes.","c5fd4d56":"Se puede ver que existe una predominancia de individuos de raza hispana y negra como beneficiarios que usan los centros de enfermer\u00eda especializada","2fca8668":"Se determinan cuales variables tienen mayor peso dentro de cada componente. Se puede observar que la mayoria de los valores propios m\u00e1s representativos de los grupos se encuentran en las variables asociadas a las enfermedades.","628ce987":"## Hospitales","90c21590":"* Agrupaci\u00f3n de centros de enfermer\u00eda seg\u00fan sus comportamientos (usando K means)\n* Usando t\u00e9cnicas de Procesamiento de Lenguaje Natural, categorizar los diagn\u00f3sticos para detectar tendencias en los mismos.","7285fcff":"* \u00bfCu\u00e1les son las afecciones de diagn\u00f3stico hospitalario m\u00e1s comunes en los Estados Unidos?\n* \u00bfQu\u00e9 ciudades tienen la mayor cantidad de casos para cada condici\u00f3n de diagn\u00f3stico?\n* \u00bfCu\u00e1les son los pagos promedio por estas condiciones en estas ciudades y c\u00f3mo se comparan con el promedio nacional?\n* \u00bfCu\u00e1les son las condiciones de diagn\u00f3stico para pacientes hospitalizados m\u00e1s comunes (Top-50) en los Estados Unidos?\n","7c0043e1":"Los estados con m\u00e1s medicamentos recetados son California, Florida, Texas y Pensilvania. Se puede ver una diferencia entre el lado este y oeste del pa\u00eds, los estados del este tienen una mayor tendencia al uso de medicamentos, con la excepci\u00f3n de California. "}}