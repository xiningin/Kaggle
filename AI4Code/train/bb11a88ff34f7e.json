{"cell_type":{"04dc8ebf":"code","34c8b307":"code","c75346b9":"code","d332dcd0":"code","ea09d0d4":"code","80f79f08":"code","a55009f9":"code","6da092b7":"code","a3160020":"code","2b276b30":"code","45e759f0":"code","e0b1582d":"code","734e67c1":"code","33d789e0":"code","670f2b84":"code","d0636edd":"code","9971539a":"code","7b9023cd":"code","e0726d7a":"code","58d92aaf":"code","781720dd":"code","452c572d":"code","d8a297a8":"code","7f480261":"code","74fadab3":"code","1bc85a45":"code","d5d8d072":"code","3b362cb8":"code","8a8e37c4":"code","e7ec2429":"code","83f9336a":"code","372dedae":"code","796591a5":"code","b032afce":"code","75a9b210":"code","fc9a3c7c":"markdown","054102d9":"markdown","d94784b8":"markdown","a60760e5":"markdown","9faa1621":"markdown","bb71ed57":"markdown","119ab221":"markdown","f7b4a8d5":"markdown","176d882e":"markdown","331deb89":"markdown","67055696":"markdown","16226dfb":"markdown","8f79669d":"markdown","6c53c367":"markdown","87dedf3d":"markdown","e80fd862":"markdown","71ee58c7":"markdown","090ed58f":"markdown","e4de2d3b":"markdown","4d28a81a":"markdown","c21a0acc":"markdown","f3ee1874":"markdown","7257d279":"markdown"},"source":{"04dc8ebf":"import os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","34c8b307":"import pandas as pd\nimport numpy as np","c75346b9":"df_manning = pd.read_csv('..\/input\/peyton\/pm.csv')\ndf_manning = df_manning[['Year', 'Age', 'Att', 'TD', 'QBR', 'Int', 'Cmp', 'Yds', '1D', 'Sk', 'QBrec']]\ndf_manning['Name'] = 'Peyton Manning'","d332dcd0":"df_manning['Cmp%'] = df_manning['Cmp']\/df_manning['Att']\ndf_manning['TD%'] = df_manning['TD']\/df_manning['Att']\ndf_manning['1D%'] = df_manning['1D']\/df_manning['Att']\ndf_manning['YPA'] = df_manning['Yds']\/df_manning['Att']\ndf_manning['Int%'] = df_manning['Int']\/df_manning['Att']\ndf_manning['Sk%'] = df_manning['Sk']\/df_manning['Att']","ea09d0d4":"df_manning.tail()","80f79f08":"df_12 = pd.read_csv('..\/input\/seasons\/2012.csv')\ndf_12 = df_12[['Age', 'Att', 'TD', 'QBR', 'Int', 'Cmp', 'Yds', '1D', 'Sk', 'QBrec', 'Player']]\ndf_12['Year'] = '2012'\n\ndf_13 = pd.read_csv('..\/input\/seasons\/2013.csv')\ndf_13 = df_13[['Age', 'Att', 'TD', 'QBR', 'Int', 'Cmp', 'Yds', '1D', 'Sk', 'QBrec', 'Player']]\ndf_13['Year'] = '2013'\n\ndf_14 = pd.read_csv('..\/input\/seasons\/2014.csv')\ndf_14 = df_14[['Age', 'Att', 'TD', 'QBR', 'Int', 'Cmp', 'Yds', '1D', 'Sk', 'QBrec', 'Player']]\ndf_14['Year'] = '2014'\n\ndf_15 = pd.read_csv('..\/input\/seasons\/2015.csv')\ndf_15 = df_15[['Age', 'Att', 'TD', 'QBR', 'Int', 'Cmp', 'Yds', '1D', 'Sk', 'QBrec', 'Player']]\ndf_15['Year'] = '2015'","a55009f9":"df_12['Cmp%'] = df_12['Cmp']\/df_12['Att']\ndf_12['TD%'] = df_12['TD']\/df_12['Att']\ndf_12['1D%'] = df_12['1D']\/df_12['Att']\ndf_12['YPA'] = df_12['Yds']\/df_12['Att']\ndf_12['Int%'] = df_12['Int']\/df_12['Att']\ndf_12['Sk%'] = df_12['Sk']\/df_12['Att']\n\ndf_13['Cmp%'] = df_13['Cmp']\/df_13['Att']\ndf_13['TD%'] = df_13['TD']\/df_13['Att']\ndf_13['1D%'] = df_13['1D']\/df_13['Att']\ndf_13['YPA'] = df_13['Yds']\/df_13['Att']\ndf_13['Int%'] = df_13['Int']\/df_13['Att']\ndf_13['Sk%'] = df_13['Sk']\/df_13['Att']\n\ndf_14['Cmp%'] = df_14['Cmp']\/df_14['Att']\ndf_14['TD%'] = df_14['TD']\/df_14['Att']\ndf_14['1D%'] = df_14['1D']\/df_14['Att']\ndf_14['YPA'] = df_14['Yds']\/df_14['Att']\ndf_14['Int%'] = df_14['Int']\/df_14['Att']\ndf_14['Sk%'] = df_14['Sk']\/df_14['Att']\n\ndf_15['Cmp%'] = df_15['Cmp']\/df_15['Att']\ndf_15['TD%'] = df_15['TD']\/df_15['Att']\ndf_15['1D%'] = df_15['1D']\/df_15['Att']\ndf_15['YPA'] = df_15['Yds']\/df_15['Att']\ndf_15['Int%'] = df_15['Int']\/df_15['Att']\ndf_15['Sk%'] = df_15['Sk']\/df_15['Att']","6da092b7":"df_15.head()","a3160020":"mean_cmp_12 = np.mean(df_12['Cmp%'])\nmean_td_12 = np.mean(df_12['TD%'])\nmean_1d_12 = np.mean(df_12['1D%'])\nmean_ypa_12 = np.mean(df_12['YPA'])\nmean_int_12 = np.mean(df_12['Int%'])\nmean_sk_12 = np.mean(df_12['Sk%'])\n\nmean_cmp_13 = np.mean(df_13['Cmp%'])\nmean_td_13 = np.mean(df_13['TD%'])\nmean_1d_13 = np.mean(df_13['1D%'])\nmean_ypa_13 = np.mean(df_13['YPA'])\nmean_int_13 = np.mean(df_13['Int%'])\nmean_sk_13 = np.mean(df_13['Sk%'])\n\nmean_cmp_14 = np.mean(df_14['Cmp%'])\nmean_td_14 = np.mean(df_14['TD%'])\nmean_1d_14 = np.mean(df_14['1D%'])\nmean_ypa_14 = np.mean(df_14['YPA'])\nmean_int_14 = np.mean(df_14['Int%'])\nmean_sk_14 = np.mean(df_14['Sk%'])\n\nmean_cmp_15 = np.mean(df_15['Cmp%'])\nmean_td_15 = np.mean(df_15['TD%'])\nmean_1d_15 = np.mean(df_15['1D%'])\nmean_ypa_15 = np.mean(df_15['YPA'])\nmean_int_15 = np.mean(df_15['Int%'])\nmean_sk_15 = np.mean(df_15['Sk%'])","2b276b30":"print('Mean Cmp% for 2015' + ' ' + str(np.mean(df_15['Cmp%'])))\nprint('Mean TD% for 2015' + ' ' + str(np.mean(df_15['TD%'])))\nprint('Mean 1D% for 2015' + ' ' + str(np.mean(df_15['1D%'])))\nprint('Mean YPA% for 2015' + ' ' + str(np.mean(df_15['YPA'])))\nprint('Mean INT% for 2015' + ' ' + str(np.mean(df_15['Int%'])))\nprint('Mean SK% for 2015' + ' ' + str(np.mean(df_15['Sk%'])))","45e759f0":"df_15.loc[df_15['Age'] <= 28, 'Age_weight'] = 1 + (28 -df_15['Age'] )*0.008\ndf_15.loc[df_15['Age'] > 28, 'Age_weight'] = 1 + (28 -df_15['Age'] )*0.004","e0b1582d":"df_manning.loc[df_manning['Age'] <= 28, 'Age_weight'] = 1+(28 -df_manning['Age'] )*0.008\ndf_manning.loc[df_manning['Age'] > 28, 'Age_weight'] = 1+ (28 -df_manning['Age'] )*0.004\n\ndf_12.loc[df_12['Age'] <= 28, 'Age_weight'] = 1+(28 -df_12['Age'] )*0.008\ndf_12.loc[df_12['Age'] > 28, 'Age_weight'] = 1+(28 -df_12['Age'] )*0.004\n\ndf_13.loc[df_13['Age'] <= 28, 'Age_weight'] = 1+(28 -df_13['Age'] )*0.008\ndf_13.loc[df_13['Age'] > 28, 'Age_weight'] = 1+(28 -df_13['Age'] )*0.004\n\ndf_14.loc[df_14['Age'] <= 28, 'Age_weight'] = 1+(28 -df_14['Age'] )*0.008\ndf_14.loc[df_14['Age'] > 28, 'Age_weight'] = 1+(28 -df_14['Age'] )*0.004 ","734e67c1":"df_15.head()","33d789e0":"average_td_rate = np.mean(mean_td_13 + mean_td_12)","670f2b84":"df_manning_proj_data = df_manning.iloc[10:15]\ndf_manning_proj_data['weight'] = np.arange(1,6)\n\nproj_td_manning = 0.964*(sum(df_manning_proj_data['weight']*df_manning_proj_data['TD%']*df_manning_proj_data['Att'])\n                   +5*average_td_rate)\/(sum(df_manning_proj_data['weight']*df_manning_proj_data['Att'])+5)","d0636edd":"print(\"Peyton Manning's projected touchdowns for 2014\" + ':' + ' ' +  str(proj_td_manning*600))","9971539a":"df_manning[df_manning['Year'] == '2014*']","7b9023cd":"df_12['Player'] = df_12['Player'].str.replace(r'*', '')\ndf_12['Player'] = df_12['Player'].str.replace(r'+', '')","e0726d7a":"df_13['Player'] = df_13['Player'].str.replace(r'*', '')\ndf_13['Player'] = df_13['Player'].str.replace(r'+', '')\n\ndf_14['Player'] = df_14['Player'].str.replace(r'*', '')\ndf_14['Player'] = df_14['Player'].str.replace(r'+', '')\n\ndf_15['Player'] = df_15['Player'].str.replace(r'*', '')\ndf_15['Player'] = df_15['Player'].str.replace(r'+', '')","58d92aaf":"from functools import reduce\nplayer_list = reduce(np.intersect1d, (df_12['Player'], df_13['Player'], df_14['Player'],df_15['Player'] )).tolist()\n\nplayer_list","781720dd":"df_12_filter = df_12[df_12['Player'].isin(player_list)]","452c572d":"df_13_filter = df_13[df_13['Player'].isin(player_list)]\ndf_14_filter = df_14[df_14['Player'].isin(player_list)]\ndf_15_filter = df_15[df_15['Player'].isin(player_list)]","d8a297a8":"average_td_rate_total = np.mean(mean_td_13 + mean_td_12 + mean_td_14+ mean_td_15)\naverage_int_rate_total = np.mean(mean_int_12 + mean_int_13 + mean_int_14+ mean_int_15)\naverage_ypa_rate_total = np.mean(mean_ypa_12 + mean_ypa_13 + mean_ypa_14+ mean_ypa_15)\naverage_cmp_rate_total = np.mean(mean_cmp_12 + mean_cmp_13+ mean_cmp_14+ mean_cmp_15)","7f480261":"df_full = pd.concat([df_12_filter, df_13_filter, df_14_filter, df_15_filter])","74fadab3":"df_brady = df_full.groupby(['Player']).get_group('Tom Brady ')\ndf_brady['weight'] = np.arange(2,6)\ndf_brady","1bc85a45":"df_ryan = df_full.groupby(['Player']).get_group('Matt Ryan')\ndf_tan = df_full.groupby(['Player']).get_group('Ryan Tannehill')\ndf_fitz = df_full.groupby(['Player']).get_group('Ryan Fitzpatrick')\ndf_rivers = df_full.groupby(['Player']).get_group('Philip Rivers')\ndf_staf = df_full.groupby(['Player']).get_group('Matthew Stafford')\ndf_flac = df_full.groupby(['Player']).get_group('Joe Flacco')\ndf_cutl = df_full.groupby(['Player']).get_group('Jay Cutler')\ndf_brees = df_full.groupby(['Player']).get_group('Drew Brees')\ndf_cam = df_full.groupby(['Player']).get_group('Cam Newton')\ndf_ben = df_full.groupby(['Player']).get_group('Ben Roethlisberger')\ndf_dalt = df_full.groupby(['Player']).get_group('Andy Dalton')\n\ndf_ryan['weight'] = np.arange(2,6)\ndf_tan['weight'] = np.arange(2,6)\ndf_fitz['weight'] = np.arange(2,6)\ndf_rivers['weight'] = np.arange(2,6)\ndf_staf['weight'] = np.arange(2,6)\ndf_flac['weight'] = np.arange(2,6)\ndf_cutl['weight'] = np.arange(2,6)\ndf_brees['weight'] = np.arange(2,6)\ndf_cam['weight'] = np.arange(2,6)\ndf_ben['weight'] = np.arange(2,6)\ndf_dalt['weight'] = np.arange(2,6)","d5d8d072":"td_brady_16 = 0.960*(sum(df_brady['weight']*df_brady['TD%']*df_brady['Att'])\n                   +5*average_td_rate_total)\/(sum(df_brady['weight']*df_brady['Att'])+5)\n\nint_brady_16 = 0.960*(sum(df_brady['weight']*df_brady['Int%']*df_brady['Att'])\n                   +5*average_int_rate_total)\/(sum(df_brady['weight']*df_brady['Att'])+5)\n\nypa_brady_16 = 0.960*(sum(df_brady['weight']*df_brady['YPA']*df_brady['Att'])\n                   +5*average_ypa_rate_total)\/(sum(df_brady['weight']*df_brady['Att'])+5)\n\ncmp_brady_16 = 0.960*(sum(df_brady['weight']*df_brady['Cmp%']*df_brady['Att'])\n                   +5*average_cmp_rate_total)\/(sum(df_brady['weight']*df_brady['Att'])+5)","3b362cb8":"print('Projected TD for Brady 2016' + ':' + ' ' + str(td_brady_16*450) + '     ' + 'Actual: ' + '28')\nprint('Projected INT for Brady 2016' + ':' + ' ' + str(int_brady_16*450)+ '     ' + 'Actual: ' + '2')\nprint('Projected Yards for Brady 2016' + ':' + ' ' + str(ypa_brady_16*450)+ '     ' + 'Actual: ' + '3554')\nprint('Projected CMP% for Brady 2016' + ':' + ' ' + str(cmp_brady_16*450\/450) +'%' + '     ' + 'Actual: ' + '67.4%')","8a8e37c4":"td_staf_16 = 1.008*(sum(df_staf['weight']*df_staf['TD%']*df_staf['Att'])\n                   +5*average_td_rate_total)\/(sum(df_staf['weight']*df_staf['Att'])+5)\n\nint_staf_16 = 1.008*(sum(df_staf['weight']*df_staf['Int%']*df_staf['Att'])\n                   +5*average_int_rate_total)\/(sum(df_staf['weight']*df_staf['Att'])+5)\n\nypa_staf_16 = 1.008*(sum(df_staf['weight']*df_staf['YPA']*df_staf['Att'])\n                   +5*average_ypa_rate_total)\/(sum(df_staf['weight']*df_staf['Att'])+5)\n\ncmp_staf_16 = 1.008*(sum(df_staf['weight']*df_staf['Cmp%']*df_staf['Att'])\n                   +5*average_cmp_rate_total)\/(sum(df_staf['weight']*df_staf['Att'])+5)\n\n\nprint('Projected TD for Stafford 2016' + ':' + ' ' + str(td_staf_16*600) + '     ' + 'Actual: ' + '24')\nprint('Projected INT for Stafford 2016' + ':' + ' ' + str(int_staf_16*600)+ '     ' + 'Actual: ' + '10')\nprint('Projected Yards for Stafford 2016' + ':' + ' ' + str(ypa_staf_16*600)+ '     ' + 'Actual: ' + '4327')\nprint('Projected CMP% for Stafford 2016' + ':' + ' ' + str(cmp_staf_16*600\/600) +'%' + '     ' + 'Actual: ' + '65.3%') ","e7ec2429":"QBR_brady = 100*(((cmp_brady_16*450\/450 - 0.3) + 0.25*(ypa_brady_16 -3)+ 20*td_brady_16 + (2.375 - int_brady_16*25))\/6)\nprint('Projected QBR for Brady 2016:' + ' ' + str(QBR_brady) + '     ' + 'Actual:' + ' ' + '79.4')","83f9336a":"QBR_staf = 100*(((cmp_staf_16*600\/600 - 0.3) + 0.25*(ypa_staf_16 -3)+ 20*td_staf_16 + (2.375 - int_staf_16*25))\/6)\nprint('Projected QBR for Stafford 2016:' + ' ' + str(QBR_staf) + '     ' + 'Actual:' + ' ' + '65.2')","372dedae":"proj_td_manning = 0.964*(sum(df_manning_proj_data['weight']*df_manning_proj_data['TD%']*df_manning_proj_data['Att'])\n                   +5*average_td_rate)\/(sum(df_manning_proj_data['weight']*df_manning_proj_data['Att'])+5)\n\nproj_int_manning = 0.964*(sum(df_manning_proj_data['weight']*df_manning_proj_data['Int%']*df_manning_proj_data['Att'])\n                   +5*average_td_rate)\/(sum(df_manning_proj_data['weight']*df_manning_proj_data['Att'])+5)\n\nproj_ypa_manning = 0.964*(sum(df_manning_proj_data['weight']*df_manning_proj_data['YPA']*df_manning_proj_data['Att'])\n                   +5*average_td_rate)\/(sum(df_manning_proj_data['weight']*df_manning_proj_data['Att'])+5)\n\nproj_cmp_manning = 0.964*(sum(df_manning_proj_data['weight']*df_manning_proj_data['Cmp%']*df_manning_proj_data['Att'])\n                   +5*average_td_rate)\/(sum(df_manning_proj_data['weight']*df_manning_proj_data['Att'])+5)\n\n\n\nQBR_manning = 100*(((proj_cmp_manning*600\/600 - 0.3) + 0.25*(proj_ypa_manning -3)+ 20*proj_td_manning + (2.375 - proj_int_manning*25))\/6)\nprint('Projected QBR for Manning 2014:' + ' ' + str(QBR_manning) + '     ' + 'Actual:' + ' ' + '72.0')\n","796591a5":"QBR_new_brady = 100*(((cmp_brady_16*450\/450)*0.2 + (ypa_brady_16)*0.1+ td_brady_16*0.4 - int_brady_16*0.6))\nprint('Revised Projected QBR for Brady 2016:' + ' ' + str(QBR_new_brady)+ '     ' + 'Actual:' + ' ' + '97.7')","b032afce":"QBR_new_staff = 100*(((cmp_staf_16*600\/600)*0.2 + (ypa_staf_16)*0.1+ td_staf_16*0.4 - int_staf_16*0.6))\nprint('Revised Projected QBR for Stafford 2016:' + ' ' + str(QBR_new_staff)+ '    ' + 'Actual:' + ' ' + '86.5')","75a9b210":"QBR_new_manning = 100*(((proj_cmp_manning*600\/600)*0.2 + (proj_ypa_manning)*0.1+ proj_td_manning*0.4 - proj_int_manning*0.6))\nprint('Revised Projected QBR for Manning 2014:' + ' ' + str(QBR_new_manning)+ '     ' + 'Actual:' + ' ' + '93.3')","fc9a3c7c":"The projection gives us the projected td rate; multipleing by the number of attempts (Peyton seems to attemp close to 600 passes a year)- we get his projected # of TDs for the 2014 season using data from 2009-2013 and the average td rate for 2013. ","054102d9":"Manning retired in 2015 - so I'll take data from seasons before that (skipping 2011 - when he had his surgery) and project his stats forward. I'm taking the top 30 QBs from each year. ","d94784b8":"Next, I'll calculate 2 QB ratings for Peyton and the other QBs and compare what they both say about them.","a60760e5":"I need the league average rates to improve the projections:","9faa1621":"Next, I'll add the weight for player age: if the player is younger tha 28 the weights are (28 - age) * 0.008. If the player is older than 28, then the adjustment is equal to (28 - age) * 0.004.","bb71ed57":"TD projection:","119ab221":"I'm cheating a little bit, but Brady only threw 432 pass attempts in 2016; so I'll use 450 Att for the projections. As he's been doing his whole career - Brady beats the projections. ","f7b4a8d5":"So the actual projections say Brady was 18% better than Stafford and 9% better than Manning, and Manning was 9% better than Stafford.\n\nThe projected stats say Brady was 8% better than Stafford; and Manning was 6% better than Brady and 13% better than Stafford. ","176d882e":"Manning's data:","331deb89":"At the end of the project I would also like to project his year-to-year completion percentage, interception rate, ect - and using this data I could shadow\/create my own QBR rating; and compare Manning against other QBs in the league. ","67055696":"Next, I need to do this for all the QBs from 2012-2015 and project them a year forward. I'll compare the results with the 2016 data; and then I'll use Manning's data to project him to 2016 (2015 wasn't a full season, so I'll toss out that data). The idea will be to do projections for all the rate states (i.e not just TD %) and try to calculate the 2016 QBR ratings, as well as my own QB rating system which weights the key features differently (QBR uses YPA, TD%, INT%, CMP%). An article on how QBR is calculated is found here: https:\/\/medium.com\/@gzil\/how-to-calculate-nfl-passer-rating-using-a-formula-in-excel-or-google-sheets-54eb07246d1e ","16226dfb":"I'll compare these values with a different QBR rating; I'm adding the features first down percentage and sack percentage. I'm also going to weight the features differently (for example, it makes sense to weight YPA lower, because Yards can depend on the receivers you have). ","8f79669d":"First - cleaning the strings in the Player Column - I need to find the QBs that are common to each season I have.","6c53c367":"I looked at these two sites for a beginner's guide to projection: https:\/\/blogs.fangraphs.com\/fangraphs-prep-build-and-test-your-own-projection-system\/ and https:\/\/www.basketball-reference.com\/about\/projections.html?fbclid=IwAR3n6JWLxIboerh28X4IwjFGwg4vgMp7Hz5wUQtbH4HfvOJEBjVQFWh_JP0 . Data was taken from Football reference, for example: https:\/\/www.pro-football-reference.com\/players\/M\/MannPe00.htm .","87dedf3d":"Now I have a Dataframe with all the players in my players_list, with data from 2012-2015. I can now iterate (or hard code) groupby statements to calculate the projections for each player; basically copying the same formula as I did for Peyton Manning above. ","e80fd862":"Feel free to fork this notebook and experiment with projections for some of the other QBs in the Dataset (Brees, Mat Ryan, ect).","71ee58c7":"As we can see, this simple projection system performs quite well! It's not perfect though - Manning beats his projections by 1 TD (unsurprising given a large reason for his success was his mind, not his athleticism).","090ed58f":"The recently traded Matt Stafford was going into his 28 year old season. ","e4de2d3b":"I want to implement a simple projection system to model the number of touchdowns Peyton Manning is expected to throw as he aged (here I'm assuming his neck injury did not presist). I'm implemening a weighted mean using his touchdown rate and the league average td weight; along with an age regression factor. ","4d28a81a":"To improve on the projections, I need to learn more about MCMC methods and Bayesian statistics (see some of my other notebooks for what I've learned so far).","c21a0acc":"Using the data from before 2014 I'm going to predict Peyton's 2014 season and compare it with the data we have. I'll use the 5\/4\/3 rule, meaning I'll weight the 2013 season by 5, the 2012 season by 4, and the 2011 season by 3 (this is the method first reccomended by Tom Tango for the Marcel the Monkey projection system). I'll make the regression weight as large as the previous season's data (so 5). I'm also multiplying by his age curve weight.","f3ee1874":"I haven't implemented the Sack percentage and first down percentage yet - I'll continue to work on this revised QBR rating in the future. I'll also work on some visualizations. ","7257d279":"These QBs (12 of them) were in the top 30 for QBs between 2012 - 2015. I'll project their stats forward and ignore the other QBs. "}}