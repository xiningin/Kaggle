{"cell_type":{"b316c224":"code","c01bd797":"code","2b94b7b1":"code","eb44fbb9":"code","646ef2a9":"code","dec2c1d9":"code","32fe8c08":"code","26a5abc1":"code","009b952f":"code","d9a7a62e":"code","5dc53732":"code","ada98f70":"code","54e6428b":"code","52a68221":"code","a5dc5304":"markdown","2f3ee880":"markdown","9ccfdecc":"markdown","279b7d7f":"markdown","c2b04ea9":"markdown","ea51de0c":"markdown","f9a73d61":"markdown","4b2ea647":"markdown","1ae6648b":"markdown","293670ff":"markdown","284b2bab":"markdown"},"source":{"b316c224":"import pandas as pd\nimport numpy as np","c01bd797":"ls ..\/input","2b94b7b1":"# csv\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\ntrain = pd.read_csv('..\/input\/train.csv')\ntest = pd.read_csv('..\/input\/test.csv')\nsample_submission = pd.read_csv('..\/input\/gender_submission.csv')","eb44fbb9":"train.head()","646ef2a9":"# Sex\u3068Embarked\u306eOne-Hot\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\ntrain = pd.get_dummies(train, columns=['Sex', 'Embarked'])\ntest = pd.get_dummies(test, columns=['Sex', 'Embarked'])\n # \u88dc\u8db3 : Sex\u306f2\u5024\u306a\u306e\u3067\u3001One-Hot\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u306f\u4e0d\u8981(\u3057\u3066\u3082\u3044\u3044\u304c\u666e\u901a\u306f\u3057\u306a\u3044)\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u884c\u306a\u3063\u3066\u3044\u307e\u3059\n\n# \u4e0d\u8981\u306a\u5217\u306e\u524a\u9664\ntrain.drop(['PassengerId', 'Name', 'Cabin', 'Ticket'], axis=1, inplace=True)\ntest.drop(['PassengerId', 'Name', 'Cabin', 'Ticket'], axis=1, inplace=True)\n\n# train\u306e\u8868\u793a\ndisplay(train.head())","dec2c1d9":"X_train = train.drop(['Survived'], axis=1)  # X_train\u306ftrain\u306eSurvived\u5217\u4ee5\u5916\nY_train = train['Survived']  # Y_train\u306ftrain\u306eSurvived\u5217","32fe8c08":"import lightgbm as lgb\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import accuracy_score\n\n# X_train\u3068Y_train\u3092train\u3068valid\u306b\u5206\u5272\ntrain_x, valid_x, train_y, valid_y = train_test_split(X_train, Y_train, test_size=0.33, random_state=0)\n\n# LightGBM\u306e\u5206\u985e\u5668\u3092\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\ngbm = lgb.LGBMClassifier(objective='binary')\n\n# train\u3068valid\u3092\u6307\u5b9a\u3057\u5b66\u7fd2\ngbm.fit(train_x, train_y, eval_set = [(valid_x, valid_y)],\n        early_stopping_rounds=20,  # 20\u56de\u9023\u7d9a\u3067loss\u304c\u4e0b\u304c\u3089\u306a\u304b\u3063\u305f\u3089\u7d42\u4e86\n        verbose=10  # 10round\u6bce\u306b\u3001loss\u3092\u8868\u793a\n) ;","26a5abc1":"# valid_x\u306b\u3064\u3044\u3066\u63a8\u8ad6\noof = gbm.predict(valid_x, num_iteration=gbm.best_iteration_)  # oof\u306fout of fold\nprint('score', round(accuracy_score(valid_y, oof)*100,2), '%')  # \u6b63\u89e3\u7387\u306e\u8868\u793a\n\n# out of fold\u306f\u5b66\u7fd2\u306b\u4f7f\u3063\u3066\u3044\u308b\u30c7\u30fc\u30bf\u4ee5\u5916\u306e\u4e88\u6e2c","009b952f":"# test\u306e\u4e88\u6e2c\ntest_pred = gbm.predict(test, num_iteration=gbm.best_iteration_)  # test\u306e\u4e88\u6e2c\nsample_submission['Survived'] = test_pred  # sample_submission\u306eSurvived\u5217\u3092test_pred\u306b\u7f6e\u304d\u63db\u3048\nsample_submission.to_csv('train_test_split.csv', index=False)  # csv\u30d5\u30a1\u30a4\u30eb\u306e\u66f8\u304d\u51fa\u3057","d9a7a62e":"# 3\u5206\u5272\u4ea4\u5dee\u691c\u8a3c\u3092\u6307\u5b9a\u3057\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\nfrom sklearn.model_selection import KFold\nkf = KFold(n_splits=3)  # 3\u5206\u5272\u4ea4\u5dee\u691c\u8a3c\u306e\u305f\u3081\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\n\n# \u30b9\u30b3\u30a2\u3068\u30e2\u30c7\u30eb\u3092\u683c\u7d0d\u3059\u308b\u30ea\u30b9\u30c8\nscore_list = []\nmodels = []\n\nfor fold_, (train_index, valid_index) in enumerate(kf.split(X_train, Y_train)):\n    train_x = X_train.iloc[train_index]\n    valid_x = X_train.iloc[valid_index]\n    train_y = Y_train[train_index]\n    valid_y = Y_train[valid_index]\n    \n    print(f'fold{fold_ + 1} start')\n\n    gbm = lgb.LGBMClassifier(objective='binary')\n    gbm.fit(train_x, train_y, eval_set = [(valid_x, valid_y)],\n                early_stopping_rounds=20,\n                verbose= -1) # \u5b66\u7fd2\u306e\u72b6\u6cc1\u3092\u8868\u793a\u3057\u306a\u3044\n    \n    oof = gbm.predict(valid_x, num_iteration=gbm.best_iteration_)\n    score_list.append(round(accuracy_score(valid_y, oof)*100,2))\n    models.append(gbm)  # \u5b66\u7fd2\u304c\u7d42\u308f\u3063\u305f\u30e2\u30c7\u30eb\u3092\u30ea\u30b9\u30c8\u306b\u5165\u308c\u3066\u304a\u304f\n    print(f'fold{fold_ + 1} end\\n' )\nprint(score_list, '\u5e73\u5747score', np.mean(score_list), \"%\")  ","5dc53732":"# test\u306e\u4e88\u6e2c\ntest_pred = np.zeros((len(test), 3))  # \u884c:len(test), \u5217:3\u306eall zero\u306e\u914d\u5217\u3092\u7528\u610f\n\nfor fold_, gbm in enumerate(models):  # \u5b66\u7fd2\u305a\u307f\u306emodel\u3092gbm\u306b\u5165\u308c\u308b\n    pred_ = gbm.predict(test, num_iteration=gbm.best_iteration_)  # test\u306e\u4e88\u6e2c\n    test_pred[:, fold_] = pred_  # \uff11\u56de\u76ee\u306f0\u5217\u76ee\u30012\u56de\u76ee\u306f1\u5217\u76ee\u30012\u56de\u76ee\u306f3\u5217\u76ee\u306b\u683c\u7d0d\n\npred = (np.mean(test_pred, axis=1) > 0.5).astype(int)  # \u5e73\u5747\u3092\u3068\u3063\u3066\u30010\u3068\uff11\u306b\u5909\u63db\nsample_submission['Survived'] = pred\nsample_submission.to_csv('3-fold_cross-validation.csv',index = False)","ada98f70":"gbm.get_params()","54e6428b":"# GridSearchCV\u3092import\nfrom sklearn.model_selection import GridSearchCV\n\ngbm = lgb.LGBMClassifier(objective='binary')\n\n# \u8a66\u884c\u3059\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u7f85\u5217\u3059\u308b\nparams = {\n    'max_depth': [2, 3, 4, 5],\n    'reg_alpha': [0, 1, 10, 100],\n    'reg_lambda': [0, 1, 10, 100],\n}\n\ngrid_search = GridSearchCV(\n                           gbm,  # \u5206\u985e\u5668\u3092\u6e21\u3059\n                           param_grid=params,  # \u8a66\u884c\u3057\u3066\u307b\u3057\u3044\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6e21\u3059\n                           cv=3,  # 3\u5206\u5272\u4ea4\u5dee\u691c\u8a3c\u3067\u30b9\u30b3\u30a2\u3092\u78ba\u8a8d\n                          )\n\ngrid_search.fit(X_train, Y_train)  # \u30c7\u30fc\u30bf\u3092\u6e21\u3059\n\nprint(grid_search.best_score_)  # \u30d9\u30b9\u30c8\u30b9\u30b3\u30a2\u3092\u8868\u793a\nprint(grid_search.best_params_)  # \u30d9\u30b9\u30c8\u30b9\u30b3\u30a2\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8868\u793a","52a68221":"# \u30b9\u30b3\u30a2\u3068\u30e2\u30c7\u30eb\u3092\u683c\u7d0d\u3059\u308b\u30ea\u30b9\u30c8\nscore_list = []\ntest_pred = np.zeros((len(test), 3))\n\n\nfor fold_, (train_index, valid_index) in enumerate(kf.split(X_train, Y_train)):\n    train_x = X_train.iloc[train_index]\n    valid_x = X_train.iloc[valid_index]\n    train_y = Y_train[train_index]\n    valid_y = Y_train[valid_index]\n    \n    print(f'fold{fold_ + 1} start')\n\n    gbm = lgb.LGBMClassifier(objective='binary', max_depth=3, reg_alpha=1,\n                             reg_lambda=0)\n    gbm.fit(train_x, train_y,\n            eval_set = [(valid_x, valid_y)],\n            early_stopping_rounds=20,\n            verbose= -1)\n    \n    oof = gbm.predict(valid_x, num_iteration=gbm.best_iteration_)\n    score_list.append(round(accuracy_score(valid_y, oof)*100,2))\n    test_pred[:, fold_] = gbm.predict(test, num_iteration=gbm.best_iteration_)\n    print(f'fold{fold_ + 1} end\\n' )\nprint(score_list, '\u5e73\u5747score', np.mean(score_list))\npred = (np.mean(test_pred, axis=1) > 0.5).astype(int)\nsample_submission['Survived'] = pred\nsample_submission.to_csv('glid_search.csv', index=False)  # score\u306f0.77511","a5dc5304":"![](https:\/\/cdn.discordapp.com\/attachments\/507208726864855060\/577789809330880532\/20190514_.012.jpeg)","2f3ee880":"## 5.4 \u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u8abf\u6574","9ccfdecc":"## 5.1 \u524d\u51e6\u7406\n### 5.1.1 \u30ab\u30c6\u30b4\u30ea\u5909\u6570\u306e\u5909\u63db","279b7d7f":"# \u53c2\u8003\u8cc7\u6599","c2b04ea9":"![](https:\/\/cdn.discordapp.com\/attachments\/507208726864855060\/577789829518065675\/20190514_.014.jpeg)","ea51de0c":"## 5.2 \u30db\u30fc\u30eb\u30c9\u30a2\u30a6\u30c8\u6cd5\u3067\u306e\u5b66\u7fd2\u30fb\u63a8\u8ad6","f9a73d61":"# \u6b21\u306eNotebook\nhttps:\/\/www.kaggle.com\/currypurin\/titanic-lightgbm-ex","4b2ea647":"# \u30bf\u30a4\u30bf\u30cb\u30c3\u30af\u306e\u30c7\u30fc\u30bf\u3067\u8a66\u3059","1ae6648b":"## 5.3 3\u5206\u5272\u4ea4\u5dee\u691c\u8a3c\u3067\u306e\u5b66\u7fd2","293670ff":"input\u30d5\u30a9\u30eb\u30c0\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8868\u793a","284b2bab":"- [Parameters Tuning](https:\/\/lightgbm.readthedocs.io\/en\/latest\/Parameters-Tuning.html)\n  - \u30d1\u30e9\u30e1\u30fc\u30bf\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\n- [LightGBM\u2019s documentation!](https:\/\/lightgbm.readthedocs.io\/en\/latest\/)\n  - LightGBM\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n- [tutorial of kaggle ver3 ch5 optuna\\_ex](https:\/\/www.kaggle.com\/)\n  - optuna\u3067\u306e\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u306e\u4f8b"}}