{"cell_type":{"0477546a":"code","a011309c":"code","bca03444":"code","d56b491a":"code","cb91ffae":"code","d12a9270":"code","c4593bfd":"code","1942a536":"code","f29da131":"code","db7d3a2a":"code","b2ef50e0":"markdown","2d6b4a51":"markdown"},"source":{"0477546a":"#!apt-get install libxss1\n#!apt -y install libgconf2-4\n#!conda install -y -c plotly plotly-orca # for exporting plots\n#!conda install -y -c plotly python-kaleido","a011309c":"!pip install -U kaleido","bca03444":"import skimage.io\nimport numpy as np\nimport matplotlib.pyplot as plt","d56b491a":"d = skimage.io.imread('..\/input\/3d_scenes\/3d_scenes\/img00020.png')\nimg = skimage.io.imread('..\/input\/3d_scenes\/3d_scenes\/img00020.tiff')\nd = d.max()-d","cb91ffae":"fig, ax = plt.subplots(1,2, figsize=(20,10))\nax[0].text(50, 100, 'original image', fontsize=16, bbox={'facecolor': 'white', 'pad': 6})\nax[0].imshow(img)\n\nax[1].text(50, 100, 'depth map', fontsize=16, bbox={'facecolor': 'white', 'pad': 6})\nax[1].imshow(d)","d12a9270":"d = np.flipud(d)\nimg = np.flipud(img)","c4593bfd":"from PIL import Image as PImage\nimport plotly.graph_objects as go\nfrom plotly import tools\nimport plotly.offline\ndef create_rgb_surface(rgb_img, depth_img, depth_cutoff=20, **kwargs):\n    rgb_img = rgb_img.swapaxes(0, 1)[:, ::-1]\n    depth_img = depth_img.swapaxes(0, 1)[:, ::-1]\n    eight_bit_img = PImage.fromarray(rgb_img).convert('P', palette='WEB', dither=None)\n    idx_to_color = np.array(eight_bit_img.getpalette()).reshape((-1, 3))\n    colorscale=[[i\/255.0, \"rgb({}, {}, {})\".format(*rgb)] for i, rgb in enumerate(idx_to_color)]\n    depth_map = depth_img.copy().astype('float')\n    depth_map[depth_map<depth_cutoff] = np.nan\n    return go.Surface(\n        z=depth_map,\n        surfacecolor=np.array(eight_bit_img),\n        cmin=0, \n        cmax=255,\n        colorscale=colorscale,\n        showscale=False,\n        **kwargs\n    )","1942a536":"fig = go.Figure(\n    data=[create_rgb_surface(img, \n                             d,\n                             10,\n                             contours_z=dict(show=True, project_z=True, highlightcolor=\"limegreen\"),\n                             opacity=1.0\n                            )],\n    layout_title_text=\"3D Surface\"\n)\n#fig.update_layout(scene_camera_eye=dict(x=0, y=-1, z=.5), scene_camera_up=dict(x=0,y=0,z=1))\nfig","f29da131":"from IPython.display import FileLink\nplotly.offline.plot(fig, filename = 'rgbd.html', auto_open=False)\nFileLink('rgbd.html')","db7d3a2a":"fig.write_image(\"figure_{:04d}.png\".format(0), height=2048, width=2048, engine=\"kaleido\")","b2ef50e0":"# RGB Surface Code\nHere is the code using PIL and the web palette to convert our images into nice plotly plots","2d6b4a51":"# View 3D Surfaces\n- Using Plotly\n- 8-bit GIF LUTs"}}