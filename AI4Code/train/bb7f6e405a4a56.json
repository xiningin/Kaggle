{"cell_type":{"f73ff9a0":"code","dd5a6035":"code","c08a7388":"code","e79d3cf6":"code","a035cdaf":"code","ff35ef99":"code","63b9d741":"code","f4f4dd7b":"code","042c88e8":"code","7dba081c":"code","6425c098":"code","20370865":"code","5310e392":"code","92e9cb9b":"code","849bb7da":"code","a644ff14":"code","dbcaa511":"code","f7f8e8f9":"code","19c3bc97":"code","685308fa":"code","62d64f8a":"code","4ec74ee7":"code","8e9cc6a0":"code","34fb423c":"code","1f8d08b2":"code","cf9724e7":"code","6dc63a73":"code","0d498873":"markdown","653cf02a":"markdown","fd0c4269":"markdown","cb0d7095":"markdown","7d5b1373":"markdown","56266332":"markdown","ea8e7e0b":"markdown","eedb2ce8":"markdown","ba1ab817":"markdown","b5e92573":"markdown","ed19b05b":"markdown","f9408ef4":"markdown","07115b11":"markdown","3325edbf":"markdown","2197d8b8":"markdown","2d2a6453":"markdown","06bd49b8":"markdown","17c0b448":"markdown","d8efdb95":"markdown","42337d38":"markdown","3118fe92":"markdown"},"source":{"f73ff9a0":"# First of all, let's import the necessary libraries.\nimport datetime as dt\nimport pandas as pd\npd.set_option('display.max_columns', None)\npd.set_option('display.max_rows', None)\npd.set_option('display.float_format', lambda x: '%.5f' % x)","dd5a6035":"# Read the 2010-2011 data in the Online Retail II excel. Make a copy of the dataframe you created.\n\ndf_= pd.read_csv('..\/input\/online-retail-ii\/online_retail_II.csv')\ndf= df_[df_[\"InvoiceDate\"] >= '2010-12-01']","c08a7388":"df.head()","e79d3cf6":"# When I look at the data set, I see a column placed like an anonymous index in the 0th. column. Let's delete this.\ndf = df.drop(df.columns[[0]], axis=1)\ndf.head()","a035cdaf":"# 2. Examine the descriptive statistics of the data set.\n\ndf.describe().T","ff35ef99":"# When we look at Describe - values and contradictory observations are observed.","63b9d741":"# Are there any missing observations in the dataset? If yes, how many missing observations in each variable?\n\ndf.isnull().sum()","f4f4dd7b":"# Remove the missing observations from the data set. Use the 'inplace=True' parameter for subtraction.\ndf.dropna(inplace=True)","042c88e8":"# How many unique products?\nprint(df['StockCode'].nunique())\nprint(df['Description'].nunique())\n# Values were different. I guess some names are the same but maybe they are perceived as a \n#different product due to the case sensitivity. So I think StockCode gives more accurate value.","7dba081c":"# How many of each product are there?\ndf['Description'].value_counts().head()","6425c098":"# Rank the 5 most ordered products from most to least.\ndf.groupby('Description').agg({\"Quantity\" : \"sum\"}).sort_values(\"Quantity\",ascending=False).head()\n","20370865":"df[\"TotalPrice\"] = df[\"Quantity\"] * df[\"Price\"]\ndf.head()","5310e392":"# We create an empty dataframe named rfm_df.\nrfm_df = pd.DataFrame()\nrfm_df.head()","92e9cb9b":"# We create rfm_df by taking the groupby according to the customer ID and aggregation the sum of the total price.\nrfm_df = df.groupby('Customer ID').agg({'TotalPrice': lambda TotalPrice: TotalPrice.sum()})\n\nrfm_df.reset_index(inplace=True)\nrfm_df.head()","849bb7da":"# We are changing the name of TotalPrice to monetary.\nrfm_df.columns = [\"Customer ID\", \"monetary\"]\nrfm_df.head()","a644ff14":"rfm_df[\"monetary\"].describe().T","dbcaa511":"# As you can see, there are also negative monetary values, the monetary value of those who make \n# refund transactions as much as they bought will be zero. we have to remove them from our data.\nrfm_df = rfm_df[rfm_df[\"monetary\"] > 0]","f7f8e8f9":"# After calculating the Monetary values, in order to calculate the other RFM metrics of these Customer Ids, we need to reduce \n# the CustomerIDs from the main df by taking the Customer Ids for which we calculated the Monetary value. \n# The reason for this is that the customer IDs, for which we make the healthiest monetary account,are the customers that give \n# the healthiest results for us, so we need to reduce them to them.\nlist_2 = rfm_df[\"Customer ID\"]","19c3bc97":"df = df[~df[\"Invoice\"].str.contains(\"C\", na=False)]","685308fa":"# CustomerIds in the monetary account are reduced in the main df by using the \" isin \" structure.\ndf = df.loc[df[\"Customer ID\"].isin(list_2)]\ndf.head()","62d64f8a":"import datetime as dt\ndf['InvoiceDate']=pd.to_datetime(df['InvoiceDate'])\ndf[\"InvoiceDate\"].max()\n# Timestamp('2011-12-09 12:50:00')\n# We accept the date we refer to, 2 days after the maximum date in order to avoid errors in the transactions.\ntoday_date = dt.datetime(2011, 12, 11)\n\nrfm_df_2 = df.groupby('Customer ID').agg({'InvoiceDate': lambda date: (today_date- date.max()).days,\n                                     'Invoice': lambda invoice: invoice.nunique()})\n\nrfm_df_2.reset_index(inplace=True)\nrfm_df_2.columns= [\"Customer ID\",'recency','frequency']\nrfm_df_2.head()","4ec74ee7":"rfm = rfm_df.merge(rfm_df_2, on=\"Customer ID\", how=\"left\")\nrfm.head()","8e9cc6a0":"rfm['recency_score']= pd.qcut(rfm['recency'],5,labels=[5,4,3,2,1])\nrfm['frequency_score']=pd.qcut(rfm[\"frequency\"].rank(method='first'),5, labels=[1,2,3,4,5])\nrfm[\"monetary_score\"] = pd.qcut(rfm['monetary'], 5, labels=[1, 2, 3, 4, 5])\nrfm.head()","34fb423c":"rfm.describe().T","1f8d08b2":"\nrfm[\"RFM_SCORE\"] = (rfm['recency_score'].astype(str) +\n                    rfm['frequency_score'].astype(str))\n\nrfm.head()","cf9724e7":"seg_map = {\n    r'[1-2][1-2]': 'hibernating',\n    r'[1-2][3-4]': 'at_Risk',\n    r'[1-2]5': 'cant_loose',\n    r'3[1-2]': 'about_to_sleep',\n    r'33': 'need_attention',\n    r'[3-4][4-5]': 'loyal_customers',\n    r'41': 'promising',\n    r'51': 'new_customers',\n    r'[4-5][2-3]': 'potential_loyalists',\n    r'5[4-5]': 'champions'\n}\nrfm['segment'] = rfm['RFM_SCORE'].replace(seg_map, regex=True)\n\nrfm.head()","6dc63a73":"rfm['segment'].value_counts()\n","0d498873":"# ***Data Preparation***","653cf02a":"# ***VARIABLES***\n* **InvoiceNo**: Invoice number. Nominal, a 6-digit integral number uniquely assigned to each transaction. If this code starts with letter \u2018c\u2019, it indicates a cancellation.\n* **StockCode**: Product (item) code. Nominal, a 5-digit integral number uniquely assigned to each distinct product.\n* **Description**: Product (item) name. Nominal.\n* **Quantity**: The quantities of each product (item) per transaction. Numeric.\n* **InvoiceDate**: Invoice Date and time. Numeric, the day and time when each transaction was generated.\n* **UnitPrice**: Unit price. Numeric, Product price per unit in sterling.\n* **CustomerID**: Customer number. Nominal, a 5-digit integral number uniquely assigned to each customer.\n* **Country**: Country name. Nominal, the name of the country where each customer resides.","fd0c4269":"# **Comment:**\nHibernating: In order to revive the customers in this segment, we need to re-introduce the company and the products, and convey a feature of this company that is different from other companies to the customer. This can be done with an email or sms. In this way, we can move the customer to other segments.\n\nAt risk: Customers in this segment have a high shopping frequency, but they seem not to have shopped for a long time. For this reason, a feasibility study should be carried out according to the item that these customers spend the most and a long-term contract campaign should be organized in the form of \"% \u00d7 discount special for you\". In this way, it can be attracted to the loyal customer segment.\n\nPot. Loyal customer: Customers in this segment are on the way to becoming loyal customers, but their shopping frequency is low. For this reason, other products that may be related to the products purchased by these customers and that have a high price per item should be promoted and we should increase the amount spent by this customer per transaction.","cb0d7095":"# **It has been merged by bringing the Monetary value and the most healthy RFM metrics have been created.**","7d5b1373":"\n# **LET'S CREATE AND CONVERT RFM POINTS IN ONE VARIABLE.**\n\u25aa Let's convert Innovation, Frequency and Monetary metrics into scores between 1-5 with the help of qcut.\n\n\u25aa Let's record these scores as novelty_score, frequency_score, and monetary_score.\n\n\u25aa Let's express the value of 2 different variables as one variable and save it as RFM_SCORE.\n\nExemple; Let's create the recency_score, frequency_score scores of 5, 2, respectively, in separate variables by naming the RFM_SCORE variable.","56266332":"\n# **CALCULATING RFM METRICS**\n \u25aa Make the definitions of Recency, Frequency and Monetary.\n \u25aa Customer specific Recency, Frequency and Monetary metrics with groupby, agg and lambda calculate.\n \u25aa Assign your calculated metrics to a variable named rfm.\n \u25aa Change the names of the metrics you created to recency, frequency and monetary.\n ATTENTION! We do not include the Monetary score.\n","ea8e7e0b":"Underlying the RFM segmentation technique is the idea that marketers can gain an extensive understanding of their customers by analyzing three quantifiable factors. These are:\n\n**Recency**: How much time has elapsed since a customer\u2019s last activity or transaction with the brand? Activity is usually a purchase, although variations are sometimes used, e.g., the last visit to a website or use of a mobile app. In most cases, the more recently a customer has interacted or transacted with a brand, the more likely that customer will be responsive to communications from the brand.\n\n**Frequency**: How often has a customer transacted or interacted with the brand during a particular period of time? Clearly, customers with frequent activities are more engaged, and probably more loyal, than customers who rarely do so. And one-time-only customers are in a class of their own.\n\n**Monetary**: Also referred to as \u201cmonetary value,\u201d this factor reflects how much a customer has spent with the brand during a particular period of time. Big spenders should usually be treated differently than customers who spend little. Looking at monetary divided by frequency indicates the average purchase amount \u2013 an important secondary factor to consider when segmenting customers.","eedb2ce8":"> # **Customer Segmentation using RFM**\n![![image.png](attachment:8c886c2d-5c50-4bde-a4e0-ffb9f31f7eed.png)]\n","ba1ab817":"hibernating            :1063. This segment should be studied primarily.\n\nat_Risk                :590. This segment should be studied primarily.\n\npotential_loyalists    :485. This segment should be studied primarily.\n","b5e92573":"# **DEFINING RFM SCORES AS SEGMENTS**\n\n\u25aa Convert the scores into segments with the help of the seg_map below.","ed19b05b":"![![image.png](attachment:e1e0e851-5c51-45bd-aee2-8fcfcd199e23.png)]","f9408ef4":"# **What are Recency, Frequency and Monetary?**","07115b11":"**At the moment, all missing, and should not be, values in the data have been removed.**","3325edbf":"# **The 'C' in the invoices shows the canceled transactions. Remove the canceled transactions from the dataset.**\nCanceled Values need to be deleted, but because the dataset also contains the product in its original state. these values also should be deleted. but the customers may have returned all of the amount they received and may have returned some of them. Also if some dataframe is examined, there are cases where some canceled invoices are not found in their original form. Therefore, in order to remove these excess values from the data, we will first calculate the total price by multiplying the price and quantity values. and we'll call it monetary.","2197d8b8":"**What is RFM Segmentation?**\n\nRFM segmentation allows marketers to target specific clusters of customers with communications that are much more relevant for their particular behavior \u2013 and thus generate much higher rates of response, plus increased loyalty and customer lifetime value. Like other segmentation methods, RFM segmentation is a powerful way to identify groups of customers for special treatment. RFM stands for recency, frequency and monetary","2d2a6453":"I think first of all, studies should be done on hibernating , at_risk and potential_loyalists which have high rates.","06bd49b8":"# ***Business Problem***\n\nAn e-commerce company wants to segment its customers and determine marketing strategies according to these segments. The company believes that marketing activities specific to customer segments that exhibit common behaviors will increase revenue.\nFor example, it is desired to organize different campaigns for new customers and different campaigns to retain customers,which are very profitable for the company.Segment customers with the RFM method.","17c0b448":"* #  ***Let's take a closer look at this with an example.***","d8efdb95":"![![image.png](attachment:c6d05d28-8835-4234-bfc9-48cc0edd6467.png)]","42337d38":"# ***Dataset Story***\nThe dataset named Online Retail II includes the sales of an UK-based online store between 01\/12\/2009 - 09\/12\/2011.\nThe product catalog of this company includes souvenirs. The vast majority of the company's customers are corporate customers.","3118fe92":"RFM segmentation is a great method to identify customer groups for special treatment. Learn how to use this method to improve your customer marketing."}}