{"cell_type":{"33d91710":"code","8e151562":"code","8f8c8c9f":"code","9459d3e6":"code","ffe11309":"code","7f3eed8b":"code","ba679b73":"code","6899d385":"code","f6e0ceaf":"code","127c572a":"code","5c8814fe":"code","52f5d0e7":"code","07ab8c74":"code","e458cdda":"code","1f3d090c":"code","f492b304":"code","3460a80b":"code","d74502d5":"code","0c642b36":"code","25234607":"code","c67d1a97":"code","6bf2b254":"code","18ca693a":"code","f5737671":"code","967060fe":"code","0bfcb243":"code","f79d6856":"code","d6c0de0d":"code","24d76cf9":"code","7db055e9":"code","ca2cccff":"code","54b93ef4":"code","6e9d32f3":"code","d68f1702":"code","056d97d6":"code","d64d4dc1":"code","1376504c":"code","e35ef0fd":"code","2467e15e":"code","1bcbe7c9":"code","56362fae":"code","0b0ad64d":"code","9a2608b8":"code","9f84f619":"code","a414979b":"code","40108ee3":"code","2bbe9605":"code","641430bb":"code","90e7e7c3":"code","f31fe9f5":"code","2fe2b8e1":"code","5a5e8f48":"code","cd1579c9":"markdown","65d09fec":"markdown","86bf8bff":"markdown","ddc12277":"markdown","3a9510a7":"markdown","2b4b4f34":"markdown","030959b2":"markdown","a61dfe95":"markdown","1b3f7ccb":"markdown","1b4309a7":"markdown","ffc64cc6":"markdown","f2ef5c13":"markdown","be595fd4":"markdown","217ff204":"markdown","34ca64c8":"markdown","81886383":"markdown","01ba8098":"markdown","97752873":"markdown"},"source":{"33d91710":"import pandas as pd \nimport numpy as np \n\nimport matplotlib.pyplot as plt \nimport seaborn as sns \n%matplotlib inline\n\nimport plotly.offline as py\npy.init_notebook_mode(connected=True)\nimport plotly.graph_objs as go\nfrom plotly.figure_factory import create_table\nimport plotly.express as px\n\nplt.style.use('fivethirtyeight')\n\nimport warnings \nwarnings.filterwarnings('ignore')\n","8e151562":"df=pd.read_csv('\/kaggle\/input\/hotel-booking-demand\/hotel_bookings.csv')","8f8c8c9f":"df.head()","9459d3e6":"df.isnull().sum()","ffe11309":"df.shape","7f3eed8b":"df.dtypes","ba679b73":"df['required_car_parking_spaces'].unique()","6899d385":"df['adr'].unique()","f6e0ceaf":"df['reserved_room_type'].value_counts()","127c572a":"df['assigned_room_type'].value_counts()","5c8814fe":"df['country'].unique()","52f5d0e7":"df['booking_changes'].unique()","07ab8c74":"df['distribution_channel'].unique()","e458cdda":"df['is_repeated_guest'].value_counts()","1f3d090c":"df['deposit_type'].value_counts()","f492b304":"df['adults'].unique()","3460a80b":"df['children'].unique()","d74502d5":"df['babies'].unique()","0c642b36":"df['previous_cancellations'].unique()","25234607":"df['meal'].unique()","c67d1a97":"df['total_of_special_requests'].value_counts()","6bf2b254":"df['customer_type'].value_counts()","18ca693a":"color=sns.color_palette()[1]\nsns.countplot(data=df,x='is_canceled',color=color);\nplt.title('Distribution of Cancelations')","f5737671":"color=sns.color_palette()[1]\nsns.countplot(data=df,x='hotel',color=color);\nplt.title('Hotel Type Count')","967060fe":"df.shape[0]","0bfcb243":"sns.set_style('whitegrid')\nrow=df.shape[0]\ncolor=sns.color_palette()[0]\nsns.countplot(data=df,x='is_canceled',hue='hotel',color=color);\n#df.plot(kind='bar',stacked=True,legend=False)\nplt.yticks([10000,20000,30000,40000],[8,17,25,34]);\nplt.ylabel('percentage');\nplt.title('Cancellation count in Hotel vs Resort');","f79d6856":"df['arrival_date_year'].min(),df['arrival_date_year'].max()","d6c0de0d":"fig = px.bar(x=df[\"arrival_date_year\"].value_counts().index, \n             y=(df.groupby('arrival_date_year').aggregate('sum')['is_canceled']\/df.groupby('arrival_date_year').aggregate('count')['is_canceled'])*100,\n             \n             )\n\nfig.update_layout(\n    title={\n        'text': \"Percent Cancellation vs Year\",\n        'y':0.95,\n        'x':0.5,\n        'xanchor': 'center',\n        'yanchor': 'top'},\n    xaxis_title=\"Year\",\n    yaxis_title=\"Percent Cancellation\",\n    font=dict(\n        family=\"Courier New, monospace\",\n        size=18,\n        color=\"RebeccaPurple\"\n    ))\n\nfig.update_xaxes(tickvals=[2015,2016,2017])\nfig.show()","24d76cf9":"timelapse=df.groupby(['arrival_date_year','arrival_date_month','country']).aggregate('sum')['is_canceled'].to_frame().reset_index()\ntimelapse['month-year']=timelapse.arrival_date_month.astype(str)+' '+timelapse.arrival_date_year.astype(str)\n\npx.choropleth(timelapse, locations=\"country\", color='is_canceled', hover_name=\"country\", animation_frame='month-year',\n              color_continuous_scale=px.colors.sequential.Plasma, projection=\"natural earth\")","7db055e9":"#df_month=df.groupby('arrival_date_month').aggregate('sum').reset_index()\n\n# Got the below values from the above groupby dataframe \n\nmonth = ['January', 'February', 'March', 'April', 'May', 'June', 'July',\n         'August', 'September', 'October', 'November', 'December']\n\nvalue=[1807,2696,3149,4524,4677,4535,4742,5239,4116,4246,2122,2371]\n\nfig=px.line(x=month,y=value)\nfig.show()","ca2cccff":"df_percent=df.groupby('arrival_date_month').aggregate('mean').reset_index()\n\n#Values taken from above dataframe \n\nmonth = ['January', 'February', 'March', 'April', 'May', 'June', 'July',\n         'August', 'September', 'October', 'November', 'December']\n\nvalue=[30.4,33.4,32.15,40.79,39.66,41.45,37.45,37.75,39.17,38.04,31.23,34.97]\n\nfig=px.line(x=month,y=value)\nfig.show()","54b93ef4":"deposit=df.groupby('deposit_type').aggregate('sum')['is_canceled'].to_frame().reset_index()\n\nfig=(px.pie(deposit, values=deposit['is_canceled'], names='deposit_type',color='deposit_type', color_discrete_map=\n                                {'Non Refund':'gold',\n                                 'No Deposit':'darkorange',\n                                 'Refundable':'lightgreen'\n                                 }\n                            ))\nfig.update_traces(textposition='inside', textinfo='percent+label')\nfig.show()","6e9d32f3":"deposit=df.groupby('deposit_type').mean()['is_canceled'].to_frame().reset_index()\n\n\nfig=(px.pie(deposit, values=deposit['is_canceled'], names='deposit_type',color='deposit_type', color_discrete_map=\n                                {'Non Refund':'gold',\n                                 'No Deposit':'darkorange',\n                                 'Refundable':'lightgreen'\n                                 }\n                                \n                                   ))\nfig.update_traces(textposition='inside', textinfo='percent+label')\nfig.show()\n","d68f1702":"plt.figure(figsize=(20,20));\nsns.heatmap(df.corr(),annot=True,linewidths=0.1,cbar=False);\n","056d97d6":"#Lets compute a new column in the above dataset to compute number of days stay booked in the hotel \n\ndf['stays_total_duration']=df['stays_in_week_nights']+df['stays_in_weekend_nights']","d64d4dc1":"plt.figure(figsize=(15,8))\n\nplt.subplot(1,2,1)\nsns.boxplot(x=df['babies'],y=df['stays_total_duration'],hue=df['is_canceled']);\n\n\nplt.subplot(1,2,2)\nsns.boxplot(x=df['children'],y=df['stays_total_duration'],hue=df['is_canceled']);","1376504c":"plt.figure(figsize=(10,10)),\nsns.boxplot(x=df['adults'],y=df['stays_total_duration'],hue=df['is_canceled']);","e35ef0fd":"plt.figure(figsize=(15,8))\n\nplt.subplot(1,2,1)\nsns.boxplot(x=df['customer_type'],y=df['stays_total_duration'],hue=df['is_canceled']);\n\nplt.subplot(1,2,2)\nsns.countplot(x=df['customer_type'],hue=df['is_canceled']);\n\n","2467e15e":"\nfrom fastai.tabular import * ","1bcbe7c9":"df.shape","56362fae":"# Lets train the model for 2015 and 2016 and validate it for 2017 \n\ndf_train=df[df['arrival_date_year']!=2017]\ndf_test=df[df['arrival_date_year']==2017]","0b0ad64d":"# Classify the variables into response , catergorical and numerical \n\nresponse='is_canceled'\n\ncatergorical=['hotel','meal','country','market_segment','customer_type','deposit_type','assigned_room_type','reserved_room_type','is_repeated_guest'\\\n              ,'distribution_channel' ,'arrival_date_year','arrival_date_month','arrival_date_week_number','arrival_date_day_of_month']\n\nnumerical=['adults','children','babies','stays_total_duration','stays_in_weekend_nights','stays_in_week_nights','required_car_parking_spaces'\\\n          ,'total_of_special_requests','booking_changes','previous_bookings_not_canceled','previous_cancellations','days_in_waiting_list']\n\nprocs = [FillMissing, Categorify, Normalize]\n\npath='\/kaggle\/working'","9a2608b8":"data = (TabularList.from_df(df_train, path=path, cat_names=catergorical, cont_names=numerical, procs=procs)\n                           .split_by_rand_pct(0.15)\n                           .label_from_df(cols=response)\n                           .add_test(df_test)\n                           .databunch())","9f84f619":"data.show_batch(rows=10)","a414979b":"learn = tabular_learner(data, layers=[200,100], metrics=[AUROC()])","40108ee3":"learn.fit(8, 1e-2)","2bbe9605":"learn.lr_find()","641430bb":"learn.recorder.plot()","90e7e7c3":"learn.fit_one_cycle(5, 1e-3, wd=0.2)","f31fe9f5":"learn.fit_one_cycle(5, 1e-4)","2fe2b8e1":"learn.fit_one_cycle(5, 1e-5, wd=0.2)","5a5e8f48":"learn.save('Hotel_Cancellation')","cd1579c9":"As the data skewed we can chose Area Under the ROC cuve\/F1 score \/ Recall\/Precision as the metrics we will chose ROC curve as our guiding metric for this problem ","65d09fec":"The above graph shows the distribution of cancelation among the various deposit types . With No deposit leading the cancellations when we consider just the cancelation <br>\n\nBut the other way to look at this would be the what percent of each booking type canceled that is how many people using the non-refund booking types cancelled doing that actually presents us a completely different picture . I always prefer percentage as compared to absolutes when the counts are different <br>","86bf8bff":"# Key Observations \n\n* Cancallation increases as the year progresses with the cancellation peaking at the end of year \n* The countries which dominate cancellation are in the neighbourhood of Spain and Portugal in Europe\n* From heatmap we have decent corelation with most variables \n* Among the cancallation vs deposits types  we see that No-deposit have higher percentage of cancellation \n* Also among the customer_type vs Stays_total_duration we see that group type customer who cancel have a higher range in days of stays\n* Among the people who who have 0 childredn or babies there is not much difference . <br>\n* But people who cancel with 1 or 2 babies usually have a longer stay booked at the hotel . <br>\n* Greater than 2 babies count would be do not have any cancelations as this could be group tours and hence cancelations do not depend on single per's will<br>","ddc12277":"# Implementing Models ","3a9510a7":"We see that most countries fall pretty on the lower range of the scale apart from countries close along the Meditarrian Belt such as Portugal , Spain , UK Italy and France so this is one the variable to look forward too ","2b4b4f34":"# Timelaps of cancellations ","030959b2":"# Lets Explore the dataset with some prelimanary EDA ","a61dfe95":"The percentage of booking cancelation seem pretty constant across year hence it makes more sense to better predict cancellation about a booking ","1b3f7ccb":"We do indeed see a higher cancelations in summer months ","1b4309a7":"Adults do not have the same distribution of cancelation vs total duration ","ffc64cc6":"This Kernel is my attempt to apply FastAI tabular implementation . The dataset is basically asking to to predict if the customer with a given set of features will cancel or not cancel . This is not a competition dataset so I had to select a evaluation metric. \n\nSeeing the un-balanced nature of the dependent variable i choose auc-roc-score which is a binary metric designed for unbalanced dataset. So basically the auc-roc-score says how confident a model is between the possible outcome . Here my auc-roc-socre of 0.948 says the model is 94.8 percent certain in predicting 1 vs 0 \n\nI have included some EDA in the below kernel . Please go through the kernel . Please upvote if you like it and feel free to comment!!!","f2ef5c13":"From the above heatmap most variables seem to have either a decent positive or negative relationship with the dependent variable ","be595fd4":"Here we can see that most customer types is concentrated in Transient and Transient-Party \n\nAlso among the customer_type vs Stays_total_duration we see that group type customer who cancel have a higher range in days of stays","217ff204":" So the job here is to predict whether the booking goes through or not that is is_canceled column is our dependent variable . <br>\n \n This model could be very beneficial for the hotel managment to plan inventory or can also help better schedule worker's schedule <br>","34ca64c8":"# Cancelations by month \n","81886383":"From the above graph we see that the cancellation increases as the year progress reaching the peak at the middle of the year . Let see the percentages to get a much more clear picture as this could also be due the number of booking reaching a high during the middle of summer ","01ba8098":"We see same trend for people having babies and children and their cancelations with weekend and weekday stays . \n\n* Among the people who who have 0 childredn or babies there is not much difference . <br>\n* But people who cancel with 1 or 2 babies usually have a longer stay booked at the hotel . <br>\n* Greater than 2 babies count would be do not have any cancelations as this could be group tours and hence cancelations do not depend on single per's will<br>","97752873":"Seeing the corelation value between difference in room type booked and assigned we see a weakish negative corelation -0.24 so this feature should be included in our analysis "}}