{"cell_type":{"d2128987":"code","436b1b5e":"code","6b8bce9f":"code","15c37ceb":"code","a7505a4e":"code","01900615":"code","f19ab919":"code","5c06a01d":"code","70bad898":"code","f947dc86":"code","aa1b2823":"code","2f92aa31":"code","2f239d30":"code","8ae940dd":"code","fb5c0154":"code","28dac548":"code","d603ef13":"code","663694b9":"code","915ba74b":"code","07da9d15":"code","2c64c0d3":"code","278a927c":"code","d388339a":"code","e0f5efde":"code","c6f0e7a1":"code","fe37c22d":"code","90b91028":"code","4d766653":"code","ce1dcefd":"code","aaf00a09":"code","04510395":"code","56f12042":"code","75f541b4":"code","d5a3d7fa":"markdown","14eb7c54":"markdown","33c99914":"markdown","23983fa4":"markdown","ce0c3f1a":"markdown","61d22175":"markdown","ba3c3780":"markdown","ef1649f3":"markdown"},"source":{"d2128987":"import fastai\nfrom fastai.imports import *\nfrom fastai.vision import *\nfrom fastai.metrics import *\nfrom fastai.gen_doc.nbdoc import *\nprint('fast.ai version:{}'.format(fastai.__version__))","436b1b5e":"model = models.resnet152#resnet34\nWORK_DIR = os.getcwd()\nIMAGE_DIR = Path('..\/input\/')\nimage_size=224\nbatch_size=32","6b8bce9f":"fnames = get_image_files(IMAGE_DIR\/'train')\nfnames[:5]","15c37ceb":"show_doc(get_transforms)","a7505a4e":"show_doc(ImageDataBunch.from_name_re)","01900615":"pattern_get_class = re.compile(r'\/([^\/]+)\\.\\d+\\.jpg$')\ndata = ImageDataBunch.from_name_re(path = IMAGE_DIR,\n                                   fnames = fnames, \n                                   pat = pattern_get_class, \n                                   ds_tfms=get_transforms(), \n                                   test ='test',\n                                   size=image_size, \n                                   bs=batch_size,\n                                   num_workers=0).normalize(imagenet_stats)\ndata","f19ab919":"data.show_batch(rows=3)","5c06a01d":"show_doc(create_cnn)","70bad898":"learn = create_cnn(data, model, metrics=accuracy, model_dir=WORK_DIR)","f947dc86":"show_doc(learn.fit_one_cycle)","aa1b2823":"learn.fit_one_cycle(1)","2f92aa31":"learn.recorder.plot_losses()","2f239d30":"learn.recorder.plot_lr(show_moms=True)\n# Left plot is Learning-Rate vs itteration, Right one is momentams vs itteration.","8ae940dd":"learn.save('stage-1')","fb5c0154":"learn.unfreeze()\nlearn.lr_find()\nlearn.recorder.plot()","28dac548":"learn.load('stage-1')\nlearn.unfreeze()\nlearn.fit_one_cycle(4, max_lr=slice(1e-6,1e-4))","d603ef13":"learn.recorder.plot_losses()","663694b9":"learn.save('stage-2')","915ba74b":"interp = ClassificationInterpretation.from_learner(learn)","07da9d15":"interp.plot_top_losses(9)","2c64c0d3":"interp.plot_confusion_matrix()","278a927c":"# Check if DatasetType loaded\n# It's depend on difference between fast.ai version v1.0.39\/v1.0.36.\nif 'DatasetType' not in sys.modules:\n    from fastai import DatasetType","d388339a":"try:\n    # TTA cause error @fast.ai v1.0.39\n    preds, _ = learn.TTA(ds_type=DatasetType.Test)\nexcept:\n    preds, _ = learn.get_preds(DatasetType.Test)\nelse:\n    print('Predict with TTA done.')","e0f5efde":"preds","c6f0e7a1":"# from here we know that 'cats' is label 0 and 'dogs' is label 1.\nprint(data.classes)\ndict_label_order = {label:order for order,label in enumerate(data.classes)}\nprint(dict_label_order)","fe37c22d":"n_dogs = dict_label_order['dog']\nn_dogs","90b91028":"prob_dogs = preds[:,n_dogs].numpy()\nprob_dogs","4d766653":"plt.hist(prob_dogs)","ce1dcefd":"ids = [int(file.stem) for file in data.test_ds.x.items]\nids[:10]","aaf00a09":"import pandas as pd\nsubmission = pd.DataFrame({'id':ids,'label':prob_dogs})\nsubmission = submission.sort_values(by=['id'])","04510395":"submission.head()","56f12042":"submission.label.describe()","75f541b4":"submission.to_csv('submission.csv', index=False)","d5a3d7fa":"[reference]\n* https:\/\/course.fast.ai\/lessons\/lesson1.html\n* https:\/\/github.com\/fastai\/course-v3\/blob\/master\/nbs\/dl1\/lesson1-pets.ipynb","14eb7c54":"# Predict","33c99914":"# Datas","23983fa4":"# Classification Interpretation","ce0c3f1a":"`get_transforms` is a data augmentation function, with good initial settings.","61d22175":"# Train","ba3c3780":"> For each image in the test set, you must submit a probability that image is a dog. ","ef1649f3":"# Import fast.ai libraries\n* Turn on GPU and Internet (connected)"}}