{"cell_type":{"b969d354":"code","3b2fd074":"code","3b41df4a":"code","bcbdec98":"code","e3ba23e7":"code","28405aa8":"code","3ffc9ba5":"code","67cedd8b":"code","f92995f4":"code","807f5ba4":"code","2a462ca8":"code","e8d47863":"code","2da8dee9":"code","c671a09a":"code","c9e282c0":"code","7c4b6b02":"code","27e0cf19":"code","8ddf3221":"code","83a3b4f4":"code","5bc518e2":"code","d84d428e":"code","5d45ece9":"code","2ae497d7":"code","f4441f38":"code","2127ad43":"code","e996d16b":"code","1b53a95d":"code","61e659e7":"code","fa1635dc":"code","497740be":"code","129fc883":"code","1de1a2d0":"code","c4a60a43":"code","bb7b4981":"code","8728b45f":"code","807e388e":"code","2d53630c":"code","0a3f59cc":"code","92e0aaec":"code","122a343f":"code","5d3f47f7":"code","44aae26a":"code","cadb3f80":"code","e4cfc5a2":"code","b818e232":"code","1c288042":"code","394b5008":"code","841d00c9":"code","5ca24804":"code","aff9b445":"code","73e7df86":"code","ead9ccda":"code","42338a0c":"code","190a7cd6":"code","c5f6b70d":"code","982848ce":"code","c20d6307":"code","e91603f3":"code","35ac832d":"code","779e6ac6":"code","888ad64f":"code","adf4bf8c":"code","68d532fa":"code","60dfc465":"code","2fcd7fdd":"code","77c14188":"code","e437fb2f":"code","15fcfc42":"code","a88d2b94":"code","4c489cb6":"code","5261330e":"code","a5a66091":"code","8449f888":"code","9e713490":"code","2b5227ba":"code","003a5b2f":"code","19772909":"code","0ffaa482":"code","6d8805d6":"code","c03ac981":"code","a840a2bd":"code","2670dcd8":"code","2ccbc5b6":"code","e1de0d1d":"code","1d87846f":"code","2402d7aa":"code","2f048b20":"code","2a93ff99":"code","010367df":"code","730fdd88":"code","c8eabe56":"code","12f8e1a5":"code","9fb13f5e":"code","92a08c40":"code","ae5acf1d":"code","73b656b9":"code","a4294cc0":"code","926aa740":"code","b0d3b6d9":"code","eff8b29b":"code","0c963568":"markdown","5ab9a77d":"markdown","ab65cbf5":"markdown","e4784cc4":"markdown","58ed5005":"markdown","7fff196a":"markdown","84fdf13f":"markdown","bb48010e":"markdown","e6a1faee":"markdown","863e94e4":"markdown","b1273a66":"markdown","76097aa4":"markdown","546c8f44":"markdown","f8f2c83c":"markdown","85a0e1ba":"markdown","0dd53def":"markdown","24f977bd":"markdown","e249d8ea":"markdown","53a5e118":"markdown"},"source":{"b969d354":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns","3b2fd074":"df=pd.read_csv('..\/input\/ckdisease\/kidney_disease.csv')","3b41df4a":"df.head()","bcbdec98":"df.isnull().sum()","e3ba23e7":"# now lets take a look at the description file to understand what this features mean exactly\ndf1=pd.read_csv('..\/input\/kidney\/data_description.txt',sep='-')\ndf1=df1.reset_index()","28405aa8":"df1","3ffc9ba5":"df1.columns=['shortf','longf']\ndf1","67cedd8b":"df1['longf'].values","f92995f4":"# lets rename the column names in our origninal dataframe\ndf.columns=df1['longf'].values\ndf.head()","807f5ba4":"df.dtypes","2a462ca8":"# we can see that some features having nueric values are assigned object datatype ,like packed cell volume,rbc count,wbc count so lets convert them to numeric\ndef convert_dtypes(df,feature):\n  df[feature]=pd.to_numeric(df[feature],errors='coerce')\n  # this error parameter will handle nan vlaues","e8d47863":"features=['packed cell volume', 'white blood cell count',\n       'red blood cell count']\nfor feature in features:\n  convert_dtypes(df,feature)\n","2da8dee9":"df.dtypes","c671a09a":"df.drop('id',axis=1,inplace=True)\n# bcoz id makes no sense","c9e282c0":"# lets clean our data\n# lets separate categorical and numerical columns\ndef extract_cat_nume(df):\n  cat_col=[col for col in df.columns if df[col].dtype=='object']\n  num_col=[col for col in df.columns if df[col].dtype!='object']\n  return cat_col,num_col\n  \n","7c4b6b02":"cat_col,num_col=extract_cat_nume(df)","27e0cf19":"num_col","8ddf3221":"cat_col","83a3b4f4":"### total unique categories in our categorical features to check if any dirtiness is there in there in  data or not","5bc518e2":"for col in cat_col:\n    print('{} has {} values '.format(col,df[col].unique()))\n    print('\\n')","d84d428e":"## ckd-chronic kidney disease\n## notckd-->> not chronic kidney disease","5d45ece9":"for col in cat_col:\n    print('{} has {} values  '.format(col, df[col].unique()))\n    print('\\n')","2ae497d7":"#Replace incorrect values\n\ndf['diabetes mellitus'].replace(to_replace = {'\\tno':'no','\\tyes':'yes',' yes':'yes'},inplace=True)\n\ndf['coronary artery disease'] = df['coronary artery disease'].replace(to_replace = '\\tno', value='no')\n\ndf['class'] = df['class'].replace(to_replace = 'ckd\\t', value = 'ckd')","f4441f38":"for col in cat_col:\n    print('{} has {} values  '.format(col, df[col].unique()))\n    print('\\n')","2127ad43":"# apart from nan values we are good to go","e996d16b":"plt.figure(figsize=(30,20))\nfor i,feature in enumerate(num_col):\n  # enuerate is used for assigning index to the features\n    plt.subplot(5,3,i+1) \n    #  \/\/i here is used for index\n    df[feature].hist()\n    plt.title(feature)","1b53a95d":"# WE CAN SEE THERE ARE SOME OUTLIERS \n#  Observations:\n#         1.age looks a bit left skewed\n#         2.Blood gluscose random is right skewed\n#         3.Blood Urea is also a bit right skewed\n#         4.Rest of the features are lightly skewed","61e659e7":"plt.figure(figsize=(30,20))\nfor i,feature in enumerate(cat_col):\n  plt.subplot(4,3,i+1)\n  sns.countplot(df[feature])","fa1635dc":"plt.figure(figsize=(20,20))\nsns.heatmap(df.corr(),annot=True)","497740be":"df.groupby(['red blood cells','class'])['red blood cell count'].agg(['count','mean','median','min','max'])","129fc883":"import plotly.express as px","1de1a2d0":"px.violin(df,y='red blood cell count',x=\"class\", color=\"class\")","c4a60a43":"px.scatter(df,'haemoglobin','packed cell volume')\n#how haemoglobin and placked cell volume relate","bb7b4981":"### analysing distribution of 'red_blood_cell_count' in both Labels \n\ngrid=sns.FacetGrid(df, hue=\"class\",aspect=2)\n#aspect =2 to increase the area\ngrid.map(sns.kdeplot, 'red blood cell count')\n#mapping a distribution of red blood cell count(feature)\ngrid.add_legend()","8728b45f":"#lets automate our analysis with the help of violin plot\ndef violin(col):\n  fig=px.violin(df,y=col,x='class',color='class',box=True)\n  fig.show()","807e388e":"def scatter(col1,col2):\n   fig = px.scatter(df, x=col1, y=col2, color=\"class\")\n   return fig.show()","2d53630c":"def kde_plot(feature):\n    grid = sns.FacetGrid(df, hue=\"class\",aspect=2)\n    grid.map(sns.kdeplot, feature)\n    grid.add_legend()","0a3f59cc":"# now we have made common function ,and we can easily cann these function for any of the features available\n# for example lets plot the kde plot for haemoglobin\nkde_plot('haemoglobin')","92e0aaec":"df.columns","122a343f":"scatter('red blood cell count','packed cell volume')","5d3f47f7":"scatter('red blood cell count','haemoglobin')","44aae26a":"violin('packed cell volume')","cadb3f80":"df.isna().sum().sort_values(ascending=False)","e4cfc5a2":"# lets fill the missing values\n ","b818e232":"data=df.copy()","1c288042":"data","394b5008":"#this function will work for all features containing null\ndef random_value_imputation(feature):\n  random_sample=data[feature].dropna().sample(data[feature].isnull().sum())\n  #this statement indicates to generate random values equal to the number of nan values\n  # the index of the random values should be same as the index of the columns \n  random_sample.index=data[data[feature].isnull()].index\n  data.loc[data[feature].isnull(),feature]=random_sample","841d00c9":"# now lets take a look at the missing values in numerical and categorical columns\ndata[num_col].isnull().sum()","5ca24804":"for col in num_col:\n  random_value_imputation(col)\n  ","aff9b445":"# now lets take a look at the missing values in numerical and categorical columns\ndata[num_col].isnull().sum()","73e7df86":"data[cat_col].isnull().sum()","ead9ccda":"random_value_imputation(' pus cell')\nrandom_value_imputation('red blood cells')","42338a0c":"data[cat_col].isnull().sum()","190a7cd6":"# now we have less missing values so we can fill them with the help of mode as we have categorical features here\n","c5f6b70d":"def impute_mode(feature):\n    mode=data[feature].mode()[0]\n    data[feature]=data[feature].fillna(mode)","982848ce":"for col in cat_col:\n    impute_mode(col)","c20d6307":"data[cat_col].isnull().sum()","e91603f3":"for col in cat_col:\n    print('{} has {} categories'.format(col, data[col].nunique()))\n    ","35ac832d":"#### as we have just 2 categories in each feature then we can consider Label Encoder as it will not cause Curse of Dimensionality","779e6ac6":"from sklearn.preprocessing import LabelEncoder","888ad64f":"le = LabelEncoder()","adf4bf8c":"for col in cat_col:\n    data[col]=le.fit_transform(data[col])","68d532fa":"data.head()","60dfc465":"from sklearn.feature_selection import SelectKBest\n# it will check the probablility value is less than 0.5 or not \nfrom sklearn.feature_selection import chi2\n# chi square","2fcd7fdd":"ind_feature=[col for col in data.columns if col!='class']\ntarget=data['class']\n","77c14188":"X=data[ind_feature]\ny=data['class']","e437fb2f":"y","15fcfc42":"ordered_rank_features=SelectKBest(score_func=chi2,k=20)\nordered_rank_features","a88d2b94":"ordered_rank_features=ordered_rank_features.fit(X,y)\nordered_rank_features","4c489cb6":"import pandas as pd","5261330e":"datascores=pd.DataFrame(ordered_rank_features.scores_,columns=['Score'])","a5a66091":"datascores","8449f888":"dfcols=X.columns\ndfcols","9e713490":"dfcols=pd.DataFrame(dfcols,columns=['Features'])\ndfcols","2b5227ba":"features_rank=pd.concat([dfcols,datascores],axis=1)\nfeatures_rank","003a5b2f":"features_rank.nlargest(10,'Score')\n# on the basis of score lets select the top 10 features\n","19772909":"selected_columns=features_rank.nlargest(10,'Score')['Features'].values\n# this will convert into an array","0ffaa482":"selected_columns","6d8805d6":"X_new=data[selected_columns]","c03ac981":"X_new.shape","a840a2bd":"X=X_new","2670dcd8":"X","2ccbc5b6":"from sklearn.model_selection import train_test_split\nX_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.25,random_state=0)","e1de0d1d":"from xgboost import XGBClassifier\n","1d87846f":"XGBClassifier()","2402d7aa":"params={\n  \"learning_rate\"    : [0.05, 0.20, 0.25 ] ,\n \"max_depth\"        : [ 5, 8, 10, 12],\n \"min_child_weight\" : [ 1, 3, 5, 7 ],\n \"gamma\"            : [ 0.0, 0.1, 0.2 , 0.4 ],\n \"colsample_bytree\" : [ 0.3, 0.4, 0.7 ]\n}","2f048b20":"import warnings\nfrom warnings import filterwarnings\nfilterwarnings('ignore')","2a93ff99":"from sklearn.model_selection import RandomizedSearchCV\n","010367df":"classifier=XGBClassifier()","730fdd88":" random_search=RandomizedSearchCV(classifier,param_distributions=params,n_iter=5,scoring='roc_auc',n_jobs=-1,cv=5,verbose=3)","c8eabe56":"random_search.fit(X_train,y_train)","12f8e1a5":"random_search.best_estimator_","9fb13f5e":"random_search.best_params_","92a08c40":"classifier=XGBClassifier(base_score=0.5, booster='gbtree', colsample_bylevel=1,\n              colsample_bynode=1, colsample_bytree=0.7, gamma=0.1,\n              learning_rate=0.2, max_delta_step=0, max_depth=5,\n              min_child_weight=1, missing=None, n_estimators=100, n_jobs=1,\n              nthread=None, objective='binary:logistic', random_state=0,\n              reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,\n              silent=None, subsample=1, verbosity=1)","ae5acf1d":"classifier.fit(X_train,y_train)","73b656b9":"y_pred=classifier.predict(X_test)","a4294cc0":"y_pred","926aa740":"from sklearn.metrics import confusion_matrix,classification_report,accuracy_score","b0d3b6d9":"confusion_matrix(y_test,y_pred)","eff8b29b":"accuracy_score(y_test,y_pred)","0c963568":"we can easily observe from the plot that the people not having chronic kidney disease have there haemoglobin count more","5ab9a77d":"we can observe all missing values got removed","ab65cbf5":"lets see the correlation between the features","e4784cc4":"![](https:\/\/i1.wp.com\/vegofwa.org\/wp-content\/uploads\/2019\/02\/kidneys-cartoon.jpeg?fit=532%2C421&ssl=1)","58ed5005":"we can see the exact inference from this visual i.e the person not having chronic disease are having high rbc count","7fff196a":"we get accuracy upto 97% on this use-case using XGBClassifier","84fdf13f":"we can observe that for the red blood cells to be normal and possessing non crhonic dissease ,the count should be atleast 134 and the mean value should also be higher","bb48010e":"#Applying a crossvalidated model and then lets check the accuracy of the model  ","e6a1faee":"#we can see the descriptive analysis with the help of violin plot","863e94e4":" Now applying feature encoding on categorical data","b1273a66":"#FEATURE IMPORTANCE","76097aa4":"Positive Correlation:\n \nSpecific gravity -> Red blood cell count, Packed cell volume and Hemoglobin\nSugar -> Blood glucose random\nBlood Urea -> Serum creatinine\nHemoglobin -> Red Blood cell count <- packed cell volume\n \n \nNegative Correlation:\nAlbumin, Blood urea -> Red blood cell count, packed cell volume, Hemoglobin\nSerum creatinine -> Sodium","546c8f44":"### Let's check for Positive correlation and its impact on classes\u00b6","f8f2c83c":"Chronic kidney disease includes conditions that damage your kidneys and decrease their ability to keep you healthy by doing the jobs listed. If kidney disease gets worse, wastes can build to high levels in your blood and make you feel sick. You may develop complications like high blood pressure, anemia (low blood count), weak bones, poor nutritional health and nerve damage. Also, kidney disease increases your risk of having heart and blood vessel disease. These problems may happen slowly over a long period of time. Chronic kidney disease may be caused by diabetes, high blood pressure and other disorders. Early detection and treatment can often keep chronic kidney disease from getting worse.\n# So in this notebook ,based on the following features I predicted ,the person is prone to ckd or not based on his blood pressure,haemoglobin rbc count ,wbc count \n* In the analysis section I tried to automate the relationshp between the features with the help of violin and scatter plot from the  plotly module,the correlation is established with the help of heatmap and tried to replace the null values with the help of random imputation,so that it didn't affect the distribution of features\n* Later I used SelectKbest for feature selection and then finally did the modelling with XGBoost \n\n","85a0e1ba":"we can see our categorical data is converted to numerical data","0dd53def":"we can observe that whenever the packed cell volume is between 35-55 the person is found not having chronic disease","24f977bd":"we can observe that the person not having disease have some non linear relationship,while the one's having the disease possess some linearity in the data","e249d8ea":"#CHECKING FEATURE DISTRIBUTION","53a5e118":"lets clean our data\nlets separate categorical and numerical columns"}}