{"cell_type":{"7504a487":"code","6e918303":"code","3f480b77":"code","4dc99e72":"code","ffa1fc1e":"code","f8370988":"code","fb4e48c2":"code","67d1334f":"markdown","2f83a210":"markdown","d6e13488":"markdown","aea84448":"markdown","5320e7ac":"markdown","6f9a757b":"markdown"},"source":{"7504a487":"import numpy as np \nimport pandas as pd \nfrom google.cloud import bigquery\n\nimport matplotlib.pyplot as plt \n\nclient= bigquery.Client()\ndataset_ref= client.dataset('google_analytics_sample', project= 'bigquery-public-data')\ndataset= client.get_dataset(dataset_ref)\n\nquery_summary_data= \"\"\"\nSELECT date, SUM(totals.visits) AS visits, SUM(totals.pageviews) AS pageviews, SUM(totals.transactions) AS transactions, SUM(totals.transactionRevenue)\/1000000 AS revenue\nFROM `bigquery-public-data.google_analytics_sample.ga_sessions_*`\nWHERE _TABLE_SUFFIX BETWEEN '20161124' AND '20161128'\nGROUP BY date\nORDER BY date ASC\n\"\"\"\n\n# run the query if it uses < 1GB\nsafe_config= bigquery.QueryJobConfig(maximum_bytes_billed= 1000000000)\nsafe_query_job= client.query(query_summary_data, job_config= safe_config)\nsummary_df= safe_query_job.to_dataframe()\nprint(summary_df)","6e918303":"rev_heights= summary_df['revenue']\npos= np.arange(len(rev_heights))\nplt.bar(pos, rev_heights, align= 'center')\nplt.xticks(pos, summary_df['date'])\nplt.xlabel('Date'); plt.ylabel('Revenue (USD $)')\nplt.title('Revenue for each day during the 2016 Thanksgiving weekend')\n\nplt.figure()\nview_heights= summary_df['pageviews']\nplt.bar(pos, view_heights, align= 'center')\nplt.xticks(pos, summary_df['date'])\nplt.xlabel('Date'); plt.ylabel('Number of page views')\nplt.title('Page views for each day during the 2016 Thanksgiving weekend')","3f480b77":"# create query that gets running total of revenue for each of the traffic sources using only instances where a purchase was made (revenue > 0)\nquery_running_tots= \"\"\"\nSELECT date, trafficSource.source AS source, SUM(totals.transactionRevenue\/1000000)\nOVER(\nPARTITION BY trafficSource.source, date \nORDER BY date, trafficSource.source\nROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW\n) as running_total_revenue\n\nFROM `bigquery-public-data.google_analytics_sample.ga_sessions_*`\nWHERE _TABLE_SUFFIX BETWEEN '20161124' AND '20161128' AND totals.transactionRevenue > 0\n\n\"\"\"\n\n# run the query if it uses < 1GB\nsafe_config= bigquery.QueryJobConfig(maximum_bytes_billed= 1000000000)\nsafe_query_job= client.query(query_running_tots, job_config= safe_config)\nrunning_tots_df= safe_query_job.to_dataframe()","4dc99e72":"# visualize distribution of traffic sources that resulted in a revenue > 0\nsource_transactions= running_tots_df['source'].value_counts()\nplt.figure()\nplt.pie(x= source_transactions, labels= source_transactions.index, labeldistance= None)\nplt.legend(loc= \"center left\", bbox_to_anchor=(1, 0, 0.5, 1))\nplt.title('Distribution of instances where revenue > 0 by traffic source')","ffa1fc1e":"# plot of cumulative sum of revenue for each day\ndirect_traffic= running_tots_df[running_tots_df['source'] == '(direct)'].sort_values(by= ['date'])\nplt.plot(direct_traffic['date'], direct_traffic['running_total_revenue'], 'x')\nplt.xlabel('Date'); plt.ylabel('Cumulative sum - revenue ($)')\nplt.title(\"Cumulative revenue for each day, '(direct)' traffic source\")","f8370988":"bounce_query= \"\"\"\nWITH bounce_counts AS \n(SELECT COUNT(trafficSource.source) AS visits, SUM(totals.bounces) AS num_bounces, SUM(totals.transactions) as num_transactions, trafficSource.source AS source\nFROM `bigquery-public-data.google_analytics_sample.ga_sessions_*`\nWHERE _TABLE_SUFFIX BETWEEN '20161124' AND '20161128'\nGROUP BY source\n)\n\nSELECT source, num_transactions, visits, num_bounces, (100*(num_bounces \/ visits)) AS bounce_rate\nFROM bounce_counts\nORDER BY visits DESC\n\n\"\"\"\n# run the query if it uses < 1GB\nsafe_config= bigquery.QueryJobConfig(maximum_bytes_billed= 1000000000)\nsafe_query_job= client.query(bounce_query, job_config= safe_config)\nbounce_df= safe_query_job.to_dataframe()\nbounce_df.fillna(0, inplace= True)\nprint(bounce_df.head(), np.shape(bounce_df))","fb4e48c2":"bad_source= bounce_df[(bounce_df['visits'] < 6) | (bounce_df['bounce_rate'] >= 85)]\nprint(bad_source['source'])\nprint('\\n','Total number of bad traffic sources:', len(bad_source))","67d1334f":"Dataframe \"summary_df\" has the total number of visits, page views, transactions, and revenue for the Google Merchandise store for each of the five days in the period of interest. \"Visit\" is defined as a single browsing session whereas \"pageview\" refers to the number of times pages on the site were viewed or refreshed; there can be multiple page views for one visit. We can see that the most revenue made and number of page views was on Monday, November 28, the day referred to as \"Cyber Monday\". Friday, November 25, also known as \"Black Friday\", had the second-largest revenue and number of page visits.\n\n# Revenue Running Total by Traffic Source\nThere were multiple ways to access the Google Merchandise store. Let's see the running total of site visits and revenue for each of the traffic sources considering only instances where revenue > 0 to see if the method of accessing the website for the purpose of making a purchase changed throughout the weekend.","2f83a210":"From the cumulative sum of revenue plot, we can see that the most transactions occurred on Monday, November 28. We can also tell that the majority of purchases for all days were relatively small\/resulted in relatively small revenue. This is indicated by the small space between points within a day; where there are large gaps between points is an indication of a larger purchase\/a purchase that resulted in greater revenue.\n\n# True Bounce Rate and Counts of Site Visits by Traffic Source\n\nTo better understand each of the traffic sources and how they were used (and how effective they were) during the time frame of 2016 American Thanksgiving, we can get the real bounce rate and ratio of site visits to number of transactions for each traffic source. The real bounce rate is the percentage of site visits that had a single page view - this can occur if someone accidentally accessed the site by clicking on an advertisement and then immediately left the site without accessing  more than one page. Ideally, we want the real bounce rate to be low - it is better for people to browse and make purchases on the ecommerce site rather than have them access the site and then immediately leave!\n\nThe count of site visits combined with the number of transactions by traffic source can give us an idea of if a particular traffic source typically resulted in a visitor browsing or making a purchase. Together, the true bounce rate and the count of site visits for each traffic source can help tell us which traffic sources are worth keeping. If a traffic source that is expensive to maintain has a high bounce rate, it may be worth eliminating that particular traffic source since it's not resulting in any browsing or purchasing. If there are not many instances of transactions for a traffic source but the source has a high number of site views and a low bounce rate, this suggests that people tend to browse the site rather than make a purchase when the site is accessed by this particular source. This is OK and the traffic source is likely worth keeping - when people browse a website, they tend to be interested in the content and may return later to make a purchase.\n","d6e13488":"When considering only instances where there was revenue, it looks like \"(direct)\" was the most common method of accessing the website, suggesting that individuals that made purchases did so by directly accessing the Google Merchandise website. This does not indicate the effectiveness of the advertising for the Google Merchandise store - people that made purchases may have seen an ad at some point in time before deciding to access the website directly to make a purchase. \n\nFor this particular traffic source, we can visualize the cumulative sum of revenue for each of the five days of interest.","aea84448":"This is the list of traffic sources that should not have a lot of effort or money directed towards them during time periods of future American Thanksgiving weekends since they resulted in few site visits and\/or high bounce rates throughout the 2016 American Thanksgiving weekend. These traffic sources may bring in more site visits and have lower bounce rates during other times of the year, but additional analysis is needed to confirm this.\n\n# Conclusions\nThis notebook provided some example SQL queries to access data from a database within Google BigQuery. This notebook also illustrated the revenue and number of page visits for the Google Merchandise store for each day during the 2016 American Thanksgiving weekend. The greatest number of page visits and revenue occurred on Cyber Monday and the traffic source that resulted in the greatest number of transactions and revenue for all days during the weekend was direct access to the Google Merchandise store. Also from this analysis, the top five traffic sources that resulted in the highest number of site visits were (direct), youtube.com, Partners, analytics.google.com, and dfa. 33 traffic sources that resulted in a low number of site visits and\/or a high bounce rate were identified. Therefore, using only the data from this analysis, the Google Merchandise ecommerce store can better prepare for future American Thanksgiving weekends by expecting the most transactions and highest revenue to occur on Cyber Monday and for most people making a purchase to access the site directly.","5320e7ac":"# Preamble\nThis notebook has example SQL queries to access a sample of the [Google Analytics](https:\/\/www.kaggle.com\/bigquery\/google-analytics-sample) dataset from Google BigQuery. Along with demonstrating the ability to write SQL queries, the goal of this notebook is to visualize summary data, including number of page views and transactions, for the Google Merchandise ecommerce store during the 2016 American Thanksgiving weekend (Thurs Nov 24 - Mon Nov 28, 2016 inclusive). These dates were chosen because American Thanksgiving is associated with large volumes of consumer purchases. This information can help Google visualize the number of page views, transactions, and revenue for the Google Merchandise Store during this period and maybe even help with advertising, inventory, and preparing for future American Thanksgiving shopping weekends.\n\n# Summary Statistics\nThere is one table for each day from August 1, 2016 to August 1, 2017 under the google_analytics_sample dataset. We will be using the tables corresponding to the dates Nov 24, 2016 - Nov 28, 2016. To get an overview of the activity for the weekend, we'll create a dataframe with some statistics summarizing each of the 5 days being considered. We will also visualize some of these summary statistics.","6f9a757b":"During the 2016 American Thanksgiving weekend, 55 traffic sources were used to access the Google Merchandise store. The five traffic sources that had the highest number of visits were (direct), youtube.com, Partners, analytics.google.com, and dfa. For each of these sources aside from (direct), people only browsed the site and the bounce rate was acceptable; there were no transactions for these sources and the highest bounce rate was 51.1%. Based on this, these five traffic sources should be kept as traffic sources during the time frames of future American Thanksgivings since they resulted in purchases and\/or browsing of the Google Merchandise site.\n\nTraffic sources not worth keeping are those with a low number of visits and\/or a very high bounce rate. We'll say that less than 5 is a low number of visits and a bounce rate of 85% or more is high. Let's identify the sources that meet either of these criteria."}}