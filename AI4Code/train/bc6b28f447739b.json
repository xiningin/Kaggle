{"cell_type":{"c923d43f":"code","f3266368":"code","4c611a49":"code","3b13df85":"code","f90462ea":"code","d5224bf0":"code","283aa74c":"code","0a92239e":"code","cb849b3f":"code","539f09b9":"code","b75b26e7":"code","dd35cc75":"code","e6d2b90e":"code","dc50fd26":"code","acae2a84":"code","48c54ae7":"code","0e00859b":"code","70790fc8":"code","41db5bf7":"code","78dd8a6f":"code","c9023d26":"code","c355ee05":"code","ec8eb397":"code","aba64d6a":"code","2a5438fb":"code","6f5cdbab":"code","a579d5ab":"code","fc19f303":"code","6f32307e":"code","e9859375":"code","c7da4f30":"code","8aa4c858":"code","e1d21337":"code","63c8071e":"code","ec7356d2":"code","52504aec":"code","69351e7e":"code","f46bdbad":"code","4a3b576f":"code","f9aa9335":"code","1b01fc19":"code","750e4720":"code","eb56e272":"code","905dcee2":"code","ee4c85a7":"code","f1ce8552":"markdown","4eb42ecd":"markdown","a87b6f99":"markdown","b2f71aa0":"markdown","4773999a":"markdown","92d18a99":"markdown","cb305a46":"markdown","0059d15d":"markdown"},"source":{"c923d43f":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\n# import os\n# for dirname, _, filenames in os.walk('\/kaggle\/input'):\n#     for filename in filenames:\n#         print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","f3266368":"data = pd.read_csv(\"\/kaggle\/input\/osic-pulmonary-fibrosis-progression\/train.csv\")","4c611a49":"data.shape # How many rows and columns?","3b13df85":"# Let's check a few rows\ndata.head()","f90462ea":"# How many rows for each patient?\ndata.groupby('Patient').size()","d5224bf0":"# How many rows for each smokers vs. ex-smokers?\ndata.groupby('SmokingStatus')['Patient'].nunique()","283aa74c":"data.groupby('SmokingStatus')['FVC'].mean() \n# Seems odd that the data description page says FVC is \"the recorded lung capacity in ml\".","0a92239e":"data.groupby('Weeks')['Patient'].nunique()","cb849b3f":"data.groupby(['Weeks','SmokingStatus','Sex','Age'])['FVC'].mean()","539f09b9":"from sklearn.preprocessing import LabelEncoder\n\ncat_features = ['Sex','SmokingStatus']\nencoder = LabelEncoder()\n\n# Apply the label encoder to each column\nencoded = data[cat_features].apply(encoder.fit_transform)","b75b26e7":"data2 = data[['FVC','Percent','Weeks','Age']].join(encoded)\ndata2.head()","dd35cc75":"X = data2[['SmokingStatus','Age','Sex','Weeks','Percent']]\ny = data2['FVC']","e6d2b90e":"# Let's define a function to calculate the metric\n# I didn't actually use this evaluation but sharing my thoughts\n# def eval_metric(FVC,FVC_Pred,sigma):\n#     sigma_clipped = np.max(sigma,70)\n#     delta = np.min(np.abs(FVC-FVC_Pred),1000)\n#     eval_metric = -np.sqrt(2)*delta\/sigma_clipped - np.ln(np.sqrt(2)*sigma_clipped)\n#     return eval_metric\n\n# We need the prediction for FVC_Pred and confidence(sigma I think?)","dc50fd26":"import matplotlib.pyplot as plt  \nimport seaborn as seabornInstance \nfrom sklearn.model_selection import train_test_split \nfrom sklearn.linear_model import LinearRegression\nfrom sklearn import metrics\n%matplotlib inline","acae2a84":"X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.4, random_state=0)","48c54ae7":"regressor = LinearRegression()  \nregressor.fit(X_train, y_train) #training the algorithm","0e00859b":"#To retrieve the intercept:\nprint(regressor.intercept_)\n#For retrieving the slope:\nprint(regressor.coef_)\n","70790fc8":"y_pred = regressor.predict(X_test)","41db5bf7":"df = pd.DataFrame({'Actual': y_test, 'Predicted': y_pred})\ndf","78dd8a6f":"df1 = df.head(25)\ndf1.plot(kind='bar',figsize=(16,10))\nplt.grid(which='major', linestyle='-', linewidth='0.5', color='green')\nplt.grid(which='minor', linestyle=':', linewidth='0.5', color='black')\nplt.show()","c9023d26":"test = pd.read_csv(\"\/kaggle\/input\/osic-pulmonary-fibrosis-progression\/test.csv\")","c355ee05":"# test2 = test[['Percent','Weeks','Age']].join(encoded)\ntest.head()","ec8eb397":"test['Patient_Week'] = test['Patient'].astype(str)+\"_\"+test['Weeks'].astype(str)\ntest.head()","aba64d6a":"test.groupby('SmokingStatus')['FVC'].mean() ","2a5438fb":"# Apply the label encoder to each column\nencoded = test[cat_features].apply(encoder.fit_transform)\ntest2 = test[['Patient','Percent','Weeks','Age']].join(encoded)","6f5cdbab":"test2.head(100)","a579d5ab":"submission = pd.read_csv(\"\/kaggle\/input\/osic-pulmonary-fibrosis-progression\/sample_submission.csv\")","fc19f303":"submission.head(100)","6f32307e":"submission[['Patient','Weeks']] = submission.Patient_Week.str.split(\"_\",expand=True,)","e9859375":"submission.head()","c7da4f30":"submission = submission.drop('FVC',1)\nsubmission = submission.drop('Confidence',1)\ntest2 = test2.drop('Weeks',1)","8aa4c858":"submission2 = pd.merge(submission,test2,on='Patient',how='left')\nsubmission2.head(100)","e1d21337":"X2 = submission2[['SmokingStatus','Age','Sex','Weeks','Percent']]\nsubmission2['FVC'] = regressor.predict(X2)","63c8071e":"submission2.head()","ec7356d2":"submission2.shape","52504aec":"submission2.groupby(['SmokingStatus','Sex','Age'])['FVC'].mean()","69351e7e":"submission2['FVC_Group'] = submission2.groupby(['SmokingStatus','Sex','Age'])['FVC'].transform('mean')","f46bdbad":"submission2.head(100)","4a3b576f":"submission2['Confidence'] = 100*submission2['FVC']\/submission2['FVC_Group']","f9aa9335":"submission2.head(100)","1b01fc19":"submission3 = submission2[['Patient_Week','FVC','Confidence']]","750e4720":"submission3.head()","eb56e272":"submission3['FVC'] = submission3['FVC'].astype(int)\nsubmission3['Confidence'] = submission3['Confidence'].astype(int)","905dcee2":"submission3.head()","ee4c85a7":"submission3.to_csv(\"\/kaggle\/working\/submission.csv\",index=False)","f1ce8552":"# Create training, validation, and test splits","4eb42ecd":"# Read in the inputs","a87b6f99":"# Predictions","b2f71aa0":"Looks like a lot of ex-smokers 118 of 176 i.e., 67%. I wonder if people who never smoked have high lung capacity?","4773999a":"# Evaluation Metric","92d18a99":"# Prep categorical variables","cb305a46":"# Simple Linear Regression Model","0059d15d":"Looks like 176 unique patients! Let's try and explain one row in words. If we look at previous display of rows, for example - patient ID00007637202177411956430 , we can say that this person is a male, ex-smoker and 79 years old. What's the percent, weeks and FVC? \n\nWhy is weeks negative? From data description - \"the relative number of weeks pre\/post the baseline CT (may be negative)\"\n\nOthers from Data Description:\nFVC - is the recorded lung capacity in ml\n(What's a good FVC value?)\n\nPercent- a computed field which approximates the patient's FVC as a percent of the typical FVC for a person of similar characteristics. \n\nWhat's the goal?\nIt seems like we have to predict the lung capacity based on gender, smoking status, age and also use the CT scans I guess?\n\nHow is the model evaluated?\nAs per competition page, \"This competition is evaluated on a modified version of the Laplace Log Likelihood. In medical applications, it is useful to evaluate a model's confidence in its decisions. Accordingly, the metric is designed to reflect both the accuracy and certainty of each prediction.\"\n\n"}}