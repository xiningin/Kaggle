{"cell_type":{"f91c204c":"code","eb3cfd23":"code","8acf25c1":"code","648c9dda":"code","c237c040":"code","cf36f8f9":"code","f58e81d9":"code","fa4ba98e":"code","b1312469":"code","c55cfc26":"code","cd150d42":"code","d84d2ead":"code","0d68f7b8":"code","84228103":"code","28ee4f68":"code","625307f2":"code","b5eb0a66":"code","8c46d291":"code","86b205af":"code","18193112":"code","91594bbb":"code","5f1e60b2":"code","d72b5e13":"markdown","9cff7c89":"markdown","13789e25":"markdown","08ec8bc3":"markdown","2439bf36":"markdown","9999dec9":"markdown","1aecb05a":"markdown","75ca9f6e":"markdown","f908ede7":"markdown","1415df52":"markdown","1612f50f":"markdown","de96fb8f":"markdown","dd55600c":"markdown","17a659d8":"markdown","ce2e5344":"markdown","d2b70523":"markdown","16f1b2a4":"markdown","6a18db0b":"markdown","97eed20a":"markdown","884d97be":"markdown"},"source":{"f91c204c":"!pip install torch\n!pip install -Uqq fastbook\n!pip install google-colab\nimport fastbook","eb3cfd23":"from fastbook import *\nfrom google.colab import files\nfrom IPython.display import Image\nfrom IPython.display import HTML","8acf25c1":"path = Path('..\/input\/foodydudy\/kaggle')","648c9dda":"dblock = DataBlock(\n    blocks=(ImageBlock, CategoryBlock), #x - image; y - single class\n    get_items=get_image_files, #get image\n    splitter=GrandparentSplitter(), #use parent folder as train-valid split\n    get_y=parent_label, #use parent folder as label\n    #two choices for resizing and rationale\n    #squishing to prevent cropping places without chips\/raisins\n    # item_tfms=Resize(224, method=ResizeMethod.Squish), \n    # #cropping to preserve image quality; tried and doesn't work - peaked at 0.85 val acc\n    # item_tfms=RandomResizedCrop(512),\n    batch_tfms=aug_transforms(size=512)\n    )\ndls = dblock.dataloaders(path, bs=64) #batch size = 64","c237c040":"dls.train.show_batch(max_n=70,nrows=10)","cf36f8f9":"learn = cnn_learner(dls, resnet34, metrics=error_rate)\nlearn.fine_tune(10)","f58e81d9":"interp = ClassificationInterpretation.from_learner(learn)\ninterp.plot_confusion_matrix(figsize=(10,10))","fa4ba98e":"Image('47thaifood.png')","b1312469":"interp.plot_top_losses(100, nrows=10)","c55cfc26":"learn.save('model')","cd150d42":"exportfilename='export.pkl'\nlearn.export(exportfilename)\npath = Path()\npath.ls(file_exts='.pkl')","d84d2ead":"dblock2 = DataBlock(\n    blocks=(ImageBlock, CategoryBlock), #x - image; y - single class\n    get_items=get_image_files, #get image\n    splitter=GrandparentSplitter(valid_name='test'), #use parent folder as train-test split\n    get_y=parent_label, #use parent folder as label\n    batch_tfms=aug_transforms(size=512)\n    )\ndls2 = dblock2.dataloaders(path, bs=64) #batch size = 64\n\nlearn = cnn_learner(dls2, resnet34, metrics=error_rate).to_fp16()\n#load trained model\nlearn.load('model');","0d68f7b8":"interp = ClassificationInterpretation.from_learner(learn)\ninterp.plot_confusion_matrix(figsize=(10,10))","84228103":"interp.print_classification_report() ","28ee4f68":"files.download(exportfilename)","625307f2":"uploaded = files.upload()","b5eb0a66":"imagetotest='test4.jpg'\nImage(imagetotest)","8c46d291":"learn.predict(imagetotest)\nresult=learn.predict(imagetotest)\npredictcat=int(result[0])\npredictindex=int(result[1])\npredictpct=result[2][predictindex]\npredictcat\n\"Cat=\" + str(predictcat) + \" : %=\" + str(float(predictpct)*100)","86b205af":"uploaded = files.upload()\npath.ls(file_exts='.pkl')","18193112":"learn_inf = load_learner('resnet34-10.pkl')","91594bbb":"learn_inf.predict('test4.jpg')","5f1e60b2":"youtubeid='EEoyMhOuCAU'\nHTML('<iframe width=\"560\" height=\"315\" src=\"https:\/\/www.youtube.com\/embed\/' + youtubeid + '\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen><\/iframe>')","d72b5e13":"Creating a Confusion Matrix for test set","9cff7c89":"Learns from the exported model","13789e25":"Create\n Datablock","08ec8bc3":"Displaying Food Chart","2439bf36":"Upload Thai food images for testing","9999dec9":"Training","1aecb05a":"Prints Top Loss","75ca9f6e":"Predicting test image","f908ede7":"Download the model into local drive","1415df52":"Install Pytorch and fastbook","1612f50f":"Prints out classification Report","de96fb8f":"Creating the datablock that is used for the test set","dd55600c":"Creating a Confusion Matrix","17a659d8":"The model tries to predict the image","ce2e5344":"Import fastbook, colab, image display library","d2b70523":"Saving the model","16f1b2a4":"Exporting the model","6a18db0b":"Presentation Video!","97eed20a":"Upload previous exported model here","884d97be":"Displaying the test image"}}