{"cell_type":{"6f905d07":"code","2efd2e80":"code","4982b773":"code","3d2ba99c":"code","99eb4777":"code","21379e6f":"code","1b6ac097":"code","4b49a82e":"code","4eb9ce49":"code","20a731c2":"code","6e728513":"code","692e7503":"code","1cb08573":"code","bd8a593d":"code","d5037c36":"code","7324db18":"code","2446e1ef":"code","1853d64a":"code","16b87723":"code","636ba74b":"code","f4e6378d":"code","22c17298":"code","e7f7f7fd":"markdown","acc9229c":"markdown","d6327b9c":"markdown","8947303b":"markdown","ea67a8df":"markdown","30133264":"markdown","1672cdc6":"markdown","339148ad":"markdown","a3b1fe3f":"markdown","4fa4c346":"markdown","af7640a8":"markdown","3560ade9":"markdown","a05991e6":"markdown","d3de5c94":"markdown","c0c11dac":"markdown","117b8443":"markdown"},"source":{"6f905d07":"import numpy as np \nimport pandas as pd \nimport seaborn as sns; sns.set(style=\"ticks\", color_codes=True)\n\nimport matplotlib as mpl\nimport matplotlib.pylab as plt\nplt.style.use('fivethirtyeight')\n%matplotlib inline\n\nimport os\n\nimport geopandas as gpd\nimport shapely\nfrom shapely.geometry import Point\nfrom matplotlib.colors import ListedColormap\n\nfrom PIL import Image\n","2efd2e80":"# Customised Color Palette\ncolors=[\"#7831F9\",\"#C22989\",\"#DE1149\",\"#AE8281\",\"#69BA31\"]\ncmap = ListedColormap(colors)","4982b773":"basepath = '..\/input\/data-science-for-good\/cpe-data'\ndept_35_pov = pd.read_csv(basepath+'\/Dept_35-00103\/35-00103_ACS_data\/35-00103_ACS_poverty\/ACS_16_5YR_S1701_with_ann.csv').iloc[1:].reset_index(drop=True)\ndept_35_race = pd.read_csv(basepath+'\/Dept_35-00103\/35-00103_ACS_data\/35-00103_ACS_race-sex-age\/ACS_15_5YR_DP05_with_ann.csv').iloc[1:].reset_index(drop=True)\ndept_35_edu = pd.read_csv(basepath+'\/Dept_35-00103\/35-00103_ACS_data\/35-00103_ACS_education-attainment-over-25\/ACS_16_5YR_B15003_with_ann.csv').iloc[1:].reset_index(drop=True)\n\npolice_arrest_df = pd.read_csv(basepath+'\/Dept_35-00103\/35-00103_UOF-OIS-P_prepped.csv').iloc[1:].reset_index(drop=True)\npolice_shp_gdf = gpd.read_file(basepath+'\/Dept_35-00103\/35-00103_Shapefiles\/CMPD_Police_Division_Offices.shp')","3d2ba99c":"dept_35_pov['HC02_EST_VC01'] = dept_35_pov['HC02_EST_VC01'].apply(int)\n\ntotal_population = pd.to_numeric(dept_35_pov['HC01_EST_VC01'][1:]).sum()\nbelow_pv_line = ((pd.to_numeric(dept_35_pov['HC02_EST_VC01'][1:]).sum()) \/ total_population) * 100","99eb4777":"\nrace_df = pd.DataFrame({\n    'white': pd.to_numeric(dept_35_race['HC01_VC49']),\n    'af_am':pd.to_numeric(dept_35_race['HC01_VC50']),\n    'asian':pd.to_numeric(dept_35_race['HC01_VC56']),\n    'native':pd.to_numeric(dept_35_race['HC01_VC51']),\n    'hispanic': pd.to_numeric(dept_35_race['HC01_VC88']),\n    'other': pd.to_numeric(dept_35_race['HC01_VC69'])\n}, columns=['white','af_am','asian','native', 'hispanic','other'])\nfig1, ax1 = plt.subplots(figsize=(15,7))\nax1.set_title(\"Distributions of race in North Carolina\", fontsize=20)\nrace_df.plot.box(ax=ax1)","21379e6f":"age_hist = pd.DataFrame({\n    '< 5': pd.to_numeric(dept_35_race['HC01_VC08']),\n    '15-19': pd.to_numeric(dept_35_race['HC01_VC11']),\n    '20-24': pd.to_numeric(dept_35_race['HC01_VC12']),\n    '25-34': pd.to_numeric(dept_35_race['HC01_VC13']),\n    '35-44':pd.to_numeric(dept_35_race['HC01_VC14']),\n    '45-54':pd.to_numeric(dept_35_race['HC01_VC15']),\n    '55-59':pd.to_numeric(dept_35_race['HC01_VC16']),\n    '60-64':pd.to_numeric(dept_35_race['HC01_VC17']),\n    '65-74':pd.to_numeric(dept_35_race['HC01_VC18']),\n    '75-84':pd.to_numeric(dept_35_race['HC01_VC19'])\n}, columns=['< 5','15-19','20-24','25-34','35-44','45-54','55-59','60-64','65-74','75-84'])\nfig2, ax2 = plt.subplots(figsize=(15,7))\nax2.set_title(\"Distributions of age in North Carolina\", fontsize=20)\nage_hist.plot.box(ax=ax2)","1b6ac097":"eduation_df = pd.DataFrame({\n    'no_schooling': pd.to_numeric(dept_35_edu['HD01_VD02']),\n    'regular_high_school_diploma':pd.to_numeric(dept_35_edu['HD01_VD17']),\n    'college_no_degree':pd.to_numeric(dept_35_edu['HD01_VD20']),\n    'associates_degree':pd.to_numeric(dept_35_edu['HD01_VD21']),\n    'bachelors_degree':pd.to_numeric(dept_35_edu['HD01_VD22']),\n    'masters_degree':pd.to_numeric(dept_35_edu['HD01_VD23']),\n    'doctorate':pd.to_numeric(dept_35_edu['HD01_VD25'])\n}, columns=['no_schooling','regular_high_school_diploma','college_no_degree','associates_degree','bachelors_degree','masters_degree','doctorate'])","4b49a82e":"fig2t, ax2t = plt.subplots(figsize=(15,7))\nax2t.set_title(\"Distributions of Education\", fontsize=20)\neduation_df.plot.box(ax=ax2t)\n","4eb9ce49":"pov_df = pd.DataFrame({\n    'under_18': pd.to_numeric(dept_35_pov['HC02_EST_VC03']),\n    '18-24': pd.to_numeric(dept_35_pov['HC02_EST_VC67']),\n    '25-34':pd.to_numeric(dept_35_pov['HC02_EST_VC68']),\n    '35-44':pd.to_numeric(dept_35_pov['HC02_EST_VC69']),\n    '45-54':pd.to_numeric(dept_35_pov['HC02_EST_VC70']),\n    '55-64':pd.to_numeric(dept_35_pov['HC02_EST_VC71']),\n    '75+':pd.to_numeric(dept_35_pov['HC02_EST_VC73']),\n}, columns=['under_18','18-24','25-34','35-44','45-54','55-64','75+'])\n\nfig2t1, ax2t1 = plt.subplots(figsize=(15,7))\nax2t1.set_title(\"Distributions of Poverty Levels by Age\", fontsize=20)\npov_df.plot.box(ax=ax2t1)","20a731c2":"pov_df_race = pd.DataFrame({\n    'white': pd.to_numeric(dept_35_pov['HC02_EST_VC18']),\n    'african_american': pd.to_numeric(dept_35_pov['HC02_EST_VC19']),\n    'asian':pd.to_numeric(dept_35_pov['HC02_EST_VC21']),\n}, columns=['white','african_american','asian'])\n\nfig2t2, ax2t2 = plt.subplots(figsize=(15,7))\nax2t2.set_title(\"Distributions of Poverty Levels by Race\", fontsize=20)\npov_df_race.plot.box(ax=ax2t2)","6e728513":"latlon_exists_index = police_arrest_df[['LOCATION_LATITUDE','LOCATION_LONGITUDE']].dropna().index\n\npolice_arrest_df = police_arrest_df.iloc[latlon_exists_index].reset_index(drop=True)\npolice_arrest_df['LOCATION_LATITUDE'] = (police_arrest_df['LOCATION_LATITUDE'].astype(float))\npolice_arrest_df['LOCATION_LONGITUDE'] = (police_arrest_df['LOCATION_LONGITUDE'].astype(float))","692e7503":"police_arrest_df['geometry'] = (police_arrest_df.apply(lambda x: Point(x['LOCATION_LONGITUDE'], \n                                                                      x['LOCATION_LATITUDE']), axis=1))\n\npolice_arrest_gdf = gpd.GeoDataFrame(police_arrest_df, geometry='geometry')\npolice_arrest_gdf = police_arrest_gdf.dropna(axis=0)\npolice_arrest_gdf['INCIDENT_YEAR'] = police_arrest_gdf['INCIDENT_DATE'].apply(lambda x: x.split('-')[0])\npolice_arrest_gdf.crs = {'init':'epsg:4326'}","1cb08573":"police_shp_gdf = police_shp_gdf.to_crs(epsg=4326)","bd8a593d":"nc_tract = gpd.read_file('..\/input\/northcarolinatract\/cb_2017_37_tract_500k.shp')\ndept_35_pov = dept_35_pov.rename(columns={'GEO.id2':'GEOID'})\ndept_35_edu = dept_35_edu.rename(columns={'GEO.id2':'GEOID'})\ndept_35_race = dept_35_race.rename(columns={'GEO.id2':'GEOID'})\n\ncensus_merged = nc_tract.merge(dept_35_pov, on = 'GEOID') \ncensus_merged_edu = nc_tract.merge(dept_35_edu, on = 'GEOID')\ncensus_merged_race = nc_tract.merge(dept_35_race, on='GEOID')\n\ncensus_merged = census_merged.to_crs(epsg = 4326)\ncensus_merged_edu = census_merged_edu.to_crs(epsg = 4326)\ncensus_merged_race = census_merged_race.to_crs(epsg = 4326)","d5037c36":"# North Carolina Poverty Map.\ncensus_merged_edu['HD01_VD22'] = census_merged_edu['HD01_VD22'].apply(int)\nfig3t, (ax3t1, ax3t2,ax3t3) = plt.subplots(nrows=1, ncols=3)\n\ncensus_merged_edu.plot(ax=ax3t1, edgecolor='grey', column=\"HD01_VD22\", cmap='Blues')\ncensus_merged.plot(ax=ax3t2, edgecolor='grey', column=\"HC02_EST_VC01\", cmap='Blues')\ncensus_merged_edu.plot(ax=ax3t3, edgecolor='grey', column=\"HD01_VD02\", cmap='Blues')\n\nax3t1.set_title(\"Education of North Carolina: Bachelors Degree\", fontsize=15)\nax3t2.set_title(\"Poverty density of North Carolina\", fontsize=15)\nax3t3.set_title(\"Education in North Carolina: No Schooling\", fontsize=15)\n\nax3t1.set_axis_off()\nax3t2.set_axis_off()\nax3t3.set_axis_off()\n\nfig3t.set_size_inches(20,16)","7324db18":"# North Carolina Race Map.\ncensus_merged_race['HC01_VC50'] = census_merged_race['HC01_VC50'].apply(int) # African American\ncensus_merged_race['HC01_VC49'] = census_merged_race['HC01_VC49'].apply(int) # White\ncensus_merged_race['HC01_VC88'] = census_merged_race['HC01_VC88'].apply(int) # Hispanic\n\nfig3t1, (ax3t01,ax3t11, ax3t21,ax3t31) = plt.subplots(nrows=1, ncols=4)\n\ncensus_merged.plot(ax=ax3t01, edgecolor='grey', column=\"HC02_EST_VC01\", cmap='Blues')\ncensus_merged_race.plot(ax=ax3t11, edgecolor='grey', column=\"HC01_VC50\", cmap='Blues')\ncensus_merged_race.plot(ax=ax3t21, edgecolor='grey', column=\"HC01_VC49\", cmap='Blues')\ncensus_merged_race.plot(ax=ax3t31, edgecolor='grey', column=\"HC01_VC88\", cmap='Blues')\n\nax3t01.set_title(\"Poverty Density Map\", fontsize=15)\nax3t11.set_title(\"Spread of African American population across districts\", fontsize=15)\nax3t21.set_title(\"Spread of White population across districts\", fontsize=15)\nax3t31.set_title(\"Spread of Hispanic population across districts\", fontsize=15)\n\nax3t01.set_axis_off()\nax3t11.set_axis_off()\nax3t21.set_axis_off()\nax3t31.set_axis_off()\n\nfig3t1.set_size_inches(25,20)","2446e1ef":"census_merged['coords'] = census_merged['geometry'].apply(lambda x: x.representative_point().coords[:])\ncensus_merged['coords'] = [coords[0] for coords in census_merged['coords']]\n\nfig4t2, ax4t2 = plt.subplots()\nax4t2.set_title(\"North Carolina by Census Tract\", fontsize=18)\ncensus_merged.plot(ax=ax4t2, column=\"NAME\",edgecolor='b', linewidth = 1.5, alpha=.3)\ncensus_merged.apply(lambda x: ax4t2.annotate(s=x.NAME, xy=x.geometry.centroid.coords[0], ha='center'), axis=1)\nfig4t2.set_size_inches(15,15)","1853d64a":"#RTree is not installed therefore spatial joins don't work, so ill have to add a screenshot of what the above graph looked like:\n\nImage.open('..\/input\/screenshot-of-arrests\/Screen Shot 2018-10-22 at 8.40.56 AM.png')","16b87723":"fig, ax = plt.subplots(figsize=(15,7))\npolice_arrest_gdf.groupby(['SUBJECT_RACE', 'SUBJECT_INJURY_TYPE']).count()['INCIDENT_UNIQUE_IDENTIFIER'].unstack().plot.bar(ax=ax)","636ba74b":"no_arrest_per_year = police_arrest_gdf['INCIDENT_YEAR'].value_counts()\n\nyear_total_df = pd.DataFrame(no_arrest_per_year.reset_index().values, columns=['year','total'])\nyr_idx = year_total_df.sort_index(axis=0, ascending=True)","f4e6378d":"fig, ax = plt.subplots(figsize=(15,7))\nsns.kdeplot(year_total_df['year'], shade=True, ax=ax)","22c17298":"fig, ax = plt.subplots(figsize=(15,7))\nsns.kdeplot(police_arrest_gdf['SUBJECT_AGE_IN_YEARS'], shade=True, ax=ax)","e7f7f7fd":"#### Results:\nFrom the boxplot above it is evident that the White race is quite dominant in the state followed by a strong african american population. The circles above the boxplot indicate outliers per region. From the graph we can conclude that the average population of the White race is approximately **~2200** per tract, and the average African American population per district is just above **1000**.\n\n#### Age distribution across the state. \n\nLet's have a look at how the ages compare across the state, in the same way we did above. ","acc9229c":"### Getting Police Districts in North Carolina\n\nThe `police_shp_gdf` is supposed to represent the police divisions in North Carolina, however observing the data they only give the point locations of the district, so we can use a spatial join to get a better visual of the area each district covers.","d6327b9c":"### Conclusion\n\nWith little data provided it is difficult to understand the nature of the arrests we see on the map as a representation of the whole state. If we can make a correlation between poverty levels and arrests, meaning areas with greater poverty will have greater arrests, then it would be safe to say there is less likelihood that arrests made on african american's in parts of the district where there is higher education has a **higher probabliity** of being an arrest based on racial profiling.","8947303b":"### Results\nNow we have a representation of the arrests made in relation to the police districts, so we can track the racial seperation of each district and compare them. Most of the arrests made from the dataset are around the same area where the poverty levels are high, this seems to make sense, however it is not possible to assume the nature of these arrests.\nLet's have a look at the arrests data and see if we can find any correlations.\n","ea67a8df":"### Results\nThere seems to be a high youth poverty rate over other ages in North Carolina, mostly under 18, but there are a few outliers in the 18-24 range, this corresponds to the age of most arrests distribution further down.","30133264":"### Results\nA majority of the data is quite old, so the data may be bias due to changes in the census data since then. The arrests data is quite small as well ~ 80 datapoints, this may not be enough to gather true patterns. ","1672cdc6":"### Results\nAs a state North Carolina seems to be a well educated, with a majority of people who went to college and got a bachelors degree, but it is still not evident where these areas of high education are. \nThis is where the geoplots below will help.","339148ad":"### Results\nOf those arrests, a majority of them were Black, with a larger number of Fatal injuries, than any  other race. \n","a3b1fe3f":"### Results\n\nThere seems to be a correlation between education levels and poverty levels, districts with higher education tend to have less poverty, this seems obvious and can be proven true above. There are also areas in the North Carolina where there is a large populus of No Schooling, this also correlates to the areas where poverty is higher. ","4fa4c346":"### Geoplotting\nLet's now have a look at plotting the North Carolina district and see if there is any patterns we can obtain from the results in terms of the arrests and areas.","af7640a8":"### Results\nThe distribution of african american poverty levels are a bit higher than the white population, however there are a higher range of outliers for african americans in parts of North Carolina.","3560ade9":"### Results\nFrom the map above we can start to see a similarity between the poverty density and the spread of the african american population. This is where most of the arrests seems to be made aswell. ","a05991e6":"## Mecklenburg Country, North Carolina\n\n**Total Population**: 992,212 \n\n**Percent Below Poverty Line**: 14.17%\n\n#### Distributions  of Race\n\nLet's have a look at the distributions of race across the state, I decided to draw a boxplot around this to get an idea of the spread of each category of race.","d3de5c94":"#### Results\nFrom the graph above we can see a rise in distribution across the 25-54 range, so it is fair to conclude the median age is somewhere around 34-44.\n\n### Education:","c0c11dac":"### Results\nMost of the subjects were around 20-30 years of age when they got arrested. From the figure of Distribution of Poverty levels by Age, this seems to correlate with the higher levels of youth poverty. ","117b8443":"> districts = gpd.sjoin(census_merged, police_shp_gdf, how='inner', op='intersects')\n> districts = districts.to_crs(epsg = 4326)\n> \n> fig6, ax6 = plt.subplots()\n> ax6.set_title(\"Police districts of North Carolina and arrests made by race\", fontsize=20)\n> \n> police_arrest_gdf.plot(ax = ax6, markersize=50, column=\"SUBJECT_RACE\",legend=True, cmap = cmap)\n> \n> districts.plot(ax=ax6, column='NAME_left', markersize=5, edgecolor='b', color='none', linewidth = 1.5)\n> districts.apply(lambda x: ax6.annotate(s=x.NAME_left, xy=x.geometry.centroid.coords[0], ha='center'), axis=1)\n> census_merged.plot(ax=ax6, alpha=.2, edgecolor='black')\n> fig6.set_size_inches(15,15)"}}