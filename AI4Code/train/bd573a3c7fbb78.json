{"cell_type":{"1e6f724b":"code","475a9799":"code","67fccb9a":"code","61d6b265":"code","c1e1a474":"code","1cb680a3":"code","e268f842":"code","ae0c36cd":"code","a9023f7c":"code","64d5528d":"code","d43697e6":"code","f232cc6d":"code","6d80b3ed":"code","ba199ff2":"code","638cf240":"code","82be44ce":"code","6a0df1a2":"code","35ce2cb9":"code","1394f486":"code","1bdbf1ef":"code","34acca9d":"code","bb31e42a":"code","48eba530":"code","bd38cbdd":"code","1fef5acc":"code","c9f52fd5":"code","b9a94ed7":"code","3540a2e3":"code","a290e89c":"code","cbe1a7dd":"code","d195a0e2":"code","200a4a1c":"code","0a2dddc3":"markdown","a93c45fe":"markdown","fab491da":"markdown","e409e2e9":"markdown","4ac188a9":"markdown","39f6f36b":"markdown","b0daac1b":"markdown","9549f37d":"markdown","4f1450de":"markdown","10b91b68":"markdown","362d87f8":"markdown","ded8dd6c":"markdown","01f2022e":"markdown","20548531":"markdown","33e21660":"markdown","12dcd9f4":"markdown","bee92d30":"markdown","4771201a":"markdown","2ae7e66a":"markdown","8d13e87b":"markdown","d1a20b2d":"markdown","5e79353e":"markdown","302b250d":"markdown","4d8ec685":"markdown","861856f1":"markdown","0b7a145f":"markdown","3a13e8f5":"markdown","a5e379e2":"markdown","e49d5c71":"markdown"},"source":{"1e6f724b":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","475a9799":"import numpy as np, pandas as pd, matplotlib.pyplot as plt\nplt.style.use('bmh')\nimport warnings\nwarnings.filterwarnings('ignore')\n\npd.options.display.float_format = '{:.6f}'.format\nimport seaborn as sns\nimport matplotlib\nmatplotlib.rcParams.update({'font.size': 12, 'font.family': 'Verdana'})","67fccb9a":"df = pd.read_csv(\"..\/input\/new-york-city-airbnb-open-data\/AB_NYC_2019.csv\")","61d6b265":"df.head(10)","c1e1a474":"print('Number of records -->', df.shape[0])\nprint('Number of features -->', df.shape[1])","1cb680a3":"print('Features type:')\ndf.dtypes","e268f842":"print('Number of null values for each feature:')\ndf.isnull().sum()","ae0c36cd":"df.info()","a9023f7c":"df1 = df[['id', 'host_id', 'neighbourhood_group', 'neighbourhood', \\\n          'latitude', 'longitude', 'room_type','price','minimum_nights','number_of_reviews']]","64d5528d":"df1.head(10)","d43697e6":"df1.shape","f232cc6d":"print('Neighbourhood group:', pd.unique(df1.neighbourhood_group), '\\n', 'Room type:',pd.unique(df1.room_type))","6d80b3ed":"fig, ax = plt.subplots(figsize = (10,10))\nsns.scatterplot(x='longitude', y='latitude', hue='neighbourhood_group', ax = ax, s = 20, alpha = 0.2, data=df1);\nplt.title('Scatterplot evidencing Airbnb listing density in New York');","ba199ff2":"groupedbyZone = df1.groupby('neighbourhood_group')\nfig, ax = plt.subplots(1,2, figsize = (14,6))\nsns.countplot(df1['neighbourhood_group'], ax = ax[0], linewidth=1, edgecolor='w')\nsns.countplot(df1['neighbourhood_group'], hue = df1['room_type'], ax = ax[1], linewidth=1, edgecolor='w')\nax[0].set_xlabel('Borough', labelpad = 10);\nax[1].set_xlabel('Borough', labelpad = 10);\nax[0].set_ylabel('Listings number');\nax[1].set_ylabel('Listings number');\nplt.tight_layout();","638cf240":"sns.catplot('neighbourhood_group', 'minimum_nights', hue = 'room_type', data = df1, \n            kind = 'bar', ci = None, linewidth=1, edgecolor='w', height=8.27, aspect=11.7\/8.27)\nplt.xlabel('Borough', fontsize = 15, labelpad = 15)\nplt.xticks(fontsize = 13)\nplt.ylabel('Average minimum nights per listing',fontsize = 17, labelpad = 14);","82be44ce":"sns.catplot('neighbourhood_group', y = 'number_of_reviews', hue = 'room_type',  kind = 'bar', \n            ci = None, data = df1, linewidth=1, edgecolor='w', height=8.27, aspect=11.7\/8.27)\nplt.xlabel('Borough', fontsize = 15, labelpad = 15)\nplt.xticks(fontsize = 13)\nplt.ylabel('Average number of reviews per listing', fontsize = 17, labelpad = 14);","6a0df1a2":"print(df1.price.describe(), '\\n')\nprint('--> 98th Price percentile:',np.percentile(df1.price, 98), '$')","35ce2cb9":"price98thPerc = pd.pivot_table(df1, values = ['price'], index = ['neighbourhood_group'], \\\n                                aggfunc = lambda x: int(np.percentile(x, 98)))\nprice98thPerc.rename(columns = {'price' : '98th price percentile'}, inplace = True)\n#price98thPerc.iloc[:,0] = price98thPerc.iloc[:,0].map('$ {}'.format)\nprice98thPerc\n","1394f486":"df1_merged = pd.merge(df1, price98thPerc, left_on ='neighbourhood_group', right_on = price98thPerc.index)\ndf1_noPriceOutliers = df1_merged[df1_merged['price'] < df1_merged['98th price percentile']]\n\nnumberOutliers = df1.shape[0] - df1_noPriceOutliers.shape[0]\nprint('In all New York there are {} listing extreme prices.'. format(numberOutliers))\nprint('But they represents only the {} % of total listing prices.'.format(round(numberOutliers \/ df1.shape[0], 3)))","1bdbf1ef":"plt.figure(figsize=(14,10))\nax = plt.gca()\ndf1_noPriceOutliers.plot(kind='scatter', x='longitude', y='latitude', c='price', ax=ax, cmap=plt.get_cmap('RdBu'), colorbar=True, alpha=0.7);","34acca9d":"print('There are {} neighbourhoods present in this dataset.'.format(len(df1.neighbourhood.unique())))","bb31e42a":"intop10  = df1[df1.neighbourhood.isin(list(df1.neighbourhood.value_counts(ascending = False).head(10).index))]\ntopten = intop10.neighbourhood.value_counts(ascending = False).to_frame()\ntopten.rename(columns = {'neighbourhood': 'number of listings'}, inplace = True)\ntopten","48eba530":"print('Fraction and Cumulative fraction of top 10 neighbourhood over total listings:')\nneighweight = pd.DataFrame([intop10.neighbourhood.value_counts()*100 \/ df.neighbourhood.value_counts().sum(), \n             np.cumsum(intop10.neighbourhood.value_counts()*100 \/ df.neighbourhood.value_counts().sum())],\\\n                index = ['% over total listings in New York','cumulative % over total listing in New York'])\nneighweight = neighweight.T\n#neighweight.rename(columns = {neighweight.columns[0]:'% over total listings', neighweight.columns[1]: 'cumulative %'})\nneighweight.name = 'Top 10 Neighbourhood'\nneighweight = neighweight.applymap('{:.1f}'.format)\nneighweight","bd38cbdd":"fig, ax = plt.subplots(figsize = (10,10))\nsns.scatterplot(x='longitude', y='latitude', hue='neighbourhood_group', ax = ax, s=20, alpha = 0.4, data=df1);\nsns.scatterplot(x='longitude', y='latitude', ax = ax, s=20, \\\n                color = 'b', label = 'Top 10 neighbourhood \\nfor Airbnb listings', alpha = 0.8, data = intop10);\nax.legend(loc = 'upper left', fancybox=True, framealpha=1, shadow=True, borderpad=1);\nax.set_title('Airbnb listings density in New York\\n Top 10 dense neighbourhood in Blue');","1fef5acc":"fig, ax = plt.subplots(figsize = (10,10))\n\nsns.scatterplot(x='longitude', y='latitude', hue='neighbourhood_group', ax = ax, s=20, alpha = 0.4, data=df1);\nsns.scatterplot(x='longitude', y='latitude', ax = ax, s=20, color = 'b', \\\n                alpha = 0.8, data = intop10[intop10.neighbourhood == 'Williamsburg'], label = 'Williamsburg');\nax.legend(fancybox=True, framealpha=1, shadow=True, borderpad=1);\nax.set_title('Airbnb listings density in New York\\n Williamsburg is the most dense neighbourhood');","c9f52fd5":"plt.figure(figsize = (8,8))\ndf1.price.plot(kind = 'hist', bins = 700, linewidth=1, edgecolor='white')\nplt.axis([0,600,0,7000]);\nplt.xlabel('Price', labelpad = 10);\nplt.ylabel('Number of listings per bin-price', labelpad = 15);\nplt.title('Airbnb daily price distribution in New York without outliers', pad = 15);","b9a94ed7":"g = df1_noPriceOutliers.groupby(['neighbourhood_group'])\nimport warnings\nwarnings.filterwarnings('ignore')\nfig, ax = plt.subplots(figsize = (16,11))\nfor _ , (k, group) in enumerate(g):\n    #ax[i].set_title(k)\n    group.price.hist(normed = False, ax = ax, bins = 40, label = k, alpha = 0.5, linewidth=1, edgecolor='white')\n    ax.legend();\nax.set_title('Price Histogram for borough', fontsize = 16, pad = 18);\nax.set_xlabel('Price', fontsize = 15, labelpad = 12)\nax.set_ylabel('Frequency in absolute value', fontsize = 15, labelpad = 12);","3540a2e3":"fig, ax = plt.subplots(figsize = (14,10))\nimport warnings\nwarnings.filterwarnings('ignore')\nfor _ , (k, group) in enumerate(g):\n    if k in ['Bronx', 'Staten Island']:\n        group.price.hist(normed = False, ax = ax, bins = 40, label = k, alpha = 0.5, linewidth=1, edgecolor='white')\n        ax.legend();\nax.set_title('Price Histogram for Bronx and Staten Island', fontsize = 16, pad = 18);\nax.set_xlabel('Price', fontsize = 15, labelpad = 12)\nax.set_ylabel('Frequency in absolute value', fontsize = 15, labelpad = 12);","a290e89c":"colors = ['red','tan','blue','green','lime']\nfig, ax = plt.subplots(3, 1, figsize = (18,18))\ndoublegrouped = df1_noPriceOutliers.groupby(['room_type','neighbourhood_group'])\nfor i, (name, combo) in enumerate(doublegrouped):\n    if i <= 4:\n        combo.price.plot(kind = 'hist', ax = ax[0], bins = 40, \n                         label = name, alpha = 0.5, linewidth=1, edgecolor='white');\n        ax[0].legend()\n        ax[0].set_title('Entire home \/ apt')\n    elif 5 <= i <= 9:\n        combo.price.plot(kind = 'hist', ax = ax[1], bins = 40, label = name, alpha = 0.5, linewidth=1, edgecolor='white');\n        ax[1].legend()\n        ax[1].set_title('Private room')\n    else:\n        combo.price.plot(kind = 'hist', ax = ax[2], bins = 40, label = name, alpha = 0.5, linewidth=1, edgecolor='white');\n        ax[2].legend()\n        ax[2].set_title('Shared room')\nfor i in range(3):\n    ax[i].set_ylabel('Frequency in absolute value', fontsize = 15, labelpad = 14)\nplt.suptitle('Price histograms by room type and borough', fontsize = 20);","cbe1a7dd":"fig, ax = plt.subplots(3, 1, figsize = (16,16))\ndoublegrouped = df1_noPriceOutliers.groupby(['room_type','neighbourhood_group'])\nfor i, (name, combo) in enumerate(doublegrouped):\n    if i <= 4 and name[1] in ['Bronx', 'Staten Island']:\n        combo.price.plot(kind = 'hist', ax = ax[0], bins = 40, \n                         label = name, alpha = 0.5, linewidth=1, edgecolor='white');\n        ax[0].legend()\n        ax[0].set_title('Entire home \/ apt')\n    elif 5 <= i <= 9 and name[1] in ['Bronx', 'Staten Island']:\n        combo.price.plot(kind = 'hist', ax = ax[1], bins = 40, label = name, alpha = 0.5, linewidth=1, edgecolor='white');\n        ax[1].legend()\n        ax[1].set_title('Private room')\n    elif i > 9 and name[1] in ['Bronx', 'Staten Island']:\n        combo.price.plot(kind = 'hist', ax = ax[2], bins = 40, label = name, alpha = 0.5, linewidth=1, edgecolor='white');\n        ax[2].legend()\n        ax[2].set_title('Shared room')\nfor k in ax:\n    k.set_ylabel('Listings number by bin-price', labelpad = 12)\nplt.suptitle('Price histogram by room type for Bronx and Staten Island', fontsize = 15);","d195a0e2":"from scipy.stats import iqr #let's import the interquartile range function from scipy","200a4a1c":"by_room_type = pd.pivot_table(df1, values = ['price'], index = ['room_type','neighbourhood_group'], aggfunc = {\"price\":[np.median, np.count_nonzero, iqr]})\nsubtables = []\nfor row in by_room_type.index.levels[0]:\n    subtables.append(by_room_type.loc[[row]].sort_values(by = ('price','median'), ascending = False))\nby_room_type = pd.concat(t for t in subtables)\n\nby_room_type[('price','median')] = by_room_type[('price','median')].map('$ {:.0f}'.format)\nby_room_type[('price','iqr')] = by_room_type[('price','iqr')].map('$ {:.0f}'.format)\nby_room_type[('price','count_nonzero')] = by_room_type[('price','count_nonzero')].map(int)\n\nby_room_type.columns.set_levels(['number listings','IQR','median price'],level=1,inplace=True)\nby_room_type.columns = by_room_type.columns.droplevel(0)\nby_room_type = by_room_type[['median price', 'IQR','number listings']] # change the column order\nby_room_type","0a2dddc3":"Which are the unique neighbourhood groups and the unique room types included in the dataset?","a93c45fe":"After importing the dataset we check out the first 10 records, in order to get acquainted with the structure of the dataset.","fab491da":"As you've noticed in this not normalized histogram, in Manhattan and Brookling not only price-distribution is more right-skewed (listings are more expensive) but there are also more listings, as you already know examining the first part of this analysis.\nBecause of last consideration, it's better to zoom the histogram for the Bronx and Staten Island boroughes:","e409e2e9":"Which are the ten neighbourhoods with the most Airbnb listings?","4ac188a9":"In Airbnb the host can specify a minimum number of nights for that listing.\nWhich are the average minimum number of nights per listing for the various boroughes and room type? You can see below.","39f6f36b":"<b>Our purpose is to know how Airbnb prices vary in New York, how they vary between the room types, and which areas of the City have the largest number of listings.<\/b>","b0daac1b":"## An Exploratory Data Analysis (EDA) on a Airbnb listings dataset ","9549f37d":"Let's zoom below for the Bronx and Staten Island boroughes:","4f1450de":"Let's do a brief digression: this graph is not so enlightening because it doesn't distinguish between the different boroughes and the different types of room.\nNevertheless it tells us one important thing: even without the outliers, the empirical price distribution of New York Airbnb listings is right-skewed.\nSo, as measure of central tendency i prefer to use the median (more robust), and not the mean.\nTherefore as measure of dispersion i prefere the interquartile range (IQR) and not the standard deviation (the standard deviation includes the mean in the formula, so if i don't use the mean as location metric i have to avoid the standard deviation).\nMaybe it's better to transform the price distribution to the log-price distribution: indeed the log transformation is appropriate when the empirical distribution can't take negative values and it is right-skewed. Moreover, if this latter transformation is very similar to a normal distribution (it can be verified with a QQ-plot), hence the price distribution follows a log-normal distribution.\nBut the point is: when we read an airbnb listing we reason in price or in log-prices? In prices of course, so for the moment we keep the original price-distribution. The point is: do we need to know which is the theoretical distribution (it cannot even exist sometimes) that is closest to the empirical price distribution? For the purpose of this analysis i don't think so.\nIndeed, an exploratory data analysis (EDA) with graphical means and tables, even with no precise associations with rigid theoretical models or distributions can be sufficient (and clearer) for certain goals.\nSometimes we may need to model in a more formal way, sometimes EDA can be sufficient to grasp what we want to know.\n\n\nThat said, let's plot the empirical price distribution distinguishing by borough:","10b91b68":"In this dataset we will utilize only a subset of features: for example we don't care about the gender of host, because we are not going to study how the listings are distributed on male and female (i'm not saying that it's wrong to mantain that feature, but that it's useless for our aims), so we are going to eliminate the <em>host name<\/em> feature. Or for example we don't care about how the listings are named (it may be interesting to analize even this feature but i guess it is less important than other aspects of the dataset) so we are going to eliminate also the <em>name<\/em> feature.<br>\nWe eliminate also the features with too many null values.\nAt the end, the feature we are interested in examining are:<br><br>\n<em>id<\/em> ---> it identifies the listing: so id values are unique<br>\n<em>host_id<\/em> ---> it identifies the host id: an host id can be associated with more than a listing, so this feature's values are not unique in the dataset <br>\n<em>neighbourhood_group<\/em> ---> for geolocation analysis <br>\n<em>neighbourhood<\/em> ---> for a more precise geolocation analysis <br>\n<em>latitude<\/em> ---> for the exact geolocation <br>\n<em>longitude<\/em> ---> for the exact geolocation <br>\n<em>room_type<\/em> ---> Very likely different types have different distribution daily prices so it's important to do a distinction <br>\n<em>price<\/em> ---> price for a night<br>\n<em>minimum_nights<\/em> ---> minimum nights to book for a single booking <br>\n<em>number_of_reviews<\/em> ---> number of reviews for a listing <br>","362d87f8":"The maximum price is \\\\$ 10000 and it represents a clear outlier given the fact that the 98th percentile is $ 550.<br> \n<u>The outlier analysis is a wide topic and we will dive into that in the second part of our study.<\/u><br> \nFor now we just study the 98th percentile truncated distribution of the prices.","ded8dd6c":"Now we can plot the scatterplot evidencing the different listing prices in New York without take care of extreme prices. In this way the scatterplot is more informative about the difference of prices relative to different parts of the City. You can see that below.","01f2022e":"Below (on the left) we have a confirmation of these different listing densities in New York.\nInstead on the right we distinguish between the different listings categories.","20548531":"The areas with thickened circles are the areas where the number of Airbnb listings is large.","33e21660":"Where is located Williamsburg, the most listing-populated neighbourhood? Let's see...","12dcd9f4":"Ok, we now are going to differentiate price distribution not only by borough, but also by room-type.","bee92d30":"So let's calculate the 98th percentile for each borough.","4771201a":"So, together, these 10 neighbourhood cover almost the 50% of all New York Airbnb listings.\nWhere they are located? Below the top 10 most listing-populated neighbourhood are scattered in blue color.","2ae7e66a":"Let's plot the scatterplot of the listings of our dataset:","8d13e87b":"I think that a recap of the last histograms with a pivot table is useful:","d1a20b2d":"A final consideration for this first part of the study: we can continue our analysis and investigate fully even the most strange relations and patterns, but the risk is to lose the whole picture. Informations must be assimilated by the analyst and adding more and more informations can be worthy only if they bring a sufficient value factor.\nOtherwise is better to truncate the information extracting process and focus the attention on the most relevant informations.","5e79353e":"And which are the number of reviews for the various boroughes and room types?","302b250d":"The skimmed dataset ha 48895 records and 10 features.","4d8ec685":"Let's continue our analysis deleting the outlier prices: for each borough we esclude the prices greater than the corresponding 98th percentile.\nIndeed, in this exploratory analysis the outliers don't represent our subject of study and they don't invalidate the logic of our analysis.","861856f1":"<br><br> \n### Now check out the principal prices statistics of these Airbnb listings in all New York.","0b7a145f":"Ok. Let's start now the second part of this analysis where we are going to focus about prices.\nCheck out the distribution of listing prices in all New York (until the 98th percentile).","3a13e8f5":"A recap of the data structure:","a5e379e2":"First 10 records of dataset used for our purposes.","e49d5c71":"New York has 5 boroughes but how many neighbourhoods are present in this dataset?"}}