{"cell_type":{"5df90a7d":"code","a7ccf33c":"code","10ef7449":"code","a776e649":"code","a4fd24b4":"code","6900ecf9":"code","87c17658":"code","66d978a3":"code","5438062a":"code","7d6c072e":"code","dd95158f":"code","aaee3700":"code","847000f0":"code","3ce762c5":"code","7fb86bed":"code","d6c31c14":"code","91ffe84d":"code","5140f1f3":"code","4e9f074f":"code","af4594d4":"markdown","669145ce":"markdown","aa307302":"markdown"},"source":{"5df90a7d":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport lightgbm as lgb\nfrom sklearn.model_selection import KFold\nfrom sklearn import model_selection, preprocessing, metrics\n\nfrom sklearn import preprocessing\nimport gc\n\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport warnings\nwarnings.simplefilter(action='ignore', category=FutureWarning)\n\nimport os\n#for dirname, _, filenames in os.walk('\/kaggle\/input'):\n#    for filename in filenames:\n#        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","a7ccf33c":"fnc_df = pd.read_csv(\"..\/input\/trends-assessment-prediction\/fnc.csv\")\nloading_df = pd.read_csv(\"..\/input\/trends-assessment-prediction\/loading.csv\")\n\nfnc_features, loading_features = list(fnc_df.columns[1:]), list(loading_df.columns[1:])\ndf = fnc_df.merge(loading_df, on=\"Id\")","10ef7449":"df.head()","a776e649":"df.shape","a4fd24b4":"labels_df = pd.read_csv(\"..\/input\/trends-assessment-prediction\/train_scores.csv\")\nreveal_ID_site2 = pd.read_csv(\"..\/input\/trends-assessment-prediction\/reveal_ID_site2.csv\")\nlabels_df.head()","6900ecf9":"labels_df.shape","87c17658":"reveal_ID_site2.head()","66d978a3":"reveal_ID_site2.shape","5438062a":"labels_df.shape","7d6c072e":"df['target'] = np.nan","dd95158f":"df.isna().sum().sum()","aaee3700":"df.loc[df.Id.isin(labels_df.Id), 'target'] = 0\ndf.loc[df.Id.isin(reveal_ID_site2.Id), 'target'] = 1\ndf.dropna(inplace=True)\n\ndf.shape","847000f0":"features = df.columns[1:-1]\ntrain = df[features].values\ntarget = df['target'].values","3ce762c5":"train, test, y_train, y_test = model_selection.train_test_split(train, target, test_size=0.33, random_state=42, shuffle=True)\ndel target\ngc.collect()","7fb86bed":"train = lgb.Dataset(train, label=y_train)\ntest = lgb.Dataset(test, label=y_test)","d6c31c14":"param = {'num_leaves': 50,\n         'min_data_in_leaf': 30, \n         'objective':'binary',\n         'max_depth': 5,\n         'learning_rate': 0.05,\n         \"min_child_samples\": 20,\n         \"boosting\": \"gbdt\",\n         \"feature_fraction\": 0.9,\n         \"bagging_freq\": 1,\n         \"bagging_fraction\": 0.9 ,\n         \"bagging_seed\": 56,\n         \"metric\": 'auc',\n         \"verbosity\": -1}","91ffe84d":"num_round = 10000\nclf = lgb.train(param, train, num_round, valid_sets = [train, test], verbose_eval=50, early_stopping_rounds = 100)","5140f1f3":"feature_imp = pd.DataFrame(sorted(zip(clf.feature_importance(),features)), columns=['Value','Feature'])\n\nplt.figure(figsize=(20, 20))\nsns.barplot(x=\"Value\", y=\"Feature\", data=feature_imp.sort_values(by=\"Value\", ascending=False).head(100))\nplt.title('LightGBM Features')\nplt.tight_layout()\nplt.show()\nplt.savefig('lgbm_importances-01.png')","4e9f074f":"feature_imp.sort_values(by=\"Value\", ascending=False).head(20)","af4594d4":"The AUC of 0.88 is much higher than the AUC of 0.72 for the \"regular\" train-test adversarial validation. Seems taht we really ahve to be very careful about the differences between sites 1 and 2.\n\nLet us now take a look at the most important features ","669145ce":"Here it would appear that the worst \"culprits\" are the IC features. Let's again list the top 20 most important ones, at least according to this measure.","aa307302":"In this adversarial validation notebook we'll take a look at the difference between sites 1 and 2."}}