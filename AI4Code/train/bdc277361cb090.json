{"cell_type":{"55790a19":"code","8895db46":"code","145e25c8":"code","135e5737":"code","3edb287e":"code","f27d4ef6":"code","608b3389":"code","e675956a":"code","ef80ded9":"code","0f5946d3":"code","1f05751c":"code","480c2d7a":"code","cbb74ab3":"code","8d6439c5":"code","70955c36":"markdown","d999665a":"markdown"},"source":{"55790a19":"import requests\nimport pandas as pd\n\n# Incep cu DailyCaseReport\n\nr = requests.get('https:\/\/covid19.geo-spatial.org\/api\/dashboard\/getDailyCaseReport')\n\ndef extract_values(obj, key): # e o functie care ma asigura ca pot citi jsonuri complexe\n    \n    arr = []\n\n    def extract(obj, arr, key):\n        \n        if isinstance(obj, dict):\n            for k, v in obj.items():\n                if isinstance(v, (dict, list)):\n                    extract(v, arr, key)\n                elif k == key:\n                    arr.append(v)\n        elif isinstance(obj, list):\n            for item in obj:\n                extract(item, arr, key)\n        return arr\n\n    rezultate = extract(obj, arr, key)\n    return rezultate\n\nday_case = extract_values(r.json(), 'day_case')\nday_no = extract_values(r.json(), 'day_no')\nnew_case_no = extract_values(r.json(), 'new_case_no')\nnew_dead_no = extract_values(r.json(), 'new_dead_no')\nnew_healed_no = extract_values(r.json(), 'new_healed_no')\ntotal_case = extract_values(r.json(), 'total_case')\ntotal_dead = extract_values(r.json(), 'total_dead')\ntotal_healed = extract_values(r.json(), 'total_healed')\n\nCazuriZilnice = pd.DataFrame()\nCazuriZilnice['Data'] = day_case\nCazuriZilnice['Ziua'] = day_no\nCazuriZilnice['CazuriNoi'] = new_case_no\nCazuriZilnice['DeceseNoi'] = new_dead_no\nCazuriZilnice['VindecariNoi'] = new_healed_no\nCazuriZilnice['TotalCazuri'] = total_case\nCazuriZilnice['TotalDecese'] = total_dead\nCazuriZilnice['TotalVindecati'] = total_healed\n\nCazuriZilnice.Data = pd.to_datetime(CazuriZilnice.Data)\n\nprint(CazuriZilnice.dtypes)\n\nCazuriZilnice.head()","8895db46":"# Deaths\n\nr = requests.get('https:\/\/covid19.geo-spatial.org\/api\/dashboard\/getDeadCasesByCounty')\n\nDeceseJudete = pd.DataFrame()\nDeceseJudete['TotalDecese'] = extract_values(r.json(), 'total_county')\nDeceseJudete['Judet'] = extract_values(r.json(), 'county')\nDeceseJudete['CodJudet'] = extract_values(r.json(), 'county_code')\nDeceseJudete.head()","145e25c8":"# Healed by counties\n\nr = requests.get('https:\/\/covid19.geo-spatial.org\/api\/dashboard\/getHealthCasesByCounty')\n\nVindecatiJudete = pd.DataFrame()\nVindecatiJudete['Judet'] = extract_values(r.json(), 'county')\nVindecatiJudete['Vindecari'] = extract_values(r.json(), 'total_county')\nVindecatiJudete.head()","135e5737":"# Total cases evolution\n\nimport plotly.express as px\nimport numpy as np\n\nx = CazuriZilnice.Data\ny = CazuriZilnice.TotalCazuri\n\nfig = px.bar(x=x, y=y)\n\nfig.update_layout(title_text='EVOLUTIE TOTAL CAZURI', title_x=0.5)\nfig.show()","3edb287e":"# New daily cases\n\nx = CazuriZilnice.Data\ny = CazuriZilnice.CazuriNoi\n\nfig = px.line(x=x, y=y)\n\nfig.update_layout(title_text='EVOLUTIE CAZURI NOI', title_x=0.5)\nfig.show()","f27d4ef6":"# Age groups\n\nr = requests.get('https:\/\/covid19.geo-spatial.org\/api\/dashboard\/getCasesByAgeGroup')\nVarsta = pd.DataFrame()\n#Varsta['data'] = extract_values(r.json(), 'timestamp')\nVarsta['0-9'] = extract_values(r.json(), '0-9')\nVarsta['10-19'] = extract_values(r.json(), '10-19')\nVarsta['20-29'] = extract_values(r.json(), '20-29')\nVarsta['30-39'] = extract_values(r.json(), '30-39')\nVarsta['40-49'] = extract_values(r.json(), '40-49')\nVarsta['50-59'] = extract_values(r.json(), '50-59')\nVarsta['60-69'] = extract_values(r.json(), '60-69')\nVarsta['70-79'] = extract_values(r.json(), '70-79')\nVarsta['80 +'] = extract_values(r.json(), '>80')\nVarsta = Varsta.T\nVarsta.reset_index()\n\nfig = px.pie(Varsta.index, values=[int(item) for item in Varsta.values], names=Varsta.index,\n            title='Cazuri pe grupe de varsta')\nfig.show()","608b3389":"# Deaths by county\n\nx = DeceseJudete.Judet\ny = DeceseJudete.TotalDecese\n\nfig = px.bar(x=x, y=y)\n\nfig.update_layout(title_text='Numar de decese pe judet', title_x=0.5)\nfig.show()","e675956a":"# Healed by county\n\nx = VindecatiJudete.Judet # elimin necunoscutii\ny = VindecatiJudete.Vindecari # elimin necunoscutii\n\nfig = px.bar(x=x, y=y)\n\nfig.update_layout(title_text='Numar de vindecari pe judet', title_x=0.5)\nfig.show()","ef80ded9":"# Healed by county, unknown removed\n\nx = VindecatiJudete.Judet[1:] # elimin necunoscutii\ny = VindecatiJudete.Vindecari[1:] # elimin necunoscutii\n\nfig = px.bar(x=x, y=y)\n\nfig.update_layout(title_text='Numar de vindecari pe judet', title_x=0.5)\nfig.show()","0f5946d3":"# Deaths and Healed by county\n\nsituatieDV = pd.merge(VindecatiJudete, DeceseJudete, on='Judet')\nsituatieDV.Judet = situatieDV.Judet.apply(str)\nsituatieDV.head(), situatieDV.dtypes","1f05751c":"# Deaths vs Healed by county\n\nimport plotly.graph_objects as go\n\nx = situatieDV.Judet\n\nfig = go.Figure(data=[\n    go.Bar(name='Vindecari', x=x, y=situatieDV.Vindecari),\n    go.Bar(name='Decese', x=x, y=situatieDV.TotalDecese)\n])\n\nfig.update_layout(barmode='group')\nfig.update_layout(title_text='Decese vs Vindecari', title_x=0.5)\nfig.show()","480c2d7a":"# get geographic coordinates of each county\n\nimport json\npath = '..\/input\/regiuni-ro\/regions.json'\n\nwith open(path) as jsonfile:\n    data = json.load(jsonfile)\n\nname = []\nlat = []\nlng = []\n\nsituatieDV.Judet[13] = 'SATU-MARE'\n\nfor item in situatieDV.Judet:\n    x = data[item][0] \n    name.append(item)\n    lat.append(x['lat'])\n    lng.append(x['long'])\ncoord = pd.DataFrame()\ncoord['Judet'] = name \n# names of counties capitals are not spelled right, so I get approx location of any small city in that county\n# don't need to be too precise\ncoord['lat'] = lat\ncoord['lng'] = lng\ngeo_sit = pd.merge(situatieDV, coord, on='Judet')\ngeo_sit.lat = geo_sit.lat.astype('float')\ngeo_sit.lng = geo_sit.lng.astype('float')\nprint(geo_sit.dtypes)\ngeo_sit","cbb74ab3":"# map with population (nothing about covid)\n\nimport plotly.express as px\nfig = px.scatter_mapbox(geo_sit, lat=geo_sit.lat, lon=geo_sit.lng, hover_name=\"Judet\", \n                        hover_data=[\"TotalDecese\", \"Vindecari\" ],\n                        color_discrete_sequence=[\"fuchsia\"], zoom=6, height=600, width=850, size=geo_sit.TotalDecese )\nfig.update_layout(mapbox_style=\"carto-positron\")\nfig.update_layout(margin={\"r\":0,\"t\":0,\"l\":0,\"b\":0})\nfig.show()","8d6439c5":"from plotly.subplots import make_subplots\n\nfig = make_subplots(\n    rows=5, cols=2,\n    specs=[[{}, {\"rowspan\": 2}],\n           [{}, None],\n           [{\"rowspan\": 2, \"colspan\": 2}, None],\n           [None, None],\n           [{},{\"type\": \"domain\"}]],\n    print_grid=False)\n\nfig.add_trace(go.Bar(x=CazuriZilnice.Data, y=CazuriZilnice.TotalCazuri, name=\"Total Cazuri\"),\n              row=1, col=1)\nfig.add_trace(go.Bar(x=CazuriZilnice.Data, y=CazuriZilnice.CazuriNoi, name=\"Cazuri zilnice noi\"), row=1, col=2)\n\nfig.add_trace(go.Bar(x=Varsta.index, y=[int(item) for item in Varsta.values], name=\"Cazuri pe grupe de varsta\"), row=2, col=1)\n\nfig.add_trace(go.Bar(x = VindecatiJudete.Judet[1:], y = VindecatiJudete.Vindecari[1:], name=\"Vindecari pe judete\"), row=3, col=1)\n\nfig.add_trace(go.Bar(x = DeceseJudete.Judet[1:], y = DeceseJudete.TotalDecese[1:], name=\"Decese pe judet\"), row=5, col=1)\n\nfig.update_layout(height=1200, width=900, title_text=\"Covid sintetic\")\nfig.show()","70955c36":"Data source:\n\nhttps:\/\/covid19.geo-spatial.org\/api\/dashboard\/getCasesByCounty<br>\nhttps:\/\/covid19.geo-spatial.org\/api\/dashboard\/getDeadCasesByCounty<br>\nhttps:\/\/covid19.geo-spatial.org\/api\/dashboard\/getHealthCasesByCounty<br>\nhttps:\/\/covid19.geo-spatial.org\/api\/dashboard\/getDailyCaseReport<br>\nhttps:\/\/covid19.geo-spatial.org\/api\/dashboard\/getCaseRelations<br>\nhttps:\/\/covid19.geo-spatial.org\/api\/dashboard\/getPercentageByGender<br>\nhttps:\/\/covid19.geo-spatial.org\/api\/dashboard\/getCasesByAgeGroup<br>\n<br>\nMultumesc, geo-spatial.org!<br><br>\n<b> In principiu, e suficient sa dati un run all ca sa obtineti rezultatele cu ultimele update-uri, insa asigurati-va ca butonul de Internet din panoul din dreapta e on!<\/b><br>\n","d999665a":"TODO:\n- sa ma lamuresc ce-i cu necunoscutii aia\n- explorarea celorlalte seturi de date puse la dispozitie de geo-spatial.org\n- sa incerc oareshce features noi, gen numar cazuri la mia de locuitor... \n- alte seturi de date gen temperatura, restrictiile, numarul de testari, cati medici cati militieni etc...\n- ... sugestiile sunt bine venite, la fel si fork-ul si upvote-ul :)"}}