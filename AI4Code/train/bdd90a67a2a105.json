{"cell_type":{"5f2541ac":"code","8c1ef578":"code","cb2d66b2":"code","edc4499d":"code","51aa1662":"code","72e06b2c":"code","e840cb05":"code","5b82e4f4":"code","2bc9c897":"code","b4909c62":"code","ff149db7":"code","7f8a1b5f":"code","47ae1a0b":"code","e1295c03":"code","4afbcfcf":"code","3aa52f5c":"code","6705997a":"code","911d645e":"code","cdf4f4b9":"code","e5a7db3d":"code","98675699":"code","52ecf5b5":"code","b9898d03":"code","9d65d96b":"code","cb5dd32a":"code","f24709e2":"code","873025d5":"code","bdd5ff41":"code","7251d117":"code","aba719a6":"code","c4996acd":"code","49fae5c7":"code","d0faa36a":"code","8305e378":"code","f8f29412":"code","8af34cc0":"code","0ac8ab88":"code","e6298f63":"code","2c4db005":"code","85b3e79c":"markdown","08e4a942":"markdown","91c2b252":"markdown","acb9b233":"markdown","e07a7bc1":"markdown","ac48f0ae":"markdown","2498a1f4":"markdown","f60c162e":"markdown","d132a747":"markdown","8915bc6a":"markdown","2cc70313":"markdown","7194e8bd":"markdown","b83867ab":"markdown","4dea99fe":"markdown","1de7689f":"markdown","04e2c232":"markdown","56093bbf":"markdown","f4058f95":"markdown","67343af3":"markdown"},"source":{"5f2541ac":"from IPython.display import Image\nfrom IPython.core.display import HTML \nImage(url= \"https:\/\/storage.googleapis.com\/kaggle-competitions\/kaggle\/10445\/logos\/thumb76_76.png?t=2018-10-24-17-14-05\")","8c1ef578":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","cb2d66b2":"import matplotlib.pyplot as plt\nplt.rcParams['figure.figsize'] = (20,10)\nimport seaborn as sns\nfrom scipy.stats import norm\nimport warnings\nwarnings.filterwarnings('ignore')","edc4499d":"train = pd.read_csv('..\/input\/train.csv')\ntest = pd.read_csv('..\/input\/test.csv')\nmerchants = pd.read_csv('..\/input\/merchants.csv')\nhist_tran = pd.read_csv('..\/input\/historical_transactions.csv')\nnew_merc_tran = pd.read_csv('..\/input\/new_merchant_transactions.csv')\n\ndata_dict_train=pd.read_excel('..\/input\/Data_Dictionary.xlsx',sheet_name='train')\ndata_dict_hist_tran=pd.read_excel('..\/input\/Data_Dictionary.xlsx',sheet_name='history')\ndata_dict_new_merc_tran=pd.read_excel('..\/input\/Data_Dictionary.xlsx',sheet_name='new_merchant_period')\ndata_dict_merchants=pd.read_excel('..\/input\/Data_Dictionary.xlsx',sheet_name='merchant')","51aa1662":"train.head()","72e06b2c":"plt.figure(figsize = (12,7))\nsns.distplot(train['target'], fit = norm);\nplt.xlabel('Loyalty Score',fontsize = 14);","e840cb05":"print('Skewness of Target is :',train.target.skew())\nprint('Kurtosis of Traget is :',train.target.kurt())","5b82e4f4":"plt.figure(figsize = (10,7))\nsns.heatmap(train.corr(),annot = True,linewidths = 0.5,cmap='cubehelix_r');","2bc9c897":"train.info()","b4909c62":"data_dict_train","ff149db7":"plt.figure(figsize = (20,7));\nplt.subplot(121)\nsns.violinplot(train.feature_1,train.target);\nplt.xlabel('feature_1',fontsize = 14);\nplt.ylabel('target',fontsize = 14);\nplt.subplot(122)\ntrain['feature_1'].value_counts().plot(kind='bar');\nplt.xlabel('feature_1',fontsize = 14);\nplt.ylabel('target',fontsize = 14);","7f8a1b5f":"plt.figure(figsize = (20,7));\nplt.subplot(121)\nsns.violinplot(train.feature_2,train.target);\nplt.xlabel('feature_2',fontsize = 14);\nplt.ylabel('target',fontsize = 14);\nplt.subplot(122)\ntrain['feature_2'].value_counts().plot(kind='bar');\nplt.xlabel('feature_2',fontsize = 14);\nplt.ylabel('target',fontsize = 14);","47ae1a0b":"plt.figure(figsize = (20,7));\nplt.subplot(121)\nsns.violinplot(train.feature_3,train.target);\nplt.xlabel('feature_3',fontsize = 14);\nplt.ylabel('target',fontsize = 14);\nplt.subplot(122)\ntrain['feature_3'].value_counts().plot(kind='bar');\nplt.xlabel('feature_3',fontsize = 14);\nplt.ylabel('target',fontsize = 14);","e1295c03":"plt.figure(figsize = (20,25))\nplt.subplot(211)\ntrain['first_active_month'].value_counts().sort_index().plot(kind = 'bar');\nplt.xlabel('First_active_month',fontsize = 14);\nplt.ylabel('Count',fontsize = 14);\nplt.title('First Active Month in Training Data',fontsize = 18);\nplt.subplot(212)\ntest['first_active_month'].value_counts().sort_index().plot(kind = 'bar');\nplt.xlabel('First_active_month',fontsize = 14);\nplt.ylabel('Count',fontsize = 14);\nplt.title('First Active Month in Test Data',fontsize = 18);","4afbcfcf":"train_lesser_m20 = train[train['target']<-20]\ntrain_lesser_m20['first_active_month'].value_counts().sort_index().plot(kind = 'bar');\nplt.xlabel('First active month', fontsize=15);\nplt.ylabel('Number of cards', fontsize=15);\nplt.title(\"First active month count in target less than -20\",fontsize=18);","3aa52f5c":"train_lesser_m20","6705997a":"train.isna().sum()","911d645e":"test.isna().sum()","cdf4f4b9":"ax = sns.FacetGrid(train, hue=\"feature_3\", col=\"feature_2\", margin_titles=True,\n                  palette={1:\"red\", 0:\"green\"} )\nax.map(plt.scatter, \"first_active_month\", \"target\",edgecolor=\"w\").add_legend();\n","e5a7db3d":"hist_tran.head()","98675699":"new_merc_tran.head()","52ecf5b5":"data_dict_hist_tran","b9898d03":"data_dict_new_merc_tran","9d65d96b":"print('Authorized Flag Y if approved, N if denied \\n',hist_tran['authorized_flag'].value_counts(),\n     '\\n Authorized Flag Y if approved, N if denied \\n',new_merc_tran['authorized_flag'].value_counts())\nplt.subplot(121)\nhist_tran['authorized_flag'].value_counts().plot(kind = 'bar');\nplt.xlabel('Authorization',fontsize = 15);\nplt.ylabel('Values',fontsize = 15);\nplt.title('Authorized Flag Y if approved, N if denied \\n Historical Data',fontsize = 20);\nplt.subplot(122)\nnew_merc_tran['authorized_flag'].value_counts().plot(kind = 'bar');\nplt.xlabel('Authorization',fontsize = 15);\nplt.ylabel('Values',fontsize = 15);\nplt.title('Authorized Flag Y if approved, N if denied \\n New Data',fontsize = 20);","cb5dd32a":"print('Historical Category 3 \\n',hist_tran['category_3'].value_counts(),\n     '\\n New Category 3 \\n',new_merc_tran['category_3'].value_counts())\nplt.subplot(121)\nhist_tran['category_3'].value_counts().plot(kind = 'bar');\nplt.xlabel('Category 3',fontsize = 15);\nplt.ylabel('Values',fontsize = 15);\nplt.title('Historical Data',fontsize = 20);\nplt.subplot(122)\nnew_merc_tran['category_3'].value_counts().plot(kind = 'bar');\nplt.xlabel('Category 3',fontsize = 15);\nplt.ylabel('Values',fontsize = 15);\nplt.title('New Data',fontsize = 20);","f24709e2":"print('Historical Category 2 \\n',hist_tran['category_2'].value_counts(),\n     '\\n New Category 2 \\n',new_merc_tran['category_2'].value_counts())\nplt.subplot(121)\nhist_tran['category_2'].value_counts().plot(kind = 'bar');\nplt.xlabel('Category 2',fontsize = 15);\nplt.ylabel('Values',fontsize = 15);\nplt.title('Historical Data',fontsize = 20);\nplt.subplot(122)\nnew_merc_tran['category_2'].value_counts().plot(kind = 'bar');\nplt.xlabel('Category 2',fontsize = 15);\nplt.ylabel('Values',fontsize = 15);\nplt.title('New Data',fontsize = 20);","873025d5":"print('Historical Category 1 \\n',hist_tran['category_1'].value_counts(),\n     '\\n New Category 1 \\n',new_merc_tran['category_1'].value_counts())\nplt.subplot(121)\nhist_tran['category_1'].value_counts().plot(kind = 'bar');\nplt.xlabel('Category 1',fontsize = 15);\nplt.ylabel('Values',fontsize = 15);\nplt.title('Historical Data',fontsize = 20);\nplt.subplot(122)\nnew_merc_tran['category_1'].value_counts().plot(kind = 'bar');\nplt.xlabel('Category 1',fontsize = 15);\nplt.ylabel('Values',fontsize = 15);\nplt.title('New Data',fontsize = 20);","bdd5ff41":"print('Historical Month Lag \\n''\\n',hist_tran['month_lag'].value_counts(),\n     '\\n New Month Lag \\n''\\n',new_merc_tran['month_lag'].value_counts())\nplt.subplot(121)\nhist_tran['month_lag'].value_counts().plot(kind = 'bar');\nplt.xlabel('Month Lag',fontsize = 15);\nplt.ylabel('Values',fontsize = 15);\nplt.title('Month lag to reference date \\n Historical Data',fontsize = 15);\nplt.subplot(122)\nnew_merc_tran['month_lag'].value_counts().plot(kind = 'bar');\nplt.xlabel('Month Lag',fontsize = 15);\nplt.ylabel('Values',fontsize = 15);\nplt.title('Month lag to reference date \\n New Data',fontsize = 15);","7251d117":"print('Historical Installments \\n''\\n',hist_tran['installments'].value_counts(),\n     '\\n New Installments \\n''\\n',new_merc_tran['installments'].value_counts())\nplt.subplot(121)\nhist_tran['installments'].value_counts().plot(kind = 'bar');\nplt.title('Number of Installments of Purchase \\n Historical Data',fontsize = 20);\nplt.subplot(122)\nnew_merc_tran['installments'].value_counts().plot(kind = 'bar');\nplt.title('Number of Installments of Purchase \\n New Data',fontsize = 20);\n","aba719a6":"data_dict_merchants","c4996acd":"sns.heatmap(merchants.corr(),annot = True);","49fae5c7":"print('Quantity of active months within Last 3 months \\n',merchants['active_months_lag3'].value_counts(),\n      '\\n Quantity of active months within Last 6 months \\n',merchants['active_months_lag6'].value_counts(),\n      '\\n Quantity of active months within Last 12 months \\n',merchants['active_months_lag12'].value_counts())\nplt.subplot(131)\nmerchants['active_months_lag3'].value_counts().plot(kind = 'bar');\nplt.xlabel('active_months_lag3',fontsize = 14);\nplt.title('Quantity of active months within Last 3 months',fontsize = 15);\nplt.subplot(132)\nmerchants['active_months_lag6'].value_counts().plot(kind = 'bar');\nplt.xlabel('active_months_lag6',fontsize = 14);\nplt.title('Quantity of active months within Last 6 months',fontsize = 15);\nplt.subplot(133)\nmerchants['active_months_lag12'].value_counts().plot(kind = 'bar');\nplt.xlabel('active_months_lag12',fontsize = 14);\nplt.title('Quantity of active months within Last 12 months',fontsize = 15);","d0faa36a":"plt.figure(figsize = (20,7))\nplt.subplot(131)\nplt.scatter(merchants['avg_sales_lag3'],merchants['avg_sales_lag6'],color = 'red');\nplt.title('Average Sales in Lag 3 vs Lag 6',fontsize = 15);\nplt.subplot(132)\nplt.scatter(merchants['avg_sales_lag3'],merchants['avg_sales_lag12'],color = 'green');\nplt.title('Average Sales in Lag 3 vs Lag 12',fontsize=15);\nplt.subplot(133)\nplt.scatter(merchants['avg_sales_lag6'],merchants['avg_sales_lag12'],color = 'green');\nplt.title('Average Sales in Lag 6 vs Lag 12',fontsize=15);","8305e378":"plt.figure(figsize = (20,5))\nplt.subplot(131)\nsns.distplot(merchants['avg_sales_lag3'].value_counts(),fit = norm);\nplt.title('avg_sales_lag3',fontsize = 15);\nplt.subplot(132)\nsns.distplot(merchants['avg_sales_lag6'].value_counts(),fit = norm);\nplt.title('avg_sales_lag6',fontsize = 15);\nplt.subplot(133)\nsns.distplot(merchants['avg_sales_lag12'].value_counts(),fit = norm);\nplt.title('avg_sales_lag12',fontsize = 15);","f8f29412":"hist = hist_tran.groupby(\"card_id\").size().reset_index().rename({0:'transactions'},axis=1)\nnew = new_merc_tran.groupby(\"card_id\").size().reset_index().rename({0:'transactions'},axis=1)","8af34cc0":"print('Historical Transactions:  \\n',hist.describe(),\" \\n New Transactions  \\n\",new.describe())","0ac8ab88":"plt.subplot(221)\nsns.violinplot(hist['transactions']);\nplt.xlabel('Historic Transactions',fontsize = 15);\nplt.subplot(222)\nsns.violinplot(new['transactions'],color = 'red');\nplt.xlabel('New Transactions',fontsize = 15);\nplt.subplot(223)\nsns.distplot(hist['transactions'],fit = norm);\nplt.xlabel('Historic Transactions',fontsize = 15);\nplt.subplot(224)\nsns.distplot(new['transactions'],fit = norm, color = 'red');\nplt.xlabel('New Transactions',fontsize = 15);","e6298f63":"total_trans = hist_tran.append(new_merc_tran)","2c4db005":"total_trans.head()","85b3e79c":"So, in this section I am going to plot some violin graphs to see the behaviour of feature with our **Target**.\n### Violin Plot:\nA violin plot is a method of plotting numeric data. It is similar to a box plot with a rotated kernel density plot on each side.\nA violin plot has four layers. The **outer shape** represents all possible results, with thickness indicating how common. (Thus the thickest section represents the mode average.) The next layer inside represents the values that occur 95% of the time. The next layer (if it exists) inside represents the values that occur 50% of the time. The central dot represents the median average value.\n\nViolin plots are similar to box plots, except that they also show the **probability density of the data at different values** (in the simplest case this could be a histogram). Typically violin plots will include a marker for the median of the data and a box indicating the interquartile range, as in standard box plots. Overlaid on this box plot is a kernel density estimation. Like box plots, violin plots are used to represent comparison of a variable distribution (or sample distribution) across different \"categories\" (for example, temperature distribution compared between day and night, or distribution of car prices compared across different car makers).\n\nA violin plot is more informative than a plain box plot. In fact **while a box plot only shows summary statistics such as mean\/median and interquartile ranges, the violin plot shows the full distribution of the data**. The difference is particularly useful when the data distribution is multimodal (more than one peak). In this case a violin plot clearly shows the presence of different peaks, their position and relative amplitude. This information could not be represented with a simple box plot which only reports summary statistics. The inner part of a violin plot usually shows the mean (or median) and the interquartile range. In other cases, when the number of samples is not too high, the inner part can show all sample points (with a dot or a line for each sample).","08e4a942":"### Checking for Missing Values in Training Data","91c2b252":"### The graph below shows how the transactions vary on the usage of credit card in the first month.\n#### It is visible that most of the first purchases cames in the years 2016 and 2017 and the trend of purchase started increasing slowly from 2011 which was almost constant till 2014. And then from 2015 onwards it's going up which indicates that new customers have shown trust in services which is a point to notice for Elo.","acb9b233":"### Now we'll explore Merchants.csv","e07a7bc1":"#### So it was all about our train  set and features given there. Now, we'll head on to historical transaction data and new merchants data.","ac48f0ae":"#### First Active Month In Target less than -20.","2498a1f4":"#### There were some unusual values in target function. Outliers exist. So we'll look into the outliers of the target now.","f60c162e":"## Problem Description\nImagine being hungry in an unfamiliar part of town and getting restaurant recommendations served up, based on your personal preferences, at just the right moment. The recommendation comes with an attached discount from your credit card provider for a local place around the corner!\n\nRight now, Elo, one of the largest payment brands in Brazil, has built partnerships with merchants in order to offer promotions or discounts to cardholders. But do these promotions work for either the consumer or the merchant? Do customers enjoy their experience? Do merchants see repeat business? Personalization is key.\n\n","d132a747":"### Target Analysis","8915bc6a":"### Working on the Rest.","2cc70313":"#### From  the Historic Transactions and New Merchant Transactions, looking into the transactions detail we deduce that Maximum transaction by a card from Historic Data is 5582 while the same for New Data is 109.\n#### Also the mean transactions from Historic data are 89 and from new card its 7.","7194e8bd":"#### Merging Historcial and New transactions to make a new DataFrame total_trans which is Total Transactions.","b83867ab":"### Information about the features in New Data","4dea99fe":"### Importing the Dataset","1de7689f":"Reference: [SRK's Kernel](http:\/\/https:\/\/www.kaggle.com\/sudalairajkumar\/simple-exploration-notebook-elo)","04e2c232":"### Informations about the features in Historical Transactions","56093bbf":"#### From the correlation Heatmap above we can deduce that the Quantities of active months in different lags are correlated with each other and Average Sales are correlated with average Purchases which is quite obvious.","f4058f95":"Elo has built machine learning models to understand the most important aspects and preferences in their customers\u2019 lifecycle, from food to shopping. But so far none of them is specifically tailored for an individual or profile. This is where you come in.\n\nIn this competition, Kagglers will develop algorithms to identify and serve the most relevant opportunities to individuals, by uncovering signal in customer loyalty. Your input will improve customers\u2019 lives and help Elo reduce unwanted campaigns, to create the right experience for customers.\n\n### What am I predicting?\nYou are predicting a loyalty score for each card_id represented in test.csv and sample_submission.csv.","67343af3":"### Missing Values in Test Data"}}