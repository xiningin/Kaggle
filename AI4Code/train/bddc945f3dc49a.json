{"cell_type":{"035a9495":"code","5ac8bc73":"code","77f28b5b":"code","6c0cbefb":"code","6ab6ffe6":"code","702ae3ec":"code","9707f126":"code","38301b1e":"code","696cb7c0":"code","11a45164":"code","9fa90bb2":"code","b38e5dbf":"code","63f94647":"code","42df1b01":"code","a5fa3b20":"code","7decd807":"code","1ba9a424":"code","5c31a4c8":"code","b334a9e6":"code","559ff4dc":"code","feea7d14":"code","c85b4dbd":"code","b39eb398":"code","38259751":"markdown","8e832c5b":"markdown","90802d8b":"markdown","e0f7c7d1":"markdown","54b2d861":"markdown","3973f09f":"markdown","21ab8bb2":"markdown","abc351c3":"markdown","9bf5c007":"markdown","83d64805":"markdown","f8b067b9":"markdown","9b58d473":"markdown","a768b6a6":"markdown","de80afa5":"markdown","3bc345ab":"markdown","d4de1b3b":"markdown","2fead695":"markdown","2d170fb8":"markdown","cf3850c0":"markdown","fec38001":"markdown","22e0b462":"markdown","e01d214b":"markdown","2466602d":"markdown","6e4060a6":"markdown","5d4dcee9":"markdown","80c47996":"markdown","1517db3f":"markdown","d89f62f7":"markdown","c2409ad7":"markdown","b4c72d32":"markdown","384d629d":"markdown"},"source":{"035a9495":"# download\nimport requests\n\n# parsing do HTML\nfrom bs4 import BeautifulSoup\n\n# express\u00f5es regulares\nimport re","5ac8bc73":"# URL de an\u00e1lise\nurl_pagina = 'https:\/\/pt.wikipedia.org\/wiki\/Portal:COVID-19'","77f28b5b":"# Utiliza a biblioteca requests para fazer o download da pagina HTML\npagina_html = requests.get(url_pagina)\n\n# O C\u00f3digo 200 indica que o download foi bem sucedido\npagina_html","6c0cbefb":"# O Beautiful Soup \nsoup = BeautifulSoup(pagina_html.content, 'html.parser')\n#soup.prettify()","6ab6ffe6":"tbs_covid_pais = soup.find_all(class_='wikitable sortable mw-collapsible no-ref')\n\n# Lembre-se que o m\u00e9todo find_all retorna uma lista. No caso deste exemplo, \n# s\u00f3 existe um elemento na lista\ntb_covid_pais = tbs_covid_pais[0]\ntb_covid_pais","702ae3ec":"# Retorna uma lista com todas as linhas da tabela\nlinhas_tb = tb_covid_pais.find_all('tr')","9707f126":"lin = linhas_tb[2].get_text()\nlin","38301b1e":"lin.strip(\"\\n\").strip(\" \")","696cb7c0":"lin","11a45164":"lin = lin.strip(\"\\n\").strip(\" \")\nlin","9fa90bb2":"lin = lin.replace(u\"\\xa0\", u\"\")\nlin","b38e5dbf":"lin = lin.replace(\"\\n\",\"\\t\")\nlin","63f94647":"import re","42df1b01":"lin = re.sub(r\"\\[.*]\\t\", \"\\t\", lin)\nlin","a5fa3b20":"lin = re.sub(r\"\\[.*\\]\", \"\", lin)\nlin","7decd807":"lin = lin.rstrip(\"\\t\")\nlin","1ba9a424":"import re\ndef prep_linha(linha):\n    # Remove os caracteres \\n no come\u00e7o e final da string\n    # Em seguida, remove os espa\u00e7os\n    linha = linha.get_text().strip(\"\\n\").strip(\" \")\n    \n    # Substitui os caracteres \\n no meio da string por \\t\n    linha = linha.replace(\"\\n\",\"\\t\")\n    \n    # Substitui os caracteres \\xa0 pela string vazia, nada\n    # Note que existe um u antes da string. Isso indica que a string est\u00e1 em unicode\n    linha = linha.replace(u\"\\xa0\", u\"\")\n    \n    # Utiliza regex para encontrar as notas depois do nome do pais\n    linha = re.sub(r\"\\[.*]\\t\", \"\\t\", linha)\n    \n    # Utiliza regex para remover as notas ao final do arquivo\n    linha = re.sub(r\"\\[.*\\]\", \"\", linha)\n    \n    # Remove o \\t ao final da linha\n    linha = linha.rstrip(\"\\t\")\n    \n    # Substitui o \u2014 na coluna de curados pela string vazia\n    linha = linha.replace(\"\u2014\", \"\")\n    \n    return linha","5c31a4c8":"ini_tb = 2\nfim_tb = 225","b334a9e6":"# Esta primeira linha define o t\u00edtulo da tabela\ntexto_final = \"pais\\tcasos\\tmortes\\tcurados\\n\"\nfor i in range(ini_tb, fim_tb+1):\n    linha = prep_linha(linhas_tb[i])\n    texto_final += linha\n    texto_final += \"\\n\"\nprint(texto_final)","559ff4dc":"arquivo = open(\"lista-paises.csv\", \"w\")\narquivo.write(texto_final)\narquivo.close()","feea7d14":"import pandas as pd\ndf = pd.read_csv(\"lista-paises.csv\", sep='\\t')\ndf.head()","c85b4dbd":"df.casos.mean()","b39eb398":"df.casos.sum()","38259751":"##### Removendo os caracteres `\\xa0` e `\\n` no meio da string","8e832c5b":"## Quest\u00e3o Dirigida","90802d8b":"##### Gravando o texto em um arquivo","e0f7c7d1":"Para criarmos o texto arquivo CSV final, basta fazer uma concatena\u00e7\u00e3o de todas as linhas da tabela, incluindo um `\\n` ao final da linha. ","54b2d861":"**Inspecionando** o c\u00f3digo-fonte da p\u00e1gina HTML no navegador (Chrome, Firefox etc) podemos ver que a tabela de interesse cont\u00e9m a classe CSS: `wikitable sortable mw-collapsible no-ref`. Vamos utilizar esta classe CSS para restringir a busca pelos elementos de interesse.","3973f09f":"Podemos utilizar o m\u00e9todo `replace()` para substituir o caractere `\\xa0` com a string vazia, para que o n\u00famero de casos n\u00e3o esteja com espa\u00e7os entre eles. Note que o caractere `\\xa0` est\u00e1 em Unicode (que podem ser representados por hexadecimais), por isso necessitam do `u` antes do come\u00e7o da string.","21ab8bb2":"Para que a vari\u00e1vel `lin` seja alterada, \u00e9 necess\u00e1rio utilizar a atribui\u00e7\u00e3o.","abc351c3":"#### Uso do Dataset","9bf5c007":"Para remover a nota ao final da linha, utilizamos a seguinte express\u00e3o regular `r\"\\[.*\\]`, que pode ser lida assim: selecione o texto que come\u00e7e com `[`, contenha uma sequ\u00eancia qualquer de caracteres e termine com `]`. ","83d64805":"Para desenvolver este projeto, vamos utilizar t\u00e9cnicas de raspagem de dados na Web (Web Scraping), com a biblioteca `requests`, `BeautifulSoup` e express\u00f5es regulares.","f8b067b9":"Remove-se finalmente o `\\t` ao final da string.","9b58d473":"##### Removendo as notas do nome do pa\u00eds e ao final da linha","a768b6a6":"##### Descobrindo empiricamente onde a lista de pa\u00edses come\u00e7a e termina","de80afa5":"# CDIA20 | Manipula\u00e7\u00e3o de Arquivos e Strings","3bc345ab":"##### Removendo os `\\n` e os espa\u00e7os no come\u00e7o e ao final da linha. ","d4de1b3b":"A incid\u00eancia de COVID-19 por pa\u00eds pode ser encontrada na p\u00e1gina da Wikipedia.","2fead695":"#### Lendo o arquivo CSV com o Pandas","2d170fb8":"## Desenvolvimento do Projeto","cf3850c0":"Brincando um pouco, podemos ver que a lista de arquivos come\u00e7a na posi\u00e7\u00e3o 2 de `linhas_tb` e termina na posi\u00e7\u00e3o 225.","fec38001":"O m\u00e9todo `strip()` remove caracteres no come\u00e7o e ao final da linha.","22e0b462":"**[01]** Utilizando **seu** projeto de raspagem de dados, crie um arquivo CSV utilizando as t\u00e9cnicas apresentadas neste caderno.","e01d214b":"Brincando um pouco com esses objetos podemos ver que eles cont\u00e9m os dados que desejamos. No entanto, esses dados precisem ser preparados. Por exemplo, podemos ver que o resultado a seguir come\u00e7a e termina com `\\n` (caractere ENTER ou RETURN), existe um espa\u00e7o antes do nome do pa\u00eds, existem v\u00e1rios `\\n` e `\\xa0` no meio da linha. Al\u00e9m disso, existem notas associadas ao nome do pa\u00eds e ao final da linha. Vamos cuidar de cada um desses problemas.","2466602d":"##### Preparando o texto do arquivo final","6e4060a6":"Como desejamos criar um arquivo CSV ao final do processo, vamos substituir cada `\\n` que separa cada coluna da tabela por um `\\t`.","5d4dcee9":"##### Defini\u00e7\u00e3o de uma fun\u00e7\u00e3o de prepara\u00e7\u00e3o da linha","80c47996":"## Semana 12 | Programa\u00e7\u00e3o","1517db3f":"Para se gravar o texto em um arquivo, basta utilizar o c\u00f3digo a seguir.","d89f62f7":"### Exerc\u00edcio","c2409ad7":"Note que a vari\u00e1vel `lin` n\u00e3o \u00e9 alterada desta forma.","b4c72d32":"Para remover as notas do nome do pa\u00eds, vamos utilizar a seguinte express\u00e3o regular: `r\"\\[.*]\\t\"`. A express\u00e3o pode ser lida da seguinte forma: selecione o texto que come\u00e7e com `[` contenha uma sequ\u00eancia qualquer de caracteres que termine com `]\\t`. ","384d629d":"Como gravar em um arquivo CSV os dados da pandemia de COVID-19 por pa\u00eds de uma p\u00e1gina Web?"}}