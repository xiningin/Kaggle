{"cell_type":{"310b29ff":"code","154299a6":"code","5bb7d515":"code","9bc64cd0":"code","a68c556f":"code","da1257d4":"code","e3d9af0f":"code","9eb97544":"code","cb1d125b":"markdown"},"source":{"310b29ff":"import os\nimport numpy as np\nimport pandas as pd\nfrom sklearn import preprocessing\nimport xgboost as xgb\nimport lightgbm as lgb\nimport optuna\nimport functools\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import roc_curve,auc,accuracy_score,confusion_matrix,f1_score","154299a6":"train_transaction = pd.read_csv('..\/input\/train_transaction.csv', index_col='TransactionID')\ntest_transaction = pd.read_csv('..\/input\/test_transaction.csv', index_col='TransactionID')\n\ntrain_identity = pd.read_csv('..\/input\/train_identity.csv', index_col='TransactionID')\ntest_identity = pd.read_csv('..\/input\/test_identity.csv', index_col='TransactionID')\n\nsample_submission = pd.read_csv('..\/input\/sample_submission.csv', index_col='TransactionID')\n\ntrain = train_transaction.merge(train_identity, how='left', left_index=True, right_index=True)\ntest = test_transaction.merge(test_identity, how='left', left_index=True, right_index=True)\n\nprint(train.shape)\nprint(test.shape)\n\ny_train = train['isFraud'].copy()\ndel train_transaction, train_identity, test_transaction, test_identity\n\n# Drop target, fill in NaNs\nX_train = train.drop('isFraud', axis=1)\nX_test = test.copy()\n\ndel train, test\n\nX_train = X_train.fillna(-999)\nX_test = X_test.fillna(-999)\n\n# Label Encoding\nfor f in X_train.columns:\n    if X_train[f].dtype=='object' or X_test[f].dtype=='object': \n        lbl = preprocessing.LabelEncoder()\n        lbl.fit(list(X_train[f].values) + list(X_test[f].values))\n        X_train[f] = lbl.transform(list(X_train[f].values))\n        X_test[f] = lbl.transform(list(X_test[f].values))   ","5bb7d515":"(X_train,X_eval,y_train,y_eval) = train_test_split(X_train,y_train,test_size=0.2,random_state=0)","9bc64cd0":"def opt(X_train, y_train, X_test, y_test, trial):\n    #param_list\n    n_estimators = trial.suggest_int('n_estimators', 0, 1000)\n    max_depth = trial.suggest_int('max_depth', 1, 20)\n    min_child_weight = trial.suggest_int('min_child_weight', 1, 20)\n    #learning_rate = trial.suggest_discrete_uniform('learning_rate', 0.01, 0.1, 0.01)\n    scale_pos_weight = trial.suggest_int('scale_pos_weight', 1, 100)\n    subsample = trial.suggest_discrete_uniform('subsample', 0.5, 0.9, 0.1)\n    colsample_bytree = trial.suggest_discrete_uniform('colsample_bytree', 0.5, 0.9, 0.1)\n\n    xgboost_tuna = xgb.XGBClassifier(\n        random_state=42, \n        tree_method='gpu_hist',\n        n_estimators = n_estimators,\n        max_depth = max_depth,\n        min_child_weight = min_child_weight,\n        #learning_rate = learning_rate,\n        scale_pos_weight = scale_pos_weight,\n        subsample = subsample,\n        colsample_bytree = colsample_bytree,\n    )\n    xgboost_tuna.fit(X_train, y_train)\n    tuna_pred_test = xgboost_tuna.predict(X_test)\n    \n    return (1.0 - (accuracy_score(y_test, tuna_pred_test)))","a68c556f":"study = optuna.create_study()\nstudy.optimize(functools.partial(opt, X_train, y_train, X_eval, y_eval), n_trials=100)","da1257d4":"study.best_params","e3d9af0f":"clf = xgb.XGBClassifier(tree_method='gpu_hist',**study.best_params)\nclf.fit(X_train, y_train)","9eb97544":"sample_submission['isFraud'] = clf.predict_proba(X_test)[:,1]\nsample_submission.to_csv('submission.csv')","cb1d125b":"## Training"}}