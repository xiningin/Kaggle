{"cell_type":{"cc2c437d":"code","85dc93eb":"code","cd3d79a9":"code","55e31999":"code","6ba7c46d":"code","4678779d":"code","ae467e98":"code","cd981129":"code","7d3cfc0b":"code","fd140361":"code","082c14a2":"code","f52837b2":"code","293aead2":"code","691d79d7":"code","e1c18964":"code","173f5f0d":"code","80b234a9":"code","037917b8":"code","449536cf":"code","c7680a7d":"code","fa246c48":"code","985ac98d":"code","320ec8dc":"code","8cbcae17":"code","d4ff8c3e":"code","753904c0":"code","de2cabbf":"code","ab6d2110":"code","f7af3add":"code","f1fcc0d3":"markdown","cb145873":"markdown","9f3f1687":"markdown","ae881a03":"markdown","9f84ae77":"markdown","b79e27b5":"markdown","7dfd770e":"markdown","a2075243":"markdown","da191b07":"markdown","34e9de30":"markdown","b6747786":"markdown","9dc8931d":"markdown","e64e3444":"markdown","d6b5a6ad":"markdown","b3747d0f":"markdown","6c7be855":"markdown","f1985f88":"markdown","58970852":"markdown","6fe46f8a":"markdown"},"source":{"cc2c437d":"from __future__ import absolute_import, print_function, unicode_literals, division\nfrom builtins import range, input","85dc93eb":"!ls -GFlash --color ..\/input","cd3d79a9":"%%time\n%load_ext autoreload\n%autoreload 2\n%matplotlib inline\n%config InlineBackend.figure_format = \"retina\"\n\nimport os\nimport gc\ngc.enable()\nimport sys\nimport csv\nimport glob\nimport json\n\nimport numpy as np\nimport pandas as pd\nfrom scipy import stats\nimport seaborn as sns \nimport matplotlib.pyplot as plt\n\nimport plotly.graph_objects as go\nimport plotly.express as px\nimport plotly.io as pio\npio.templates.default = \"plotly_dark\"\nfrom plotly.subplots import make_subplots\nimport folium \nfrom folium import plugins\n\nplt.rc('font', size=12) \nplt.rc('axes', titlesize=14)\nplt.rc('axes', labelsize=12) \nplt.rc('xtick', labelsize=12)\nplt.rc('ytick', labelsize=12) \nplt.rc('legend', fontsize=12) \nplt.rc('figure', titlesize=14) \nplt.rcParams['figure.dpi'] = 60\nsns.set(rc={\"figure.figsize\":(12,10)})\nsns.set_style(\"whitegrid\")\nsns.set_context(\"notebook\")\ncolors = [\"windows blue\", \"amber\", \"greyish\", \"faded green\", \"dusty purple\"]\nsns.set_palette(sns.xkcd_palette(colors))\n\nimport datetime\nimport multiprocessing\nimport missingno as msno \nfrom pathlib import Path\nfrom tqdm import tqdm_notebook\nfrom IPython.display import display, clear_output\nimport warnings\nwarnings.simplefilter('ignore')","55e31999":"# function to display summary statistics\ndef resumetable(df):\n    print(f\"Dataset Shape: {df.shape}\")\n    summary = pd.DataFrame(df.dtypes,columns=['dtypes'])\n    summary = summary.reset_index()\n    summary['Name'] = summary['index']\n    summary = summary[['Name','dtypes']]\n    summary['Missing'] = df.isnull().sum().values    \n    summary['Uniques'] = df.nunique().values\n    summary['First Value'] = df.loc[0].values\n    summary['Second Value'] = df.loc[1].values\n    summary['Third Value'] = df.loc[2].values\n\n    for name in summary['Name'].value_counts().index:\n        summary.loc[summary['Name'] == name, 'Entropy'] = round(stats.entropy(df[name].value_counts(normalize=True), base=2),2) \n\n    return summary","6ba7c46d":"print(\"Display input files\")\ndata_dir = Path('..\/input\/covid19-global-forecasting-week-2\/')\nos.listdir(data_dir)","4678779d":"print(\"Read data and display\")\ndata = pd.read_csv(data_dir\/'train.csv', parse_dates=['Date'])\ndata.rename(columns={'Date': 'date', \n                     'Id': 'id',\n                     'Province\/State':'state',\n                     'Country\/Region':'country',\n                     'Lat':'lat',\n                     'Long': 'long',\n                     'ConfirmedCases': 'confirmed',\n                     'Fatalities':'deaths',\n                    }, inplace=True)\nwith pd.option_context(\"display.max_rows\",10,\"display.max_columns\",100):\n    display(data)","ae467e98":"print(\"Display External Data\")\ncleaned_data = pd.read_csv('..\/input\/corona-virus-report\/covid_19_clean_complete.csv', parse_dates=['Date'])\ncleaned_data.rename(columns={'Date': 'date', \n                     'Id': 'id',\n                     'Province\/State':'state',\n                     'Country\/Region':'country',\n                     'Lat':'lat',\n                     'Long': 'long',\n                     'ConfirmedCases': 'confirmed',\n                     'Fatalities':'deaths',\n                    }, inplace=True)\nwith pd.option_context(\"display.max_rows\",10,\"display.max_columns\",100):\n    display(cleaned_data)","cd981129":"print(\"External Data Summary\")\nresumetable(cleaned_data)","7d3cfc0b":"# check for missing values\nmsno.bar(cleaned_data, sort='descending')","fd140361":"# create a new column of active cases \ncases = ['Confirmed','Deaths','Recovered','Active']\ncleaned_data['Active'] = cleaned_data['Confirmed'] - cleaned_data['Deaths'] - cleaned_data['Recovered']\n\n# replace 'mainland china' with 'china'\ncleaned_data['country'] = cleaned_data['country'].replace('Mainland China', 'China')\n\n# fill blank in state column for null values\ncleaned_data[['state']] = cleaned_data[['state']].fillna('')\n\n# fill 0 in cases for null values\ncleaned_data[cases] = cleaned_data[cases].fillna(0)\n\n# rename Date to date\ncleaned_data.rename(columns={'Date':'date'}, inplace=True)\ndf = cleaned_data","082c14a2":"print(\"External Data\")\nprint(f\"Earliest Entry: {df['date'].min()}\")\nprint(f\"Last Entry:     {df['date'].max()}\")\nprint(f\"Total Days:     {df['date'].max() - df['date'].min()}\")","f52837b2":"formated_gdf = df.groupby(['date', 'country'])['Confirmed', 'Deaths'].max()\nformated_gdf = formated_gdf.reset_index()\nformated_gdf['date'] = pd.to_datetime(formated_gdf['date'])\nformated_gdf['date'] = formated_gdf['date'].dt.strftime('%m\/%d\/%Y')\nformated_gdf['size'] = formated_gdf['Confirmed'].pow(0.3)\n\nfig = px.scatter_geo(formated_gdf, locations=\"country\", locationmode='country names', \n                     color=\"Confirmed\", size='size', hover_name=\"country\", \n                     range_color= [0, 1500], \n                     projection=\"natural earth\", animation_frame=\"date\", \n                     title='COVID-19: Spread Over Time', color_continuous_scale=\"portland\")\nfig.show()","293aead2":"# %%time\n# world_map = folium.Map(location=[0, 0], zoom_start=2.5, tiles='Stamen Terrain')\n# tooltip = 'Click me!'\n# for lat, lon, Confirmed, Deaths, Recovered, name in zip(df['lat'], df['long'], df['Confirmed'],df['Deaths'],df['Recovered'], df['country']):\n#     folium.Marker([lat, lon],\n                        \n#                         popup = ('<strong>Country<\/strong>: ' + str(name).capitalize() + '<br>'\n#                                 '<strong>Confirmed Cases<\/strong>: ' + str(Confirmed) + '<br>'\n#                                 '<strong>Recovered Cases<\/strong>: ' + str(Recovered) +'<br>'\n#                                 '<strong>Deaths Cases<\/strong>: ' + str(Deaths) +'<br>'),\n#                         icon=folium.Icon(color='red', icon='info-sign'),\n#                         tooltip=tooltip\n#                         ).add_to(world_map)\n# world_map","691d79d7":"plt.figure(figsize=(16,28))\nsummary = df.groupby(\"country\")[\"Confirmed\",\"Deaths\",\"Active\",\"Recovered\"].sum().reset_index().sort_values(by=\"Confirmed\",ascending=False).reset_index(drop=True)[:10][::-1]\n\nfig = go.Figure()\nfig.add_trace(go.Bar(name='Confirmed Cases', y=list(summary[\"country\"]), x=list(summary[\"Confirmed\"]),orientation='h'))\nfig.update_layout(title=\"Top 10 Affected Countries\")\nfig.show()\n\nfig = go.Figure()\nfig.add_trace(go.Bar(name='Active Cases', y=list(summary[\"country\"]), x=list(summary[\"Active\"]),orientation='h')),\nfig.add_trace(go.Bar(name='Recovered Cases', y=list(summary[\"country\"]), x=list(summary[\"Recovered\"]),orientation='h'))\nfig.add_trace(go.Bar(name='Death Cases', y=list(summary[\"country\"]), x=list(summary[\"Deaths\"]),orientation='h')),\nfig.update_layout(barmode='stack',title=\"Active, Recovered & Deaths in Top 10 Countries\")\nfig.show()","e1c18964":"grouped = df.groupby('date')['Recovered', 'Deaths', 'Active'].sum().reset_index()\n\ntemp = grouped.melt(id_vars=\"date\", value_vars=['Recovered', 'Deaths', 'Active'],\n                 var_name='case', value_name='count')\nfig = px.area(temp, x=\"date\", y=\"count\", color='case',\n             title='Cases - Total Cases: Area Plot', color_discrete_sequence = ['cyan', 'red', 'orange'], labels={'count':'Comparisons', 'date':''})\nfig.show()","173f5f0d":"grouped = df.groupby('date')['date', 'Confirmed'].sum().reset_index()\n\nfig = px.line(grouped, x=\"date\", y=\"Confirmed\", \n              title=\"Worldwide Confirmed Cases Over Time\", labels={'date':'', 'Confirmed':'Total Coronavirus Cases'})\nfig.show()\n\nfig = px.line(grouped, x=\"date\", y=\"Confirmed\", \n              title=\"Worldwide Confirmed Cases (Logarithmic Scale) Over Time\", \n              log_y=True,labels={'date':'', 'Confirmed':'Total Coronavirus Cases'})\nfig.show()","80b234a9":"grouped = df.groupby([\"date\"])[\"Confirmed\"].sum().reset_index()\ngrouped['daily_cases'] = grouped['Confirmed'].shift(-1) - grouped['Confirmed']\ngrouped['daily_cases'].fillna(0)\nfig = px.bar(grouped, x='date',y='daily_cases', labels={'date':'', 'daily_cases':'Novel Coronavirus Daily Cases'},title='Daily New Cases')\nfig.show()","037917b8":"grouped[\"growth_factor\"] = grouped[\"daily_cases\"].shift(-1) \/ grouped[\"daily_cases\"]\ngrouped[\"growth_factor\"]=grouped[\"growth_factor\"].fillna(0)\nfig = go.Figure()\nfig.add_trace(go.Scatter(x=grouped['date'], y=grouped[\"growth_factor\"],\n                    mode='lines+markers',\n                    name='lines+markers'))\nfig.update_layout(\n    title={\n        'text': \"Growth Factor\",\n})\nfig.show()","449536cf":"grouped = df[df[\"country\"]!=\"China\"].groupby('date')['date', 'Confirmed'].sum().reset_index()\n\nfig = px.line(grouped, x=\"date\", y=\"Confirmed\", \n              title=\"Total Cases outside of China (Linear Scale)\", labels={'date':'', 'Confirmed':'Total Coronavirus Cases'})\nfig.show()\n\nfig = px.line(grouped, x=\"date\", y=\"Confirmed\", \n              title=\"Total Cases outside of China (Logarithmic Scale)\", \n              log_y=True, labels={'date':'', 'Confirmed':'Total Coronavirus Cases'})\nfig.show()","c7680a7d":"grouped = df[df[\"country\"]!=\"China\"].groupby([\"date\"])[\"Confirmed\"].sum().reset_index()\ngrouped['daily_cases'] = grouped['Confirmed'].shift(-1) - grouped['Confirmed']\ngrouped['daily_cases'].fillna(0)\nfig = px.bar(grouped, x='date',y='daily_cases', labels={'date':'', 'daily_cases':'Novel Coronavirus Daily Cured'},title='Daily Cured')\nfig.show()","fa246c48":"grouped[\"growth_factor\"] = grouped[\"daily_cases\"].shift(-1) \/ grouped[\"daily_cases\"]\ngrouped[\"growth_factor\"]=grouped[\"growth_factor\"].fillna(0)\nfig = go.Figure()\nfig.add_trace(go.Scatter(x=grouped['date'], y=grouped[\"growth_factor\"],\n                    mode='lines+markers',\n                    name='lines+markers'))\nfig.update_layout(\n    title={\n        'text': \"Growth Factor\",\n})\nfig.show()","985ac98d":"plt.figure(figsize=(8,8))\ngrouped = df.groupby(\"country\")[\"Confirmed\"].sum().reset_index()\n\ntemp = pd.DataFrame()\ntemp[\"China\"] = grouped[grouped[\"country\"]==\"China\"][\"Confirmed\"]\ntemp[\"Others\"] = grouped[grouped[\"country\"]!=\"China\"][\"Confirmed\"].sum()\ntemp = temp.melt()\n\nfig = px.pie(temp, values='value', names='variable', title='Distribution of Cases WorldWide',color='variable', color_discrete_map={'Others':'lightcyan',\n                                 'China':'royalblue'}, hover_data=['value'], labels={'value':'Total Affected','variable':'Country'})\nfig.update_traces(textposition='inside', textinfo='percent+label')\nfig.show()","320ec8dc":"formated_gdf = df.groupby(['date', 'country'])['Confirmed', 'Deaths', 'Active', 'Recovered'].max()\nformated_gdf = formated_gdf.reset_index()\nformated_gdf['date'] = pd.to_datetime(formated_gdf['date'])\nformated_gdf['date'] = formated_gdf['date'].dt.strftime('%m\/%d\/%Y')\nformated_gdf['size'] = formated_gdf['Active'].pow(0.3)\nformated_gdf['size'].fillna(formated_gdf['size'].mean(),inplace=True)\n\nfig = px.scatter_geo(formated_gdf, locations=\"country\", locationmode='country names', \n                     color=\"Active\", size='size', hover_name=\"country\", \n                     range_color= [0, 1000], \n                     projection=\"natural earth\", animation_frame=\"date\", \n                     title='COVID-19: Active Cases Over Time', color_continuous_scale=\"portland\")\nfig.update(layout_coloraxis_showscale=False)\nfig.show()","8cbcae17":"grouped_df = df.groupby('date')['Active'].sum().reset_index()\nfig = go.Figure()\nfig.add_trace(go.Scatter(x=grouped_df['date'], y=grouped_df['Active'],\n                    mode='lines+markers',\n                    name='Active Cases'))\nfig.update_layout(\n    title={\n        'text': \"Active Cases\",\n})","d4ff8c3e":"grouped_df = df.groupby('date')['Recovered'].sum().reset_index()\nfig = go.Figure()\nfig.add_trace(go.Scatter(x=grouped_df['date'], y=grouped_df['Recovered'],\n                    mode='lines+markers',\n                    name='Recovered Cases'))\nfig.update_layout(\n    title={\n        'text': \"Total Cured\",\n})","753904c0":"grouped = df.groupby([\"date\"])[\"Recovered\"].sum().reset_index()\ngrouped['daily_cases'] = grouped['Recovered'].shift(-1) - grouped['Recovered']\ngrouped['daily_cases'].fillna(0)\nfig = px.bar(grouped, x='date',y='daily_cases',labels={'date':'', 'daily_cases':'Novel Coronavirus Daily Cured'},title='Daily Cured')\n\nfig.show()","de2cabbf":"grouped_df = df.groupby('date')['Recovered','Deaths'].sum().reset_index()\nfig = go.Figure()\nfig.add_trace(go.Scatter(x=grouped_df['date'], y=grouped_df['Recovered'],\n                    mode='lines+markers',\n                    name='Recovered Cases'))\nfig.add_trace(go.Scatter(x=grouped_df['date'], y=grouped_df['Deaths'],\n                    mode='lines+markers',\n                    name='Death Cases'))\n\nfig.update_layout(\n    title={\n        'text': \"Outcome of Cases (Recovery or Death)\",\n})","ab6d2110":"grouped = df.groupby([\"date\"])[\"Recovered\",\"Deaths\"].sum().reset_index()\ngrouped['daily_cases_rec'] = grouped['Recovered'].shift(-1) - grouped['Recovered']\ngrouped['daily_cases_death'] = grouped['Deaths'].shift(-1) - grouped['Deaths']\n\nfig = go.Figure()\nfig.add_trace(go.Scatter(x=grouped['date'], y=grouped['daily_cases_rec'],\n                    mode='lines+markers',\n                    name='Recovered Cases'))\nfig.add_trace(go.Scatter(x=grouped['date'], y=grouped['daily_cases_death'],\n                    mode='lines+markers',\n                    name='Death Cases'))\n\nfig.update_layout(\n    title={\n        'text': \"Outcome of Cases everyday (Recovery or Death)\",\n})\nfig.show()","f7af3add":"formated_gdf = df.groupby(['date', 'country'])['Confirmed', 'Deaths'].max()\nformated_gdf = formated_gdf.reset_index()\nformated_gdf['date'] = pd.to_datetime(formated_gdf['date'])\nformated_gdf['date'] = formated_gdf['date'].dt.strftime('%m\/%d\/%Y')\nformated_gdf['size'] = formated_gdf['Deaths'].pow(0.3)\n\nfig = px.scatter_geo(formated_gdf, locations=\"country\", locationmode='country names', \n                     color=\"Deaths\", size='size', hover_name=\"country\", \n                     range_color= [0, 100], \n                     projection=\"natural earth\", animation_frame=\"date\", \n                     title='COVID-19: Deaths Over Time', color_continuous_scale=\"peach\")\n# fig.update(layout_coloraxis_showscale=False)\nfig.show()","f1fcc0d3":"## Top 10 Affected Countries (worldwide) ","cb145873":"## Outcome of Cases (Recovery or Death)","9f3f1687":"## Will be updating with more.. \n\n### Please give an upvote if you liked the kernel. Stay safe and Thanks.!","ae881a03":"## Daily Cases Excluding Mainland China","9f84ae77":"## Outcome of Cases (Recovery or Death) - Daily","b79e27b5":"## Total Cases excluding mailand China","7dfd770e":"## Cases","a2075243":"## Comparisons\n**How about comparing the cases to better assess the situation**","da191b07":"### Daily Cases WorldWide\n\nThe spike observed on Feb. 12 is the result, for the most part, of a change in diagnosis classification for which 13,332 clinically (rather than laboratory) confirmed cases were all reported as new cases on Feb. 12, even though they were diagnosed in the preceding days and weeks. We will distribute these cases over the correct period once the analysis being conducted by the WHO with China's NHC is completed.","34e9de30":"# Exploratory Data Analysis","b6747786":"### Novel Covid 19 spread around globe over time","9dc8931d":"### Growth Factor of Daily New Cases\n\nGrowth factor is the factor by which a quantity multiplies itself over time. The formula used is **every day's new cases \/ new cases on the previous day. For example, a quantity growing by 7% every period (in this case daily) has a growth factor of 1.07.**\n\nA growth factor **above 1 indicates an increase**, whereas one which remains **between 0 and 1 it is a sign of decline**, with the quantity eventually becoming zero, whereas a growth factor constantly above 1 could signal exponential growth","e64e3444":"## Growth Factor Excluding Mailand China","d6b5a6ad":"## Recovered and Discharged","b3747d0f":"## Deaths over time","6c7be855":"### Check Missing Values","f1985f88":"## Total Cured Daily","58970852":"## Active Cases\nBy removing deaths and recoveries from total cases, we get \"currently infected cases\" or \"active cases\" (cases still awaiting for an outcome).","6fe46f8a":"### Total Cases (worldwide)\n\n\"Total Cases\" = total cumulative count (5,529,971). This figure therefore includes deaths and recovered or discharged patients (cases with an outcome)."}}