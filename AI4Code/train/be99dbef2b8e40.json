{"cell_type":{"b835e68f":"code","d0014f9e":"code","0def21db":"code","680c7bc0":"code","72a1dad1":"code","7be9ba97":"code","f47fc27e":"code","ff1c3b31":"code","bd142da4":"code","e0d60eaa":"code","2157466d":"code","acf59c32":"code","8cf48473":"code","f607531e":"code","188eeba8":"code","8ceaa456":"code","471764d2":"code","b23af829":"code","5de29942":"code","80717d9e":"code","5afc662f":"markdown","39279ca5":"markdown","7121244d":"markdown","a564886e":"markdown","b7a7a2b5":"markdown"},"source":{"b835e68f":"import gc\nfrom tqdm import tqdm\nimport numpy as np\nimport pandas as pd\nfrom pylab import rcParams\nimport matplotlib.pyplot as plt\nfrom sklearn.metrics import mean_squared_error\nfrom scipy.stats import probplot\n\nimport datetime as dt\nfrom datetime import date\nfrom datetime import timedelta\nfrom fbprophet import Prophet\n\n%matplotlib inline\nimport os\nimport warnings\nwarnings.filterwarnings(\"ignore\")","d0014f9e":"data0=pd.read_csv('..\/input\/earthquake-in-japan\/japan-20190101_20211203_query.csv')\ndata0[1:2]","0def21db":"data0=data0.fillna('N')\ndata1=data0[['time','latitude','longitude','depth','mag',]]\ndata1[0:5]","680c7bc0":"data2=pd.DataFrame(columns=data1.columns.tolist())\nfor i,item in enumerate(data1['time']):\n    data2=pd.concat([data2,data1.loc[i:i]])\ndata2=data2.sort_values(['time']).reset_index(drop=True)    ","72a1dad1":"from datetime import datetime as dt\ndata2a=data2.copy()\ndate=[]\nfor item in data2['time']:\n    date+=[dt.strptime(item[0:-5],'%Y-%m-%dT%H:%M:%S')]\ndata2a['date']=date\ndata2a","7be9ba97":"data4=data2a[data2a['latitude']>33][data2a['latitude']<37][data2a['longitude']>138][data2a['longitude']<142]\ndata4=data4.reset_index(drop=True)\ndata4","f47fc27e":"import plotly.express as px\nfig=px.scatter(x=data4['date'],y=data4['mag'])\nfig=px.scatter(data4, x=\"date\", y=\"mag\")\nfig.update_layout(title='Magnituide of earthquake around Tokyo in 2019-2021')\nfig.show()","ff1c3b31":"data4['date2']=data4['date'].apply(lambda x: dt.strptime(str(x)[0:10],'%Y-%m-%d') )\ndata4","bd142da4":"data5=data4[['date2','mag']][data4['mag']>4.7]   ### focus setting mag>4.7\ndata5","e0d60eaa":"item1=data5\n\nitem1.columns = ['ds','y']\nitem1.y = item1.y.astype('float')\nitem1.ds = item1.ds.astype('datetime64')\n\nrcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y)","2157466d":"ph = Prophet()\nph.fit(item1)\nforecast1=ph.predict(item1)\nfigure = ph.plot(forecast1)\nfigure.show()","acf59c32":"from datetime import timedelta\nstart0 = dt.strptime('2021-01-01','%Y-%m-%d').date()\nend0   = dt.strptime('2025-12-31','%Y-%m-%d').date()\nprint((end0-start0).days)","8cf48473":"def daterange(start,end):\n    for i in range((end-start).days):\n        return start+timedelta(i)  ","f607531e":"dates0=[]\nfor i in range((end0-start0).days):\n    dates0+=[(start0+timedelta(i)).strftime('%Y-%m-%d') ]\nprint(dates0[0:30])","188eeba8":"dates0_df=pd.DataFrame(dates0)\ndates0_df.columns=['ds']\ndates0_df","8ceaa456":"ph = Prophet()\nph.fit(item1)\nforecast3=ph.predict(dates0_df)\nfigure = ph.plot(forecast3)\nfigure.show()","471764d2":"forecast3[['ds','yhat','yhat_lower','yhat_upper']]","b23af829":"forecast4=forecast3[['ds','yhat','yhat_lower','yhat_upper']][365:365*2]\nforecast4.to_csv('mag_forcast.csv')","5de29942":"mag0=forecast3[365:365*2]['yhat'].max()\nprint(mag0)","80717d9e":"forecast3[forecast3['yhat']==mag0]","5afc662f":"* https:\/\/www.kaggle.com\/stpeteishii\/earthquake-location-prediction-in-tokyo-by-prophet\n* https:\/\/www.kaggle.com\/stpeteishii\/m5-9-earthquake-in-tokyo-on-2021-10-07","39279ca5":"# fit past and predict past+future","7121244d":"## Predicted max magnitude of earthquake in 2022","a564886e":"# fit past and predict past","b7a7a2b5":"## Magnitude 6.1 Earthquake might occur on 2022-05-12 "}}