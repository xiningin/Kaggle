{"cell_type":{"59ee91e1":"code","6d8d0a09":"code","3171ae2b":"code","5b13df86":"code","f8dcb345":"code","cf35bc1e":"code","4061663c":"code","4c9630f0":"code","36456ac4":"code","c2f476bd":"code","7236b156":"code","e14c2055":"code","030368d4":"code","d872d250":"code","87dd60f3":"code","43fb1e59":"code","436eb180":"code","df6d0bdb":"code","b12bb2bf":"code","58a2ab9b":"code","d4f05e34":"code","04e8e561":"code","586b8b90":"code","86a5de5f":"code","24033652":"code","09c463d0":"code","46ee1312":"markdown","ac8ca6d1":"markdown","77b51cab":"markdown","83f59d7b":"markdown","9e6dc5cb":"markdown","c59f7b50":"markdown","63559a84":"markdown","7006f479":"markdown","5362f170":"markdown","f71f1f3d":"markdown","3edb2634":"markdown","266b79bd":"markdown","18d6d925":"markdown","a7457559":"markdown","c452057b":"markdown","9ef607bb":"markdown","e2114b97":"markdown","ec8375fb":"markdown","30fe8819":"markdown","b40f58cf":"markdown","b7820729":"markdown","efbe9af2":"markdown"},"source":{"59ee91e1":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    print(dirname)\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","6d8d0a09":"# https:\/\/www.kaggle.com\/ultralytics\/yolov5\n!git clone https:\/\/github.com\/ultralytics\/yolov5  # clone repo\n%cd yolov5\n%pip install -qr requirements.txt pycocotools # install dependencies\n\nimport torch\nfrom IPython.display import Image, Video, clear_output  # to display images and videos\n\nclear_output()\nprint(f\"Setup complete. Using torch v{torch.__version__} ({torch.cuda.get_device_properties(0).name if torch.cuda.is_available() else 'CPU'})\")","3171ae2b":"!ls \/kaggle\/input\/praia-balneario-camboriu-yolo\/images\/*.png | wc -l","5b13df86":"Image(\"\/kaggle\/input\/praia-balneario-camboriu-yolo\/images\/Captura de tela 2021-09-27 201053.png\", width=780)","f8dcb345":"%%writefile custom_dataset.yaml\n\npath: \/kaggle\/input\/praia-balneario-camboriu-yolo\/ # dataset root dir\ntrain: images\/  # train images (relative to 'path') \nval: images\/  # val images (relative to 'path')\ntest:  # test images (optional)\n\n# Classes\nnc: 2  # number of classes\nnames: ['pessoa', 'roda-gigante']  # class names]","cf35bc1e":"!cat custom_dataset.yaml","4061663c":"PROJECT = 'camboriu'\nRUN = 'nightly'\n%set_env PROJECT=camboriu\n%set_env RUN=nightly\n\n%set_env IMG_SIZE=1920\n%set_env BATCH_SIZE=8\n%set_env MAX_EPOCHS=100","4c9630f0":"import wandb\nfrom kaggle_secrets import UserSecretsClient\nuser_secrets = UserSecretsClient()\nsecret_value = user_secrets.get_secret('wandb-login')\nwandb.login(key=secret_value)","36456ac4":"run = wandb.init(project=PROJECT, name=RUN)","c2f476bd":"# Train YOLOv5s on custom dataset\n# With Img 1920 and Batch 8 it consumes 14.4GB!!!\n!python train.py --project $PROJECT --name $RUN\/train \\\n        --img $IMG_SIZE \\\n        --batch $BATCH_SIZE \\\n        --epochs $MAX_EPOCHS \\\n        --data custom_dataset.yaml \\\n        --weights yolov5s.pt \\\n        --cache","7236b156":"!ls $PROJECT\/$RUN\/train\/weights","e14c2055":"!ls $PROJECT\/$RUN\/train","030368d4":"Image(filename=f\"{PROJECT}\/{RUN}\/train\/confusion_matrix.png\")","d872d250":"from utils.plots import plot_results \nplot_results(f\"{PROJECT}\/{RUN}\/train\/results.csv\")","87dd60f3":"# Using yolov5s model\n!python detect.py --project $PROJECT --name $RUN\/yolov5-img \\\n                  --weights yolov5s.pt \\\n                  --img $IMG_SIZE --conf 0.25 \\\n                  --source \/kaggle\/input\/praia-balneario-camboriu-yolo\/test\n\n# Using custom model\n!python detect.py --project $PROJECT --name $RUN\/custom-img \\\n                  --weights $PROJECT\/$RUN\/train\/weights\/best.pt \\\n                  --img $IMG_SIZE --conf 0.25 \\\n                  --source \/kaggle\/input\/praia-balneario-camboriu-yolo\/test","43fb1e59":"Image(filename=f\"{PROJECT}\/{RUN}\/yolov5-img\/Captura de tela 2021-09-27 230214.png\")","436eb180":"Image(filename=f\"{PROJECT}\/{RUN}\/custom-img\/Captura de tela 2021-09-27 230214.png\")","df6d0bdb":"Image(filename=f\"{PROJECT}\/{RUN}\/yolov5-img\/Captura de tela 2021-09-27 230253.png\")","b12bb2bf":"Image(filename=f\"{PROJECT}\/{RUN}\/custom-img\/Captura de tela 2021-09-27 230253.png\")","58a2ab9b":"!ls \/kaggle\/input\/praia-balneario-camboriu-yolo\/*.mp4","d4f05e34":"# Using yolov5s model\n!python detect.py --project $PROJECT --name $RUN\/yolov5-video \\\n                  --weights yolov5s.pt \\\n                  --img $IMG_SIZE --conf 0.25 \\\n                  --source '\/kaggle\/input\/praia-balneario-camboriu-yolo\/001 BNU.tv - Canal Balnerio Cambori - SC - Cmera ao vivo Hotel Villa do Mar Ilha das Cabras.mp4'\nclear_output()","04e8e561":"Video(f\"{PROJECT}\/{RUN}\/yolov5-video\/001 BNU.tv - Canal Balnerio Cambori - SC - Cmera ao vivo Hotel Villa do Mar Ilha das Cabras.mp4\")","586b8b90":"# Using custom model\n!python detect.py --project $PROJECT --name $RUN\/custom-video \\\n                  --weights $PROJECT\/$RUN\/train\/weights\/best.pt \\\n                  --img $IMG_SIZE --conf 0.25 \\\n                  --source '\/kaggle\/input\/praia-balneario-camboriu-yolo\/001 BNU.tv - Canal Balnerio Cambori - SC - Cmera ao vivo Hotel Villa do Mar Ilha das Cabras.mp4'\nclear_output()","86a5de5f":"Video(f\"{PROJECT}\/{RUN}\/custom-video\/001 BNU.tv - Canal Balnerio Cambori - SC - Cmera ao vivo Hotel Villa do Mar Ilha das Cabras.mp4\")","24033652":"wandb.save(f\"{PROJECT}\/{RUN}\/**\/**\")","09c463d0":"#artifact = wandb.use_artifact(f\"{RUN}:latest\")\n#artifact.download()","46ee1312":"# Considera\u00e7\u00f5es finais","ac8ca6d1":"Foram coletadas e anotadas 59 imagens no total a partir de transmiss\u00f5es de c\u00e2meras de seguran\u00e7a apontadas para a Praia de Balne\u00e1rio Cambori\u00fa","77b51cab":"# **YOLOv5** vs **Modelo Customizado** em videos","83f59d7b":"A chave de acesso \u00e0 plataforma **wandb** deve ser configurada em *Add-ons > Secrets* antes de executar a c\u00e9lula a seguir: ","9e6dc5cb":"Agora vamos criar um arquivo de configura\u00e7\u00e3o *.yaml* contendo os diret\u00f3rios onde est\u00e3o as imagens, a quantidade de classes e seus respectivos labels. Este arquivo ser\u00e1 passado ao YOLOv5.","c59f7b50":"# Detec\u00e7\u00e3o de Pessoas em Balne\u00e1rio Cambori\u00fa com YoLo v5\n* Dataset customizado: https:\/\/www.kaggle.com\/bmendes00\/praia-balneario-camboriu-yolo\n* Fonte das imagens\/videos: https:\/\/bnu.tv\/\n* Ferramenta para anota\u00e7\u00e3o de imagens: https:\/\/www.makesense.ai\/\n* Ferramenta para armazenamento e visualiza\u00e7\u00e3o do modelo: https:\/\/wandb.ai\/\n* Tutorial: https:\/\/blog.paperspace.com\/train-yolov5-custom-data\n* YoLo v5 repo: https:\/\/github.com\/ultralytics\/yolov5\n* Base Notebook: https:\/\/www.kaggle.com\/ultralytics\/yolov5\n* Base Dataset: https:\/\/www.kaggle.com\/ultralytics\/coco128\n* Base YAML config: https:\/\/raw.githubusercontent.com\/ultralytics\/yolov5\/master\/data\/coco128.yaml\n","63559a84":"# Avalia\u00e7\u00e3o do modelo customizado","7006f479":"As m\u00e9tricas do modelo e seus pesos s\u00e3o automaticamente sincronizados com a plataforma **wandb**","5362f170":"# Treinamento do modelo customizado a partir do YOLOv5","f71f1f3d":"# **YOLOv5** vs **Modelo Customizado** em imagens","3edb2634":"## Instala\u00e7\u00e3o YOLOv5","266b79bd":"# Custom Dataset","18d6d925":"## **YOLOv5**: Hotel Marambaia Roda Gigante","a7457559":"Vamos instalar o YOLOv5 a partir de seu c\u00f3digo fonte dispon\u00edvel no github. Em seguida, vamos conferir se a lib PyTorch est\u00e1 dispon\u00edvel e tamb\u00e9m se h\u00e1 GPU.","c452057b":"## **YOLOv5**: Hotel Villa do Mar Ilha das Cabras","9ef607bb":"# Train YOLOv5 on Custom Dataset","e2114b97":"Caso seja necess\u00e1rio utilizar o modelo treinado em outro notebook, \u00e9 poss\u00edvel baixar os pesos diretaente do **wandb**:","ec8375fb":"Para finalizar, vamos salvar os arquivos gerados pelo modelo na plataforma **wandb**:","30fe8819":"As m\u00e9tricas e os pesos do modelo ser\u00e3o salvos na ferramenta Weights & Biases (https:\/\/wandb.ai\/) e, portanto, precisamos definir o nome do projeto e do notebook para refer\u00eancia futura.","b40f58cf":"## **Modelo Customizado**: Hotel Marambaia Roda Gigante","b7820729":"Arquivos dispon\u00edveis, em: https:\/\/wandb.ai\/bmnds\/camboriu\/runs\/2qgc7a1t\/files\/camboriu\/nightly","efbe9af2":"## **Modelo Customizado**: Hotel Villa do Mar Ilha das Cabras"}}