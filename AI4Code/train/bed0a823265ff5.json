{"cell_type":{"7bac6c0a":"code","f167c1f4":"code","4776b298":"code","74eb9854":"code","1836cbd7":"code","4b558b6f":"code","a46b6aa3":"code","4baa8cf1":"code","739faec4":"code","e15b0262":"code","457c96a5":"code","e23d0ec9":"code","4a847065":"code","c0deb441":"code","ec0e791e":"code","f560ad62":"code","9ed3559b":"code","1cdc6fc8":"code","fb48a3a3":"code","8ab0fb56":"code","e7f7296a":"code","952d25a0":"code","30aaf545":"code","7b98fec7":"code","ab14a057":"code","da802c88":"code","88f137a7":"code","109cd8ff":"code","d6170d4d":"code","97c80338":"code","f4601bcf":"code","10fdb817":"code","e1e0b7ed":"code","73f89779":"code","a0085d5a":"code","4bdd8568":"code","95f0323a":"code","503725ea":"code","30c1255d":"code","d15a87a0":"code","77f1a60a":"code","b76d168d":"code","a80c9810":"code","b8ee3b73":"code","ddbc9930":"code","97f799ee":"code","9a9cab39":"code","72fbf6ed":"code","2377ea1b":"code","53b93ed8":"code","e73afcc6":"code","b78f2e63":"code","c357a4c9":"code","1d3412f8":"code","ffda86dc":"code","7a61da04":"code","0be02ea5":"code","ece95a70":"code","570cf598":"code","a2c720b7":"code","1e83648e":"code","101760bd":"code","bcc5a206":"code","cb3f6eae":"code","c0f50a59":"code","b1e39892":"code","0a10944a":"code","21752ce6":"code","190aa066":"code","e5080fcf":"markdown","43603198":"markdown","cc4fe1b5":"markdown","fe9185cf":"markdown","c9b06fa7":"markdown","8da70b20":"markdown","bf1647a4":"markdown","ffdeac42":"markdown","e8006d5d":"markdown","5f5e35ee":"markdown","0bf94601":"markdown","90a7a411":"markdown","057d004b":"markdown","e8467a26":"markdown","94810d5c":"markdown","c2f5cd42":"markdown","d856587c":"markdown","c91002fd":"markdown","8cff894b":"markdown","41add559":"markdown","21e74ad7":"markdown","42326553":"markdown","393d2123":"markdown","36a72418":"markdown","3d2de660":"markdown","3bee69f0":"markdown","90176648":"markdown","2f72d09d":"markdown","a3c7b845":"markdown","4728c23f":"markdown","a077429a":"markdown","61da0385":"markdown","d56490f9":"markdown","4aaf30ca":"markdown","6d308dbb":"markdown","ee32497b":"markdown","ae8710a9":"markdown","ce52f2ea":"markdown","283ca7c1":"markdown","6fd60ce2":"markdown","3d98940f":"markdown","5ecf0023":"markdown"},"source":{"7bac6c0a":"import pandas as pd\nimport seaborn as sns\nfrom matplotlib import pyplot as plt\nimport numpy as np\n\nimport warnings\nwarnings.filterwarnings('ignore')\n\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.ensemble import GradientBoostingClassifier, RandomForestClassifier\nfrom sklearn.metrics import accuracy_score\nfrom sklearn.model_selection import train_test_split, GridSearchCV","f167c1f4":"df = pd.read_csv('..\/input\/titanic\/train.csv')","4776b298":"df","74eb9854":"df.info()","1836cbd7":"df.drop('PassengerId', axis=1, inplace=True)","4b558b6f":"df.groupby('Pclass').Survived.mean()","a46b6aa3":"sns.countplot(x=df.Pclass, hue=df.Survived)\nplt.show()","4baa8cf1":"df.Name.sample(4)","739faec4":"df.Name = df.Name.apply(lambda x: x.split()[1].replace('.',''))","e15b0262":"df.Name.unique()","457c96a5":"df.Name.value_counts()","e23d0ec9":"def name_fun(x):\n    if x not in ['Mr', 'Miss', 'Mrs', 'Master', 'Dr', 'Rev']:\n        return 'Others'\n    else:\n        return x","4a847065":"df.Name = df.Name.apply(name_fun)","c0deb441":"df.Name = df.Name.map({'Mr':0, 'Miss':1, 'Mrs':2, 'Master':3, 'Dr':3, 'Rev':3, 'Others':4})","ec0e791e":"sns.countplot(x=df.Name)\nplt.xticks(rotation=75)\nplt.show()","f560ad62":"sns.countplot(x=df.Name, hue=df.Survived)\nplt.show()","9ed3559b":"df.Sex = df.Sex.map({'male':1, 'female':0})","1cdc6fc8":"df['Family'] = df.SibSp + df.Parch\ndf.drop(['SibSp', 'Parch'], axis=1, inplace=True)","fb48a3a3":"df.Ticket.sample(10)","8ab0fb56":"def ticket_fun(x):\n    if x.isdigit():\n        return str(x)[:1]\n    else:\n        return x[:1]","e7f7296a":"df.Ticket = df.Ticket.apply(lambda x: x.split()[0].replace('.','').replace('\/','').lower())\ndf.Ticket = df.Ticket.apply(ticket_fun)","952d25a0":"dict(df.Ticket.value_counts())","30aaf545":"sns.countplot(x=df.Ticket, hue=df.Survived)\nplt.show()","7b98fec7":"def ticket_fun2(x):\n    if x not in ['a', 'p', 's', '1', '2', '3', 'c']:\n        return 'Others'\n    else:\n        return str(x)\ndf.Ticket = df.Ticket.apply(ticket_fun2)","ab14a057":"sns.countplot(x=df.Ticket, hue=df.Survived)\nplt.show()","da802c88":"df.Ticket = df.Ticket.map({'a':0, 'p':1, 's':2, '1':3, '2':3, '3':4, 'c':5, 'Others':6})","88f137a7":"sns.histplot(df.Fare, bins=range(1,500, 10))\nplt.show()","109cd8ff":"def fare_fun(x):\n    if x>0 and x<50:\n        return 'gr1'\n    elif x>50 and x<100:\n        return 'gr2'\n    elif x>100:\n        return 'gr3'\ndf.Fare = df.Fare.apply(fare_fun)","d6170d4d":"sns.countplot(x=df.Fare, hue=df.Survived)\nplt.show()","97c80338":"df.Fare = df.Fare.fillna('gr1')\ndf[df.Fare.isnull()]","f4601bcf":"df.Fare = df.Fare.map({'gr1':0, 'gr2':1, 'gr3':2})","10fdb817":"df.Cabin = df.Cabin.apply(lambda x: str(x)[0])","e1e0b7ed":"df.drop(['Cabin'], axis=1, inplace=True)","73f89779":"df.Embarked = df.Embarked.fillna('S')\ndf.Embarked = df.Embarked.map({'S':0, 'Q':1, 'C':2})","a0085d5a":"sns.histplot(df[df.Survived==0].Age, color='r', label='Died')\nsns.histplot(df[df.Survived==1].Age, color='g', label='Survived')\nplt.legend()\nplt.show()","4bdd8568":"sns.histplot(df[df.Survived==0].Age, color='r', label='Died', bins=[0,15,30,45,60,80])\nsns.histplot(df[df.Survived==1].Age, color='g', label='Survived', bins=[0,15,30,45,60,80])\nplt.legend()\nplt.show()","95f0323a":"def age_fun(x):\n    if x>0 and x<30:\n        return 'gr1'\n    elif x>30 and x<45:\n        return 'gr2'\n    elif x>45 and x<60:\n        return 'gr3'\n    elif x>60:\n        return 'gr4'\ndf.Age = df.Age.apply(age_fun)","503725ea":"sns.countplot(x=df.Age, hue=df.Survived)\nplt.show()","30c1255d":"sns.countplot(x=df.Age, hue=df.Fare)\nplt.show()","d15a87a0":"df[df.Age.isnull()]","77f1a60a":"train_data = df[df.Age.isnull()==False]\ntrain_surv = train_data.Survived\ntarget = train_data.Age\ntrain_data.drop(['Age'], axis=1, inplace=True)\n\ntest_data =  df[df.Age.isnull()==True]\ntest_surv = test_data.Survived\ntest_data.drop(['Age'], axis=1, inplace=True)","b76d168d":"train_data.info()","a80c9810":"dtclf = DecisionTreeClassifier()\ndtclf.fit(train_data, target)\ntest_data['Age'] = dtclf.predict(test_data)","b8ee3b73":"sns.countplot(x=test_data.Age)\nplt.show()","ddbc9930":"train_data['Age'] = target\ntrain_data['Survived'] = train_surv\ntest_data['Survived'] = test_surv\ndf = pd.concat([train_data, test_data], axis=0)","97f799ee":"df.Age = df.Age.map({'gr1':0, 'gr2':1, 'gr3':2, 'gr4':3})","9a9cab39":"df.info()","72fbf6ed":"df","2377ea1b":"df.nunique()\n","53b93ed8":"X_train, X_val, y_train, y_val = train_test_split(df.drop(['Survived'], axis=1), df.Survived,\n                                                    test_size=0.10, random_state=42)\n\ngbclf = GradientBoostingClassifier()\ngbclf.fit(X_train, y_train)\ny_pred = gbclf.predict(X_val)\nacc = round(accuracy_score(y_pred, y_val) * 100, 2)\nprint(acc)","e73afcc6":"from xgboost.sklearn import XGBClassifier\n\nxgbclf = XGBClassifier()\nxgbclf.fit(X_train, y_train)\ny_pred = xgbclf.predict(X_val)\nacc = round(accuracy_score(y_pred, y_val) * 100, 2)\nprint(acc)","b78f2e63":"from sklearn.linear_model import LogisticRegression\n\nclf = LogisticRegression()\nclf.fit(X_train, y_train)\ny_pred = clf.predict(X_val)\nacc = round(accuracy_score(y_pred, y_val) * 100, 2)\nprint(acc)","c357a4c9":"from sklearn.ensemble import ExtraTreesClassifier\n\nclf = ExtraTreesClassifier()\nclf.fit(X_train, y_train)\ny_pred = clf.predict(X_val)\nacc = round(accuracy_score(y_pred, y_val) * 100, 2)\nprint(acc)","1d3412f8":"rfclf = RandomForestClassifier()\nrfclf.fit(X_train, y_train)\ny_pred = rfclf.predict(X_val)\nacc = round(accuracy_score(y_pred, y_val) * 100, 2)\nprint(acc)","ffda86dc":"from sklearn.svm import SVC\n\nsvclf = SVC()\nsvclf.fit(X_train, y_train)\ny_pred = svclf.predict(X_val)\nacc = round(accuracy_score(y_pred, y_val) * 100, 2)\nprint(acc)","7a61da04":"tdf = pd.read_csv('..\/input\/titanic\/test.csv')","0be02ea5":"tdf.info()","ece95a70":"tdf.drop(['PassengerId','Cabin'], axis=1, inplace=True)","570cf598":"tdf.Name = tdf.Name.apply(lambda x: str(x).split()[1].replace('.',''))","a2c720b7":"# For test data\n\ndef name_fun(x):\n    if x not in ['Mr', 'Miss', 'Mrs', 'Master', 'Dr', 'Rev']:\n        return 'Others'\n    else:\n        return x\n    \ntdf.Name = tdf.Name.apply(name_fun)\ntdf.Name = tdf.Name.map({'Mr':0, 'Miss':1, 'Mrs':2, 'Master':3, 'Dr':3, 'Rev':3, 'Others':4})\n\ntdf.Sex = tdf.Sex.map({'male':1, 'female':0})\n\ndef ticket_fun(x):\n    if x.isdigit():\n        return str(x)[:1]\n    else:\n        return x[:1]\n    \ntdf.Ticket = tdf.Ticket.apply(lambda x: x.split()[0].replace('.','').replace('\/','').lower())\ntdf.Ticket = tdf.Ticket.apply(ticket_fun)\n\ndef ticket_fun2(x):\n    if x not in ['a', 'p', 's', '1', '2', '3', 'c']:\n        return 'Others'\n    else:\n        return str(x)\ntdf.Ticket = tdf.Ticket.apply(ticket_fun2)\ntdf.Ticket = tdf.Ticket.map({'a':0, 'p':1, 's':2, '1':3, '2':3, '3':4, 'c':5, 'Others':6})\n\ndef fare_fun(x):\n    x = float(x)\n    if x>0 and x<50:\n        return 'gr1'\n    elif x>50 and x<100:\n        return 'gr2'\n    elif x>100:\n        return 'gr3'\ntdf.Fare = tdf.Fare.apply(fare_fun)\ntdf.Fare = tdf.Fare.fillna('gr1')\ntdf.Fare = tdf.Fare.map({'gr1':0, 'gr2':1, 'gr3':2})\ntdf.Embarked = tdf.Embarked.map({'S':0, 'Q':1, 'C':2})\n\ndef age_fun(x):\n    if x>0 and x<30:\n        return 'gr1'\n    elif x>30 and x<45:\n        return 'gr2'\n    elif x>45 and x<60:\n        return 'gr3'\n    elif x>60:\n        return 'gr4'\ntdf.Age = tdf.Age.apply(age_fun)\ntdf.Age = tdf.Age.fillna('gr1')\ntdf.Age = tdf.Age.map({'gr1':0, 'gr2':1, 'gr3':2, 'gr4':3})","1e83648e":"tdf['Family'] = tdf.SibSp + tdf.Parch\ntdf.drop(['SibSp','Parch'], axis=1, inplace=True)","101760bd":"tdf","bcc5a206":"RFC = RandomForestClassifier()\n\nparams = { \n              \"max_features\": [3, 5, 10, 15],\n              \"min_samples_split\": [3, 10, 15, 20],\n              \"n_estimators\" :[100, 300, 400, 500, 700, 1000, 1200, 1500, 1700],\n              \"criterion\": [\"gini\", \"entropy\"]\n          }\n\n\ngs = GridSearchCV(RFC, param_grid = params, cv=3, scoring=\"accuracy\", n_jobs= -1, verbose = 1)\n\ngs.fit(X_train,y_train)\n\n# print(gs.best_estimator_)\n# print(gs.best_score_)\n\nRFC_Best = gs.best_estimator_","cb3f6eae":"gbclf = GradientBoostingClassifier()\n\nparams = {    \n              'loss' : [\"deviance\"],\n              'n_estimators' : [50,100,200,300,500],\n              'learning_rate': [0.1, 0.05, 0.01, 0.001, 0.0001],\n              'max_depth': [4, 8]\n         }\n\ngs = GridSearchCV(gbclf,param_grid = params, cv=3, scoring=\"accuracy\", n_jobs= -1, verbose = 1)\n\ngs.fit(X_train,y_train)\n\n# print(gs.best_estimator_)\n# print(gs.best_score_)\n\nGBC_Best = gs.best_estimator_","c0f50a59":"clf = XGBClassifier()\n\nparams = {    \n              \"learning_rate\":[0.001, 0.01, 0.1],\n              \"max_depth\": [3, 5, 10, 15],\n              \"n_estimators\" :[100, 300, 400, 500, 700, 1000, 1200, 1500, 1700],\n         }\n\ngs = GridSearchCV(clf,param_grid = params, cv=3, scoring=\"accuracy\", n_jobs= -1, verbose = 1)\n\ngs.fit(X_train,y_train)\n\n# print(gs.best_estimator_)\n# print(gs.best_score_)\n\nXGBC_Best = gs.best_estimator_","b1e39892":"clf = SVC(probability=True)\nparams = {        \n                  'kernel': ['rbf', 'linear'], \n                  'gamma': [ 0.001, 0.01, 0.1, 1],\n                  'C': [1, 10, 50, 100, 200, 300, 1000]\n         }\n\ngs = GridSearchCV(clf,param_grid = params, cv=3, \n                      scoring=\"accuracy\", n_jobs= -1, verbose = 1)\n\ngs.fit(X_train,y_train)\n\n# print(gs.best_estimator_)\n# print(gs.best_score_)\n\nSVC_best = gs.best_estimator_","0a10944a":"from sklearn.ensemble import VotingClassifier\nVC = VotingClassifier(estimators=[('RFC', RFC_Best), \n                                       ('GBC', GBC_Best),\n                                       ('XGBC', XGBC_Best), \n                                       ('SVC',SVC_best)], voting='hard', n_jobs=-1)\n\nVC = VC.fit(X_train, y_train)","21752ce6":"ntdf = tdf[['Pclass', 'Name', 'Sex', 'Ticket', 'Fare', 'Embarked', 'Family', 'Age']]","190aa066":"submission = pd.DataFrame({ 'PassengerId' : pd.read_csv('..\/input\/titanic\/test.csv')['PassengerId'], \n                           'Survived': VC.predict(ntdf)})\nsubmission.to_csv('submission.csv', index=False)","e5080fcf":"### Feature Engineering Outcome","43603198":"#### Age","cc4fe1b5":"It turns out, test data has some NULL values too, we need to take care of that also the encodings must be same.","fe9185cf":"This dataset demands a feature centric approach and I haev kept it simple. For each step there is always something new one can do, so one must feel free to experiment. However, keeping it simple is the key.\n\n<b>I used Google Colab to get the outputs as Kaggle was taking too long.<\/b>","c9b06fa7":"This should be good enough.","8da70b20":"The tickets must correspond to something, cabin area or booking sequence maybe. But they surely form a group, by the initials, be they of the words present in the ticket columns or the first digits of the ticket no. So we break them like that.","bf1647a4":"### Feature Engineering","ffdeac42":"This is the prediction for the null values of Age column.","e8006d5d":"Lets split the train data and check once how a basic model performs. ","5f5e35ee":"#### Pclass","0bf94601":"#### Embarked","90a7a411":"So our task is to help the model get a clean and effective data and here we see \n1. PassengerId is useless\n2. Missing values in - Age, Cabin","057d004b":"It has so many missing values that it is better to drop.","e8467a26":"#### Ticket","94810d5c":"If you like this work, please <b>UPVOTE.<\/b>","c2f5cd42":"#### Fare","d856587c":"And they do have meaning when it comes to survival. But not all categories are relevant so lets reduce the no of buckets.","c91002fd":"#### PassengerId","8cff894b":"Now it is cleaner and more precise","41add559":"#### Name","21e74ad7":"### Training Model","42326553":"Lets see survival by the age group. Looks like only 0-5 year olds were certain to live others just followed a natural patter. But we will group them too.","393d2123":"#### Sex","36a72418":"There are plenty of Null values to be filled. I could try to infer from other features but lets give this task to a model instead.\n\nWe will predict the age from the data we have.","3d2de660":"#### Cabin","3bee69f0":"That's good enough.","90176648":"I took the liberty give few missing values to group 1 as they are the most in no.","2f72d09d":"We will keep till 'Rev' and put all others under one label called 'Others'.","a3c7b845":"Here is the test data after cleaning that we will use for prediction.","4728c23f":"### Load Data","a077429a":"### Imports","61da0385":"#### SibSp and Parch","d56490f9":"So here is what it looks like after all the tweaking.","4aaf30ca":"So they do form a group, as we can see.","6d308dbb":"In the Name feature, however, anything before the second space is like a title that repeats for several people but anything else in both its sides do not seem to repeat so they give no context to the model. In short they are not helpful.","ee32497b":"This gives meaning to the Sibling Spouse Parent Child features and defines one feature called Family.","ae8710a9":"### Predicting and Creating Submission File","ce52f2ea":"The bin sizes below hold the values well, so they should make good groups.","283ca7c1":"We leave the Pclass as it is as no of categories are low and they seem to have meaning in relation to target feature.","6fd60ce2":"Here is a truth about the 100% accuracy on Leader Board, this is something that everyone should be aware of while starting - https:\/\/www.kaggle.com\/tarunpaparaju\/titanic-competition-how-top-lb-got-their-score","3d98940f":"If we group them from 0-50, 51-100, 100 to any value, they fall in line well.","5ecf0023":"If we look at the Fare, they follow a pareto chart. They do have groups as we will see next."}}