{"cell_type":{"7c839656":"code","5da3a708":"code","a85b78c3":"code","939c3d3e":"code","9ea81696":"code","5acd6068":"code","4f8fd1aa":"code","a2d160b3":"code","6c21120a":"code","5fcc62c5":"code","ecb81ac5":"code","814df4a5":"code","fe7d1b64":"code","74b19d44":"code","67b3b2fa":"code","0b9b6d0a":"code","72addf35":"code","400f45ef":"code","7981385d":"code","7f7f7081":"code","23119c89":"code","b4c1506f":"code","13bc0df9":"code","ffbe3e75":"code","a338f346":"code","b307537f":"code","d7e63b58":"code","821728da":"code","79c7c41a":"code","7c1004c3":"code","81f3b286":"code","96fea750":"code","260acc89":"code","fcf2e487":"code","8a8905cb":"code","192b11fe":"code","1d7a6b69":"code","e3b5d240":"code","966af106":"code","4f5074e4":"code","7aecc0c3":"code","24bf9d89":"code","24bc9088":"code","8bf72af3":"code","28e40d6f":"code","348e2e12":"code","c45697e4":"code","2a6c28e7":"code","e6106316":"markdown","1b418647":"markdown","d41502a8":"markdown","23608807":"markdown","741775c7":"markdown","eff634db":"markdown","661960b8":"markdown","6ff5da56":"markdown","849fbd5c":"markdown","0ddb1933":"markdown","fa9f4229":"markdown","8c78b560":"markdown","15f97cc4":"markdown","2ba199ed":"markdown","1abca2d6":"markdown","fe3e8811":"markdown","54ce948b":"markdown","6f8a3de1":"markdown","74fd71e9":"markdown","70beb3f3":"markdown","00e258d3":"markdown","255be2df":"markdown","b7d91ee0":"markdown","e7e36257":"markdown"},"source":{"7c839656":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.preprocessing import StandardScaler\nfrom category_encoders.ordinal import OrdinalEncoder\nfrom sklearn.cluster import KMeans\nfrom sklearn.datasets import make_blobs\nfrom yellowbrick.cluster import KElbowVisualizer","5da3a708":"data = pd.read_csv('..\/input\/customer-personality-analysis\/marketing_campaign.csv', sep='\\t')","a85b78c3":"data.head()","939c3d3e":"data = data.set_index('ID')","9ea81696":"data.info()","5acd6068":"data['Income'] = data['Income'].fillna(data.groupby('Education')['Income'].transform('mean'))","4f8fd1aa":"data.describe()","a2d160b3":"data.nunique()","6c21120a":"# Dropping Z_CostContact and Z_Revenue for lack of information value\ndata=data.drop(columns=[\"Z_CostContact\", \"Z_Revenue\"],axis=1)","5fcc62c5":"data.hist(bins=50, figsize=(20,20))","ecb81ac5":"# Visualisation of corellations between columns\ncorr_matrix = data.corr()\nfig, ax = plt.subplots(figsize=(25, 16))\nax = sns.heatmap(data.corr(), cmap=sns.diverging_palette(240, 10, n=9), annot = True, ax = ax, center = 0)\nplt.xticks(rotation=45)","814df4a5":"data['Education'] = data['Education'].replace('2n Cycle', 'Master')","fe7d1b64":"# Creating total time of customers in company, last timestamp is from 2014 so i'll count days from 01.01.2015 to avoid\n# creating unrealistic numbers that are results of using old data.\ndata['Dt_Customer'] = pd.to_datetime(data['Dt_Customer'])\ndata['days_in_company']= (np.datetime64(\"2015-01-01\") - data['Dt_Customer']).dt.days","74b19d44":"# Transforming Year Birth into Age\ndata['Age']= 2015 - data['Year_Birth']","67b3b2fa":"# Calculating Total Spending\ndata['total_spending'] = data['MntWines'] + data['MntFruits'] + data['MntMeatProducts'] + data['MntFishProducts'] + data['MntSweetProducts'] + data['MntGoldProds']","0b9b6d0a":"# Calculating total number of purchases\ndata['total_purchases'] = data['NumDealsPurchases'] + data['NumWebPurchases'] + data['NumCatalogPurchases']+ data['NumStorePurchases']","72addf35":"# Calculating total number of Accepted promotion campaign\ndata['total_accepted_cmp'] = data['AcceptedCmp3']+ data['AcceptedCmp4']+ data['AcceptedCmp5'] + data['AcceptedCmp1'] +data['AcceptedCmp2']","400f45ef":"# Calculating total number of kids in houshold\ndata['kids'] = data['Kidhome']+data['Teenhome']","7981385d":"data['Marital_Status'].value_counts()","7f7f7081":"# Simplifying relationship status\ndata['Marital_Status'] = data['Marital_Status'].replace(['Single', 'Widow', 'Alone', 'Absurd', 'YOLO','Divorced'], 'Single')\ndata['Marital_Status'] = data['Marital_Status'].replace(['Married', 'Together'], 'Relationship')","23119c89":"sns.set_theme(style=\"whitegrid\")\nsns.boxplot(x=data['Age'])","b4c1506f":"sns.boxplot(x=data['Income'])","13bc0df9":"sns.boxplot(x=data['total_spending'])","ffbe3e75":"data = data[data['Age'] < 80]\ndata = data[data['Income'] < 120000]","a338f346":"print(\"Removed {} rows with outliers\".format(2240 - data.shape[0]))","b307537f":"cluster_columns = ['Age','Education','Income','Marital_Status','kids', 'total_spending', 'total_accepted_cmp']\ncluster_data = data[cluster_columns].copy()","d7e63b58":"ordinal_cols_mapping =[\n    { \n 'col':'Education',\n            'mapping':{ \n                'Basic' : 1,\n                'Graduation' : 2,\n                'Master' : 3,\n                'PhD' : 4},\n    }\n]\nencoder = OrdinalEncoder(mapping = ordinal_cols_mapping)\ncluster_data = encoder.fit_transform(cluster_data)","821728da":"cluster_data['Marital_Status'] = cluster_data['Marital_Status'].replace('Relationship', 1)\ncluster_data['Marital_Status'] = cluster_data['Marital_Status'].replace('Single', 0)","79c7c41a":"cluster_data['Marital_Status'].value_counts()","7c1004c3":"cluster_data.describe()","81f3b286":"scaler = StandardScaler()\nscaler.fit(cluster_data)\nnorm_cluster_data = pd.DataFrame(scaler.transform(cluster_data), columns= cluster_columns, index=cluster_data.index)","96fea750":"norm_cluster_data.head()","260acc89":"model = KMeans()\nvisualizer = KElbowVisualizer(model, k=10)\nvisualizer.fit(norm_cluster_data) \nvisualizer.show()  ","fcf2e487":"model = KMeans(n_clusters = 5, random_state = 42)\ncluster_class = model.fit_predict(norm_cluster_data)","8a8905cb":"cluster_data['cluster_class'] = cluster_class + 1","192b11fe":"data['cluster_class'] = cluster_class + 1","1d7a6b69":"groupby_clusters = cluster_data.groupby(cluster_class)","e3b5d240":"groupby_clusters.mean()","966af106":"cluster_data['cluster_class'].value_counts()","4f5074e4":"sns.kdeplot(x = cluster_data[\"Age\"], hue = cluster_data['cluster_class'], palette=\"tab10\",linewidth = 2.5, common_norm=False)","7aecc0c3":"groupby_clusters.mean()['Age']","24bf9d89":"sns.barplot(x = ['Class 1','Class 2', 'Class 3', 'Class 4','Class 5'], y=groupby_clusters.mean()['Marital_Status'], palette=\"tab10\").set_title('Percentage of people in Relationship')","24bc9088":"groupby_clusters.mean()['Marital_Status']","8bf72af3":"sns.histplot(x = cluster_data[\"kids\"], hue = cluster_data['cluster_class'], palette=\"tab10\", multiple = 'stack', binwidth=0.4, stat='density', common_norm=False)","28e40d6f":"sns.histplot(x = data[\"Education\"], hue = data['cluster_class'], palette=\"tab10\", multiple = 'dodge', binwidth=0.5, shrink = 0.8, stat='density', common_norm=False)","348e2e12":"sns.kdeplot(x = cluster_data[\"Income\"], hue = cluster_data['cluster_class'], palette=\"tab10\", linewidth = 2.5, common_norm=False)","c45697e4":"sns.kdeplot(x = cluster_data[\"total_spending\"], hue = cluster_data['cluster_class'], palette=\"tab10\",linewidth = 2.5, common_norm=False)","2a6c28e7":"sns.histplot(x = cluster_data[\"total_accepted_cmp\"], hue = cluster_data['cluster_class'], palette=\"tab10\", multiple = 'stack', binwidth=0.4, stat='density', common_norm=False)","e6106316":"# EDA","1b418647":"# Feature Engineering","d41502a8":"Class 1 - Have often 1 or 2 kids rarely 0 or 3<br>\nClass 2 - Have mostly 0 kid, rarely 1<br>\nClass 3 - Have mostly 1 kid rarely 0 or 1<br>\nClass 4 - Have mostly 1 kid rarely 0 or 1<br>\nClass 5 - Have mostly 0 kid rarely 1<br>","23608807":"Looking for outliers","741775c7":"# Customer Segmentation (EDA, K-means, Personality analysis)","eff634db":"Summary: <br>\n\nCluster 1 \"Medium-class parents \/ intelligency \"- Older, 72 % in relationship, have 1 or 2 kids, Very High education ,Medium Income, Low to Medium Spending, rarely use promotions<br>\n\nCluster 2 \"Rich retired\"- Older,65 % in relationship, No kids in home, High Education,High Income, High Spending, sometimes use promotion,<br>\n<br>\nCluster 3 \"Single parent\"- Young to middle Aged, 0 % in relationship, have often 1 kid, Standard education ,Low Income, Low to lower-medium spending, rarely use promotions<br>\n<br>\nCluster 4 \"Love and married\"- Young to Middle Aged, always in relationship, have 1 or 2 kids, Standard education, Low Income, Low spender, rarely use promotions<br>\n<br>\nCluster 5 \"Rich, childfree\"- Spread in age, mostly young, 65 % in relationship, have mostly 0 kids sometimes 1, High Education ,Very High income, Biggest Spender, very often use coupons,<br>","661960b8":"Clustering using KMeans","6ff5da56":"Normalization","849fbd5c":"Preparing data for clustering","0ddb1933":"# Clustering","fa9f4229":"Class 1 - Older people mostly 40-65<br>\nClass 2 - Older people mostly 40-60 with presence of younger<br>\nClass 3 - Mostly Middle Aged with presence of older<br>\nClass 4 - Mostly Middle Aged<br>\nClass 5 - Mostly young people with presence of older<br>","8c78b560":"KDE graphs was adjusted for cluster size.","15f97cc4":"Encoding categorial columns","2ba199ed":"# Analysing clustered group","1abca2d6":"Removing outliers from Age and Income","fe3e8811":"Class 1, 3, 4 - rarely use coupons<br>\nClass 2 - sometimes use coupons<br>\nClass 5 - use coupons very often<br>","54ce948b":"Class 1 - 72 % is in relationship<br>\nClass 2 - 64 % is in relationship<br>\nClass 3 - 0 % is in relationship<br>\nClass 4 - 100 % is in relationship<br>\nClass 5 - 64 % is in relationship <br>","6f8a3de1":"Goal : Explore Customers data, cluster customers to create managable personas, analyse created clusters.","74fd71e9":"Cluster 1 - Medium Income<br>\nCluster 2 - High Income<br>\nCluster 3 - Low to Medium income<br>\nCluster 4 - Low to Medium Income<br>\nCluster 5 - Very High Income<br>","70beb3f3":"# Summary of cluster classes.","00e258d3":"Attributes<br>\n\nPeople<br>\n\nID: Customer's unique identifier<br>\nYear_Birth: Customer's birth year<br>\nEducation: Customer's education level<br>\nMarital_Status: Customer's marital status<br>\nIncome: Customer's yearly household income<br>\nKidhome: Number of children in customer's household<br>\nTeenhome: Number of teenagers in customer's household<br>\nDt_Customer: Date of customer's enrollment with the company<br>\nRecency: Number of days since customer's last purchase<br>\nComplain: 1 if customer complained in the last 2 years, 0 otherwise<br>\n\nProducts<br>\n\nMntWines: Amount spent on wine in last 2 years<br>\nMntFruits: Amount spent on fruits in last 2 years<br>\nMntMeatProducts: Amount spent on meat in last 2 years<br>\nMntFishProducts: Amount spent on fish in last 2 years<br>\nMntSweetProducts: Amount spent on sweets in last 2 years<br>\nMntGoldProds: Amount spent on gold in last 2 years<br>\n\nPromotion<br>\n\nNumDealsPurchases: Number of purchases made with a discount<br>\nAcceptedCmp1: 1 if customer accepted the offer in the 1st campaign, 0 otherwise<br>\nAcceptedCmp2: 1 if customer accepted the offer in the 2nd campaign, 0 otherwise<br>\nAcceptedCmp3: 1 if customer accepted the offer in the 3rd campaign, 0 otherwise<br>\nAcceptedCmp4: 1 if customer accepted the offer in the 4th campaign, 0 otherwise<br>\nAcceptedCmp5: 1 if customer accepted the offer in the 5th campaign, 0 otherwise<br>\nResponse: 1 if customer accepted the offer in the last campaign, 0 otherwise<br>\n\nPlace<br>\n\nNumWebPurchases: Number of purchases made through the company\u2019s web site<br>\nNumCatalogPurchases: Number of purchases made using a catalogue<br>\nNumStorePurchases: Number of purchases made directly in stores<br>\nNumWebVisitsMonth: Number of visits to company\u2019s web site in the last month<br>","255be2df":"Cluster 1 - Low to Medium Spending<br>\nCluster 2 - High Spending<br>\nCluster 3 - Low to Lower-Medium spending<br>\nCluster 4 - Low spending<br>\nCluster 5 - Biggest spending<br>","b7d91ee0":"There are some null values in Income column, they consist of less than 5 % of data, it is safe to fill them with mean value.","e7e36257":"Class 1 - Highest Education Mostly PhD some Master<br>\nClass 2 - High Education Mostly Graduated significant part have Master some have PhD<br>\nClass 3 - Standard Education Mostly Graduated significant part have Master some PhD and some have Basic<br>\nClass 4 - Similar to Class 3 with no PhD presence<br>\nClass 5 - High Education Half group have either PhD or Master, rest Graduated<br>"}}