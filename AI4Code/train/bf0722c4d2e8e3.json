{"cell_type":{"19938732":"code","0318e304":"code","6330fdb1":"code","bc462be1":"code","d4af8167":"code","b0bba744":"code","db0bf6d9":"code","61c508b8":"code","eea9a28b":"code","6447fd1f":"code","60ba4387":"code","38017985":"code","a3bf9877":"code","e4f6e9a0":"code","28ff1611":"markdown","ce33fe44":"markdown","c8aeed4a":"markdown"},"source":{"19938732":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nplt.rcParams['figure.figsize'] = 16,9\nfrom tqdm import tqdm","0318e304":"K = 1","6330fdb1":"df_test = pd.read_csv('..\/input\/test.csv', parse_dates=['pickup_datetime'], index_col='key')\ndf_test.info()","bc462be1":"from sklearn.neighbors import KDTree, NearestNeighbors","d4af8167":"df_test['t'] = df_test['pickup_datetime'].astype('int64') \/\/ 10**9","b0bba744":"features = ['t', 'pickup_latitude', 'pickup_longitude', 'dropoff_latitude', 'dropoff_longitude', 'passenger_count']","db0bf6d9":"features_mean, features_std = df_test[features].describe().loc[['mean', 'std']].values","61c508b8":"X_test = (df_test[features].values - features_mean) \/ features_std","eea9a28b":"test_neighbors = [[] for _ in range(len(df_test))]","6447fd1f":"for df_chunk in tqdm(pd.read_csv('..\/input\/train.csv', index_col='key', parse_dates=['pickup_datetime'], chunksize=50000)):\n    df_chunk['t'] = df_chunk['pickup_datetime'].astype('int64') \/\/ 10**9\n    \n    X_chunk = (df_chunk[features].values - features_mean) \/ features_std\n    \n    kd = KDTree(X_chunk, leaf_size=50)\n    \n    D, I = kd.query(X_test, k=K)\n    Y = df_chunk['fare_amount'].values[I]\n\n    for i in range(len(test_neighbors)):\n        test_neighbors[i] += list(zip(D[i], Y[i]))\n        test_neighbors[i] = sorted(test_neighbors[i], key=lambda x: x[0])[:K]","60ba4387":"df_sub = pd.DataFrame({\n    'key': df_test.index,\n    'fare_amount': np.array([[x[1] for x in neighbors] for neighbors in test_neighbors]).mean(axis=1)\n}).set_index('key')","38017985":"df_sub.head()","a3bf9877":"sns.distplot(df_sub['fare_amount'])","e4f6e9a0":"df_sub.to_csv('submission.csv')","28ff1611":"\n# Predict and Submit","ce33fe44":"# Find k-Nearest Neighbors","c8aeed4a":"# Read Test Data"}}