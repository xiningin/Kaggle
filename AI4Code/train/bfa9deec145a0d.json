{"cell_type":{"e7026918":"code","7ee95e56":"code","4ba2ebca":"code","c82101a2":"code","28d6e3a4":"code","1fed5e77":"code","08b3a0d3":"code","65c0a3ea":"code","6c387791":"code","089cff7b":"code","2a255cd7":"code","06ef1f2e":"code","1ed7cbd2":"code","b013ecf0":"code","b572fe39":"code","3812a26f":"code","a218043d":"code","d2a4111a":"code","7771c2c3":"code","29106ee6":"code","70255c52":"code","2d23e6c4":"code","d61dc521":"code","cbee078e":"code","719c58ab":"code","1bb55f38":"code","1fa942bd":"code","89c46e6c":"code","8b3fc873":"code","3177374d":"code","34e9a69a":"code","8c474b84":"code","f3cd43ed":"code","10f4bb51":"code","7a44f6ca":"code","780f60b9":"markdown","076b7342":"markdown","3dd4b7ee":"markdown","73ded572":"markdown","f6eae1c4":"markdown","87367c92":"markdown","36bc3b77":"markdown","94701d09":"markdown","11b5d26b":"markdown","d546cd8b":"markdown","c7a0780e":"markdown","a592ed33":"markdown","e6fcd234":"markdown","6a87de7c":"markdown","ddf022f5":"markdown","30de4175":"markdown","ef7f4b1f":"markdown","6e7d4e42":"markdown","9b73ba71":"markdown","95b2351c":"markdown","f30805a8":"markdown","8156b6fc":"markdown","f8025a35":"markdown","1d6b6f57":"markdown","e97da97f":"markdown","6a04700c":"markdown","6bef69e5":"markdown","80de73f9":"markdown"},"source":{"e7026918":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.metrics import confusion_matrix\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.preprocessing import LabelEncoder\nfrom sklearn.model_selection import train_test_split \n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","7ee95e56":"dataframe = pd.read_csv('\/kaggle\/input\/hotel-booking-demand\/hotel_bookings.csv')","4ba2ebca":"use_columns = list(dataframe.columns)","c82101a2":"use_columns.remove('previous_cancellations')","28d6e3a4":"pd.set_option('display.max_columns', None)\ndisplay(dataframe.head())\npd.set_option('display.max_columns', 10)","1fed5e77":"dataframe.info()","08b3a0d3":"dataframe['company'] = dataframe['company'].fillna('no company')\ndataframe['agent'] = dataframe['agent'].fillna('no agent')","65c0a3ea":"display(f\"Number of unique companies '{dataframe.company.unique().shape[0]}' \")\ndisplay(f\"Number of unique agent '{dataframe.agent.unique().shape[0]}' \")","6c387791":"dataframe.loc[dataframe['company'] != 'no company', 'company'] = 1\ndataframe.loc[dataframe['company'] == 'no company', 'company'] = 0","089cff7b":"dataframe.loc[dataframe['agent'] != 'no agent', 'agent'] = 1\ndataframe.loc[dataframe['agent'] == 'no agent', 'agent'] = 0","2a255cd7":"sns.countplot(dataframe['is_canceled'])\nplt.title(\"Number of cancel booking and not cancel booking\")\nplt.show()","06ef1f2e":"use_columns.remove('arrival_date_year')\nuse_columns.remove('arrival_date_month')\nuse_columns.remove('arrival_date_week_number')\nuse_columns.remove('arrival_date_day_of_month')","1ed7cbd2":"pd.DataFrame(dataframe.groupby(['is_canceled', 'hotel']).size())","b013ecf0":"use_columns.remove('hotel')","b572fe39":"dataframe.groupby(['assigned_room_type','is_canceled']).size()","3812a26f":"dataframe.groupby(['reserved_room_type','is_canceled']).size()","a218043d":"use_columns.remove('reserved_room_type')\nuse_columns.remove('assigned_room_type')","d2a4111a":"dataframe.groupby(['deposit_type','is_canceled']).size()","7771c2c3":"pd.DataFrame(dataframe.groupby(['is_canceled'])['days_in_waiting_list'].mean())","29106ee6":"pd.DataFrame(dataframe.groupby(['is_canceled'])['days_in_waiting_list'].std())","70255c52":"pd.DataFrame(dataframe.groupby('is_canceled')['days_in_waiting_list'].median())","2d23e6c4":"use_columns.remove('days_in_waiting_list')","d61dc521":"dataframe.groupby(['total_of_special_requests', 'is_canceled']).size()","cbee078e":"dataframe.groupby(['is_canceled', 'required_car_parking_spaces']).size()","719c58ab":"use_columns.remove('reservation_status_date')\nuse_columns.remove('reservation_status')","1bb55f38":"labelEncoder = LabelEncoder()\nencoded_dataframe = dataframe[use_columns].apply(lambda x: labelEncoder.fit_transform(x.astype(str)))","1fa942bd":"x_train, x_test, y_train, y_test = train_test_split(encoded_dataframe.drop('is_canceled', axis=1), encoded_dataframe['is_canceled'])","89c46e6c":"model = RandomForestClassifier()\nmodel.fit(x_train, y_train)","8b3fc873":"y_pred = model.predict(x_test)","3177374d":"confusion_matrix(y_pred, y_test)","34e9a69a":"pd.DataFrame.from_dict([dict(zip(encoded_dataframe.drop('is_canceled', axis=1), model.feature_importances_))]).T.sort_values(0)","8c474b84":"pd.DataFrame.from_dict([dict(zip(encoded_dataframe.drop('is_canceled', axis=1), model.feature_importances_))]).T.sort_values(0)[:6].index","f3cd43ed":"x_train, x_test, y_train, y_test = train_test_split(encoded_dataframe.drop(['babies', 'is_repeated_guest', 'company',\n       'previous_bookings_not_canceled', 'agent', 'children', 'is_canceled'], axis=1), encoded_dataframe['is_canceled'])","10f4bb51":"model.fit(x_train, y_train)\ny_pred = model.predict(x_test)\nconfusion_matrix(y_pred, y_test)","7a44f6ca":"pd.DataFrame.from_dict([dict(zip(x_train, model.feature_importances_))]).T.sort_values(0)","780f60b9":"# reservation_status e reservation_status_date","076b7342":"As we can see, 6 features does not aggregate too much to the model, so lets remove than and retrain","3dd4b7ee":"Company is the one with the biggest number of null values, but as we can see this means that the guests are not doing the reservation thought a company. Let fill the company attribute with 0. The same happen to 'agent'.","73ded572":"The data seems to be balance. Let's move on","f6eae1c4":"This variables helps a lot. When a booking is created and the guest request at least one space, he is definily going to hotel","87367c92":"# reserved_room_type","36bc3b77":"As we can see above, this variable definitely helps to predict the model. So, the chance of someone who did a deposit like Non Refund cancel a booking is huge ","94701d09":"# days_in_waiting_list","11b5d26b":"Looking only for the mean, it seems that the number of days have some influence; however, looking for the std, we can see that the values vary a lot. When we analyse the median, we can see that most part of the people cancel their book even when there are not in the waiting list.","d546cd8b":"The numbers of days in the waiting list have any influence on the cancelation?","c7a0780e":"Looking for the above data, we can see that the number of requests does have influence on the cancelation rate.","a592ed33":"# total_of_special_requests","e6fcd234":"# Let's see if the data is well balance","6a87de7c":"# deposit_type","ddf022f5":"# hotel","30de4175":"# Finally, let's do some prediction","ef7f4b1f":"Does the number of required_car_parking_spaces in a reservation influence the cancelation rate?","6e7d4e42":"Since I am not doing any temporal analysis, I am checking all the other features.","9b73ba71":"Dont think so","95b2351c":"If we analyse the values below, we indeed can see, that the days_in_waiting_list does not influence the is_canceled","f30805a8":"> This variables are used to show whether or not a reservation was made or not. This can be used to futher analysis, but not for predict the is_canceled","8156b6fc":"hotel influence on the cancelation?","f8025a35":"Since the number of unique values of agent and companies are extremily big, let's replace the values for 0 and 1. This means if the guest uses company, it will be 1 and in case it does not use it, it will be 0. The same procesedure to agent","1d6b6f57":"Does the number of total_of_special_requests in a reservation influence the cancelation rate?","e97da97f":"# arrival_date_year, arrival_date_month, arrival_date_week_number, arrival_date_day_of_month","6a04700c":"In this kernel I am trying to predict whether or not a guest is going to cancel their booking. I did some data exploration and remove some variables from the analysis.","6bef69e5":"# required_car_parking_spaces","80de73f9":"# company and agent"}}