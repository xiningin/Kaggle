{"cell_type":{"b9e5841f":"code","f02da174":"code","91fb69cf":"code","97fd121b":"code","cb25605e":"code","24bc3b33":"code","3c412406":"code","20b1196c":"code","e07437ac":"code","e1b5479b":"code","b1c82d6e":"code","4cebdb96":"code","5cd13a05":"code","1a422abd":"code","234273ae":"code","cc239c3a":"code","146d93fd":"code","1988b3db":"markdown","4afe6664":"markdown","b4e97126":"markdown","ae55f131":"markdown","e9225873":"markdown","d4167a59":"markdown","d5cd22dd":"markdown"},"source":{"b9e5841f":"import fastai\nfrom fastai.vision import *\nfastai.__version__","f02da174":"path = Path('..\/input\/2019-3rd-ml-month-with-kakr\/')","91fb69cf":"# Making pretrained weights work without needing to find the default filename\nfrom torch.utils import model_zoo\nPath('models').mkdir(exist_ok=True)\n!cp '..\/input\/densenet201\/densenet201.pth' 'models\/'\ndef load_url(*args, **kwargs):\n    model_dir = Path('models')\n    filename  = 'densenet201.pth'\n    if not (model_dir\/filename).is_file(): raise FileNotFoundError\n    return torch.load(model_dir\/filename)\nmodel_zoo.load_url = load_url","97fd121b":"# Load train dataframe\ntrain_df = pd.read_csv(path\/'train.csv')\ntrain_df.head()","cb25605e":"# Load sample submission\ntest_df = pd.read_csv(path\/'sample_submission.csv')\ntest_df.head()","24bc3b33":"tfms = get_transforms(do_flip=True, flip_vert=False, max_rotate=0.10, max_zoom=1.5, max_lighting=0.2)","3c412406":"train, test = [ImageList.from_df(df, path=path, cols='img_file', folder=folder) \n               for df, folder in zip([train_df, test_df], ['train', 'test'])]\ndata = (train.split_by_rand_pct(0.2, seed=42)\n        .label_from_df(cols='class')\n        .add_test(test)\n        .transform(tfms, size=224)\n        .databunch(path=Path('.'), bs=64).normalize(imagenet_stats))","20b1196c":"data.show_batch() # data\uc5d0\uc11c \ud558\ub098\uc758 \ubc30\uce58\ub97c \ud655\uc778\ud558\uac8c \ud560 \uc218 \uc788\uac8c \ud569\ub2c8\ub2e4.","e07437ac":"data.classes # data\uac00 \uac16\ub294 class\ub4e4\uc744 \ubcfc \uc218 \uc788\uac8c \ud569\ub2c8\ub2e4.","e1b5479b":"learn = cnn_learner(data, base_arch=models.densenet201, metrics=accuracy)","b1c82d6e":"# Find a good learning rate\nlearn.lr_find()\nlearn.recorder.plot()","4cebdb96":"lr = 7e-02\nlearn.fit_one_cycle(3, slice(lr))","5cd13a05":"learn.unfreeze()","1a422abd":"learn.lr_find()\nlearn.recorder.plot()","234273ae":"lr = 7e-4\nlearn.fit_one_cycle(21, slice(lr\/10, lr))","cc239c3a":"# Test predictions\ntest_preds = learn.TTA(ds_type=DatasetType.Test)\ntest_df['class'] = np.argmax(test_preds[0], axis=1) + 1\ntest_df.head()","146d93fd":"test_df.to_csv('submission.csv', index=False) ","1988b3db":"[Fast.ai Documentation](https:\/\/docs.fast.ai\/)\uc5d0\ub294 \ub2e4\uc591\ud55c \uc635\uc158\ub4e4\uc774 \ub9ce\uc544 \ucc38\uace0\ud558\uc138\uc694","4afe6664":"## Load pre-trained model\n\uc774\ubc88 Kaggle Korea 3rd Competition\uc740 \uc778\ud130\ub137 \uc811\uc18d\uc744 \ud5c8\uc6a9\ud558\uc9c0\ub9cc \ub300\ubd80\ubd84\uc758 Competition\ub4e4\uc740 \uc778\ud130\ub137\uc744 \uc811\uc18d\uc744 \ud5c8\uc6a9\ud558\uc9c0 \uc54a\ub294 \uacbd\uc6b0\uac00 \ub9ce\uc544 \uc774 \ubc29\ubc95\uc744 \uc54c\uace0 \uc788\uc73c\uba74 \uc88b\uc744 \uac83 \uac19\uc544 \uc18c\uac1c\ud574\ub4dc\ub9bd\ub2c8\ub2e4.\n\ucee4\ub110 \uc624\ub978\ucabd \uc704\uc5d0 + Add Dataset\uc774\ub77c\ub294 \ubc84\ud2bc\uc744 \ub20c\ub9ac\uba74 \uc790\uc2e0\uc774 \ub9cc\ub4e0 private \ub370\uc774\ud130 \uc14b\uc774\ub098 \ub2e4\ub978 \uc0ac\ub78c\ub4e4\uc774 \ub9cc\ub4e0 public \ub370\uc774\ud130 \uc14b\ub4e4\uc744 \uac00\uc838\ub2e4 \uc0ac\uc6a9\ud560 \uc218 \uc788\uac8c \ub429\ub2c8\ub2e4. \n\n\uc544\ub798\uc758 \uc140\uc740 Imagenet\uc73c\ub85c train \ub418\uc5b4 \uc788\ub294 model\uc744 \ubd88\ub7ec\uc640 Fast.ai\uac00 \uc77d\uc744 \uc218 \uc788\ub294 \ud615\ud0dc\ub85c \ubcc0\ud615\ud574 \uc8fc\uc5c8\uc2b5\ub2c8\ub2e4.","b4e97126":"## Model define\n\n\uc0ac\uc6a9\ud560 model\uacfc metric\uc744 cnn_learner\ub85c \uc815\uc758\ud574 \uc90d\ub2c8\ub2e4. cnn_learner\uc758 pretrained\ub294 default\ub85c True\ub85c \ub4e4\uc5b4\uac00 \uc788\uc5b4 pretrain model\uc744 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294\ub2e4\uba74 False\ub85c \uc8fc\uc2dc\uba74 \ub429\ub2c8\ub2e4. \uc704\uc5d0\uc11c pretrain model\uc744 \uc5c5\ub85c\ub4dc \ud558\uc9c0 \uc54a\uc558\ub2e4\uba74 \uc790\ub3d9\uc73c\ub85c \ub2e4\uc6b4\ub85c\ub4dc \ubc1b\uc2b5\ub2c8\ub2e4.(\ub2e4\uc6b4\ub85c\ub4dc\ub97c \ubc1b\uc73c\ub824\uba74 settings\uc5d0 internet \uc635\uc158\uc774 on\uc774 \ub418\uc5b4\uc57c \uac00\ub2a5\ud569\ub2c8\ub2e4.)","ae55f131":"## Data Augmentation\n\n\ub370\uc774\ud130\ub4e4\uc744 \uc778\uc704\uc801\uc73c\ub85c \ub2e4\uc591\ud55c \uc65c\uace1\uc744 \ubd80\uc5ec\ud558\uc5ec \ubaa8\ub378\uc5d0\uac8c \ub2e4\uc591\ud55c \uacbd\ud5d8\ub4e4\uc744 \ud558\uac8c \ub3c4\uc640\uc90d\ub2c8\ub2e4. \ud558\uc9c0\ub9cc \ub108\ubb34 \uacfc\ub3c4\ud55c \uc65c\uace1\uc740 \ubaa8\ub378\uc774 \ubaa9\uc801\ud55c \uac83\uacfc \ub2e4\ub974\uac8c train\uc774 \ub420 \uc218 \uc788\uc73c\ub2c8 \uc720\uc758\ud558\uc154\uc11c \uc0ac\uc6a9\ud558\uc154\uc57c \ud569\ub2c8\ub2e4.\n\nFast.ai\uc5d0\uc11c\ub294 get_transforms\ub77c\ub294 \ud568\uc218\ub97c \uc774\uc6a9\ud558\uc5ec \uc0ac\uc6a9\ud558\uace0 \uc2f6\uc740 \uc635\uc158\ub4e4\uc744 \ucd94\uac00\ud558\uc5ec data Augmetation\uc744 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\n\n- do_flip : \uc774\ubbf8\uc9c0\ub4e4\uc744 \uc88c\uc6b0 \/ \uc0c1\ud558 \ub300\uce6d\uc73c\ub85c flip\uc744 \ud558\ub294 \uc635\uc158\uc785\ub2c8\ub2e4.\n- flip_vert : \uc0c1\ud558 \ub300\uce6d\uc744 \ud558\uac70\ub098 \ud558\uc9c0 \uc54a\uc744 \uc218 \uc788\uac8c \ud558\ub294 \uc635\uc158\uc785\ub2c8\ub2e4.\n- max_rotate : \uc774\ubbf8\uc9c0\ub97c \ud68c\uc804\uc2dc\ud0a4\ub294 \uc635\uc158\uc774\uba70 \ubd80\uc5ec\ud55c [-max_rotate ~ max_rotate ] \ubc94\uc704\uc5d0\uc11c \ub79c\ub364\ud558\uac8c \ud68c\uc804\ud569\ub2c8\ub2e4.\n- max_zoom : \ub79c\ub364\ud558\uac8c zoom \ud558\ub294 \uc635\uc158\uc785\ub2c8\ub2e4.\n- max_lighting : \ub79c\ub364\ud558\uac8c \ubc1d\uae30 \uc870\uc808\uc744 \ud574\uc904 \uc218 \uc788\ub294 \uc635\uc158\uc785\ub2c8\ub2e4.","e9225873":"## Train \/ Test Dataframe load","d4167a59":"## Learning Rate Find\n\nFast.ai\uc5d0\ub294 hyper paramter\uc778 learning rate\ub97c \ucc3e\uc544\uc8fc\ub294 \ud568\uc218\uac00 \uc788\uc2b5\ub2c8\ub2e4. \n\n\uc815\ud655\ud55c \uad6c\ub3d9 \uc6d0\ub9ac\ub294 [\ub17c\ubb38](https:\/\/arxiv.org\/abs\/1506.01186) \uc5d0\uc11c \uc124\uba85\ud558\uace0 \uc788\uc73c\ub2c8 \ucc38\uace0 \ud558\uc2dc\uba74 \uc88b\uc744 \uac83 \uac19\uc544\uc694\n\n\n## Model Learning","d5cd22dd":"## Fast.ai\nFast.ai\ub294 Pytorch \uc0c1\uc704 Framwork\uc774\uba70 \ucf54\ub4dc \uba87 \uc904\ub9cc\uc73c\ub85c \ubaa8\ub378\uc744 \ub9cc\ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uadf8\ub9ac\uace0 \ucd5c\uc2e0 \ub17c\ubb38\uc5d0\uc11c \uac00\uc838\uc628 \uae30\uc220\ub4e4\uc744 \uc190\uc27d\uac8c \uad6c\ud604\ud574\ub0bc \uc218 \uc788\uc2b5\ub2c8\ub2e4. "}}