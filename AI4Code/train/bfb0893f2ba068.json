{"cell_type":{"aeac948a":"code","f9751239":"code","fe9584c7":"code","fee32703":"code","aba375c7":"code","2bbeaa51":"code","2d9db56e":"code","9318268f":"code","9100c664":"code","86d65dd2":"code","b4f13e41":"code","210aff01":"code","8d24eaf4":"code","9e5a7ebe":"code","ed764347":"code","fba0ec32":"code","c60b7f48":"code","916ef19a":"code","7aa215f5":"code","bbb7fc54":"code","921b3a79":"code","6b66c4e1":"code","1c18e77b":"markdown","c30e76c1":"markdown","5ff035d8":"markdown","031fccaa":"markdown","be210529":"markdown"},"source":{"aeac948a":"import pandas as pd\nimport numpy as np\nfrom sklearn.preprocessing import MinMaxScaler, LabelEncoder\nimport matplotlib.pyplot as plt\nimport tensorflow as tf","f9751239":"tr = pd.read_csv('..\/input\/tabular-playground-series-may-2021\/train.csv')\ntr.head()","fe9584c7":"tr_X = tr.iloc[:,1:-1]\ntr_y = tr.iloc[:,-1]","fee32703":"le = LabelEncoder()\nlabels = le.fit_transform(tr_y)","aba375c7":"ms = MinMaxScaler()\nms.fit(tr_X)\ntr_X_ms = ms.transform(tr_X)","2bbeaa51":"image_rows = 5\nimage_cols = 10\ntr_X_ms_reshape = tr_X_ms.reshape(tr_X_ms.shape[0],image_rows,image_cols,1)","2d9db56e":"images = np.array(tr_X_ms_reshape, dtype = 'float32')","9318268f":"plt.imshow(images[0], cmap=plt.cm.binary)","9100c664":"input_shapes = (image_rows, image_cols, 1)","86d65dd2":"model = tf.keras.Sequential([\n    tf.keras.layers.Conv2D(256, (2, 2), padding='same', activation = 'relu', input_shape = input_shapes), \n    tf.keras.layers.Conv2D(128, (2, 2), padding='same', activation = 'relu'),\n    tf.keras.layers.Conv2D(64, (2, 2), padding='same', activation = 'relu'),\n    tf.keras.layers.Conv2D(32, (2, 2), padding='same', activation = 'relu'),\n    tf.keras.layers.Flatten(),\n    tf.keras.layers.Dense(128, activation=tf.nn.relu),\n    tf.keras.layers.Dense(64, activation=tf.nn.relu),\n    tf.keras.layers.Dense(32, activation=tf.nn.relu),\n    tf.keras.layers.Dense(4, activation=tf.nn.softmax)\n])\n\nmodel.compile(optimizer = 'RMSprop', loss = 'sparse_categorical_crossentropy', metrics=['accuracy'])","b4f13e41":"def create_callbacks():\n    \n    cpk_path = '.\/best_model.h5'\n    \n    checkpoint = tf.keras.callbacks.ModelCheckpoint(\n        filepath=cpk_path,\n        monitor='val_accuracy',\n        mode='max',\n        save_best_only=True,\n        verbose=1,\n    )\n\n    reducelr = tf.keras.callbacks.ReduceLROnPlateau(\n        monitor='val_accuracy',\n        mode='max',\n        factor=0.1,\n        patience=3,\n        verbose=0\n    )\n\n    earlystop = tf.keras.callbacks.EarlyStopping(\n        monitor='val_accuracy',\n        mode='max',\n        patience=10, \n        verbose=1\n    )\n    \n    callbacks = [checkpoint, reducelr, earlystop]         \n    \n    return callbacks","210aff01":"def plot_hist(hist):\n    plt.plot(hist.history[\"accuracy\"])\n    plt.plot(hist.history[\"val_accuracy\"])\n    plt.title(\"model accuracy\")\n    plt.ylabel(\"accuracy\")\n    plt.xlabel(\"epoch\")\n    plt.legend([\"train\", \"validation\"], loc=\"best\")\n    plt.show()","8d24eaf4":"Epochs = 100\nBatch = 32\n\nhistory = model.fit(images, labels, batch_size=Batch, epochs=Epochs, callbacks=create_callbacks(),validation_split=0.3)","9e5a7ebe":"plot_hist(history)","ed764347":"te = pd.read_csv('..\/input\/tabular-playground-series-may-2021\/test.csv')\nte.head()","fba0ec32":"te_X = te.iloc[:,1:]\nte_id = te.iloc[:,0]","c60b7f48":"te_X_ms = ms.transform(te_X)\nte_X_ms_reshape = te_X_ms.reshape(te_X_ms.shape[0],image_rows,image_cols,1)","916ef19a":"te_images = np.array(te_X_ms_reshape, dtype = 'float32')","7aa215f5":"preds = model.predict_proba(te_images)","bbb7fc54":"preds","921b3a79":"submission = pd.DataFrame(preds, columns = [\"Class_1\", \"Class_2\", \"Class_3\", \"Class_4\"], index=te_id)","6b66c4e1":"submission.to_csv('.\/submission.csv')","1c18e77b":"## 3. Data reshape - Image array","c30e76c1":"## 5.Prediction","5ff035d8":"## 2.Read Data","031fccaa":"## 4. Make CNN model","be210529":"## 1.Load library"}}