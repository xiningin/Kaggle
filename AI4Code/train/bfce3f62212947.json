{"cell_type":{"90213ee6":"code","102a4115":"code","977627bf":"code","fec80677":"code","db6a4c37":"code","867910bc":"code","4998b7cf":"code","83c4718e":"code","d796cc7a":"code","e33d5a5a":"code","765104b7":"code","a19c2878":"code","c5b25c1d":"code","85a5e8c7":"code","10a113d6":"code","3a130b70":"code","ed9be2d6":"code","27ed92b3":"code","ea3fb368":"code","600f86c1":"code","f0543e04":"code","363b9d22":"code","3c7e41d0":"code","082eb383":"code","9b53bd28":"code","4c74ea30":"code","5f3b7f1f":"code","3743cc71":"code","dec59351":"code","67ab30e8":"code","5cafc40f":"code","41f94b8c":"code","0f3827e3":"code","47bfaf6f":"code","9efc97ec":"code","7e0ab134":"code","36b7366c":"code","0440ec68":"code","9670d676":"code","6a68d90a":"code","6b1a8f8d":"code","d27ae225":"code","598946c4":"markdown","8a4a2f9f":"markdown","71a3bd39":"markdown","15ffd3f9":"markdown","9355a80b":"markdown","b4ebc6c2":"markdown","130a0db2":"markdown"},"source":{"90213ee6":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\npd.plotting.register_matplotlib_converters()\nplt.show()","102a4115":"file_path='..\/input\/osic-pulmonary-fibrosis-progression'\nraw_data =pd.read_csv(file_path+'\/train.csv')\ntest_data =pd.read_csv(file_path+'\/test.csv')\nsub =pd.read_csv(file_path+'\/sample_submission.csv')","977627bf":"print('The shape of the training dataset is ', raw_data.shape)\nprint('The shape of the training dataset is ', test_data.shape)\nprint('The Totl number of patients visited :',len(raw_data.Patient.unique()))","fec80677":"raw_data.info()","db6a4c37":"# reading the data from the first week of evry patient\ndf=raw_data.groupby(['Patient']).first()","867910bc":"df.head()","4998b7cf":"Smoke=df.groupby(['SmokingStatus']).count()['Sex'].to_frame()\nSmoke","83c4718e":"sns.barplot(x=Smoke.Sex.keys(),y=Smoke.Sex.values)","d796cc7a":"df.groupby(['Sex']).count()['SmokingStatus'].to_frame()","e33d5a5a":"plt.figure(figsize=(10, 5))\nsns.countplot(data=df, x='SmokingStatus', hue='Sex')","765104b7":"# Age dostribution plot \nmu=df.Age.std()\nmean=df.Age.mean()\nplt.figure(figsize=(10,6))\nplt.title('Age distirbution [mu {:.2f} and mean {:.2f}]'.format(mu,mean),fontsize=15,color='black')\nsns.distplot(df['Age'],kde=True)","a19c2878":"# smoking staus versus Age distribution\nsmoker_dist=df.loc[df.SmokingStatus=='Currently smokes']['Age']\nexsmoker_dist=df.loc[df.SmokingStatus=='Ex-smoker']['Age']\nnonsmoker_dist=df.loc[df.SmokingStatus=='Never smoked']['Age']\n\nplt.figure(figsize=(10,6))\nsns.kdeplot(smoker_dist,shade=True,label='currenty smokes')\nsns.kdeplot(exsmoker_dist,shade=True,label='Ex-smoker')\nsns.kdeplot(nonsmoker_dist,shade=True,label='Never smoked')","c5b25c1d":"# Gender and Age distribution\nMale_dist=df.loc[df.Sex=='Male']['Age']\nFemale_dist=df.loc[df.Sex=='Female']['Age']\n\nplt.figure(figsize=(10,6))\nsns.kdeplot(Male_dist,shade=True,label='Male')\nsns.kdeplot(Female_dist,shade=True,label='Female')","85a5e8c7":"plt.figure(figsize=(10,6))\nsns.swarmplot(x=df[\"Sex\"],y=df['Age'],hue=df['SmokingStatus'])","10a113d6":"patient_ids=raw_data.Patient.unique()","3a130b70":"patient_week=[]\npatient_fvc=[]\npatient_percentage=[]\nfor ids in patient_ids:\n    week=raw_data.loc[raw_data['Patient']==ids]['Weeks'].values\n    fvc=raw_data.loc[raw_data['Patient']==ids]['FVC'].values\n    percent=raw_data.loc[raw_data['Patient']==ids]['Percent'].values\n    patient_week.append(week)\n    patient_fvc.append(fvc)\n    patient_percentage.append(percent)","ed9be2d6":"plt.figure(figsize=(10,10))\nplt.title(\"Each patient's FVC decay over the weeks\")\nplt.xlabel('Weeks')\nplt.ylabel('FVC deacy ')\nfor i in range(len(patient_ids)):\n    sns.lineplot(x=patient_week[i],y=patient_fvc[i],label ='P'+str(i+1),lw=1,legend=False)","27ed92b3":"plt.figure(figsize=(10,10))\nplt.title(\"Each patient's Percentage over the weeks\")\nplt.xlabel('Weeks')\nplt.ylabel('Percentage')\nfor i in range(len(patient_ids)):\n    sns.lineplot(x=patient_week[i],y=patient_percentage[i],label ='P'+str(i+1),lw=1,legend=False)","ea3fb368":"plt.figure(figsize=(10,10))\nplt.title(\"Each patient's Percentage Vs FVC\")\nplt.xlabel('FVC')\nplt.ylabel('Percentage')\nfor i in range(len(patient_ids)):\n    sns.lineplot(x=patient_fvc[i],y=patient_percentage[i],label ='P'+str(i+1),lw=1,legend=False)","600f86c1":"df_base = raw_data.drop_duplicates(subset='Patient', keep='first')\ndf_base = df_base[['Patient', 'Weeks', 'FVC', \n                   'Percent', 'Age']].rename(columns={'Weeks': 'base_week',\n                                                      'Percent': 'base_percent',\n                                                      'Age': 'base_age',\n                                                      'FVC': 'base_FVC'})","f0543e04":"data_train =raw_data.merge(df_base,how='left',on=['Patient'])\ndata_train =data_train.loc[data_train.Weeks!=data_train.base_week]# removing the first week from the weeks\ndata_train['week_count']=data_train.Weeks-data_train.base_week # to check the weeks count from base week\n\ndata_train= pd.get_dummies(data_train,columns=['Sex','SmokingStatus']) # to get the dummy columns for Sex and smokingststaus","363b9d22":"data_train.head()","3c7e41d0":"data_train_inp_file =data_train.drop(columns=['Patient','FVC','Percent','Weeks','Age'],axis=1)","082eb383":"target =data_train['FVC']","9b53bd28":"def log_likely_hood(y_true,y_pred,y_pred_std):\n    \n    sigma_clipped = np.maximum(y_pred_std,70)\n    \n    delta = np.minimum(abs(y_true-y_pred),1000)\n    \n    metric = -(np.sqrt(2*delta)\/sigma_clipped)-np.log(np.sqrt(2*sigma_clipped))\n    \n    return np.mean(metric)","4c74ea30":"from sklearn.linear_model import ARDRegression\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn.model_selection import train_test_split","5f3b7f1f":"X_train,X_test,y_train,y_test=train_test_split(data_train_inp_file,target,test_size=0.2)","3743cc71":"X_train.shape,y_test.shape","dec59351":"from sklearn.preprocessing import StandardScaler\n\nscalar= StandardScaler()\n\nX_train_scaled = scalar.fit_transform(X_train)\n\nX_test_scaled = scalar.fit_transform(X_test)","67ab30e8":"ard= ARDRegression()\nard.fit(X_train_scaled,y_train)","5cafc40f":"y_pred,y_pred_std=ard.predict(X_test_scaled,return_std=True)","41f94b8c":"log_likely_hood(y_test,y_pred,y_pred_std)# prediction on training set","0f3827e3":"sub['Patient'] = sub['Patient_Week'].apply(lambda x: x.split('_')[0])\nsub['Weeks'] = sub['Patient_Week'].apply(lambda x: x.split('_')[1]).astype(int)\nsub.head()","47bfaf6f":"sub_mod = sub.drop(columns=['FVC','Confidence'],axis=1)\nsub_mod.head()","9efc97ec":"df_test=test_data.rename(columns={'Weeks': 'base_week',\n                                'Percent': 'base_percent',\n                                'Age': 'base_age',\n                                'FVC': 'base_FVC'})\n\ndf_test=pd.get_dummies(df_test,columns=['Sex','SmokingStatus'])","7e0ab134":"df_test['Sex_Female']=0\ndf_test['SmokingStatus_Currently smokes']=0","36b7366c":"df_test_mod2=sub_mod.merge(df_test,how='left',on=['Patient'])\nsub2= df_test_mod2.copy()","0440ec68":"sub2.head()","9670d676":"data_test_inp_file = sub2.copy()\ndata_test_inp_file['week_count']= data_test_inp_file.Weeks-data_test_inp_file.base_week\ndata_test_inp_file.drop(['Patient','Weeks'],axis=1,inplace=True)","6a68d90a":"features=data_train_inp_file.columns\ndata_test_inp_file_id=data_test_inp_file['Patient_Week']\ndata_test_file =data_test_inp_file.drop(['Patient_Week'],axis=1)\ndata_test_file = data_test_file[features]","6b1a8f8d":"data_test_file.head()","d27ae225":"y_pred_test,y_pred_test_std=ard.predict(data_test_file.values,return_std=True)\nsubmission=pd.DataFrame({'Patient_Week':data_test_inp_file_id,'FVC':y_pred_test,'Confidence':y_pred_test_std})\nsubmission.to_csv('submission.csv', index=False)","598946c4":"# Training Set up","8a4a2f9f":"## In-sights\n`1.There are more number of patients belongs to ex-smokers and currently smoking patients are very less.\n2.From gender prespective many patients are men` ","71a3bd39":"# Metrics","15ffd3f9":"# FVC and Percentage","9355a80b":"# Age distirbution","b4ebc6c2":"# preparing test data","130a0db2":"# Smoking Status"}}