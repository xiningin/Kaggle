{"cell_type":{"0035fd44":"code","0d20441a":"code","75189883":"code","4d549394":"code","65b1f6c2":"code","59b35683":"code","bb6f6e29":"code","c6d16f27":"code","2ee7732b":"code","16e3ff28":"code","fc339c9c":"code","2cc940fd":"code","6e17142c":"code","ba3cf382":"code","a2d41e6a":"code","95fadbb9":"code","7bae5b7d":"code","1fb8ce12":"code","79b87b18":"code","16c6dfa9":"code","753dc5eb":"code","8e4ff9c1":"code","39c0fa7a":"code","b31a96bf":"code","91ef8c27":"code","12f46f50":"code","ed266985":"code","345764df":"code","653ce2d3":"code","d1c36daa":"code","44b2ff69":"code","f3b5d386":"code","dc20d0c6":"code","81566f7f":"code","7db44831":"code","0cbba62a":"code","befda3e7":"code","1505809f":"code","46184ef2":"code","4dfb757e":"code","892794c8":"code","1bf03ae8":"code","453b91ad":"code","00d2bc31":"code","c389fdfb":"code","a7d0dbb2":"code","982a33fd":"code","d0e4987b":"code","2cbf0880":"code","c0bed1a2":"code","47dc8c4f":"code","fcfead4d":"code","3b4acbfa":"code","c075c2a1":"code","74d6d29f":"code","0d4c6b79":"code","e58013d6":"code","3d73d74d":"code","7587c92d":"code","961bcb8b":"code","af201c53":"code","c70399f3":"markdown","1c9fdaef":"markdown","acfdabb5":"markdown","0b0cdec8":"markdown","dbc80d54":"markdown","9237b923":"markdown","0d09d1aa":"markdown","c85ad1da":"markdown","cbe276c5":"markdown","618f963a":"markdown","6ab162a6":"markdown","31234e53":"markdown","dd3475df":"markdown","df96da36":"markdown","7aa7cf07":"markdown","2410635e":"markdown","a7cc011b":"markdown","d0afd0d3":"markdown","89712224":"markdown","be374360":"markdown","5c683f7a":"markdown","eec2c7dc":"markdown","2236d439":"markdown","ed80dbd0":"markdown"},"source":{"0035fd44":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","0d20441a":"train_data=pd.read_excel('\/kaggle\/input\/flight-fare-prediction-mh\/Data_Train.xlsx')\ntest_data=pd.read_excel('\/kaggle\/input\/flight-fare-prediction-mh\/Test_set.xlsx')","75189883":"train_data.shape,test_data.shape","4d549394":"train_data.head()","65b1f6c2":"train_data.info()","59b35683":"test_data.info()","bb6f6e29":"# Checking missing value in dataset\ntrain_data.isnull().values.any(),test_data.isnull().values.any()","c6d16f27":"train_data.isnull().sum()","2ee7732b":"train_data.dropna(inplace=True)","16e3ff28":"# Checking if there are any Duplicate values\ntrain_data[train_data.duplicated()]","fc339c9c":"# Drop duplicates value\ntrain_data.drop_duplicates(keep='first',inplace=True)","2cc940fd":"train_data[\"Additional_Info\"].value_counts()","6e17142c":"train_data[\"Additional_Info\"] = train_data[\"Additional_Info\"].replace({'No Info': 'No info'})","ba3cf382":"# Duration convert hours in min.\ntrain_data['Duration']=  train_data['Duration'].str.replace(\"h\", '*60').str.replace(' ','+').str.replace('m','*1').apply(eval)\ntest_data['Duration']=  test_data['Duration'].str.replace(\"h\", '*60').str.replace(' ','+').str.replace('m','*1').apply(eval)","a2d41e6a":"# Date_of_Journey\ntrain_data[\"Journey_day\"] = train_data['Date_of_Journey'].str.split('\/').str[0].astype(int)\ntrain_data[\"Journey_month\"] = train_data['Date_of_Journey'].str.split('\/').str[1].astype(int)\ntrain_data.drop([\"Date_of_Journey\"], axis = 1, inplace = True)\n\n# Dep_Time\ntrain_data[\"Dep_hour\"] = pd.to_datetime(train_data[\"Dep_Time\"]).dt.hour\ntrain_data[\"Dep_min\"] = pd.to_datetime(train_data[\"Dep_Time\"]).dt.minute\ntrain_data.drop([\"Dep_Time\"], axis = 1, inplace = True)\n\n# Arrival_Time\ntrain_data[\"Arrival_hour\"] = pd.to_datetime(train_data.Arrival_Time).dt.hour\ntrain_data[\"Arrival_min\"] = pd.to_datetime(train_data.Arrival_Time).dt.minute\ntrain_data.drop([\"Arrival_Time\"], axis = 1, inplace = True)","95fadbb9":"# Date_of_Journey\ntest_data[\"Journey_day\"] = test_data['Date_of_Journey'].str.split('\/').str[0].astype(int)\ntest_data[\"Journey_month\"] = test_data['Date_of_Journey'].str.split('\/').str[1].astype(int)\ntest_data.drop([\"Date_of_Journey\"], axis = 1, inplace = True)\n\n# Dep_Time\ntest_data[\"Dep_hour\"] = pd.to_datetime(test_data[\"Dep_Time\"]).dt.hour\ntest_data[\"Dep_min\"] = pd.to_datetime(test_data[\"Dep_Time\"]).dt.minute\ntest_data.drop([\"Dep_Time\"], axis = 1, inplace = True)\n\n# Arrival_Time\ntest_data[\"Arrival_hour\"] = pd.to_datetime(test_data.Arrival_Time).dt.hour\ntest_data[\"Arrival_min\"] = pd.to_datetime(test_data.Arrival_Time).dt.minute\ntest_data.drop([\"Arrival_Time\"], axis = 1, inplace = True)","7bae5b7d":"plt.figure(figsize = (15, 10))\nplt.title('Count of flights month wise')\nax=sns.countplot(x = 'Journey_month', data = train_data)\nplt.xlabel('Month')\nplt.ylabel('Count of flights')\nfor p in ax.patches:\n    ax.annotate(int(p.get_height()), (p.get_x()+0.25, p.get_height()+1), va='bottom',\n                    color= 'black')","1fb8ce12":"# Total_Stops\ntrain_data['Total_Stops'].replace(['1 stop', 'non-stop', '2 stops', '3 stops', '4 stops'], [1, 0, 2, 3, 4], inplace=True)\ntest_data['Total_Stops'].replace(['1 stop', 'non-stop', '2 stops', '3 stops', '4 stops'], [1, 0, 2, 3, 4], inplace=True)","79b87b18":"train_data[\"Airline\"].value_counts()","16c6dfa9":"plt.figure(figsize = (15, 10))\nplt.title('Count of flights with different Airlines')\nax=sns.countplot(x = 'Airline', data =train_data)\nplt.xlabel('Airline')\nplt.ylabel('Count of flights')\nplt.xticks(rotation = 90)\nfor p in ax.patches:\n    ax.annotate(int(p.get_height()), (p.get_x()+0.25, p.get_height()+1), va='bottom',\n                    color= 'black')","753dc5eb":"plt.figure(figsize = (15, 10))\nplt.title('Price VS Airlines')\nplt.scatter(train_data['Airline'], train_data['Price'])\nplt.xticks(rotation = 90)\nplt.xlabel('Airline')\nplt.ylabel('Price of ticket')\nplt.xticks(rotation = 90)\n","8e4ff9c1":"# Airline\ntrain_data[\"Airline\"].replace({'Multiple carriers Premium economy':'Other', \n                                                        'Jet Airways Business':'Other',\n                                                        'Vistara Premium economy':'Other',\n                                                        'Trujet':'Other'\n                                                   },    \n                                        inplace=True)\n\ntest_data[\"Airline\"].replace({'Multiple carriers Premium economy':'Other', \n                                                        'Jet Airways Business':'Other',\n                                                        'Vistara Premium economy':'Other',\n                                                        'Trujet':'Other'\n                                                   },    \n                                        inplace=True)","39c0fa7a":"\nplt.figure(figsize = (15, 10))\nplt.title('Price VS Additional Information')\nsns.scatterplot(train_data['Additional_Info'], train_data['Price'],data=train_data)\nplt.xticks(rotation = 90)\nplt.xlabel('Information')\nplt.ylabel('Price of ticket')","b31a96bf":"train_data[\"Additional_Info\"].value_counts()","91ef8c27":"# Additional_Info\ntrain_data[\"Additional_Info\"].replace({'Change airports':'Other', \n                                                        'Business class':'Other',\n                                                        '1 Short layover':'Other',\n                                                        'Red-eye flight':'Other',\n                                                        '2 Long layover':'Other',   \n                                                   },    \n                                        inplace=True)\ntest_data[\"Additional_Info\"].replace({'Change airports':'Other', \n                                                        'Business class':'Other',\n                                                        '1 Short layover':'Other',\n                                                        'Red-eye flight':'Other',\n                                                        '2 Long layover':'Other',   \n                                                   },    \n                                        inplace=True)","12f46f50":"train_data.head()","ed266985":"data = train_data.drop([\"Price\"], axis=1)","345764df":"train_categorical_data = data.select_dtypes(exclude=['int64', 'float','int32'])\ntrain_numerical_data = data.select_dtypes(include=['int64', 'float','int32'])\n\ntest_categorical_data = test_data.select_dtypes(exclude=['int64', 'float','int32','int32'])\ntest_numerical_data  = test_data.select_dtypes(include=['int64', 'float','int32'])","653ce2d3":"train_categorical_data.head()","d1c36daa":"#Label encode and hot encode categorical columns\nfrom sklearn.preprocessing import LabelEncoder\nle = LabelEncoder()\ntrain_categorical_data = train_categorical_data.apply(LabelEncoder().fit_transform)\ntest_categorical_data = test_categorical_data.apply(LabelEncoder().fit_transform)","44b2ff69":"train_categorical_data.head()","f3b5d386":"X = pd.concat([train_categorical_data, train_numerical_data], axis=1)\ny=train_data['Price']\ntest_set = pd.concat([test_categorical_data, test_numerical_data], axis=1)","dc20d0c6":"X.head()","81566f7f":"y.head()","7db44831":"from sklearn.preprocessing import StandardScaler\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import mean_squared_error as mse\nfrom sklearn.metrics import r2_score\n\nfrom math import sqrt\n\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.model_selection import RandomizedSearchCV\n\nfrom sklearn.neighbors import KNeighborsRegressor\nfrom sklearn.linear_model import Ridge\nfrom sklearn.linear_model import Lasso\nfrom sklearn.tree import DecisionTreeRegressor\nfrom sklearn.ensemble import RandomForestRegressor\nfrom xgboost import XGBRegressor\nfrom sklearn.model_selection import KFold\n\ndef mean_absolute_percentage_error(y_true, y_pred): \n    y_true, y_pred = np.array(y_true), np.array(y_pred)\n    return np.mean(np.abs((y_true - y_pred) \/ y_true)) * 100","0cbba62a":"# training testing and splitting the dataset\nfrom sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.3, random_state = 42)","befda3e7":"print(\"The size of training input is\", X_train.shape)\nprint(\"The size of training output is\", y_train.shape)\nprint(50 *'*')\nprint(\"The size of testing input is\", X_test.shape)\nprint(\"The size of testing output is\", y_test.shape)","1505809f":"params ={'alpha' :[0.0001, 0.001, 0.01, 0.1, 1, 10, 100, 1000, 10000, 100000]}\nridge_regressor =GridSearchCV(Ridge(), params ,cv =5,scoring = 'neg_mean_absolute_error', n_jobs =-1)\nridge_regressor.fit(X_train ,y_train)","46184ef2":"y_train_pred =ridge_regressor.predict(X_train) ##Predict train result\ny_test_pred =ridge_regressor.predict(X_test) ##Predict test result","4dfb757e":"print(\"Train Results for Ridge Regressor Model:\")\nprint(50 * '-')\nprint(\"Root mean squared error: \", sqrt(mse(y_train.values, y_train_pred)))\nprint(\"Mean absolute % error: \", round(mean_absolute_percentage_error(y_train.values, y_train_pred)))\nprint(\"R-squared: \", r2_score(y_train.values, y_train_pred))","892794c8":"print(\"Test Results for Ridge Regressor Model:\")\nprint(50 * '-')\nprint(\"Root mean squared error: \", sqrt(mse(y_test, y_test_pred)))\nprint(\"Mean absolute % error: \", round(mean_absolute_percentage_error(y_test, y_test_pred)))\nprint(\"R-squared: \", r2_score(y_test, y_test_pred))\n","1bf03ae8":"params ={'alpha' :[0.0001, 0.001, 0.01, 0.1, 1, 10, 100, 1000, 10000, 100000]}\nlasso_regressor =GridSearchCV(Lasso(), params ,cv =15,scoring = 'neg_mean_absolute_error', n_jobs =-1)\nlasso_regressor.fit(X_train ,y_train)","453b91ad":"y_train_pred =lasso_regressor.predict(X_train) ##Predict train result\ny_test_pred =lasso_regressor.predict(X_test) ##Predict test result","00d2bc31":"print(\"Train Results for Lasso Regressor Model:\")\nprint(50 * '-')\nprint(\"Root mean squared error: \", sqrt(mse(y_train.values, y_train_pred)))\nprint(\"Mean absolute % error: \", round(mean_absolute_percentage_error(y_train.values, y_train_pred)))\nprint(\"R-squared: \", r2_score(y_train.values, y_train_pred))","c389fdfb":"print(\"Test Results for Lasso Regressor Model:\")\nprint(50 * '-')\nprint(\"Root mean squared error: \", sqrt(mse(y_test, y_test_pred)))\nprint(\"Mean absolute % error: \", round(mean_absolute_percentage_error(y_test, y_test_pred)))\nprint(\"R-squared: \", r2_score(y_test, y_test_pred))","a7d0dbb2":"k_range = list(range(1, 30))\nparams = dict(n_neighbors = k_range)\nknn_regressor = GridSearchCV(KNeighborsRegressor(), params, cv =10, scoring = 'neg_mean_squared_error')\nknn_regressor.fit(X_train, y_train)\n","982a33fd":"y_train_pred =knn_regressor.predict(X_train) ##Predict train result\ny_test_pred =knn_regressor.predict(X_test) ##Predict test result","d0e4987b":"print(\"Train Results for KNN Regressor Model:\")\nprint(50 * '-')\nprint(\"Root mean squared error: \", sqrt(mse(y_train.values, y_train_pred)))\nprint(\"Mean absolute % error: \", round(mean_absolute_percentage_error(y_train.values, y_train_pred)))\nprint(\"R-squared: \", r2_score(y_train.values, y_train_pred))\n","2cbf0880":"\nprint(\"Test Results for KNN Regressor Model:\")\nprint(50 * '-')\nprint(\"Root mean squared error: \", sqrt(mse(y_test, y_test_pred)))\nprint(\"Mean absolute % errorr: \", round(mean_absolute_percentage_error(y_test, y_test_pred)))\nprint(\"R-squared: \", r2_score(y_test, y_test_pred))","c0bed1a2":"depth  =list(range(3,30))\nparam_grid =dict(max_depth =depth)\ntree =GridSearchCV(DecisionTreeRegressor(),param_grid,cv =10)\ntree.fit(X_train,y_train)","47dc8c4f":"y_train_pred =tree.predict(X_train) ##Predict train result\ny_test_pred =tree.predict(X_test) ##Predict test result","fcfead4d":"print(\"Train Results for Decision Tree Regressor Model:\")\nprint(50 * '-')\nprint(\"Root mean squared error: \", sqrt(mse(y_train.values, y_train_pred)))\nprint(\"Mean absolute % error: \", round(mean_absolute_percentage_error(y_train.values, y_train_pred)))\nprint(\"R-squared: \", r2_score(y_train.values, y_train_pred))","3b4acbfa":"print(\"Test Results for Decision Tree Regressor Model:\")\nprint(50 * '-')\nprint(\"Root mean squared error: \", sqrt(mse(y_test, y_test_pred)))\nprint(\"Mean absolute % error: \", round(mean_absolute_percentage_error(y_test, y_test_pred)))\nprint(\"R-squared: \", r2_score(y_test, y_test_pred))","c075c2a1":"tuned_params = {'n_estimators': [100, 200, 300, 400, 500], 'min_samples_split': [2, 5, 10], 'min_samples_leaf': [1, 2, 4]}\nrandom_regressor = RandomizedSearchCV(RandomForestRegressor(), tuned_params, n_iter = 20, scoring = 'neg_mean_absolute_error', cv = 5, n_jobs = -1)\nrandom_regressor.fit(X_train, y_train)\n","74d6d29f":"y_train_pred = random_regressor.predict(X_train)\ny_test_pred = random_regressor.predict(X_test)","0d4c6b79":"print(\"Train Results for Random Forest Regressor Model:\")\nprint(50 * '-')\nprint(\"Root mean squared error: \", sqrt(mse(y_train.values, y_train_pred)))\nprint(\"Mean absolute % error: \", round(mean_absolute_percentage_error(y_train.values, y_train_pred)))\nprint(\"R-squared: \", r2_score(y_train.values, y_train_pred))","e58013d6":"print(\"Test Results for Random Forest Regressor Model:\")\nprint(50 * '-')\nprint(\"Root mean squared error: \", sqrt(mse(y_test, y_test_pred)))\nprint(\"Mean absolute % error: \", round(mean_absolute_percentage_error(y_test, y_test_pred)))\nprint(\"R-squared: \", r2_score(y_test, y_test_pred))","3d73d74d":"tuned_params = {'max_depth': [1, 2, 3, 4, 5], 'learning_rate': [0.01, 0.05, 0.1], 'n_estimators': [100, 200, 300, 400, 500], 'reg_lambda': [0.001, 0.1, 1.0, 10.0, 100.0]}\nmodel = RandomizedSearchCV(XGBRegressor(), tuned_params, n_iter=20, scoring = 'neg_mean_absolute_error', cv=5, n_jobs=-1)\nmodel.fit(X_train, y_train)","7587c92d":"y_train_pred = model.predict(X_train)\ny_test_pred = model.predict(X_test)","961bcb8b":"print(\"Train Results for XGBoost Regressor Model:\")\nprint(50 * '-')\nprint(\"Root mean squared error: \", sqrt(mse(y_train.values, y_train_pred)))\nprint(\"Mean absolute % error: \", round(mean_absolute_percentage_error(y_train.values, y_train_pred)))\nprint(\"R-squared: \", r2_score(y_train.values, y_train_pred))","af201c53":"print(\"Test Results for XGBoost Regressor Model:\")\nprint(50 * '-')\nprint(\"Root mean squared error: \", sqrt(mse(y_test, y_test_pred)))\nprint(\"Mean absolute % error: \", round(mean_absolute_percentage_error(y_test, y_test_pred)))\nprint(\"R-squared: \", r2_score(y_test, y_test_pred))","c70399f3":"### **Concatenate both catagorical and numerical data**","1c9fdaef":"Convert No Info in No info because both are same","acfdabb5":"* # Random Forest Regressor","0b0cdec8":"* # Feature Engineering ( Dividing data into features and labels)","dbc80d54":"# Flight Price prediction\n![](https:\/\/wonderfulengineering.com\/wp-content\/uploads\/2014\/05\/airplane-wallpaper-2.jpg)","9237b923":"* ## Decision Tree Regressor","0d09d1aa":" <center><h1 style=\"color:red\">Don't forget to upvote if you like it! :)<\/h1><\/center>","c85ad1da":"## Problem Statement\n\nFlight ticket prices can be something hard to guess, today we might see a price, check out the price of the same flight tomorrow, it will be a different story. We might have often heard travelers saying that flight ticket prices are so unpredictable. As data scientists, we are gonna prove that given the right data anything can be predicted. Here you will be provided with prices of flight tickets for various airlines between the months of March and June of 2019 and between various cities.\nSize of training set: 10683 records\n\nSize of test set: 2671 records\n\nFEATURES: Airline: The name of the airline.\n\nDate_of_Journey: The date of the journey\n\nSource: The source from which the service begins.\n\nDestination: The destination where the service ends.\n\nRoute: The route taken by the flight to reach the destination.\n\nDep_Time: The time when the journey starts from the source.\n\nArrival_Time: Time of arrival at the destination.\n\nDuration: Total duration of the flight.\n\nTotal_Stops: Total stops between the source and destination.\n\nAdditional_Info: Additional information about the flight\n\nPrice: The price of the ticket","cbe276c5":"There are more number of flights of Jet Airways.\n\n Jet Airways Business, Vistara Premium economy, Trujet have actually almost negligible flights.","618f963a":"If you have reached till here, So i hope you liked my Analysis.\n\nDon't forget to **upvote** if you like it!.\n\nI'm a beginner and any suggestion in the comment box is highly appreciated.\n\nIf you have any doubt reagrding any part of the notebook, feel free to comment your doubt in the comment box.\n\nThank you!!","6ab162a6":"* ## XGB Regressor","31234e53":"* ## Explore dataset","dd3475df":"\n#### From above scatter plot it is clear that the ticket prices for Business class is higher which is quite obivious.","df96da36":"* ## K Neighbors Regressor","7aa7cf07":"train_data have missing value.Lets check it","2410635e":"* # Data Cleaning","a7cc011b":"* ## Ridge","d0afd0d3":"* ## Lasso","89712224":"\nThe ticket rate for Jet Airways Business airline is high.","be374360":"## Our dataset is ready now!","5c683f7a":"### Convert categorical data into numerical","eec2c7dc":"## Importing Libraries","2236d439":"#  Building Machine Learning Models","ed80dbd0":"## **Random Forest Regressor & XGB Regressor are giving Maximum Accuracy as compare to other Regressor algorithm.**"}}