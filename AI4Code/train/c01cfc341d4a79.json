{"cell_type":{"53b69df3":"code","fac45131":"code","8f1c5dc5":"code","8c2aecca":"code","af0e3100":"code","c0398d41":"code","7bc510a2":"markdown"},"source":{"53b69df3":"import pandas as pd\nimport numpy as np\nimport datetime\n\nimport gc\nimport sys\nimport os","fac45131":"### \n# train = pd.read_csv('..\/input\/train.csv')\nhist = pd.read_csv('..\/input\/historical_transactions.csv')\n# new = pd.read_csv('..\/input\/new_merchant_transactions.csv')\n# merchant = pd.read_csv('..\/input\/merchants.csv')","8f1c5dc5":"agg_func = {\n        'purchase_amount': ['sum'],\n        'installments':['sum']\n        }\n    \nagg_history = hist.groupby(['card_id','month_lag']).agg(agg_func)\nagg_history.columns = ['_'.join(col).strip() for col in agg_history.columns.values]\nagg_history.reset_index(inplace=True)","8c2aecca":"tmp = agg_history.loc[agg_history['month_lag'] == 0]\ntmp = tmp[['card_id']].reset_index(drop = True)\n\nfor i in range(-13,-1):\n    LAG = agg_history.loc[agg_history['month_lag'] == i ]\n    lag = agg_history.loc[agg_history['month_lag'] == i+2]\n    \n    LAG = LAG.merge(lag,how = 'left',on = 'card_id')\n    \n    LAG['ratio_month_lag_purchase_amount'+'_'+str(i)+'_'+str(i+2)] = LAG['purchase_amount_sum_y']\/LAG['purchase_amount_sum_x']\n#     LAG['ratio_month_lag_installments'+'_'+str(i)+'_'+str(i+2)] = LAG['installments_sum_y']\/LAG['installments_sum_x']\n    \n    LAG = LAG[['card_id','ratio_month_lag_purchase_amount'+'_'+str(i)+'_'+str(i+2)]]\n    \n    tmp = tmp.merge(LAG,on = \"card_id\",how = \"left\")","af0e3100":"tmp['average_increase_rate_by_2months'] = tmp.iloc[:,1:].sum(axis = 1)","c0398d41":"tmp.to_csv(\"monthly_rate.csv\",index=False)","7bc510a2":"These features are inspired from raddar findings and suggestions: https:\/\/www.kaggle.com\/raddar\/target-true-meaning-revealed\n\nIt helped me improve my CV and LB by 0.002; hope it helps you too.\nI have taken two months gap since it is given in data dictionary that target is \"Loyalty numerical score calculated 2 months after historical and evaluation period\""}}