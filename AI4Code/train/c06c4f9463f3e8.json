{"cell_type":{"081f8eea":"code","f3369fb7":"code","7b103c9b":"code","63b1a413":"code","a28540da":"code","b06d150e":"code","5fd1838b":"code","ab5b4330":"code","ab231ccb":"code","1cb4aa7c":"code","6b68fea9":"code","b2ce3ce7":"code","b739d958":"code","414409e4":"code","cf56fbb7":"code","8f4623fb":"code","ddf78342":"code","eb3a01d7":"code","bf88e7ae":"code","2d659978":"code","c05956fe":"code","4878f20f":"code","496c6512":"code","5d409de5":"code","af0be117":"code","6c2f1fbf":"code","81c110ac":"code","f5ee35fd":"code","a5cd672a":"code","7acc8e1f":"code","a1542fba":"code","2b404b56":"code","ae28300f":"code","eddb218b":"code","2033e627":"code","9d84881b":"code","8c4f90e2":"code","ff5631bd":"markdown","f4de093d":"markdown","3ffd11a8":"markdown","712c301a":"markdown","a44cb751":"markdown","33310efa":"markdown","31830950":"markdown","bd21588d":"markdown","53625b6f":"markdown","81cfed73":"markdown","1aae3f38":"markdown","d611f04a":"markdown","f7e5ae6a":"markdown","478683ea":"markdown","43be160e":"markdown","47fc4a0f":"markdown","267201c7":"markdown","d7c976ef":"markdown","1fe5f945":"markdown"},"source":{"081f8eea":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport catboost\nfrom catboost import CatBoostRegressor, Pool\nfrom sklearn.model_selection import train_test_split\nimport seaborn as sns\nimport shap\nfrom scipy.constants import golden\nimport matplotlib.pyplot as plt\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn.ensemble import RandomForestRegressor\n\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session\nshap.initjs()\nnp.random.seed(42)","f3369fb7":"df = pd.read_csv('\/kaggle\/input\/graduate-admissions\/Admission_Predict_Ver1.1.csv')","7b103c9b":"print(df.head()); print(df.columns)","63b1a413":"df.head()","a28540da":"# left skewed distribution. raise your standard university!","b06d150e":"sns.distplot(df['Chance of Admit '], hist=False)","5fd1838b":"y = df['Chance of Admit ']\ndf = df.drop('Chance of Admit ', axis=1)","ab5b4330":"df.describe(); df.isnull().sum()","ab231ccb":"df.dtypes","1cb4aa7c":"m = CatBoostRegressor(iterations=1000, silent=True)","6b68fea9":"valid_idx = 400","b2ce3ce7":"X_train, y_train, X_valid, y_valid = df[:valid_idx], y[:valid_idx], df[valid_idx:], y[valid_idx:]","b739d958":"train_pool, validate_pool = Pool(X_train, y_train), Pool(X_valid, y_valid)","414409e4":"m.fit(train_pool, eval_set=validate_pool, plot=True, logging_level='Silent')","cf56fbb7":"# create series feature importance\nimp = pd.Series(m.feature_importances_, index=df.columns).sort_values()","8f4623fb":"# apparently university rating is pretty unimportant. You'd expect the best universities to have better admission rates.","ddf78342":"plt.figure(figsize=(10, 10\/golden), dpi=144)\nsns.barplot(imp, imp.index)","eb3a01d7":"plot = pd.concat([X_train, y], axis=1)\nsns.lineplot('University Rating', 'Chance of Admit ', data=plot)","bf88e7ae":"sns.heatmap(X_train.corr())","2d659978":"m = CatBoostRegressor(iterations=1000, silent=True, ignored_features=['University Rating'])\nm.fit(train_pool, eval_set=validate_pool, plot=True)","c05956fe":"def feature_importance(model):\n    \"\"\"Return feature importance of catboost model and plot it.\"\"\"\n    imp = pd.Series(model.feature_importances_, index=df.columns).sort_values()\n    plt.figure(figsize=(10, 10 \/ golden), dpi=144)\n    sns.barplot(imp, imp.index)\n    return imp","4878f20f":"imp = feature_importance(m)","496c6512":"explainer = shap.TreeExplainer(m)\nshap_values = explainer.shap_values(X_train)","5d409de5":"shap.force_plot(explainer.expected_value, shap_values[2,:], X_train.iloc[2,:])","af0be117":"plt.axvline(8, 0, 0.68, color='red')\nsns.distplot(plot['CGPA'], hist=False)","6c2f1fbf":"sns.regplot('CGPA', 'Chance of Admit ', data=plot,lowess=True)","81c110ac":"sns.regplot('Serial No.', 'Chance of Admit ', data=plot, lowess=True)","f5ee35fd":"m = CatBoostRegressor(iterations=1000, silent=True, ignored_features=['University Rating', 'Serial No.'])\nm.fit(train_pool, eval_set=validate_pool, plot=True)","a5cd672a":"imp = feature_importance(m)","7acc8e1f":"m = CatBoostRegressor(iterations=1000, silent=True)\nm.fit(train_pool, eval_set=validate_pool, plot=True)","a1542fba":"shap.dependence_plot(\"Serial No.\", shap_values, X_train, interaction_index=None)","2b404b56":"shap.dependence_plot(\"CGPA\", shap_values, X_train, interaction_index=None)","ae28300f":"shap.summary_plot(shap_values, X_train)","eddb218b":"m = CatBoostRegressor(iterations=1000, silent=True, ignored_features=['University Rating'])\nm.fit(train_pool, eval_set=validate_pool, plot=True)","2033e627":"explainer.shap_interaction_values(X_train)","9d84881b":"y_pred = m.predict(X_valid)\nround(mean_squared_error(y_valid, y_pred, squared=False), 4)","8c4f90e2":"shap.__version__","ff5631bd":"That's surprising. You'd expect the best universities to have worse admission rates. Let's see if that's the case.","f4de093d":"Hmmm. Lower serial nos have a big negative impact on admission. Serial no. is definitely not random.","3ffd11a8":"Dropping serial no. increased validation rmse.","712c301a":"Almost linear relationship with CGP","a44cb751":"# TO-DO\n* tune model\n* investigate interactions\n* figure out what is going on with serial no.\n* save model without university rating instead of training it again","33310efa":"It doesn't look too related with admission. however, it's weird there's a lump in the middle. There's probably a latent variable involved. Maybe low serial numbers are people who applied first, and later serial\nnumbers people who applied late.","31830950":"let's add back all features","bd21588d":"CGPA had a big effect on the first sample. serial no. had some impact. You would expect that serial number would be unpredictive. It must be proxying some sort of hidden variable. Perhaps date?","53625b6f":"8 is a below average gpa which makes sense that it would have a negative impact on the student's predicted admission.","81cfed73":"University rating is highly correlated with other variables in the dataset. So, let's drop it.","1aae3f38":"That improved validation rmse amazingly. Hooray.","d611f04a":"* Unsuprisingly CGPA shows the largest variance in model impact. High values increase admission rate and low values decrease admission rate.\n* Seems low serial numbers have a chance of lower admission rate. Maybe it's people applying early and to a lot of universities because their expectation of getting in is low. Worth investigating whover put this data together.\n* TOEFL score is proportional to admission rate. If you have research experience you're slightly more likely to get it.\n* Having a good SOP helps, and a letter of recommentation helps.\n* All else equal, university rating doesn't impact admission rate so I will exclude it from final model. This explains why dropping it slightly improved validation metric.","f7e5ae6a":"It didn't change order of feature importance. I say include it and let it remain a mystery. Lol.","478683ea":"didn't change feature importance a huge amount. some features traded places. However, let's keep it dropped so we can interpret the results, we can add it back later for slightly better predictive power.","43be160e":"Hmm. It it's not the case. The best universities admit the most. Lol. Maybe it's because they're the largest. Anyway, the fact that it isn't an important variable must mean that there are other variables picking up its signal.","47fc4a0f":"trained shap model to interpret the model","267201c7":"no missing values","d7c976ef":"Linear relationship between CGPA and admission. Not surprising!","1fe5f945":"all numeric features"}}