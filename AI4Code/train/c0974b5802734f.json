{"cell_type":{"169885cd":"code","d3f5b8b7":"code","fd1d5f85":"code","023d46fb":"code","0389a3e2":"code","90563620":"code","6927784b":"code","20d0afd7":"code","1020fc4d":"code","988d508a":"code","07540c47":"code","f5b735ff":"code","2cb3c921":"code","52546688":"code","de908d2f":"code","2514e8be":"code","23eb4e90":"code","b78f44c9":"code","c5395aea":"code","0ef60e3a":"code","d52b4b25":"code","fcb38317":"code","3afbf700":"code","2e2bb7b3":"code","1de486c7":"code","cc56f677":"code","398f843c":"code","983ef009":"code","f81ce48b":"code","7b62e43a":"code","29b523a9":"code","8a8858d5":"code","dbd0165c":"markdown","e60fdea8":"markdown","9ca45523":"markdown","6e89c1fb":"markdown","6cff947e":"markdown"},"source":{"169885cd":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","d3f5b8b7":"# Importando a base\ndf_cardio = pd.read_csv('\/kaggle\/input\/cardiovascular-disease-dataset\/cardio_train.csv', sep=';')\n\ndf_cardio.shape","fd1d5f85":"# Visualizando os dados\ndf_cardio.head()","023d46fb":"# Altura minima\ndf_cardio['height'].min()","0389a3e2":"# Altura maxima\ndf_cardio['height'].max()","90563620":"# Tipos e tamanhos\ndf_cardio.info()","6927784b":"# Selecionando as colunas para treinamento\nfeats = [c for c in df_cardio.columns if c not in ['id', 'cardio']]\n\nfeats","20d0afd7":"# Separando o dataframe\nfrom sklearn.model_selection import train_test_split\n\ntrain, test = train_test_split(df_cardio, random_state = 42, test_size=0.1)\n\ntrain, valid = train_test_split(train, random_state = 42, test_size=0.1)\n\ntrain.shape, valid.shape, test.shape","1020fc4d":"# Treinando um modelo de RF Classifier\nfrom sklearn.ensemble import RandomForestClassifier\n\nrf = RandomForestClassifier(n_estimators=200, n_jobs=-1, random_state=42)\n\nrf.fit(train[feats], train['cardio'])","988d508a":"# Fazendo previs\u00f5es com o modelo treinado na base de valida\u00e7\u00e3o\npreds_val = rf.predict(valid[feats])\n\npreds_val","07540c47":"# Visualizando os 3 primeiros registros da base de valida\u00e7\u00e3o\nvalid.head(3)","f5b735ff":"# Visualizando os 3 \u00faltimos registros da base de valida\u00e7\u00e3o\nvalid.tail(3)","2cb3c921":"# Verificando o desempenho de acordo com a m\u00e9trica - base de valida\u00e7\u00e3o\nfrom sklearn.metrics import accuracy_score\n\naccuracy_score(valid['cardio'], preds_val)","52546688":"# Vamos verificar qual o valor de base para a coluna target da base de valida\u00e7\u00e3o\nvalid['cardio'].value_counts(normalize=True)","de908d2f":"# Fazendo previs\u00f5es com o modelo treinado na base de teste\npreds_test = rf.predict(test[feats])\n\npreds_test","2514e8be":"# Verificando o desempenho de acordo com a m\u00e9trica - base de teste\naccuracy_score(test['cardio'], preds_test)","23eb4e90":"# Dividindo novamente os dados apenas em treino e teste\ntrain, test = train_test_split(df_cardio, random_state = 42, test_size=0.1)\n\ntrain.shape, test.shape","b78f44c9":"# Criando um modelo de RF Classifier e usando o Cross Validation\nrf = RandomForestClassifier(n_estimators=200, n_jobs=-1, random_state=42)\n\nfrom sklearn.model_selection import cross_val_score\n\nscores = cross_val_score(rf, train[feats], train['cardio'], cv=5, n_jobs=-1)\n\nscores","c5395aea":"# M\u00e9dia dos scores de valida\u00e7\u00e3o\nscores.mean()","0ef60e3a":"# Criando um modelo de RF Classifier e usando o Cross Validation\nrf2 = RandomForestClassifier(n_estimators=200, n_jobs=-1, random_state=42, max_depth=8)\n\nscores2 = cross_val_score(rf2, train[feats], train['cardio'], cv=5, n_jobs=-1)\n\n# M\u00e9dias dos scores de valida\u00e7\u00e3o\nscores2.mean()","d52b4b25":"# Criando um modelo de RF Classifier e usando o Cross Validation\nrf3 = RandomForestClassifier(n_estimators=200, n_jobs=-1, random_state=42, max_depth=12)\n\nscores3 = cross_val_score(rf3, train[feats], train['cardio'], cv=5, n_jobs=-1)\n\n# M\u00e9dias dos scores de valida\u00e7\u00e3o\nscores3.mean()","fcb38317":"# Treinamento e fazendo previs\u00f5es\nrf.fit(train[feats], train['cardio'])\n\npreds_test = rf.predict(test[feats])\n\naccuracy_score(test['cardio'], preds_test)","3afbf700":"# Treinamento e fazendo previs\u00f5es RF2\nrf2.fit(train[feats], train['cardio'])\n\npreds_test = rf2.predict(test[feats])\n\naccuracy_score(test['cardio'], preds_test)","2e2bb7b3":"# Treinamento e fazendo previs\u00f5es RF3\nrf3.fit(train[feats], train['cardio'])\n\npreds_test = rf3.predict(test[feats])\n\naccuracy_score(test['cardio'], preds_test)","1de486c7":"# Criando um modelo de RF Classifier e usando o Cross Validation com cv=10\nrf4 = RandomForestClassifier(n_estimators=200, n_jobs=-1, random_state=42, max_depth=12)\n\nscores4 = cross_val_score(rf4, train[feats], train['cardio'], cv=10, n_jobs=-1)\n\n# M\u00e9dias dos scores de valida\u00e7\u00e3o\nscores4.mean()","cc56f677":"# Treinamento e fazendo previs\u00f5es RF4\nrf4.fit(train[feats], train['cardio'])\n\npreds_test = rf4.predict(test[feats])\n\naccuracy_score(test['cardio'], preds_test)","398f843c":"# Dividindo novamente os dados apenas em treino e teste\ntrain, test = train_test_split(df_cardio, random_state = 42, test_size=0.1)\n\ntrain.shape, test.shape","983ef009":"# Treinando um modelo de RF Classifier usando oob_score\nrf = RandomForestClassifier(n_estimators=200, n_jobs=-1, random_state=42, oob_score=True)\n\nrf.fit(train[feats], train['cardio'])","f81ce48b":"# Fazendo previs\u00f5es com o modelo treinado na base de teste\npreds_test = rf.predict(test[feats])\n\naccuracy_score(test['cardio'], preds_test)","7b62e43a":"# OOB Score e max_depth=12\nrf5 = RandomForestClassifier(n_estimators=200, n_jobs=-1, random_state=42, max_depth=12, oob_score=True)\nrf5.fit(train[feats], train['cardio'])\n\n# Fazendo previs\u00f5es com o modelo treinado na base de teste\npreds_test = rf5.predict(test[feats])\n\naccuracy_score(test['cardio'], preds_test)","29b523a9":"# Treinando um modelo de RF Classifier\nrf = RandomForestClassifier(n_estimators=200, n_jobs=-1, random_state=42, oob_score=True,\n                           min_samples_leaf=5, min_samples_split=20, max_depth=12)\n\nrf.fit(train[feats], train['cardio'])","8a8858d5":"# Fazendo previs\u00f5es com o modelo treinado na base de teste\npreds_test = rf.predict(test[feats])\n\naccuracy_score(test['cardio'], preds_test)","dbd0165c":"## Doen\u00e7as cardiovasculares - Modelo de classifica\u00e7\u00e3o bin\u00e1ria","e60fdea8":"## Cross Validation\nConjunto de t\u00e9cnicas que usam os pr\u00f3prios dados de treinamento para realizar a valida\u00e7\u00e3o do modelo.\n\nComo o modelo deve ser validado com dados que n\u00e3o foram usados durante o treinamento, s\u00e3o aplicadas t\u00e9cnicas espec\u00edficas para separar alguns dados de treino e com eles realizar a valida\u00e7\u00e3o.\n\nA vantagem \u00e9 n\u00e3o precisar dividir nossos dados de treino em conjuntos de treino e valida\u00e7\u00e3o, j\u00e1 que a valida\u00e7\u00e3o vai ser feita pelo Cross Validation. Isso \u00e9 extremamente \u00fatil principalmente em conjunto de dados pequenos, onde a separa\u00e7\u00e3o em treino e valida\u00e7\u00e3o pode reduzir muito o tamanho do conjunto de dados de treinamento e com isso comprometer o desempenho do modelo.\n\nUm exemplo de t\u00e9cnica \u00e9 o KFold, que divide os dados de treino em k itera\u00e7\u00f5es e para cada itera\u00e7\u00e3o uma amostra dos dados de treino \u00e9 separada para fazer valida\u00e7\u00e3o.\n\n\n![Cross](https:\/\/scikit-learn.org\/stable\/_images\/grid_search_cross_validation.png)\n","9ca45523":"## OOB - Out Of Bag\nInicialmente precisamos lembrar como funciona o modelo de random forest: s\u00e3o criadas diversas \u00e1rvores de decis\u00e3o que recebem amostras dos dados originais. Essas amostras s\u00e3o criadas de forma aleat\u00f3ria, com repeti\u00e7\u00e3o.\n\n![random](https:\/\/miro.medium.com\/max\/1050\/1*ixvrbH45K8CcNZaj98JGuA.png)\n\n\u00c9 f\u00e1cil notar que, em cada \u00e1rvore criada, alguns dados foram usados e outros n\u00e3o. Ou seja, para cada \u00e1rvore, alguns dados entraram na cesta de dados de treinamento, enquanto outros ficaram fora da cesta de treinamento (out of bag).\n\n![oob](https:\/\/miro.medium.com\/max\/1043\/1*_J-O7FJ99a3Zehb3eUlqcg.png)\n\nPara cada \u00e1rvore existe uma parte do conjunto de dados que aquela \u00e1rvore nunca viu, aqueles que ficaram fora da cesta de treinamento daquela \u00e1rvore. Ent\u00e3o, podemos usar esses dados nunca vistos pela \u00e1rvore para fazer a valida\u00e7\u00e3o da pr\u00f3pria \u00e1rvore, uma vez que precisamos de dados n\u00e3o usados no treinamento para realizarmos a valida\u00e7\u00e3o.\n\nPara usar o conceito de OOB e determinar que o modelo deve ser validado com o dados que ele mesmo deixou de fora do treinamento de cada \u00e1rvore, basta usar o par\u00e2metro **oob_score = True** no momento de instanciar o modelo de Randon Forest.\n\nMais uma vez, esse artif\u00edcio \u00e9 de grande valia para bases pequenas, pois n\u00e3o precisamos criar uma base de dados de valida\u00e7\u00e3o, mas apenas usar para valida\u00e7\u00e3o os dados que o pr\u00f3prio modelo descartou.\n","6e89c1fb":"# IESB - CIA035 - Aula 03 - Cross Validation e OOB","6cff947e":"## Melhorando os par\u00e2metros do modelo Random Forest"}}