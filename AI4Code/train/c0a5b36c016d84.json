{"cell_type":{"2b695b0c":"code","e1e48bc9":"code","a7d43663":"code","80a724a7":"code","568d4d83":"code","fb90318a":"code","55a6b11d":"code","d111098b":"code","9db1b8fe":"code","785c2fd9":"code","c080a503":"code","924a4b65":"code","286515a9":"code","770f657e":"code","79f910c9":"code","be334117":"code","14ad6370":"markdown","73141a25":"markdown","cb5bfd5e":"markdown","14d7f737":"markdown","2d6e0297":"markdown","0193cdb8":"markdown"},"source":{"2b695b0c":"from fastai.vision import *\nfrom fastai.metrics import error_rate","e1e48bc9":"path = \"..\/input\"\nSEED = 42\nsz = 124\nbs = 64\ntest_df = pd.read_csv(f\"{path}\/sample_submission.csv\")\nsub_df = pd.read_csv(f\"{path}\/sample_submission.csv\")","a7d43663":"data = ImageDataBunch.from_folder(path, valid_pct=0.1, ds_tfms=get_transforms(), size=sz, bs=bs, seed=SEED).normalize(imagenet_stats)\ndata.add_test(ImageList.from_df(test_df, path, folder=\"test\/test\"))","80a724a7":"#Showing Images\ndata.show_batch(rows=3, figsize=(5,5))","568d4d83":"learn = cnn_learner(data, models.resnet34, metrics=[accuracy],model_dir=\"\/tmp\/model\/\")","fb90318a":"# Plotting to find the ideal learning rate\nlearn.lr_find()\nlearn.recorder.plot()","55a6b11d":"lr=1e-1\/2","d111098b":"learn.fit_one_cycle(3, slice(lr))","9db1b8fe":"# Saving the model\nlearn.save('stage1')","785c2fd9":"data = ImageDataBunch.from_folder(path, train=\".\", \n                                  valid_pct=0.2,\n                                  ds_tfms=get_transforms(),\n                                  size=224,bs=64, \n                                  num_workers=0).normalize(imagenet_stats)","c080a503":"learn.lr_find()\nlearn.recorder.plot()","924a4b65":"lr = 1e-3\/3","286515a9":"learn.fit_one_cycle(2, slice(lr))","770f657e":"test_probs, _ = learn.get_preds(ds_type=DatasetType.Test)\ntest_preds = [data.classes[pred] for pred in np.argmax(test_probs.numpy(), axis=-1)]","79f910c9":"sub_df = pd.read_csv(f\"{path}\/sample_submission.csv\")\nsub_df.predicted_class = test_preds\nsub_df.to_csv(\"submission.csv\", index=False)","be334117":"sub_df.head()","14ad6370":"## Loading data\n\nWe will be reducing Image size=124px at first and start training at first. THis makes training our neural nets whole lot faster","73141a25":"## Generate predictions","cb5bfd5e":"## Training The Model","14d7f737":"## Importing Libraries","2d6e0297":"## Retraining the last layers\n\nThis technique of training model with the original size is mentioned in @jeremyhowards [fastai Lecture3](https:\/\/course.fast.ai\/videos\/?lesson=3). This gives us a \nbetter neural net whcih can be trained at less time and is more accurate always :)","0193cdb8":"# fin."}}