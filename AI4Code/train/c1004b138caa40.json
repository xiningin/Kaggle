{"cell_type":{"5722dde2":"code","07e6d946":"code","b09752b0":"code","552a7fad":"code","79f3c2dc":"code","708bfb82":"code","64b8cee7":"code","4cfc4177":"code","5e4fc531":"code","95100ce2":"code","6aee505a":"code","888ff2c5":"code","63e00bd5":"code","f9d3dd12":"code","aa7bac2c":"code","6cb6f737":"code","5a6f186c":"code","4abfd5ec":"code","4d7c0cc5":"code","8abc42dc":"code","ee587335":"code","fdb747de":"code","4c6328d4":"code","6adeacf0":"code","9ccdea76":"code","c74fc9cc":"code","16b843d5":"code","af1d572c":"code","4d3729d5":"code","91399aef":"code","84b7ef0e":"code","4c8359af":"code","356dc26d":"code","af0b2ac7":"code","a87fc6e2":"code","20439caa":"code","bcaef8a2":"code","f24d9ee1":"code","f31a5bbd":"code","02a8f627":"code","38f88d29":"code","7a05ffbb":"code","82b686ac":"code","99e0c4ae":"code","2801a35a":"code","23cf92e7":"code","7d1c691b":"code","5fda2361":"code","bfe6e894":"code","c2e4c4a9":"code","27c1d756":"code","16753d07":"code","e5559f6a":"code","73c338be":"code","e61ff7b4":"code","e003687f":"markdown","feb9db97":"markdown","ad6650e6":"markdown","88a4e20a":"markdown"},"source":{"5722dde2":"!pip install pytextrank","07e6d946":"import numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport re\n\nfrom collections import Counter\nfrom wordcloud import WordCloud, ImageColorGenerator\nfrom urllib.request import urlopen\nfrom PIL import Image\n\n\nfrom tqdm import tqdm\nimport string\nimport matplotlib.pyplot as plt\nfrom sklearn.decomposition import NMF, LatentDirichletAllocation, TruncatedSVD\nfrom sklearn.feature_extraction.text import CountVectorizer\nfrom sklearn.manifold import TSNE\nimport concurrent.futures\nimport time\nimport pyLDAvis.sklearn\nfrom pylab import bone, pcolor, colorbar, plot, show, rcParams, savefig\n\n\n# Plotly based imports for visualization\nimport plotly.express as px\ndata = px.data.gapminder()\nfrom plotly.subplots import make_subplots\nfrom plotly import tools\nfrom plotly.offline import init_notebook_mode, iplot\ninit_notebook_mode(connected=True)\nimport plotly.graph_objs as go\nimport plotly.figure_factory as ff\n\n\nfrom nltk.corpus import stopwords\nfrom nltk.util import ngrams\nimport nltk\nstop=stopwords.words('english')\n\n# spaCy based imports\nimport spacy\nfrom spacy.lang.en.stop_words import STOP_WORDS\nfrom spacy.lang.en import English\nnlp = spacy.load(\"en_core_web_lg\")\nimport pytextrank\ntr = pytextrank.TextRank()\nnlp.add_pipe(tr.PipelineComponent, name='textrank', last=True)\nimport networkx as nx\n\nimport warnings\nwarnings.filterwarnings('ignore')","b09752b0":"df = pd.read_csv('..\/input\/paatal-lok-imdb-reviewcsv\/Paatal Lok IMDB Review.csv')\n#df.Rating = df.Rating.apply(lambda x: \"Rating \" + str(x))\ndf.sample(5)","552a7fad":"df.info()","79f3c2dc":"rating_dist = df.groupby(['Rating']).size().reset_index(name = 'Number Of Ratings')\nrating_dist['Rating Percentage'] = (rating_dist['Number Of Ratings']\/df.shape[0])*100\n\nfig = px.bar(rating_dist, x ='Rating', y = 'Rating Percentage',\n              title= 'User Rating Distribution',\n             color = 'Rating Percentage',\n             height=400, width=800) #color = 'Rating Percentage'\nfig.show()","708bfb82":"#Mean of word length distribution\n#x1 = df[df['Rating']==1]['Review Text'].str.split().apply(lambda x : [len(i) for i in x])\n#x1 = x1.map(lambda x: np.mean(x))\n#fig = go.Figure(data=[go.Histogram(x=x1)])\n#fig.show()","64b8cee7":"df['Review Length'] = df['Review Text'].str.split().apply(lambda x: len(x))\nfig = px.box(df, x=\"Rating\", y=\"Review Length\", title=\"Review Lengths\")\nfig.show()","4cfc4177":"review_length = df.groupby(['Rating']).agg({'Review Length' : ['mean', np.median,'max', 'min']})\nreview_length.columns = review_length.columns.droplevel(0)\nreview_length = review_length.reset_index()","5e4fc531":"fig = go.Figure()\nfig.add_trace(go.Scatter(x=review_length['Rating'], y=review_length['mean'],\n                    mode='lines+markers',\n                    name='Mean'))\nfig.add_trace(go.Scatter(x=review_length['Rating'], y=review_length['median'],\n                    mode='lines+markers',\n                    name='Standard deviation'))\nfig.add_trace(go.Scatter(x=review_length['Rating'], y=review_length['max'],\n                    mode='lines+markers',\n                    name='Max'))\nfig.add_trace(go.Scatter(x=review_length['Rating'], y=review_length['min'],\n                    mode='lines+markers',\n                    name='Min'))\nfig.show()","95100ce2":"fig = go.Figure(data=[\n    go.Bar(name='Mean', x=review_length['Rating'], y=review_length['mean']),\n    go.Bar(name='Median', x=review_length['Rating'], y=review_length['median']),\n    go.Bar(name='Minimum', x=review_length['Rating'], y=review_length['min'],marker_color='rgb(55, 83, 109)'),\n    go.Bar(name='Maximum', x=review_length['Rating'], y=review_length['max'],marker_color='rgb(26, 118, 255)')\n])\n# Change the bar mode\nfig.update_layout(barmode='group', title=\"Reviews Length Distribution\",\n    xaxis_title=\"Rating\",\n    yaxis_title=\"Number of Words\")\nfig.show()","6aee505a":"#https:\/\/help.imdb.com\/article\/imdb\/track-movies-tv\/what-does-it-mean-if-i-found-a-user-review-helpful-or-not\/G4YY5P5XP2KJ349M?ref_=helpart_nav_16#\ndef helpfull_percenage(helpfull):\n    a = helpfull.strip('found this helpful').split(\" \")\n    st = int(a[0].replace(\",\",\"\"))\n    ed = int(''.join(a[-1:]).replace(\",\",\"\"))\n    try:\n        return (st\/ed)*100\n    except:\n        return 0\n\nHelpfull_Percentage = df.Helpfullness.apply(helpfull_percenage)\ndf.insert(loc=2, column='Helpfull Percentage', value=Helpfull_Percentage)","888ff2c5":"avg_helpfull_percentage_by_rating = df.groupby(['Rating']).agg({'Helpfull Percentage':'mean','Review Length':'mean'}).reset_index()","63e00bd5":"fig = px.bar(avg_helpfull_percentage_by_rating, x='Rating', y='Helpfull Percentage',orientation='v',\n              title= 'Mean Of Helpfull Percentage By Rating',\n             labels = {'Rating':'Ratings'},\n             height=400, width = 700) #color = 'Helpfull Percentage',\nfig.show()","f9d3dd12":"fig = go.Figure()\nfig.add_trace(\n    go.Bar(\n        x=avg_helpfull_percentage_by_rating['Rating'],\n        y=avg_helpfull_percentage_by_rating['Helpfull Percentage'],\n        \n    ))\n\nfig.add_trace(\n    go.Scatter(\n        x=avg_helpfull_percentage_by_rating['Rating'],\n        y=avg_helpfull_percentage_by_rating['Review Length']\n    ))\nfig.update_layout(title=\"Reviews Length Distribution\",\n    xaxis_title=\"Rating\",\n    yaxis_title=\"Helpfull Percentage\")\nfig.show()","aa7bac2c":"fig = px.scatter_3d(avg_helpfull_percentage_by_rating, x='Rating', z='Helpfull Percentage', y='Review Length')\nfig.show()","6cb6f737":"def remove_URL(text):\n    url = re.compile(r'https?:\/\/\\S+|www\\.\\S+')\n    return url.sub(r'',text)","5a6f186c":"def remove_html(text):\n    html=re.compile(r'<.*?>')\n    return html.sub(r'',text)","4abfd5ec":"def remove_emoji(text):\n    emoji_pattern = re.compile(\"[\"\n                           u\"\\U0001F600-\\U0001F64F\"  # emoticons\n                           u\"\\U0001F300-\\U0001F5FF\"  # symbols & pictographs\n                           u\"\\U0001F680-\\U0001F6FF\"  # transport & map symbols\n                           u\"\\U0001F1E0-\\U0001F1FF\"  # flags (iOS)\n                           u\"\\U00002702-\\U000027B0\"\n                           u\"\\U000024C2-\\U0001F251\"\n                           \"]+\", flags=re.UNICODE)\n    return emoji_pattern.sub(r'', text)\n\nremove_emoji(\"Omg another Earthquake \ud83d\ude14\ud83d\ude14\")","4d7c0cc5":"def remove_punct(text):\n    table=str.maketrans('','',string.punctuation)\n    return text.translate(table)\n\nexample=\"I am a #king\"\nprint(remove_punct(example))","8abc42dc":"def clean_text(text):\n    text = re.sub(\"[^a-zA-Z ]\", \"\", text)\n    text = text.lower() # lower case the text\n    text = nltk.word_tokenize(text)\n    return text","ee587335":"def remove_stop_words(text):\n    return [word for word in text if word not in stop]","fdb747de":"def stem_words(text):\n    try:\n        text = [stemmer.stem(word) for word in text]\n        text = [word for word in text if len(word) > 1] # make sure we have no 1 letter words\n    except : # the word \"oed\" broke this, so needed try except\n        pass\n    return \" \".join(text)","4c6328d4":"df['Cleaned Text'] = df['Review Text'].apply(remove_URL).apply(remove_html).apply(remove_emoji).\\\n                        apply(remove_punct).apply(clean_text).apply(remove_stop_words).apply(stem_words)","6adeacf0":"df['Review Text'].apply(remove_URL).apply(remove_html).apply(remove_emoji).\\\n                        apply(remove_punct).apply(clean_text).apply(remove_stop_words).apply(stem_words)[0]","9ccdea76":"df['Title Cleaned Text'] = df['Review Title'].apply(remove_URL).apply(remove_html).apply(remove_emoji).\\\n                        apply(remove_punct).apply(clean_text).apply(remove_stop_words).apply(stem_words)","c74fc9cc":"def most_common_words(df,col_name,rating,word_num=10):\n    review_title_rating = []\n    for title in df[col_name][df['Rating'] == rating]:\n        review_title_rating.extend(title.split())\n    review_title_rating = [title.lower() for title in review_title_rating if title not in spacy.lang.en.stop_words.STOP_WORDS]\n    review_title_rating = Counter(review_title_rating)\n    most_common_words = review_title_rating.most_common(word_num)\n    words = pd.DataFrame(most_common_words, columns=['Words', 'Count'])\n    return words","16b843d5":"review_title_rating_10 = most_common_words(df,'Title Cleaned Text',10)\nreview_title_rating_1 = most_common_words(df,'Title Cleaned Text',1)","af1d572c":"fig = make_subplots(\n    rows=1, cols=2,\n    subplot_titles=(\"Rating 10\", \"Rating 1\"))\nfig.add_trace(go.Bar(x=review_title_rating_10['Words'], y=review_title_rating_10['Count']),\n              row=1, col=1)\nfig.add_trace(go.Bar(x=review_title_rating_1['Words'], y=review_title_rating_1['Count']),\n              row=1, col=2)\n\nfig.update_layout(height=400, width=1000,showlegend=False,\n                  title_text=\"Top 10 words on Review Ttitle\")\n\nfig.show()","4d3729d5":"def get_top_review_bigrams(corpus, n=None):\n    vec = CountVectorizer(ngram_range=(2, 2)).fit(corpus)\n    bag_of_words = vec.transform(corpus)\n    sum_words = bag_of_words.sum(axis=0) \n    words_freq = [(word, sum_words[0, idx]) for word, idx in vec.vocabulary_.items()]\n    words_freq =sorted(words_freq, key = lambda x: x[1], reverse=True)\n    top_bigram = pd.DataFrame(words_freq, columns=('Bigram', 'Counts'))\n    return top_bigram.head(n)","91399aef":"fig = make_subplots(\n    rows=2, cols=2,\n    subplot_titles=(\"Rating 1\", \"Rating 2\", \"Rating 9\", \"Rating 10\"))\n\nrating_1 = get_top_review_bigrams(df['Cleaned Text'][df['Rating'] ==1], 10)\nfig.add_trace(go.Bar(x=rating_1['Bigram'], y=rating_1['Counts']),\n              row=1, col=1)\n\nrating_2 = get_top_review_bigrams(df['Cleaned Text'][df['Rating'] ==2], 10)\nfig.add_trace(go.Bar(x=rating_2['Bigram'], y=rating_2['Counts']),\n              row=1, col=2)\n\nrating_9 = get_top_review_bigrams(df['Cleaned Text'][df['Rating'] ==9], 10)\nfig.add_trace(go.Bar(x=rating_9['Bigram'], y=rating_9['Counts']),\n              row=2, col=1)\n\nrating_10 = get_top_review_bigrams(df['Cleaned Text'][df['Rating'] ==10], 10)\nfig.add_trace(go.Bar(x=rating_10['Bigram'], y=rating_10['Counts']),\n              row=2, col=2)\n\nfig.update_layout(height=600, width=1000,showlegend=False,\n                  title_text=\"Top 10 Bigram on Ratings\")\n\nfig.show()","84b7ef0e":"Review_Text = df['Review Text'][df['Rating'] == 1].sample().reset_index()['Review Text'][0]\ndoc = nlp(Review_Text)\nfor p in doc._.phrases:\n    print('{:.4f} {:5d}  {}'.format(p.rank, p.count, p.text))\n    print(p.chunks)","4c8359af":"def textrank(review):\n    doc = nlp(review)\n    last_index = len(doc._.phrases)\n    if last_index > 5:\n        last_index = 5\n    ranked_words = []    \n    for p in doc._.phrases[0:last_index]:\n        ranked_words.append(p)\n    #ranked_words = ranked_words  \n    return ranked_words\n\ndf['Review Text Rank'] = df['Cleaned Text'].apply(textrank)","356dc26d":"Review_Text = df['Review Text'][df['Rating'] == 1].sample().reset_index()['Review Text'][0]\nprint(Review_Text)\ntextrank(Review_Text)","af0b2ac7":"def increment_edge (graph, node0, node1):\n    #print(\"link {} {}\".format(node0, node1))\n    \n    if graph.has_edge(node0, node1):\n        graph[node0][node1][\"weight\"] += 1.0\n    else:\n        graph.add_edge(node0, node1, weight=1.0)","a87fc6e2":"POS_KEPT = [\"ADJ\", \"NOUN\", \"PROPN\", \"VERB\"]\n\ndef link_sentence (doc, sent, lemma_graph, seen_lemma):\n    visited_tokens = []\n    visited_nodes = []\n\n    for i in range(sent.start, sent.end):\n        token = doc[i]\n\n        if token.pos_ in POS_KEPT:\n            key = (token.lemma_, token.pos_)\n\n            if key not in seen_lemma:\n                seen_lemma[key] = set([token.i])\n            else:\n                seen_lemma[key].add(token.i)\n\n            node_id = list(seen_lemma.keys()).index(key)\n\n            if not node_id in lemma_graph:\n                lemma_graph.add_node(node_id)\n\n            #print(\"visit {} {}\".format(visited_tokens, visited_nodes))\n            #print(\"range {}\".format(list(range(len(visited_tokens) - 1, -1, -1))))\n            \n            for prev_token in range(len(visited_tokens) - 1, -1, -1):\n                #print(\"prev_tok {} {}\".format(prev_token, (token.i - visited_tokens[prev_token])))\n                \n                if (token.i - visited_tokens[prev_token]) <= 3:\n                    increment_edge(lemma_graph, node_id, visited_nodes[prev_token])\n                else:\n                    break\n                    \n                    \n\n            #print(\" -- {} {} {} {} {} {}\".format(token.i, token.text, token.lemma_, token.pos_, visited_tokens, visited_nodes))\n\n            visited_tokens.append(token.i)\n            visited_nodes.append(node_id)","20439caa":"doc = nlp(df['Cleaned Text'][df['Rating'] == 1].sample().reset_index()['Cleaned Text'][0])\n\nlemma_graph = nx.Graph()\nseen_lemma = {}\n\nfor sent in doc.sents:\n    link_sentence(doc, sent, lemma_graph, seen_lemma)\n    #break # only test one sentence\n    \nlabels = {}\nkeys = list(seen_lemma.keys())\n\nfor i in range(len(seen_lemma)):\n    labels[i] = keys[i][0].lower()","bcaef8a2":"fig = plt.figure(figsize=(9,9))\npos = nx.spring_layout(lemma_graph)\n\nnx.draw(lemma_graph, pos=pos, with_labels=False, font_weight=\"bold\")\nnx.draw_networkx_labels(lemma_graph, pos, labels)\nplt.show()","f24d9ee1":"img = Image.open('..\/input\/patal-lok-image-5\/pl-1.jpg')\ncustom_mask = np.array(img)\nreview_title_rating_1 = [words.lower() for words in df['Cleaned Text'][df['Rating'] == 1] if words not in spacy.lang.en.stop_words.STOP_WORDS]\nwc = WordCloud(background_color=\"black\",   max_font_size= 400, contour_width=0, contour_color='firebrick', mask = custom_mask)\nwc.generate(','.join(review_title_rating_1))\nplt.figure(figsize=(40,20))\nimage_colors = ImageColorGenerator(custom_mask)\nplt.imshow(wc, interpolation='bilinear')\nplt.title(\"Wordcloud Of Rating 1\", fontsize=24)\nplt.axis(\"off\")\nplt.show()","f31a5bbd":"img = Image.open('..\/input\/patal-lok-image-5\/pl-1.jpg')\ncustom_mask = np.array(img)\nreview_title_rating_10 = [words.lower() for words in df['Cleaned Text'][df['Rating'] == 10] if words not in spacy.lang.en.stop_words.STOP_WORDS]\nwc = WordCloud(background_color=\"black\",   max_font_size= 400, contour_width=0, contour_color='firebrick', mask = custom_mask)\nwc.generate(','.join(review_title_rating_10))\nplt.figure(figsize=(40,20))\nimage_colors = ImageColorGenerator(custom_mask)\nplt.imshow(wc, interpolation='bilinear')\nplt.axis(\"off\")\nplt.title(\"Wordcloud Of Rating 10\", fontsize=24)\nplt.show()","02a8f627":"for i in df['Review Text'][df['Rating'] == 1].head(3):\n    spacy.displacy.render(nlp(i), style='ent',jupyter=True)","38f88d29":"punctuations = string.punctuation\nstopwords = list(STOP_WORDS)","7a05ffbb":"for j in df['Review Text'][df['Rating'] == 1].head(3):\n    review = str(\" \".join([i.lemma_ for i in nlp(j)]))\n    doc = nlp(review)\n    spacy.displacy.render(doc, style='ent',jupyter=True)","82b686ac":"# POS tagging\nfor i in nlp(df['Review Text'][1]):\n    print(i,\"=>\",i.pos_)","99e0c4ae":"parser = English()\ndef spacy_tokenizer(sentence):\n    mytokens = parser(sentence)\n    mytokens = [ word.lemma_.lower().strip() if word.lemma_ != \"-PRON-\" else word.lower_ for word in mytokens ]\n    mytokens = [ word for word in mytokens if word not in stopwords and word not in punctuations ]\n    mytokens = \" \".join([i for i in mytokens])\n    return mytokens","2801a35a":"tqdm.pandas()\ndf[\"processed_review\"] = df[\"Review Text\"].progress_apply(spacy_tokenizer)","23cf92e7":"# Creating a vectorizer\nvectorizer = CountVectorizer(min_df=5, max_df=0.9, stop_words='english', lowercase=True, token_pattern='[a-zA-Z\\-][a-zA-Z\\-]{2,}')\ndata_vectorized = vectorizer.fit_transform(df[\"processed_review\"][df['Rating'] == 10])","7d1c691b":"NUM_TOPICS = 5","5fda2361":"# Latent Dirichlet Allocation Model\nlda = LatentDirichletAllocation(n_components=NUM_TOPICS, max_iter=10, learning_method='online',verbose=True)\ndata_lda = lda.fit_transform(data_vectorized)","bfe6e894":"# Non-Negative Matrix Factorization Model\nnmf = NMF(n_components=NUM_TOPICS)\ndata_nmf = nmf.fit_transform(data_vectorized) ","c2e4c4a9":"# Latent Semantic Indexing Model using Truncated SVD\nlsi = TruncatedSVD(n_components=NUM_TOPICS)\ndata_lsi = lsi.fit_transform(data_vectorized)","27c1d756":"# Functions for printing keywords for each topic\ndef selected_topics(model, vectorizer, top_n=10):\n    for idx, topic in enumerate(model.components_):\n        print(\"Topic %d:\" % (idx))\n        print([(vectorizer.get_feature_names()[i], topic[i]) for i in topic.argsort()[:-top_n - 1:-1]]) ","16753d07":"# Keywords for topics clustered by Latent Dirichlet Allocation\nprint(\"LDA Model:\")\nselected_topics(lda, vectorizer)","e5559f6a":"# Keywords for topics clustered by Latent Semantic Indexing\nprint(\"NMF Model:\")\nselected_topics(nmf, vectorizer)","73c338be":"# Keywords for topics clustered by Non-Negative Matrix Factorization\nprint(\"LSI Model:\")\nselected_topics(lsi, vectorizer)","e61ff7b4":"pyLDAvis.enable_notebook()\ndash = pyLDAvis.sklearn.prepare(lda, data_vectorized, vectorizer, mds='tsne')\ndash","e003687f":"## Named Entity Recognition\nNamed Entity Recognition is an information extraction task where named entities in unstructured sentences are located and classified in some pre-defined categories such as the person names, organizations, locations, medical codes, time expressions, quantities, monetary values, percentages, etc","feb9db97":"## Parts of Speech tagging\nThis is the process of marking up a word in a text (corpus) as corresponding to a particular part of speech,[1] based on both its definition and its context\u2014i.e., its relationship with adjacent and related words in a phrase, sentence, or paragraph. A simplified form of this is commonly taught to school-age children, in the identification of words as nouns, verbs, adjectives, adverbs, etc.","ad6650e6":"# Ngram analysis\nwe will do a bigram (n=2) analysis over the tweets.Let's check the most common bigrams in tweets.","88a4e20a":"\n**Topic Modeling Of Review**"}}