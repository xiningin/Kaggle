{"cell_type":{"6f8aecba":"code","23360756":"code","ed904c5f":"code","a2cf1095":"code","e2ecae78":"code","1985a500":"code","23d86432":"code","8e62af39":"code","8434def8":"code","3f6a88dc":"code","25b7dfea":"code","237d27f6":"code","e66ecb27":"code","4723defe":"code","f3724607":"code","29cccfd9":"code","9a14f211":"code","55976b62":"code","441aa59a":"code","da04398b":"markdown","95be6ecf":"markdown","1689acd9":"markdown"},"source":{"6f8aecba":"import numpy as np \nimport pandas as pd\nimport tensorflow.keras as tf\nimport tensorflow_addons as tfa\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.decomposition import PCA","23360756":"K_FOLDS = 5","ed904c5f":"train_features = pd.read_csv(\"\/kaggle\/input\/lish-moa\/train_features.csv\")\ntrain_labels = pd.read_csv(\"\/kaggle\/input\/lish-moa\/train_targets_scored.csv\")\ntest_features = pd.read_csv(\"\/kaggle\/input\/lish-moa\/test_features.csv\")","a2cf1095":"df = pd.DataFrame(train_features)\ndl = pd.DataFrame(train_labels)","e2ecae78":"def DataPreProcessing(dataframe):\n    dataframe['cp_type'] = dataframe['cp_type'].map({'trt_cp': 0, 'ctl_vehicle': 1})\n    dataframe['cp_time'] = dataframe['cp_time'].map({ 24: 0, 48: 0.5, 72: 1})\n    dataframe['cp_dose'] = dataframe['cp_dose'].map({'D1': 0, 'D2': 1})","1985a500":"DataPreProcessing(df)","23d86432":"rf = df[df[\"cp_type\"] == 1][\"sig_id\"]\n\ndf = df[~df[\"sig_id\"].isin(rf)]\ndl = dl[~dl[\"sig_id\"].isin(rf)]","8e62af39":"df","8434def8":"dl","3f6a88dc":"df = df.drop([\"sig_id\",\"cp_type\"], axis=1)\ndl = dl.drop([\"sig_id\"], axis=1) #, \"atp-sensitive_potassium_channel_antagonist\",\"erbb2_inhibitor\"], axis=1)","25b7dfea":"data_features = df.values\ndata_labels = dl.values\n\nfold = int(len(data_features) \/ K_FOLDS)","237d27f6":"def NN_Model(model, fold, k, X, y):\n    \n    i = k*fold\n    j = (k+1)*fold\n    \n    v_features = X[i:j]\n    v_labels = y[i:j]\n    \n    X_features = np.delete(X, slice(i,j), axis=0)\n    y_labels = np.delete(y, slice(i,j), axis=0)\n    \n    \n    model.add(tf.layers.BatchNormalization())\n    \n\n    model.add(tfa.layers.WeightNormalization(tf.layers.Dense(876, activation='relu')))\n    model.add(tf.layers.BatchNormalization())\n    model.add(tf.layers.Dropout(0.7))\n\n    \n    model.add(tfa.layers.WeightNormalization(tf.layers.Dense(876, activation='relu')))\n    model.add(tf.layers.BatchNormalization())\n    model.add(tf.layers.Dropout(0.6))\n\n    model.add(tfa.layers.WeightNormalization(tf.layers.Dense(512, activation='relu')))\n    model.add(tf.layers.BatchNormalization())\n\n    \n    model.add(tf.layers.Dense(206, activation='sigmoid'))\n    \n    model.compile(optimizer='adam'\n                  ,loss='binary_crossentropy'\n                 )\n\n    #model.summary()\n\n    res = model.fit(X_features, y_labels, epochs=22, validation_data=(v_features, v_labels))","e66ecb27":"fold","4723defe":"# test\n#model = tf.models.Sequential()\n#NN_Model(model, fold, 0, data_features, data_labels)","f3724607":"model_list = []\n\nfor f in range(0, K_FOLDS):\n    model = tf.models.Sequential()\n    NN_Model(model, fold, f, data_features, data_labels)\n    model_list.append(model)\n    print(\"\")","29cccfd9":"tf = pd.DataFrame(test_features)\nDataPreProcessing(tf)\n\ntest_data_features = tf.drop([\"sig_id\",\"cp_type\"], axis=1).values","9a14f211":"p = model_list[0].predict(test_data_features)\n\nfor f in range(1, K_FOLDS):\n    p += model_list[f].predict(test_data_features)","55976b62":"prediction = p \/ K_FOLDS","441aa59a":"res_set = pd.DataFrame.from_records(prediction)\nres_set.insert(0,'cp_type',test_features['cp_type'])\n\nres_set.loc[res_set['cp_type'] == 1, res_set.columns != \"cp_type\"] = 0\n\nres_set = res_set.drop([\"cp_type\"], axis=1)\nres_set.insert(0,'sig_id',test_features['sig_id'])\n\n#res_set.insert(35,'atp-sensitive_potassium_channel_antagonist',0)\n#res_set.insert(83,'erbb2_inhibitor',0)\n\nres_set.columns = train_labels.columns\n\n#res_set\n\nres_set.to_csv('submission.csv', index=False)","da04398b":"**Samples**","95be6ecf":"# **Preparing a dataset**","1689acd9":"# **Building a model**"}}