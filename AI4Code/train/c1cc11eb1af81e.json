{"cell_type":{"c387ca43":"code","3710d026":"code","b019ed4d":"code","20f33f32":"code","e371ce4b":"code","0d5920c7":"code","5631200f":"code","507c7af6":"code","a7bc5b19":"code","236d9a4b":"code","6c60a2e7":"code","549f106f":"code","a82a9747":"code","31b353f4":"code","7648617b":"code","ece2c270":"code","0420dad1":"code","3d260fce":"code","86bc2625":"code","a952f60a":"code","50df85d3":"code","5832a96c":"code","4cc7fe09":"code","b2d579fb":"code","e2875cee":"code","b79dc5f8":"code","0f5907c4":"code","744d949d":"code","3e484771":"code","11e319c9":"code","b0598f73":"code","033e51ee":"code","182f186e":"code","eef9cdc5":"code","7db274b1":"code","eef6cb0f":"code","6b029d24":"code","55481425":"code","fa5dc22f":"code","ceba9a26":"code","4b50b8ad":"code","8c46938d":"code","910cb55e":"code","e4baae01":"code","6a950b43":"code","2ec434dd":"markdown","9a540416":"markdown","ae004009":"markdown","2eb9134e":"markdown","738515ac":"markdown","4adfbb84":"markdown","cec378c5":"markdown","fcb0ae73":"markdown","8c892a99":"markdown","cbea641f":"markdown","f4fa7e65":"markdown","9847769f":"markdown","5e551d94":"markdown","47b32e46":"markdown","b6ab0717":"markdown","f7b1da34":"markdown","4abedadf":"markdown","fdfe779b":"markdown","f6468a45":"markdown","cff3927e":"markdown","10ecdd2d":"markdown","925021f8":"markdown","27a14083":"markdown"},"source":{"c387ca43":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","3710d026":"import os, sys\nimport matplotlib.pyplot as plt\nimport cv2\nfrom sklearn.model_selection import train_test_split\nfrom PIL import Image\nimport warnings\nwarnings.filterwarnings(\"ignore\")\nIMG_SIZE = 512","b019ed4d":"df_train=pd.read_csv(\"..\/input\/aptos2019-blindness-detection\/train.csv\")\ndf_test=pd.read_csv(\"..\/input\/aptos2019-blindness-detection\/test.csv\")","20f33f32":"df_train.head()","e371ce4b":"x=df_train[\"id_code\"]\ny=df_train[\"diagnosis\"]","0d5920c7":"labels=[\"Train\",\"Test\"]\nsizes=[len(df_train),len(df_test)]\n\nplt.pie(sizes,labels=labels,autopct='%1.1f%%')\nplt.show()","5631200f":"x_train,x_test,y_train,y_test = train_test_split(x,y,test_size=0.15,random_state=42)\nprint(\"x_train shape: \", x_train.shape)\nprint(\"x_test shape: \", x_test.shape)\nprint(\"y_train shape: \", y_train.shape)\nprint(\"y_test shape: \", y_test.shape)","507c7af6":"plt.hist(y_train,label=\"y_train\")\nplt.hist(y_test,label=\"y_test\")\nplt.title(\"Retinopathy Type and number\")\nplt.xlabel(\"0:No DR, 1:Mild, 2:Moderate, 3:Severe, 4:Proliferative DR\")\nplt.ylabel(\"Number\")\nplt.legend()\nplt.show()","a7bc5b19":" %%time\nfig = plt.figure(figsize=(25, 16))\n# display 10 images from each class\nfor i in sorted(y_train.unique()):\n    for j, (idx, row) in enumerate(df_train.loc[df_train['diagnosis'] == i].sample(5, random_state=42).iterrows()):\n        ax = fig.add_subplot(5, 5, i * 5 + j + 1, xticks=[], yticks=[])\n        path=f\"..\/input\/aptos2019-blindness-detection\/train_images\/{row['id_code']}.png\"\n        image = cv2.imread(path)\n        image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n        image = cv2.resize(image, (IMG_SIZE, IMG_SIZE))\n        plt.imshow(image)\n        ax.set_title('Label: %d-%d-%s' % (i, idx, row['id_code']) )\n        \n","236d9a4b":"%%time\nfig=plt.figure(figsize=(25,16))\nfor i in sorted(y_train.unique()):\n    for j ,(idx,row) in enumerate(df_train.loc[df_train[\"diagnosis\"]==i].sample(5,random_state=42).iterrows()):\n        ax = fig.add_subplot(5, 5, i*5+j+1, xticks=[], yticks=[])\n        path=f\"..\/input\/aptos2019-blindness-detection\/train_images\/{row['id_code']}.png\"\n        image = cv2.imread(path)\n        image = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)\n        image = cv2.resize(image, (IMG_SIZE, IMG_SIZE))\n\n        plt.imshow(image)\n        ax.set_title('Label: %d-%d-%s' % (i, idx, row['id_code']) )","6c60a2e7":"%%time\nfig=plt.figure(figsize=(25,16))\nfor i in sorted(y_train.unique()):\n    for j ,(idx,row) in enumerate(df_train.loc[df_train[\"diagnosis\"]==i].sample(5,random_state=42).iterrows()):\n        ax = fig.add_subplot(5, 5, i*5+j+1, xticks=[], yticks=[])\n        path=f\"..\/input\/aptos2019-blindness-detection\/train_images\/{row['id_code']}.png\"\n        image = cv2.imread(path)\n        image = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)\n        image = cv2.resize(image, (IMG_SIZE, IMG_SIZE))\n\n        plt.imshow(image,cmap=\"gray\")\n        ax.set_title('Label: %d-%d-%s' % (i, idx, row['id_code']) )","549f106f":"dpi=80\n\npath=f\"..\/input\/aptos2019-blindness-detection\/train_images\/838c87c63422.png\"\nimage = cv2.imread(path)\nimage=cv2.cvtColor(image,cv2.COLOR_BGR2GRAY)\nheight,width=image.shape\nprint(height,width)\nSCALE=2\nfigsize=(width\/float(dpi))\/SCALE,(height\/float(dpi))\/SCALE\nimage = cv2.resize(image, (IMG_SIZE, IMG_SIZE))\nfig=plt.figure(figsize=figsize)\nplt.imshow(image,cmap=\"gray\")","a82a9747":"fig=plt.figure(figsize=(25,16))\nfor i in sorted(y_train.unique()):\n    for j,(idx,row) in enumerate(df_train.loc[df_train[\"diagnosis\"]==i].sample(5,random_state=42).iterrows()):\n        \n        ax = fig.add_subplot(5, 5, i*5+j+1, xticks=[], yticks=[])\n        path=f\"..\/input\/aptos2019-blindness-detection\/train_images\/{row['id_code']}.png\"\n        image = cv2.imread(path)\n        image = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)\n\n        image = cv2.resize(image, (IMG_SIZE, IMG_SIZE))\n        image=cv2.addWeighted ( image,4, cv2.GaussianBlur( image , (0,0) , IMG_SIZE\/10) ,-4 ,128) \n\n        plt.imshow(image, cmap='gray')\n        ax.set_title('Label: %d-%d-%s' % (i, idx, row['id_code']) )","31b353f4":"def crop_image_from_gray(img,tol=7):\n    if img.ndim ==2:\n        mask = img>tol\n        return img[np.ix_(mask.any(1),mask.any(0))]\n    elif img.ndim==3:\n        gray_img = cv2.cvtColor(img, cv2.COLOR_RGB2GRAY)\n        mask = gray_img>tol\n        \n        check_shape = img[:,:,0][np.ix_(mask.any(1),mask.any(0))].shape[0]\n        if (check_shape == 0): # image is too dark so that we crop out everything,\n            return img # return original image\n        else:\n            img1=img[:,:,0][np.ix_(mask.any(1),mask.any(0))]\n            img2=img[:,:,1][np.ix_(mask.any(1),mask.any(0))]\n            img3=img[:,:,2][np.ix_(mask.any(1),mask.any(0))]\n    #         print(img1.shape,img2.shape,img3.shape)\n            img = np.stack([img1,img2,img3],axis=-1)\n    #         print(img.shape)\n        return img","7648617b":"def load_ben_color(path, sigmaX=10):\n    image = cv2.imread(path)\n    image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n    image = crop_image_from_gray(image)\n    image = cv2.resize(image, (IMG_SIZE, IMG_SIZE))\n    image=cv2.addWeighted ( image,4, cv2.GaussianBlur( image , (0,0) , sigmaX) ,-4 ,128)\n        \n    return image","ece2c270":"NUM_SAMP=7\nfig = plt.figure(figsize=(25, 16))\nfor i in sorted(y_train.unique()):\n    for j, (idx, row) in enumerate(df_train.loc[df_train['diagnosis'] == i].sample(NUM_SAMP, random_state=42).iterrows()):\n        ax = fig.add_subplot(5, NUM_SAMP, i* NUM_SAMP + j + 1, xticks=[], yticks=[])\n        path=f\"..\/input\/aptos2019-blindness-detection\/train_images\/{row['id_code']}.png\"\n        image = load_ben_color(path,sigmaX=30)\n\n        plt.imshow(image)\n        ax.set_title('%d-%d-%s' % (i, idx, row['id_code']) )","0420dad1":"def load_ben_color2(path, sigmaX=10):\n    image = cv2.imread(path)\n    image = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)\n    image = crop_image_from_gray(image)\n    image = cv2.resize(image, (IMG_SIZE, IMG_SIZE))\n  \n        \n    return image","3d260fce":"dpi = 80 #inch\n\npath=f\"..\/input\/aptos2019-blindness-detection\/train_images\/838c87c63422.png\" \nimage = load_ben_color(path,sigmaX=10)\n\nheight, width = IMG_SIZE, IMG_SIZE\nprint(height, width)\n\nSCALE=1\nfigsize = (width \/ float(dpi))\/SCALE, (height \/ float(dpi))\/SCALE\n\nfig = plt.figure(figsize=figsize)\nplt.imshow(image, cmap='gray')\n\ndpi = 80 #inch\n\npath=f\"..\/input\/aptos2019-blindness-detection\/train_images\/838c87c63422.png\" \nimage = load_ben_color2(path,sigmaX=10)\n\nheight, width = IMG_SIZE, IMG_SIZE\nprint(height, width)\n\nSCALE=1\nfigsize = (width \/ float(dpi))\/SCALE, (height \/ float(dpi))\/SCALE\n\nfig = plt.figure(figsize=figsize)\nplt.imshow(image, cmap='gray')\n\n\n","86bc2625":"dpi = 80 #inch\n\npath=f\"..\/input\/aptos2019-blindness-detection\/train_images\/78937523f7a8.png\" \nimage = load_ben_color(path,sigmaX=10)\n\nheight, width = IMG_SIZE, IMG_SIZE\nprint(height, width)\n\nSCALE=1\nfigsize = (width \/ float(dpi))\/SCALE, (height \/ float(dpi))\/SCALE\n\nfig = plt.figure(figsize=figsize)\nplt.imshow(image, cmap='gray')\ndpi = 80 #inch\n\n\npath=f\"..\/input\/aptos2019-blindness-detection\/train_images\/838c87c63422.png\" \nimage = load_ben_color(path,sigmaX=10)\n\nheight, width = IMG_SIZE, IMG_SIZE\nprint(height, width)\n\nSCALE=1\nfigsize = (width \/ float(dpi))\/SCALE, (height \/ float(dpi))\/SCALE\n\nfig = plt.figure(figsize=figsize)\nplt.imshow(image, cmap='gray')\n\n\n","a952f60a":"train=pd.read_csv(\"..\/input\/aptos2019-blindness-detection\/train.csv\")","50df85d3":"train.head()","5832a96c":"patient=train[train[\"diagnosis\"]==4]\nhealt=train[train[\"diagnosis\"]==0]\ntrain_df=pd.concat([patient,healt])","4cc7fe09":"train_df[\"diagnosis\"]=[1 if i==4 else 0 for i in train_df.diagnosis]","b2d579fb":"train_df.shape","e2875cee":"x=train_df.drop(columns=[\"diagnosis\"])\ny=train_df.diagnosis","b79dc5f8":"from sklearn.model_selection import train_test_split\nx_train,x_test,y_train,y_test=train_test_split(x,y,test_size=0.30,random_state=42)","0f5907c4":"dn_x = [ Image.open('..\/input\/aptos2019-blindness-detection\/train_images\/'+i+'.png') for i in x_train.id_code[:5]]","744d949d":"dn_x","3e484771":"for i in dn_x:\n    \n    plt.figure(figsize=(5,3))\n    i = cv2.resize(np.asarray(i),(64,64))\n    i= cv2.cvtColor(i,cv2.COLOR_BGR2GRAY)\n    plt.imshow(i,cmap=\"gray\")\n    plt.axis(\"off\")\n    plt.show","11e319c9":"x_train = [cv2.resize(np.asarray(Image.open('..\/input\/aptos2019-blindness-detection\/train_images\/'+i+'.png').convert(\"L\")),(64,64)) for i in x_train.id_code]","b0598f73":"x_test = [cv2.resize(np.asarray(Image.open('..\/input\/aptos2019-blindness-detection\/train_images\/'+i+'.png').convert(\"L\")),(64,64)) for i in x_test.id_code]","033e51ee":"x_test=np.array(x_test)\nx_test.shape","182f186e":"x_train=np.array(x_train)\nx_train.shape","eef9cdc5":"x_train_flatten=x_train.reshape(x_train.shape[0],x_train.shape[1]*x_train.shape[2])\nx_test_flatten=x_test.reshape(x_test.shape[0],x_test.shape[1]*x_test.shape[2])","7db274b1":"x_train=x_train_flatten.T\ny_train=y_train.T\nx_test=x_test_flatten.T\ny_test=y_test.T\nprint(\"x_train: \",x_train.shape)\nprint(\"x_test: \",x_test.shape)\nprint(\"y_train: \",y_train.shape)\nprint(\"y_test: \",y_test.shape)","eef6cb0f":"y_train=np.array(y_train)\ny_test=np.array(y_test)","6b029d24":"y_train=y_train.reshape(-1,1)\ny_test=y_test.reshape(-1,1)\nprint(\"y_train: \",y_train.shape)\nprint(\"y_test: \",y_test.shape)","55481425":"def initialize_weights_and_bias(dimension):\n    w=np.full((dimension,1),0.01)\n    b=0.0\n    return w,b","fa5dc22f":"def sigmoid(z):\n    # sigmoid function is 1\/(1+e^-z)\n    y_head=1\/(1+np.exp(-z))\n    return y_head","ceba9a26":"def forward_propagation(w,b,x_train,y_train):\n    z=np.dot(w.T,x_train)+b\n    y_head=sigmoid(z)\n    loss=-y_train*np.log(y_head)-(1-y_train)*np.log(1-y_head)\n    cost=(np.sum(loss))\/x_train.shape[1]\n    return cost","4b50b8ad":"def forward_backward_propagation(w,b,x_train,y_train):\n    # forward propagation\n    z=np.dot(w.T,x_train)+b\n    y_head=sigmoid(z)\n    loss=-y_train*np.log(y_head)-(1-y_train)*np.log(1-y_head)\n    cost=(np.sum(loss))\/x_train.shape[1]\n    #backward propagation\n    derivative_weight = (np.dot(x_train,((y_head-y_train).T)))\/x_train.shape[1]\n    derivative_bias=np.sum(y_head-y_train)\/x_train.shape[1]\n    gradients={\"derivative_weight\":derivative_weight,\"derivative_bias\":derivative_bias}\n    return cost,gradients\n    ","8c46938d":"# Updating(learning) parameters\n\ndef update(w,b,x_train,y_train,learning_rate,number_of_iteration):\n    cost_list=[]\n    cost_list2=[]\n    index=[]\n    for i in range(number_of_iteration):\n        cost,gradients=forward_backward_propagation(w,b,x_train,y_train)\n        cost_list.append(cost)\n        w=w-learning_rate*gradients[\"derivative_weight\"]\n        b=b-learning_rate*gradients[\"derivative_bias\"]\n    parameters ={\"weight\":w,\"bias\":b}\n    \n    return parameters,gradients,cost_list","910cb55e":"# prediction\ndef predict(w,b,x_test):\n    z=sigmoid(np.dot(w.T,x_test)+b)\n    Y_prediction=np.zeros((1,x_test.shape[1]))\n    for i in range(z.shape[1]):\n        if z[0,i]<=0.5:\n            Y_prediction[0,i]=0\n        else:\n            Y_prediction[0,i]=1\n    return Y_prediction   \n","e4baae01":"# Logistic regression initialize\ndef logistic_regression(x_train,y_train,x_test,y_test,learning_rate,num_iterations):\n    dimension=x_train.shape[0]\n    w,b=initialize_weights_and_bias(dimension)\n    parameters,gradients,cost_list=update(w,b,x_train,y_train,learning_rate,num_iterations)\n    y_prediction_test=predict(parameters[\"weight\"],parameters[\"bias\"],x_test)\n    y_prediction_train=predict(parameters[\"weight\"],parameters[\"bias\"],x_train)\n    print(\"train accuracy: {} %\".format(100 - np.mean(np.abs(y_prediction_train - y_train)) * 100))\n    print(\"test accuracy: {} %\".format(100 - np.mean(np.abs(y_prediction_test - y_test)) * 100))\nlogistic_regression(x_train, y_train, x_test, y_test,learning_rate = 0.01, num_iterations = 50)","6a950b43":"from sklearn import linear_model\nlogreg = linear_model.LogisticRegression(random_state = 42,max_iter= 150)\nprint(\"test accuracy: {} \".format(logreg.fit(x_train.T, y_train).score(x_test.T, y_test)))","2ec434dd":"* Retinopathy levels of patients","9a540416":"## Scikit Learn with Logistic Regression","ae004009":"## Level 4 Retinopathy Image After Image Processing ","2eb9134e":"# Diabetic Retinopathy Detection with Logistic Regression\n* Logistic regression is the basis of artificial neural networks. Therefore, I will use logistic regression.\n* Logistic regression is a binary classification algorithm.So I'm going to take the illness level 4 and level 0 ones.","738515ac":"# INTRODUCTION\n\n![](https:\/\/tansuerakgun.com\/tr\/wp-content\/uploads\/2017\/08\/diabetik-retina-tedavisi-1.jpg)\n[Picture Source:](https:\/\/tansuerakgun.com\/tr\/wp-content\/uploads\/2017\/08\/diabetik-retina-tedavisi-1.jpg)\n\n The most common cause of blindness due to diabetes is \u201cDiabetic Retinopathy\u201d. Diabetes affects the nerve layer (retina or net layer) of the eye and the capillaries in this layer, disrupting its work and causing vision loss. Retinal disorders due to diabetes are called diabetic retinopathy.\n\n","4adfbb84":"### IMPORT LIBRARY","cec378c5":"* Separation of pictures in the data","fcb0ae73":"### A picture with 4.level retinopathy","8c892a99":"## Sigmoid Function","cbea641f":"## Initialize Parameters","f4fa7e65":"## Comparision of 0.Level and 4.level Diabetic Retinopathy","9847769f":"### 3- Gray Pictures and Sorted Image ","5e551d94":"# Basic Data Analysis","47b32e46":"### 2- Different Colored Pictures and Sorted Image","b6ab0717":"# BEN GRAHAM'S LIGTHING METHOD","f7b1da34":"## Lighting","4abedadf":"## Forward Propagation","fdfe779b":"# IMAGE PROCESSING","f6468a45":"* Train, test data distinction and shows shape","cff3927e":"### 1- Default and Sorted Image","10ecdd2d":"## Basic Data Analysis","925021f8":"### Image Resized (512,512)","27a14083":"## Optimization Algorithm with Gradient Descent"}}