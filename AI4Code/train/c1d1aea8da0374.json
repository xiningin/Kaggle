{"cell_type":{"bf78cb2b":"code","9412f77b":"code","3dfbbd46":"code","bceed725":"code","41b845a9":"code","3ba1e5ee":"code","317ab0eb":"code","e17cb108":"code","20703031":"code","2711c47c":"code","27017cf6":"code","c2b58bb9":"code","c92fdb35":"code","df10a0fa":"code","9d84d0c6":"code","96a93e2c":"code","0a3c193d":"code","2782f3d2":"code","e7933957":"code","995b26d0":"code","1413c120":"code","5f97cf70":"code","4144084f":"code","a245cc4d":"markdown","de7b275a":"markdown","ca1f5cfd":"markdown","e333f6af":"markdown","e9d9cf96":"markdown","a47c2ca7":"markdown","f966da1b":"markdown","56e46744":"markdown","7b15a2fa":"markdown","f94ad923":"markdown","7b3ebadd":"markdown","3cfcbe43":"markdown","7a4932ad":"markdown","e359bbd5":"markdown","989ceae4":"markdown","c8d38b76":"markdown","b3a96d8a":"markdown","cbc838b6":"markdown","73d179ab":"markdown","3711393c":"markdown","d8ab4254":"markdown","c1973bfb":"markdown","810bc2b5":"markdown","b231fe5a":"markdown"},"source":{"bf78cb2b":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom collections import Counter\nfrom itertools import cycle\nfrom string import ascii_lowercase, ascii_uppercase\n\ntrain = pd.read_csv(\"..\/input\/train.csv\")\ntest = pd.read_csv('..\/input\/test.csv')\ntest1 = test[test[\"difficulty\"] == 1].reset_index()\n\nplaintext = train.loc[range(train.shape[0])][\"text\"]\nciphertext1 = test1.loc[list(range(test1.shape[0]))][\"ciphertext\"]","9412f77b":"def letter_frequency_stats(texts):\n    memo = Counter(\"\".join(texts))\n    mstats = pd.DataFrame([[x[0], x[1]] for x in memo.items()], columns=[\"Letter\", \"Frequency\"])\n    return mstats.sort_values(by='Frequency', ascending=False)\n\nplainStats = letter_frequency_stats(plaintext)\ncipherStats = letter_frequency_stats(ciphertext1)\n\nplt.figure(figsize=(24, 6))\n\nplt.subplot(2, 1, 1)\nprint(len(plainStats))\nplot_series = np.array(range(len(plainStats))) + 0.5\nplt.bar(plot_series, plainStats['Frequency'].values)\nplt.xticks(plot_series, plainStats['Letter'].values)\n\nplt.subplot(2, 1, 2)\nprint(len(cipherStats))\nplot_series = np.array(range(len(cipherStats))) + 0.5\nplt.bar(plot_series, cipherStats['Frequency'].values)\nplt.xticks(plot_series, cipherStats['Letter'].values)\n\n# plt.savefig(\"count.png\")\nplt.show()\nplainStatsL = plainStats","3dfbbd46":"def word_frequency_stats(texts):\n    memo = Counter(\" \".join(texts).split(\" \"))\n    mstats = pd.DataFrame([[x[0], x[1]] for x in memo.items() if len(x[0]) > 0], columns=[\"Word\", \"Frequency\"])\n    return mstats.sort_values(by='Frequency', ascending=False)\n\nplainStats = word_frequency_stats(plaintext)\ncipherStats = word_frequency_stats(ciphertext1)\n\nplt.figure(figsize=(24, 6))\n\nplt.subplot(2, 1, 1)\nplot_series = np.array(range(10)) + 0.5\nplt.bar(plot_series, plainStats['Frequency'].values[:10])\nplt.xticks(plot_series, plainStats['Word'].values[:10])\n\nplt.subplot(2, 1, 2)\nplot_series = np.array(range(40)) + 0.5\nplt.bar(plot_series, cipherStats['Frequency'].values[:40])\nplt.xticks(plot_series, cipherStats['Word'].values[:40])\n\n# plt.savefig(\"count.png\")\nplt.show()","bceed725":"{\n    \"the\": [\"flt\", \"ssi\", \"xwd\", \"jgp\"],\n    \"and\": [\"pmo\", \"lrs\", \"yyh\", \"edc\"],\n    \"I\": [\"M\", \"H\", \"T\", \"X\"], # ?!\n    \"to\": [\"xe\", \"fs\", \"aj\", \"jn\"], # might be a bit\n    \"of\": [\"su\", \"nq\", \"ee\", \"sa\"], # messed here\n    \"a\": [\"l\", \"e\", \"p\", \"y\"] # !!! \n}","41b845a9":"def caesar_shift(text, key):\n    def substitute(char, i):\n        if char in ascii_lowercase:\n            char = chr((ord(char) - 97 - ord(key[i]) + 97) % 26 + 97)\n            i = (i + 1) % len(key)\n        if char in ascii_uppercase:\n            char = chr((ord(char) - 65 - ord(key[i]) + 97) % 26 + 65)\n            i = (i + 1) % len(key)\n        return char, i\n    i = 0\n    result = [char for char in text]\n    for j in range(len(result)):\n        result[j], i = substitute(result[j], i)\n    return ''.join(result)\n\nencodedtext = ciphertext1.map(lambda x: caesar_shift(x, 'pyle'))\nencodedtext.values[:20]","3ba1e5ee":"encodedStats = word_frequency_stats(encodedtext)\n\nplt.figure(figsize=(24, 6))\n\nplt.subplot(2, 1, 1)\nplot_series = np.array(range(10)) + 0.5\nplt.bar(plot_series, plainStats['Frequency'].values[:10])\nplt.xticks(plot_series, plainStats['Word'].values[:10])\n\nplt.subplot(2, 1, 2)\nplot_series = np.array(range(40)) + 0.5\nplt.bar(plot_series, encodedStats['Frequency'].values[:40])\nplt.xticks(plot_series, encodedStats['Word'].values[:40])\n\n# plt.savefig(\"count.png\")\nplt.show()","317ab0eb":"{\n    \"a\": [\"a\"], \n    \"the\": [\"uhe\", \"thf\", \"uie\"],\n    \"and\": [\"and\", \"aod\", \"aoe\"],\n    \"I\": [\"I\", \"J\"],\n    \"to\": [\"up\", \"tp\", \"uo\"],\n    \"of\": [\"pf\", \"pg\", \"of\"],\n    \"my\": [\"mz\", \"nz\"],\n    \"in\": [\"io\", \"in\", \"jn\"],\n    \"is\/it\": [\"it\", \"iu\", \"jt\"],\n    \"you\": [\"zpv\", \"zpu\", \"zov\"]\n}","e17cb108":"[x for x in ciphertext1.values if 'AHYK WDYVO U: Iltqpmd sssk ydx bdew wybto apmdf qipq\\'o' in x]","20703031":"print(caesar_shift(\"RUld.B]4:tV79 wTUXjHHxgAHYK WDYVO U: Iltqpmd sssk ydx bdew wybto apmdf qipq'oYVRwT5KnGazYrqKYOdBF4.5\", 'pyle'))\nprint(caesar_shift(\"RUld.B]4:tV79 wTUXjHHxgAHYK WDYVO U: Iltqpmd sssk ydx bdew wybto apmdf qipq'oYVRwT5KnGazYrqKYOdBF4.5\", 'qzmf'))","2711c47c":"''.join((chr((ord(x) - 97) % 26 + 97) for x in caesar_shift('AHYKWDYVOU', 'KINGHENRYV')))","27017cf6":"print(caesar_shift(\"RUld.B]4:tV79 wTUXjHHxgAHYK WDYVO U: Iltqpmd sssk ydx bdew wybto apmdf qipq'oYVRwT5KnGazYrqKYOdBF4.5\", 'qzlepzle'))","c2b58bb9":"[x for x in plaintext.values if 'KING HENRY V: Wherein' in x]","c92fdb35":"key01 = ''.join((chr((ord(x) - 97) % 26 + 97) for x in caesar_shift('AHYKWDYVOUIltqpmdssskydxbdewwybtoapmdfqipqo', 'KINGHENRYVWhereinthouartlesshappybeingfeard')))\nkey01","df10a0fa":"np.array([x for x in (key01 + ' ')]).reshape((-1, 4))","9d84d0c6":"print(''.join((chr((ord(x) - 97) % 26 + 97) for x in caesar_shift('MHTX', 'I')))) # Upper case to lower case transformation magic here\nprint(caesar_shift('flt ssi xwd jgp', 'the'))\nprint(caesar_shift('pmo lrs yyh edc', 'and'))\nprint(caesar_shift('xe fs sa jn', 'to'))\nprint(caesar_shift('su nq ee aj', 'of'))","96a93e2c":"{\n    \"a\": \"pyle\",\n    \"I\": \"pzle\",\n    \"t\": \"qzme\",\n    \"h\": \"pzle\",\n    \"e\": \"pzle\",\n    \"a\": \"pyle\",\n    \"n\": \"qzle\",\n    \"d\": \"pzle\",\n    \"t\": \"qzme\",\n    \"o\": \"qzme\",\n    \"o\": \"qzme\",\n    \"f\": \"pzle\"\n}","0a3c193d":"{\n    \"a\": \"pyle\",\n    \"a\": \"pyle\",\n    \"d\": \"pzle\",\n    \"e\": \"pzle\",\n    \"f\": \"pzle\"\n    \"h\": \"pzle\",\n    \"I\": \"pzle\",\n    \"n\": \"qzle\",\n    \"o\": \"qzme\",\n    \"o\": \"qzme\",\n    \"t\": \"qzme\",\n    \"t\": \"qzme\",\n}","2782f3d2":"print(ord('a') - 97 + ord('y') - 97, ord('b') - 97 + ord('z') - 97)\nprint(ord('n') - 97 + ord('l') - 97, ord('o') - 97 + ord('m') - 97)\nprint(ord('j') - 97 + ord('p') - 97, ord('k') - 97 + ord('q') - 97)\nprint(ord('u') - 97 + ord('e') - 97, ord('v') - 97 + ord('f') - 97)","e7933957":"def caesar_shift_ex(text, key):\n    def substitute(char, i):\n        if char in ascii_lowercase:\n            char = chr((ord(char) - 97 - ord(key[i]) + 97) % 25 + 97)\n            i = (i + 1) % len(key)\n        if char in ascii_uppercase:\n            char = chr((ord(char) - 65 - ord(key[i]) + 97) % 25 + 65)\n            i = (i + 1) % len(key)\n        return char, i\n    i = 0\n    result = [char for char in text]\n    for j in range(len(result)):\n        result[j], i = substitute(result[j], i)\n    return ''.join(result)\n\nencodedtext = ciphertext1.map(lambda x: caesar_shift_ex(x, 'pyle'))\nencodedtext.values[:20]","995b26d0":"encodedtext.values[9]","1413c120":"[x for x in plaintext.values if 'DOMITIUS ENOBARBUS: Had gone to' in x]","5f97cf70":"def caesar_shift_ex2(text, key):\n    def substitute(char, i):\n        if char in ascii_lowercase and char != 'z':\n            char = chr((ord(char) - 97 - ord(key[i]) + 97) % 25 + 97)\n            i = (i + 1) % len(key)\n        if char in ascii_uppercase:\n            char = chr((ord(char) - 65 - ord(key[i]) + 97) % 25 + 65)\n            i = (i + 1) % len(key)\n        return char, i\n    i = 0\n    result = [char for char in text]\n    for j in range(len(result)):\n        result[j], i = substitute(result[j], i)\n    return ''.join(result)\n\nencodedtext = ciphertext1.map(lambda x: caesar_shift_ex2(x, 'pyle'))\nencodedtext.values[:20]","4144084f":"rare_symbols = plainStatsL.loc[plainStatsL[\"Frequency\"] < 100]['Letter'].values\nrare_occurances = [x for x in plaintext if np.any(np.isin(rare_symbols, [y for y in x]))]\nprint(rare_symbols)\nrare_occurances","a245cc4d":"It did! So looks like 'z' was just skipped!\n\nLet's try again:","de7b275a":"A bit of ~~woodoo~~ qzlepzle magic:","ca1f5cfd":"# New Hypotesis\n\nBased on word frequency statistics above, let's try guess cipher key based on other words, not only 'a':","e333f6af":"# Example\nI need to find specific example. After looking at encoded texts, I've chosen one. Let's try to decode it:","e9d9cf96":"Nice! Do you know what it means?\n\nThat ciphered text doesn't produce 'z'! (ord('z') == 25)\n\nLet's get back to letter frequency.\nYou might not have noticed, but now we can see that:\n- 'Z' doesn't appear neither in ciphered nor in plane text!\n- 'z' frequency in ciphered text is way lower than for other lower case letters, and is around those of numbers and special characters.\n\nIt might be that **'z' only appears in randomly generated salt.**\n\n**Well, so what?**\n\nOk, first where 'z' comes from in ciphered text. If cipher is applied only to plain text part, decoding will require finding proper alignment of plain text withing encoded string, which may be problematic.\n\nNext, 26 letters are encoded into 25. Specifically:\n- when key letter is 'y\/z': 'z' and 'a' will be encoded into 'y'\n- when key letter is 'p\/q': 'z' and 'j' will be encoded into 'p'\n- when key letter is 'l\/m': 'z' and 'n' will be encoded into 'l'\n- when key letter is 'e\/f': 'z' and 'u' will be encoded into 'e'\n\nGiving higher overall letter frequencies for letters 'pyle' constituting cipher, which we could also see in letter frequency chart if frequency of 'z' in plain text wouldn't be so extremely low.\n\nAnyway, we need to adjust our decoding function:","a47c2ca7":"Interesting, I can see something like 'KING HENRY V: ', don't you see it?\n\nLet's find possible cipher key:","f966da1b":"Ok, I could play a lot more with it.\n\nBut it seems to be a way to nowhere.\n\nOr...","56e46744":"Nice!\n\nNow we can find cipher key more precisely:","7b15a2fa":"Really interesting! This looks like a pattern, each letter changes to next letter at some point.\n\n- For letter 'a' our cipher uses 'y' while for other letters 'z' is used instead.\n- 'p' is used for letters before 'i', but 'q' used for letters starting from 'n'.\n- Shift from 'l' to 'm' is between letters 'n' and 'o'!\n- 'e' if even replaced by 'f' then only after letter 't'.\n\nWait..","f94ad923":"# A bit of Visualizations\n\nFirst let's load [Competition](https:\/\/www.kaggle.com\/c\/ciphertext-challenge-iii) data.","7b3ebadd":"I had to apply transformation only to alphabetic characters skipping other characters and spaces, and played around letters order in the cipher key (which can be guessed from transformations of the words 'and' and 'the' **;)** ), but still looks messy.\n\nLet's look at the word frequency chart, though:","3cfcbe43":"A bit of alignment...","7a4932ad":"From test data we took only rows with **Difficulty 1**.\n\nLet's get **letter** frequency statistics first.","e359bbd5":"Note, that first letters from words corresponding to \"**a**nd\" also are **\"p\", \"l\", \"y\", \"e\"**!\n\nTime to try Caesar cipher (more precisely **Vigen\u00e8re cipher**):","989ceae4":"Look's like some clues left by competition authors about further difficulty levels.","c8d38b76":"Interesting! Let's see how each individual letter is transformed:","b3a96d8a":"I left some values behind to show the pattern that can be seen here.\nSometimes next letter is taken.\nBut it doesn't seem to happen with \"a\" word alone.\n\nHmm...","cbc838b6":"There is a strong correlation between plain and encoded word frequencies:","73d179ab":"It looks like **we finally did it!**\n\nNow the only step left is to figure out how to use it for submittion and perhaps for cracking next cipher difficulties.\n\n\n*See you in my next kernel, ladies and gentelmen!*\n\nP.S.: What are numbers and special symbols doing in plain data? Let's figureout.","3711393c":"This string was broken in the middle. Probably, next character selection from cipher key failed. But what could go wrong?\n\nMaybe.. Did original string contain 'z'?","d8ab4254":"What do we have in plain data:","c1973bfb":"It seems that cipher doesn't affect spaces frequency. And possibly **doesn't transform spaces at all**.\n\nSo, let's get **word** frequency statistics.","810bc2b5":"Interestingly 'a' was \"merged\" properly, but other words still have variations.\nSpecifically:","b231fe5a":"Which is as simple as **changing modulus from 26 to 25**.\n\nSome were decoded other still look weird which stands for the idea that plain text is only part which is encoded and starts after unknown number of salted...\n\n### Oh, wait..\n\n# WHAT?!!"}}