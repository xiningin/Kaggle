{"cell_type":{"13b48719":"code","45747e8b":"code","25bee5ae":"code","f75ad545":"code","5ff34449":"code","627d64a8":"code","e7b6a002":"code","177d2cc6":"code","ad9a5f20":"code","e07369ce":"code","8923ad03":"code","2691648e":"code","fdabf666":"code","74bedaaf":"code","dbe0fea4":"code","b061d405":"markdown","b4214812":"markdown","4435f44e":"markdown","3a33dc53":"markdown","aa82b984":"markdown","ec561b38":"markdown","6a279694":"markdown","6d15dd78":"markdown"},"source":{"13b48719":"import numpy as np\nimport pandas as pd\nimport os\nimport seaborn as sns\nimport matplotlib.pyplot as plt","45747e8b":"df = pd.read_csv('\/kaggle\/input\/fraud-detection\/fraudTrain.csv',parse_dates=['trans_date_trans_time',])","25bee5ae":"df.columns","f75ad545":"df['hour'] = df.trans_date_trans_time.dt.hour","5ff34449":"df['hourEnc'] = 0\ndf.loc[df.hour < 5,'hourEnc'] = 1\ndf.loc[df.hour > 21,'hourEnc'] = 1","627d64a8":"# Extract frequencies of transactions in last 1\/7\/30 days\ndef last1DayTransactionCount(x):\n    temp = pd.Series(x.index, index = x.trans_date_trans_time, name='count_1_day').sort_index()\n    count_1_day = temp.rolling('1d').count() - 1\n    count_1_day.index = temp.values\n    x['count_1_day'] = count_1_day.reindex(x.index)\n    return x\ndef last7DaysTransactionCount(x):\n    temp = pd.Series(x.index, index = x.trans_date_trans_time, name='count_7_days').sort_index()\n    count_7_days = temp.rolling('7d').count() - 1\n    count_7_days.index = temp.values\n    x['count_7_days'] = count_7_days.reindex(x.index)\n    return x\ndef last30DaysTransactionCount(x):\n    temp = pd.Series(x.index, index = x.trans_date_trans_time, name='count_30_days').sort_index()\n    count_30_days = temp.rolling('30d').count() - 1\n    count_30_days.index = temp.values\n    x['count_30_days'] = count_30_days.reindex(x.index)\n    return x","e7b6a002":"df1 = df.groupby('cc_num').apply(last1DayTransactionCount)","177d2cc6":"df1 = df1.groupby('cc_num').apply(last7DaysTransactionCount)","ad9a5f20":"df1 = df1.groupby('cc_num').apply(last30DaysTransactionCount)","e07369ce":"def timeDifference(x):\n    x['time_diff'] = x.trans_date_trans_time - x.trans_date_trans_time.shift()\n    return x","8923ad03":"df1 = df1.groupby('cc_num').apply(timeDifference)","2691648e":"df1['time_diff'] = df1['time_diff'].dt.seconds","fdabf666":"fig, ax = plt.subplots(figsize=(20,10))\nsns.heatmap(df.corr(),annot=True).set_title('Correlation heatmap without generated features')","74bedaaf":"fig, ax = plt.subplots(figsize=(20,10))\nsns.heatmap(df1.corr(),annot=True).set_title('Correlation heatmap with generated features')","dbe0fea4":"df1.corr()['is_fraud'].abs().sort_values(ascending=False)","b061d405":"# is_fraud correlation\n\nAs you can see from the following correlation series, amount, normal\/abnormal hour, count_30_days, count_7_days, time_diff, hour are important contributors","b4214812":"## Add hour feature\n\nHere, first, we simply extract the hour. Then, we encode transactions done in normal hours 0500-2100 as normal (0) and transactions done in abnormal hours 2100-0500 as abnormal (1)","4435f44e":"# Display correlation heatmaps","3a33dc53":"# Add Features","aa82b984":"## Add times since last transaction - time_diff","ec561b38":"Fin.","6a279694":"## Add frequencies of transactions\n\nNow, we need to generate frequencies of transactions done in last 1\/7\/30 days. For this, we use pandas rolling function","6d15dd78":"# Credit Card Transaction Fraud Detection Dataset EDA\n\nIn this notebook, we explore the dataset to determine the important attributes that influence our dependent variable - is_fraud\n\nis_fraud = 1 indicates fraudulent transaction\n         = 0 indicates non-fraudulent transaction\n\nWe need to generate new features. From intuition, we can generate the following new features:\n* We can say that the hour of the day could be an influential factor. There is a higher chance that fraud transactions might be occuring during odd hours. So, we'll extract the hour.\n* Now, having extracted the hour, we can further encode it. Say, if the transaction is between 21:00-05:00, there is a higher chance it might be fraudulent.\n* We can also say that the frequency of the transaction can be an influential factor. For example, if the number of transactions in last 1\/7\/30 days suddenly increases, it might indicate a fraudulent transaction"}}