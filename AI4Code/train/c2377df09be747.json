{"cell_type":{"c6aba2aa":"code","8db277ff":"code","22deb32f":"code","3423fedb":"code","937bb579":"code","9cbf19e2":"code","4a15a1fa":"code","6afd24dd":"code","85cbbb2a":"code","ebae434c":"code","7ec81c48":"code","0760f839":"code","c25b1e0d":"code","3127beac":"code","96b8f33e":"code","e85fe529":"code","96e8a0ce":"code","dd7b095c":"code","2571037e":"code","6594732a":"code","5bcceeb7":"code","a9f0ec80":"code","a0c9aa9d":"code","78bb95b1":"code","e30ae4d5":"code","2cc723e5":"code","68f84634":"code","3574d65b":"code","0bb851a7":"code","dc09375f":"code","609de3f3":"code","92a00bb9":"code","4f6b7307":"code","1b9a06b2":"code","91fc86cf":"code","28246790":"markdown","f736bced":"markdown","1f63d747":"markdown","e81af7d3":"markdown","8f2cbe3f":"markdown","8e5fbc26":"markdown","ef2c8723":"markdown","22c6ca8a":"markdown","c4c8fa7c":"markdown","cdf1ceb4":"markdown","c6b27652":"markdown","aefebc41":"markdown","0d6da0a0":"markdown","4efeff80":"markdown","7477ca75":"markdown","fbf2b7e5":"markdown","c58d768c":"markdown","6ee71d32":"markdown","c9bc380a":"markdown","6806214a":"markdown","ea08cbd1":"markdown","b32c2818":"markdown","b94310ba":"markdown","beae584b":"markdown","8fde1e91":"markdown","e43ba998":"markdown","629951a1":"markdown","5e37d2e0":"markdown","25edf69a":"markdown","6fe4b971":"markdown","4c1c8025":"markdown","423efa5a":"markdown","0deb2a22":"markdown","aacbbde0":"markdown","4c078d36":"markdown","25f3faa4":"markdown","fa813ed1":"markdown"},"source":{"c6aba2aa":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","8db277ff":"#Reading the data file\ndf = pd.read_csv('\/kaggle\/input\/airline-passenger-satisfaction\/train.csv')\ndf.head()","22deb32f":"def data_explore(dataframe):\n    print(\"DATA EXPLORATION\")\n    print('*'*70)\n    print(\"Shape of dataset : \",dataframe.shape)\n    print('*'*70)\n    print(dataframe.info())\n    print('*'*70)\n    print(\"STATISTICAL ANALYSIS OF NUMERICAL DATA\")\n    print('*'*70)\n    print(dataframe.describe().T)\n    print('*'*70)\n    print(\"STATISTICAL ANALYSIS OF CATEGORICAL DATA\")\n    print('*'*70)\n    print(dataframe.describe(exclude = ['float', 'int64']).T)\n    print('*'*70)\n    print(\"MISSING VALUES\")\n    print('*'*70)\n    print(dataframe.isna().sum().sort_values(ascending=False))\n    print('*'*70)\n    print(\"MISSING VALUES IN %\")\n    print('*'*70)\n    print(round(100* (dataframe.isnull().sum() \/ len(dataframe)).sort_values(ascending=False),2))\n    print('*'*70)","3423fedb":"data_explore(df)","937bb579":"df.drop(['Unnamed: 0','id'], axis=1, inplace=True)","9cbf19e2":"cat_features = [feature for feature in df.columns if df[feature].dtypes == 'O']\nprint('Number of categorical variables: ', len(cat_features))\nprint('*'*80)\nprint('Categorical variables column name:',cat_features)","4a15a1fa":"numerical_features = [feature for feature in df.columns if df[feature].dtypes != 'O']\nprint('Number of numerical variables: ', len(numerical_features))\nprint('*'*80)\nprint('Numerical Variables Column: ',numerical_features)","6afd24dd":"for col in cat_features[:-1]:\n    plt.figure(figsize=(6,3), dpi=100)\n    sns.countplot(data=df,x=col,hue ='satisfaction',palette='gist_rainbow_r')\n    plt.legend(loc=(1.05,0.5))","85cbbb2a":"def get_insights(data):\n    for cols in cat_features[:-1]:\n        cat_group = data.groupby(cols)['satisfaction'].describe()\n        percent = 100 *(cat_group['freq']\/cat_group['count'])\n        print('*'*70)\n        print(\"Insights from '{}' data\".format(cols))\n        print('*'*70)\n        for i in range(0,(len(cat_group))):\n            print('{} from {} are {}'.format(round(percent[i],2),percent.index[i], cat_group['top'][i]))\n        print('*'*70)","ebae434c":"get_insights(df)","7ec81c48":"#Creating a heatmap of the correlation values\nsns.heatmap(df.corr())","0760f839":"#Plotting the barplot of numerical features\nfor col in numerical_features:\n    plt.figure(figsize=(6,3), dpi=100)\n    sns.barplot(data=df,x='satisfaction',y=col,palette='gist_rainbow_r')","c25b1e0d":"#Dropping age, gender and gate location\ndf.drop(['Age','Gender','Gate location'], axis=1, inplace=True)","3127beac":"df.groupby('satisfaction')['Arrival Delay in Minutes'].mean()","96b8f33e":"plt.figure(figsize=(10,5), dpi=100)\nsns.scatterplot(data=df,x='Arrival Delay in Minutes',y='Departure Delay in Minutes',hue='satisfaction',palette='gist_rainbow_r', alpha=0.8)","e85fe529":"plt.figure(figsize=(10,5), dpi=100)\nsns.scatterplot(data=df,x='Flight Distance',y='Departure Delay in Minutes',hue='satisfaction',palette='gist_rainbow_r', alpha=0.8)\nplt.ylim(0,1000)","96e8a0ce":"df.groupby('Class').mean()","dd7b095c":"#Creating a copy of the dataset, before we delete the NA values and substitute\ndf_copy=df.copy()","2571037e":"df_na = df[df['Arrival Delay in Minutes'].isna()] #The dataset with null values\ndf_copy.dropna(inplace=True) #Dropping the missing rows from copied dataset\ndf_na['Arrival Delay in Minutes']=df_na['Departure Delay in Minutes'] #Replacing the null dataset with Arrival delay\ndf_copyna = pd.concat([df_copy,df_na]) #Creating a new dataframe by combining both\ndf = df_copyna #Copying the values to original df","6594732a":"df.isna().sum()","5bcceeb7":"#Let's try plotting the new values\nsns.scatterplot(data=df_na, x='Arrival Delay in Minutes', y='Departure Delay in Minutes')","a9f0ec80":"#Mapping the values\ndf['satisfaction'] = df['satisfaction'].map({'neutral or dissatisfied':0 , 'satisfied':1})\ndf['Customer Type'] = df['Customer Type'].map({'Loyal Customer':1, 'disloyal Customer':0})\ndf['Type of Travel'] = df['Type of Travel'].map({'Personal Travel':0, 'Business travel':1})","a0c9aa9d":"#Transforming the dataframe with mapped values\ndf=pd.get_dummies(df)","78bb95b1":"#Checking the data\ndf.head()","e30ae4d5":"#Preparing X and Y\nX = df.drop('satisfaction', axis=1)\ny = df['satisfaction']","2cc723e5":"#Importing our ML toolkit\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.metrics import accuracy_score, plot_confusion_matrix,classification_report\nfrom sklearn.svm import SVC\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.tree import DecisionTreeClassifier\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.ensemble import AdaBoostClassifier\nfrom sklearn.ensemble import GradientBoostingClassifier\nfrom xgboost import XGBClassifier, plot_importance\nfrom sklearn.model_selection import GridSearchCV, cross_val_score, StratifiedKFold, learning_curve","68f84634":"#Train-Test Split\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)","3574d65b":"#Scaling the features with pipeline method, and standard scaler\npipeline = Pipeline([\n            ('std_scaler',StandardScaler()),\n                    ])\nscaled_X_train = pipeline.fit_transform(X_train)\nscaled_X_test = pipeline.transform(X_test)","0bb851a7":"kfold = StratifiedKFold(n_splits=10)","dc09375f":"# Modeling step to test differents algorithms \nrandom_state = 2\nclassifiers = []\nclassifiers.append(LogisticRegression(random_state = random_state))\nclassifiers.append(KNeighborsClassifier())\nclassifiers.append(SVC(random_state=random_state))\nclassifiers.append(DecisionTreeClassifier(random_state=random_state))\nclassifiers.append(AdaBoostClassifier(DecisionTreeClassifier(random_state=random_state),random_state=random_state,learning_rate=0.1))\nclassifiers.append(RandomForestClassifier(random_state=random_state))\nclassifiers.append(GradientBoostingClassifier(random_state=random_state))\nclassifiers.append(XGBClassifier(random_state=random_state))\n\ncv_results = []\nfor classifier in classifiers :\n    cv_results.append(cross_val_score(classifier, scaled_X_train, y = y_train, scoring = \"accuracy\", cv = kfold, n_jobs=4))\n\ncv_means = []\ncv_std = []\nfor cv_result in cv_results:\n    cv_means.append(cv_result.mean())\n    cv_std.append(cv_result.std())\n\ncv_res = pd.DataFrame({\"CrossValMeans\":cv_means,\"CrossValerrors\": cv_std,\"Algorithm\":[\"LogisticRegression\",\"KNeighbors\",\"SVC\",\"DecisionTree\",\"AdaBoost\",\n\"RandomForest\",\"GradientBoosting\",\"XGBoost\"]})\n\ng = sns.barplot(\"CrossValMeans\",\"Algorithm\",data = cv_res, palette=\"Set3\",orient = \"h\",**{'xerr':cv_std})\ng.set_xlabel(\"Mean Accuracy\")\ng = g.set_title(\"Cross validation scores\")","609de3f3":"#Fitting the model to calculate accuracy\nmodel_xgb = XGBClassifier(random_state =random_state)\nmodel_xgb.fit(scaled_X_train,y_train)","92a00bb9":"#Predicting and calculating accuracy score\npred_xgb = model_xgb.predict(scaled_X_test)\naccuracy_score(y_test,pred_xgb)","4f6b7307":"plot_confusion_matrix(model_xgb,scaled_X_test,y_test)","1b9a06b2":"print(classification_report(y_test,pred_xgb))","91fc86cf":"orig_feature_names = X_train.columns\nfeature_important = model_xgb.get_booster().get_score(importance_type='weight')\nkeys = list(feature_important.keys())\nvalues = list(feature_important.values())\n\ndata = pd.DataFrame(data=values, index=keys, columns=[\"score\"]).sort_values(by = \"score\")#, ascending=False)\nax =data.plot(kind='barh', figsize = (20,10))\nax.set_yticklabels(orig_feature_names); ## plot top features\n#ax.set_xlabel(\"F-Score\")\nax.set(xlabel=\"F-Score\", ylabel=\"y label\")\nax.set_title('Feature Importance')","28246790":"<span style=\"color:#A12288;\"><span style=\"font-size:18px;\"><b>Visualizing Numerical Features<\/b>","f736bced":"<span style=\"color:#A12288;\"><span style=\"font-size:18px;\"><b>Visualizing Categorical Features<\/b>","1f63d747":"> <span style=\"font-size:16px;\">  <b>So, the people from business class have given higher ratings for all the services provided, compared to Eco and Eco plus. Hence 'class' of travel should be a big factor in satisfaction","e81af7d3":"# <center> <span style=\"color:#A12288;\"><span style=\"font-size:22px;\"><b>EXPLORE THE DATA<\/b>","8f2cbe3f":"# <h><center> <span style=\"color:#A12288;\"><span style=\"font-size:22px;\"><b>BACKGROUND","8e5fbc26":"> <span style=\"font-size:16px;\">  <b>Now we have handled the missing data!","ef2c8723":"> <span style=\"font-size:16px;\">  <b>We get an accuracy score of 96%","22c6ca8a":"> <span style=\"font-size:16px;\">  <b>Generally, business class seems to have been satisfied more than the passengers from economy or economy plus, let's analyze that","c4c8fa7c":"> <span style=\"font-size:16px;\">  <b>We have 310 missing values in 'Arrival delay', which is not quiet big, in terms of the data point we have, however, we'd not drop these values. And also we'd not settle with a strategy to calculate the mean, and fill in the missing values. We'd try something different here","cdf1ceb4":"# <center> <span style=\"color:#A12288;\"><span style=\"font-size:22px;\"><b>PROBLEM STATEMENT<\/b>","c6b27652":"> <span style=\"font-size:16px;\">  <b> Some observations about the data:\n  >*    > <span style=\"font-size:16px;\">  <b>The average delay in flights are 15 minutes, with a deviation of 38\n     >*    > <span style=\"font-size:16px;\">  <b>Median of the delays are 0, which means 50% of the flights from this data, were not delayed\n  >*    > <span style=\"font-size:16px;\">  <b>The count of Female passengers are more with 52727 !!","aefebc41":"> <span style=\"font-size:16px;\">  <b>Let us focus now on the most important factor, we discussed ealier, which is the flight delays. Let us do an analysis of the delays, and it's relation with the satisfaction","0d6da0a0":"# <center> <span style=\"color:#A12288;\"><span style=\"font-size:22px;\"><b>BUILDING THE MODEL","4efeff80":"> <span style=\"font-size:16px;\">  <b>The most important takeaway here is the longer the flight distance, most passengers are okay with a slight delay in departure, which is a strange finding from this plot! So departure delay is less of a factor for a long distance flight, comparitively, however, short distance travellers does not seem to be excited about the departure delays, which also makes sense","7477ca75":"> <span style=\"font-size:16px;\">  <b>Now comes the most exciting part of building a model wiwth our data, and let's do some predictions, and most importantly find out the features that stand out","fbf2b7e5":"> <span style=\"font-size:16px;\">  <b>We will map the binary variables with 0 and 1, and we will use the get_dummies method for the remaining variables","c58d768c":"> <span style=\"font-size:16px;\">  <b>Let us dive deep into the data to check if the data here agrees with our preliminary analysis of the possible factors","6ee71d32":"# <center> <span style=\"color:#A12288;\"><span style=\"font-size:22px;\"><b>MISSING VALUES<\/b>","c9bc380a":"> <span style=\"font-size:16px;\">  <b>The problem statement is to identify the key factors which lead to the satisfaction of the customer, and before diving into the data, thinking intuitively and being an avid traveller myself, from my experience, the main factors should be:\n >*    > <span style=\"font-size:16px;\">  <b>Delays in the flight<\/b>\n >*   > <span style=\"font-size:16px;\">   <b>Staff efficiency to address customer needs<\/b>\n >*  > <span style=\"font-size:16px;\">   <b>Services provided in the flight<\/b><\/span>","6806214a":"> <span style=\"font-size:16px;\">  <b>The arrival and departure delay seems to have a linear relationship, which makes complete sense! And well, there is 1 customer who was satisfied even after a delay of 1300 minutes!!","ea08cbd1":"> <span style=\"font-size:16px;\">  <b>Now, let us plot the feature importances, and let us visualize it","b32c2818":"> <span style=\"font-size:16px;\">  <b>The Airline industry suffered a huge setback after the pandemic, and as per ICAO, the airline industry suffered a 371 bn loss in 2020, and 329 bn with the reduced seat capacity. Hence, to revive the industry in the light of this recession, it is absolutely a necessity to understand the customer pain points, and improve their satisfaction in the services provided.<\/b><\/span>","b94310ba":"> <span style=\"font-size:16px;\">  <b>Clearly the most important features are:\n >*    > <span style=\"font-size:16px;\">  <b>Class of travel\n >*    > <span style=\"font-size:16px;\">  <b>Arrival\/Departure delays\n >*    > <span style=\"font-size:16px;\">  <b>Services provided in the flight\n\n> <span style=\"font-size:16px;\">  <b>Hence, our original hypothesis turned out true, as these are the golden factors that affect the passenger satisfaction","beae584b":"> <span style=\"font-size:16px;\">  <b>We will visualize any specific trends in the features, and that would help us in feature selection, and better understanding of the data. Later, we will derive some useful insights from our custom made function!","8fde1e91":"> <span style=\"font-size:16px;\">  <b>We are already aware that the 'Arrival time' and 'Departure Time' have a sort of linear relationship, so we'll substitute the same departure delay values to the arrival delay values, for the missing values in data points","e43ba998":" <span style=\"color:#A12288;\"><span style=\"font-size:18px;\">*\u201cOnce you have tasted flight, you will forever walk the earth with your eyes turned skyward, for there you have been, and there you will always long to return.\u201d*\n\n<span style=\"font-size:18px;\">  \u2013 Leonardo da Vinci <\/span>","629951a1":"> <span style=\"font-size:16px;\">  <b>From the visualizations and insights, some points are clear:\n     >*    > <span style=\"font-size:16px;\">  <b>Gender doesn't play an important role in the satisfaction, as men and women seems to equally concerned about the same factors<\/b>\n >*   > <span style=\"font-size:16px;\">   <b>Number of loyal customers for this airline is high, however, the dissatisfaction level is high irrespective of the loyalty. Airline will have to work on maintaining the loyal customers<\/b>\n >*  > <span style=\"font-size:16px;\">   <b>Business Travellers seems to be more satisfied with the flight, than the personal travellers<\/b><\/span>\n   >*    > <span style=\"font-size:16px;\">  <b>People in business class seems to be the most satisfied lot, and those in economy class are least satisfied<\/b>\n  ","5e37d2e0":"![](https:\/\/honeywell.scene7.com\/is\/image\/honeywell\/AeroBT-Plane-02242020-2880x1440)","25edf69a":"> <span style=\"font-size:16px;\">  <b>Now let's analyse the numerical features","6fe4b971":"> <span style=\"font-size:16px;\">  <b>From the plots, it is clear that age and Gate location, does not play a huge role in flight satisfaction, and also the gender does not tell us much as seen in the earlier plot. Hence we drop these values","4c1c8025":"> <span style=\"font-size:16px;\">  <b>Now, as we have conducted a preliminary analysis of the data, lets segregate the features into categorical and numerical. Before that let us remove the 'Id' and 'Unnamed: 0' feature from the data","423efa5a":"> <span style=\"font-size:16px;\">  <b>Now it's time for some insights with percent values, to back up our conclusions above","0deb2a22":"# <center> <span style=\"color:#A12288;\"><span style=\"font-size:22px;\"><b>MAPPING THE CATEGORICAL VARIABLES","aacbbde0":"> <span style=\"font-size:16px;\">  <b>From the curve, XGBoost works the best, and let us see the accuracy score, and other metrics","4c078d36":"# <center> <span style=\"color:#A12288;\"><span style=\"font-size:22px;\"><b>VISUALIZATION AND INSIGHTS FROM DATA<\/b>","25f3faa4":"> <span style=\"font-size:16px;\">  <b>Well, we almost guessed the features right, however, we have a detailed data here with 25 features, and we will explore and play with it more, until we find the best","fa813ed1":" # <center>   \u2708 **Airline Passenger Satisfaction** \u2708"}}