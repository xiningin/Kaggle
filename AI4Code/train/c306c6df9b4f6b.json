{"cell_type":{"ee1fec25":"code","21913001":"code","55ec9970":"code","b84bd556":"code","a4a7b585":"code","0893f108":"code","d3e23263":"code","3e975b5d":"code","7c05b1a6":"code","99de348b":"code","7ebf6a95":"code","7d4bd2b6":"code","4afe5b33":"code","d0d15653":"code","dfa111b7":"code","cb2de723":"code","603e12dc":"code","6d956968":"code","315274aa":"code","b49190dd":"code","24cbb966":"code","f0d006ad":"code","68f66753":"code","fa549972":"code","67952432":"code","30bb0bfb":"code","52eeb90e":"code","38c5de52":"code","f050938e":"code","73ea7dce":"code","0dce9d46":"code","f885da8f":"code","c3b7a319":"code","a308ebda":"code","3404f019":"code","0af9f129":"code","7d71dc86":"code","ddbe518a":"markdown","d59ba393":"markdown","ca142b93":"markdown","39ba619a":"markdown","b448fb8e":"markdown","2d93c09a":"markdown","5dc6887c":"markdown","0d423770":"markdown","f399c720":"markdown","9ccbb786":"markdown"},"source":{"ee1fec25":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt","21913001":"X_train = pd.read_csv(\"..\/input\/data-science-summer2-osaka\/train.csv\")\nX_test = pd.read_csv(\"..\/input\/data-science-summer2-osaka\/test.csv\")\ndf_user = pd.read_csv(\"..\/input\/data-science-summer2-osaka\/user_x_anime.csv\")","55ec9970":"df_user = df_user[df_user.rating != 0]\ndf_user.head()","b84bd556":"# \u5b66\u7fd2\u30c7\u30fc\u30bf\u3068\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u304f\u3063\u3064\u3051\u308b\nX_all = pd.concat([X_train,X_test])\n\n# Unknown\u306a\u308b\u3082\u306e\u3092np.nan\u3068\u3057\u3066\u8a08\u7b97\u3067\u304d\u308b\u3088\u3046\u306b\u578b\u3092\u5909\u63db\u3059\u308b\nX_all.loc[X_all.Episodes == \"Unknown\",\"Episodes\"] = np.nan\nX_all[\"Episodes\"] = X_all.Episodes.astype(float)\n\n#\u5fc5\u8981\u306a\u3082\u306e\u3060\u3051\u53d6\u308a\u51fa\u3059\nX_all_temp = X_all[[\"MAL_ID\",\"Episodes\",\"Score\"]]\n\n# \ndf_user = pd.merge(df_user, X_all_temp, left_on='anime_id', right_on='MAL_ID',how='left')\ndf_user[\"watching_rate\"] = df_user[\"watched_episodes\"]\/df_user[\"Episodes\"]","a4a7b585":"df_user.loc[df_user[\"watching_rate\"] >= 1,\"watching_rate\"] = 1","0893f108":"df_user[\"watching_rate\"].describe()","d3e23263":"df_user_mean = df_user.groupby('anime_id').mean()","3e975b5d":"#\u5168\u4f53\u3067\u306f\u95a2\u4fc2\u306a\u3055\u305d\u3046\uff0e\n#\u305f\u3060\u5c11\u306a\u3044\u30a8\u30d4\u30bd\u30fc\u30c9\u307b\u3069\u4eba\u306b\u3088\u3063\u3066\u8a55\u4fa1\u306f\u3042\u307e\u308a\u5909\u308f\u3089\u305a(\u3070\u3089\u3064\u304d\u5c11\u306a\u3044)\uff0e\u5b8c\u4e86\u3059\u308b\u3068\u3070\u3089\u3064\u304d\u304c\u5927\u304d\u304f\u306a\u308b\u6a21\u69d8\nplt.scatter(df_user_mean.watching_rate, df_user_mean.Score, s=1)","7c05b1a6":"#1\u3092\u3064\u3051\u3066\u3044\u308b\u4eba\u306f\u5c11\u306a\u305d\u3046\nplt.scatter(df_user.watching_rate, df_user.rating, s=1)","99de348b":"#\u5225\u30b3\u30fc\u30c9\u3067\u5b9f\u65bd\u6e08\u307f\n#1\/5\u306f\u524a\u9664\u3059\u308b\u3068\u30b9\u30b3\u30a2\u30a2\u30c3\u30d7","7ebf6a95":"# \u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\ndf_train = pd.read_csv('\/kaggle\/input\/data-science-summer2-osaka\/train.csv')\ndf_test = pd.read_csv('\/kaggle\/input\/data-science-summer2-osaka\/test.csv')\ndf_user = pd.read_csv('\/kaggle\/input\/data-science-summer2-osaka\/user_x_anime.csv')\ndf_wiki = pd.read_csv(\"..\/input\/data-science-summer2-osaka\/wiki.csv\")","7d4bd2b6":"anim_user_list = df_user.groupby('anime_id').apply(lambda d: (d.user_id.tolist()))","4afe5b33":"#anim_user_list\u3092\u898b\u3066\u307f\u308b\u3000anime_id \u3054\u3068\u306b\u3069\u306e\u30e6\u30fc\u30b6\u304c\u95b2\u89a7\u3057\uff0c\u8a55\u4fa1\u3057\u3066\u3044\u308b\u304b\u308f\u304b\u308b\uff0e\nanim_user_list","d0d15653":"# \u3084\u308b\u3053\u3068\u306f\u5358\u7d14\u3067\u3069\u308c\u3060\u3051[224239, 304695, 159671, 168286, 107358, 26996...\u3068[60694, 292766, 227630, 263928, 161613, 67633,...\u304c\u91cd\u8907\u3057\u3066\u3044\u308b\u304b\u3092\u7b97\u51fa\u3059\u308c\u3070\u3088\u3044\n#\u305f\u3060\uff0c\u30e1\u30e2\u30ea\u306e\u554f\u984c\u3067\u8a08\u7b97\u3067\u304d\u306a\u3044\uff0e\u3053\u3053\u3092\u5de5\u592b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\uff0e","dfa111b7":"#\u5c71\u672c\u3055\u3093\u306e\u30b3\u30fc\u30c9\u3092\u898b\u308c\u3070\u305d\u306e\u307e\u307e\u3067\u304d\u308b\u304b\u3082\u3057\u308c\u306a\u3044\uff0e\n#\u5c71\u672c\u3055\u3093\u306e\u30b3\u30fc\u30c9\u3092\u6d3b\u7528\u3059\u308b","cb2de723":"# \u6700\u7d42\u7684\u306a\u30a2\u30a6\u30c8\u30d7\u30c3\u30c8\u30a4\u30e1\u30fc\u30b8\nanim_user_list = pd.DataFrame(anim_user_list,columns= [\"user_list\"]).reset_index()\nanim_user_list[\"series\"] = 0 # \u4eee\u7f6e\u304d\u30670\u3068\u3057\u305f\u304c\uff0c\u30b7\u30ea\u30fc\u30ba\u306e\u5834\u5408\u306f\u540c\u3058\u756a\u53f7\u3092\u3075\u308b\u306a\u3069\u306e\u30e9\u30d9\u30eb\u4ed8\nanim_user_list","603e12dc":"df_all = pd.concat([df_train,df_test])","6d956968":"df_all.head(3)","315274aa":"df_all[\"Japanese name\"]#\u3053\u308c\u3092\u30d9\u30af\u30c8\u30eb\u5909\u63db\u3059\u308b\uff0e\n#\u53c2\u8003\n#https:\/\/www.kaggle.com\/risatk\/bert-text","b49190dd":"df_wiki = pd.read_csv(\"..\/input\/data-science-summer2-osaka\/wiki.csv\")","24cbb966":"#\u3069\u3046\u3084\u3089wiki\u306e\u9806\u756a\u306fmal_id\u3067\u7ba1\u7406\u3055\u308c\u3066\u3044\u308b\u6a21\u69d8\ndf_all.sort_values(by = \"MAL_ID\")[\"Japanese name\"].head()","f0d006ad":"df_wiki[\"Japanese name\"].head()","68f66753":"df_wiki[\"Japanese name\"].tolist() == df_all.sort_values(by = \"MAL_ID\")[\"Japanese name\"].tolist()\n#True\u304c\u5e30\u3063\u3066\u304d\u305f","fa549972":"df_wiki[\"MAL_ID\"] = df_all.sort_values(by = \"MAL_ID\").reset_index()[\"MAL_ID\"]","67952432":"def len_(data):\n    try:\n        data = len(data)\n    except:\n        data = np.nan\n    return (data)","30bb0bfb":"df_wiki[\"wiki_len\"] = df_wiki[\"wiki_description\"].apply(len_)","52eeb90e":"wiki_train = df_wiki[df_wiki.MAL_ID.isin(df_train.MAL_ID)]\nwiki_test = df_wiki[df_wiki.MAL_ID.isin(df_test.MAL_ID)]","38c5de52":"df_wiki","f050938e":"X_all_ = pd.merge(X_all, df_wiki[[\"wiki_len\",\"MAL_ID\"]], left_on='MAL_ID', right_on='MAL_ID',how='left')","73ea7dce":"series = X_all_[X_all_.wiki_len.duplicated()].wiki_len.value_counts().index","0dce9d46":"X_train = pd.merge(df_train, wiki_train[[\"wiki_len\",\"MAL_ID\"]], left_on='MAL_ID', right_on='MAL_ID',how='left')\nX_test = pd.merge(df_test, wiki_test[[\"wiki_len\",\"MAL_ID\"]], left_on='MAL_ID', right_on='MAL_ID',how='left')","f885da8f":"#\u306a\u305c\u304bwiki_len\u3092\u8ffd\u52a0\u3057\u3066\u3082\u30b9\u30b3\u30a2\u4e0a\u304c\u3089\u305a\uff0e\uff0e\uff0e\uff0e","c3b7a319":"def japanese_extract(data):\n    if data != np.nan:\n        try :\n            return data.split(\",\")[0].split(\"Japanese:\")[-1]\n        except:\n            return np.nan\n    else:\n        return np.nan","a308ebda":"df_wiki[\"japnese\"] = df_wiki[\"wiki_description\"].map(japanese_extract)\ndf_wiki[\"japnese\"] = df_wiki[\"japnese\"].str.strip()\ns = df_wiki[df_wiki[\"Japanese name\"] == df_wiki[\"japnese\"].str.strip()]\ns","3404f019":"df_wiki[\"Series\"] = 0","0af9f129":"for ss in s.japnese.unique():\n        df_wiki.loc[df_wiki[\"Japanese name\"].str.contains(ss),\"Series\"] = df_wiki[\"Series\"]  + len(df_wiki[df_wiki[\"Japanese name\"].str.contains(ss)])","7d71dc86":"df_wiki.to_csv(\"wiki_.csv\",index = False)","ddbe518a":"## 1.\u5168\u30a8\u30d4\u30bd\u30fc\u30c9\u306b\u5bfe\u3059\u95b2\u89a7\u5b8c\u4e86\u30a8\u30d4\u30bd\u30fc\u30c9\u6570","d59ba393":"1. \u30a8\u30d4\u30bd\u30fc\u30c9\u6570\u306b\u5bfe\u3057\u3066\u898b\u3066\u3044\u308b\u6570\u304c\u5c11\u306a\u3044\u5834\u5408\u306f\u9762\u767d\u304f\u306a\u3044\uff01\u307f\u305f\u3044\u306a\uff0c\u5168\u30a8\u30d4\u30bd\u30fc\u30c9\u306b\u5bfe\u3059\u95b2\u89a7\u5b8c\u4e86\u30a8\u30d4\u30bd\u30fc\u30c9\u6570\uff08\u5ca9\u4e0b\u3055\u3093\u6848\uff09\n1. user_id \u304b\u3089\u3000mean\u3092\u53d6\u308b\u306e\u3067\u306f\u306a\u304f\uff0e\u5c71\u672c\u3055\u3093\u53c2\u7167\u306e\u3082\u306e\u3092\u5b9f\u88c5\u3059\u308b\uff0e\uff08https:\/\/myanimelist.net\/info.php?go=topanime\uff09\n1. \u30b7\u30ea\u30fc\u30ba\u3092\u8868\u73fe\u3059\u308b\n    + anime_id\u3054\u3068\u306buser_id\u3092\u4fdd\u6301\u3057\u3066\u3069\u308c\u3060\u3051user_id\u304c\u88ab\u3063\u3066\u3044\u308b\u304b\uff08\u91cd\u8907\u3057\u3066\u3044\u308b\u304b\uff09\u8868\u73fe\u3059\u308b\uff0euser_id\u304c\u88ab\u3063\u3066\u3044\u308b\u307b\u3069\u30b7\u30ea\u30fc\u30ba\u3060\u3068\u5224\u65ad\u3067\u304d\u308b\uff0e\n    + japanes name \u304b\u3089\u6587\u5b57\u3092\u30d9\u30af\u30c8\u30eb\u5316\u3057\u3066\u4f3c\u305f\u30d9\u30af\u30c8\u30eb\u306f\u4f3c\u305fjapanese name\u306e\u305f\u3081\u30b7\u30ea\u30fc\u30ba\u3068\u3057\u3066\u8868\u73fe\u3059\u308b\uff01https:\/\/www.kaggle.com\/nejumi\/anime2vec\n    + **wiki\u3092\u6d3b\u7528\u3059\u308c\u3070\u3067\u304d\u305d\u3046**\n1. \u305d\u308c\u305e\u308c\u306e\u5217\u3092\u30ab\u30a6\u30f3\u30c8\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3067\u306f\u306a\u304f\uff0c\u4ed6\u306e\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u306b\u3059\u308b","ca142b93":"### \u624b\u6bb51 anime_id\u3054\u3068\u306buser_id\u3092\u4fdd\u6301\u3057\u3066\u3069\u308c\u3060\u3051user_id\u304c\u88ab\u3063\u3066\u3044\u308b\u304b\uff08\u91cd\u8907\u3057\u3066\u3044\u308b\u304b\uff09\u8868\u73fe\u3059\u308b\uff0euser_id\u304c\u88ab\u3063\u3066\u3044\u308b\u307b\u3069\u30b7\u30ea\u30fc\u30ba\u3060\u3068\u5224\u65ad\u3067\u304d\u308b\uff0e","39ba619a":"## 2.\u5c71\u672c\u3055\u3093\u53c2\u7167\u306e\u3082\u306e\u3092\u5b9f\u88c5\u3059\u308b\uff0e\uff08https:\/\/myanimelist.net\/info.php?go=topanime\uff09","b448fb8e":"### wiki\u4f7f\u3048\u3070\u30b7\u30ea\u30fc\u30ba\u3092\u8868\u73fe\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u304b\u3082","2d93c09a":"### \u624b\u6bb52 japanes name \u304b\u3089\u6587\u5b57\u3092\u30d9\u30af\u30c8\u30eb\u5316\u3057\u3066\u4f3c\u305f\u30d9\u30af\u30c8\u30eb\u306f\u4f3c\u305fjapanese name\u306e\u305f\u3081\u30b7\u30ea\u30fc\u30ba\u3068\u3057\u3066\u8868\u73fe\u3059\u308b","5dc6887c":"### \u30a2\u30a4\u30c7\u30a2\u3042\u3052\u3066\u3044\u304d\u307e\u3059\uff01","0d423770":"## 3.\u30b7\u30ea\u30fc\u30ba\u3092\u8868\u73fe\u3059\u308b\n\n+ anime_id\u3054\u3068\u306buser_id\u3092\u4fdd\u6301\u3057\u3066\u3069\u308c\u3060\u3051user_id\u304c\u88ab\u3063\u3066\u3044\u308b\u304b\uff08\u91cd\u8907\u3057\u3066\u3044\u308b\u304b\uff09\u8868\u73fe\u3059\u308b\uff0euser_id\u304c\u88ab\u3063\u3066\u3044\u308b\u307b\u3069\u30b7\u30ea\u30fc\u30ba\u3060\u3068\u5224\u65ad\u3067\u304d\u308b\uff0e\uff01https:\/\/www.kaggle.com\/nejumi\/anime2vec\n+ japanes name \u304b\u3089\u6587\u5b57\u3092\u30d9\u30af\u30c8\u30eb\u5316\u3057\u3066\u4f3c\u305f\u30d9\u30af\u30c8\u30eb\u306f\u4f3c\u305fjapanese name\u306e\u305f\u3081\u30b7\u30ea\u30fc\u30ba\u3068\u3057\u3066\u8868\u73fe\u3059\u308b!","f399c720":"![](https:\/\/media.giphy.com\/media\/l41Ys1fQky5raqvMQ\/giphy.gif?cid=ecf05e47vu0u26wekz5nlrhka06vbhv3hgil0ojx89phl3b3&rid=giphy.gif&ct=g)","9ccbb786":"\u3068\u308a\u3042\u3048\u305a\u5b9f\u88c5\u3067\u304d\u305f\uff0e\u307e\u3068\u3081\u308b\u3068\n\n+ \u5c11\u306a\u3044\u30a8\u30d4\u30bd\u30fc\u30c9\u3057\u304b\u898b\u3066\u3044\u306a\u3044\u307b\u3069\u4eba\u306b\u3088\u3063\u3066\u8a55\u4fa1\u306f\u3042\u307e\u308a\u5909\u308f\u3089\u305a(\u3070\u3089\u3064\u304d\u5c11\u306a\u3044)\uff0e\u5b8c\u4e86\u3059\u308b\u3068\u3070\u3089\u3064\u304d\u304c\u5927\u304d\u304f\u306a\u308b\u6a21\u69d8\n+ \u6700\u5f8c\u307e\u3067\u898b\u305f\u4eba\u306f0~2\u4ed8\u8fd1\u306f\u6bd4\u8f03\u7684\u3064\u3051\u306a\u304f\u306a\u308b"}}