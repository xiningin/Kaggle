{"cell_type":{"c1b0332b":"code","c934f004":"code","bd4431a7":"code","483d9864":"code","8eb75ae0":"code","2ed4f1e4":"code","de448860":"code","a7e414ff":"code","815a3120":"code","d357dfbd":"code","6cb235d5":"code","ef0191db":"code","84c389c1":"code","a86173ce":"code","9a510c1e":"code","70a523d2":"code","0d2744d1":"code","79417bd0":"markdown"},"source":{"c1b0332b":"from fastai.vision.all import *","c934f004":"path = Path('..\/input\/planets-dataset\/planet\/planet')","bd4431a7":"train_df = pd.read_csv(path\/'train_classes.csv')\ntrain_df","483d9864":"def get_x(r):\n    return path\/'train-jpg'\/(r['image_name']+'.jpg')\n\n\n","8eb75ae0":"def get_y(r):\n    return r['tags'].split()\n","2ed4f1e4":"def get_data(size=224, bs=64, data_df=train_df):\n    dblock = DataBlock(blocks=(ImageBlock, MultiCategoryBlock),\n                       splitter=RandomSplitter(seed=42),\n                       get_x=get_x,\n                       get_y=get_y,\n                       item_tfms=Resize(size),\n                       batch_tfms=[*aug_transforms(flip_vert=True, max_warp=0),\n                                   Normalize.from_stats(*imagenet_stats)])\n    return dblock.dataloaders(data_df,bs=bs)","de448860":"dls = get_data(300, 40)","a7e414ff":"dls.show_batch(nrows=1,ncols=3)","815a3120":"f2samples = FBetaMulti(beta=2, average='samples', thresh=0.2)","d357dfbd":"metrics = [partial(accuracy_multi, thresh=0.2), f2samples]\ncbs = [MixUp]","6cb235d5":"!pip install wwf -q\n!pip install timm -q","ef0191db":"from wwf.vision.timm import *","84c389c1":"learn = timm_learner(dls, 'efficientnet_b3', metrics=metrics, cbs=cbs)","a86173ce":"learn.fine_tune(12, base_lr=3e-2,freeze_epochs=4)\n","9a510c1e":"file_path = Path('..\/input\/planets-dataset\/test-jpg-additional\/test-jpg-additional')\ntest_path = Path('..\/input\/planets-dataset\/planet\/planet\/test-jpg')\nsubmission_df = pd.read_csv(path\/'sample_submission.csv')","70a523d2":"testing_path = (submission_df['image_name'] +'.jpg').apply(lambda x: test_path\/x if x.startswith('test') else file_path\/x)","0d2744d1":"def prediction(filename='submission.csv', tta=False):\n    tst_dl = learn.dls.test_dl(testing_path)\n    if tta:\n        predictions = learn.tta(dl=tst_dl)\n    else :\n        predictions = learn.get_preds(dl=tst_dl)\n    predlist = [' '.join(learn.dls.vocab[i]) for i in (predictions[0] >0.2)]\n    df = submission_df\n    df['tags'] = predlist\n    df.to_csv(filename, index=False)\n    return df","79417bd0":"with reference from : https:\/\/www.kaggle.com\/slm37102\/0-93-multi-category-planet-dataset-fast-ai"}}