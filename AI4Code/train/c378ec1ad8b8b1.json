{"cell_type":{"1aa70eb6":"code","babee19c":"code","f1b5850c":"code","492d0b46":"code","c87c37c9":"code","7d291e83":"code","1ed7a07b":"code","1e1059be":"code","0c04f3f6":"code","c35e90c5":"code","1b3acbd6":"code","bf61388b":"code","3a2e7977":"code","9a834c28":"code","f135248a":"code","e463814f":"code","cc25738a":"code","92aa0ff6":"code","cb002068":"code","50aec2bd":"code","4fe3e408":"code","e93d4b51":"code","562192ed":"code","3ffbfa18":"code","bcdcf6c0":"code","a27d483e":"code","5044caf4":"code","78111db5":"code","a057ba86":"code","d78eb89a":"code","8933f3fb":"code","1ffe81a9":"code","4c9397a4":"code","fff440a2":"markdown","e22c6a76":"markdown","746aee3a":"markdown","3d79eba5":"markdown","74e55404":"markdown","c1c9e0a0":"markdown","471c72cc":"markdown","4dabe8f6":"markdown"},"source":{"1aa70eb6":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","babee19c":"import pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport numpy as np\nimport numpy.random as nr\nimport math\n\n%matplotlib inline\ndata = pd.read_csv('..\/input\/sales_train.csv')\nprint(data.head(3))\ndata.info()","f1b5850c":"# Check for negative item_cnt_day (could be a return ?, invalid values, I don't think so)\ndata[data['item_cnt_day']<0]['item_cnt_day'].value_counts()","492d0b46":"plt.plot(data[data['item_cnt_day']<0]['item_id'].value_counts().sort_index())","c87c37c9":"data_filtered=data.loc[data['item_cnt_day']>0]\ndata_filtered.info()\ndata=data_filtered","7d291e83":"item_categories = pd.read_csv('..\/input\/items.csv')\nitem_categories.head(3)","1ed7a07b":"dt=pd.merge(data, item_categories, how='inner')\ndt.sort_values(by=['date'], inplace=True)\ndt.head(3)","1e1059be":"## Drop column \ncolumns=['date','item_price','item_name']\nfor c in columns:\n    if c in dt:\n        dt.drop(c, axis = 1, inplace = True)\ndt[(dt['item_cnt_day']>0)].head(3)","0c04f3f6":"dtf=dt.groupby(['date_block_num', 'shop_id','item_id'])[[\"item_cnt_day\"]].sum().reset_index()","c35e90c5":"print(data.size)\nprint(dtf.size)","1b3acbd6":"dtf.hist(figsize=(15,20))\nplt.figure()","bf61388b":"pd.plotting.scatter_matrix(dtf[['item_cnt_day','item_id','shop_id','date_block_num']],figsize=(10,10))\nplt.figure()","3a2e7977":"dtf[(dtf['item_id']==2929) & (dtf['shop_id']==0)]","9a834c28":"dt[(dt['item_id']==2929) & (dt['shop_id']==0)]","f135248a":"test_shop_id=dt.groupby(['shop_id'])[[\"item_cnt_day\"]].sum().reset_index()\ntest_shop_id.head()\nplt.bar(test_shop_id['shop_id'],test_shop_id [\"item_cnt_day\"])\n\n","e463814f":"test_item_id=dt.groupby(['item_id'])[[\"item_cnt_day\"]].sum().reset_index()\nplt.plot(test_item_id[(test_item_id['item_id']!=20949)]['item_id'],test_item_id[(test_item_id['item_id']!=20949)] [\"item_cnt_day\"])\nplt.plot(test_item_id[(test_item_id['item_cnt_day']<=10000)]['item_id'],test_item_id[(test_item_id['item_cnt_day']<=10000)][\"item_cnt_day\"])\n\nprint(test_item_id[(test_item_id['item_id']!=20949)]['item_id'].describe())\nprint(test_item_id[(test_item_id['item_cnt_day']>12000)]['item_id'].value_counts())","cc25738a":"test_item_id=dt.groupby(['item_category_id'])[[\"item_cnt_day\"]].sum().reset_index()\nplt.plot(test_item_id['item_category_id'],test_item_id[\"item_cnt_day\"])\n","92aa0ff6":"plt.plot(dt.groupby(['date_block_num'])[[\"item_cnt_day\"]].sum())\ndt_filtered=dt.loc[(dt['date_block_num'] ==9) | (dt['date_block_num'] ==10) | (dt['date_block_num'] ==21)| (dt['date_block_num'] ==22) | (dt['date_block_num'] ==33)]\nprint(dt_filtered.size)","cb002068":"dt_filtered['date_block_num'].value_counts()","50aec2bd":"pd.options.mode.chained_assignment = None  # default='warn'\n\nidx=dt_filtered.loc[(dt_filtered['date_block_num'] ==9)].index.values\ndt_filtered.at[idx,'date_block_num']=0\ndt_filtered.at[idx,'year']=1\n\nidx=dt_filtered.loc[(dt_filtered['date_block_num'] ==10)].index.values\ndt_filtered.at[idx,'date_block_num']=1\ndt_filtered.at[idx,'year']=1\n\nidx=dt_filtered.loc[(dt_filtered['date_block_num'] ==21)].index.values\ndt_filtered.at[idx,'date_block_num']=0\ndt_filtered.at[idx,'year']=2\n\nidx=dt_filtered.loc[(dt_filtered['date_block_num'] ==22)].index.values\ndt_filtered.at[idx,'date_block_num']=1\ndt_filtered.at[idx,'year']=2\n\nidx=dt_filtered.loc[(dt_filtered['date_block_num'] ==33)].index.values\ndt_filtered.at[idx,'date_block_num']=0\ndt_filtered.at[idx,'year']=3\nprint(dt_filtered['date_block_num'].value_counts())\nprint(dt_filtered['year'].value_counts())","4fe3e408":"plt.plot(dt_filtered.groupby(['date_block_num'])[[\"item_cnt_day\"]].sum())\nprint(dt_filtered.head())\n","e93d4b51":"dt_filtered.to_csv('sales_train_trans_filtered.csv', sep=',',index=False)","562192ed":"dt.to_csv('sales_train_trans.csv', sep=',',index=False)","3ffbfa18":"sales_test = pd.read_csv('..\/input\/test.csv')\nsales_test.head(3)","bcdcf6c0":"sales_test1=pd.merge(sales_test, item_categories, how='inner')\nsales_test1.sort_values(by=['ID'], inplace=True)\nsales_test1.head(3)","a27d483e":"sales_test1['shop_id'].value_counts()","5044caf4":"sales_test1.info()","78111db5":"sales_test1.isnull().sum()","a057ba86":"sales_test1['item_id'].value_counts().count()","d78eb89a":"sales_test1['item_category_id'].value_counts().count()","8933f3fb":"dt['item_category_id'].value_counts().count()","1ffe81a9":"#pd.concat([pd.unique(sales_test1['item_category_id']),pd.unique(sales_test1['item_category_id'])]).drop_duplicates(keep=False)\n#print(\"sales_test1['item_category_id']-->\",pd.unique(sales_test1['item_category_id']))\n#print(\"dt['item_category_id']-->\",pd.unique(dt['item_category_id']))\n#print(\"concatenate-->\", np.concatenate((pd.unique(sales_test1['item_category_id']),pd.unique(dt['item_category_id'])),axis=0))\nnp.unique(np.concatenate((pd.unique(sales_test1['item_category_id']),pd.unique(dt['item_category_id'])),axis=0))\n\na=set(pd.unique(dt['item_category_id']));\nb=set(pd.unique(sales_test1['item_category_id']));\n\nlist(a-b)\n","4c9397a4":"sales_test1.drop('item_name', axis = 1, inplace = True)\nsales_test1.to_csv('sales_test1.csv', sep=',',index=False)","fff440a2":"# Analyze item_id outliers","e22c6a76":"# Prepare test data : adding category column","746aee3a":"# Group by 'date_block_num', 'shop_id','item_id'  and sum the item count per day to get the sum for each month (or date_block_num)","3d79eba5":"# Merge based on item_id","74e55404":"# Drop unused columns","c1c9e0a0":"# Try to remove outliers (december months ...)","471c72cc":"# Remove item_cnt_day outliers ?","4dabe8f6":"# Item_category_id that can be removed"}}