{"cell_type":{"6f2ede94":"code","b7e3633c":"code","dd192109":"code","82fe2f47":"code","7599524c":"code","c8cb5e05":"code","3c6356cc":"code","5f878b04":"code","7f7eca7b":"code","d3640dbd":"code","a71e18e3":"code","880a4691":"code","5d8d45e1":"code","942c202f":"code","6772de72":"code","347987aa":"code","b29ba9d1":"code","e21ca80c":"code","63b1397a":"code","2f5d31ce":"code","22beacd6":"code","c5ef864d":"code","59f9d72d":"code","0cddd09f":"code","879c0ae6":"code","638e72ea":"code","b2946fd7":"code","b1aec742":"code","a9b8f4e7":"code","077e70fb":"code","26d33bbd":"markdown"},"source":{"6f2ede94":"import datetime\nimport pandas as pd\nimport requests\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nimport os\nimport plotly.express as px\nimport numpy as np\n\nmpl.rcParams['figure.figsize'] = (14,8)\nmpl.rcParams['axes.grid'] = False\n\n","b7e3633c":"df = pd.read_csv('https:\/\/raw.githubusercontent.com\/numenta\/NAB\/master\/data\/realKnownCause\/nyc_taxi.csv')\ndf","dd192109":"df.timestamp = pd.to_datetime(df['timestamp'])\n","82fe2f47":"df.info()\n","7599524c":"df = df.set_index('timestamp').resample(\"H\").mean()\ndf\n","c8cb5e05":"# !pip install fbprophet","3c6356cc":"fig = px.line(df.reset_index(), x = 'timestamp',y = 'value',title = 'NYC_Taxi_Demand')\n\nfig.update_xaxes(\n    rangeslider_visible= True,\n    rangeselector=dict(\n                        buttons = list([\n                        dict(count = 1,label = '1y',step='month',stepmode = \"backward\"),\n                        dict(count = 2,label = '3y',step='month',stepmode = \"backward\"),\n                        dict(count = 3,label = '5y',step='month',stepmode = \"todate\"),\n                        dict(step= 'all')\n                            ])        \n                        )\n                   )\nfig.show()","5f878b04":"from fbprophet import Prophet\n","7f7eca7b":"taxi_df = df.reset_index()[['timestamp','value']].rename({'timestamp':'ds','value':'y'}, axis='columns')\n\n","d3640dbd":"taxi_df\n","a71e18e3":"\ntrain = taxi_df[(taxi_df['ds']>='2014-07-01') & (taxi_df['ds']<='2015-01-27')]\ntest = taxi_df[(taxi_df['ds']>'2015-01-27')]","880a4691":"print(train.shape)\nprint(test.shape)\n","5d8d45e1":"test\n","942c202f":"m = Prophet(changepoint_range=0.95)\n","6772de72":"m.fit(train)\n","347987aa":"m.params\n","b29ba9d1":"\nfuture = m.make_future_dataframe(periods=119,freq='H')\nfuture.tail(167)","e21ca80c":"forecast = m.predict(future)\nforecast[['ds','yhat','yhat_lower','yhat_upper']].tail()","63b1397a":"results = pd.concat([taxi_df.set_index('ds')['y'],forecast.set_index('ds')[['yhat','yhat_lower','yhat_upper']]],axis=1)\nresults","2f5d31ce":"fig1 = m.plot(forecast)\n","22beacd6":"comp = m.plot_components(forecast)\n","c5ef864d":"results","59f9d72d":"\nresults['error'] = results['y'] - results['yhat']\n# print(\"************************\")\n# print(results)","0cddd09f":"results['uncertainity'] = results['yhat_upper'] - results['yhat_lower']\n","879c0ae6":"results","638e72ea":"results[results['error'].abs() > 1.5*results['uncertainity']]\n","b2946fd7":"results['anomaly'] = results.apply(lambda x: 'Yes' if (np.abs(x['error']) > 1.5*x['uncertainity']) else 'No', axis=1)\n","b1aec742":"results","a9b8f4e7":"fig = px.scatter(results.reset_index(), x = 'ds',y = 'y',color='anomaly',title = 'NYC_Taxi_Demand')\n\nfig.update_xaxes(\n    rangeslider_visible= True,\n    rangeselector=dict(\n                        buttons = list([\n                        dict(count = 1,label = '1y',step='month',stepmode = \"backward\"),\n                        dict(count = 2,label = '3y',step='month',stepmode = \"backward\"),\n                        dict(count = 3,label = '5y',step='month',stepmode = \"todate\"),\n                        dict(step= 'all')\n                            ])        \n                        )\n                   )\nfig.show()","077e70fb":"comp=m.plot_components(forecast)","26d33bbd":"references:- https:\/\/www.youtube.com\/watch?v=0wfOOl5XtcU"}}