{"cell_type":{"1b65a0ab":"code","302e2203":"code","9d76e9a3":"code","6b09f097":"code","3d7c85c0":"code","cc20d3c1":"code","33bfad9a":"code","d4ac352d":"code","6838c7da":"code","32a09d0b":"code","1088d164":"code","48057e23":"code","a72e0c4b":"code","baee2fd7":"code","fec5af82":"code","2f8ddcd5":"markdown","f6a579a3":"markdown","662af1c2":"markdown","3f591ab9":"markdown","c350ce69":"markdown","75fbdea5":"markdown","dfe1e61c":"markdown","48b0a656":"markdown","92b7e0c0":"markdown","b3deda77":"markdown","a5b6ec20":"markdown","041e7c72":"markdown","f55b9592":"markdown","e465c477":"markdown","6e9f4260":"markdown","a673a3f4":"markdown","474f4fea":"markdown","8766b547":"markdown","394ec428":"markdown","e90ed0dc":"markdown"},"source":{"1b65a0ab":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport statistics\nfrom sklearn.impute import SimpleImputer\nfrom lifelines import KaplanMeierFitter, CoxPHFitter\nfrom lifelines.statistics import logrank_test\nfrom scipy import stats","302e2203":"df = pd.read_csv(\"..\/input\/echocardiogram.csv\")\ndf.head()","9d76e9a3":"print(df.isnull().sum())\nprint(df.shape)","6b09f097":"imp_mean = SimpleImputer(missing_values = np.nan, strategy = 'mean')\nCOLUMNS = ['age', 'pericardialeffusion', 'fractionalshortening', 'epss', 'lvdd', 'wallmotion-score']\nX = imp_mean.fit_transform(df[COLUMNS])\ndf_X = pd.DataFrame(X,\n                    columns = COLUMNS)\ndf_X.shape","3d7c85c0":"COLUMNS_keep = ['survival', 'alive']\ndf_keep = df[COLUMNS_keep]\ndf_keep.shape","cc20d3c1":"df = pd.concat([df_keep, df_X], axis = 1)\ndf = df.dropna() \nprint(df.isnull().sum())\nprint(df.shape)","33bfad9a":"sns.pairplot(df)","d4ac352d":"df.loc[df.alive == 1, 'dead'] = 0\ndf.loc[df.alive == 0, 'dead'] = 1\ndf.groupby('dead').count()","6838c7da":"kmf = KaplanMeierFitter()\nT = df['survival']\nE = df['dead']\nkmf.fit(T, event_observed = E)\nkmf.plot()\nplt.title(\"Kaplan Meier estimates\")\nplt.xlabel(\"Month after heart attack\")\nplt.ylabel(\"Survival\")\nplt.show()","32a09d0b":"print(statistics.median(df['age']))\nprint(statistics.median(df['wallmotion-score']))","1088d164":"age_group = df['age'] < statistics.median(df['age'])\nax = plt.subplot(111)\nkmf.fit(T[age_group], event_observed = E[age_group], label = 'below 62')\nkmf.plot(ax = ax)\nkmf.fit(T[~age_group], event_observed = E[~age_group], label = 'above 62')\nkmf.plot(ax = ax)\nplt.title(\"Kaplan Meier estimates by age group\")\nplt.xlabel(\"Month after heart attack\")\nplt.ylabel(\"Survival\")","48057e23":"score_group = df['wallmotion-score'] < statistics.median(df['wallmotion-score'])\nax = plt.subplot(111)\nkmf.fit(T[score_group], event_observed = E[score_group], label = 'Low score')\nkmf.plot(ax = ax)\nkmf.fit(T[~score_group], event_observed = E[~score_group], label = 'High score')\nkmf.plot(ax = ax)\nplt.title(\"Kaplan Meier estimamtes by wallmotion-score group\")\nplt.xlabel(\"Month after heart attack\")\nplt.ylabel(\"Survival\")","a72e0c4b":"month_cut = 24\ndf.loc[(df.dead == 1) & (df.survival <= month_cut), 'censored'] = 1\ndf.loc[(df.dead == 1) & (df.survival > month_cut), 'censored'] = 0\ndf.loc[df.dead == 0, 'censored'] = 0\nE_v2 = df['censored']\n\nT_low = T[score_group]\nT_high = T[~score_group]\nE_low = E_v2[score_group]\nE_high = E_v2[~score_group]\n\nresults = logrank_test(T_low, T_high, event_observed_A = E_low, event_observed_B = E_high)\nresults.print_summary()","baee2fd7":"cph = CoxPHFitter()\ndf_score_group = pd.DataFrame(score_group)\ndf_model = df[['survival', 'censored', 'age']]\ndf_model = pd.concat([df_model, df_score_group], axis = 1)\ncph.fit(df_model, 'survival', 'censored')\ncph.print_summary()","fec5af82":"# p-value of Log-likelihood ratio test\nround(stats.chi2.sf(10.68, 2),4)","2f8ddcd5":"# Data ","f6a579a3":"# Log-rank test","662af1c2":"I saw a slightly negative relationship of age and wallmotion-score to survival, so I used median to make two groups within each variable to see difference in survival time.","3f591ab9":"# Impute missing values with mean","c350ce69":"# Check censored data ","75fbdea5":"For alive = 1 patients, because they are alive during data collection period and we do not know their survival months after the data collection, they are regarded as censored data. Hence, the following analysis needs to consider the censored data by making dead variable below.","dfe1e61c":"# Packages used","48b0a656":"The difference by age groups seems to be weak. However, there seems to differ by wallmotion-score group for the first 24 months (2 years) after heart attack. So I applied the following analysis based on wallmotion-score group.","92b7e0c0":"We only have 133 observations, but there are many missing values across variables. Since I don't wanna drop these data, I'm gonna implement imputation for missing values with means of each columns.","b3deda77":"# Kaplan Meier estimates","a5b6ec20":"dropna function applies to survival and alive variables which I don't consider imputation for. The number of the data for analysis is 130 observations.","041e7c72":"# Survival Analysis on Echocardiogam heart attack data ","f55b9592":"This analysis performs survival analysis to predict survival month (\"survival\") base on the covariates in Echocardiogram - UCI data. The survival analysis includes use of censoring data, Kaplan-Meier estimates, Log-rank test, and Cox proportional hazards model. There is little correlation between survival time and the covariates, which makes it hard to derive significant results. However, by exploring Kaplan-Meier estimates, it seems to have difference in survival time in the first two years after heart attacks.","e465c477":"When I installed lifelines package, it cuased errors. I'm using Windows PC. I downloaded Visual Sutudio C++ Tool Box and run \"pip install lifelines\" at Anaconda Prompt to solve this problem. I also copied and pasted error messages in Google to solve it.","6e9f4260":"# Scatter plots between survival and covariates","a673a3f4":"# Cox proportional hazards model ","474f4fea":"\"test_statistic\" here is a chi-square statistic. It shows chi-square statistic 9.98, and p-value is less than 5%. Thus, I confirm that there is a significant difference in suvival time by wallmotion score group for the first 2 year after heart attack.","8766b547":"We have 88 non-censored data and 42 censored data.","394ec428":"# Check missing values ","e90ed0dc":"Whether this model is significant or not depends on the result of Log-likelihood ratio test at the bottom of the summary. This statistic follows Chi-square distribution with 2 degree of freedom, and p-value is 0.0048. It says this cox model is significant so that statistical inference is based on this model. Wallmotion-score group is a risk factor for survival time, but age is not by checking p-values. Negative sign of wallmotion-score variable indicates that the patients with low wallmotion score reduce the risk of death. Hazard ration of wallmotion-score is 0.28, which means it reduce in hazard since it is less than 1 and it reduces the hazard by 72% (1 - 0.28). Thus, I conclude that for the first two years after each patient experiences heart attack, the people with high wallmotion score would have a higher risk of death so that we can pay attention to this group of patients."}}