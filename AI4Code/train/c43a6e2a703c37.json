{"cell_type":{"9f3328a8":"code","abe3eab9":"code","30ce4642":"code","bae2a7db":"code","aa2f4fd3":"code","adcfb4dd":"code","25d663ad":"code","a1d5d990":"code","2bef33e0":"code","425d7e91":"code","fee7c64d":"code","69c98d0e":"code","776795c2":"code","5dc361ba":"code","4675575e":"code","5fec6f9c":"code","c816db45":"code","40e4deca":"code","00d70927":"code","84015e7b":"markdown","76c1fbf8":"markdown"},"source":{"9f3328a8":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load in \n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# Any results you write to the current directory are saved as output.","abe3eab9":"SEED = 42\nnp.random.seed(SEED)\n\nfrom sklearn.metrics import mean_squared_log_error\nfrom sklearn.preprocessing import LabelEncoder\nfrom catboost import Pool, CatBoostRegressor\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport gc","30ce4642":"train = pd.read_csv(\"..\/input\/ashrae-energy-prediction\/train.csv\")\ntest = pd.read_csv(\"..\/input\/ashrae-energy-prediction\/test.csv\")\n\ntrain_weather = pd.read_csv(\"..\/input\/ashrae-energy-prediction\/weather_train.csv\")\ntest_weather = pd.read_csv(\"..\/input\/ashrae-energy-prediction\/weather_test.csv\")\n\nmetadata = pd.read_csv(\"..\/input\/ashrae-energy-prediction\/building_metadata.csv\")","bae2a7db":"merged_train = pd.merge(train, metadata, how=\"left\", on=[\"building_id\"])\nmerged_test = pd.merge(test, metadata, how=\"left\", on=[\"building_id\"])\n\ndel train, test, metadata\ngc.collect()","aa2f4fd3":"def simple_mem_reduce(df):\n    for col in df.columns:\n        if df[col].dtype == int:\n            m = df[col].max()\n            if m > np.iinfo(np.uint32).max:\n                df[col] = df[col].astype(np.uint64)\n            elif m > np.iinfo(np.uint16).max:\n                df[col] = df[col].astype(np.uint32)\n            elif m > np.iinfo(np.uint8).max:\n                df[col] = df[col].astype(np.uint16)\n            elif m < np.iinfo(np.uint8).max:\n                df[col] = df[col].astype(np.uint8)\n                \n        elif df[col].dtype == float:\n            m = df[col].max()\n            if m > np.finfo(np.float32).max:\n                df[col] = df[col].astype(np.float64)\n            elif m > np.finfo(np.float16).max:\n                df[col] = df[col].astype(np.float32)\n            elif m < np.finfo(np.float32).max:\n                df[col] = df[col].astype(np.float16)\n        \n    return df","adcfb4dd":"merged_train = simple_mem_reduce(merged_train)\nmerged_test = simple_mem_reduce(merged_test)","25d663ad":"train_weather = simple_mem_reduce(train_weather)\ntest_weather = simple_mem_reduce(test_weather)","a1d5d990":"train_df = pd.merge(merged_train, train_weather, \\\n                    how=\"left\", on=[\"site_id\", \"timestamp\"])\ntest_df = pd.merge(merged_test, test_weather, \\\n                    how=\"left\", on=[\"site_id\", \"timestamp\"])\n\ndel merged_train, merged_test, train_weather, test_weather\ngc.collect()","2bef33e0":"train_df[\"timestamp\"] = pd.to_datetime(train_df[\"timestamp\"])\ntest_df[\"timestamp\"] = pd.to_datetime(test_df[\"timestamp\"])\n\n\ntrain_df[\"year\"] = train_df[\"timestamp\"].dt.year.astype(np.uint16)\ntrain_df[\"month\"] = train_df[\"timestamp\"].dt.month.astype(np.uint8)\ntrain_df[\"day\"] = train_df[\"timestamp\"].dt.day.astype(np.uint8)\ntrain_df[\"hour\"] = train_df[\"timestamp\"].dt.hour.astype(np.uint8)\n\ntest_df[\"year\"] = test_df[\"timestamp\"].dt.year.astype(np.uint16)\ntest_df[\"month\"] = test_df[\"timestamp\"].dt.month.astype(np.uint8)\ntest_df[\"day\"] = test_df[\"timestamp\"].dt.day.astype(np.uint8)\ntest_df[\"hour\"] = test_df[\"timestamp\"].dt.hour.astype(np.uint8)\n\ndel train_df[\"timestamp\"], test_df[\"timestamp\"]\ngc.collect()","425d7e91":"encoder = LabelEncoder()\n\ntrain_df[\"primary_use\"] = encoder.fit_transform(train_df[\"primary_use\"]).astype(np.uint8)\ntest_df[\"primary_use\"] = encoder.fit_transform(test_df[\"primary_use\"]).astype(np.uint8)","fee7c64d":"gc.collect()","69c98d0e":"def RMSLE(y_true, y_pred, *args, **kwargs):\n    return np.sqrt(mean_squared_log_error(y_true, y_pred))","776795c2":"# train_df = train_df.fillna(-999)\n# test_df = test_df.fillna(-999)","5dc361ba":"y = train_df[\"meter_reading\"]\n\ndel train_df[\"meter_reading\"]\ngc.collect()","4675575e":"model = CatBoostRegressor(loss_function=\"RMSE\",\n                           eval_metric=\"RMSE\",\n                           task_type=\"GPU\",\n                           learning_rate=0.01,\n                           iterations=180000,\n                           l2_leaf_reg=5,\n                           random_seed=42,\n                           od_type=\"Iter\",\n                           depth=7,\n                           early_stopping_rounds=3000,\n                           border_count=32\n                          )\n\ntrain_data = Pool(train_df[:-100000], label=np.log1p(y)[:-100000])\nvalid_data = Pool(train_df[-100000:], label=np.log1p(y)[-100000:])\n\nclf = model.fit(train_data,\n                    eval_set=valid_data,\n                    use_best_model=True,\n                    verbose=2000)","5fec6f9c":"val_pred = clf.predict(train_df[-100000:])\nval_pred = np.exp(val_pred)\n\nRMSLE(y[-100000:], val_pred)","c816db45":"pred = clf.predict(test_df)","40e4deca":"sub = pd.read_csv(\"..\/input\/ashrae-energy-prediction\/sample_submission.csv\")","00d70927":"sub[\"meter_reading\"] = np.exp(pred)\nsub.to_csv(\"submission.csv\", index=False)\nsub.head(10)","84015e7b":"# Prepare data","76c1fbf8":"# Build Model"}}