{"cell_type":{"c65c1689":"code","64b52f8a":"code","a665a331":"code","8cd71e26":"code","0ae7485c":"code","3c1aa8ab":"code","0fbdd6e4":"code","5f542c5c":"code","fadbecf0":"code","1980129e":"code","0ce47c05":"markdown"},"source":{"c65c1689":"from fastai.text.all import *","64b52f8a":"input_path = Path('..\/input\/jigsaw-toxic-severity-rating')\nsub_df = pd.read_csv(input_path\/'sample_submission.csv')\ntest_df = pd.read_csv(input_path\/'comments_to_score.csv')\ndf = pd.read_csv(input_path\/'comments_to_score.csv')\ndf['total_tox'] = 5\ndf.shape","a665a331":"vocab = pd.read_csv('..\/input\/initial-files\/lm_vocab.csv')\nlm_vocab = vocab['0'].values","8cd71e26":"toxic_db = DataBlock(blocks=(TextBlock.from_df('text', vocab=lm_vocab), RegressionBlock),\n                     get_x = ColReader('text'),\n                     get_y = ColReader('total_tox'),\n                     splitter = RandomSplitter())","0ae7485c":"dls = toxic_db.dataloaders(df[:100], bs=64)\nlearner = text_classifier_learner(dls, AWD_LSTM, drop_mult=0.5, metrics=accuracy, pretrained=False)","3c1aa8ab":"! mkdir ..\/working\/models\n!cp ..\/input\/initial-files\/initial_model.pth ..\/working\/models","0fbdd6e4":"learner.load('initial_model');","5f542c5c":"test_dl = dls.test_dl(test_df['text'])\nlen(test_dl)","fadbecf0":"preds = learner.get_preds(dl=test_dl)\nlen(preds), preds[0].shape","1980129e":"sub_df.score = preds[0]\nsub_df.to_csv('submission.csv', index=False)","0ce47c05":"Training pipeline can be found here: https:\/\/www.kaggle.com\/alibaba19\/jigsaw-training-ulmfit-w-fastai"}}