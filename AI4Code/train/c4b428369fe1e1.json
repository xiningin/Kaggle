{"cell_type":{"dfe1c04a":"code","1f4d696a":"code","fe7aad5a":"code","1f31b5eb":"code","df10f229":"code","46223277":"code","1fb4987a":"code","6073c255":"code","b0248494":"code","0ab884a9":"code","9ed28a98":"code","be9857bf":"code","36af001f":"code","f73bcc31":"code","18f9921c":"code","ba8df576":"code","5c4ee0c2":"code","c356d29c":"code","de0dcdd7":"code","13d9a8d7":"code","7f6f9f31":"code","62430b57":"code","8e101c6e":"code","4eddfe1b":"code","c9bee79b":"code","1be72846":"code","aa44af7e":"code","778e97f3":"code","015f7a80":"code","d4728676":"code","332e2772":"code","31cd27c6":"code","5c058d82":"markdown","656fb4d4":"markdown","a23d9c92":"markdown","8074119f":"markdown","d79efbd6":"markdown","4d0b5de2":"markdown","870374c5":"markdown","fa8f3985":"markdown","aba96325":"markdown","6c520f3c":"markdown","1eea9fc0":"markdown","7b1f2c53":"markdown","27b55b1d":"markdown"},"source":{"dfe1c04a":"\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n \n","1f4d696a":"# lets import the required libraries\n\n# for mathemaical operations\nimport numpy as np\n# for dataframe manipulations\nimport pandas as pd\n\n# for data visualizations\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport plotly.express as px\n\n# setting parameters for visualization\nplt.rcParams['figure.figsize'] = (16, 5)\nplt.style.use('fivethirtyeight')","fe7aad5a":"data = pd.read_csv('..\/input\/insurance-premium-prediction\/insurance.csv')","1f31b5eb":"data.shape\n","df10f229":"# lets check the head of the dataset\ndata.head()","46223277":"# lets check the missing values in the dataset\ndata.isnull().sum()","1fb4987a":"# lets check the descriptive summary\ndata.describe().style.background_gradient(cmap = 'Greens')","6073c255":"# lets check the distribution of smoker, children and region\n\nplt.subplot(1, 3, 1)\nplt.pie(data['smoker'].value_counts().values,\n        labels = data['smoker'].value_counts().index,\n        colors = ['gold','silver'],\n        startangle = 90,\n        shadow = True,\n       explode = [0.1, 0])\n\nplt.subplot(1, 3, 2)\nsns.countplot(data['children'], palette = 'magma')\nplt.grid()\n\nplt.subplot(1, 3, 3)\nplt.pie(data['region'].value_counts().values,\n        labels = data['region'].value_counts().index,\n        colors = ['gold','silver','grey','black'],\n        startangle = 90,\n        shadow = True,\n       explode = [0.1, 0, 0, 0])\nplt.suptitle('Distribution of Smoker, Children and Regions', fontsize = 15)\nplt.show()","b0248494":"# lets check the distribution of age, bmi and expenses\n\nplt.subplot(1, 3, 1)\nsns.distplot(data['age'], color = 'black')\nplt.xlabel('Age')\nplt.grid()\n\nplt.subplot(1, 3, 2)\nsns.distplot(data['bmi'], color = 'orange')\nplt.xlabel('BMI')\nplt.grid()\n\nplt.subplot(1, 3, 3)\nsns.distplot(data['expenses'], color = 'aqua')\nplt.xlabel('Expenses')\nplt.grid()\n\nplt.suptitle('Distribution of Age, BMI, and Expenses', fontsize = 15)\nplt.show()","0ab884a9":"# lets understand the impact of age on Medical Expenses\npx.scatter(data, y = 'expenses',\n           x = 'age',\n           marginal_y = 'violin',\n           trendline = 'ols')","9ed28a98":"# lets understand the impact of bmi on Medical Expenses\npx.scatter(data, y = 'expenses',\n           x = 'bmi',\n           marginal_y = 'violin',\n           trendline = 'ols')","be9857bf":"# lets check the impact of smoking and childrens in Medical Expenses\n\nplt.subplot(1, 2, 1)\nsns.boxplot(data['children'], data['expenses'])\n\nplt.subplot(1, 2, 2)\nsns.boxplot(data['smoker'], data['expenses'])\n\nplt.suptitle('Impact of Smoking and Childrens on Expenses', fontsize = 20)\nplt.show()","36af001f":"# As we can see from the above chart that having 4 and 5 childrens is having similar impact on expenses\n# so let's cap these values\n\ndata['children'] = data['children'].replace((4, 5), (3, 3))\n\n# lets check the value counts\ndata['children'].value_counts()","f73bcc31":"px.scatter(data,\n        x=\"expenses\",\n                 y=\"age\",\n                 facet_row=\"children\",\n                 facet_col=\"region\",\n                 color=\"smoker\",\n                 trendline=\"ols\")\n","18f9921c":"px.scatter(data,\n        x=\"expenses\",\n                 y=\"bmi\",\n                 facet_row=\"children\",\n                 facet_col=\"region\",\n                 color=\"smoker\",\n                 trendline=\"ols\")","ba8df576":"# A Bubble Chart to Represent the relation of Expense with BMI, Age, smoking\n# only for the North West Region\npx.scatter(data,\n                 x=\"expenses\",\n                 y=\"bmi\",\n                 size=\"age\",\n                 color=\"smoker\",\n           hover_name=\"expenses\", size_max=15)","5c4ee0c2":"px.bar_polar(data, r=\"expenses\", theta=\"region\", color = 'sex', template = 'plotly_dark',\n            color_discrete_sequence= px.colors.sequential.Plasma_r)","c356d29c":"# lets check the impact of Regions in Expenses\n\ndata[['expenses', 'region']].groupby(['region']).agg(['min','mean','max']).style.background_gradient(cmap = 'Wistia')","de0dcdd7":"# as we can see that all the columns are important, we will not remove any column\ndata.head()","13d9a8d7":"# lets perform encoding\n\n# as we know males have higher expense than females, lets encode males as 2, and females as 1, \n# similarly smokers, have highers expense, so we will encode smokers as 2, and non smokers as 1,\n# as we know that the south east region has higher expense than other regions\n\ndata['sex'] = data['sex'].replace(('male','female'), (2, 1))\ndata['smoker'] = data['smoker'].replace(('yes','no'), (2, 1))\ndata['region'] = data['region'].replace(('southeast','southwest','northeast','northwest'),(2, 1, 1, 1))\n\n# let's check whether any categorical column is left\ndata.select_dtypes('object').columns","7f6f9f31":"# now lets check our data again\ndata.head()","62430b57":"# lets form dependent and independent sets\n\ny = data['expenses']\nx = data.drop(['expenses'], axis = 1)\n\nprint(y.shape)\nprint(x.columns)# lets form dependent and independent sets\n\ny = data['expenses']\nx = data.drop(['expenses'], axis = 1)\n\nprint(y.shape)\nprint(x.columns)","8e101c6e":"# lets perform train test split\n\nfrom sklearn.model_selection import train_test_split\n\nx_train, x_test, y_train, y_test = train_test_split(x, y, test_size = 0.2, random_state = 0)\n\nprint(x_train.shape)\nprint(x_test.shape)\nprint(y_train.shape)\nprint(y_test.shape)","4eddfe1b":"# lets perform standardization\n\nfrom sklearn.preprocessing import StandardScaler\n\nsc = StandardScaler()\nx_train = sc.fit_transform(x_train)\nx_test = sc.transform(x_test)","c9bee79b":"# lets create the Model\n\n# lets create a simple Linear Regression Model\nfrom sklearn.linear_model import LinearRegression\n\nmodel1 = LinearRegression()\nmodel1.fit(x_train, y_train)\n\ny_pred1 = model1.predict(x_test)","1be72846":"# lets check the Model accuracy\nfrom sklearn.metrics import r2_score, mean_squared_error\n\nmse = mean_squared_error(y_test, y_pred1)\nrmse = np.sqrt(mse)\nprint(\"RMSE Score :\", rmse)\n\nr2_score = r2_score(y_test, y_pred1)\nprint(\"R2 Score :\",r2_score)","aa44af7e":"# lets create a Random Forest Model\n\nfrom sklearn.ensemble import RandomForestRegressor\n\nmodel2 = RandomForestRegressor()\nmodel2.fit(x_train, y_train)\n\ny_pred2 = model2.predict(x_test)\n\n# lets check the Model accuracy\nfrom sklearn.metrics import r2_score, mean_squared_error\n\nmse = mean_squared_error(y_test, y_pred2)\nrmse = np.sqrt(mse)\nprint(\"RMSE Score :\", rmse)\n\nr2_score = r2_score(y_test, y_pred2)\nprint(\"R2 Score :\",r2_score)","778e97f3":"# lets create a Gradient Boosting Model\n\nfrom sklearn.ensemble import GradientBoostingRegressor\n\nmodel3 = GradientBoostingRegressor()\nmodel3.fit(x_train, y_train)\n\ny_pred3 = model3.predict(x_test)\n\n# lets check the Model accuracy\nfrom sklearn.metrics import r2_score, mean_squared_error\n\nmse = mean_squared_error(y_test, y_pred3)\nrmse = np.sqrt(mse)\nprint(\"RMSE Score :\", rmse)\n\nr2_score = r2_score(y_test, y_pred3)\nprint(\"R2 Score :\",r2_score)","015f7a80":"# lets create an ensemble by averaging \n\navg_model = (y_pred1 + y_pred2 + y_pred3)\/3\n\n# lets check the Model accuracy\nfrom sklearn.metrics import r2_score, mean_squared_error\n\nmse = mean_squared_error(y_test, avg_model)\nrmse = np.sqrt(mse)\nprint(\"RMSE Score :\", rmse)\n\nr2_score = r2_score(y_test, avg_model)\nprint(\"R2 Score :\",r2_score)","d4728676":"# lets create an weighted averaging model\n\n# lets give 50% weight to gradient boosting\n# 30% weight to random forest\n# and 20% weight to linear regression\n\nweight_avg_model = 0.2*y_pred1 + 0.3*y_pred2 + 0.5*y_pred3\n\n# lets check the Model accuracy\nfrom sklearn.metrics import r2_score, mean_squared_error\n\nmse = mean_squared_error(y_test, weight_avg_model)\nrmse = np.sqrt(mse)\nprint(\"RMSE Score :\", rmse)\n\nr2_score = r2_score(y_test, weight_avg_model)\nprint(\"R2 Score :\",r2_score)","332e2772":"## lets perform cross validaion\n\nfrom sklearn.model_selection import cross_val_score\nscores = cross_val_score(model3, x, y, cv=5)\nprint(scores)","31cd27c6":"r2_score = np.array([0.79, 0.87, 0.89])\nlabels = np.array(['Linear Regression', 'Random Forest' 'Gradient Boosting'])\nindex = np.argsort(r2_score)\ncolor = plt.cm.rainbow(np.linspace(0, 1, 4))\n\nplt.style.use('fivethirtyeight')\nplt.rcParams['figure.figsize'] = (4, 4)\n\nplt.bar(range(len(index)), r2_score[index], color = color)\nplt.xticks(range(0, 3), ['Linear Regression', 'Random Forest','Gradient Boosting'], rotation = 90)\nplt.title('Comparison of r2 Score', fontsize = 15)\nplt.show()","5c058d82":"# Data Processing","656fb4d4":"#   UNIVARIATE ANALYSIS ","a23d9c92":"* We can clearly see that there is a increasing pattern for BMI as well.\n* For smoker with less BMI: Expense is around 20k\n* For Smokers with High BMI: Expense is around 50K\n* For Non Smokers BMI is not a Huge Factor, The Expense range from 5k to 10k","8074119f":"* The Expenses of Smokers in all regions ranges from 20 to 60k\n* Whereas the Expenses of Non Smokers in all regions ranges from 10 to 20K\n* The Lesser range of Expense is for lesser age people and vice versa.","d79efbd6":"* as we can see that the scores are not varying much, so we can say that this model is good.\n","4d0b5de2":"# Multivariate Analysis","870374c5":"* This Chart clearly depits that the Southeast region has higher expenses compared to other regions.\n* This Chart clearly shows that Males have Higher Expenses in general in all the regions.","fa8f3985":"* This Chart makes it clear that BMI is not powerful indicator Expenses, as people having less BMI also have high Medical Expenses.\n* This chart makes it clear that People who smoke have higher Medical Expenses.\n* The Size of Bubble, which represents age, shows that people having higher expenses belong to Higher Expenses category","aba96325":"**So, hence it is observed that there are no null values.**\n\n\n","6c520f3c":"# Bivariate Analysis","1eea9fc0":"# Predictive Modelling","7b1f2c53":"## Comparison of Models","27b55b1d":"**With Increasing Age, Expense is expeted to increase, but It is not obvious for all the scenarios.**"}}