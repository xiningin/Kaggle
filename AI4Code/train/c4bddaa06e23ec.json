{"cell_type":{"e3629643":"code","9ed63ae6":"code","de716af9":"code","742bbb26":"code","096db1d8":"code","461c5e32":"code","b6df5c00":"code","0620930c":"code","08376d26":"code","0f26ed8d":"code","b4b0b5ff":"markdown","1a0ddce2":"markdown","cbd21468":"markdown","24dff843":"markdown","235b65d8":"markdown","89052ccc":"markdown","9ad754c6":"markdown","fa76ffe1":"markdown","e2f501cf":"markdown","27afe96d":"markdown","c7358a93":"markdown"},"source":{"e3629643":"# local Operating System\nimport os\n\n# Visualisation\nimport geopandas\nfrom geopandas import GeoDataFrame\n\n# Dataframe\nimport pandas as pd\nfrom shapely.geometry import Point, Polygon\n\n# SQL - PostgreSQL\nimport bq_helper\nfrom bq_helper import BigQueryHelper","9ed63ae6":"chicago_crime = bq_helper.BigQueryHelper(active_project=\"bigquery-public-data\", dataset_name=\"chicago_crime\") ","de716af9":"print(os.listdir(\"..\/input\")) \nchicri_geo = geopandas.read_file('..\/input\/geo_export_33ca7ae0-c469-46ed-84da-cc7587ccbfe6.shp')\n","742bbb26":"city_sql_loc = \"\"\" \nWITH cr AS\n(\n    SELECT \n    latitude\n    , longitude \n    , primary_type\n    , community_area\n    FROM  `bigquery-public-data.chicago_crime.crime`\n    WHERE year = 2012\n    \/*WHERE date = '2012-01-15'*\/\n)\nSELECT \ncr.latitude\n, cr.longitude\n, cr.primary_type\n, cr.community_area\nFROM cr\nORDER BY  cr.latitude, cr.longitude\n\"\"\"\nchicri_loc_df = chicago_crime.query_to_pandas(city_sql_loc)","096db1d8":"chicri_loc_df = chicri_loc_df.dropna(inplace=False)  # Remove all nan entries. \nchicri_loc_df = chicri_loc_df.drop(chicri_loc_df[(chicri_loc_df.latitude < 41.0)].index) #Remove bad values in Long\/Lat \nchicri_loc_df['community_area'] = chicri_loc_df['community_area'].astype(int)\nchicri_geometry = [Point(xy) for xy in zip(chicri_loc_df.longitude, chicri_loc_df.latitude)]\nchicri_crs = {'type': 'EPSG', 'properties': {'code': 102671}}\nchicri_points = GeoDataFrame(chicri_loc_df, crs=chicri_crs, geometry=chicri_geometry)\nchicri_points.head(5)","461c5e32":"chicri_points_map = chicri_points.plot(figsize=(30,30), markersize=5) \nchicri_points_map.set_axis_off()","b6df5c00":"chicri_map = chicri_geo.plot(figsize=(30,30), edgecolor='k', cmap='nipy_spectral', alpha=0.5, linewidth=2) \nchicri_geo.apply(lambda x: chicri_map.annotate(s=x.community, xy=x.geometry.centroid.coords[0], ha='center', size=16),axis=1);\nchicri_map.set_axis_off()","0620930c":"chicri_map = chicri_geo.plot(figsize=(25,25), edgecolor='k', facecolor='b', alpha=0.25, linewidth=2) \nchicri_geo.apply(lambda x: chicri_map.annotate(s=x.community, xy=x.geometry.centroid.coords[0], ha='center', size=16),axis=1);\nchicri_points.plot(figsize=(25,25),ax=chicri_map, markersize=5, color='r', alpha=0.25)\nchicri_map.set_axis_off()","08376d26":"chicri_vc_points = chicri_points.loc[chicri_points['primary_type'].isin(['ASSAULT'\n                                                                , 'BATTERY'\n                                                                , 'CRIM SEXUAL ASSAULT'\n                                                                , 'HOMICIDE'\n                                                                , 'HUMAN TRAFFICKING'\n                                                                , 'INTIMIDATION'\n                                                                , 'KIDNAPPING'])]\n\nchicri_vc_points_map = chicri_vc_points.plot(figsize=(30,30), markersize=5) \nchicri_vc_points_map.set_axis_off()","0f26ed8d":"chicri_vc_map = chicri_geo.plot(figsize=(25,25), edgecolor='k', facecolor='b', alpha=0.25, linewidth=2) \nchicri_geo.apply(lambda x: chicri_vc_map.annotate(s=x.community, xy=x.geometry.centroid.coords[0], ha='center', size=16),axis=1);\nchicri_vc_points.plot(ax=chicri_vc_map, markersize=5, color='r', legend=True)\nchicri_vc_map.set_axis_off()","b4b0b5ff":"** Render a map of The City of Chicago with Community Area Boundaries **","1a0ddce2":"** Overlay the Violent Crime Points onto the City of Chicago map with Community Area Boundaries **","cbd21468":"## Plot the Crimes Geographically","24dff843":"** Clean Up the Crime Data and Create a GeoDataFrame object of the Crime Data  **\n> * Remove all rows with NaN data\n> * There are some Long\/Lat values that are way out-of-bounds\n> * Cast columns to the appropriate types\n> * Genereate the point value from the Long\/Lat values in the crime data which are passed as the Geometry attribute","235b65d8":"** Draw the Points of the Crime Data (All Crime Categories) **","89052ccc":"**GeoPandas - Load City of Chicago Community Area Shape Files **","9ad754c6":"** Filter for \"Violent Crime\" Categories only **\n> Draw the Points of the Violent Crime Data ","fa76ffe1":"**The Chicago Crime Data dataset is hosted on Google Big Query**","e2f501cf":"** Overlay the Points onto the City of Chicago map with Community Area Boundaries **","27afe96d":"## GeoPandas Chicago Crime Data\n\nThis project uses crime data and Shape Files from the Chicago Data Portal \n\n**Crime data is from calendar year 2012 **\n\n> Each Reported Crime has the folloing information associated:\n> * Primary Category for the Crime\n> * The City of Chicago Community Area where the crime was committed\n> * Longitude and Lattitude\n\n> We can use this information to overlay a plot the crimes on a map of the City of Chicago showing Community Area Boundaries\n\n> This provides a ready visual of clusters by Community Area or Neighborhood for overall crimes and specific categories of crimes\n\n**The Geographic Areas are the City of Chicago Community Areas **\n\n> GeoPandas uses[ ESRI ]https:\/\/en.wikipedia.org\/wiki\/Shapefile)shape files\n> * .shp- Feature Geometry\n> * .shx - Feature Index\n> * .dbf - Feature Attributes\n> * .prj - Projection information and attributes for drawing the map \n\n> These files are published by the US Census\n\n> City of Chicago makes files available from their Chicago Data Portal\n\n> Files are published as a Dataset on Kaggle:  [Chicago Shape Files](https:\/\/www.kaggle.com\/threadid\/chicago-shape-files)\n","c7358a93":"**Get Location Data from the Crime Dataset**"}}