{"cell_type":{"170eeede":"code","e255cb27":"code","66239ec6":"code","cef26e9c":"code","86945788":"code","14fa2a08":"code","c9954eb0":"code","4f25cf61":"code","d5143121":"code","57347441":"code","25cbc58b":"code","1ab6c5bc":"code","cc3da2d2":"code","7c69cb70":"code","173a39e5":"code","0c9f0fb8":"code","f55d919e":"code","dc8f6d98":"code","21de35e2":"code","5a3050da":"code","a9d8c8cc":"code","05419732":"code","166ad3e6":"code","8a0e67a7":"code","36bbd047":"code","1d72f204":"code","87d7e488":"code","750c924c":"code","07d0ab5e":"code","cb33d3f7":"code","19934bee":"code","1ad728a7":"code","608d27b9":"code","190b6071":"code","c8c1787b":"code","8d70575d":"code","814d8329":"code","030ff517":"code","b2f9f5be":"code","22d89dba":"code","d88d725c":"code","bc91bdd8":"code","04061fc5":"code","ebab1247":"code","88aaae3a":"code","734dbf87":"markdown","ded5ebee":"markdown","544db967":"markdown","61a4d33f":"markdown","f8b93c17":"markdown","9fd1f25c":"markdown","36ecdb3d":"markdown","a59b9f2d":"markdown","2463db0d":"markdown","912598df":"markdown","0e47b9eb":"markdown","a711a68c":"markdown","16e103e4":"markdown","de0a1cbb":"markdown","f1e33a54":"markdown"},"source":{"170eeede":"import pyforest as pf","e255cb27":"data = pd.read_csv(\"C:\\\\Users\\\\sys\\\\DS\\\\AI_ML_Projects\\\\Heart failure prediction\\\\heart.csv\")","66239ec6":"data.head()","cef26e9c":"data.shape","86945788":"\"\"\"This dataset was created by combining different datasets already available independently but not combined before.\nIn this dataset, 5 heart datasets are combined over 11 common features which makes it the largest heart disease dataset \navailable so far for research purposes. The five datasets used for its curation are:\n\nCleveland: 303 observations\nHungarian: 294 observations\nSwitzerland: 123 observations\nLong Beach VA: 200 observations\nStalog (Heart) Data Set: 270 observations\nTotal: 1190 observations\nDuplicated: 272 observations\n\nFinal dataset: 918 observations\"\"\"\n\n\"\"\"Acknowledgements\nCreators:\n\nHungarian Institute of Cardiology. Budapest: Andras Janosi, M.D.\nUniversity Hospital, Zurich, Switzerland: William Steinbrunn, M.D.\nUniversity Hospital, Basel, Switzerland: Matthias Pfisterer, M.D.\nV.A. Medical Center, Long Beach and Cleveland Clinic Foundation: Robert Detrano, M.D., Ph.D.\"\"\"","14fa2a08":"# Dealing with missing values\ndata.isnull().sum()   # the data has no missing values","c9954eb0":"# Dealing with outliers = Age,RestingBP,Cholesterol,MaxHR are numeric attributes\nprint(sns.boxplot(data['Age']))","4f25cf61":"data['Cholesterol'] = np.where(data['Cholesterol']>350,data['Cholesterol'].mean(),data['Cholesterol'])\ndata['Cholesterol'] = np.where(data['Cholesterol']<100,data['Cholesterol'].mean(),data['Cholesterol'])","d5143121":"print(sns.boxplot(data['Cholesterol']))","57347441":"data['MaxHR'] = np.where(data['MaxHR']<70,data['MaxHR'].mean(),data['MaxHR'])","25cbc58b":"print(sns.boxplot(data['MaxHR']))","1ab6c5bc":"data['RestingBP'] = np.where(data['RestingBP']>170,data['RestingBP'].mean(),data['RestingBP'])\ndata['RestingBP'] = np.where(data['RestingBP']<90,data['RestingBP'].mean(),data['RestingBP'])\n","cc3da2d2":"print(sns.boxplot(data['RestingBP']))","7c69cb70":"x = data.iloc[:,:-1]\ny = data.iloc[:,-1]","173a39e5":"print(x.shape)\nprint(y.shape)","0c9f0fb8":"# checking whether dataset is balanced or not\ny.value_counts()  ","f55d919e":"x.head(2)","dc8f6d98":"x['Sex'].replace({'M':1,'F':0},inplace=True)\nx['ExerciseAngina'].replace({\"N\":0,\"Y\":1},inplace = True)","21de35e2":"x = pd.get_dummies(x,columns = ['ChestPainType','RestingECG','ST_Slope'])","5a3050da":"x.shape","a9d8c8cc":"names = x.columns","05419732":"from sklearn import preprocessing","166ad3e6":"x = sklearn.preprocessing.minmax_scale(x,feature_range=(0,1))","8a0e67a7":"x =pd.DataFrame(x,columns=names)","36bbd047":"x.head(3)","1d72f204":"from sklearn import model_selection","87d7e488":"x_train,x_test,y_train,y_test = model_selection.train_test_split(x,y,test_size = 0.2,random_state = 123)","750c924c":"XGBoost = xgb.XGBClassifier()\nRand_forest = sklearn.ensemble.RandomForestClassifier()\nsvm = sklearn.svm.SVC()\nDtree = sklearn.tree.DecisionTreeClassifier()\nGBM = sklearn.ensemble.GradientBoostingClassifier()\nlog = sklearn.linear_model.LogisticRegression()","07d0ab5e":"XGBoost.fit(x_train,y_train)\nRand_forest.fit(x_train,y_train)\nsvm.fit(x_train,y_train)\nDtree.fit(x_train,y_train)\nGBM.fit(x_train,y_train)\nlog.fit(x_train,y_train)","cb33d3f7":"p1 = XGBoost.predict(x_train)\np2 = Rand_forest.predict(x_train)\np3 = svm.predict(x_train)\np4 = Dtree.predict(x_train)\np5 = GBM.predict(x_train)\np6 = log.predict(x_train)","19934bee":"print(\"xgboost:\",metrics.accuracy_score(y_train,p1))\nprint(\"Rand_forest:\",metrics.accuracy_score(y_train,p2))\nprint(\"svm:\",metrics.accuracy_score(y_train,p3))\nprint(\"Dtree:\",metrics.accuracy_score(y_train,p4))\nprint(\"GBM:\",metrics.accuracy_score(y_train,p5))\nprint(\"log:\",metrics.accuracy_score(y_train,p6))","1ad728a7":"GBM","608d27b9":"parameters = {\n              \"loss\":[\"deviance\",\"exponential\"],\n              \"max_features\":[\"log2\",\"sqrt\"],\n              'learning_rate': [0.1,0.25,0.5,0.75,1.0],\n              'n_estimators': [5,10,15,20,25]}\n","190b6071":"Grid_search = sklearn.model_selection.GridSearchCV(estimator=GBM,param_grid=parameters,cv=10)","c8c1787b":"Grid_search.fit(x_train,y_train)","8d70575d":"Grid_search.best_params_  # best combination,which gives better accuracy","814d8329":"gd = Grid_search.predict(x_train)","030ff517":"metrics.accuracy_score(gd,y_train) # training accuracy of the model","b2f9f5be":"# Model building and fitting the data\nModel = sklearn.ensemble.GradientBoostingClassifier(learning_rate=0.25,loss='exponential',max_features='sqrt',n_estimators=25)\nModel.fit(x_train,y_train)\ny_tp= Model.predict(x_train)\nsklearn.metrics.accuracy_score(y_train,y_tp)","22d89dba":"# predicting with test data\ny_pred = Model.predict(x_test)\nsklearn.metrics.accuracy_score(y_test,y_pred)","d88d725c":"conf_matrix = sklearn.metrics.confusion_matrix(y_train,y_tp)\n\nconf_matrix","bc91bdd8":"Accuracy  = metrics.accuracy_score(y_train,y_tp)\nPrecesion = metrics.precision_score(y_train,y_tp)\nRecall = metrics.recall_score(y_train,y_tp)\nF1_score = metrics.f1_score(y_train,y_tp)","04061fc5":"print(conf_matrix)\nprint(\"Accuracy:\",Accuracy)\nprint(\"Precesion:\",Precesion)\nprint(\"Recall:\",Recall)\nprint(\"F1-score:\",F1_score)","ebab1247":"metrics.roc_auc_score(y_train,y_tp)","88aaae3a":"auc = metrics.roc_auc_score(y_train,y_tp)\n\nfpr, tpr, thresolds = metrics.roc_curve(y_train,y_tp)\n\nplt.figure(figsize=(12, 10), dpi=80)\nplt.axis('scaled')\nplt.xlim([0, 1])\nplt.ylim([0, 1])\nplt.title(\"AUC & ROC Curve\")\nplt.plot(fpr, tpr, 'v')\nplt.fill_between(fpr, tpr, facecolor='blue', alpha=0.8)\nplt.text(1, 0.05, 'AUC = %0.4f' % auc, ha='right', fontsize=10, weight='bold', color='black')\nplt.xlabel(\"False Positive Rate\")\nplt.ylabel(\"True Positive Rate\")\nplt.show()","734dbf87":"# Model Perfomance metrics","ded5ebee":"# Attribute Information","544db967":"# confusion matrix ,classification report,precession,recall and f1score","61a4d33f":"# Data collection - Secondary collection method","f8b93c17":"# Identifying the Best parameters combination using Gridsearchcv","9fd1f25c":"# Feature Scaling","36ecdb3d":"# Hyper-parameter tuned Model ","a59b9f2d":"# Data preprocessing","2463db0d":"Heart disease is one of the major cause of mortality in the world today. Prediction of cardiovascular disease is a critical challenge in the field of clinical data analysis. With the advanced development in machine learning (ML), artificial intelligence (AI) and data science has been shown to be effective in assisting in decision making and predictions from the large quantity of data produced by the healthcare industry. ML approaches has brought lot of improvements and broadens the study in medical field which recognizes patterns in the human body by using various algorithms and correlation techniques. One such reality is coronary heart disease, various studies gives impression into predicting heart disease with ML techniques. Initially ML was used to find degree of heart failure, but also used to identify significant features that affects the heart disease by using correlation techniques. There are many features\/factors that lead to heart disease like age, blood pressure,Cholesterol,Chest pain type etc. In this paper we propose a method to finding important features by applying machine learning techniques. The work is to design and develop prediction of heart disease by  machine learning. Hence ML has huge impact in saving lives and helping the doctors, widening the scope of research in actionable insights, drive complex decisions and to create innovative products for businesses to achieve key goals.","912598df":"# ROC and AUC","0e47b9eb":"# Problem statement","a711a68c":"Age:           age of the patient [years]\n\nSex:           sex of the patient [M: Male, F: Female]\n\nChestPainType: chest pain type [TA: Typical Angina, ATA: Atypical Angina, NAP: Non-Anginal Pain, ASY: Asymptomatic]\n\nRestingBP:     resting blood pressure [mm Hg]\n\nCholesterol:   serum cholesterol [mm\/dl]\n\nFastingBS:     fasting blood sugar [1: if FastingBS > 120 mg\/dl, 0: otherwise]\n\nRestingECG:    resting electrocardiogram results [Normal: Normal, ST: having ST-T wave abnormality (T wave inversions and\/or ST \n\nelevation or depression of > 0.05 mV), LVH: showing probable or definite left ventricular hypertrophy by Estes' criteria]\n\nMaxHR:         maximum heart rate achieved [Numeric value between 60 and 202]\n\nExerciseAngina: exercise-induced angina [Y: Yes, N: No]\n\nOldpeak: oldpeak = ST [Numeric value measured in depression]\n\nST_Slope:     the slope of the peak exercise ST segment [Up: upsloping, Flat: flat, Down: downsloping]\n\nHeartDisease: output class [1: heart disease, 0: Normal]","16e103e4":"# Identifying the best classification model","de0a1cbb":"# Dealing with categorical\/Binary data columns","f1e33a54":"out all classifiers xgb,randomforest and Dtree are leading to specific prediction and svm,logistic and GBM are good,picking GBM which is optimum"}}