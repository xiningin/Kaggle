{"cell_type":{"9f47d0ab":"code","cb37e664":"code","94b52e91":"code","2a8f11fb":"code","e43c667c":"code","d4210a99":"code","f5748859":"code","18a04a82":"code","dc96b68c":"code","5927ae4c":"code","16aac14f":"code","bbecaf6b":"code","ab02c3b6":"code","3fb96d60":"code","ba65a655":"code","078d782c":"code","13a332eb":"code","32dc94f7":"code","2ecd052c":"code","43616e9b":"code","31a6329a":"code","83443ca0":"code","6ea089fb":"code","6430b68d":"code","0dd4bf19":"code","a26f1911":"code","4feb413f":"code","0eccf0e6":"code","90bd79ca":"code","84331a36":"code","40a928be":"code","940dcad3":"code","23aa8f5b":"code","8a221dd6":"code","24acb882":"code","a98c8841":"code","42970cf6":"code","50cf24bf":"code","220ff871":"code","17e7b78d":"code","8fe37564":"code","d631ea3f":"code","580becd1":"code","690ec852":"code","6cdef8be":"code","de67bbdc":"code","44f0daa0":"code","e2dd4072":"code","d9de79c8":"code","7e327531":"code","87bc26c9":"code","d5699da2":"code","358abf79":"code","fdecbf52":"code","86155d4d":"code","fff5e0d8":"code","5da734f9":"code","3146a6b1":"code","54ac8728":"code","e16e9226":"code","09bf6a99":"code","93b5fadc":"markdown","f07fee74":"markdown","3c8ace4f":"markdown","9540eb78":"markdown","090c9338":"markdown","6c42c13d":"markdown","a74d1e5c":"markdown","9f2fda78":"markdown","ce3eeb0c":"markdown","9951d476":"markdown","04a0fa5f":"markdown","1988a953":"markdown","ff33da7b":"markdown","4526962f":"markdown","c98be52e":"markdown","1b6c0955":"markdown","40ec8a54":"markdown","7653df20":"markdown","4fea33b7":"markdown","84891d53":"markdown"},"source":{"9f47d0ab":"from IPython.display import Image\nImage(\"..\/input\/diamond-picture\/diamond.jpg\")","cb37e664":"import numpy as np\nimport pandas as pd\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\nimport plotly.express as px\nimport plotly.graph_objects as go\n\nfrom scipy.stats import skew, kurtosis\n\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.preprocessing import StandardScaler\n\nfrom sklearn.pipeline import Pipeline\n#from sklearn.preprocessing import OrdinalEncoder\nfrom sklearn.compose import ColumnTransformer\nfrom sklearn.ensemble import RandomForestRegressor","94b52e91":"plt.rcParams[\"figure.figsize\"] = (12,5)","2a8f11fb":"# Load the dataset\ndiamonds_df = pd.read_csv(\"\/kaggle\/input\/diamonds\/diamonds.csv\") \ndiamonds_df.drop(\"Unnamed: 0\", axis=1, inplace=True)\n\n# Create a list of numeric columns\nnum_feat = [col for col in diamonds_df.select_dtypes(include='number').columns]\n# Create a list of categorical columns\ncat_feat = [col for col in diamonds_df.select_dtypes(\"object\").columns]\n\ndiamonds_df","e43c667c":"diamonds_df.info()","d4210a99":"diamonds_df.describe()","f5748859":"corr_map = diamonds_df.corr()\nmask = np.zeros_like(corr_map)\nmask[np.triu_indices_from(mask)] = True\n\nplt.figure(figsize=(10, 8))\nsns.heatmap(corr_map,\n            mask=mask,\n            annot=True,\n            linewidth=1,\n            linecolor='w',\n            #square=True,\n            cbar=False);","18a04a82":"def skew_test(df):\n    col = df.skew(axis = 0, skipna = True)\n    val = df.skew(axis = 0, skipna = True)\n    sk_table = pd.concat([col, val], axis=1)\n    \n    sk_table = sk_table.rename(\n    columns = {0 : \"skewness\"})\n    \n    return sk_table.drop([1], axis = 1).sort_values(\"skewness\", ascending = False).reset_index()","dc96b68c":"skk = skew_test(diamonds_df[num_feat])","5927ae4c":"skk['kurtosis'] = diamonds_df[num_feat].kurtosis().values\nskk.style.background_gradient(cmap='Blues')","16aac14f":"sns.scatterplot(x='price', y='x', data=diamonds_df)","bbecaf6b":"# Will drop these outliers later on\ndiamonds_df[diamonds_df['x'] <1]","ab02c3b6":"num_feat","3fb96d60":"fig = plt.figure(figsize=(12, 20))\nfor i, col in enumerate(num_feat):\n    plt.subplot(12, 2, i+1 )\n    sns.histplot(x=diamonds_df[col])\n    plt.grid('darkgrid')\n    plt.tight_layout()\n    \nfig.show()","ba65a655":"fig = px.box(diamonds_df, x='price')\nfig.show()","078d782c":"fig = px.histogram(data_frame=diamonds_df, x='price', nbins=40, color='cut', marginal='rug',\n                  color_discrete_sequence=px.colors.qualitative.G10)\nfig.show()","13a332eb":"fig = px.histogram(data_frame=diamonds_df, x='carat', nbins=40, color='cut', marginal='rug',\n                  color_discrete_sequence=px.colors.qualitative.G10)\nfig.show()","32dc94f7":"fig = px.scatter(diamonds_df, x='price', y='carat', size='carat', color='color', opacity=0.6,\n                 color_discrete_sequence=px.colors.qualitative.Vivid)\nfig.show()","2ecd052c":"fig = px.scatter(diamonds_df, x=\"carat\", y=\"price\", facet_col=\"cut\", color='color')\nfig.show()","43616e9b":"fig = px.scatter(diamonds_df, x='carat', y='depth', size='carat', color='color', opacity=0.4)\nfig.show()","31a6329a":"fig = px.histogram(data_frame=diamonds_df, x='depth', nbins=45)\nfig.show()","83443ca0":"fig = px.histogram(data_frame=diamonds_df, x='table', nbins=45, marginal='rug', opacity=0.6)\nfig.show()","6ea089fb":"cat_feat","6430b68d":"fig = px.pie(diamonds_df, values='price', names='cut', color_discrete_sequence=px.colors.sequential.RdBu)\nfig.show()","0dd4bf19":"x = diamonds_df[\"cut\"].value_counts().index\ny = diamonds_df['cut'].value_counts().values\n\nfig = go.Figure(data=[go.Bar(x=x, y=y)])\n# Customize aspect\nfig.update_traces(marker_color=px.colors.sequential.Plasma, marker_line_color='rgb(8,48,107)',\n                  marker_line_width=1.5, opacity=0.6)\nfig.update_layout(title_text='Diamond Cut Scale')\nfig.show()","a26f1911":"fig = px.box(diamonds_df, x='cut', y='depth', color='cut')\nfig.update_traces(quartilemethod=\"exclusive\")\nfig.show()","4feb413f":"fig = px.box(diamonds_df, x='cut', y='price', color='color')\nfig.update_traces(quartilemethod=\"exclusive\")\nfig.show()","0eccf0e6":"\nfig = px.pie(diamonds_df, values='price', names='color', color_discrete_sequence=px.colors.sequential.RdBu)\nfig.show()","90bd79ca":"x = diamonds_df[\"color\"].value_counts().index\ny = diamonds_df['color'].value_counts().values\n\n\nfig = go.Figure(data=[go.Bar(x=x, y=y)])\n# Customize aspect\nfig.update_traces(marker_color= px.colors.sequential.RdBu, marker_line_color='rgb(8,48,107)',\n                  marker_line_width=1.5, opacity=0.6)\nfig.update_layout(title_text='Diamond Color')\nfig.show()","84331a36":"fig = px.box(diamonds_df, x='color', y='depth', color='color')\nfig.update_traces(quartilemethod=\"exclusive\")\nfig.show()","40a928be":"labels = diamonds_df['clarity'].value_counts().index\nvalues = diamonds_df['clarity'].value_counts().values\n\n# Use `hole` to create a donut-like pie chart\nfig = go.Figure(data=[go.Pie(labels=labels, values=values, hole=.5,marker_colors=px.colors.sequential.Jet)])\nfig.show()","940dcad3":"diamonds_df['clarity'].unique()","23aa8f5b":"x = diamonds_df[\"clarity\"].value_counts().index\ny = diamonds_df['clarity'].value_counts().values\n\norder = ['IF','VVS2', 'VVS1','VS1', 'VS2','SI2', 'SI1','I1']\n\nfig = go.Figure(data=[go.Bar(x=x, y=y)])\n# Customize aspect\nfig.update_traces(marker_color='LightSkyBlue', marker_line_color='rgb(8,48,107)',\n                  marker_line_width=1.5, opacity=0.6)\nfig.update_layout(title_text='Diamond Clarity')\nfig.show()","8a221dd6":"fig = px.box(diamonds_df, x='clarity', y='depth', color='clarity')\nfig.update_traces(quartilemethod=\"exclusive\")\nfig.show()","24acb882":"#fig = px.scatter_3d(diamonds_df, x='x', y='y', z='z', color=\"cut\")\n#fig.show()","a98c8841":"diamonds_df.head()","42970cf6":"for col in cat_feat:\n    print(f\"{col} unique values: {diamonds_df[col].unique()}\")","50cf24bf":"dict_map = {\"Fair\":0, \"Good\":1, \"Very Good\":2, \"Premium\":3, \"Ideal\":4,\n            'I1':1, 'SI1':1, 'SI2':1, 'VS1':2, 'VS2':2, 'VVS1':3, 'VVS2':3, \"IF\":4,\n            'I':0,'J':0,'H':0,'G':0, 'E':1,'F':1,'D':1}\n\nfor col in cat_feat:\n    diamonds_df[col] = diamonds_df[col].map(dict_map)","220ff871":"diamonds_df.head()","17e7b78d":"# Drop outliers\nnew_diamonds_df = diamonds_df.drop(diamonds_df[diamonds_df['z'] <1].index, axis=0).copy()","8fe37564":"sns.scatterplot(x='price', y='z', data=new_diamonds_df)","d631ea3f":"sns.scatterplot(x='price', y='y', data=new_diamonds_df)","580becd1":"y_drop_idx = new_diamonds_df[new_diamonds_df['y'] > 30].index\nnew_diamonds_df = new_diamonds_df.drop(y_drop_idx, axis=0)","690ec852":"z_drop_idx = new_diamonds_df[new_diamonds_df['z'] > 30].index\nnew_diamonds_df = new_diamonds_df.drop(z_drop_idx, axis=0)","6cdef8be":"new_diamonds_df.head()","de67bbdc":"# X\/y sets\nX = new_diamonds_df.drop(\"price\", axis=1)\ny = new_diamonds_df['price']\n\n# Split into train\/test sets\nX_train, X_val, y_train, y_val = train_test_split(X, y, test_size=0.2, random_state=45)\n\n# Scale data\nscaler = StandardScaler()\n\nscaled_X_train = scaler.fit_transform(X_train)\nscaled_X_val = scaler.transform(X_val)","44f0daa0":"\npd.DataFrame(scaled_X_train, columns=X.columns)","e2dd4072":"from sklearn.linear_model import ElasticNetCV","d9de79c8":"elcv = ElasticNetCV(l1_ratio=[.1, .5, .7, .9, .95, .99, 1])\n\nelcv.fit(scaled_X_train, y_train)","7e327531":"elcv.l1_ratio_","87bc26c9":"X.columns.shape","d5699da2":"pd.DataFrame(elcv.coef_, index=X.columns, columns=['coefficient'])","358abf79":"from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score","fdecbf52":"y_preds = elcv.predict(scaled_X_val)","86155d4d":"print(f\"Base MAE: {mean_absolute_error(y_val, y_preds)}\")\nprint(f\"Base RMSE: {np.sqrt(mean_squared_error(y_val, y_preds))}\")\nprint(f\"Base R-square: {r2_score(y_val, y_preds)}\")","fff5e0d8":"100 * mean_absolute_error(y_val, y_preds) \/ new_diamonds_df['price'].mean()","5da734f9":"from xgboost import XGBRegressor","3146a6b1":"xgb = XGBRegressor()\nxgb.fit(scaled_X_train, y_train)","54ac8728":"y_preds = xgb.predict(scaled_X_val)\n\nprint(f\"Base MAE: {mean_absolute_error(y_val, y_preds)}\")\nprint(f\"Base RMSE: {np.sqrt(mean_squared_error(y_val, y_preds))}\")\nprint(f\"Base R-square: {r2_score(y_val, y_preds)}\")","e16e9226":"100 * mean_absolute_error(y_val, y_preds) \/ new_diamonds_df['price'].mean()","09bf6a99":"Where to go from here:","93b5fadc":"## Evaluate a model","f07fee74":"**\"carat\" feature**","3c8ace4f":"## Split our dataset into X\/y","9540eb78":"## Feature engineering","090c9338":"**\"x, y, z\" features**","6c42c13d":"EDA summary:\n\n1. There is skewness in numrical and categorical features.\n2. Very high correlation between columns \"x\",\"y\", \"z\", \"carat\" and \"price\".\n3. There is linear relation between above features.\n4. Categorical features are ordinal (instead onehotencode them we need to map these features)\n5. There are only two categories in \"cut\" column - very good and excellent","a74d1e5c":"Ideas to explore:\n1. Try other algorithms for regression\n2. Hyperparameters tunning with GridSearchCV\n3. Cross-validation.","9f2fda78":"## Libraries","ce3eeb0c":"**Label \"Price\"**","9951d476":"**\"table\" feature** ","04a0fa5f":"## About the dataset","1988a953":"**\"Color feature\"**","ff33da7b":"**\"depth\" feature**","4526962f":"### Color Explained\n\n('E','F','D') - Colorness (scale- Excellent) (4)\n\n('I','J','H','G') - Near Colorness (scale- Very Good) (3)\n\n('K','L','M') - Faint Yellow (scale- Good) (2)\n\n('N','O','P','Q','R') - Very Light Yellow (scale - Fair) (1)\n\n('S','T','U','V','W','X','Y','Z') - Light Yellow (scale - Poor) (0)","c98be52e":"The aim of this notebook is to hone my visualization skills and show that with few lines of code we can achieve beautiful interactive visualization. After EDA I will create a model which will predict the price of a diamond. I also hope for this notebook to be educational as well, so if you find it interesting and you learn something new don't forget to vote and leave feedback, thanks.","1b6c0955":"**\"Clarity feature\"**","40ec8a54":"## Numeric features","7653df20":"**\"Cut\" feature**","4fea33b7":"### Clarity explained\n\n'IF' - Internaly Flawless  (4)\n\n'VVS2' - Very Very Slight Inclusions  (3)\n\n'VVS1' - Very Very Slight Inclusions  (3)\n\n'VS1' - Very Slight Inclusions  (2)\n\n'VS2' - Very Slight Inclusions  (2)\n\n'SI2' - Slight Inclusions  (1)\n\n'SI1' - Slight Inclusions  (1)\n\n'I1' - Imperfect   (0)","84891d53":"## Categorical features"}}