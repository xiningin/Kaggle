{"cell_type":{"04e2675a":"code","22ba5e80":"code","57e32d97":"code","89fc43c9":"code","8026edc2":"code","2962219b":"code","e0d70d19":"code","35dee82e":"code","2874e720":"code","f7370ae9":"code","8778e925":"code","06e90ecb":"code","6db198c4":"code","a841a15c":"code","ef9d9fa1":"code","f51b66c9":"code","42ff3b3a":"markdown","01597fdd":"markdown","6e22307b":"markdown","da5f9fca":"markdown","62883c21":"markdown"},"source":{"04e2675a":"%reload_ext autoreload\n%autoreload 2\n%matplotlib inline","22ba5e80":"from fastai.vision import *\nfrom fastai.metrics import error_rate","57e32d97":"monkey_images_path = '..\/input\/10-monkey-species\/'\ntfms = get_transforms()\ndata = ImageDataBunch.from_folder(monkey_images_path, train='training', valid='validation', ds_tfms=tfms, size=128)","89fc43c9":"print(data.classes)\nlen(data.classes),data.c","8026edc2":"data.show_batch()","2962219b":"!mkdir -p \/tmp\/.torch\/models\/\n!cp ..\/input\/resnet34\/resnet34.pth \/tmp\/.torch\/models\/resnet34-333f7ec4.pth\n!cp ..\/input\/resnet50\/resnet50.pth  \/tmp\/.torch\/models\/resnet50-19c8e357.pth","e0d70d19":"path_model='\/kaggle\/working\/'\npath_input='\/kaggle\/input\/'\nlearn_resnet34 = cnn_learner(data, models.resnet34, metrics=error_rate, model_dir=f'{path_model}')","35dee82e":"learn_resnet34.fit_one_cycle(4)","2874e720":"learn_resnet34.lr_find()\nlearn_resnet34.recorder.plot()","f7370ae9":"learn.unfreeze()\nlearn.fit_one_cycle(2, max_lr=slice(1e-03,1e-04))","8778e925":"learn_resnet50 = cnn_learner(data, models.resnet50, metrics=error_rate, model_dir=f'{path_model}')","06e90ecb":"learn_resnet50.fit_one_cycle(8)","6db198c4":"interp_resnet50 = ClassificationInterpretation.from_learner(learn_resnet50)\ninterp_resnet50.most_confused(min_val=2)","a841a15c":"interp_resnet38 = ClassificationInterpretation.from_learner(learn_resnet34)\ninterp_resnet38.most_confused(min_val=2)","ef9d9fa1":"interp_resnet38.plot_confusion_matrix(figsize=(12,12), dpi=60)","f51b66c9":"interp_resnet50.plot_confusion_matrix(figsize=(12,12), dpi=60)","42ff3b3a":"Try the same with resnet50. The results are even better.","01597fdd":"Model directory defaults to the dataset directory which is read-only in Kaggle. Change it to the working directory (\/kaggle\/working)","6e22307b":"The Resnet34 and Resnet50 models are added as input datasets. So we don't need to download them from internet. Copy them to cache folder. ","da5f9fca":"For some reason, the model works poorly wheen the learning rate is fine-tuned. Need to workout the optimal working rate (the default one seems to be good enough right now","62883c21":"The folder names for training and validation data is differnt from the IIT Pet Dataset. Fortunately it is easy to override with `train=` and `valid=` arguments. So we can load using from_folder method as in the course."}}