{"cell_type":{"51e752e6":"code","3e774402":"code","3f06346f":"code","db58878a":"code","607528d6":"code","65c02b83":"code","c78da432":"code","ae70d65d":"code","1cc46d93":"code","c840152c":"code","da3e45a2":"code","196593ea":"code","2ec9cb7d":"code","07dc8b5c":"code","f6f31280":"code","e51c7bb9":"code","5e6ed356":"code","d3dd4588":"code","dbe598d0":"code","efc5906a":"code","a37acfdc":"code","fd3799bc":"code","6224ae85":"code","7a3fc9de":"code","09d89939":"code","432caccc":"code","fa810820":"code","a9cd46b6":"code","fa8b1eee":"code","71fd4749":"code","ac2cc24e":"code","e686e71d":"code","3e04218d":"code","d1bdfe93":"code","7410d16a":"code","a6571682":"code","51e885cd":"code","42d1e63b":"code","f79b84db":"code","9a336c8b":"code","9c0051aa":"code","931b19d9":"markdown","38169f86":"markdown","9d067da4":"markdown","55a48575":"markdown","027245d9":"markdown","e41ad639":"markdown","5fc308ad":"markdown","83453206":"markdown","b170b200":"markdown","2e0a219d":"markdown","6ac1328b":"markdown","138db3d9":"markdown","3bc0039e":"markdown","f06fbc76":"markdown","b4f85dd4":"markdown","67830899":"markdown","ca896602":"markdown","ca7c6ca9":"markdown","3cac2250":"markdown","ca668694":"markdown","cdc62f61":"markdown","b7e71556":"markdown","4295eda4":"markdown","fe310536":"markdown","2eeaebc1":"markdown","a7143cb1":"markdown"},"source":{"51e752e6":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set_style('whitegrid')\n%matplotlib inline\n\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n\n# Any results you write to the current directory are saved as output.","3e774402":"loans = pd.read_csv(\"..\/input\/loan.csv\", low_memory=False) #Dataset","3f06346f":"# Checking the Dimensions of our dataset\n\nloans.shape","db58878a":"loans.columns","607528d6":"description = pd.read_excel('..\/input\/LCDataDictionary.xlsx').dropna()\ndescription.style.set_properties(subset=['Description'], **{'width' :'850px'})","65c02b83":"loans.info()","c78da432":"fig = plt.figure(figsize=(15,10))\nsns.heatmap(loans.isna(),cmap='inferno')","ae70d65d":"loans['loan_status'].value_counts()","1cc46d93":"target = [1 if i=='Default' else 0 for i in loans['loan_status']]\nloans['target'] = target\nloans['target'].value_counts()","c840152c":"nulls = pd.DataFrame(round(loans.isnull().sum()\/len(loans.index)*100,2),columns=['null_percent'])\n#sns.barplot(x='index',y='null_percent',data=nulls.reset_index())\nnulls[nulls['null_percent']!=0.00].sort_values('null_percent',ascending=False)","da3e45a2":"# Drop unneccesary columns\nloans = loans.drop(['url', 'desc', 'policy_code', 'last_pymnt_d', 'next_pymnt_d', 'earliest_cr_line', 'emp_title'], axis=1)\nloans = loans.drop(['id', 'title', 'total_rec_int', 'total_rec_late_fee', 'total_rec_prncp', 'zip_code'], axis=1)\n","196593ea":"loans['member_id'].value_counts().head(5)","2ec9cb7d":"loans.drop(['member_id'], axis=1, inplace=True)","07dc8b5c":"i = len(loans)\nloans = pd.DataFrame(loans[loans['loan_status'] != \"Does not meet the credit policy. Status:Fully Paid\"])\nloans = pd.DataFrame(loans[loans['loan_status'] != \"Does not meet the credit policy. Status:Charged Off\"])\nloans = pd.DataFrame(loans[loans['loan_status'] != \"Issued\"])\nloans = pd.DataFrame(loans[loans['loan_status'] != \"In Grace Period\"])\na = len(loans)\nprint(f\"We dropped {i-a} rows, a {((i-a)\/((a+i)\/2))*100}% reduction in rows\")","f6f31280":"# Number of each type of column\nsns.set(rc={'figure.figsize':(15,5)})\nsns.countplot(loans.dtypes,palette='viridis')\nplt.title('Number of columns distributed by Data Types',fontsize=20)\nplt.ylabel('Number of columns',fontsize=15)\nplt.xlabel('Data type',fontsize=15)","e51c7bb9":"# Let us see how many Object type features are actually Categorical\nloans.select_dtypes('object').apply(pd.Series.nunique, axis = 0)","5e6ed356":"sns.set(rc={'figure.figsize':(15,8)})\nsns.countplot(loans['emp_length'],palette='inferno')\nplt.xlabel(\"Length\")\nplt.ylabel(\"Count\")\nplt.title(\"Distribution of Employement Length For Issued Loans\")\nplt.show()","d3dd4588":"sns.set(rc={'figure.figsize':(15,10)})\nsns.violinplot(x=\"target\",y=\"loan_amnt\",data=loans, hue=\"pymnt_plan\", split=True,palette='inferno')\nplt.title(\"Payment plan - Loan Amount\", fontsize=20)\nplt.xlabel(\"TARGET\", fontsize=15)\nplt.ylabel(\"Loan Amount\", fontsize=15);","dbe598d0":"sns.set(rc={'figure.figsize':(15,6)})\nsns.boxplot(x='loan_amnt', y='loan_status', data=loans)","efc5906a":"sns.set(rc={'figure.figsize':(15,6)})\nsns.countplot(loans['grade'], palette='inferno')","a37acfdc":"loan_grades = loans.groupby(\"grade\").mean().reset_index()\n\nsns.set(rc={'figure.figsize':(15,6)})\nsns.barplot(x='grade', y='loan_amnt', data=loan_grades, palette='inferno')\nplt.title(\"Average Loan Amount - Grade\", fontsize=20)\nplt.xlabel(\"Grade\", fontsize=15)\nplt.ylabel(\"Average Loan Amount\", fontsize=15);","fd3799bc":"sns.set(rc={'figure.figsize':(15,10)})\nsns.violinplot(x=\"grade\", y=\"int_rate\", data=loans, palette='viridis', order=\"ABCDEFG\",hue='target',split=True)\nplt.title(\"Interest Rate - Grade\", fontsize=20)\nplt.xlabel(\"Grade\", fontsize=15)\nplt.ylabel(\"Interest Rate\", fontsize=15);","6224ae85":"sns.set(rc={'figure.figsize':(15,10)})\nsns.violinplot(x=\"target\",y=\"loan_amnt\",data=loans, hue=\"application_type\", split=True,palette='viridis')\nplt.title(\"Application Type - Loan Amount\", fontsize=20)\nplt.xlabel(\"TARGET\", fontsize=15)\nplt.ylabel(\"Loan Amount\", fontsize=15);","7a3fc9de":"sns.set(rc={'figure.figsize':(15,5)})\nsns.kdeplot(loans.loc[loans['target'] == 1, 'int_rate'], label = 'target = 1',shade=True)\nsns.kdeplot(loans.loc[loans['target'] == 0, 'int_rate'], label = 'target = 0',shade=True);\nplt.xlabel('Interest Rate (%)',fontsize=15)\nplt.ylabel('Density',fontsize=15)\nplt.title('Distribution of Interest Rate',fontsize=20);","09d89939":"state_default = loans[loans['target']==1]['addr_state']\n\nsns.set(rc={'figure.figsize':(15,5)})\nsns.countplot(state_default, order=state_default.value_counts().index, palette='viridis')\nplt.xlabel('State',fontsize=15)\nplt.ylabel('Number of loans',fontsize=15)\nplt.title('Number of defaulted loans per state',fontsize=20);","432caccc":"state_non_default = loans[loans['target']==0]['addr_state']\n\nsns.set(rc={'figure.figsize':(15,5)})\nsns.countplot(state_non_default, order=state_non_default.value_counts().index, palette='viridis')\nplt.xlabel('State',fontsize=15)\nplt.ylabel('Number of loans',fontsize=15)\nplt.title('Number of not-defaulted loans per state',fontsize=20);","fa810820":"loans.columns","a9cd46b6":"loans.shape","fa8b1eee":"loans.head(5)","71fd4749":"nulls = pd.DataFrame(round(loans.isnull().sum()\/len(loans.index)*100,2),columns=['null_percent'])\ndrop_cols = nulls[nulls['null_percent']>75.0].index\nloans.drop(drop_cols, axis=1, inplace=True)","ac2cc24e":"loans.shape","e686e71d":"loans.head(5)","3e04218d":"loans.columns","d1bdfe93":"loans['issue_d']= pd.to_datetime(loans['issue_d']).apply(lambda x: int(x.strftime('%Y')))\nloans['last_credit_pull_d']= pd.to_datetime(loans['last_credit_pull_d'].fillna(\"2016-01-01\")).apply(lambda x: int(x.strftime('%m')))","7410d16a":"loans.drop(['loan_status'],axis=1,inplace=True)","a6571682":"categorical = []\nfor column in loans:\n    if loans[column].dtype == 'object':\n        categorical.append(column)\ncategorical","51e885cd":"loans = pd.get_dummies(loans, columns=categorical)","42d1e63b":"loans.shape","f79b84db":"loans['mths_since_last_delinq'].fillna(loans['mths_since_last_delinq'].median(), inplace=True)","9a336c8b":"# Finally we are going to drop all the rows that contain null values\nloans.dropna(inplace=True)","9c0051aa":"sns.set(rc={'figure.figsize':(15,8)})\nsns.heatmap(loans.isna(),cmap='inferno')","931b19d9":"As expected, people who have defaulted their loans had no payment plan","38169f86":"Well, it can be seen that people who have worked for 10 or more years are more likely to take loans","9d067da4":"Let us see the overall distribution of interest rates now.","55a48575":"Additionally, we identified some rows that we decided were not relevant to our needs. The 'loan_status' column is the source of our answer to the core question if people are paying the loans they take out. We found some records with a loan_status of  \"Does not meet the credit policy\". We believe these may be older loans that would simply not be accepted under LendingClubs current criteria. As these data points will provide no value moving forward, we've ecluded them from our data. Similiarily, recently issued loans could mislead our analysis, as no payment has been expected yet.","027245d9":"Now I am going to drop columns that have more than 75% null values","e41ad639":"We should have a look at the interest rates offered for these loan grades.","5fc308ad":"In this kernel I will be going over the Lending Club Loan Data. The data has a lot of features, some are useful and some are not, some features have a lot of missing values too. I will try to clean this data and make it ready for a great predictive model. <br>\nData Available at: https:\/\/www.kaggle.com\/wendykan\/lending-club-loan-data","83453206":"Now I would like to know what kind of loans Lending Club usually issues?\nI guess this can be answered by having look at Loan Grade that Lending Club assigns.","b170b200":"To which state most of the defaulted loan cases belong?","2e0a219d":"So most of the defaulted loans were issued to individuals. Two or more people who take loans have lower chances of defaulting","6ac1328b":"# Playing with Lending Club's Loan Data","138db3d9":"Now I would like to know the distribution of Data types","3bc0039e":"Another thing we would want to examine is that how many loans have a default loan status in comparison to other loans. A common thing to predict in datasets like these are if a new loan will get default or not. I'll be keeping loans with default status as my target variable.","f06fbc76":"Since most of the loans are of B Grade, we should have a look at their loan amounts too","b4f85dd4":"Average loan amount of B grade loans is the least of all grades. I guess the higher the grade, lower the loan amount is issued","67830899":"Now we need to familiarize ourselves with this dataset, and we should understand what these columns represent.","ca896602":"Since no customer has taken loan again, we can drop member id too.","ca7c6ca9":"# Cleaning The Data","3cac2250":"It is evident from the above heatmap that our dataset contains a lot of missing values and we can not use feature that has so many missing values.","ca668694":"As I mentioned earlier, there are some columns\/features that are not required. We have already dropped those features.","cdc62f61":"Now we should convert date object columns to integer years or months so that we can easily encode other categorical features without exhausting our resources. For filling the dates, I am gonna use the most used dates in that feature","b7e71556":"# Exploratory Data Analysis","4295eda4":"There are several columns that fit into one of the following categories:\n\nUnneccesary data such as the URL to view the loan <br>\nRedundant data. Loan description may be useful to some, but loan purpose fits our needs <br>\nUser provided information. Employer titles may offer some insight into employment industry, but would need significant cleanup to provide useful statistics <br>\nOperational data. The next payment date for the loan at the time the data was generated is not relevant to us ","fe310536":"We should have a look at the distribution of Employement Lengths too","2eeaebc1":"I think my previous assumption was right. The higher the loan amount, higher the interest rate.","a7143cb1":"### Summary <br> <br>\nSince most of the customers have been employed for 10+ years, the **majority of Lending Club's customers are 30+ years of age**.  <br>\nInterest rate varies wildly, reaching **nearly 30%** for high-risk loans <br>\nGrade A has the **lowest interest rate** around 7% <br>\nGrade G has the **highest interest rate** above 25% <br>\nThe **lower the grade, the higher loan amount** loan issued <br>\nFully Paid loans tend to be smaller. This could be due to the age of the loans <br>\nDefault has the highest count among other loan status. <br>\n**In Grace Period** and **Late(16~30 days)** have the highest loan amount and mean. <br>\nMost of the loans have interest rates between **12% and 18%** <br>\nAll the loans that have been defaulted are from **individuals** rather than from two or more people. <br>\n**California** has the most defaulted and non-defaulted loans out of all the states in US <br>\n**States** are not a distinguishing feature for predicting the defaulted loans."}}