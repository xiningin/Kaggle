{"cell_type":{"7d474cc6":"code","a67ae6c8":"code","1266b9c0":"code","095153f7":"code","587b831a":"code","ff69a9c0":"code","b4214601":"code","3cf1d66b":"code","7c52ef30":"code","08b6a594":"code","729bb585":"code","9e0eeb0a":"code","cd021107":"code","dcb04872":"code","0d96a93b":"code","e922b2d3":"code","049ff5f8":"code","39f1bd84":"code","0f519229":"code","7d5eaa7e":"markdown","f124fa30":"markdown","9cfa3c1c":"markdown","ec07f90f":"markdown","5ca6abff":"markdown","35f0a222":"markdown","d4787d63":"markdown","d7dac420":"markdown","703f47ea":"markdown","f03842d5":"markdown","ce28586e":"markdown","6e6e7616":"markdown","5f3e064a":"markdown","bc2e42cf":"markdown"},"source":{"7d474cc6":"#Importaci\u00f3n de las librer\u00edas de inter\u00e9s\nimport numpy as np                # linear algebra\nimport pandas as pd               # data frames\nimport seaborn as sns             # visualizations\nimport matplotlib.pyplot as plt   # visualizations\nimport scipy.stats                # statistics\n\nfrom scipy.cluster.hierarchy import dendrogram, linkage\nfrom scipy.cluster.hierarchy import complete, fcluster #Cluster Jerarquico Completo\n\nfrom sklearn import preprocessing\nfrom sklearn.cluster import KMeans\nfrom sklearn.decomposition import PCA\n\nimport os\nprint(os.listdir(\"..\/input\"))","a67ae6c8":"#Se renombra la base de datos a trabajar y se realiza la exploraci\u00f3n inicial\ndf = pd.read_csv(\"..\/input\/heart.csv\")\n\n# Print the head of df\nprint(df.head())\n# Print the info of df\nprint(df.info())\n# Print the shape of df\nprint(df.shape)","1266b9c0":"#M\u00e9didas b\u00e1sicas para todas las variables\ndf.describe()","095153f7":"#\u00bfLa base est\u00e1 balaceada?\ndf.isnull().sum()","587b831a":"#histograma para variables continuas\nf, axes = plt.subplots(2,2, figsize=(20, 12))\nf.suptitle(\"Distribuci\u00f3n variables continuas\", fontsize=20)\nsns.distplot( df[\"age\"], ax=axes[0,0])\nsns.distplot( df[\"chol\"], ax=axes[0,1])\nsns.distplot( df[\"thalach\"], ax=axes[1,0])\nsns.distplot( df[\"oldpeak\"], ax=axes[1,1])","ff69a9c0":"#Histogramas para las variables categoricas \nfig, axes = plt.subplots(nrows=2, ncols=4, figsize=(18, 10))\nfig.suptitle(\"Distribuci\u00f3n de frecuencias para las variables categoricas\", fontsize=20)\n\nx = ['Mujer','Hombre'];y = df.sex.value_counts(sort = False).values\naxes[0][0].bar(x,y);axes[0][0].set_title('Sexo')\n\nx = ['Typical','Atypical','Non-Anginal','Aysyptomatic'];y = df.cp.value_counts(sort = False).values\naxes[0][1].bar(x,y);axes[0][1].set_title('Dolor en el Pecho-cp')\n\nx = ['<120 mg\/dl','>120 mg\/dl'];y = df.fbs.value_counts(sort = False).values\naxes[0][2].bar(x,y);axes[0][2].set_title('Az\u00facar sangre ayunas-fbs')\n\nx = ['Regular','Abnormality','Severe'];y = df.restecg.value_counts(sort = False).values\naxes[0][3].bar(x,y);axes[0][3].set_title('Electrocardiograma-restecg')\n\nx = ['No','Si'];y = df.exang.value_counts(sort = False).values\naxes[1][0].bar(x,y);axes[1][0].set_title('Angina por ejercicio-exang')\n\nx = ['Downward','Flat','Upward'];y = df.slope.value_counts(sort = False).values\naxes[1][1].bar(x,y);axes[1][1].set_title('ST excercise peak-slope')\n\nx = ['None','Normal','Fixed Defect','Reversable Defect'];y = df.thal.value_counts(sort = False).values\naxes[1][2].bar(x,y);axes[1][2].set_title('Thalium Stress Test - Thal')\n\nx = ['No','Si'];y = df.target.value_counts(sort = False).values\naxes[1][3].bar(x,y);axes[1][3].set_title('Enfermedad Coronaria - Target')\n\nplt.show()","b4214601":"#los nombres no dicen mucho, entonces se renombraran\ndf=df.rename(columns={'age':'Edad','sex':'Sexo','cp':'Dolor_pecho','trestbps':'Presi\u00f3n','chol':'Colesterol','fbs':'Az\u00facar >120','restecg':'Electro','thalach':'Ritmo_cardiaco','exang':'Angina_ejercicio','oldpeak':'Depresi\u00f3n_ST ','slope':'Pico_ejercicio','ca':'Vasos_Ppales','thal':'Defecto','target':'Diagnostico'})\ndf.columns","3cf1d66b":"# Compute the correlation matrix\ncorr=df.corr()\n\n# Generate a mask for the upper triangle\nmask = np.zeros_like(corr, dtype=np.bool);mask[np.triu_indices_from(mask)] = True\n\n# Set up the matplotlib figure\nf, ax = plt.subplots(figsize=(11, 9))\n\n# Generate a custom diverging colormap\ncmap = sns.diverging_palette(220, 10, as_cmap=True)\n\n# Draw the heatmap with the mask and correct aspect ratio\nsns.heatmap(corr, mask=mask, cmap=cmap, center=0,square=True, linewidths=.5, cbar_kws={\"shrink\": .5})","7c52ef30":"#Grafico de violin\nf, axes = plt.subplots(1,2, figsize=(20, 12))\nf.suptitle(\"Ritmo cardiaco Vs. Prueba esfuerzo y tipo de dolor de pecho\", fontsize=20)\n\nsns.catplot(x=\"Pico_ejercicio\", y=\"Ritmo_cardiaco\", hue=\"Diagnostico\",kind=\"violin\", split=True, data=df,ax=axes[0] )\nsns.catplot(x=\"Dolor_pecho\", y=\"Ritmo_cardiaco\", hue=\"Diagnostico\",kind=\"violin\", split=True, data=df, ax=axes[1] ) ","08b6a594":"fig, axes = plt.subplots(nrows=1, ncols=2, figsize=(18, 10))\nfig.suptitle(\"Ritmo cardiaco Vs. Prueba esfuerzo y tipo de dolor de pecho\", fontsize=20)\n\nsns.catplot(x=\"Dolor_pecho\", y=\"Ritmo_cardiaco\", hue=\"Diagnostico\",kind=\"point\", ax=axes[0],data=df )\nsns.catplot(x=\"Pico_ejercicio\", y=\"Ritmo_cardiaco\", hue=\"Diagnostico\",kind=\"point\", data=df,ax=axes[1])","729bb585":"#Codificando las variables categoricas\ndf = pd.read_csv(\"..\/input\/heart.csv\")\n#creamos variables categoricas separadas y quitamos una para no generar problemas de multicolinealidad\ndf_dum=pd.get_dummies(df,columns=[\"sex\",\"cp\",\"fbs\",\"restecg\",\"exang\",\"slope\",\"thal\",\"target\"],drop_first=True)\ndf_dum.describe()","9e0eeb0a":"heart_scale = df_dum\nscaler = preprocessing.StandardScaler()\ncolumns =df_dum.columns\nheart_scale[columns] = scaler.fit_transform(heart_scale[columns])\nheart_scale.head()","cd021107":"#Primero generamos un dendograma y generamos la matriz de distancias \"Z\" que se requiere para \n#el cluster jerarquico completo\n\nZ = linkage(heart_scale.loc[:,[\"thalach\",\"cp_1\",\"cp_2\",\"cp_3\",\"target_1\",\"slope_1\",\"slope_2\"]], 'complete', metric='euclidean')\nfig = plt.figure(figsize=(25, 10))\ndn = dendrogram(Z)\nplt.show()\n","dcb04872":"#Pasamos a generar los cluster, para lo cual definimos K=5 y K=3\n#conforme a la informaci\u00f3n del dendograma\n\nh_cluster=df.copy()\nh_cluster['5_clust']=fcluster(Z,t=5, criterion='distance')\nh_cluster['3_clust']=fcluster(Z,t=3, criterion='distance')\nh_cluster.head()","0d96a93b":"# Compute the correlation matrix\ncorr_cluster=h_cluster.corr()\n\n# Generate a mask for the upper triangle\nmask = np.zeros_like(corr_cluster, dtype=np.bool)\nmask[np.triu_indices_from(mask)] = True\n\n# Set up the matplotlib figure\nf, ax = plt.subplots(figsize=(11, 9))\n\n# Generate a custom diverging colormap\ncmap = sns.diverging_palette(220, 10, as_cmap=True)\n\n# Draw the heatmap with the mask and correct aspect ratio\nsns.heatmap(corr_cluster, mask=mask, cmap=cmap, center=0,\n            square=True, linewidths=.5, cbar_kws={\"shrink\": .5})\n\n","e922b2d3":"#los nombres no dicen mucho, entonces se renombraran\nh_cluster=h_cluster.rename(columns={'age':'Edad','sex':'Sexo','cp':'Dolor_pecho','trestbps':'Presi\u00f3n','chol':'Colesterol','fbs':'Az\u00facar >120','restecg':'Electro','thalach':'Ritmo_cardiaco','exang':'Angina_ejercicio','oldpeak':'Depresi\u00f3n_ST ','slope':'Pico_ejercicio','ca':'Vasos_Ppales','thal':'Defecto','target':'Diagnostico'})\nh_cluster.columns\n\nfig, axes = plt.subplots(1,2, figsize=(18, 10))\nfig.suptitle(\"grupos de pancientes\", fontsize=20)\n\nsns.catplot(x=\"Dolor_pecho\", y=\"Ritmo_cardiaco\", hue=\"Diagnostico\",col=\"5_clust\", aspect=.6,\n            kind=\"swarm\", data=h_cluster);\n\nsns.catplot(x=\"Pico_ejercicio\", y=\"Ritmo_cardiaco\", hue=\"Diagnostico\",col=\"5_clust\", aspect=.6,\n            kind=\"swarm\", data=h_cluster);\n","049ff5f8":"#Primero generamos un dendograma y generamos la matriz de distancias \"Z\" que se requiere para \n#el cluster jerarquico sencillo\n\nZ = linkage(heart_scale.loc[:,[\"thalach\",\"cp_1\",\"cp_2\",\"cp_3\",\"target_1\",\"slope_1\",\"slope_2\"]],\n            'single', metric='euclidean')\nfig = plt.figure(figsize=(25, 10))\ndn = dendrogram(Z)\nplt.show()","39f1bd84":"#Pasamos a generar los cluster, para lo cual definimos K=3\n#conforme a la informaci\u00f3n del dendograma\n\nh_single=df.copy()\nh_single['3_clust']=fcluster(Z,t=5, criterion='distance')\n\nh_single.head()","0f519229":"# Compute the correlation matrix\ncorr_single=h_single.corr()\n\n# Generate a mask for the upper triangle\nmask = np.zeros_like(corr_single, dtype=np.bool)\nmask[np.triu_indices_from(mask)] = True\n\n# Set up the matplotlib figure\nf, ax = plt.subplots(figsize=(11, 9))\n\n# Generate a custom diverging colormap\ncmap = sns.diverging_palette(220, 10, as_cmap=True)\n\n# Draw the heatmap with the mask and correct aspect ratio\nsns.heatmap(corr_single, mask=mask, cmap=cmap, center=0,\n            square=True, linewidths=.5, cbar_kws={\"shrink\": .5})","7d5eaa7e":"**Objetivo: K-Means y Jerarquico \"Complete\"**\n\nSe reclasificar\u00e1 la informaci\u00f3n en *clusters* usando los m\u00e9todos Jerarquico *Complete* y *Single* de *Machine Learning *(ML), no supervisado, y se compraran las diferencias entre los resultados.\n\nLa [base de datos](https:\/\/archive.ics.uci.edu\/ml\/datasets\/Heart+Disease) tiene informaci\u00f3n sobre pacientes de la ciudad de Cleveland, con  variables usadas en varios estudios para determinar si un paciente tiene una enfermedad del coraz\u00f3n y finalmente el diagnostico de enfermedad cardiaca.\n","f124fa30":"**Hierarchical clustering \/ Complete**\n\nAhora que tenemos la base normalizada aplicaremos el algoritmo de clusterin herarquico completo para las variables que m\u00e1s se relacionan con la posibilidad de tener un infarto.","9cfa3c1c":"**Analisis Exploratorio de Datos B\u00e1sico**","ec07f90f":"Las variables Edad y colesterol parecen tener una distribuci\u00f3n m\u00e1s o menos normal,thalach (ritmo card\u00edaco m\u00e1ximo alcanzado) parece tener un ligero sesgo a la derecha y claramente oldpeak (Depresi\u00f3n ST inducida por el ejercicio en relaci\u00f3n con el descanso) se consentra alrededor de cero, indicando que la poca tolerancia al esfuerzo sobresale en los pacientes. Se resalta que la media de la edad se ubica alrededor de los 55 a\u00f1os.","5ca6abff":"Nos arroj\u00f3 solo 3 clusters","35f0a222":"**Los Clusters**\n\nCluster 1 = Corazones felices\n\nCluster 2= No te esfuerces Coraz\u00f3n!\n\nCluster 3= Corazones en riesgo controlable\n\ncluster 4= Riesgo eventual, pero si le duele vaya a urgencias\n\nCluter 5 = Cuidado","d4787d63":"**Los histogramas nos dan mucha informaci\u00f3n de las variables categoricas:**\n\nLa incidencia de la enfermedad coronaria (Target) afecta a casi la mitad de la poblaci\u00f3n (46%) y la mayor\u00eda de los pacientes son mujeres. Asimismo, el dolor de pecho (cp) m\u00e1s frecuente en la \"tipica angina\", seguido por \"no dolor anginal\". Por su parte las anginas no son producto del ejercicio. \n\nEn cuanto a los recursos diagnosticos, la mayor\u00eda de los pacientes presentan defectos fijos o reversibles (thalium stress-thal);  picos de esfuerzo planos o al alza (ST excercise peak-slope) y electrocardigramas no severos. Curiosamente no tienen az\u00facar alta, parece que esta variable tiene poca incidencia en los pacientes cardiacos.\n\nNo obstante, los histogramas no nos dicen c\u00f3mo se relacionan estas variables con tener o no una enfermedad cardiaca. ","d7dac420":"A diferencia del complete, el m\u00e9todo single no arroja una clasificaci\u00f3n con correlaci\u00f3n significativa. Nos quedamos con \"complete\" para este caso.\n\n**Clusters Complete**\n\nCluster 1 = Corazones felices\n\nCluster 2= No te esfuerces Coraz\u00f3n!\n\nCluster 3= Corazones en riesgo controlable\n\ncluster 4= Riesgo eventual, pero si le duele vaya a urgencias\n\nCluter 5 = Cuidado","703f47ea":"**Transformaci\u00f3n de los datos**\n\nPara poder hacer clusters es importante estandarizar primero los datos y quitar el efecto magnitud de ellos. ","f03842d5":"Definitivamente un mayor ritmo cardiaco parace tener una mayor incidencia en una enfermedad coronaria, sobre todo si existe alg\u00fan dolor en el pecho. Esto lo vemos mejor en el siguiente gr\u00e1fico:","ce28586e":"**Resultado primer acercamiento a la base:** Informaci\u00f3n para 303 pacientes con 14 variables numericas, sin informaci\u00f3n faltante. Las variables relacionadas son: \n\n**age**: edad en a\u00f1os\n**sex:** 0 para hombre y 1 para mujer\n**cp:** tipo de dolor en el pecho (0, 1, 2, 3 y 4:  typical angina, atypical angina, non-anginal pain y asymptomatic. No dice, que n\u00famero representa que tipo de dolor, pero se asumen en el orden en el que estan)\n**trestbps**: Presi\u00f3n arterial en reposo (en mm Hg al ingreso en el hospital)\n**chol**: Colesterol s\u00e9rico en mg \/ dl\n**fbs:** 1: Az\u00facar en sangre ayunas >120 mg\/dl y 0: Az\u00facar en sangre ayunas <120 mg\/dl\n**restecg**:Resultados electrocardiogr\u00e1ficos en reposo. ( 0: normal,  1: anomal\u00eda de la onda ST-T y 2: muestra la hipertrofia ventricular izquierda probable o definitiva seg\u00fan los criterios de Estes)\n**thalach**: ritmo card\u00edaco m\u00e1ximo alcanzado\n**exang**: angina inducida por el ejercicio (1 = s\u00ed; 0 = no)\n**oldpeak**:Depresi\u00f3n ST inducida por el ejercicio en relaci\u00f3n con el descanso.\n**slope**:La pendiente del segmento pico del ejercicio ST. (0: pendiente ascendente, 1: plano y 2: bajada)\n**ca**: n\u00famero de vasos principales (0-3) coloreados por fluoroscopia \n**thal:** 3 = normal; 6 = defecto fijo; 7 = defecto reversible (no se corresponde con los c\u00f3digos de la base.\n**target:** Diagn\u00f3stico de enfermedad card\u00edaca (estado de enfermedad angiogr\u00e1fica; 0: <50% de di\u00e1metro de estrechamiento y 1: > 50% de di\u00e1metro de estrechamiento.)\n\n***Nota:*** La descripci\u00f3n de algunas variables no se corresponde con sus valores en la base.\n","6e6e7616":"Al parecer las variables m\u00e1s relacionadas con tener una enfermedad cardiaca son el tipo de dolor en el pecho (cp), el ritmo cardiaco (thalach) y la relaci\u00f3n de pendiente entre el pico del ejercicio y el descanso (slope). Gr\u00e1fiquemos la relaci\u00f3n entre variables.","5f3e064a":"**Hierarchical clustering \/ Single**\n","bc2e42cf":"Observamos que las variables \"5_clust\" y \"3_clust\" tienen una alta correlaci\u00f3n con el diagnostico, pero al parecer 5 clusteres tienes mayor relaci\u00f3n."}}