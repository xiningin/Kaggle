{"cell_type":{"f5925e37":"code","e29339df":"code","f86d660e":"code","f28888d6":"code","79883079":"code","f9f7b157":"code","206ba994":"code","f503b6a9":"code","90edcb33":"code","68798d22":"code","b9c60ac9":"code","1c6947a9":"code","d1be9b87":"code","6541fe03":"code","fc35ac8b":"code","b9b8c432":"code","df5fc462":"code","a8fc013b":"code","52cd51dd":"markdown","358484e4":"markdown","e0f41212":"markdown","0cbfc9ed":"markdown","246d7be2":"markdown","1068a9d6":"markdown","e7b2393a":"markdown","35f96c62":"markdown","c8c230bc":"markdown","9fc5c533":"markdown","d3f7f541":"markdown","c1d21608":"markdown","f7e7833a":"markdown","e3643253":"markdown","cc0b57ad":"markdown","3c2db2dc":"markdown","ef1994cf":"markdown"},"source":{"f5925e37":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\n\nimport plotly.express as px\nimport plotly.subplots as psp\n\nimport re\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 20GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","e29339df":"# report 2005 - 2020\npath_report = '\/kaggle\/input\/world-happiness-report-2021\/world-happiness-report.csv'\ndf = pd.read_csv(path_report)\n\ndf['Yearly Ranking'] = df.groupby('year')['Life Ladder'].rank(method='first',ascending=False)\ndf['Inverse Yearly Ranking'] = df.groupby('year')['Life Ladder'].rank(method='first')\n\n# report 2021\npath_report_2021 = '\/kaggle\/input\/world-happiness-report-2021\/world-happiness-report-2021.csv'\ndf_2021 = pd.read_csv(path_report_2021)","f86d660e":"df_top_happiness = df.query(\"`Yearly Ranking` <= 10\").sort_values('year')\n\nranking_happiness = px.bar(\n    df_top_happiness,\n    x='Life Ladder',\n    y='Yearly Ranking',\n    animation_frame='year',\n    animation_group='Country name',\n    color='Country name',\n    text='Country name',\n    title='Happiness score - Top 10 countries',\n    orientation='h',\n    range_x=[0,8.5]\n)\n\nranking_happiness.layout.updatemenus[0].buttons[0].args[1][\"frame\"][\"duration\"] = 2000\nranking_happiness.update_layout(showlegend=False)\n\nranking_happiness.update_yaxes(\n    autorange='reversed',\n    tickmode='linear'\n)\n\nranking_happiness.show()","f28888d6":"series_top_appearences = df_top_happiness['Country name'].value_counts()\n\ndf_regions = df_2021[['Country name','Regional indicator']].set_index('Country name')\n\ndf_top_appearences = series_top_appearences.to_frame(name='Total appearences').reset_index(level=0)\ndf_top_appearences = df_top_appearences.rename(columns={'index':'Country name'})\ndf_top_appearences = df_top_appearences.join(df_regions, on='Country name')\n\ntop_appearences = px.sunburst(\n    df_top_appearences,\n    path=['Regional indicator','Country name'],\n    values='Total appearences',\n    title='Total appearence of countries in the top 10 list'\n)\n\ntop_appearences.show()","79883079":"df_bottom_happiness = df.query(\"`Inverse Yearly Ranking` <= 10\").sort_values('year')\n\nranking_happiness = px.bar(\n    df_bottom_happiness,\n    x='Life Ladder',\n    y='Inverse Yearly Ranking',\n    animation_frame='year',\n    animation_group='Country name',\n    color='Country name',\n    text='Country name',\n    title='Happiness score - Bottom 10 countries',\n    orientation='h',\n    range_x=[0,7]\n)\n\nranking_happiness.layout.updatemenus[0].buttons[0].args[1][\"frame\"][\"duration\"] = 2000\nranking_happiness.update_layout(showlegend=False)\n\nranking_happiness.update_yaxes(\n    autorange='reversed',\n    tickmode='linear'\n)\n\nranking_happiness.show()","f9f7b157":"series_bottom_appearences = df_bottom_happiness['Country name'].value_counts()\n\ndf_regions = df_2021[['Country name','Regional indicator']].set_index('Country name')\n\ndf_bottom_appearences = series_bottom_appearences.to_frame(name='Total appearences').reset_index(level=0)\ndf_bottom_appearences = df_bottom_appearences.rename(columns={'index':'Country name'})\ndf_bottom_appearences = df_bottom_appearences.join(df_regions, on='Country name')\ndf_bottom_appearences.fillna('Sub-Saharan Africa',inplace=True)\n\nbottom_appearences = px.sunburst(\n    df_bottom_appearences,\n    path=['Regional indicator','Country name'],\n    values='Total appearences',\n    title='Total appearence of countries in the bottom 10 list'\n)\n\nbottom_appearences.show()","206ba994":"df_top = df_top_appearences.value_counts('Regional indicator').to_frame(name='Total appearences').reset_index(level=0)\ndf_top['Ranking Position'] = 'Top'\ndf_top.sort_values('Regional indicator',inplace=True)\n\ndf_bottom = df_bottom_appearences.value_counts('Regional indicator').to_frame(name='Total appearences').reset_index(level=0)\ndf_bottom['Ranking Position'] = 'Bottom'\ndf_bottom.sort_values('Regional indicator',inplace=True)\n\ndf_appearnces = pd.concat((df_top,df_bottom))\n\ndf_appearnces['Countires appearing'] = 'all'\n\nfig = px.bar(\n    df_appearnces,\n    x='Total appearences',\n    y='Countires appearing',\n    range_x=[0,df_appearnces['Total appearences'].sum()],\n    color='Ranking Position',\n    hover_data={'Ranking Position':True,'Regional indicator':True,'Total appearences':True,'Countires appearing':False},\n    orientation='h',\n    title='Number of distinct counties appearing in the top\/bottom of the ranking',\n    height=250\n)\n\nfig.update_yaxes(showticklabels=False)\n\nfig.show()","f503b6a9":"fig = px.violin(\n    df,\n    x='year',\n    y='Life Ladder',\n    range_y=[1.5,10],\n    points='all',\n    title='Distribution of Happiness score throughout the years'\n)\n\ndf_countries = df.groupby('year')['Life Ladder'].agg('count').to_frame(name='total countries').reset_index()\n\nfor year, n_countries in df_countries.to_numpy():\n\n    fig.add_annotation(\n        x=year,\n        y=9.5,\n        text=str(n_countries),\n        showarrow=False,\n        bordercolor=\"#94c5d1\",\n        borderwidth=2,\n        borderpad=4,\n        bgcolor=\"#65a2db\"\n    )\n\nfig.show()","90edcb33":"px.choropleth(\n    df_2021,\n    locations='Country name',\n    locationmode='country names',\n    color='Ladder score',\n    title='Happiness index - world view'\n)","68798d22":"px.box(\n    data_frame=df_2021,\n    x='Regional indicator',\n    y='Ladder score',\n    color='Regional indicator',\n    title='Happines index - regional distribution'\n)","b9c60ac9":"world_region = 'Latin America and Caribbean'","1c6947a9":"index_fields = [\n    'Regional indicator',\n    'Country name',\n    'Ladder score',\n    'Standard error of ladder score'\n]\n\nindex_explained = {\n    'Dystopia + residual' : 'Dystopia + Residuals',\n    'Explained by: Social support' : 'Social support',\n    'Explained by: Perceptions of corruption' : 'Perceived corruption',\n    'Explained by: Healthy life expectancy' : 'Life expectancy',\n    'Explained by: Freedom to make life choices' : 'Freedom',\n    'Explained by: Generosity' : 'Generosity',\n    'Explained by: Log GDP per capita' : 'Log GDP per capita'\n}\n\ndf_index_score = df_2021[index_fields+list(index_explained.keys())].rename(columns=index_explained)\n\ndf_index_score = df_index_score.melt(\n    id_vars=index_fields,\n    value_vars=list(index_explained.values()),\n    var_name='Explained by',\n    value_name='Contribution to score'\n)\n\ndf_region_score = df_index_score.query(\"`Regional indicator` == '{}'\".format(world_region))\n\nregion_plot = px.bar(\n    data_frame=df_region_score,\n    x='Country name',\n    y='Contribution to score',\n    color='Explained by',\n    title='Happiness index for {}'.format(world_region)\n)\n\nregion_plot.update_traces(\n    patch={'error_y': {'array': df_region_score['Standard error of ladder score'].to_numpy()}},\n    selector={'name': 'Log GDP per capita'}\n)\n\nregion_plot.add_hline(\n    y=df_2021.loc[0,'Ladder score in Dystopia'],\n    line_width=2,\n    line_dash=\"dash\"\n)\n\nregion_plot.add_annotation(\n    text=\"Dystopia score\",\n    xref=\"paper\",\n    yref=\"paper\",\n    x=1.13,\n    y=0.3,\n    showarrow=False\n)\n\nregion_plot.show()","d1be9b87":"df_2021['Ranking'] = df_2021['Ladder score'].rank(method='first',ascending=False)\n\nn_top = 5\nn_bot = df_2021['Ranking'].count() - 5\n\ndf_2021_top = df_2021.query(\"Ranking <= {}\".format(n_top)).copy()\ndf_2021_bottom = df_2021.query(\"Ranking > {}\".format(n_bot)).copy()\n\ndf_2021_top['Ranking position'] = 'top'\ndf_2021_bottom['Ranking position'] = 'bottom'\n\ndf_2021_rank = pd.concat((df_2021_top,df_2021_bottom)).sort_values('Ladder score')\n\nfig = px.bar(\n    df_2021_rank,\n    x='Ladder score',\n    y='Country name',\n    color='Ranking position',\n    title='Happiness Index - Top and bottom countries'\n)\n\nfig.data[0].marker = {'color': '#d12e13'}\nfig.data[1].marker = {'color': '#46b361'}\n\nfig.show()","6541fe03":"df_2021['GDP per capita'] = np.exp(df_2021['Logged GDP per capita'])\n\nhappiness_measures = [\n    'GDP per capita',\n    'Social support',\n    'Healthy life expectancy',\n    'Freedom to make life choices',\n    'Generosity',\n    'Perceptions of corruption'\n]\n\ndf_happiness_measures = df_2021[['Regional indicator']+happiness_measures]\n\ndf_happiness_measures = df_happiness_measures.melt(\n    id_vars='Regional indicator',\n    value_vars=happiness_measures,\n    var_name='Happiness measure',\n    value_name='Measure value'\n)\n\nhappiness_plot = px.box(\n    data_frame=df_happiness_measures,\n    x='Regional indicator',\n    y='Measure value',\n    color='Regional indicator',\n    facet_row='Happiness measure',\n    title='Happines index - regional distribution',\n    height=2000\n)\n\nhappiness_plot.for_each_annotation(lambda a: a.update(text=a.text.split(\"=\")[-1]))\nhappiness_plot.update_yaxes(matches=None,showticklabels=True)\n\nhappiness_plot.show()","fc35ac8b":"px.imshow(\n    df_2021[['Ladder score']+happiness_measures].corr(),\n    title='Happiness measures - correlations'\n)","b9b8c432":"px.scatter(\n    df_2021,\n    x='Healthy life expectancy',\n    y='Ladder score',\n    color='Regional indicator',\n    size='GDP per capita',\n    title='Happiness measures - life expectancy vs happiness'\n)","df5fc462":"px.scatter(\n    df_2021,\n    x='Freedom to make life choices',\n    y='Perceptions of corruption',\n    color='Regional indicator',\n    size='GDP per capita',\n    title='Happiness measures - freedom vs corruption'\n)","a8fc013b":"px.scatter(\n    df_2021,\n    x='Social support',\n    y='Healthy life expectancy',\n    color='Regional indicator',\n    size='GDP per capita',\n    title='Happiness measures - social support vs life expectancy'\n)","52cd51dd":"### Distribution of the Happiness index\n\nFrom the animation, we get an idea of the tails of the distribution of Happiness scores, but not of the distributions as a whole. Furthermore, we see that when the study started in 2005, the bottom countries had an unusal high score, compare to those in the following years. This suggest that when the study started, not many countries where accounted for.\n\nHere, we plot the distribution of the Happiness score at different years, together with the number of countires accounted for that year.","358484e4":"### Happiness measures analysis\n\nHere we have a look at the measures used to compute the happiness index. We consider their distribution in different geographical regions, as well as their correlations and trends.","e0f41212":"It seems that Western countires are consistently at the top of the ranking, in particular the Norther European ones. Let's take a better look at how often each counties appears in the top 10.","0cbfc9ed":"Interestingly, Denmark is the one country that appear every time since the ranking was made.\n\n### Bottom 10 Countries","246d7be2":"From the above correlation matrix we see how Happiness score, GDP per capita, Social support, Life expectancy and Freedom are positively correlated with one another, while the perception of corruption is negatively correlated with these measures. On the other hand, generosity is only weakly correlated with the other measures.\n\nLet's visualize these quantities against one another, to better understand their relation.","1068a9d6":"Indeed, African counties overwelmingly populate the bottom of the ranking. However, it is interesting to notice that the countries at the bottom of the list tend to change from year to year, while this seems not to be the case for the ones on top of the ranking.\n\n### Distinct countries at bottom\/top of the ranking\n\nWe can better visualize this phenomenon by showing the number of distinct countires appearing in the top\/bottom of the Happiness ranking throughout the years,","e7b2393a":"It seems that the countries with highest Happiness score are sitauted in Europe, North America, and Oceania. Let's explore a bit more.\n\n### Happiness index\n\nFirst, we can check how the score is distributed in the different regional zones,","35f96c62":"The above plot very clearly show how the Happiness score is positively correlated with both the life expectancy and the GDP per capita. ","c8c230bc":"In the above figure, the number in the squared box is the total number of countries surveyed on the correspondin year. We see that during the first few years, the study was limited to a fewer countries than it was later on, and that in 2020 the number of counties studied dropped significantly, possibly due to the COVID-19 pandemic.\n\n## World Happiness Report 2021\n\nWe can now focus on this year report. First, let's have a bird eye look at the happiness index on the geographical map. ","9fc5c533":"The above figure seems to confirm the impression we had, that Europe, North America and Oceania are the regions with highest Happiness score.\n\nLet's check the Happiness score of each country within a given world region, explaied by different measures such as the amount of social support available, the life expectancy, and so on.\n\nYou can replace the field below with any other available region to check the Happiness score of the countries.","d3f7f541":"## World Happiness Report 2005-2020\n\nLet's start with an animation of the happiness score obtained by the top and bottom 10 countries throughout the years.\n\n### Top 10 Countries","c1d21608":"We see that, in countries with a high social support and high GDP per capita, the life expectance tends to be high. Vice versa, when the social support is lacking, and the country has a low GDP per capita, the life expectance is generally low. ","f7e7833a":"It seems that a large number of countries at the bottom of the ranking are from the African continent. Let' check whether this is indeed the case,","e3643253":"It gives some info, but it is also a lot to digest and possibly it is not very instructive. Let's see how the different measures are correlated, and how they are correlated with the Happiness score.","cc0b57ad":"We see that, in countries where freedom is limited, the perception of corruption is generally pretty high, as one might expect. For countires with high freedom, instead, we see that the perception of corruption range from low to high. However, we see that countries with a high GDP per capita and high freedom score tend to have a low perception of corrpution, compared to those countries with a lower GDP per capita.","3c2db2dc":"The happiness index for each contries in a given geographical region, with the contribution of each happiness measure highlighed. The dashed line represent the happiness score of Dystopia, an imaginary country where all measures take their minimum value.\n\nOne can use the distance between the dashed line and the top of the blue bar (the 'Dysopia + Residuals' bar) to compute the residual, that is, how much of the Happiness index is not explained by the main happiness measures used in the study. For more info, see this [link](https:\/\/worldhappiness.report\/faq\/).\n\nBefore moving on, we can check which countries are in the top\/bottom 5 list this year.","ef1994cf":"# World Happiness Report\n\nIn the following we visualize the results of the World Happiness Report.\n\n- We first take a look at which countries have been in the top and bottom 10 of the ranking through the years.\n\n- We then move to analyse the 2021 report, specifically the happiness score in different world regions and countries, as well as the happiness measures used to build the score."}}