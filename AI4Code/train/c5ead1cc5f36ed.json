{"cell_type":{"fb3fad64":"code","9567b044":"code","023942bf":"code","670d9484":"code","4f1a3f82":"code","eded5ff2":"code","7f0c0386":"code","13c865b1":"code","b8b17268":"code","55195f24":"code","cc1d8c41":"code","8d07a5ba":"code","f77e72e1":"code","baa98357":"markdown","22d3fa4e":"markdown","6734fc7f":"markdown","7aaebbbc":"markdown","67ea9392":"markdown"},"source":{"fb3fad64":"!pip freeze | grep tensorflow==2.3\n","9567b044":"import math\nimport shutil\nimport numpy as np\nimport pandas as pd\nimport tensorflow as tf\n\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\nprint(tf.__version__)\ntf.compat.v1.logging.set_verbosity(tf.compat.v1.logging.INFO)\npd.options.display.max_rows = 10\npd.options.display.float_format = '{:.1f}'.format","023942bf":"df = pd.read_csv(\"https:\/\/storage.googleapis.com\/ml_universities\/california_housing_train.csv\", sep=\",\")","670d9484":"df.head()","4f1a3f82":"df.describe()","eded5ff2":"np.random.seed(seed=1) #makes result reproducible\nmsk = np.random.rand(len(df)) < 0.8\ntraindf = df[msk]\nevaldf = df[~msk]","7f0c0386":"\ndef add_more_features(df):\n  df['avg_rooms_per_house'] = df['total_rooms'] \/ df['households'] #expect positive correlation\n  df['avg_persons_per_room'] = df['population'] \/ df['total_rooms'] #expect negative correlation\n  return df","13c865b1":"# Create pandas input function\ndef make_input_fn(df, num_epochs):\n  return tf.compat.v1.estimator.inputs.pandas_input_fn(\n    x = add_more_features(df),\n    y = df['median_house_value'] \/ 100000, \n    batch_size = 128,\n    num_epochs = num_epochs,\n    shuffle = True,\n    queue_capacity = 1000,\n    num_threads = 1\n  )","b8b17268":"# Define your feature columns\ndef create_feature_cols():\n  return [\n    tf.feature_column.numeric_column('housing_median_age'),\n    tf.feature_column.bucketized_column(tf.feature_column.numeric_column('latitude'), boundaries = np.arange(32.0, 42, 1).tolist()),\n    tf.feature_column.bucketized_column(tf.feature_column.numeric_column('longitude'), boundaries = np.arange(-125.0, -113.0, 1).tolist()),\n    tf.feature_column.numeric_column('avg_rooms_per_house'),\n    tf.feature_column.numeric_column('avg_persons_per_room'),\n    tf.feature_column.numeric_column('median_income')\n  ]","55195f24":"# Create estimator train and evaluate function\ndef train_and_evaluate(output_dir,num_train_steps):\n    estimator = tf.compat.v1.estimator.LinearRegressor(model_dir=output_dir,feature_columns=create_feature_cols())\n    train_spec =tf.estimator.TrainSpec(input_fn=make_input_fn(traindf,None),\n                                      max_steps=num_train_steps)\n    \n    eval_spec = tf.estimator.EvalSpec(input_fn=make_input_fn(evaldf,1),\n                                     steps=None,\n                                     start_delay_secs=1,\n                                     throttle_secs=5)\n    tf.estimator.train_and_evaluate(estimator,train_spec,eval_spec)","cc1d8c41":"OUTDIR = \".\/trained_model\"\n","8d07a5ba":"\n# Run the model\nshutil.rmtree(OUTDIR, ignore_errors = True) # start fresh each time\ntf.compat.v1.summary.FileWriterCache.clear() \ntrain_and_evaluate(OUTDIR, 2000)","f77e72e1":"!ls $OUTDIR","baa98357":"# Basic Model Building With Tensorflow ","22d3fa4e":"## Import Modules","6734fc7f":"## Training and Evaluation\nIn this exercise, we'll be trying to predict median_house_value It will be our label (sometimes also called a target).\n\nWe'll modify the feature_cols and input function to represent the features you want to use.\n\nWe divide total_rooms by households to get avg_rooms_per_house which we expect to positively correlate with median_house_value.\n\nWe also divide population by total_rooms to get avg_persons_per_room which we expect to negatively correlate with median_house_value.","7aaebbbc":"### Examine and split the data\nIt's a good idea to get to know your data a little bit before you work with it.\n\nWe'll print out a quick summary of a few useful statistics on each column.\n\nThis will include things like mean, standard deviation, max, min, and various quantiles.","67ea9392":"# Load Data"}}