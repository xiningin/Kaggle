{"cell_type":{"19c47a47":"code","51d65b47":"code","66401123":"code","66ab873a":"code","3404bce6":"code","acda5aba":"code","c52115fc":"code","6fe7ed36":"code","c8717dc6":"code","05d5aff4":"code","90ed8282":"code","1cd43b86":"code","8009622a":"code","9dfb328b":"code","286e78a0":"code","53be6e1c":"code","24dd7e7d":"code","c5935fcc":"code","4c19bed3":"code","437b0003":"code","5b88762b":"code","23d598ec":"code","3fc63fbe":"code","c8daa67e":"code","b6dd4e69":"code","f19ff4a3":"code","1d202c68":"code","85b73887":"code","1049edd8":"code","dbfbc760":"code","72bafd91":"code","387fa970":"code","fb3e465c":"code","04472510":"code","4696149f":"code","a2d28046":"code","864fee4a":"code","bb04d081":"code","1deacb65":"code","a1a95435":"code","989b024f":"code","410239ab":"code","da7307c2":"code","8cc40331":"code","2343bc57":"code","ab3290ce":"code","f18e3bd8":"code","8df96510":"code","f3f95850":"code","04100479":"code","41b8d119":"code","1cd74771":"code","3a0980d6":"code","faa11772":"code","add55036":"code","bceee478":"markdown","fcd85d41":"markdown","82bce102":"markdown","db0a9991":"markdown","1be93ef1":"markdown","3e3ee38d":"markdown","39ac4e0c":"markdown","b264aae2":"markdown","1c6a87b1":"markdown","3468a9ce":"markdown","de1ccb1c":"markdown","69933fe2":"markdown","712cabd1":"markdown","ff240926":"markdown","5366fea4":"markdown","1af3f591":"markdown","594e93fd":"markdown","2484ece9":"markdown","f24cf32c":"markdown","cf1081e4":"markdown","d44a5069":"markdown","6cc68689":"markdown","db81b52d":"markdown","e5d544c0":"markdown","51f3f3b4":"markdown","b421b885":"markdown","5c8b3d27":"markdown","78d0ad8b":"markdown","bdc2c06b":"markdown"},"source":{"19c47a47":"#import required libraries\nfrom sklearn.model_selection import train_test_split \nfrom sklearn.linear_model import LinearRegression\nfrom sklearn import preprocessing\nimport numpy as np \nimport pandas as pd \nimport matplotlib.pyplot as plt\nimport seaborn as sns\n%matplotlib inline","51d65b47":"#reading data files\nstore_df=pd.read_csv(\"..\/input\/rossmann-store-sales\/store.csv\")\ntrain_df=pd.read_csv(\"..\/input\/rossmann-store-sales\/train.csv\")","66401123":"store_df.head()","66ab873a":"store_df.describe()","3404bce6":"#Checking the no. of NaN vales\nstore_df.isna().sum()","acda5aba":"train_df.head()","c52115fc":"train_df.describe()","6fe7ed36":"#Checking the no. of NaN values\ntrain_df.isna().sum()","c8717dc6":"#Merging both the Dataframes into one based on the \"Store\" ID\ndf=store_df.merge(train_df,on=[\"Store\"],how=\"inner\")\ndf.head()","05d5aff4":"#(rowsxcolumns) of the merged DataFrame\ndf.shape","90ed8282":"#Checking the no. of NaN values\ndf.isna().sum()","1cd43b86":"#Dropping columns\ndf=df.drop(columns=[\"PromoInterval\",\"Promo2SinceWeek\",\"Promo2SinceYear\"])","8009622a":"#Handling NaN\ndf.CompetitionDistance.fillna(df.CompetitionDistance.mode()[0],inplace=True)\ndf.CompetitionOpenSinceMonth.fillna(1, inplace=True)\ndf.CompetitionOpenSinceYear.fillna(df.CompetitionOpenSinceYear.mode()[0], inplace=True)\ndf.CompetitionOpenSinceMonth=df.CompetitionOpenSinceMonth.astype(int)\ndf.CompetitionOpenSinceYear=df.CompetitionOpenSinceYear.astype(int)","9dfb328b":"#Find the range of data\nplt.figure(figsize=(5,10))\nsns.set(style=\"whitegrid\")\nsns.distplot(df[\"Sales\"])","286e78a0":"#Find the range of the data\nplt.figure(figsize=(5,10))\nsns.set(style=\"whitegrid\")\nsns.distplot(df[\"Customers\"])","53be6e1c":"plt.figure(figsize=(10,10))\nsns.set(style=\"whitegrid\")\nsns.boxenplot(data=df,scale=\"linear\",x=\"DayOfWeek\",y=\"Sales\",color=\"orange\")","24dd7e7d":"plt.figure(figsize=(10,10))\nsns.set(style=\"whitegrid\")\nsns.boxenplot(y=\"Customers\", x=\"DayOfWeek\",data=df, scale=\"linear\",color=\"orange\")","c5935fcc":"df[\"Sales\"]=df[\"Sales\"].apply(lambda x: 20000 if x>20000 else x)\ndf[\"Customers\"]=df[\"Customers\"].apply(lambda y: 3000 if y>3000 else y)\nprint(max(df[\"Sales\"]))\nprint(max(df[\"Customers\"]))","4c19bed3":"df[\"Date\"]=pd.to_datetime(df[\"Date\"])\ndf[\"Year\"]=df[\"Date\"].dt.year\ndf[\"Month\"]=df[\"Date\"].dt.month\ndf[\"Day\"]=df[\"Date\"].dt.day\ndf[\"Week\"]=df[\"Date\"].dt.week%4\ndf[\"Season\"] = np.where(df[\"Month\"].isin([3,4]),\"Spring\",np.where(df[\"Month\"].isin([5,6,7,8]), \"Summer\",np.where(df[\"Month\"].isin ([9,10,11]),\"Fall\",np.where(df[\"Month\"].isin ([12,1,2]),\"Winter\",\"None\"))))\ndf","437b0003":"Holiday_Year_Month_Week_df=pd.DataFrame({\"Holiday per week\":df[\"SchoolHoliday\"],\"Week\":df[\"Week\"],\"Month\":df[\"Month\"],\"Year\":df[\"Year\"],\"Date\":df[\"Date\"]})\nHoliday_Year_Month_Week_df=Holiday_Year_Month_Week_df.drop_duplicates(subset=['Date'])\nHoliday_Year_Month_Week_df=Holiday_Year_Month_Week_df.groupby([\"Year\",\"Month\",\"Week\"]).sum()\nHoliday_Year_Month_Week_df","5b88762b":"df=df.merge(Holiday_Year_Month_Week_df, on=[\"Year\",\"Month\",\"Week\"],how=\"inner\")","23d598ec":"customer_time_df=pd.DataFrame({\"Avg CustomersPerMonth\":df[\"Customers\"],\"Month\":df[\"Month\"]})\nAvgCustomerperMonth=customer_time_df.groupby(\"Month\").mean()\nAvgCustomerperMonth","3fc63fbe":"customer_time_df=pd.DataFrame({\"Avg CustomersPerWeek\":df[\"Customers\"],\"Week\":df[\"Week\"],\"Year\":df[\"Year\"],\"Month\":df[\"Month\"]})\nAvgCustomerperWeek=customer_time_df.groupby([\"Year\",\"Month\",\"Week\"]).mean()\nAvgCustomerperWeek","c8daa67e":"df=df.merge(AvgCustomerperMonth,on=\"Month\",how=\"inner\")\ndf=df.merge(AvgCustomerperWeek,on=[\"Year\",\"Month\",\"Week\"],how=\"inner\")","b6dd4e69":"promo_time_df=pd.DataFrame({\"PromoCountperWeek\":df[\"Promo\"],\"Year\":df[\"Year\"],\"Month\":df[\"Month\"],\"Week\":df[\"Week\"],\"Date\":df[\"Date\"]})\npromo_time_df=promo_time_df.drop_duplicates(subset=['Date'])\npromo_time_df=promo_time_df.groupby([\"Year\",\"Month\",\"Week\"]).sum()\npromo_time_df","f19ff4a3":"df=df.merge(promo_time_df,on=[\"Year\",\"Month\",\"Week\"], how=\"inner\")","1d202c68":"df=df.rename(columns={'CompetitionOpenSinceYear': 'year','CompetitionOpenSinceMonth':'month'})\ndf['CompetitionOpenSince'] = pd.to_datetime(df[['year', 'month']].assign(DAY=1))\ndf=df.rename(columns={ 'year':'CompetitionOpenSinceYear','month':'CompetitionOpenSinceMonth'})","85b73887":"numerical_data_col=[\"Store\",\"Competition Distance\",\"Promo2\",\"DayOfWeek\",\"Sales\",\"Customers\",\"Open\",\"SchoolHoliday\",\"Year\",\"Month\",\"Day\",\"Week\"]\ncategorical_data_col=[\"StoreType\",\"Assortment\",\"Season\"]","1049edd8":"for i in categorical_data_col:\n    p=0\n    for j in df[i].unique():\n        df[i]=np.where(df[i]==j,p,df[i])\n        p=p+1\n\n    df[i]=df[i].astype(int)","dbfbc760":"#The column StateHoliday contains 0,'0',a and b. This needs to be conerted to a pure numerical data column\ndf[\"StateHoliday\"].unique()","72bafd91":"df[\"StateHoliday\"]=np.where(df[\"StateHoliday\"] == '0' ,0,1)\ndf[\"StateHoliday\"]=df[\"StateHoliday\"].astype(int)","387fa970":"plt.figure(figsize=(10,10))\nsns.set(style=\"whitegrid\",palette=\"pastel\",color_codes=True)\nsns.violinplot(x=\"DayOfWeek\",y=\"Sales\",hue=\"Promo\",split=True, data=df)","fb3e465c":"plt.figure(figsize=(10,10))\nsns.set(style=\"whitegrid\",palette=\"pastel\",color_codes=True)\nsns.violinplot(x=\"DayOfWeek\",y=\"Customers\",hue=\"Promo\",split=True, data=df)","04472510":"plt.figure(figsize=(15,15))\nsns.set(style=\"whitegrid\")\ndf[\"CompetitionDistanceLOG\"]=np.log(df[\"CompetitionDistance\"])\nsns.lineplot(x=\"CompetitionDistanceLOG\", y=\"Sales\", data=df)","4696149f":"sns.set(style=\"whitegrid\")\ng=sns.relplot(y=\"Avg CustomersPerWeek\", x=\"Week\", hue=\"Holiday per week\", data=df)\ng.fig.set_size_inches(10,10)","a2d28046":"sns.set(style=\"whitegrid\")\ng=sns.relplot(y=\"Holiday per week\", x=\"Week\", hue=\"PromoCountperWeek\", data=df)\ng.fig.set_size_inches(10,10)","864fee4a":"#using public state holidays data from https:\/\/www.timeanddate.com\/holidays\/germany\/2013\nholid=df.loc[df.StateHoliday=='a']\nbydate=df.groupby('Date')['Store'].count()\n#number of stores celebrating holidays\nbydate.head()","bb04d081":"#Figuring out store locations based on state holidays\nSN = holid.loc[holid.Date == '2013-11-20','Store'].values\nprint('{} stores located in Saxony.'.format(SN.shape[0]))\nBW_BY_ST = holid.loc[holid.Date == '2013-01-06','Store'].values\nprint('{} stores located in BW, BY, ST.'.format(BW_BY_ST.shape[0]))\nBW_BY_HE_NW_RP_SL = holid.loc[holid.Date == '2013-05-30','Store'].values\nprint('{} stores located in BW, BY, HE, NW, RP, SL.'.format(BW_BY_HE_NW_RP_SL.shape[0]))\nBY_SL = holid.loc[holid.Date =='2013-08-15','Store'].values\nprint('{} stores located in BY,SL.'.format(BY_SL.shape[0]))\nBB_MV_SN_ST_TH = holid.loc[holid.Date =='2013-10-31','Store'].values\nprint('{} stores located in BB, MV, SN, ST, TH.'.format(BB_MV_SN_ST_TH.shape[0]))\nBW_BY_NW_RP_SL = holid.loc[holid.Date =='2013-11-01','Store'].values\nprint('{} stores located in BW, BY, NW, RP, SL.'.format(BW_BY_NW_RP_SL.shape[0]))\nBW_BY = np.intersect1d(BW_BY_ST, BW_BY_HE_NW_RP_SL)\nprint('{} stores located in BW, BY.'.format(BW_BY.shape[0]))","1deacb65":"ST = np.setxor1d(BW_BY_ST, BW_BY)\nprint('{} stores located in ST.'.format(ST.shape[0]))\nBY = np.intersect1d(BW_BY, BY_SL)\nprint('{} stores located in BY.'.format(BY.shape[0]))\nSL = np.setxor1d(BY, BY_SL)\nprint('{} stores located in SL.'.format(SL.shape[0]))\nBW = np.setxor1d(BW_BY, BY)\nprint('{} stores located in BW.'.format(BW.shape[0]))\nHE = np.setxor1d(BW_BY_HE_NW_RP_SL,BW_BY_NW_RP_SL)\nprint('{} stores located in HE.'.format(HE.shape[0]))\nBB_MV_TH = np.setxor1d(np.setxor1d(BB_MV_SN_ST_TH,SN),ST)\nprint('{} stores located in BB, MV, TH.'.format(BB_MV_TH.shape[0]))\nNW_RP = np.setxor1d(BW_BY_NW_RP_SL,BW_BY) # SL has 0 stores\nprint('{} stores located in NW, RP.'.format(NW_RP.shape[0]))\nallstores = np.unique(df.Store.values)\nBE_HB_HH_NI_SH = np.setxor1d(np.setxor1d(allstores,BW_BY_HE_NW_RP_SL),BB_MV_SN_ST_TH)\nprint('{} stores located in BE, HB, HH, NI, SH.'.format(BE_HB_HH_NI_SH.shape[0]))","a1a95435":"#using public school holidays data from http:\/\/www.holidays-info.com\/School-Holidays-Germany\/2015\/school-holidays_2015.html.\n#furthur division based on school holidays \ndf.loc[df.Store.isin(NW_RP)].groupby('Date')['SchoolHoliday'].sum().value_counts()\nRP = df.loc[df.Date=='2015-03-26'].loc[df.Store.isin(NW_RP)].loc[df.SchoolHoliday==1,'Store'].values\nNW = np.setxor1d(NW_RP,RP)\nprint('{} stores located in RP.'.format(RP.shape[0]))\nprint('{} stores located in NW.'.format(NW.shape[0]))\ndf.loc[df.Store.isin(BB_MV_TH)].groupby('Date')['SchoolHoliday'].sum().value_counts()\nTH = BB_MV_TH\nprint('{} stores located in TH.'.format(TH.shape[0]))\nHH = df.loc[df.Date=='2015-03-02'].loc[df.Store.isin(BE_HB_HH_NI_SH)].loc[df.SchoolHoliday==1,'Store'].values\nprint('{} stores located in HH.'.format(HH.shape[0]))\nBE_HB_NI_SH = np.setxor1d(BE_HB_HH_NI_SH,HH)\nSH = df.loc[df.Date=='2015-04-17'].loc[df.Store.isin(BE_HB_NI_SH)].loc[df.SchoolHoliday==1,'Store'].values\nprint('{} stores located in SH.'.format(SH.shape[0]))\nBE_HB_NI = np.setxor1d(BE_HB_NI_SH,SH)\nBE = df.loc[df.Date=='2015-03-25'].loc[df.Store.isin(BE_HB_NI)].loc[df.SchoolHoliday==0,'Store'].values\nprint('{} stores located in BE.'.format(BE.shape[0]))\nHB_NI = np.setxor1d(BE_HB_NI,BE)","989b024f":"states = pd.Series('',index = allstores,name='State')\nstates.loc[BW] = 'BW'\nstates.loc[BY] = 'BY'\nstates.loc[BE] = 'BE'\nstates.loc[HB_NI] = 'HB,NI'\nstates.loc[HH] = 'HH'\nstates.loc[HE] = 'HE'\nstates.loc[NW] = 'NW'\nstates.loc[RP] = 'RP'\nstates.loc[SN] = 'SN'\nstates.loc[ST] = 'ST'\nstates.loc[SH] = 'SH'\nstates.loc[TH] = 'TH'\nstates[states!=''].value_counts().sum()\nstates.to_csv('location.csv', header=True, index_label='Store')","410239ab":"location_df=pd.read_csv(\".\/location.csv\",index_col=\"Store\")\nlocation_df.head()","da7307c2":"df=df.merge(location_df,on='Store',how=\"inner\")","8cc40331":"weather_df=pd.read_csv(\"..\/input\/rossmann-stores-weather-dataset\/weather.csv\")","2343bc57":"weather_df.head()","ab3290ce":"weather_df.describe()","f18e3bd8":"weather_df.isna().sum()","8df96510":"weather_df=weather_df.bfill()\nweather_df=weather_df.ffill()","f3f95850":"weather_df.Date=pd.to_datetime(weather_df.Date)","04100479":"#encoding the values\nweather={'Fog':'1','Rain':'2','Hail':'3','Thunderstorm':'4','Snow':'5'}\nencoding=dict()\nfor t in weather_df['Events']:\n    j=t\n    for i in j.split('-'):\n      j=j.replace(i,weather[i])\n    \n    j=j.replace('-','')\n    encoding[t]=j   \n#print(encoding)\n\nfor i in encoding.keys():\n  weather_df[\"Events\"]=np.where(weather_df[\"Events\"]==i,encoding[i],weather_df[\"Events\"])\n\nweather_df[\"Events\"].unique()","41b8d119":"df.to_csv('cleaned_weather.csv') ","1cd74771":"df= df.merge(weather_df, how='inner', left_on=[\"Date\", \"State\"], right_on=[\"Date\",\"State\"])","3a0980d6":"df.to_csv('final_RossmannSales.csv') ","faa11772":"df.head()","add55036":"#Find Correlation between the data columns\nplt.figure(figsize=(15,15))\nsns.heatmap((df.corr()))","bceee478":"# Handling Categorical Data","fcd85d41":"This data, contains many outliers, but these might have been caused to the surge of customers during a festival or Holiday, or due to an effective promo.\nHowever I will cap off, the Customers at 3000, and Sales at 20,000.","82bce102":"Adding additional features, that records the avg. no. of Customers per month and avg. no. of Customers per week","db0a9991":"This is part 1 of predicting Rossmann Sales \nIt only deals with data cleaning, feature engineering and EDA.\n\nFor part 2, which deals with finding the best models for predicting sales, \ncheckout https:\/\/www.kaggle.com\/amithanayak\/predict-rossmann-sales","1be93ef1":"Competition Distance does seem to affect Sales. The stores with less CompetitionDistance didn't make more Sales.","3e3ee38d":"# Working With 'TIME'","39ac4e0c":"combining 'CompetitionSinceMonth' & 'CompetitionSinceYear' into 'CompetitionSince'","b264aae2":"# Final Check","1c6a87b1":"It doesn't seem like the Holidays had any effect on promo and Customers.","3468a9ce":"## Are the promos effective?","de1ccb1c":"## Is there a surge of customers during SchoolHolidays?","69933fe2":"The days promos were present have indeed shown a slight improvement in Sales.\nThe plot above also shows that there was no promo offered on 6th and the 7th day of the week (Saturday and Sunday), and stores didn't suffer for doing so either, as it can be seen the no. of customers on the weekends, were more that that during the weekdays.","712cabd1":"The columns StoreType, Assortment, Season have char type or String type values, all of this need to converted to a numerical value","ff240926":"# EDA","5366fea4":"# Feature Engineering","1af3f591":"# Getting to Know your Data","594e93fd":"The columns - CompetitionOpenSinceMonth, CompetitionOpenSinceYear, Promo2SinceWeek, Promo2SinceYear, PromoInterval have too many values as NaN (roughly 30% or above).\nWhereas, the column CompetitionDistance has very few values missing, and these values can be substituted by the 'mode' of the very same column. ","2484ece9":"## Finding location of stores","f24cf32c":"Adding an additional feature, that records the no. of Holidays per week.","cf1081e4":"the heatmap shows all our hypothesis were true, there is very little correlation between School Holiday, Customers and Promo, but there is a strong correlation between Promo and Sales","d44a5069":"# Data Cleaning","6cc68689":"adding an additional feature that records the no. of promo per week","db81b52d":"Data fields\n\nMost of the fields are self-explanatory. The following are descriptions for those that aren't.\n\n    Id - an Id that represents a (Store, Date) duple within the test set\n    Store - a unique Id for each store\n    Sales - the turnover for any given day (this is what you are predicting)\n    Customers - the number of customers on a given day\n    Open - an indicator for whether the store was open: 0 = closed, 1 = open\n    StateHoliday - indicates a state holiday. Normally all stores, with few exceptions, are closed on state holidays. Note that all schools are closed on public holidays and weekends. a = public holiday, b = Easter holiday, c = Christmas, 0 = None\n    SchoolHoliday - indicates if the (Store, Date) was affected by the closure of public schools\n    StoreType - differentiates between 4 different store models: a, b, c, d\n    Assortment - describes an assortment level: a = basic, b = extra, c = extended\n    CompetitionDistance - distance in meters to the nearest competitor store\n    CompetitionOpenSince[Month\/Year] - gives the approximate year and month of the time the nearest competitor was opened\n    Promo - indicates whether a store is running a promo on that day\n    Promo2 - Promo2 is a continuing and consecutive promotion for some stores: 0 = store is not participating, 1 = store is participating\n    Promo2Since[Year\/Week] - describes the year and calendar week when the store started participating in Promo2\n    PromoInterval - describes the consecutive intervals Promo2 is started, naming the months the promotion is started anew. E.g. \"Feb,May,Aug,Nov\" means each round starts in February, May, August, November of any given year for that store\n","e5d544c0":"# Getting Started","51f3f3b4":"# Handling Outliers","b421b885":"## Does competition distance matter?","5c8b3d27":"It doesn't look like there is a big difference in the no. of customers even if there were 4 School Holidays that week","78d0ad8b":"## Is there an increase in promo if it is a School Holiday?","bdc2c06b":"## Adding weather data"}}