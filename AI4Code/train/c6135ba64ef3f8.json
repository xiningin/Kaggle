{"cell_type":{"87d6e5bc":"code","230b1a68":"code","fde3e01c":"code","e784b78a":"code","b6fd7b44":"code","3ed4073a":"code","914b5cd2":"code","525420e7":"code","d8e67924":"code","e1af774c":"code","10025df5":"code","31937eb5":"code","505bc179":"code","388fb23b":"code","5dc690d6":"code","1a7dcd1b":"code","346c894e":"code","9249ba82":"code","221d41bf":"code","38e1e485":"code","b005ad26":"code","e11af5ba":"code","c9199a01":"code","11a7aa34":"code","f532ec9a":"code","eb01c03c":"code","486c58ba":"code","f0c4888d":"code","35445d81":"code","85cb99d0":"code","a10ff279":"code","21db7d31":"code","b0c65d83":"code","8ec5ba95":"code","5faa36a3":"code","188eb0d7":"code","70a39d1f":"code","63cbc2c2":"code","a95fecd2":"code","e7397a7d":"code","21743f3a":"code","f4c9028e":"code","bf22c366":"code","060325b4":"code","7282acb7":"code","101172ce":"code","88262e2e":"code","62f94306":"code","95d7c3da":"code","d6e9f220":"code","77ce5ce7":"code","1a3e3e89":"code","273ad7ef":"code","811a739d":"code","fec07e65":"code","88fc2be7":"code","f0c4dbd0":"code","e546f296":"code","e81d3b9f":"code","c75537f4":"code","84869bde":"code","5d71296a":"code","ca6907f9":"code","3a7d1bf5":"code","12823ccb":"code","76cb7e45":"code","94ead315":"code","3acba8bc":"code","d9803143":"code","e98c2e72":"code","7b186c4b":"code","2d7d2658":"code","0410eece":"code","ba78c965":"code","26b7d6cb":"code","fcc277cc":"code","96077356":"code","c1ec02a3":"code","db5c246a":"code","81f230f7":"code","7f7ecba3":"code","8c516805":"code","f146db6e":"code","0407b96d":"code","dc039c46":"code","ceefbfa4":"code","4b459093":"code","85df7174":"code","31bde27a":"code","82ab4946":"code","c205a286":"code","1f74766b":"code","1d264291":"code","ab42159f":"code","76ff568d":"code","6e07c757":"code","ea76f8c1":"code","f137f822":"code","4d28d583":"code","84ae7dec":"code","df846de0":"code","44e3b7e5":"code","c600c252":"code","d383501b":"code","f668baf9":"code","f0ec3419":"code","daf374fb":"code","6b350753":"code","f49b35fe":"code","3a48765e":"code","1b47c4fc":"code","67e0d829":"code","fb4f9a39":"code","076f78ae":"code","cf01af37":"code","9fd9ba22":"code","e8be330e":"code","ccab9a7f":"code","47f1e73a":"code","dca5f5df":"code","d1f25d7a":"code","92fb7e81":"code","318162eb":"code","1e291919":"code","53f7bf6c":"code","1ce6eaf6":"code","13e66f44":"code","a23659e6":"code","709bdca9":"code","efb33620":"code","3937292a":"code","46c53006":"code","98d43273":"code","0277b2a7":"markdown","bdf31045":"markdown","5fddd901":"markdown","861644df":"markdown"},"source":{"87d6e5bc":"import pandas as pd                     #Load libraries\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport numpy as np\nfrom pandas import Series\nfrom scipy import stats\nimport requests, re\nfrom scipy.stats import norm\nfrom sklearn import preprocessing\nfrom sklearn.preprocessing import minmax_scale\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn import metrics\nfrom sklearn.feature_selection import RFE\nfrom sklearn.linear_model import Ridge\nimport os","230b1a68":"#Data cleaning and exploration\nprint(os.listdir(\"..\/input\"))","fde3e01c":"movie_data = pd.DataFrame(pd.read_csv(\"..\/input\/imdb-5000-movie-dataset\/movie_metadata.csv\"))  #Load data","e784b78a":"movie_data.head()     #Check data","b6fd7b44":"movie_data.shape      #Check number of rows and columns","3ed4073a":"movie_data.info()  #Information about movie columns","914b5cd2":"movie_data.isna().sum()        #Null values","525420e7":"movie_data.groupby('color')['color'].count()    #Distribution check","d8e67924":"movie_data['color'] = movie_data['color'].fillna('Color')         #Fill null values","e1af774c":"movie_data['director_name'] = movie_data['director_name'].fillna('Unknown\/Multiple')    #Fill null values","10025df5":"duration = movie_data[~movie_data['duration'].isna()]      #Considering only complete data for duration","31937eb5":"plt.boxplot(duration['duration'])   #Boxplot","505bc179":"duration['duration'].describe()     #Stats for duration column","388fb23b":"movie_data['duration'] = movie_data['duration'].fillna(duration['duration'].mean())   #Fill null values with mean","5dc690d6":"movie_data['num_critic_for_reviews'] = movie_data['num_critic_for_reviews'].fillna(0)\nmovie_data['director_facebook_likes'] = movie_data['director_facebook_likes'].fillna(0)    #Fill null values with 0\nmovie_data['actor_1_facebook_likes'] = movie_data['actor_1_facebook_likes'].fillna(0)\nmovie_data['actor_2_facebook_likes'] = movie_data['actor_2_facebook_likes'].fillna(0)\nmovie_data['actor_3_facebook_likes'] = movie_data['actor_3_facebook_likes'].fillna(0)\nmovie_data['facenumber_in_poster'] = movie_data['facenumber_in_poster'].fillna(0)\nmovie_data['num_user_for_reviews'] = movie_data['num_user_for_reviews'].fillna(0)","1a7dcd1b":"movie_data['actor_1_name'] = movie_data['actor_1_name'].fillna('Unknown')\nmovie_data['actor_2_name'] = movie_data['actor_2_name'].fillna('Unknown')     #Fill null values\nmovie_data['actor_3_name'] = movie_data['actor_3_name'].fillna('Unknown')","346c894e":"movie_data.groupby('language')['language'].count()     #Count of languages","9249ba82":"movie_data['language'] = movie_data['language'].fillna('English')   #Fill null values","221d41bf":"movie_data.groupby('country')['country'].count()        #Check distribution","38e1e485":"movie_data['country'] = movie_data['country'].fillna('USA')  #Fill null values","b005ad26":"movie_data['title_year'].hist()       #Check distribution","e11af5ba":"movie_data = movie_data[~movie_data['title_year'].isna()]  #Most rows with empty title year are documentries or series \n#Most rows with empty title year do not have gross or budget","c9199a01":"movie_data.groupby('content_rating')['content_rating'].count()  #Check distribution","11a7aa34":"movie_data['content_rating'] = movie_data['content_rating'].fillna('Unrated') #Fill null values","f532ec9a":"del movie_data['aspect_ratio']         #Remove unecessary column","eb01c03c":"movie_data.isna().sum()      #Null value check","486c58ba":"movie_data.shape     #Check rows and columns left","f0c4888d":"def link_replacer(link):             #Replace movies URL with IMDB URL\n    link = link.replace('http:\/\/www.movie.com\/title\/', 'https:\/\/www.imdb.com\/title\/')\n    link = link.replace('\/?ref_=fn_tt_tt_1', '\/')\n    return link\n\n\ndef budget_extractor(link):           #Webscrape data from IMDB to get budget value  \n    \n    print(link)\n    r = requests.get(link)\n    if re.search('<h4 class=\"inline\">Budget:<\/h4>(.*?)<span class=\"attribute\">',r.text, re.DOTALL) is None:\n        return np.NAN\n    content = re.search('<h4 class=\"inline\">Budget:<\/h4>(.*?)<span class=\"attribute\">',r.text,re.DOTALL).group(1)\n    content = re.sub('\\W+','', content)\n    content = re.search(r'\\d+', content).group()\n    content = int(content)\n    return content\n\n\ndef gross_extractor(link):         #Webscrape data from IMDB to get gross value\n    print(link)\n    r = requests.get(link)\n    if re.search('<h4 class=\"inline\">Gross USA:<\/h4>(.*?)<\/div>',r.text, re.DOTALL) is None:\n                                                    #Check if Gross USA values exists\n        if re.search('<h4 class=\"inline\">Cumulative Worldwide Gross:<\/h4>(.*?)<\/div>',r.text, re.DOTALL) is None:\n            return np.NAN                       #Check if Cummulative Gross values exists\n        else:\n            content = re.search('<h4 class=\"inline\">Cumulative Worldwide Gross:<\/h4>(.*?)<\/div>',r.text,re.DOTALL).group(1)\n            content = re.sub('\\W+','', content)\n            content = re.search(r'\\d+', content).group()\n            content = int(content)\n            return content\n    else:\n        content = re.search('<h4 class=\"inline\">Gross USA:<\/h4>(.*?)<\/div>',r.text,re.DOTALL).group(1)\n        content = re.sub('\\W+','', content)\n        content = re.search(r'\\d+', content).group()\n        content = int(content)\n        return content\n","35445d81":"#movie_data['movie_imdb_link'] = movie_data['movie_imdb_link'].apply(lambda x: link_replacer(x))\n\n#gross = movie_data[~movie_data['gross'].isna()]\n#nt_gross = movie_data[movie_data['gross'].isna()]\n#nt_gross['gross'] = nt_gross['movie_imdb_link'].apply(lambda x: gross_extractor(x))\n#mv1 = pd.concat([gross, nt_gross], ignore_index = True)\n\n#budget = mv1[~mv1['budget'].isna()\n#nt_budget = mv1[mv1['budget'].isna()]\n#nt_budget['budget'] = nt_budget['movie_imdb_link'].apply(lambda x: budget_extractor(x))\n#mv2 = pd.concat([budget, nt_budget], ignore_index = True)\n\n#movie_data = mv2\n\n#movie_data.isna().sum()","85cb99d0":"#movie_data.to_csv('movie_cln_v4.csv')     #Save data","a10ff279":"movie_data = pd.DataFrame(pd.read_csv('..\/input\/movie-clean\/movie_cln_v5.csv')) #Read clean dataset","21db7d31":"movie_data = movie_data.drop(columns=['color', 'Unnamed: 0'])   #Remove unnecessary columns","b0c65d83":"movie_data.shape","8ec5ba95":"movie_data.isna().sum()","5faa36a3":"movie_data = movie_data.dropna(subset = ['gross', 'budget'], how = 'all')       #Drop null which exist in both gross AND budget","188eb0d7":"movie_data.shape     #Check cleaned dataset","70a39d1f":"movie_data_nn = movie_data.dropna(subset = ['gross'], how = 'all')\nmovie_data_nn = movie_data_nn.dropna(subset = ['budget'], how = 'all')","63cbc2c2":"movie_data_nn.shape       #Dataframe with no null values","a95fecd2":"movie_data_nn.isna().sum()","e7397a7d":"movie_data_nn.to_csv('movie_data_no_null.csv')","21743f3a":"movie_data.to_csv('movie_cln_v5.csv')","f4c9028e":"movie_data_nn['net'] = movie_data_nn['gross'] - movie_data_nn['budget']","bf22c366":"movie_data_nn = pd.DataFrame(pd.read_csv('\/Users\/smokha\/Downloads\/DSCS\/movie_data_no_null.csv'))","060325b4":"movie_data_nn.info()","7282acb7":"#Plotting heat map:\nplt.figure(figsize=(18,8),dpi=100,)\nplt.subplots(figsize=(18,8))\nsns.heatmap(data=movie_data.corr(),square=True,vmax=0.8,annot=True)","101172ce":"#Plotting heat map for all non null values:\nplt.figure(figsize=(18,8),dpi=100,)\nplt.subplots(figsize=(20,10))\nsns.heatmap(data=movie_data_nn.corr(),square=True,vmax=0.8,annot=True)","88262e2e":"sns.distplot(a=movie_data_nn['movie_facebook_likes'],hist=True,bins=10,fit=norm,color=\"red\")\nplt.title(\"IMDB Movie Review\")\nplt.ylabel(\"frequency\")         #Distribution of movie Facebook likes\nplt.show()","62f94306":"mean, variance=norm.fit(movie_data_nn['movie_facebook_likes'])         ","95d7c3da":"mean","d6e9f220":"variance","77ce5ce7":"col_n = ['num_critic_for_reviews', 'duration', 'director_facebook_likes', 'actor_3_facebook_likes', 'actor_1_facebook_likes', 'gross', 'num_voted_users', 'cast_total_facebook_likes', 'facenumber_in_poster', 'num_user_for_reviews', 'title_year', 'actor_2_facebook_likes', 'movie_score', 'movie_facebook_likes', 'net']","1a3e3e89":"plt.boxplot(movie_data_nn['net']) #Distribution of net ","273ad7ef":"movie_data_nn.info()","811a739d":"sns.jointplot(x=(movie_data_nn['budget']),y=(movie_data_nn['gross']),kind=\"reg\", height=8.27) #Budget V\/S Gross","fec07e65":"data = movie_data_nn.drop(movie_data_nn[(movie_data_nn['budget']>200000000)].index).reset_index(drop=True)  #Remove outliers","88fc2be7":"sns.jointplot(x=(data['budget']),y=(data['gross']),kind=\"reg\", height=8.27)   #Higher budget can mean higher gross","f0c4dbd0":"data['budget'].corr(data['gross'])","e546f296":"data['net'] = data['gross'] - data['budget']","e81d3b9f":"data['budget'].corr(data['net'])","c75537f4":"sns.jointplot(x=(data['budget']),y=(data['net']),kind=\"reg\", height=8.27)   #Budget does not have an effect on net profit or loss","84869bde":"#Plotting heat map for all non null values:\nplt.figure(figsize=(18,8),dpi=100,)\nplt.subplots(figsize=(20,10))\nsns.heatmap(data=data.corr(),square=True,vmax=0.8,annot=True)","5d71296a":"sns.jointplot(x=(data['gross']),y=(data['net']),kind=\"reg\", height=8.27)   #Higher budget can mean higher gross","ca6907f9":"movie_data_sp = data      #New dataframe to split genres","3a7d1bf5":"# Split genres and create a new entry for each of the genre a movie falls into\ns = movie_data_sp['genres'].str.split('|').apply(Series, 1).stack()\ns.index = s.index.droplevel(-1)\ns.name = 'genres'\ndel movie_data_sp['genres']\nmd_split_genres = movie_data_sp.join(s)","12823ccb":"md_split_genres.info()","76cb7e45":"md_split_genres.groupby('genres')['genres'].count()","94ead315":"md_split_genres['genres_cat'] = md_split_genres['genres'].astype('category').cat.codes","3acba8bc":"data_3 = data[data['title_year']>1950]","d9803143":"sns.relplot(x=\"title_year\", y=\"budget\", kind=\"line\", ci=\"sd\", data=data_3, height=8.27);","e98c2e72":"sns.countplot(x=\"genres_cat\", data=md_split_genres, color=\"c\");","7b186c4b":"data.info()","2d7d2658":"sns.jointplot(x=(data['cast_total_facebook_likes']),y=(data['gross']),kind=\"reg\", height=8.27)","0410eece":"sns.jointplot(x=(data_2['cast_total_facebook_likes']),y=(data_2['gross']),kind=\"reg\", height=8.27)","ba78c965":"sns.jointplot(x=(data_3['net']),y=(data_3['num_voted_users']),kind=\"reg\", height=8.27)","26b7d6cb":"#Plotting heat map for all non null values:\nplt.figure(figsize=(18,8),dpi=100,)\nplt.subplots(figsize=(20,10))\nsns.heatmap(data=data_3.corr(),square=True,vmax=0.8,annot=True)","fcc277cc":"sns.jointplot(x=(data_3['gross']),y=(data_3['num_voted_users']),kind=\"reg\", height=8.27)","96077356":"sns.jointplot(x=(data_3['net']),y=(data_3['num_user_for_reviews']),kind=\"reg\", height=8.27)","c1ec02a3":"#Hypothesis       -- We define a block buster movie as follows,\n#For a movie with a budget less than $5million, gross over $2million and having a profit greater than 500% of net\n#For a movie with a budget more than $5mil having a profit greater than 150% of net","db5c246a":"movie_data_nn.isna().sum()   #Check null values","81f230f7":"movie_data_nn['net'] = (movie_data_nn['gross'] - movie_data_nn['budget'])\/movie_data_nn['budget']  #Create net column\nmovie_data_nn['blockbuster'] = 0   ","7f7ecba3":"movie_data_nn.sort_values(by=['budget'])","8c516805":"#Removing outliers\nmovie_data_nn = movie_data_nn.drop(movie_data_nn[(movie_data_nn['budget']>200000000)].index).reset_index(drop=True)","f146db6e":"movie_data_nn['budget'].hist()","0407b96d":"mov_l = movie_data_nn[movie_data_nn['budget']<5000000]   #Split data","dc039c46":"mov_m = movie_data_nn[movie_data_nn['budget']>=5000000]        #Split data","ceefbfa4":"mov_l.sort_values(by=['net'])","4b459093":"mov_l_ntg = mov_l[mov_l['gross']<2000000]\nmov_l_g = mov_l[mov_l['gross']>=2000000]   #Split data","85df7174":"mov_l_g['blockbuster'] = mov_l_g['net'].apply(lambda x: 1 if x>=5 else 0)   #Setting blockbuster condition","31bde27a":"mov_l = pd.concat([mov_l_g, mov_l_ntg])","82ab4946":"mov_l.groupby('blockbuster')['blockbuster'].count()","c205a286":"mov_m['blockbuster'] = mov_m['net'].apply(lambda x: 1 if x>=1.5 else 0)  #Setting blockbuster condition","1f74766b":"mov_m.groupby('blockbuster')['blockbuster'].count()","1d264291":"movie_data_nn = pd.concat([mov_l, mov_m])","ab42159f":"movie_data_nn.groupby('blockbuster')['blockbuster'].count()","76ff568d":"movie_data_nn = movie_data_nn.drop(columns=['director_name', 'actor_2_name', 'actor_1_name', 'actor_3_name', 'movie_title'], axis = 1)   #Drop unecessary columns","6e07c757":"movie_data_nn.info()","ea76f8c1":"sns.distplot(movie_data['title_year'])","f137f822":"movie_data_nn['year_bin'] = pd.cut(movie_data_nn['title_year'], 20)   #Creating bins for title year","4d28d583":"movie_data_nn.groupby('year_bin')['year_bin'].count()","84ae7dec":"movie_data_nn.info()","df846de0":"movie_data_nn['language'] = movie_data_nn['language'].apply(lambda x: 'English' if x =='English' else 'Others')  #Convert data","44e3b7e5":"def country(x):    #Function to convert country data\n    if x != 'UK' and x != 'Canada' and x != 'Australia' and x != 'France' and x != 'Germany' and x != 'USA':\n        x = 'Others'  \n    return x\n\nmovie_data_nn['country'] = movie_data_nn['country'].apply(lambda x: country(x))","c600c252":"def rating(x):    #Function to convert country data\n    if x != 'PG-13' and x != 'PG' and x != 'G' and x != 'Not Rated' and x != 'Unrated' and x != 'R':\n        x = 'Others' \n        \n    if x == 'Not Rated':\n        x = 'Unrated'\n    return x\n\nmovie_data_nn['content_rating'] = movie_data_nn['content_rating'].apply(lambda x: rating(x))","d383501b":"movie_data_nn['duration_bins'] = pd.cut(movie_data_nn['duration'], 12)","f668baf9":"# Split genres and create a new entry for each of the genre a movie falls into\ns = movie_data_nn['genres'].str.split('|').apply(Series, 1).stack()\ns.index = s.index.droplevel(-1)\ns.name = 'genres'\ndel movie_data_nn['genres']\nmovie_data_nn = movie_data_nn.join(s)","f0ec3419":"movie_data_nn.info()","daf374fb":"cols_ohc = ['content_rating', 'language', 'country', 'genres', 'duration_bins', 'year_bin']","6b350753":"md1 = pd.get_dummies(movie_data_nn, prefix_sep=\"__\", columns=cols_ohc)  #Creating dummy variables","f49b35fe":"md1 = md1.drop(columns=['duration', 'title_year', 'net'], axis=1)  #Drop unecessary columns","3a48765e":"md1['gross'] = md1['gross']\/1000000      #Scaling down values\nmd1['budget'] = md1['budget']\/1000000","1b47c4fc":"y = md1.pop('blockbuster')       #Sepereate feature matrix and output\nx = md1","67e0d829":"x_train, x_test, y_train, y_test = train_test_split(x, y, test_size = 0.45, random_state = 1)    #Train test split","fb4f9a39":"logreg=LogisticRegression()  ","076f78ae":"logreg.fit(x_train,y_train)             #Fit logistic regression to train data","cf01af37":"predictions = logreg.predict(x_test)       #Logistic regression prediction","9fd9ba22":"score = logreg.score(x_test, y_test)  #Prediction Score\nprint(score)","e8be330e":"cm = metrics.confusion_matrix(y_test, predictions)       #Confusion matrix\nprint(cm)  ","ccab9a7f":"import statsmodel.api as sm   #Tool not present on kernel, but required for OLS regression and F-statistics","47f1e73a":"X2 = sm.add_constant(x)    #OLS regression to get F-statistics and t-statistics\nest = sm.OLS(y, X2)\nest2 = est.fit()\nprint(est2.summary())","dca5f5df":"x_train.shape","d1f25d7a":"##Logistic regression without 'Gross' variable\nx.pop('gross')","92fb7e81":"x_train, x_test, y_train, y_test = train_test_split(x, y, test_size = 0.45, random_state = 1)","318162eb":"logreg.fit(x_train,y_train)\npredictions = logreg.predict(x_test)\nscore = logreg.score(x_test, y_test)\nprint(score)","1e291919":"cm = metrics.confusion_matrix(y_test, predictions)  #Confusion matrix\nprint(cm)","53f7bf6c":"X2 = sm.add_constant(x)   #OLS regression to get F-statistics and t-statistics\nest = sm.OLS(y, X2)\nest2 = est.fit()\nprint(est2.summary())","1ce6eaf6":"from sklearn.decomposition import PCA","13e66f44":"x2 = x       #PCA for dimensionality reduction\npca = PCA(n_components=3)\nx2 = pca.fit_transform(x)","a23659e6":"x4 = sm.add_constant(x2)\nest = sm.OLS(y, x4)   #OLS regression to get F-statistics and t-statistics\nest2 = est.fit()\nprint(est2.summary())","709bdca9":"ridge = Ridge(alpha=1.0)\nridge.fit(x,y)    #Ridge regression for diamensionality regression","efb33620":"# A helper method for pretty-printing the coefficients\ndef pretty_print_coefs(coefs, names = None, sort = False):\n    if names == None:\n        names = [\"X%s\" % x for x in range(len(coefs))]\n    lst = zip(coefs, names)\n    if sort:\n        lst = sorted(lst,  key = lambda x:-np.abs(x[0]))\n    return \" + \".join(\"%s * %s\" % (round(coef, 3), name)\n                                   for coef, name in lst)\n\nprint (\"Ridge model:\", pretty_print_coefs(ridge.coef_))","3937292a":"from sklearn.feature_selection import SelectKBest, chi2","46c53006":"test = SelectKBest(score_func=chi2, k=4)   #KBest regression for diamensionality regression\nfit = test.fit(x,y)","98d43273":"print(fit.scores_)","0277b2a7":"# ","bdf31045":"Action          987   --0\nAdventure       815   --1\nAnimation       203   --2\nBiography       260   --3\nComedy         1590   --4\nCrime           750   --5\nDocumentary      72   --6\nDrama          2098   --7\nFamily          475   --8\nFantasy         536   --9\nFilm-Noir         4   --10\nHistory         181   --11\nHorror          438   --12\nMusic           172   --13\nMusical         110   --14\nMystery         416   --15\nNews              1   --16\nRomance         938   --17\nSci-Fi          518   --18\nShort             2   --19\nSport           162   --20\nThriller       1187   --21\nWar             183   --22\nWestern          78   --23","5fddd901":"genres        count    encoding\nAction          987     -- 0\nAdventure       815     -- 1\nAnimation       203     -- 2\nBiography       260     -- 3\nComedy         1590     -- 4\nCrime           750     -- 5\nDocumentary      72     -- 6\nDrama          2098     -- 7\nFamily          475     -- 8\nFantasy         536     -- 9\nFilm-Noir         4     -- 10\nHistory         181     -- 11\nHorror          438     -- 12\nMusic           172     -- 13\nMusical         110     -- 14\nMystery         416     -- 15\nNews              1     -- 16\nRomance         938     -- 17\nSci-Fi          518     -- 18\nShort             2     -- 19\nSport           162     -- 20\nThriller       1187     -- 21\nWar             183     -- 22\nWestern          78     -- 23","861644df":"#################################################################################################"}}