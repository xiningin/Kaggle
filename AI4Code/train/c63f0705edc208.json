{"cell_type":{"391c4769":"code","d24618b5":"code","6be9e0bc":"code","a3d9c003":"code","4171bf30":"code","d2ef0553":"code","5c8822a9":"code","d3facd35":"code","10c8f275":"code","8866e345":"code","5f14c75b":"code","a2f2bb90":"code","37f24f86":"code","27bf7452":"code","5b4d326b":"code","4d4d344c":"code","d0c17d77":"code","0aee4801":"code","223fc3fe":"code","e373f1d9":"code","70728071":"code","2a8279c7":"code","41ddf5ac":"code","87eaed30":"code","113fbf9e":"code","ebf412e5":"code","5f0cd957":"code","06fef7a9":"code","415ac106":"code","4c41476f":"code","47dde0f5":"code","c76fbe7c":"code","b5cd9b15":"code","320e411c":"code","58bb6f55":"code","bf61fd31":"markdown","519a0813":"markdown","6e5515bb":"markdown","d370cb3e":"markdown","7acadaae":"markdown","33c496f3":"markdown","cf099ee7":"markdown","c1cfe29e":"markdown","6ef974f5":"markdown","b274ddb1":"markdown","8ff64331":"markdown","6add1f85":"markdown","a83678a5":"markdown","563ce784":"markdown","d9b4dd05":"markdown","8f8a73f5":"markdown","48af7308":"markdown","e1798b57":"markdown","22f63e3c":"markdown","145cf517":"markdown","c1016fc3":"markdown","ec24e58e":"markdown","9e829e1b":"markdown"},"source":{"391c4769":"%matplotlib inline\nimport pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt","d24618b5":"all_data = pd.read_csv(\"..\/input\/Churn_Modelling.csv\")","6be9e0bc":"all_data.info()","a3d9c003":"all_data.describe()","4171bf30":"all_data['Geography'].value_counts()","d2ef0553":"sns.barplot(x='Geography',y='Exited', hue='Gender',data=all_data)","5c8822a9":"all_data.columns","d3facd35":"dummy_gender = pd.get_dummies(all_data['Gender'], prefix='Gender')","10c8f275":"dummy_geo = pd.get_dummies(all_data['Geography'],prefix = 'Geo')","8866e345":"dummy_NoOfProducts=pd.get_dummies(all_data['NumOfProducts'],prefix='NOP')","5f14c75b":"a=sns.FacetGrid(all_data,hue='Exited',aspect=6)\na.map(sns.kdeplot,'Age',shade=True)\na.set(xlim=[0,all_data['Age'].max()])\na.add_legend()","a2f2bb90":"bins = [18,22,34,40,60,80,100]\nlabels = ['18-22','23-34','35-40','41-60','61-80','81-100']\ndummy_age_labels=pd.cut(all_data['Age'],bins,labels=labels,right=False)","37f24f86":"all_data['Age_labeled']= dummy_age_labels","27bf7452":"sns.barplot(x='Age_labeled',y='NumOfProducts',hue='Gender', data = all_data)","5b4d326b":"sns.barplot(x = 'Age_labeled',y='Exited',hue='Gender',data=all_data)","4d4d344c":"dummy_age=pd.get_dummies(all_data['Age_labeled'],prefix='Age')","d0c17d77":"bins =[300,579,669,739,799,850]\nlabels =['Very Poor','Fair','Good','Very Good','Exceptional']\ndummy_crdscore_labels=pd.cut(all_data['CreditScore'],bins,labels=labels)\nall_data['CreditScore_labled']= dummy_crdscore_labels\ndummy_creditscore = pd.get_dummies(all_data['CreditScore_labled'], prefix = 'CreditLevel')","0aee4801":"sns.barplot(x = 'CreditScore_labled',y='Exited',hue='Gender',data=all_data)","223fc3fe":"bins = [0,1,5,8,11]\nlabels = ['0-1','1-5','5-8','8-11']\ndummy_tenure_labels=pd.cut(all_data['Tenure'],bins,labels=labels,right=False)\nall_data['Tenure_labeled']= dummy_tenure_labels\ndummy_tenure = pd.get_dummies(all_data['Tenure_labeled'],prefix = 'Tenure')","e373f1d9":"sns.barplot(x = 'Tenure_labeled',y='Exited',hue='Gender',data=all_data)","70728071":"from sklearn.preprocessing import StandardScaler\nall_data['Balance'] = StandardScaler().fit_transform(all_data.filter(['Balance']))\nall_data['EstimatedSalary'] = StandardScaler().fit_transform(all_data.filter(['EstimatedSalary']))","2a8279c7":"data_combined = pd.concat([\n    all_data, dummy_age, dummy_tenure, dummy_creditscore, dummy_geo,\n    dummy_gender, dummy_NoOfProducts\n],\n                          axis=1)","41ddf5ac":"data_combined.drop(\n    ['Gender', 'Age', 'CreditScore', 'Geography', 'NumOfProducts', 'Tenure'],\n    axis=1,\n    inplace=True)","87eaed30":"data_combined.drop([\n    'Surname', 'CustomerId', 'Age_labeled', 'CreditScore_labled',\n    'Tenure_labeled'\n],\n                   axis=1,\n                   inplace=True)","113fbf9e":"data_combined.head()","ebf412e5":"#\u83b7\u53d6\u6807\u7b7e\u503c \n#Label value\ny_label=data_combined['Exited']\ny_label.shape","5f0cd957":"#\u53bb\u6389\u6807\u7b7e\u503c\uff0c\u4fdd\u7559\u8bad\u7ec3\u7279\u5f81\n#Remove lable value, keep training featurers only.\ndata_combined.drop(['Exited'],axis=1, inplace = True)","06fef7a9":"X_data = data_combined","415ac106":"#\u628a\u6570\u636e\u5212\u5206\u51fa\u8bad\u7ec3\u96c6\u548c\u6d4b\u8bd5\u96c6\n#Split data into trainging set and testing set\nfrom sklearn.model_selection import train_test_split\nx_train,x_test,y_train,y_test = train_test_split(X_data,y_label,test_size=0.2,random_state=2)","4c41476f":"from sklearn.ensemble import RandomForestClassifier\nfrom sklearn.model_selection import GridSearchCV\nparam_grid = [\n    {\n        'n_estimators': [50, 100, 150],\n        'max_leaf_nodes':[50,100,150]\n    },\n    {\n        'bootstrap': [False],\n        'n_estimators': [50, 100,150],\n    },\n]\nchurn_mdl_rf_sm = RandomForestClassifier()\ngrid_search = GridSearchCV(\n    churn_mdl_rf_sm, param_grid, cv=5, scoring='neg_mean_squared_error')\ngrid_search.fit(x_train, y_train)","47dde0f5":"#\u67e5\u770b\u6700\u4f73\u53c2\u6570\n#Check the best parameters\ngrid_search.best_params_","c76fbe7c":"#\u4f7f\u7528\u6700\u4f73\u53c2\u6570\u5efa\u7acb\u5206\u7c7b\u5668\n#Use the best parameters for the classifier\nchurn_mdl_rf = RandomForestClassifier(\n    random_state=2,\n    n_estimators=150,\n    n_jobs=4,\n    max_leaf_nodes=150\n)\nchurn_mdl_rf.fit(x_train, y_train)","b5cd9b15":"from sklearn.model_selection import cross_val_score\ncross_val_score(churn_mdl_rf,x_train, y_train,cv=5)","320e411c":"cross_val_score(churn_mdl_rf,x_test, y_test,cv=5)","58bb6f55":"from sklearn.model_selection import cross_val_score\ncross_val_score(churn_mdl_rf,X_data, y_label,cv=5)","bf61fd31":"\u4ece\u4e0b\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u65e0\u8bba\u7537\u5973\uff0c\u5904\u4e8e\u4fe1\u7528\u4e2d\u6bb5\u7684\u5ba2\u6237\u9000\u51fa\u7684\u6982\u7387\u8f83\u4f4e\uff0c\u53ef\u80fd\u662f\u56e0\u4e3a\u592a\u4f4e\u7684\u65e0\u5fc3\u7559\u604b\uff0c\u800c\u5f88\u9ad8\u7684\u5219\u53ef\u80fd\u9762\u4e34\u5176\u4ed6\u91d1\u878d\u670d\u52a1\u7684\u8bf1\u60d1\u6216\u8005\u5176\u5b83\u56e0\u7d20  \nFrom the chart below, people who have Good credit score are more intend to stay with the bank","519a0813":"Geography\u505a\u72ec\u70ed\u5316\u5904\u7406  \nOne-hot encoding Geography ","6e5515bb":"\u628a\u94f6\u884c\u5b58\u6b3e\u4f59\u989d\u4e0e\u85aa\u6c34\u6807\u51c6\u5316\u5904\u7406  \nStandardize Balance and EstimatedSalary","d370cb3e":"\u4ece\u4e0b\u56fe\u5219\u53ef\u4ee5\u770b\u51fa\uff0c\u968f\u7740\u5de5\u4f5c\u5e74\u9f84\u7684\u589e\u52a0\uff0c\u9000\u51fa\u94f6\u884c\u670d\u52a1\u7684\u6bd4\u4f8b\u4f1a\u964d\u4f4e\uff0c\u8fd9\u70b9\u5bf9\u7537\u6027\u6765\u8bb2\u66f4\u52a0\u786e\u5b9a\uff0c\u4f46\u662f\u5947\u602a\u7684\u662f\uff0c\u5973\u6027\u7684\u6bd4\u4f8b\u6709\u70b9\u70b9\u4e0a\u5347  \nFrom the chat below, we can find with the tenure increasing, people are more intend to stay with bank, especially for male","7acadaae":"\u4f7f\u7528\u4ea4\u53c9\u9a8c\u8bc1\u6765\u8bc4\u4f30\u6a21\u578b,\u53ef\u4ee5\u770b\u51fa\u5e73\u5747\u51c6\u786e\u5ea6\u572885%\u5de6\u53f3  \nUse cross validate to evaluate the model\uff0caccuracy is about 85%","33c496f3":"NumOfProducts\u505a\u72ec\u70ed\u5316\u5904\u7406  \nOne-hot encoding number of products","cf099ee7":"\u5f53\u524d\u5355\u4f4d\u5de5\u4f5c\u5e74\u9650 Tenure \u5904\u7406\uff0c\u5206\u62101\uff0c5\uff0c8\uff0c10\u53ca\u4ee5\u4e0a, \u6570\u636e\u91cc10\u662f\u6700\u5927\u4e86\uff0c\u6240\u4ee5\u968f\u4fbf\u53d6\u4e00\u4e2a\u6700\u5927\u503c11  \nSplie Tenure into 4 section, according to bank standard","c1cfe29e":"\u628aGender\u6570\u5b57\u5316\uff0c\u5e76\u505a\u72ec\u70ed\u5316\u5904\u7406  \nOne-hot encoding Gender","6ef974f5":"\u5408\u5e76\u6240\u6709\u5904\u7406\u597d\u7684\u5217\uff0c\u5e76\u5220\u9664\u539f\u6709\u7684\u5217  \nCombine all prepared columns and drop original ones","b274ddb1":"\u770b\u5f97\u51fa\u6765\uff0c\u8fd9\u91cc\u53ea\u6709\u4e09\u4e2a\u56fd\u5bb6\u7684\u6570\u636e\uff0c\u6cd5\u56fd\u7684\u6570\u636e\u51e0\u4e4e\u5360\u4e86\u4e00\u534a\uff0c\u5fb7\u56fd\u8ddf\u897f\u73ed\u7259\u7684\u6570\u91cf\u5dee\u4e0d\u591a\u7684  \nWe can find there are only data for three countries,50% are for France, numbers of Germany and Spain are very close","8ff64331":"\u67e5\u770b\u4e0b\u6570\u636e\u57fa\u672c\u60c5\u51b5\uff0c\u53ef\u4ee5\u770b\u51fa\uff1a  \n1.Age\uff1a\u6700\u5c0f\u5e74\u9f8418\u5c81\uff0c\u6700\u592792\u5c81  \n2.Tenure\uff1a\u5de5\u4f5c\u5e74\u9650\u6700\u77ed\u4e0d\u52301\u5e74\uff0c\u6700\u957f10\u5e74   \n3.CreditScore\uff1a\u6bcf\u4e2a\u4eba\u76ee\u524d\u90fd\u7ed9\u7ed9\u51fa\u4e86\u4fe1\u7528\u5206\u6570\uff0c\u6700\u4f4e350\uff0c\u6700\u9ad8850\uff0c\u770b\u4e0a\u53bb\u5e94\u8be5\u662f\u57fa\u4e8eFICO\u7684\u6807\u51c6  \n4.Balance\uff1a\u8d26\u6237\u4f59\u989d,\u6700\u5c11\u4e3a\u96f6\uff0c\u6700\u591a25\u4e07\u5de6\u53f3   \n5.NumOfProducts\uff1a\u6301\u6709\u94f6\u884c\u4ea7\u54c1\u7684\u6570\u91cf\uff0c\u6700\u5c111\u4e2a\uff0c\u6700\u591a4\u4e2a  \n6.HasCrdCard\uff1a\u662f\u5426\u6301\u6709\u4fe1\u7528\u5361\uff0c\u53ef\u770b\u51fa\u8981\u4e48\u6ca1\u6709\u4fe1\u7528\u5361\uff0c\u8981\u4e48\u6700\u591a\u53ea\u6709\u4e00\u5f20  \n7.IsActiveMember\uff1a\u662f\u5426\u6d3b\u8dc3\u7528\u6237\uff0c\u770b\u6765\u8fd8\u662f\u6709\u5f88\u591a\u4e0d\u6d3b\u8dc3\u7684\u7528\u6237\u7684  \n8.EstimatedSalary: \u85aa\u6c34\u4f30\u8ba1\uff0c\u5c45\u7136\u6700\u5c11\u662f11\uff0c\u8c01\u4f1a\u62ff11\u5757\u7684\u6708\u85aa\uff1f  \n9.Exited\uff1a\u8868\u793a\u7528\u6237\u662f\u5426\u5df2\u7ecf\u9000\u51fa\uff0c1\u8868\u793a\u9000\u51fa\uff0c0\u8868\u793a\u5b58\u6d3b \n\nfrom the data, we found that:  \n1.Age: between 18-92  \n2.Tenure:less then one year to 10 years  \n3.CreditScore: This score should should be according to FICO standard, it's between 350-850  \n4.Balance: 0 - ~250,000  \n5.NumOfProduct: Number of product, it's between 1-4  \n6.HasCrdCard:Some people have credit card, some don't  \n7.IsActiveMember: Whether an user is active or not  \n8.EstimatedSalary: it's between 11 - ~200000, who has 11 as salary\uff1f  \n9.Exited: 1 - exited, 0 - existed  ","6add1f85":"\u5e74\u9f84\u7684\u79bb\u6563\u5316\uff0c\u5206\u62106\u6bb5,\u8fd9\u4e2a\u662f\u6309\u7167\u94f6\u884c\u5185\u90e8\u6807\u51c6\u6765\u7684  \nSplit age into 6 section, according to bank starndard","a83678a5":"\u67e5\u770b\u4e0b\u6700\u540e\u7684\u6570\u636e\uff0c\u73b0\u5728\u6240\u6709\u5206\u7c7b\u7c7b\u578b\u90fd\u505a\u4e86\u70ed\u72ec\u5316\uff0c\u6570\u5b57\u7c7b\u578b\u7684\u6bd4\u5982\u4f59\u989d\u548c\u85aa\u6c34\u4f30\u503c\u90fd\u505a\u4e86\u5f52\u4e00\u5316","563ce784":"\u6d4b\u8bd5\u96c6\u7684\u4ea4\u53c9\u9a8c\u8bc1\u7ed3\u679c  \nCross validation by using testing dataset","d9b4dd05":"## \u6839\u636e\u5df2\u6709\u6570\u636e\u5efa\u7acb\u4e00\u4e2a\u6a21\u578b\u9884\u6d4b\u7ed9\u5b9a\u7528\u6237\u662f\u5426\u4f1a\u9000\u51fa\u94f6\u884c\u670d\u52a1\n## Given a Bank customer, can we build a classifier which can determine whether they will leave or not?\n\u6570\u636e\u96c6\u6765\u6e90 Dataset from\nhttps:\/\/www.kaggle.com\/barelydedicated\/bank-customer-churn-modeling","8f8a73f5":"\u68c0\u67e5\u6570\u636e\u4fe1\u606f\uff0c\u770b\u4e0a\u53bb\u975e\u5e38\u6574\u9f50\u6ca1\u6709\u7f3a\u5931  \nCheck all data info, seems quite well formated and no missing value","48af7308":"\u6309\u5730\u57df\u67e5\u770b\u9000\u51fa\u7684\u60c5\u51b5\uff0c\u5fb7\u56fd\u4eba\u7684\u9000\u51fa\u7387\u660e\u663e\u9ad8\u4e8e\u6cd5\u56fd\u548c\u897f\u73ed\u7259\uff0c\u800c\u4e14\u4e0d\u7ba1\u662f\u54ea\u4e2a\u56fd\u5bb6\uff0c\u5973\u6027\u7684\u9000\u51fa\u7387\u9ad8\u4e8e\u7537\u6027\nCheck the relationship between country and 'Exited', so German quit more that other countries and from gender perspective, females are more intended to quit","e1798b57":"\u4f7f\u7528\u7f51\u683c\u641c\u7d22\u627e\u51fa\u968f\u673a\u68ee\u6797\u7684\u5408\u9002\u8d85\u53c2\u6570  \nUse grid search to find best super parameter for random forest classifier","22f63e3c":"\u6bcf\u4e2a\u5e74\u9f84\u6bb5\u6301\u6709\u94f6\u884c\u4ea7\u54c1\u6570\u91cf\u7684\u5206\u5e03\uff0c\u53ef\u4ee5\u770b\u51fa\uff0c\u7edd\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u90fd\u662f\u5973\u6027\u6bd4\u7537\u6027\u7684\u6301\u6709\u66f4\u591a\uff0c\u4f46\u6570\u91cf\u63a5\u8fd1\uff0c\u7537\u6027\u572880\u5c81\u4ee5\u540e\u5374\u6bd4\u5973\u6027\u5c11\u4e86\u5f88\u591a  \nThis chart shows that number of product held by people in each age section, and we can find at most sections, female hold more than male","145cf517":"## \u5904\u7406\u4fe1\u7528\u8bc4\u5206\u7b49\u7ea7\uff0c\u6309\u7167FICO\u6807\u51c6  \n## Split credit score into 5 sections, based on FICO standard\n\n\u5206\u6570\u533a\u95f4\t\u8bc4\u7ea7\t\n300-579\tVery Poor\t\n580-669\tFair\t\n670-739\tGood\t\n740-799\tVery Good\t\n800-850\tExceptional\t\n\n300-579\uff1a\u5f88\u4f4e\uff0c\u8868\u793a\u4f60\u662f\u4e00\u4e2a\u975e\u5e38\u6709\u98ce\u9669\u7684\u5ba2\u6237\uff0c\u4e00\u822c\u662f\u4fe1\u7528\u62a5\u544a\u4e0a\u6709\u975e\u5e38\u4e25\u91cd\u7684\u6b20\u503a\u95ee\u9898  \n580-669\uff1a\u8f83\u4f4e\uff0c\u62a5\u544a\u4e0a\u53ef\u80fd\u6709\u4e00\u4e9b\u98ce\u9669\u56e0\u7d20\uff0c\u6bd4\u5982late payments\u8f83\u591a  \n670-739\uff1a\u5e73\u5747\uff0c\u5927\u90e8\u5206\u4eba\u7684\u5206\u6570\u533a\u95f4\uff0c\u4e00\u822c\u6765\u8bf4\u5728\u8fd9\u4e2a\u8303\u56f4\u5185\u5c31\u4e0d\u7528\u62c5\u5fc3\u5565\u4e86  \n740-799\uff1a\u5f88\u597d\uff0c\u4fe1\u7528\u8bb0\u5f55\u5f88\u4e0d\u9519  \n800-850\uff1a\u6781\u597d\uff0c\u8fd9\u79cd\u4fe1\u7528\u5206\u7533\u5361\u6765\u4e00\u5f20\u79d2\u4e00\u5f20\u7684\u611f\u89c9~  ","c1016fc3":"\u5bf9\u6574\u4e2a\u6570\u636e\u96c6\u7684\u4ea4\u53c9\u9a8c\u8bc1  \nCross validation by using the whole dataset","ec24e58e":"\u67e5\u770b\u4e0b\u968f\u7740\u5e74\u9f84\u7684\u53d8\u5316\uff0c\u9000\u51fa\u94f6\u884c\u7684\u4eba\u6570\u5206\u5e03    \nCheck how the number of exited change according to the age","9e829e1b":"\u67e5\u770b\u5e74\u9f84\u6bb5\uff0c\u6027\u522b\u4e0e\u9000\u51fa\u94f6\u884c\u670d\u52a1\u7684\u5173\u7cfb\uff0c\u4ece\u4e0b\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u4e0d\u7ba1\u7537\u5973, \u51e0\u4e4e\u90fd\u572841-80\u5c81\u4e4b\u95f4\u9000\u51fa\u94f6\u884c\u670d\u52a1\uff0c\u800c\u4e14\u5176\u4e2d\u5973\u6027\u9000\u51fa\u7684\u6982\u7387\u5927\u4e8e\u7537\u6027\uff0c\u4e14\u4e0e\u5e74\u9f84\u6bb5\u65e0\u5173  \nCheck how Age, Gender related to 'Exited', the chart below show that no matter male or female, if people intend to exit, most of them will do this between 41-80 years old. Also, number of female exit is more that of male."}}