{"cell_type":{"112d9cab":"code","e7865734":"code","e1153c8b":"code","485c8290":"code","cfd330dd":"code","5dfdaf8d":"code","47ddb94c":"code","88927514":"code","5be063af":"code","a6a8a86b":"code","76a4778c":"code","46807356":"code","5df1c76a":"code","9f557bf7":"code","266ad098":"code","41fad31c":"code","0307a1a4":"code","64069146":"code","bbb3cc60":"code","f0287559":"code","ea1a898f":"code","dbc7d55d":"code","15ba74c1":"code","632ced92":"markdown","d774b2cb":"markdown","006dceb0":"markdown","9d5692d4":"markdown","8e5f9cac":"markdown","9d9287df":"markdown","89257ea6":"markdown","adf12096":"markdown","cc6c28f2":"markdown","bff76201":"markdown","df046555":"markdown","7c1a8855":"markdown","28541210":"markdown","ccef91c2":"markdown","08b09e9e":"markdown","adac058f":"markdown","c9e812d1":"markdown","51fb549f":"markdown","deba4cf7":"markdown","fb529468":"markdown","81bb380f":"markdown","df71f166":"markdown","892944eb":"markdown","e433e6cf":"markdown","7f3c2003":"markdown","6b98e5d7":"markdown","9879234e":"markdown","4620568f":"markdown","376ff035":"markdown","a35f9e7e":"markdown","85a05f59":"markdown","99db0dee":"markdown","1469e15a":"markdown","a0c68a8c":"markdown","3e0415ef":"markdown","8a10a16b":"markdown","8b87c2c3":"markdown","33260918":"markdown"},"source":{"112d9cab":"import os\nimport json\n\nimport numpy as np\nimport pandas as pd\nimport seaborn as sn\nimport matplotlib.pyplot as plt\nimport cv2\nimport albumentations as A\nfrom sklearn import metrics as sk_metrics","e7865734":"BASE_DIR = \"..\/input\/cassava-leaf-disease-classification\/\"","e1153c8b":"with open(os.path.join(BASE_DIR, \"label_num_to_disease_map.json\")) as file:\n    map_classes = json.loads(file.read())\n    map_classes = {int(k) : v for k, v in map_classes.items()}\n    \nprint(json.dumps(map_classes, indent=4))","485c8290":"input_files = os.listdir(os.path.join(BASE_DIR, \"train_images\"))\nprint(f\"Number of train images: {len(input_files)}\")","cfd330dd":"img_shapes = {}\nfor image_name in os.listdir(os.path.join(BASE_DIR, \"train_images\"))[:300]:\n    image = cv2.imread(os.path.join(BASE_DIR, \"train_images\", image_name))\n    img_shapes[image.shape] = img_shapes.get(image.shape, 0) + 1\n\nprint(img_shapes)","5dfdaf8d":"df_train = pd.read_csv(os.path.join(BASE_DIR, \"train.csv\"))\n\ndf_train[\"class_name\"] = df_train[\"label\"].map(map_classes)\n\ndf_train","47ddb94c":"plt.figure(figsize=(8, 4))\nsn.countplot(y=\"class_name\", data=df_train);","88927514":"def visualize_batch(image_ids, labels):\n    plt.figure(figsize=(16, 12))\n    \n    for ind, (image_id, label) in enumerate(zip(image_ids, labels)):\n        plt.subplot(3, 3, ind + 1)\n        image = cv2.imread(os.path.join(BASE_DIR, \"train_images\", image_id))\n        image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n\n        plt.imshow(image)\n        plt.title(f\"Class: {label}\", fontsize=12)\n        plt.axis(\"off\")\n    \n    plt.show()","5be063af":"tmp_df = df_train.sample(9)\nimage_ids = tmp_df[\"image_id\"].values\nlabels = tmp_df[\"class_name\"].values\n\nvisualize_batch(image_ids, labels)","a6a8a86b":"tmp_df = df_train[df_train[\"label\"] == 0]\nprint(f\"Total train images for class 0: {tmp_df.shape[0]}\")\n\ntmp_df = tmp_df.sample(9)\nimage_ids = tmp_df[\"image_id\"].values\nlabels = tmp_df[\"label\"].values\n\nvisualize_batch(image_ids, labels)","76a4778c":"tmp_df = df_train[df_train[\"label\"] == 1]\nprint(f\"Total train images for class 1: {tmp_df.shape[0]}\")\n\ntmp_df = tmp_df.sample(9)\nimage_ids = tmp_df[\"image_id\"].values\nlabels = tmp_df[\"label\"].values\n\nvisualize_batch(image_ids, labels)","46807356":"tmp_df = df_train[df_train[\"label\"] == 2]\nprint(f\"Total train images for class 2: {tmp_df.shape[0]}\")\n\ntmp_df = tmp_df.sample(9)\nimage_ids = tmp_df[\"image_id\"].values\nlabels = tmp_df[\"label\"].values\n\nvisualize_batch(image_ids, labels)","5df1c76a":"tmp_df = df_train[df_train[\"label\"] == 3]\nprint(f\"Total train images for class 3: {tmp_df.shape[0]}\")\n\ntmp_df = tmp_df.sample(9)\nimage_ids = tmp_df[\"image_id\"].values\nlabels = tmp_df[\"label\"].values\n\nvisualize_batch(image_ids, labels)","9f557bf7":"tmp_df = df_train[df_train[\"label\"] == 4]\nprint(f\"Total train images for class 4: {tmp_df.shape[0]}\")\n\ntmp_df = tmp_df.sample(9)\nimage_ids = tmp_df[\"image_id\"].values\nlabels = tmp_df[\"label\"].values\n\nvisualize_batch(image_ids, labels)","266ad098":"def plot_augmentation(image_id, transform):\n    plt.figure(figsize=(16, 4))\n    img = cv2.imread(os.path.join(BASE_DIR, \"train_images\", image_id))\n    img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)\n\n    plt.subplot(1, 3, 1)\n    plt.imshow(img)\n    plt.axis(\"off\")\n\n    plt.subplot(1, 3, 2)\n    x = transform(image=img)[\"image\"]\n    plt.imshow(x)\n    plt.axis(\"off\")\n\n    plt.subplot(1, 3, 3)\n    x = transform(image=img)[\"image\"]\n    plt.imshow(x)\n    plt.axis(\"off\")\n    \n    plt.show()","41fad31c":"transform_shift_scale_rotate = A.ShiftScaleRotate(\n    p=1.0, \n    shift_limit=(-0.3, 0.3), \n    scale_limit=(-0.1, 0.1), \n    rotate_limit=(-180, 180), \n    interpolation=0, \n    border_mode=4, \n)\n\nplot_augmentation(\"1003442061.jpg\", transform_shift_scale_rotate)","0307a1a4":"transform_coarse_dropout = A.CoarseDropout(\n    p=1.0, \n    max_holes=100, \n    max_height=50, \n    max_width=50, \n    min_holes=30, \n    min_height=20, \n    min_width=20,\n)\n\nplot_augmentation(\"1003442061.jpg\", transform_coarse_dropout)","64069146":"transform = A.Compose(\n    transforms=[\n        transform_shift_scale_rotate,\n        transform_coarse_dropout,\n    ],\n    p=1.0,\n)\n\nplot_augmentation(\"1003442061.jpg\", transform)","bbb3cc60":"df_sub = pd.read_csv(\"..\/input\/cassava-leaf-disease-classification\/sample_submission.csv\", index_col=0)\ndf_sub","f0287559":"os.listdir(os.path.join(BASE_DIR, \"test_images\"))","ea1a898f":"for pred_class in range(0, 5):\n    y_true = df_train[\"label\"].values\n    y_pred = np.full_like(y_true, pred_class)\n    print(f\"accuracy score (predict {pred_class}): {sk_metrics.accuracy_score(y_true, y_pred):.3f}\")","dbc7d55d":"df_sub[\"label\"] = 3","15ba74c1":"df_sub.to_csv(\"submission.csv\")","632ced92":"If you submit the result for evaluation, you will get an accuracy of 0.614 on a public liderboard (on the train it is 0.615). This may indicate that there is also an imbalance of classes on the public test distribution.","d774b2cb":"<a id=\"2\"><\/a>\n<h2 style='background:#5BEB9C; border:0; color:black'><center>General Visualization<center><h2>","006dceb0":"<a id=\"6\"><\/a>\n<h2 style='background:#5BEB9C; border:0; color:black'><center>3 - CMD - Cassava Mosaic Disease<center><h2>","9d5692d4":"<img style=\"height:500px\" src=\"https:\/\/albumentations.ai\/docs\/images\/introduction\/image_augmentation\/augmentation.jpg\">\n<cite>The image from the <a href=\"https:\/\/albumentations.ai\/docs\/introduction\/image_augmentation\/\">Albumentations Documentation<\/a><\/cite>","8e5f9cac":"As we can see, the dataset has a fairly large imbalance.","9d9287df":"The metric of this competition is **Accuracy**.    \nAccuracy - the ratio of the number of samples predicted correctly to the total number of samples","89257ea6":"<a id=\"50\"><\/a>\n<h2 style='background:#5BEB9C; border:0; color:black'><center>Augmentation Examples<center><h2>","adf12096":"<a id=\"1\"><\/a>\n<h2 style='background:#5BEB9C; border:0; color:black'><center>Overview<center><h2>","cc6c28f2":"As we can see only one file in the submission file","bff76201":"<img style=\"height:300px\" src=\"https:\/\/www.googleapis.com\/download\/storage\/v1\/b\/kaggle-forum-message-attachments\/o\/inbox%2F1865449%2F4f2975866feb2a1d4ef4111c2d57db29%2Fgreen_mottle.jpeg?generation=1605829101431013&alt=media\">\n<cite>The image from discussion: <a href=\"https:\/\/www.kaggle.com\/c\/cassava-leaf-disease-classification\/discussion\/198143\">Cassava Lead Diseases: Overview<\/a><\/cite>","df046555":"<img style=\"height:300px\" src=\"https:\/\/www.googleapis.com\/download\/storage\/v1\/b\/kaggle-forum-message-attachments\/o\/inbox%2F1865449%2Fbe9cdd94efb9b1660066ad10b55c8626%2Fbact_bright.jpeg?generation=1605827469211692&alt=media\">\n<cite>The image from discussion: <a href=\"https:\/\/www.kaggle.com\/c\/cassava-leaf-disease-classification\/discussion\/198143\">Cassava Lead Diseases: Overview<\/a><\/cite>","7c1a8855":"Let's calculate the accuracy on a training set if we select only one class for all examples.","28541210":"<a id=\"5\"><\/a>\n<h2 style='background:#5BEB9C; border:0; color:black'><center>2 - CGM - Cassava Green Mottle<center><h2>","ccef91c2":"Let's choose the most popular class of training set as the label for all images in test set","08b09e9e":"Let's take a look at the dimensions of the first 300 images   \nAs you can see below, all images are the same size (600, 800, 3)","adac058f":"Image augmentation is a process of creating new training examples from the existing ones. To make a new sample, you slightly change the original image. For instance, you could make a new image a little brighter; you could cut a piece from the original image; you could make a new image by mirroring the original one, etc. [[source]](https:\/\/albumentations.ai\/docs\/introduction\/image_augmentation\/)","c9e812d1":"<a id=\"top\"><\/a>\n\n<div class=\"list-group\" id=\"list-tab\" role=\"tablist\">\n<h3 class=\"list-group-item list-group-item-action active\" data-toggle=\"list\" style='color:black; background:#5BEB9C; border:0' role=\"tab\" aria-controls=\"home\"><center>Quick Navigation<\/center><\/h3>\n\n* [Overview](#1)\n    \n    \n* [General Visualization](#2)\n* [0 - CBB - Cassava Bacterial Blight](#3)\n* [1 - CBSD - Cassava Brown Streak Disease](#4)\n* [2 - CGM - Cassava Green Mottle](#5)\n* [3 - CMD - Cassava Mosaic Disease](#6)\n* [4 - Healthy](#7)\n    \n    \n* [Augmentation Examples](#50)\n    \n    \n* [Submission Example](#100)","51fb549f":"$$Accuracy\\ Score = \\frac{The\\ number\\ of\\ samples\\ predicted\\ correctly}{Total\\ number\\ of\\ samples}$$","deba4cf7":"<img style=\"height:300px\" src=\"https:\/\/www.googleapis.com\/download\/storage\/v1\/b\/kaggle-forum-message-attachments\/o\/inbox%2F1865449%2F36990f77ded6667e5c30d19b5405d4d3%2Fmosaic_disease.jpeg?generation=1605829705010773&alt=media\">\n<cite>The image from discussion: <a href=\"https:\/\/www.kaggle.com\/c\/cassava-leaf-disease-classification\/discussion\/198143\">Cassava Lead Diseases: Overview<\/a><\/cite>","fb529468":"Another useful augmentation could be CoarseDropout. Thanks to this augmentation, you can complicate the life of the model so that she does not look too closely at some of the details of the image.   \nLet's look at the example below:","81bb380f":"Since we have a fairly limited number of some classes, we can use augmentation    \nThis section shows examples of augmentation using the [albumentations](https:\/\/albumentations.ai\/) library","df71f166":"The example below uses rotate-shift-scale augmentation with specular edge complementation. For this kind of pictures, this augmentation looks quite natural.","892944eb":"# Cassava Leaf Disease Classification - Exploratory Data Analysis\n\nQuick Exploratory Data Analysis for [Cassava Leaf Disease Classification](https:\/\/www.kaggle.com\/c\/cassava-leaf-disease-classification) challenge    \n\nThis competition will challenge you to distinguish between several diseases that cause material harm to the food supply of many African countries. In some cases the main remedy is to burn the infected plants to prevent further spread, which can make a rapid automated turnaround quite useful to the farmers.","e433e6cf":"![](https:\/\/storage.googleapis.com\/kaggle-competitions\/kaggle\/13836\/logos\/header.png)","7f3c2003":"Let's load the training dataframe and add a column with the real class name to it.","6b98e5d7":"Since we have a large imbalance of classes, if we predict the most frequent class, then our accuracy is greater in this case","9879234e":"This is because [it is a Code Competition](https:\/\/www.kaggle.com\/c\/cassava-leaf-disease-classification\/overview\/code-requirements), and the test data is hidden   \nYour notebook should correct working with unseen test dataset\n\nThe full set of test images will only be available to your notebook when it is submitted for scoring.    \nExpect to see roughly 15,000 images in the test set.    ","4620568f":"<a id=\"3\"><\/a>\n<h2 style='background:#5BEB9C; border:0; color:black'><center>0 - CBB - Cassava Bacterial Blight<center><h2>","376ff035":"In this competition we have 5 classes: **4 diseases** and **1 healthy**   \nWe can find the mapping between the class number and its name in the file label_num_to_disease_map.json","a35f9e7e":"<a id=\"7\"><\/a>\n<h2 style='background:#5BEB9C; border:0; color:black'><center>4 - Healthy<center><h2>","85a05f59":"<img style=\"height:300px\" src=\"https:\/\/www.googleapis.com\/download\/storage\/v1\/b\/kaggle-forum-message-attachments\/o\/inbox%2F1865449%2Ffeba3dafc914d04517659650d137b77a%2Fbrown_st.jpeg?generation=1605830407530983&alt=media\">\n<cite>The image from discussion: <a href=\"https:\/\/www.kaggle.com\/c\/cassava-leaf-disease-classification\/discussion\/198143\">Cassava Lead Diseases: Overview<\/a><\/cite>","99db0dee":"# WORK IN PROGRESS...","1469e15a":"We can compose two or more augmentations into one process.    \nFor example, let's use shift-scale-rotate and CoarseDropout consistently:","a0c68a8c":"Load the submission template","3e0415ef":"<a id=\"4\"><\/a>\n<h2 style='background:#5BEB9C; border:0; color:black'><center>1 - CBSD - Cassava Brown Streak Disease<center><h2>","8a10a16b":"And then write result to the submission file","8b87c2c3":"Let's look at the number of pictures in each class.","33260918":"<a id=\"100\"><\/a>\n<h2 style='background:#5BEB9C; border:0; color:black'><center>Submission Example<center><h2>"}}