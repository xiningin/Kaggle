{"cell_type":{"35182ffe":"code","3a5ab563":"code","be4e0970":"code","056f6fcd":"code","75feb47a":"code","2c1d9d29":"code","3203d6d6":"code","43780c03":"code","b3873122":"code","8844b779":"code","50ef235f":"code","d48a704c":"code","1474f623":"code","bd7f8964":"code","56875258":"markdown","1aa3ef72":"markdown","d0220932":"markdown","e19f324c":"markdown","a319a981":"markdown","39caf4ac":"markdown","df8bab2a":"markdown","a45b097e":"markdown","d6859070":"markdown","1c9ca294":"markdown","ab6f0ca9":"markdown","c86629c0":"markdown","e1e8a16e":"markdown","25267466":"markdown","7a2442c9":"markdown","119abf2d":"markdown","a1b7a9b7":"markdown","7f174254":"markdown"},"source":{"35182ffe":"# Import all the libraries which will be used in the exploration process\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\nimport seaborn as sns # for data visualisations\nimport matplotlib.pyplot as plt # for data plotting and visualisations\nfrom matplotlib.pyplot import figure, pie\nfrom mpl_toolkits.basemap import Basemap\nfrom matplotlib.patches import Polygon\nfrom matplotlib.collections import PatchCollection\nfrom matplotlib.patches import PathPatch\nimport math\n\nimport bq_helper\nfrom bq_helper import BigQueryHelper\n\n# Input data files are available in the \"..\/input\/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nimport os\nprint(os.listdir(\"..\/input\"))\n\n# Any results you write to the current directory are saved as output.","3a5ab563":"from pylab import rcParams\nrcParams['figure.figsize'] = 40, 10","be4e0970":"chicago_crime = bq_helper.BigQueryHelper(active_project=\"bigquery-public-data\", dataset_name=\"chicago_crime\")\nbq_assistant = BigQueryHelper(\"bigquery-public-data\", \"chicago_crime\")","056f6fcd":"select_query = \"\"\"SELECT date,district,primary_type,location_description,ward,arrest,domestic,community_area,year,latitude,longitude,location\n            FROM `bigquery-public-data.chicago_crime.crime`\n            LIMIT 300000\"\"\"\ncrime_data = chicago_crime.query_to_pandas_safe(select_query)","75feb47a":"month_year_frame = pd.DataFrame(columns=[])\n\nfor i in range(0,crime_data.shape[0]):\n    month = crime_data.iloc[i].date.strftime(\"%b\")\n    year = str(crime_data.iloc[i].year)\n        \n    try:\n        get_count = month_year_frame.at[month, year]\n        if np.isnan(get_count):\n            month_year_frame.at[month, year] = 1\n        else:\n            month_year_frame.at[month, year] = get_count+1\n    except (ValueError,KeyError):\n        month_year_frame.at[month, year] = 1\n\nmonth_year_frame.index = pd.CategoricalIndex(month_year_frame.index, \n                               categories=['Jan', 'Feb', 'Mar', 'Apr','May','Jun', 'Jul', 'Aug','Sep', 'Oct', 'Nov', 'Dec'])\nmonth_year_frame = month_year_frame.sort_index()\nmonth_year_frame = month_year_frame.reindex(sorted(month_year_frame.columns), axis=1)\n\nsns.heatmap(month_year_frame, cmap='gist_ncar')","2c1d9d29":"corresponding_arrest = pd.DataFrame(columns=[])\n\nfor i in range(0,crime_data.shape[0]):\n    month = crime_data.iloc[i].date.strftime(\"%b\")\n    year = str(crime_data.iloc[i].year)\n\n    if crime_data.iloc[i].arrest:        \n        try:\n            get_count = corresponding_arrest.at[month, year]\n\n            if np.isnan(get_count):\n                corresponding_arrest.at[month, year] = 1\n            else:\n                corresponding_arrest.at[month, year] = get_count+1\n        except (ValueError,KeyError):\n            corresponding_arrest.at[month, year] = 1\n            \ncorresponding_arrest.index = pd.CategoricalIndex(corresponding_arrest.index, \n                               categories=['Jan', 'Feb', 'Mar', 'Apr','May','Jun', 'Jul', 'Aug','Sep', 'Oct', 'Nov', 'Dec'])\ncorresponding_arrest = corresponding_arrest.sort_index()\ncorresponding_arrest = corresponding_arrest.reindex(sorted(corresponding_arrest.columns), axis=1)","3203d6d6":"fig = plt.figure()\nax1 = fig.add_subplot(121)\nax2 = fig.add_subplot(122)\n\nsns.heatmap(month_year_frame, cmap=\"gist_ncar\",ax=ax1)\nsns.heatmap(corresponding_arrest, cmap=\"gist_ncar\",ax=ax2)","43780c03":"district_list = []\n\nfor i in range(0,crime_data.shape[0]):\n    district = crime_data.iloc[i].district\n    arrest = crime_data.iloc[i].arrest\n    get_index = -1\n    \n    for j in range(0, len(district_list)):\n        if (district_list[j][0] == district):\n            get_index = j\n            if arrest:\n                district_list[j][1]+=1\n            else:\n                district_list[j][2]+=1\n    \n    if get_index == -1:\n        if arrest:\n            district_list.append([district, 1, 0])\n        else:\n            district_list.append([district, 0, 1])\n\n\nget_district = pd.DataFrame(columns=['district','arrest','not_arrest'], data=district_list) \nget_district['Total'] = get_district.apply(lambda x: x.arrest+x.not_arrest, axis=1)\n\nsns.set(style=\"whitegrid\")\n\n# Initialize the matplotlib figure\nf, ax = plt.subplots(figsize=(10, 15))\n\n# Load the example car crash dataset\n\n# Plot the total crashes\nsns.set_color_codes(\"pastel\")\nsns.barplot(x=\"Total\", y=\"district\", data=get_district,\n            label=\"Total\", color=\"b\", orient='h')\n\nsns.set_color_codes(\"muted\")\nsns.barplot(x=\"arrest\", y=\"district\", data=get_district,\n            label=\"Arrest\", color=\"b\", orient='h')\n\nax.legend(ncol=2, loc=\"lower right\", frameon=True)\nax.set(ylabel=\"\",\n       xlabel=\"Total cases vs arrest\")\nsns.despine(left=True, bottom=True)","b3873122":"get_type = []\n\nfor i in range(0,crime_data.shape[0]):\n    primary = crime_data.iloc[i].primary_type\n    get_index = -1\n    \n    for j in range(0, len(get_type)):\n        if (get_type[j][0] == primary):\n            get_index = j\n            get_type[j][1]+=1\n    \n    if get_index == -1:\n        get_type.append([primary, 1])\n\ntype_data = pd.DataFrame(columns=['Type', 'count'], data=get_type)\nfig1, ax1 = plt.subplots()\nfig1.set_size_inches(18.5, 10.5)\nax1.pie(type_data['count'], labels=type_data['Type'], autopct='%1.1f%%',startangle=90)\nax1.axis('equal')  # Equal aspect ratio ensures that pie is drawn as a circle.\n\nplt.show()","8844b779":"crime_data['month'] = crime_data.apply(lambda x: x.date.strftime(\"%b\"), axis=1)","50ef235f":"year_range = {\n    1: [2001,2005],\n    2: [2006,2010],\n    3: [2011,2015],\n    4: [2016,2020]\n}\n\ndef get_year_ref(year):\n    for index, dic in enumerate(year_range):\n        gap = year_range[dic]\n        if year >= gap[0] and year <= gap[1]:\n            return dic\n        \nget_month_year = []\n\nfor i in range(0,crime_data.shape[0]):\n    row = crime_data.iloc[i]\n    get_index = -1\n    get_year_index = get_year_ref(row.year)\n    \n    for j in range(0, len(get_month_year)):\n        if get_month_year[j][0] == row.month:\n            get_index = j\n            get_month_year[j][get_year_index]+=1\n    \n    if get_index == -1:\n        create_arr = [0] * 5\n        create_arr[0] = row.month\n        create_arr[get_year_index] = 1\n        get_month_year.append(create_arr)\n\nmonth_wise_crime = pd.DataFrame(columns=['month','2001-2005','2006-2010','2011-2015','2016-2020'], data=get_month_year) \nmonths = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \n          \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"]\nmonth_wise_crime['month'] = pd.Categorical(month_wise_crime['month'], categories=months, ordered=True)\nmonth_wise_crime.sort_values('month', inplace=True)","d48a704c":"rcParams['figure.figsize'] = 20, 10\nsns.barplot(data=month_wise_crime)","1474f623":"fig = plt.figure()\nax1 = fig.add_subplot(221)\nax2 = fig.add_subplot(222)\nax3 = fig.add_subplot(223)\nax4 = fig.add_subplot(224)\n\nsns.barplot(x='month',y='2001-2005', data=month_wise_crime, ax=ax1)\nsns.barplot(x='month',y='2006-2010', data=month_wise_crime, ax=ax2)\nsns.barplot(x='month',y='2011-2015', data=month_wise_crime, ax=ax3)\nsns.barplot(x='month',y='2016-2020', data=month_wise_crime, ax=ax4)","bd7f8964":"fig = plt.figure(figsize=(22, 12))\nax = fig.add_subplot(111)\ncm = plt.get_cmap('Reds')\n\ndistrict_val = pd.DataFrame(crime_data.district.value_counts().reset_index().values, columns=[\"district\", \"count\"])\n\nm = Basemap(projection='lcc', resolution='l', \n            lat_0=41.867779, lon_0=-87.638403,\n            width=0.06E6, height=0.06E6)\nm.drawmapboundary()\n\nm.readshapefile('..\/input\/geo_export_4ea0a4fd-5ba9-4f3f-bb35-ccd16bfc2ff9', \n                    name='world', \n                    drawbounds=True, \n                    color='gray')\n\nfor info,shape in zip(m.world_info, m.world):\n    color = '#dddddd'\n    for i in range(0,len(district_val)):\n        if str(math.ceil(district_val.iloc[i].district)) == info['dist_num']:\n            color =  cm(district_val.iloc[i]['count'] \/ district_val['count'].sum())\n            break\n\n\n    patches = [Polygon(np.array(shape), True)]\n    pc = PatchCollection(patches)\n    pc.set_facecolor(color)\n    ax.add_collection(pc)","56875258":"> The district 4 has the place where the highest crime (37834) taken place among all the district\n\n> The plot represents that the arrest has not made for most of the crime in all the district","1aa3ef72":"The graph shows that the crime rates has been reducing over the years. From the graph, the crime count of 2001-2005 is around 16000 and it gets decreased to around 1500 in the year 2016-2020. This shows that the police department has been taken several actions to reduce and control the crime rates","d0220932":"> Based on the heat trend in the map, it is said that the south of Chicago which is district 4 has the high crime rate and the second would be district 24 followed by district 8.\n\n> The lower crime rate in Chicage are the district 31, followed by district 20 and district 1","e19f324c":"**Note**\nThere will be future improvements in this kernel based on the reviews and the suggestions given for this kernel.","a319a981":"**EDA for Chicago Crime data**\n\nThis is an data exploration performed in the Chicago crime dataset, extracted from the Chicago Police Department's CLEAR (Citizen Law Enforcement Analysis and Reporting) system.\n\n**Note:**\nPlease review my kernels and express your reviews or suggest your recommendation. I respect all the reviews and recommendations and it will be useful for my future works :)\n\nLet's jump into the explorations","39caf4ac":"Let's compare the crime rates based on the time duration. The data is transformed into four categories based on the years: 2001-2005, 2006-2010, 2011-2015, 2016-2020 and we will compare the crime count based on the year gaps.","df8bab2a":"> From the comparison, we can say that the department has maintained the crime rate by making the arrest for the crime, however there is a lack of actions for the crime during the year 2001 to 2012 which can be seen clearly from the heat trends above.","a45b097e":"Let's plot the crime rate based on the district of Chicago. To make this visualization, the shape file of the district is used which is available in the **data.cityofchicago**","d6859070":"The Police department has categorised the crime into several types and Let's see which type of crime has been taken place the more.","1c9ca294":"Let's plot the data which are categoried separtely based on the year with respect to the month. The month is extracted from the date column and stored in a separte column in the crime_data","ab6f0ca9":"**Heatmap** is used to observe the crime counts based on the month and the years. The month is extracted from the date column using the **datetime**","c86629c0":"> The Theft occured over 20.3% around Chicago whereas Battery crime has covered around 18.4% and the third is the 13.1% of criminal damages","e1e8a16e":"Loading the reference of the Chicago crime dataset from the **BigQueryAPI**","25267466":"> The year 2001 has the highest crime count for the range 2001 to present. The crime count goes around 8000 to 12000\n\n> The crime rate has gone down from the May of 2002 and it's been decreased in the upcoming years, which indicates that the Police department has took necessary actions to control the crime rate in Chicago","7a2442c9":"The district plays an important role in crime occurence. The plot will be made for the total crime occurs and the arrest made against the district.","119abf2d":"It is seen that March to August is the month in all the year category data where the crime rate are high when compared to the rest of the months. One possibility would be the temperature of the month when the crime taken place. The temperature of Chicago on the month March to August varies around 12c to 27c which says that the frequency of people in the public place are very high whereas the rest of the month, the temperature is below 10c, so the frequency of people in the public place are very low","a1b7a9b7":"Let's extract the arrest made by the Police Department for the crime in the year 2001 to present and compare with the crime heatmap and the heatmap for the arrest made.","7f174254":"Select the necessary columns from the dataset of the Chicago crime dataset.\n\n**Note**\nThe limit is set to 300000 since loading the full dataset making my kernel suck."}}