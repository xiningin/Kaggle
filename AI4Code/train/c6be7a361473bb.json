{"cell_type":{"318c2974":"code","bbd552d3":"code","d97e02c3":"code","00d6e483":"code","951f8ec5":"code","08fa94bf":"code","bcab2274":"code","2637287a":"code","fc312028":"code","7ce34f06":"code","c888120a":"code","b422add7":"code","c54f80ad":"code","aa8a71b3":"code","a02eb76c":"code","6f9aa79c":"code","d8fb6dd7":"code","280618b2":"code","1f792425":"code","ceb0766b":"code","ed1c8bc5":"code","17575af4":"code","e38b34ef":"code","62c6a329":"code","fcf36c89":"code","bfeeed17":"code","97141c5b":"code","05db3894":"code","9eeef648":"code","15607b6f":"markdown","b3c24c5d":"markdown","6b938edd":"markdown","cef9bc1a":"markdown","c832cd4e":"markdown"},"source":{"318c2974":"import numpy as np\nimport pandas as pd\nimport os\nimport random\nfrom keras.models import Sequential\nfrom keras.layers import Dense\nfrom keras.layers import Dropout\nfrom keras.layers import Flatten\nfrom keras.callbacks import EarlyStopping\nfrom keras.layers.convolutional import Conv2D\nfrom keras.layers.convolutional import MaxPooling2D\nfrom keras.utils import np_utils\nfrom sklearn.preprocessing import LabelBinarizer\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import classification_report, log_loss, accuracy_score\nfrom PIL import Image\nimport matplotlib.pyplot as plt","bbd552d3":"data0 = pd.read_csv('..\/input\/digit-recognizer\/train.csv')","d97e02c3":"print(data0.shape)\ndata0.head()","00d6e483":"n0=len(data0)\nprint(n0)","951f8ec5":"N0=[]\nfor i in range(n0):\n    N0+=[i]\nrandom.shuffle(N0)","08fa94bf":"data2=data0.loc[N0].reset_index(drop=True)\ndata2","bcab2274":"X = data2.iloc[:, 1:]\ny0 = data2.iloc[:, 0]","2637287a":"X.head()","fc312028":"y0","7ce34f06":"plt.figure(figsize=(5,5), dpi=50)\nimg0=X.loc[3].values.reshape(28,28)\nplt.imshow(img0)\nplt.show()","c888120a":"plt.figure(figsize=(5,5), dpi=50)\nimg1=X.loc[4].values.reshape(28,28)\nplt.imshow(img1)\nplt.show()","b422add7":"plt.figure(figsize=(5,5), dpi=50)\nimg2=X.loc[5].values.reshape(28,28)\nplt.imshow(img2)\nplt.show()","c54f80ad":"plt.figure(figsize=(15,5), dpi=50)\nimg3=np.concatenate([img0,img1,img2],1)\nplt.imshow(img3)\nplt.show()","aa8a71b3":"X3D=[]\nfor i in range(n0\/\/3):\n    img0=X.loc[3*i].values.reshape(28,28)\n    img1=X.loc[3*i+1].values.reshape(28,28)\n    img2=X.loc[3*i+2].values.reshape(28,28)\n    X3d=np.concatenate([img0,img1,img2],1)\n    X3D+=[X3d]\nprint(X3D[0])","a02eb76c":"X_images=np.array(X3D).reshape(-1,28,84)","6f9aa79c":"Y3D=[]\nfor i in range(n0\/\/3):\n    Y3D+=[str(y0[3*i])+str(y0[3*i+1])+str(y0[3*i+2])]\nprint(Y3D[0:3])","d8fb6dd7":"binencoder = LabelBinarizer()\ny = binencoder.fit_transform(Y3D)\nprint(y.shape)\ny","280618b2":"X_train, X_test, y_train, y_test = train_test_split(X_images, y, test_size = 0.2, random_state=90)","1f792425":"print(X_train.shape)\nprint(X_test.shape)\nprint(y_train.shape)\nprint(y_test.shape)","ceb0766b":"X_train = X_train\/255\nX_test = X_test\/255\n\nX_train = X_train.reshape(-1,28,84,1).astype('float32')\nX_test = X_test.reshape(-1,28,84,1).astype('float32')","ed1c8bc5":"conv_model = Sequential()\n\nconv_model.add(Conv2D(64,(4,4),input_shape = (28,84,1),activation = 'relu'))\nconv_model.add(MaxPooling2D(pool_size=(2,2)))\nconv_model.add(Conv2D(64,(3,3),activation = 'relu'))\nconv_model.add(MaxPooling2D(pool_size=(2,2)))\nconv_model.add(Dropout(0.2))\nconv_model.add(Flatten())\nconv_model.add(Dense(4000,activation='relu'))\nconv_model.add(Dense(1000, activation='softmax')) #### distinguish 000--999\nconv_model.compile(loss='categorical_crossentropy', optimizer='adam',metrics=['accuracy'])","17575af4":"conv_model.summary()","e38b34ef":"result = conv_model.fit(X_train, y_train, validation_split=0.2, epochs=40, batch_size=92, verbose=2)\nresult","62c6a329":"y_pred=conv_model.predict(X_test)\npred=np.argmax(y_pred,axis=1)\nground = np.argmax(y_test,axis=1)\nprint(classification_report(ground,pred))","fcf36c89":"history_df = pd.DataFrame(result.history)\nhistory_df.loc[:, ['accuracy','val_accuracy']].plot()","bfeeed17":"history_df.loc[:, ['loss','val_loss']].plot()","97141c5b":"plt.figure(figsize=(15,5), dpi=50)\nplt.imshow(img3)\nplt.show()","05db3894":"print(img3.shape)\nimg4=img3.reshape(1,28,84,1)","9eeef648":"pred=conv_model.predict(img4)\nvalue=np.argmax(pred)      \nprint(value)","15607b6f":"# 1-Digit MNIST Data","b3c24c5d":"# Horizontal 3-Digit Sample","6b938edd":"# Conv2D Model","cef9bc1a":"# Create Horizontal 3-Digit MNIST Data","c832cd4e":"# Prediction"}}