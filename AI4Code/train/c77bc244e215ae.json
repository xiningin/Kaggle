{"cell_type":{"838e0063":"code","6b4df382":"code","7fabb063":"code","999d567a":"markdown","0528f863":"markdown","0b86e924":"markdown"},"source":{"838e0063":"import pandas as pd \nimport datetime as dt\nimport matplotlib as mpl","6b4df382":"def astype_cat(dd, cols):\n    for col in cols:\n        if isinstance(col, tuple):\n            col, idx1, idx2 = col\n            for idx in range(idx1, idx2+1):\n                full_col=col+str(idx)\n                dd[full_col]=dd[full_col].astype(\"category\")\n        else:\n            dd[col]=dd[col].astype(\"category\")\n            \ndd=pd.read_csv(\"..\/input\/train_transaction.csv\")\nastype_cat(dd, [\"ProductCD\", (\"card\", 1, 6), \"addr1\", \"addr2\", \"P_emaildomain\", \"R_emaildomain\", (\"M\", 1, 9)])\n\nddid=pd.read_csv(\"..\/input\/train_identity.csv\")\nastype_cat(ddid, [\"DeviceType\", \"DeviceInfo\", (\"id_\", 12, 38)])\n\ndd=dd.merge(ddid, \"left\", \"TransactionID\")\n\ndd[\"datetime\"]=(dd[\"TransactionDT\"].apply(lambda x:dt.timedelta(seconds=x)+pd.Timestamp(\"2017-11-30\")))\n\ndel ddid\n\ndd.head()","7fabb063":"show_cols=[\"datetime\", \"TransactionAmt\", \"card1\", \"card2\", \"card3\", \"id_31\", \"DeviceType\", \"DeviceInfo\"]\nsort_cols=[\"TransactionAmt\"]\n\nfraud=dd.query(\"isFraud==1\")\n\ncat_cols=dd.dtypes.loc[lambda x:x==\"category\"].index\n\ncolors=mpl.cm.tab20.colors\nn_colors=len(colors)\ncolor_spec={i:'background: rgb({})'.format(\",\".join(str(int(255*colval)) for colval in color)) for i, color in enumerate(colors)}\n\ndef color_hash(value):\n    color_idx = hash(value) % n_colors\n    return color_spec[color_idx]\n\nall_show_cols=set(sort_cols)|set(cat_cols)\n\nfraud.sort_values(sort_cols + [\"TransactionDT\"])[show_cols + sorted(all_show_cols-set(show_cols))].head(100).style.applymap(color_hash)","999d567a":"# Show fraud cases","0528f863":"# Load data","0b86e924":"Display table of Fraud cases and hash-color all value to spot identical values quicker."}}