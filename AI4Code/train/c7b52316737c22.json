{"cell_type":{"bcc6139e":"code","88a5b3e7":"code","30b6a5fc":"code","908ef62b":"code","e1122da8":"code","5a39981b":"code","528618ca":"code","9a2274ee":"code","8cc681c9":"code","42cd70a0":"code","1d533652":"code","f69bae1c":"code","eded9566":"code","5fe9c83d":"code","88a1f7cc":"code","e446d36a":"code","f6ed8a4f":"code","cb5d446f":"code","32f821cf":"code","7134a1f0":"code","8ed77d51":"code","80ce501e":"code","77573f8e":"code","dc2d3169":"code","1a1f7096":"code","2c77af60":"code","a71036ed":"code","a7aa10a5":"code","bdc87cb8":"code","51a65e09":"code","42b8a3a4":"code","8027d8db":"code","32d46fe5":"code","65197c13":"code","86f267da":"code","c6784ab9":"code","323e23d1":"code","20f14ef9":"code","62f47f4a":"code","5895b445":"code","620a8b9a":"code","0a81cbca":"code","a9afbd87":"code","b9c4370a":"code","bbed0215":"markdown"},"source":{"bcc6139e":"!pip install multi-prophet","88a5b3e7":"import gc\nfrom tqdm import tqdm\nimport numpy as np\nimport pandas as pd\nfrom pylab import rcParams\nimport matplotlib.pyplot as plt\nfrom sklearn.metrics import mean_squared_error\nfrom sklearn.preprocessing import LabelEncoder\nfrom scipy.stats import probplot\nimport datetime as dt\nfrom datetime import date\nfrom datetime import timedelta\nfrom fbprophet import Prophet\nfrom multi_prophet import MultiProphet\nimport os\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n%matplotlib inline","30b6a5fc":"train=pd.read_csv('..\/input\/tabular-playground-series-jan-2022\/train.csv')\ntest=pd.read_csv('..\/input\/tabular-playground-series-jan-2022\/test.csv')","908ef62b":"train.info()","e1122da8":"train['country_store_product']=train['country']+'_'+train['store']+'_'+train['product']\ntest['country_store_product']=test['country']+'_'+test['store']+'_'+test['product']\nName=train['country_store_product'].unique().tolist()\nprint(Name)\nprint(len(Name))","5a39981b":"print(train.columns.tolist())\ntrain","528618ca":"train2=train[['row_id','date','country_store_product','num_sold']]\ntrain2","9a2274ee":"test","8cc681c9":"test2=test[['row_id','date','country_store_product']]\ntest2","42cd70a0":"from datetime import datetime as dt\ndate=[]\nfor item in train2['date']:\n    date+=[dt.strptime(item,'%Y-%m-%d')]\ntrain2['date2']=date\ntrain2","1d533652":"start0 = dt.strptime('2015-01-01', '%Y-%m-%d').date()\nend0   = dt.strptime('2019-12-31', '%Y-%m-%d').date()\n  \ndates0=[]\nfor i in range((end0-start0).days+1):\n    dates0+=[(start0+timedelta(i)).strftime('%Y-%m-%d') ]\nprint(dates0[0:10])","f69bae1c":"train3=pd.DataFrame(columns=['date2']+Name)\ntrain3['date2']=dates0\ntrain3","eded9566":"for item in Name:\n    for i in range(len(dates0)-365):\n        train3.loc[i,item]=train2[train2['country_store_product']==item][train2['date2']==dates0[i]]['num_sold'].tolist()[0]\ntrain3","5fe9c83d":"train3.info()","88a1f7cc":"train3","e446d36a":"item1=train3\nitem1.columns = ['ds','y1','y2','y3','y4','y5','y6','y7','y8','y9','y10','y11','y12','y13','y14','y15','y16','y17','y18']","f6ed8a4f":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y1)","cb5d446f":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y2)","32f821cf":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y3)","7134a1f0":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y4)","8ed77d51":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y5)","80ce501e":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y6)","77573f8e":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y7)","dc2d3169":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y8)","1a1f7096":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y9)","2c77af60":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y10)","a71036ed":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y11)","a7aa10a5":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y12)","bdc87cb8":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y13)","51a65e09":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y14)","42b8a3a4":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y15)","8027d8db":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y16)","32d46fe5":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y17)","65197c13":"rcParams['figure.figsize'] = 20,5\nplt.plot(item1.ds, item1.y18)","86f267da":"mph = MultiProphet(columns=['y1','y2','y3','y4','y5','y6','y7','y8','y9','y10','y11','y12','y13','y14','y15','y16','y17','y18'])\nmph.fit(item1)","c6784ab9":"forecast = mph.predict(item1)\nmph.plot(forecast)","323e23d1":"y1=forecast['y1'][['ds','yhat']][-365:].reset_index(drop=True)\ny2=forecast['y2'][['ds','yhat']][-365:].reset_index(drop=True)\ny3=forecast['y3'][['ds','yhat']][-365:].reset_index(drop=True)\ny4=forecast['y4'][['ds','yhat']][-365:].reset_index(drop=True)\ny5=forecast['y5'][['ds','yhat']][-365:].reset_index(drop=True)\ny6=forecast['y6'][['ds','yhat']][-365:].reset_index(drop=True)\ny7=forecast['y7'][['ds','yhat']][-365:].reset_index(drop=True)\ny8=forecast['y8'][['ds','yhat']][-365:].reset_index(drop=True)\ny9=forecast['y9'][['ds','yhat']][-365:].reset_index(drop=True)\ny10=forecast['y10'][['ds','yhat']][-365:].reset_index(drop=True)\ny11=forecast['y11'][['ds','yhat']][-365:].reset_index(drop=True)\ny12=forecast['y12'][['ds','yhat']][-365:].reset_index(drop=True)\ny13=forecast['y13'][['ds','yhat']][-365:].reset_index(drop=True)\ny14=forecast['y14'][['ds','yhat']][-365:].reset_index(drop=True)\ny15=forecast['y15'][['ds','yhat']][-365:].reset_index(drop=True)\ny16=forecast['y16'][['ds','yhat']][-365:].reset_index(drop=True)\ny17=forecast['y17'][['ds','yhat']][-365:].reset_index(drop=True)\ny18=forecast['y18'][['ds','yhat']][-365:].reset_index(drop=True)","20f14ef9":"test2_1=test2[test2['country_store_product']==Name[0]]\ntest2_2=test2[test2['country_store_product']==Name[1]]\ntest2_3=test2[test2['country_store_product']==Name[2]]\ntest2_4=test2[test2['country_store_product']==Name[3]]\ntest2_5=test2[test2['country_store_product']==Name[4]]\ntest2_6=test2[test2['country_store_product']==Name[5]]\ntest2_7=test2[test2['country_store_product']==Name[6]]\ntest2_8=test2[test2['country_store_product']==Name[7]]\ntest2_9=test2[test2['country_store_product']==Name[8]]\ntest2_10=test2[test2['country_store_product']==Name[9]]\ntest2_11=test2[test2['country_store_product']==Name[10]]\ntest2_12=test2[test2['country_store_product']==Name[11]]\ntest2_13=test2[test2['country_store_product']==Name[12]]\ntest2_14=test2[test2['country_store_product']==Name[13]]\ntest2_15=test2[test2['country_store_product']==Name[14]]\ntest2_16=test2[test2['country_store_product']==Name[15]]\ntest2_17=test2[test2['country_store_product']==Name[16]]\ntest2_18=test2[test2['country_store_product']==Name[17]]","62f47f4a":"y1.columns=['date','num_sold']\ny2.columns=['date','num_sold']\ny3.columns=['date','num_sold']\ny4.columns=['date','num_sold']\ny5.columns=['date','num_sold']\ny6.columns=['date','num_sold']\ny7.columns=['date','num_sold']\ny8.columns=['date','num_sold']\ny9.columns=['date','num_sold']\ny10.columns=['date','num_sold']\ny11.columns=['date','num_sold']\ny12.columns=['date','num_sold']\ny13.columns=['date','num_sold']\ny14.columns=['date','num_sold']\ny15.columns=['date','num_sold']\ny16.columns=['date','num_sold']\ny17.columns=['date','num_sold']\ny18.columns=['date','num_sold']","5895b445":"y1['date']=y1['date'].astype(str)\ny2['date']=y2['date'].astype(str)\ny3['date']=y3['date'].astype(str)\ny4['date']=y4['date'].astype(str)\ny5['date']=y5['date'].astype(str)\ny6['date']=y6['date'].astype(str)\ny7['date']=y7['date'].astype(str)\ny8['date']=y8['date'].astype(str)\ny9['date']=y9['date'].astype(str)\ny10['date']=y10['date'].astype(str)\ny11['date']=y11['date'].astype(str)\ny12['date']=y12['date'].astype(str)\ny13['date']=y13['date'].astype(str)\ny14['date']=y14['date'].astype(str)\ny15['date']=y15['date'].astype(str)\ny16['date']=y16['date'].astype(str)\ny17['date']=y17['date'].astype(str)\ny18['date']=y18['date'].astype(str)","620a8b9a":"test2_1=test2_1.merge(y1,on='date')\ntest2_2=test2_2.merge(y2,on='date')\ntest2_3=test2_3.merge(y3,on='date')\ntest2_4=test2_4.merge(y4,on='date')\ntest2_5=test2_5.merge(y5,on='date')\ntest2_6=test2_6.merge(y6,on='date')\ntest2_7=test2_7.merge(y7,on='date')\ntest2_8=test2_8.merge(y8,on='date')\ntest2_9=test2_9.merge(y9,on='date')\ntest2_10=test2_10.merge(y10,on='date')\ntest2_11=test2_11.merge(y11,on='date')\ntest2_12=test2_12.merge(y12,on='date')\ntest2_13=test2_13.merge(y13,on='date')\ntest2_14=test2_14.merge(y14,on='date')\ntest2_15=test2_15.merge(y15,on='date')\ntest2_16=test2_16.merge(y16,on='date')\ntest2_17=test2_17.merge(y17,on='date')\ntest2_18=test2_18.merge(y18,on='date')","0a81cbca":"test3=pd.concat([test2_1,test2_2,test2_3,test2_4,test2_5,\n                 test2_6,test2_7,test2_8,test2_9,test2_10,\n                 test2_11,test2_12,test2_13,test2_14,test2_15,\n                 test2_16,test2_17,test2_18],axis=0)\ntest3","a9afbd87":"test3=test3[['row_id','num_sold']].sort_values('row_id')\ntest3","b9c4370a":"test3.to_csv('submission.csv',index=False)","bbed0215":"# **TPS0122 Multi Prophet**"}}