{"cell_type":{"aebb14a1":"code","b03175c7":"code","c9032cf0":"code","bb995b2c":"code","4622779c":"code","f2679866":"code","ad80ea04":"code","d6dbc5dd":"code","8c11f5ce":"code","4ed5ad8a":"code","2802d3ec":"code","ef95e7b2":"code","d73ce168":"code","9d077039":"code","7efe1c40":"markdown","5eed2324":"markdown","4de3716d":"markdown","3c33f7b2":"markdown","5af7ca41":"markdown","c565a41b":"markdown","5dd8b437":"markdown","43b7c07d":"markdown","c20115fa":"markdown","126e788a":"markdown","69d57fbd":"markdown","563c9bd4":"markdown","b3b1c00d":"markdown","bc32b72d":"markdown","2d6ee4f7":"markdown","73a2f6dd":"markdown","f1bdae2a":"markdown","dbbc82c1":"markdown","fd160b81":"markdown","d0dfcd5e":"markdown","bea4361c":"markdown","74ac38c7":"markdown","b44d3a6a":"markdown","2e55ed8d":"markdown","7917427d":"markdown","02da120c":"markdown","59d8a3f0":"markdown","6c7027a4":"markdown","50617c79":"markdown","20f0e461":"markdown"},"source":{"aebb14a1":"#importing libraries\nfrom fastai import *\nfrom fastai.vision import *\nfrom fastai.metrics import error_rate\nimport os\nimport pandas as pd\nimport numpy as np","b03175c7":"x  = \"..\/input\/face-mask-dataset\/data\"\npath = Path(x)\npath.ls()","c9032cf0":"np.random.seed(40)\ndata = ImageDataBunch.from_folder(path, train = '.', valid_pct=0.2,\n                                  ds_tfms=get_transforms(), size=224,\n                                  num_workers=4).normalize(imagenet_stats)","bb995b2c":"data.show_batch(rows=3, figsize=(7,6),recompute_scale_factor=True)\n","4622779c":"print(data.classes)\nlen(data.classes)\ndata.c","f2679866":"data","ad80ea04":"learn = cnn_learner(data, models.resnet50, metrics=[accuracy], model_dir = Path('..\/kaggle\/working'),path = Path(\".\"))","d6dbc5dd":"learn.lr_find()\nlearn.recorder.plot(suggestions=True)","8c11f5ce":"lr1 = 1e-3\nlr2 = 1e-1\nlearn.fit_one_cycle(4,slice(lr1,lr2))","4ed5ad8a":"learn.unfreeze()\nlearn.fit_one_cycle(10,slice(1e-4,1e-3))","2802d3ec":"learn.recorder.plot_losses()","ef95e7b2":"interp = ClassificationInterpretation.from_learner(learn)\ninterp.plot_confusion_matrix()","d73ce168":"interp.plot_top_losses(6,figsize = (25,5))","9d077039":"learn.export(file = Path(\"\/kaggle\/working\/export.pkl\"))\nlearn.model_dir = \"\/kaggle\/working\"\nlearn.save(\"stage-1\",return_path=True)","7efe1c40":"<a id=\"top\"><\/a>\n<div class=\"list-group\" id=\"list-tab\" role=\"tablist\">\n<h3 class=\"list-group-item list-group-item-action active\" data-toggle=\"list\"  role=\"tab\" aria-controls=\"home\">Table of content<\/h3>\n\n<font color=\"blue\" size=+1><b>Introduction<\/b><\/font>\n* [1. What is CNN ?](#2)\n* [2. What is Transfer Learning ?](#3)    \n\n<font color=\"blue\" size=+1><b>Library<\/b><\/font>\n* [1. Installation](#4)\n* [2. Import Libraries ](#5)\n    \n<font color=\"blue\" size=+1><b> Load and view your data <\/b><\/font>\n* [1. Setting up path for training data ](#6)\n* [2. Data Loading For training ](#7)\n* [3. Data Explorations ](#8)\n* [4. Print Classes present in the data ](#9)\n\n<font color=\"blue\" size=+1><b> Create and train a model <\/b><\/font>\n* [1. Create Models ](#10)\n* [2. Train Model ](#11)\n* [3. Finding LR ](#12)\n* [4. Finetuning HyperParameter](#13)\n\n<font color=\"blue\" size=+1><b> Others <\/b><\/font>\n* [1. Interpret the results](#14)\n* [2. Prediction Using Trained Model](#15)\n* [3. Save and Load Model](#16)\n* [4. Sources](#17)","5eed2324":"<a id=\"12\"><\/a>\n<font color=\"blue\" size=+2.5><b>4.3 Train Model<\/b><\/font>\n<br\/>","4de3716d":"![image.png](attachment:image.png)","3c33f7b2":"<a id=\"17\"><\/a>\n<font color=\"blue\" size=+2.5><b>5.4 Sources<\/b><\/font>\n<br\/>\n* [Fastai MOOC](https:\/\/course.fast.ai\/)\n* [Fastai library](https:\/\/docs.fast.ai\/)","5af7ca41":"<font size=\"+3\" color=red><b> <center><u>Face Mask Detection using Transfer Learning <\/u><\/center><\/b><\/font>","c565a41b":"<a id=\"10\"><\/a>\n<font color=\"blue\" size=+2.5><b>4.1 Create Model<\/b><\/font>\n<br\/>\n![image.png](attachment:image.png)\n* We now use a pre-trained ResNet50 Convolutional Neural Net model, and use transfer learning to learn weights of only the last layer of the network.\n* Why Transfer learning? Because with transfer learning, you begin with an existing (trained) neural network used for image recognition \u2014 and then tweak it a bit (or more) here and there to train a model for your particular use case. And why do we do that? Training a reasonable neural network would mean needing approximately 300,000 image samples, and to achieve really good performance, we\u2019re going to need at least a million images.\n* In our case, we have approximately 4000+ images in our training set \u2014 you have one guess to decide if that would have been enough if were to train a neural net from scratch.\n* We use the create_cnn() function for loading a pre-trained ResNet18 network, that was trained on around a million images from the ImageNet database.","5dd8b437":"<a id=\"5\"><\/a>\n\n\n<font color=\"blue\" size=+2.5><b>2. Library<\/b><\/font>","43b7c07d":"# Objective\nGoal of this kernel is following:\n- Learn how to implement FastAI on image data.\n- Learn how to implement CNN on custom data.\n- Learn how to Resnet to get better accuracy.\n- Provide Perfect Guide for all the tips and trick to implement CNN and get better accuracy as a Begineer.\n\nI have learned them from [FastAI](https:\/\/docs.fast.ai\/)","c20115fa":"<a id=\"1\"><\/a>\n<font color=\"blue\" size=+2.5><b>Introduction<\/b><\/font>\n","126e788a":"<a id=\"8\"><\/a>\n<font color=\"blue\" size=+2.5><b>3.3 Data Explorations<\/b><\/font>\n<br\/>\n\n*Our image dataset is stored as .jpg files in 2 different folders, with each folder bearing the name of model of the images contained in the folder. We use the ImageDataBunch.from_folder() function to load the images and assign labels the images based on the name of the folder they\u2019re read from.*","69d57fbd":"<a id=\"6\"><\/a>\n<font color=\"blue\" size=+2.5><b>3.1 Setting up path for training data<\/b><\/font>\n\n**Point to be Noted: Number of elements in a list of path is same as number of classes you have**","563c9bd4":"<a id=\"16\"><\/a>\n<font color=\"blue\" size=+2.5><b>5.3 Save and Load Model<\/b><\/font>\n<br\/>\n","b3b1c00d":"<a id=\"4\"><\/a>\n<font color=\"blue\" size=+2.5><b>2.1 Installation<\/b><\/font>\n* Numpy\n* Pandas\n* Matplotlib\n* Fastai","bc32b72d":"### If these kernels impress you,give them an <font size=\"+3\" color=\"red\"><b>Upvote<\/b><\/font>.<br>","2d6ee4f7":"<a id=\"2\"><\/a>\n<font color=\"blue\" size=+2.5><b>1.2  What is CNN ?<\/b><\/font>\n<br\/>\n<br\/>\n![image.png](attachment:image.png)\n**CNN stands for Convolutional Neural Network which is a specialized neural network for processing data that has an input shape like a 2D matrix like images. CNN's are typically used for image detection and classification.**","73a2f6dd":"<a id=\"3\"><\/a>\n<font color=\"blue\" size=+2.5><b>1.3  What is Transfer Learning?<\/b><\/font>\n\n**Transfer learning is the task of using a pre-trained model and applying it to a new task, i.e., transferring the knowledge learned from one task to another. This is useful because the model doesn\u2019t have to learn from scratch and can achieve higher accuracy in less time as compared to models that don\u2019t use transfer learning.**\n![image.png](attachment:image.png)\n**The use of transfer learning in the machine learning domain has surged in the last few years. The following are the top reasons:**\n- **Growth in the ML community and knowledge sharing**: The research and investments by top universities and tech companies have grown exponentially in the last few years and there is also a strong desire to share state-of-the-art models and datasets with the community. This allows people to utilize pre-trained models in a specific area bootstrap quickly.\n- **Common sub-problems**: Another key motivator is that many problems share common sub-problems, e.g., in all visual understanding and prediction areas, tasks such as finding edges, boundaries, and background are common sub-problems. Similarly, in the text domain, the semantic understanding of textual terms can be helpful in almost all problems where the user is represented by text terms, including search, recommendation systems, ads, etc.\n- **Limited supervised learning data and training resources**: Many real-world applications are still mapped onto supervised learning problems where the model is asked to predict a label. One key problem is the limited amount of training data available for models to generalize well. One key advantage of doing transfer learning is that we have the ability to start learning from pre-trained models, and hence, we can utilize the knowledge from similar domains.\n\n<font color=\"blue\" size=+2.5><b> Techniques for transfer learning utilization <\/b><\/font>\n\nThe transfer learning technique can be utilized in the following ways:\n**Extract features from useful layers**\n- Keep the initial layers of the pre-trained model and remove the final layers. Add the new layer to the remaining chunk and train them for final classification.\n**Fine-tuning**\n- Change or tune the existing parameters in a pre-trained network, i.e., optimizing the model parameters during training for the supervised prediction task. A key question with fine-tuning the model is to see how many layers can we freeze and how many final layers we want to fine-tune. This requires understanding the network structure of the model and role of each layer, e.g., for the image classification model we used in the Image data example, once we understand the convolution, pooling, and fully connected layers, we can decide how many final layers we need to fine-tune for our model training process.","f1bdae2a":"<a id=\"5\"><\/a>\n<font color=\"blue\" size=+2.5><b>2.2 Library Import<\/b><\/font>","dbbc82c1":"<font size=\"+3\" color=red > Prerequisites <\/font>","fd160b81":"<a id=\"11\"><\/a>\n<font color=\"blue\" size=+2.5><b>4.2 Finding LR<\/b><\/font>\n<br\/>","d0dfcd5e":"<a id=\"18\"><\/a>\n<font color=\"blue\" size=+2.5><b>Feedback and Support<\/b><\/font>\n<br\/>\n* Your feedback is much appreciated\n* Please UPVOTE if you LIKE this notebook\n* Comment if you have any doubts or you found any errors in the notebook","bea4361c":"<a id=\"7\"><\/a>\n<font color=\"blue\" size=+2.5><b>3.2 Data Loading For training<\/b><\/font>\n<br\/>\n\n**Things to be remember:**\n* Decide validation percentage ( 0.2 => 20% )\n* Provide path for training data\n* [Decide augmentations criteria (optional)](https:\/\/www.kaggle.com\/init27\/introduction-to-image-augmentation-using-fastai\/)\n* Decide image size (which is 224 in my case)\n* Test data can also be added but it's optional","74ac38c7":"<a id=\"13\"><\/a>\n<font color=\"blue\" size=+2.5><b>4.4 Hyper Parameter Tuning<\/b><\/font>\n<br\/>","b44d3a6a":"<a id=\"14\"><\/a>\n<font color=\"blue\" size=+2.5><b>5.1 Interpret the results<\/b><\/font>\n<br\/>","2e55ed8d":"1. [Learn Plotly ](http:\/\/www.kaggle.com\/arbazkhan971\/iris-eda-plotly-25-models-for-beginners)\n2. [Learn Fast ai as a beginner ](https:\/\/www.kaggle.com\/arbazkhan971\/pneumonia-detection-using-cnn-96-accuracy)\n3. [Learn NLP](https:\/\/www.kaggle.com\/arbazkhan971\/sentiment-analysis-for-beginner-93-accuracy)\n4. [Learn Sentiment Analysis As a Beginner](https:\/\/www.kaggle.com\/arbazkhan971\/tweets-classification-82-eda-cleaning-fastai)\n5. [Cancer Detection Using CNN](https:\/\/www.kaggle.com\/arbazkhan971\/invasive-ductal-carcinoma-classification-89-acc)\n6. [Image classification Using CNN ](https:\/\/www.kaggle.com\/arbazkhan971\/image-classifications-in-5-steps-for-beginner)\n7. [Machine Learning For beginner ](https:\/\/www.kaggle.com\/arbazkhan971\/titanic-survival-everything-that-you-need-to-know)\n8. [Loan Analysis Using Seaborn for beginner](https:\/\/www.kaggle.com\/arbazkhan971\/loan-approval-analysis-eda-for-begineers)[Kaggle Survey Data Analysis](https:\/\/www.kaggle.com\/arbazkhan971\/indians-vs-world)\n9. [Retina Damage Classification for Noobs ](https:\/\/www.kaggle.com\/arbazkhan971\/retina-damage-classification-95-accuracy)\n10. [Machine Learning Algorithms For Beginners](https:\/\/www.kaggle.com\/arbazkhan971\/pima-eda-plotly-25-models-for-beginners)\n11. [Analysis Of Rapes In india](https:\/\/www.kaggle.com\/arbazkhan971\/analysis-of-rapes-in-india)","7917427d":"<a href=\"#top\" class=\"btn btn-success btn-lg active\" role=\"button\" aria-pressed=\"true\" style=\"color:white\" data-toggle=\"popover\" title=\"go to Colors\">Go to TOP<\/a>","02da120c":"<a id=\"24\"><\/a>\n<font color=\"blue\" size=+2.5><b> Other Best Work <\/b><\/font>\n1. [Learn Plotly ](http:\/\/www.kaggle.com\/arbazkhan971\/iris-eda-plotly-25-models-for-beginners)\n2. [Learn Fast ai as a beginner ](https:\/\/www.kaggle.com\/arbazkhan971\/pneumonia-detection-using-cnn-96-accuracy)\n3. [Learn NLP](https:\/\/www.kaggle.com\/arbazkhan971\/sentiment-analysis-for-beginner-93-accuracy)\n4. [Learn Sentiment Analysis As a Beginner](https:\/\/www.kaggle.com\/arbazkhan971\/tweets-classification-82-eda-cleaning-fastai)\n5. [Cancer Detection Using CNN](https:\/\/www.kaggle.com\/arbazkhan971\/invasive-ductal-carcinoma-classification-89-acc)\n6. [Image classification Using CNN ](https:\/\/www.kaggle.com\/arbazkhan971\/image-classifications-in-5-steps-for-beginner)\n7. [Machine Learning For beginner ](https:\/\/www.kaggle.com\/arbazkhan971\/titanic-survival-everything-that-you-need-to-know)\n8. [Loan Analysis Using Seaborn for beginner](https:\/\/www.kaggle.com\/arbazkhan971\/loan-approval-analysis-eda-for-begineers)[Kaggle Survey Data Analysis](https:\/\/www.kaggle.com\/arbazkhan971\/indians-vs-world)\n9. [Retina Damage Classification for Noobs ](https:\/\/www.kaggle.com\/arbazkhan971\/retina-damage-classification-95-accuracy)\n10. [Machine Learning Algorithms For Beginners](https:\/\/www.kaggle.com\/arbazkhan971\/pima-eda-plotly-25-models-for-beginners)\n11. [Analysis Of Rapes In india](https:\/\/www.kaggle.com\/arbazkhan971\/analysis-of-rapes-in-india)","59d8a3f0":"<a id=\"9\"><\/a>\n<font color=\"blue\" size=+2.5><b>3.4 Print Classes present in the data<\/b><\/font>\n<br\/>\n\n* data.c \u2014 How many classes are there in our dataset?\n* len(data.train_ds) \u2014 What is the size of our training dataset?\n* len(data.valid_ds) \u2014 What is the size of our validation dataset?","6c7027a4":"Once you have trained the model and satisfied with the outcome, its time to deploy the model. For deploying the model into production you need to save your model architecture and the parameters it\u2019s trained on. For this, the export method is used. The exported model is saved as a PKL file, which is a file created by pickle (a Python module).","50617c79":"<font size=\"+2\" color=red ><b>Please <large>Upvote<\/large> my kernel and keep it in your favourite section if you think it is helpful.<\/font>","20f0e461":"Model performance can be validated in different ways. One of the popular methods is using the confusion matrix. Diagonal values of the matrix indicate correct predictions for each class, whereas other cell values indicate a number of wrong predictions."}}