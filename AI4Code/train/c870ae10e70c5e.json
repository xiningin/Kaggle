{"cell_type":{"9a06fa08":"code","4be02798":"code","6e79b37f":"code","1e55a6ce":"code","3f4b1cf5":"code","e6643f89":"code","631062ec":"code","f430f45c":"markdown","b15ee96e":"markdown","f56b044c":"markdown","90df4553":"markdown","9ff30ba7":"markdown"},"source":{"9a06fa08":"import numpy as np \nimport pandas as pd \nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport math\npd.options.display.max_columns = 999","4be02798":"pitch_stat = pd.read_csv('\/kaggle\/input\/mlb-statcast-data\/Statcast_2020.csv')\npitch_stat = pitch_stat[(pitch_stat['balls'] <= 3)& (pitch_stat['strikes'] <= 2)]","6e79b37f":"pitch_stat['yR'] = 60-pitch_stat.release_extension\npitch_stat['tR'] = (-pitch_stat.vy0 - (pitch_stat.vy0**2-2*pitch_stat.ay*(50-pitch_stat.yR))**0.5)\/pitch_stat.ay\npitch_stat['vxR'] = pitch_stat.vx0 + pitch_stat.ax * pitch_stat.tR\npitch_stat['vyR'] = pitch_stat.vy0 + pitch_stat.ay * pitch_stat.tR\npitch_stat['vzR'] = pitch_stat.vz0 + pitch_stat.az * pitch_stat.tR\npitch_stat['dv0'] = pitch_stat.release_speed - (pitch_stat.vxR**2+pitch_stat.vyR**2+pitch_stat.vzR**2)**0.5\/1.467\npitch_stat['tf'] = (-pitch_stat.vyR-(pitch_stat.vyR**2-2*pitch_stat.ay*(pitch_stat.yR-17\/12))**0.5)\/pitch_stat.ay\n\npitch_stat['x_mvt'] = pitch_stat.plate_x - pitch_stat.release_pos_x - (pitch_stat.vxR\/pitch_stat.vyR)*(17\/12-pitch_stat.yR)\npitch_stat['z_mvt'] = pitch_stat.plate_z - pitch_stat.release_pos_z - (pitch_stat.vzR\/pitch_stat.vyR)*(17\/12-pitch_stat.yR) + 0.5*32.174*pitch_stat.tf**2\n\npitch_stat['vxbar'] = (2*pitch_stat.vxR+pitch_stat.ax*pitch_stat.tf)\/2\npitch_stat['vybar'] = (2*pitch_stat.vyR+pitch_stat.ay*pitch_stat.tf)\/2\npitch_stat['vzbar'] = (2*pitch_stat.vzR+pitch_stat.az*pitch_stat.tf)\/2\npitch_stat['vbar'] = (pitch_stat.vxbar**2+pitch_stat.vybar**2+pitch_stat.vzbar**2)**0.5\n\n\npitch_stat['adrag'] = -(pitch_stat.ax*pitch_stat.vxbar+pitch_stat.ay*pitch_stat.vybar+(pitch_stat.az+32.174)*pitch_stat.vzbar)\/pitch_stat.vbar\npitch_stat['Cd'] = pitch_stat.adrag\/(5.153E-03*pitch_stat.vbar**2)\n\npitch_stat['amagx'] = pitch_stat.ax+pitch_stat.adrag*pitch_stat.vxbar\/pitch_stat.vbar\npitch_stat['amagy'] = pitch_stat.ay+pitch_stat.adrag*pitch_stat.vybar\/pitch_stat.vbar\npitch_stat['amagz'] = pitch_stat.az+pitch_stat.adrag*pitch_stat.vzbar\/pitch_stat.vbar+32.174\npitch_stat['amag'] = (pitch_stat.amagx**2+pitch_stat.amagy**2+pitch_stat.amagz**2)**0.5\n\npitch_stat['Mx'] = 0.5*pitch_stat.amagx*pitch_stat.tf**2*12\npitch_stat['Mz'] = 0.5*pitch_stat.amagz*pitch_stat.tf**2*12\n\npitch_stat['Cl'] = pitch_stat.amag\/(5.153E-03*pitch_stat.vbar**2)\npitch_stat['S'] = 0.4*pitch_stat.Cl\/(1-2.32*pitch_stat.Cl)\n\npitch_stat['spinT'] = 78.92*pitch_stat.S*pitch_stat.vbar\npitch_stat['spinTX'] = pitch_stat.spinT*(pitch_stat.vybar*pitch_stat.amagz-pitch_stat.vzbar*pitch_stat.amagy)\/(pitch_stat.amag*pitch_stat.vbar)\npitch_stat['spinTY'] = pitch_stat.spinT*(pitch_stat.vzbar*pitch_stat.amagx-pitch_stat.vxbar*pitch_stat.amagz)\/(pitch_stat.amag*pitch_stat.vbar)\npitch_stat['spinTZ'] = pitch_stat.spinT*(pitch_stat.vxbar*pitch_stat.amagy-pitch_stat.vybar*pitch_stat.amagx)\/(pitch_stat.amag*pitch_stat.vbar)\n\npitch_stat['spin_check'] = (pitch_stat.spinTX**2+pitch_stat.spinTY**2+pitch_stat.spinTZ**2)**0.5-pitch_stat.spinT\n\npitch_stat['phi'] = np.arctan2(pitch_stat.amagz,pitch_stat.amagx)*180\/math.pi\npitch_stat['phi'] = pitch_stat['phi'] + pitch_stat['amagz'].apply(lambda x: 360 if x < 0 else 0)\npitch_stat['spin_eff'] = pitch_stat.spinT\/pitch_stat.release_spin_rate\n\npitch_stat['flag'] = pitch_stat['description'].apply(lambda x: 1 if x == 'swinging_strike' else 0)\npitch_stat['flag_2'] = pitch_stat['estimated_woba_using_speedangle'].apply(lambda x: 1 if x>= 0 else 0)","1e55a6ce":"spin_dir = pd.read_csv('\/kaggle\/input\/spin-direction-2020\/spin_direction_pbp.csv')\npitch_stat = pd.merge(pitch_stat,spin_dir,on=['batter','pitcher','game_pk','pitch_number','inning'])","3f4b1cf5":"pitch_stat.head(5)","e6643f89":"changeup_df = pitch_stat[pitch_stat.pitch_type == 'CH']\nchangeup_df = changeup_df[~pd.isna(changeup_df.description) & (changeup_df.release_speed > 0)] ","631062ec":"x = np.arange(360)\ny = np.arange(360)\n\nplt.scatter(changeup_df[changeup_df.pitcher == 453286]['phi']+90,changeup_df[changeup_df.pitcher == 453286]['release_spin_direction'])\nplt.plot(x,y)\nplt.xlim([0,360])\nplt.ylim([0,360])\nplt.xlabel('Inferred Axis')\nplt.ylabel('Observed Axis')\nplt.title('Max Scherzer Changeup 2020')","f430f45c":"Read the pitch stat and merge to baseball savant data","b15ee96e":"We can see the above code reproduce the graph pretty well","f56b044c":"As an example we want to see if our calculataion match the calculation by [Barton Smith](https:\/\/twitter.com\/NotRealCertain) for Max Scherzer Changeup\n\n![Image](https:\/\/i.imgur.com\/bRHIrFN.jpg)","90df4553":"Calculate inferred pitch data using [Alan Nathan](https:\/\/twitter.com\/pobguy) calculator","9ff30ba7":"The code below merge the spin direction data provided by [Bill Petti](https:\/\/twitter.com\/BillPetti) and baseball savant data in 2020"}}