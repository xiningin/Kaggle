{"cell_type":{"d9c7b359":"code","6edb5864":"code","7e3c7b32":"code","46b8f9b8":"code","7ff8ee48":"code","c6a2837b":"code","aa0598e7":"code","b82b3774":"code","c7dfa6f2":"code","16071066":"code","4d640b79":"code","aff00733":"code","6dbd46a9":"code","db21b497":"code","54b6cf06":"code","5eeaa318":"code","6522b2aa":"code","44612d31":"code","db868da6":"code","147b156d":"code","f64f6095":"code","f81e0bac":"code","bfb6a24d":"code","7e67ae5a":"code","dd34357e":"code","f48819e6":"code","673f9dbe":"code","7726664e":"markdown","d2e28228":"markdown","f8628ca9":"markdown","9f3d8e58":"markdown","946aad66":"markdown","dd194871":"markdown"},"source":{"d9c7b359":"%reload_ext autoreload\n%autoreload 2\n%matplotlib inline","6edb5864":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n\nfrom fastai import *\nfrom fastai.vision import *\nfrom fastai.callbacks.hooks import *\n\nimport os\nprint(os.listdir(\"..\/input\/cell_images\/cell_images\/\"))","7e3c7b32":"img_dir='..\/input\/cell_images\/cell_images\/'","46b8f9b8":"path=Path(img_dir)\npath","7ff8ee48":"data = ImageDataBunch.from_folder(path, train=\".\", \n                                  valid_pct=0.2,\n                                  ds_tfms=get_transforms(flip_vert=True, max_warp=0),\n                                  size=224,bs=64, \n                                  num_workers=0).normalize(imagenet_stats)","c6a2837b":"print(f'Classes: \\n {data.classes}')","aa0598e7":"data.show_batch(rows=3, figsize=(7,6))","b82b3774":"learn = create_cnn(data, models.resnet34, metrics=accuracy, model_dir=\"\/tmp\/model\/\")\n","c7dfa6f2":"learn.lr_find()\nlearn.recorder.plot()","16071066":"learn.fit_one_cycle(6,1e-2)","4d640b79":"learn.save('stage-1')","aff00733":"learn.unfreeze()","6dbd46a9":"learn.lr_find()\nlearn.recorder.plot()","db21b497":"learn.fit_one_cycle(4, max_lr=slice(5e-6,5e-5 ))","54b6cf06":"learn.save('stage-2')","5eeaa318":"learn.recorder.plot_losses()","6522b2aa":"interp = ClassificationInterpretation.from_learner(learn)","44612d31":"interp.plot_top_losses(9, figsize=(15,11))","db868da6":"interp.plot_confusion_matrix(figsize=(8,8), dpi=60)","147b156d":"interp.most_confused(min_val=2)","f64f6095":"pred_data= ImageDataBunch.from_folder(path, train=\".\", \n                                  valid_pct=0.2,\n                                  ds_tfms=get_transforms(flip_vert=True, max_warp=0),\n                                  size=224,bs=64, \n                                  num_workers=0).normalize(imagenet_stats)","f81e0bac":"predictor=create_cnn(data, models.resnet34, metrics=accuracy, model_dir=\"\/tmp\/model\/\").load('stage-2')","bfb6a24d":"pred_data.single_from_classes(path, pred_data.classes)","7e67ae5a":"x,y = data.valid_ds[3]\nx.show()\ndata.valid_ds.y[3]","dd34357e":"pred_class,pred_idx,outputs = predictor.predict(x)\npred_class","f48819e6":"def heatMap(x,y,data, learner, size=(0,224,224,0)):\n    \"\"\"HeatMap\"\"\"\n    \n    # Evaluation mode\n    m=learner.model.eval()\n    \n    # Denormalize the image\n    xb,_ = data.one_item(x)\n    xb_im = Image(data.denorm(xb)[0])\n    xb = xb.cuda()\n    \n    # hook the activations\n    with hook_output(m[0]) as hook_a: \n        with hook_output(m[0], grad=True) as hook_g:\n            preds = m(xb)\n            preds[0,int(y)].backward()\n\n    # Activations    \n    acts=hook_a.stored[0].cpu()\n    \n    # Avg of the activations\n    avg_acts=acts.mean(0)\n    \n    # Show HeatMap\n    _,ax = plt.subplots()\n    xb_im.show(ax)\n    ax.imshow(avg_acts, alpha=0.5, extent=size,\n              interpolation='bilinear', cmap='magma')\n    ","673f9dbe":"heatMap(x,y,pred_data,learn)","7726664e":"## Inference","d2e28228":"## Confusion Matrix","f8628ca9":"## Heatmap\nThe heatmap will help us identify were our model it's looking and it's really useful for decision making","9f3d8e58":"## Model ResNet34","946aad66":"# Malaria Detection\n\nMalaria is a life-threatening disease caused by parasites that are transmitted to people through the bites of infected female Anopheles mosquitoes. It is preventable and curable.\n* In 2017, there were an estimated 219 million cases of malaria in 90 countries.\n* Malaria deaths reached 435 000 in 2017.\n* The WHO African Region carries a disproportionately high share of the global malaria burden. In 2017, the region was home to 92% of malaria cases and 93% of malaria deaths.\n\nMalaria is caused by Plasmodium parasites. The parasites are spread to people through the bites of infected female Anopheles mosquitoes, called \"malaria vectors.\" There are 5 parasite species that cause malaria in humans, and 2 of these species \u2013 P. falciparum and P. vivax \u2013 pose the greatest threat.\n\n\n***Diagnosis of malaria can be difficult***:\n\n* Where malaria is not endemic any more (such as in the United States), health-care providers may not be familiar with the disease. Clinicians seeing a malaria patient may forget to consider malaria among the potential diagnoses and not order the needed diagnostic tests. Laboratorians may lack experience with malaria and fail to detect parasites when examining blood smears under the microscope.\n* Malaria is an acute febrile illness. In a non-immune individual, symptoms usually appear 10\u201315 days after the infective mosquito bite. The first symptoms \u2013 fever, headache, and chills \u2013 may be mild and difficult to recognize as malaria. If not treated within 24 hours, P. falciparum malaria can progress to severe illness, often leading to death.\n\n***Microscopic Diagnosis***\n\nMalaria parasites can be identified by examining under the microscope a drop of the patient\u2019s blood, spread out as a \u201cblood smear\u201d on a microscope slide. Prior to examination, the specimen is stained  to give the parasites a distinctive appearance. This technique remains the gold standard for laboratory confirmation of malaria. However, it depends on the quality of the reagents, of the microscope, and on the experience of the laboratorian.\n\n![malaria](https:\/\/cdn1.sph.harvard.edu\/wp-content\/uploads\/2015\/03\/Malaria-cells_CDC.jpg)\n\nreferences :\n* [1] https:\/\/www.who.int\/news-room\/fact-sheets\/detail\/malaria \n* [2] https:\/\/www.cdc.gov\/malaria\/diagnosis_treatment\/diagnosis.html \n","dd194871":"## Dataset"}}