{"cell_type":{"b659fce0":"code","28c0fb50":"code","e3b57795":"code","7f62c0f6":"code","f3c923ad":"code","8a2b124d":"code","05976c51":"code","a51e83e1":"code","54f87276":"code","01704512":"code","1f0cff88":"code","8075ab15":"code","f1d1bd13":"code","a0592aa1":"markdown","7eb4ffd1":"markdown","39c5fa5b":"markdown"},"source":{"b659fce0":"import numpy as np\nimport pandas as pd\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","28c0fb50":"submission = pd.read_csv('\/kaggle\/input\/lish-moa\/sample_submission.csv')\n\npublic_ids = list(submission['sig_id'].values)\n\nsubmission.shape","e3b57795":"test = pd.read_csv('\/kaggle\/input\/lish-moa\/test_features.csv')\n\ntest_ids = list(test['sig_id'].values)\n\nprivate_ids = list(set(test_ids)-set(public_ids))\n\nlen(private_ids)","7f62c0f6":"kernels = pd.read_csv('\/kaggle\/input\/best-kernels\/kernels.csv', index_col='id')","f3c923ad":"kernels.head(10)","8a2b124d":"import glob\n\ndef make_filename(idx):\n    return glob.glob('\/kaggle\/input\/best-kernels\/' + str(idx) + '__submission.csv')[0]\n\ndef read_predictions(idx):\n    temp = pd.read_csv(make_filename(idx))\n    return temp\n\n\npredictions = [read_predictions(idx) for idx in kernels.index]\nlen(predictions)","05976c51":"predictions[0]","a51e83e1":"target_columns = list(submission.columns)\ntarget_columns.remove('sig_id')","54f87276":"y_pred = pd.DataFrame()\ny_pred['sig_id'] = predictions[0]['sig_id']\n\nfor column in target_columns:\n    column_data = []\n    for i in range(len(predictions)):\n        column_data.append(predictions[i][column])\n    y_pred[column] = np.mean(column_data, axis=0)\n\ny_pred.shape","01704512":"# (1 - score) because lesser metric is better\nscores = 1. - kernels['score']\n\nsum_scores = sum(scores)\n\nweights = [x \/ sum_scores for x in scores]","1f0cff88":"weighted_y_pred = pd.DataFrame()\nweighted_y_pred['sig_id'] = predictions[0]['sig_id']\n\nfor column in target_columns:\n    column_data = []\n    for i in range(len(predictions)):\n        column_data.append(predictions[i][column] * weights[i])\n    weighted_y_pred[column] = np.sum(column_data, axis=0)\n\nweighted_y_pred.shape","8075ab15":"y_pred = weighted_y_pred","f1d1bd13":"submission = pd.DataFrame(index = public_ids + private_ids, columns=target_columns)\nsubmission.index.name = 'sig_id'\n\nsubmission[:] = 0\n\nsubmission.loc[y_pred.sig_id,:] = y_pred[target_columns].values\n\nsubmission.loc[test[test.cp_type == 'ctl_vehicle'].sig_id] = 0\n\nsubmission.to_csv('submission.csv', index=True)\n\nsubmission.head().T","a0592aa1":"## Average","7eb4ffd1":"## Weighted sum","39c5fa5b":"## Submit predictions"}}