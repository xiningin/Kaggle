{"cell_type":{"066b1cad":"code","3548f26a":"code","5c2a64d0":"code","218a73d2":"code","acc23c7a":"code","d6d88530":"code","b000641b":"code","2e2de88c":"code","d602647c":"code","5422835f":"code","5ddf9157":"code","4d853654":"code","ceef06ed":"code","976553e7":"code","c0c53509":"code","94d071c5":"code","bd338af7":"code","7f8a5345":"code","92770b9b":"code","eade83ce":"code","523ebe44":"code","24b88b3e":"code","afb53d77":"code","687eb251":"code","66b5cef1":"code","74c85c28":"code","1f9222e0":"code","f4c18824":"code","0e0424ee":"code","9bef5d0e":"code","40808854":"code","800a8682":"code","807b9356":"code","6a46d867":"code","14a6068d":"code","c30607ee":"code","6961eed9":"code","a22ed93f":"code","623d9029":"code","ed8a30c5":"code","a943bc37":"code","28fa613e":"code","17f36286":"code","1282b295":"code","68086416":"code","a117350f":"code","7094fe0b":"code","39862f5c":"code","80983423":"code","1b8e7dc6":"code","71e9f7b8":"code","db6063cf":"code","460e8b47":"code","9eaef329":"code","197c32cf":"code","d42f3a0b":"code","f0234716":"code","70a5cb6a":"code","9feb14b8":"code","12b39d08":"code","3fb8f4ab":"code","482159e2":"code","00dbd552":"code","6efbe56b":"code","77d15fdc":"code","b82b4ad8":"code","9c7c0bfa":"code","dd4bedff":"code","9c6e5ccc":"code","61befc70":"code","319bff8d":"code","c264a496":"code","682a6bc7":"code","55a67d00":"code","b988daa7":"code","deebb901":"code","8abe2941":"code","9b0b48cd":"code","c760712f":"code","2fa8438a":"code","4d20a624":"code","90572ae4":"code","c0a50677":"code","7f3a3e09":"code","43cf5dcc":"markdown","74066d79":"markdown","fc6f7bdf":"markdown","d5fddcb2":"markdown","2c2f9e8e":"markdown","fecd5030":"markdown","8c35a6f6":"markdown","206f6631":"markdown","f5c40835":"markdown","96d2a2c9":"markdown","cdb63784":"markdown","8d098d99":"markdown","9402da95":"markdown","cdf5b70a":"markdown","5896a929":"markdown","8cf08f1f":"markdown","235def10":"markdown","c2ef6cfc":"markdown","eae21a22":"markdown","d774de9d":"markdown"},"source":{"066b1cad":"import numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)","3548f26a":"# This Python 3 environment comes with many helpful analytics libraries installed\n# It is defined by the kaggle\/python Docker image: https:\/\/github.com\/kaggle\/docker-python\n# For example, here's several helpful packages to load\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I\/O (e.g. pd.read_csv)\npd.set_option('display.max_columns', 100) # Setting pandas to display a N number of columns\npd.set_option('display.max_rows', 10) # Setting pandas to display a N number rows\npd.set_option('display.width', 1000) # Setting pandas dataframe display width to N\n# from scipy import stats # statistical library\n# from statsmodels.stats.weightstats import ztest # statistical library for hypothesis testing\n# import plotly.graph_objs as go # interactive plotting library\n# import pandas_profiling # library for automatic EDA\n# %pip install autoviz # installing and importing autoviz, another library for automatic data visualization\n# from autoviz.AutoViz_Class import AutoViz_Class\n# from itertools import cycle # function used for cycling over values\n\nfrom IPython.display import display # display from IPython.display\n\n# Input data files are available in the read-only \"..\/input\/\" directory\n# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))\n\n# You can write up to 5GB to the current directory (\/kaggle\/working\/) that gets preserved as output when you create a version using \"Save & Run All\" \n# You can also write temporary files to \/kaggle\/temp\/, but they won't be saved outside of the current session","5c2a64d0":"def dataframe_split_between_null_and_not_null(df):\n    not_null_df = df.dropna()\n    null_df = df.drop(not_null_df.index)\n    percentage = 100 * null_df.shape[0] \/ df.shape[0]\n    print(\"Actual dataset \", df.shape)\n    print(\"Null dataset \", null_df.shape)\n    print(\"Not null dataset \", not_null_df.shape)\n    print(f'Null percentage {percentage}%')\n    return df, null_df, not_null_df,percentage\n\ndef column_missing_state(df):\n    mis_val = df.isnull().sum()\n    mis_val_percent = 100 * mis_val \/ len(df)\n    mis_val_table = pd.concat([mis_val, mis_val_percent], axis=1)\n    mis_val_table = mis_val_table[mis_val_table.iloc[:,1] != 0].sort_values(1, ascending=False).round(1)\n    print (\"Your selected dataframe has \" + str(df.shape[1]) + \" columns.\\n\"      \n            \"There are \" + str(mis_val_table.shape[0]) +\n              \" columns that have missing values.\")\n    return mis_val_table","218a73d2":"    xlsx = pd.ExcelFile('\/kaggle\/input\/khaodao\/data.xlsx')\n    df = dict()\n    for index, sheet in enumerate(xlsx.sheet_names):\n        df[sheet] = xlsx.parse(sheet, index_col=None)\n        df[sheet] = df[sheet].replace(\"\", np.nan)","acc23c7a":"df_r = dict()\nimport os\nfor dirname, _, filenames in os.walk('\/kaggle\/input\/restaurant-recommendation-challenge'):\n    for filename in filenames:\n        if filename.endswith('.csv'):\n            name = filename.split('.')[0]\n            df_r[name] = pd.read_csv(os.path.join(dirname, filename))\n        print(os.path.join(dirname, filename))","d6d88530":"raw_customer = df_r['train_customers']\nraw_orders = df_r['orders']\nraw_locations = df_r['train_locations']\nraw_vendors = df_r['vendors']\ntrain_df = df_r['train_full']\n","b000641b":"for k,v in df.items():\n    print(f\"Table Name: {k} ---- Shape: {v.shape}\")","2e2de88c":"for k,v in df.items():\n    print(f\"Table Name: {k}\\n\")\n    for i, column in enumerate(v.columns):\n        print(f\"{i+1}. {column}\")\n    print('\\n')","d602647c":"for k,v in df_r.items():\n    print(f\"Table Name: {k}\\n\")\n    for i, column in enumerate(v.columns):\n        print(f\"{i+1}. {column}\")\n    print('\\n')","5422835f":"display(df['customer'].head(2))","5ddf9157":"display(df_r['train_customers'].head(2))","4d853654":"customer = pd.DataFrame({\n    'customer_id': raw_customer.akeed_customer_id,\n    'gender': raw_customer.gender,\n    'dob': raw_customer.dob,\n    'status': raw_customer.status,\n    'verified': raw_customer.verified,\n    'language': raw_customer. language,\n    'location_service_preference': True,\n    'notification_preference': True,\n    \n})","ceef06ed":"def clean_string(string):\n    string = str(string)\n    if '?' in string or string.lower()=='nan' or string.strip(' ')=='':\n        return np.nan\n    string = string.strip(' ').lower()\n    return string\n\ncustomer.loc[:, 'gender'] = customer['gender'].apply(clean_string)\n\n\nfrom datetime import date\ndef calc_age(year):\n    if len(str(year))==2:\n        if str(year).startswith('0'):\n            year = '20'+str(year)\n        else:\n            year = '19'+str(year)\n        year = int(year)\n    if year is None:\n        return np.nan\n    return date.today().year-year\n\ncustomer.loc[:, 'age'] = customer['dob'].apply(calc_age)","976553e7":"display(customer.head(4))","c0c53509":"customers = customer","94d071c5":"customers.to_csv('final_customer.csv', index= False)","bd338af7":"import geopandas as gpd\nimport re \n\ndef check_num(string):\n    if string is None:\n        return float(0)\n    string = str(string)\n    regex = r'-?[0-9]*.[0-9]*'\n    m = re.match(regex, string)\n    if m is None:\n        return float(0)\n    return float(string[:6])\n\nraw_locations.loc[:,'latitude'] = raw_locations['latitude'].apply(check_num)\nraw_locations.loc[:,'longitude'] = raw_locations['longitude'].apply(check_num)\n# raw_locations.loc[:,'geometry'] = gpd.points_from_xy(raw_locations['longitude'], raw_locations['latitude'])\n\ndisplay(raw_locations.head(4))","7f8a5345":"raw_locations['location_type'].value_counts()","92770b9b":"locations = raw_locations","eade83ce":"locations.to_csv('final_locations.csv', index= False)","523ebe44":"# sorted(df['order'].columns.to_list())","24b88b3e":"# df['order'].head()","afb53d77":"# df['order_items'].head()","687eb251":"# df['order_line_item_modifier'].head()","66b5cef1":"# df['order_status'].head()","74c85c28":"raw_orders.rename(columns={'customer_id': 'customer_id', 'vendor_discount_amount': 'discounts', 'akeed_order_id':'order_id','created_at':'order_placed_time','vendor_id':'restaurant_id'}, inplace=True)","1f9222e0":"raw_orders.drop(['CID X LOC_NUM X VENDOR'], axis=1, inplace=True)","f4c18824":"display(raw_orders.head())","0e0424ee":"raw_orders.to_csv('final_orders.csv', index= False)","9bef5d0e":"# df['menu'].head()","40808854":"# df['menu_category'].head()","800a8682":"# df['menu_item'].head()","807b9356":"# df['modifier_type'].head()","6a46d867":"# df['modifier_item'].head()","14a6068d":"# df['payment'].head()","c30607ee":"raw_vendors.rename(columns={'id':'restaurant_id','is_akeed_delivering':'delivery_available','vendor_rating':'restaurent_rating','vendor_tag_name':'restaurent_tag_name'}, inplace=True)","6961eed9":"raw_vendors = raw_vendors[['restaurant_id','latitude','longitude','vendor_category_en','delivery_available','delivery_charge','serving_distance','is_open','prepration_time','commission','discount_percentage','status','verified','language','restaurent_rating','open_close_flags','restaurent_tag_name','country_id','city_id']]","a22ed93f":"display(raw_vendors.head(4))","623d9029":"raw_vendors.to_csv('final_restaurents.csv', index= False)","ed8a30c5":"# display(df['restaurant_detail'].head(4))","a943bc37":"# display(df['restaurant'].head(4))","28fa613e":"# df['restaurant_admin'].columns","17f36286":"# display(df['restaurant_menu'].head(4))","1282b295":"train_df.shape","68086416":"train_df.drop(['authentication_id','vendor_category_id','primary_tags','vendor_tag','one_click_vendor','device_type','display_orders','CID X LOC_NUM X VENDOR'], axis=1, inplace=True)","a117350f":"train_df.rename(columns={'is_akeed_delivering':'delivery_available','vendor_rating':'restaurent_rating','vendor_tag_name':'restaurent_tag_name'}, inplace=True)","7094fe0b":"def clean_string(string):\n    string = str(string)\n    if '?' in string or string.lower()=='nan' or string.strip(' ')=='':\n        return np.nan\n    string = string.strip(' ').lower()\n    return string\n\ntrain_df.loc[:, 'gender'] = train_df['gender'].apply(clean_string)","39862f5c":"import re\ndef check_num(string):\n    if string is None:\n        return float(0)\n    string = str(string)\n    regex = r'-?[0-9]*.[0-9]*'\n    m = re.match(regex, string)\n    if m is None:\n        return float(0)\n    try:\n        return float(string[:6])\n    except:\n        return float(0)\n\ntrain_df.loc[:,'latitude_x'] = train_df['latitude_x'].apply(check_num)\ntrain_df.loc[:,'longitude_x'] = train_df['longitude_x'].apply(check_num)\n\ntrain_df.loc[:,'latitude_y'] = train_df['latitude_y'].apply(check_num)\ntrain_df.loc[:,'longitude_y'] = train_df['longitude_y'].apply(check_num)","80983423":"age_df = pd.DataFrame({\n    'customer_id': customers['customer_id'],\n    'age': customers['age']\n})","1b8e7dc6":"train_df = pd.merge(train_df, age_df, on='customer_id', how='inner')","71e9f7b8":"display(train_df.head(4))","db6063cf":"train_df.to_csv('final_train_df.csv', index= False)","460e8b47":"# !pip3 install numpy\n# !pip3 install scikit-surprise","9eaef329":"from surprise import Reader\nfrom surprise import Dataset\nfrom surprise.model_selection import cross_validate\nfrom surprise import NormalPredictor\nfrom surprise import KNNBasic\nfrom surprise import KNNWithMeans\nfrom surprise import KNNWithZScore\nfrom surprise import KNNBaseline\nfrom surprise import SVD\nfrom surprise import BaselineOnly\nfrom surprise import SVDpp\nfrom surprise import NMF\nfrom surprise import SlopeOne\nfrom surprise import CoClustering\nfrom surprise.accuracy import rmse\nfrom surprise import accuracy\nfrom surprise.model_selection import train_test_split\nfrom surprise.model_selection import GridSearchCV","197c32cf":"# df = pd.read_csv (\"\/kaggle\/working\/final_train_df.csv\")","d42f3a0b":"df = train_df","f0234716":"df = df.sample(100000)","70a5cb6a":"\ndf.head()","9feb14b8":"\ndf.tail()","12b39d08":"train_df.columns","3fb8f4ab":"explicit_df = df[['customer_id','id','restaurent_rating']]\nexplicit_df.columns = ['customer_id','restaurent_id','restaurent_rating']","482159e2":"explicit_df.head()","00dbd552":"explicit_df.shape","6efbe56b":"explicit_df.info()","77d15fdc":"print('Dataset shape: {}'.format(explicit_df.shape))\nprint('-Dataset examples-')\nprint(explicit_df.iloc[::20000, :])","b82b4ad8":"from plotly.offline import init_notebook_mode, plot, iplot\nimport plotly.graph_objs as go\ninit_notebook_mode(connected=True)\n\ndata = explicit_df['restaurent_rating'].value_counts().sort_index(ascending=False)\ntrace = go.Bar(x = data.index,\n               text = ['{:.1f} %'.format(val) for val in (data.values \/ explicit_df.shape[0] * 100)],\n               textposition = 'auto',\n               textfont = dict(color = '#000000'),\n               y = data.values,\n               )\n# Create layout\nlayout = dict(title = 'Distribution Of {} ratings'.format(explicit_df.shape[0]),\n              xaxis = dict(title = 'Rating'),\n              yaxis = dict(title = 'Count'))\n# Create plot\nfig = go.Figure(data=[trace], layout=layout)\nfig.show()","9c7c0bfa":"# Number of ratings per book\ndata = explicit_df.groupby('restaurent_id')['restaurent_rating'].count().clip(upper=100)\n\n# Create trace\ntrace = go.Histogram(x = data.values,\n                     name = 'Ratings',\n                     xbins = dict(start = 0,\n                                  end = 100,\n                                  size = 2))\n# Create layout\nlayout = go.Layout(title = 'Distribution Of Number of Ratings Per Restaurent (Clipped at 100)',\n                   xaxis = dict(title = 'Number of Ratings Per Restaurent'),\n                   yaxis = dict(title = 'Count'),\n                   bargap = 0.2)\n\n# Create plot\nfig = go.Figure(data=[trace], layout=layout)\nfig.show()","dd4bedff":"explicit_df.groupby('restaurent_id')['restaurent_rating'].count().reset_index().sort_values('restaurent_rating', ascending=False)[:10]","9c6e5ccc":"\n# Number of ratings per user\ndata = explicit_df.groupby('customer_id')['restaurent_rating'].count().clip(upper=100)\n\n# Create trace\ntrace = go.Histogram(x = data.values,\n                     name = 'Ratings',\n                     xbins = dict(start = 0,\n                                  end = 100,\n                                  size = 2))\n# Create layout\nlayout = go.Layout(title = 'Distribution Of Number of Ratings Per User (Clipped at 100)',\n                   xaxis = dict(title = 'Ratings Per User'),\n                   yaxis = dict(title = 'Count'),\n                   bargap = 0.2)\n\n# Create plot\nfig = go.Figure(data=[trace], layout=layout)\nfig.show()","61befc70":"explicit_df.groupby('customer_id')['restaurent_rating'].count().reset_index().sort_values('restaurent_rating', ascending=False)[:10]","319bff8d":"explicit_df.restaurent_rating.unique()","c264a496":"df = explicit_df","682a6bc7":"\nmin_ratings = 5\nfilter_items = df['restaurent_id'].value_counts() > min_ratings\nfilter_items = filter_items[filter_items].index.tolist()\n\nmin_user_ratings = 5\nfilter_users = df['customer_id'].value_counts() > min_user_ratings\nfilter_users = filter_users[filter_users].index.tolist()\n\ndf_new = df[(df['restaurent_id'].isin(filter_items)) & (df['customer_id'].isin(filter_users))]\nprint('The original data frame shape:\\t{}'.format(df.shape))\nprint('The new data frame shape:\\t{}'.format(df_new.shape))","55a67d00":"reader = Reader(rating_scale=(1, 5))\ndata = Dataset.load_from_df(df_new[['customer_id', 'restaurent_id', 'restaurent_rating']], reader)","b988daa7":"benchmark = []\n\nalgorithms = [SVD(), SVDpp(), SlopeOne(), NMF(), NormalPredictor(), KNNBaseline(), KNNBasic(), KNNWithMeans(), KNNWithZScore(), BaselineOnly(), CoClustering()]\n\nprint (\"Attempting: \", str(algorithms), '\\n\\n\\n')\n\nfor algorithm in algorithms:\n    print(\"Starting: \" ,str(algorithm))\n    results = cross_validate(algorithm, data, measures=['RMSE'], cv=3, verbose=False)\n    \n    tmp = pd.DataFrame.from_dict(results).mean(axis=0)\n    tmp = tmp.append(pd.Series([str(algorithm).split(' ')[0].split('.')[-1]], index=['Algorithm']))\n    benchmark.append(tmp)\n    print(\"Done: \" ,str(algorithm), \"\\n\\n\")\n\nprint ('\\n\\tDONE\\n')","deebb901":"surprise_results = pd.DataFrame(benchmark).set_index('Algorithm').sort_values('test_rmse')","8abe2941":"surprise_results","9b0b48cd":"# df['organization'].head()","c760712f":"# for column in df['menu_item'].columns:\n#     print(column)","2fa8438a":"# for column in df['order'].columns:\n#     print(column)","4d20a624":"# for k,v in df.items():\n#     print('*'*10)\n#     print(\"Table Name:\",k)\n#     print(\"Shape: \", v.shape)\n#     print(\"Columns: \", v.columns.to_list())\n#     print('*'*10)","90572ae4":"# for k,v in df.items():\n#     print('*'*10)\n#     print(\"Table Name:\",k)\n#     print(\"Dataframe infos:\")\n#     print(v.info())\n#     print('*'*10)\n    ","c0a50677":"# for k,v in df.items():\n#     print('*'*10)\n#     print(\"Table Name:\",k)\n#     print(\"Dataframe infos:\")\n#     print(v.describe())\n#     print('*'*10)","7f3a3e09":"# for k,v in df.items():\n#     print('*'*10)\n#     print(\"Table Name:\",k)\n#     column_missing_state(v)\n#     print('*'*10)","43cf5dcc":"## Importing data","74066d79":"# Restaurents","fc6f7bdf":"## EDA\n#### Ratings Distribution","d5fddcb2":"**Order**\n- commission_amount\n- commission_remark\n- customer_id [customer_id]\n- discounts [vendor_discount_amount]\n- num_people\n- order_id [akeed_order_id]\n- order_placed_time [created_at]\n- order_served_time [ready_for_pickup_time]\n- order_status\n- order_type\n- payment_method [payment_mode]\n- pickup_time [picked_up_time]\n- promocode [promo_code]\n- requested_serve_time\n- restaurant_id [vendor_id]\n- sub_total [grand_total]\n- tips\n- total\n\n**Order Item**\n- discount\n- menu_item_id\n- order_id\n- price\n- quantity\n\n**Order Line Item Modifier**\n- modifier_item_id\n- modifier_item_name\n- order_line_item_id\n- price\n\n**New Adapted**\n- item_count\n- grand_total\n- promo_code_discount_percentage\n- is_favorite\n- is_rated\n- vendor_rating\n- driver_rating\n- deliverydistance\n- preparationtime\n- delivery_time\n- driver_accepted_time\n- delivered_time\n- delivery_date\n- order_accepted_time\n- LOCATION_NUMBER\n- LOCATION_TYPE","2c2f9e8e":"#### Ratings Distribution By User","fecd5030":"## Dimensionality","8c35a6f6":"# Organization","206f6631":"# Explicit Rating Implementation\n","f5c40835":"# Final Dataframe","96d2a2c9":"## Importing required libraries","cdb63784":"# Location","8d098d99":"# Payment","9402da95":"# Orders","cdf5b70a":"# Customer","5896a929":"# Menu","8cf08f1f":"**Restaurent**\n\n- city\n- state\n- country_code\n- currency\n- is_active\n- latitude [latitude]\n- longitude [longitude]\n- restaurant_id\n- services_fee\n\n**Restaurent Detail**\n- cash_payment_available\n- catering_available\n- cuisine_type\n- delivery_available [is_akeed_delivering]\n- delivery_radius\n- dine_in_available\n- fixed_delivery_charge\n- food_type\n- is_location_wise_delivery_charge\n- max_group_size\n- online_payment_available\n- parking_info\n- pets_allowed\n- pre_order_available\n- price_range\n- reservations_required\n- restaurant_id\n- seating_capacity\n- service_type\n- takeout_available\n- wheelchair_accessible\n\n**Restaurent Menu**\n\n- restaurant_id\n- menu_id\n\n**New Adapted**\n\n- delivery_charge\n- serving_distance\n- is_open\n- prepration_time\n- commission\n- discount_percentage\n- status\n- verified\n- language\n- vendor_rating\n- open_close_flags\n- vendor_tag_name\n- country_id\n- city_id\n","235def10":"**Missing Order Info**\n\n- Order line item count (Item count)\n- Vendor discount amount\n- Promocode discount percentage\n- Favorite\n- Rating\n- Vendor rating\n- Driver rating\n- Delivery distance\n- Preparation time\n- ('preparationtime','delivery_time', 'order_accepted_time', 'driver_accepted_time','ready_for_pickup_time', 'picked_up_time', 'delivered_time','delivery_date',)\n- Location Number\n- Location Type\n- CID X LOC_NUM X Restaurent","c2ef6cfc":"**Missing Customer Demographics**\n\n    - Marital Status\n    - Cusine Preference - default\n    - Location Preference - default\n    - Location (City, Country, Region) based on order\n        - Customer id\n        - Location Number\n        - Location Type\n        - Latitude\n        - Longitude\n        - Geometry\n    - Ethnicity (Proposed)","eae21a22":"## Surprise","d774de9d":"#### Ratings Distribution By Restaurent"}}