{"cell_type":{"2c052804":"code","2913aca3":"code","344494cd":"code","393d7408":"code","a12c2992":"code","0959120c":"code","bd865afb":"code","3ba46ace":"code","01ed9496":"code","ab16df6c":"code","0ac1ef9a":"code","f0ce608d":"code","53acdf9e":"code","e2e39c46":"code","3648dbbd":"code","d678a37d":"code","0cb5ed9a":"code","0ba106f8":"code","ea077bfd":"code","840f09ae":"markdown","8a3ce8a7":"markdown","f2fade29":"markdown","bf709c6f":"markdown","0a2fafc1":"markdown","e18927b7":"markdown","56fba134":"markdown","53ea3d26":"markdown","f257e183":"markdown","5a7b67ea":"markdown","af4d0cf7":"markdown","1a09b847":"markdown","04e66cdd":"markdown"},"source":{"2c052804":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\n\n%matplotlib inline","2913aca3":"df = pd.read_csv('..\/input\/employee-compensation.csv')","344494cd":"df.head()","393d7408":"df['Salaries'].hist(bins=20)","a12c2992":"total_salary_description = df['Salaries'].describe()\nprint(total_salary_description)","0959120c":"negative_salaries = df[df['Salaries'] < 0]\nnegative_salaries_description = negative_salaries['Salaries'].describe()\nprint(negative_salaries_description)","bd865afb":"negative_salaries_description['mean'] \/ (total_salary_description['count'] \/ negative_salaries_description['count'])","3ba46ace":"corrected_df = df[df['Salaries'] > 0].copy() #copying to avoid warnings later","01ed9496":"groupped_by_department = corrected_df.groupby(by='Department')\ndepartments_stats = groupped_by_department['Salaries'].agg(['mean', 'sum', 'count', 'std'])\ndepartments_stats['sum'] = departments_stats['sum'] \/ 1000000000.0\n\ntop_departments_by_department_budget = departments_stats.sort_values(by='sum', ascending=False).iloc[0:10]\ntop_departments_by_average_salary = departments_stats.sort_values(by='mean', ascending=False).iloc[0:10]","ab16df6c":"def plot_salaries(entries, title, field_name):\n\n    def calc_95_ci(entry):\n        mean = entry['mean']\n        z = 1.960\n        std = entry['std']\n        n = entry['count']\n        diff = z*std\/np.sqrt(n)\n        return (mean - diff, mean + diff, diff)\n\n    cb_dark_blue = (0\/255, 107\/255, 164\/255)\n    cb_orange = (255\/255, 128\/255, 14\/255)\n    cb_light_gray = (171\/255, 171\/255, 171\/255)\n\n    fig = plt.figure()\n    fig.set_size_inches(18, 12)\n    ax1 = fig.add_subplot(111)\n\n    ax1.set_title(title)\n\n    plt.sca(ax1)\n    x_labels = entries.index\n    plt.xticks(range(10), x_labels, rotation=60)\n\n    sums = entries['sum'].values\n    bar1 = ax1.bar([x for x in range(0, 10)], sums, width=0.8, color=cb_dark_blue)\n    #ax1.set_ylim([0, 4])\n    ax1.set_ylabel(\"Department \" + field_name + \" budget, billions of USD\")\n\n    ax2 = ax1.twinx()\n    means = entries['mean'].values\n    bar2 = ax2.bar(range(0, 10), means, width=0.3, color=cb_orange)\n    #ax2.set_ylim([0, 170000])\n    ax2.set_ylabel(\"Individual \" + field_name + \", USD\")\n\n    fig.legend([bar1, bar2], ['Department ' + field_name + ' budget', 'Mean individual ' + field_name], loc=(0.55, 0.9), ncol=2)\n\n    confidence_intervals = [calc_95_ci(entries.loc[x_labels[i]]) for i in range(0, len(x_labels))]\n    salaries = entries['mean'].as_matrix()\n    for i in range(0, len(x_labels)):\n        plt.errorbar(i, salaries[i], xerr=0, yerr=confidence_intervals[i][2], capsize=10, color='black')\n\n    plt.show()","0ac1ef9a":"plot_salaries(top_departments_by_department_budget, 'Top SF departments by department salary budgets', 'salaries')","f0ce608d":"plot_salaries(top_departments_by_average_salary, 'Top SF departments by average individual salary', 'salaries')","53acdf9e":"corrected_df['Guaranteed Compensations'] = corrected_df['Salaries'] + corrected_df['Total Benefits']\n\ngroupped_by_department = corrected_df.groupby(by='Department')\ndepartments_compensation_stats = groupped_by_department['Guaranteed Compensations'].agg(['mean', 'sum', 'count', 'std'])\ndepartments_compensation_stats['sum'] = departments_compensation_stats['sum'] \/ 1000000000.0\n\ntop_departments_by_compensation_budget = departments_compensation_stats.sort_values(by='sum', ascending=False).iloc[0:10]\ntop_departments_by_compensation = departments_compensation_stats.sort_values(by='mean', ascending=False).iloc[0:10]","e2e39c46":"plot_salaries(top_departments_by_compensation_budget, 'Top SF departments by department compensation budgets', 'compensations')","3648dbbd":"plot_salaries(top_departments_by_compensation, 'Top SF departments by guaranteed compensation', 'compensations')","d678a37d":"all(top_departments_by_compensation_budget.index == top_departments_by_department_budget.index)","0cb5ed9a":"all(top_departments_by_compensation.index == top_departments_by_average_salary.index)","0ba106f8":"df_by_salary = top_departments_by_average_salary.reset_index(drop=False)[['Department', 'mean']]\ndf_by_salary[['Department by salary', 'Salary']] = df_by_salary[['Department', 'mean']]\ndf_by_salary = df_by_salary[['Department by salary', 'Salary']]\n\ndf_by_compensation = top_departments_by_compensation.reset_index(drop=False)[['Department', 'mean']]\ndf_by_compensation[['Department by compensation', 'Compensation']] = df_by_compensation[['Department', 'mean']]\ndf_by_compensation = df_by_compensation[['Department by compensation', 'Compensation']]\n\ncompare_df = pd.concat([df_by_salary, df_by_compensation], axis=1)\ncompare_df.head(10)","ea077bfd":"direct_comparison_df = top_departments_by_average_salary[['mean']].join(\n    top_departments_by_compensation[['mean']], lsuffix=' salary', rsuffix=' compensation')\n\n\ndirect_comparison_df['Benefits to total Compensation, %'] = (\n    (direct_comparison_df['mean compensation'] - direct_comparison_df['mean salary']) \/ direct_comparison_df['mean compensation']) * 100\ndirect_comparison_df = direct_comparison_df.reset_index(drop=False)\ndirect_comparison_df.plot(kind='bar',x='Department',y='Benefits to total Compensation, %')","840f09ae":"Let's check if top lists for salaries and compensations are identical.","8a3ce8a7":"# Guaranteed compensations","f2fade29":"On average, negative values would change mean salary by $1.23. Comparing to mean salary of $63,818.59, that value can be neglected, so all rows will be omitted.\n\nAlso all negative values could be inspected with more attention, e.g. what departments are more prone to such values. For the purposes of this research it will be ignored.","bf709c6f":"Top lists for individual salaries and compensations are different. Let's explore it.","0a2fafc1":"Now let's explore compensations in details. Salary is only one of components of total compensations.","e18927b7":"Let's explore guaranteed compensations. That includes all benefits and salary, but excludes payments for overtime and other salaries that are not guaranteed in any way.","56fba134":"We can see from the plot that benefits are from ~25 to ~33% of total compensations for the top 10 departments.","53ea3d26":"Let's explore how many entries with negative salary is presented.","f257e183":"While we're here, let's explore how big is the part of benefits for each department in comparison with the salary.","5a7b67ea":"# Let's explore top departments by average individual salaries and by department salaries budgets.","af4d0cf7":"## Initial exploration of data","1a09b847":"Top list for individual salaries and compensations are almost identical. The only difference is SHF Sheriff department is slightly better with compensations in comparison with RET Retirement System department.","04e66cdd":"Top lists for department budgets in both categories are identical."}}