{"cell_type":{"1423a399":"code","243c5b27":"code","f8a05b68":"code","4fcb7ffd":"code","5ff5ea0b":"code","2d7807a7":"code","ef0eb5cf":"code","344ae325":"code","9c5614c9":"code","0b6d5749":"code","d999fdcd":"code","3f102f5d":"code","1cf01bba":"code","45e5a588":"code","fc85790a":"code","5bdcf6a0":"code","14dace95":"code","1bf872da":"code","bb8d3254":"code","aef1f831":"code","98c657e3":"code","39c72da4":"code","8b0ff72d":"code","c6d5563f":"code","3b9cc6b3":"code","513f3485":"code","50eac180":"code","c2c40561":"code","63ee1674":"code","bd8332f0":"code","29091d28":"code","0800aa61":"code","8f4db58e":"code","a278242a":"code","94c1dae6":"code","78eed56e":"code","bf3c9c2d":"code","7cdbe7c7":"code","083fe084":"code","105c79a0":"code","9fcfaef2":"code","8ba267e3":"code","ba2c66b2":"code","42459d8f":"code","90dc2b5c":"code","bd52fd48":"code","8f52b29e":"code","5b2c7580":"code","87d1fdf6":"code","eb29710c":"code","32e2c8b2":"code","40f0bedb":"code","3f261ae0":"code","e7bb2a76":"code","5b156680":"code","4d0c7709":"code","41513dae":"code","6daf65c1":"code","7187c0c6":"code","152d2925":"code","b12dcc74":"code","3fb43497":"code","95eb6819":"code","3bca0f2d":"code","1dbd25e6":"code","fc5fc298":"code","5a2001bc":"code","3b1eb4cd":"code","8cf01d1e":"code","040b2f33":"code","1cf75ea4":"code","18db0ac4":"code","fd2c413a":"code","b02cbf33":"code","ac946388":"code","a08a505e":"code","9d6f5325":"code","79bd1182":"code","a3553641":"markdown","4a1d1e85":"markdown","a139ce79":"markdown","0062a251":"markdown","ddd5faea":"markdown","e7ede93e":"markdown","33c7d202":"markdown","fd79c804":"markdown","a783b428":"markdown","6abfc388":"markdown","95928a62":"markdown"},"source":{"1423a399":"import pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport numpy as np\n\nimport warnings\nwarnings.filterwarnings('ignore')","243c5b27":"df=pd.read_csv('..\/input\/janatahack-crosssell-prediction\/train.csv')\ndf.head()","f8a05b68":"del df['id']","4fcb7ffd":"df.shape","5ff5ea0b":"df.isnull().sum()","2d7807a7":"df_test=pd.read_csv('..\/input\/janatahack-crosssell-prediction\/test.csv')\ndf_test.head()","ef0eb5cf":"df_test.shape","344ae325":"df.info()","9c5614c9":"df_test.info()","0b6d5749":"sns.countplot(df['Gender']);","d999fdcd":"sns.countplot(df['Gender'],hue=df['Driving_License']);","3f102f5d":"plt.figure(figsize=(10,10))\nsns.catplot(x=\"Vehicle_Age\", y=\"Response\", hue=\"Gender\", kind=\"bar\", data=df);","1cf01bba":"sns.catplot(x=\"Vehicle_Age\", y=\"Response\", hue=\"Previously_Insured\", kind=\"bar\", data=df);","45e5a588":"sns.catplot(x=\"Vehicle_Age\", y=\"Response\", hue=\"Driving_License\", kind=\"bar\", data=df);","fc85790a":"sns.catplot(x=\"Gender\", y=\"Response\", hue=\"Previously_Insured\", kind=\"bar\", data=df.query(\"Vehicle_Age == '> 2 Years'\"))","5bdcf6a0":"sns.catplot(x=\"Gender\", y=\"Response\", hue=\"Previously_Insured\", kind=\"bar\", data=df.query(\"Vehicle_Age == '1-2 Year'\"))","14dace95":"sns.lineplot(df['Policy_Sales_Channel'],df['Vintage'],hue=df['Gender'])","1bf872da":"sns.boxplot(df['Age'])","bb8d3254":"df[df['Age']>=80]['Response'].value_counts()","aef1f831":"# index=df[df['Age']>=80].index","98c657e3":"# df.drop(labels=index,inplace=True)","39c72da4":"df['Annual_Premium'].max(),df['Annual_Premium'].min()","8b0ff72d":"\ndef outliers(df,features):\n  for c in features:\n    Q1=np.percentile(df[c],25)\n    Q3=np.percentile(df[c],75)\n    IQR=Q3-Q1\n    outliers=df[(df[c] < (Q1-1.5 * IQR)) | (df[c] > (Q3 + 1.5 * IQR))]\n    return outliers.index","c6d5563f":"outliers(df,['Annual_Premium'])","3b9cc6b3":"df.drop(labels=outliers(df,['Annual_Premium','Age','Vintage']),inplace=True)","513f3485":"sns.countplot(df['Response']);","50eac180":"df['Gender']=df['Gender'].replace(['Male','Female'],[1,0])\ndf['Vehicle_Age']=df['Vehicle_Age'].replace(['< 1 Year','1-2 Year','> 2 Years'],[1,2,3])\ndf['Vehicle_Damage']=df['Vehicle_Damage'].replace(['Yes','No'],[1,0])\n\n\ndf_test['Gender']=df_test['Gender'].replace(['Male','Female'],[1,0])\ndf_test['Vehicle_Age']=df_test['Vehicle_Age'].replace(['< 1 Year','1-2 Year','> 2 Years'],[1,2,3])\ndf_test['Vehicle_Damage']=df_test['Vehicle_Damage'].replace(['Yes','No'],[1,0])","c2c40561":"plt.figure(figsize=(10,10))\nsns.heatmap(df.corr(),annot=True);","63ee1674":"X=df.drop(['Response'],axis=1)\ny=df.Response.values","bd8332f0":"X.columns","29091d28":"y\n","0800aa61":"from imblearn.over_sampling import SMOTE\nsm=SMOTE()","8f4db58e":"X_res,y_res=sm.fit_sample(X,y)","a278242a":"X_res.shape,y_res.shape","94c1dae6":"from collections import Counter\nprint(\"Orginal Dataset Shape {}\".format(Counter(y)))\nprint(\"Applying Smote dataset shape {}\".format(Counter(y_res)))","78eed56e":"from sklearn.model_selection import train_test_split\nX_train,X_test,y_train,y_test=train_test_split(X_res,y_res,test_size=0.3,random_state=23,stratify=y_res,shuffle=True)\nprint(X_train.shape)\nprint(X_test.shape)\nprint(y_train.shape)\nprint(y_test.shape)","bf3c9c2d":"from sklearn.preprocessing import StandardScaler,MinMaxScaler\nsc=StandardScaler()\n","7cdbe7c7":"X_train_res=sc.fit_transform(X_train)\nX_test_res=sc.transform(X_test)","083fe084":"X_train_res","105c79a0":"# !pip install xgboost","9fcfaef2":"# from xgboost import  XGBClassifier\n# xg=XGBClassifier()","8ba267e3":"# model=xg.fit(X_train_res,y_train)","ba2c66b2":"# y_pred=model.predict(X_test_res)","42459d8f":"!pip install catboost","90dc2b5c":"from catboost import CatBoostClassifier\ncb=CatBoostClassifier(task_type='GPU',loss_function='Logloss',iterations=9500,l2_leaf_reg=8,depth=8)","bd52fd48":"model_cb=cb.fit(X_train_res,y_train)","8f52b29e":"y_pred=model_cb.predict(X_test_res)","5b2c7580":"from sklearn.metrics import accuracy_score,roc_auc_score,roc_curve,precision_score,f1_score,classification_report,confusion_matrix,plot_confusion_matrix","87d1fdf6":"print(\"Accuarcy on training\", accuracy_score(y_train,model_cb.predict(X_train_res)))\nprint(\"Accuarcy on testing\",accuracy_score(y_test,model_cb.predict(X_test_res)))","eb29710c":"precision_score(y_test,y_pred)","32e2c8b2":"print(classification_report(y_test,y_pred))","40f0bedb":"print(plot_confusion_matrix(model_cb,X_test_res,y_test,values_format='.1f',cmap='Blues'))","3f261ae0":"cb_probs=model_cb.predict_proba(X_test_res)[:,1]\ncb_probs","e7bb2a76":"cb_auc=roc_auc_score(y_test,cb_probs)\nprint(\"cb_area\",cb_auc)","5b156680":"fpr,tpr,th=roc_curve(y_test,cb_probs)","4d0c7709":"plt.plot([0,1],[0,1],linestyle='--',color='red')\nplt.plot(fpr,tpr,marker='*',label='RF auc {}'.format(cb_auc.round(2)))\nplt.legend()","41513dae":"feat_importances = pd.Series(model_cb.feature_importances_, index=X.columns)\nfeat_importances.nlargest(15).plot(kind='barh')\n#feat_importances.nsmallest(20).plot(kind='barh')\nplt.show()","6daf65c1":"# parameters={\"learning_rate\"    : [0.10, 0.15, 0.20,0.30] ,\n#  \"max_depth\"        : [ 3,5,8,10, 12, 15],\n#  \"min_child_weight\" : [ 1, 3, 5, 7 ],\n#  \"gamma\"            : [ 0.0, 0.1, 0.2 , 0.3],\n#  \"colsample_bytree\" : [ 0.3, 0.4, 0.5 , 0.7 ]\n#  }\n\n# parameters={'depth':[4,6,7,8],\n#             'learning_rate':[0.14,0.16,0.18,0.2],\n#             'iterations':[5000,5500,6000,7000],\n#             'l2_leaf_reg': [2,6,10,14]\n           \n#             }","7187c0c6":"# from sklearn.model_selection import RandomizedSearchCV\n# import time","152d2925":"# rd_obj=RandomizedSearchCV(model_cb,parameters,scoring='accuracy',cv=20)","b12dcc74":"# rd_obj","3fb43497":"# start=time.time()\n# rd_obj.fit(X_train_res,y_train)\n# end=time.time()\n# print(\"Total time taken is {}\".format(end-start))","95eb6819":"# rd_obj.best_params_","3bca0f2d":"# best_split=rd_obj.best_estimator_\n# best_split","1dbd25e6":"#  model_cv=best_split.fit(X_train_res,y_train)","fc5fc298":"# from sklearn.model_selection import cross_val_score\n# print(cross_val_score(model_cv,X_train_res,y_train,cv=10,scoring='accuracy').mean())","5a2001bc":"df_test.head()","3b1eb4cd":"df_test_copy=df_test.copy()","8cf01d1e":"df_test_copy.drop('id',axis=1,inplace=True)","040b2f33":"df_test_copy.columns","1cf75ea4":"df_test_copy=sc.transform(df_test_copy)","18db0ac4":"df_test_copy","fd2c413a":"predictions=model_cb.predict_proba(df_test_copy)[:,1]","b02cbf33":"predictions","ac946388":"final=pd.DataFrame()\nfinal['id']=df_test['id']\nfinal['Response']=predictions","a08a505e":"final","9d6f5325":"final.to_csv('final_cb.csv',index=False)","79bd1182":"#if you like my work ,Please upvote it.","a3553641":"- it is imbalaced Dataset.","4a1d1e85":"- Vehicle_Age  is between 1-2 years.\n- insurance was very less.","a139ce79":"- Vehicle_age > 2 years.\n- previous insurance was very less which is vehicle age > 2 years.","0062a251":"- We can also use Xgboost.","ddd5faea":"- Policy_Sales_Channel Anonymised Code for the channel of outreaching to the customer ie. Different Agents, Over Mail, Over Phone, In Person, etc.\n- Vintage - Number of Days, Customer has been associated with the company","e7ede93e":"#**Problem Statement**\n\n##*Jantahack Cross-sell Prediction*\n\nThe Problem statement is [here](https:\/\/datahack.analyticsvidhya.com\/contest\/janatahack-cross-sell-prediction\/#ProblemStatement).","33c7d202":"- People whose vehicle age is < 2 years tends to buy insurance compared to others.","fd79c804":"**Data Description**\n\t              \n- id\t       :            Unique ID for the customer\n- Gender\t      :         Gender of the customer\n- Age           :          Age of the customer\n- Driving_License\t0 : Customer does not have DL, 1 : Customer already has DL.\n- Region_Code\t: Unique code for the region of the customer\n- Previously_Insured\t1 : Customer already has Vehicle Insurance, 0 : Customer doesn't have Vehicle Insurance\n- Vehicle_Age\t-   Age of the Vehicle \n- Vehicle_Damage\n1 : Customer got his\/her vehicle damaged in the past.\n0 : Customer didn't get his\/her vehicle damaged in the past.\n- Annual_Premium\tThe amount customer needs to pay as premium in the year\n- Policy_Sales_Channel\tAnonymised Code for the channel of outreaching to the customer ie. Different Agents, Over Mail, Over Phone, In Person, etc.\n- Vintage -\tNumber of Days, Customer has been associated with the company\n- Response\t1 :  Customer is interested, 0 : Customer is not interested","a783b428":"- Previously_Insured\n- 1 : Customer already has Vehicle Insurance, 0 : Customer doesn't have Vehicle Insurance\n\n- Most of the people who have insured doesnt  want to insure it again.","6abfc388":"- Most of the customers had already DL.","95928a62":"### Visualizing train data"}}