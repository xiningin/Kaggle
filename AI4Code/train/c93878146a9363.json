{"cell_type":{"8db959b3":"code","b456a459":"code","b44e0196":"code","eba40311":"code","dbf12b69":"markdown"},"source":{"8db959b3":"import os\nprint(os.listdir(\"..\/input\"))","b456a459":"import pandas as pd\nimport csv","b44e0196":"sub_files = [\n                 \"..\/input\/ensemble-0842\/sub_simi_800.csv\",             \n                 \"..\/input\/ensemble-0842\/sub_simi_805.csv\",\n                 \"..\/input\/ensemble-0842\/sub_ens_833.csv\",\n                 \"..\/input\/ensemble-0842\/sub_ens_824.csv\",\n                 \"..\/input\/ensemble-0842\/sub_tri_760.csv\",\n                 \"..\/input\/ensemble-0842\/sub_siam_822.csv\",\n            ]\n\nsub_weight = [\n                0.800**2,            \n                0.805**2,\n                0.833**2,\n                0.824**2,\n                0.76**2,\n                0.822**2,\n            ]","eba40311":"Hlabel = 'Image' \nHtarget = 'Id'\nnpt = 6\nplace_weights = {}\nfor i in range(npt):\n    place_weights[i] = ( 1 \/ (i + 1) )\n    \nprint(place_weights)\n\nlg = len(sub_files)\nsub = [None]*lg\nfor i, file in enumerate( sub_files ):\n   \n    print(\"Reading {}: w={} - {}\". format(i, sub_weight[i], file))\n    reader = csv.DictReader(open(file,\"r\"))\n    sub[i] = sorted(reader, key=lambda d: str(d[Hlabel]))\n\nout = open(\"submission_1.csv\", \"w\", newline='')\nwriter = csv.writer(out)\nwriter.writerow([Hlabel,Htarget])\n\nfor p, row in enumerate(sub[0]):\n    target_weight = {}\n    for s in range(lg):\n        row1 = sub[s][p]\n        for ind, trgt in enumerate(row1[Htarget].split(' ')):\n            target_weight[trgt] = target_weight.get(trgt,0) + (place_weights[ind]*sub_weight[s])\n    tops_trgt = sorted(target_weight, key=target_weight.get, reverse=True)[:npt]\n    writer.writerow([row1[Hlabel], \" \".join(tops_trgt)])\nout.close()","dbf12b69":"1. Ref: https:\/\/www.kaggle.com\/iafoss\/similarity-densenet121-0-805lb-kernel-time-limit\n2. Ref: https:\/\/www.kaggle.com\/ateplyuk\/ensemble-lb-0-833\n3. Ref: https:\/\/www.kaggle.com\/axel81\/siamese-ensemble-of-ensemble-lb-0-824\n4. Ref: https:\/\/www.kaggle.com\/frkhit\/triplet-loss-from-pretrained-siamese-net-0-76\n5. Ref: https:\/\/www.kaggle.com\/seesee\/siamese-pretrained-0-822\n6. Ref: https:\/\/www.kaggle.com\/monuwio\/ensemble-of-many-good-submissions"}}