{"cell_type":{"fc7674f6":"code","0830b52e":"code","1a1d76c2":"code","3ca636e7":"code","bc39a213":"code","a5977998":"code","79e409d7":"code","92aa1026":"code","47bf1d10":"code","c8051c5c":"code","53713dc4":"code","ac912711":"code","7b10cf50":"code","aabb8858":"code","39dd516b":"code","6590420a":"code","2486b8db":"code","5310be45":"code","06624de3":"code","b2704395":"code","716480b6":"code","7533c932":"code","dac2d1b8":"markdown","639c62b2":"markdown","4283b44f":"markdown","c9688577":"markdown","8564f5e8":"markdown","ae1d531d":"markdown","bcba1e4c":"markdown","b5282d26":"markdown","5dc1325d":"markdown","d5c268a5":"markdown","4d0f7f05":"markdown","4182855f":"markdown","3239768f":"markdown","cd86f0c1":"markdown","8379962c":"markdown","f4e141ff":"markdown","5f5e8815":"markdown","afe307d7":"markdown","69865bfa":"markdown"},"source":{"fc7674f6":"import os # accessing directory structure\nfor dirname, _, filenames in os.walk('\/kaggle\/input'):\n    for filename in filenames:\n        print(os.path.join(dirname, filename))","0830b52e":"import pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom scipy import stats\nfrom scipy.stats import shapiro\nfrom sklearn.neighbors import LocalOutlierFactor\nfrom scipy.stats import levene\nfrom sklearn.impute import KNNImputer\n\npd.set_option(\"display.max_columns\",None);\npd.set_option(\"display.max_rows\",None);","1a1d76c2":"def checkReject(p_value,alpha=0.05):\n    if p_value > alpha:\n        print(f'p_value is {p_value} > alpha {alpha}, cannot reject null hypoposis')\n    elif p_value < alpha:\n        print('p_value is {p_value} < alpha {alpha}, reject null hypoposis')","3ca636e7":"control = pd.read_excel('\/kaggle\/input\/ab-case-study\/AB_Case_Study.xlsx', sheet_name='Control Group', index_col=0)\ntest = pd.read_excel('\/kaggle\/input\/ab-case-study\/AB_Case_Study.xlsx', sheet_name='Test Group', index_col=0)","bc39a213":"control.head()","a5977998":"test.head()","79e409d7":"control.info()","92aa1026":"#Categorical Columns\ncategorical = [col for col in control.columns if (control[col].dtype=='object')|(control[col].dtype=='bool')]\n#Numerical Variables\nnumerical = [col for col in control.columns if col not in categorical]\nnumerical\nkat_control = control[categorical]\nnum_control = control[numerical]","47bf1d10":"kat_control.head()","c8051c5c":"num_control.head(15)","53713dc4":"# Fill the control dataframe values NaN value with KNNImputer.\nimputer = KNNImputer(n_neighbors = 8)\nnum_control = pd.DataFrame(imputer.fit_transform(num_control), columns = num_control.columns)\nnum_control.iloc[11:12,:]","ac912711":"control = pd.concat([kat_control,num_control],axis=1)\ncontrol.head(3)","7b10cf50":"# Data Type Conversions\ncontrol = control.astype({'# of Impressions' : 'int64', \n                        'Reach': 'int64', \n                        '# of Website Clicks' : 'int64', \n                        '# of Searches': 'int64', \n                        '# of View Content': 'int64', \n                        '# of Add to Cart': 'int64', \n                        '# of Purchase' : 'int64'})\ntest = test.astype({'# of Impressions' : 'int64', \n                        'Reach': 'int64', \n                        '# of Website Clicks' : 'int64', \n                        '# of Searches': 'int64', \n                        '# of View Content': 'int64', \n                        '# of Add to Cart': 'int64', \n                        '# of Purchase' : 'int64'})\n\nprint(control.shape)\nprint(test.shape)","aabb8858":"print(control.info())\nprint(test.info())","39dd516b":"# add columns \"Website Click Through Rate\" \"Number of Action\", \"Cost per Action\"\ncontrol[\"Website Click Through Rate\"] = control[\"# of Website Clicks\"] \/ control[\"# of Impressions\"] * 100\ntest[\"Website Click Through Rate\"] = test[\"# of Website Clicks\"] \/ test[\"# of Impressions\"] * 100\n\ncontrol[\"Number of Action\"] = control[\"# of Impressions\"] + control[\"# of Website Clicks\"] \\\n+ control[\"# of Searches\"] + control[\"# of View Content\"] + control[\"# of Add to Cart\"] + control[\"# of Purchase\"]\ntest[\"Number of Action\"] = test[\"# of Impressions\"] + test[\"# of Website Clicks\"] \\\n+ test[\"# of Searches\"] + test[\"# of View Content\"] + test[\"# of Add to Cart\"] + test[\"# of Purchase\"]\n\ncontrol[\"Cost per Action\"] = control[\"Spend [USD]\"] \/ control[\"Number of Action\"]\ntest[\"Cost per Action\"] = test[\"Spend [USD]\"] \/ test[\"Number of Action\"]\n\ncontrol[\"Conversion Rate\"] = control[\"Number of Action\"] \/ control[\"# of Website Clicks\"] * 100\ntest[\"Conversion Rate\"] = test[\"Number of Action\"] \/ test[\"# of Website Clicks\"] * 100\n\ncontrol_nop = pd.DataFrame(control[\"# of Purchase\"])\ntest_nop = pd.DataFrame(test[\"# of Purchase\"])\n\nGroup_A = control.loc[:, \"# of Purchase\":\"Conversion Rate\"].drop(columns='Number of Action')\nGroup_A[\"Group\"] = \"A (MaximumBidding)\"\n\nGroup_B = test.loc[:, \"# of Purchase\":\"Conversion Rate\"].drop(columns='Number of Action')\nGroup_B[\"Group\"] = \"B (AverageBidding)\"\n\nAB = pd.concat([Group_A, Group_B])\nAB.head(3)","6590420a":"AB['Group'].value_counts()","2486b8db":"cols = [\"Website Click Through Rate\",\"Cost per Action\",\"Conversion Rate\",\"# of Purchase\"]\nfig, axarr = plt.subplots(2, 2, figsize=(18,9))\nfor i in [0,1] :\n    for j in [0,1] :\n        for c in cols :\n            sns.boxplot(y=c, x = \"Group\", hue = \"Group\", data = AB, ax=axarr[i][j])\n            cols.remove(c)\n            break","5310be45":"df_AB = pd.concat([control_nop, test_nop], axis = 1)\ndf_AB.columns = [\"A\",\"B\"]\ndf_AB.head(3)","06624de3":"p_value = shapiro(df_AB.A)[1]\ncheckReject(p_value)","b2704395":"p_value = shapiro(df_AB.B)[1]\ncheckReject(p_value)","716480b6":"# **H0** : Varyanslar homojendir.\n# **H1** : Varyanslar homojen de\u011fildir.\n\np_value = stats.levene(df_AB.A, df_AB.B)[1]\ncheckReject(p_value)","7533c932":"p_value = stats.mannwhitneyu(df_AB.A, df_AB.B)[1]\ncheckReject(p_value)","dac2d1b8":"## 4. Preparing Data for Hypothesis Testing (A\/B Test)\n\nLet's create a feature with the help of functions and create a feature for visualization and prepare it.","639c62b2":"### 5.1.2. Variance Homogeneity Assumption (**Levene Test**)\n * **H0** : Variances are homogeneous.\n * **H1** : Variances are not homogeneous.","4283b44f":"### 4.1. Website Click Through Rate (CTR)\n- It is a rate that shows how often the users who saw the ad CLICK the ad.\n- Number of Ad Clicks \/ Number of Ad Displays\n- Example: 5 clicks, CTR at 100 impressions = 5%\n\n- ##### Use visualizations to compare test and control group metrics, such as Website Click Through Rate, Cost per Action, and Conversion Rates in addition to Purchase numbers.","c9688577":"Let's create our df for AB test.","8564f5e8":"Fill the control dataframe values NaN value with KNNImputer.","ae1d531d":"## 6. Conclusion and Evaluation \n\n\n##### You should answer the following questions in your presentation:\n\n\n**1. How would you define the hypothesis of this A\/B test ?**\n\n   **Hipotez:**\n   - **H0** : When it comes to Maximum Bidding and Average Bidding, there is no statistically significant difference between the purchase amounts of the two groups. \n    \n   - **H1** : ... there is a difference\n\n   \n**2. Can we conclude statistically significant results?**\n\n   - I observed that there was no statistically significant difference between the amount of purchases made with the Maximum Bidding and Average Bidding methods, since the pvalue value for the ** Nonparametric Independent Two-Sample T Test ** I performed using the Test and Control group data set was greater than 0.05. \n\n\n**3. Which statistical test did you use, and why?**\n    \n   - I used the nonparametric Independent Two Sample T Test (Mannwihtneyu) statistical method. Because the return of a new system is wanted to be tested. For this purpose, user behaviors are examined and statistically compared with each other with the Control Group, which uses the old system with equal number of observations, and the Test Group, which uses the new system. Since these 2 groups will use different systems independently of each other, Independent Two-Sample T Test was used.\n   \n    \n**4. Based on your answer to Question 2, what would be your recommendation to client?**\n\n   - This test was conducted on datasets containing 30 observations. In accordance with the Law of Large Numbers, as the number of observations increases, the tests performed will produce the most realistic results. Therefore, since there is no statistically significant difference between the returns of the old and new systems, it would be better to examine the systems for a while by increasing the number of observations in the data set. In other words, repeating this hypothesis test with new data sets by increasing the amount of purchases in both systems and continuing to collect data can give us a statistically significant difference and this situation should be tested.\n\n\n## HINTS\n**Explain the concept of statistical testing for a non-technical audience.**\n  \n  - When we develop a system technically by investing time and resources, we want to measure whether the new system is a better system than the old one, whether the work we do is worth the result we have, in short, whether the stone we throw is worth the frog we frightened. It is possible to talk about this situation with numbers, net values and statistics. For example, here we divide our data into 2 equal parts. We measured the performance of the old system with the first of these parts and the performance of the new system with the second, and these measurements produced some mathematical values for us. By comparing these values with some statistical assumptions (such as comparing the pvalue value with 0.05), we were able to determine whether there was a statistical difference between the performance of these systems and performed a statistical test.\n\n\n**Use visualizations to compare test and control group metrics, such as Website Click Through Rate, Cost per Action, and Conversion Rates in addition to Purchase numbers.**\n\n  - For the newly derived \"Website Click Through Rate\", \"Cost per Action\", \"Conversion Rates\" variables and the \"Purchase numbers\" variable we have, the above visualization charts in Test and Control groups are below.\n  \n  \n \n## 7. Recommendation to Client\n\n- When the new system is compared with the old system, it is seen that the number of purchases does not change, the cost increases and the clicks decrease.\n \n- When the Conversion Rate is based on the purchasing status among those who add to the basket and those who look at the product details, a comparison is made in favor of the test group.\n \n- **Therefore, retesting is recommended by collecting more data. If there is no such opportunity or time, it is recommended to continue with the existing bidding system.**","bcba1e4c":"Note: This notebook was referece for my self-training from https:\/\/www.kaggle.com\/mathchi\/ab-test-for-real-data\/ by [Mehmet A.](https:\/\/www.kaggle.com\/mathchi)<br>\nSince the original dataset is private, I faked one for running it through. Some row of the data was copied data from originally showed. Others was kind of randomly generated.","b5282d26":"## 1. Import libraries","5dc1325d":"Let's look at the numbers A and B.","d5c268a5":"## 2. Functions","4d0f7f05":"**Comment:** Since the pvalue = 0.36> 0.05, the H0 hypothesis, that is, **the variances were not statistically rejected as homogeneous.**","4182855f":"So, we could not reject that there was no statistically significant difference between the purchase amounts of the Average Bidding and Maximum Bidding systems.","3239768f":"If we look at the 12th line, we can see the NaN value.","cd86f0c1":"data type conversions from float64 to int64.","8379962c":"## 3. Data Preparation","f4e141ff":"### 5.1.3. Nonparametric Independent Two-Sample T Test (Mann\u2013Whitney U test) \n\n- Since the normality of the distribution of the data set in which Average Bidding (Test Group) was measured was rejected, the [NonParametric](https:\/\/machinelearningmastery.com\/nonparametric-statistical-significance-tests-in-python\/) Independent Two-Sample T Test was applied for the Hypothesis Test.\n\n**Hypothesis:**\n\n * **H0** : When it comes to Maximum Bidding and Average Bidding, there is no statistically significant difference between the purchasing amounts of the two groups. ($\\mu_1 = \\mu_2$)\n\n * **H1** : ... there is a difference ($\\mu_1 \\neq \\mu_2$)","5f5e8815":"Let's combine categorical and numerical variables with the concept.","afe307d7":"## 5. Two Independent Sample T Test\n### 5.1. Assumption Check \n#### 5.1.1. Normality Assumption (**Shapiro Test**) \n\n * **H0**: Normal distribution assumption is provided.\n * **H1**: ... not provided.","69865bfa":"# Data Science Analyze and Present A\/B Test Results\n\nAA company recently introduced a new bidding type, \u201caverage bidding\u201d, as an alternative to its exisiting bidding\ntype, called \u201cmaximum bidding\u201d. One of our clients, --------.com, has decided to test this new feature\nand wants to conduct an A\/B test to understand if average bidding brings more conversions than maximum\nbidding.\n\nIn this A\/B test, --------.com randomly splits its audience into two equally sized groups, e.g. the test\nand the control group. AA company ad campaign with \u201cmaximum bidding\u201d is served to \u201ccontrol group\u201d and\nanother campaign with \u201caverage bidding\u201d is served to the \u201ctest group\u201d.\n\nThe A\/B test has run for 1 month and --------.com now expects you to analyze and present the results\nof this A\/B test.\n\n\n\n##### You should answer the following questions in your presentation:\n\n1. How would you define the hypothesis of this A\/B test?\n2. Can we conclude statistically significant results?\n3. Which statistical test did you use, and why?\n4. Based on your answer to Question 2, what would be your recommendation to client?\n\n\n##### Hints:\n1. Your presentation should last about 15 minutes, and should be presented in English.\n2. The ultimate success metric for HotelsForYou.com is Number of Purchases. Therefore, you should focus on Purchase metrics for statistical testing.\n3. Explain the concept of statistical testing for a non-technical audience.\n4. The customer journey for this campaign is:\n    1. User sees an ad (Impression)\n    2. User clicks on the website link on the ad (Website Click)\n    3. User makes a search on the website (Search)\n    4. User views details of a product (View Content)\n    5. User adds the product to the cart (Add to Cart)\n    6. User purchases the product (Purchase)\n5. Use visualizations to compare test and control group metrics, such as Website Click Through Rate, Cost per Action, and Conversion Rates in addition to Purchase numbers.\n6. If you see trends, anomalies or other patterns, discuss these in your presentation.\n7. You can make assumptions if needed."}}