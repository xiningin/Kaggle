{"cell_type":{"a245ba02":"code","2e9a087e":"code","0fa31273":"code","1f3a2c2a":"code","256f415b":"code","295d61ef":"code","44ffe456":"code","24a4c23e":"code","3b62a97f":"code","93a4a583":"code","b7065c25":"code","8b731324":"code","26ff11ce":"code","94f34e4b":"code","b362bc62":"code","9c700237":"code","0851f1ca":"code","866d788b":"code","3ec7bdf3":"code","1f6662d0":"code","e168e91a":"code","10b5468d":"code","52f4ed4e":"code","cc51f3d0":"code","a6e5eaf6":"code","11ce3e74":"code","40d3f3a1":"markdown","58748eda":"markdown","a54cbdb6":"markdown","88ff2a01":"markdown","9018fb36":"markdown","668aad63":"markdown","ff1096e5":"markdown","71057443":"markdown","5e31a2df":"markdown","c3733c6d":"markdown","98eb3115":"markdown","7ac8b970":"markdown"},"source":{"a245ba02":"# Load the dataset\nimport pandas as pd\ndf = pd.read_csv(\"..\/input\/stroke-prediction-dataset\/healthcare-dataset-stroke-data.csv\")\ndf.head()","2e9a087e":"del df['id']\ndf.info()","0fa31273":"print(df.isnull().sum())","1f3a2c2a":"import matplotlib.pyplot as plt\n\nfig, axs = plt.subplots(2, 5)\naxs[0, 0].bar(df.gender.unique(),  df.gender.value_counts())\naxs[0, 0].set_title('Gender')\naxs[0, 1].bar(df.age.unique(),  df.age.value_counts())\naxs[0, 1].set_title('Age')\naxs[0, 2].bar(df.hypertension.unique(),  df.hypertension.value_counts())\naxs[0, 2].set_title('Hypertension')\naxs[0, 3].bar(df.heart_disease.unique(),  df.heart_disease.value_counts())\naxs[0, 3].set_title('Heart Disease')\naxs[0, 4].bar(df.ever_married.unique(),  df.ever_married.value_counts())\naxs[0, 4].set_title('Ever Married')\naxs[1, 0].bar(df.work_type.unique(),  df.work_type.value_counts())\naxs[1, 0].set_title('Work Type')\naxs[1, 1].bar(df.Residence_type.unique(),  df.Residence_type.value_counts())\naxs[1, 1].set_title('Residence type ')\naxs[1, 2].bar(df.avg_glucose_level.unique(),  df.avg_glucose_level.value_counts())\naxs[1, 2].set_title('avg_glucose_level')\naxs[1, 3].bar(df.stroke.unique(),  df.stroke.value_counts())\naxs[1, 3].set_title('stroke')\naxs[1, 4].bar(df.smoking_status.unique(),  df.smoking_status.value_counts())\naxs[1, 4].set_title('smoking_status')\nfig.set_figheight(8)\nfig.set_figwidth(25)\nfig.tight_layout()\nfig.show()","256f415b":"import numpy as np\n\nneg, pos = np.bincount(df['stroke'])\ntotal = neg + pos\nprint('Examples:\\n    Total: {}\\n    Stroke: {} ({:.2f}% of total)\\n'.format(\n    total, pos, 100 * pos \/ total))","295d61ef":"from sklearn.preprocessing import LabelEncoder\n# LabelEncoder\nle = LabelEncoder()\n\n# apply \"le.fit_transform\"\ndf_encoded = df.apply(le.fit_transform)\ndf_encoded","44ffe456":"# Scaling\nfrom sklearn.preprocessing import StandardScaler\n\nfeatures = ['gender','age','hypertension','heart_disease','ever_married', 'work_type', 'Residence_type', 'avg_glucose_level','bmi', 'smoking_status']\nft_to_scale = ['age', 'work_type', 'avg_glucose_level', 'bmi', 'smoking_status']\nscaler = StandardScaler()\ndf_encoded[ft_to_scale] = scaler.fit_transform(df_encoded[ft_to_scale])","24a4c23e":"df_encoded","3b62a97f":"import seaborn as sns\nsns.catplot(y=\"work_type\", hue=\"stroke\", kind=\"count\",\n            palette=\"pastel\", edgecolor=\".6\",\n            data=df)","93a4a583":"sns.catplot(y=\"smoking_status\", hue=\"stroke\", kind=\"count\",\n            palette=\"pastel\", edgecolor=\".6\",\n            data=df)","b7065c25":"sns.catplot(y=\"heart_disease\", hue=\"stroke\", kind=\"count\",\n            palette=\"pastel\", edgecolor=\".6\",\n            data=df)","8b731324":"column_means = df_encoded.bmi.mean()\ndf_encoded.bmi = df_encoded.bmi.fillna(column_means)","26ff11ce":"!pip install heatmapz\n","94f34e4b":"# Import the two methods from heatmap library\nfrom heatmap import heatmap, corrplot\nplt.figure(figsize=(8, 8))\ncorrplot(df_encoded.corr(), size_scale=1000);","b362bc62":"df_encoded.info()","9c700237":"df_encoded.describe()","0851f1ca":"from sklearn.model_selection import train_test_split\n\nX = df_encoded[features]\ny = df_encoded['stroke']\n# split into 70:30 ration\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.3, random_state = 0)\n  \n# describes info about train and test set\nprint(\"Number transactions X_train dataset: \", X_train.shape)\nprint(\"Number transactions y_train dataset: \", y_train.shape)\nprint(\"Number transactions X_test dataset: \", X_test.shape)\nprint(\"Number transactions y_test dataset: \", y_test.shape)","866d788b":"from imblearn.over_sampling import SMOTE\nprint(\"Before OverSampling, counts of label '1': {}\".format(sum(y_train == 1)))\nprint(\"Before OverSampling, counts of label '0': {} \\n\".format(sum(y_train == 0)))\n  \n\nsm = SMOTE(random_state = 2)\nX_train_res, y_train_res = sm.fit_resample(X_train, y_train.ravel())\n  \nprint('After OverSampling, the shape of train_X: {}'.format(X_train_res.shape))\nprint('After OverSampling, the shape of train_y: {} \\n'.format(y_train_res.shape))\n  \nprint(\"After OverSampling, counts of label '1': {}\".format(sum(y_train_res == 1)))\nprint(\"After OverSampling, counts of label '0': {}\".format(sum(y_train_res == 0)))","3ec7bdf3":"from sklearn.pipeline import Pipeline\nfrom sklearn.compose import ColumnTransformer\nfrom sklearn.metrics import confusion_matrix\nfrom sklearn.metrics import classification_report\nfrom imblearn.over_sampling import RandomOverSampler","1f6662d0":"from sklearn.linear_model import LogisticRegression\nlog_reg = LogisticRegression()\nlog_reg.fit(X_train_res, y_train_res)\nY_pred = log_reg.predict(X_test)\nsns.heatmap(confusion_matrix(y_test, Y_pred),annot=True,fmt='d',cmap='Blues')\nprint(classification_report(y_test, Y_pred))","e168e91a":"from sklearn import svm\n\nclf = svm.SVC()\nclf.fit(X_train_res, y_train_res)\nY_pred = clf.predict(X_test)\nsns.heatmap(confusion_matrix(y_test, Y_pred),annot=True,fmt='d',cmap='Blues')\nprint(classification_report(y_test, Y_pred))","10b5468d":"from sklearn.ensemble import RandomForestClassifier\nfrom sklearn.datasets import make_classification\nfrom sklearn.model_selection import RepeatedStratifiedKFold\n# Instantiate model with 1000 decision trees\nrf = RandomForestClassifier(n_estimators = 200, random_state = 1, criterion='gini')\n# Train the model on training data\nrf.fit(X_train_res, y_train_res)\nY_pred = rf.predict(X_test)\nsns.heatmap(confusion_matrix(y_test, Y_pred),annot=True,fmt='d',cmap='Blues')\nprint(classification_report(y_test, Y_pred))\ncv = RepeatedStratifiedKFold(n_splits=10, n_repeats=3, random_state=0)\n","52f4ed4e":"from sklearn.model_selection import GridSearchCV","cc51f3d0":"grid_models = [(LogisticRegression(),[{'C':[0.25,0.5,0.75,1],'random_state':[0],'solver': ['liblinear','lbfgs']}])]\nfor i,j in grid_models:\n    grid = GridSearchCV(estimator=i,param_grid = j, scoring = 'accuracy')\n    grid.fit(X_train_res, y_train_res)\n    best_accuracy = grid.best_score_\n    best_param = grid.best_params_\n    print('{}:\\nBest Accuracy : {:.2f}%'.format(i,best_accuracy*100))\n    print('Best Parameters : ',best_param)\n    print('')\n    print('----------------')\n    print('')","a6e5eaf6":"from sklearn.metrics import accuracy_score, confusion_matrix, roc_auc_score, ConfusionMatrixDisplay, precision_score, recall_score, f1_score, classification_report, roc_curve, plot_roc_curve, auc, precision_recall_curve, plot_precision_recall_curve, average_precision_score\nfrom sklearn.model_selection import cross_val_score","11ce3e74":"#Using best fit parameters\nclassifier = LogisticRegression(C= 0.25, random_state= 0, solver= 'liblinear')\nclassifier.fit(X_train_res, y_train_res)\ny_pred = classifier.predict(X_test)\ny_prob = classifier.predict_proba(X_test)[:,1]\ncm = confusion_matrix(y_test, y_pred)\n\nprint(classification_report(y_test, y_pred))\nprint(f'ROC AUC score: {roc_auc_score(y_test, y_prob)}')\nprint('Accuracy Score: ',accuracy_score(y_test, y_pred))\nprint('F1 Score: ',f1_score(y_test,y_pred))\nprint('Recall: ', recall_score(y_test,y_pred))\n# Visualizing Confusion Matrix\nplt.figure(figsize = (8, 5))\nsns.heatmap(cm, cmap = 'Blues', annot = True, fmt = 'd', linewidths = 5, cbar = False, annot_kws = {'fontsize': 15}, \n            yticklabels = ['No stroke', 'Stroke'], xticklabels = ['Predicted no stroke', 'Predicted stroke'])\nplt.yticks(rotation = 0)\nplt.show()\n\n# Roc AUC Curve\nfalse_positive_rate, true_positive_rate, thresholds = roc_curve(y_test, y_prob)\nroc_auc = auc(false_positive_rate, true_positive_rate)\n\nsns.set_theme(style = 'white')\nplt.figure(figsize = (8, 8))\nplt.plot(false_positive_rate,true_positive_rate, color = '#b01717', label = 'AUC = %0.3f' % roc_auc)\nplt.legend(loc = 'lower right')\nplt.plot([0, 1], [0, 1], linestyle = '--', color = '#174ab0')\nplt.axis('tight')\nplt.ylabel('True Positive Rate')\nplt.xlabel('False Positive Rate')\nplt.legend()\nplt.show()","40d3f3a1":"We have NaN data in bmi, for now let's do an EDA ","58748eda":"## Data cleaning","a54cbdb6":"**We can see that our dataset is imbalanced on stroke subjects**","88ff2a01":"**LogisticRegression** gives best results for F1 score, let's tune it!","9018fb36":"We have an imbalanced dataset, we can apply SMOTE technique","668aad63":"According to the World Health Organization (WHO) stroke is the 2nd leading cause of death globally, responsible for approximately 11% of total deaths.\nThis dataset is used to predict whether a patient is likely to get stroke based on the input parameters like gender, age, various diseases, and smoking status. Each row in the data provides relavant information about the patient.","ff1096e5":"**81.1% AUC** **75.6% Accuracy** **71.05% Recall** ","71057443":"# Stroke Prediction\n","5e31a2df":"1) id: unique identifier\n2) gender: \"Male\", \"Female\" or \"Other\"\n3) age: age of the patient\n4) hypertension: 0 if the patient doesn't have hypertension, 1 if the patient has hypertension\n5) heart_disease: 0 if the patient doesn't have any heart diseases, 1 if the patient has a heart disease\n6) ever_married: \"No\" or \"Yes\"\n7) work_type: \"children\", \"Govt_jov\", \"Never_worked\", \"Private\" or \"Self-employed\"\n8) Residence_type: \"Rural\" or \"Urban\"\n9) avg_glucose_level: average glucose level in blood\n10) bmi: body mass index\n11) smoking_status: \"formerly smoked\", \"never smoked\", \"smokes\" or \"Unknown\"*\n12) stroke: 1 if the patient had a stroke or 0 if not\n*Note: \"Unknown\" in smoking_status means that the information is unavailable for this patient\n\n\n","c3733c6d":"Now we can encode our categorical variables","98eb3115":"Deal with NaN values\n","7ac8b970":"We can see from the previous plot that there is some sort of correlation between heart disease history and stroke occurrancies. \nInstead, in this dataset we don't have a major incidence of strokes with smokers. Probably due to the lack of data. "}}